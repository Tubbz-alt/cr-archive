<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/JITOperations.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JITOpcodes32_64.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JITOperations.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/JITOperations.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (C) 2013-2019 Apple Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2013-2020 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -28,11 +28,12 @@</span>
  
  #if ENABLE(JIT)
  
  #include &quot;ArithProfile.h&quot;
  #include &quot;ArrayConstructor.h&quot;
<span class="udiff-line-modified-removed">- #include &quot;CommonSlowPaths.h&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;CacheableIdentifierInlines.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;CommonSlowPathsInlines.h&quot;</span>
  #include &quot;DFGCompilationMode.h&quot;
  #include &quot;DFGDriver.h&quot;
  #include &quot;DFGOSREntry.h&quot;
  #include &quot;DFGThunks.h&quot;
  #include &quot;DFGWorklist.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -52,15 +53,17 @@</span>
  #include &quot;Interpreter.h&quot;
  #include &quot;JIT.h&quot;
  #include &quot;JITExceptions.h&quot;
  #include &quot;JITToDFGDeferredCompilationCallback.h&quot;
  #include &quot;JSAsyncFunction.h&quot;
<span class="udiff-line-added">+ #include &quot;JSAsyncGenerator.h&quot;</span>
  #include &quot;JSAsyncGeneratorFunction.h&quot;
  #include &quot;JSCInlines.h&quot;
  #include &quot;JSCPtrTag.h&quot;
  #include &quot;JSGeneratorFunction.h&quot;
  #include &quot;JSGlobalObjectFunctions.h&quot;
<span class="udiff-line-added">+ #include &quot;JSInternalPromise.h&quot;</span>
  #include &quot;JSLexicalEnvironment.h&quot;
  #include &quot;JSWithScope.h&quot;
  #include &quot;ModuleProgramCodeBlock.h&quot;
  #include &quot;ObjectConstructor.h&quot;
  #include &quot;PolymorphicAccess.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -77,12 +80,22 @@</span>
  #include &quot;TypeProfilerLog.h&quot;
  #include &quot;VMInlines.h&quot;
  #include &quot;WebAssemblyFunction.h&quot;
  #include &lt;wtf/InlineASM.h&gt;
  
<span class="udiff-line-added">+ IGNORE_WARNINGS_BEGIN(&quot;frame-address&quot;)</span>
<span class="udiff-line-added">+ </span>
  namespace JSC {
  
<span class="udiff-line-added">+ ALWAYS_INLINE JSValue profiledAdd(JSGlobalObject* globalObject, JSValue op1, JSValue op2, BinaryArithProfile&amp; arithProfile)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     arithProfile.observeLHSAndRHS(op1, op2);</span>
<span class="udiff-line-added">+     JSValue result = jsAdd(globalObject, op1, op2);</span>
<span class="udiff-line-added">+     arithProfile.observeResult(result);</span>
<span class="udiff-line-added">+     return result;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  extern &quot;C&quot; {
  
  #if COMPILER(MSVC)
  void * _ReturnAddress(void);
  #pragma intrinsic(_ReturnAddress)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -97,551 +110,584 @@</span>
  #else
  #define CTI_SAMPLER 0
  #endif
  
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationThrowStackOverflowError(ExecState* exec, CodeBlock* codeBlock)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationThrowStackOverflowError(CodeBlock* codeBlock)</span>
  {
      // We pass in our own code block, because the callframe hasn&#39;t been populated.
      VM&amp; vm = codeBlock-&gt;vm();
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="udiff-line-modified-removed">-     exec-&gt;convertToStackOverflowFrame(vm, codeBlock);</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-removed">-     throwStackOverflowError(exec, scope);</span>
<span class="udiff-line-modified-added">+     callFrame-&gt;convertToStackOverflowFrame(vm, codeBlock);</span>
<span class="udiff-line-modified-added">+     throwStackOverflowError(codeBlock-&gt;globalObject(), scope);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION throwStackOverflowErrorFromThunk(VM* vmPointer, ExecState* exec)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationThrowStackOverflowErrorFromThunk(JSGlobalObject* globalObject)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-removed">-     throwStackOverflowError(exec, scope);</span>
<span class="udiff-line-removed">-     genericUnwind(vm, exec);</span>
<span class="udiff-line-modified-added">+     throwStackOverflowError(globalObject, scope);</span>
<span class="udiff-line-modified-added">+     genericUnwind(vm, callFrame);</span>
      ASSERT(vm.targetMachinePCForThrow);
  }
  
<span class="udiff-line-modified-removed">- int32_t JIT_OPERATION operationCallArityCheck(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ int32_t JIT_OPERATION operationCallArityCheck(JSGlobalObject* globalObject)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     int32_t missingArgCount = CommonSlowPaths::arityCheckFor(exec, vm, CodeForCall);</span>
<span class="udiff-line-modified-added">+     int32_t missingArgCount = CommonSlowPaths::arityCheckFor(vm, callFrame, CodeForCall);</span>
      if (UNLIKELY(missingArgCount &lt; 0)) {
<span class="udiff-line-modified-removed">-         CodeBlock* codeBlock = CommonSlowPaths::codeBlockFromCallFrameCallee(exec, CodeForCall);</span>
<span class="udiff-line-modified-removed">-         exec-&gt;convertToStackOverflowFrame(vm, codeBlock);</span>
<span class="udiff-line-modified-removed">-         NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-removed">-         throwStackOverflowError(vm.topCallFrame, scope);</span>
<span class="udiff-line-modified-added">+         CodeBlock* codeBlock = CommonSlowPaths::codeBlockFromCallFrameCallee(callFrame, CodeForCall);</span>
<span class="udiff-line-modified-added">+         callFrame-&gt;convertToStackOverflowFrame(vm, codeBlock);</span>
<span class="udiff-line-modified-added">+         throwStackOverflowError(globalObject, scope);</span>
      }
  
      return missingArgCount;
  }
  
<span class="udiff-line-modified-removed">- int32_t JIT_OPERATION operationConstructArityCheck(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ int32_t JIT_OPERATION operationConstructArityCheck(JSGlobalObject* globalObject)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     int32_t missingArgCount = CommonSlowPaths::arityCheckFor(exec, vm, CodeForConstruct);</span>
<span class="udiff-line-modified-added">+     int32_t missingArgCount = CommonSlowPaths::arityCheckFor(vm, callFrame, CodeForConstruct);</span>
      if (UNLIKELY(missingArgCount &lt; 0)) {
<span class="udiff-line-modified-removed">-         CodeBlock* codeBlock = CommonSlowPaths::codeBlockFromCallFrameCallee(exec, CodeForConstruct);</span>
<span class="udiff-line-modified-removed">-         exec-&gt;convertToStackOverflowFrame(vm, codeBlock);</span>
<span class="udiff-line-modified-removed">-         NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-removed">-         throwStackOverflowError(vm.topCallFrame, scope);</span>
<span class="udiff-line-modified-added">+         CodeBlock* codeBlock = CommonSlowPaths::codeBlockFromCallFrameCallee(callFrame, CodeForConstruct);</span>
<span class="udiff-line-modified-added">+         callFrame-&gt;convertToStackOverflowFrame(vm, codeBlock);</span>
<span class="udiff-line-modified-added">+         throwStackOverflowError(globalObject, scope);</span>
      }
  
      return missingArgCount;
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationTryGetById(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationTryGetById(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      Identifier ident = Identifier::fromUid(vm, uid);
      stubInfo-&gt;tookSlowPath = true;
  
      JSValue baseValue = JSValue::decode(base);
      PropertySlot slot(baseValue, PropertySlot::InternalMethodType::VMInquiry);
<span class="udiff-line-modified-removed">-     baseValue.getPropertySlot(exec, ident, slot);</span>
<span class="udiff-line-modified-added">+     baseValue.getPropertySlot(globalObject, ident, slot);</span>
  
      return JSValue::encode(slot.getPureResult());
  }
  
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationTryGetByIdGeneric(ExecState* exec, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationTryGetByIdGeneric(JSGlobalObject* globalObject, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      Identifier ident = Identifier::fromUid(vm, uid);
  
      JSValue baseValue = JSValue::decode(base);
      PropertySlot slot(baseValue, PropertySlot::InternalMethodType::VMInquiry);
<span class="udiff-line-modified-removed">-     baseValue.getPropertySlot(exec, ident, slot);</span>
<span class="udiff-line-modified-added">+     baseValue.getPropertySlot(globalObject, ident, slot);</span>
  
      return JSValue::encode(slot.getPureResult());
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationTryGetByIdOptimize(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationTryGetByIdOptimize(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      Identifier ident = Identifier::fromUid(vm, uid);
  
      JSValue baseValue = JSValue::decode(base);
      PropertySlot slot(baseValue, PropertySlot::InternalMethodType::VMInquiry);
  
<span class="udiff-line-modified-removed">-     baseValue.getPropertySlot(exec, ident, slot);</span>
<span class="udiff-line-modified-added">+     baseValue.getPropertySlot(globalObject, ident, slot);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
<span class="udiff-line-modified-removed">-     if (stubInfo-&gt;considerCaching(vm, exec-&gt;codeBlock(), baseValue.structureOrNull()) &amp;&amp; !slot.isTaintedByOpaqueObject() &amp;&amp; (slot.isCacheableValue() || slot.isCacheableGetter() || slot.isUnset()))</span>
<span class="udiff-line-modified-removed">-         repatchGetByID(exec, baseValue, ident, slot, *stubInfo, GetByIDKind::Try);</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     if (stubInfo-&gt;considerCaching(vm, codeBlock, baseValue.structureOrNull()) &amp;&amp; !slot.isTaintedByOpaqueObject() &amp;&amp; (slot.isCacheableValue() || slot.isCacheableGetter() || slot.isUnset()))</span>
<span class="udiff-line-added">+         repatchGetBy(globalObject, codeBlock, baseValue, ident, slot, *stubInfo, GetByKind::Try);</span>
  
      return JSValue::encode(slot.getPureResult());
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetByIdDirect(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetByIdDirect(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      Identifier ident = Identifier::fromUid(vm, uid);
      stubInfo-&gt;tookSlowPath = true;
  
      JSValue baseValue = JSValue::decode(base);
      PropertySlot slot(baseValue, PropertySlot::InternalMethodType::GetOwnProperty);
  
<span class="udiff-line-modified-removed">-     bool found = baseValue.getOwnPropertySlot(exec, ident, slot);</span>
<span class="udiff-line-modified-added">+     bool found = baseValue.getOwnPropertySlot(globalObject, ident, slot);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
<span class="udiff-line-modified-removed">-     RELEASE_AND_RETURN(scope, JSValue::encode(found ? slot.getValue(exec, ident) : jsUndefined()));</span>
<span class="udiff-line-modified-added">+     RELEASE_AND_RETURN(scope, JSValue::encode(found ? slot.getValue(globalObject, ident) : jsUndefined()));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetByIdDirectGeneric(ExecState* exec, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetByIdDirectGeneric(JSGlobalObject* globalObject, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      Identifier ident = Identifier::fromUid(vm, uid);
  
      JSValue baseValue = JSValue::decode(base);
      PropertySlot slot(baseValue, PropertySlot::InternalMethodType::GetOwnProperty);
  
<span class="udiff-line-modified-removed">-     bool found = baseValue.getOwnPropertySlot(exec, ident, slot);</span>
<span class="udiff-line-modified-added">+     bool found = baseValue.getOwnPropertySlot(globalObject, ident, slot);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
<span class="udiff-line-modified-removed">-     RELEASE_AND_RETURN(scope, JSValue::encode(found ? slot.getValue(exec, ident) : jsUndefined()));</span>
<span class="udiff-line-modified-added">+     RELEASE_AND_RETURN(scope, JSValue::encode(found ? slot.getValue(globalObject, ident) : jsUndefined()));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetByIdDirectOptimize(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetByIdDirectOptimize(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      Identifier ident = Identifier::fromUid(vm, uid);
  
      JSValue baseValue = JSValue::decode(base);
      PropertySlot slot(baseValue, PropertySlot::InternalMethodType::GetOwnProperty);
  
<span class="udiff-line-modified-removed">-     bool found = baseValue.getOwnPropertySlot(exec, ident, slot);</span>
<span class="udiff-line-modified-added">+     bool found = baseValue.getOwnPropertySlot(globalObject, ident, slot);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
<span class="udiff-line-modified-removed">-     if (stubInfo-&gt;considerCaching(vm, exec-&gt;codeBlock(), baseValue.structureOrNull()))</span>
<span class="udiff-line-modified-removed">-         repatchGetByID(exec, baseValue, ident, slot, *stubInfo, GetByIDKind::Direct);</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     if (stubInfo-&gt;considerCaching(vm, codeBlock, baseValue.structureOrNull()))</span>
<span class="udiff-line-added">+         repatchGetBy(globalObject, codeBlock, baseValue, ident, slot, *stubInfo, GetByKind::Direct);</span>
  
<span class="udiff-line-modified-removed">-     RELEASE_AND_RETURN(scope, JSValue::encode(found ? slot.getValue(exec, ident) : jsUndefined()));</span>
<span class="udiff-line-modified-added">+     RELEASE_AND_RETURN(scope, JSValue::encode(found ? slot.getValue(globalObject, ident) : jsUndefined()));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetById(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetById(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      stubInfo-&gt;tookSlowPath = true;
  
      JSValue baseValue = JSValue::decode(base);
      PropertySlot slot(baseValue, PropertySlot::InternalMethodType::Get);
      Identifier ident = Identifier::fromUid(vm, uid);
<span class="udiff-line-modified-removed">-     JSValue result = baseValue.get(exec, ident, slot);</span>
<span class="udiff-line-modified-added">+     JSValue result = baseValue.get(globalObject, ident, slot);</span>
  
      LOG_IC((ICEvent::OperationGetById, baseValue.classInfoOrNull(vm), ident, baseValue == slot.slotBase()));
  
      return JSValue::encode(result);
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetByIdGeneric(ExecState* exec, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetByIdGeneric(JSGlobalObject* globalObject, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue baseValue = JSValue::decode(base);
      PropertySlot slot(baseValue, PropertySlot::InternalMethodType::Get);
      Identifier ident = Identifier::fromUid(vm, uid);
<span class="udiff-line-modified-removed">-     JSValue result = baseValue.get(exec, ident, slot);</span>
<span class="udiff-line-modified-added">+     JSValue result = baseValue.get(globalObject, ident, slot);</span>
  
      LOG_IC((ICEvent::OperationGetByIdGeneric, baseValue.classInfoOrNull(vm), ident, baseValue == slot.slotBase()));
  
      return JSValue::encode(result);
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetByIdOptimize(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetByIdOptimize(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      Identifier ident = Identifier::fromUid(vm, uid);
  
      JSValue baseValue = JSValue::decode(base);
  
<span class="udiff-line-modified-removed">-     return JSValue::encode(baseValue.getPropertySlot(exec, ident, [&amp;] (bool found, PropertySlot&amp; slot) -&gt; JSValue {</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(baseValue.getPropertySlot(globalObject, ident, [&amp;] (bool found, PropertySlot&amp; slot) -&gt; JSValue {</span>
  
          LOG_IC((ICEvent::OperationGetByIdOptimize, baseValue.classInfoOrNull(vm), ident, baseValue == slot.slotBase()));
  
<span class="udiff-line-modified-removed">-         if (stubInfo-&gt;considerCaching(vm, exec-&gt;codeBlock(), baseValue.structureOrNull()))</span>
<span class="udiff-line-modified-removed">-             repatchGetByID(exec, baseValue, ident, slot, *stubInfo, GetByIDKind::Normal);</span>
<span class="udiff-line-modified-removed">-         return found ? slot.getValue(exec, ident) : jsUndefined();</span>
<span class="udiff-line-modified-added">+         CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+         if (stubInfo-&gt;considerCaching(vm, codeBlock, baseValue.structureOrNull()))</span>
<span class="udiff-line-modified-added">+             repatchGetBy(globalObject, codeBlock, baseValue, ident, slot, *stubInfo, GetByKind::Normal);</span>
<span class="udiff-line-added">+         return found ? slot.getValue(globalObject, ident) : jsUndefined();</span>
      }));
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetByIdWithThis(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue base, EncodedJSValue thisEncoded, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetByIdWithThis(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue base, EncodedJSValue thisEncoded, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      Identifier ident = Identifier::fromUid(vm, uid);
  
      stubInfo-&gt;tookSlowPath = true;
  
      JSValue baseValue = JSValue::decode(base);
      JSValue thisValue = JSValue::decode(thisEncoded);
      PropertySlot slot(thisValue, PropertySlot::InternalMethodType::Get);
  
<span class="udiff-line-modified-removed">-     return JSValue::encode(baseValue.get(exec, ident, slot));</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(baseValue.get(globalObject, ident, slot));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetByIdWithThisGeneric(ExecState* exec, EncodedJSValue base, EncodedJSValue thisEncoded, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetByIdWithThisGeneric(JSGlobalObject* globalObject, EncodedJSValue base, EncodedJSValue thisEncoded, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      Identifier ident = Identifier::fromUid(vm, uid);
  
      JSValue baseValue = JSValue::decode(base);
      JSValue thisValue = JSValue::decode(thisEncoded);
      PropertySlot slot(thisValue, PropertySlot::InternalMethodType::Get);
  
<span class="udiff-line-modified-removed">-     return JSValue::encode(baseValue.get(exec, ident, slot));</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(baseValue.get(globalObject, ident, slot));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetByIdWithThisOptimize(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue base, EncodedJSValue thisEncoded, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetByIdWithThisOptimize(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue base, EncodedJSValue thisEncoded, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      Identifier ident = Identifier::fromUid(vm, uid);
  
      JSValue baseValue = JSValue::decode(base);
      JSValue thisValue = JSValue::decode(thisEncoded);
  
      PropertySlot slot(thisValue, PropertySlot::InternalMethodType::Get);
<span class="udiff-line-modified-removed">-     return JSValue::encode(baseValue.getPropertySlot(exec, ident, slot, [&amp;] (bool found, PropertySlot&amp; slot) -&gt; JSValue {</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(baseValue.getPropertySlot(globalObject, ident, slot, [&amp;] (bool found, PropertySlot&amp; slot) -&gt; JSValue {</span>
          LOG_IC((ICEvent::OperationGetByIdWithThisOptimize, baseValue.classInfoOrNull(vm), ident, baseValue == slot.slotBase()));
  
<span class="udiff-line-modified-removed">-         if (stubInfo-&gt;considerCaching(vm, exec-&gt;codeBlock(), baseValue.structureOrNull()))</span>
<span class="udiff-line-modified-removed">-             repatchGetByID(exec, baseValue, ident, slot, *stubInfo, GetByIDKind::WithThis);</span>
<span class="udiff-line-modified-removed">-         return found ? slot.getValue(exec, ident) : jsUndefined();</span>
<span class="udiff-line-modified-added">+         CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+         if (stubInfo-&gt;considerCaching(vm, codeBlock, baseValue.structureOrNull()))</span>
<span class="udiff-line-modified-added">+             repatchGetBy(globalObject, codeBlock, baseValue, ident, slot, *stubInfo, GetByKind::WithThis);</span>
<span class="udiff-line-added">+         return found ? slot.getValue(globalObject, ident) : jsUndefined();</span>
      }));
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationInById(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationInById(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      stubInfo-&gt;tookSlowPath = true;
  
      Identifier ident = Identifier::fromUid(vm, uid);
  
      JSValue baseValue = JSValue::decode(base);
      if (!baseValue.isObject()) {
<span class="udiff-line-modified-removed">-         throwException(exec, scope, createInvalidInParameterError(exec, baseValue));</span>
<span class="udiff-line-modified-added">+         throwException(globalObject, scope, createInvalidInParameterError(globalObject, baseValue));</span>
          return JSValue::encode(jsUndefined());
      }
      JSObject* baseObject = asObject(baseValue);
  
      LOG_IC((ICEvent::OperationInById, baseObject-&gt;classInfo(vm), ident));
  
      scope.release();
      PropertySlot slot(baseObject, PropertySlot::InternalMethodType::HasProperty);
<span class="udiff-line-modified-removed">-     return JSValue::encode(jsBoolean(baseObject-&gt;getPropertySlot(exec, ident, slot)));</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(jsBoolean(baseObject-&gt;getPropertySlot(globalObject, ident, slot)));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationInByIdGeneric(ExecState* exec, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationInByIdGeneric(JSGlobalObject* globalObject, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      Identifier ident = Identifier::fromUid(vm, uid);
  
      JSValue baseValue = JSValue::decode(base);
      if (!baseValue.isObject()) {
<span class="udiff-line-modified-removed">-         throwException(exec, scope, createInvalidInParameterError(exec, baseValue));</span>
<span class="udiff-line-modified-added">+         throwException(globalObject, scope, createInvalidInParameterError(globalObject, baseValue));</span>
          return JSValue::encode(jsUndefined());
      }
      JSObject* baseObject = asObject(baseValue);
  
      LOG_IC((ICEvent::OperationInByIdGeneric, baseObject-&gt;classInfo(vm), ident));
  
      scope.release();
      PropertySlot slot(baseObject, PropertySlot::InternalMethodType::HasProperty);
<span class="udiff-line-modified-removed">-     return JSValue::encode(jsBoolean(baseObject-&gt;getPropertySlot(exec, ident, slot)));</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(jsBoolean(baseObject-&gt;getPropertySlot(globalObject, ident, slot)));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationInByIdOptimize(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationInByIdOptimize(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue base, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      Identifier ident = Identifier::fromUid(vm, uid);
  
      JSValue baseValue = JSValue::decode(base);
      if (!baseValue.isObject()) {
<span class="udiff-line-modified-removed">-         throwException(exec, scope, createInvalidInParameterError(exec, baseValue));</span>
<span class="udiff-line-modified-added">+         throwException(globalObject, scope, createInvalidInParameterError(globalObject, baseValue));</span>
          return JSValue::encode(jsUndefined());
      }
      JSObject* baseObject = asObject(baseValue);
  
      LOG_IC((ICEvent::OperationInByIdOptimize, baseObject-&gt;classInfo(vm), ident));
  
      scope.release();
      PropertySlot slot(baseObject, PropertySlot::InternalMethodType::HasProperty);
<span class="udiff-line-modified-removed">-     bool found = baseObject-&gt;getPropertySlot(exec, ident, slot);</span>
<span class="udiff-line-modified-removed">-     if (stubInfo-&gt;considerCaching(vm, exec-&gt;codeBlock(), baseObject-&gt;structure(vm)))</span>
<span class="udiff-line-modified-removed">-         repatchInByID(exec, baseObject, ident, found, slot, *stubInfo);</span>
<span class="udiff-line-modified-added">+     bool found = baseObject-&gt;getPropertySlot(globalObject, ident, slot);</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     if (stubInfo-&gt;considerCaching(vm, codeBlock, baseObject-&gt;structure(vm)))</span>
<span class="udiff-line-added">+         repatchInByID(globalObject, codeBlock, baseObject, ident, found, slot, *stubInfo);</span>
      return JSValue::encode(jsBoolean(found));
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationInByVal(ExecState* exec, JSCell* base, EncodedJSValue key)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationInByVal(JSGlobalObject* globalObject, JSCell* base, EncodedJSValue key)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     return JSValue::encode(jsBoolean(CommonSlowPaths::opInByVal(exec, base, JSValue::decode(key))));</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(jsBoolean(CommonSlowPaths::opInByVal(globalObject, base, JSValue::decode(key))));</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutByIdStrict(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutByIdStrict(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      stubInfo-&gt;tookSlowPath = true;
  
      JSValue baseValue = JSValue::decode(encodedBase);
      Identifier ident = Identifier::fromUid(vm, uid);
<span class="udiff-line-modified-removed">-     PutPropertySlot slot(baseValue, true, exec-&gt;codeBlock()-&gt;putByIdContext());</span>
<span class="udiff-line-modified-removed">-     baseValue.putInline(exec, ident, JSValue::decode(encodedValue), slot);</span>
<span class="udiff-line-modified-added">+     PutPropertySlot slot(baseValue, true, callFrame-&gt;codeBlock()-&gt;putByIdContext());</span>
<span class="udiff-line-modified-added">+     baseValue.putInline(globalObject, ident, JSValue::decode(encodedValue), slot);</span>
  
      LOG_IC((ICEvent::OperationPutByIdStrict, baseValue.classInfoOrNull(vm), ident, slot.base() == baseValue));
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutByIdNonStrict(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutByIdNonStrict(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      stubInfo-&gt;tookSlowPath = true;
  
      JSValue baseValue = JSValue::decode(encodedBase);
      Identifier ident = Identifier::fromUid(vm, uid);
<span class="udiff-line-modified-removed">-     PutPropertySlot slot(baseValue, false, exec-&gt;codeBlock()-&gt;putByIdContext());</span>
<span class="udiff-line-modified-removed">-     baseValue.putInline(exec, ident, JSValue::decode(encodedValue), slot);</span>
<span class="udiff-line-modified-added">+     PutPropertySlot slot(baseValue, false, callFrame-&gt;codeBlock()-&gt;putByIdContext());</span>
<span class="udiff-line-modified-added">+     baseValue.putInline(globalObject, ident, JSValue::decode(encodedValue), slot);</span>
  
      LOG_IC((ICEvent::OperationPutByIdNonStrict, baseValue.classInfoOrNull(vm), ident, slot.base() == baseValue));
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutByIdDirectStrict(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutByIdDirectStrict(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      stubInfo-&gt;tookSlowPath = true;
  
      JSValue baseValue = JSValue::decode(encodedBase);
      Identifier ident = Identifier::fromUid(vm, uid);
<span class="udiff-line-modified-removed">-     PutPropertySlot slot(baseValue, true, exec-&gt;codeBlock()-&gt;putByIdContext());</span>
<span class="udiff-line-modified-removed">-     CommonSlowPaths::putDirectWithReify(vm, exec, asObject(baseValue), ident, JSValue::decode(encodedValue), slot);</span>
<span class="udiff-line-modified-added">+     PutPropertySlot slot(baseValue, true, callFrame-&gt;codeBlock()-&gt;putByIdContext());</span>
<span class="udiff-line-modified-added">+     CommonSlowPaths::putDirectWithReify(vm, globalObject, asObject(baseValue), ident, JSValue::decode(encodedValue), slot);</span>
  
      LOG_IC((ICEvent::OperationPutByIdDirectStrict, baseValue.classInfoOrNull(vm), ident, slot.base() == baseValue));
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutByIdDirectNonStrict(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutByIdDirectNonStrict(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      stubInfo-&gt;tookSlowPath = true;
  
      JSValue baseValue = JSValue::decode(encodedBase);
      Identifier ident = Identifier::fromUid(vm, uid);
<span class="udiff-line-modified-removed">-     PutPropertySlot slot(baseValue, false, exec-&gt;codeBlock()-&gt;putByIdContext());</span>
<span class="udiff-line-modified-removed">-     CommonSlowPaths::putDirectWithReify(vm, exec, asObject(baseValue), ident, JSValue::decode(encodedValue), slot);</span>
<span class="udiff-line-modified-added">+     PutPropertySlot slot(baseValue, false, callFrame-&gt;codeBlock()-&gt;putByIdContext());</span>
<span class="udiff-line-modified-added">+     CommonSlowPaths::putDirectWithReify(vm, globalObject, asObject(baseValue), ident, JSValue::decode(encodedValue), slot);</span>
  
      LOG_IC((ICEvent::OperationPutByIdDirectNonStrict, baseValue.classInfoOrNull(vm), ident, slot.base() == baseValue));
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutByIdStrictOptimize(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutByIdStrictOptimize(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      Identifier ident = Identifier::fromUid(vm, uid);
      AccessType accessType = static_cast&lt;AccessType&gt;(stubInfo-&gt;accessType);
  
      JSValue value = JSValue::decode(encodedValue);
      JSValue baseValue = JSValue::decode(encodedBase);
<span class="udiff-line-modified-removed">-     CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
      PutPropertySlot slot(baseValue, true, codeBlock-&gt;putByIdContext());
  
      Structure* structure = baseValue.isCell() ? baseValue.asCell()-&gt;structure(vm) : nullptr;
<span class="udiff-line-modified-removed">-     baseValue.putInline(exec, ident, value, slot);</span>
<span class="udiff-line-modified-added">+     baseValue.putInline(globalObject, ident, value, slot);</span>
  
      LOG_IC((ICEvent::OperationPutByIdStrictOptimize, baseValue.classInfoOrNull(vm), ident, slot.base() == baseValue));
  
      RETURN_IF_EXCEPTION(scope, void());
  
      if (accessType != static_cast&lt;AccessType&gt;(stubInfo-&gt;accessType))
          return;
  
      if (stubInfo-&gt;considerCaching(vm, codeBlock, structure))
<span class="udiff-line-modified-removed">-         repatchPutByID(exec, baseValue, structure, ident, slot, *stubInfo, NotDirect);</span>
<span class="udiff-line-modified-added">+         repatchPutByID(globalObject, codeBlock, baseValue, structure, ident, slot, *stubInfo, NotDirect);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutByIdNonStrictOptimize(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutByIdNonStrictOptimize(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      Identifier ident = Identifier::fromUid(vm, uid);
      AccessType accessType = static_cast&lt;AccessType&gt;(stubInfo-&gt;accessType);
  
      JSValue value = JSValue::decode(encodedValue);
      JSValue baseValue = JSValue::decode(encodedBase);
<span class="udiff-line-modified-removed">-     CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
      PutPropertySlot slot(baseValue, false, codeBlock-&gt;putByIdContext());
  
      Structure* structure = baseValue.isCell() ? baseValue.asCell()-&gt;structure(vm) : nullptr;
<span class="udiff-line-modified-removed">-     baseValue.putInline(exec, ident, value, slot);</span>
<span class="udiff-line-modified-added">+     baseValue.putInline(globalObject, ident, value, slot);</span>
  
      LOG_IC((ICEvent::OperationPutByIdNonStrictOptimize, baseValue.classInfoOrNull(vm), ident, slot.base() == baseValue));
  
      RETURN_IF_EXCEPTION(scope, void());
  
      if (accessType != static_cast&lt;AccessType&gt;(stubInfo-&gt;accessType))
          return;
  
      if (stubInfo-&gt;considerCaching(vm, codeBlock, structure))
<span class="udiff-line-modified-removed">-         repatchPutByID(exec, baseValue, structure, ident, slot, *stubInfo, NotDirect);</span>
<span class="udiff-line-modified-added">+         repatchPutByID(globalObject, codeBlock, baseValue, structure, ident, slot, *stubInfo, NotDirect);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutByIdDirectStrictOptimize(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutByIdDirectStrictOptimize(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      Identifier ident = Identifier::fromUid(vm, uid);
      AccessType accessType = static_cast&lt;AccessType&gt;(stubInfo-&gt;accessType);
  
      JSValue value = JSValue::decode(encodedValue);
      JSObject* baseObject = asObject(JSValue::decode(encodedBase));
<span class="udiff-line-modified-removed">-     CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
      PutPropertySlot slot(baseObject, true, codeBlock-&gt;putByIdContext());
      Structure* structure = nullptr;
<span class="udiff-line-modified-removed">-     CommonSlowPaths::putDirectWithReify(vm, exec, baseObject, ident, value, slot, &amp;structure);</span>
<span class="udiff-line-modified-added">+     CommonSlowPaths::putDirectWithReify(vm, globalObject, baseObject, ident, value, slot, &amp;structure);</span>
  
      LOG_IC((ICEvent::OperationPutByIdDirectStrictOptimize, baseObject-&gt;classInfo(vm), ident, slot.base() == baseObject));
  
      RETURN_IF_EXCEPTION(scope, void());
  
      if (accessType != static_cast&lt;AccessType&gt;(stubInfo-&gt;accessType))
          return;
  
      if (stubInfo-&gt;considerCaching(vm, codeBlock, structure))
<span class="udiff-line-modified-removed">-         repatchPutByID(exec, baseObject, structure, ident, slot, *stubInfo, Direct);</span>
<span class="udiff-line-modified-added">+         repatchPutByID(globalObject, codeBlock, baseObject, structure, ident, slot, *stubInfo, Direct);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutByIdDirectNonStrictOptimize(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutByIdDirectNonStrictOptimize(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
  {
      SuperSamplerScope superSamplerScope(false);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      Identifier ident = Identifier::fromUid(vm, uid);
      AccessType accessType = static_cast&lt;AccessType&gt;(stubInfo-&gt;accessType);
  
      JSValue value = JSValue::decode(encodedValue);
      JSObject* baseObject = asObject(JSValue::decode(encodedBase));
<span class="udiff-line-modified-removed">-     CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
      PutPropertySlot slot(baseObject, false, codeBlock-&gt;putByIdContext());
      Structure* structure = nullptr;
<span class="udiff-line-modified-removed">-     CommonSlowPaths::putDirectWithReify(vm, exec, baseObject, ident, value, slot, &amp;structure);</span>
<span class="udiff-line-modified-added">+     CommonSlowPaths::putDirectWithReify(vm, globalObject, baseObject, ident, value, slot, &amp;structure);</span>
  
      LOG_IC((ICEvent::OperationPutByIdDirectNonStrictOptimize, baseObject-&gt;classInfo(vm), ident, slot.base() == baseObject));
  
      RETURN_IF_EXCEPTION(scope, void());
  
      if (accessType != static_cast&lt;AccessType&gt;(stubInfo-&gt;accessType))
          return;
  
      if (stubInfo-&gt;considerCaching(vm, codeBlock, structure))
<span class="udiff-line-modified-removed">-         repatchPutByID(exec, baseObject, structure, ident, slot, *stubInfo, Direct);</span>
<span class="udiff-line-modified-added">+         repatchPutByID(globalObject, codeBlock, baseObject, structure, ident, slot, *stubInfo, Direct);</span>
  }
  
  ALWAYS_INLINE static bool isStringOrSymbol(JSValue value)
  {
      return value.isString() || value.isSymbol();
  }
  
<span class="udiff-line-modified-removed">- static void putByVal(CallFrame* callFrame, JSValue baseValue, JSValue subscript, JSValue value, ByValInfo* byValInfo)</span>
<span class="udiff-line-modified-added">+ static void putByVal(JSGlobalObject* globalObject, CodeBlock* codeBlock, JSValue baseValue, JSValue subscript, JSValue value, ByValInfo* byValInfo)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = callFrame-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      if (LIKELY(subscript.isUInt32())) {
          byValInfo-&gt;tookSlowPath = true;
          uint32_t i = subscript.asUInt32();
          if (baseValue.isObject()) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -651,40 +697,40 @@</span>
                  return;
              }
  
              byValInfo-&gt;arrayProfile-&gt;setOutOfBounds();
              scope.release();
<span class="udiff-line-modified-removed">-             object-&gt;methodTable(vm)-&gt;putByIndex(object, callFrame, i, value, callFrame-&gt;codeBlock()-&gt;isStrictMode());</span>
<span class="udiff-line-modified-added">+             object-&gt;methodTable(vm)-&gt;putByIndex(object, globalObject, i, value, codeBlock-&gt;isStrictMode());</span>
              return;
          }
  
          scope.release();
<span class="udiff-line-modified-removed">-         baseValue.putByIndex(callFrame, i, value, callFrame-&gt;codeBlock()-&gt;isStrictMode());</span>
<span class="udiff-line-modified-added">+         baseValue.putByIndex(globalObject, i, value, codeBlock-&gt;isStrictMode());</span>
          return;
      } else if (subscript.isInt32()) {
          byValInfo-&gt;tookSlowPath = true;
          if (baseValue.isObject())
              byValInfo-&gt;arrayProfile-&gt;setOutOfBounds();
      }
  
<span class="udiff-line-modified-removed">-     auto property = subscript.toPropertyKey(callFrame);</span>
<span class="udiff-line-modified-added">+     auto property = subscript.toPropertyKey(globalObject);</span>
      // Don&#39;t put to an object if toString threw an exception.
      RETURN_IF_EXCEPTION(scope, void());
  
      if (byValInfo-&gt;stubInfo &amp;&amp; (!isStringOrSymbol(subscript) || byValInfo-&gt;cachedId != property))
          byValInfo-&gt;tookSlowPath = true;
  
      scope.release();
<span class="udiff-line-modified-removed">-     PutPropertySlot slot(baseValue, callFrame-&gt;codeBlock()-&gt;isStrictMode());</span>
<span class="udiff-line-modified-removed">-     baseValue.putInline(callFrame, property, value, slot);</span>
<span class="udiff-line-modified-added">+     PutPropertySlot slot(baseValue, codeBlock-&gt;isStrictMode());</span>
<span class="udiff-line-modified-added">+     baseValue.putInline(globalObject, property, value, slot);</span>
  }
  
<span class="udiff-line-modified-removed">- static void directPutByVal(CallFrame* callFrame, JSObject* baseObject, JSValue subscript, JSValue value, ByValInfo* byValInfo)</span>
<span class="udiff-line-modified-added">+ static void directPutByVal(JSGlobalObject* globalObject, CodeBlock* codeBlock, JSObject* baseObject, JSValue subscript, JSValue value, ByValInfo* byValInfo)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = callFrame-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="udiff-line-modified-removed">-     bool isStrictMode = callFrame-&gt;codeBlock()-&gt;isStrictMode();</span>
<span class="udiff-line-modified-added">+     bool isStrictMode = codeBlock-&gt;isStrictMode();</span>
  
      if (LIKELY(subscript.isUInt32())) {
          // Despite its name, JSValue::isUInt32 will return true only for positive boxed int32_t; all those values are valid array indices.
          byValInfo-&gt;tookSlowPath = true;
          uint32_t index = subscript.asUInt32();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -702,74 +748,75 @@</span>
              byValInfo-&gt;arrayProfile-&gt;setOutOfBounds();
              break;
          }
  
          scope.release();
<span class="udiff-line-modified-removed">-         baseObject-&gt;putDirectIndex(callFrame, index, value, 0, isStrictMode ? PutDirectIndexShouldThrow : PutDirectIndexShouldNotThrow);</span>
<span class="udiff-line-modified-added">+         baseObject-&gt;putDirectIndex(globalObject, index, value, 0, isStrictMode ? PutDirectIndexShouldThrow : PutDirectIndexShouldNotThrow);</span>
          return;
      }
  
      if (subscript.isDouble()) {
          double subscriptAsDouble = subscript.asDouble();
          uint32_t subscriptAsUInt32 = static_cast&lt;uint32_t&gt;(subscriptAsDouble);
          if (subscriptAsDouble == subscriptAsUInt32 &amp;&amp; isIndex(subscriptAsUInt32)) {
              byValInfo-&gt;tookSlowPath = true;
              scope.release();
<span class="udiff-line-modified-removed">-             baseObject-&gt;putDirectIndex(callFrame, subscriptAsUInt32, value, 0, isStrictMode ? PutDirectIndexShouldThrow : PutDirectIndexShouldNotThrow);</span>
<span class="udiff-line-modified-added">+             baseObject-&gt;putDirectIndex(globalObject, subscriptAsUInt32, value, 0, isStrictMode ? PutDirectIndexShouldThrow : PutDirectIndexShouldNotThrow);</span>
              return;
          }
      }
  
      // Don&#39;t put to an object if toString threw an exception.
<span class="udiff-line-modified-removed">-     auto property = subscript.toPropertyKey(callFrame);</span>
<span class="udiff-line-modified-added">+     auto property = subscript.toPropertyKey(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, void());
  
      if (Optional&lt;uint32_t&gt; index = parseIndex(property)) {
          byValInfo-&gt;tookSlowPath = true;
          scope.release();
<span class="udiff-line-modified-removed">-         baseObject-&gt;putDirectIndex(callFrame, index.value(), value, 0, isStrictMode ? PutDirectIndexShouldThrow : PutDirectIndexShouldNotThrow);</span>
<span class="udiff-line-modified-added">+         baseObject-&gt;putDirectIndex(globalObject, index.value(), value, 0, isStrictMode ? PutDirectIndexShouldThrow : PutDirectIndexShouldNotThrow);</span>
          return;
      }
  
      if (byValInfo-&gt;stubInfo &amp;&amp; (!isStringOrSymbol(subscript) || byValInfo-&gt;cachedId != property))
          byValInfo-&gt;tookSlowPath = true;
  
      scope.release();
      PutPropertySlot slot(baseObject, isStrictMode);
<span class="udiff-line-modified-removed">-     CommonSlowPaths::putDirectWithReify(vm, callFrame, baseObject, property, value, slot);</span>
<span class="udiff-line-modified-added">+     CommonSlowPaths::putDirectWithReify(vm, globalObject, baseObject, property, value, slot);</span>
  }
  
  enum class OptimizationResult {
      NotOptimized,
      SeenOnce,
      Optimized,
      GiveUp,
  };
  
<span class="udiff-line-modified-removed">- static OptimizationResult tryPutByValOptimize(ExecState* exec, JSValue baseValue, JSValue subscript, ByValInfo* byValInfo, ReturnAddressPtr returnAddress)</span>
<span class="udiff-line-modified-added">+ static OptimizationResult tryPutByValOptimize(JSGlobalObject* globalObject, CallFrame* callFrame, CodeBlock* codeBlock, JSValue baseValue, JSValue subscript, ByValInfo* byValInfo, ReturnAddressPtr returnAddress)</span>
  {
<span class="udiff-line-added">+     UNUSED_PARAM(callFrame);</span>
<span class="udiff-line-added">+ </span>
      // See if it&#39;s worth optimizing at all.
      OptimizationResult optimizationResult = OptimizationResult::NotOptimized;
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      if (baseValue.isObject() &amp;&amp; isCopyOnWrite(baseValue.getObject()-&gt;indexingMode()))
          return OptimizationResult::GiveUp;
  
      if (baseValue.isObject() &amp;&amp; subscript.isInt32()) {
          JSObject* object = asObject(baseValue);
  
<span class="udiff-line-modified-removed">-         ASSERT(exec-&gt;bytecodeOffset());</span>
<span class="udiff-line-modified-added">+         ASSERT(callFrame-&gt;bytecodeIndex() != BytecodeIndex(0));</span>
          ASSERT(!byValInfo-&gt;stubRoutine);
  
          Structure* structure = object-&gt;structure(vm);
          if (hasOptimizableIndexing(structure)) {
              // Attempt to optimize.
              JITArrayMode arrayMode = jitArrayModeForStructure(structure);
              if (jitArrayModePermitsPut(arrayMode) &amp;&amp; arrayMode != byValInfo-&gt;arrayMode) {
<span class="udiff-line-removed">-                 CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
                  ConcurrentJSLocker locker(codeBlock-&gt;m_lock);
                  byValInfo-&gt;arrayProfile-&gt;computeUpdatedPrediction(locker, codeBlock, structure);
                  JIT::compilePutByVal(locker, vm, codeBlock, byValInfo, returnAddress, arrayMode);
                  optimizationResult = OptimizationResult::Optimized;
              }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -779,25 +826,24 @@</span>
          if (optimizationResult != OptimizationResult::Optimized &amp;&amp; object-&gt;structure(vm)-&gt;typeInfo().interceptsGetOwnPropertySlotByIndexEvenWhenLengthIsNotZero())
              optimizationResult = OptimizationResult::GiveUp;
      }
  
      if (baseValue.isObject() &amp;&amp; isStringOrSymbol(subscript)) {
<span class="udiff-line-modified-removed">-         const Identifier propertyName = subscript.toPropertyKey(exec);</span>
<span class="udiff-line-modified-added">+         const Identifier propertyName = subscript.toPropertyKey(globalObject);</span>
          RETURN_IF_EXCEPTION(scope, OptimizationResult::GiveUp);
          if (subscript.isSymbol() || !parseIndex(propertyName)) {
<span class="udiff-line-modified-removed">-             ASSERT(exec-&gt;bytecodeOffset());</span>
<span class="udiff-line-modified-added">+             ASSERT(callFrame-&gt;bytecodeIndex() != BytecodeIndex(0));</span>
              ASSERT(!byValInfo-&gt;stubRoutine);
              if (byValInfo-&gt;seen) {
                  if (byValInfo-&gt;cachedId == propertyName) {
<span class="udiff-line-modified-removed">-                     JIT::compilePutByValWithCachedId&lt;OpPutByVal&gt;(vm, exec-&gt;codeBlock(), byValInfo, returnAddress, NotDirect, propertyName);</span>
<span class="udiff-line-modified-added">+                     JIT::compilePutByValWithCachedId&lt;OpPutByVal&gt;(vm, codeBlock, byValInfo, returnAddress, NotDirect, propertyName);</span>
                      optimizationResult = OptimizationResult::Optimized;
                  } else {
                      // Seem like a generic property access site.
                      optimizationResult = OptimizationResult::GiveUp;
                  }
              } else {
<span class="udiff-line-removed">-                 CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
                  ConcurrentJSLocker locker(codeBlock-&gt;m_lock);
                  byValInfo-&gt;seen = true;
                  byValInfo-&gt;cachedId = propertyName;
                  if (subscript.isSymbol())
                      byValInfo-&gt;cachedSymbol.set(vm, codeBlock, asSymbol(subscript));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -817,47 +863,50 @@</span>
      }
  
      return optimizationResult;
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutByValOptimize(ExecState* exec, EncodedJSValue encodedBaseValue, EncodedJSValue encodedSubscript, EncodedJSValue encodedValue, ByValInfo* byValInfo)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutByValOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedBaseValue, EncodedJSValue encodedSubscript, EncodedJSValue encodedValue, ByValInfo* byValInfo)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      JSValue baseValue = JSValue::decode(encodedBaseValue);
      JSValue subscript = JSValue::decode(encodedSubscript);
      JSValue value = JSValue::decode(encodedValue);
<span class="udiff-line-modified-removed">-     OptimizationResult result = tryPutByValOptimize(exec, baseValue, subscript, byValInfo, ReturnAddressPtr(OUR_RETURN_ADDRESS));</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
<span class="udiff-line-added">+     OptimizationResult result = tryPutByValOptimize(globalObject, callFrame, codeBlock, baseValue, subscript, byValInfo, ReturnAddressPtr(OUR_RETURN_ADDRESS));</span>
      RETURN_IF_EXCEPTION(scope, void());
      if (result == OptimizationResult::GiveUp) {
          // Don&#39;t ever try to optimize.
          byValInfo-&gt;tookSlowPath = true;
          ctiPatchCallByReturnAddress(ReturnAddressPtr(OUR_RETURN_ADDRESS), operationPutByValGeneric);
      }
<span class="udiff-line-modified-removed">-     RELEASE_AND_RETURN(scope, putByVal(exec, baseValue, subscript, value, byValInfo));</span>
<span class="udiff-line-modified-added">+     RELEASE_AND_RETURN(scope, putByVal(globalObject, codeBlock, baseValue, subscript, value, byValInfo));</span>
  }
  
<span class="udiff-line-modified-removed">- static OptimizationResult tryDirectPutByValOptimize(ExecState* exec, JSObject* object, JSValue subscript, ByValInfo* byValInfo, ReturnAddressPtr returnAddress)</span>
<span class="udiff-line-modified-added">+ static OptimizationResult tryDirectPutByValOptimize(JSGlobalObject* globalObject, CallFrame* callFrame, CodeBlock* codeBlock, JSObject* object, JSValue subscript, ByValInfo* byValInfo, ReturnAddressPtr returnAddress)</span>
  {
<span class="udiff-line-added">+     UNUSED_PARAM(callFrame);</span>
<span class="udiff-line-added">+ </span>
      // See if it&#39;s worth optimizing at all.
      OptimizationResult optimizationResult = OptimizationResult::NotOptimized;
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      if (subscript.isInt32()) {
<span class="udiff-line-modified-removed">-         ASSERT(exec-&gt;bytecodeOffset());</span>
<span class="udiff-line-modified-added">+         ASSERT(callFrame-&gt;bytecodeIndex() != BytecodeIndex(0));</span>
          ASSERT(!byValInfo-&gt;stubRoutine);
  
          Structure* structure = object-&gt;structure(vm);
          if (hasOptimizableIndexing(structure)) {
              // Attempt to optimize.
              JITArrayMode arrayMode = jitArrayModeForStructure(structure);
              if (jitArrayModePermitsPutDirect(arrayMode) &amp;&amp; arrayMode != byValInfo-&gt;arrayMode) {
<span class="udiff-line-removed">-                 CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
                  ConcurrentJSLocker locker(codeBlock-&gt;m_lock);
                  byValInfo-&gt;arrayProfile-&gt;computeUpdatedPrediction(locker, codeBlock, structure);
  
                  JIT::compileDirectPutByVal(locker, vm, codeBlock, byValInfo, returnAddress, arrayMode);
                  optimizationResult = OptimizationResult::Optimized;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -866,25 +915,24 @@</span>
  
          // If we failed to patch and we have some object that intercepts indexed get, then don&#39;t even wait until 10 times.
          if (optimizationResult != OptimizationResult::Optimized &amp;&amp; object-&gt;structure(vm)-&gt;typeInfo().interceptsGetOwnPropertySlotByIndexEvenWhenLengthIsNotZero())
              optimizationResult = OptimizationResult::GiveUp;
      } else if (isStringOrSymbol(subscript)) {
<span class="udiff-line-modified-removed">-         const Identifier propertyName = subscript.toPropertyKey(exec);</span>
<span class="udiff-line-modified-added">+         const Identifier propertyName = subscript.toPropertyKey(globalObject);</span>
          RETURN_IF_EXCEPTION(scope, OptimizationResult::GiveUp);
          if (subscript.isSymbol() || !parseIndex(propertyName)) {
<span class="udiff-line-modified-removed">-             ASSERT(exec-&gt;bytecodeOffset());</span>
<span class="udiff-line-modified-added">+             ASSERT(callFrame-&gt;bytecodeIndex() != BytecodeIndex(0));</span>
              ASSERT(!byValInfo-&gt;stubRoutine);
              if (byValInfo-&gt;seen) {
                  if (byValInfo-&gt;cachedId == propertyName) {
<span class="udiff-line-modified-removed">-                     JIT::compilePutByValWithCachedId&lt;OpPutByValDirect&gt;(vm, exec-&gt;codeBlock(), byValInfo, returnAddress, Direct, propertyName);</span>
<span class="udiff-line-modified-added">+                     JIT::compilePutByValWithCachedId&lt;OpPutByValDirect&gt;(vm, codeBlock, byValInfo, returnAddress, Direct, propertyName);</span>
                      optimizationResult = OptimizationResult::Optimized;
                  } else {
                      // Seem like a generic property access site.
                      optimizationResult = OptimizationResult::GiveUp;
                  }
              } else {
<span class="udiff-line-removed">-                 CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
                  ConcurrentJSLocker locker(codeBlock-&gt;m_lock);
                  byValInfo-&gt;seen = true;
                  byValInfo-&gt;cachedId = propertyName;
                  if (subscript.isSymbol())
                      byValInfo-&gt;cachedSymbol.set(vm, codeBlock, asSymbol(subscript));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -904,91 +952,94 @@</span>
      }
  
      return optimizationResult;
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationDirectPutByValOptimize(ExecState* exec, EncodedJSValue encodedBaseValue, EncodedJSValue encodedSubscript, EncodedJSValue encodedValue, ByValInfo* byValInfo)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationDirectPutByValOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedBaseValue, EncodedJSValue encodedSubscript, EncodedJSValue encodedValue, ByValInfo* byValInfo)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      JSValue baseValue = JSValue::decode(encodedBaseValue);
      JSValue subscript = JSValue::decode(encodedSubscript);
      JSValue value = JSValue::decode(encodedValue);
      RELEASE_ASSERT(baseValue.isObject());
      JSObject* object = asObject(baseValue);
<span class="udiff-line-modified-removed">-     OptimizationResult result = tryDirectPutByValOptimize(exec, object, subscript, byValInfo, ReturnAddressPtr(OUR_RETURN_ADDRESS));</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
<span class="udiff-line-added">+     OptimizationResult result = tryDirectPutByValOptimize(globalObject, callFrame, codeBlock, object, subscript, byValInfo, ReturnAddressPtr(OUR_RETURN_ADDRESS));</span>
      RETURN_IF_EXCEPTION(scope, void());
      if (result == OptimizationResult::GiveUp) {
          // Don&#39;t ever try to optimize.
          byValInfo-&gt;tookSlowPath = true;
          ctiPatchCallByReturnAddress(ReturnAddressPtr(OUR_RETURN_ADDRESS), operationDirectPutByValGeneric);
      }
  
<span class="udiff-line-modified-removed">-     RELEASE_AND_RETURN(scope, directPutByVal(exec, object, subscript, value, byValInfo));</span>
<span class="udiff-line-modified-added">+     RELEASE_AND_RETURN(scope, directPutByVal(globalObject, codeBlock, object, subscript, value, byValInfo));</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutByValGeneric(ExecState* exec, EncodedJSValue encodedBaseValue, EncodedJSValue encodedSubscript, EncodedJSValue encodedValue, ByValInfo* byValInfo)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutByValGeneric(JSGlobalObject* globalObject, EncodedJSValue encodedBaseValue, EncodedJSValue encodedSubscript, EncodedJSValue encodedValue, ByValInfo* byValInfo)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue baseValue = JSValue::decode(encodedBaseValue);
      JSValue subscript = JSValue::decode(encodedSubscript);
      JSValue value = JSValue::decode(encodedValue);
  
<span class="udiff-line-modified-removed">-     putByVal(exec, baseValue, subscript, value, byValInfo);</span>
<span class="udiff-line-modified-added">+     putByVal(globalObject, callFrame-&gt;codeBlock(), baseValue, subscript, value, byValInfo);</span>
  }
  
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationDirectPutByValGeneric(ExecState* exec, EncodedJSValue encodedBaseValue, EncodedJSValue encodedSubscript, EncodedJSValue encodedValue, ByValInfo* byValInfo)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationDirectPutByValGeneric(JSGlobalObject* globalObject, EncodedJSValue encodedBaseValue, EncodedJSValue encodedSubscript, EncodedJSValue encodedValue, ByValInfo* byValInfo)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue baseValue = JSValue::decode(encodedBaseValue);
      JSValue subscript = JSValue::decode(encodedSubscript);
      JSValue value = JSValue::decode(encodedValue);
      RELEASE_ASSERT(baseValue.isObject());
<span class="udiff-line-modified-removed">-     directPutByVal(exec, asObject(baseValue), subscript, value, byValInfo);</span>
<span class="udiff-line-modified-added">+     directPutByVal(globalObject, callFrame-&gt;codeBlock(), asObject(baseValue), subscript, value, byValInfo);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationCallEval(ExecState* exec, ExecState* execCallee)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationCallEval(JSGlobalObject* globalObject, CallFrame* calleeFrame)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     execCallee-&gt;setCodeBlock(0);</span>
<span class="udiff-line-modified-added">+     calleeFrame-&gt;setCodeBlock(0);</span>
  
<span class="udiff-line-modified-removed">-     if (!isHostFunction(execCallee-&gt;guaranteedJSValueCallee(), globalFuncEval))</span>
<span class="udiff-line-modified-added">+     if (!isHostFunction(calleeFrame-&gt;guaranteedJSValueCallee(), globalFuncEval))</span>
          return JSValue::encode(JSValue());
  
<span class="udiff-line-modified-removed">-     JSValue result = eval(execCallee);</span>
<span class="udiff-line-modified-added">+     JSValue result = eval(globalObject, calleeFrame);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      return JSValue::encode(result);
  }
  
<span class="udiff-line-modified-removed">- static SlowPathReturnType handleHostCall(ExecState* execCallee, JSValue callee, CallLinkInfo* callLinkInfo)</span>
<span class="udiff-line-modified-added">+ static SlowPathReturnType handleHostCall(JSGlobalObject* globalObject, CallFrame* calleeFrame, JSValue callee, CallLinkInfo* callLinkInfo)</span>
  {
<span class="udiff-line-modified-removed">-     ExecState* exec = execCallee-&gt;callerFrame();</span>
<span class="udiff-line-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     execCallee-&gt;setCodeBlock(0);</span>
<span class="udiff-line-modified-added">+     calleeFrame-&gt;setCodeBlock(0);</span>
  
      if (callLinkInfo-&gt;specializationKind() == CodeForCall) {
          CallData callData;
          CallType callType = getCallData(vm, callee, callData);
  
          ASSERT(callType != CallType::JS);
  
          if (callType == CallType::Host) {
<span class="udiff-line-modified-removed">-             NativeCallFrameTracer tracer(vm, execCallee);</span>
<span class="udiff-line-modified-removed">-             execCallee-&gt;setCallee(asObject(callee));</span>
<span class="udiff-line-modified-removed">-             vm.hostCallReturnValue = JSValue::decode(callData.native.function(execCallee));</span>
<span class="udiff-line-modified-added">+             NativeCallFrameTracer tracer(vm, calleeFrame);</span>
<span class="udiff-line-modified-added">+             calleeFrame-&gt;setCallee(asObject(callee));</span>
<span class="udiff-line-modified-added">+             vm.hostCallReturnValue = JSValue::decode(callData.native.function(asObject(callee)-&gt;globalObject(vm), calleeFrame));</span>
              if (UNLIKELY(scope.exception())) {
                  return encodeResult(
                      vm.getCTIStub(throwExceptionFromCallSlowPathGenerator).retaggedCode&lt;JSEntryPtrTag&gt;().executableAddress(),
                      reinterpret_cast&lt;void*&gt;(KeepTheFrame));
              }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -997,11 +1048,11 @@</span>
                  tagCFunctionPtr&lt;void*, JSEntryPtrTag&gt;(getHostCallReturnValue),
                  reinterpret_cast&lt;void*&gt;(callLinkInfo-&gt;callMode() == CallMode::Tail ? ReuseTheFrame : KeepTheFrame));
          }
  
          ASSERT(callType == CallType::None);
<span class="udiff-line-modified-removed">-         throwException(exec, scope, createNotAFunctionError(exec, callee));</span>
<span class="udiff-line-modified-added">+         throwException(globalObject, scope, createNotAFunctionError(globalObject, callee));</span>
          return encodeResult(
              vm.getCTIStub(throwExceptionFromCallSlowPathGenerator).retaggedCode&lt;JSEntryPtrTag&gt;().executableAddress(),
              reinterpret_cast&lt;void*&gt;(KeepTheFrame));
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1011,56 +1062,56 @@</span>
      ConstructType constructType = getConstructData(vm, callee, constructData);
  
      ASSERT(constructType != ConstructType::JS);
  
      if (constructType == ConstructType::Host) {
<span class="udiff-line-modified-removed">-         NativeCallFrameTracer tracer(vm, execCallee);</span>
<span class="udiff-line-modified-removed">-         execCallee-&gt;setCallee(asObject(callee));</span>
<span class="udiff-line-modified-removed">-         vm.hostCallReturnValue = JSValue::decode(constructData.native.function(execCallee));</span>
<span class="udiff-line-modified-added">+         NativeCallFrameTracer tracer(vm, calleeFrame);</span>
<span class="udiff-line-modified-added">+         calleeFrame-&gt;setCallee(asObject(callee));</span>
<span class="udiff-line-modified-added">+         vm.hostCallReturnValue = JSValue::decode(constructData.native.function(asObject(callee)-&gt;globalObject(vm), calleeFrame));</span>
          if (UNLIKELY(scope.exception())) {
              return encodeResult(
                  vm.getCTIStub(throwExceptionFromCallSlowPathGenerator).retaggedCode&lt;JSEntryPtrTag&gt;().executableAddress(),
                  reinterpret_cast&lt;void*&gt;(KeepTheFrame));
          }
  
          return encodeResult(tagCFunctionPtr&lt;void*, JSEntryPtrTag&gt;(getHostCallReturnValue), reinterpret_cast&lt;void*&gt;(KeepTheFrame));
      }
  
      ASSERT(constructType == ConstructType::None);
<span class="udiff-line-modified-removed">-     throwException(exec, scope, createNotAConstructorError(exec, callee));</span>
<span class="udiff-line-modified-added">+     throwException(globalObject, scope, createNotAConstructorError(globalObject, callee));</span>
      return encodeResult(
          vm.getCTIStub(throwExceptionFromCallSlowPathGenerator).retaggedCode&lt;JSEntryPtrTag&gt;().executableAddress(),
          reinterpret_cast&lt;void*&gt;(KeepTheFrame));
  }
  
<span class="udiff-line-modified-removed">- SlowPathReturnType JIT_OPERATION operationLinkCall(ExecState* execCallee, CallLinkInfo* callLinkInfo)</span>
<span class="udiff-line-modified-added">+ SlowPathReturnType JIT_OPERATION operationLinkCall(CallFrame* calleeFrame, JSGlobalObject* globalObject, CallLinkInfo* callLinkInfo)</span>
  {
<span class="udiff-line-modified-removed">-     ExecState* exec = execCallee-&gt;callerFrame();</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = calleeFrame-&gt;callerFrame();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto throwScope = DECLARE_THROW_SCOPE(vm);
  
      CodeSpecializationKind kind = callLinkInfo-&gt;specializationKind();
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     NativeCallFrameTracer tracer(vm, callFrame);</span>
  
      RELEASE_ASSERT(!callLinkInfo-&gt;isDirect());
  
<span class="udiff-line-modified-removed">-     JSValue calleeAsValue = execCallee-&gt;guaranteedJSValueCallee();</span>
<span class="udiff-line-modified-added">+     JSValue calleeAsValue = calleeFrame-&gt;guaranteedJSValueCallee();</span>
      JSCell* calleeAsFunctionCell = getJSFunction(calleeAsValue);
      if (!calleeAsFunctionCell) {
          if (auto* internalFunction = jsDynamicCast&lt;InternalFunction*&gt;(vm, calleeAsValue)) {
              MacroAssemblerCodePtr&lt;JSEntryPtrTag&gt; codePtr = vm.getCTIInternalFunctionTrampolineFor(kind);
              RELEASE_ASSERT(!!codePtr);
  
              if (!callLinkInfo-&gt;seenOnce())
                  callLinkInfo-&gt;setSeen();
              else
<span class="udiff-line-modified-removed">-                 linkFor(execCallee, *callLinkInfo, nullptr, internalFunction, codePtr);</span>
<span class="udiff-line-modified-added">+                 linkFor(vm, calleeFrame, *callLinkInfo, nullptr, internalFunction, codePtr);</span>
  
              void* linkedTarget = codePtr.executableAddress();
              return encodeResult(linkedTarget, reinterpret_cast&lt;void*&gt;(callLinkInfo-&gt;callMode() == CallMode::Tail ? ReuseTheFrame : KeepTheFrame));
          }
<span class="udiff-line-modified-removed">-         RELEASE_AND_RETURN(throwScope, handleHostCall(execCallee, calleeAsValue, callLinkInfo));</span>
<span class="udiff-line-modified-added">+         RELEASE_AND_RETURN(throwScope, handleHostCall(globalObject, calleeFrame, calleeAsValue, callLinkInfo));</span>
      }
  
      JSFunction* callee = jsCast&lt;JSFunction*&gt;(calleeAsFunctionCell);
      JSScope* scope = callee-&gt;scopeUnchecked();
      ExecutableBase* executable = callee-&gt;executable();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1078,121 +1129,70 @@</span>
              void* throwTarget = vm.getCTIStub(throwExceptionFromCallSlowPathGenerator).retaggedCode&lt;JSEntryPtrTag&gt;().executableAddress();
              return encodeResult(throwTarget, reinterpret_cast&lt;void*&gt;(KeepTheFrame));
          };
  
          if (!isCall(kind) &amp;&amp; functionExecutable-&gt;constructAbility() == ConstructAbility::CannotConstruct) {
<span class="udiff-line-modified-removed">-             throwException(exec, throwScope, createNotAConstructorError(exec, callee));</span>
<span class="udiff-line-modified-added">+             throwException(globalObject, throwScope, createNotAConstructorError(globalObject, callee));</span>
              return handleThrowException();
          }
  
<span class="udiff-line-modified-removed">-         CodeBlock** codeBlockSlot = execCallee-&gt;addressOfCodeBlock();</span>
<span class="udiff-line-modified-added">+         CodeBlock** codeBlockSlot = calleeFrame-&gt;addressOfCodeBlock();</span>
          Exception* error = functionExecutable-&gt;prepareForExecution&lt;FunctionExecutable&gt;(vm, callee, scope, kind, *codeBlockSlot);
          EXCEPTION_ASSERT(throwScope.exception() == error);
          if (UNLIKELY(error))
              return handleThrowException();
          codeBlock = *codeBlockSlot;
          ArityCheckMode arity;
<span class="udiff-line-modified-removed">-         if (execCallee-&gt;argumentCountIncludingThis() &lt; static_cast&lt;size_t&gt;(codeBlock-&gt;numParameters()) || callLinkInfo-&gt;isVarargs())</span>
<span class="udiff-line-modified-added">+         if (calleeFrame-&gt;argumentCountIncludingThis() &lt; static_cast&lt;size_t&gt;(codeBlock-&gt;numParameters()) || callLinkInfo-&gt;isVarargs())</span>
              arity = MustCheckArity;
          else
              arity = ArityCheckNotRequired;
          codePtr = functionExecutable-&gt;entrypointFor(kind, arity);
      }
  
      if (!callLinkInfo-&gt;seenOnce())
          callLinkInfo-&gt;setSeen();
      else
<span class="udiff-line-modified-removed">-         linkFor(execCallee, *callLinkInfo, codeBlock, callee, codePtr);</span>
<span class="udiff-line-modified-added">+         linkFor(vm, calleeFrame, *callLinkInfo, codeBlock, callee, codePtr);</span>
  
      return encodeResult(codePtr.executableAddress(), reinterpret_cast&lt;void*&gt;(callLinkInfo-&gt;callMode() == CallMode::Tail ? ReuseTheFrame : KeepTheFrame));
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationLinkDirectCall(ExecState* exec, CallLinkInfo* callLinkInfo, JSFunction* callee)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-removed">-     auto throwScope = DECLARE_THROW_SCOPE(vm);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     CodeSpecializationKind kind = callLinkInfo-&gt;specializationKind();</span>
<span class="udiff-line-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     RELEASE_ASSERT(callLinkInfo-&gt;isDirect());</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     // This would happen if the executable died during GC but the CodeBlock did not die. That should</span>
<span class="udiff-line-removed">-     // not happen because the CodeBlock should have a weak reference to any executable it uses for</span>
<span class="udiff-line-removed">-     // this purpose.</span>
<span class="udiff-line-removed">-     RELEASE_ASSERT(callLinkInfo-&gt;executable());</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     // Having a CodeBlock indicates that this is linked. We shouldn&#39;t be taking this path if it&#39;s</span>
<span class="udiff-line-removed">-     // linked.</span>
<span class="udiff-line-removed">-     RELEASE_ASSERT(!callLinkInfo-&gt;codeBlock());</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     // We just don&#39;t support this yet.</span>
<span class="udiff-line-removed">-     RELEASE_ASSERT(!callLinkInfo-&gt;isVarargs());</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     ExecutableBase* executable = callLinkInfo-&gt;executable();</span>
<span class="udiff-line-removed">-     RELEASE_ASSERT(callee-&gt;executable() == callLinkInfo-&gt;executable());</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     JSScope* scope = callee-&gt;scopeUnchecked();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     MacroAssemblerCodePtr&lt;JSEntryPtrTag&gt; codePtr;</span>
<span class="udiff-line-removed">-     CodeBlock* codeBlock = nullptr;</span>
<span class="udiff-line-removed">-     if (executable-&gt;isHostFunction())</span>
<span class="udiff-line-removed">-         codePtr = executable-&gt;entrypointFor(kind, MustCheckArity);</span>
<span class="udiff-line-removed">-     else {</span>
<span class="udiff-line-removed">-         FunctionExecutable* functionExecutable = static_cast&lt;FunctionExecutable*&gt;(executable);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         RELEASE_ASSERT(isCall(kind) || functionExecutable-&gt;constructAbility() != ConstructAbility::CannotConstruct);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         Exception* error = functionExecutable-&gt;prepareForExecution&lt;FunctionExecutable&gt;(vm, callee, scope, kind, codeBlock);</span>
<span class="udiff-line-removed">-         EXCEPTION_ASSERT_UNUSED(throwScope, throwScope.exception() == error);</span>
<span class="udiff-line-removed">-         if (UNLIKELY(error))</span>
<span class="udiff-line-removed">-             return;</span>
<span class="udiff-line-removed">-         unsigned argumentStackSlots = callLinkInfo-&gt;maxNumArguments();</span>
<span class="udiff-line-removed">-         if (argumentStackSlots &lt; static_cast&lt;size_t&gt;(codeBlock-&gt;numParameters()))</span>
<span class="udiff-line-removed">-             codePtr = functionExecutable-&gt;entrypointFor(kind, MustCheckArity);</span>
<span class="udiff-line-removed">-         else</span>
<span class="udiff-line-removed">-             codePtr = functionExecutable-&gt;entrypointFor(kind, ArityCheckNotRequired);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     linkDirectFor(exec, *callLinkInfo, codeBlock, codePtr);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline SlowPathReturnType virtualForWithFunction(</span>
<span class="udiff-line-removed">-     ExecState* execCallee, CallLinkInfo* callLinkInfo, JSCell*&amp; calleeAsFunctionCell)</span>
<span class="udiff-line-modified-added">+ inline SlowPathReturnType virtualForWithFunction(JSGlobalObject* globalObject, CallFrame* calleeFrame, CallLinkInfo* callLinkInfo, JSCell*&amp; calleeAsFunctionCell)</span>
  {
<span class="udiff-line-modified-removed">-     ExecState* exec = execCallee-&gt;callerFrame();</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = calleeFrame-&gt;callerFrame();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto throwScope = DECLARE_THROW_SCOPE(vm);
  
      CodeSpecializationKind kind = callLinkInfo-&gt;specializationKind();
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     NativeCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     JSValue calleeAsValue = execCallee-&gt;guaranteedJSValueCallee();</span>
<span class="udiff-line-modified-added">+     JSValue calleeAsValue = calleeFrame-&gt;guaranteedJSValueCallee();</span>
      calleeAsFunctionCell = getJSFunction(calleeAsValue);
      if (UNLIKELY(!calleeAsFunctionCell)) {
          if (jsDynamicCast&lt;InternalFunction*&gt;(vm, calleeAsValue)) {
              MacroAssemblerCodePtr&lt;JSEntryPtrTag&gt; codePtr = vm.getCTIInternalFunctionTrampolineFor(kind);
              ASSERT(!!codePtr);
              return encodeResult(codePtr.executableAddress(), reinterpret_cast&lt;void*&gt;(callLinkInfo-&gt;callMode() == CallMode::Tail ? ReuseTheFrame : KeepTheFrame));
          }
<span class="udiff-line-modified-removed">-         RELEASE_AND_RETURN(throwScope, handleHostCall(execCallee, calleeAsValue, callLinkInfo));</span>
<span class="udiff-line-modified-added">+         RELEASE_AND_RETURN(throwScope, handleHostCall(globalObject, calleeFrame, calleeAsValue, callLinkInfo));</span>
      }
  
      JSFunction* function = jsCast&lt;JSFunction*&gt;(calleeAsFunctionCell);
      JSScope* scope = function-&gt;scopeUnchecked();
      ExecutableBase* executable = function-&gt;executable();
      if (UNLIKELY(!executable-&gt;hasJITCodeFor(kind))) {
          FunctionExecutable* functionExecutable = static_cast&lt;FunctionExecutable*&gt;(executable);
  
          if (!isCall(kind) &amp;&amp; functionExecutable-&gt;constructAbility() == ConstructAbility::CannotConstruct) {
<span class="udiff-line-modified-removed">-             throwException(exec, throwScope, createNotAConstructorError(exec, function));</span>
<span class="udiff-line-modified-added">+             throwException(globalObject, throwScope, createNotAConstructorError(globalObject, function));</span>
              return encodeResult(
                  vm.getCTIStub(throwExceptionFromCallSlowPathGenerator).retaggedCode&lt;JSEntryPtrTag&gt;().executableAddress(),
                  reinterpret_cast&lt;void*&gt;(KeepTheFrame));
          }
  
<span class="udiff-line-modified-removed">-         CodeBlock** codeBlockSlot = execCallee-&gt;addressOfCodeBlock();</span>
<span class="udiff-line-modified-added">+         CodeBlock** codeBlockSlot = calleeFrame-&gt;addressOfCodeBlock();</span>
          Exception* error = functionExecutable-&gt;prepareForExecution&lt;FunctionExecutable&gt;(vm, function, scope, kind, *codeBlockSlot);
          EXCEPTION_ASSERT(throwScope.exception() == error);
          if (UNLIKELY(error)) {
              return encodeResult(
                  vm.getCTIStub(throwExceptionFromCallSlowPathGenerator).retaggedCode&lt;JSEntryPtrTag&gt;().executableAddress(),
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1202,226 +1202,300 @@</span>
      return encodeResult(executable-&gt;entrypointFor(
          kind, MustCheckArity).executableAddress(),
          reinterpret_cast&lt;void*&gt;(callLinkInfo-&gt;callMode() == CallMode::Tail ? ReuseTheFrame : KeepTheFrame));
  }
  
<span class="udiff-line-modified-removed">- SlowPathReturnType JIT_OPERATION operationLinkPolymorphicCall(ExecState* execCallee, CallLinkInfo* callLinkInfo)</span>
<span class="udiff-line-modified-added">+ SlowPathReturnType JIT_OPERATION operationLinkPolymorphicCall(CallFrame* calleeFrame, JSGlobalObject* globalObject, CallLinkInfo* callLinkInfo)</span>
  {
      ASSERT(callLinkInfo-&gt;specializationKind() == CodeForCall);
      JSCell* calleeAsFunctionCell;
<span class="udiff-line-modified-removed">-     SlowPathReturnType result = virtualForWithFunction(execCallee, callLinkInfo, calleeAsFunctionCell);</span>
<span class="udiff-line-modified-added">+     SlowPathReturnType result = virtualForWithFunction(globalObject, calleeFrame, callLinkInfo, calleeAsFunctionCell);</span>
  
<span class="udiff-line-modified-removed">-     linkPolymorphicCall(execCallee, *callLinkInfo, CallVariant(calleeAsFunctionCell));</span>
<span class="udiff-line-modified-added">+     linkPolymorphicCall(globalObject, calleeFrame, *callLinkInfo, CallVariant(calleeAsFunctionCell));</span>
  
      return result;
  }
  
<span class="udiff-line-modified-removed">- SlowPathReturnType JIT_OPERATION operationVirtualCall(ExecState* execCallee, CallLinkInfo* callLinkInfo)</span>
<span class="udiff-line-modified-added">+ SlowPathReturnType JIT_OPERATION operationVirtualCall(CallFrame* calleeFrame, JSGlobalObject* globalObject, CallLinkInfo* callLinkInfo)</span>
  {
      JSCell* calleeAsFunctionCellIgnored;
<span class="udiff-line-modified-removed">-     return virtualForWithFunction(execCallee, callLinkInfo, calleeAsFunctionCellIgnored);</span>
<span class="udiff-line-modified-added">+     return virtualForWithFunction(globalObject, calleeFrame, callLinkInfo, calleeAsFunctionCellIgnored);</span>
  }
  
<span class="udiff-line-modified-removed">- size_t JIT_OPERATION operationCompareLess(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-modified-added">+ size_t JIT_OPERATION operationCompareLess(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     return jsLess&lt;true&gt;(exec, JSValue::decode(encodedOp1), JSValue::decode(encodedOp2));</span>
<span class="udiff-line-modified-added">+     return jsLess&lt;true&gt;(globalObject, JSValue::decode(encodedOp1), JSValue::decode(encodedOp2));</span>
  }
  
<span class="udiff-line-modified-removed">- size_t JIT_OPERATION operationCompareLessEq(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-modified-added">+ size_t JIT_OPERATION operationCompareLessEq(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     return jsLessEq&lt;true&gt;(exec, JSValue::decode(encodedOp1), JSValue::decode(encodedOp2));</span>
<span class="udiff-line-modified-added">+     return jsLessEq&lt;true&gt;(globalObject, JSValue::decode(encodedOp1), JSValue::decode(encodedOp2));</span>
  }
  
<span class="udiff-line-modified-removed">- size_t JIT_OPERATION operationCompareGreater(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-modified-added">+ size_t JIT_OPERATION operationCompareGreater(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     return jsLess&lt;false&gt;(exec, JSValue::decode(encodedOp2), JSValue::decode(encodedOp1));</span>
<span class="udiff-line-modified-added">+     return jsLess&lt;false&gt;(globalObject, JSValue::decode(encodedOp2), JSValue::decode(encodedOp1));</span>
  }
  
<span class="udiff-line-modified-removed">- size_t JIT_OPERATION operationCompareGreaterEq(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-modified-added">+ size_t JIT_OPERATION operationCompareGreaterEq(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     return jsLessEq&lt;false&gt;(exec, JSValue::decode(encodedOp2), JSValue::decode(encodedOp1));</span>
<span class="udiff-line-modified-added">+     return jsLessEq&lt;false&gt;(globalObject, JSValue::decode(encodedOp2), JSValue::decode(encodedOp1));</span>
  }
  
<span class="udiff-line-modified-removed">- size_t JIT_OPERATION operationCompareEq(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-modified-added">+ size_t JIT_OPERATION operationCompareEq(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     return JSValue::equalSlowCaseInline(exec, JSValue::decode(encodedOp1), JSValue::decode(encodedOp2));</span>
<span class="udiff-line-modified-added">+     return JSValue::equalSlowCaseInline(globalObject, JSValue::decode(encodedOp1), JSValue::decode(encodedOp2));</span>
  }
  
  #if USE(JSVALUE64)
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationCompareStringEq(ExecState* exec, JSCell* left, JSCell* right)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationCompareStringEq(JSGlobalObject* globalObject, JSCell* left, JSCell* right)</span>
  #else
<span class="udiff-line-modified-removed">- size_t JIT_OPERATION operationCompareStringEq(ExecState* exec, JSCell* left, JSCell* right)</span>
<span class="udiff-line-modified-added">+ size_t JIT_OPERATION operationCompareStringEq(JSGlobalObject* globalObject, JSCell* left, JSCell* right)</span>
  #endif
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     bool result = asString(left)-&gt;equal(exec, asString(right));</span>
<span class="udiff-line-modified-added">+     bool result = asString(left)-&gt;equal(globalObject, asString(right));</span>
  #if USE(JSVALUE64)
      return JSValue::encode(jsBoolean(result));
  #else
      return result;
  #endif
  }
  
<span class="udiff-line-modified-removed">- size_t JIT_OPERATION operationCompareStrictEq(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-modified-added">+ size_t JIT_OPERATION operationCompareStrictEq(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue src1 = JSValue::decode(encodedOp1);
      JSValue src2 = JSValue::decode(encodedOp2);
  
<span class="udiff-line-modified-removed">-     return JSValue::strictEqual(exec, src1, src2);</span>
<span class="udiff-line-modified-added">+     return JSValue::strictEqual(globalObject, src1, src2);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationNewArrayWithProfile(ExecState* exec, ArrayAllocationProfile* profile, const JSValue* values, int size)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationNewArrayWithProfile(JSGlobalObject* globalObject, ArrayAllocationProfile* profile, const JSValue* values, int size)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-removed">-     return JSValue::encode(constructArrayNegativeIndexed(exec, profile, values, size));</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-modified-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return JSValue::encode(constructArrayNegativeIndexed(globalObject, profile, values, size));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationNewArrayWithSizeAndProfile(ExecState* exec, ArrayAllocationProfile* profile, EncodedJSValue size)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationNewArrayWithSizeAndProfile(JSGlobalObject* globalObject, ArrayAllocationProfile* profile, EncodedJSValue size)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      JSValue sizeValue = JSValue::decode(size);
<span class="udiff-line-modified-removed">-     return JSValue::encode(constructArrayWithSizeQuirk(exec, profile, exec-&gt;lexicalGlobalObject(), sizeValue));</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(constructArrayWithSizeQuirk(globalObject, profile, sizeValue));</span>
  }
  
  }
  
  template&lt;typename FunctionType&gt;
<span class="udiff-line-modified-removed">- static EncodedJSValue operationNewFunctionCommon(ExecState* exec, JSScope* scope, JSCell* functionExecutable, bool isInvalidated)</span>
<span class="udiff-line-modified-added">+ static EncodedJSValue newFunctionCommon(VM&amp; vm, JSScope* scope, JSCell* functionExecutable, bool isInvalidated)</span>
  {
<span class="udiff-line-removed">-     VM&amp; vm = exec-&gt;vm();</span>
      ASSERT(functionExecutable-&gt;inherits&lt;FunctionExecutable&gt;(vm));
<span class="udiff-line-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
      if (isInvalidated)
          return JSValue::encode(FunctionType::createWithInvalidatedReallocationWatchpoint(vm, static_cast&lt;FunctionExecutable*&gt;(functionExecutable), scope));
      return JSValue::encode(FunctionType::create(vm, static_cast&lt;FunctionExecutable*&gt;(functionExecutable), scope));
  }
  
  extern &quot;C&quot; {
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationNewFunction(ExecState* exec, JSScope* scope, JSCell* functionExecutable)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationNewFunction(VM* vmPointer, JSScope* scope, JSCell* functionExecutable)</span>
  {
<span class="udiff-line-modified-removed">-     return operationNewFunctionCommon&lt;JSFunction&gt;(exec, scope, functionExecutable, false);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return newFunctionCommon&lt;JSFunction&gt;(vm, scope, functionExecutable, false);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationNewFunctionWithInvalidatedReallocationWatchpoint(ExecState* exec, JSScope* scope, JSCell* functionExecutable)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationNewFunctionWithInvalidatedReallocationWatchpoint(VM* vmPointer, JSScope* scope, JSCell* functionExecutable)</span>
  {
<span class="udiff-line-modified-removed">-     return operationNewFunctionCommon&lt;JSFunction&gt;(exec, scope, functionExecutable, true);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return newFunctionCommon&lt;JSFunction&gt;(vm, scope, functionExecutable, true);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationNewGeneratorFunction(ExecState* exec, JSScope* scope, JSCell* functionExecutable)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationNewGeneratorFunction(VM* vmPointer, JSScope* scope, JSCell* functionExecutable)</span>
  {
<span class="udiff-line-modified-removed">-     return operationNewFunctionCommon&lt;JSGeneratorFunction&gt;(exec, scope, functionExecutable, false);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return newFunctionCommon&lt;JSGeneratorFunction&gt;(vm, scope, functionExecutable, false);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationNewGeneratorFunctionWithInvalidatedReallocationWatchpoint(ExecState* exec, JSScope* scope, JSCell* functionExecutable)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationNewGeneratorFunctionWithInvalidatedReallocationWatchpoint(VM* vmPointer, JSScope* scope, JSCell* functionExecutable)</span>
  {
<span class="udiff-line-modified-removed">-     return operationNewFunctionCommon&lt;JSGeneratorFunction&gt;(exec, scope, functionExecutable, true);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return newFunctionCommon&lt;JSGeneratorFunction&gt;(vm, scope, functionExecutable, true);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationNewAsyncFunction(ExecState* exec, JSScope* scope, JSCell* functionExecutable)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationNewAsyncFunction(VM* vmPointer, JSScope* scope, JSCell* functionExecutable)</span>
  {
<span class="udiff-line-modified-removed">-     return operationNewFunctionCommon&lt;JSAsyncFunction&gt;(exec, scope, functionExecutable, false);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return newFunctionCommon&lt;JSAsyncFunction&gt;(vm, scope, functionExecutable, false);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationNewAsyncFunctionWithInvalidatedReallocationWatchpoint(ExecState* exec, JSScope* scope, JSCell* functionExecutable)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationNewAsyncFunctionWithInvalidatedReallocationWatchpoint(VM* vmPointer, JSScope* scope, JSCell* functionExecutable)</span>
  {
<span class="udiff-line-modified-removed">-     return operationNewFunctionCommon&lt;JSAsyncFunction&gt;(exec, scope, functionExecutable, true);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return newFunctionCommon&lt;JSAsyncFunction&gt;(vm, scope, functionExecutable, true);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationNewAsyncGeneratorFunction(ExecState* exec, JSScope* scope, JSCell* functionExecutable)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationNewAsyncGeneratorFunction(VM* vmPointer, JSScope* scope, JSCell* functionExecutable)</span>
  {
<span class="udiff-line-modified-removed">-     return operationNewFunctionCommon&lt;JSAsyncGeneratorFunction&gt;(exec, scope, functionExecutable, false);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return newFunctionCommon&lt;JSAsyncGeneratorFunction&gt;(vm, scope, functionExecutable, false);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationNewAsyncGeneratorFunctionWithInvalidatedReallocationWatchpoint(ExecState* exec, JSScope* scope, JSCell* functionExecutable)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationNewAsyncGeneratorFunctionWithInvalidatedReallocationWatchpoint(VM* vmPointer, JSScope* scope, JSCell* functionExecutable)</span>
  {
<span class="udiff-line-modified-removed">-     return operationNewFunctionCommon&lt;JSAsyncGeneratorFunction&gt;(exec, scope, functionExecutable, true);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return newFunctionCommon&lt;JSAsyncGeneratorFunction&gt;(vm, scope, functionExecutable, true);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationSetFunctionName(ExecState* exec, JSCell* funcCell, EncodedJSValue encodedName)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationSetFunctionName(JSGlobalObject* globalObject, JSCell* funcCell, EncodedJSValue encodedName)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSFunction* func = jsCast&lt;JSFunction*&gt;(funcCell);
      JSValue name = JSValue::decode(encodedName);
<span class="udiff-line-modified-removed">-     func-&gt;setFunctionName(exec, name);</span>
<span class="udiff-line-modified-added">+     func-&gt;setFunctionName(globalObject, name);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JSCell* JIT_OPERATION operationNewObject(VM* vmPointer, Structure* structure)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return constructEmptyObject(vm, structure);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JSCell* JIT_OPERATION operationNewPromise(VM* vmPointer, Structure* structure)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return JSPromise::create(vm, structure);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JSCell* JIT_OPERATION operationNewInternalPromise(VM* vmPointer, Structure* structure)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return JSInternalPromise::create(vm, structure);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JSCell* JIT_OPERATION operationNewGenerator(VM* vmPointer, Structure* structure)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return JSGenerator::create(vm, structure);</span>
  }
  
<span class="udiff-line-modified-removed">- JSCell* JIT_OPERATION operationNewObject(ExecState* exec, Structure* structure)</span>
<span class="udiff-line-modified-added">+ JSCell* JIT_OPERATION operationNewAsyncGenerator(VM* vmPointer, Structure* structure)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     return constructEmptyObject(exec, structure);</span>
<span class="udiff-line-modified-added">+     return JSAsyncGenerator::create(vm, structure);</span>
  }
  
<span class="udiff-line-modified-removed">- JSCell* JIT_OPERATION operationNewRegexp(ExecState* exec, JSCell* regexpPtr)</span>
<span class="udiff-line-modified-added">+ JSCell* JIT_OPERATION operationNewRegexp(JSGlobalObject* globalObject, JSCell* regexpPtr)</span>
  {
      SuperSamplerScope superSamplerScope(false);
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      RegExp* regexp = static_cast&lt;RegExp*&gt;(regexpPtr);
      ASSERT(regexp-&gt;isValid());
<span class="udiff-line-modified-removed">-     return RegExpObject::create(vm, exec-&gt;lexicalGlobalObject()-&gt;regExpStructure(), regexp);</span>
<span class="udiff-line-modified-added">+     return RegExpObject::create(vm, globalObject-&gt;regExpStructure(), regexp);</span>
  }
  
  // The only reason for returning an UnusedPtr (instead of void) is so that we can reuse the
  // existing DFG slow path generator machinery when creating the slow path for CheckTraps
  // in the DFG. If a DFG slow path generator that supports a void return type is added in the
  // future, we can switch to using that then.
<span class="udiff-line-modified-removed">- UnusedPtr JIT_OPERATION operationHandleTraps(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ UnusedPtr JIT_OPERATION operationHandleTraps(JSGlobalObject* globalObject)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      ASSERT(vm.needTrapHandling());
<span class="udiff-line-modified-removed">-     vm.handleTraps(exec);</span>
<span class="udiff-line-modified-added">+     vm.handleTraps(globalObject, callFrame);</span>
      return nullptr;
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationDebug(ExecState* exec, int32_t debugHookType)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationDebug(VM* vmPointer, int32_t debugHookType)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     vm.interpreter-&gt;debug(exec, static_cast&lt;DebugHookType&gt;(debugHookType));</span>
<span class="udiff-line-modified-added">+     vm.interpreter-&gt;debug(callFrame, static_cast&lt;DebugHookType&gt;(debugHookType));</span>
  }
  
  #if ENABLE(DFG_JIT)
  static void updateAllPredictionsAndOptimizeAfterWarmUp(CodeBlock* codeBlock)
  {
      codeBlock-&gt;updateAllPredictions();
      codeBlock-&gt;optimizeAfterWarmUp();
  }
  
<span class="udiff-line-modified-removed">- SlowPathReturnType JIT_OPERATION operationOptimize(ExecState* exec, uint32_t bytecodeIndex)</span>
<span class="udiff-line-modified-added">+ SlowPathReturnType JIT_OPERATION operationOptimize(VM* vmPointer, uint32_t bytecodeIndexBits)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     BytecodeIndex bytecodeIndex = BytecodeIndex::fromBits(bytecodeIndexBits);</span>
  
      // Defer GC for a while so that it doesn&#39;t run between when we enter into this
      // slow path and when we figure out the state of our code block. This prevents
      // a number of awkward reentrancy scenarios, including:
      //
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1435,11 +1509,11 @@</span>
      // Note that jettisoning won&#39;t happen if we already initiated OSR, because in
      // that case we would have already planted the optimized code block into the JS
      // stack.
      DeferGCForAWhile deferGC(vm.heap);
  
<span class="udiff-line-modified-removed">-     CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
      if (UNLIKELY(codeBlock-&gt;jitType() != JITType::BaselineJIT)) {
          dataLog(&quot;Unexpected code block in Baseline-&gt;DFG tier-up: &quot;, *codeBlock, &quot;\n&quot;);
          RELEASE_ASSERT_NOT_REACHED();
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1463,12 +1537,11 @@</span>
      }
  
      if (!codeBlock-&gt;checkIfOptimizationThresholdReached()) {
          CODEBLOCK_LOG_EVENT(codeBlock, &quot;delayOptimizeToDFG&quot;, (&quot;counter = &quot;, codeBlock-&gt;jitExecuteCounter()));
          codeBlock-&gt;updateAllPredictions();
<span class="udiff-line-modified-removed">-         if (UNLIKELY(Options::verboseOSR()))</span>
<span class="udiff-line-removed">-             dataLog(&quot;Choosing not to optimize &quot;, *codeBlock, &quot; yet, because the threshold hasn&#39;t been reached.\n&quot;);</span>
<span class="udiff-line-modified-added">+         dataLogLnIf(Options::verboseOSR(), &quot;Choosing not to optimize &quot;, *codeBlock, &quot; yet, because the threshold hasn&#39;t been reached.&quot;);</span>
          return encodeResult(0, 0);
      }
  
      Debugger* debugger = codeBlock-&gt;globalObject()-&gt;debugger();
      if (UNLIKELY(debugger &amp;&amp; (debugger-&gt;isStepping() || codeBlock-&gt;baselineAlternative()-&gt;hasDebuggerRequests()))) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1478,12 +1551,11 @@</span>
      }
  
      if (codeBlock-&gt;m_shouldAlwaysBeInlined) {
          CODEBLOCK_LOG_EVENT(codeBlock, &quot;delayOptimizeToDFG&quot;, (&quot;should always be inlined&quot;));
          updateAllPredictionsAndOptimizeAfterWarmUp(codeBlock);
<span class="udiff-line-modified-removed">-         if (UNLIKELY(Options::verboseOSR()))</span>
<span class="udiff-line-removed">-             dataLog(&quot;Choosing not to optimize &quot;, *codeBlock, &quot; yet, because m_shouldAlwaysBeInlined == true.\n&quot;);</span>
<span class="udiff-line-modified-added">+         dataLogLnIf(Options::verboseOSR(), &quot;Choosing not to optimize &quot;, *codeBlock, &quot; yet, because m_shouldAlwaysBeInlined == true.&quot;);</span>
          return encodeResult(0, 0);
      }
  
      // We cannot be in the process of asynchronous compilation and also have an optimized
      // replacement.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1534,18 +1606,16 @@</span>
          // CodeBlock::setOptimizationThresholdBasedOnCompilationResult() and we have
          // nothing left to do.
          if (!codeBlock-&gt;hasOptimizedReplacement()) {
              CODEBLOCK_LOG_EVENT(codeBlock, &quot;delayOptimizeToDFG&quot;, (&quot;compiled and failed&quot;));
              codeBlock-&gt;updateAllPredictions();
<span class="udiff-line-modified-removed">-             if (UNLIKELY(Options::verboseOSR()))</span>
<span class="udiff-line-removed">-                 dataLog(&quot;Code block &quot;, *codeBlock, &quot; was compiled but it doesn&#39;t have an optimized replacement.\n&quot;);</span>
<span class="udiff-line-modified-added">+             dataLogLnIf(Options::verboseOSR(), &quot;Code block &quot;, *codeBlock, &quot; was compiled but it doesn&#39;t have an optimized replacement.&quot;);</span>
              return encodeResult(0, 0);
          }
      } else if (codeBlock-&gt;hasOptimizedReplacement()) {
          CodeBlock* replacement = codeBlock-&gt;replacement();
<span class="udiff-line-modified-removed">-         if (UNLIKELY(Options::verboseOSR()))</span>
<span class="udiff-line-removed">-             dataLog(&quot;Considering OSR &quot;, codeBlock, &quot; -&gt; &quot;, replacement, &quot;.\n&quot;);</span>
<span class="udiff-line-modified-added">+         dataLogLnIf(Options::verboseOSR(), &quot;Considering OSR &quot;, codeBlock, &quot; -&gt; &quot;, replacement, &quot;.&quot;);</span>
          // If we have an optimized replacement, then it must be the case that we entered
          // cti_optimize from a loop. That&#39;s because if there&#39;s an optimized replacement,
          // then all calls to this function will be relinked to the replacement and so
          // the prologue OSR will never fire.
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1557,44 +1627,39 @@</span>
          // attempt OSR entry. Hence it might even be correct for
          // shouldReoptimizeFromLoopNow() to always return true. But we make it do some
          // additional checking anyway, to reduce the amount of recompilation thrashing.
          if (replacement-&gt;shouldReoptimizeFromLoopNow()) {
              CODEBLOCK_LOG_EVENT(codeBlock, &quot;delayOptimizeToDFG&quot;, (&quot;should reoptimize from loop now&quot;));
<span class="udiff-line-modified-removed">-             if (UNLIKELY(Options::verboseOSR())) {</span>
<span class="udiff-line-modified-removed">-                 dataLog(</span>
<span class="udiff-line-modified-removed">-                     &quot;Triggering reoptimization of &quot;, codeBlock,</span>
<span class="udiff-line-removed">-                     &quot;(&quot;, replacement, &quot;) (in loop).\n&quot;);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+             dataLogLnIf(Options::verboseOSR(),</span>
<span class="udiff-line-modified-added">+                 &quot;Triggering reoptimization of &quot;, codeBlock,</span>
<span class="udiff-line-modified-added">+                 &quot;(&quot;, replacement, &quot;) (in loop).&quot;);</span>
              replacement-&gt;jettison(Profiler::JettisonDueToBaselineLoopReoptimizationTrigger, CountReoptimization);
              return encodeResult(0, 0);
          }
      } else {
          if (!codeBlock-&gt;shouldOptimizeNow()) {
              CODEBLOCK_LOG_EVENT(codeBlock, &quot;delayOptimizeToDFG&quot;, (&quot;insufficient profiling&quot;));
<span class="udiff-line-modified-removed">-             if (UNLIKELY(Options::verboseOSR())) {</span>
<span class="udiff-line-modified-removed">-                 dataLog(</span>
<span class="udiff-line-modified-removed">-                     &quot;Delaying optimization for &quot;, *codeBlock,</span>
<span class="udiff-line-removed">-                     &quot; because of insufficient profiling.\n&quot;);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+             dataLogLnIf(Options::verboseOSR(),</span>
<span class="udiff-line-modified-added">+                 &quot;Delaying optimization for &quot;, *codeBlock,</span>
<span class="udiff-line-modified-added">+                 &quot; because of insufficient profiling.&quot;);</span>
              return encodeResult(0, 0);
          }
  
<span class="udiff-line-modified-removed">-         if (UNLIKELY(Options::verboseOSR()))</span>
<span class="udiff-line-removed">-             dataLog(&quot;Triggering optimized compilation of &quot;, *codeBlock, &quot;\n&quot;);</span>
<span class="udiff-line-modified-added">+         dataLogLnIf(Options::verboseOSR(), &quot;Triggering optimized compilation of &quot;, *codeBlock);</span>
  
<span class="udiff-line-modified-removed">-         unsigned numVarsWithValues;</span>
<span class="udiff-line-modified-added">+         unsigned numVarsWithValues = 0;</span>
          if (bytecodeIndex)
              numVarsWithValues = codeBlock-&gt;numCalleeLocals();
<span class="udiff-line-modified-removed">-         else</span>
<span class="udiff-line-modified-removed">-             numVarsWithValues = 0;</span>
<span class="udiff-line-removed">-         Operands&lt;Optional&lt;JSValue&gt;&gt; mustHandleValues(codeBlock-&gt;numParameters(), numVarsWithValues);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         Operands&lt;Optional&lt;JSValue&gt;&gt; mustHandleValues(codeBlock-&gt;numParameters(), numVarsWithValues, 0);</span>
          int localsUsedForCalleeSaves = static_cast&lt;int&gt;(CodeBlock::llintBaselineCalleeSaveSpaceAsVirtualRegisters());
          for (size_t i = 0; i &lt; mustHandleValues.size(); ++i) {
<span class="udiff-line-modified-removed">-             int operand = mustHandleValues.operandForIndex(i);</span>
<span class="udiff-line-modified-removed">-             if (operandIsLocal(operand) &amp;&amp; VirtualRegister(operand).toLocal() &lt; localsUsedForCalleeSaves)</span>
<span class="udiff-line-modified-added">+             Operand operand = mustHandleValues.operandForIndex(i);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+             if (operand.isLocal() &amp;&amp; operand.toLocal() &lt; localsUsedForCalleeSaves)</span>
                  continue;
<span class="udiff-line-modified-removed">-             mustHandleValues[i] = exec-&gt;uncheckedR(operand).jsValue();</span>
<span class="udiff-line-modified-added">+             mustHandleValues[i] = callFrame-&gt;uncheckedR(operand.virtualRegister()).jsValue();</span>
          }
  
          CodeBlock* replacementCodeBlock = codeBlock-&gt;newReplacement();
          CompilationResult result = DFG::compile(
              vm, replacementCodeBlock, nullptr, DFG::DFGMode, bytecodeIndex,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1607,30 +1672,25 @@</span>
      }
  
      CodeBlock* optimizedCodeBlock = codeBlock-&gt;replacement();
      ASSERT(optimizedCodeBlock &amp;&amp; JITCode::isOptimizingJIT(optimizedCodeBlock-&gt;jitType()));
  
<span class="udiff-line-modified-removed">-     if (void* dataBuffer = DFG::prepareOSREntry(exec, optimizedCodeBlock, bytecodeIndex)) {</span>
<span class="udiff-line-modified-added">+     if (void* dataBuffer = DFG::prepareOSREntry(vm, callFrame, optimizedCodeBlock, bytecodeIndex)) {</span>
          CODEBLOCK_LOG_EVENT(optimizedCodeBlock, &quot;osrEntry&quot;, (&quot;at bc#&quot;, bytecodeIndex));
<span class="udiff-line-modified-removed">-         if (UNLIKELY(Options::verboseOSR())) {</span>
<span class="udiff-line-removed">-             dataLog(</span>
<span class="udiff-line-removed">-                 &quot;Performing OSR &quot;, codeBlock, &quot; -&gt; &quot;, optimizedCodeBlock, &quot;.\n&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         dataLogLnIf(Options::verboseOSR(), &quot;Performing OSR &quot;, codeBlock, &quot; -&gt; &quot;, optimizedCodeBlock);</span>
  
          codeBlock-&gt;optimizeSoon();
          codeBlock-&gt;unlinkedCodeBlock()-&gt;setDidOptimize(TrueTriState);
          void* targetPC = vm.getCTIStub(DFG::osrEntryThunkGenerator).code().executableAddress();
<span class="udiff-line-modified-removed">-         targetPC = retagCodePtr(targetPC, JITThunkPtrTag, bitwise_cast&lt;PtrTag&gt;(exec));</span>
<span class="udiff-line-modified-added">+         targetPC = retagCodePtr(targetPC, JITThunkPtrTag, bitwise_cast&lt;PtrTag&gt;(callFrame));</span>
          return encodeResult(targetPC, dataBuffer);
      }
  
<span class="udiff-line-modified-removed">-     if (UNLIKELY(Options::verboseOSR())) {</span>
<span class="udiff-line-modified-removed">-         dataLog(</span>
<span class="udiff-line-modified-removed">-             &quot;Optimizing &quot;, codeBlock, &quot; -&gt; &quot;, codeBlock-&gt;replacement(),</span>
<span class="udiff-line-modified-removed">-             &quot; succeeded, OSR failed, after a delay of &quot;,</span>
<span class="udiff-line-removed">-             codeBlock-&gt;optimizationDelayCounter(), &quot;.\n&quot;);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     dataLogLnIf(Options::verboseOSR(),</span>
<span class="udiff-line-modified-added">+         &quot;Optimizing &quot;, codeBlock, &quot; -&gt; &quot;, codeBlock-&gt;replacement(),</span>
<span class="udiff-line-modified-added">+         &quot; succeeded, OSR failed, after a delay of &quot;,</span>
<span class="udiff-line-modified-added">+         codeBlock-&gt;optimizationDelayCounter());</span>
  
      // Count the OSR failure as a speculation failure. If this happens a lot, then
      // reoptimize.
      optimizedCodeBlock-&gt;countOSRExit();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1642,15 +1702,13 @@</span>
      // because the OSR code decided for any spurious reason that it did not want to OSR
      // right now. So, we only trigger reoptimization only upon the more conservative (non-loop)
      // reoptimization trigger.
      if (optimizedCodeBlock-&gt;shouldReoptimizeNow()) {
          CODEBLOCK_LOG_EVENT(codeBlock, &quot;delayOptimizeToDFG&quot;, (&quot;should reoptimize now&quot;));
<span class="udiff-line-modified-removed">-         if (UNLIKELY(Options::verboseOSR())) {</span>
<span class="udiff-line-modified-removed">-             dataLog(</span>
<span class="udiff-line-modified-removed">-                 &quot;Triggering reoptimization of &quot;, codeBlock, &quot; -&gt; &quot;,</span>
<span class="udiff-line-removed">-                 codeBlock-&gt;replacement(), &quot; (after OSR fail).\n&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         dataLogLnIf(Options::verboseOSR(),</span>
<span class="udiff-line-modified-added">+             &quot;Triggering reoptimization of &quot;, codeBlock, &quot; -&gt; &quot;,</span>
<span class="udiff-line-modified-added">+             codeBlock-&gt;replacement(), &quot; (after OSR fail).&quot;);</span>
          optimizedCodeBlock-&gt;jettison(Profiler::JettisonDueToBaselineLoopReoptimizationTriggerOnOSREntryFail, CountReoptimization);
          return encodeResult(0, 0);
      }
  
      // OSR failed this time, but it might succeed next time! Let the code run a bit
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1659,221 +1717,230 @@</span>
  
      CODEBLOCK_LOG_EVENT(codeBlock, &quot;delayOptimizeToDFG&quot;, (&quot;OSR failed&quot;));
      return encodeResult(0, 0);
  }
  
<span class="udiff-line-modified-removed">- char* JIT_OPERATION operationTryOSREnterAtCatch(ExecState* exec, uint32_t bytecodeIndex)</span>
<span class="udiff-line-modified-added">+ char* JIT_OPERATION operationTryOSREnterAtCatch(VM* vmPointer, uint32_t bytecodeIndexBits)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     BytecodeIndex bytecodeIndex = BytecodeIndex::fromBits(bytecodeIndexBits);</span>
  
<span class="udiff-line-modified-removed">-     CodeBlock* optimizedReplacement = exec-&gt;codeBlock()-&gt;replacement();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
<span class="udiff-line-added">+     CodeBlock* optimizedReplacement = codeBlock-&gt;replacement();</span>
      if (UNLIKELY(!optimizedReplacement))
          return nullptr;
  
      switch (optimizedReplacement-&gt;jitType()) {
      case JITType::DFGJIT:
      case JITType::FTLJIT: {
<span class="udiff-line-modified-removed">-         MacroAssemblerCodePtr&lt;ExceptionHandlerPtrTag&gt; entry = DFG::prepareCatchOSREntry(exec, optimizedReplacement, bytecodeIndex);</span>
<span class="udiff-line-modified-added">+         MacroAssemblerCodePtr&lt;ExceptionHandlerPtrTag&gt; entry = DFG::prepareCatchOSREntry(vm, callFrame, codeBlock, optimizedReplacement, bytecodeIndex);</span>
          return entry.executableAddress&lt;char*&gt;();
      }
      default:
          break;
      }
      return nullptr;
  }
  
<span class="udiff-line-modified-removed">- char* JIT_OPERATION operationTryOSREnterAtCatchAndValueProfile(ExecState* exec, uint32_t bytecodeIndex)</span>
<span class="udiff-line-modified-added">+ char* JIT_OPERATION operationTryOSREnterAtCatchAndValueProfile(VM* vmPointer, uint32_t bytecodeIndexBits)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     BytecodeIndex bytecodeIndex = BytecodeIndex::fromBits(bytecodeIndexBits);</span>
  
<span class="udiff-line-modified-removed">-     CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
      CodeBlock* optimizedReplacement = codeBlock-&gt;replacement();
      if (UNLIKELY(!optimizedReplacement))
          return nullptr;
  
      switch (optimizedReplacement-&gt;jitType()) {
      case JITType::DFGJIT:
      case JITType::FTLJIT: {
<span class="udiff-line-modified-removed">-         MacroAssemblerCodePtr&lt;ExceptionHandlerPtrTag&gt; entry = DFG::prepareCatchOSREntry(exec, optimizedReplacement, bytecodeIndex);</span>
<span class="udiff-line-modified-added">+         MacroAssemblerCodePtr&lt;ExceptionHandlerPtrTag&gt; entry = DFG::prepareCatchOSREntry(vm, callFrame, codeBlock, optimizedReplacement, bytecodeIndex);</span>
          return entry.executableAddress&lt;char*&gt;();
      }
      default:
          break;
      }
  
<span class="udiff-line-modified-removed">-     codeBlock-&gt;ensureCatchLivenessIsComputedForBytecodeOffset(bytecodeIndex);</span>
<span class="udiff-line-modified-added">+     codeBlock-&gt;ensureCatchLivenessIsComputedForBytecodeIndex(bytecodeIndex);</span>
      auto bytecode = codeBlock-&gt;instructions().at(bytecodeIndex)-&gt;as&lt;OpCatch&gt;();
      auto&amp; metadata = bytecode.metadata(codeBlock);
<span class="udiff-line-modified-removed">-     metadata.m_buffer-&gt;forEach([&amp;] (ValueProfileAndOperand&amp; profile) {</span>
<span class="udiff-line-modified-removed">-         profile.m_buckets[0] = JSValue::encode(exec-&gt;uncheckedR(profile.m_operand).jsValue());</span>
<span class="udiff-line-modified-added">+     metadata.m_buffer-&gt;forEach([&amp;] (ValueProfileAndVirtualRegister&amp; profile) {</span>
<span class="udiff-line-modified-added">+         profile.m_buckets[0] = JSValue::encode(callFrame-&gt;uncheckedR(profile.m_operand).jsValue());</span>
      });
  
      return nullptr;
  }
  
  #endif
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutByIndex(ExecState* exec, EncodedJSValue encodedArrayValue, int32_t index, EncodedJSValue encodedValue)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutByIndex(JSGlobalObject* globalObject, EncodedJSValue encodedArrayValue, int32_t index, EncodedJSValue encodedValue)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue arrayValue = JSValue::decode(encodedArrayValue);
      ASSERT(isJSArray(arrayValue));
<span class="udiff-line-modified-removed">-     asArray(arrayValue)-&gt;putDirectIndex(exec, index, JSValue::decode(encodedValue));</span>
<span class="udiff-line-modified-added">+     asArray(arrayValue)-&gt;putDirectIndex(globalObject, index, JSValue::decode(encodedValue));</span>
  }
  
  enum class AccessorType {
      Getter,
      Setter
  };
  
<span class="udiff-line-modified-removed">- static void putAccessorByVal(ExecState* exec, JSObject* base, JSValue subscript, int32_t attribute, JSObject* accessor, AccessorType accessorType)</span>
<span class="udiff-line-modified-added">+ static void putAccessorByVal(JSGlobalObject* globalObject, JSObject* base, JSValue subscript, int32_t attribute, JSObject* accessor, AccessorType accessorType)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="udiff-line-modified-removed">-     auto propertyKey = subscript.toPropertyKey(exec);</span>
<span class="udiff-line-modified-added">+     auto propertyKey = subscript.toPropertyKey(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, void());
  
      scope.release();
      if (accessorType == AccessorType::Getter)
<span class="udiff-line-modified-removed">-         base-&gt;putGetter(exec, propertyKey, accessor, attribute);</span>
<span class="udiff-line-modified-added">+         base-&gt;putGetter(globalObject, propertyKey, accessor, attribute);</span>
      else
<span class="udiff-line-modified-removed">-         base-&gt;putSetter(exec, propertyKey, accessor, attribute);</span>
<span class="udiff-line-modified-added">+         base-&gt;putSetter(globalObject, propertyKey, accessor, attribute);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutGetterById(ExecState* exec, JSCell* object, UniquedStringImpl* uid, int32_t options, JSCell* getter)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutGetterById(JSGlobalObject* globalObject, JSCell* object, UniquedStringImpl* uid, int32_t options, JSCell* getter)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      ASSERT(object &amp;&amp; object-&gt;isObject());
      JSObject* baseObj = object-&gt;getObject();
  
      ASSERT(getter-&gt;isObject());
<span class="udiff-line-modified-removed">-     baseObj-&gt;putGetter(exec, uid, getter, options);</span>
<span class="udiff-line-modified-added">+     baseObj-&gt;putGetter(globalObject, uid, getter, options);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutSetterById(ExecState* exec, JSCell* object, UniquedStringImpl* uid, int32_t options, JSCell* setter)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutSetterById(JSGlobalObject* globalObject, JSCell* object, UniquedStringImpl* uid, int32_t options, JSCell* setter)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      ASSERT(object &amp;&amp; object-&gt;isObject());
      JSObject* baseObj = object-&gt;getObject();
  
      ASSERT(setter-&gt;isObject());
<span class="udiff-line-modified-removed">-     baseObj-&gt;putSetter(exec, uid, setter, options);</span>
<span class="udiff-line-modified-added">+     baseObj-&gt;putSetter(globalObject, uid, setter, options);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutGetterByVal(ExecState* exec, JSCell* base, EncodedJSValue encodedSubscript, int32_t attribute, JSCell* getter)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutGetterByVal(JSGlobalObject* globalObject, JSCell* base, EncodedJSValue encodedSubscript, int32_t attribute, JSCell* getter)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     putAccessorByVal(exec, asObject(base), JSValue::decode(encodedSubscript), attribute, asObject(getter), AccessorType::Getter);</span>
<span class="udiff-line-modified-added">+     putAccessorByVal(globalObject, asObject(base), JSValue::decode(encodedSubscript), attribute, asObject(getter), AccessorType::Getter);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutSetterByVal(ExecState* exec, JSCell* base, EncodedJSValue encodedSubscript, int32_t attribute, JSCell* setter)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutSetterByVal(JSGlobalObject* globalObject, JSCell* base, EncodedJSValue encodedSubscript, int32_t attribute, JSCell* setter)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     putAccessorByVal(exec, asObject(base), JSValue::decode(encodedSubscript), attribute, asObject(setter), AccessorType::Setter);</span>
<span class="udiff-line-modified-added">+     putAccessorByVal(globalObject, asObject(base), JSValue::decode(encodedSubscript), attribute, asObject(setter), AccessorType::Setter);</span>
  }
  
  #if USE(JSVALUE64)
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutGetterSetter(ExecState* exec, JSCell* object, UniquedStringImpl* uid, int32_t attribute, EncodedJSValue encodedGetterValue, EncodedJSValue encodedSetterValue)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutGetterSetter(JSGlobalObject* globalObject, JSCell* object, UniquedStringImpl* uid, int32_t attribute, EncodedJSValue encodedGetterValue, EncodedJSValue encodedSetterValue)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      ASSERT(object &amp;&amp; object-&gt;isObject());
      JSObject* baseObject = asObject(object);
  
      JSValue getter = JSValue::decode(encodedGetterValue);
      JSValue setter = JSValue::decode(encodedSetterValue);
      ASSERT(getter.isObject() || setter.isObject());
<span class="udiff-line-modified-removed">-     GetterSetter* accessor = GetterSetter::create(vm, exec-&gt;lexicalGlobalObject(), getter, setter);</span>
<span class="udiff-line-modified-removed">-     CommonSlowPaths::putDirectAccessorWithReify(vm, exec, baseObject, uid, accessor, attribute);</span>
<span class="udiff-line-modified-added">+     GetterSetter* accessor = GetterSetter::create(vm, globalObject, getter, setter);</span>
<span class="udiff-line-modified-added">+     CommonSlowPaths::putDirectAccessorWithReify(vm, globalObject, baseObject, uid, accessor, attribute);</span>
  }
  
  #else
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutGetterSetter(ExecState* exec, JSCell* object, UniquedStringImpl* uid, int32_t attribute, JSCell* getterCell, JSCell* setterCell)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutGetterSetter(JSGlobalObject* globalObject, JSCell* object, UniquedStringImpl* uid, int32_t attribute, JSCell* getterCell, JSCell* setterCell)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      ASSERT(object &amp;&amp; object-&gt;isObject());
      JSObject* baseObject = asObject(object);
  
      ASSERT(getterCell || setterCell);
      JSObject* getter = getterCell ? getterCell-&gt;getObject() : nullptr;
      JSObject* setter = setterCell ? setterCell-&gt;getObject() : nullptr;
<span class="udiff-line-modified-removed">-     GetterSetter* accessor = GetterSetter::create(vm, exec-&gt;lexicalGlobalObject(), getter, setter);</span>
<span class="udiff-line-modified-removed">-     CommonSlowPaths::putDirectAccessorWithReify(vm, exec, baseObject, uid, accessor, attribute);</span>
<span class="udiff-line-modified-added">+     GetterSetter* accessor = GetterSetter::create(vm, globalObject, getter, setter);</span>
<span class="udiff-line-modified-added">+     CommonSlowPaths::putDirectAccessorWithReify(vm, globalObject, baseObject, uid, accessor, attribute);</span>
  }
  #endif
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPopScope(ExecState* exec, int32_t scopeReg)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPopScope(JSGlobalObject* globalObject, int32_t scopeReg)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     JSScope* scope = exec-&gt;uncheckedR(scopeReg).Register::scope();</span>
<span class="udiff-line-modified-removed">-     exec-&gt;uncheckedR(scopeReg) = scope-&gt;next();</span>
<span class="udiff-line-modified-added">+     auto&amp; scopeSlot = callFrame-&gt;uncheckedR(VirtualRegister(scopeReg));</span>
<span class="udiff-line-modified-added">+     scopeSlot = scopeSlot.Register::scope()-&gt;next();</span>
  }
  
<span class="udiff-line-modified-removed">- int32_t JIT_OPERATION operationInstanceOfCustom(ExecState* exec, EncodedJSValue encodedValue, JSObject* constructor, EncodedJSValue encodedHasInstance)</span>
<span class="udiff-line-modified-added">+ int32_t JIT_OPERATION operationInstanceOfCustom(JSGlobalObject* globalObject, EncodedJSValue encodedValue, JSObject* constructor, EncodedJSValue encodedHasInstance)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue value = JSValue::decode(encodedValue);
      JSValue hasInstanceValue = JSValue::decode(encodedHasInstance);
  
<span class="udiff-line-modified-removed">-     if (constructor-&gt;hasInstance(exec, value, hasInstanceValue))</span>
<span class="udiff-line-modified-added">+     if (constructor-&gt;hasInstance(globalObject, value, hasInstanceValue))</span>
          return 1;
      return 0;
  }
  
  }
  
<span class="udiff-line-modified-removed">- static JSValue getByVal(ExecState* exec, JSValue baseValue, JSValue subscript, ByValInfo* byValInfo, ReturnAddressPtr returnAddress)</span>
<span class="udiff-line-modified-added">+ ALWAYS_INLINE static JSValue getByVal(JSGlobalObject* globalObject, CallFrame* callFrame, ArrayProfile* arrayProfile, JSValue baseValue, JSValue subscript)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     UNUSED_PARAM(callFrame);</span>
<span class="udiff-line-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      if (LIKELY(baseValue.isCell() &amp;&amp; subscript.isString())) {
          Structure&amp; structure = *baseValue.asCell()-&gt;structure(vm);
          if (JSCell::canUseFastGetOwnProperty(structure)) {
<span class="udiff-line-modified-removed">-             RefPtr&lt;AtomStringImpl&gt; existingAtomString = asString(subscript)-&gt;toExistingAtomString(exec);</span>
<span class="udiff-line-modified-added">+             RefPtr&lt;AtomStringImpl&gt; existingAtomString = asString(subscript)-&gt;toExistingAtomString(globalObject);</span>
              RETURN_IF_EXCEPTION(scope, JSValue());
              if (existingAtomString) {
                  if (JSValue result = baseValue.asCell()-&gt;fastGetOwnProperty(vm, structure, existingAtomString.get())) {
<span class="udiff-line-modified-removed">-                     ASSERT(exec-&gt;bytecodeOffset());</span>
<span class="udiff-line-removed">-                     if (byValInfo-&gt;stubInfo &amp;&amp; byValInfo-&gt;cachedId.impl() != existingAtomString)</span>
<span class="udiff-line-removed">-                         byValInfo-&gt;tookSlowPath = true;</span>
<span class="udiff-line-modified-added">+                     ASSERT(callFrame-&gt;bytecodeIndex() != BytecodeIndex(0));</span>
                      return result;
                  }
              }
          }
      }
  
      if (subscript.isInt32()) {
<span class="udiff-line-removed">-         ASSERT(exec-&gt;bytecodeOffset());</span>
<span class="udiff-line-removed">-         byValInfo-&gt;tookSlowPath = true;</span>
<span class="udiff-line-removed">- </span>
          int32_t i = subscript.asInt32();
          if (isJSString(baseValue)) {
<span class="udiff-line-modified-removed">-             if (i &gt;= 0 &amp;&amp; asString(baseValue)-&gt;canGetIndex(i)) {</span>
<span class="udiff-line-modified-removed">-                 ctiPatchCallByReturnAddress(returnAddress, operationGetByValString);</span>
<span class="udiff-line-modified-removed">-                 RELEASE_AND_RETURN(scope, asString(baseValue)-&gt;getIndex(exec, i));</span>
<span class="udiff-line-modified-removed">-             }</span>
<span class="udiff-line-removed">-             byValInfo-&gt;arrayProfile-&gt;setOutOfBounds();</span>
<span class="udiff-line-modified-added">+             if (i &gt;= 0 &amp;&amp; asString(baseValue)-&gt;canGetIndex(i))</span>
<span class="udiff-line-modified-added">+                 RELEASE_AND_RETURN(scope, asString(baseValue)-&gt;getIndex(globalObject, i));</span>
<span class="udiff-line-modified-added">+             if (arrayProfile)</span>
<span class="udiff-line-modified-added">+                 arrayProfile-&gt;setOutOfBounds();</span>
          } else if (baseValue.isObject()) {
              JSObject* object = asObject(baseValue);
              if (object-&gt;canGetIndexQuickly(i))
                  return object-&gt;getIndexQuickly(i);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1888,158 +1955,148 @@</span>
  
              if (!skipMarkingOutOfBounds &amp;&amp; !CommonSlowPaths::canAccessArgumentIndexQuickly(*object, i)) {
                  // FIXME: This will make us think that in-bounds typed array accesses are actually
                  // out-of-bounds.
                  // https://bugs.webkit.org/show_bug.cgi?id=149886
<span class="udiff-line-modified-removed">-                 byValInfo-&gt;arrayProfile-&gt;setOutOfBounds();</span>
<span class="udiff-line-modified-added">+                 if (arrayProfile)</span>
<span class="udiff-line-added">+                     arrayProfile-&gt;setOutOfBounds();</span>
              }
          }
  
          if (i &gt;= 0)
<span class="udiff-line-modified-removed">-             RELEASE_AND_RETURN(scope, baseValue.get(exec, static_cast&lt;uint32_t&gt;(i)));</span>
<span class="udiff-line-modified-added">+             RELEASE_AND_RETURN(scope, baseValue.get(globalObject, static_cast&lt;uint32_t&gt;(i)));</span>
      }
  
<span class="udiff-line-modified-removed">-     baseValue.requireObjectCoercible(exec);</span>
<span class="udiff-line-modified-added">+     baseValue.requireObjectCoercible(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, JSValue());
<span class="udiff-line-modified-removed">-     auto property = subscript.toPropertyKey(exec);</span>
<span class="udiff-line-modified-added">+     auto property = subscript.toPropertyKey(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, JSValue());
  
<span class="udiff-line-modified-removed">-     ASSERT(exec-&gt;bytecodeOffset());</span>
<span class="udiff-line-modified-removed">-     if (byValInfo-&gt;stubInfo &amp;&amp; (!isStringOrSymbol(subscript) || byValInfo-&gt;cachedId != property))</span>
<span class="udiff-line-removed">-         byValInfo-&gt;tookSlowPath = true;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     RELEASE_AND_RETURN(scope, baseValue.get(exec, property));</span>
<span class="udiff-line-modified-added">+     ASSERT(callFrame-&gt;bytecodeIndex() != BytecodeIndex(0));</span>
<span class="udiff-line-modified-added">+     RELEASE_AND_RETURN(scope, baseValue.get(globalObject, property));</span>
  }
  
<span class="udiff-line-modified-removed">- static OptimizationResult tryGetByValOptimize(ExecState* exec, JSValue baseValue, JSValue subscript, ByValInfo* byValInfo, ReturnAddressPtr returnAddress)</span>
<span class="udiff-line-modified-added">+ extern &quot;C&quot; {</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ EncodedJSValue JIT_OPERATION operationGetByValGeneric(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, ArrayProfile* profile, EncodedJSValue encodedBase, EncodedJSValue encodedSubscript)</span>
  {
<span class="udiff-line-modified-removed">-     // See if it&#39;s worth optimizing this at all.</span>
<span class="udiff-line-modified-removed">-     OptimizationResult optimizationResult = OptimizationResult::NotOptimized;</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     JSValue baseValue = JSValue::decode(encodedBase);</span>
<span class="udiff-line-added">+     JSValue subscript = JSValue::decode(encodedSubscript);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     stubInfo-&gt;tookSlowPath = true;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return JSValue::encode(getByVal(globalObject, callFrame, profile, baseValue, subscript));</span>
<span class="udiff-line-added">+ }</span>
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetByValOptimize(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, ArrayProfile* profile, EncodedJSValue encodedBase, EncodedJSValue encodedSubscript)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     if (baseValue.isObject() &amp;&amp; subscript.isInt32()) {</span>
<span class="udiff-line-modified-removed">-         JSObject* object = asObject(baseValue);</span>
<span class="udiff-line-modified-added">+     JSValue baseValue = JSValue::decode(encodedBase);</span>
<span class="udiff-line-modified-added">+     JSValue subscript = JSValue::decode(encodedSubscript);</span>
  
<span class="udiff-line-modified-removed">-         ASSERT(exec-&gt;bytecodeOffset());</span>
<span class="udiff-line-removed">-         ASSERT(!byValInfo-&gt;stubRoutine);</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
  
<span class="udiff-line-modified-removed">-         if (hasOptimizableIndexing(object-&gt;structure(vm))) {</span>
<span class="udiff-line-modified-removed">-             // Attempt to optimize.</span>
<span class="udiff-line-modified-removed">-             Structure* structure = object-&gt;structure(vm);</span>
<span class="udiff-line-modified-removed">-             JITArrayMode arrayMode = jitArrayModeForStructure(structure);</span>
<span class="udiff-line-removed">-             if (arrayMode != byValInfo-&gt;arrayMode) {</span>
<span class="udiff-line-removed">-                 // If we reached this case, we got an interesting array mode we did not expect when we compiled.</span>
<span class="udiff-line-removed">-                 // Let&#39;s update the profile to do better next time.</span>
<span class="udiff-line-removed">-                 CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     if (baseValue.isCell() &amp;&amp; subscript.isInt32()) {</span>
<span class="udiff-line-modified-added">+         Structure* structure = baseValue.asCell()-&gt;structure(vm);</span>
<span class="udiff-line-modified-added">+         if (stubInfo-&gt;considerCaching(vm, codeBlock, structure)) {</span>
<span class="udiff-line-modified-added">+             if (profile) {</span>
                  ConcurrentJSLocker locker(codeBlock-&gt;m_lock);
<span class="udiff-line-modified-removed">-                 byValInfo-&gt;arrayProfile-&gt;computeUpdatedPrediction(locker, codeBlock, structure);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 JIT::compileGetByVal(locker, vm, codeBlock, byValInfo, returnAddress, arrayMode);</span>
<span class="udiff-line-removed">-                 optimizationResult = OptimizationResult::Optimized;</span>
<span class="udiff-line-modified-added">+                 profile-&gt;computeUpdatedPrediction(locker, codeBlock, structure);</span>
              }
<span class="udiff-line-added">+             repatchArrayGetByVal(globalObject, codeBlock, baseValue, subscript, *stubInfo);</span>
          }
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         // If we failed to patch and we have some object that intercepts indexed get, then don&#39;t even wait until 10 times.</span>
<span class="udiff-line-removed">-         if (optimizationResult != OptimizationResult::Optimized &amp;&amp; object-&gt;structure(vm)-&gt;typeInfo().interceptsGetOwnPropertySlotByIndexEvenWhenLengthIsNotZero())</span>
<span class="udiff-line-removed">-             optimizationResult = OptimizationResult::GiveUp;</span>
      }
  
<span class="udiff-line-modified-removed">-     if (baseValue.isObject() &amp;&amp; isStringOrSymbol(subscript)) {</span>
<span class="udiff-line-modified-removed">-         const Identifier propertyName = subscript.toPropertyKey(exec);</span>
<span class="udiff-line-modified-removed">-         RETURN_IF_EXCEPTION(scope, OptimizationResult::GiveUp);</span>
<span class="udiff-line-modified-added">+     if (baseValue.isCell() &amp;&amp; CacheableIdentifier::isCacheableIdentifierCell(subscript)) {</span>
<span class="udiff-line-modified-added">+         const Identifier propertyName = subscript.toPropertyKey(globalObject);</span>
<span class="udiff-line-modified-added">+         RETURN_IF_EXCEPTION(scope, encodedJSValue());</span>
          if (subscript.isSymbol() || !parseIndex(propertyName)) {
<span class="udiff-line-modified-removed">-             ASSERT(exec-&gt;bytecodeOffset());</span>
<span class="udiff-line-modified-removed">-             ASSERT(!byValInfo-&gt;stubRoutine);</span>
<span class="udiff-line-modified-removed">-             if (byValInfo-&gt;seen) {</span>
<span class="udiff-line-removed">-                 if (byValInfo-&gt;cachedId == propertyName) {</span>
<span class="udiff-line-removed">-                     JIT::compileGetByValWithCachedId(vm, exec-&gt;codeBlock(), byValInfo, returnAddress, propertyName);</span>
<span class="udiff-line-removed">-                     optimizationResult = OptimizationResult::Optimized;</span>
<span class="udiff-line-removed">-                 } else {</span>
<span class="udiff-line-removed">-                     // Seem like a generic property access site.</span>
<span class="udiff-line-removed">-                     optimizationResult = OptimizationResult::GiveUp;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             } else {</span>
<span class="udiff-line-removed">-                 CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-removed">-                 ConcurrentJSLocker locker(codeBlock-&gt;m_lock);</span>
<span class="udiff-line-removed">-                 byValInfo-&gt;seen = true;</span>
<span class="udiff-line-removed">-                 byValInfo-&gt;cachedId = propertyName;</span>
<span class="udiff-line-removed">-                 if (subscript.isSymbol())</span>
<span class="udiff-line-removed">-                     byValInfo-&gt;cachedSymbol.set(vm, codeBlock, asSymbol(subscript));</span>
<span class="udiff-line-removed">-                 optimizationResult = OptimizationResult::SeenOnce;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+             scope.release();</span>
<span class="udiff-line-modified-added">+             return JSValue::encode(baseValue.getPropertySlot(globalObject, propertyName, [&amp;] (bool found, PropertySlot&amp; slot) -&gt; JSValue {</span>
<span class="udiff-line-modified-added">+                 LOG_IC((ICEvent::OperationGetByValOptimize, baseValue.classInfoOrNull(vm), propertyName, baseValue == slot.slotBase()));</span>
  
<span class="udiff-line-modified-removed">-     if (optimizationResult != OptimizationResult::Optimized &amp;&amp; optimizationResult != OptimizationResult::SeenOnce) {</span>
<span class="udiff-line-modified-removed">-         // If we take slow path more than 10 times without patching then make sure we</span>
<span class="udiff-line-modified-removed">-         // never make that mistake again. For cases where we see non-index-intercepting</span>
<span class="udiff-line-modified-removed">-         // objects, this gives 10 iterations worth of opportunity for us to observe</span>
<span class="udiff-line-modified-removed">-         // that the get_by_val may be polymorphic. We count up slowPathCount even if</span>
<span class="udiff-line-removed">-         // the result is GiveUp.</span>
<span class="udiff-line-removed">-         if (++byValInfo-&gt;slowPathCount &gt;= 10)</span>
<span class="udiff-line-removed">-             optimizationResult = OptimizationResult::GiveUp;</span>
<span class="udiff-line-modified-added">+                 if (stubInfo-&gt;considerCaching(vm, codeBlock, baseValue.structureOrNull(), propertyName.impl()))</span>
<span class="udiff-line-modified-added">+                     repatchGetBy(globalObject, codeBlock, baseValue, subscript.asCell(), slot, *stubInfo, GetByKind::NormalByVal);</span>
<span class="udiff-line-modified-added">+                 return found ? slot.getValue(globalObject, propertyName) : jsUndefined();</span>
<span class="udiff-line-modified-added">+             }));</span>
<span class="udiff-line-modified-added">+         }</span>
      }
  
<span class="udiff-line-modified-removed">-     return optimizationResult;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- extern &quot;C&quot; {</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- EncodedJSValue JIT_OPERATION operationGetByValGeneric(ExecState* exec, EncodedJSValue encodedBase, EncodedJSValue encodedSubscript, ByValInfo* byValInfo)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-removed">-     JSValue baseValue = JSValue::decode(encodedBase);</span>
<span class="udiff-line-removed">-     JSValue subscript = JSValue::decode(encodedSubscript);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     JSValue result = getByVal(exec, baseValue, subscript, byValInfo, ReturnAddressPtr(OUR_RETURN_ADDRESS));</span>
<span class="udiff-line-removed">-     return JSValue::encode(result);</span>
<span class="udiff-line-modified-added">+     RELEASE_AND_RETURN(scope, JSValue::encode(getByVal(globalObject, callFrame, profile, baseValue, subscript)));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetByValOptimize(ExecState* exec, EncodedJSValue encodedBase, EncodedJSValue encodedSubscript, ByValInfo* byValInfo)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetByVal(JSGlobalObject* globalObject, EncodedJSValue encodedBase, EncodedJSValue encodedProperty)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      JSValue baseValue = JSValue::decode(encodedBase);
<span class="udiff-line-modified-removed">-     JSValue subscript = JSValue::decode(encodedSubscript);</span>
<span class="udiff-line-modified-removed">-     ReturnAddressPtr returnAddress = ReturnAddressPtr(OUR_RETURN_ADDRESS);</span>
<span class="udiff-line-modified-removed">-     OptimizationResult result = tryGetByValOptimize(exec, baseValue, subscript, byValInfo, returnAddress);</span>
<span class="udiff-line-modified-removed">-     RETURN_IF_EXCEPTION(scope, { });</span>
<span class="udiff-line-modified-removed">-     if (result == OptimizationResult::GiveUp) {</span>
<span class="udiff-line-modified-removed">-         // Don&#39;t ever try to optimize.</span>
<span class="udiff-line-modified-removed">-         byValInfo-&gt;tookSlowPath = true;</span>
<span class="udiff-line-modified-removed">-         ctiPatchCallByReturnAddress(returnAddress, operationGetByValGeneric);</span>
<span class="udiff-line-modified-added">+     JSValue property = JSValue::decode(encodedProperty);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     if (LIKELY(baseValue.isCell())) {</span>
<span class="udiff-line-modified-added">+         JSCell* base = baseValue.asCell();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         if (property.isUInt32())</span>
<span class="udiff-line-modified-added">+             RELEASE_AND_RETURN(scope, getByValWithIndex(globalObject, base, property.asUInt32()));</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+         if (property.isDouble()) {</span>
<span class="udiff-line-added">+             double propertyAsDouble = property.asDouble();</span>
<span class="udiff-line-added">+             uint32_t propertyAsUInt32 = static_cast&lt;uint32_t&gt;(propertyAsDouble);</span>
<span class="udiff-line-added">+             if (propertyAsUInt32 == propertyAsDouble &amp;&amp; isIndex(propertyAsUInt32))</span>
<span class="udiff-line-added">+                 RELEASE_AND_RETURN(scope, getByValWithIndex(globalObject, base, propertyAsUInt32));</span>
<span class="udiff-line-added">+         } else if (property.isString()) {</span>
<span class="udiff-line-added">+             Structure&amp; structure = *base-&gt;structure(vm);</span>
<span class="udiff-line-added">+             if (JSCell::canUseFastGetOwnProperty(structure)) {</span>
<span class="udiff-line-added">+                 RefPtr&lt;AtomStringImpl&gt; existingAtomString = asString(property)-&gt;toExistingAtomString(globalObject);</span>
<span class="udiff-line-added">+                 RETURN_IF_EXCEPTION(scope, encodedJSValue());</span>
<span class="udiff-line-added">+                 if (existingAtomString) {</span>
<span class="udiff-line-added">+                     if (JSValue result = base-&gt;fastGetOwnProperty(vm, structure, existingAtomString.get()))</span>
<span class="udiff-line-added">+                         return JSValue::encode(result);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
      }
  
<span class="udiff-line-modified-removed">-     RELEASE_AND_RETURN(scope, JSValue::encode(getByVal(exec, baseValue, subscript, byValInfo, returnAddress)));</span>
<span class="udiff-line-modified-added">+     baseValue.requireObjectCoercible(globalObject);</span>
<span class="udiff-line-added">+     RETURN_IF_EXCEPTION(scope, encodedJSValue());</span>
<span class="udiff-line-added">+     auto propertyName = property.toPropertyKey(globalObject);</span>
<span class="udiff-line-added">+     RETURN_IF_EXCEPTION(scope, encodedJSValue());</span>
<span class="udiff-line-added">+     RELEASE_AND_RETURN(scope, JSValue::encode(baseValue.get(globalObject, propertyName)));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationHasIndexedPropertyDefault(ExecState* exec, EncodedJSValue encodedBase, EncodedJSValue encodedSubscript, ByValInfo* byValInfo)</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+ EncodedJSValue JIT_OPERATION operationHasIndexedPropertyDefault(JSGlobalObject* globalObject, EncodedJSValue encodedBase, EncodedJSValue encodedSubscript, ByValInfo* byValInfo)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      JSValue baseValue = JSValue::decode(encodedBase);
      JSValue subscript = JSValue::decode(encodedSubscript);
  
      ASSERT(baseValue.isObject());
      ASSERT(subscript.isUInt32AsAnyInt());
  
      JSObject* object = asObject(baseValue);
      bool didOptimize = false;
  
<span class="udiff-line-modified-removed">-     ASSERT(exec-&gt;bytecodeOffset());</span>
<span class="udiff-line-modified-added">+     ASSERT(callFrame-&gt;bytecodeIndex() != BytecodeIndex(0));</span>
      ASSERT(!byValInfo-&gt;stubRoutine);
  
      if (hasOptimizableIndexing(object-&gt;structure(vm))) {
          // Attempt to optimize.
          JITArrayMode arrayMode = jitArrayModeForStructure(object-&gt;structure(vm));
          if (arrayMode != byValInfo-&gt;arrayMode) {
<span class="udiff-line-modified-removed">-             JIT::compileHasIndexedProperty(vm, exec-&gt;codeBlock(), byValInfo, ReturnAddressPtr(OUR_RETURN_ADDRESS), arrayMode);</span>
<span class="udiff-line-modified-added">+             JIT::compileHasIndexedProperty(vm, callFrame-&gt;codeBlock(), byValInfo, ReturnAddressPtr(OUR_RETURN_ADDRESS), arrayMode);</span>
              didOptimize = true;
          }
      }
  
      if (!didOptimize) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2059,17 +2116,18 @@</span>
      if (object-&gt;canGetIndexQuickly(index))
          return JSValue::encode(JSValue(JSValue::JSTrue));
  
      if (!CommonSlowPaths::canAccessArgumentIndexQuickly(*object, index))
          byValInfo-&gt;arrayProfile-&gt;setOutOfBounds();
<span class="udiff-line-modified-removed">-     return JSValue::encode(jsBoolean(object-&gt;hasPropertyGeneric(exec, index, PropertySlot::InternalMethodType::GetOwnProperty)));</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(jsBoolean(object-&gt;hasPropertyGeneric(globalObject, index, PropertySlot::InternalMethodType::GetOwnProperty)));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationHasIndexedPropertyGeneric(ExecState* exec, EncodedJSValue encodedBase, EncodedJSValue encodedSubscript, ByValInfo* byValInfo)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationHasIndexedPropertyGeneric(JSGlobalObject* globalObject, EncodedJSValue encodedBase, EncodedJSValue encodedSubscript, ByValInfo* byValInfo)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      JSValue baseValue = JSValue::decode(encodedBase);
      JSValue subscript = JSValue::decode(encodedSubscript);
  
      ASSERT(baseValue.isObject());
      ASSERT(subscript.isUInt32AsAnyInt());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2079,221 +2137,223 @@</span>
      if (object-&gt;canGetIndexQuickly(index))
          return JSValue::encode(JSValue(JSValue::JSTrue));
  
      if (!CommonSlowPaths::canAccessArgumentIndexQuickly(*object, index))
          byValInfo-&gt;arrayProfile-&gt;setOutOfBounds();
<span class="udiff-line-modified-removed">-     return JSValue::encode(jsBoolean(object-&gt;hasPropertyGeneric(exec, index, PropertySlot::InternalMethodType::GetOwnProperty)));</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(jsBoolean(object-&gt;hasPropertyGeneric(globalObject, index, PropertySlot::InternalMethodType::GetOwnProperty)));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetByValString(ExecState* exec, EncodedJSValue encodedBase, EncodedJSValue encodedSubscript, ByValInfo* byValInfo)</span>
<span class="udiff-line-modified-added">+ static bool deleteById(JSGlobalObject* globalObject, CallFrame* callFrame, VM&amp; vm, JSValue base, UniquedStringImpl* uid)</span>
  {
<span class="udiff-line-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="udiff-line-removed">-     JSValue baseValue = JSValue::decode(encodedBase);</span>
<span class="udiff-line-removed">-     JSValue subscript = JSValue::decode(encodedSubscript);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     JSValue result;</span>
<span class="udiff-line-removed">-     if (LIKELY(subscript.isUInt32())) {</span>
<span class="udiff-line-removed">-         uint32_t i = subscript.asUInt32();</span>
<span class="udiff-line-removed">-         if (isJSString(baseValue) &amp;&amp; asString(baseValue)-&gt;canGetIndex(i))</span>
<span class="udiff-line-removed">-             RELEASE_AND_RETURN(scope, JSValue::encode(asString(baseValue)-&gt;getIndex(exec, i)));</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         result = baseValue.get(exec, i);</span>
<span class="udiff-line-removed">-         RETURN_IF_EXCEPTION(scope, encodedJSValue());</span>
<span class="udiff-line-removed">-         if (!isJSString(baseValue)) {</span>
<span class="udiff-line-removed">-             ASSERT(exec-&gt;bytecodeOffset());</span>
<span class="udiff-line-removed">-             auto getByValFunction = byValInfo-&gt;stubRoutine ? operationGetByValGeneric : operationGetByValOptimize;</span>
<span class="udiff-line-removed">-             ctiPatchCallByReturnAddress(ReturnAddressPtr(OUR_RETURN_ADDRESS), getByValFunction);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     } else {</span>
<span class="udiff-line-removed">-         baseValue.requireObjectCoercible(exec);</span>
<span class="udiff-line-removed">-         RETURN_IF_EXCEPTION(scope, encodedJSValue());</span>
<span class="udiff-line-removed">-         auto property = subscript.toPropertyKey(exec);</span>
<span class="udiff-line-removed">-         RETURN_IF_EXCEPTION(scope, encodedJSValue());</span>
<span class="udiff-line-removed">-         scope.release();</span>
<span class="udiff-line-removed">-         result = baseValue.get(exec, property);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return JSValue::encode(result);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- EncodedJSValue JIT_OPERATION operationDeleteByIdJSResult(ExecState* exec, EncodedJSValue base, UniquedStringImpl* uid)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return JSValue::encode(jsBoolean(operationDeleteById(exec, base, uid)));</span>
<span class="udiff-line-removed">- }</span>
  
<span class="udiff-line-modified-removed">- size_t JIT_OPERATION operationDeleteById(ExecState* exec, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-removed">-     auto scope = DECLARE_THROW_SCOPE(vm);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     JSObject* baseObj = JSValue::decode(encodedBase).toObject(exec);</span>
<span class="udiff-line-modified-added">+     JSObject* baseObj = base.toObject(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, false);
      if (!baseObj)
          return false;
<span class="udiff-line-modified-removed">-     bool couldDelete = baseObj-&gt;methodTable(vm)-&gt;deleteProperty(baseObj, exec, Identifier::fromUid(vm, uid));</span>
<span class="udiff-line-modified-added">+     bool couldDelete = baseObj-&gt;methodTable(vm)-&gt;deleteProperty(baseObj, globalObject, Identifier::fromUid(vm, uid));</span>
      RETURN_IF_EXCEPTION(scope, false);
<span class="udiff-line-modified-removed">-     if (!couldDelete &amp;&amp; exec-&gt;codeBlock()-&gt;isStrictMode())</span>
<span class="udiff-line-modified-removed">-         throwTypeError(exec, scope, UnableToDeletePropertyError);</span>
<span class="udiff-line-modified-added">+     if (!couldDelete &amp;&amp; callFrame-&gt;codeBlock()-&gt;isStrictMode())</span>
<span class="udiff-line-modified-added">+         throwTypeError(globalObject, scope, UnableToDeletePropertyError);</span>
      return couldDelete;
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationDeleteByValJSResult(ExecState* exec, EncodedJSValue base,  EncodedJSValue key)</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+ EncodedJSValue JIT_OPERATION operationDeleteByIdJSResult(JSGlobalObject* globalObject, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return JSValue::encode(jsBoolean(deleteById(globalObject, callFrame, vm, JSValue::decode(encodedBase), uid)));</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ size_t JIT_OPERATION operationDeleteById(JSGlobalObject* globalObject, EncodedJSValue encodedBase, UniquedStringImpl* uid)</span>
  {
<span class="udiff-line-modified-removed">-     return JSValue::encode(jsBoolean(operationDeleteByVal(exec, base, key)));</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return deleteById(globalObject, callFrame, vm, JSValue::decode(encodedBase), uid);</span>
  }
  
<span class="udiff-line-modified-removed">- size_t JIT_OPERATION operationDeleteByVal(ExecState* exec, EncodedJSValue encodedBase, EncodedJSValue encodedKey)</span>
<span class="udiff-line-modified-added">+ static bool deleteByVal(JSGlobalObject* globalObject, CallFrame* callFrame, VM&amp; vm, JSValue base, JSValue key)</span>
  {
<span class="udiff-line-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     JSObject* baseObj = JSValue::decode(encodedBase).toObject(exec);</span>
<span class="udiff-line-modified-added">+     JSObject* baseObj = base.toObject(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, false);
<span class="udiff-line-removed">-     JSValue key = JSValue::decode(encodedKey);</span>
      if (!baseObj)
          return false;
  
      bool couldDelete;
      uint32_t index;
      if (key.getUInt32(index))
<span class="udiff-line-modified-removed">-         couldDelete = baseObj-&gt;methodTable(vm)-&gt;deletePropertyByIndex(baseObj, exec, index);</span>
<span class="udiff-line-modified-added">+         couldDelete = baseObj-&gt;methodTable(vm)-&gt;deletePropertyByIndex(baseObj, globalObject, index);</span>
      else {
<span class="udiff-line-modified-removed">-         Identifier property = key.toPropertyKey(exec);</span>
<span class="udiff-line-modified-added">+         Identifier property = key.toPropertyKey(globalObject);</span>
          RETURN_IF_EXCEPTION(scope, false);
<span class="udiff-line-modified-removed">-         couldDelete = baseObj-&gt;methodTable(vm)-&gt;deleteProperty(baseObj, exec, property);</span>
<span class="udiff-line-modified-added">+         couldDelete = baseObj-&gt;methodTable(vm)-&gt;deleteProperty(baseObj, globalObject, property);</span>
      }
      RETURN_IF_EXCEPTION(scope, false);
<span class="udiff-line-modified-removed">-     if (!couldDelete &amp;&amp; exec-&gt;codeBlock()-&gt;isStrictMode())</span>
<span class="udiff-line-modified-removed">-         throwTypeError(exec, scope, UnableToDeletePropertyError);</span>
<span class="udiff-line-modified-added">+     if (!couldDelete &amp;&amp; callFrame-&gt;codeBlock()-&gt;isStrictMode())</span>
<span class="udiff-line-modified-added">+         throwTypeError(globalObject, scope, UnableToDeletePropertyError);</span>
      return couldDelete;
  }
  
<span class="udiff-line-modified-removed">- JSCell* JIT_OPERATION operationPushWithScope(ExecState* exec, JSCell* currentScopeCell, EncodedJSValue objectValue)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationDeleteByValJSResult(JSGlobalObject* globalObject, EncodedJSValue encodedBase,  EncodedJSValue encodedKey)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return JSValue::encode(jsBoolean(deleteByVal(globalObject, callFrame, vm, JSValue::decode(encodedBase), JSValue::decode(encodedKey))));</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ size_t JIT_OPERATION operationDeleteByVal(JSGlobalObject* globalObject, EncodedJSValue encodedBase, EncodedJSValue encodedKey)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return deleteByVal(globalObject, callFrame, vm, JSValue::decode(encodedBase), JSValue::decode(encodedKey));</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JSCell* JIT_OPERATION operationPushWithScope(JSGlobalObject* globalObject, JSCell* currentScopeCell, EncodedJSValue objectValue)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     JSObject* object = JSValue::decode(objectValue).toObject(exec);</span>
<span class="udiff-line-modified-added">+     JSObject* object = JSValue::decode(objectValue).toObject(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, nullptr);
  
      JSScope* currentScope = jsCast&lt;JSScope*&gt;(currentScopeCell);
  
<span class="udiff-line-modified-removed">-     return JSWithScope::create(vm, exec-&gt;lexicalGlobalObject(), currentScope, object);</span>
<span class="udiff-line-modified-added">+     return JSWithScope::create(vm, globalObject, currentScope, object);</span>
  }
  
<span class="udiff-line-modified-removed">- JSCell* JIT_OPERATION operationPushWithScopeObject(ExecState* exec, JSCell* currentScopeCell, JSObject* object)</span>
<span class="udiff-line-modified-added">+ JSCell* JIT_OPERATION operationPushWithScopeObject(JSGlobalObject* globalObject, JSCell* currentScopeCell, JSObject* object)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      JSScope* currentScope = jsCast&lt;JSScope*&gt;(currentScopeCell);
<span class="udiff-line-modified-removed">-     return JSWithScope::create(vm, exec-&gt;lexicalGlobalObject(), currentScope, object);</span>
<span class="udiff-line-modified-added">+     return JSWithScope::create(vm, globalObject, currentScope, object);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationInstanceOf(ExecState* exec, EncodedJSValue encodedValue, EncodedJSValue encodedProto)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationInstanceOf(JSGlobalObject* globalObject, EncodedJSValue encodedValue, EncodedJSValue encodedProto)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      JSValue value = JSValue::decode(encodedValue);
      JSValue proto = JSValue::decode(encodedProto);
  
<span class="udiff-line-modified-removed">-     bool result = JSObject::defaultHasInstance(exec, value, proto);</span>
<span class="udiff-line-modified-added">+     bool result = JSObject::defaultHasInstance(globalObject, value, proto);</span>
      return JSValue::encode(jsBoolean(result));
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationInstanceOfGeneric(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedProto)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationInstanceOfGeneric(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedProto)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      JSValue value = JSValue::decode(encodedValue);
      JSValue proto = JSValue::decode(encodedProto);
  
      stubInfo-&gt;tookSlowPath = true;
  
<span class="udiff-line-modified-removed">-     bool result = JSObject::defaultHasInstance(exec, value, proto);</span>
<span class="udiff-line-modified-added">+     bool result = JSObject::defaultHasInstance(globalObject, value, proto);</span>
      return JSValue::encode(jsBoolean(result));
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationInstanceOfOptimize(ExecState* exec, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedProto)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationInstanceOfOptimize(JSGlobalObject* globalObject, StructureStubInfo* stubInfo, EncodedJSValue encodedValue, EncodedJSValue encodedProto)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      JSValue value = JSValue::decode(encodedValue);
      JSValue proto = JSValue::decode(encodedProto);
  
<span class="udiff-line-modified-removed">-     bool result = JSObject::defaultHasInstance(exec, value, proto);</span>
<span class="udiff-line-modified-added">+     bool result = JSObject::defaultHasInstance(globalObject, value, proto);</span>
      RETURN_IF_EXCEPTION(scope, JSValue::encode(jsUndefined()));
  
<span class="udiff-line-modified-removed">-     if (stubInfo-&gt;considerCaching(vm, exec-&gt;codeBlock(), value.structureOrNull()))</span>
<span class="udiff-line-modified-removed">-         repatchInstanceOf(exec, value, proto, *stubInfo, result);</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     if (stubInfo-&gt;considerCaching(vm, codeBlock, value.structureOrNull()))</span>
<span class="udiff-line-added">+         repatchInstanceOf(globalObject, codeBlock, value, proto, *stubInfo, result);</span>
  
      return JSValue::encode(jsBoolean(result));
  }
  
<span class="udiff-line-modified-removed">- int32_t JIT_OPERATION operationSizeFrameForForwardArguments(ExecState* exec, EncodedJSValue, int32_t numUsedStackSlots, int32_t)</span>
<span class="udiff-line-modified-added">+ int32_t JIT_OPERATION operationSizeFrameForForwardArguments(JSGlobalObject* globalObject, EncodedJSValue, int32_t numUsedStackSlots, int32_t)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-removed">-     return sizeFrameForForwardArguments(exec, vm, numUsedStackSlots);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-modified-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return sizeFrameForForwardArguments(globalObject, callFrame, vm, numUsedStackSlots);</span>
  }
  
<span class="udiff-line-modified-removed">- int32_t JIT_OPERATION operationSizeFrameForVarargs(ExecState* exec, EncodedJSValue encodedArguments, int32_t numUsedStackSlots, int32_t firstVarArgOffset)</span>
<span class="udiff-line-modified-added">+ int32_t JIT_OPERATION operationSizeFrameForVarargs(JSGlobalObject* globalObject, EncodedJSValue encodedArguments, int32_t numUsedStackSlots, int32_t firstVarArgOffset)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      JSValue arguments = JSValue::decode(encodedArguments);
<span class="udiff-line-modified-removed">-     return sizeFrameForVarargs(exec, vm, arguments, numUsedStackSlots, firstVarArgOffset);</span>
<span class="udiff-line-modified-added">+     return sizeFrameForVarargs(globalObject, callFrame, vm, arguments, numUsedStackSlots, firstVarArgOffset);</span>
  }
  
<span class="udiff-line-modified-removed">- CallFrame* JIT_OPERATION operationSetupForwardArgumentsFrame(ExecState* exec, CallFrame* newCallFrame, EncodedJSValue, int32_t, int32_t length)</span>
<span class="udiff-line-modified-added">+ CallFrame* JIT_OPERATION operationSetupForwardArgumentsFrame(JSGlobalObject* globalObject, CallFrame* newCallFrame, EncodedJSValue, int32_t, int32_t length)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-removed">-     setupForwardArgumentsFrame(exec, newCallFrame, length);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-modified-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     setupForwardArgumentsFrame(globalObject, callFrame, newCallFrame, length);</span>
      return newCallFrame;
  }
  
<span class="udiff-line-modified-removed">- CallFrame* JIT_OPERATION operationSetupVarargsFrame(ExecState* exec, CallFrame* newCallFrame, EncodedJSValue encodedArguments, int32_t firstVarArgOffset, int32_t length)</span>
<span class="udiff-line-modified-added">+ CallFrame* JIT_OPERATION operationSetupVarargsFrame(JSGlobalObject* globalObject, CallFrame* newCallFrame, EncodedJSValue encodedArguments, int32_t firstVarArgOffset, int32_t length)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      JSValue arguments = JSValue::decode(encodedArguments);
<span class="udiff-line-modified-removed">-     setupVarargsFrame(exec, newCallFrame, arguments, firstVarArgOffset, length);</span>
<span class="udiff-line-modified-added">+     setupVarargsFrame(globalObject, callFrame, newCallFrame, arguments, firstVarArgOffset, length);</span>
      return newCallFrame;
  }
  
<span class="udiff-line-modified-removed">- char* JIT_OPERATION operationSwitchCharWithUnknownKeyType(ExecState* exec, EncodedJSValue encodedKey, size_t tableIndex)</span>
<span class="udiff-line-modified-added">+ char* JIT_OPERATION operationSwitchCharWithUnknownKeyType(JSGlobalObject* globalObject, EncodedJSValue encodedKey, size_t tableIndex)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     auto throwScope = DECLARE_THROW_SCOPE(vm);</span>
<span class="udiff-line-added">+ </span>
      JSValue key = JSValue::decode(encodedKey);
<span class="udiff-line-modified-removed">-     CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
  
      SimpleJumpTable&amp; jumpTable = codeBlock-&gt;switchJumpTable(tableIndex);
      void* result = jumpTable.ctiDefault.executableAddress();
  
      if (key.isString()) {
<span class="udiff-line-modified-removed">-         StringImpl* value = asString(key)-&gt;value(exec).impl();</span>
<span class="udiff-line-modified-removed">-         if (value-&gt;length() == 1)</span>
<span class="udiff-line-modified-removed">-             result = jumpTable.ctiForValue((*value)[0]).executableAddress();</span>
<span class="udiff-line-modified-added">+         JSString* string = asString(key);</span>
<span class="udiff-line-modified-added">+         if (string-&gt;length() == 1) {</span>
<span class="udiff-line-modified-added">+             String value = string-&gt;value(globalObject);</span>
<span class="udiff-line-added">+             RETURN_IF_EXCEPTION(throwScope, nullptr);</span>
<span class="udiff-line-added">+             result = jumpTable.ctiForValue(value[0]).executableAddress();</span>
<span class="udiff-line-added">+         }</span>
      }
  
      assertIsTaggedWith(result, JSSwitchPtrTag);
      return reinterpret_cast&lt;char*&gt;(result);
  }
  
<span class="udiff-line-modified-removed">- char* JIT_OPERATION operationSwitchImmWithUnknownKeyType(ExecState* exec, EncodedJSValue encodedKey, size_t tableIndex)</span>
<span class="udiff-line-modified-added">+ char* JIT_OPERATION operationSwitchImmWithUnknownKeyType(VM* vmPointer, EncodedJSValue encodedKey, size_t tableIndex)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      JSValue key = JSValue::decode(encodedKey);
<span class="udiff-line-modified-removed">-     CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
  
      SimpleJumpTable&amp; jumpTable = codeBlock-&gt;switchJumpTable(tableIndex);
      void* result;
      if (key.isInt32())
          result = jumpTable.ctiForValue(key.asInt32()).executableAddress();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2303,23 +2363,24 @@</span>
          result = jumpTable.ctiDefault.executableAddress();
      assertIsTaggedWith(result, JSSwitchPtrTag);
      return reinterpret_cast&lt;char*&gt;(result);
  }
  
<span class="udiff-line-modified-removed">- char* JIT_OPERATION operationSwitchStringWithUnknownKeyType(ExecState* exec, EncodedJSValue encodedKey, size_t tableIndex)</span>
<span class="udiff-line-modified-added">+ char* JIT_OPERATION operationSwitchStringWithUnknownKeyType(JSGlobalObject* globalObject, EncodedJSValue encodedKey, size_t tableIndex)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      JSValue key = JSValue::decode(encodedKey);
<span class="udiff-line-modified-removed">-     CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
      auto throwScope = DECLARE_THROW_SCOPE(vm);
  
      void* result;
      StringJumpTable&amp; jumpTable = codeBlock-&gt;stringSwitchJumpTable(tableIndex);
  
      if (key.isString()) {
<span class="udiff-line-modified-removed">-         StringImpl* value = asString(key)-&gt;value(exec).impl();</span>
<span class="udiff-line-modified-added">+         StringImpl* value = asString(key)-&gt;value(globalObject).impl();</span>
  
          RETURN_IF_EXCEPTION(throwScope, nullptr);
  
          result = jumpTable.ctiForValue(value).executableAddress();
      } else
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2327,64 +2388,66 @@</span>
  
      assertIsTaggedWith(result, JSSwitchPtrTag);
      return reinterpret_cast&lt;char*&gt;(result);
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationGetFromScope(ExecState* exec, const Instruction* pc)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationGetFromScope(JSGlobalObject* globalObject, const Instruction* pc)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto throwScope = DECLARE_THROW_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
  
      auto bytecode = pc-&gt;as&lt;OpGetFromScope&gt;();
      const Identifier&amp; ident = codeBlock-&gt;identifier(bytecode.m_var);
<span class="udiff-line-modified-removed">-     JSObject* scope = jsCast&lt;JSObject*&gt;(exec-&gt;uncheckedR(bytecode.m_scope.offset()).jsValue());</span>
<span class="udiff-line-modified-added">+     JSObject* scope = jsCast&lt;JSObject*&gt;(callFrame-&gt;uncheckedR(bytecode.m_scope).jsValue());</span>
      GetPutInfo&amp; getPutInfo = bytecode.metadata(codeBlock).m_getPutInfo;
  
      // ModuleVar is always converted to ClosureVar for get_from_scope.
      ASSERT(getPutInfo.resolveType() != ModuleVar);
  
<span class="udiff-line-modified-removed">-     RELEASE_AND_RETURN(throwScope, JSValue::encode(scope-&gt;getPropertySlot(exec, ident, [&amp;] (bool found, PropertySlot&amp; slot) -&gt; JSValue {</span>
<span class="udiff-line-modified-added">+     RELEASE_AND_RETURN(throwScope, JSValue::encode(scope-&gt;getPropertySlot(globalObject, ident, [&amp;] (bool found, PropertySlot&amp; slot) -&gt; JSValue {</span>
          if (!found) {
              if (getPutInfo.resolveMode() == ThrowIfNotFound)
<span class="udiff-line-modified-removed">-                 throwException(exec, throwScope, createUndefinedVariableError(exec, ident));</span>
<span class="udiff-line-modified-added">+                 throwException(globalObject, throwScope, createUndefinedVariableError(globalObject, ident));</span>
              return jsUndefined();
          }
  
          JSValue result = JSValue();
          if (scope-&gt;isGlobalLexicalEnvironment()) {
              // When we can&#39;t statically prove we need a TDZ check, we must perform the check on the slow path.
<span class="udiff-line-modified-removed">-             result = slot.getValue(exec, ident);</span>
<span class="udiff-line-modified-added">+             result = slot.getValue(globalObject, ident);</span>
              if (result == jsTDZValue()) {
<span class="udiff-line-modified-removed">-                 throwException(exec, throwScope, createTDZError(exec));</span>
<span class="udiff-line-modified-added">+                 throwException(globalObject, throwScope, createTDZError(globalObject));</span>
                  return jsUndefined();
              }
          }
  
<span class="udiff-line-modified-removed">-         CommonSlowPaths::tryCacheGetFromScopeGlobal(exec, vm, bytecode, scope, slot, ident);</span>
<span class="udiff-line-modified-added">+         CommonSlowPaths::tryCacheGetFromScopeGlobal(globalObject, codeBlock, vm, bytecode, scope, slot, ident);</span>
  
          if (!result)
<span class="udiff-line-modified-removed">-             return slot.getValue(exec, ident);</span>
<span class="udiff-line-modified-added">+             return slot.getValue(globalObject, ident);</span>
          return result;
      })));
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationPutToScope(ExecState* exec, const Instruction* pc)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationPutToScope(JSGlobalObject* globalObject, const Instruction* pc)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto throwScope = DECLARE_THROW_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     CodeBlock* codeBlock = exec-&gt;codeBlock();</span>
<span class="udiff-line-modified-added">+     CodeBlock* codeBlock = callFrame-&gt;codeBlock();</span>
      auto bytecode = pc-&gt;as&lt;OpPutToScope&gt;();
      auto&amp; metadata = bytecode.metadata(codeBlock);
  
      const Identifier&amp; ident = codeBlock-&gt;identifier(bytecode.m_var);
<span class="udiff-line-modified-removed">-     JSObject* scope = jsCast&lt;JSObject*&gt;(exec-&gt;uncheckedR(bytecode.m_scope.offset()).jsValue());</span>
<span class="udiff-line-modified-removed">-     JSValue value = exec-&gt;r(bytecode.m_value.offset()).jsValue();</span>
<span class="udiff-line-modified-added">+     JSObject* scope = jsCast&lt;JSObject*&gt;(callFrame-&gt;uncheckedR(bytecode.m_scope).jsValue());</span>
<span class="udiff-line-modified-added">+     JSValue value = callFrame-&gt;r(bytecode.m_value).jsValue();</span>
      GetPutInfo&amp; getPutInfo = metadata.m_getPutInfo;
  
      // ModuleVar does not keep the scope register value alive in DFG.
      ASSERT(getPutInfo.resolveType() != ModuleVar);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2394,561 +2457,569 @@</span>
          if (WatchpointSet* set = metadata.m_watchpointSet)
              set-&gt;touch(vm, &quot;Executed op_put_scope&lt;LocalClosureVar&gt;&quot;);
          return;
      }
  
<span class="udiff-line-modified-removed">-     bool hasProperty = scope-&gt;hasProperty(exec, ident);</span>
<span class="udiff-line-modified-added">+     bool hasProperty = scope-&gt;hasProperty(globalObject, ident);</span>
      RETURN_IF_EXCEPTION(throwScope, void());
      if (hasProperty
          &amp;&amp; scope-&gt;isGlobalLexicalEnvironment()
          &amp;&amp; !isInitialization(getPutInfo.initializationMode())) {
          // When we can&#39;t statically prove we need a TDZ check, we must perform the check on the slow path.
          PropertySlot slot(scope, PropertySlot::InternalMethodType::Get);
<span class="udiff-line-modified-removed">-         JSGlobalLexicalEnvironment::getOwnPropertySlot(scope, exec, ident, slot);</span>
<span class="udiff-line-modified-removed">-         if (slot.getValue(exec, ident) == jsTDZValue()) {</span>
<span class="udiff-line-modified-removed">-             throwException(exec, throwScope, createTDZError(exec));</span>
<span class="udiff-line-modified-added">+         JSGlobalLexicalEnvironment::getOwnPropertySlot(scope, globalObject, ident, slot);</span>
<span class="udiff-line-modified-added">+         if (slot.getValue(globalObject, ident) == jsTDZValue()) {</span>
<span class="udiff-line-modified-added">+             throwException(globalObject, throwScope, createTDZError(globalObject));</span>
              return;
          }
      }
  
      if (getPutInfo.resolveMode() == ThrowIfNotFound &amp;&amp; !hasProperty) {
<span class="udiff-line-modified-removed">-         throwException(exec, throwScope, createUndefinedVariableError(exec, ident));</span>
<span class="udiff-line-modified-added">+         throwException(globalObject, throwScope, createUndefinedVariableError(globalObject, ident));</span>
          return;
      }
  
      PutPropertySlot slot(scope, codeBlock-&gt;isStrictMode(), PutPropertySlot::UnknownContext, isInitialization(getPutInfo.initializationMode()));
<span class="udiff-line-modified-removed">-     scope-&gt;methodTable(vm)-&gt;put(scope, exec, ident, value, slot);</span>
<span class="udiff-line-modified-added">+     scope-&gt;methodTable(vm)-&gt;put(scope, globalObject, ident, value, slot);</span>
  
      RETURN_IF_EXCEPTION(throwScope, void());
  
<span class="udiff-line-modified-removed">-     CommonSlowPaths::tryCachePutToScopeGlobal(exec, codeBlock, bytecode, scope, slot, ident);</span>
<span class="udiff-line-modified-added">+     CommonSlowPaths::tryCachePutToScopeGlobal(globalObject, codeBlock, bytecode, scope, slot, ident);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationThrow(ExecState* exec, EncodedJSValue encodedExceptionValue)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationThrow(JSGlobalObject* globalObject, EncodedJSValue encodedExceptionValue)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      JSValue exceptionValue = JSValue::decode(encodedExceptionValue);
<span class="udiff-line-modified-removed">-     throwException(exec, scope, exceptionValue);</span>
<span class="udiff-line-modified-added">+     throwException(globalObject, scope, exceptionValue);</span>
  
      // Results stored out-of-band in vm.targetMachinePCForThrow &amp; vm.callFrameForCatch
<span class="udiff-line-modified-removed">-     genericUnwind(vm, exec);</span>
<span class="udiff-line-modified-added">+     genericUnwind(vm, callFrame);</span>
  }
  
<span class="udiff-line-modified-removed">- char* JIT_OPERATION operationReallocateButterflyToHavePropertyStorageWithInitialCapacity(ExecState* exec, JSObject* object)</span>
<span class="udiff-line-modified-added">+ char* JIT_OPERATION operationReallocateButterflyToHavePropertyStorageWithInitialCapacity(VM* vmPointer, JSObject* object)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      ASSERT(!object-&gt;structure(vm)-&gt;outOfLineCapacity());
      Butterfly* result = object-&gt;allocateMoreOutOfLineStorage(vm, 0, initialOutOfLineCapacity);
      object-&gt;nukeStructureAndSetButterfly(vm, object-&gt;structureID(), result);
      return reinterpret_cast&lt;char*&gt;(result);
  }
  
<span class="udiff-line-modified-removed">- char* JIT_OPERATION operationReallocateButterflyToGrowPropertyStorage(ExecState* exec, JSObject* object, size_t newSize)</span>
<span class="udiff-line-modified-added">+ char* JIT_OPERATION operationReallocateButterflyToGrowPropertyStorage(VM* vmPointer, JSObject* object, size_t newSize)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      Butterfly* result = object-&gt;allocateMoreOutOfLineStorage(vm, object-&gt;structure(vm)-&gt;outOfLineCapacity(), newSize);
      object-&gt;nukeStructureAndSetButterfly(vm, object-&gt;structureID(), result);
      return reinterpret_cast&lt;char*&gt;(result);
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationOSRWriteBarrier(ExecState* exec, JSCell* cell)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationOSRWriteBarrier(VM* vmPointer, JSCell* cell)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      vm.heap.writeBarrier(cell);
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationWriteBarrierSlowPath(ExecState* exec, JSCell* cell)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationWriteBarrierSlowPath(VM* vmPointer, JSCell* cell)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      vm.heap.writeBarrierSlowPath(cell);
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION lookupExceptionHandler(VM* vmPointer, ExecState* exec)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationLookupExceptionHandler(VM* vmPointer)</span>
  {
      VM&amp; vm = *vmPointer;
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-removed">-     genericUnwind(vm, exec);</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-modified-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     genericUnwind(vm, callFrame);</span>
      ASSERT(vm.targetMachinePCForThrow);
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION lookupExceptionHandlerFromCallerFrame(VM* vm, ExecState* exec)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationLookupExceptionHandlerFromCallerFrame(VM* vmPointer)</span>
  {
<span class="udiff-line-modified-removed">-     ASSERT(exec-&gt;isStackOverflowFrame());</span>
<span class="udiff-line-modified-removed">-     ASSERT(jsCast&lt;ErrorInstance*&gt;(vm-&gt;exceptionForInspection()-&gt;value().asCell())-&gt;isStackOverflowError());</span>
<span class="udiff-line-modified-removed">-     lookupExceptionHandler(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-modified-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     ASSERT(callFrame-&gt;isStackOverflowFrame());</span>
<span class="udiff-line-added">+     ASSERT(jsCast&lt;ErrorInstance*&gt;(vm.exceptionForInspection()-&gt;value().asCell())-&gt;isStackOverflowError());</span>
<span class="udiff-line-added">+     genericUnwind(vm, callFrame);</span>
<span class="udiff-line-added">+     ASSERT(vm.targetMachinePCForThrow);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationVMHandleException(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationVMHandleException(VM* vmPointer)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-removed">-     genericUnwind(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-modified-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     genericUnwind(vm, callFrame);</span>
  }
  
<span class="udiff-line-modified-removed">- // This function &quot;should&quot; just take the ExecState*, but doing so would make it more difficult</span>
<span class="udiff-line-modified-added">+ // This function &quot;should&quot; just take the JSGlobalObject*, but doing so would make it more difficult</span>
  // to call from exception check sites. So, unlike all of our other functions, we allow
  // ourselves to play some gnarly ABI tricks just to simplify the calling convention. This is
  // particularly safe here since this is never called on the critical path - it&#39;s only for
  // testing.
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationExceptionFuzz(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationExceptionFuzz(JSGlobalObject* globalObject)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      UNUSED_PARAM(scope);
  #if COMPILER(GCC_COMPATIBLE)
      void* returnPC = __builtin_return_address(0);
<span class="udiff-line-modified-removed">-     doExceptionFuzzing(exec, scope, &quot;JITOperations&quot;, returnPC);</span>
<span class="udiff-line-modified-added">+     doExceptionFuzzing(globalObject, scope, &quot;JITOperations&quot;, returnPC);</span>
  #endif // COMPILER(GCC_COMPATIBLE)
  }
  
<span class="udiff-line-modified-removed">- ALWAYS_INLINE static EncodedJSValue unprofiledAdd(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueAdd(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-     JSValue op1 = JSValue::decode(encodedOp1);</span>
<span class="udiff-line-removed">-     JSValue op2 = JSValue::decode(encodedOp2);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return JSValue::encode(jsAdd(exec, op1, op2));</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-modified-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(jsAdd(globalObject, JSValue::decode(encodedOp1), JSValue::decode(encodedOp2)));</span>
  }
  
<span class="udiff-line-modified-removed">- ALWAYS_INLINE static EncodedJSValue profiledAdd(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, ArithProfile&amp; arithProfile)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     JSValue op1 = JSValue::decode(encodedOp1);</span>
<span class="udiff-line-removed">-     JSValue op2 = JSValue::decode(encodedOp2);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     arithProfile.observeLHSAndRHS(op1, op2);</span>
<span class="udiff-line-removed">-     JSValue result = jsAdd(exec, op1, op2);</span>
<span class="udiff-line-removed">-     arithProfile.observeResult(result);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return JSValue::encode(result);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- EncodedJSValue JIT_OPERATION operationValueAdd(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return unprofiledAdd(exec, encodedOp1, encodedOp2);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- EncodedJSValue JIT_OPERATION operationValueAddProfiled(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, ArithProfile* arithProfile)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueAddProfiled(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, BinaryArithProfile* arithProfile)</span>
  {
      ASSERT(arithProfile);
<span class="udiff-line-modified-removed">-     return profiledAdd(exec, encodedOp1, encodedOp2, *arithProfile);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return JSValue::encode(profiledAdd(globalObject, JSValue::decode(encodedOp1), JSValue::decode(encodedOp2), *arithProfile));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueAddProfiledOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITAddIC* addIC)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueAddProfiledOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITAddIC* addIC)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue op1 = JSValue::decode(encodedOp1);
      JSValue op2 = JSValue::decode(encodedOp2);
  
<span class="udiff-line-modified-removed">-     ArithProfile* arithProfile = addIC-&gt;arithProfile();</span>
<span class="udiff-line-modified-added">+     BinaryArithProfile* arithProfile = addIC-&gt;arithProfile();</span>
      ASSERT(arithProfile);
      arithProfile-&gt;observeLHSAndRHS(op1, op2);
      auto nonOptimizeVariant = operationValueAddProfiledNoOptimize;
<span class="udiff-line-modified-removed">-     addIC-&gt;generateOutOfLine(exec-&gt;codeBlock(), nonOptimizeVariant);</span>
<span class="udiff-line-modified-added">+     addIC-&gt;generateOutOfLine(callFrame-&gt;codeBlock(), nonOptimizeVariant);</span>
  
  #if ENABLE(MATH_IC_STATS)
<span class="udiff-line-modified-removed">-     exec-&gt;codeBlock()-&gt;dumpMathICStats();</span>
<span class="udiff-line-modified-added">+     callFrame-&gt;codeBlock()-&gt;dumpMathICStats();</span>
  #endif
  
<span class="udiff-line-modified-removed">-     JSValue result = jsAdd(exec, op1, op2);</span>
<span class="udiff-line-modified-added">+     JSValue result = jsAdd(globalObject, op1, op2);</span>
      arithProfile-&gt;observeResult(result);
  
      return JSValue::encode(result);
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueAddProfiledNoOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITAddIC* addIC)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueAddProfiledNoOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITAddIC* addIC)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     ArithProfile* arithProfile = addIC-&gt;arithProfile();</span>
<span class="udiff-line-modified-added">+     BinaryArithProfile* arithProfile = addIC-&gt;arithProfile();</span>
      ASSERT(arithProfile);
<span class="udiff-line-modified-removed">-     return profiledAdd(exec, encodedOp1, encodedOp2, *arithProfile);</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(profiledAdd(globalObject, JSValue::decode(encodedOp1), JSValue::decode(encodedOp2), *arithProfile));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueAddOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITAddIC* addIC)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueAddOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITAddIC* addIC)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue op1 = JSValue::decode(encodedOp1);
      JSValue op2 = JSValue::decode(encodedOp2);
  
      auto nonOptimizeVariant = operationValueAddNoOptimize;
<span class="udiff-line-modified-removed">-     if (ArithProfile* arithProfile = addIC-&gt;arithProfile())</span>
<span class="udiff-line-modified-added">+     if (BinaryArithProfile* arithProfile = addIC-&gt;arithProfile())</span>
          arithProfile-&gt;observeLHSAndRHS(op1, op2);
<span class="udiff-line-modified-removed">-     addIC-&gt;generateOutOfLine(exec-&gt;codeBlock(), nonOptimizeVariant);</span>
<span class="udiff-line-modified-added">+     addIC-&gt;generateOutOfLine(callFrame-&gt;codeBlock(), nonOptimizeVariant);</span>
  
  #if ENABLE(MATH_IC_STATS)
<span class="udiff-line-modified-removed">-     exec-&gt;codeBlock()-&gt;dumpMathICStats();</span>
<span class="udiff-line-modified-added">+     callFrame-&gt;codeBlock()-&gt;dumpMathICStats();</span>
  #endif
  
<span class="udiff-line-modified-removed">-     return JSValue::encode(jsAdd(exec, op1, op2));</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(jsAdd(globalObject, op1, op2));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueAddNoOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITAddIC*)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueAddNoOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITAddIC*)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue op1 = JSValue::decode(encodedOp1);
      JSValue op2 = JSValue::decode(encodedOp2);
  
<span class="udiff-line-modified-removed">-     JSValue result = jsAdd(exec, op1, op2);</span>
<span class="udiff-line-modified-added">+     JSValue result = jsAdd(globalObject, op1, op2);</span>
  
      return JSValue::encode(result);
  }
  
<span class="udiff-line-modified-removed">- ALWAYS_INLINE static EncodedJSValue unprofiledMul(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-modified-added">+ ALWAYS_INLINE static EncodedJSValue unprofiledMul(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
  {
      JSValue op1 = JSValue::decode(encodedOp1);
      JSValue op2 = JSValue::decode(encodedOp2);
  
<span class="udiff-line-modified-removed">-     return JSValue::encode(jsMul(exec, op1, op2));</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(jsMul(globalObject, op1, op2));</span>
  }
  
<span class="udiff-line-modified-removed">- ALWAYS_INLINE static EncodedJSValue profiledMul(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, ArithProfile&amp; arithProfile, bool shouldObserveLHSAndRHSTypes = true)</span>
<span class="udiff-line-modified-added">+ ALWAYS_INLINE static EncodedJSValue profiledMul(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, BinaryArithProfile&amp; arithProfile, bool shouldObserveLHSAndRHSTypes = true)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      JSValue op1 = JSValue::decode(encodedOp1);
      JSValue op2 = JSValue::decode(encodedOp2);
  
      if (shouldObserveLHSAndRHSTypes)
          arithProfile.observeLHSAndRHS(op1, op2);
  
<span class="udiff-line-modified-removed">-     JSValue result = jsMul(exec, op1, op2);</span>
<span class="udiff-line-modified-added">+     JSValue result = jsMul(globalObject, op1, op2);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
      arithProfile.observeResult(result);
      return JSValue::encode(result);
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueMul(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueMul(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     return unprofiledMul(exec, encodedOp1, encodedOp2);</span>
<span class="udiff-line-modified-added">+     return unprofiledMul(globalObject, encodedOp1, encodedOp2);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueMulNoOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITMulIC*)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueMulNoOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITMulIC*)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     return unprofiledMul(exec, encodedOp1, encodedOp2);</span>
<span class="udiff-line-modified-added">+     return unprofiledMul(globalObject, encodedOp1, encodedOp2);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueMulOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITMulIC* mulIC)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueMulOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITMulIC* mulIC)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      auto nonOptimizeVariant = operationValueMulNoOptimize;
<span class="udiff-line-modified-removed">-     if (ArithProfile* arithProfile = mulIC-&gt;arithProfile())</span>
<span class="udiff-line-modified-added">+     if (BinaryArithProfile* arithProfile = mulIC-&gt;arithProfile())</span>
          arithProfile-&gt;observeLHSAndRHS(JSValue::decode(encodedOp1), JSValue::decode(encodedOp2));
<span class="udiff-line-modified-removed">-     mulIC-&gt;generateOutOfLine(exec-&gt;codeBlock(), nonOptimizeVariant);</span>
<span class="udiff-line-modified-added">+     mulIC-&gt;generateOutOfLine(callFrame-&gt;codeBlock(), nonOptimizeVariant);</span>
  
  #if ENABLE(MATH_IC_STATS)
<span class="udiff-line-modified-removed">-     exec-&gt;codeBlock()-&gt;dumpMathICStats();</span>
<span class="udiff-line-modified-added">+     callFrame-&gt;codeBlock()-&gt;dumpMathICStats();</span>
  #endif
  
<span class="udiff-line-modified-removed">-     return unprofiledMul(exec, encodedOp1, encodedOp2);</span>
<span class="udiff-line-modified-added">+     return unprofiledMul(globalObject, encodedOp1, encodedOp2);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueMulProfiled(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, ArithProfile* arithProfile)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueMulProfiled(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, BinaryArithProfile* arithProfile)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      ASSERT(arithProfile);
<span class="udiff-line-modified-removed">-     return profiledMul(exec, encodedOp1, encodedOp2, *arithProfile);</span>
<span class="udiff-line-modified-added">+     return profiledMul(globalObject, encodedOp1, encodedOp2, *arithProfile);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueMulProfiledOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITMulIC* mulIC)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueMulProfiledOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITMulIC* mulIC)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     ArithProfile* arithProfile = mulIC-&gt;arithProfile();</span>
<span class="udiff-line-modified-added">+     BinaryArithProfile* arithProfile = mulIC-&gt;arithProfile();</span>
      ASSERT(arithProfile);
      arithProfile-&gt;observeLHSAndRHS(JSValue::decode(encodedOp1), JSValue::decode(encodedOp2));
      auto nonOptimizeVariant = operationValueMulProfiledNoOptimize;
<span class="udiff-line-modified-removed">-     mulIC-&gt;generateOutOfLine(exec-&gt;codeBlock(), nonOptimizeVariant);</span>
<span class="udiff-line-modified-added">+     mulIC-&gt;generateOutOfLine(callFrame-&gt;codeBlock(), nonOptimizeVariant);</span>
  
  #if ENABLE(MATH_IC_STATS)
<span class="udiff-line-modified-removed">-     exec-&gt;codeBlock()-&gt;dumpMathICStats();</span>
<span class="udiff-line-modified-added">+     callFrame-&gt;codeBlock()-&gt;dumpMathICStats();</span>
  #endif
  
<span class="udiff-line-modified-removed">-     return profiledMul(exec, encodedOp1, encodedOp2, *arithProfile, false);</span>
<span class="udiff-line-modified-added">+     return profiledMul(globalObject, encodedOp1, encodedOp2, *arithProfile, false);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueMulProfiledNoOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITMulIC* mulIC)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueMulProfiledNoOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITMulIC* mulIC)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     ArithProfile* arithProfile = mulIC-&gt;arithProfile();</span>
<span class="udiff-line-modified-added">+     BinaryArithProfile* arithProfile = mulIC-&gt;arithProfile();</span>
      ASSERT(arithProfile);
<span class="udiff-line-modified-removed">-     return profiledMul(exec, encodedOp1, encodedOp2, *arithProfile);</span>
<span class="udiff-line-modified-added">+     return profiledMul(globalObject, encodedOp1, encodedOp2, *arithProfile);</span>
  }
  
<span class="udiff-line-modified-removed">- ALWAYS_INLINE static EncodedJSValue unprofiledNegate(ExecState* exec, EncodedJSValue encodedOperand)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationArithNegate(JSGlobalObject* globalObject, EncodedJSValue encodedOperand)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue operand = JSValue::decode(encodedOperand);
  
<span class="udiff-line-modified-removed">-     JSValue primValue = operand.toPrimitive(exec, PreferNumber);</span>
<span class="udiff-line-modified-added">+     JSValue primValue = operand.toPrimitive(globalObject, PreferNumber);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      if (primValue.isBigInt())
          return JSValue::encode(JSBigInt::unaryMinus(vm, asBigInt(primValue)));
  
<span class="udiff-line-modified-removed">-     double number = primValue.toNumber(exec);</span>
<span class="udiff-line-modified-added">+     double number = primValue.toNumber(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
      return JSValue::encode(jsNumber(-number));
<span class="udiff-line-added">+ </span>
  }
  
<span class="udiff-line-modified-removed">- ALWAYS_INLINE static EncodedJSValue profiledNegate(ExecState* exec, EncodedJSValue encodedOperand, ArithProfile&amp; arithProfile)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationArithNegateProfiled(JSGlobalObject* globalObject, EncodedJSValue encodedOperand, UnaryArithProfile* arithProfile)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     ASSERT(arithProfile);</span>
<span class="udiff-line-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue operand = JSValue::decode(encodedOperand);
<span class="udiff-line-modified-removed">-     arithProfile.observeLHS(operand);</span>
<span class="udiff-line-modified-added">+     arithProfile-&gt;observeArg(operand);</span>
  
<span class="udiff-line-modified-removed">-     JSValue primValue = operand.toPrimitive(exec);</span>
<span class="udiff-line-modified-added">+     JSValue primValue = operand.toPrimitive(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      if (primValue.isBigInt()) {
          JSBigInt* result = JSBigInt::unaryMinus(vm, asBigInt(primValue));
<span class="udiff-line-modified-removed">-         arithProfile.observeResult(result);</span>
<span class="udiff-line-modified-added">+         arithProfile-&gt;observeResult(result);</span>
  
          return JSValue::encode(result);
      }
  
<span class="udiff-line-modified-removed">-     double number = primValue.toNumber(exec);</span>
<span class="udiff-line-modified-added">+     double number = primValue.toNumber(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
      JSValue result = jsNumber(-number);
<span class="udiff-line-modified-removed">-     arithProfile.observeResult(result);</span>
<span class="udiff-line-modified-added">+     arithProfile-&gt;observeResult(result);</span>
      return JSValue::encode(result);
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationArithNegate(ExecState* exec, EncodedJSValue operand)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return unprofiledNegate(exec, operand);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- EncodedJSValue JIT_OPERATION operationArithNegateProfiled(ExecState* exec, EncodedJSValue operand, ArithProfile* arithProfile)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(arithProfile);</span>
<span class="udiff-line-removed">-     return profiledNegate(exec, operand, *arithProfile);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- EncodedJSValue JIT_OPERATION operationArithNegateProfiledOptimize(ExecState* exec, EncodedJSValue encodedOperand, JITNegIC* negIC)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationArithNegateProfiledOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOperand, JITNegIC* negIC)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue operand = JSValue::decode(encodedOperand);
  
<span class="udiff-line-modified-removed">-     ArithProfile* arithProfile = negIC-&gt;arithProfile();</span>
<span class="udiff-line-modified-added">+     UnaryArithProfile* arithProfile = negIC-&gt;arithProfile();</span>
      ASSERT(arithProfile);
<span class="udiff-line-modified-removed">-     arithProfile-&gt;observeLHS(operand);</span>
<span class="udiff-line-modified-removed">-     negIC-&gt;generateOutOfLine(exec-&gt;codeBlock(), operationArithNegateProfiled);</span>
<span class="udiff-line-modified-added">+     arithProfile-&gt;observeArg(operand);</span>
<span class="udiff-line-modified-added">+     negIC-&gt;generateOutOfLine(callFrame-&gt;codeBlock(), operationArithNegateProfiled);</span>
  
  #if ENABLE(MATH_IC_STATS)
<span class="udiff-line-modified-removed">-     exec-&gt;codeBlock()-&gt;dumpMathICStats();</span>
<span class="udiff-line-modified-added">+     callFrame-&gt;codeBlock()-&gt;dumpMathICStats();</span>
  #endif
  
<span class="udiff-line-modified-removed">-     JSValue primValue = operand.toPrimitive(exec);</span>
<span class="udiff-line-modified-added">+     JSValue primValue = operand.toPrimitive(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      if (primValue.isBigInt()) {
          JSBigInt* result = JSBigInt::unaryMinus(vm, asBigInt(primValue));
          arithProfile-&gt;observeResult(result);
          return JSValue::encode(result);
      }
  
<span class="udiff-line-modified-removed">-     double number = primValue.toNumber(exec);</span>
<span class="udiff-line-modified-added">+     double number = primValue.toNumber(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
      JSValue result = jsNumber(-number);
      arithProfile-&gt;observeResult(result);
      return JSValue::encode(result);
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationArithNegateOptimize(ExecState* exec, EncodedJSValue encodedOperand, JITNegIC* negIC)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationArithNegateOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOperand, JITNegIC* negIC)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      JSValue operand = JSValue::decode(encodedOperand);
  
<span class="udiff-line-modified-removed">-     if (ArithProfile* arithProfile = negIC-&gt;arithProfile())</span>
<span class="udiff-line-modified-removed">-         arithProfile-&gt;observeLHS(operand);</span>
<span class="udiff-line-modified-removed">-     negIC-&gt;generateOutOfLine(exec-&gt;codeBlock(), operationArithNegate);</span>
<span class="udiff-line-modified-added">+     if (UnaryArithProfile* arithProfile = negIC-&gt;arithProfile())</span>
<span class="udiff-line-modified-added">+         arithProfile-&gt;observeArg(operand);</span>
<span class="udiff-line-modified-added">+     negIC-&gt;generateOutOfLine(callFrame-&gt;codeBlock(), operationArithNegate);</span>
  
  #if ENABLE(MATH_IC_STATS)
<span class="udiff-line-modified-removed">-     exec-&gt;codeBlock()-&gt;dumpMathICStats();</span>
<span class="udiff-line-modified-added">+     callFrame-&gt;codeBlock()-&gt;dumpMathICStats();</span>
  #endif
  
<span class="udiff-line-modified-removed">-     JSValue primValue = operand.toPrimitive(exec);</span>
<span class="udiff-line-modified-added">+     JSValue primValue = operand.toPrimitive(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      if (primValue.isBigInt())
          return JSValue::encode(JSBigInt::unaryMinus(vm, asBigInt(primValue)));
  
<span class="udiff-line-modified-removed">-     double number = primValue.toNumber(exec);</span>
<span class="udiff-line-modified-added">+     double number = primValue.toNumber(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
      return JSValue::encode(jsNumber(-number));
  }
  
<span class="udiff-line-modified-removed">- ALWAYS_INLINE static EncodedJSValue unprofiledSub(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-modified-added">+ ALWAYS_INLINE static EncodedJSValue unprofiledSub(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
  {
      JSValue op1 = JSValue::decode(encodedOp1);
      JSValue op2 = JSValue::decode(encodedOp2);
  
<span class="udiff-line-modified-removed">-     return JSValue::encode(jsSub(exec, op1, op2));</span>
<span class="udiff-line-modified-added">+     return JSValue::encode(jsSub(globalObject, op1, op2));</span>
  }
  
<span class="udiff-line-modified-removed">- ALWAYS_INLINE static EncodedJSValue profiledSub(VM&amp; vm, ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, ArithProfile&amp; arithProfile, bool shouldObserveLHSAndRHSTypes = true)</span>
<span class="udiff-line-modified-added">+ ALWAYS_INLINE static EncodedJSValue profiledSub(VM&amp; vm, JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, BinaryArithProfile&amp; arithProfile, bool shouldObserveLHSAndRHSTypes = true)</span>
  {
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      JSValue op1 = JSValue::decode(encodedOp1);
      JSValue op2 = JSValue::decode(encodedOp2);
  
      if (shouldObserveLHSAndRHSTypes)
          arithProfile.observeLHSAndRHS(op1, op2);
  
<span class="udiff-line-modified-removed">-     JSValue result = jsSub(exec, op1, op2);</span>
<span class="udiff-line-modified-added">+     JSValue result = jsSub(globalObject, op1, op2);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
      arithProfile.observeResult(result);
      return JSValue::encode(result);
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueSub(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueSub(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-removed">-     return unprofiledSub(exec, encodedOp1, encodedOp2);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-modified-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
<span class="udiff-line-added">+     return unprofiledSub(globalObject, encodedOp1, encodedOp2);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueSubProfiled(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, ArithProfile* arithProfile)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueSubProfiled(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, BinaryArithProfile* arithProfile)</span>
  {
      ASSERT(arithProfile);
  
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     return profiledSub(vm, exec, encodedOp1, encodedOp2, *arithProfile);</span>
<span class="udiff-line-modified-added">+     return profiledSub(vm, globalObject, encodedOp1, encodedOp2, *arithProfile);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueSubOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITSubIC* subIC)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueSubOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITSubIC* subIC)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
      auto nonOptimizeVariant = operationValueSubNoOptimize;
<span class="udiff-line-modified-removed">-     if (ArithProfile* arithProfile = subIC-&gt;arithProfile())</span>
<span class="udiff-line-modified-added">+     if (BinaryArithProfile* arithProfile = subIC-&gt;arithProfile())</span>
          arithProfile-&gt;observeLHSAndRHS(JSValue::decode(encodedOp1), JSValue::decode(encodedOp2));
<span class="udiff-line-modified-removed">-     subIC-&gt;generateOutOfLine(exec-&gt;codeBlock(), nonOptimizeVariant);</span>
<span class="udiff-line-modified-added">+     subIC-&gt;generateOutOfLine(callFrame-&gt;codeBlock(), nonOptimizeVariant);</span>
  
  #if ENABLE(MATH_IC_STATS)
<span class="udiff-line-modified-removed">-     exec-&gt;codeBlock()-&gt;dumpMathICStats();</span>
<span class="udiff-line-modified-added">+     callFrame-&gt;codeBlock()-&gt;dumpMathICStats();</span>
  #endif
  
<span class="udiff-line-modified-removed">-     return unprofiledSub(exec, encodedOp1, encodedOp2);</span>
<span class="udiff-line-modified-added">+     return unprofiledSub(globalObject, encodedOp1, encodedOp2);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueSubNoOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITSubIC*)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueSubNoOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITSubIC*)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     return unprofiledSub(exec, encodedOp1, encodedOp2);</span>
<span class="udiff-line-modified-added">+     return unprofiledSub(globalObject, encodedOp1, encodedOp2);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueSubProfiledOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITSubIC* subIC)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueSubProfiledOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITSubIC* subIC)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     ArithProfile* arithProfile = subIC-&gt;arithProfile();</span>
<span class="udiff-line-modified-added">+     BinaryArithProfile* arithProfile = subIC-&gt;arithProfile();</span>
      ASSERT(arithProfile);
      arithProfile-&gt;observeLHSAndRHS(JSValue::decode(encodedOp1), JSValue::decode(encodedOp2));
      auto nonOptimizeVariant = operationValueSubProfiledNoOptimize;
<span class="udiff-line-modified-removed">-     subIC-&gt;generateOutOfLine(exec-&gt;codeBlock(), nonOptimizeVariant);</span>
<span class="udiff-line-modified-added">+     subIC-&gt;generateOutOfLine(callFrame-&gt;codeBlock(), nonOptimizeVariant);</span>
  
  #if ENABLE(MATH_IC_STATS)
<span class="udiff-line-modified-removed">-     exec-&gt;codeBlock()-&gt;dumpMathICStats();</span>
<span class="udiff-line-modified-added">+     callFrame-&gt;codeBlock()-&gt;dumpMathICStats();</span>
  #endif
  
<span class="udiff-line-modified-removed">-     return profiledSub(vm, exec, encodedOp1, encodedOp2, *arithProfile, false);</span>
<span class="udiff-line-modified-added">+     return profiledSub(vm, globalObject, encodedOp1, encodedOp2, *arithProfile, false);</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JIT_OPERATION operationValueSubProfiledNoOptimize(ExecState* exec, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITSubIC* subIC)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JIT_OPERATION operationValueSubProfiledNoOptimize(JSGlobalObject* globalObject, EncodedJSValue encodedOp1, EncodedJSValue encodedOp2, JITSubIC* subIC)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
  
<span class="udiff-line-modified-removed">-     ArithProfile* arithProfile = subIC-&gt;arithProfile();</span>
<span class="udiff-line-modified-added">+     BinaryArithProfile* arithProfile = subIC-&gt;arithProfile();</span>
      ASSERT(arithProfile);
<span class="udiff-line-modified-removed">-     return profiledSub(vm, exec, encodedOp1, encodedOp2, *arithProfile);</span>
<span class="udiff-line-modified-added">+     return profiledSub(vm, globalObject, encodedOp1, encodedOp2, *arithProfile);</span>
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationProcessTypeProfilerLog(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationProcessTypeProfilerLog(VM* vmPointer)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      vm.typeProfilerLog()-&gt;processLogEntries(vm, &quot;Log Full, called from inside baseline JIT&quot;_s);
  }
  
<span class="udiff-line-modified-removed">- void JIT_OPERATION operationProcessShadowChickenLog(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ void JIT_OPERATION operationProcessShadowChickenLog(VM* vmPointer)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      RELEASE_ASSERT(vm.shadowChicken());
<span class="udiff-line-modified-removed">-     vm.shadowChicken()-&gt;update(vm, exec);</span>
<span class="udiff-line-modified-added">+     vm.shadowChicken()-&gt;update(vm, callFrame);</span>
  }
  
<span class="udiff-line-modified-removed">- int32_t JIT_OPERATION operationCheckIfExceptionIsUncatchableAndNotifyProfiler(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ int32_t JIT_OPERATION operationCheckIfExceptionIsUncatchableAndNotifyProfiler(VM* vmPointer)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     NativeCallFrameTracer tracer(vm, exec);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = *vmPointer;</span>
<span class="udiff-line-modified-added">+     CallFrame* callFrame = DECLARE_CALL_FRAME(vm);</span>
<span class="udiff-line-added">+     JITOperationPrologueCallFrameTracer tracer(vm, callFrame);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      RELEASE_ASSERT(!!scope.exception());
  
      if (isTerminatedExecutionException(vm, scope.exception())) {
<span class="udiff-line-modified-removed">-         genericUnwind(vm, exec);</span>
<span class="udiff-line-modified-added">+         genericUnwind(vm, callFrame);</span>
          return 1;
      }
      return 0;
  }
  
  } // extern &quot;C&quot;
  
  } // namespace JSC
  
<span class="udiff-line-added">+ IGNORE_WARNINGS_END</span>
<span class="udiff-line-added">+ </span>
  #endif // ENABLE(JIT)
</pre>
<center><a href="JITOpcodes32_64.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JITOperations.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>