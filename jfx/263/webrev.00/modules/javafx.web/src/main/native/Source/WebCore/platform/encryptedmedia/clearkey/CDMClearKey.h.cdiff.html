<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/encryptedmedia/clearkey/CDMClearKey.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CDMClearKey.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../generic/KeyedDecoderGeneric.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/encryptedmedia/clearkey/CDMClearKey.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 75,10 ***</span>
<span class="line-new-header">--- 75,24 ---</span>
      bool supportsInitData(const AtomString&amp;, const SharedBuffer&amp;) const final;
      RefPtr&lt;SharedBuffer&gt; sanitizeResponse(const SharedBuffer&amp;) const final;
      Optional&lt;String&gt; sanitizeSessionId(const String&amp;) const final;
  };
  
<span class="line-added">+ class ProxyCDMClearKey final : public ProxyCDM {</span>
<span class="line-added">+ public:</span>
<span class="line-added">+     struct Key {</span>
<span class="line-added">+         CDMInstanceSession::KeyStatus status;</span>
<span class="line-added">+         String keyIDData;</span>
<span class="line-added">+         String keyValueData;</span>
<span class="line-added">+     };</span>
<span class="line-added">+ </span>
<span class="line-added">+     virtual ~ProxyCDMClearKey() = default;</span>
<span class="line-added">+     const Vector&lt;Key&gt; isolatedKeys() const;</span>
<span class="line-added">+ private:</span>
<span class="line-added">+     mutable Lock m_keysMutex;</span>
<span class="line-added">+ };</span>
<span class="line-added">+ </span>
  class CDMInstanceClearKey final : public CDMInstance, public CanMakeWeakPtr&lt;CDMInstanceClearKey&gt; {
  public:
      CDMInstanceClearKey();
      virtual ~CDMInstanceClearKey();
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 94,16 ***</span>
  
      struct Key {
          CDMInstanceSession::KeyStatus status;
          RefPtr&lt;SharedBuffer&gt; keyIDData;
          RefPtr&lt;SharedBuffer&gt; keyValueData;
      };
  
<span class="line-modified">!     const Vector&lt;Key&gt; keys() const;</span>
  
  private:
<span class="line-modified">!     mutable Lock m_keysMutex;</span>
  };
  
  class CDMInstanceSessionClearKey final : public CDMInstanceSession, public CanMakeWeakPtr&lt;CDMInstanceSessionClearKey&gt; {
  public:
      void requestLicense(LicenseType, const AtomString&amp; initDataType, Ref&lt;SharedBuffer&gt;&amp;&amp; initData, LicenseCallback&amp;&amp;) final;
<span class="line-new-header">--- 108,36 ---</span>
  
      struct Key {
          CDMInstanceSession::KeyStatus status;
          RefPtr&lt;SharedBuffer&gt; keyIDData;
          RefPtr&lt;SharedBuffer&gt; keyValueData;
<span class="line-added">+ </span>
<span class="line-added">+         String keyIDAsString() const;</span>
<span class="line-added">+         String keyValueAsString() const;</span>
<span class="line-added">+ </span>
<span class="line-added">+         bool hasSameKeyValue(const Key &amp;other)</span>
<span class="line-added">+         {</span>
<span class="line-added">+             ASSERT(keyValueData);</span>
<span class="line-added">+             ASSERT(other.keyValueData);</span>
<span class="line-added">+             return *keyValueData == *other.keyValueData;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Two keys are equal if they have the same ID, ignoring key value and status.</span>
<span class="line-added">+         friend bool operator==(const Key &amp;k1, const Key &amp;k2);</span>
<span class="line-added">+         // Key&#39;s are ordered by their IDs, first by size, then by contents.</span>
<span class="line-added">+         friend bool operator&lt;(const Key &amp;k1, const Key &amp;k2);</span>
<span class="line-added">+ </span>
<span class="line-added">+         friend bool operator!=(const Key &amp;k1, const Key &amp;k2) { return !(operator==(k1, k2)); }</span>
<span class="line-added">+         friend bool operator&gt;(const Key &amp;k1, const Key &amp;k2) { return !operator==(k1, k2) &amp;&amp; !operator&lt;(k1, k2); }</span>
<span class="line-added">+         friend bool operator&lt;=(const Key &amp;k1, const Key &amp;k2) { return !operator&gt;(k1, k2); }</span>
<span class="line-added">+         friend bool operator&gt;=(const Key &amp;k1, const Key &amp;k2) { return !operator&lt;(k1, k2); }</span>
      };
  
<span class="line-modified">!     RefPtr&lt;ProxyCDM&gt; proxyCDM() const final { return m_proxyCDM; }</span>
  
  private:
<span class="line-modified">!     RefPtr&lt;ProxyCDM&gt; m_proxyCDM;</span>
  };
  
  class CDMInstanceSessionClearKey final : public CDMInstanceSession, public CanMakeWeakPtr&lt;CDMInstanceSessionClearKey&gt; {
  public:
      void requestLicense(LicenseType, const AtomString&amp; initDataType, Ref&lt;SharedBuffer&gt;&amp;&amp; initData, LicenseCallback&amp;&amp;) final;
</pre>
<center><a href="CDMClearKey.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../generic/KeyedDecoderGeneric.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>