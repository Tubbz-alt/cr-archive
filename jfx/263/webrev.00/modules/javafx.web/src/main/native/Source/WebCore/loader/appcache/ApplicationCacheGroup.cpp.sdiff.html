<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/loader/appcache/ApplicationCacheGroup.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ApplicationCache.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ApplicationCacheGroup.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/loader/appcache/ApplicationCacheGroup.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  24  */
  25 
  26 #include &quot;config.h&quot;
  27 #include &quot;ApplicationCacheGroup.h&quot;
  28 
  29 #include &quot;ApplicationCache.h&quot;
  30 #include &quot;ApplicationCacheHost.h&quot;
  31 #include &quot;ApplicationCacheResource.h&quot;
  32 #include &quot;ApplicationCacheResourceLoader.h&quot;
  33 #include &quot;ApplicationCacheStorage.h&quot;
  34 #include &quot;Chrome.h&quot;
  35 #include &quot;ChromeClient.h&quot;
  36 #include &quot;DOMApplicationCache.h&quot;
  37 #include &quot;DocumentLoader.h&quot;
  38 #include &quot;EventNames.h&quot;
  39 #include &quot;Frame.h&quot;
  40 #include &quot;FrameLoader.h&quot;
  41 #include &quot;FrameLoaderClient.h&quot;
  42 #include &quot;HTTPHeaderNames.h&quot;

  43 #include &quot;InspectorInstrumentation.h&quot;
  44 #include &quot;ManifestParser.h&quot;
  45 #include &quot;NavigationScheduler.h&quot;
  46 #include &quot;NetworkLoadMetrics.h&quot;
  47 #include &quot;Page.h&quot;
  48 #include &quot;ProgressTracker.h&quot;
  49 #include &quot;SecurityOrigin.h&quot;
  50 #include &quot;Settings.h&quot;
  51 #include &lt;wtf/CompletionHandler.h&gt;
  52 #include &lt;wtf/HashMap.h&gt;
  53 #include &lt;wtf/MainThread.h&gt;
  54 
  55 namespace WebCore {
  56 
  57 ApplicationCacheGroup::ApplicationCacheGroup(Ref&lt;ApplicationCacheStorage&gt;&amp;&amp; storage, const URL&amp; manifestURL)
  58     : m_storage(WTFMove(storage))
  59     , m_manifestURL(manifestURL)
  60     , m_origin(SecurityOrigin::create(manifestURL))
  61     , m_availableSpaceInQuota(ApplicationCacheStorage::unknownQuota())
  62 {
</pre>
<hr />
<pre>
 446                 return;
 447             if (error == ApplicationCacheResourceLoader::Error::CannotCreateResource) {
 448                 // FIXME: We should get back the error from ApplicationCacheResourceLoader level.
 449                 InspectorInstrumentation::didFailLoading(m_frame, m_frame-&gt;loader().documentLoader(), m_currentResourceIdentifier, ResourceError { ResourceError::Type::AccessControl });
 450                 this-&gt;cacheUpdateFailed();
 451                 return;
 452             }
 453             this-&gt;didFailLoadingManifest(error);
 454             return;
 455         }
 456 
 457         m_manifestResource = WTFMove(resourceOrError.value());
 458         this-&gt;didFinishLoadingManifest();
 459     });
 460 }
 461 
 462 ResourceRequest ApplicationCacheGroup::createRequest(URL&amp;&amp; url, ApplicationCacheResource* resource)
 463 {
 464     ResourceRequest request { WTFMove(url) };
 465     m_frame-&gt;loader().applyUserAgentIfNeeded(request);
<span class="line-modified"> 466     request.setHTTPHeaderField(HTTPHeaderName::CacheControl, &quot;max-age=0&quot;);</span>
 467 
 468     if (resource) {
 469         const String&amp; lastModified = resource-&gt;response().httpHeaderField(HTTPHeaderName::LastModified);
 470         if (!lastModified.isEmpty())
 471             request.setHTTPHeaderField(HTTPHeaderName::IfModifiedSince, lastModified);
 472 
 473         const String&amp; eTag = resource-&gt;response().httpHeaderField(HTTPHeaderName::ETag);
 474         if (!eTag.isEmpty())
 475             request.setHTTPHeaderField(HTTPHeaderName::IfNoneMatch, eTag);
 476     }
 477     return request;
 478 }
 479 
 480 void ApplicationCacheGroup::abort(Frame&amp; frame)
 481 {
 482     if (m_updateStatus == Idle)
 483         return;
 484     ASSERT(m_updateStatus == Checking || (m_updateStatus == Downloading &amp;&amp; m_cacheBeingUpdated));
 485 
 486     if (m_completionType != None)
</pre>
</td>
<td>
<hr />
<pre>
  23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  24  */
  25 
  26 #include &quot;config.h&quot;
  27 #include &quot;ApplicationCacheGroup.h&quot;
  28 
  29 #include &quot;ApplicationCache.h&quot;
  30 #include &quot;ApplicationCacheHost.h&quot;
  31 #include &quot;ApplicationCacheResource.h&quot;
  32 #include &quot;ApplicationCacheResourceLoader.h&quot;
  33 #include &quot;ApplicationCacheStorage.h&quot;
  34 #include &quot;Chrome.h&quot;
  35 #include &quot;ChromeClient.h&quot;
  36 #include &quot;DOMApplicationCache.h&quot;
  37 #include &quot;DocumentLoader.h&quot;
  38 #include &quot;EventNames.h&quot;
  39 #include &quot;Frame.h&quot;
  40 #include &quot;FrameLoader.h&quot;
  41 #include &quot;FrameLoaderClient.h&quot;
  42 #include &quot;HTTPHeaderNames.h&quot;
<span class="line-added">  43 #include &quot;HTTPHeaderValues.h&quot;</span>
  44 #include &quot;InspectorInstrumentation.h&quot;
  45 #include &quot;ManifestParser.h&quot;
  46 #include &quot;NavigationScheduler.h&quot;
  47 #include &quot;NetworkLoadMetrics.h&quot;
  48 #include &quot;Page.h&quot;
  49 #include &quot;ProgressTracker.h&quot;
  50 #include &quot;SecurityOrigin.h&quot;
  51 #include &quot;Settings.h&quot;
  52 #include &lt;wtf/CompletionHandler.h&gt;
  53 #include &lt;wtf/HashMap.h&gt;
  54 #include &lt;wtf/MainThread.h&gt;
  55 
  56 namespace WebCore {
  57 
  58 ApplicationCacheGroup::ApplicationCacheGroup(Ref&lt;ApplicationCacheStorage&gt;&amp;&amp; storage, const URL&amp; manifestURL)
  59     : m_storage(WTFMove(storage))
  60     , m_manifestURL(manifestURL)
  61     , m_origin(SecurityOrigin::create(manifestURL))
  62     , m_availableSpaceInQuota(ApplicationCacheStorage::unknownQuota())
  63 {
</pre>
<hr />
<pre>
 447                 return;
 448             if (error == ApplicationCacheResourceLoader::Error::CannotCreateResource) {
 449                 // FIXME: We should get back the error from ApplicationCacheResourceLoader level.
 450                 InspectorInstrumentation::didFailLoading(m_frame, m_frame-&gt;loader().documentLoader(), m_currentResourceIdentifier, ResourceError { ResourceError::Type::AccessControl });
 451                 this-&gt;cacheUpdateFailed();
 452                 return;
 453             }
 454             this-&gt;didFailLoadingManifest(error);
 455             return;
 456         }
 457 
 458         m_manifestResource = WTFMove(resourceOrError.value());
 459         this-&gt;didFinishLoadingManifest();
 460     });
 461 }
 462 
 463 ResourceRequest ApplicationCacheGroup::createRequest(URL&amp;&amp; url, ApplicationCacheResource* resource)
 464 {
 465     ResourceRequest request { WTFMove(url) };
 466     m_frame-&gt;loader().applyUserAgentIfNeeded(request);
<span class="line-modified"> 467     request.setHTTPHeaderField(HTTPHeaderName::CacheControl, HTTPHeaderValues::maxAge0());</span>
 468 
 469     if (resource) {
 470         const String&amp; lastModified = resource-&gt;response().httpHeaderField(HTTPHeaderName::LastModified);
 471         if (!lastModified.isEmpty())
 472             request.setHTTPHeaderField(HTTPHeaderName::IfModifiedSince, lastModified);
 473 
 474         const String&amp; eTag = resource-&gt;response().httpHeaderField(HTTPHeaderName::ETag);
 475         if (!eTag.isEmpty())
 476             request.setHTTPHeaderField(HTTPHeaderName::IfNoneMatch, eTag);
 477     }
 478     return request;
 479 }
 480 
 481 void ApplicationCacheGroup::abort(Frame&amp; frame)
 482 {
 483     if (m_updateStatus == Idle)
 484         return;
 485     ASSERT(m_updateStatus == Checking || (m_updateStatus == Downloading &amp;&amp; m_cacheBeingUpdated));
 486 
 487     if (m_completionType != None)
</pre>
</td>
</tr>
</table>
<center><a href="ApplicationCache.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ApplicationCacheGroup.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>