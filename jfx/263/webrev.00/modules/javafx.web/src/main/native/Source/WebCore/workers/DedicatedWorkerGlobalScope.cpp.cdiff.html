<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/workers/DedicatedWorkerGlobalScope.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../testing/js/WebCoreTestSupportPrefix.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DedicatedWorkerGlobalScope.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/workers/DedicatedWorkerGlobalScope.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 42,35 ***</span>
  
  namespace WebCore {
  
  WTF_MAKE_ISO_ALLOCATED_IMPL(DedicatedWorkerGlobalScope);
  
<span class="line-modified">! Ref&lt;DedicatedWorkerGlobalScope&gt; DedicatedWorkerGlobalScope::create(const URL&amp; url, Ref&lt;SecurityOrigin&gt;&amp;&amp; origin, const String&amp; name, const String&amp; identifier, const String&amp; userAgent, bool isOnline, DedicatedWorkerThread&amp; thread, const ContentSecurityPolicyResponseHeaders&amp; contentSecurityPolicyResponseHeaders, bool shouldBypassMainWorldContentSecurityPolicy, Ref&lt;SecurityOrigin&gt;&amp;&amp; topOrigin, MonotonicTime timeOrigin, IDBClient::IDBConnectionProxy* connectionProxy, SocketProvider* socketProvider, PAL::SessionID sessionID)</span>
  {
<span class="line-modified">!     auto context = adoptRef(*new DedicatedWorkerGlobalScope(url, WTFMove(origin), name, identifier, userAgent, isOnline, thread, shouldBypassMainWorldContentSecurityPolicy, WTFMove(topOrigin), timeOrigin, connectionProxy, socketProvider, sessionID));</span>
<span class="line-modified">!     if (!shouldBypassMainWorldContentSecurityPolicy)</span>
<span class="line-modified">!         context-&gt;applyContentSecurityPolicyResponseHeaders(contentSecurityPolicyResponseHeaders);</span>
      return context;
  }
  
<span class="line-modified">! DedicatedWorkerGlobalScope::DedicatedWorkerGlobalScope(const URL&amp; url, Ref&lt;SecurityOrigin&gt;&amp;&amp; origin, const String&amp; name, const String&amp; identifier, const String&amp; userAgent, bool isOnline, DedicatedWorkerThread&amp; thread, bool shouldBypassMainWorldContentSecurityPolicy, Ref&lt;SecurityOrigin&gt;&amp;&amp; topOrigin, MonotonicTime timeOrigin, IDBClient::IDBConnectionProxy* connectionProxy, SocketProvider* socketProvider, PAL::SessionID sessionID)</span>
<span class="line-modified">!     : WorkerGlobalScope(url, WTFMove(origin), identifier, userAgent, isOnline, thread, shouldBypassMainWorldContentSecurityPolicy, WTFMove(topOrigin), timeOrigin, connectionProxy, socketProvider, sessionID)</span>
<span class="line-modified">!     , m_name(name)</span>
  {
  }
  
  DedicatedWorkerGlobalScope::~DedicatedWorkerGlobalScope() = default;
  
  EventTargetInterface DedicatedWorkerGlobalScope::eventTargetInterface() const
  {
      return DedicatedWorkerGlobalScopeEventTargetInterfaceType;
  }
  
<span class="line-modified">! ExceptionOr&lt;void&gt; DedicatedWorkerGlobalScope::postMessage(JSC::ExecState&amp; state, JSC::JSValue messageValue, Vector&lt;JSC::Strong&lt;JSC::JSObject&gt;&gt;&amp;&amp; transfer)</span>
  {
      Vector&lt;RefPtr&lt;MessagePort&gt;&gt; ports;
<span class="line-modified">!     auto message = SerializedScriptValue::create(state, messageValue, WTFMove(transfer), ports, SerializationContext::WorkerPostMessage);</span>
      if (message.hasException())
          return message.releaseException();
  
      // Disentangle the port in preparation for sending it to the remote context.
      auto channels = MessagePort::disentanglePorts(WTFMove(ports));
<span class="line-new-header">--- 42,35 ---</span>
  
  namespace WebCore {
  
  WTF_MAKE_ISO_ALLOCATED_IMPL(DedicatedWorkerGlobalScope);
  
<span class="line-modified">! Ref&lt;DedicatedWorkerGlobalScope&gt; DedicatedWorkerGlobalScope::create(const WorkerParameters&amp; params, Ref&lt;SecurityOrigin&gt;&amp;&amp; origin, DedicatedWorkerThread&amp; thread, Ref&lt;SecurityOrigin&gt;&amp;&amp; topOrigin, IDBClient::IDBConnectionProxy* connectionProxy, SocketProvider* socketProvider)</span>
  {
<span class="line-modified">!     auto context = adoptRef(*new DedicatedWorkerGlobalScope(params, WTFMove(origin), thread, WTFMove(topOrigin), connectionProxy, socketProvider));</span>
<span class="line-modified">!     if (!params.shouldBypassMainWorldContentSecurityPolicy)</span>
<span class="line-modified">!         context-&gt;applyContentSecurityPolicyResponseHeaders(params.contentSecurityPolicyResponseHeaders);</span>
      return context;
  }
  
<span class="line-modified">! DedicatedWorkerGlobalScope::DedicatedWorkerGlobalScope(const WorkerParameters&amp; params, Ref&lt;SecurityOrigin&gt;&amp;&amp; origin, DedicatedWorkerThread&amp; thread, Ref&lt;SecurityOrigin&gt;&amp;&amp; topOrigin, IDBClient::IDBConnectionProxy* connectionProxy, SocketProvider* socketProvider)</span>
<span class="line-modified">!     : WorkerGlobalScope(params, WTFMove(origin), thread, WTFMove(topOrigin), connectionProxy, socketProvider)</span>
<span class="line-modified">!     , m_name(params.name)</span>
  {
  }
  
  DedicatedWorkerGlobalScope::~DedicatedWorkerGlobalScope() = default;
  
  EventTargetInterface DedicatedWorkerGlobalScope::eventTargetInterface() const
  {
      return DedicatedWorkerGlobalScopeEventTargetInterfaceType;
  }
  
<span class="line-modified">! ExceptionOr&lt;void&gt; DedicatedWorkerGlobalScope::postMessage(JSC::JSGlobalObject&amp; state, JSC::JSValue messageValue, PostMessageOptions&amp;&amp; options)</span>
  {
      Vector&lt;RefPtr&lt;MessagePort&gt;&gt; ports;
<span class="line-modified">!     auto message = SerializedScriptValue::create(state, messageValue, WTFMove(options.transfer), ports, SerializationContext::WorkerPostMessage);</span>
      if (message.hasException())
          return message.releaseException();
  
      // Disentangle the port in preparation for sending it to the remote context.
      auto channels = MessagePort::disentanglePorts(WTFMove(ports));
</pre>
<center><a href="../testing/js/WebCoreTestSupportPrefix.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DedicatedWorkerGlobalScope.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>