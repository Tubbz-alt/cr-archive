<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/PlatformKeyboardEvent.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PasteboardStrategy.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PlatformPasteboard.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/PlatformKeyboardEvent.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  9  *    notice, this list of conditions and the following disclaimer.
 10  * 2. Redistributions in binary form must reproduce the above copyright
 11  *    notice, this list of conditions and the following disclaimer in the
 12  *    documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 15  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 16  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 18  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 19  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 20  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 21  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 22  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 24  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 25  */
 26 
 27 #pragma once
 28 

 29 #include &quot;KeypressCommand.h&quot;
 30 #include &quot;PlatformEvent.h&quot;
 31 #include &lt;wtf/WindowsExtras.h&gt;
 32 #include &lt;wtf/text/WTFString.h&gt;
 33 
 34 #if PLATFORM(COCOA)
 35 #include &lt;wtf/RetainPtr.h&gt;
 36 OBJC_CLASS NSEvent;
 37 #endif
 38 
 39 #if PLATFORM(IOS_FAMILY)
 40 OBJC_CLASS WebEvent;
 41 #endif
 42 
<span class="line-removed"> 43 #if PLATFORM(GTK)</span>
<span class="line-removed"> 44 typedef struct _GdkEventKey GdkEventKey;</span>
<span class="line-removed"> 45 #include &quot;CompositionResults.h&quot;</span>
<span class="line-removed"> 46 #endif</span>
<span class="line-removed"> 47 </span>
 48 #if PLATFORM(JAVA)
 49 #include &lt;jni.h&gt;
 50 #endif
 51 
 52 namespace WebCore {
 53 
 54     class PlatformKeyboardEvent : public PlatformEvent {
 55         WTF_MAKE_FAST_ALLOCATED;
 56     public:
 57         PlatformKeyboardEvent()
 58             : PlatformEvent(PlatformEvent::KeyDown)
 59             , m_windowsVirtualKeyCode(0)
 60             , m_autoRepeat(false)
 61             , m_isKeypad(false)
 62             , m_isSystemKey(false)
<span class="line-removed"> 63 #if PLATFORM(GTK)</span>
<span class="line-removed"> 64             , m_gdkEventKey(0)</span>
<span class="line-removed"> 65 #endif</span>
 66         {
 67         }
 68 
<span class="line-modified"> 69         PlatformKeyboardEvent(Type type, const String&amp; text, const String&amp; unmodifiedText,</span>
<span class="line-removed"> 70 #if ENABLE(KEYBOARD_KEY_ATTRIBUTE)</span>
<span class="line-removed"> 71         const String&amp; key,</span>
<span class="line-removed"> 72 #endif</span>
<span class="line-removed"> 73 #if ENABLE(KEYBOARD_CODE_ATTRIBUTE)</span>
<span class="line-removed"> 74         const String&amp; code,</span>
<span class="line-removed"> 75 #endif</span>
 76         const String&amp; keyIdentifier, int windowsVirtualKeyCode, bool isAutoRepeat, bool isKeypad, bool isSystemKey, OptionSet&lt;Modifier&gt; modifiers, WallTime timestamp)
 77             : PlatformEvent(type, modifiers, timestamp)
 78             , m_text(text)
 79             , m_unmodifiedText(unmodifiedText)
<span class="line-removed"> 80 #if ENABLE(KEYBOARD_KEY_ATTRIBUTE)</span>
 81             , m_key(key)
<span class="line-removed"> 82 #endif</span>
<span class="line-removed"> 83 #if ENABLE(KEYBOARD_CODE_ATTRIBUTE)</span>
 84             , m_code(code)
<span class="line-removed"> 85 #endif</span>
 86             , m_keyIdentifier(keyIdentifier)
 87             , m_windowsVirtualKeyCode(windowsVirtualKeyCode)
 88             , m_autoRepeat(isAutoRepeat)
 89             , m_isKeypad(isKeypad)
 90             , m_isSystemKey(isSystemKey)
 91         {
 92         }
 93 
 94         WEBCORE_EXPORT void disambiguateKeyDownEvent(Type, bool backwardCompatibilityMode = false); // Only used on platforms that need it, i.e. those that generate KeyDown events.
 95 
 96         // Text as as generated by processing a virtual key code with a keyboard layout
 97         // (in most cases, just a character code, but the layout can emit several
 98         // characters in a single keypress event on some platforms).
 99         // This may bear no resemblance to the ultimately inserted text if an input method
100         // processes the input.
101         // Will be null for KeyUp and RawKeyDown events.
102         String text() const { return m_text; }
103 
104         // Text that would have been generated by the keyboard if no modifiers were pressed
105         // (except for Shift); useful for shortcut (accelerator) key handling.
106         // Otherwise, same as text().
107         String unmodifiedText() const { return m_unmodifiedText; }
108 
109         String keyIdentifier() const { return m_keyIdentifier; }
<span class="line-removed">110 </span>
<span class="line-removed">111 #if ENABLE(KEYBOARD_KEY_ATTRIBUTE)</span>
112         const String&amp; key() const { return m_key; }
<span class="line-removed">113 #endif</span>
<span class="line-removed">114 #if ENABLE(KEYBOARD_CODE_ATTRIBUTE)</span>
115         const String&amp; code() const { return m_code; }
<span class="line-removed">116 #endif</span>
117 
118         // Most compatible Windows virtual key code associated with the event.
119         // Zero for Char events.
120         int windowsVirtualKeyCode() const { return m_windowsVirtualKeyCode; }
121         void setWindowsVirtualKeyCode(int code) { m_windowsVirtualKeyCode = code; }
122 
<span class="line-modified">123 #if USE(APPKIT) || USE(UIKIT_KEYBOARD_ADDITIONS) || PLATFORM(GTK)</span>
124         bool handledByInputMethod() const { return m_handledByInputMethod; }
125 #endif





126 #if USE(APPKIT)
127         const Vector&lt;KeypressCommand&gt;&amp; commands() const { return m_commands; }
128 #elif PLATFORM(GTK)
129         const Vector&lt;String&gt;&amp; commands() const { return m_commands; }
130 #endif
131 
132         bool isAutoRepeat() const { return m_autoRepeat; }
133         bool isKeypad() const { return m_isKeypad; }
134         bool isSystemKey() const { return m_isSystemKey; }
135 
136         bool isSyntheticEvent() const { return m_isSyntheticEvent; }
137         void setIsSyntheticEvent() { m_isSyntheticEvent = true; }
138 
139         WEBCORE_EXPORT static bool currentCapsLockState();
140         WEBCORE_EXPORT static void getCurrentModifierState(bool&amp; shiftKey, bool&amp; ctrlKey, bool&amp; altKey, bool&amp; metaKey);
141         WEBCORE_EXPORT static void setCurrentModifierState(OptionSet&lt;Modifier&gt;);
142         WEBCORE_EXPORT static OptionSet&lt;Modifier&gt; currentStateOfModifierKeys();
143 
144 #if PLATFORM(COCOA)
145 #if !PLATFORM(IOS_FAMILY)
146         NSEvent* macEvent() const { return m_macEvent.get(); }
147 #else
148         ::WebEvent *event() const { return m_Event.get(); }
149 #endif
150 #endif
151 
152 #if PLATFORM(WIN)
153         PlatformKeyboardEvent(HWND, WPARAM, LPARAM, Type, bool);
154 #endif
155 
156 #if PLATFORM(GTK)
<span class="line-removed">157         PlatformKeyboardEvent(GdkEventKey*, const CompositionResults&amp;);</span>
<span class="line-removed">158         GdkEventKey* gdkEventKey() const { return m_gdkEventKey; }</span>
<span class="line-removed">159         const CompositionResults&amp; compositionResults() const { return m_compositionResults; }</span>
<span class="line-removed">160 </span>
161         // Used by WebKit2
162         static String keyValueForGdkKeyCode(unsigned);
163         static String keyCodeForHardwareKeyCode(unsigned);
164         static String keyIdentifierForGdkKeyCode(unsigned);
165         static int windowsKeyCodeForGdkKeyCode(unsigned);
166         static String singleCharacterString(unsigned);
167         static bool modifiersContainCapsLock(unsigned);
168 #endif
169 
170 #if PLATFORM(JAVA)
171         PlatformKeyboardEvent(jint type, jstring text, jstring keyIdentifier,
172                               jint windowsVirtualKeyCode, jboolean shift,
173                               jboolean ctrl, jboolean alt, jboolean meta, jdouble timestamp);
174 #endif
175 
176 #if USE(LIBWPE)
177         static String keyValueForWPEKeyCode(unsigned);
178         static String keyCodeForHardwareKeyCode(unsigned);
179         static String keyIdentifierForWPEKeyCode(unsigned);
180         static int windowsKeyCodeForWPEKeyCode(unsigned);
181         static String singleCharacterString(unsigned);
182 #endif
183 
184     protected:
185         String m_text;
186         String m_unmodifiedText;
<span class="line-removed">187 #if ENABLE(KEYBOARD_KEY_ATTRIBUTE)</span>
188         String m_key;
<span class="line-removed">189 #endif</span>
<span class="line-removed">190 #if ENABLE(KEYBOARD_CODE_ATTRIBUTE)</span>
191         String m_code;
<span class="line-removed">192 #endif</span>
193         String m_keyIdentifier;
194         int m_windowsVirtualKeyCode;
<span class="line-modified">195 #if USE(APPKIT) || USE(UIKIT_KEYBOARD_ADDITIONS) || PLATFORM(GTK)</span>
196         bool m_handledByInputMethod { false };
197 #endif





198 #if USE(APPKIT)
199         Vector&lt;KeypressCommand&gt; m_commands;
200 #elif PLATFORM(GTK)
201         Vector&lt;String&gt; m_commands;
202 #endif
203         bool m_autoRepeat;
204         bool m_isKeypad;
205         bool m_isSystemKey;
206 
207         bool m_isSyntheticEvent { false };
208 
209 #if PLATFORM(COCOA)
210 #if !PLATFORM(IOS_FAMILY)
211         RetainPtr&lt;NSEvent&gt; m_macEvent;
212 #else
213         RetainPtr&lt;::WebEvent&gt; m_Event;
214 #endif
215 #endif
<span class="line-removed">216 #if PLATFORM(GTK)</span>
<span class="line-removed">217         GdkEventKey* m_gdkEventKey;</span>
<span class="line-removed">218         CompositionResults m_compositionResults;</span>
<span class="line-removed">219 #endif</span>
<span class="line-removed">220 </span>
221         // The modifier state is optional, since it is not needed in the UI process or in legacy WebKit.
222         static Optional&lt;OptionSet&lt;Modifier&gt;&gt; s_currentModifiers;
223     };
224 
225 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
  9  *    notice, this list of conditions and the following disclaimer.
 10  * 2. Redistributions in binary form must reproduce the above copyright
 11  *    notice, this list of conditions and the following disclaimer in the
 12  *    documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 15  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 16  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 18  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 19  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 20  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 21  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 22  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 24  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 25  */
 26 
 27 #pragma once
 28 
<span class="line-added"> 29 #include &quot;CompositionUnderline.h&quot;</span>
 30 #include &quot;KeypressCommand.h&quot;
 31 #include &quot;PlatformEvent.h&quot;
 32 #include &lt;wtf/WindowsExtras.h&gt;
 33 #include &lt;wtf/text/WTFString.h&gt;
 34 
 35 #if PLATFORM(COCOA)
 36 #include &lt;wtf/RetainPtr.h&gt;
 37 OBJC_CLASS NSEvent;
 38 #endif
 39 
 40 #if PLATFORM(IOS_FAMILY)
 41 OBJC_CLASS WebEvent;
 42 #endif
 43 





 44 #if PLATFORM(JAVA)
 45 #include &lt;jni.h&gt;
 46 #endif
 47 
 48 namespace WebCore {
 49 
 50     class PlatformKeyboardEvent : public PlatformEvent {
 51         WTF_MAKE_FAST_ALLOCATED;
 52     public:
 53         PlatformKeyboardEvent()
 54             : PlatformEvent(PlatformEvent::KeyDown)
 55             , m_windowsVirtualKeyCode(0)
 56             , m_autoRepeat(false)
 57             , m_isKeypad(false)
 58             , m_isSystemKey(false)



 59         {
 60         }
 61 
<span class="line-modified"> 62         PlatformKeyboardEvent(Type type, const String&amp; text, const String&amp; unmodifiedText, const String&amp; key, const String&amp; code,</span>






 63         const String&amp; keyIdentifier, int windowsVirtualKeyCode, bool isAutoRepeat, bool isKeypad, bool isSystemKey, OptionSet&lt;Modifier&gt; modifiers, WallTime timestamp)
 64             : PlatformEvent(type, modifiers, timestamp)
 65             , m_text(text)
 66             , m_unmodifiedText(unmodifiedText)

 67             , m_key(key)


 68             , m_code(code)

 69             , m_keyIdentifier(keyIdentifier)
 70             , m_windowsVirtualKeyCode(windowsVirtualKeyCode)
 71             , m_autoRepeat(isAutoRepeat)
 72             , m_isKeypad(isKeypad)
 73             , m_isSystemKey(isSystemKey)
 74         {
 75         }
 76 
 77         WEBCORE_EXPORT void disambiguateKeyDownEvent(Type, bool backwardCompatibilityMode = false); // Only used on platforms that need it, i.e. those that generate KeyDown events.
 78 
 79         // Text as as generated by processing a virtual key code with a keyboard layout
 80         // (in most cases, just a character code, but the layout can emit several
 81         // characters in a single keypress event on some platforms).
 82         // This may bear no resemblance to the ultimately inserted text if an input method
 83         // processes the input.
 84         // Will be null for KeyUp and RawKeyDown events.
 85         String text() const { return m_text; }
 86 
 87         // Text that would have been generated by the keyboard if no modifiers were pressed
 88         // (except for Shift); useful for shortcut (accelerator) key handling.
 89         // Otherwise, same as text().
 90         String unmodifiedText() const { return m_unmodifiedText; }
 91 
 92         String keyIdentifier() const { return m_keyIdentifier; }


 93         const String&amp; key() const { return m_key; }


 94         const String&amp; code() const { return m_code; }

 95 
 96         // Most compatible Windows virtual key code associated with the event.
 97         // Zero for Char events.
 98         int windowsVirtualKeyCode() const { return m_windowsVirtualKeyCode; }
 99         void setWindowsVirtualKeyCode(int code) { m_windowsVirtualKeyCode = code; }
100 
<span class="line-modified">101 #if USE(APPKIT) || USE(UIKIT_KEYBOARD_ADDITIONS) || PLATFORM(GTK) || USE(LIBWPE)</span>
102         bool handledByInputMethod() const { return m_handledByInputMethod; }
103 #endif
<span class="line-added">104 #if PLATFORM(GTK) || USE(LIBWPE)</span>
<span class="line-added">105         const Optional&lt;Vector&lt;WebCore::CompositionUnderline&gt;&gt;&amp; preeditUnderlines() const { return m_preeditUnderlines; }</span>
<span class="line-added">106         const Optional&lt;uint64_t&gt;&amp; preeditSelectionRangeStart() const { return m_preeditSelectionRangeStart; }</span>
<span class="line-added">107         const Optional&lt;uint64_t&gt;&amp; preeditSelectionRangeLength() const { return m_preeditSelectionRangeLength; }</span>
<span class="line-added">108 #endif</span>
109 #if USE(APPKIT)
110         const Vector&lt;KeypressCommand&gt;&amp; commands() const { return m_commands; }
111 #elif PLATFORM(GTK)
112         const Vector&lt;String&gt;&amp; commands() const { return m_commands; }
113 #endif
114 
115         bool isAutoRepeat() const { return m_autoRepeat; }
116         bool isKeypad() const { return m_isKeypad; }
117         bool isSystemKey() const { return m_isSystemKey; }
118 
119         bool isSyntheticEvent() const { return m_isSyntheticEvent; }
120         void setIsSyntheticEvent() { m_isSyntheticEvent = true; }
121 
122         WEBCORE_EXPORT static bool currentCapsLockState();
123         WEBCORE_EXPORT static void getCurrentModifierState(bool&amp; shiftKey, bool&amp; ctrlKey, bool&amp; altKey, bool&amp; metaKey);
124         WEBCORE_EXPORT static void setCurrentModifierState(OptionSet&lt;Modifier&gt;);
125         WEBCORE_EXPORT static OptionSet&lt;Modifier&gt; currentStateOfModifierKeys();
126 
127 #if PLATFORM(COCOA)
128 #if !PLATFORM(IOS_FAMILY)
129         NSEvent* macEvent() const { return m_macEvent.get(); }
130 #else
131         ::WebEvent *event() const { return m_Event.get(); }
132 #endif
133 #endif
134 
135 #if PLATFORM(WIN)
136         PlatformKeyboardEvent(HWND, WPARAM, LPARAM, Type, bool);
137 #endif
138 
139 #if PLATFORM(GTK)




140         // Used by WebKit2
141         static String keyValueForGdkKeyCode(unsigned);
142         static String keyCodeForHardwareKeyCode(unsigned);
143         static String keyIdentifierForGdkKeyCode(unsigned);
144         static int windowsKeyCodeForGdkKeyCode(unsigned);
145         static String singleCharacterString(unsigned);
146         static bool modifiersContainCapsLock(unsigned);
147 #endif
148 
149 #if PLATFORM(JAVA)
150         PlatformKeyboardEvent(jint type, jstring text, jstring keyIdentifier,
151                               jint windowsVirtualKeyCode, jboolean shift,
152                               jboolean ctrl, jboolean alt, jboolean meta, jdouble timestamp);
153 #endif
154 
155 #if USE(LIBWPE)
156         static String keyValueForWPEKeyCode(unsigned);
157         static String keyCodeForHardwareKeyCode(unsigned);
158         static String keyIdentifierForWPEKeyCode(unsigned);
159         static int windowsKeyCodeForWPEKeyCode(unsigned);
160         static String singleCharacterString(unsigned);
161 #endif
162 
163     protected:
164         String m_text;
165         String m_unmodifiedText;

166         String m_key;


167         String m_code;

168         String m_keyIdentifier;
169         int m_windowsVirtualKeyCode;
<span class="line-modified">170 #if USE(APPKIT) || USE(UIKIT_KEYBOARD_ADDITIONS) || PLATFORM(GTK) || USE(LIBWPE)</span>
171         bool m_handledByInputMethod { false };
172 #endif
<span class="line-added">173 #if PLATFORM(GTK) || USE(LIBWPE)</span>
<span class="line-added">174         Optional&lt;Vector&lt;WebCore::CompositionUnderline&gt;&gt; m_preeditUnderlines;</span>
<span class="line-added">175         Optional&lt;uint64_t&gt; m_preeditSelectionRangeStart;</span>
<span class="line-added">176         Optional&lt;uint64_t&gt; m_preeditSelectionRangeLength;</span>
<span class="line-added">177 #endif</span>
178 #if USE(APPKIT)
179         Vector&lt;KeypressCommand&gt; m_commands;
180 #elif PLATFORM(GTK)
181         Vector&lt;String&gt; m_commands;
182 #endif
183         bool m_autoRepeat;
184         bool m_isKeypad;
185         bool m_isSystemKey;
186 
187         bool m_isSyntheticEvent { false };
188 
189 #if PLATFORM(COCOA)
190 #if !PLATFORM(IOS_FAMILY)
191         RetainPtr&lt;NSEvent&gt; m_macEvent;
192 #else
193         RetainPtr&lt;::WebEvent&gt; m_Event;
194 #endif
195 #endif





196         // The modifier state is optional, since it is not needed in the UI process or in legacy WebKit.
197         static Optional&lt;OptionSet&lt;Modifier&gt;&gt; s_currentModifiers;
198     };
199 
200 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="PasteboardStrategy.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PlatformPasteboard.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>