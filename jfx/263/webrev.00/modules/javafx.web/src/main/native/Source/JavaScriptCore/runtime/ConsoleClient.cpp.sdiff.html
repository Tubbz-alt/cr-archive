<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ConsoleClient.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ConfigFile.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ConsoleClient.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ConsoleClient.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
130     builder.append(&#39; &#39;);
131     builder.append(levelString);
132 }
133 
134 void ConsoleClient::printConsoleMessage(MessageSource source, MessageType type, MessageLevel level, const String&amp; message, const String&amp; url, unsigned lineNumber, unsigned columnNumber)
135 {
136     StringBuilder builder;
137 
138     if (!url.isEmpty()) {
139         appendURLAndPosition(builder, url, lineNumber, columnNumber);
140         builder.appendLiteral(&quot;: &quot;);
141     }
142 
143     appendMessagePrefix(builder, source, type, level);
144     builder.append(&#39; &#39;);
145     builder.append(message);
146 
147     WTFLogAlways(&quot;%s&quot;, builder.toString().utf8().data());
148 }
149 
<span class="line-modified">150 void ConsoleClient::printConsoleMessageWithArguments(MessageSource source, MessageType type, MessageLevel level, JSC::ExecState* exec, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
151 {
152     bool isTraceMessage = type == MessageType::Trace;
153     size_t stackSize = isTraceMessage ? ScriptCallStack::maxCallStackSizeToCapture : 1;
<span class="line-modified">154     Ref&lt;ScriptCallStack&gt; callStack = createScriptCallStackForConsole(exec, stackSize);</span>
155     const ScriptCallFrame&amp; lastCaller = callStack-&gt;at(0);
156 
157     StringBuilder builder;
158 
159     if (!lastCaller.sourceURL().isEmpty()) {
160         appendURLAndPosition(builder, lastCaller.sourceURL(), lastCaller.lineNumber(), lastCaller.columnNumber());
161         builder.appendLiteral(&quot;: &quot;);
162     }
163 
164     appendMessagePrefix(builder, source, type, level);
165     for (size_t i = 0; i &lt; arguments-&gt;argumentCount(); ++i) {
166         builder.append(&#39; &#39;);
<span class="line-modified">167         auto* state = arguments-&gt;globalState();</span>
<span class="line-modified">168         auto scope = DECLARE_CATCH_SCOPE(state-&gt;vm());</span>
<span class="line-modified">169         builder.append(arguments-&gt;argumentAt(i).toWTFString(state));</span>
170         scope.clearException();
171     }
172 
173     WTFLogAlways(&quot;%s&quot;, builder.toString().utf8().data());
174 
175     if (isTraceMessage) {
176         for (size_t i = 0; i &lt; callStack-&gt;size(); ++i) {
177             const ScriptCallFrame&amp; callFrame = callStack-&gt;at(i);
178             String functionName = String(callFrame.functionName());
179             if (functionName.isEmpty())
180                 functionName = &quot;(unknown)&quot;_s;
181 
182             StringBuilder callFrameBuilder;
183             callFrameBuilder.appendNumber(i);
184             callFrameBuilder.appendLiteral(&quot;: &quot;);
185             callFrameBuilder.append(functionName);
186             callFrameBuilder.append(&#39;(&#39;);
187             appendURLAndPosition(callFrameBuilder, callFrame.sourceURL(), callFrame.lineNumber(), callFrame.columnNumber());
188             callFrameBuilder.append(&#39;)&#39;);
189 
190             WTFLogAlways(&quot;%s&quot;, callFrameBuilder.toString().utf8().data());
191         }
192     }
193 }
194 
<span class="line-modified">195 void ConsoleClient::internalMessageWithTypeAndLevel(MessageType type, MessageLevel level, JSC::ExecState* exec, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments, ArgumentRequirement argumentRequirement)</span>
196 {
197     if (argumentRequirement == ArgumentRequired &amp;&amp; !arguments-&gt;argumentCount())
198         return;
199 
<span class="line-modified">200     messageWithTypeAndLevel(type, level, exec, WTFMove(arguments));</span>
201 }
202 
<span class="line-modified">203 void ConsoleClient::logWithLevel(ExecState* exec, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments, MessageLevel level)</span>
204 {
<span class="line-modified">205     internalMessageWithTypeAndLevel(MessageType::Log, level, exec, WTFMove(arguments), ArgumentRequired);</span>
206 }
207 
<span class="line-modified">208 void ConsoleClient::clear(ExecState* exec)</span>
209 {
<span class="line-modified">210     internalMessageWithTypeAndLevel(MessageType::Clear, MessageLevel::Log, exec, ScriptArguments::create(*exec, { }), ArgumentNotRequired);</span>
211 }
212 
<span class="line-modified">213 void ConsoleClient::dir(ExecState* exec, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
214 {
<span class="line-modified">215     internalMessageWithTypeAndLevel(MessageType::Dir, MessageLevel::Log, exec, WTFMove(arguments), ArgumentRequired);</span>
216 }
217 
<span class="line-modified">218 void ConsoleClient::dirXML(ExecState* exec, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
219 {
<span class="line-modified">220     internalMessageWithTypeAndLevel(MessageType::DirXML, MessageLevel::Log, exec, WTFMove(arguments), ArgumentRequired);</span>
221 }
222 
<span class="line-modified">223 void ConsoleClient::table(ExecState* exec, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
224 {
<span class="line-modified">225     internalMessageWithTypeAndLevel(MessageType::Table, MessageLevel::Log, exec, WTFMove(arguments), ArgumentRequired);</span>
226 }
227 
<span class="line-modified">228 void ConsoleClient::trace(ExecState* exec, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
229 {
<span class="line-modified">230     internalMessageWithTypeAndLevel(MessageType::Trace, MessageLevel::Log, exec, WTFMove(arguments), ArgumentNotRequired);</span>
231 }
232 
<span class="line-modified">233 void ConsoleClient::assertion(ExecState* exec, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
234 {
<span class="line-modified">235     internalMessageWithTypeAndLevel(MessageType::Assert, MessageLevel::Error, exec, WTFMove(arguments), ArgumentNotRequired);</span>
236 }
237 
<span class="line-modified">238 void ConsoleClient::group(ExecState* exec, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
239 {
<span class="line-modified">240     internalMessageWithTypeAndLevel(MessageType::StartGroup, MessageLevel::Log, exec, WTFMove(arguments), ArgumentNotRequired);</span>
241 }
242 
<span class="line-modified">243 void ConsoleClient::groupCollapsed(ExecState* exec, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
244 {
<span class="line-modified">245     internalMessageWithTypeAndLevel(MessageType::StartGroupCollapsed, MessageLevel::Log, exec, WTFMove(arguments), ArgumentNotRequired);</span>
246 }
247 
<span class="line-modified">248 void ConsoleClient::groupEnd(ExecState* exec, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
249 {
<span class="line-modified">250     internalMessageWithTypeAndLevel(MessageType::EndGroup, MessageLevel::Log, exec, WTFMove(arguments), ArgumentNotRequired);</span>
251 }
252 
253 } // namespace JSC
</pre>
</td>
<td>
<hr />
<pre>
130     builder.append(&#39; &#39;);
131     builder.append(levelString);
132 }
133 
134 void ConsoleClient::printConsoleMessage(MessageSource source, MessageType type, MessageLevel level, const String&amp; message, const String&amp; url, unsigned lineNumber, unsigned columnNumber)
135 {
136     StringBuilder builder;
137 
138     if (!url.isEmpty()) {
139         appendURLAndPosition(builder, url, lineNumber, columnNumber);
140         builder.appendLiteral(&quot;: &quot;);
141     }
142 
143     appendMessagePrefix(builder, source, type, level);
144     builder.append(&#39; &#39;);
145     builder.append(message);
146 
147     WTFLogAlways(&quot;%s&quot;, builder.toString().utf8().data());
148 }
149 
<span class="line-modified">150 void ConsoleClient::printConsoleMessageWithArguments(MessageSource source, MessageType type, MessageLevel level, JSC::JSGlobalObject* globalObject, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
151 {
152     bool isTraceMessage = type == MessageType::Trace;
153     size_t stackSize = isTraceMessage ? ScriptCallStack::maxCallStackSizeToCapture : 1;
<span class="line-modified">154     Ref&lt;ScriptCallStack&gt; callStack = createScriptCallStackForConsole(globalObject, stackSize);</span>
155     const ScriptCallFrame&amp; lastCaller = callStack-&gt;at(0);
156 
157     StringBuilder builder;
158 
159     if (!lastCaller.sourceURL().isEmpty()) {
160         appendURLAndPosition(builder, lastCaller.sourceURL(), lastCaller.lineNumber(), lastCaller.columnNumber());
161         builder.appendLiteral(&quot;: &quot;);
162     }
163 
164     appendMessagePrefix(builder, source, type, level);
165     for (size_t i = 0; i &lt; arguments-&gt;argumentCount(); ++i) {
166         builder.append(&#39; &#39;);
<span class="line-modified">167         auto* globalObject = arguments-&gt;globalObject();</span>
<span class="line-modified">168         auto scope = DECLARE_CATCH_SCOPE(globalObject-&gt;vm());</span>
<span class="line-modified">169         builder.append(arguments-&gt;argumentAt(i).toWTFString(globalObject));</span>
170         scope.clearException();
171     }
172 
173     WTFLogAlways(&quot;%s&quot;, builder.toString().utf8().data());
174 
175     if (isTraceMessage) {
176         for (size_t i = 0; i &lt; callStack-&gt;size(); ++i) {
177             const ScriptCallFrame&amp; callFrame = callStack-&gt;at(i);
178             String functionName = String(callFrame.functionName());
179             if (functionName.isEmpty())
180                 functionName = &quot;(unknown)&quot;_s;
181 
182             StringBuilder callFrameBuilder;
183             callFrameBuilder.appendNumber(i);
184             callFrameBuilder.appendLiteral(&quot;: &quot;);
185             callFrameBuilder.append(functionName);
186             callFrameBuilder.append(&#39;(&#39;);
187             appendURLAndPosition(callFrameBuilder, callFrame.sourceURL(), callFrame.lineNumber(), callFrame.columnNumber());
188             callFrameBuilder.append(&#39;)&#39;);
189 
190             WTFLogAlways(&quot;%s&quot;, callFrameBuilder.toString().utf8().data());
191         }
192     }
193 }
194 
<span class="line-modified">195 void ConsoleClient::internalMessageWithTypeAndLevel(MessageType type, MessageLevel level, JSC::JSGlobalObject* globalObject, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments, ArgumentRequirement argumentRequirement)</span>
196 {
197     if (argumentRequirement == ArgumentRequired &amp;&amp; !arguments-&gt;argumentCount())
198         return;
199 
<span class="line-modified">200     messageWithTypeAndLevel(type, level, globalObject, WTFMove(arguments));</span>
201 }
202 
<span class="line-modified">203 void ConsoleClient::logWithLevel(JSGlobalObject* globalObject, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments, MessageLevel level)</span>
204 {
<span class="line-modified">205     internalMessageWithTypeAndLevel(MessageType::Log, level, globalObject, WTFMove(arguments), ArgumentRequired);</span>
206 }
207 
<span class="line-modified">208 void ConsoleClient::clear(JSGlobalObject* globalObject)</span>
209 {
<span class="line-modified">210     internalMessageWithTypeAndLevel(MessageType::Clear, MessageLevel::Log, globalObject, ScriptArguments::create(globalObject, { }), ArgumentNotRequired);</span>
211 }
212 
<span class="line-modified">213 void ConsoleClient::dir(JSGlobalObject* globalObject, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
214 {
<span class="line-modified">215     internalMessageWithTypeAndLevel(MessageType::Dir, MessageLevel::Log, globalObject, WTFMove(arguments), ArgumentRequired);</span>
216 }
217 
<span class="line-modified">218 void ConsoleClient::dirXML(JSGlobalObject* globalObject, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
219 {
<span class="line-modified">220     internalMessageWithTypeAndLevel(MessageType::DirXML, MessageLevel::Log, globalObject, WTFMove(arguments), ArgumentRequired);</span>
221 }
222 
<span class="line-modified">223 void ConsoleClient::table(JSGlobalObject* globalObject, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
224 {
<span class="line-modified">225     internalMessageWithTypeAndLevel(MessageType::Table, MessageLevel::Log, globalObject, WTFMove(arguments), ArgumentRequired);</span>
226 }
227 
<span class="line-modified">228 void ConsoleClient::trace(JSGlobalObject* globalObject, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
229 {
<span class="line-modified">230     internalMessageWithTypeAndLevel(MessageType::Trace, MessageLevel::Log, globalObject, WTFMove(arguments), ArgumentNotRequired);</span>
231 }
232 
<span class="line-modified">233 void ConsoleClient::assertion(JSGlobalObject* globalObject, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
234 {
<span class="line-modified">235     internalMessageWithTypeAndLevel(MessageType::Assert, MessageLevel::Error, globalObject, WTFMove(arguments), ArgumentNotRequired);</span>
236 }
237 
<span class="line-modified">238 void ConsoleClient::group(JSGlobalObject* globalObject, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
239 {
<span class="line-modified">240     internalMessageWithTypeAndLevel(MessageType::StartGroup, MessageLevel::Log, globalObject, WTFMove(arguments), ArgumentNotRequired);</span>
241 }
242 
<span class="line-modified">243 void ConsoleClient::groupCollapsed(JSGlobalObject* globalObject, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
244 {
<span class="line-modified">245     internalMessageWithTypeAndLevel(MessageType::StartGroupCollapsed, MessageLevel::Log, globalObject, WTFMove(arguments), ArgumentNotRequired);</span>
246 }
247 
<span class="line-modified">248 void ConsoleClient::groupEnd(JSGlobalObject* globalObject, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
249 {
<span class="line-modified">250     internalMessageWithTypeAndLevel(MessageType::EndGroup, MessageLevel::Log, globalObject, WTFMove(arguments), ArgumentNotRequired);</span>
251 }
252 
253 } // namespace JSC
</pre>
</td>
</tr>
</table>
<center><a href="ConfigFile.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ConsoleClient.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>