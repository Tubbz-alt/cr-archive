<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/PlatformWheelEvent.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PlatformScreen.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PopupMenu.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/PlatformWheelEvent.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;FloatPoint.h&quot;
 29 #include &quot;IntPoint.h&quot;
 30 #include &quot;PlatformEvent.h&quot;
 31 #include &lt;wtf/WindowsExtras.h&gt;
 32 
 33 #if PLATFORM(GTK)
 34 typedef struct _GdkEventScroll GdkEventScroll;
 35 #endif
 36 




 37 namespace WebCore {
 38 
 39 // The ScrollByPixelWheelEvent is a fine-grained event that specifies the precise number of pixels to scroll.
 40 // It is sent directly by touch pads on macOS, or synthesized when platforms generate line-by-line scrolling events.
 41 //
 42 // The ScrollByPageWheelEvent indicates that the wheel event should scroll an entire page.
 43 // In this case, WebKit built in paging behavior is used to page up and down.
 44 // This yields the same behavior as clicking in a scrollbar track to page up and down.
 45 
 46 enum PlatformWheelEventGranularity : uint8_t {
 47     ScrollByPageWheelEvent,
 48     ScrollByPixelWheelEvent,
 49 };
 50 
 51 #if ENABLE(KINETIC_SCROLLING)
 52 
 53 enum PlatformWheelEventPhase : uint8_t {
 54     PlatformWheelEventPhaseNone = 0,
 55     PlatformWheelEventPhaseBegan = 1 &lt;&lt; 0,
 56     PlatformWheelEventPhaseStationary = 1 &lt;&lt; 1,
 57     PlatformWheelEventPhaseChanged = 1 &lt;&lt; 2,
 58     PlatformWheelEventPhaseEnded = 1 &lt;&lt; 3,
 59     PlatformWheelEventPhaseCancelled = 1 &lt;&lt; 4,
 60     PlatformWheelEventPhaseMayBegin = 1 &lt;&lt; 5,
 61 };
 62 


 63 #endif
 64 
 65 #if PLATFORM(WIN)
 66 // How many pixels should we scroll per line? Gecko uses the height of the
 67 // current line, which means scroll distance changes as you go through the
 68 // page or go to different pages. IE 7 is ~50 px/line, although the value
 69 // seems to vary slightly by page and zoom level. Since IE 7 has a
 70 // smoothing algorithm on scrolling, it can get away with slightly larger
 71 // scroll values without feeling jerky. Here we use 100 px per three lines
 72 // (the default scroll amount on Windows is three lines per wheel tick).
 73 const float cScrollbarPixelsPerLine = 100.0f / 3.0f;
 74 #endif
 75 
 76 class PlatformWheelEvent : public PlatformEvent {
 77 public:
 78     PlatformWheelEvent()
 79         : PlatformEvent(PlatformEvent::Wheel)
 80     {
 81     }
 82 
</pre>
<hr />
<pre>
139 
140 #if ENABLE(ASYNC_SCROLLING)
141     bool useLatchedEventElement() const;
142     bool shouldConsiderLatching() const;
143     bool shouldResetLatching() const;
144     bool isEndOfMomentumScroll() const;
145 #else
146     bool useLatchedEventElement() const { return false; }
147 #endif
148 
149 #if ENABLE(KINETIC_SCROLLING)
150     PlatformWheelEventPhase phase() const { return m_phase; }
151     PlatformWheelEventPhase momentumPhase() const { return m_momentumPhase; }
152     bool isEndOfNonMomentumScroll() const;
153     bool isTransitioningToMomentumScroll() const;
154     FloatPoint swipeVelocity() const;
155 #endif
156 
157 #if PLATFORM(WIN)
158     PlatformWheelEvent(HWND, WPARAM, LPARAM, bool isMouseHWheel);
<span class="line-removed">159     PlatformWheelEvent(HWND, const FloatSize&amp; delta, const FloatPoint&amp; location);</span>
160 #endif
161 
162 #if PLATFORM(JAVA)
163     PlatformWheelEvent(const IntPoint&amp; pos, const IntPoint&amp; globalPos,
164                        float deltaX, float deltaY,
165                        bool shift, bool ctrl, bool alt, bool meta);
166 
167 #endif
168 protected:
169     IntPoint m_position;
170     IntPoint m_globalPosition;
171     float m_deltaX { 0 };
172     float m_deltaY { 0 };
173     float m_wheelTicksX { 0 };
174     float m_wheelTicksY { 0 };
175     PlatformWheelEventGranularity m_granularity { ScrollByPixelWheelEvent };
176     bool m_directionInvertedFromDevice { false };
177 
178     // Scrolling velocity in pixels per second.
179     FloatSize m_scrollingVelocity;
</pre>
<hr />
<pre>
221 #if ENABLE(KINETIC_SCROLLING)
222 
223 inline bool PlatformWheelEvent::isEndOfNonMomentumScroll() const
224 {
225     return m_phase == PlatformWheelEventPhaseEnded &amp;&amp; m_momentumPhase == PlatformWheelEventPhaseNone;
226 }
227 
228 inline bool PlatformWheelEvent::isTransitioningToMomentumScroll() const
229 {
230     return m_phase == PlatformWheelEventPhaseNone &amp;&amp; m_momentumPhase == PlatformWheelEventPhaseBegan;
231 }
232 
233 inline FloatPoint PlatformWheelEvent::swipeVelocity() const
234 {
235     // The swiping velocity is stored in the deltas of the event declaring it.
236     return isTransitioningToMomentumScroll() ? FloatPoint(m_wheelTicksX, m_wheelTicksY) : FloatPoint();
237 }
238 
239 #endif // ENABLE(KINETIC_SCROLLING)
240 


241 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;FloatPoint.h&quot;
 29 #include &quot;IntPoint.h&quot;
 30 #include &quot;PlatformEvent.h&quot;
 31 #include &lt;wtf/WindowsExtras.h&gt;
 32 
 33 #if PLATFORM(GTK)
 34 typedef struct _GdkEventScroll GdkEventScroll;
 35 #endif
 36 
<span class="line-added"> 37 namespace WTF {</span>
<span class="line-added"> 38 class TextStream;</span>
<span class="line-added"> 39 }</span>
<span class="line-added"> 40 </span>
 41 namespace WebCore {
 42 
 43 // The ScrollByPixelWheelEvent is a fine-grained event that specifies the precise number of pixels to scroll.
 44 // It is sent directly by touch pads on macOS, or synthesized when platforms generate line-by-line scrolling events.
 45 //
 46 // The ScrollByPageWheelEvent indicates that the wheel event should scroll an entire page.
 47 // In this case, WebKit built in paging behavior is used to page up and down.
 48 // This yields the same behavior as clicking in a scrollbar track to page up and down.
 49 
 50 enum PlatformWheelEventGranularity : uint8_t {
 51     ScrollByPageWheelEvent,
 52     ScrollByPixelWheelEvent,
 53 };
 54 
 55 #if ENABLE(KINETIC_SCROLLING)
 56 
 57 enum PlatformWheelEventPhase : uint8_t {
 58     PlatformWheelEventPhaseNone = 0,
 59     PlatformWheelEventPhaseBegan = 1 &lt;&lt; 0,
 60     PlatformWheelEventPhaseStationary = 1 &lt;&lt; 1,
 61     PlatformWheelEventPhaseChanged = 1 &lt;&lt; 2,
 62     PlatformWheelEventPhaseEnded = 1 &lt;&lt; 3,
 63     PlatformWheelEventPhaseCancelled = 1 &lt;&lt; 4,
 64     PlatformWheelEventPhaseMayBegin = 1 &lt;&lt; 5,
 65 };
 66 
<span class="line-added"> 67 WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, PlatformWheelEventPhase);</span>
<span class="line-added"> 68 </span>
 69 #endif
 70 
 71 #if PLATFORM(WIN)
 72 // How many pixels should we scroll per line? Gecko uses the height of the
 73 // current line, which means scroll distance changes as you go through the
 74 // page or go to different pages. IE 7 is ~50 px/line, although the value
 75 // seems to vary slightly by page and zoom level. Since IE 7 has a
 76 // smoothing algorithm on scrolling, it can get away with slightly larger
 77 // scroll values without feeling jerky. Here we use 100 px per three lines
 78 // (the default scroll amount on Windows is three lines per wheel tick).
 79 const float cScrollbarPixelsPerLine = 100.0f / 3.0f;
 80 #endif
 81 
 82 class PlatformWheelEvent : public PlatformEvent {
 83 public:
 84     PlatformWheelEvent()
 85         : PlatformEvent(PlatformEvent::Wheel)
 86     {
 87     }
 88 
</pre>
<hr />
<pre>
145 
146 #if ENABLE(ASYNC_SCROLLING)
147     bool useLatchedEventElement() const;
148     bool shouldConsiderLatching() const;
149     bool shouldResetLatching() const;
150     bool isEndOfMomentumScroll() const;
151 #else
152     bool useLatchedEventElement() const { return false; }
153 #endif
154 
155 #if ENABLE(KINETIC_SCROLLING)
156     PlatformWheelEventPhase phase() const { return m_phase; }
157     PlatformWheelEventPhase momentumPhase() const { return m_momentumPhase; }
158     bool isEndOfNonMomentumScroll() const;
159     bool isTransitioningToMomentumScroll() const;
160     FloatPoint swipeVelocity() const;
161 #endif
162 
163 #if PLATFORM(WIN)
164     PlatformWheelEvent(HWND, WPARAM, LPARAM, bool isMouseHWheel);

165 #endif
166 
167 #if PLATFORM(JAVA)
168     PlatformWheelEvent(const IntPoint&amp; pos, const IntPoint&amp; globalPos,
169                        float deltaX, float deltaY,
170                        bool shift, bool ctrl, bool alt, bool meta);
171 
172 #endif
173 protected:
174     IntPoint m_position;
175     IntPoint m_globalPosition;
176     float m_deltaX { 0 };
177     float m_deltaY { 0 };
178     float m_wheelTicksX { 0 };
179     float m_wheelTicksY { 0 };
180     PlatformWheelEventGranularity m_granularity { ScrollByPixelWheelEvent };
181     bool m_directionInvertedFromDevice { false };
182 
183     // Scrolling velocity in pixels per second.
184     FloatSize m_scrollingVelocity;
</pre>
<hr />
<pre>
226 #if ENABLE(KINETIC_SCROLLING)
227 
228 inline bool PlatformWheelEvent::isEndOfNonMomentumScroll() const
229 {
230     return m_phase == PlatformWheelEventPhaseEnded &amp;&amp; m_momentumPhase == PlatformWheelEventPhaseNone;
231 }
232 
233 inline bool PlatformWheelEvent::isTransitioningToMomentumScroll() const
234 {
235     return m_phase == PlatformWheelEventPhaseNone &amp;&amp; m_momentumPhase == PlatformWheelEventPhaseBegan;
236 }
237 
238 inline FloatPoint PlatformWheelEvent::swipeVelocity() const
239 {
240     // The swiping velocity is stored in the deltas of the event declaring it.
241     return isTransitioningToMomentumScroll() ? FloatPoint(m_wheelTicksX, m_wheelTicksY) : FloatPoint();
242 }
243 
244 #endif // ENABLE(KINETIC_SCROLLING)
245 
<span class="line-added">246 WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, const PlatformWheelEvent&amp;);</span>
<span class="line-added">247 </span>
248 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="PlatformScreen.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PopupMenu.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>