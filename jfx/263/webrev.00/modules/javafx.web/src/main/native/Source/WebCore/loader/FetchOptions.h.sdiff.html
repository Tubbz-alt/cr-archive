<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/loader/FetchOptions.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="EmptyFrameLoaderClient.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FormSubmission.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/loader/FetchOptions.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 13  * 3.  Neither the name of Canon Inc. nor the names of
 14  *     its contributors may be used to endorse or promote products derived
 15  *     from this software without specific prior written permission.
 16  *
 17  * THIS SOFTWARE IS PROVIDED BY CANON INC. AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 18  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 19  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 20  * DISCLAIMED. IN NO EVENT SHALL CANON INC. AND ITS CONTRIBUTORS BE LIABLE FOR
 21  * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 22  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 23  * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 24  * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 25  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 26  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 27  */
 28 
 29 #pragma once
 30 
 31 #include &quot;DocumentIdentifier.h&quot;
 32 #include &quot;ReferrerPolicy.h&quot;

 33 #include &lt;wtf/text/WTFString.h&gt;
 34 
 35 namespace WebCore {
 36 
 37 struct FetchOptions {
 38     enum class Destination : uint8_t { EmptyString, Audio, Document, Embed, Font, Image, Manifest, Object, Report, Script, Serviceworker, Sharedworker, Style, Track, Video, Worker, Xslt };
 39     enum class Mode : uint8_t { Navigate, SameOrigin, NoCors, Cors };
 40     enum class Credentials : uint8_t { Omit, SameOrigin, Include };
 41     enum class Cache : uint8_t { Default, NoStore, Reload, NoCache, ForceCache, OnlyIfCached };
 42     enum class Redirect : uint8_t { Follow, Error, Manual };
 43 
 44     FetchOptions() = default;
 45     FetchOptions(Destination, Mode, Credentials, Cache, Redirect, ReferrerPolicy, String&amp;&amp;, bool);
 46     FetchOptions isolatedCopy() const { return { destination, mode, credentials, cache, redirect, referrerPolicy, integrity.isolatedCopy(), keepAlive }; }
 47 
 48     template&lt;class Encoder&gt; void encodePersistent(Encoder&amp;) const;
 49     template&lt;class Decoder&gt; static bool decodePersistent(Decoder&amp;, FetchOptions&amp;);
 50     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
 51     template&lt;class Decoder&gt; static Optional&lt;FetchOptions&gt; decode(Decoder&amp;);
 52 
 53     Destination destination { Destination::EmptyString };
 54     Mode mode { Mode::NoCors };
 55     Credentials credentials { Credentials::Omit };
 56     Cache cache { Cache::Default };
 57     Redirect redirect { Redirect::Follow };
 58     ReferrerPolicy referrerPolicy { ReferrerPolicy::EmptyString };
 59     bool keepAlive { false };
 60     String integrity;
<span class="line-modified"> 61     Optional&lt;DocumentIdentifier&gt; clientIdentifier;</span>
 62 };
 63 
 64 inline FetchOptions::FetchOptions(Destination destination, Mode mode, Credentials credentials, Cache cache, Redirect redirect, ReferrerPolicy referrerPolicy, String&amp;&amp; integrity, bool keepAlive)
 65     : destination(destination)
 66     , mode(mode)
 67     , credentials(credentials)
 68     , cache(cache)
 69     , redirect(redirect)
 70     , referrerPolicy(referrerPolicy)
 71     , keepAlive(keepAlive)
 72     , integrity(WTFMove(integrity))
 73 {
 74 }
 75 
 76 inline bool isPotentialNavigationOrSubresourceRequest(FetchOptions::Destination destination)
 77 {
 78     return destination == FetchOptions::Destination::Object
 79         || destination == FetchOptions::Destination::Embed;
 80 }
 81 
</pre>
<hr />
<pre>
211 
212     bool keepAlive;
213     if (!decoder.decode(keepAlive))
214         return false;
215 
216     options.destination = destination;
217     options.mode = mode;
218     options.credentials = credentials;
219     options.cache = cache;
220     options.redirect = redirect;
221     options.referrerPolicy = referrerPolicy;
222     options.integrity = WTFMove(integrity);
223     options.keepAlive = keepAlive;
224 
225     return true;
226 }
227 
228 template&lt;class Encoder&gt; inline void FetchOptions::encode(Encoder&amp; encoder) const
229 {
230     encodePersistent(encoder);
<span class="line-modified">231     encoder &lt;&lt; clientIdentifier;</span>
232 }
233 
234 template&lt;class Decoder&gt; inline Optional&lt;FetchOptions&gt; FetchOptions::decode(Decoder&amp; decoder)
235 {
236     FetchOptions options;
237     if (!decodePersistent(decoder, options))
238         return WTF::nullopt;
239 
240     Optional&lt;Optional&lt;DocumentIdentifier&gt;&gt; clientIdentifier;
241     decoder &gt;&gt; clientIdentifier;
242     if (!clientIdentifier)
243         return WTF::nullopt;
244     options.clientIdentifier = WTFMove(clientIdentifier.value());
245 
246     return options;
247 }
248 
249 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
 13  * 3.  Neither the name of Canon Inc. nor the names of
 14  *     its contributors may be used to endorse or promote products derived
 15  *     from this software without specific prior written permission.
 16  *
 17  * THIS SOFTWARE IS PROVIDED BY CANON INC. AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 18  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 19  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 20  * DISCLAIMED. IN NO EVENT SHALL CANON INC. AND ITS CONTRIBUTORS BE LIABLE FOR
 21  * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 22  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 23  * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 24  * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 25  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 26  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 27  */
 28 
 29 #pragma once
 30 
 31 #include &quot;DocumentIdentifier.h&quot;
 32 #include &quot;ReferrerPolicy.h&quot;
<span class="line-added"> 33 #include &lt;wtf/Markable.h&gt;</span>
 34 #include &lt;wtf/text/WTFString.h&gt;
 35 
 36 namespace WebCore {
 37 
 38 struct FetchOptions {
 39     enum class Destination : uint8_t { EmptyString, Audio, Document, Embed, Font, Image, Manifest, Object, Report, Script, Serviceworker, Sharedworker, Style, Track, Video, Worker, Xslt };
 40     enum class Mode : uint8_t { Navigate, SameOrigin, NoCors, Cors };
 41     enum class Credentials : uint8_t { Omit, SameOrigin, Include };
 42     enum class Cache : uint8_t { Default, NoStore, Reload, NoCache, ForceCache, OnlyIfCached };
 43     enum class Redirect : uint8_t { Follow, Error, Manual };
 44 
 45     FetchOptions() = default;
 46     FetchOptions(Destination, Mode, Credentials, Cache, Redirect, ReferrerPolicy, String&amp;&amp;, bool);
 47     FetchOptions isolatedCopy() const { return { destination, mode, credentials, cache, redirect, referrerPolicy, integrity.isolatedCopy(), keepAlive }; }
 48 
 49     template&lt;class Encoder&gt; void encodePersistent(Encoder&amp;) const;
 50     template&lt;class Decoder&gt; static bool decodePersistent(Decoder&amp;, FetchOptions&amp;);
 51     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
 52     template&lt;class Decoder&gt; static Optional&lt;FetchOptions&gt; decode(Decoder&amp;);
 53 
 54     Destination destination { Destination::EmptyString };
 55     Mode mode { Mode::NoCors };
 56     Credentials credentials { Credentials::Omit };
 57     Cache cache { Cache::Default };
 58     Redirect redirect { Redirect::Follow };
 59     ReferrerPolicy referrerPolicy { ReferrerPolicy::EmptyString };
 60     bool keepAlive { false };
 61     String integrity;
<span class="line-modified"> 62     Markable&lt;DocumentIdentifier, DocumentIdentifier::MarkableTraits&gt; clientIdentifier;</span>
 63 };
 64 
 65 inline FetchOptions::FetchOptions(Destination destination, Mode mode, Credentials credentials, Cache cache, Redirect redirect, ReferrerPolicy referrerPolicy, String&amp;&amp; integrity, bool keepAlive)
 66     : destination(destination)
 67     , mode(mode)
 68     , credentials(credentials)
 69     , cache(cache)
 70     , redirect(redirect)
 71     , referrerPolicy(referrerPolicy)
 72     , keepAlive(keepAlive)
 73     , integrity(WTFMove(integrity))
 74 {
 75 }
 76 
 77 inline bool isPotentialNavigationOrSubresourceRequest(FetchOptions::Destination destination)
 78 {
 79     return destination == FetchOptions::Destination::Object
 80         || destination == FetchOptions::Destination::Embed;
 81 }
 82 
</pre>
<hr />
<pre>
212 
213     bool keepAlive;
214     if (!decoder.decode(keepAlive))
215         return false;
216 
217     options.destination = destination;
218     options.mode = mode;
219     options.credentials = credentials;
220     options.cache = cache;
221     options.redirect = redirect;
222     options.referrerPolicy = referrerPolicy;
223     options.integrity = WTFMove(integrity);
224     options.keepAlive = keepAlive;
225 
226     return true;
227 }
228 
229 template&lt;class Encoder&gt; inline void FetchOptions::encode(Encoder&amp; encoder) const
230 {
231     encodePersistent(encoder);
<span class="line-modified">232     encoder &lt;&lt; clientIdentifier.asOptional();</span>
233 }
234 
235 template&lt;class Decoder&gt; inline Optional&lt;FetchOptions&gt; FetchOptions::decode(Decoder&amp; decoder)
236 {
237     FetchOptions options;
238     if (!decodePersistent(decoder, options))
239         return WTF::nullopt;
240 
241     Optional&lt;Optional&lt;DocumentIdentifier&gt;&gt; clientIdentifier;
242     decoder &gt;&gt; clientIdentifier;
243     if (!clientIdentifier)
244         return WTF::nullopt;
245     options.clientIdentifier = WTFMove(clientIdentifier.value());
246 
247     return options;
248 }
249 
250 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="EmptyFrameLoaderClient.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FormSubmission.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>