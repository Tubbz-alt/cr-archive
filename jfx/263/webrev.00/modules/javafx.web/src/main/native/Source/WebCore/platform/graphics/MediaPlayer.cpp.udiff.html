<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/MediaPlayer.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MediaPlaybackTargetPicker.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaPlayer.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/MediaPlayer.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (C) 2007-2018 Apple Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2007-2019 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -93,18 +93,10 @@</span>
  #include &quot;MediaPlayerPrivateHolePunch.h&quot;
  #endif
  
  namespace WebCore {
  
<span class="udiff-line-removed">- #if !RELEASE_LOG_DISABLED</span>
<span class="udiff-line-removed">- static RefPtr&lt;Logger&gt;&amp; nullLogger()</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     static NeverDestroyed&lt;RefPtr&lt;Logger&gt;&gt; logger;</span>
<span class="udiff-line-removed">-     return logger;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
  // a null player to make MediaPlayer logic simpler
  
  class NullMediaPlayerPrivate final : public MediaPlayerPrivateInterface {
  public:
      explicit NullMediaPlayerPrivate(MediaPlayer*) { }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -120,11 +112,11 @@</span>
  
      void prepareToPlay() final { }
      void play() final { }
      void pause() final { }
  
<span class="udiff-line-modified-removed">-     PlatformLayer* platformLayer() const final { return 0; }</span>
<span class="udiff-line-modified-added">+     PlatformLayer* platformLayer() const final { return nullptr; }</span>
  
      FloatSize naturalSize() const final { return FloatSize(); }
  
      bool hasVideo() const final { return false; }
      bool hasAudio() const final { return false; }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -146,12 +138,12 @@</span>
      void setMuted(bool) final { }
  
      bool hasClosedCaptions() const final { return false; }
      void setClosedCaptionsVisible(bool) final { };
  
<span class="udiff-line-modified-removed">-     MediaPlayer::NetworkState networkState() const final { return MediaPlayer::Empty; }</span>
<span class="udiff-line-modified-removed">-     MediaPlayer::ReadyState readyState() const final { return MediaPlayer::HaveNothing; }</span>
<span class="udiff-line-modified-added">+     MediaPlayer::NetworkState networkState() const final { return MediaPlayer::NetworkState::Empty; }</span>
<span class="udiff-line-modified-added">+     MediaPlayer::ReadyState readyState() const final { return MediaPlayer::ReadyState::HaveNothing; }</span>
  
      float maxTimeSeekable() const final { return 0; }
      double minTimeSeekable() const final { return 0; }
      std::unique_ptr&lt;PlatformTimeRanges&gt; buffered() const final { return makeUnique&lt;PlatformTimeRanges&gt;(); }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -163,18 +155,29 @@</span>
  
      void setSize(const IntSize&amp;) final { }
  
      void paint(GraphicsContext&amp;, const FloatRect&amp;) final { }
  
<span class="udiff-line-removed">-     bool canLoadPoster() const final { return false; }</span>
<span class="udiff-line-removed">-     void setPoster(const String&amp;) final { }</span>
<span class="udiff-line-removed">- </span>
      bool hasSingleSecurityOrigin() const final { return true; }
  };
  
<span class="udiff-line-added">+ #if !RELEASE_LOG_DISABLED</span>
<span class="udiff-line-added">+ static RefPtr&lt;Logger&gt;&amp; nullLogger()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     static NeverDestroyed&lt;RefPtr&lt;Logger&gt;&gt; logger;</span>
<span class="udiff-line-added">+     return logger;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ static const Vector&lt;WebCore::ContentType&gt;&amp; nullContentTypeVector()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     static NeverDestroyed&lt;Vector&lt;WebCore::ContentType&gt;&gt; vector;</span>
<span class="udiff-line-added">+     return vector;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  class NullMediaPlayerClient : public MediaPlayerClient {
<span class="udiff-line-modified-removed">- public:</span>
<span class="udiff-line-modified-added">+ private:</span>
  #if !RELEASE_LOG_DISABLED
      const Logger&amp; mediaPlayerLogger() final
      {
          if (!nullLogger().get()) {
              nullLogger() = Logger::create(this);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -182,12 +185,15 @@</span>
          }
  
          return *nullLogger().get();
      }
  #endif
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     const Vector&lt;WebCore::ContentType&gt;&amp; mediaContentTypesRequiringHardwareSupport() const final { return nullContentTypeVector(); }</span>
  };
  
<span class="udiff-line-added">+ </span>
  const Vector&lt;ContentType&gt;&amp; MediaPlayerClient::mediaContentTypesRequiringHardwareSupport() const
  {
      static NeverDestroyed&lt;Vector&lt;ContentType&gt;&gt; contentTypes;
      return contentTypes;
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -198,45 +204,51 @@</span>
      return client.get();
  }
  
  // engine support
  
<span class="udiff-line-modified-removed">- struct MediaPlayerFactory {</span>
<span class="udiff-line-removed">-     CreateMediaEnginePlayer constructor;</span>
<span class="udiff-line-removed">-     MediaEngineSupportedTypes getSupportedTypes;</span>
<span class="udiff-line-removed">-     MediaEngineSupportsType supportsTypeAndCodecs;</span>
<span class="udiff-line-removed">-     MediaEngineOriginsInMediaCache originsInMediaCache;</span>
<span class="udiff-line-removed">-     MediaEngineClearMediaCache clearMediaCache;</span>
<span class="udiff-line-removed">-     MediaEngineClearMediaCacheForOrigins clearMediaCacheForOrigins;</span>
<span class="udiff-line-removed">-     MediaEngineSupportsKeySystem supportsKeySystem;</span>
<span class="udiff-line-removed">- };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- static void addMediaEngine(CreateMediaEnginePlayer&amp;&amp;, MediaEngineSupportedTypes, MediaEngineSupportsType, MediaEngineOriginsInMediaCache, MediaEngineClearMediaCache, MediaEngineClearMediaCacheForOrigins, MediaEngineSupportsKeySystem);</span>
<span class="udiff-line-modified-added">+ static void addMediaEngine(std::unique_ptr&lt;MediaPlayerFactory&gt;&amp;&amp;);</span>
  
  static Lock mediaEngineVectorLock;
  
  static bool&amp; haveMediaEnginesVector()
  {
      static bool haveVector;
      return haveVector;
  }
  
<span class="udiff-line-modified-removed">- static Vector&lt;MediaPlayerFactory&gt;&amp; mutableInstalledMediaEnginesVector()</span>
<span class="udiff-line-modified-added">+ static Vector&lt;std::unique_ptr&lt;MediaPlayerFactory&gt;&gt;&amp; mutableInstalledMediaEnginesVector()</span>
  {
<span class="udiff-line-modified-removed">-     static NeverDestroyed&lt;Vector&lt;MediaPlayerFactory&gt;&gt; installedEngines;</span>
<span class="udiff-line-modified-added">+     static NeverDestroyed&lt;Vector&lt;std::unique_ptr&lt;MediaPlayerFactory&gt;&gt;&gt; installedEngines;</span>
      return installedEngines;
  }
  
<span class="udiff-line-added">+ static RemoteMediaPlayerSupport::RegisterRemotePlayerCallback&amp; registerRemotePlayerCallback()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     static NeverDestroyed&lt;RemoteMediaPlayerSupport::RegisterRemotePlayerCallback&gt; callback;</span>
<span class="udiff-line-added">+     return callback;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void RemoteMediaPlayerSupport::setRegisterRemotePlayerCallback(RegisterRemotePlayerCallback&amp;&amp; callback)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     registerRemotePlayerCallback() = WTFMove(callback);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  static void buildMediaEnginesVector()
  {
      ASSERT(mediaEngineVectorLock.isLocked());
  
  #if USE(AVFOUNDATION)
<span class="udiff-line-added">+ </span>
      if (DeprecatedGlobalSettings::isAVFoundationEnabled()) {
  
<span class="udiff-line-added">+         auto&amp; registerRemoteEngine = registerRemotePlayerCallback();</span>
  #if PLATFORM(COCOA)
<span class="udiff-line-modified-removed">-         MediaPlayerPrivateAVFoundationObjC::registerMediaEngine(addMediaEngine);</span>
<span class="udiff-line-modified-added">+         if (registerRemoteEngine)</span>
<span class="udiff-line-added">+             registerRemoteEngine(addMediaEngine, MediaPlayerEnums::MediaEngineIdentifier::AVFoundation);</span>
<span class="udiff-line-added">+         else</span>
<span class="udiff-line-added">+             MediaPlayerPrivateAVFoundationObjC::registerMediaEngine(addMediaEngine);</span>
  #endif
  
  #if ENABLE(MEDIA_SOURCE)
          MediaPlayerPrivateMediaSourceAVFObjC::registerMediaEngine(addMediaEngine);
  #endif
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -268,29 +280,24 @@</span>
  #endif
  
      haveMediaEnginesVector() = true;
  }
  
<span class="udiff-line-modified-removed">- static const Vector&lt;MediaPlayerFactory&gt;&amp; installedMediaEngines()</span>
<span class="udiff-line-modified-added">+ static const Vector&lt;std::unique_ptr&lt;MediaPlayerFactory&gt;&gt;&amp; installedMediaEngines()</span>
  {
      {
          auto locker = holdLock(mediaEngineVectorLock);
          if (!haveMediaEnginesVector())
              buildMediaEnginesVector();
      }
  
      return mutableInstalledMediaEnginesVector();
  }
  
<span class="udiff-line-modified-removed">- static void addMediaEngine(CreateMediaEnginePlayer&amp;&amp; constructor, MediaEngineSupportedTypes getSupportedTypes, MediaEngineSupportsType supportsType,</span>
<span class="udiff-line-removed">-     MediaEngineOriginsInMediaCache originsInMediaCache, MediaEngineClearMediaCache clearMediaCache, MediaEngineClearMediaCacheForOrigins clearMediaCacheForOrigins, MediaEngineSupportsKeySystem supportsKeySystem)</span>
<span class="udiff-line-modified-added">+ static void addMediaEngine(std::unique_ptr&lt;MediaPlayerFactory&gt;&amp;&amp; factory)</span>
  {
<span class="udiff-line-modified-removed">-     ASSERT(constructor);</span>
<span class="udiff-line-removed">-     ASSERT(getSupportedTypes);</span>
<span class="udiff-line-removed">-     ASSERT(supportsType);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     mutableInstalledMediaEnginesVector().append(MediaPlayerFactory { WTFMove(constructor), getSupportedTypes, supportsType, originsInMediaCache, clearMediaCache, clearMediaCacheForOrigins, supportsKeySystem });</span>
<span class="udiff-line-modified-added">+     mutableInstalledMediaEnginesVector().append(WTFMove(factory));</span>
  }
  
  static const AtomString&amp; applicationOctetStream()
  {
      static NeverDestroyed&lt;const AtomString&gt; applicationOctetStream(&quot;application/octet-stream&quot;, AtomString::ConstructFromLiteral);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -301,10 +308,25 @@</span>
  {
      static NeverDestroyed&lt;const AtomString&gt; textPlain(&quot;text/plain&quot;, AtomString::ConstructFromLiteral);
      return textPlain;
  }
  
<span class="udiff-line-added">+ const MediaPlayerFactory* MediaPlayer::mediaEngine(MediaPlayerEnums::MediaEngineIdentifier identifier)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     auto&amp; engines = installedMediaEngines();</span>
<span class="udiff-line-added">+     auto currentIndex = engines.findMatching([identifier] (auto&amp; engine) {</span>
<span class="udiff-line-added">+         return engine-&gt;identifier() == identifier;</span>
<span class="udiff-line-added">+     });</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (currentIndex == notFound) {</span>
<span class="udiff-line-added">+         ASSERT_NOT_REACHED();</span>
<span class="udiff-line-added">+         return nullptr;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return engines[currentIndex].get();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  static const MediaPlayerFactory* bestMediaEngineForSupportParameters(const MediaEngineSupportParameters&amp; parameters, const MediaPlayerFactory* current = nullptr)
  {
      if (parameters.type.isEmpty() &amp;&amp; !parameters.isMediaSource &amp;&amp; !parameters.isMediaStream)
          return nullptr;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -315,57 +337,82 @@</span>
          if (!parameters.type.codecs().isEmpty())
              return nullptr;
      }
  
      const MediaPlayerFactory* foundEngine = nullptr;
<span class="udiff-line-modified-removed">-     MediaPlayer::SupportsType supported = MediaPlayer::IsNotSupported;</span>
<span class="udiff-line-modified-added">+     MediaPlayer::SupportsType supported = MediaPlayer::SupportsType::IsNotSupported;</span>
      for (auto&amp; engine : installedMediaEngines()) {
          if (current) {
<span class="udiff-line-modified-removed">-             if (current == &amp;engine)</span>
<span class="udiff-line-modified-added">+             if (current == engine.get())</span>
                  current = nullptr;
              continue;
          }
<span class="udiff-line-modified-removed">-         MediaPlayer::SupportsType engineSupport = engine.supportsTypeAndCodecs(parameters);</span>
<span class="udiff-line-modified-added">+         MediaPlayer::SupportsType engineSupport = engine-&gt;supportsTypeAndCodecs(parameters);</span>
          if (engineSupport &gt; supported) {
              supported = engineSupport;
<span class="udiff-line-modified-removed">-             foundEngine = &amp;engine;</span>
<span class="udiff-line-modified-added">+             foundEngine = engine.get();</span>
          }
      }
  
      return foundEngine;
  }
  
<span class="udiff-line-modified-removed">- static const MediaPlayerFactory* nextMediaEngine(const MediaPlayerFactory* current)</span>
<span class="udiff-line-modified-added">+ const MediaPlayerFactory* MediaPlayer::nextMediaEngine(const MediaPlayerFactory* current)</span>
  {
<span class="udiff-line-added">+     if (m_activeEngineIdentifier) {</span>
<span class="udiff-line-added">+         auto* engine = mediaEngine(m_activeEngineIdentifier.value());</span>
<span class="udiff-line-added">+         return current != engine ? engine : nullptr;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      auto&amp; engines = installedMediaEngines();
      if (engines.isEmpty())
          return nullptr;
  
      if (!current)
<span class="udiff-line-modified-removed">-         return &amp;engines.first();</span>
<span class="udiff-line-modified-added">+         return engines.first().get();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     auto currentIndex = engines.findMatching([current] (auto&amp; engine) {</span>
<span class="udiff-line-added">+         return engine.get() == current;</span>
<span class="udiff-line-added">+     });</span>
<span class="udiff-line-added">+     if (currentIndex == notFound) {</span>
<span class="udiff-line-added">+         ASSERT_NOT_REACHED();</span>
<span class="udiff-line-added">+         return nullptr;</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-removed">-     size_t currentIndex = current - &amp;engines.first();</span>
      if (currentIndex + 1 &gt;= engines.size())
          return nullptr;
  
<span class="udiff-line-modified-removed">-     return &amp;engines[currentIndex + 1];</span>
<span class="udiff-line-modified-added">+     return engines[currentIndex + 1].get();</span>
  }
  
  // media player
  
  Ref&lt;MediaPlayer&gt; MediaPlayer::create(MediaPlayerClient&amp; client)
  {
      return adoptRef(*new MediaPlayer(client));
  }
  
<span class="udiff-line-added">+ Ref&lt;MediaPlayer&gt; MediaPlayer::create(MediaPlayerClient&amp; client, MediaPlayerEnums::MediaEngineIdentifier mediaEngineIdentifier)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     return adoptRef(*new MediaPlayer(client, mediaEngineIdentifier));</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  MediaPlayer::MediaPlayer(MediaPlayerClient&amp; client)
      : m_client(&amp;client)
      , m_reloadTimer(*this, &amp;MediaPlayer::reloadTimerFired)
      , m_private(makeUnique&lt;NullMediaPlayerPrivate&gt;(this))
  {
  }
  
<span class="udiff-line-added">+ MediaPlayer::MediaPlayer(MediaPlayerClient&amp; client, MediaPlayerEnums::MediaEngineIdentifier mediaEngineIdentifier)</span>
<span class="udiff-line-added">+     : m_client(&amp;client)</span>
<span class="udiff-line-added">+     , m_reloadTimer(*this, &amp;MediaPlayer::reloadTimerFired)</span>
<span class="udiff-line-added">+     , m_private(makeUnique&lt;NullMediaPlayerPrivate&gt;(this))</span>
<span class="udiff-line-added">+     , m_activeEngineIdentifier(mediaEngineIdentifier)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  MediaPlayer::~MediaPlayer()
  {
      ASSERT(!m_initializingMediaEngine);
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -444,11 +491,11 @@</span>
      loadWithNextMediaEngine(nullptr);
      return m_currentMediaEngine;
  }
  #endif
  
<span class="udiff-line-modified-removed">- const MediaPlayerFactory* MediaPlayer::nextBestMediaEngine(const MediaPlayerFactory* current) const</span>
<span class="udiff-line-modified-added">+ const MediaPlayerFactory* MediaPlayer::nextBestMediaEngine(const MediaPlayerFactory* current)</span>
  {
      MediaEngineSupportParameters parameters;
      parameters.type = m_contentType;
      parameters.url = m_url;
  #if ENABLE(MEDIA_SOURCE)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -456,10 +503,21 @@</span>
  #endif
  #if ENABLE(MEDIA_STREAM)
      parameters.isMediaStream = !!m_mediaStream;
  #endif
  
<span class="udiff-line-added">+     if (m_activeEngineIdentifier) {</span>
<span class="udiff-line-added">+         if (current)</span>
<span class="udiff-line-added">+             return nullptr;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         auto* engine = mediaEngine(m_activeEngineIdentifier.value());</span>
<span class="udiff-line-added">+         if (engine &amp;&amp; engine-&gt;supportsTypeAndCodecs(parameters) != SupportsType::IsNotSupported)</span>
<span class="udiff-line-added">+             return engine;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         return nullptr;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      return bestMediaEngineForSupportParameters(parameters, current);
  }
  
  void MediaPlayer::loadWithNextMediaEngine(const MediaPlayerFactory* current)
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -492,17 +550,15 @@</span>
          LOG(Media, &quot;MediaPlayer::loadWithNextMediaEngine - no media engine found for type \&quot;%s\&quot;&quot;, m_contentType.raw().utf8().data());
          m_currentMediaEngine = engine;
          m_private = nullptr;
      } else if (m_currentMediaEngine != engine) {
          m_currentMediaEngine = engine;
<span class="udiff-line-modified-removed">-         m_private = engine-&gt;constructor(this);</span>
<span class="udiff-line-modified-removed">-         client().mediaPlayerEngineUpdated(this);</span>
<span class="udiff-line-modified-removed">-         m_private-&gt;setPrivateBrowsingMode(m_privateBrowsing);</span>
<span class="udiff-line-modified-removed">-         m_private-&gt;setPreload(m_preload);</span>
<span class="udiff-line-modified-removed">-         m_private-&gt;setPreservesPitch(preservesPitch());</span>
<span class="udiff-line-removed">-         if (m_shouldPrepareToRender)</span>
<span class="udiff-line-removed">-             m_private-&gt;prepareForRendering();</span>
<span class="udiff-line-modified-added">+         m_private = engine-&gt;createMediaEnginePlayer(this);</span>
<span class="udiff-line-modified-added">+         if (m_private) {</span>
<span class="udiff-line-modified-added">+             client().mediaPlayerEngineUpdated();</span>
<span class="udiff-line-modified-added">+             m_private-&gt;prepareForPlayback(m_privateBrowsing, m_preload, m_preservesPitch, m_shouldPrepareToRender);</span>
<span class="udiff-line-modified-added">+         }</span>
      }
  
      if (m_private) {
  #if ENABLE(MEDIA_SOURCE)
          if (m_mediaSource)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -512,15 +568,19 @@</span>
  #if ENABLE(MEDIA_STREAM)
          if (m_mediaStream)
              m_private-&gt;load(*m_mediaStream);
          else
  #endif
<span class="udiff-line-modified-removed">-         m_private-&gt;load(m_url.string());</span>
<span class="udiff-line-modified-added">+         m_private-&gt;load(m_url, m_contentType, m_keySystem);</span>
      } else {
          m_private = makeUnique&lt;NullMediaPlayerPrivate&gt;(this);
<span class="udiff-line-modified-removed">-         client().mediaPlayerEngineUpdated(this);</span>
<span class="udiff-line-modified-removed">-         client().mediaPlayerResourceNotSupported(this);</span>
<span class="udiff-line-modified-added">+         if (!m_activeEngineIdentifier &amp;&amp; installedMediaEngines().size() &gt; 1 &amp;&amp; nextBestMediaEngine(m_currentMediaEngine))</span>
<span class="udiff-line-modified-added">+             m_reloadTimer.startOneShot(0_s);</span>
<span class="udiff-line-added">+         else {</span>
<span class="udiff-line-added">+             client().mediaPlayerEngineUpdated();</span>
<span class="udiff-line-added">+             client().mediaPlayerResourceNotSupported();</span>
<span class="udiff-line-added">+         }</span>
      }
  
      m_initializingMediaEngine = false;
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -533,20 +593,10 @@</span>
  {
      m_shouldPrepareToRender = true;
      m_private-&gt;prepareForRendering();
  }
  
<span class="udiff-line-removed">- bool MediaPlayer::canLoadPoster() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return m_private-&gt;canLoadPoster();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- void MediaPlayer::setPoster(const String&amp; url)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     m_private-&gt;setPoster(url);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  void MediaPlayer::cancelLoad()
  {
      m_private-&gt;cancelLoad();
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -688,15 +738,10 @@</span>
  bool MediaPlayer::hasAudio() const
  {
      return m_private-&gt;hasAudio();
  }
  
<span class="udiff-line-removed">- bool MediaPlayer::inMediaDocument() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return m_visible &amp;&amp; client().mediaPlayerIsInMediaDocument();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  PlatformLayer* MediaPlayer::platformLayer() const
  {
      return m_private-&gt;platformLayer();
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -855,10 +900,20 @@</span>
  double MediaPlayer::seekableTimeRangesLastModifiedTime()
  {
      return m_private-&gt;seekableTimeRangesLastModifiedTime();
  }
  
<span class="udiff-line-added">+ void MediaPlayer::bufferedTimeRangesChanged()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     client().mediaPlayerBufferedTimeRangesChanged();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void MediaPlayer::seekableTimeRangesChanged()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     client().mediaPlayerSeekableTimeRangesChanged();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  double MediaPlayer::liveUpdateInterval()
  {
      return m_private-&gt;liveUpdateInterval();
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -903,11 +958,11 @@</span>
  void MediaPlayer::paintCurrentFrameInContext(GraphicsContext&amp; p, const FloatRect&amp; r)
  {
      m_private-&gt;paintCurrentFrameInContext(p, r);
  }
  
<span class="udiff-line-modified-removed">- bool MediaPlayer::copyVideoTextureToPlatformTexture(GraphicsContext3D* context, Platform3DObject texture, GC3Denum target, GC3Dint level, GC3Denum internalFormat, GC3Denum format, GC3Denum type, bool premultiplyAlpha, bool flipY)</span>
<span class="udiff-line-modified-added">+ bool MediaPlayer::copyVideoTextureToPlatformTexture(GraphicsContextGLOpenGL* context, PlatformGLObject texture, GCGLenum target, GCGLint level, GCGLenum internalFormat, GCGLenum format, GCGLenum type, bool premultiplyAlpha, bool flipY)</span>
  {
      return m_private-&gt;copyVideoTextureToPlatformTexture(context, texture, target, level, internalFormat, format, type, premultiplyAlpha, flipY);
  }
  
  NativeImagePtr MediaPlayer::nativeImageForCurrentTime()
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -919,24 +974,24 @@</span>
  {
      // 4.8.10.3 MIME types - The canPlayType(type) method must return the empty string if type is a type that the
      // user agent knows it cannot render or is the type &quot;application/octet-stream&quot;
      AtomString containerType = parameters.type.containerType();
      if (containerType == applicationOctetStream())
<span class="udiff-line-modified-removed">-         return IsNotSupported;</span>
<span class="udiff-line-modified-added">+         return SupportsType::IsNotSupported;</span>
  
      const MediaPlayerFactory* engine = bestMediaEngineForSupportParameters(parameters);
      if (!engine)
<span class="udiff-line-modified-removed">-         return IsNotSupported;</span>
<span class="udiff-line-modified-added">+         return SupportsType::IsNotSupported;</span>
  
      return engine-&gt;supportsTypeAndCodecs(parameters);
  }
  
  void MediaPlayer::getSupportedTypes(HashSet&lt;String, ASCIICaseInsensitiveHash&gt;&amp; types)
  {
      for (auto&amp; engine : installedMediaEngines()) {
          HashSet&lt;String, ASCIICaseInsensitiveHash&gt; engineTypes;
<span class="udiff-line-modified-removed">-         engine.getSupportedTypes(engineTypes);</span>
<span class="udiff-line-modified-added">+         engine-&gt;getSupportedTypes(engineTypes);</span>
          types.add(engineTypes.begin(), engineTypes.end());
      }
  }
  
  bool MediaPlayer::isAvailable()
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -992,13 +1047,13 @@</span>
  void MediaPlayer::setWirelessVideoPlaybackDisabled(bool disabled)
  {
      m_private-&gt;setWirelessVideoPlaybackDisabled(disabled);
  }
  
<span class="udiff-line-modified-removed">- void MediaPlayer::currentPlaybackTargetIsWirelessChanged()</span>
<span class="udiff-line-modified-added">+ void MediaPlayer::currentPlaybackTargetIsWirelessChanged(bool isCurrentPlaybackTargetWireless)</span>
  {
<span class="udiff-line-modified-removed">-     client().mediaPlayerCurrentPlaybackTargetIsWirelessChanged(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerCurrentPlaybackTargetIsWirelessChanged(isCurrentPlaybackTargetWireless);</span>
  }
  
  bool MediaPlayer::canPlayToWirelessPlaybackTarget() const
  {
      return m_private-&gt;canPlayToWirelessPlaybackTarget();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1128,38 +1183,32 @@</span>
  }
  
  HashSet&lt;RefPtr&lt;SecurityOrigin&gt;&gt; MediaPlayer::originsInMediaCache(const String&amp; path)
  {
      HashSet&lt;RefPtr&lt;SecurityOrigin&gt;&gt; origins;
<span class="udiff-line-modified-removed">-     for (auto&amp; engine : installedMediaEngines()) {</span>
<span class="udiff-line-modified-removed">-         if (!engine.originsInMediaCache)</span>
<span class="udiff-line-modified-removed">-             continue;</span>
<span class="udiff-line-removed">-         addToHash(origins, engine.originsInMediaCache(path));</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     for (auto&amp; engine : installedMediaEngines())</span>
<span class="udiff-line-modified-added">+         addToHash(origins, engine-&gt;originsInMediaCache(path));</span>
<span class="udiff-line-modified-added">+ </span>
      return origins;
  }
  
  void MediaPlayer::clearMediaCache(const String&amp; path, WallTime modifiedSince)
  {
<span class="udiff-line-modified-removed">-     for (auto&amp; engine : installedMediaEngines()) {</span>
<span class="udiff-line-modified-removed">-         if (engine.clearMediaCache)</span>
<span class="udiff-line-removed">-             engine.clearMediaCache(path, modifiedSince);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     for (auto&amp; engine : installedMediaEngines())</span>
<span class="udiff-line-modified-added">+         engine-&gt;clearMediaCache(path, modifiedSince);</span>
  }
  
  void MediaPlayer::clearMediaCacheForOrigins(const String&amp; path, const HashSet&lt;RefPtr&lt;SecurityOrigin&gt;&gt;&amp; origins)
  {
<span class="udiff-line-modified-removed">-     for (auto&amp; engine : installedMediaEngines()) {</span>
<span class="udiff-line-modified-removed">-         if (engine.clearMediaCacheForOrigins)</span>
<span class="udiff-line-removed">-             engine.clearMediaCacheForOrigins(path, origins);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     for (auto&amp; engine : installedMediaEngines())</span>
<span class="udiff-line-modified-added">+         engine-&gt;clearMediaCacheForOrigins(path, origins);</span>
  }
  
  bool MediaPlayer::supportsKeySystem(const String&amp; keySystem, const String&amp; mimeType)
  {
      for (auto&amp; engine : installedMediaEngines()) {
<span class="udiff-line-modified-removed">-         if (engine.supportsKeySystem &amp;&amp; engine.supportsKeySystem(keySystem, mimeType))</span>
<span class="udiff-line-modified-added">+         if (engine-&gt;supportsKeySystem(keySystem, mimeType))</span>
              return true;
      }
      return false;
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1173,83 +1222,83 @@</span>
  // Client callbacks.
  void MediaPlayer::networkStateChanged()
  {
      // If more than one media engine is installed and this one failed before finding metadata,
      // let the next engine try.
<span class="udiff-line-modified-removed">-     if (m_private-&gt;networkState() &gt;= FormatError &amp;&amp; m_private-&gt;readyState() &lt; HaveMetadata) {</span>
<span class="udiff-line-modified-added">+     if (m_private-&gt;networkState() &gt;= MediaPlayer::NetworkState::FormatError &amp;&amp; m_private-&gt;readyState() &lt; MediaPlayer::ReadyState::HaveMetadata) {</span>
          client().mediaPlayerEngineFailedToLoad();
<span class="udiff-line-modified-removed">-         if (installedMediaEngines().size() &gt; 1 &amp;&amp; (m_contentType.isEmpty() || nextBestMediaEngine(m_currentMediaEngine))) {</span>
<span class="udiff-line-modified-added">+         if (!m_activeEngineIdentifier &amp;&amp; installedMediaEngines().size() &gt; 1 &amp;&amp; (m_contentType.isEmpty() || nextBestMediaEngine(m_currentMediaEngine))) {</span>
              m_reloadTimer.startOneShot(0_s);
              return;
          }
      }
<span class="udiff-line-modified-removed">-     client().mediaPlayerNetworkStateChanged(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerNetworkStateChanged();</span>
  }
  
  void MediaPlayer::readyStateChanged()
  {
<span class="udiff-line-modified-removed">-     client().mediaPlayerReadyStateChanged(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerReadyStateChanged();</span>
  }
  
  void MediaPlayer::volumeChanged(double newVolume)
  {
  #if PLATFORM(IOS_FAMILY)
      UNUSED_PARAM(newVolume);
      m_volume = m_private-&gt;volume();
  #else
      m_volume = newVolume;
  #endif
<span class="udiff-line-modified-removed">-     client().mediaPlayerVolumeChanged(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerVolumeChanged();</span>
  }
  
  void MediaPlayer::muteChanged(bool newMuted)
  {
      if (newMuted == m_muted)
          return;
  
      m_muted = newMuted;
<span class="udiff-line-modified-removed">-     client().mediaPlayerMuteChanged(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerMuteChanged();</span>
  }
  
  void MediaPlayer::timeChanged()
  {
<span class="udiff-line-modified-removed">-     client().mediaPlayerTimeChanged(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerTimeChanged();</span>
  }
  
  void MediaPlayer::sizeChanged()
  {
<span class="udiff-line-modified-removed">-     client().mediaPlayerSizeChanged(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerSizeChanged();</span>
  }
  
  void MediaPlayer::repaint()
  {
<span class="udiff-line-modified-removed">-     client().mediaPlayerRepaint(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerRepaint();</span>
  }
  
  void MediaPlayer::durationChanged()
  {
<span class="udiff-line-modified-removed">-     client().mediaPlayerDurationChanged(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerDurationChanged();</span>
  }
  
  void MediaPlayer::rateChanged()
  {
<span class="udiff-line-modified-removed">-     client().mediaPlayerRateChanged(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerRateChanged();</span>
  }
  
  void MediaPlayer::playbackStateChanged()
  {
<span class="udiff-line-modified-removed">-     client().mediaPlayerPlaybackStateChanged(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerPlaybackStateChanged();</span>
  }
  
  void MediaPlayer::firstVideoFrameAvailable()
  {
<span class="udiff-line-modified-removed">-     client().mediaPlayerFirstVideoFrameAvailable(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerFirstVideoFrameAvailable();</span>
  }
  
  void MediaPlayer::characteristicChanged()
  {
<span class="udiff-line-modified-removed">-     client().mediaPlayerCharacteristicChanged(this);</span>
<span class="udiff-line-modified-added">+     client().mediaPlayerCharacteristicChanged();</span>
  }
  
  #if ENABLE(WEB_AUDIO)
  
  AudioSourceProvider* MediaPlayer::audioSourceProvider()
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1266,11 +1315,11 @@</span>
      return client().mediaPlayerCachedKeyForKeyId(keyId);
  }
  
  bool MediaPlayer::keyNeeded(Uint8Array* initData)
  {
<span class="udiff-line-modified-removed">-     return client().mediaPlayerKeyNeeded(this, initData);</span>
<span class="udiff-line-modified-added">+     return client().mediaPlayerKeyNeeded(initData);</span>
  }
  
  String MediaPlayer::mediaKeysStorageDirectory() const
  {
      return client().mediaPlayerMediaKeysStorageDirectory();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1325,11 +1374,11 @@</span>
  }
  
  #if PLATFORM(WIN) &amp;&amp; USE(AVFOUNDATION)
  GraphicsDeviceAdapter* MediaPlayer::graphicsDeviceAdapter() const
  {
<span class="udiff-line-modified-removed">-     return client().mediaPlayerGraphicsDeviceAdapter(this);</span>
<span class="udiff-line-modified-added">+     return client().mediaPlayerGraphicsDeviceAdapter();</span>
  }
  #endif
  
  CachedResourceLoader* MediaPlayer::cachedResourceLoader()
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1475,15 +1524,10 @@</span>
          return WTF::nullopt;
  
      return m_private-&gt;videoPlaybackQualityMetrics();
  }
  
<span class="udiff-line-removed">- void MediaPlayer::handlePlaybackCommand(PlatformMediaSession::RemoteControlCommandType command)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     client().mediaPlayerHandlePlaybackCommand(command);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  String MediaPlayer::sourceApplicationIdentifier() const
  {
      return client().mediaPlayerSourceApplicationIdentifier();
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1562,97 +1606,102 @@</span>
  bool MediaPlayer::shouldIgnoreIntrinsicSize()
  {
      return m_private-&gt;shouldIgnoreIntrinsicSize();
  }
  
<span class="udiff-line-added">+ void MediaPlayer::remoteEngineFailedToLoad()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     client().mediaPlayerEngineFailedToLoad();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  #if !RELEASE_LOG_DISABLED
  const Logger&amp; MediaPlayer::mediaPlayerLogger()
  {
      return client().mediaPlayerLogger();
  }
  #endif
  
<span class="udiff-line-modified-removed">- String convertEnumerationToString(MediaPlayerEnums::ReadyState enumerationValue)</span>
<span class="udiff-line-modified-added">+ String convertEnumerationToString(MediaPlayer::ReadyState enumerationValue)</span>
  {
      static const NeverDestroyed&lt;String&gt; values[] = {
          MAKE_STATIC_STRING_IMPL(&quot;HaveNothing&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;HaveMetadata&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;HaveCurrentData&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;HaveFutureData&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;HaveEnoughData&quot;),
      };
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::HaveNothing) == 0, &quot;MediaPlayerEnums::HaveNothing is not 0 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::HaveMetadata) == 1, &quot;MediaPlayerEnums::HaveMetadata is not 1 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::HaveCurrentData) == 2, &quot;MediaPlayerEnums::HaveCurrentData is not 2 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::HaveFutureData) == 3, &quot;MediaPlayerEnums::HaveFutureData is not 3 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::HaveEnoughData) == 4, &quot;MediaPlayerEnums::HaveEnoughData is not 4 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::ReadyState::HaveNothing) == 0, &quot;MediaPlayer::ReadyState::HaveNothing is not 0 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::ReadyState::HaveMetadata) == 1, &quot;MediaPlayer::ReadyState::HaveMetadata is not 1 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::ReadyState::HaveCurrentData) == 2, &quot;MediaPlayer::ReadyState::HaveCurrentData is not 2 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::ReadyState::HaveFutureData) == 3, &quot;MediaPlayer::ReadyState::HaveFutureData is not 3 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::ReadyState::HaveEnoughData) == 4, &quot;MediaPlayer::ReadyState::HaveEnoughData is not 4 as expected&quot;);</span>
      ASSERT(static_cast&lt;size_t&gt;(enumerationValue) &lt; WTF_ARRAY_LENGTH(values));
      return values[static_cast&lt;size_t&gt;(enumerationValue)];
  }
  
<span class="udiff-line-modified-removed">- String convertEnumerationToString(MediaPlayerEnums::NetworkState enumerationValue)</span>
<span class="udiff-line-modified-added">+ String convertEnumerationToString(MediaPlayer::NetworkState enumerationValue)</span>
  {
      static const NeverDestroyed&lt;String&gt; values[] = {
          MAKE_STATIC_STRING_IMPL(&quot;Empty&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;Idle&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;Loading&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;Loaded&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;FormatError&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;NetworkError&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;DecodeError&quot;),
      };
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::Empty) == 0, &quot;MediaPlayerEnums::Empty is not 0 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::Idle) == 1, &quot;MediaPlayerEnums::Idle is not 1 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::Loading) == 2, &quot;MediaPlayerEnums::Loading is not 2 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::Loaded) == 3, &quot;MediaPlayerEnums::Loaded is not 3 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::FormatError) == 4, &quot;MediaPlayerEnums::FormatError is not 4 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::NetworkError) == 5, &quot;MediaPlayerEnums::NetworkError is not 5 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::DecodeError) == 6, &quot;MediaPlayerEnums::DecodeError is not 6 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::NetworkState::Empty) == 0, &quot;MediaPlayer::NetworkState::Empty is not 0 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::NetworkState::Idle) == 1, &quot;MediaPlayer::NetworkState::Idle is not 1 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::NetworkState::Loading) == 2, &quot;MediaPlayer::NetworkState::Loading is not 2 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::NetworkState::Loaded) == 3, &quot;MediaPlayer::NetworkState::Loaded is not 3 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::NetworkState::FormatError) == 4, &quot;MediaPlayer::NetworkState::FormatError is not 4 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::NetworkState::NetworkError) == 5, &quot;MediaPlayer::NetworkError is not 5 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::NetworkState::DecodeError) == 6, &quot;MediaPlayer::NetworkState::DecodeError is not 6 as expected&quot;);</span>
      ASSERT(static_cast&lt;size_t&gt;(enumerationValue) &lt; WTF_ARRAY_LENGTH(values));
      return values[static_cast&lt;size_t&gt;(enumerationValue)];
  }
  
<span class="udiff-line-modified-removed">- String convertEnumerationToString(MediaPlayerEnums::Preload enumerationValue)</span>
<span class="udiff-line-modified-added">+ String convertEnumerationToString(MediaPlayer::Preload enumerationValue)</span>
  {
      static const NeverDestroyed&lt;String&gt; values[] = {
          MAKE_STATIC_STRING_IMPL(&quot;None&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;MetaData&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;Auto&quot;),
      };
<span class="udiff-line-modified-removed">-     static_assert(!static_cast&lt;size_t&gt;(MediaPlayerEnums::None), &quot;MediaPlayerEnums::None is not 0 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::MetaData) == 1, &quot;MediaPlayerEnums::MetaData is not 1 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::Auto) == 2, &quot;MediaPlayerEnums::Auto is not 2 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(!static_cast&lt;size_t&gt;(MediaPlayer::Preload::None), &quot;MediaPlayer::Preload::None is not 0 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::Preload::MetaData) == 1, &quot;MediaPlayer::Preload::MetaData is not 1 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::Preload::Auto) == 2, &quot;MediaPlayer::Preload::Auto is not 2 as expected&quot;);</span>
      ASSERT(static_cast&lt;size_t&gt;(enumerationValue) &lt; WTF_ARRAY_LENGTH(values));
      return values[static_cast&lt;size_t&gt;(enumerationValue)];
  }
  
<span class="udiff-line-modified-removed">- String convertEnumerationToString(MediaPlayerEnums::SupportsType enumerationValue)</span>
<span class="udiff-line-modified-added">+ String convertEnumerationToString(MediaPlayer::SupportsType enumerationValue)</span>
  {
      static const NeverDestroyed&lt;String&gt; values[] = {
          MAKE_STATIC_STRING_IMPL(&quot;IsNotSupported&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;IsSupported&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;MayBeSupported&quot;),
      };
<span class="udiff-line-modified-removed">-     static_assert(!static_cast&lt;size_t&gt;(MediaPlayerEnums::IsNotSupported), &quot;MediaPlayerEnums::IsNotSupported is not 0 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::IsSupported) == 1, &quot;MediaPlayerEnums::IsSupported is not 1 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::MayBeSupported) == 2, &quot;MediaPlayerEnums::MayBeSupported is not 2 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(!static_cast&lt;size_t&gt;(MediaPlayer::SupportsType::IsNotSupported), &quot;MediaPlayer::SupportsType::IsNotSupported is not 0 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::SupportsType::IsSupported) == 1, &quot;MediaPlayer::SupportsType::IsSupported is not 1 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::SupportsType::MayBeSupported) == 2, &quot;MediaPlayer::SupportsType::MayBeSupported is not 2 as expected&quot;);</span>
      ASSERT(static_cast&lt;size_t&gt;(enumerationValue) &lt; WTF_ARRAY_LENGTH(values));
      return values[static_cast&lt;size_t&gt;(enumerationValue)];
  }
  
<span class="udiff-line-modified-removed">- String convertEnumerationToString(MediaPlayerEnums::BufferingPolicy enumerationValue)</span>
<span class="udiff-line-modified-added">+ String convertEnumerationToString(MediaPlayer::BufferingPolicy enumerationValue)</span>
  {
      static const NeverDestroyed&lt;String&gt; values[] = {
          MAKE_STATIC_STRING_IMPL(&quot;Default&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;LimitReadAhead&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;MakeResourcesPurgeable&quot;),
          MAKE_STATIC_STRING_IMPL(&quot;PurgeResources&quot;),
      };
<span class="udiff-line-modified-removed">-     static_assert(!static_cast&lt;size_t&gt;(MediaPlayerEnums::BufferingPolicy::Default), &quot;MediaPlayerEnums::Default is not 0 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::BufferingPolicy::LimitReadAhead) == 1, &quot;MediaPlayerEnums::LimitReadAhead is not 1 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::BufferingPolicy::MakeResourcesPurgeable) == 2, &quot;MediaPlayerEnums::MakeResourcesPurgeable is not 2 as expected&quot;);</span>
<span class="udiff-line-modified-removed">-     static_assert(static_cast&lt;size_t&gt;(MediaPlayerEnums::BufferingPolicy::PurgeResources) == 3, &quot;MediaPlayerEnums::PurgeResources is not 3 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(!static_cast&lt;size_t&gt;(MediaPlayer::BufferingPolicy::Default), &quot;MediaPlayer::Default is not 0 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::BufferingPolicy::LimitReadAhead) == 1, &quot;MediaPlayer::LimitReadAhead is not 1 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::BufferingPolicy::MakeResourcesPurgeable) == 2, &quot;MediaPlayer::MakeResourcesPurgeable is not 2 as expected&quot;);</span>
<span class="udiff-line-modified-added">+     static_assert(static_cast&lt;size_t&gt;(MediaPlayer::BufferingPolicy::PurgeResources) == 3, &quot;MediaPlayer::PurgeResources is not 3 as expected&quot;);</span>
      ASSERT(static_cast&lt;size_t&gt;(enumerationValue) &lt; WTF_ARRAY_LENGTH(values));
      return values[static_cast&lt;size_t&gt;(enumerationValue)];
  }
  
  }
</pre>
<center><a href="MediaPlaybackTargetPicker.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaPlayer.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>