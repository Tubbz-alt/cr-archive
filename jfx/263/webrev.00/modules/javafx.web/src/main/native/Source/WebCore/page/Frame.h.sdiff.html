<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/page/Frame.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Frame.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FrameIdentifier.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/page/Frame.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 40 #include &quot;ViewportArguments.h&quot;
 41 #include &quot;VisibleSelection.h&quot;
 42 #endif
 43 
 44 #if PLATFORM(WIN)
 45 #include &quot;FrameWin.h&quot;
 46 #endif
 47 
 48 #if PLATFORM(COCOA)
 49 OBJC_CLASS NSArray;
 50 #endif
 51 
 52 #if PLATFORM(WIN)
 53 typedef struct HBITMAP__* HBITMAP;
 54 #endif
 55 
 56 namespace JSC { namespace Yarr {
 57 class RegularExpression;
 58 } }
 59 
<span class="line-removed"> 60 namespace PAL {</span>
<span class="line-removed"> 61 class SessionID;</span>
<span class="line-removed"> 62 }</span>
<span class="line-removed"> 63 </span>
 64 namespace WebCore {
 65 
 66 class CSSAnimationController;
 67 class Color;
 68 class DOMWindow;
 69 class Document;
 70 class Editor;
 71 class Element;
 72 class EventHandler;
 73 class FloatSize;
 74 class FrameDestructionObserver;
 75 class FrameLoader;
 76 class FrameLoaderClient;
 77 class FrameSelection;
 78 class FrameView;
 79 class HTMLFrameOwnerElement;
 80 class HTMLTableCellElement;
 81 class HitTestResult;
 82 class ImageBuffer;
 83 class IntPoint;
</pre>
<hr />
<pre>
104     OverflowScrollUp = 1 &lt;&lt; 2,
105     OverflowScrollDown = 1 &lt;&lt; 3
106 };
107 
108 enum OverflowScrollAction { DoNotPerformOverflowScroll, PerformOverflowScroll };
109 using NodeQualifier = Function&lt;Node* (const HitTestResult&amp;, Node* terminationNode, IntRect* nodeBounds)&gt;;
110 #endif
111 
112 enum {
113     LayerTreeFlagsIncludeDebugInfo              = 1 &lt;&lt; 0,
114     LayerTreeFlagsIncludeVisibleRects           = 1 &lt;&lt; 1,
115     LayerTreeFlagsIncludeTileCaches             = 1 &lt;&lt; 2,
116     LayerTreeFlagsIncludeRepaintRects           = 1 &lt;&lt; 3,
117     LayerTreeFlagsIncludePaintingPhases         = 1 &lt;&lt; 4,
118     LayerTreeFlagsIncludeContentLayers          = 1 &lt;&lt; 5,
119     LayerTreeFlagsIncludeAcceleratesDrawing     = 1 &lt;&lt; 6,
120     LayerTreeFlagsIncludeClipping               = 1 &lt;&lt; 7,
121     LayerTreeFlagsIncludeBackingStoreAttached   = 1 &lt;&lt; 8,
122     LayerTreeFlagsIncludeRootLayerProperties    = 1 &lt;&lt; 9,
123     LayerTreeFlagsIncludeEventRegion            = 1 &lt;&lt; 10,

124 };
125 typedef unsigned LayerTreeFlags;
126 
127 // FIXME: Rename Frame to LocalFrame and AbstractFrame to Frame.
128 class Frame final : public AbstractFrame {
129 public:
130     WEBCORE_EXPORT static Ref&lt;Frame&gt; create(Page*, HTMLFrameOwnerElement*, FrameLoaderClient*);
131 
132     WEBCORE_EXPORT void init();
133 #if PLATFORM(IOS_FAMILY)
134     // Creates &lt;html&gt;&lt;body style=&quot;...&quot;&gt;&lt;/body&gt;&lt;/html&gt; doing minimal amount of work.
135     WEBCORE_EXPORT void initWithSimpleHTMLDocument(const String&amp; style, const URL&amp;);
136 #endif
137     WEBCORE_EXPORT void setView(RefPtr&lt;FrameView&gt;&amp;&amp;);
138     WEBCORE_EXPORT void createView(const IntSize&amp;, const Optional&lt;Color&gt;&amp; backgroundColor,
139         const IntSize&amp; fixedLayoutSize, const IntRect&amp; fixedVisibleContentRect,
140         bool useFixedLayout = false, ScrollbarMode = ScrollbarAuto, bool horizontalLock = false,
141         ScrollbarMode = ScrollbarAuto, bool verticalLock = false);
142 
143     WEBCORE_EXPORT ~Frame();
</pre>
<hr />
<pre>
208     float textZoomFactor() const { return m_textZoomFactor; }
209     WEBCORE_EXPORT void setPageAndTextZoomFactors(float pageZoomFactor, float textZoomFactor);
210 
211     // Scale factor of this frame with respect to the container.
212     WEBCORE_EXPORT float frameScaleFactor() const;
213 
214     void deviceOrPageScaleFactorChanged();
215 
216 #if ENABLE(DATA_DETECTION)
217     void setDataDetectionResults(NSArray *results) { m_dataDetectionResults = results; }
218     NSArray *dataDetectionResults() const { return m_dataDetectionResults.get(); }
219 #endif
220 
221 #if PLATFORM(IOS_FAMILY)
222     const ViewportArguments&amp; viewportArguments() const;
223     WEBCORE_EXPORT void setViewportArguments(const ViewportArguments&amp;);
224 
225     WEBCORE_EXPORT Node* deepestNodeAtLocation(const FloatPoint&amp; viewportLocation);
226     WEBCORE_EXPORT Node* nodeRespondingToClickEvents(const FloatPoint&amp; viewportLocation, FloatPoint&amp; adjustedViewportLocation, SecurityOrigin* = nullptr);
227     WEBCORE_EXPORT Node* nodeRespondingToDoubleClickEvent(const FloatPoint&amp; viewportLocation, FloatPoint&amp; adjustedViewportLocation);

228     WEBCORE_EXPORT Node* nodeRespondingToScrollWheelEvents(const FloatPoint&amp; viewportLocation);
229     WEBCORE_EXPORT Node* approximateNodeAtViewportLocationLegacy(const FloatPoint&amp; viewportLocation, FloatPoint&amp; adjustedViewportLocation);
230 
231     WEBCORE_EXPORT NSArray *wordsInCurrentParagraph() const;
232     WEBCORE_EXPORT CGRect renderRectForPoint(CGPoint, bool* isReplaced, float* fontSize) const;
233 
234     WEBCORE_EXPORT void setSelectionChangeCallbacksDisabled(bool = true);
235     bool selectionChangeCallbacksDisabled() const;
236 
237     enum ViewportOffsetChangeType { IncrementalScrollOffset, CompletedScrollOffset };
238     WEBCORE_EXPORT void viewportOffsetChanged(ViewportOffsetChangeType);
239     bool containsTiledBackingLayers() const;
240 
241     WEBCORE_EXPORT void overflowScrollPositionChangedForNode(const IntPoint&amp;, Node*, bool isUserScroll);
242 
243     WEBCORE_EXPORT void resetAllGeolocationPermission();
244 #endif
245 
246 #if ENABLE(ORIENTATION_EVENTS)
247     // Orientation is the interface orientation in degrees. Some examples are:
</pre>
<hr />
<pre>
284     WEBCORE_EXPORT void setRangedSelectionInitialExtentToCurrentSelectionEnd();
285     WEBCORE_EXPORT VisibleSelection rangedSelectionBase() const;
286     WEBCORE_EXPORT VisibleSelection rangedSelectionInitialExtent() const;
287     WEBCORE_EXPORT void recursiveSetUpdateAppearanceEnabled(bool);
288     WEBCORE_EXPORT NSArray *interpretationsForCurrentRoot() const;
289 #endif
290     void suspendActiveDOMObjectsAndAnimations();
291     void resumeActiveDOMObjectsAndAnimations();
292     bool activeDOMObjectsAndAnimationsSuspended() const { return m_activeDOMObjectsAndAnimationsSuspendedCount &gt; 0; }
293 
294     WEBCORE_EXPORT bool isAlwaysOnLoggingAllowed() const;
295 
296     void didPrewarmLocalStorage();
297     bool mayPrewarmLocalStorage() const;
298 
299 // ========
300 
301     void selfOnlyRef();
302     void selfOnlyDeref();
303 
<span class="line-removed">304     PAL::SessionID sessionID() const;</span>
<span class="line-removed">305 </span>
306 private:
307     friend class NavigationDisabler;
308 
309     Frame(Page&amp;, HTMLFrameOwnerElement*, FrameLoaderClient&amp;);
310 
311     void dropChildren();
312 
313     bool isLocalFrame() const final { return true; }
314     bool isRemoteFrame() const final { return false; }
315 
316     AbstractDOMWindow* virtualWindow() const final;
317 
318     HashSet&lt;FrameDestructionObserver*&gt; m_destructionObservers;
319 
320     Frame&amp; m_mainFrame;
321     Page* m_page;
322     const RefPtr&lt;Settings&gt; m_settings;
323     mutable FrameTree m_treeNode;
324     mutable UniqueRef&lt;FrameLoader&gt; m_loader;
325     mutable UniqueRef&lt;NavigationScheduler&gt; m_navigationScheduler;
326 
327     HTMLFrameOwnerElement* m_ownerElement;
328     RefPtr&lt;FrameView&gt; m_view;
329     RefPtr&lt;Document&gt; m_doc;
330 
331     UniqueRef&lt;ScriptController&gt; m_script;
332     UniqueRef&lt;Editor&gt; m_editor;
333     UniqueRef&lt;FrameSelection&gt; m_selection;
334     UniqueRef&lt;CSSAnimationController&gt; m_animationController;
335 
336 #if ENABLE(DATA_DETECTION)
337     RetainPtr&lt;NSArray&gt; m_dataDetectionResults;
338 #endif
339 #if PLATFORM(IOS_FAMILY)
340     void betterApproximateNode(const IntPoint&amp; testPoint, const NodeQualifier&amp;, Node*&amp; best, Node* failedNode, IntPoint&amp; bestPoint, IntRect&amp; bestRect, const IntRect&amp; testRect);
341     bool hitTestResultAtViewportLocation(const FloatPoint&amp; viewportLocation, HitTestResult&amp;, IntPoint&amp; center);
<span class="line-modified">342     Node* qualifyingNodeAtViewportLocation(const FloatPoint&amp; viewportLocation, FloatPoint&amp; adjustedViewportLocation, const NodeQualifier&amp;, bool shouldApproximate);</span>



343 
344     void setTimersPausedInternal(bool);
345 
346     ViewportArguments m_viewportArguments;
347     bool m_selectionChangeCallbacksDisabled { false };
348     VisibleSelection m_rangedSelectionBase;
349     VisibleSelection m_rangedSelectionInitialExtent;
350 #endif
351 
352     float m_pageZoomFactor;
353     float m_textZoomFactor;
354 
355     int m_activeDOMObjectsAndAnimationsSuspendedCount { 0 };
356     bool m_documentIsBeingReplaced { false };
357     unsigned m_navigationDisableCount { 0 };
358     unsigned m_selfOnlyRefCount { 0 };
359     bool m_hasHadUserInteraction { false };
360     unsigned m_localStoragePrewarmingCount { 0 };
361 
362 protected:
</pre>
</td>
<td>
<hr />
<pre>
 40 #include &quot;ViewportArguments.h&quot;
 41 #include &quot;VisibleSelection.h&quot;
 42 #endif
 43 
 44 #if PLATFORM(WIN)
 45 #include &quot;FrameWin.h&quot;
 46 #endif
 47 
 48 #if PLATFORM(COCOA)
 49 OBJC_CLASS NSArray;
 50 #endif
 51 
 52 #if PLATFORM(WIN)
 53 typedef struct HBITMAP__* HBITMAP;
 54 #endif
 55 
 56 namespace JSC { namespace Yarr {
 57 class RegularExpression;
 58 } }
 59 




 60 namespace WebCore {
 61 
 62 class CSSAnimationController;
 63 class Color;
 64 class DOMWindow;
 65 class Document;
 66 class Editor;
 67 class Element;
 68 class EventHandler;
 69 class FloatSize;
 70 class FrameDestructionObserver;
 71 class FrameLoader;
 72 class FrameLoaderClient;
 73 class FrameSelection;
 74 class FrameView;
 75 class HTMLFrameOwnerElement;
 76 class HTMLTableCellElement;
 77 class HitTestResult;
 78 class ImageBuffer;
 79 class IntPoint;
</pre>
<hr />
<pre>
100     OverflowScrollUp = 1 &lt;&lt; 2,
101     OverflowScrollDown = 1 &lt;&lt; 3
102 };
103 
104 enum OverflowScrollAction { DoNotPerformOverflowScroll, PerformOverflowScroll };
105 using NodeQualifier = Function&lt;Node* (const HitTestResult&amp;, Node* terminationNode, IntRect* nodeBounds)&gt;;
106 #endif
107 
108 enum {
109     LayerTreeFlagsIncludeDebugInfo              = 1 &lt;&lt; 0,
110     LayerTreeFlagsIncludeVisibleRects           = 1 &lt;&lt; 1,
111     LayerTreeFlagsIncludeTileCaches             = 1 &lt;&lt; 2,
112     LayerTreeFlagsIncludeRepaintRects           = 1 &lt;&lt; 3,
113     LayerTreeFlagsIncludePaintingPhases         = 1 &lt;&lt; 4,
114     LayerTreeFlagsIncludeContentLayers          = 1 &lt;&lt; 5,
115     LayerTreeFlagsIncludeAcceleratesDrawing     = 1 &lt;&lt; 6,
116     LayerTreeFlagsIncludeClipping               = 1 &lt;&lt; 7,
117     LayerTreeFlagsIncludeBackingStoreAttached   = 1 &lt;&lt; 8,
118     LayerTreeFlagsIncludeRootLayerProperties    = 1 &lt;&lt; 9,
119     LayerTreeFlagsIncludeEventRegion            = 1 &lt;&lt; 10,
<span class="line-added">120     LayerTreeFlagsIncludeDeepColor              = 1 &lt;&lt; 11,</span>
121 };
122 typedef unsigned LayerTreeFlags;
123 
124 // FIXME: Rename Frame to LocalFrame and AbstractFrame to Frame.
125 class Frame final : public AbstractFrame {
126 public:
127     WEBCORE_EXPORT static Ref&lt;Frame&gt; create(Page*, HTMLFrameOwnerElement*, FrameLoaderClient*);
128 
129     WEBCORE_EXPORT void init();
130 #if PLATFORM(IOS_FAMILY)
131     // Creates &lt;html&gt;&lt;body style=&quot;...&quot;&gt;&lt;/body&gt;&lt;/html&gt; doing minimal amount of work.
132     WEBCORE_EXPORT void initWithSimpleHTMLDocument(const String&amp; style, const URL&amp;);
133 #endif
134     WEBCORE_EXPORT void setView(RefPtr&lt;FrameView&gt;&amp;&amp;);
135     WEBCORE_EXPORT void createView(const IntSize&amp;, const Optional&lt;Color&gt;&amp; backgroundColor,
136         const IntSize&amp; fixedLayoutSize, const IntRect&amp; fixedVisibleContentRect,
137         bool useFixedLayout = false, ScrollbarMode = ScrollbarAuto, bool horizontalLock = false,
138         ScrollbarMode = ScrollbarAuto, bool verticalLock = false);
139 
140     WEBCORE_EXPORT ~Frame();
</pre>
<hr />
<pre>
205     float textZoomFactor() const { return m_textZoomFactor; }
206     WEBCORE_EXPORT void setPageAndTextZoomFactors(float pageZoomFactor, float textZoomFactor);
207 
208     // Scale factor of this frame with respect to the container.
209     WEBCORE_EXPORT float frameScaleFactor() const;
210 
211     void deviceOrPageScaleFactorChanged();
212 
213 #if ENABLE(DATA_DETECTION)
214     void setDataDetectionResults(NSArray *results) { m_dataDetectionResults = results; }
215     NSArray *dataDetectionResults() const { return m_dataDetectionResults.get(); }
216 #endif
217 
218 #if PLATFORM(IOS_FAMILY)
219     const ViewportArguments&amp; viewportArguments() const;
220     WEBCORE_EXPORT void setViewportArguments(const ViewportArguments&amp;);
221 
222     WEBCORE_EXPORT Node* deepestNodeAtLocation(const FloatPoint&amp; viewportLocation);
223     WEBCORE_EXPORT Node* nodeRespondingToClickEvents(const FloatPoint&amp; viewportLocation, FloatPoint&amp; adjustedViewportLocation, SecurityOrigin* = nullptr);
224     WEBCORE_EXPORT Node* nodeRespondingToDoubleClickEvent(const FloatPoint&amp; viewportLocation, FloatPoint&amp; adjustedViewportLocation);
<span class="line-added">225     WEBCORE_EXPORT Node* nodeRespondingToInteraction(const FloatPoint&amp; viewportLocation, FloatPoint&amp; adjustedViewportLocation);</span>
226     WEBCORE_EXPORT Node* nodeRespondingToScrollWheelEvents(const FloatPoint&amp; viewportLocation);
227     WEBCORE_EXPORT Node* approximateNodeAtViewportLocationLegacy(const FloatPoint&amp; viewportLocation, FloatPoint&amp; adjustedViewportLocation);
228 
229     WEBCORE_EXPORT NSArray *wordsInCurrentParagraph() const;
230     WEBCORE_EXPORT CGRect renderRectForPoint(CGPoint, bool* isReplaced, float* fontSize) const;
231 
232     WEBCORE_EXPORT void setSelectionChangeCallbacksDisabled(bool = true);
233     bool selectionChangeCallbacksDisabled() const;
234 
235     enum ViewportOffsetChangeType { IncrementalScrollOffset, CompletedScrollOffset };
236     WEBCORE_EXPORT void viewportOffsetChanged(ViewportOffsetChangeType);
237     bool containsTiledBackingLayers() const;
238 
239     WEBCORE_EXPORT void overflowScrollPositionChangedForNode(const IntPoint&amp;, Node*, bool isUserScroll);
240 
241     WEBCORE_EXPORT void resetAllGeolocationPermission();
242 #endif
243 
244 #if ENABLE(ORIENTATION_EVENTS)
245     // Orientation is the interface orientation in degrees. Some examples are:
</pre>
<hr />
<pre>
282     WEBCORE_EXPORT void setRangedSelectionInitialExtentToCurrentSelectionEnd();
283     WEBCORE_EXPORT VisibleSelection rangedSelectionBase() const;
284     WEBCORE_EXPORT VisibleSelection rangedSelectionInitialExtent() const;
285     WEBCORE_EXPORT void recursiveSetUpdateAppearanceEnabled(bool);
286     WEBCORE_EXPORT NSArray *interpretationsForCurrentRoot() const;
287 #endif
288     void suspendActiveDOMObjectsAndAnimations();
289     void resumeActiveDOMObjectsAndAnimations();
290     bool activeDOMObjectsAndAnimationsSuspended() const { return m_activeDOMObjectsAndAnimationsSuspendedCount &gt; 0; }
291 
292     WEBCORE_EXPORT bool isAlwaysOnLoggingAllowed() const;
293 
294     void didPrewarmLocalStorage();
295     bool mayPrewarmLocalStorage() const;
296 
297 // ========
298 
299     void selfOnlyRef();
300     void selfOnlyDeref();
301 


302 private:
303     friend class NavigationDisabler;
304 
305     Frame(Page&amp;, HTMLFrameOwnerElement*, FrameLoaderClient&amp;);
306 
307     void dropChildren();
308 
309     bool isLocalFrame() const final { return true; }
310     bool isRemoteFrame() const final { return false; }
311 
312     AbstractDOMWindow* virtualWindow() const final;
313 
314     HashSet&lt;FrameDestructionObserver*&gt; m_destructionObservers;
315 
316     Frame&amp; m_mainFrame;
317     Page* m_page;
318     const RefPtr&lt;Settings&gt; m_settings;
319     mutable FrameTree m_treeNode;
320     mutable UniqueRef&lt;FrameLoader&gt; m_loader;
321     mutable UniqueRef&lt;NavigationScheduler&gt; m_navigationScheduler;
322 
323     HTMLFrameOwnerElement* m_ownerElement;
324     RefPtr&lt;FrameView&gt; m_view;
325     RefPtr&lt;Document&gt; m_doc;
326 
327     UniqueRef&lt;ScriptController&gt; m_script;
328     UniqueRef&lt;Editor&gt; m_editor;
329     UniqueRef&lt;FrameSelection&gt; m_selection;
330     UniqueRef&lt;CSSAnimationController&gt; m_animationController;
331 
332 #if ENABLE(DATA_DETECTION)
333     RetainPtr&lt;NSArray&gt; m_dataDetectionResults;
334 #endif
335 #if PLATFORM(IOS_FAMILY)
336     void betterApproximateNode(const IntPoint&amp; testPoint, const NodeQualifier&amp;, Node*&amp; best, Node* failedNode, IntPoint&amp; bestPoint, IntRect&amp; bestRect, const IntRect&amp; testRect);
337     bool hitTestResultAtViewportLocation(const FloatPoint&amp; viewportLocation, HitTestResult&amp;, IntPoint&amp; center);
<span class="line-modified">338 </span>
<span class="line-added">339     enum class ShouldApproximate : bool { No, Yes };</span>
<span class="line-added">340     enum class ShouldFindRootEditableElement : bool { No, Yes };</span>
<span class="line-added">341     Node* qualifyingNodeAtViewportLocation(const FloatPoint&amp; viewportLocation, FloatPoint&amp; adjustedViewportLocation, const NodeQualifier&amp;, ShouldApproximate, ShouldFindRootEditableElement = ShouldFindRootEditableElement::Yes);</span>
342 
343     void setTimersPausedInternal(bool);
344 
345     ViewportArguments m_viewportArguments;
346     bool m_selectionChangeCallbacksDisabled { false };
347     VisibleSelection m_rangedSelectionBase;
348     VisibleSelection m_rangedSelectionInitialExtent;
349 #endif
350 
351     float m_pageZoomFactor;
352     float m_textZoomFactor;
353 
354     int m_activeDOMObjectsAndAnimationsSuspendedCount { 0 };
355     bool m_documentIsBeingReplaced { false };
356     unsigned m_navigationDisableCount { 0 };
357     unsigned m_selfOnlyRefCount { 0 };
358     bool m_hasHadUserInteraction { false };
359     unsigned m_localStoragePrewarmingCount { 0 };
360 
361 protected:
</pre>
</td>
</tr>
</table>
<center><a href="Frame.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FrameIdentifier.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>