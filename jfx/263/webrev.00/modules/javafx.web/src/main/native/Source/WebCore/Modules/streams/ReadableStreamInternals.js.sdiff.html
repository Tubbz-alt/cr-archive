<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/Modules/streams/ReadableStreamInternals.js</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ReadableStream.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ReadableStreamSource.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/streams/ReadableStreamInternals.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
280 
281     if (!@getByIdDirectPrivate(stream, &quot;reader&quot;))
282         return;
283 
284     const reader = @getByIdDirectPrivate(stream, &quot;reader&quot;);
285 
286     if (@isReadableStreamDefaultReader(reader)) {
287         const requests = @getByIdDirectPrivate(reader, &quot;readRequests&quot;);
288         for (let index = 0, length = requests.length; index &lt; length; ++index)
289             requests[index].@reject.@call(@undefined, error);
290         @putByIdDirectPrivate(reader, &quot;readRequests&quot;, []);
291     } else {
292         @assert(@isReadableStreamBYOBReader(reader));
293         const requests = @getByIdDirectPrivate(reader, &quot;readIntoRequests&quot;);
294         for (let index = 0, length = requests.length; index &lt; length; ++index)
295             requests[index].@reject.@call(@undefined, error);
296         @putByIdDirectPrivate(reader, &quot;readIntoRequests&quot;, []);
297     }
298 
299     @getByIdDirectPrivate(reader, &quot;closedPromiseCapability&quot;).@reject.@call(@undefined, error);
<span class="line-modified">300     @putByIdDirectPrivate(@getByIdDirectPrivate(reader, &quot;closedPromiseCapability&quot;).@promise, &quot;promiseIsHandled&quot;, true);</span>

301 }
302 
303 function readableStreamDefaultControllerCallPullIfNeeded(controller)
304 {
305     &quot;use strict&quot;;
306 
307     const stream = @getByIdDirectPrivate(controller, &quot;controlledReadableStream&quot;);
308 
309     if (!@readableStreamDefaultControllerCanCloseOrEnqueue(controller))
310         return;
311     if (!@getByIdDirectPrivate(controller, &quot;started&quot;))
312         return;
313     if ((!@isReadableStreamLocked(stream) || !@getByIdDirectPrivate(@getByIdDirectPrivate(stream, &quot;reader&quot;), &quot;readRequests&quot;).length) &amp;&amp; @readableStreamDefaultControllerGetDesiredSize(controller) &lt;= 0)
314         return;
315 
316     if (@getByIdDirectPrivate(controller, &quot;pulling&quot;)) {
317         @putByIdDirectPrivate(controller, &quot;pullAgain&quot;, true);
318         return;
319     }
320 
</pre>
<hr />
<pre>
503 function isReadableStreamDisturbed(stream)
504 {
505     &quot;use strict&quot;;
506 
507     @assert(@isReadableStream(stream));
508     return @getByIdDirectPrivate(stream, &quot;disturbed&quot;);
509 }
510 
511 function readableStreamReaderGenericRelease(reader)
512 {
513     &quot;use strict&quot;;
514 
515     @assert(!!@getByIdDirectPrivate(reader, &quot;ownerReadableStream&quot;));
516     @assert(@getByIdDirectPrivate(@getByIdDirectPrivate(reader, &quot;ownerReadableStream&quot;), &quot;reader&quot;) === reader);
517 
518     if (@getByIdDirectPrivate(@getByIdDirectPrivate(reader, &quot;ownerReadableStream&quot;), &quot;state&quot;) === @streamReadable)
519         @getByIdDirectPrivate(reader, &quot;closedPromiseCapability&quot;).@reject.@call(@undefined, @makeTypeError(&quot;releasing lock of reader whose stream is still in readable state&quot;));
520     else
521         @putByIdDirectPrivate(reader, &quot;closedPromiseCapability&quot;, { @promise: @newHandledRejectedPromise(@makeTypeError(&quot;reader released lock&quot;)) });
522 
<span class="line-modified">523     @putByIdDirectPrivate(@getByIdDirectPrivate(reader, &quot;closedPromiseCapability&quot;).@promise, &quot;promiseIsHandled&quot;, true);</span>

524     @putByIdDirectPrivate(@getByIdDirectPrivate(reader, &quot;ownerReadableStream&quot;), &quot;reader&quot;, @undefined);
525     @putByIdDirectPrivate(reader, &quot;ownerReadableStream&quot;, @undefined);
526 }
527 
528 function readableStreamDefaultControllerCanCloseOrEnqueue(controller)
529 {
530     &quot;use strict&quot;;
531 
532     return !@getByIdDirectPrivate(controller, &quot;closeRequested&quot;) &amp;&amp; @getByIdDirectPrivate(@getByIdDirectPrivate(controller, &quot;controlledReadableStream&quot;), &quot;state&quot;) === @streamReadable;
533 }
</pre>
</td>
<td>
<hr />
<pre>
280 
281     if (!@getByIdDirectPrivate(stream, &quot;reader&quot;))
282         return;
283 
284     const reader = @getByIdDirectPrivate(stream, &quot;reader&quot;);
285 
286     if (@isReadableStreamDefaultReader(reader)) {
287         const requests = @getByIdDirectPrivate(reader, &quot;readRequests&quot;);
288         for (let index = 0, length = requests.length; index &lt; length; ++index)
289             requests[index].@reject.@call(@undefined, error);
290         @putByIdDirectPrivate(reader, &quot;readRequests&quot;, []);
291     } else {
292         @assert(@isReadableStreamBYOBReader(reader));
293         const requests = @getByIdDirectPrivate(reader, &quot;readIntoRequests&quot;);
294         for (let index = 0, length = requests.length; index &lt; length; ++index)
295             requests[index].@reject.@call(@undefined, error);
296         @putByIdDirectPrivate(reader, &quot;readIntoRequests&quot;, []);
297     }
298 
299     @getByIdDirectPrivate(reader, &quot;closedPromiseCapability&quot;).@reject.@call(@undefined, error);
<span class="line-modified">300     const promise = @getByIdDirectPrivate(reader, &quot;closedPromiseCapability&quot;).@promise;</span>
<span class="line-added">301     @putPromiseInternalField(promise, @promiseFieldFlags, @getPromiseInternalField(promise, @promiseFieldFlags) | @promiseFlagsIsHandled);</span>
302 }
303 
304 function readableStreamDefaultControllerCallPullIfNeeded(controller)
305 {
306     &quot;use strict&quot;;
307 
308     const stream = @getByIdDirectPrivate(controller, &quot;controlledReadableStream&quot;);
309 
310     if (!@readableStreamDefaultControllerCanCloseOrEnqueue(controller))
311         return;
312     if (!@getByIdDirectPrivate(controller, &quot;started&quot;))
313         return;
314     if ((!@isReadableStreamLocked(stream) || !@getByIdDirectPrivate(@getByIdDirectPrivate(stream, &quot;reader&quot;), &quot;readRequests&quot;).length) &amp;&amp; @readableStreamDefaultControllerGetDesiredSize(controller) &lt;= 0)
315         return;
316 
317     if (@getByIdDirectPrivate(controller, &quot;pulling&quot;)) {
318         @putByIdDirectPrivate(controller, &quot;pullAgain&quot;, true);
319         return;
320     }
321 
</pre>
<hr />
<pre>
504 function isReadableStreamDisturbed(stream)
505 {
506     &quot;use strict&quot;;
507 
508     @assert(@isReadableStream(stream));
509     return @getByIdDirectPrivate(stream, &quot;disturbed&quot;);
510 }
511 
512 function readableStreamReaderGenericRelease(reader)
513 {
514     &quot;use strict&quot;;
515 
516     @assert(!!@getByIdDirectPrivate(reader, &quot;ownerReadableStream&quot;));
517     @assert(@getByIdDirectPrivate(@getByIdDirectPrivate(reader, &quot;ownerReadableStream&quot;), &quot;reader&quot;) === reader);
518 
519     if (@getByIdDirectPrivate(@getByIdDirectPrivate(reader, &quot;ownerReadableStream&quot;), &quot;state&quot;) === @streamReadable)
520         @getByIdDirectPrivate(reader, &quot;closedPromiseCapability&quot;).@reject.@call(@undefined, @makeTypeError(&quot;releasing lock of reader whose stream is still in readable state&quot;));
521     else
522         @putByIdDirectPrivate(reader, &quot;closedPromiseCapability&quot;, { @promise: @newHandledRejectedPromise(@makeTypeError(&quot;reader released lock&quot;)) });
523 
<span class="line-modified">524     const promise = @getByIdDirectPrivate(reader, &quot;closedPromiseCapability&quot;).@promise;</span>
<span class="line-added">525     @putPromiseInternalField(promise, @promiseFieldFlags, @getPromiseInternalField(promise, @promiseFieldFlags) | @promiseFlagsIsHandled);</span>
526     @putByIdDirectPrivate(@getByIdDirectPrivate(reader, &quot;ownerReadableStream&quot;), &quot;reader&quot;, @undefined);
527     @putByIdDirectPrivate(reader, &quot;ownerReadableStream&quot;, @undefined);
528 }
529 
530 function readableStreamDefaultControllerCanCloseOrEnqueue(controller)
531 {
532     &quot;use strict&quot;;
533 
534     return !@getByIdDirectPrivate(controller, &quot;closeRequested&quot;) &amp;&amp; @getByIdDirectPrivate(@getByIdDirectPrivate(controller, &quot;controlledReadableStream&quot;), &quot;state&quot;) === @streamReadable;
535 }
</pre>
</td>
</tr>
</table>
<center><a href="ReadableStream.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ReadableStreamSource.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>