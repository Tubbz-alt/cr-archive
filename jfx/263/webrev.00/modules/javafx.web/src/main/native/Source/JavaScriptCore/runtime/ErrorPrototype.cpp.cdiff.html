<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ErrorPrototype.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ErrorInstance.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ErrorPrototype.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ErrorPrototype.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 28,13 ***</span>
  #include &quot;JSCInlines.h&quot;
  #include &quot;StringRecursionChecker.h&quot;
  
  namespace JSC {
  
  STATIC_ASSERT_IS_TRIVIALLY_DESTRUCTIBLE(ErrorPrototype);
  
<span class="line-modified">! static EncodedJSValue JSC_HOST_CALL errorProtoFuncToString(ExecState*);</span>
  
  }
  
  #include &quot;ErrorPrototype.lut.h&quot;
  
<span class="line-new-header">--- 28,14 ---</span>
  #include &quot;JSCInlines.h&quot;
  #include &quot;StringRecursionChecker.h&quot;
  
  namespace JSC {
  
<span class="line-added">+ STATIC_ASSERT_IS_TRIVIALLY_DESTRUCTIBLE(ErrorPrototypeBase);</span>
  STATIC_ASSERT_IS_TRIVIALLY_DESTRUCTIBLE(ErrorPrototype);
  
<span class="line-modified">! static EncodedJSValue JSC_HOST_CALL errorProtoFuncToString(JSGlobalObject*, CallFrame*);</span>
  
  }
  
  #include &quot;ErrorPrototype.lut.h&quot;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 46,77 ***</span>
  @begin errorPrototypeTable
    toString          errorProtoFuncToString         DontEnum|Function 0
  @end
  */
  
<span class="line-modified">! ErrorPrototype::ErrorPrototype(VM&amp; vm, Structure* structure)</span>
<span class="line-modified">!     : JSNonFinalObject(vm, structure)</span>
<span class="line-removed">- {</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- ErrorPrototype* ErrorPrototype::create(VM&amp; vm, JSGlobalObject*, Structure* structure)</span>
  {
<span class="line-removed">-     ErrorPrototype* prototype = new (NotNull, allocateCell&lt;ErrorPrototype&gt;(vm.heap)) ErrorPrototype(vm, structure);</span>
<span class="line-removed">-     prototype-&gt;finishCreation(vm, &quot;Error&quot;_s);</span>
<span class="line-removed">-     return prototype;</span>
  }
  
<span class="line-modified">! void ErrorPrototype::finishCreation(VM&amp; vm, const String&amp; name)</span>
  {
      Base::finishCreation(vm);
      ASSERT(inherits(vm, info()));
      putDirectWithoutTransition(vm, vm.propertyNames-&gt;name, jsString(vm, name), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
      putDirectWithoutTransition(vm, vm.propertyNames-&gt;message, jsEmptyString(vm), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
  }
  
  // ------------------------------ Functions ---------------------------
  
  // ECMA-262 5.1, 15.11.4.4
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL errorProtoFuncToString(ExecState* exec)</span>
  {
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      // 1. Let O be the this value.
<span class="line-modified">!     JSValue thisValue = exec-&gt;thisValue();</span>
  
      // 2. If Type(O) is not Object, throw a TypeError exception.
      if (!thisValue.isObject())
<span class="line-modified">!         return throwVMTypeError(exec, scope);</span>
      JSObject* thisObj = asObject(thisValue);
  
      // Guard against recursion!
<span class="line-modified">!     StringRecursionChecker checker(exec, thisObj);</span>
      EXCEPTION_ASSERT(!scope.exception() || checker.earlyReturnValue());
      if (JSValue earlyReturnValue = checker.earlyReturnValue())
          return JSValue::encode(earlyReturnValue);
  
      // 3. Let name be the result of calling the [[Get]] internal method of O with argument &quot;name&quot;.
<span class="line-modified">!     JSValue name = thisObj-&gt;get(exec, vm.propertyNames-&gt;name);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      // 4. If name is undefined, then let name be &quot;Error&quot;; else let name be ToString(name).
      String nameString;
      if (name.isUndefined())
          nameString = &quot;Error&quot;_s;
      else {
<span class="line-modified">!         nameString = name.toWTFString(exec);</span>
          RETURN_IF_EXCEPTION(scope, encodedJSValue());
      }
  
      // 5. Let msg be the result of calling the [[Get]] internal method of O with argument &quot;message&quot;.
<span class="line-modified">!     JSValue message = thisObj-&gt;get(exec, vm.propertyNames-&gt;message);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      // (sic)
      // 6. If msg is undefined, then let msg be the empty String; else let msg be ToString(msg).
      // 7. If msg is undefined, then let msg be the empty String; else let msg be ToString(msg).
      String messageString;
      if (message.isUndefined())
          messageString = String();
      else {
<span class="line-modified">!         messageString = message.toWTFString(exec);</span>
          RETURN_IF_EXCEPTION(scope, encodedJSValue());
      }
  
      // 8. If name is the empty String, return msg.
      if (!nameString.length())
<span class="line-new-header">--- 47,75 ---</span>
  @begin errorPrototypeTable
    toString          errorProtoFuncToString         DontEnum|Function 0
  @end
  */
  
<span class="line-modified">! ErrorPrototypeBase::ErrorPrototypeBase(VM&amp; vm, Structure* structure)</span>
<span class="line-modified">!     : Base(vm, structure)</span>
  {
  }
  
<span class="line-modified">! void ErrorPrototypeBase::finishCreation(VM&amp; vm, const String&amp; name)</span>
  {
      Base::finishCreation(vm);
      ASSERT(inherits(vm, info()));
      putDirectWithoutTransition(vm, vm.propertyNames-&gt;name, jsString(vm, name), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
      putDirectWithoutTransition(vm, vm.propertyNames-&gt;message, jsEmptyString(vm), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
  }
  
<span class="line-added">+ ErrorPrototype::ErrorPrototype(VM&amp; vm, Structure* structure)</span>
<span class="line-added">+     : Base(vm, structure)</span>
<span class="line-added">+ {</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  // ------------------------------ Functions ---------------------------
  
  // ECMA-262 5.1, 15.11.4.4
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL errorProtoFuncToString(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      // 1. Let O be the this value.
<span class="line-modified">!     JSValue thisValue = callFrame-&gt;thisValue();</span>
  
      // 2. If Type(O) is not Object, throw a TypeError exception.
      if (!thisValue.isObject())
<span class="line-modified">!         return throwVMTypeError(globalObject, scope);</span>
      JSObject* thisObj = asObject(thisValue);
  
      // Guard against recursion!
<span class="line-modified">!     StringRecursionChecker checker(globalObject, thisObj);</span>
      EXCEPTION_ASSERT(!scope.exception() || checker.earlyReturnValue());
      if (JSValue earlyReturnValue = checker.earlyReturnValue())
          return JSValue::encode(earlyReturnValue);
  
      // 3. Let name be the result of calling the [[Get]] internal method of O with argument &quot;name&quot;.
<span class="line-modified">!     JSValue name = thisObj-&gt;get(globalObject, vm.propertyNames-&gt;name);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      // 4. If name is undefined, then let name be &quot;Error&quot;; else let name be ToString(name).
      String nameString;
      if (name.isUndefined())
          nameString = &quot;Error&quot;_s;
      else {
<span class="line-modified">!         nameString = name.toWTFString(globalObject);</span>
          RETURN_IF_EXCEPTION(scope, encodedJSValue());
      }
  
      // 5. Let msg be the result of calling the [[Get]] internal method of O with argument &quot;message&quot;.
<span class="line-modified">!     JSValue message = thisObj-&gt;get(globalObject, vm.propertyNames-&gt;message);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      // (sic)
      // 6. If msg is undefined, then let msg be the empty String; else let msg be ToString(msg).
      // 7. If msg is undefined, then let msg be the empty String; else let msg be ToString(msg).
      String messageString;
      if (message.isUndefined())
          messageString = String();
      else {
<span class="line-modified">!         messageString = message.toWTFString(globalObject);</span>
          RETURN_IF_EXCEPTION(scope, encodedJSValue());
      }
  
      // 8. If name is the empty String, return msg.
      if (!nameString.length())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 125,9 ***</span>
      // 9. If msg is the empty String, return name.
      if (!messageString.length())
          return JSValue::encode(name.isString() ? name : jsString(vm, nameString));
  
      // 10. Return the result of concatenating name, &quot;:&quot;, a single space character, and msg.
<span class="line-modified">!     RELEASE_AND_RETURN(scope, JSValue::encode(jsMakeNontrivialString(exec, nameString, &quot;: &quot;, messageString)));</span>
  }
  
  } // namespace JSC
<span class="line-new-header">--- 124,9 ---</span>
      // 9. If msg is the empty String, return name.
      if (!messageString.length())
          return JSValue::encode(name.isString() ? name : jsString(vm, nameString));
  
      // 10. Return the result of concatenating name, &quot;:&quot;, a single space character, and msg.
<span class="line-modified">!     RELEASE_AND_RETURN(scope, JSValue::encode(jsMakeNontrivialString(globalObject, nameString, &quot;: &quot;, messageString)));</span>
  }
  
  } // namespace JSC
</pre>
<center><a href="ErrorInstance.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ErrorPrototype.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>