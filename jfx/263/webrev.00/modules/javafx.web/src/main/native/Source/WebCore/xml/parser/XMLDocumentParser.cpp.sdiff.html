<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/xml/parser/XMLDocumentParser.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../XSLTProcessor.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="XMLDocumentParser.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/xml/parser/XMLDocumentParser.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 14  *
 15  * This library is distributed in the hope that it will be useful,
 16  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 17  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 18  * Library General Public License for more details.
 19  *
 20  * You should have received a copy of the GNU Library General Public License
 21  * along with this library; see the file COPYING.LIB.  If not, write to
 22  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 23  * Boston, MA 02110-1301, USA.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;XMLDocumentParser.h&quot;
 28 
 29 #include &quot;CDATASection.h&quot;
 30 #include &quot;Comment.h&quot;
 31 #include &quot;Document.h&quot;
 32 #include &quot;DocumentFragment.h&quot;
 33 #include &quot;DocumentType.h&quot;

 34 #include &quot;Frame.h&quot;
 35 #include &quot;FrameLoader.h&quot;
 36 #include &quot;FrameView.h&quot;
 37 #include &quot;HTMLLinkElement.h&quot;
 38 #include &quot;HTMLNames.h&quot;
 39 #include &quot;HTMLStyleElement.h&quot;
 40 #include &quot;ImageLoader.h&quot;
 41 #include &quot;PendingScript.h&quot;
 42 #include &quot;ProcessingInstruction.h&quot;
 43 #include &quot;ResourceError.h&quot;
 44 #include &quot;ResourceRequest.h&quot;
 45 #include &quot;ResourceResponse.h&quot;

 46 #include &quot;SVGNames.h&quot;
 47 #include &quot;SVGStyleElement.h&quot;
 48 #include &quot;ScriptElement.h&quot;
 49 #include &quot;ScriptSourceCode.h&quot;
 50 #include &quot;StyleScope.h&quot;
 51 #include &quot;TextResourceDecoder.h&quot;
 52 #include &quot;TreeDepthLimit.h&quot;

 53 #include &lt;wtf/Ref.h&gt;
 54 #include &lt;wtf/Threading.h&gt;
 55 #include &lt;wtf/Vector.h&gt;
 56 
 57 namespace WebCore {
 58 
 59 using namespace HTMLNames;
 60 
 61 void XMLDocumentParser::pushCurrentNode(ContainerNode* n)
 62 {
 63     ASSERT(n);
 64     ASSERT(m_currentNode);
 65     if (n != document())
 66         n-&gt;ref();
 67     m_currentNodeStack.append(m_currentNode);
 68     m_currentNode = n;
 69     if (m_currentNodeStack.size() &gt; maxDOMTreeDepth)
 70         handleError(XMLErrors::fatal, &quot;Excessive node nesting.&quot;, textPosition());
 71 }
 72 
</pre>
<hr />
<pre>
252 
253     if (m_parsingFragment)
254         return;
255 
256     m_parserPaused = true;
257 }
258 
259 bool XMLDocumentParser::parseDocumentFragment(const String&amp; chunk, DocumentFragment&amp; fragment, Element* contextElement, ParserContentPolicy parserContentPolicy)
260 {
261     if (!chunk.length())
262         return true;
263 
264     // FIXME: We need to implement the HTML5 XML Fragment parsing algorithm:
265     // http://www.whatwg.org/specs/web-apps/current-work/multipage/the-xhtml-syntax.html#xml-fragment-parsing-algorithm
266     // For now we have a hack for script/style innerHTML support:
267     if (contextElement &amp;&amp; (contextElement-&gt;hasLocalName(HTMLNames::scriptTag-&gt;localName()) || contextElement-&gt;hasLocalName(HTMLNames::styleTag-&gt;localName()))) {
268         fragment.parserAppendChild(fragment.document().createTextNode(chunk));
269         return true;
270     }
271 
<span class="line-modified">272     auto parser = XMLDocumentParser::create(fragment, contextElement, parserContentPolicy);</span>





















273     bool wellFormed = parser-&gt;appendFragmentSource(chunk);
274     // Do not call finish(). The finish() and doEnd() implementations touch the main document and loader and can cause crashes in the fragment case.
275     parser-&gt;detach(); // Allows ~DocumentParser to assert it was detached before destruction.
276     return wellFormed; // appendFragmentSource()&#39;s wellFormed is more permissive than Document::wellFormed().
277 }
278 
279 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
 14  *
 15  * This library is distributed in the hope that it will be useful,
 16  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 17  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 18  * Library General Public License for more details.
 19  *
 20  * You should have received a copy of the GNU Library General Public License
 21  * along with this library; see the file COPYING.LIB.  If not, write to
 22  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 23  * Boston, MA 02110-1301, USA.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;XMLDocumentParser.h&quot;
 28 
 29 #include &quot;CDATASection.h&quot;
 30 #include &quot;Comment.h&quot;
 31 #include &quot;Document.h&quot;
 32 #include &quot;DocumentFragment.h&quot;
 33 #include &quot;DocumentType.h&quot;
<span class="line-added"> 34 #include &quot;ElementAncestorIterator.h&quot;</span>
 35 #include &quot;Frame.h&quot;
 36 #include &quot;FrameLoader.h&quot;
 37 #include &quot;FrameView.h&quot;
 38 #include &quot;HTMLLinkElement.h&quot;
 39 #include &quot;HTMLNames.h&quot;
 40 #include &quot;HTMLStyleElement.h&quot;
 41 #include &quot;ImageLoader.h&quot;
 42 #include &quot;PendingScript.h&quot;
 43 #include &quot;ProcessingInstruction.h&quot;
 44 #include &quot;ResourceError.h&quot;
 45 #include &quot;ResourceRequest.h&quot;
 46 #include &quot;ResourceResponse.h&quot;
<span class="line-added"> 47 #include &quot;SVGForeignObjectElement.h&quot;</span>
 48 #include &quot;SVGNames.h&quot;
 49 #include &quot;SVGStyleElement.h&quot;
 50 #include &quot;ScriptElement.h&quot;
 51 #include &quot;ScriptSourceCode.h&quot;
 52 #include &quot;StyleScope.h&quot;
 53 #include &quot;TextResourceDecoder.h&quot;
 54 #include &quot;TreeDepthLimit.h&quot;
<span class="line-added"> 55 #include &quot;XMLNSNames.h&quot;</span>
 56 #include &lt;wtf/Ref.h&gt;
 57 #include &lt;wtf/Threading.h&gt;
 58 #include &lt;wtf/Vector.h&gt;
 59 
 60 namespace WebCore {
 61 
 62 using namespace HTMLNames;
 63 
 64 void XMLDocumentParser::pushCurrentNode(ContainerNode* n)
 65 {
 66     ASSERT(n);
 67     ASSERT(m_currentNode);
 68     if (n != document())
 69         n-&gt;ref();
 70     m_currentNodeStack.append(m_currentNode);
 71     m_currentNode = n;
 72     if (m_currentNodeStack.size() &gt; maxDOMTreeDepth)
 73         handleError(XMLErrors::fatal, &quot;Excessive node nesting.&quot;, textPosition());
 74 }
 75 
</pre>
<hr />
<pre>
255 
256     if (m_parsingFragment)
257         return;
258 
259     m_parserPaused = true;
260 }
261 
262 bool XMLDocumentParser::parseDocumentFragment(const String&amp; chunk, DocumentFragment&amp; fragment, Element* contextElement, ParserContentPolicy parserContentPolicy)
263 {
264     if (!chunk.length())
265         return true;
266 
267     // FIXME: We need to implement the HTML5 XML Fragment parsing algorithm:
268     // http://www.whatwg.org/specs/web-apps/current-work/multipage/the-xhtml-syntax.html#xml-fragment-parsing-algorithm
269     // For now we have a hack for script/style innerHTML support:
270     if (contextElement &amp;&amp; (contextElement-&gt;hasLocalName(HTMLNames::scriptTag-&gt;localName()) || contextElement-&gt;hasLocalName(HTMLNames::styleTag-&gt;localName()))) {
271         fragment.parserAppendChild(fragment.document().createTextNode(chunk));
272         return true;
273     }
274 
<span class="line-modified">275     HashMap&lt;AtomString, AtomString&gt; prefixToNamespaceMap;</span>
<span class="line-added">276     AtomString defaultNamespaceURI;</span>
<span class="line-added">277     bool stopLookingForDefaultNamespaceURI = false;</span>
<span class="line-added">278 </span>
<span class="line-added">279     for (auto&amp; element : elementLineage(contextElement)) {</span>
<span class="line-added">280         if (is&lt;SVGForeignObjectElement&gt;(element))</span>
<span class="line-added">281             stopLookingForDefaultNamespaceURI = true;</span>
<span class="line-added">282         else if (!stopLookingForDefaultNamespaceURI)</span>
<span class="line-added">283             defaultNamespaceURI = element.namespaceURI();</span>
<span class="line-added">284 </span>
<span class="line-added">285         if (!element.hasAttributes())</span>
<span class="line-added">286             continue;</span>
<span class="line-added">287 </span>
<span class="line-added">288         for (const Attribute&amp; attribute : element.attributesIterator()) {</span>
<span class="line-added">289             if (attribute.prefix() == xmlnsAtom())</span>
<span class="line-added">290                 prefixToNamespaceMap.set(attribute.localName(), attribute.value());</span>
<span class="line-added">291             else if (!stopLookingForDefaultNamespaceURI &amp;&amp; attribute.prefix() == xmlnsAtom())</span>
<span class="line-added">292                 defaultNamespaceURI = attribute.value();</span>
<span class="line-added">293         }</span>
<span class="line-added">294     }</span>
<span class="line-added">295 </span>
<span class="line-added">296     auto parser = XMLDocumentParser::create(fragment, WTFMove(prefixToNamespaceMap), defaultNamespaceURI, parserContentPolicy);</span>
297     bool wellFormed = parser-&gt;appendFragmentSource(chunk);
298     // Do not call finish(). The finish() and doEnd() implementations touch the main document and loader and can cause crashes in the fragment case.
299     parser-&gt;detach(); // Allows ~DocumentParser to assert it was detached before destruction.
300     return wellFormed; // appendFragmentSource()&#39;s wellFormed is more permissive than Document::wellFormed().
301 }
302 
303 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="../XSLTProcessor.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="XMLDocumentParser.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>