<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/JITInlineCacheGenerator.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2013-2018 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #if ENABLE(JIT)
 29 
 30 #include &quot;CodeOrigin.h&quot;
 31 #include &quot;JITOperations.h&quot;
 32 #include &quot;JSCJSValue.h&quot;
 33 #include &quot;PutKind.h&quot;
 34 #include &quot;RegisterSet.h&quot;
 35 
 36 namespace JSC {
 37 
 38 class CallSiteIndex;
 39 class CodeBlock;
 40 class StructureStubInfo;
 41 
 42 enum class AccessType : int8_t;
 43 
 44 class JITInlineCacheGenerator {
 45 protected:
 46     JITInlineCacheGenerator() { }
 47     JITInlineCacheGenerator(
 48         CodeBlock*, CodeOrigin, CallSiteIndex, AccessType, const RegisterSet&amp; usedRegisters);
 49 
 50 public:
 51     StructureStubInfo* stubInfo() const { return m_stubInfo; }
 52 
 53     void reportSlowPathCall(MacroAssembler::Label slowPathBegin, MacroAssembler::Call call)
 54     {
 55         m_slowPathBegin = slowPathBegin;
 56         m_slowPathCall = call;
 57     }
 58 
 59     MacroAssembler::Label slowPathBegin() const { return m_slowPathBegin; }
 60 
 61     void finalize(
 62         LinkBuffer&amp; fastPathLinkBuffer, LinkBuffer&amp; slowPathLinkBuffer,
 63         CodeLocationLabel&lt;JITStubRoutinePtrTag&gt; start);
 64 
 65 protected:
 66     CodeBlock* m_codeBlock;
 67     StructureStubInfo* m_stubInfo;
 68 
 69     MacroAssembler::Label m_done;
 70     MacroAssembler::Label m_slowPathBegin;
 71     MacroAssembler::Call m_slowPathCall;
 72 };
 73 
 74 class JITByIdGenerator : public JITInlineCacheGenerator {
 75 protected:
 76     JITByIdGenerator() { }
 77 
 78     JITByIdGenerator(
 79         CodeBlock*, CodeOrigin, CallSiteIndex, AccessType, const RegisterSet&amp; usedRegisters,
 80         JSValueRegs base, JSValueRegs value);
 81 
 82 public:
 83     MacroAssembler::Jump slowPathJump() const
 84     {
 85         ASSERT(m_slowPathJump.isSet());
 86         return m_slowPathJump;
 87     }
 88 
 89     void finalize(
 90         LinkBuffer&amp; fastPathLinkBuffer, LinkBuffer&amp; slowPathLinkBuffer);
 91 
 92 protected:
 93 
 94     void generateFastCommon(MacroAssembler&amp;, size_t size);
 95 
 96     JSValueRegs m_base;
 97     JSValueRegs m_value;
 98 
 99     MacroAssembler::Label m_start;
100     MacroAssembler::Jump m_slowPathJump;
101 };
102 
103 class JITGetByIdGenerator : public JITByIdGenerator {
104 public:
105     JITGetByIdGenerator() { }
106 
107     JITGetByIdGenerator(
108         CodeBlock*, CodeOrigin, CallSiteIndex, const RegisterSet&amp; usedRegisters, UniquedStringImpl* propertyName,
109         JSValueRegs base, JSValueRegs value, AccessType);
110 
111     void generateFastPath(MacroAssembler&amp;);
112 
113 private:
114     bool m_isLengthAccess;
115 };
116 
117 class JITGetByIdWithThisGenerator : public JITByIdGenerator {
118 public:
119     JITGetByIdWithThisGenerator() { }
120 
121     JITGetByIdWithThisGenerator(
122         CodeBlock*, CodeOrigin, CallSiteIndex, const RegisterSet&amp; usedRegisters, UniquedStringImpl* propertyName,
<a name="1" id="anc1"></a><span class="line-modified">123         JSValueRegs value, JSValueRegs base, JSValueRegs thisRegs);</span>
124 
125     void generateFastPath(MacroAssembler&amp;);
126 };
127 
128 class JITPutByIdGenerator : public JITByIdGenerator {
129 public:
130     JITPutByIdGenerator() { }
131 
132     JITPutByIdGenerator(
133         CodeBlock*, CodeOrigin, CallSiteIndex, const RegisterSet&amp; usedRegisters, JSValueRegs base,
134         JSValueRegs value, GPRReg scratch, ECMAMode, PutKind);
135 
136     void generateFastPath(MacroAssembler&amp;);
137 
<a name="2" id="anc2"></a><span class="line-modified">138     V_JITOperation_GSsiJJI slowPathFunction();</span>
139 
140 private:
141     ECMAMode m_ecmaMode;
142     PutKind m_putKind;
143 };
144 
145 class JITInByIdGenerator : public JITByIdGenerator {
146 public:
147     JITInByIdGenerator() { }
148 
149     JITInByIdGenerator(
150         CodeBlock*, CodeOrigin, CallSiteIndex, const RegisterSet&amp; usedRegisters, UniquedStringImpl* propertyName,
151         JSValueRegs base, JSValueRegs value);
152 
153     void generateFastPath(MacroAssembler&amp;);
154 };
155 
156 class JITInstanceOfGenerator : public JITInlineCacheGenerator {
157 public:
158     JITInstanceOfGenerator() { }
159 
160     JITInstanceOfGenerator(
161         CodeBlock*, CodeOrigin, CallSiteIndex, const RegisterSet&amp; usedRegisters, GPRReg result,
162         GPRReg value, GPRReg prototype, GPRReg scratch1, GPRReg scratch2,
163         bool prototypeIsKnownObject = false);
164 
165     void generateFastPath(MacroAssembler&amp;);
166 
167     void finalize(LinkBuffer&amp; fastPathLinkBuffer, LinkBuffer&amp; slowPathLinkBuffer);
168 
169 private:
170     MacroAssembler::PatchableJump m_jump;
171 };
172 
<a name="3" id="anc3"></a><span class="line-added">173 class JITGetByValGenerator : public JITInlineCacheGenerator {</span>
<span class="line-added">174     using Base = JITInlineCacheGenerator;</span>
<span class="line-added">175 public:</span>
<span class="line-added">176     JITGetByValGenerator() { }</span>
<span class="line-added">177 </span>
<span class="line-added">178     JITGetByValGenerator(</span>
<span class="line-added">179         CodeBlock*, CodeOrigin, CallSiteIndex, const RegisterSet&amp; usedRegisters,</span>
<span class="line-added">180         JSValueRegs base, JSValueRegs property, JSValueRegs result);</span>
<span class="line-added">181 </span>
<span class="line-added">182     MacroAssembler::Jump slowPathJump() const</span>
<span class="line-added">183     {</span>
<span class="line-added">184         ASSERT(m_slowPathJump.m_jump.isSet());</span>
<span class="line-added">185         return m_slowPathJump.m_jump;</span>
<span class="line-added">186     }</span>
<span class="line-added">187 </span>
<span class="line-added">188     void finalize(</span>
<span class="line-added">189         LinkBuffer&amp; fastPathLinkBuffer, LinkBuffer&amp; slowPathLinkBuffer);</span>
<span class="line-added">190 </span>
<span class="line-added">191     void generateFastPath(MacroAssembler&amp;);</span>
<span class="line-added">192 </span>
<span class="line-added">193 private:</span>
<span class="line-added">194     JSValueRegs m_base;</span>
<span class="line-added">195     JSValueRegs m_result;</span>
<span class="line-added">196     JSValueRegs m_;</span>
<span class="line-added">197 </span>
<span class="line-added">198     MacroAssembler::Label m_start;</span>
<span class="line-added">199     MacroAssembler::PatchableJump m_slowPathJump;</span>
<span class="line-added">200 };</span>
<span class="line-added">201 </span>
202 template&lt;typename VectorType&gt;
203 void finalizeInlineCaches(VectorType&amp; vector, LinkBuffer&amp; fastPath, LinkBuffer&amp; slowPath)
204 {
205     for (auto&amp; entry : vector)
206         entry.finalize(fastPath, slowPath);
207 }
208 
209 template&lt;typename VectorType&gt;
210 void finalizeInlineCaches(VectorType&amp; vector, LinkBuffer&amp; linkBuffer)
211 {
212     finalizeInlineCaches(vector, linkBuffer, linkBuffer);
213 }
214 
215 } // namespace JSC
216 
217 #endif // ENABLE(JIT)
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>