<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/cv/VideoTextureCopierCV.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="VideoTextureCopierCV.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../displaylists/DisplayList.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/cv/VideoTextureCopierCV.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 25,11 ***</span>
  
  #pragma once
  
  #if HAVE(CORE_VIDEO)
  
<span class="line-modified">! #import &quot;GraphicsContext3D.h&quot;</span>
  #import &lt;wtf/UnsafePointer.h&gt;
  
  typedef struct __CVBuffer* CVImageBufferRef;
  typedef struct __CVBuffer* CVPixelBufferRef;
  typedef CVImageBufferRef CVOpenGLTextureRef;
<span class="line-new-header">--- 25,11 ---</span>
  
  #pragma once
  
  #if HAVE(CORE_VIDEO)
  
<span class="line-modified">! #import &quot;GraphicsContextGLOpenGL.h&quot;</span>
  #import &lt;wtf/UnsafePointer.h&gt;
  
  typedef struct __CVBuffer* CVImageBufferRef;
  typedef struct __CVBuffer* CVPixelBufferRef;
  typedef CVImageBufferRef CVOpenGLTextureRef;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 40,66 ***</span>
  class TextureCacheCV;
  
  class VideoTextureCopierCV {
      WTF_MAKE_FAST_ALLOCATED;
  public:
<span class="line-modified">!     VideoTextureCopierCV(GraphicsContext3D&amp;);</span>
      ~VideoTextureCopierCV();
  
  #if PLATFORM(IOS_FAMILY)
      typedef CVOpenGLESTextureRef TextureType;
  #else
      typedef CVOpenGLTextureRef TextureType;
  #endif
  
<span class="line-modified">!     bool copyImageToPlatformTexture(CVPixelBufferRef, size_t width, size_t height, Platform3DObject outputTexture, GC3Denum outputTarget, GC3Dint level, GC3Denum internalFormat, GC3Denum format, GC3Denum type, bool premultiplyAlpha, bool flipY);</span>
<span class="line-modified">!     bool copyVideoTextureToPlatformTexture(TextureType, size_t width, size_t height, Platform3DObject outputTexture, GC3Denum outputTarget, GC3Dint level, GC3Denum internalFormat, GC3Denum format, GC3Denum type, bool premultiplyAlpha, bool flipY, bool swapColorChannels = false);</span>
  
<span class="line-modified">!     GraphicsContext3D&amp; context() { return m_context; }</span>
  
  private:
<span class="line-modified">!     bool copyVideoTextureToPlatformTexture(Platform3DObject inputTexture, GC3Denum inputTarget, size_t width, size_t height, Platform3DObject outputTexture, GC3Denum outputTarget, GC3Dint level, GC3Denum internalFormat, GC3Denum format, GC3Denum type, bool premultiplyAlpha, bool flipY, bool swapColorChannels);</span>
  
      bool initializeContextObjects();
      bool initializeUVContextObjects();
  
  #if HAVE(IOSURFACE)
<span class="line-modified">!     unsigned lastTextureSeed(GC3Duint texture)</span>
      {
          auto iterator = m_lastTextureSeed.find(texture);
          return iterator == m_lastTextureSeed.end() ? 0 : iterator-&gt;value;
      }
  #endif
  
<span class="line-modified">!     Ref&lt;GraphicsContext3D&gt; m_sharedContext;</span>
<span class="line-modified">!     Ref&lt;GraphicsContext3D&gt; m_context;</span>
      std::unique_ptr&lt;TextureCacheCV&gt; m_textureCache;
<span class="line-modified">!     Platform3DObject m_framebuffer { 0 };</span>
<span class="line-modified">!     Platform3DObject m_program { 0 };</span>
<span class="line-modified">!     Platform3DObject m_vertexBuffer { 0 };</span>
<span class="line-modified">!     GC3Dint m_textureUniformLocation { -1 };</span>
<span class="line-modified">!     GC3Dint m_textureDimensionsUniformLocation { -1 };</span>
<span class="line-modified">!     GC3Dint m_flipYUniformLocation { -1 };</span>
<span class="line-modified">!     GC3Dint m_swapColorChannelsUniformLocation { -1 };</span>
<span class="line-modified">!     GC3Dint m_premultiplyUniformLocation { -1 };</span>
<span class="line-modified">!     GC3Dint m_positionAttributeLocation { -1 };</span>
<span class="line-modified">!     Platform3DObject m_yuvProgram { 0 };</span>
<span class="line-modified">!     Platform3DObject m_yuvVertexBuffer { 0 };</span>
<span class="line-modified">!     GC3Dint m_yTextureUniformLocation { -1 };</span>
<span class="line-modified">!     GC3Dint m_uvTextureUniformLocation { -1 };</span>
<span class="line-modified">!     GC3Dint m_yuvFlipYUniformLocation { -1 };</span>
<span class="line-modified">!     GC3Dint m_colorMatrixUniformLocation { -1 };</span>
<span class="line-modified">!     GC3Dint m_yuvPositionAttributeLocation { -1 };</span>
<span class="line-modified">!     GC3Dint m_yTextureSizeUniformLocation { -1 };</span>
<span class="line-modified">!     GC3Dint m_uvTextureSizeUniformLocation { -1 };</span>
  
  #if HAVE(IOSURFACE)
      bool m_lastFlipY { false };
      UnsafePointer&lt;IOSurfaceRef&gt; m_lastSurface;
      uint32_t m_lastSurfaceSeed { 0 };
  
<span class="line-modified">!     using TextureSeedMap = HashMap&lt;GC3Duint, unsigned, WTF::IntHash&lt;GC3Duint&gt;, WTF::UnsignedWithZeroKeyHashTraits&lt;GC3Duint&gt;&gt;;</span>
      TextureSeedMap m_lastTextureSeed;
  #endif
  };
  
  }
<span class="line-new-header">--- 40,79 ---</span>
  class TextureCacheCV;
  
  class VideoTextureCopierCV {
      WTF_MAKE_FAST_ALLOCATED;
  public:
<span class="line-modified">!     VideoTextureCopierCV(GraphicsContextGLOpenGL&amp;);</span>
      ~VideoTextureCopierCV();
  
  #if PLATFORM(IOS_FAMILY)
      typedef CVOpenGLESTextureRef TextureType;
  #else
      typedef CVOpenGLTextureRef TextureType;
  #endif
  
<span class="line-modified">!     bool copyImageToPlatformTexture(CVPixelBufferRef, size_t width, size_t height, PlatformGLObject outputTexture, GCGLenum outputTarget, GCGLint level, GCGLenum internalFormat, GCGLenum format, GCGLenum type, bool premultiplyAlpha, bool flipY);</span>
<span class="line-modified">!     bool copyVideoTextureToPlatformTexture(TextureType, size_t width, size_t height, PlatformGLObject outputTexture, GCGLenum outputTarget, GCGLint level, GCGLenum internalFormat, GCGLenum format, GCGLenum type, bool premultiplyAlpha, bool flipY, bool swapColorChannels = false);</span>
  
<span class="line-modified">!     GraphicsContextGLOpenGL&amp; context() { return m_context; }</span>
  
  private:
<span class="line-modified">!     bool copyVideoTextureToPlatformTexture(PlatformGLObject inputTexture, GCGLenum inputTarget, size_t width, size_t height, PlatformGLObject outputTexture, GCGLenum outputTarget, GCGLint level, GCGLenum internalFormat, GCGLenum format, GCGLenum type, bool premultiplyAlpha, bool flipY, bool swapColorChannels);</span>
  
      bool initializeContextObjects();
      bool initializeUVContextObjects();
  
  #if HAVE(IOSURFACE)
<span class="line-modified">!     unsigned lastTextureSeed(GCGLuint texture)</span>
      {
          auto iterator = m_lastTextureSeed.find(texture);
          return iterator == m_lastTextureSeed.end() ? 0 : iterator-&gt;value;
      }
  #endif
  
<span class="line-modified">! #if USE(ANGLE)</span>
<span class="line-modified">! #if !HAVE(IOSURFACE)</span>
<span class="line-added">+ #error USE(ANGLE) requires HAVE(IOSURFACE)</span>
<span class="line-added">+ #endif // !HAVE(IOSURFACE)</span>
<span class="line-added">+ </span>
<span class="line-added">+     // Returns a handle which, if non-null, must be released via the</span>
<span class="line-added">+     // detach call below.</span>
<span class="line-added">+     void* attachIOSurfaceToTexture(GCGLenum target, GCGLenum internalFormat, GCGLsizei width, GCGLsizei height, GCGLenum type, IOSurfaceRef, GCGLuint plane);</span>
<span class="line-added">+     void detachIOSurfaceFromTexture(void* handle);</span>
<span class="line-added">+ #endif</span>
<span class="line-added">+ </span>
<span class="line-added">+     Ref&lt;GraphicsContextGLOpenGL&gt; m_sharedContext;</span>
<span class="line-added">+     Ref&lt;GraphicsContextGLOpenGL&gt; m_context;</span>
<span class="line-added">+ #if !USE(ANGLE)</span>
      std::unique_ptr&lt;TextureCacheCV&gt; m_textureCache;
<span class="line-modified">! #endif</span>
<span class="line-modified">!     PlatformGLObject m_framebuffer { 0 };</span>
<span class="line-modified">!     PlatformGLObject m_program { 0 };</span>
<span class="line-modified">!     PlatformGLObject m_vertexBuffer { 0 };</span>
<span class="line-modified">!     GCGLint m_textureUniformLocation { -1 };</span>
<span class="line-modified">!     GCGLint m_textureDimensionsUniformLocation { -1 };</span>
<span class="line-modified">!     GCGLint m_flipYUniformLocation { -1 };</span>
<span class="line-modified">!     GCGLint m_swapColorChannelsUniformLocation { -1 };</span>
<span class="line-modified">!     GCGLint m_premultiplyUniformLocation { -1 };</span>
<span class="line-modified">!     GCGLint m_positionAttributeLocation { -1 };</span>
<span class="line-modified">!     PlatformGLObject m_yuvProgram { 0 };</span>
<span class="line-modified">!     PlatformGLObject m_yuvVertexBuffer { 0 };</span>
<span class="line-modified">!     GCGLint m_yTextureUniformLocation { -1 };</span>
<span class="line-modified">!     GCGLint m_uvTextureUniformLocation { -1 };</span>
<span class="line-modified">!     GCGLint m_yuvFlipYUniformLocation { -1 };</span>
<span class="line-modified">!     GCGLint m_colorMatrixUniformLocation { -1 };</span>
<span class="line-modified">!     GCGLint m_yuvPositionAttributeLocation { -1 };</span>
<span class="line-modified">!     GCGLint m_yTextureSizeUniformLocation { -1 };</span>
<span class="line-added">+     GCGLint m_uvTextureSizeUniformLocation { -1 };</span>
  
  #if HAVE(IOSURFACE)
      bool m_lastFlipY { false };
      UnsafePointer&lt;IOSurfaceRef&gt; m_lastSurface;
      uint32_t m_lastSurfaceSeed { 0 };
  
<span class="line-modified">!     using TextureSeedMap = HashMap&lt;GCGLuint, unsigned, WTF::IntHash&lt;GCGLuint&gt;, WTF::UnsignedWithZeroKeyHashTraits&lt;GCGLuint&gt;&gt;;</span>
      TextureSeedMap m_lastTextureSeed;
  #endif
  };
  
  }
</pre>
<center><a href="VideoTextureCopierCV.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../displaylists/DisplayList.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>