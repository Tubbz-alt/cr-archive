<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/Modules/mediastream/MediaStream.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MediaDevices.idl.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaStream.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/mediastream/MediaStream.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 77,11 ***</span>
  }
  
  MediaStream::MediaStream(Document&amp; document, const MediaStreamTrackVector&amp; tracks)
      : ActiveDOMObject(document)
      , m_private(MediaStreamPrivate::create(document.logger(), createTrackPrivateVector(tracks)))
<span class="line-removed">-     , m_mediaSession(PlatformMediaSession::create(*this))</span>
  {
      // This constructor preserves MediaStreamTrack instances and must be used by calls originating
      // from the JavaScript MediaStream constructor.
  
      for (auto&amp; track : tracks) {
<span class="line-new-header">--- 77,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 95,22 ***</span>
  }
  
  MediaStream::MediaStream(Document&amp; document, Ref&lt;MediaStreamPrivate&gt;&amp;&amp; streamPrivate)
      : ActiveDOMObject(document)
      , m_private(WTFMove(streamPrivate))
<span class="line-removed">-     , m_mediaSession(PlatformMediaSession::create(*this))</span>
  {
      ALWAYS_LOG(LOGIDENTIFIER);
  
<span class="line-removed">-     setIsActive(m_private-&gt;active());</span>
<span class="line-removed">-     m_private-&gt;addObserver(*this);</span>
<span class="line-removed">- </span>
      for (auto&amp; trackPrivate : m_private-&gt;tracks()) {
          auto track = MediaStreamTrack::create(document, *trackPrivate);
          track-&gt;addObserver(*this);
          m_trackSet.add(track-&gt;id(), WTFMove(track));
      }
      suspendIfNeeded();
  }
  
  MediaStream::~MediaStream()
  {
<span class="line-new-header">--- 94,21 ---</span>
  }
  
  MediaStream::MediaStream(Document&amp; document, Ref&lt;MediaStreamPrivate&gt;&amp;&amp; streamPrivate)
      : ActiveDOMObject(document)
      , m_private(WTFMove(streamPrivate))
  {
      ALWAYS_LOG(LOGIDENTIFIER);
  
      for (auto&amp; trackPrivate : m_private-&gt;tracks()) {
          auto track = MediaStreamTrack::create(document, *trackPrivate);
          track-&gt;addObserver(*this);
          m_trackSet.add(track-&gt;id(), WTFMove(track));
      }
<span class="line-added">+ </span>
<span class="line-added">+     setIsActive(m_private-&gt;active());</span>
<span class="line-added">+     m_private-&gt;addObserver(*this);</span>
      suspendIfNeeded();
  }
  
  MediaStream::~MediaStream()
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 300,26 ***</span>
      }
  
      if (m_isProducingData)
          return;
      m_isProducingData = true;
<span class="line-removed">- </span>
<span class="line-removed">-     m_mediaSession-&gt;canProduceAudioChanged();</span>
      m_private-&gt;startProducingData();
  }
  
  void MediaStream::stopProducingData()
  {
      if (!m_isProducingData)
          return;
  
<span class="line-removed">-     ALWAYS_LOG(LOGIDENTIFIER);</span>
<span class="line-removed">- </span>
      m_isProducingData = false;
<span class="line-removed">- </span>
<span class="line-removed">-     m_mediaSession-&gt;canProduceAudioChanged();</span>
<span class="line-removed">- </span>
      m_private-&gt;stopProducingData();
  }
  
  MediaProducer::MediaStateFlags MediaStream::mediaState() const
  {
<span class="line-new-header">--- 298,21 ---</span>
      }
  
      if (m_isProducingData)
          return;
      m_isProducingData = true;
      m_private-&gt;startProducingData();
  }
  
  void MediaStream::stopProducingData()
  {
<span class="line-added">+     ALWAYS_LOG(LOGIDENTIFIER);</span>
<span class="line-added">+ </span>
      if (!m_isProducingData)
          return;
  
      m_isProducingData = false;
      m_private-&gt;stopProducingData();
  }
  
  MediaProducer::MediaStateFlags MediaStream::mediaState() const
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 334,13 ***</span>
      return state;
  }
  
  void MediaStream::statusDidChange()
  {
<span class="line-modified">!     m_mediaSession-&gt;canProduceAudioChanged();</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (Document* document = this-&gt;document()) {</span>
          if (!m_isActive)
              return;
          document-&gt;updateIsPlayingMedia();
      }
  }
<span class="line-new-header">--- 327,11 ---</span>
      return state;
  }
  
  void MediaStream::statusDidChange()
  {
<span class="line-modified">!     if (auto* document = this-&gt;document()) {</span>
          if (!m_isActive)
              return;
          document-&gt;updateIsPlayingMedia();
      }
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 397,87 ***</span>
  Document* MediaStream::document() const
  {
      return downcast&lt;Document&gt;(scriptExecutionContext());
  }
  
<span class="line-removed">- PlatformMediaSession::MediaType MediaStream::mediaType() const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     // We only need to override the type when capturing audio, HTMLMediaElement and/or WebAudio</span>
<span class="line-removed">-     // will do the right thing when a stream is attached to a media element or an audio context.</span>
<span class="line-removed">-     if (m_private-&gt;hasAudio() &amp;&amp; m_isProducingData &amp;&amp; m_private-&gt;hasCaptureAudioSource())</span>
<span class="line-removed">-         return PlatformMediaSession::MediaStreamCapturingAudio;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return PlatformMediaSession::None;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- PlatformMediaSession::MediaType MediaStream::presentationType() const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     return mediaType();</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- PlatformMediaSession::CharacteristicsFlags MediaStream::characteristics() const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     PlatformMediaSession::CharacteristicsFlags state = PlatformMediaSession::HasNothing;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (!m_isProducingData)</span>
<span class="line-removed">-         return state;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (m_private-&gt;hasAudio())</span>
<span class="line-removed">-         state |= PlatformMediaSession::HasAudio;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (m_private-&gt;hasVideo())</span>
<span class="line-removed">-         state |= PlatformMediaSession::HasVideo;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return state;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- void MediaStream::mayResumePlayback(bool)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     // FIXME: should a media stream pay attention to this directly, or only when attached to a media element?</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- void MediaStream::suspendPlayback()</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     // FIXME: should a media stream pay attention to this directly, or only when attached to a media element?</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- String MediaStream::sourceApplicationIdentifier() const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     Document* document = this-&gt;document();</span>
<span class="line-removed">-     if (document &amp;&amp; document-&gt;frame()) {</span>
<span class="line-removed">-         if (NetworkingContext* networkingContext = document-&gt;frame()-&gt;loader().networkingContext())</span>
<span class="line-removed">-             return networkingContext-&gt;sourceApplicationIdentifier();</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return emptyString();</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- bool MediaStream::canProduceAudio() const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     return !muted() &amp;&amp; active() &amp;&amp; m_private-&gt;hasAudio() &amp;&amp; m_isProducingData;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- bool MediaStream::processingUserGestureForMedia() const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     return document() ? document()-&gt;processingUserGestureForMedia() : false;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  void MediaStream::stop()
  {
      m_isActive = false;
  }
  
  const char* MediaStream::activeDOMObjectName() const
  {
      return &quot;MediaStream&quot;;
  }
  
<span class="line-removed">- bool MediaStream::canSuspendForDocumentSuspension() const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     return !hasPendingActivity();</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  bool MediaStream::hasPendingActivity() const
  {
      return m_isActive;
  }
  
<span class="line-new-header">--- 388,20 ---</span>
</pre>
<center><a href="MediaDevices.idl.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaStream.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>