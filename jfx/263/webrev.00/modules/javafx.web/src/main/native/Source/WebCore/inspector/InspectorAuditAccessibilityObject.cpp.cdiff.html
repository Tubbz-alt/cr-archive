<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorAuditAccessibilityObject.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DOMPatchSupport.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorCanvas.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorAuditAccessibilityObject.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 27,11 ***</span>
  #include &quot;config.h&quot;
  #include &quot;InspectorAuditAccessibilityObject.h&quot;
  
  #include &quot;AXObjectCache.h&quot;
  #include &quot;AccessibilityNodeObject.h&quot;
<span class="line-modified">! #include &quot;AccessibilityObject.h&quot;</span>
  #include &quot;ContainerNode.h&quot;
  #include &quot;Document.h&quot;
  #include &quot;Element.h&quot;
  #include &quot;ElementDescendantIterator.h&quot;
  #include &quot;HTMLNames.h&quot;
<span class="line-new-header">--- 27,11 ---</span>
  #include &quot;config.h&quot;
  #include &quot;InspectorAuditAccessibilityObject.h&quot;
  
  #include &quot;AXObjectCache.h&quot;
  #include &quot;AccessibilityNodeObject.h&quot;
<span class="line-modified">! #include &quot;AccessibilityObjectInterface.h&quot;</span>
  #include &quot;ContainerNode.h&quot;
  #include &quot;Document.h&quot;
  #include &quot;Element.h&quot;
  #include &quot;ElementDescendantIterator.h&quot;
  #include &quot;HTMLNames.h&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 51,11 ***</span>
  InspectorAuditAccessibilityObject::InspectorAuditAccessibilityObject(InspectorAuditAgent&amp; auditAgent)
      : m_auditAgent(auditAgent)
  {
  }
  
<span class="line-modified">! static AccessibilityObject* accessiblityObjectForNode(Node&amp; node)</span>
  {
      if (!AXObjectCache::accessibilityEnabled())
          AXObjectCache::enableAccessibility();
  
      if (AXObjectCache* axObjectCache = node.document().axObjectCache())
<span class="line-new-header">--- 51,11 ---</span>
  InspectorAuditAccessibilityObject::InspectorAuditAccessibilityObject(InspectorAuditAgent&amp; auditAgent)
      : m_auditAgent(auditAgent)
  {
  }
  
<span class="line-modified">! static AXCoreObject* accessiblityObjectForNode(Node&amp; node)</span>
  {
      if (!AXObjectCache::accessibilityEnabled())
          AXObjectCache::enableAccessibility();
  
      if (AXObjectCache* axObjectCache = node.document().axObjectCache())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 69,11 ***</span>
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Vector&lt;Ref&lt;Node&gt;&gt; nodes;
  
      for (Element&amp; element : elementDescendants(is&lt;ContainerNode&gt;(container) ? downcast&lt;ContainerNode&gt;(*container) : document)) {
<span class="line-modified">!         if (AccessibilityObject* axObject = accessiblityObjectForNode(element)) {</span>
              if (axObject-&gt;computedRoleString() == role)
                  nodes.append(element);
          }
      }
  
<span class="line-new-header">--- 69,11 ---</span>
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Vector&lt;Ref&lt;Node&gt;&gt; nodes;
  
      for (Element&amp; element : elementDescendants(is&lt;ContainerNode&gt;(container) ? downcast&lt;ContainerNode&gt;(*container) : document)) {
<span class="line-modified">!         if (AXCoreObject* axObject = accessiblityObjectForNode(element)) {</span>
              if (axObject-&gt;computedRoleString() == role)
                  nodes.append(element);
          }
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 82,21 ***</span>
  
  ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getActiveDescendant(Node&amp; node)
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
<span class="line-modified">!     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
<span class="line-modified">!         if (AccessibilityObject* activeDescendant = axObject-&gt;activeDescendant())</span>
              return activeDescendant-&gt;node();
      }
  
      return nullptr;
  }
  
<span class="line-modified">! static void addChildren(AccessibilityObject&amp; parentObject, Vector&lt;RefPtr&lt;Node&gt;&gt;&amp; childNodes)</span>
  {
<span class="line-modified">!     for (const RefPtr&lt;AccessibilityObject&gt;&amp; childObject : parentObject.children()) {</span>
          if (Node* childNode = childObject-&gt;node())
              childNodes.append(childNode);
          else
              addChildren(*childObject, childNodes);
      }
<span class="line-new-header">--- 82,21 ---</span>
  
  ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getActiveDescendant(Node&amp; node)
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
<span class="line-modified">!     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
<span class="line-modified">!         if (AXCoreObject* activeDescendant = axObject-&gt;activeDescendant())</span>
              return activeDescendant-&gt;node();
      }
  
      return nullptr;
  }
  
<span class="line-modified">! static void addChildren(AXCoreObject&amp; parentObject, Vector&lt;RefPtr&lt;Node&gt;&gt;&amp; childNodes)</span>
  {
<span class="line-modified">!     for (const auto&amp; childObject : parentObject.children()) {</span>
          if (Node* childNode = childObject-&gt;node())
              childNodes.append(childNode);
          else
              addChildren(*childObject, childNodes);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 106,11 ***</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
  
<span class="line-modified">!     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
          Vector&lt;RefPtr&lt;Node&gt;&gt; childNodes;
          addChildren(*axObject, childNodes);
          result = WTFMove(childNodes);
      }
  
<span class="line-new-header">--- 106,11 ---</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
  
<span class="line-modified">!     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
          Vector&lt;RefPtr&lt;Node&gt;&gt; childNodes;
          addChildren(*axObject, childNodes);
          result = WTFMove(childNodes);
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 121,14 ***</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;InspectorAuditAccessibilityObject::ComputedProperties&gt; result;
  
<span class="line-modified">!     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
          ComputedProperties computedProperties;
  
<span class="line-modified">!         AccessibilityObject* current = axObject;</span>
          while (current &amp;&amp; (!computedProperties.busy || !computedProperties.busy.value())) {
              computedProperties.busy = current-&gt;isBusy();
              current = current-&gt;parentObject();
          }
  
<span class="line-new-header">--- 121,14 ---</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;InspectorAuditAccessibilityObject::ComputedProperties&gt; result;
  
<span class="line-modified">!     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
          ComputedProperties computedProperties;
  
<span class="line-modified">!         AXCoreObject* current = axObject;</span>
          while (current &amp;&amp; (!computedProperties.busy || !computedProperties.busy.value())) {
              computedProperties.busy = current-&gt;isBusy();
              current = current-&gt;parentObject();
          }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 245,11 ***</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
  
<span class="line-modified">!     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
          Vector&lt;RefPtr&lt;Node&gt;&gt; controlledNodes;
  
          Vector&lt;Element*&gt; controlledElements;
          axObject-&gt;elementsFromAttribute(controlledElements, HTMLNames::aria_controlsAttr);
          for (Element* controlledElement : controlledElements) {
<span class="line-new-header">--- 245,11 ---</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
  
<span class="line-modified">!     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
          Vector&lt;RefPtr&lt;Node&gt;&gt; controlledNodes;
  
          Vector&lt;Element*&gt; controlledElements;
          axObject-&gt;elementsFromAttribute(controlledElements, HTMLNames::aria_controlsAttr);
          for (Element* controlledElement : controlledElements) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 267,11 ***</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
  
<span class="line-modified">!     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
          Vector&lt;RefPtr&lt;Node&gt;&gt; flowedNodes;
  
          Vector&lt;Element*&gt; flowedElements;
          axObject-&gt;elementsFromAttribute(flowedElements, HTMLNames::aria_flowtoAttr);
          for (Element* flowedElement : flowedElements) {
<span class="line-new-header">--- 267,11 ---</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
  
<span class="line-modified">!     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
          Vector&lt;RefPtr&lt;Node&gt;&gt; flowedNodes;
  
          Vector&lt;Element*&gt; flowedElements;
          axObject-&gt;elementsFromAttribute(flowedElements, HTMLNames::aria_flowtoAttr);
          for (Element* flowedElement : flowedElements) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 287,11 ***</span>
  
  ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getMouseEventNode(Node&amp; node)
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
<span class="line-modified">!     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
          if (is&lt;AccessibilityNodeObject&gt;(axObject))
              return downcast&lt;AccessibilityNodeObject&gt;(axObject)-&gt;mouseButtonListener(MouseButtonListenerResultFilter::IncludeBodyElement);
      }
  
      return nullptr;
<span class="line-new-header">--- 287,11 ---</span>
  
  ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getMouseEventNode(Node&amp; node)
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
<span class="line-modified">!     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
          if (is&lt;AccessibilityNodeObject&gt;(axObject))
              return downcast&lt;AccessibilityNodeObject&gt;(axObject)-&gt;mouseButtonListener(MouseButtonListenerResultFilter::IncludeBodyElement);
      }
  
      return nullptr;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 301,11 ***</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
  
<span class="line-modified">!     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
          if (axObject-&gt;supportsARIAOwns()) {
              Vector&lt;RefPtr&lt;Node&gt;&gt; ownedNodes;
  
              Vector&lt;Element*&gt; ownedElements;
              axObject-&gt;elementsFromAttribute(ownedElements, HTMLNames::aria_ownsAttr);
<span class="line-new-header">--- 301,11 ---</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
  
<span class="line-modified">!     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
          if (axObject-&gt;supportsARIAOwns()) {
              Vector&lt;RefPtr&lt;Node&gt;&gt; ownedNodes;
  
              Vector&lt;Element*&gt; ownedElements;
              axObject-&gt;elementsFromAttribute(ownedElements, HTMLNames::aria_ownsAttr);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 323,12 ***</span>
  
  ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getParentNode(Node&amp; node)
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
<span class="line-modified">!     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
<span class="line-modified">!         if (AccessibilityObject* parentObject = axObject-&gt;parentObjectUnignored())</span>
              return parentObject-&gt;node();
      }
  
      return nullptr;
  }
<span class="line-new-header">--- 323,12 ---</span>
  
  ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getParentNode(Node&amp; node)
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
<span class="line-modified">!     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
<span class="line-modified">!         if (AXCoreObject* parentObject = axObject-&gt;parentObjectUnignored())</span>
              return parentObject-&gt;node();
      }
  
      return nullptr;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 337,16 ***</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
  
<span class="line-modified">!     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
          Vector&lt;RefPtr&lt;Node&gt;&gt; selectedChildNodes;
  
<span class="line-modified">!         AccessibilityObject::AccessibilityChildrenVector selectedChildren;</span>
          axObject-&gt;selectedChildren(selectedChildren);
<span class="line-modified">!         for (RefPtr&lt;AccessibilityObject&gt;&amp; selectedChildObject : selectedChildren) {</span>
              if (Node* selectedChildNode = selectedChildObject-&gt;node())
                  selectedChildNodes.append(selectedChildNode);
          }
  
          result = WTFMove(selectedChildNodes);
<span class="line-new-header">--- 337,16 ---</span>
  {
      ERROR_IF_NO_ACTIVE_AUDIT();
  
      Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
  
<span class="line-modified">!     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
          Vector&lt;RefPtr&lt;Node&gt;&gt; selectedChildNodes;
  
<span class="line-modified">!         AXCoreObject::AccessibilityChildrenVector selectedChildren;</span>
          axObject-&gt;selectedChildren(selectedChildren);
<span class="line-modified">!         for (auto&amp; selectedChildObject : selectedChildren) {</span>
              if (Node* selectedChildNode = selectedChildObject-&gt;node())
                  selectedChildNodes.append(selectedChildNode);
          }
  
          result = WTFMove(selectedChildNodes);
</pre>
<center><a href="DOMPatchSupport.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorCanvas.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>