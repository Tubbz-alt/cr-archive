<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMWrapperCache.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSDOMWrapper.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSDeprecatedCSSOMValueCustom.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMWrapperCache.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -38,11 +38,11 @@</span>
  
  WEBCORE_EXPORT JSC::Structure* getCachedDOMStructure(JSDOMGlobalObject&amp;, const JSC::ClassInfo*);
  WEBCORE_EXPORT JSC::Structure* cacheDOMStructure(JSDOMGlobalObject&amp;, JSC::Structure*, const JSC::ClassInfo*);
  
  template&lt;typename WrapperClass&gt; JSC::Structure* getDOMStructure(JSC::VM&amp;, JSDOMGlobalObject&amp;);
<span class="udiff-line-modified-removed">- template&lt;typename WrapperClass&gt; JSC::Structure* deprecatedGetDOMStructure(JSC::ExecState*);</span>
<span class="udiff-line-modified-added">+ template&lt;typename WrapperClass&gt; JSC::Structure* deprecatedGetDOMStructure(JSC::JSGlobalObject*);</span>
  template&lt;typename WrapperClass&gt; JSC::JSObject* getDOMPrototype(JSC::VM&amp;, JSC::JSGlobalObject*);
  
  JSC::WeakHandleOwner* wrapperOwner(DOMWrapperWorld&amp;, JSC::ArrayBuffer*);
  void* wrapperKey(JSC::ArrayBuffer*);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -63,34 +63,34 @@</span>
  template&lt;typename DOMClass, typename WrapperClass&gt; void cacheWrapper(DOMWrapperWorld&amp;, DOMClass*, WrapperClass*);
  template&lt;typename DOMClass, typename WrapperClass&gt; void uncacheWrapper(DOMWrapperWorld&amp;, DOMClass*, WrapperClass*);
  template&lt;typename DOMClass, typename T&gt; auto createWrapper(JSDOMGlobalObject*, Ref&lt;T&gt;&amp;&amp;) -&gt; typename std::enable_if&lt;std::is_same&lt;DOMClass, T&gt;::value, typename JSDOMWrapperConverterTraits&lt;DOMClass&gt;::WrapperClass*&gt;::type;
  template&lt;typename DOMClass, typename T&gt; auto createWrapper(JSDOMGlobalObject*, Ref&lt;T&gt;&amp;&amp;) -&gt; typename std::enable_if&lt;!std::is_same&lt;DOMClass, T&gt;::value, typename JSDOMWrapperConverterTraits&lt;DOMClass&gt;::WrapperClass*&gt;::type;
  
<span class="udiff-line-modified-removed">- template&lt;typename DOMClass&gt; JSC::JSValue wrap(JSC::ExecState*, JSDOMGlobalObject*, DOMClass&amp;);</span>
<span class="udiff-line-modified-added">+ template&lt;typename DOMClass&gt; JSC::JSValue wrap(JSC::JSGlobalObject*, JSDOMGlobalObject*, DOMClass&amp;);</span>
  
  
  // Inline functions and template definitions.
  
<span class="udiff-line-modified-removed">- inline JSDOMGlobalObject* deprecatedGlobalObjectForPrototype(JSC::ExecState* exec)</span>
<span class="udiff-line-modified-added">+ inline JSDOMGlobalObject* deprecatedGlobalObjectForPrototype(JSC::JSGlobalObject* lexicalGlobalObject)</span>
  {
      // FIXME: Callers to this function should be using the global object
      // from which the object is being created, instead of assuming the lexical one.
      // e.g. subframe.document.body should use the subframe&#39;s global object, not the lexical one.
<span class="udiff-line-modified-removed">-     return JSC::jsCast&lt;JSDOMGlobalObject*&gt;(exec-&gt;lexicalGlobalObject());</span>
<span class="udiff-line-modified-added">+     return JSC::jsCast&lt;JSDOMGlobalObject*&gt;(lexicalGlobalObject);</span>
  }
  
  template&lt;typename WrapperClass&gt; inline JSC::Structure* getDOMStructure(JSC::VM&amp; vm, JSDOMGlobalObject&amp; globalObject)
  {
      if (JSC::Structure* structure = getCachedDOMStructure(globalObject, WrapperClass::info()))
          return structure;
      return cacheDOMStructure(globalObject, WrapperClass::createStructure(vm, &amp;globalObject, WrapperClass::createPrototype(vm, globalObject)), WrapperClass::info());
  }
  
<span class="udiff-line-modified-removed">- template&lt;typename WrapperClass&gt; inline JSC::Structure* deprecatedGetDOMStructure(JSC::ExecState* exec)</span>
<span class="udiff-line-modified-added">+ template&lt;typename WrapperClass&gt; inline JSC::Structure* deprecatedGetDOMStructure(JSC::JSGlobalObject* lexicalGlobalObject)</span>
  {
      // FIXME: This function is wrong. It uses the wrong global object for creating the prototype structure.
<span class="udiff-line-modified-removed">-     return getDOMStructure&lt;WrapperClass&gt;(exec-&gt;vm(), *deprecatedGlobalObjectForPrototype(exec));</span>
<span class="udiff-line-modified-added">+     return getDOMStructure&lt;WrapperClass&gt;(JSC::getVM(lexicalGlobalObject), *deprecatedGlobalObjectForPrototype(lexicalGlobalObject));</span>
  }
  
  template&lt;typename WrapperClass&gt; inline JSC::JSObject* getDOMPrototype(JSC::VM&amp; vm, JSDOMGlobalObject&amp; globalObject)
  {
      return JSC::jsCast&lt;JSC::JSObject*&gt;(asObject(getDOMStructure&lt;WrapperClass&gt;(vm, globalObject)-&gt;storedPrototype()));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -192,13 +192,13 @@</span>
  template&lt;typename DOMClass, typename T&gt; inline auto createWrapper(JSDOMGlobalObject* globalObject, Ref&lt;T&gt;&amp;&amp; domObject) -&gt; typename std::enable_if&lt;!std::is_same&lt;DOMClass, T&gt;::value, typename JSDOMWrapperConverterTraits&lt;DOMClass&gt;::WrapperClass*&gt;::type
  {
      return createWrapper&lt;DOMClass&gt;(globalObject, static_reference_cast&lt;DOMClass&gt;(WTFMove(domObject)));
  }
  
<span class="udiff-line-modified-removed">- template&lt;typename DOMClass&gt; inline JSC::JSValue wrap(JSC::ExecState* state, JSDOMGlobalObject* globalObject, DOMClass&amp; domObject)</span>
<span class="udiff-line-modified-added">+ template&lt;typename DOMClass&gt; inline JSC::JSValue wrap(JSC::JSGlobalObject* lexicalGlobalObject, JSDOMGlobalObject* globalObject, DOMClass&amp; domObject)</span>
  {
      if (auto* wrapper = getCachedWrapper(globalObject-&gt;world(), domObject))
          return wrapper;
<span class="udiff-line-modified-removed">-     return toJSNewlyCreated(state, globalObject, Ref&lt;DOMClass&gt;(domObject));</span>
<span class="udiff-line-modified-added">+     return toJSNewlyCreated(lexicalGlobalObject, globalObject, Ref&lt;DOMClass&gt;(domObject));</span>
  }
  
  } // namespace WebCore
</pre>
<center><a href="JSDOMWrapper.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSDeprecatedCSSOMValueCustom.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>