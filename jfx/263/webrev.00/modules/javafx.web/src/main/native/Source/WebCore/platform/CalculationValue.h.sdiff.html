<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/CalculationValue.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CalculationValue.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ContentType.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/CalculationValue.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 32 
 33 #include &quot;Length.h&quot;
 34 #include &lt;memory&gt;
 35 #include &lt;wtf/Ref.h&gt;
 36 #include &lt;wtf/RefCounted.h&gt;
 37 #include &lt;wtf/Vector.h&gt;
 38 
 39 namespace WTF {
 40 class TextStream;
 41 }
 42 
 43 namespace WebCore {
 44 
 45 // Don&#39;t change these values; parsing uses them.
 46 enum class CalcOperator : uint8_t {
 47     Add = &#39;+&#39;,
 48     Subtract = &#39;-&#39;,
 49     Multiply = &#39;*&#39;,
 50     Divide = &#39;/&#39;,
 51     Min = 0,
<span class="line-modified"> 52     Max = 1,</span>

 53 };
 54 
 55 enum class CalcExpressionNodeType : uint8_t {
 56     Undefined,
 57     Number,
 58     Length,
 59     Operation,


 60     BlendLength,
 61 };
 62 
 63 class CalcExpressionNode {
 64     WTF_MAKE_FAST_ALLOCATED;
 65 public:
 66     explicit CalcExpressionNode(CalcExpressionNodeType = CalcExpressionNodeType::Undefined);
 67     virtual ~CalcExpressionNode() = default;
 68 
 69     CalcExpressionNodeType type() const { return m_type; }
 70 
 71     virtual float evaluate(float maxValue) const = 0;
 72     virtual bool operator==(const CalcExpressionNode&amp;) const = 0;
 73     virtual void dump(WTF::TextStream&amp;) const = 0;
 74 
 75 private:
 76     CalcExpressionNodeType m_type;
 77 };
 78 
 79 class CalcExpressionNumber final : public CalcExpressionNode {
</pre>
<hr />
<pre>
 87     bool operator==(const CalcExpressionNode&amp;) const override;
 88     void dump(WTF::TextStream&amp;) const override;
 89 
 90     float m_value;
 91 };
 92 
 93 class CalcExpressionLength final : public CalcExpressionNode {
 94 public:
 95     explicit CalcExpressionLength(Length);
 96 
 97     const Length&amp; length() const { return m_length; }
 98 
 99 private:
100     float evaluate(float maxValue) const override;
101     bool operator==(const CalcExpressionNode&amp;) const override;
102     void dump(WTF::TextStream&amp;) const override;
103 
104     Length m_length;
105 };
106 










































107 class CalcExpressionOperation final : public CalcExpressionNode {
108 public:
109     CalcExpressionOperation(Vector&lt;std::unique_ptr&lt;CalcExpressionNode&gt;&gt;&amp;&amp; children, CalcOperator);
110 
111     CalcOperator getOperator() const { return m_operator; }
112 
113     const Vector&lt;std::unique_ptr&lt;CalcExpressionNode&gt;&gt;&amp; children() const { return m_children; }
114 
115 private:
116     float evaluate(float maxValue) const override;
117     bool operator==(const CalcExpressionNode&amp;) const override;
118     void dump(WTF::TextStream&amp;) const override;
119 
120     Vector&lt;std::unique_ptr&lt;CalcExpressionNode&gt;&gt; m_children;
121     CalcOperator m_operator;
122 };
123 
124 class CalcExpressionBlendLength final : public CalcExpressionNode {
125 public:
126     CalcExpressionBlendLength(Length from, Length to, float progress);
</pre>
<hr />
<pre>
164     , m_shouldClampToNonNegative(range == ValueRangeNonNegative)
165 {
166 }
167 
168 inline bool operator==(const CalculationValue&amp; a, const CalculationValue&amp; b)
169 {
170     return a.expression() == b.expression();
171 }
172 
173 inline CalcExpressionNumber::CalcExpressionNumber(float value)
174     : CalcExpressionNode(CalcExpressionNodeType::Number)
175     , m_value(value)
176 {
177 }
178 
179 inline bool operator==(const CalcExpressionNumber&amp; a, const CalcExpressionNumber&amp; b)
180 {
181     return a.value() == b.value();
182 }
183 
<span class="line-removed">184 inline const CalcExpressionNumber&amp; toCalcExpressionNumber(const CalcExpressionNode&amp; value)</span>
<span class="line-removed">185 {</span>
<span class="line-removed">186     ASSERT_WITH_SECURITY_IMPLICATION(value.type() == CalcExpressionNodeType::Number);</span>
<span class="line-removed">187     return static_cast&lt;const CalcExpressionNumber&amp;&gt;(value);</span>
<span class="line-removed">188 }</span>
<span class="line-removed">189 </span>
190 inline CalcExpressionLength::CalcExpressionLength(Length length)
191     : CalcExpressionNode(CalcExpressionNodeType::Length)
192     , m_length(length)
193 {
194 }
195 
196 inline bool operator==(const CalcExpressionLength&amp; a, const CalcExpressionLength&amp; b)
197 {
198     return a.length() == b.length();
199 }
200 
<span class="line-removed">201 inline const CalcExpressionLength&amp; toCalcExpressionLength(const CalcExpressionNode&amp; value)</span>
<span class="line-removed">202 {</span>
<span class="line-removed">203     ASSERT_WITH_SECURITY_IMPLICATION(value.type() == CalcExpressionNodeType::Length);</span>
<span class="line-removed">204     return static_cast&lt;const CalcExpressionLength&amp;&gt;(value);</span>
<span class="line-removed">205 }</span>
<span class="line-removed">206 </span>
207 inline CalcExpressionOperation::CalcExpressionOperation(Vector&lt;std::unique_ptr&lt;CalcExpressionNode&gt;&gt;&amp;&amp; children, CalcOperator op)
208     : CalcExpressionNode(CalcExpressionNodeType::Operation)
209     , m_children(WTFMove(children))
210     , m_operator(op)
211 {
212 }
213 
214 bool operator==(const CalcExpressionOperation&amp;, const CalcExpressionOperation&amp;);
215 
<span class="line-removed">216 inline const CalcExpressionOperation&amp; toCalcExpressionOperation(const CalcExpressionNode&amp; value)</span>
<span class="line-removed">217 {</span>
<span class="line-removed">218     ASSERT_WITH_SECURITY_IMPLICATION(value.type() == CalcExpressionNodeType::Operation);</span>
<span class="line-removed">219     return static_cast&lt;const CalcExpressionOperation&amp;&gt;(value);</span>
<span class="line-removed">220 }</span>
<span class="line-removed">221 </span>
222 inline bool operator==(const CalcExpressionBlendLength&amp; a, const CalcExpressionBlendLength&amp; b)
223 {
224     return a.progress() == b.progress() &amp;&amp; a.from() == b.from() &amp;&amp; a.to() == b.to();
225 }
226 
<span class="line-removed">227 inline const CalcExpressionBlendLength&amp; toCalcExpressionBlendLength(const CalcExpressionNode&amp; value)</span>
<span class="line-removed">228 {</span>
<span class="line-removed">229     ASSERT_WITH_SECURITY_IMPLICATION(value.type() == CalcExpressionNodeType::BlendLength);</span>
<span class="line-removed">230     return static_cast&lt;const CalcExpressionBlendLength&amp;&gt;(value);</span>
<span class="line-removed">231 }</span>
<span class="line-removed">232 </span>
233 WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, const CalculationValue&amp;);
234 WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, const CalcExpressionNode&amp;);
235 WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, CalcOperator);
236 
237 } // namespace WebCore












</pre>
</td>
<td>
<hr />
<pre>
 32 
 33 #include &quot;Length.h&quot;
 34 #include &lt;memory&gt;
 35 #include &lt;wtf/Ref.h&gt;
 36 #include &lt;wtf/RefCounted.h&gt;
 37 #include &lt;wtf/Vector.h&gt;
 38 
 39 namespace WTF {
 40 class TextStream;
 41 }
 42 
 43 namespace WebCore {
 44 
 45 // Don&#39;t change these values; parsing uses them.
 46 enum class CalcOperator : uint8_t {
 47     Add = &#39;+&#39;,
 48     Subtract = &#39;-&#39;,
 49     Multiply = &#39;*&#39;,
 50     Divide = &#39;/&#39;,
 51     Min = 0,
<span class="line-modified"> 52     Max,</span>
<span class="line-added"> 53     Clamp,</span>
 54 };
 55 
 56 enum class CalcExpressionNodeType : uint8_t {
 57     Undefined,
 58     Number,
 59     Length,
 60     Operation,
<span class="line-added"> 61     Negation,</span>
<span class="line-added"> 62     Inversion,</span>
 63     BlendLength,
 64 };
 65 
 66 class CalcExpressionNode {
 67     WTF_MAKE_FAST_ALLOCATED;
 68 public:
 69     explicit CalcExpressionNode(CalcExpressionNodeType = CalcExpressionNodeType::Undefined);
 70     virtual ~CalcExpressionNode() = default;
 71 
 72     CalcExpressionNodeType type() const { return m_type; }
 73 
 74     virtual float evaluate(float maxValue) const = 0;
 75     virtual bool operator==(const CalcExpressionNode&amp;) const = 0;
 76     virtual void dump(WTF::TextStream&amp;) const = 0;
 77 
 78 private:
 79     CalcExpressionNodeType m_type;
 80 };
 81 
 82 class CalcExpressionNumber final : public CalcExpressionNode {
</pre>
<hr />
<pre>
 90     bool operator==(const CalcExpressionNode&amp;) const override;
 91     void dump(WTF::TextStream&amp;) const override;
 92 
 93     float m_value;
 94 };
 95 
 96 class CalcExpressionLength final : public CalcExpressionNode {
 97 public:
 98     explicit CalcExpressionLength(Length);
 99 
100     const Length&amp; length() const { return m_length; }
101 
102 private:
103     float evaluate(float maxValue) const override;
104     bool operator==(const CalcExpressionNode&amp;) const override;
105     void dump(WTF::TextStream&amp;) const override;
106 
107     Length m_length;
108 };
109 
<span class="line-added">110 class CalcExpressionNegation final : public CalcExpressionNode {</span>
<span class="line-added">111 public:</span>
<span class="line-added">112     CalcExpressionNegation(std::unique_ptr&lt;CalcExpressionNode&gt;&amp;&amp; node)</span>
<span class="line-added">113         : CalcExpressionNode(CalcExpressionNodeType::Negation)</span>
<span class="line-added">114         , m_child(WTFMove(node))</span>
<span class="line-added">115     {</span>
<span class="line-added">116         ASSERT(m_child);</span>
<span class="line-added">117     }</span>
<span class="line-added">118 </span>
<span class="line-added">119     float evaluate(float maxValue) const final;</span>
<span class="line-added">120     bool operator==(const CalcExpressionNode&amp;) const final;</span>
<span class="line-added">121     void dump(WTF::TextStream&amp;) const final;</span>
<span class="line-added">122 </span>
<span class="line-added">123     const CalcExpressionNode* child() const { return m_child.get(); }</span>
<span class="line-added">124 </span>
<span class="line-added">125 private:</span>
<span class="line-added">126     std::unique_ptr&lt;CalcExpressionNode&gt; m_child;</span>
<span class="line-added">127 };</span>
<span class="line-added">128 </span>
<span class="line-added">129 bool operator==(const CalcExpressionNegation&amp;, const CalcExpressionNegation&amp;);</span>
<span class="line-added">130 </span>
<span class="line-added">131 class CalcExpressionInversion final : public CalcExpressionNode {</span>
<span class="line-added">132 public:</span>
<span class="line-added">133     CalcExpressionInversion(std::unique_ptr&lt;CalcExpressionNode&gt;&amp;&amp; node)</span>
<span class="line-added">134         : CalcExpressionNode(CalcExpressionNodeType::Inversion)</span>
<span class="line-added">135         , m_child(WTFMove(node))</span>
<span class="line-added">136     {</span>
<span class="line-added">137         ASSERT(m_child);</span>
<span class="line-added">138     }</span>
<span class="line-added">139 </span>
<span class="line-added">140     float evaluate(float maxValue) const final;</span>
<span class="line-added">141     bool operator==(const CalcExpressionNode&amp;) const final;</span>
<span class="line-added">142     void dump(WTF::TextStream&amp;) const final;</span>
<span class="line-added">143 </span>
<span class="line-added">144     const CalcExpressionNode* child() const { return m_child.get(); }</span>
<span class="line-added">145 </span>
<span class="line-added">146 private:</span>
<span class="line-added">147     std::unique_ptr&lt;CalcExpressionNode&gt; m_child;</span>
<span class="line-added">148 };</span>
<span class="line-added">149 </span>
<span class="line-added">150 bool operator==(const CalcExpressionInversion&amp;, const CalcExpressionInversion&amp;);</span>
<span class="line-added">151 </span>
152 class CalcExpressionOperation final : public CalcExpressionNode {
153 public:
154     CalcExpressionOperation(Vector&lt;std::unique_ptr&lt;CalcExpressionNode&gt;&gt;&amp;&amp; children, CalcOperator);
155 
156     CalcOperator getOperator() const { return m_operator; }
157 
158     const Vector&lt;std::unique_ptr&lt;CalcExpressionNode&gt;&gt;&amp; children() const { return m_children; }
159 
160 private:
161     float evaluate(float maxValue) const override;
162     bool operator==(const CalcExpressionNode&amp;) const override;
163     void dump(WTF::TextStream&amp;) const override;
164 
165     Vector&lt;std::unique_ptr&lt;CalcExpressionNode&gt;&gt; m_children;
166     CalcOperator m_operator;
167 };
168 
169 class CalcExpressionBlendLength final : public CalcExpressionNode {
170 public:
171     CalcExpressionBlendLength(Length from, Length to, float progress);
</pre>
<hr />
<pre>
209     , m_shouldClampToNonNegative(range == ValueRangeNonNegative)
210 {
211 }
212 
213 inline bool operator==(const CalculationValue&amp; a, const CalculationValue&amp; b)
214 {
215     return a.expression() == b.expression();
216 }
217 
218 inline CalcExpressionNumber::CalcExpressionNumber(float value)
219     : CalcExpressionNode(CalcExpressionNodeType::Number)
220     , m_value(value)
221 {
222 }
223 
224 inline bool operator==(const CalcExpressionNumber&amp; a, const CalcExpressionNumber&amp; b)
225 {
226     return a.value() == b.value();
227 }
228 






229 inline CalcExpressionLength::CalcExpressionLength(Length length)
230     : CalcExpressionNode(CalcExpressionNodeType::Length)
231     , m_length(length)
232 {
233 }
234 
235 inline bool operator==(const CalcExpressionLength&amp; a, const CalcExpressionLength&amp; b)
236 {
237     return a.length() == b.length();
238 }
239 






240 inline CalcExpressionOperation::CalcExpressionOperation(Vector&lt;std::unique_ptr&lt;CalcExpressionNode&gt;&gt;&amp;&amp; children, CalcOperator op)
241     : CalcExpressionNode(CalcExpressionNodeType::Operation)
242     , m_children(WTFMove(children))
243     , m_operator(op)
244 {
245 }
246 
247 bool operator==(const CalcExpressionOperation&amp;, const CalcExpressionOperation&amp;);
248 






249 inline bool operator==(const CalcExpressionBlendLength&amp; a, const CalcExpressionBlendLength&amp; b)
250 {
251     return a.progress() == b.progress() &amp;&amp; a.from() == b.from() &amp;&amp; a.to() == b.to();
252 }
253 






254 WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, const CalculationValue&amp;);
255 WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, const CalcExpressionNode&amp;);
256 WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, CalcOperator);
257 
258 } // namespace WebCore
<span class="line-added">259 </span>
<span class="line-added">260 #define SPECIALIZE_TYPE_TRAITS_CALCEXPRESSION_NODE(ToValueTypeName, predicate) \</span>
<span class="line-added">261 SPECIALIZE_TYPE_TRAITS_BEGIN(WebCore::ToValueTypeName) \</span>
<span class="line-added">262     static bool isType(const WebCore::CalcExpressionNode&amp; node) { return node.predicate; } \</span>
<span class="line-added">263 SPECIALIZE_TYPE_TRAITS_END()</span>
<span class="line-added">264 </span>
<span class="line-added">265 SPECIALIZE_TYPE_TRAITS_CALCEXPRESSION_NODE(CalcExpressionNumber, type() == WebCore::CalcExpressionNodeType::Number)</span>
<span class="line-added">266 SPECIALIZE_TYPE_TRAITS_CALCEXPRESSION_NODE(CalcExpressionLength, type() == WebCore::CalcExpressionNodeType::Length)</span>
<span class="line-added">267 SPECIALIZE_TYPE_TRAITS_CALCEXPRESSION_NODE(CalcExpressionOperation, type() == WebCore::CalcExpressionNodeType::Operation)</span>
<span class="line-added">268 SPECIALIZE_TYPE_TRAITS_CALCEXPRESSION_NODE(CalcExpressionNegation, type() == WebCore::CalcExpressionNodeType::Negation)</span>
<span class="line-added">269 SPECIALIZE_TYPE_TRAITS_CALCEXPRESSION_NODE(CalcExpressionInversion, type() == WebCore::CalcExpressionNodeType::Inversion)</span>
<span class="line-added">270 SPECIALIZE_TYPE_TRAITS_CALCEXPRESSION_NODE(CalcExpressionBlendLength, type() == WebCore::CalcExpressionNodeType::BlendLength)</span>
</pre>
</td>
</tr>
</table>
<center><a href="CalculationValue.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ContentType.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>