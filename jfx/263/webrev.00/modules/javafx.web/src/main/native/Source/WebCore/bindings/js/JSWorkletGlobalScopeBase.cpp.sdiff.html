<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSWorkletGlobalScopeBase.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSWorkerGlobalScopeCustom.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSWorkletGlobalScopeBase.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSWorkletGlobalScopeBase.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  *
 25  */
 26 
 27 #include &quot;config.h&quot;
 28 #include &quot;JSWorkletGlobalScopeBase.h&quot;
 29 
 30 #if ENABLE(CSS_PAINTING_API)
 31 
 32 #include &quot;DOMWrapperWorld.h&quot;
 33 #include &quot;JSDOMGlobalObjectTask.h&quot;

 34 #include &quot;JSWorkletGlobalScope.h&quot;
 35 #include &quot;WorkletGlobalScope.h&quot;
 36 #include &quot;WorkletScriptController.h&quot;
 37 #include &lt;JavaScriptCore/JSCInlines.h&gt;
 38 #include &lt;JavaScriptCore/JSCJSValueInlines.h&gt;
 39 #include &lt;wtf/Language.h&gt;
 40 
 41 namespace WebCore {
 42 
 43 using namespace JSC;
 44 
 45 const ClassInfo JSWorkletGlobalScopeBase::s_info = { &quot;WorkletGlobalScope&quot;, &amp;JSDOMGlobalObject::s_info, nullptr, nullptr, CREATE_METHOD_TABLE(JSWorkletGlobalScopeBase) };
 46 
 47 const GlobalObjectMethodTable JSWorkletGlobalScopeBase::s_globalObjectMethodTable = {
 48     &amp;supportsRichSourceInfo,
 49     &amp;shouldInterruptScript,
 50     &amp;javaScriptRuntimeFlags,
<span class="line-modified"> 51     nullptr, // queueTaskToEventLoop</span>
 52     &amp;shouldInterruptScriptBeforeTimeout,
 53     nullptr, // moduleLoaderImportModule
 54     nullptr, // moduleLoaderResolve
 55     nullptr, // moduleLoaderFetch
 56     nullptr, // moduleLoaderCreateImportMetaProperties
 57     nullptr, // moduleLoaderEvaluate
 58     &amp;promiseRejectionTracker,
 59     &amp;defaultLanguage,
 60     nullptr, // compileStreaming
 61     nullptr, // instantiateStreaming
 62 };
 63 
 64 JSWorkletGlobalScopeBase::JSWorkletGlobalScopeBase(JSC::VM&amp; vm, JSC::Structure* structure, RefPtr&lt;WorkletGlobalScope&gt;&amp;&amp; impl)
 65     : JSDOMGlobalObject(vm, structure, normalWorld(vm), &amp;s_globalObjectMethodTable)
 66     , m_wrapped(WTFMove(impl))
 67 {
 68 }
 69 
 70 void JSWorkletGlobalScopeBase::finishCreation(VM&amp; vm, JSProxy* proxy)
 71 {
</pre>
<hr />
<pre>
104 {
105     return JSGlobalObject::supportsRichSourceInfo(object);
106 }
107 
108 bool JSWorkletGlobalScopeBase::shouldInterruptScript(const JSGlobalObject* object)
109 {
110     return JSGlobalObject::shouldInterruptScript(object);
111 }
112 
113 bool JSWorkletGlobalScopeBase::shouldInterruptScriptBeforeTimeout(const JSGlobalObject* object)
114 {
115     return JSGlobalObject::shouldInterruptScriptBeforeTimeout(object);
116 }
117 
118 RuntimeFlags JSWorkletGlobalScopeBase::javaScriptRuntimeFlags(const JSGlobalObject* object)
119 {
120     auto* thisObject = jsCast&lt;const JSWorkletGlobalScopeBase*&gt;(object);
121     return thisObject-&gt;m_wrapped-&gt;jsRuntimeFlags();
122 }
123 
<span class="line-modified">124 JSValue toJS(ExecState* exec, JSDOMGlobalObject*, WorkletGlobalScope&amp; workletGlobalScope)</span>
125 {
<span class="line-modified">126     return toJS(exec, workletGlobalScope);</span>
127 }
128 
<span class="line-modified">129 JSValue toJS(ExecState*, WorkletGlobalScope&amp; workletGlobalScope)</span>
130 {
131     if (!workletGlobalScope.script())
132         return jsUndefined();
133     auto* contextWrapper = workletGlobalScope.script()-&gt;workletGlobalScopeWrapper();
134     if (!contextWrapper)
135         return jsUndefined();
136     return contextWrapper-&gt;proxy();
137 }
138 
139 JSWorkletGlobalScope* toJSWorkletGlobalScope(VM&amp; vm, JSValue value)
140 {
141     if (!value.isObject())
142         return nullptr;
143     auto* classInfo = asObject(value)-&gt;classInfo(vm);
144 
145     if (classInfo == JSProxy::info())
146         return jsDynamicCast&lt;JSWorkletGlobalScope*&gt;(vm, jsCast&lt;JSProxy*&gt;(asObject(value))-&gt;target());
147 
148     return nullptr;
149 }
</pre>
</td>
<td>
<hr />
<pre>
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  *
 25  */
 26 
 27 #include &quot;config.h&quot;
 28 #include &quot;JSWorkletGlobalScopeBase.h&quot;
 29 
 30 #if ENABLE(CSS_PAINTING_API)
 31 
 32 #include &quot;DOMWrapperWorld.h&quot;
 33 #include &quot;JSDOMGlobalObjectTask.h&quot;
<span class="line-added"> 34 #include &quot;JSDOMGuardedObject.h&quot;</span>
 35 #include &quot;JSWorkletGlobalScope.h&quot;
 36 #include &quot;WorkletGlobalScope.h&quot;
 37 #include &quot;WorkletScriptController.h&quot;
 38 #include &lt;JavaScriptCore/JSCInlines.h&gt;
 39 #include &lt;JavaScriptCore/JSCJSValueInlines.h&gt;
 40 #include &lt;wtf/Language.h&gt;
 41 
 42 namespace WebCore {
 43 
 44 using namespace JSC;
 45 
 46 const ClassInfo JSWorkletGlobalScopeBase::s_info = { &quot;WorkletGlobalScope&quot;, &amp;JSDOMGlobalObject::s_info, nullptr, nullptr, CREATE_METHOD_TABLE(JSWorkletGlobalScopeBase) };
 47 
 48 const GlobalObjectMethodTable JSWorkletGlobalScopeBase::s_globalObjectMethodTable = {
 49     &amp;supportsRichSourceInfo,
 50     &amp;shouldInterruptScript,
 51     &amp;javaScriptRuntimeFlags,
<span class="line-modified"> 52     nullptr, // queueMicrotaskToEventLoop</span>
 53     &amp;shouldInterruptScriptBeforeTimeout,
 54     nullptr, // moduleLoaderImportModule
 55     nullptr, // moduleLoaderResolve
 56     nullptr, // moduleLoaderFetch
 57     nullptr, // moduleLoaderCreateImportMetaProperties
 58     nullptr, // moduleLoaderEvaluate
 59     &amp;promiseRejectionTracker,
 60     &amp;defaultLanguage,
 61     nullptr, // compileStreaming
 62     nullptr, // instantiateStreaming
 63 };
 64 
 65 JSWorkletGlobalScopeBase::JSWorkletGlobalScopeBase(JSC::VM&amp; vm, JSC::Structure* structure, RefPtr&lt;WorkletGlobalScope&gt;&amp;&amp; impl)
 66     : JSDOMGlobalObject(vm, structure, normalWorld(vm), &amp;s_globalObjectMethodTable)
 67     , m_wrapped(WTFMove(impl))
 68 {
 69 }
 70 
 71 void JSWorkletGlobalScopeBase::finishCreation(VM&amp; vm, JSProxy* proxy)
 72 {
</pre>
<hr />
<pre>
105 {
106     return JSGlobalObject::supportsRichSourceInfo(object);
107 }
108 
109 bool JSWorkletGlobalScopeBase::shouldInterruptScript(const JSGlobalObject* object)
110 {
111     return JSGlobalObject::shouldInterruptScript(object);
112 }
113 
114 bool JSWorkletGlobalScopeBase::shouldInterruptScriptBeforeTimeout(const JSGlobalObject* object)
115 {
116     return JSGlobalObject::shouldInterruptScriptBeforeTimeout(object);
117 }
118 
119 RuntimeFlags JSWorkletGlobalScopeBase::javaScriptRuntimeFlags(const JSGlobalObject* object)
120 {
121     auto* thisObject = jsCast&lt;const JSWorkletGlobalScopeBase*&gt;(object);
122     return thisObject-&gt;m_wrapped-&gt;jsRuntimeFlags();
123 }
124 
<span class="line-modified">125 JSValue toJS(JSGlobalObject* lexicalGlobalObject, JSDOMGlobalObject*, WorkletGlobalScope&amp; workletGlobalScope)</span>
126 {
<span class="line-modified">127     return toJS(lexicalGlobalObject, workletGlobalScope);</span>
128 }
129 
<span class="line-modified">130 JSValue toJS(JSGlobalObject*, WorkletGlobalScope&amp; workletGlobalScope)</span>
131 {
132     if (!workletGlobalScope.script())
133         return jsUndefined();
134     auto* contextWrapper = workletGlobalScope.script()-&gt;workletGlobalScopeWrapper();
135     if (!contextWrapper)
136         return jsUndefined();
137     return contextWrapper-&gt;proxy();
138 }
139 
140 JSWorkletGlobalScope* toJSWorkletGlobalScope(VM&amp; vm, JSValue value)
141 {
142     if (!value.isObject())
143         return nullptr;
144     auto* classInfo = asObject(value)-&gt;classInfo(vm);
145 
146     if (classInfo == JSProxy::info())
147         return jsDynamicCast&lt;JSWorkletGlobalScope*&gt;(vm, jsCast&lt;JSProxy*&gt;(asObject(value))-&gt;target());
148 
149     return nullptr;
150 }
</pre>
</td>
</tr>
</table>
<center><a href="JSWorkerGlobalScopeCustom.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSWorkletGlobalScopeBase.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>