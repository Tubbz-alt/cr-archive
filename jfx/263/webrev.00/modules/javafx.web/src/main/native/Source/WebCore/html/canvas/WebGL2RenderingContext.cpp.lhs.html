<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/html/canvas/WebGL2RenderingContext.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
   2  * Copyright (C) 2015-2017 Apple Inc. All rights reserved.
   3  *
   4  * Redistribution and use in source and binary forms, with or without
   5  * modification, are permitted provided that the following conditions
   6  * are met:
   7  * 1. Redistributions of source code must retain the above copyright
   8  *    notice, this list of conditions and the following disclaimer.
   9  * 2. Redistributions in binary form must reproduce the above copyright
  10  *    notice, this list of conditions and the following disclaimer in the
  11  *    documentation and/or other materials provided with the distribution.
  12  *
  13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
  14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
  17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
  21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  24  */
  25 
  26 #include &quot;config.h&quot;
  27 #include &quot;WebGL2RenderingContext.h&quot;
  28 
  29 #if ENABLE(WEBGL2)
  30 
  31 #include &quot;CachedImage.h&quot;
  32 #include &quot;EXTTextureFilterAnisotropic.h&quot;
<a name="1" id="anc1"></a><span class="line-modified">  33 #include &quot;Extensions3D.h&quot;</span>

  34 #include &quot;HTMLCanvasElement.h&quot;
  35 #include &quot;HTMLImageElement.h&quot;
  36 #include &quot;HTMLVideoElement.h&quot;
  37 #include &quot;ImageData.h&quot;
  38 #include &quot;InspectorInstrumentation.h&quot;
  39 #include &quot;Logging.h&quot;
  40 #include &quot;OESTextureFloat.h&quot;
  41 #include &quot;OESTextureFloatLinear.h&quot;
  42 #include &quot;OESTextureHalfFloat.h&quot;
  43 #include &quot;OESTextureHalfFloatLinear.h&quot;
  44 #include &quot;RenderBox.h&quot;
  45 #include &quot;WebGLActiveInfo.h&quot;
  46 #include &quot;WebGLCompressedTextureASTC.h&quot;
  47 #include &quot;WebGLCompressedTextureATC.h&quot;
<a name="2" id="anc2"></a>

  48 #include &quot;WebGLCompressedTexturePVRTC.h&quot;
  49 #include &quot;WebGLCompressedTextureS3TC.h&quot;
  50 #include &quot;WebGLDebugRendererInfo.h&quot;
  51 #include &quot;WebGLDebugShaders.h&quot;
  52 #include &quot;WebGLDepthTexture.h&quot;
  53 #include &quot;WebGLLoseContext.h&quot;
  54 #include &quot;WebGLQuery.h&quot;
  55 #include &quot;WebGLSampler.h&quot;
  56 #include &quot;WebGLSync.h&quot;
  57 #include &quot;WebGLTransformFeedback.h&quot;
  58 #include &quot;WebGLVertexArrayObject.h&quot;
  59 #include &lt;JavaScriptCore/GenericTypedArrayViewInlines.h&gt;
  60 #include &lt;JavaScriptCore/HeapInlines.h&gt;
  61 #include &lt;JavaScriptCore/JSGenericTypedArrayViewInlines.h&gt;
<a name="3" id="anc3"></a>
  62 #include &lt;wtf/IsoMallocInlines.h&gt;
  63 
  64 namespace WebCore {
  65 
  66 WTF_MAKE_ISO_ALLOCATED_IMPL(WebGL2RenderingContext);
  67 
<a name="4" id="anc4"></a><span class="line-modified">  68 std::unique_ptr&lt;WebGL2RenderingContext&gt; WebGL2RenderingContext::create(CanvasBase&amp; canvas, GraphicsContext3DAttributes attributes)</span>
  69 {
  70     auto renderingContext = std::unique_ptr&lt;WebGL2RenderingContext&gt;(new WebGL2RenderingContext(canvas, attributes));
  71 
  72     InspectorInstrumentation::didCreateCanvasRenderingContext(*renderingContext);
  73 
  74     return renderingContext;
  75 }
  76 
<a name="5" id="anc5"></a><span class="line-modified">  77 std::unique_ptr&lt;WebGL2RenderingContext&gt; WebGL2RenderingContext::create(CanvasBase&amp; canvas, Ref&lt;GraphicsContext3D&gt;&amp;&amp; context, GraphicsContext3DAttributes attributes)</span>
  78 {
  79     auto renderingContext = std::unique_ptr&lt;WebGL2RenderingContext&gt;(new WebGL2RenderingContext(canvas, WTFMove(context), attributes));
  80 
  81     InspectorInstrumentation::didCreateCanvasRenderingContext(*renderingContext);
  82 
  83     return renderingContext;
  84 }
  85 
<a name="6" id="anc6"></a><span class="line-modified">  86 WebGL2RenderingContext::WebGL2RenderingContext(CanvasBase&amp; canvas, GraphicsContext3DAttributes attributes)</span>
  87     : WebGLRenderingContextBase(canvas, attributes)
  88 {
  89 }
  90 
<a name="7" id="anc7"></a><span class="line-modified">  91 WebGL2RenderingContext::WebGL2RenderingContext(CanvasBase&amp; canvas, Ref&lt;GraphicsContext3D&gt;&amp;&amp; context, GraphicsContext3DAttributes attributes)</span>
  92     : WebGLRenderingContextBase(canvas, WTFMove(context), attributes)
  93 {
  94     initializeShaderExtensions();
  95     initializeVertexArrayObjects();
<a name="8" id="anc8"></a>










  96 }
  97 
  98 void WebGL2RenderingContext::initializeVertexArrayObjects()
  99 {
 100     m_defaultVertexArrayObject = WebGLVertexArrayObject::create(*this, WebGLVertexArrayObject::Type::Default);
 101     addContextObject(*m_defaultVertexArrayObject);
 102 #if USE(OPENGL_ES)
 103     m_boundVertexArrayObject = m_defaultVertexArrayObject;
 104 #else
 105     bindVertexArray(nullptr); // The default VAO was removed in OpenGL 3.3 but not from WebGL 2; bind the default for WebGL to use.
 106 #endif
 107     if (!isGLES2Compliant())
 108         initVertexAttrib0();
 109 }
 110 
 111 void WebGL2RenderingContext::initializeShaderExtensions()
 112 {
 113     m_context-&gt;getExtensions().ensureEnabled(&quot;GL_OES_standard_derivatives&quot;);
 114     m_context-&gt;getExtensions().ensureEnabled(&quot;GL_EXT_draw_buffers&quot;);
 115     m_context-&gt;getExtensions().ensureEnabled(&quot;GL_EXT_shader_texture_lod&quot;);
 116     m_context-&gt;getExtensions().ensureEnabled(&quot;GL_EXT_frag_depth&quot;);
 117 }
 118 
<a name="9" id="anc9"></a><span class="line-modified"> 119 inline static Optional&lt;unsigned&gt; arrayBufferViewElementSize(const ArrayBufferView&amp; data)</span>
 120 {
<a name="10" id="anc10"></a><span class="line-modified"> 121     switch (data.getType()) {</span>
<span class="line-modified"> 122     case JSC::NotTypedArray:</span>
<span class="line-modified"> 123     case JSC::TypeDataView:</span>
<span class="line-modified"> 124         return WTF::nullopt;</span>
<span class="line-removed"> 125     case JSC::TypeInt8:</span>
<span class="line-removed"> 126     case JSC::TypeUint8:</span>
<span class="line-removed"> 127     case JSC::TypeUint8Clamped:</span>
<span class="line-removed"> 128     case JSC::TypeInt16:</span>
<span class="line-removed"> 129     case JSC::TypeUint16:</span>
<span class="line-removed"> 130     case JSC::TypeInt32:</span>
<span class="line-removed"> 131     case JSC::TypeUint32:</span>
<span class="line-removed"> 132     case JSC::TypeFloat32:</span>
<span class="line-removed"> 133     case JSC::TypeFloat64:</span>
<span class="line-removed"> 134         return elementSize(data.getType());</span>
<span class="line-removed"> 135     }</span>
<span class="line-removed"> 136     RELEASE_ASSERT_NOT_REACHED();</span>
 137 }
 138 
<a name="11" id="anc11"></a><span class="line-modified"> 139 void WebGL2RenderingContext::bufferData(GC3Denum target, const ArrayBufferView&amp; data, GC3Denum usage, GC3Duint srcOffset, GC3Duint length)</span>
 140 {
<a name="12" id="anc12"></a><span class="line-modified"> 141     auto optionalElementSize = arrayBufferViewElementSize(data);</span>
<span class="line-modified"> 142     if (!optionalElementSize) {</span>
<span class="line-modified"> 143         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;bufferData&quot;, &quot;Invalid type of Array Buffer View&quot;);</span>
<span class="line-removed"> 144         return;</span>
<span class="line-removed"> 145     }</span>
<span class="line-removed"> 146     auto elementSize = optionalElementSize.value();</span>
<span class="line-removed"> 147     Checked&lt;GC3Duint, RecordOverflow&gt; checkedElementSize(elementSize);</span>
 148 
<a name="13" id="anc13"></a><span class="line-modified"> 149     Checked&lt;GC3Duint, RecordOverflow&gt; checkedSrcOffset(srcOffset);</span>
<span class="line-modified"> 150     Checked&lt;GC3Duint, RecordOverflow&gt; checkedByteSrcOffset = checkedSrcOffset * checkedElementSize;</span>
<span class="line-modified"> 151     Checked&lt;GC3Duint, RecordOverflow&gt; checkedlength(length);</span>
<span class="line-removed"> 152     Checked&lt;GC3Duint, RecordOverflow&gt; checkedByteLength = checkedlength * checkedElementSize;</span>
 153 
<a name="14" id="anc14"></a><span class="line-modified"> 154     if (checkedByteSrcOffset.hasOverflowed()</span>
<span class="line-modified"> 155         || checkedByteLength.hasOverflowed()</span>
<span class="line-modified"> 156         || checkedByteSrcOffset.unsafeGet() &gt; data.byteLength()</span>
<span class="line-modified"> 157         || checkedByteLength.unsafeGet() &gt; data.byteLength() - checkedByteSrcOffset.unsafeGet()) {</span>
<span class="line-modified"> 158         synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;bufferData&quot;, &quot;srcOffset or length is out of bounds&quot;);</span>
<span class="line-removed"> 159         return;</span>
<span class="line-removed"> 160     }</span>
 161 
<a name="15" id="anc15"></a><span class="line-modified"> 162     auto slice = Uint8Array::tryCreate(data.possiblySharedBuffer(), data.byteOffset() + checkedByteSrcOffset.unsafeGet(), checkedByteLength.unsafeGet());</span>
<span class="line-modified"> 163     if (!slice) {</span>
<span class="line-modified"> 164         synthesizeGLError(GraphicsContext3D::OUT_OF_MEMORY, &quot;bufferData&quot;, &quot;Could not create intermediate ArrayBufferView&quot;);</span>
<span class="line-modified"> 165         return;</span>




 166     }
<a name="16" id="anc16"></a><span class="line-modified"> 167     WebGLRenderingContextBase::bufferData(target, BufferDataSource(slice.get()), usage);</span>




 168 }
 169 
<a name="17" id="anc17"></a><span class="line-modified"> 170 void WebGL2RenderingContext::bufferSubData(GC3Denum target, long long offset, const ArrayBufferView&amp; data, GC3Duint srcOffset, GC3Duint length)</span>
 171 {
<a name="18" id="anc18"></a><span class="line-modified"> 172     auto optionalElementSize = arrayBufferViewElementSize(data);</span>
<span class="line-modified"> 173     if (!optionalElementSize) {</span>
<span class="line-modified"> 174         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;bufferSubData&quot;, &quot;Invalid type of Array Buffer View&quot;);</span>
<span class="line-removed"> 175         return;</span>
 176     }
<a name="19" id="anc19"></a><span class="line-removed"> 177     auto elementSize = optionalElementSize.value();</span>
<span class="line-removed"> 178     Checked&lt;GC3Duint, RecordOverflow&gt; checkedElementSize(elementSize);</span>
 179 
<a name="20" id="anc20"></a><span class="line-modified"> 180     Checked&lt;GC3Duint, RecordOverflow&gt; checkedSrcOffset(srcOffset);</span>
<span class="line-modified"> 181     Checked&lt;GC3Duint, RecordOverflow&gt; checkedByteSrcOffset = checkedSrcOffset * checkedElementSize;</span>
<span class="line-modified"> 182     Checked&lt;GC3Duint, RecordOverflow&gt; checkedlength(length);</span>
<span class="line-modified"> 183     Checked&lt;GC3Duint, RecordOverflow&gt; checkedByteLength = checkedlength * checkedElementSize;</span>



 184 
 185     if (checkedByteSrcOffset.hasOverflowed()
 186         || checkedByteLength.hasOverflowed()
 187         || checkedByteSrcOffset.unsafeGet() &gt; data.byteLength()
 188         || checkedByteLength.unsafeGet() &gt; data.byteLength() - checkedByteSrcOffset.unsafeGet()) {
<a name="21" id="anc21"></a><span class="line-modified"> 189         synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;bufferSubData&quot;, &quot;srcOffset or length is out of bounds&quot;);</span>
<span class="line-modified"> 190         return;</span>
 191     }
 192 
<a name="22" id="anc22"></a><span class="line-modified"> 193     auto slice = Uint8Array::tryCreate(data.possiblySharedBuffer(), data.byteOffset() + checkedByteSrcOffset.unsafeGet(), checkedByteLength.unsafeGet());</span>
<span class="line-modified"> 194     if (!slice) {</span>
<span class="line-removed"> 195         synthesizeGLError(GraphicsContext3D::OUT_OF_MEMORY, &quot;bufferSubData&quot;, &quot;Could not create intermediate ArrayBufferView&quot;);</span>
<span class="line-removed"> 196         return;</span>
<span class="line-removed"> 197     }</span>
 198 
<a name="23" id="anc23"></a><span class="line-modified"> 199     WebGLRenderingContextBase::bufferSubData(target, offset, BufferDataSource(slice.get()));</span>



 200 }
 201 
<a name="24" id="anc24"></a><span class="line-modified"> 202 void WebGL2RenderingContext::copyBufferSubData(GC3Denum readTarget, GC3Denum writeTarget, GC3Dint64 readOffset, GC3Dint64 writeOffset, GC3Dint64 size)</span>






 203 {
 204     if (isContextLostOrPending())
 205         return;
<a name="25" id="anc25"></a><span class="line-modified"> 206     if ((readTarget == GraphicsContext3D::ELEMENT_ARRAY_BUFFER &amp;&amp; writeTarget != GraphicsContext3D::ELEMENT_ARRAY_BUFFER)</span>
<span class="line-modified"> 207         || (writeTarget == GraphicsContext3D::ELEMENT_ARRAY_BUFFER &amp;&amp; readTarget != GraphicsContext3D::ELEMENT_ARRAY_BUFFER)) {</span>
<span class="line-modified"> 208         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;copyBufferSubData&quot;, &quot;Either both targets need to be ELEMENT_ARRAY_BUFFER or neither should be ELEMENT_ARRAY_BUFFER.&quot;);</span>
 209         return;
 210     }
 211     if (readOffset &lt; 0 || writeOffset &lt; 0 || size &lt; 0) {
<a name="26" id="anc26"></a><span class="line-modified"> 212         synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;copyBufferSubData&quot;, &quot;offset &lt; 0&quot;);</span>
 213         return;
 214     }
<a name="27" id="anc27"></a><span class="line-modified"> 215     RefPtr&lt;WebGLBuffer&gt; readBuffer = validateBufferDataParameters(&quot;copyBufferSubData&quot;, readTarget, GraphicsContext3D::STATIC_DRAW);</span>
<span class="line-modified"> 216     RefPtr&lt;WebGLBuffer&gt; writeBuffer = validateBufferDataParameters(&quot;copyBufferSubData&quot;, writeTarget, GraphicsContext3D::STATIC_DRAW);</span>
 217     if (!readBuffer || !writeBuffer) {
<a name="28" id="anc28"></a><span class="line-modified"> 218         synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;copyBufferSubData&quot;, &quot;Invalid readTarget or writeTarget&quot;);</span>
 219         return;
 220     }
 221 
<a name="29" id="anc29"></a><span class="line-modified"> 222     Checked&lt;GC3Dintptr, RecordOverflow&gt; checkedReadOffset(readOffset);</span>
<span class="line-modified"> 223     Checked&lt;GC3Dintptr, RecordOverflow&gt; checkedWriteOffset(writeOffset);</span>
<span class="line-modified"> 224     Checked&lt;GC3Dsizeiptr, RecordOverflow&gt; checkedSize(size);</span>
 225     if (checkedReadOffset.hasOverflowed() || checkedWriteOffset.hasOverflowed() || checkedSize.hasOverflowed()) {
<a name="30" id="anc30"></a><span class="line-modified"> 226         synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;copyBufferSubData&quot;, &quot;Offset or size is too big&quot;);</span>
 227         return;
 228     }
 229 
 230     if (!writeBuffer-&gt;associateCopyBufferSubData(*readBuffer, checkedReadOffset.unsafeGet(), checkedWriteOffset.unsafeGet(), checkedSize.unsafeGet())) {
<a name="31" id="anc31"></a><span class="line-modified"> 231         this-&gt;synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;copyBufferSubData&quot;, &quot;offset out of range&quot;);</span>
 232         return;
 233     }
 234 
 235     m_context-&gt;moveErrorsToSyntheticErrorList();
 236 #if PLATFORM(COCOA)
 237     m_context-&gt;copyBufferSubData(readTarget, writeTarget, checkedReadOffset.unsafeGet(), checkedWriteOffset.unsafeGet(), checkedSize.unsafeGet());
 238 #endif
 239     if (m_context-&gt;moveErrorsToSyntheticErrorList()) {
 240         // The bufferSubData function failed. Tell the buffer it doesn&#39;t have the data it thinks it does.
 241         writeBuffer-&gt;disassociateBufferData();
 242     }
 243 }
 244 
<a name="32" id="anc32"></a><span class="line-modified"> 245 void WebGL2RenderingContext::getBufferSubData(GC3Denum target, long long srcByteOffset, RefPtr&lt;ArrayBufferView&gt;&amp;&amp; dstData, GC3Duint dstOffset, GC3Duint length)</span>
 246 {
 247     if (isContextLostOrPending())
 248         return;
<a name="33" id="anc33"></a><span class="line-modified"> 249     RefPtr&lt;WebGLBuffer&gt; buffer = validateBufferDataParameters(&quot;bufferSubData&quot;, target, GraphicsContext3D::STATIC_DRAW);</span>
 250     if (!buffer) {
<a name="34" id="anc34"></a><span class="line-modified"> 251         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;getBufferSubData&quot;, &quot;No WebGLBuffer is bound to target&quot;);</span>
 252         return;
 253     }
 254 
 255     // FIXME: Implement &quot;If target is TRANSFORM_FEEDBACK_BUFFER, and any transform feedback object is currently active, an INVALID_OPERATION error is generated.&quot;
 256 
 257     if (!dstData) {
<a name="35" id="anc35"></a><span class="line-modified"> 258         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;getBufferSubData&quot;, &quot;Null dstData&quot;);</span>
 259         return;
 260     }
 261 
<a name="36" id="anc36"></a><span class="line-modified"> 262     auto optionalElementSize = arrayBufferViewElementSize(*dstData);</span>
<span class="line-modified"> 263     if (!optionalElementSize) {</span>
<span class="line-removed"> 264         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;getBufferSubData&quot;, &quot;Invalid type of Array Buffer View&quot;);</span>
 265         return;
 266     }
<a name="37" id="anc37"></a><span class="line-modified"> 267     auto elementSize = optionalElementSize.value();</span>

 268     auto dstDataLength = dstData-&gt;byteLength() / elementSize;
 269 
 270     if (dstOffset &gt; dstDataLength) {
<a name="38" id="anc38"></a><span class="line-modified"> 271         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;getBufferSubData&quot;, &quot;dstOffset is larger than the length of the destination buffer.&quot;);</span>
 272         return;
 273     }
 274 
<a name="39" id="anc39"></a><span class="line-modified"> 275     GC3Duint copyLength = length ? length : dstDataLength - dstOffset;</span>
 276 
<a name="40" id="anc40"></a><span class="line-modified"> 277     Checked&lt;GC3Duint, RecordOverflow&gt; checkedDstOffset(dstOffset);</span>
<span class="line-modified"> 278     Checked&lt;GC3Duint, RecordOverflow&gt; checkedCopyLength(copyLength);</span>
 279     auto checkedDestinationEnd = checkedDstOffset + checkedCopyLength;
 280     if (checkedDestinationEnd.hasOverflowed()) {
<a name="41" id="anc41"></a><span class="line-modified"> 281         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;getBufferSubData&quot;, &quot;dstOffset + copyLength is too high&quot;);</span>
 282         return;
 283     }
 284 
 285     if (checkedDestinationEnd.unsafeGet() &gt; dstDataLength) {
<a name="42" id="anc42"></a><span class="line-modified"> 286         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;getBufferSubData&quot;, &quot;end of written destination is past the end of the buffer&quot;);</span>
 287         return;
 288     }
 289 
 290     if (srcByteOffset &lt; 0) {
<a name="43" id="anc43"></a><span class="line-modified"> 291         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;getBufferSubData&quot;, &quot;srcByteOffset is less than 0&quot;);</span>
 292         return;
 293     }
 294 
<a name="44" id="anc44"></a><span class="line-modified"> 295     Checked&lt;GC3Dintptr, RecordOverflow&gt; checkedSrcByteOffset(srcByteOffset);</span>
<span class="line-modified"> 296     Checked&lt;GC3Dintptr, RecordOverflow&gt; checkedCopyLengthPtr(copyLength);</span>
<span class="line-modified"> 297     Checked&lt;GC3Dintptr, RecordOverflow&gt; checkedElementSize(elementSize);</span>
 298     auto checkedSourceEnd = checkedSrcByteOffset + checkedCopyLengthPtr * checkedElementSize;
 299     if (checkedSourceEnd.hasOverflowed() || checkedSourceEnd.unsafeGet() &gt; buffer-&gt;byteLength()) {
<a name="45" id="anc45"></a><span class="line-modified"> 300         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;getBufferSubData&quot;, &quot;Parameters would read outside the bounds of the source buffer&quot;);</span>
 301         return;
 302     }
 303 
 304     m_context-&gt;moveErrorsToSyntheticErrorList();
 305 #if PLATFORM(COCOA)
 306     // FIXME: Coalesce multiple getBufferSubData() calls to use a single map() call
<a name="46" id="anc46"></a><span class="line-modified"> 307     void* ptr = m_context-&gt;mapBufferRange(target, checkedSrcByteOffset.unsafeGet(), static_cast&lt;GC3Dsizeiptr&gt;(checkedCopyLengthPtr.unsafeGet() * checkedElementSize.unsafeGet()), GraphicsContext3D::MAP_READ_BIT);</span>
<span class="line-modified"> 308     memcpy(static_cast&lt;char*&gt;(dstData-&gt;baseAddress()) + dstData-&gt;byteOffset() + dstOffset * elementSize, ptr, copyLength * elementSize);</span>
<span class="line-modified"> 309     bool success = m_context-&gt;unmapBuffer(target);</span>
<span class="line-modified"> 310     ASSERT_UNUSED(success, success);</span>


 311 #endif
 312     m_context-&gt;moveErrorsToSyntheticErrorList();
 313 }
 314 
<a name="47" id="anc47"></a><span class="line-modified"> 315 void WebGL2RenderingContext::blitFramebuffer(GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dbitfield, GC3Denum)</span>
 316 {
 317     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] blitFramebuffer()&quot;);
 318 }
 319 
<a name="48" id="anc48"></a><span class="line-modified"> 320 void WebGL2RenderingContext::framebufferTextureLayer(GC3Denum, GC3Denum, WebGLTexture*, GC3Dint, GC3Dint)</span>
 321 {
 322     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] framebufferTextureLayer()&quot;);
 323 }
 324 
 325 #if !USE(OPENGL_ES)
<a name="49" id="anc49"></a><span class="line-modified"> 326 static bool isRenderableInternalformat(GC3Denum internalformat)</span>
 327 {
 328     // OpenGL ES 3: internalformat must be a color-renderable, depth-renderable, or stencil-renderable format, as shown in Table 1 below.
 329     switch (internalformat) {
<a name="50" id="anc50"></a><span class="line-modified"> 330     case GraphicsContext3D::R8:</span>
<span class="line-modified"> 331     case GraphicsContext3D::R8UI:</span>
<span class="line-modified"> 332     case GraphicsContext3D::R16UI:</span>
<span class="line-modified"> 333     case GraphicsContext3D::R16I:</span>
<span class="line-modified"> 334     case GraphicsContext3D::R32UI:</span>
<span class="line-modified"> 335     case GraphicsContext3D::R32I:</span>
<span class="line-modified"> 336     case GraphicsContext3D::RG8:</span>
<span class="line-modified"> 337     case GraphicsContext3D::RG8UI:</span>
<span class="line-modified"> 338     case GraphicsContext3D::RG8I:</span>
<span class="line-modified"> 339     case GraphicsContext3D::RG16UI:</span>
<span class="line-modified"> 340     case GraphicsContext3D::RG16I:</span>
<span class="line-modified"> 341     case GraphicsContext3D::RG32UI:</span>
<span class="line-modified"> 342     case GraphicsContext3D::RG32I:</span>
<span class="line-modified"> 343     case GraphicsContext3D::RGB8:</span>
<span class="line-modified"> 344     case GraphicsContext3D::RGB565:</span>
<span class="line-modified"> 345     case GraphicsContext3D::RGBA8:</span>
<span class="line-modified"> 346     case GraphicsContext3D::SRGB8_ALPHA8:</span>
<span class="line-modified"> 347     case GraphicsContext3D::RGB5_A1:</span>
<span class="line-modified"> 348     case GraphicsContext3D::RGBA4:</span>
<span class="line-modified"> 349     case GraphicsContext3D::RGB10_A2:</span>
<span class="line-modified"> 350     case GraphicsContext3D::RGBA8UI:</span>
<span class="line-modified"> 351     case GraphicsContext3D::RGBA8I:</span>
<span class="line-modified"> 352     case GraphicsContext3D::RGB10_A2UI:</span>
<span class="line-modified"> 353     case GraphicsContext3D::RGBA16UI:</span>
<span class="line-modified"> 354     case GraphicsContext3D::RGBA16I:</span>
<span class="line-modified"> 355     case GraphicsContext3D::RGBA32I:</span>
<span class="line-modified"> 356     case GraphicsContext3D::RGBA32UI:</span>
<span class="line-modified"> 357     case GraphicsContext3D::DEPTH_COMPONENT16:</span>
<span class="line-modified"> 358     case GraphicsContext3D::DEPTH_COMPONENT24:</span>
<span class="line-modified"> 359     case GraphicsContext3D::DEPTH_COMPONENT32F:</span>
<span class="line-modified"> 360     case GraphicsContext3D::DEPTH24_STENCIL8:</span>
<span class="line-modified"> 361     case GraphicsContext3D::DEPTH32F_STENCIL8:</span>
<span class="line-modified"> 362     case GraphicsContext3D::STENCIL_INDEX8:</span>
 363         return true;
 364     }
 365     return false;
 366 }
 367 #endif
 368 
<a name="51" id="anc51"></a><span class="line-modified"> 369 WebGLAny WebGL2RenderingContext::getInternalformatParameter(GC3Denum target, GC3Denum internalformat, GC3Denum pname)</span>
 370 {
 371     if (isContextLostOrPending())
 372         return nullptr;
 373 
<a name="52" id="anc52"></a><span class="line-modified"> 374     if (pname != GraphicsContext3D::SAMPLES) {</span>
<span class="line-modified"> 375         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;getInternalformatParameter&quot;, &quot;invalid parameter name&quot;);</span>
 376         return nullptr;
 377     }
 378 
 379     int numValues = 0;
 380 #if USE(OPENGL_ES)
<a name="53" id="anc53"></a><span class="line-modified"> 381     m_context-&gt;getInternalformativ(target, internalformat, GraphicsContext3D::NUM_SAMPLE_COUNTS, 1, &amp;numValues);</span>
 382 
<a name="54" id="anc54"></a><span class="line-modified"> 383     GC3Dint params[numValues];</span>
 384     m_context-&gt;getInternalformativ(target, internalformat, pname, numValues, params);
 385 #else
 386     // On desktop OpenGL 4.1 or below we must emulate glGetInternalformativ.
 387 
 388     // GL_INVALID_ENUM is generated if target is not GL_RENDERBUFFER.
<a name="55" id="anc55"></a><span class="line-modified"> 389     if (target != GraphicsContext3D::RENDERBUFFER) {</span>
<span class="line-modified"> 390         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;getInternalformatParameter&quot;, &quot;invalid target&quot;);</span>
 391         return nullptr;
 392     }
 393 
 394     // GL_INVALID_ENUM is generated if internalformat is not color-, depth-, or stencil-renderable.
 395     if (!isRenderableInternalformat(internalformat)) {
<a name="56" id="anc56"></a><span class="line-modified"> 396         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;getInternalformatParameter&quot;, &quot;invalid internal format&quot;);</span>
 397         return nullptr;
 398     }
 399 
<a name="57" id="anc57"></a><span class="line-modified"> 400     Vector&lt;GC3Dint&gt; samples;</span>
 401     // The way I understand this is that this will return a MINIMUM numSamples for all accepeted internalformats.
 402     // However, the true value of this on supported GL versions is gleaned via a getInternalformativ call that depends on internalformat.
<a name="58" id="anc58"></a><span class="line-modified"> 403     int numSamplesMask = getIntParameter(GraphicsContext3D::MAX_SAMPLES);</span>
 404 
 405     while (numSamplesMask &gt; 0) {
 406         samples.append(numSamplesMask);
 407         numSamplesMask = numSamplesMask &gt;&gt; 1;
 408     }
 409 
 410     // Since multisampling is not supported for signed and unsigned integer internal formats,
 411     // the value of GL_NUM_SAMPLE_COUNTS will be zero for such formats.
 412     numValues = isIntegerFormat(internalformat) ? 0 : samples.size();
<a name="59" id="anc59"></a><span class="line-modified"> 413     GC3Dint params[numValues];</span>
 414     for (size_t i = 0; i &lt; samples.size(); ++i)
 415         params[i] = samples[i];
 416 #endif
 417 
 418     return Int32Array::tryCreate(params, numValues);
 419 }
 420 
<a name="60" id="anc60"></a><span class="line-modified"> 421 void WebGL2RenderingContext::invalidateFramebuffer(GC3Denum, const Vector&lt;GC3Denum&gt;&amp;)</span>
 422 {
 423     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] invalidateFramebuffer()&quot;);
 424 }
 425 
<a name="61" id="anc61"></a><span class="line-modified"> 426 void WebGL2RenderingContext::invalidateSubFramebuffer(GC3Denum, const Vector&lt;GC3Denum&gt;&amp;, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei)</span>
 427 {
 428     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] invalidateSubFramebuffer()&quot;);
 429 }
 430 
<a name="62" id="anc62"></a><span class="line-modified"> 431 void WebGL2RenderingContext::readBuffer(GC3Denum)</span>
 432 {
 433     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] readBuffer()&quot;);
 434 }
 435 
<a name="63" id="anc63"></a><span class="line-modified"> 436 void WebGL2RenderingContext::renderbufferStorageMultisample(GC3Denum target, GC3Dsizei samples, GC3Denum internalformat, GC3Dsizei width, GC3Dsizei height)</span>
 437 {
 438     // To be backward compatible with WebGL 1, also accepts internal format DEPTH_STENCIL,
 439     // which should be mapped to DEPTH24_STENCIL8 by implementations.
<a name="64" id="anc64"></a><span class="line-modified"> 440     if (internalformat == GraphicsContext3D::DEPTH_STENCIL)</span>
<span class="line-modified"> 441         internalformat = GraphicsContext3D::DEPTH24_STENCIL8;</span>
 442 
 443     // ES 3: GL_INVALID_OPERATION is generated if internalformat is a signed or unsigned integer format and samples is greater than 0.
 444     if (isIntegerFormat(internalformat) &amp;&amp; samples &gt; 0) {
<a name="65" id="anc65"></a><span class="line-modified"> 445         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;renderbufferStorageMultisample&quot;, &quot;multisampling not supported for this format&quot;);</span>
 446         return;
 447     }
 448 
 449     switch (internalformat) {
<a name="66" id="anc66"></a><span class="line-modified"> 450     case GraphicsContext3D::DEPTH_COMPONENT16:</span>
<span class="line-modified"> 451     case GraphicsContext3D::DEPTH_COMPONENT32F:</span>
<span class="line-modified"> 452     case GraphicsContext3D::DEPTH_COMPONENT24:</span>
<span class="line-modified"> 453     case GraphicsContext3D::RGBA32I:</span>
<span class="line-modified"> 454     case GraphicsContext3D::RGBA32UI:</span>
<span class="line-modified"> 455     case GraphicsContext3D::RGBA16I:</span>
<span class="line-modified"> 456     case GraphicsContext3D::RGBA16UI:</span>
<span class="line-modified"> 457     case GraphicsContext3D::RGBA8:</span>
<span class="line-modified"> 458     case GraphicsContext3D::RGBA8I:</span>
<span class="line-modified"> 459     case GraphicsContext3D::RGBA8UI:</span>
<span class="line-modified"> 460     case GraphicsContext3D::RGB10_A2:</span>
<span class="line-modified"> 461     case GraphicsContext3D::RGB10_A2UI:</span>
<span class="line-modified"> 462     case GraphicsContext3D::RGBA4:</span>
<span class="line-modified"> 463     case GraphicsContext3D::RG32I:</span>
<span class="line-modified"> 464     case GraphicsContext3D::RG32UI:</span>
<span class="line-modified"> 465     case GraphicsContext3D::RG16I:</span>
<span class="line-modified"> 466     case GraphicsContext3D::RG16UI:</span>
<span class="line-modified"> 467     case GraphicsContext3D::RG8:</span>
<span class="line-modified"> 468     case GraphicsContext3D::RG8I:</span>
<span class="line-modified"> 469     case GraphicsContext3D::RG8UI:</span>
<span class="line-modified"> 470     case GraphicsContext3D::R32I:</span>
<span class="line-modified"> 471     case GraphicsContext3D::R32UI:</span>
<span class="line-modified"> 472     case GraphicsContext3D::R16I:</span>
<span class="line-modified"> 473     case GraphicsContext3D::R16UI:</span>
<span class="line-modified"> 474     case GraphicsContext3D::R8:</span>
<span class="line-modified"> 475     case GraphicsContext3D::R8I:</span>
<span class="line-modified"> 476     case GraphicsContext3D::R8UI:</span>
<span class="line-modified"> 477     case GraphicsContext3D::RGB5_A1:</span>
<span class="line-modified"> 478     case GraphicsContext3D::RGB565:</span>
<span class="line-modified"> 479     case GraphicsContext3D::RGB8:</span>
<span class="line-modified"> 480     case GraphicsContext3D::STENCIL_INDEX8:</span>
<span class="line-modified"> 481     case GraphicsContext3D::SRGB8_ALPHA8:</span>
 482         m_context-&gt;renderbufferStorageMultisample(target, samples, internalformat, width, height);
 483         m_renderbufferBinding-&gt;setInternalFormat(internalformat);
 484         m_renderbufferBinding-&gt;setIsValid(true);
 485         m_renderbufferBinding-&gt;setSize(width, height);
 486         break;
<a name="67" id="anc67"></a><span class="line-modified"> 487     case GraphicsContext3D::DEPTH32F_STENCIL8:</span>
<span class="line-modified"> 488     case GraphicsContext3D::DEPTH24_STENCIL8:</span>
 489         if (!isDepthStencilSupported()) {
<a name="68" id="anc68"></a><span class="line-modified"> 490             synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;renderbufferStorage&quot;, &quot;invalid internalformat&quot;);</span>
 491             return;
 492         }
 493         m_context-&gt;renderbufferStorageMultisample(target, samples, internalformat, width, height);
 494         m_renderbufferBinding-&gt;setSize(width, height);
 495         m_renderbufferBinding-&gt;setIsValid(isDepthStencilSupported());
 496         m_renderbufferBinding-&gt;setInternalFormat(internalformat);
 497         break;
 498     default:
<a name="69" id="anc69"></a><span class="line-modified"> 499         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;renderbufferStorage&quot;, &quot;invalid internalformat&quot;);</span>
 500         return;
 501     }
 502     applyStencilTest();
 503 }
 504 
<a name="70" id="anc70"></a><span class="line-modified"> 505 bool WebGL2RenderingContext::validateTexStorageFuncParameters(GC3Denum target, GC3Dsizei levels, GC3Denum internalFormat, GC3Dsizei width, GC3Dsizei height, const char* functionName)</span>
 506 {
 507     if (width &lt; 0 || height &lt; 0) {
<a name="71" id="anc71"></a><span class="line-modified"> 508         synthesizeGLError(GraphicsContext3D::INVALID_VALUE, functionName, &quot;width or height &lt; 0&quot;);</span>
 509         return false;
 510     }
 511 
 512     if (width &gt; m_maxTextureSize || height &gt; m_maxTextureSize) {
<a name="72" id="anc72"></a><span class="line-modified"> 513         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, functionName, &quot;texture dimensions are larger than the maximum texture size&quot;);</span>
 514         return false;
 515     }
 516 
<a name="73" id="anc73"></a><span class="line-modified"> 517     if (target == GraphicsContext3D::TEXTURE_CUBE_MAP) {</span>
 518         if (width != height) {
<a name="74" id="anc74"></a><span class="line-modified"> 519             synthesizeGLError(GraphicsContext3D::INVALID_VALUE, functionName, &quot;width != height for cube map&quot;);</span>
 520             return false;
 521         }
<a name="75" id="anc75"></a><span class="line-modified"> 522     } else if (target != GraphicsContext3D::TEXTURE_2D) {</span>
<span class="line-modified"> 523         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, functionName, &quot;invalid target&quot;);</span>
 524         return false;
 525     }
 526 
 527     if (levels &lt; 0 || levels &gt; m_maxTextureLevel) {
<a name="76" id="anc76"></a><span class="line-modified"> 528         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, functionName, &quot;number of levels is out of bounds&quot;);</span>
 529         return false;
 530     }
 531 
 532     switch (internalFormat) {
<a name="77" id="anc77"></a><span class="line-modified"> 533     case GraphicsContext3D::R8:</span>
<span class="line-modified"> 534     case GraphicsContext3D::R8_SNORM:</span>
<span class="line-modified"> 535     case GraphicsContext3D::R16F:</span>
<span class="line-modified"> 536     case GraphicsContext3D::R32F:</span>
<span class="line-modified"> 537     case GraphicsContext3D::R8UI:</span>
<span class="line-modified"> 538     case GraphicsContext3D::R8I:</span>
<span class="line-modified"> 539     case GraphicsContext3D::R16UI:</span>
<span class="line-modified"> 540     case GraphicsContext3D::R16I:</span>
<span class="line-modified"> 541     case GraphicsContext3D::R32UI:</span>
<span class="line-modified"> 542     case GraphicsContext3D::R32I:</span>
<span class="line-modified"> 543     case GraphicsContext3D::RG8:</span>
<span class="line-modified"> 544     case GraphicsContext3D::RG8_SNORM:</span>
<span class="line-modified"> 545     case GraphicsContext3D::RG16F:</span>
<span class="line-modified"> 546     case GraphicsContext3D::RG32F:</span>
<span class="line-modified"> 547     case GraphicsContext3D::RG8UI:</span>
<span class="line-modified"> 548     case GraphicsContext3D::RG8I:</span>
<span class="line-modified"> 549     case GraphicsContext3D::RG16UI:</span>
<span class="line-modified"> 550     case GraphicsContext3D::RG16I:</span>
<span class="line-modified"> 551     case GraphicsContext3D::RG32UI:</span>
<span class="line-modified"> 552     case GraphicsContext3D::RG32I:</span>
<span class="line-modified"> 553     case GraphicsContext3D::RGB8:</span>
<span class="line-modified"> 554     case GraphicsContext3D::SRGB8:</span>
<span class="line-modified"> 555     case GraphicsContext3D::RGB565:</span>
<span class="line-modified"> 556     case GraphicsContext3D::RGB8_SNORM:</span>
<span class="line-modified"> 557     case GraphicsContext3D::R11F_G11F_B10F:</span>
<span class="line-modified"> 558     case GraphicsContext3D::RGB9_E5:</span>
<span class="line-modified"> 559     case GraphicsContext3D::RGB16F:</span>
<span class="line-modified"> 560     case GraphicsContext3D::RGB32F:</span>
<span class="line-modified"> 561     case GraphicsContext3D::RGB8UI:</span>
<span class="line-modified"> 562     case GraphicsContext3D::RGB8I:</span>
<span class="line-modified"> 563     case GraphicsContext3D::RGB16UI:</span>
<span class="line-modified"> 564     case GraphicsContext3D::RGB16I:</span>
<span class="line-modified"> 565     case GraphicsContext3D::RGB32UI:</span>
<span class="line-modified"> 566     case GraphicsContext3D::RGB32I:</span>
<span class="line-modified"> 567     case GraphicsContext3D::RGBA8:</span>
<span class="line-modified"> 568     case GraphicsContext3D::SRGB8_ALPHA8:</span>
<span class="line-modified"> 569     case GraphicsContext3D::RGBA8_SNORM:</span>
<span class="line-modified"> 570     case GraphicsContext3D::RGB5_A1:</span>
<span class="line-modified"> 571     case GraphicsContext3D::RGBA4:</span>
<span class="line-modified"> 572     case GraphicsContext3D::RGB10_A2:</span>
<span class="line-modified"> 573     case GraphicsContext3D::RGBA16F:</span>
<span class="line-modified"> 574     case GraphicsContext3D::RGBA32F:</span>
<span class="line-modified"> 575     case GraphicsContext3D::RGBA8UI:</span>
<span class="line-modified"> 576     case GraphicsContext3D::RGBA8I:</span>
<span class="line-modified"> 577     case GraphicsContext3D::RGB10_A2UI:</span>
<span class="line-modified"> 578     case GraphicsContext3D::RGBA16UI:</span>
<span class="line-modified"> 579     case GraphicsContext3D::RGBA16I:</span>
<span class="line-modified"> 580     case GraphicsContext3D::RGBA32I:</span>
<span class="line-modified"> 581     case GraphicsContext3D::RGBA32UI:</span>
<span class="line-modified"> 582     case GraphicsContext3D::DEPTH_COMPONENT16:</span>
<span class="line-modified"> 583     case GraphicsContext3D::DEPTH_COMPONENT24:</span>
<span class="line-modified"> 584     case GraphicsContext3D::DEPTH_COMPONENT32F:</span>
<span class="line-modified"> 585     case GraphicsContext3D::DEPTH24_STENCIL8:</span>
<span class="line-modified"> 586     case GraphicsContext3D::DEPTH32F_STENCIL8:</span>
 587         break;
 588     default:
<a name="78" id="anc78"></a><span class="line-modified"> 589         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, functionName, &quot;Unknown internalFormat&quot;);</span>
 590         return false;
 591     }
 592 
 593     return true;
 594 }
 595 
<a name="79" id="anc79"></a><span class="line-modified"> 596 void WebGL2RenderingContext::texStorage2D(GC3Denum target, GC3Dsizei levels, GC3Denum internalFormat, GC3Dsizei width, GC3Dsizei height)</span>
 597 {
 598     if (isContextLostOrPending())
 599         return;
 600 
 601     auto texture = validateTextureBinding(&quot;texStorage2D&quot;, target, false);
 602     if (!texture)
 603         return;
 604 
 605     if (!validateTexStorageFuncParameters(target, levels, internalFormat, width, height, &quot;texStorage2D&quot;))
 606         return;
 607 
 608     if (!validateNPOTTextureLevel(width, height, levels, &quot;texStorage2D&quot;))
 609         return;
 610 
 611     if (texture-&gt;immutable()) {
<a name="80" id="anc80"></a><span class="line-modified"> 612         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;texStorage2D&quot;, &quot;texStorage2D already called on this texture&quot;);</span>
 613         return;
 614     }
 615     texture-&gt;setImmutable();
 616 
 617     m_context-&gt;texStorage2D(target, levels, internalFormat, width, height);
 618 
 619     {
<a name="81" id="anc81"></a><span class="line-modified"> 620         GC3Denum format;</span>
<span class="line-modified"> 621         GC3Denum type;</span>
<span class="line-modified"> 622         if (!GraphicsContext3D::possibleFormatAndTypeForInternalFormat(internalFormat, format, type)) {</span>
<span class="line-modified"> 623             synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;texStorage2D&quot;, &quot;Texture has unknown internal format&quot;);</span>
 624             return;
 625         }
 626 
<a name="82" id="anc82"></a><span class="line-modified"> 627         GC3Dsizei levelWidth = width;</span>
<span class="line-modified"> 628         GC3Dsizei levelHeight = height;</span>
 629 
 630         unsigned size;
<a name="83" id="anc83"></a><span class="line-modified"> 631         GC3Denum error = m_context-&gt;computeImageSizeInBytes(format, type, width, height, m_unpackAlignment, &amp;size, nullptr);</span>
<span class="line-modified"> 632         if (error != GraphicsContext3D::NO_ERROR) {</span>
 633             synthesizeGLError(error, &quot;texStorage2D&quot;, &quot;bad dimensions&quot;);
 634             return;
 635         }
 636 
 637         Vector&lt;char&gt; data(size);
 638         memset(data.data(), 0, size);
 639 
<a name="84" id="anc84"></a><span class="line-modified"> 640         for (GC3Dsizei level = 0; level &lt; levels; ++level) {</span>
<span class="line-modified"> 641             if (target == GraphicsContext3D::TEXTURE_CUBE_MAP) {</span>
<span class="line-modified"> 642                 m_context-&gt;texSubImage2D(GraphicsContext3D::TEXTURE_CUBE_MAP_POSITIVE_X, level, 0, 0, levelWidth, levelHeight, format, type, data.data());</span>
<span class="line-modified"> 643                 m_context-&gt;texSubImage2D(GraphicsContext3D::TEXTURE_CUBE_MAP_NEGATIVE_X, level, 0, 0, levelWidth, levelHeight, format, type, data.data());</span>
<span class="line-modified"> 644                 m_context-&gt;texSubImage2D(GraphicsContext3D::TEXTURE_CUBE_MAP_POSITIVE_Y, level, 0, 0, levelWidth, levelHeight, format, type, data.data());</span>
<span class="line-modified"> 645                 m_context-&gt;texSubImage2D(GraphicsContext3D::TEXTURE_CUBE_MAP_NEGATIVE_Y, level, 0, 0, levelWidth, levelHeight, format, type, data.data());</span>
<span class="line-modified"> 646                 m_context-&gt;texSubImage2D(GraphicsContext3D::TEXTURE_CUBE_MAP_POSITIVE_Z, level, 0, 0, levelWidth, levelHeight, format, type, data.data());</span>
<span class="line-modified"> 647                 m_context-&gt;texSubImage2D(GraphicsContext3D::TEXTURE_CUBE_MAP_NEGATIVE_Z, level, 0, 0, levelWidth, levelHeight, format, type, data.data());</span>
 648             } else
 649                 m_context-&gt;texSubImage2D(target, level, 0, 0, levelWidth, levelHeight, format, type, data.data());
 650             levelWidth = std::max(1, levelWidth / 2);
 651             levelHeight = std::max(1, levelHeight / 2);
 652         }
 653     }
 654 
<a name="85" id="anc85"></a><span class="line-modified"> 655     for (GC3Dsizei level = 0; level &lt; levels; ++level) {</span>
<span class="line-modified"> 656         if (target == GraphicsContext3D::TEXTURE_CUBE_MAP) {</span>
<span class="line-modified"> 657             texture-&gt;setLevelInfo(GraphicsContext3D::TEXTURE_CUBE_MAP_POSITIVE_X, level, internalFormat, width, height, GraphicsContext3D::UNSIGNED_BYTE);</span>
<span class="line-modified"> 658             texture-&gt;setLevelInfo(GraphicsContext3D::TEXTURE_CUBE_MAP_NEGATIVE_X, level, internalFormat, width, height, GraphicsContext3D::UNSIGNED_BYTE);</span>
<span class="line-modified"> 659             texture-&gt;setLevelInfo(GraphicsContext3D::TEXTURE_CUBE_MAP_POSITIVE_Y, level, internalFormat, width, height, GraphicsContext3D::UNSIGNED_BYTE);</span>
<span class="line-modified"> 660             texture-&gt;setLevelInfo(GraphicsContext3D::TEXTURE_CUBE_MAP_NEGATIVE_Y, level, internalFormat, width, height, GraphicsContext3D::UNSIGNED_BYTE);</span>
<span class="line-modified"> 661             texture-&gt;setLevelInfo(GraphicsContext3D::TEXTURE_CUBE_MAP_POSITIVE_Z, level, internalFormat, width, height, GraphicsContext3D::UNSIGNED_BYTE);</span>
<span class="line-modified"> 662             texture-&gt;setLevelInfo(GraphicsContext3D::TEXTURE_CUBE_MAP_NEGATIVE_Z, level, internalFormat, width, height, GraphicsContext3D::UNSIGNED_BYTE);</span>
 663         } else
<a name="86" id="anc86"></a><span class="line-modified"> 664             texture-&gt;setLevelInfo(target, level, internalFormat, width, height, GraphicsContext3D::UNSIGNED_BYTE);</span>
 665     }
 666 }
 667 
<a name="87" id="anc87"></a><span class="line-modified"> 668 void WebGL2RenderingContext::texStorage3D(GC3Denum, GC3Dsizei, GC3Denum, GC3Dsizei, GC3Dsizei, GC3Dsizei)</span>
 669 {
 670     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texStorage3D()&quot;);
 671 }
 672 
<a name="88" id="anc88"></a><span class="line-modified"> 673 void WebGL2RenderingContext::texImage2D(GC3Denum, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dint, GC3Denum, GC3Denum, GC3Dint64)</span>
 674 {
<a name="89" id="anc89"></a><span class="line-modified"> 675     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texImage2D()&quot;);</span>

 676 }
 677 
<a name="90" id="anc90"></a><span class="line-modified"> 678 void WebGL2RenderingContext::texImage2D(GC3Denum, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dint, GC3Denum, GC3Denum, TexImageSource&amp;&amp;)</span>
 679 {
<a name="91" id="anc91"></a><span class="line-modified"> 680     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texImage2D()&quot;);</span>


 681 }
 682 
<a name="92" id="anc92"></a><span class="line-modified"> 683 void WebGL2RenderingContext::texImage2D(GC3Denum, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dint, GC3Denum, GC3Denum, RefPtr&lt;ArrayBufferView&gt;&amp;&amp;, GC3Duint)</span>
 684 {
<a name="93" id="anc93"></a><span class="line-modified"> 685     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texImage2D()&quot;);</span>
<span class="line-modified"> 686 }</span>
 687 
<a name="94" id="anc94"></a><span class="line-modified"> 688 void WebGL2RenderingContext::texImage3D(GC3Denum, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dsizei, GC3Dint, GC3Denum, GC3Denum, GC3Dint64)</span>
<span class="line-modified"> 689 {</span>
<span class="line-modified"> 690     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texImage3D()&quot;);</span>












 691 }
 692 
<a name="95" id="anc95"></a><span class="line-modified"> 693 void WebGL2RenderingContext::texImage3D(GC3Denum, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dsizei, GC3Dint, GC3Denum, GC3Denum, TexImageSource&amp;&amp;)</span>
 694 {
<a name="96" id="anc96"></a><span class="line-modified"> 695     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texImage3D()&quot;);</span>





 696 }
 697 
<a name="97" id="anc97"></a><span class="line-modified"> 698 void WebGL2RenderingContext::texImage3D(GC3Denum, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dsizei, GC3Dint, GC3Denum, GC3Denum, RefPtr&lt;ArrayBufferView&gt;&amp;&amp;)</span>
 699 {
<a name="98" id="anc98"></a><span class="line-modified"> 700     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texImage3D()&quot;);</span>
 701 }
 702 
<a name="99" id="anc99"></a><span class="line-modified"> 703 void WebGL2RenderingContext::texImage3D(GC3Denum, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dsizei, GC3Dint, GC3Denum, GC3Denum, RefPtr&lt;ArrayBufferView&gt;&amp;&amp;, GC3Duint)</span>
 704 {
<a name="100" id="anc100"></a><span class="line-modified"> 705     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texImage3D()&quot;);</span>

 706 }
 707 
<a name="101" id="anc101"></a><span class="line-modified"> 708 void WebGL2RenderingContext::texSubImage2D(GC3Denum, GC3Dint, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Denum, GC3Denum, GC3Dint64)</span>
 709 {
<a name="102" id="anc102"></a><span class="line-modified"> 710     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texSubImage2D()&quot;);</span>
 711 }
 712 
<a name="103" id="anc103"></a><span class="line-modified"> 713 void WebGL2RenderingContext::texSubImage2D(GC3Denum, GC3Dint, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Denum, GC3Denum, TexImageSource&amp;&amp;)</span>
 714 {
<a name="104" id="anc104"></a><span class="line-modified"> 715     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texSubImage2D()&quot;);</span>
 716 }
 717 
<a name="105" id="anc105"></a><span class="line-modified"> 718 void WebGL2RenderingContext::texSubImage2D(GC3Denum, GC3Dint, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Denum, GC3Denum, RefPtr&lt;ArrayBufferView&gt;&amp;&amp;, GC3Duint)</span>
 719 {
<a name="106" id="anc106"></a><span class="line-modified"> 720     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texSubImage2D()&quot;);</span>
 721 }
 722 
<a name="107" id="anc107"></a><span class="line-modified"> 723 void WebGL2RenderingContext::texSubImage3D(GC3Denum, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dsizei, GC3Denum, GC3Denum, GC3Dint64)</span>
 724 {
<a name="108" id="anc108"></a><span class="line-modified"> 725     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texSubImage3D()&quot;);</span>

 726 }
 727 
<a name="109" id="anc109"></a><span class="line-modified"> 728 void WebGL2RenderingContext::texSubImage3D(GC3Denum, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dsizei, GC3Denum, GC3Denum, RefPtr&lt;ArrayBufferView&gt;&amp;&amp;, GC3Duint)</span>
 729 {
<a name="110" id="anc110"></a><span class="line-modified"> 730     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texSubImage3D()&quot;);</span>





 731 }
 732 
<a name="111" id="anc111"></a><span class="line-modified"> 733 void WebGL2RenderingContext::texSubImage3D(GC3Denum, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dsizei, GC3Denum, GC3Denum, TexImageSource&amp;&amp;)</span>
 734 {
<a name="112" id="anc112"></a><span class="line-modified"> 735     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] texSubImage3D()&quot;);</span>
 736 }
 737 
<a name="113" id="anc113"></a><span class="line-modified"> 738 void WebGL2RenderingContext::copyTexSubImage3D(GC3Denum, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei)</span>
 739 {
<a name="114" id="anc114"></a><span class="line-modified"> 740     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] copyTexSubImage3D()&quot;);</span>
 741 }
 742 
<a name="115" id="anc115"></a><span class="line-modified"> 743 void WebGL2RenderingContext::compressedTexImage2D(GC3Denum, GC3Dint, GC3Denum, GC3Dsizei, GC3Dsizei, GC3Dint, GC3Dsizei, GC3Dint64)</span>
 744 {
<a name="116" id="anc116"></a><span class="line-modified"> 745     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] compressedTexImage2D()&quot;);</span>

 746 }
 747 
<a name="117" id="anc117"></a><span class="line-modified"> 748 void WebGL2RenderingContext::compressedTexImage2D(GC3Denum, GC3Dint, GC3Denum, GC3Dsizei, GC3Dsizei, GC3Dint, ArrayBufferView&amp;, GC3Duint, GC3Duint)</span>
 749 {
<a name="118" id="anc118"></a><span class="line-modified"> 750     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] compressedTexImage2D()&quot;);</span>
 751 }
 752 
<a name="119" id="anc119"></a><span class="line-modified"> 753 void WebGL2RenderingContext::compressedTexImage3D(GC3Denum, GC3Dint, GC3Denum, GC3Dsizei, GC3Dsizei, GC3Dsizei, GC3Dint, GC3Dsizei, GC3Dint64)</span>
 754 {
<a name="120" id="anc120"></a><span class="line-modified"> 755     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] compressedTexImage3D()&quot;);</span>
 756 }
 757 
<a name="121" id="anc121"></a><span class="line-modified"> 758 void WebGL2RenderingContext::compressedTexImage3D(GC3Denum, GC3Dint, GC3Denum, GC3Dsizei, GC3Dsizei, GC3Dsizei, GC3Dint, ArrayBufferView&amp;, GC3Duint, GC3Duint)</span>
 759 {
<a name="122" id="anc122"></a><span class="line-modified"> 760     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] compressedTexImage3D()&quot;);</span>
 761 }
 762 
<a name="123" id="anc123"></a><span class="line-modified"> 763 void WebGL2RenderingContext::compressedTexSubImage3D(GC3Denum, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dsizei, GC3Denum, GC3Dsizei, GC3Dint64)</span>
 764 {
<a name="124" id="anc124"></a><span class="line-modified"> 765     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] compressedTexSubImage3D()&quot;);</span>
 766 }
 767 
<a name="125" id="anc125"></a><span class="line-modified"> 768 void WebGL2RenderingContext::compressedTexSubImage3D(GC3Denum, GC3Dint, GC3Dint, GC3Dint, GC3Dint, GC3Dsizei, GC3Dsizei, GC3Dsizei, GC3Denum, ArrayBufferView&amp;, GC3Duint, GC3Duint)</span>
 769 {
<a name="126" id="anc126"></a><span class="line-modified"> 770     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] compressedTexSubImage3D()&quot;);</span>
 771 }
 772 
<a name="127" id="anc127"></a><span class="line-modified"> 773 GC3Dint WebGL2RenderingContext::getFragDataLocation(WebGLProgram&amp;, const String&amp;)</span>
 774 {
 775     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] getFragDataLocation()&quot;);
 776     return 0;
 777 }
 778 
<a name="128" id="anc128"></a><span class="line-modified"> 779 void WebGL2RenderingContext::uniform1ui(WebGLUniformLocation*, GC3Duint)</span>
 780 {
 781     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniform1ui()&quot;);
 782 }
 783 
<a name="129" id="anc129"></a><span class="line-modified"> 784 void WebGL2RenderingContext::uniform2ui(WebGLUniformLocation*, GC3Duint, GC3Duint)</span>
 785 {
 786     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniform2ui()&quot;);
 787 }
 788 
<a name="130" id="anc130"></a><span class="line-modified"> 789 void WebGL2RenderingContext::uniform3ui(WebGLUniformLocation*, GC3Duint, GC3Duint, GC3Duint)</span>
 790 {
 791     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniform3ui()&quot;);
 792 }
 793 
<a name="131" id="anc131"></a><span class="line-modified"> 794 void WebGL2RenderingContext::uniform4ui(WebGLUniformLocation*, GC3Duint, GC3Duint, GC3Duint, GC3Duint)</span>
 795 {
 796     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniform4ui()&quot;);
 797 }
 798 
<a name="132" id="anc132"></a><span class="line-modified"> 799 void WebGL2RenderingContext::uniform1uiv(WebGLUniformLocation*, Uint32List&amp;&amp;, GC3Duint, GC3Duint)</span>
 800 {
 801     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniform1uiv()&quot;);
 802 }
 803 
<a name="133" id="anc133"></a><span class="line-modified"> 804 void WebGL2RenderingContext::uniform2uiv(WebGLUniformLocation*, Uint32List&amp;&amp;, GC3Duint, GC3Duint)</span>
 805 {
 806     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniform2uiv()&quot;);
 807 }
 808 
<a name="134" id="anc134"></a><span class="line-modified"> 809 void WebGL2RenderingContext::uniform3uiv(WebGLUniformLocation*, Uint32List&amp;&amp;, GC3Duint, GC3Duint)</span>
 810 {
 811     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniform3uiv()&quot;);
 812 }
 813 
<a name="135" id="anc135"></a><span class="line-modified"> 814 void WebGL2RenderingContext::uniform4uiv(WebGLUniformLocation*, Uint32List&amp;&amp;, GC3Duint, GC3Duint)</span>
 815 {
 816     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniform4uiv()&quot;);
 817 }
 818 
<a name="136" id="anc136"></a><span class="line-modified"> 819 void WebGL2RenderingContext::uniformMatrix2x3fv(WebGLUniformLocation*, GC3Dboolean, Float32List&amp;&amp;, GC3Duint, GC3Duint)</span>
 820 {
 821     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniformMatrix2x3fv()&quot;);
 822 }
 823 
<a name="137" id="anc137"></a><span class="line-modified"> 824 void WebGL2RenderingContext::uniformMatrix3x2fv(WebGLUniformLocation*, GC3Dboolean, Float32List&amp;&amp;, GC3Duint, GC3Duint)</span>
 825 {
 826     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniformMatrix3x2fv()&quot;);
 827 }
 828 
<a name="138" id="anc138"></a><span class="line-modified"> 829 void WebGL2RenderingContext::uniformMatrix2x4fv(WebGLUniformLocation*, GC3Dboolean, Float32List&amp;&amp;, GC3Duint, GC3Duint)</span>
 830 {
 831     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniformMatrix2x4fv()&quot;);
 832 }
 833 
<a name="139" id="anc139"></a><span class="line-modified"> 834 void WebGL2RenderingContext::uniformMatrix4x2fv(WebGLUniformLocation*, GC3Dboolean, Float32List&amp;&amp;, GC3Duint, GC3Duint)</span>
 835 {
 836     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniformMatrix4x2fv()&quot;);
 837 }
 838 
<a name="140" id="anc140"></a><span class="line-modified"> 839 void WebGL2RenderingContext::uniformMatrix3x4fv(WebGLUniformLocation*, GC3Dboolean, Float32List&amp;&amp;, GC3Duint, GC3Duint)</span>
 840 {
 841     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniformMatrix3x4fv()&quot;);
 842 }
 843 
<a name="141" id="anc141"></a><span class="line-modified"> 844 void WebGL2RenderingContext::uniformMatrix4x3fv(WebGLUniformLocation*, GC3Dboolean, Float32List&amp;&amp;, GC3Duint, GC3Duint)</span>
 845 {
 846     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniformMatrix4x3fv()&quot;);
 847 }
 848 
<a name="142" id="anc142"></a><span class="line-modified"> 849 void WebGL2RenderingContext::vertexAttribI4i(GC3Duint, GC3Dint, GC3Dint, GC3Dint, GC3Dint)</span>
 850 {
 851     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] vertexAttribI4i()&quot;);
 852 }
 853 
<a name="143" id="anc143"></a><span class="line-modified"> 854 void WebGL2RenderingContext::vertexAttribI4iv(GC3Duint, Int32List&amp;&amp;)</span>
 855 {
 856     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] vertexAttribI4iv()&quot;);
 857 }
 858 
<a name="144" id="anc144"></a><span class="line-modified"> 859 void WebGL2RenderingContext::vertexAttribI4ui(GC3Duint, GC3Duint, GC3Duint, GC3Duint, GC3Duint)</span>
 860 {
 861     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] vertexAttribI4ui()&quot;);
 862 }
 863 
<a name="145" id="anc145"></a><span class="line-modified"> 864 void WebGL2RenderingContext::vertexAttribI4uiv(GC3Duint, Uint32List&amp;&amp;)</span>
 865 {
 866     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] vertexAttribI4uiv()&quot;);
 867 }
 868 
<a name="146" id="anc146"></a><span class="line-modified"> 869 void WebGL2RenderingContext::vertexAttribIPointer(GC3Duint, GC3Dint, GC3Denum, GC3Dsizei, GC3Dint64)</span>
 870 {
<a name="147" id="anc147"></a><span class="line-modified"> 871     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] vertexAttribIPointer()&quot;);</span>



 872 }
 873 
<a name="148" id="anc148"></a><span class="line-modified"> 874 void WebGL2RenderingContext::clear(GC3Dbitfield mask)</span>
 875 {
 876     if (isContextLostOrPending())
 877         return;
<a name="149" id="anc149"></a><span class="line-modified"> 878     if (mask &amp; ~(GraphicsContext3D::COLOR_BUFFER_BIT | GraphicsContext3D::DEPTH_BUFFER_BIT | GraphicsContext3D::STENCIL_BUFFER_BIT)) {</span>
<span class="line-modified"> 879         synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;clear&quot;, &quot;invalid mask&quot;);</span>
 880         return;
 881     }
<a name="150" id="anc150"></a><span class="line-modified"> 882     if (m_framebufferBinding &amp;&amp; (mask &amp; GraphicsContext3D::COLOR_BUFFER_BIT) &amp;&amp; isIntegerFormat(m_framebufferBinding-&gt;getColorBufferFormat())) {</span>
<span class="line-modified"> 883         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;clear&quot;, &quot;cannot clear an integer buffer&quot;);</span>

 884         return;
 885     }
<a name="151" id="anc151"></a><span class="line-modified"> 886     const char* reason = &quot;framebuffer incomplete&quot;;</span>
<span class="line-modified"> 887     if (m_framebufferBinding &amp;&amp; !m_framebufferBinding-&gt;onAccess(graphicsContext3D(), &amp;reason)) {</span>
<span class="line-removed"> 888         synthesizeGLError(GraphicsContext3D::INVALID_FRAMEBUFFER_OPERATION, &quot;clear&quot;, reason);</span>
 889         return;
 890     }
 891     if (!clearIfComposited(mask))
 892         m_context-&gt;clear(mask);
 893     markContextChangedAndNotifyCanvasObserver();
 894 }
 895 
<a name="152" id="anc152"></a><span class="line-modified"> 896 void WebGL2RenderingContext::vertexAttribDivisor(GC3Duint index, GC3Duint divisor)</span>
 897 {
 898     if (isContextLostOrPending())
 899         return;
 900 
 901     WebGLRenderingContextBase::vertexAttribDivisor(index, divisor);
 902 }
 903 
<a name="153" id="anc153"></a><span class="line-modified"> 904 void WebGL2RenderingContext::drawArraysInstanced(GC3Denum mode, GC3Dint first, GC3Dsizei count, GC3Dsizei instanceCount)</span>
 905 {
 906     if (isContextLostOrPending())
 907         return;
 908 
 909     WebGLRenderingContextBase::drawArraysInstanced(mode, first, count, instanceCount);
 910 }
 911 
<a name="154" id="anc154"></a><span class="line-modified"> 912 void WebGL2RenderingContext::drawElementsInstanced(GC3Denum mode, GC3Dsizei count, GC3Denum type, GC3Dint64 offset, GC3Dsizei instanceCount)</span>
 913 {
 914     if (isContextLostOrPending())
 915         return;
 916 
 917     WebGLRenderingContextBase::drawElementsInstanced(mode, count, type, offset, instanceCount);
 918 }
 919 
<a name="155" id="anc155"></a><span class="line-modified"> 920 void WebGL2RenderingContext::drawRangeElements(GC3Denum, GC3Duint, GC3Duint, GC3Dsizei, GC3Denum, GC3Dint64)</span>
 921 {
 922     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] drawRangeElements()&quot;);
 923 }
 924 
<a name="156" id="anc156"></a><span class="line-modified"> 925 void WebGL2RenderingContext::drawBuffers(const Vector&lt;GC3Denum&gt;&amp; buffers)</span>
 926 {
 927     if (isContextLost())
 928         return;
<a name="157" id="anc157"></a><span class="line-modified"> 929     GC3Dsizei n = buffers.size();</span>
<span class="line-modified"> 930     const GC3Denum* bufs = buffers.data();</span>
 931     if (!m_framebufferBinding) {
 932         if (n != 1) {
<a name="158" id="anc158"></a><span class="line-modified"> 933             synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;drawBuffers&quot;, &quot;more than one buffer&quot;);</span>
 934             return;
 935         }
<a name="159" id="anc159"></a><span class="line-modified"> 936         if (bufs[0] != GraphicsContext3D::BACK &amp;&amp; bufs[0] != GraphicsContext3D::NONE) {</span>
<span class="line-modified"> 937             synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;drawBuffers&quot;, &quot;BACK or NONE&quot;);</span>
 938             return;
 939         }
 940         // Because the backbuffer is simulated on all current WebKit ports, we need to change BACK to COLOR_ATTACHMENT0.
<a name="160" id="anc160"></a><span class="line-modified"> 941         GC3Denum value = (bufs[0] == GraphicsContext3D::BACK) ? GraphicsContext3D::COLOR_ATTACHMENT0 : GraphicsContext3D::NONE;</span>
<span class="line-modified"> 942         graphicsContext3D()-&gt;getExtensions().drawBuffersEXT(1, &amp;value);</span>
 943         setBackDrawBuffer(bufs[0]);
 944     } else {
 945         if (n &gt; getMaxDrawBuffers()) {
<a name="161" id="anc161"></a><span class="line-modified"> 946             synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;drawBuffers&quot;, &quot;more than max draw buffers&quot;);</span>
 947             return;
 948         }
<a name="162" id="anc162"></a><span class="line-modified"> 949         for (GC3Dsizei i = 0; i &lt; n; ++i) {</span>
<span class="line-modified"> 950             if (bufs[i] != GraphicsContext3D::NONE &amp;&amp; bufs[i] != static_cast&lt;GC3Denum&gt;(GraphicsContext3D::COLOR_ATTACHMENT0 + i)) {</span>
<span class="line-modified"> 951                 synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;drawBuffers&quot;, &quot;COLOR_ATTACHMENTi or NONE&quot;);</span>
 952                 return;
 953             }
 954         }
 955         m_framebufferBinding-&gt;drawBuffers(buffers);
 956     }
 957 }
 958 
<a name="163" id="anc163"></a><span class="line-modified"> 959 void WebGL2RenderingContext::clearBufferiv(GC3Denum buffer, GC3Dint drawbuffer, Int32List&amp;&amp;, GC3Duint)</span>
 960 {
 961     switch (buffer) {
<a name="164" id="anc164"></a><span class="line-modified"> 962     case GraphicsContext3D::COLOR:</span>
 963         if (drawbuffer &lt; 0 || drawbuffer &gt;= getMaxDrawBuffers()) {
<a name="165" id="anc165"></a><span class="line-modified"> 964             synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;clearBufferiv&quot;, &quot;buffer index out of range&quot;);</span>
 965             return;
 966         }
 967         // TODO: Call clearBufferiv, requires gl3.h and ES3/gl.h
 968         break;
<a name="166" id="anc166"></a><span class="line-modified"> 969     case GraphicsContext3D::STENCIL:</span>
 970         if (drawbuffer) {
<a name="167" id="anc167"></a><span class="line-modified"> 971             synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;clearBufferiv&quot;, &quot;buffer index must be 0&quot;);</span>
 972             return;
 973         }
 974         // TODO: Call clearBufferiv, requires gl3.h and ES3/gl.h
 975         break;
<a name="168" id="anc168"></a><span class="line-modified"> 976     case GraphicsContext3D::DEPTH:</span>
<span class="line-modified"> 977     case GraphicsContext3D::DEPTH_STENCIL:</span>
 978     default:
<a name="169" id="anc169"></a><span class="line-modified"> 979         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;clearBufferiv&quot;, &quot;buffer argument must be COLOR or STENCIL&quot;);</span>
 980         break;
 981     }
 982 }
 983 
<a name="170" id="anc170"></a><span class="line-modified"> 984 void WebGL2RenderingContext::clearBufferuiv(GC3Denum buffer, GC3Dint drawbuffer, Uint32List&amp;&amp;, GC3Duint)</span>
 985 {
 986     switch (buffer) {
<a name="171" id="anc171"></a><span class="line-modified"> 987     case GraphicsContext3D::COLOR:</span>
 988         if (drawbuffer &lt; 0 || drawbuffer &gt;= getMaxDrawBuffers()) {
<a name="172" id="anc172"></a><span class="line-modified"> 989             synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;clearBufferuiv&quot;, &quot;buffer index out of range&quot;);</span>
 990             return;
 991         }
 992         // TODO: Call clearBufferuiv, requires gl3.h and ES3/gl.h
 993         break;
<a name="173" id="anc173"></a><span class="line-modified"> 994     case GraphicsContext3D::DEPTH:</span>
<span class="line-modified"> 995     case GraphicsContext3D::STENCIL:</span>
<span class="line-modified"> 996     case GraphicsContext3D::DEPTH_STENCIL:</span>
 997     default:
<a name="174" id="anc174"></a><span class="line-modified"> 998         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;clearBufferuiv&quot;, &quot;buffer argument must be COLOR&quot;);</span>
 999         break;
1000     }
1001 }
1002 
<a name="175" id="anc175"></a><span class="line-modified">1003 void WebGL2RenderingContext::clearBufferfv(GC3Denum buffer, GC3Dint drawbuffer, Float32List&amp;&amp;, GC3Duint)</span>
1004 {
1005     switch (buffer) {
<a name="176" id="anc176"></a><span class="line-modified">1006     case GraphicsContext3D::COLOR:</span>
1007         if (drawbuffer &lt; 0 || drawbuffer &gt;= getMaxDrawBuffers()) {
<a name="177" id="anc177"></a><span class="line-modified">1008             synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;clearBufferfv&quot;, &quot;buffer index out of range&quot;);</span>
1009             return;
1010         }
1011         // TODO: Call clearBufferfv, requires gl3.h and ES3/gl.h
1012         break;
<a name="178" id="anc178"></a><span class="line-modified">1013     case GraphicsContext3D::DEPTH:</span>
1014         if (drawbuffer) {
<a name="179" id="anc179"></a><span class="line-modified">1015             synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;clearBufferfv&quot;, &quot;buffer index must be 0&quot;);</span>
1016             return;
1017         }
1018         // TODO: Call clearBufferfv, requires gl3.h and ES3/gl.h
1019         break;
<a name="180" id="anc180"></a><span class="line-modified">1020     case GraphicsContext3D::STENCIL:</span>
<span class="line-modified">1021     case GraphicsContext3D::DEPTH_STENCIL:</span>
1022     default:
<a name="181" id="anc181"></a><span class="line-modified">1023         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;clearBufferfv&quot;, &quot;buffer argument must be COLOR OR DEPTH&quot;);</span>
1024         break;
1025     }
1026 }
1027 
<a name="182" id="anc182"></a><span class="line-modified">1028 void WebGL2RenderingContext::clearBufferfi(GC3Denum buffer, GC3Dint drawbuffer, GC3Dfloat, GC3Dint)</span>
1029 {
1030     switch (buffer) {
<a name="183" id="anc183"></a><span class="line-modified">1031     case GraphicsContext3D::DEPTH_STENCIL:</span>
1032         if (drawbuffer) {
<a name="184" id="anc184"></a><span class="line-modified">1033             synthesizeGLError(GraphicsContext3D::INVALID_VALUE, &quot;clearBufferfv&quot;, &quot;buffer index must be 0&quot;);</span>
1034             return;
1035         }
1036         // TODO: Call clearBufferfi, requires gl3.h and ES3/gl.h
1037         break;
<a name="185" id="anc185"></a><span class="line-modified">1038     case GraphicsContext3D::COLOR:</span>
<span class="line-modified">1039     case GraphicsContext3D::DEPTH:</span>
<span class="line-modified">1040     case GraphicsContext3D::STENCIL:</span>
1041     default:
<a name="186" id="anc186"></a><span class="line-modified">1042         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;clearBufferfv&quot;, &quot;buffer argument must be DEPTH_STENCIL&quot;);</span>
1043         break;
1044     }
1045 }
1046 
1047 RefPtr&lt;WebGLQuery&gt; WebGL2RenderingContext::createQuery()
1048 {
<a name="187" id="anc187"></a><span class="line-modified">1049     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] createQuery()&quot;);</span>
<span class="line-modified">1050     return nullptr;</span>




1051 }
1052 
1053 void WebGL2RenderingContext::deleteQuery(WebGLQuery*)
1054 {
1055     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] deleteQuery()&quot;);
1056 }
1057 
<a name="188" id="anc188"></a><span class="line-modified">1058 GC3Dboolean WebGL2RenderingContext::isQuery(WebGLQuery*)</span>
1059 {
1060     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] isQuery()&quot;);
1061     return false;
1062 }
1063 
<a name="189" id="anc189"></a><span class="line-modified">1064 void WebGL2RenderingContext::beginQuery(GC3Denum, WebGLQuery&amp;)</span>
1065 {
<a name="190" id="anc190"></a><span class="line-modified">1066     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] beginQuery()&quot;);</span>















1067 }
1068 
<a name="191" id="anc191"></a><span class="line-modified">1069 void WebGL2RenderingContext::endQuery(GC3Denum)</span>
1070 {
<a name="192" id="anc192"></a><span class="line-modified">1071     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] endQuery()&quot;);</span>
















1072 }
1073 
<a name="193" id="anc193"></a><span class="line-modified">1074 RefPtr&lt;WebGLQuery&gt; WebGL2RenderingContext::getQuery(GC3Denum, GC3Denum)</span>
1075 {
1076     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] getquery()&quot;);
1077     return nullptr;
1078 }
1079 
<a name="194" id="anc194"></a><span class="line-modified">1080 WebGLAny WebGL2RenderingContext::getQueryParameter(WebGLQuery&amp;, GC3Denum)</span>
1081 {
<a name="195" id="anc195"></a><span class="line-modified">1082     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] getQueryParameter)&quot;);</span>
<span class="line-modified">1083     return nullptr;</span>















1084 }
1085 
1086 RefPtr&lt;WebGLSampler&gt; WebGL2RenderingContext::createSampler()
1087 {
<a name="196" id="anc196"></a><span class="line-modified">1088     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] createSampler()&quot;);</span>
<span class="line-modified">1089     return nullptr;</span>




1090 }
1091 
<a name="197" id="anc197"></a><span class="line-modified">1092 void WebGL2RenderingContext::deleteSampler(WebGLSampler*)</span>
1093 {
<a name="198" id="anc198"></a><span class="line-modified">1094     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] deleteSampler()&quot;);</span>











1095 }
1096 
<a name="199" id="anc199"></a><span class="line-modified">1097 GC3Dboolean WebGL2RenderingContext::isSampler(WebGLSampler*)</span>
1098 {
<a name="200" id="anc200"></a><span class="line-modified">1099     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] isSampler()&quot;);</span>
<span class="line-modified">1100     return false;</span>


1101 }
1102 
<a name="201" id="anc201"></a><span class="line-modified">1103 void WebGL2RenderingContext::bindSampler(GC3Duint, WebGLSampler*)</span>
1104 {
<a name="202" id="anc202"></a><span class="line-modified">1105     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] bindSampler()&quot;);</span>









1106 }
1107 
<a name="203" id="anc203"></a><span class="line-modified">1108 void WebGL2RenderingContext::samplerParameteri(WebGLSampler&amp;, GC3Denum, GC3Dint)</span>
1109 {
<a name="204" id="anc204"></a><span class="line-modified">1110     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] samplerParameteri()&quot;);</span>



1111 }
1112 
<a name="205" id="anc205"></a><span class="line-modified">1113 void WebGL2RenderingContext::samplerParameterf(WebGLSampler&amp;, GC3Denum, GC3Dfloat)</span>
1114 {
<a name="206" id="anc206"></a><span class="line-modified">1115     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] samplerParameterf()&quot;);</span>



1116 }
1117 
<a name="207" id="anc207"></a><span class="line-modified">1118 WebGLAny WebGL2RenderingContext::getSamplerParameter(WebGLSampler&amp;, GC3Denum)</span>
1119 {
<a name="208" id="anc208"></a><span class="line-modified">1120     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] getSamplerParameter()&quot;);</span>
<span class="line-modified">1121     return nullptr;</span>























1122 }
1123 
<a name="209" id="anc209"></a><span class="line-modified">1124 RefPtr&lt;WebGLSync&gt; WebGL2RenderingContext::fenceSync(GC3Denum, GC3Dbitfield)</span>
1125 {
1126     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] fenceSync()&quot;);
1127     return nullptr;
1128 }
1129 
<a name="210" id="anc210"></a><span class="line-modified">1130 GC3Dboolean WebGL2RenderingContext::isSync(WebGLSync*)</span>
1131 {
1132     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] isSync()&quot;);
1133     return false;
1134 }
1135 
1136 void WebGL2RenderingContext::deleteSync(WebGLSync*)
1137 {
1138     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] deleteSync()&quot;);
1139 }
1140 
<a name="211" id="anc211"></a><span class="line-modified">1141 GC3Denum WebGL2RenderingContext::clientWaitSync(WebGLSync&amp;, GC3Dbitfield, GC3Duint64)</span>
1142 {
1143     // Note: Do not implement this function without consulting webkit-dev and WebGL
1144     // reviewers beforehand. Apple folks, see &lt;rdar://problem/36666458&gt;.
1145     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] clientWaitSync()&quot;);
1146     return 0;
1147 }
1148 
<a name="212" id="anc212"></a><span class="line-modified">1149 void WebGL2RenderingContext::waitSync(WebGLSync&amp;, GC3Dbitfield, GC3Dint64)</span>
1150 {
1151     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] waitSync()&quot;);
1152 }
1153 
<a name="213" id="anc213"></a><span class="line-modified">1154 WebGLAny WebGL2RenderingContext::getSyncParameter(WebGLSync&amp;, GC3Denum)</span>
1155 {
1156     // Note: Do not implement this function without consulting webkit-dev and WebGL
1157     // reviewers beforehand. Apple folks, see &lt;rdar://problem/36666458&gt;.
1158     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] getSyncParameter()&quot;);
1159     return nullptr;
1160 }
1161 
1162 RefPtr&lt;WebGLTransformFeedback&gt; WebGL2RenderingContext::createTransformFeedback()
1163 {
<a name="214" id="anc214"></a><span class="line-modified">1164     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] createTransformFeedback()&quot;);</span>
<span class="line-modified">1165     return nullptr;</span>




1166 }
1167 
<a name="215" id="anc215"></a><span class="line-modified">1168 void WebGL2RenderingContext::deleteTransformFeedback(WebGLTransformFeedback*)</span>
1169 {
<a name="216" id="anc216"></a><span class="line-modified">1170     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] deleteTransformFeedback()&quot;);</span>






1171 }
1172 
<a name="217" id="anc217"></a><span class="line-modified">1173 GC3Dboolean WebGL2RenderingContext::isTransformFeedback(WebGLTransformFeedback*)</span>
1174 {
<a name="218" id="anc218"></a><span class="line-modified">1175     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] isTransformFeedback()&quot;);</span>
<span class="line-modified">1176     return false;</span>


1177 }
1178 
<a name="219" id="anc219"></a><span class="line-modified">1179 void WebGL2RenderingContext::bindTransformFeedback(GC3Denum, WebGLTransformFeedback*)</span>
1180 {
<a name="220" id="anc220"></a><span class="line-modified">1181     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] bindTransformFeedback()&quot;);</span>














1182 }
1183 
<a name="221" id="anc221"></a><span class="line-modified">1184 void WebGL2RenderingContext::beginTransformFeedback(GC3Denum)</span>
1185 {
<a name="222" id="anc222"></a><span class="line-modified">1186     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] beginTransformFeedback()&quot;);</span>



1187 }
1188 
1189 void WebGL2RenderingContext::endTransformFeedback()
1190 {
<a name="223" id="anc223"></a><span class="line-modified">1191     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] endTransformFeedback()&quot;);</span>



1192 }
1193 
<a name="224" id="anc224"></a><span class="line-modified">1194 void WebGL2RenderingContext::transformFeedbackVaryings(WebGLProgram&amp;, const Vector&lt;String&gt;&amp;, GC3Denum)</span>
1195 {
<a name="225" id="anc225"></a><span class="line-modified">1196     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] transformFeedbackVaryings()&quot;);</span>



1197 }
1198 
<a name="226" id="anc226"></a><span class="line-modified">1199 RefPtr&lt;WebGLActiveInfo&gt; WebGL2RenderingContext::getTransformFeedbackVarying(WebGLProgram&amp;, GC3Duint)</span>
1200 {
<a name="227" id="anc227"></a><span class="line-modified">1201     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] getTransformFeedbackVarying()&quot;);</span>
<span class="line-modified">1202     return nullptr;</span>








1203 }
1204 
1205 void WebGL2RenderingContext::pauseTransformFeedback()
1206 {
1207     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] pauseTransformFeedback()&quot;);
1208 }
1209 
1210 void WebGL2RenderingContext::resumeTransformFeedback()
1211 {
1212     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] resumeTransformFeedback()&quot;);
1213 }
1214 
<a name="228" id="anc228"></a><span class="line-modified">1215 void WebGL2RenderingContext::bindBufferBase(GC3Denum, GC3Duint, WebGLBuffer*)</span>
1216 {
<a name="229" id="anc229"></a><span class="line-modified">1217     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] bindBufferBase()&quot;);</span>





















1218 }
1219 
<a name="230" id="anc230"></a><span class="line-modified">1220 void WebGL2RenderingContext::bindBufferRange(GC3Denum, GC3Duint, WebGLBuffer*, GC3Dint64, GC3Dint64)</span>
1221 {
1222     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] bindBufferRange()&quot;);
1223 }
1224 
<a name="231" id="anc231"></a><span class="line-modified">1225 WebGLAny WebGL2RenderingContext::getIndexedParameter(GC3Denum target, GC3Duint)</span>
1226 {
<a name="232" id="anc232"></a>


1227     switch (target) {
<a name="233" id="anc233"></a><span class="line-modified">1228     case GraphicsContext3D::TRANSFORM_FEEDBACK_BUFFER_BINDING:</span>
<span class="line-modified">1229     case GraphicsContext3D::TRANSFORM_FEEDBACK_BUFFER_SIZE:</span>
<span class="line-modified">1230     case GraphicsContext3D::TRANSFORM_FEEDBACK_BUFFER_START:</span>
<span class="line-modified">1231     case GraphicsContext3D::UNIFORM_BUFFER_BINDING:</span>
<span class="line-modified">1232     case GraphicsContext3D::UNIFORM_BUFFER_SIZE:</span>
<span class="line-modified">1233     case GraphicsContext3D::UNIFORM_BUFFER_START:</span>
<span class="line-modified">1234         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;getIndexedParameter&quot;, &quot;parameter name not yet supported&quot;);</span>





1235         return nullptr;
1236     default:
<a name="234" id="anc234"></a><span class="line-modified">1237         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;getIndexedParameter&quot;, &quot;invalid parameter name&quot;);</span>
1238         return nullptr;
1239     }
1240 }
1241 
<a name="235" id="anc235"></a><span class="line-modified">1242 Optional&lt;Vector&lt;GC3Duint&gt;&gt; WebGL2RenderingContext::getUniformIndices(WebGLProgram&amp;, const Vector&lt;String&gt;&amp;)</span>
1243 {
1244     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] getUniformIndices()&quot;);
1245     return WTF::nullopt;
1246 }
1247 
<a name="236" id="anc236"></a><span class="line-modified">1248 WebGLAny WebGL2RenderingContext::getActiveUniforms(WebGLProgram&amp; program, const Vector&lt;GC3Duint&gt;&amp; uniformIndices, GC3Denum pname)</span>
1249 {
1250     if (isContextLostOrPending() || !validateWebGLObject(&quot;getActiveUniforms&quot;, &amp;program))
1251         return nullptr;
1252 
1253     switch (pname) {
<a name="237" id="anc237"></a><span class="line-modified">1254     case GraphicsContext3D::UNIFORM_TYPE:</span>
<span class="line-modified">1255     case GraphicsContext3D::UNIFORM_SIZE:</span>
<span class="line-modified">1256     case GraphicsContext3D::UNIFORM_BLOCK_INDEX:</span>
<span class="line-modified">1257     case GraphicsContext3D::UNIFORM_OFFSET:</span>
<span class="line-modified">1258     case GraphicsContext3D::UNIFORM_ARRAY_STRIDE:</span>
<span class="line-modified">1259     case GraphicsContext3D::UNIFORM_MATRIX_STRIDE:</span>
<span class="line-modified">1260     case GraphicsContext3D::UNIFORM_IS_ROW_MAJOR:</span>
1261         {
<a name="238" id="anc238"></a><span class="line-modified">1262             Vector&lt;GC3Dint&gt; params(uniformIndices.size(), 0);</span>
1263             m_context-&gt;getActiveUniforms(program.object(), uniformIndices, pname, params);
1264             return WTFMove(params);
1265         }
1266     default:
<a name="239" id="anc239"></a><span class="line-modified">1267         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;getActiveUniforms&quot;, &quot;invalid parameter name&quot;);</span>
1268         return nullptr;
1269     }
1270 }
1271 
<a name="240" id="anc240"></a><span class="line-modified">1272 GC3Duint WebGL2RenderingContext::getUniformBlockIndex(WebGLProgram&amp;, const String&amp;)</span>
1273 {
1274     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] getUniformBlockIndex()&quot;);
1275     return 0;
1276 }
1277 
<a name="241" id="anc241"></a><span class="line-modified">1278 WebGLAny WebGL2RenderingContext::getActiveUniformBlockParameter(WebGLProgram&amp;, GC3Duint, GC3Denum)</span>
1279 {
1280     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] getActiveUniformBlockParameter()&quot;);
1281     return nullptr;
1282 }
1283 
<a name="242" id="anc242"></a><span class="line-modified">1284 WebGLAny WebGL2RenderingContext::getActiveUniformBlockName(WebGLProgram&amp;, GC3Duint)</span>
1285 {
1286     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] getActiveUniformBlockName()&quot;);
1287     return nullptr;
1288 }
1289 
<a name="243" id="anc243"></a><span class="line-modified">1290 void WebGL2RenderingContext::uniformBlockBinding(WebGLProgram&amp;, GC3Duint, GC3Duint)</span>
1291 {
1292     LOG(WebGL, &quot;[[ NOT IMPLEMENTED ]] uniformBlockBinding()&quot;);
1293 }
1294 
1295 RefPtr&lt;WebGLVertexArrayObject&gt; WebGL2RenderingContext::createVertexArray()
1296 {
1297     if (isContextLost())
1298         return nullptr;
1299 
1300     auto object = WebGLVertexArrayObject::create(*this, WebGLVertexArrayObject::Type::User);
1301     addContextObject(object.get());
1302     return WTFMove(object);
1303 }
1304 
1305 void WebGL2RenderingContext::deleteVertexArray(WebGLVertexArrayObject* arrayObject)
1306 {
1307     if (!arrayObject || isContextLost())
1308         return;
1309 
1310     if (arrayObject-&gt;isDeleted())
1311         return;
1312 
1313     if (!arrayObject-&gt;isDefaultObject() &amp;&amp; arrayObject == m_boundVertexArrayObject)
1314 #if USE(OPENGL_ES)
1315         setBoundVertexArrayObject(nullptr);
1316 #else
1317         bindVertexArray(nullptr); // The default VAO was removed in OpenGL 3.3 but not from WebGL 2; bind the default for WebGL to use.
1318 #endif
1319 
<a name="244" id="anc244"></a><span class="line-modified">1320     arrayObject-&gt;deleteObject(graphicsContext3D());</span>
1321 }
1322 
<a name="245" id="anc245"></a><span class="line-modified">1323 GC3Dboolean WebGL2RenderingContext::isVertexArray(WebGLVertexArrayObject* arrayObject)</span>
1324 {
1325     if (!arrayObject || isContextLost())
1326         return false;
1327 
1328     if (!arrayObject-&gt;hasEverBeenBound() || !arrayObject-&gt;validate(0, *this))
1329         return false;
1330 
1331     return m_context-&gt;isVertexArray(arrayObject-&gt;object());
1332 }
1333 
1334 void WebGL2RenderingContext::bindVertexArray(WebGLVertexArrayObject* arrayObject)
1335 {
1336     if (isContextLost())
1337         return;
1338 
1339     if (arrayObject &amp;&amp; (arrayObject-&gt;isDeleted() || !arrayObject-&gt;validate(0, *this) || !m_contextObjects.contains(arrayObject))) {
<a name="246" id="anc246"></a><span class="line-modified">1340         m_context-&gt;synthesizeGLError(GraphicsContext3D::INVALID_OPERATION);</span>
1341         return;
1342     }
1343     if (arrayObject &amp;&amp; !arrayObject-&gt;isDefaultObject() &amp;&amp; arrayObject-&gt;object()) {
1344         m_context-&gt;bindVertexArray(arrayObject-&gt;object());
1345 
1346         arrayObject-&gt;setHasEverBeenBound();
1347         setBoundVertexArrayObject(arrayObject);
1348     } else {
1349         m_context-&gt;bindVertexArray(m_defaultVertexArrayObject-&gt;object());
1350         setBoundVertexArrayObject(m_defaultVertexArrayObject.get());
1351     }
1352 }
1353 
1354 WebGLExtension* WebGL2RenderingContext::getExtension(const String&amp; name)
1355 {
1356     if (isContextLostOrPending())
1357         return nullptr;
1358 
1359 #define ENABLE_IF_REQUESTED(type, variable, nameLiteral, canEnable) \
1360     if (equalIgnoringASCIICase(name, nameLiteral)) { \
1361         if (!variable) { \
1362             variable = (canEnable) ? makeUnique&lt;type&gt;(*this) : nullptr; \
1363             if (variable != nullptr) \
1364                 InspectorInstrumentation::didEnableExtension(*this, name); \
1365         } \
1366         return variable.get(); \
1367     }
1368 
1369     ENABLE_IF_REQUESTED(EXTTextureFilterAnisotropic, m_extTextureFilterAnisotropic, &quot;EXT_texture_filter_anisotropic&quot;, enableSupportedExtension(&quot;GL_EXT_texture_filter_anisotropic&quot;_s));
<a name="247" id="anc247"></a><span class="line-removed">1370     ENABLE_IF_REQUESTED(EXTTextureFilterAnisotropic, m_extTextureFilterAnisotropic, &quot;WEBKIT_EXT_texture_filter_anisotropic&quot;, enableSupportedExtension(&quot;GL_OES_texture_float&quot;_s));</span>
1371     ENABLE_IF_REQUESTED(OESTextureFloat, m_oesTextureFloat, &quot;OES_texture_float&quot;, enableSupportedExtension(&quot;GL_OES_texture_float&quot;_s));
1372     ENABLE_IF_REQUESTED(OESTextureFloatLinear, m_oesTextureFloatLinear, &quot;OES_texture_float_linear&quot;, enableSupportedExtension(&quot;GL_OES_texture_float_linear&quot;_s));
1373     ENABLE_IF_REQUESTED(OESTextureHalfFloat, m_oesTextureHalfFloat, &quot;OES_texture_half_float&quot;, enableSupportedExtension(&quot;GL_OES_texture_half_float&quot;_s));
1374     ENABLE_IF_REQUESTED(OESTextureHalfFloatLinear, m_oesTextureHalfFloatLinear, &quot;OES_texture_half_float_linear&quot;, enableSupportedExtension(&quot;GL_OES_texture_half_float_linear&quot;_s));
1375     ENABLE_IF_REQUESTED(WebGLLoseContext, m_webglLoseContext, &quot;WEBGL_lose_context&quot;, true);
<a name="248" id="anc248"></a>
1376     ENABLE_IF_REQUESTED(WebGLCompressedTextureATC, m_webglCompressedTextureATC, &quot;WEBKIT_WEBGL_compressed_texture_atc&quot;, WebGLCompressedTextureATC::supported(*this));
<a name="249" id="anc249"></a>

1377     ENABLE_IF_REQUESTED(WebGLCompressedTexturePVRTC, m_webglCompressedTexturePVRTC, &quot;WEBKIT_WEBGL_compressed_texture_pvrtc&quot;, WebGLCompressedTexturePVRTC::supported(*this));
1378     ENABLE_IF_REQUESTED(WebGLCompressedTextureS3TC, m_webglCompressedTextureS3TC, &quot;WEBGL_compressed_texture_s3tc&quot;, WebGLCompressedTextureS3TC::supported(*this));
<a name="250" id="anc250"></a><span class="line-modified">1379     ENABLE_IF_REQUESTED(WebGLCompressedTextureASTC, m_webglCompressedTextureASTC, &quot;WEBGL_compressed_texture_astc&quot;, WebGLCompressedTextureASTC::supported(*this));</span>
<span class="line-removed">1380     ENABLE_IF_REQUESTED(WebGLDepthTexture, m_webglDepthTexture, &quot;WEBGL_depth_texture&quot;, WebGLDepthTexture::supported(*graphicsContext3D()));</span>
1381     ENABLE_IF_REQUESTED(WebGLDebugRendererInfo, m_webglDebugRendererInfo, &quot;WEBGL_debug_renderer_info&quot;, true);
1382     ENABLE_IF_REQUESTED(WebGLDebugShaders, m_webglDebugShaders, &quot;WEBGL_debug_shaders&quot;, m_context-&gt;getExtensions().supports(&quot;GL_ANGLE_translated_shader_source&quot;_s));
1383     return nullptr;
1384 }
1385 
1386 Optional&lt;Vector&lt;String&gt;&gt; WebGL2RenderingContext::getSupportedExtensions()
1387 {
1388     if (isContextLost())
1389         return WTF::nullopt;
1390 
1391     Vector&lt;String&gt; result;
1392 
1393     if (m_isPendingPolicyResolution)
1394         return result;
1395 
1396     auto&amp; extensions = m_context-&gt;getExtensions();
1397     if (extensions.supports(&quot;GL_OES_texture_float&quot;_s))
1398         result.append(&quot;OES_texture_float&quot;_s);
1399     if (extensions.supports(&quot;GL_OES_texture_float_linear&quot;_s))
1400         result.append(&quot;OES_texture_float_linear&quot;_s);
1401     if (extensions.supports(&quot;GL_OES_texture_half_float&quot;_s))
1402         result.append(&quot;OES_texture_half_float&quot;_s);
1403     if (extensions.supports(&quot;GL_OES_texture_half_float_linear&quot;_s))
1404         result.append(&quot;OES_texture_half_float_linear&quot;_s);
1405     if (extensions.supports(&quot;GL_EXT_texture_filter_anisotropic&quot;_s))
<a name="251" id="anc251"></a><span class="line-modified">1406         result.append(&quot;WEBKIT_EXT_texture_filter_anisotropic&quot;_s);</span>


1407     if (WebGLCompressedTextureATC::supported(*this))
1408         result.append(&quot;WEBKIT_WEBGL_compressed_texture_atc&quot;_s);
<a name="252" id="anc252"></a>



1409     if (WebGLCompressedTexturePVRTC::supported(*this))
1410         result.append(&quot;WEBKIT_WEBGL_compressed_texture_pvrtc&quot;_s);
1411     if (WebGLCompressedTextureS3TC::supported(*this))
1412         result.append(&quot;WEBGL_compressed_texture_s3tc&quot;_s);
<a name="253" id="anc253"></a><span class="line-modified">1413     if (WebGLCompressedTextureASTC::supported(*this))</span>
<span class="line-removed">1414         result.append(&quot;WEBGL_compressed_texture_astc&quot;_s);</span>
<span class="line-removed">1415     if (WebGLDepthTexture::supported(*graphicsContext3D()))</span>
1416         result.append(&quot;WEBGL_depth_texture&quot;_s);
1417     result.append(&quot;WEBGL_lose_context&quot;_s);
1418     if (extensions.supports(&quot;GL_ANGLE_translated_shader_source&quot;_s))
1419         result.append(&quot;WEBGL_debug_shaders&quot;_s);
1420     result.append(&quot;WEBGL_debug_renderer_info&quot;_s);
1421 
1422     return result;
1423 }
1424 
<a name="254" id="anc254"></a><span class="line-modified">1425 static bool validateDefaultFramebufferAttachment(GC3Denum&amp; attachment)</span>
1426 {
1427     switch (attachment) {
<a name="255" id="anc255"></a><span class="line-modified">1428     case GraphicsContext3D::BACK:</span>
1429         // Because the backbuffer is simulated on all current WebKit ports, we need to change BACK to COLOR_ATTACHMENT0.
<a name="256" id="anc256"></a><span class="line-modified">1430         attachment = GraphicsContext3D::COLOR_ATTACHMENT0;</span>
1431         return true;
<a name="257" id="anc257"></a><span class="line-modified">1432     case GraphicsContext3D::DEPTH:</span>
<span class="line-modified">1433     case GraphicsContext3D::STENCIL:</span>
1434         return true;
1435     }
1436 
1437     return false;
1438 }
1439 
<a name="258" id="anc258"></a><span class="line-modified">1440 WebGLAny WebGL2RenderingContext::getFramebufferAttachmentParameter(GC3Denum target, GC3Denum attachment, GC3Denum pname)</span>
1441 {
1442     const char* functionName = &quot;getFramebufferAttachmentParameter&quot;;
1443     if (isContextLostOrPending() || !validateFramebufferTarget(functionName, target))
1444         return nullptr;
1445 
<a name="259" id="anc259"></a><span class="line-modified">1446     auto targetFramebuffer = (target == GraphicsContext3D::READ_FRAMEBUFFER) ? m_readFramebufferBinding : m_framebufferBinding;</span>
1447 
1448     if (!targetFramebuffer) {
1449         // OpenGL ES 3: Default framebuffer is bound.
1450         if (!validateDefaultFramebufferAttachment(attachment)) {
<a name="260" id="anc260"></a><span class="line-modified">1451             synthesizeGLError(GraphicsContext3D::INVALID_ENUM, functionName, &quot;invalid attachment&quot;);</span>
1452             return nullptr;
1453         }
<a name="261" id="anc261"></a><span class="line-modified">1454         GC3Dint value = 0;</span>
1455         m_context-&gt;getFramebufferAttachmentParameteriv(target, attachment, pname, &amp;value);
1456         return value;
1457     }
1458     if (!validateNonDefaultFramebufferAttachment(functionName, attachment))
1459         return nullptr;
1460 
1461     auto object = makeRefPtr(targetFramebuffer-&gt;getAttachmentObject(attachment));
1462     if (!object) {
<a name="262" id="anc262"></a><span class="line-modified">1463         if (pname == GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE)</span>
<span class="line-modified">1464             return static_cast&lt;unsigned&gt;(GraphicsContext3D::NONE);</span>
<span class="line-modified">1465         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, functionName, &quot;invalid parameter name&quot;);</span>
1466         return nullptr;
1467     }
1468 
1469     switch (pname) {
<a name="263" id="anc263"></a><span class="line-modified">1470     case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_RED_SIZE:</span>
<span class="line-modified">1471     case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:</span>
<span class="line-modified">1472     case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:</span>
<span class="line-modified">1473     case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:</span>
<span class="line-modified">1474     case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:</span>
<span class="line-modified">1475     case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:</span>
<span class="line-modified">1476     case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE: {</span>
<span class="line-modified">1477         GC3Dint value = 0;</span>
1478         m_context-&gt;getFramebufferAttachmentParameteriv(target, attachment, pname, &amp;value);
1479         return value;
1480     }
1481     }
1482 
1483     if (object-&gt;isTexture()) {
1484         switch (pname) {
<a name="264" id="anc264"></a><span class="line-modified">1485         case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:</span>
<span class="line-modified">1486             return static_cast&lt;unsigned&gt;(GraphicsContext3D::TEXTURE);</span>
<span class="line-modified">1487         case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:</span>
1488             return makeRefPtr(reinterpret_cast&lt;WebGLTexture&amp;&gt;(*object));
<a name="265" id="anc265"></a><span class="line-modified">1489         case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:</span>
<span class="line-modified">1490         case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:</span>
<span class="line-modified">1491         case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING: {</span>
<span class="line-modified">1492             GC3Dint value = 0;</span>
1493             m_context-&gt;getFramebufferAttachmentParameteriv(target, attachment, pname, &amp;value);
1494             return value;
1495         }
1496         default:
<a name="266" id="anc266"></a><span class="line-modified">1497             synthesizeGLError(GraphicsContext3D::INVALID_ENUM, functionName, &quot;invalid parameter name for texture attachment&quot;);</span>
1498             return nullptr;
1499         }
1500     } else {
1501         ASSERT(object-&gt;isRenderbuffer());
1502         switch (pname) {
<a name="267" id="anc267"></a><span class="line-modified">1503         case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:</span>
<span class="line-modified">1504             return static_cast&lt;unsigned&gt;(GraphicsContext3D::RENDERBUFFER);</span>
<span class="line-modified">1505         case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:</span>
1506             return makeRefPtr(reinterpret_cast&lt;WebGLRenderbuffer&amp;&gt;(*object));
<a name="268" id="anc268"></a><span class="line-modified">1507         case GraphicsContext3D::FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING : {</span>
1508             auto&amp; renderBuffer = reinterpret_cast&lt;WebGLRenderbuffer&amp;&gt;(*object);
1509             auto format = renderBuffer.getInternalFormat();
<a name="269" id="anc269"></a><span class="line-modified">1510             if (format == GraphicsContext3D::SRGB8_ALPHA8</span>
<span class="line-modified">1511                 || format == GraphicsContext3D::COMPRESSED_SRGB8_ETC2</span>
<span class="line-modified">1512                 || format == GraphicsContext3D::COMPRESSED_SRGB8_ALPHA8_ETC2_EAC</span>
<span class="line-modified">1513                 || format == GraphicsContext3D::COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2) {</span>
<span class="line-modified">1514                 return static_cast&lt;unsigned&gt;(GraphicsContext3D::SRGB);</span>
1515             }
<a name="270" id="anc270"></a><span class="line-modified">1516             return static_cast&lt;unsigned&gt;(GraphicsContext3D::LINEAR);</span>
1517         }
1518         default:
<a name="271" id="anc271"></a><span class="line-modified">1519             synthesizeGLError(GraphicsContext3D::INVALID_ENUM, functionName, &quot;invalid parameter name for renderbuffer attachment&quot;);</span>
1520             return nullptr;
1521         }
1522     }
1523 }
1524 
<a name="272" id="anc272"></a><span class="line-modified">1525 bool WebGL2RenderingContext::validateFramebufferFuncParameters(const char* functionName, GC3Denum target, GC3Denum attachment)</span>
1526 {
1527     return validateFramebufferTarget(functionName, target) &amp;&amp; validateNonDefaultFramebufferAttachment(functionName, attachment);
1528 }
1529 
<a name="273" id="anc273"></a><span class="line-modified">1530 bool WebGL2RenderingContext::validateFramebufferTarget(const char* functionName, GC3Denum target)</span>
1531 {
1532     switch (target) {
<a name="274" id="anc274"></a><span class="line-modified">1533     case GraphicsContext3D::FRAMEBUFFER:</span>
<span class="line-modified">1534     case GraphicsContext3D::DRAW_FRAMEBUFFER:</span>
<span class="line-modified">1535     case GraphicsContext3D::READ_FRAMEBUFFER:</span>
1536         return true;
1537     }
1538 
<a name="275" id="anc275"></a><span class="line-modified">1539     synthesizeGLError(GraphicsContext3D::INVALID_ENUM, functionName, &quot;invalid target&quot;);</span>
1540     return false;
1541 }
1542 
<a name="276" id="anc276"></a><span class="line-modified">1543 bool WebGL2RenderingContext::validateNonDefaultFramebufferAttachment(const char* functionName, GC3Denum attachment)</span>
1544 {
1545     switch (attachment) {
<a name="277" id="anc277"></a><span class="line-modified">1546     case GraphicsContext3D::DEPTH_ATTACHMENT:</span>
<span class="line-modified">1547     case GraphicsContext3D::STENCIL_ATTACHMENT:</span>
<span class="line-modified">1548     case GraphicsContext3D::DEPTH_STENCIL_ATTACHMENT:</span>
1549         return true;
1550     default:
<a name="278" id="anc278"></a><span class="line-modified">1551         if (attachment &gt;= GraphicsContext3D::COLOR_ATTACHMENT0 &amp;&amp; attachment &lt; static_cast&lt;GC3Denum&gt;(GraphicsContext3D::COLOR_ATTACHMENT0 + getMaxColorAttachments()))</span>
1552             return true;
1553     }
1554 
<a name="279" id="anc279"></a><span class="line-modified">1555     synthesizeGLError(GraphicsContext3D::INVALID_ENUM, functionName, &quot;invalid attachment&quot;);</span>
1556     return false;
1557 }
1558 
<a name="280" id="anc280"></a><span class="line-modified">1559 GC3Dint WebGL2RenderingContext::getMaxDrawBuffers()</span>
1560 {
1561     if (!m_maxDrawBuffers)
<a name="281" id="anc281"></a><span class="line-modified">1562         m_context-&gt;getIntegerv(GraphicsContext3D::MAX_DRAW_BUFFERS, &amp;m_maxDrawBuffers);</span>
1563     return m_maxDrawBuffers;
1564 }
1565 
<a name="282" id="anc282"></a><span class="line-modified">1566 GC3Dint WebGL2RenderingContext::getMaxColorAttachments()</span>
1567 {
1568     // DrawBuffers requires MAX_COLOR_ATTACHMENTS == MAX_DRAW_BUFFERS
1569     if (!m_maxColorAttachments)
<a name="283" id="anc283"></a><span class="line-modified">1570         m_context-&gt;getIntegerv(GraphicsContext3D::MAX_DRAW_BUFFERS, &amp;m_maxColorAttachments);</span>
1571     return m_maxColorAttachments;
1572 }
1573 
<a name="284" id="anc284"></a><span class="line-modified">1574 void WebGL2RenderingContext::renderbufferStorage(GC3Denum target, GC3Denum internalformat, GC3Dsizei width, GC3Dsizei height)</span>
1575 {
1576     if (isContextLostOrPending())
1577         return;
<a name="285" id="anc285"></a><span class="line-modified">1578     if (target != GraphicsContext3D::RENDERBUFFER) {</span>
<span class="line-modified">1579         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;renderbufferStorage&quot;, &quot;invalid target&quot;);</span>
1580         return;
1581     }
1582     if (!m_renderbufferBinding || !m_renderbufferBinding-&gt;object()) {
<a name="286" id="anc286"></a><span class="line-modified">1583         synthesizeGLError(GraphicsContext3D::INVALID_OPERATION, &quot;renderbufferStorage&quot;, &quot;no bound renderbuffer&quot;);</span>
1584         return;
1585     }
1586     if (!validateSize(&quot;renderbufferStorage&quot;, width, height))
1587         return;
1588     switch (internalformat) {
<a name="287" id="anc287"></a><span class="line-modified">1589     case GraphicsContext3D::DEPTH_COMPONENT16:</span>
<span class="line-modified">1590     case GraphicsContext3D::DEPTH_COMPONENT32F:</span>
<span class="line-modified">1591     case GraphicsContext3D::DEPTH_COMPONENT24:</span>
<span class="line-modified">1592     case GraphicsContext3D::RGBA32I:</span>
<span class="line-modified">1593     case GraphicsContext3D::RGBA32UI:</span>
<span class="line-modified">1594     case GraphicsContext3D::RGBA16I:</span>
<span class="line-modified">1595     case GraphicsContext3D::RGBA16UI:</span>
<span class="line-modified">1596     case GraphicsContext3D::RGBA8:</span>
<span class="line-modified">1597     case GraphicsContext3D::RGBA8I:</span>
<span class="line-modified">1598     case GraphicsContext3D::RGBA8UI:</span>
<span class="line-modified">1599     case GraphicsContext3D::RGB10_A2:</span>
<span class="line-modified">1600     case GraphicsContext3D::RGB10_A2UI:</span>
<span class="line-modified">1601     case GraphicsContext3D::RGBA4:</span>
<span class="line-modified">1602     case GraphicsContext3D::RG32I:</span>
<span class="line-modified">1603     case GraphicsContext3D::RG32UI:</span>
<span class="line-modified">1604     case GraphicsContext3D::RG16I:</span>
<span class="line-modified">1605     case GraphicsContext3D::RG16UI:</span>
<span class="line-modified">1606     case GraphicsContext3D::RG8:</span>
<span class="line-modified">1607     case GraphicsContext3D::RG8I:</span>
<span class="line-modified">1608     case GraphicsContext3D::RG8UI:</span>
<span class="line-modified">1609     case GraphicsContext3D::R32I:</span>
<span class="line-modified">1610     case GraphicsContext3D::R32UI:</span>
<span class="line-modified">1611     case GraphicsContext3D::R16I:</span>
<span class="line-modified">1612     case GraphicsContext3D::R16UI:</span>
<span class="line-modified">1613     case GraphicsContext3D::R8:</span>
<span class="line-modified">1614     case GraphicsContext3D::R8I:</span>
<span class="line-modified">1615     case GraphicsContext3D::R8UI:</span>
<span class="line-modified">1616     case GraphicsContext3D::RGB5_A1:</span>
<span class="line-modified">1617     case GraphicsContext3D::RGB565:</span>
<span class="line-modified">1618     case GraphicsContext3D::RGB8:</span>
<span class="line-modified">1619     case GraphicsContext3D::STENCIL_INDEX8:</span>
<span class="line-modified">1620     case GraphicsContext3D::SRGB8_ALPHA8:</span>
1621         m_context-&gt;renderbufferStorage(target, internalformat, width, height);
1622         m_renderbufferBinding-&gt;setInternalFormat(internalformat);
1623         m_renderbufferBinding-&gt;setIsValid(true);
1624         m_renderbufferBinding-&gt;setSize(width, height);
1625         break;
<a name="288" id="anc288"></a><span class="line-modified">1626     case GraphicsContext3D::DEPTH32F_STENCIL8:</span>
<span class="line-modified">1627     case GraphicsContext3D::DEPTH24_STENCIL8:</span>
1628         if (!isDepthStencilSupported()) {
<a name="289" id="anc289"></a><span class="line-modified">1629             synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;renderbufferStorage&quot;, &quot;invalid internalformat&quot;);</span>
1630             return;
1631         }
1632         m_context-&gt;renderbufferStorage(target, internalformat, width, height);
1633         m_renderbufferBinding-&gt;setSize(width, height);
1634         m_renderbufferBinding-&gt;setIsValid(isDepthStencilSupported());
1635         m_renderbufferBinding-&gt;setInternalFormat(internalformat);
1636         break;
1637     default:
<a name="290" id="anc290"></a><span class="line-modified">1638         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;renderbufferStorage&quot;, &quot;invalid internalformat&quot;);</span>
1639         return;
1640     }
1641     applyStencilTest();
1642 }
1643 
<a name="291" id="anc291"></a><span class="line-modified">1644 void WebGL2RenderingContext::hint(GC3Denum target, GC3Denum mode)</span>
1645 {
1646     if (isContextLostOrPending())
1647         return;
1648     bool isValid = false;
1649     switch (target) {
<a name="292" id="anc292"></a><span class="line-modified">1650     case GraphicsContext3D::GENERATE_MIPMAP_HINT:</span>
<span class="line-modified">1651     case GraphicsContext3D::FRAGMENT_SHADER_DERIVATIVE_HINT:</span>
1652         isValid = true;
1653         break;
1654     }
1655     if (!isValid) {
<a name="293" id="anc293"></a><span class="line-modified">1656         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;hint&quot;, &quot;invalid target&quot;);</span>
1657         return;
1658     }
1659     m_context-&gt;hint(target, mode);
1660 }
1661 
<a name="294" id="anc294"></a><span class="line-modified">1662 GC3Denum WebGL2RenderingContext::baseInternalFormatFromInternalFormat(GC3Denum internalformat)</span>
1663 {
1664     // Handles sized, unsized, and compressed internal formats.
1665     switch (internalformat) {
<a name="295" id="anc295"></a><span class="line-modified">1666     case GraphicsContext3D::R8:</span>
<span class="line-modified">1667     case GraphicsContext3D::R8_SNORM:</span>
<span class="line-modified">1668     case GraphicsContext3D::R16F:</span>
<span class="line-modified">1669     case GraphicsContext3D::R32F:</span>
<span class="line-modified">1670     case GraphicsContext3D::COMPRESSED_R11_EAC:</span>
<span class="line-modified">1671     case GraphicsContext3D::COMPRESSED_SIGNED_R11_EAC:</span>
<span class="line-modified">1672         return GraphicsContext3D::RED;</span>
<span class="line-modified">1673     case GraphicsContext3D::R8I:</span>
<span class="line-modified">1674     case GraphicsContext3D::R8UI:</span>
<span class="line-modified">1675     case GraphicsContext3D::R16I:</span>
<span class="line-modified">1676     case GraphicsContext3D::R16UI:</span>
<span class="line-modified">1677     case GraphicsContext3D::R32I:</span>
<span class="line-modified">1678     case GraphicsContext3D::R32UI:</span>
<span class="line-modified">1679         return GraphicsContext3D::RED_INTEGER;</span>
<span class="line-modified">1680     case GraphicsContext3D::RG8:</span>
<span class="line-modified">1681     case GraphicsContext3D::RG8_SNORM:</span>
<span class="line-modified">1682     case GraphicsContext3D::RG16F:</span>
<span class="line-modified">1683     case GraphicsContext3D::RG32F:</span>
<span class="line-modified">1684     case GraphicsContext3D::COMPRESSED_RG11_EAC:</span>
<span class="line-modified">1685     case GraphicsContext3D::COMPRESSED_SIGNED_RG11_EAC:</span>
<span class="line-modified">1686         return GraphicsContext3D::RG;</span>
<span class="line-modified">1687     case GraphicsContext3D::RG8I:</span>
<span class="line-modified">1688     case GraphicsContext3D::RG8UI:</span>
<span class="line-modified">1689     case GraphicsContext3D::RG16I:</span>
<span class="line-modified">1690     case GraphicsContext3D::RG16UI:</span>
<span class="line-modified">1691     case GraphicsContext3D::RG32I:</span>
<span class="line-modified">1692     case GraphicsContext3D::RG32UI:</span>
<span class="line-modified">1693         return GraphicsContext3D::RG_INTEGER;</span>
<span class="line-modified">1694     case GraphicsContext3D::RGB8:</span>
<span class="line-modified">1695     case GraphicsContext3D::RGB8_SNORM:</span>
<span class="line-modified">1696     case GraphicsContext3D::RGB565:</span>
<span class="line-modified">1697     case GraphicsContext3D::SRGB8:</span>
<span class="line-modified">1698     case GraphicsContext3D::RGB16F:</span>
<span class="line-modified">1699     case GraphicsContext3D::RGB32F:</span>
<span class="line-modified">1700     case GraphicsContext3D::RGB:</span>
<span class="line-modified">1701     case GraphicsContext3D::COMPRESSED_RGB8_ETC2:</span>
<span class="line-modified">1702     case GraphicsContext3D::COMPRESSED_SRGB8_ETC2:</span>
<span class="line-modified">1703         return GraphicsContext3D::RGB;</span>
<span class="line-modified">1704     case GraphicsContext3D::RGB8I:</span>
<span class="line-modified">1705     case GraphicsContext3D::RGB8UI:</span>
<span class="line-modified">1706     case GraphicsContext3D::RGB16I:</span>
<span class="line-modified">1707     case GraphicsContext3D::RGB16UI:</span>
<span class="line-modified">1708     case GraphicsContext3D::RGB32I:</span>
<span class="line-modified">1709     case GraphicsContext3D::RGB32UI:</span>
<span class="line-modified">1710         return GraphicsContext3D::RGB_INTEGER;</span>
<span class="line-modified">1711     case GraphicsContext3D::RGBA4:</span>
<span class="line-modified">1712     case GraphicsContext3D::RGB5_A1:</span>
<span class="line-modified">1713     case GraphicsContext3D::RGBA8:</span>
<span class="line-modified">1714     case GraphicsContext3D::RGBA8_SNORM:</span>
<span class="line-modified">1715     case GraphicsContext3D::RGB10_A2:</span>
<span class="line-modified">1716     case GraphicsContext3D::SRGB8_ALPHA8:</span>
<span class="line-modified">1717     case GraphicsContext3D::RGBA16F:</span>
<span class="line-modified">1718     case GraphicsContext3D::RGBA32F:</span>
<span class="line-modified">1719     case GraphicsContext3D::RGBA:</span>
<span class="line-modified">1720     case GraphicsContext3D::COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:</span>
<span class="line-modified">1721     case GraphicsContext3D::COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:</span>
<span class="line-modified">1722     case GraphicsContext3D::COMPRESSED_RGBA8_ETC2_EAC:</span>
<span class="line-modified">1723     case GraphicsContext3D::COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:</span>
<span class="line-modified">1724         return GraphicsContext3D::RGBA;</span>
<span class="line-modified">1725     case GraphicsContext3D::RGBA8I:</span>
<span class="line-modified">1726     case GraphicsContext3D::RGBA8UI:</span>
<span class="line-modified">1727     case GraphicsContext3D::RGB10_A2UI:</span>
<span class="line-modified">1728     case GraphicsContext3D::RGBA16I:</span>
<span class="line-modified">1729     case GraphicsContext3D::RGBA16UI:</span>
<span class="line-modified">1730     case GraphicsContext3D::RGBA32I:</span>
<span class="line-modified">1731     case GraphicsContext3D::RGBA32UI:</span>
<span class="line-modified">1732         return GraphicsContext3D::RGBA_INTEGER;</span>
<span class="line-modified">1733     case GraphicsContext3D::DEPTH_COMPONENT16:</span>
<span class="line-modified">1734     case GraphicsContext3D::DEPTH_COMPONENT24:</span>
<span class="line-modified">1735     case GraphicsContext3D::DEPTH_COMPONENT32F:</span>
<span class="line-modified">1736         return GraphicsContext3D::DEPTH_COMPONENT;</span>
<span class="line-modified">1737     case GraphicsContext3D::DEPTH24_STENCIL8:</span>
<span class="line-modified">1738     case GraphicsContext3D::DEPTH32F_STENCIL8:</span>
<span class="line-modified">1739         return GraphicsContext3D::DEPTH_STENCIL;</span>
<span class="line-modified">1740     case GraphicsContext3D::LUMINANCE:</span>
<span class="line-modified">1741     case GraphicsContext3D::LUMINANCE_ALPHA:</span>
<span class="line-modified">1742     case GraphicsContext3D::ALPHA:</span>
1743         return internalformat;
1744     default:
1745         ASSERT_NOT_REACHED();
<a name="296" id="anc296"></a><span class="line-modified">1746         return GraphicsContext3D::NONE;</span>
1747     }
1748 }
1749 
<a name="297" id="anc297"></a><span class="line-modified">1750 bool WebGL2RenderingContext::isIntegerFormat(GC3Denum internalformat)</span>
1751 {
1752     switch (baseInternalFormatFromInternalFormat(internalformat)) {
<a name="298" id="anc298"></a><span class="line-modified">1753     case GraphicsContext3D::RED_INTEGER:</span>
<span class="line-modified">1754     case GraphicsContext3D::RG_INTEGER:</span>
<span class="line-modified">1755     case GraphicsContext3D::RGB_INTEGER:</span>
<span class="line-modified">1756     case GraphicsContext3D::RGBA_INTEGER:</span>
1757         return true;
1758     }
1759     return false;
1760 }
1761 
<a name="299" id="anc299"></a><span class="line-modified">1762 WebGLAny WebGL2RenderingContext::getParameter(GC3Denum pname)</span>
1763 {
1764     if (isContextLostOrPending())
1765         return nullptr;
1766     switch (pname) {
<a name="300" id="anc300"></a><span class="line-modified">1767     case GraphicsContext3D::ACTIVE_TEXTURE:</span>
1768         return getUnsignedIntParameter(pname);
<a name="301" id="anc301"></a><span class="line-modified">1769     case GraphicsContext3D::ALIASED_LINE_WIDTH_RANGE:</span>
1770         return getWebGLFloatArrayParameter(pname);
<a name="302" id="anc302"></a><span class="line-modified">1771     case GraphicsContext3D::ALIASED_POINT_SIZE_RANGE:</span>
1772         return getWebGLFloatArrayParameter(pname);
<a name="303" id="anc303"></a><span class="line-modified">1773     case GraphicsContext3D::ALPHA_BITS:</span>
1774         if (!m_framebufferBinding &amp;&amp; !m_attributes.alpha)
1775             return 0;
1776         return getIntParameter(pname);
<a name="304" id="anc304"></a><span class="line-modified">1777     case GraphicsContext3D::ARRAY_BUFFER_BINDING:</span>
1778         return m_boundArrayBuffer;
<a name="305" id="anc305"></a><span class="line-modified">1779     case GraphicsContext3D::BLEND:</span>
1780         return getBooleanParameter(pname);
<a name="306" id="anc306"></a><span class="line-modified">1781     case GraphicsContext3D::BLEND_COLOR:</span>
1782         return getWebGLFloatArrayParameter(pname);
<a name="307" id="anc307"></a><span class="line-modified">1783     case GraphicsContext3D::BLEND_DST_ALPHA:</span>
1784         return getUnsignedIntParameter(pname);
<a name="308" id="anc308"></a><span class="line-modified">1785     case GraphicsContext3D::BLEND_DST_RGB:</span>
1786         return getUnsignedIntParameter(pname);
<a name="309" id="anc309"></a><span class="line-modified">1787     case GraphicsContext3D::BLEND_EQUATION_ALPHA:</span>
1788         return getUnsignedIntParameter(pname);
<a name="310" id="anc310"></a><span class="line-modified">1789     case GraphicsContext3D::BLEND_EQUATION_RGB:</span>
1790         return getUnsignedIntParameter(pname);
<a name="311" id="anc311"></a><span class="line-modified">1791     case GraphicsContext3D::BLEND_SRC_ALPHA:</span>
1792         return getUnsignedIntParameter(pname);
<a name="312" id="anc312"></a><span class="line-modified">1793     case GraphicsContext3D::BLEND_SRC_RGB:</span>
1794         return getUnsignedIntParameter(pname);
<a name="313" id="anc313"></a><span class="line-modified">1795     case GraphicsContext3D::BLUE_BITS:</span>
1796         return getIntParameter(pname);
<a name="314" id="anc314"></a><span class="line-modified">1797     case GraphicsContext3D::COLOR_CLEAR_VALUE:</span>
1798         return getWebGLFloatArrayParameter(pname);
<a name="315" id="anc315"></a><span class="line-modified">1799     case GraphicsContext3D::COLOR_WRITEMASK:</span>
1800         return getBooleanArrayParameter(pname);
<a name="316" id="anc316"></a><span class="line-modified">1801     case GraphicsContext3D::COMPRESSED_TEXTURE_FORMATS:</span>
1802         return Uint32Array::tryCreate(m_compressedTextureFormats.data(), m_compressedTextureFormats.size());
<a name="317" id="anc317"></a><span class="line-modified">1803     case GraphicsContext3D::CULL_FACE:</span>
1804         return getBooleanParameter(pname);
<a name="318" id="anc318"></a><span class="line-modified">1805     case GraphicsContext3D::CULL_FACE_MODE:</span>
1806         return getUnsignedIntParameter(pname);
<a name="319" id="anc319"></a><span class="line-modified">1807     case GraphicsContext3D::CURRENT_PROGRAM:</span>
1808         return m_currentProgram;
<a name="320" id="anc320"></a><span class="line-modified">1809     case GraphicsContext3D::DEPTH_BITS:</span>
1810         if (!m_framebufferBinding &amp;&amp; !m_attributes.depth)
1811             return 0;
1812         return getIntParameter(pname);
<a name="321" id="anc321"></a><span class="line-modified">1813     case GraphicsContext3D::DEPTH_CLEAR_VALUE:</span>
1814         return getFloatParameter(pname);
<a name="322" id="anc322"></a><span class="line-modified">1815     case GraphicsContext3D::DEPTH_FUNC:</span>
1816         return getUnsignedIntParameter(pname);
<a name="323" id="anc323"></a><span class="line-modified">1817     case GraphicsContext3D::DEPTH_RANGE:</span>
1818         return getWebGLFloatArrayParameter(pname);
<a name="324" id="anc324"></a><span class="line-modified">1819     case GraphicsContext3D::DEPTH_TEST:</span>
1820         return getBooleanParameter(pname);
<a name="325" id="anc325"></a><span class="line-modified">1821     case GraphicsContext3D::DEPTH_WRITEMASK:</span>
1822         return getBooleanParameter(pname);
<a name="326" id="anc326"></a><span class="line-modified">1823     case GraphicsContext3D::DITHER:</span>
1824         return getBooleanParameter(pname);
<a name="327" id="anc327"></a><span class="line-modified">1825     case GraphicsContext3D::ELEMENT_ARRAY_BUFFER_BINDING:</span>
1826         return makeRefPtr(m_boundVertexArrayObject-&gt;getElementArrayBuffer());
<a name="328" id="anc328"></a><span class="line-modified">1827     case GraphicsContext3D::FRAMEBUFFER_BINDING:</span>
1828         return m_framebufferBinding;
<a name="329" id="anc329"></a><span class="line-modified">1829     case GraphicsContext3D::FRONT_FACE:</span>
1830         return getUnsignedIntParameter(pname);
<a name="330" id="anc330"></a><span class="line-modified">1831     case GraphicsContext3D::GENERATE_MIPMAP_HINT:</span>
1832         return getUnsignedIntParameter(pname);
<a name="331" id="anc331"></a><span class="line-modified">1833     case GraphicsContext3D::GREEN_BITS:</span>
1834         return getIntParameter(pname);
<a name="332" id="anc332"></a><span class="line-modified">1835     case GraphicsContext3D::IMPLEMENTATION_COLOR_READ_FORMAT:</span>
1836         return getIntParameter(pname);
<a name="333" id="anc333"></a><span class="line-modified">1837     case GraphicsContext3D::IMPLEMENTATION_COLOR_READ_TYPE:</span>
1838         return getIntParameter(pname);
<a name="334" id="anc334"></a><span class="line-modified">1839     case GraphicsContext3D::LINE_WIDTH:</span>
1840         return getFloatParameter(pname);
<a name="335" id="anc335"></a><span class="line-modified">1841     case GraphicsContext3D::MAX_COMBINED_TEXTURE_IMAGE_UNITS:</span>
1842         return getIntParameter(pname);
<a name="336" id="anc336"></a><span class="line-modified">1843     case GraphicsContext3D::MAX_CUBE_MAP_TEXTURE_SIZE:</span>
1844         return getIntParameter(pname);
<a name="337" id="anc337"></a><span class="line-modified">1845     case GraphicsContext3D::MAX_FRAGMENT_UNIFORM_VECTORS:</span>
1846         return getIntParameter(pname);
<a name="338" id="anc338"></a><span class="line-modified">1847     case GraphicsContext3D::MAX_RENDERBUFFER_SIZE:</span>
1848         return getIntParameter(pname);
<a name="339" id="anc339"></a><span class="line-modified">1849     case GraphicsContext3D::MAX_TEXTURE_IMAGE_UNITS:</span>
1850         return getIntParameter(pname);
<a name="340" id="anc340"></a><span class="line-modified">1851     case GraphicsContext3D::MAX_TEXTURE_SIZE:</span>
1852         return getIntParameter(pname);
<a name="341" id="anc341"></a><span class="line-modified">1853     case GraphicsContext3D::MAX_VARYING_VECTORS:</span>
1854         return getIntParameter(pname);
<a name="342" id="anc342"></a><span class="line-modified">1855     case GraphicsContext3D::MAX_VERTEX_ATTRIBS:</span>
1856         return getIntParameter(pname);
<a name="343" id="anc343"></a><span class="line-modified">1857     case GraphicsContext3D::MAX_VERTEX_TEXTURE_IMAGE_UNITS:</span>
1858         return getIntParameter(pname);
<a name="344" id="anc344"></a><span class="line-modified">1859     case GraphicsContext3D::MAX_VERTEX_UNIFORM_VECTORS:</span>
1860         return getIntParameter(pname);
<a name="345" id="anc345"></a><span class="line-modified">1861     case GraphicsContext3D::MAX_VIEWPORT_DIMS:</span>
1862         return getWebGLIntArrayParameter(pname);
<a name="346" id="anc346"></a><span class="line-modified">1863     case GraphicsContext3D::NUM_SHADER_BINARY_FORMATS:</span>
1864         return getIntParameter(pname);
<a name="347" id="anc347"></a><span class="line-modified">1865     case GraphicsContext3D::PACK_ALIGNMENT:</span>
1866         return getIntParameter(pname);
<a name="348" id="anc348"></a><span class="line-modified">1867     case GraphicsContext3D::POLYGON_OFFSET_FACTOR:</span>
1868         return getFloatParameter(pname);
<a name="349" id="anc349"></a><span class="line-modified">1869     case GraphicsContext3D::POLYGON_OFFSET_FILL:</span>
1870         return getBooleanParameter(pname);
<a name="350" id="anc350"></a><span class="line-modified">1871     case GraphicsContext3D::POLYGON_OFFSET_UNITS:</span>
1872         return getFloatParameter(pname);
<a name="351" id="anc351"></a><span class="line-modified">1873     case GraphicsContext3D::RED_BITS:</span>
1874         return getIntParameter(pname);
<a name="352" id="anc352"></a><span class="line-modified">1875     case GraphicsContext3D::RENDERBUFFER_BINDING:</span>
1876         return m_renderbufferBinding;
<a name="353" id="anc353"></a><span class="line-modified">1877     case GraphicsContext3D::RENDERER:</span>
1878         return &quot;WebKit WebGL&quot;_str;
<a name="354" id="anc354"></a><span class="line-modified">1879     case GraphicsContext3D::SAMPLE_BUFFERS:</span>
1880         return getIntParameter(pname);
<a name="355" id="anc355"></a><span class="line-modified">1881     case GraphicsContext3D::SAMPLE_COVERAGE_INVERT:</span>
1882         return getBooleanParameter(pname);
<a name="356" id="anc356"></a><span class="line-modified">1883     case GraphicsContext3D::SAMPLE_COVERAGE_VALUE:</span>
1884         return getFloatParameter(pname);
<a name="357" id="anc357"></a><span class="line-modified">1885     case GraphicsContext3D::SAMPLES:</span>
1886         return getIntParameter(pname);
<a name="358" id="anc358"></a><span class="line-modified">1887     case GraphicsContext3D::SCISSOR_BOX:</span>
1888         return getWebGLIntArrayParameter(pname);
<a name="359" id="anc359"></a><span class="line-modified">1889     case GraphicsContext3D::SCISSOR_TEST:</span>
1890         return getBooleanParameter(pname);
<a name="360" id="anc360"></a><span class="line-modified">1891     case GraphicsContext3D::SHADING_LANGUAGE_VERSION:</span>
<span class="line-modified">1892         return &quot;WebGL GLSL ES 1.0 (&quot; + m_context-&gt;getString(GraphicsContext3D::SHADING_LANGUAGE_VERSION) + &quot;)&quot;;</span>
<span class="line-modified">1893     case GraphicsContext3D::STENCIL_BACK_FAIL:</span>
1894         return getUnsignedIntParameter(pname);
<a name="361" id="anc361"></a><span class="line-modified">1895     case GraphicsContext3D::STENCIL_BACK_FUNC:</span>
1896         return getUnsignedIntParameter(pname);
<a name="362" id="anc362"></a><span class="line-modified">1897     case GraphicsContext3D::STENCIL_BACK_PASS_DEPTH_FAIL:</span>
1898         return getUnsignedIntParameter(pname);
<a name="363" id="anc363"></a><span class="line-modified">1899     case GraphicsContext3D::STENCIL_BACK_PASS_DEPTH_PASS:</span>
1900         return getUnsignedIntParameter(pname);
<a name="364" id="anc364"></a><span class="line-modified">1901     case GraphicsContext3D::STENCIL_BACK_REF:</span>
1902         return getIntParameter(pname);
<a name="365" id="anc365"></a><span class="line-modified">1903     case GraphicsContext3D::STENCIL_BACK_VALUE_MASK:</span>
1904         return getUnsignedIntParameter(pname);
<a name="366" id="anc366"></a><span class="line-modified">1905     case GraphicsContext3D::STENCIL_BACK_WRITEMASK:</span>
1906         return getUnsignedIntParameter(pname);
<a name="367" id="anc367"></a><span class="line-modified">1907     case GraphicsContext3D::STENCIL_BITS:</span>
1908         if (!m_framebufferBinding &amp;&amp; !m_attributes.stencil)
1909             return 0;
1910         return getIntParameter(pname);
<a name="368" id="anc368"></a><span class="line-modified">1911     case GraphicsContext3D::STENCIL_CLEAR_VALUE:</span>
1912         return getIntParameter(pname);
<a name="369" id="anc369"></a><span class="line-modified">1913     case GraphicsContext3D::STENCIL_FAIL:</span>
1914         return getUnsignedIntParameter(pname);
<a name="370" id="anc370"></a><span class="line-modified">1915     case GraphicsContext3D::STENCIL_FUNC:</span>
1916         return getUnsignedIntParameter(pname);
<a name="371" id="anc371"></a><span class="line-modified">1917     case GraphicsContext3D::STENCIL_PASS_DEPTH_FAIL:</span>
1918         return getUnsignedIntParameter(pname);
<a name="372" id="anc372"></a><span class="line-modified">1919     case GraphicsContext3D::STENCIL_PASS_DEPTH_PASS:</span>
1920         return getUnsignedIntParameter(pname);
<a name="373" id="anc373"></a><span class="line-modified">1921     case GraphicsContext3D::STENCIL_REF:</span>
1922         return getIntParameter(pname);
<a name="374" id="anc374"></a><span class="line-modified">1923     case GraphicsContext3D::STENCIL_TEST:</span>
1924         return getBooleanParameter(pname);
<a name="375" id="anc375"></a><span class="line-modified">1925     case GraphicsContext3D::STENCIL_VALUE_MASK:</span>
1926         return getUnsignedIntParameter(pname);
<a name="376" id="anc376"></a><span class="line-modified">1927     case GraphicsContext3D::STENCIL_WRITEMASK:</span>
1928         return getUnsignedIntParameter(pname);
<a name="377" id="anc377"></a><span class="line-modified">1929     case GraphicsContext3D::SUBPIXEL_BITS:</span>
1930         return getIntParameter(pname);
<a name="378" id="anc378"></a><span class="line-modified">1931     case GraphicsContext3D::TEXTURE_BINDING_2D:</span>
1932         return m_textureUnits[m_activeTextureUnit].texture2DBinding;
<a name="379" id="anc379"></a><span class="line-modified">1933     case GraphicsContext3D::TEXTURE_BINDING_CUBE_MAP:</span>
1934         return m_textureUnits[m_activeTextureUnit].textureCubeMapBinding;
<a name="380" id="anc380"></a><span class="line-modified">1935     case GraphicsContext3D::UNPACK_ALIGNMENT:</span>
1936         return getIntParameter(pname);
<a name="381" id="anc381"></a><span class="line-modified">1937     case GraphicsContext3D::UNPACK_FLIP_Y_WEBGL:</span>
1938         return m_unpackFlipY;
<a name="382" id="anc382"></a><span class="line-modified">1939     case GraphicsContext3D::UNPACK_PREMULTIPLY_ALPHA_WEBGL:</span>
1940         return m_unpackPremultiplyAlpha;
<a name="383" id="anc383"></a><span class="line-modified">1941     case GraphicsContext3D::UNPACK_COLORSPACE_CONVERSION_WEBGL:</span>
1942         return m_unpackColorspaceConversion;
<a name="384" id="anc384"></a><span class="line-modified">1943     case GraphicsContext3D::VENDOR:</span>
1944         return &quot;WebKit&quot;_str;
<a name="385" id="anc385"></a><span class="line-modified">1945     case GraphicsContext3D::VERSION:</span>
1946         return &quot;WebGL 2.0&quot;_str;
<a name="386" id="anc386"></a><span class="line-modified">1947     case GraphicsContext3D::VIEWPORT:</span>
1948         return getWebGLIntArrayParameter(pname);
1949     case WebGLDebugRendererInfo::UNMASKED_RENDERER_WEBGL:
1950         if (m_webglDebugRendererInfo) {
1951 #if PLATFORM(IOS_FAMILY)
1952             return &quot;Apple GPU&quot;_str;
1953 #else
<a name="387" id="anc387"></a><span class="line-modified">1954             return m_context-&gt;getString(GraphicsContext3D::RENDERER);</span>
1955 #endif
1956         }
<a name="388" id="anc388"></a><span class="line-modified">1957         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;getParameter&quot;, &quot;invalid parameter name, WEBGL_debug_renderer_info not enabled&quot;);</span>
1958         return nullptr;
1959     case WebGLDebugRendererInfo::UNMASKED_VENDOR_WEBGL:
1960         if (m_webglDebugRendererInfo)
<a name="389" id="anc389"></a><span class="line-modified">1961             return m_context-&gt;getString(GraphicsContext3D::VENDOR);</span>
<span class="line-modified">1962         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;getParameter&quot;, &quot;invalid parameter name, WEBGL_debug_renderer_info not enabled&quot;);</span>
1963         return nullptr;
<a name="390" id="anc390"></a><span class="line-modified">1964     case Extensions3D::MAX_TEXTURE_MAX_ANISOTROPY_EXT: // EXT_texture_filter_anisotropic</span>
1965         if (m_extTextureFilterAnisotropic)
<a name="391" id="anc391"></a><span class="line-modified">1966             return getUnsignedIntParameter(Extensions3D::MAX_TEXTURE_MAX_ANISOTROPY_EXT);</span>
<span class="line-modified">1967         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;getParameter&quot;, &quot;invalid parameter name, EXT_texture_filter_anisotropic not enabled&quot;);</span>
1968         return nullptr;
<a name="392" id="anc392"></a><span class="line-modified">1969     case GraphicsContext3D::FRAGMENT_SHADER_DERIVATIVE_HINT:</span>
1970         return getIntParameter(pname);
<a name="393" id="anc393"></a><span class="line-modified">1971     case GraphicsContext3D::MAX_3D_TEXTURE_SIZE:</span>
1972         return getIntParameter(pname);
<a name="394" id="anc394"></a><span class="line-modified">1973     case GraphicsContext3D::MAX_ARRAY_TEXTURE_LAYERS:</span>
1974         return getIntParameter(pname);
<a name="395" id="anc395"></a><span class="line-modified">1975     case GraphicsContext3D::MAX_COLOR_ATTACHMENTS:</span>
1976         return getIntParameter(pname);
<a name="396" id="anc396"></a><span class="line-modified">1977     case GraphicsContext3D::MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:</span>
1978         return getInt64Parameter(pname);
<a name="397" id="anc397"></a><span class="line-modified">1979     case GraphicsContext3D::MAX_COMBINED_UNIFORM_BLOCKS:</span>
1980         return getIntParameter(pname);
<a name="398" id="anc398"></a><span class="line-modified">1981     case GraphicsContext3D::MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:</span>
1982         return getInt64Parameter(pname);
<a name="399" id="anc399"></a><span class="line-modified">1983     case GraphicsContext3D::MAX_DRAW_BUFFERS:</span>
1984         return getIntParameter(pname);
<a name="400" id="anc400"></a><span class="line-modified">1985     case GraphicsContext3D::MAX_ELEMENT_INDEX:</span>
1986         return getInt64Parameter(pname);
<a name="401" id="anc401"></a><span class="line-modified">1987     case GraphicsContext3D::MAX_ELEMENTS_INDICES:</span>
1988         return getIntParameter(pname);
<a name="402" id="anc402"></a><span class="line-modified">1989     case GraphicsContext3D::MAX_ELEMENTS_VERTICES:</span>
1990         return getIntParameter(pname);
<a name="403" id="anc403"></a><span class="line-modified">1991     case GraphicsContext3D::MAX_FRAGMENT_UNIFORM_COMPONENTS:</span>
1992         return getIntParameter(pname);
<a name="404" id="anc404"></a><span class="line-modified">1993     case GraphicsContext3D::MAX_FRAGMENT_UNIFORM_BLOCKS:</span>
1994         return getIntParameter(pname);
<a name="405" id="anc405"></a><span class="line-modified">1995     case GraphicsContext3D::MAX_PROGRAM_TEXEL_OFFSET:</span>
1996         return getIntParameter(pname);
<a name="406" id="anc406"></a><span class="line-modified">1997     case GraphicsContext3D::MAX_SAMPLES:</span>
1998         return getIntParameter(pname);
<a name="407" id="anc407"></a><span class="line-modified">1999     case GraphicsContext3D::MAX_SERVER_WAIT_TIMEOUT:</span>
2000         return getInt64Parameter(pname);
<a name="408" id="anc408"></a><span class="line-modified">2001     case GraphicsContext3D::MAX_TEXTURE_LOD_BIAS:</span>
2002         return getIntParameter(pname);
<a name="409" id="anc409"></a><span class="line-modified">2003     case GraphicsContext3D::MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:</span>
2004         return getIntParameter(pname);
<a name="410" id="anc410"></a><span class="line-modified">2005     case GraphicsContext3D::MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:</span>
2006         return getIntParameter(pname);
<a name="411" id="anc411"></a><span class="line-modified">2007     case GraphicsContext3D::MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:</span>
2008         return getIntParameter(pname);
<a name="412" id="anc412"></a><span class="line-modified">2009     case GraphicsContext3D::MAX_UNIFORM_BLOCK_SIZE:</span>
2010         return getInt64Parameter(pname);
<a name="413" id="anc413"></a><span class="line-modified">2011     case GraphicsContext3D::MAX_UNIFORM_BUFFER_BINDINGS:</span>
2012         return getIntParameter(pname);
<a name="414" id="anc414"></a><span class="line-modified">2013     case GraphicsContext3D::MAX_VARYING_COMPONENTS:</span>
2014         return getIntParameter(pname);
<a name="415" id="anc415"></a><span class="line-modified">2015     case GraphicsContext3D::MAX_VERTEX_OUTPUT_COMPONENTS:</span>
2016         return getIntParameter(pname);
<a name="416" id="anc416"></a><span class="line-modified">2017     case GraphicsContext3D::MAX_VERTEX_UNIFORM_BLOCKS:</span>
2018         return getIntParameter(pname);
<a name="417" id="anc417"></a><span class="line-modified">2019     case GraphicsContext3D::MAX_VERTEX_UNIFORM_COMPONENTS:</span>
2020         return getIntParameter(pname);
<a name="418" id="anc418"></a><span class="line-modified">2021     case GraphicsContext3D::MIN_PROGRAM_TEXEL_OFFSET:</span>
2022         return getIntParameter(pname);
<a name="419" id="anc419"></a><span class="line-modified">2023     case GraphicsContext3D::PACK_ROW_LENGTH:</span>
2024         return getIntParameter(pname);
<a name="420" id="anc420"></a><span class="line-modified">2025     case GraphicsContext3D::PACK_SKIP_PIXELS:</span>
2026         return getIntParameter(pname);
<a name="421" id="anc421"></a><span class="line-modified">2027     case GraphicsContext3D::PACK_SKIP_ROWS:</span>
2028         return getIntParameter(pname);
<a name="422" id="anc422"></a><span class="line-modified">2029     case GraphicsContext3D::UNPACK_IMAGE_HEIGHT:</span>
2030         return getIntParameter(pname);
<a name="423" id="anc423"></a><span class="line-modified">2031     case GraphicsContext3D::UNPACK_ROW_LENGTH:</span>
2032         return getIntParameter(pname);
<a name="424" id="anc424"></a><span class="line-modified">2033     case GraphicsContext3D::UNPACK_SKIP_IMAGES:</span>
2034         return getIntParameter(pname);
<a name="425" id="anc425"></a><span class="line-modified">2035     case GraphicsContext3D::UNPACK_SKIP_PIXELS:</span>
2036         return getIntParameter(pname);
<a name="426" id="anc426"></a><span class="line-modified">2037     case GraphicsContext3D::UNPACK_SKIP_ROWS:</span>
2038         return getIntParameter(pname);
<a name="427" id="anc427"></a><span class="line-modified">2039     case GraphicsContext3D::RASTERIZER_DISCARD:</span>
2040         return getBooleanParameter(pname);
<a name="428" id="anc428"></a><span class="line-modified">2041     case GraphicsContext3D::SAMPLE_ALPHA_TO_COVERAGE:</span>
2042         return getBooleanParameter(pname);
<a name="429" id="anc429"></a><span class="line-modified">2043     case GraphicsContext3D::SAMPLE_COVERAGE:</span>
2044         return getBooleanParameter(pname);
<a name="430" id="anc430"></a><span class="line-modified">2045     case GraphicsContext3D::TRANSFORM_FEEDBACK_ACTIVE:</span>
2046         return getBooleanParameter(pname);
<a name="431" id="anc431"></a><span class="line-modified">2047     case GraphicsContext3D::TRANSFORM_FEEDBACK_PAUSED:</span>
2048         return getBooleanParameter(pname);
<a name="432" id="anc432"></a><span class="line-modified">2049     case GraphicsContext3D::UNIFORM_BUFFER_OFFSET_ALIGNMENT:</span>
2050         return getIntParameter(pname);
<a name="433" id="anc433"></a><span class="line-modified">2051     case GraphicsContext3D::VERTEX_ARRAY_BINDING:</span>
2052         if (m_boundVertexArrayObject-&gt;isDefaultObject())
2053             return nullptr;
2054         return makeRefPtr(static_cast&lt;WebGLVertexArrayObject&amp;&gt;(*m_boundVertexArrayObject));
<a name="434" id="anc434"></a><span class="line-modified">2055     case GraphicsContext3D::DRAW_BUFFER0:</span>
<span class="line-modified">2056     case GraphicsContext3D::DRAW_BUFFER1:</span>
<span class="line-modified">2057     case GraphicsContext3D::DRAW_BUFFER2:</span>
<span class="line-modified">2058     case GraphicsContext3D::DRAW_BUFFER3:</span>
<span class="line-modified">2059     case GraphicsContext3D::DRAW_BUFFER4:</span>
<span class="line-modified">2060     case GraphicsContext3D::DRAW_BUFFER5:</span>
<span class="line-modified">2061     case GraphicsContext3D::DRAW_BUFFER6:</span>
<span class="line-modified">2062     case GraphicsContext3D::DRAW_BUFFER7:</span>
<span class="line-modified">2063     case GraphicsContext3D::DRAW_BUFFER8:</span>
<span class="line-modified">2064     case GraphicsContext3D::DRAW_BUFFER9:</span>
<span class="line-modified">2065     case GraphicsContext3D::DRAW_BUFFER10:</span>
<span class="line-modified">2066     case GraphicsContext3D::DRAW_BUFFER11:</span>
<span class="line-modified">2067     case GraphicsContext3D::DRAW_BUFFER12:</span>
<span class="line-modified">2068     case GraphicsContext3D::DRAW_BUFFER13:</span>
<span class="line-modified">2069     case GraphicsContext3D::DRAW_BUFFER14:</span>
<span class="line-modified">2070     case GraphicsContext3D::DRAW_BUFFER15:</span>
2071         if (m_framebufferBinding)
2072             return m_framebufferBinding-&gt;getDrawBuffer(pname);
2073         return m_backDrawBuffer; // emulated backbuffer
<a name="435" id="anc435"></a><span class="line-modified">2074     case GraphicsContext3D::READ_FRAMEBUFFER_BINDING:</span>
2075         return m_readFramebufferBinding;
<a name="436" id="anc436"></a><span class="line-modified">2076     case GraphicsContext3D::COPY_READ_BUFFER:</span>
<span class="line-modified">2077     case GraphicsContext3D::COPY_WRITE_BUFFER:</span>
<span class="line-modified">2078     case GraphicsContext3D::PIXEL_PACK_BUFFER_BINDING:</span>
<span class="line-modified">2079     case GraphicsContext3D::PIXEL_UNPACK_BUFFER_BINDING:</span>
<span class="line-modified">2080     case GraphicsContext3D::READ_BUFFER:</span>
<span class="line-modified">2081     case GraphicsContext3D::SAMPLER_BINDING:</span>
<span class="line-modified">2082     case GraphicsContext3D::TEXTURE_BINDING_2D_ARRAY:</span>
<span class="line-modified">2083     case GraphicsContext3D::TEXTURE_BINDING_3D:</span>
<span class="line-modified">2084     case GraphicsContext3D::TRANSFORM_FEEDBACK_BUFFER_BINDING:</span>
<span class="line-modified">2085     case GraphicsContext3D::UNIFORM_BUFFER_BINDING:</span>
<span class="line-modified">2086         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;getParameter&quot;, &quot;parameter name not yet supported&quot;);</span>




2087         return nullptr;
2088     default:
<a name="437" id="anc437"></a><span class="line-modified">2089         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, &quot;getParameter&quot;, &quot;invalid parameter name&quot;);</span>
2090         return nullptr;
2091     }
2092 }
2093 
<a name="438" id="anc438"></a><span class="line-modified">2094 bool WebGL2RenderingContext::validateIndexArrayConservative(GC3Denum type, unsigned&amp; numElementsRequired)</span>
2095 {
2096     // Performs conservative validation by caching a maximum index of
2097     // the given type per element array buffer. If all of the bound
2098     // array buffers have enough elements to satisfy that maximum
2099     // index, skips the expensive per-draw-call iteration in
2100     // validateIndexArrayPrecise.
2101 
2102     RefPtr&lt;WebGLBuffer&gt; elementArrayBuffer = m_boundVertexArrayObject-&gt;getElementArrayBuffer();
2103 
2104     if (!elementArrayBuffer)
2105         return false;
2106 
<a name="439" id="anc439"></a><span class="line-modified">2107     GC3Dsizeiptr numElements = elementArrayBuffer-&gt;byteLength();</span>
2108     // The case count==0 is already dealt with in drawElements before validateIndexArrayConservative.
2109     if (!numElements)
2110         return false;
2111     auto buffer = elementArrayBuffer-&gt;elementArrayBuffer();
2112     ASSERT(buffer);
2113 
2114     Optional&lt;unsigned&gt; maxIndex = elementArrayBuffer-&gt;getCachedMaxIndex(type);
2115     if (!maxIndex) {
2116         // Compute the maximum index in the entire buffer for the given type of index.
2117         switch (type) {
<a name="440" id="anc440"></a><span class="line-modified">2118         case GraphicsContext3D::UNSIGNED_BYTE:</span>
<span class="line-modified">2119             maxIndex = getMaxIndex&lt;GC3Dubyte&gt;(buffer, 0, numElements);</span>
2120             break;
<a name="441" id="anc441"></a><span class="line-modified">2121         case GraphicsContext3D::UNSIGNED_SHORT:</span>
<span class="line-modified">2122             maxIndex = getMaxIndex&lt;GC3Dushort&gt;(buffer, 0, numElements / sizeof(GC3Dushort));</span>
2123             break;
<a name="442" id="anc442"></a><span class="line-modified">2124         case GraphicsContext3D::UNSIGNED_INT:</span>
<span class="line-modified">2125             maxIndex = getMaxIndex&lt;GC3Duint&gt;(buffer, 0, numElements / sizeof(GC3Duint));</span>
2126             break;
2127         default:
2128             return false;
2129         }
2130         if (maxIndex)
2131             elementArrayBuffer-&gt;setCachedMaxIndex(type, maxIndex.value());
2132     }
2133 
2134     if (!maxIndex)
2135         return false;
2136 
2137     // The number of required elements is one more than the maximum
2138     // index that will be accessed.
2139     auto checkedNumElementsRequired = checkedAddAndMultiply&lt;unsigned&gt;(maxIndex.value(), 1, 1);
2140     if (!checkedNumElementsRequired)
2141         return false;
2142     numElementsRequired = checkedNumElementsRequired.value();
2143 
2144     return true;
2145 }
2146 
<a name="443" id="anc443"></a><span class="line-modified">2147 bool WebGL2RenderingContext::validateBlendEquation(const char* functionName, GC3Denum mode)</span>
2148 {
2149     switch (mode) {
<a name="444" id="anc444"></a><span class="line-modified">2150     case GraphicsContext3D::FUNC_ADD:</span>
<span class="line-modified">2151     case GraphicsContext3D::FUNC_SUBTRACT:</span>
<span class="line-modified">2152     case GraphicsContext3D::FUNC_REVERSE_SUBTRACT:</span>
<span class="line-modified">2153     case GraphicsContext3D::MIN:</span>
<span class="line-modified">2154     case GraphicsContext3D::MAX:</span>
2155         return true;
2156     default:
<a name="445" id="anc445"></a><span class="line-modified">2157         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, functionName, &quot;invalid mode&quot;);</span>
2158         return false;
2159     }
2160 }
2161 
<a name="446" id="anc446"></a><span class="line-modified">2162 bool WebGL2RenderingContext::validateCapability(const char* functionName, GC3Denum cap)</span>
2163 {
2164     switch (cap) {
<a name="447" id="anc447"></a><span class="line-modified">2165     case GraphicsContext3D::BLEND:</span>
<span class="line-modified">2166     case GraphicsContext3D::CULL_FACE:</span>
<span class="line-modified">2167     case GraphicsContext3D::DEPTH_TEST:</span>
<span class="line-modified">2168     case GraphicsContext3D::DITHER:</span>
<span class="line-modified">2169     case GraphicsContext3D::POLYGON_OFFSET_FILL:</span>
<span class="line-modified">2170     case GraphicsContext3D::SAMPLE_ALPHA_TO_COVERAGE:</span>
<span class="line-modified">2171     case GraphicsContext3D::SAMPLE_COVERAGE:</span>
<span class="line-modified">2172     case GraphicsContext3D::SCISSOR_TEST:</span>
<span class="line-modified">2173     case GraphicsContext3D::STENCIL_TEST:</span>
<span class="line-modified">2174     case GraphicsContext3D::RASTERIZER_DISCARD:</span>
2175         return true;
2176     default:
<a name="448" id="anc448"></a><span class="line-modified">2177         synthesizeGLError(GraphicsContext3D::INVALID_ENUM, functionName, &quot;invalid capability&quot;);</span>
2178         return false;
2179     }
2180 }
2181 
<a name="449" id="anc449"></a>



















































































































































































































2182 } // namespace WebCore
2183 
2184 #endif // ENABLE(WEBGL)
<a name="450" id="anc450"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="450" type="hidden" />
</body>
</html>