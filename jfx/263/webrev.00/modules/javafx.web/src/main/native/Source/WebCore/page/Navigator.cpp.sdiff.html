<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/page/Navigator.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MemoryRelease.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Navigator.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/page/Navigator.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 60 Navigator::~Navigator() = default;
 61 
 62 String Navigator::appVersion() const
 63 {
 64     auto* frame = this-&gt;frame();
 65     if (!frame)
 66         return String();
 67     if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled())
 68         ResourceLoadObserver::shared().logNavigatorAPIAccessed(*frame-&gt;document(), ResourceLoadStatistics::NavigatorAPI::AppVersion);
 69     return NavigatorBase::appVersion();
 70 }
 71 
 72 const String&amp; Navigator::userAgent() const
 73 {
 74     auto* frame = this-&gt;frame();
 75     if (!frame || !frame-&gt;page())
 76         return m_userAgent;
 77     if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled())
 78         ResourceLoadObserver::shared().logNavigatorAPIAccessed(*frame-&gt;document(), ResourceLoadStatistics::NavigatorAPI::UserAgent);
 79     if (m_userAgent.isNull())
<span class="line-modified"> 80         m_userAgent = frame-&gt;loader().userAgentForJavaScript(frame-&gt;document()-&gt;url());</span>
 81     return m_userAgent;
 82 }
 83 
 84 String Navigator::platform() const
 85 {
 86     auto* frame = this-&gt;frame();
 87     if (!frame || !frame-&gt;page())
 88         return m_platform;
 89 
 90     if (m_platform.isNull())
 91         m_platform = frame-&gt;loader().navigatorPlatform();
 92 
 93     if (m_platform.isNull())
 94         m_platform = NavigatorBase::platform();
 95     return m_platform;
 96 }
 97 
 98 void Navigator::userAgentChanged()
 99 {
100     m_userAgent = String();
</pre>
<hr />
<pre>
110     auto* frame = this-&gt;frame();
111     if (!frame || !frame-&gt;page()) {
112         promise-&gt;reject(TypeError);
113         return;
114     }
115 
116     if (data.title.isEmpty() &amp;&amp; data.url.isEmpty() &amp;&amp; data.text.isEmpty()) {
117         promise-&gt;reject(TypeError);
118         return;
119     }
120 
121     Optional&lt;URL&gt; url;
122     if (!data.url.isEmpty()) {
123         url = context.completeURL(data.url);
124         if (!url-&gt;isValid()) {
125             promise-&gt;reject(TypeError);
126             return;
127         }
128     }
129 
<span class="line-modified">130     if (!UserGestureIndicator::processingUserGesture()) {</span>


131         promise-&gt;reject(NotAllowedError);
132         return;
133     }
134 
135     ShareDataWithParsedURL shareData = {
136         data,
137         url,
138     };
139 
140     frame-&gt;page()-&gt;chrome().showShareSheet(shareData, [promise = WTFMove(promise)] (bool completed) {
141         if (completed) {
142             promise-&gt;resolve();
143             return;
144         }
145         promise-&gt;reject(Exception { AbortError, &quot;Abort due to cancellation of share.&quot;_s });
146     });
147 }
148 
149 DOMPluginArray&amp; Navigator::plugins()
150 {
</pre>
</td>
<td>
<hr />
<pre>
 60 Navigator::~Navigator() = default;
 61 
 62 String Navigator::appVersion() const
 63 {
 64     auto* frame = this-&gt;frame();
 65     if (!frame)
 66         return String();
 67     if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled())
 68         ResourceLoadObserver::shared().logNavigatorAPIAccessed(*frame-&gt;document(), ResourceLoadStatistics::NavigatorAPI::AppVersion);
 69     return NavigatorBase::appVersion();
 70 }
 71 
 72 const String&amp; Navigator::userAgent() const
 73 {
 74     auto* frame = this-&gt;frame();
 75     if (!frame || !frame-&gt;page())
 76         return m_userAgent;
 77     if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled())
 78         ResourceLoadObserver::shared().logNavigatorAPIAccessed(*frame-&gt;document(), ResourceLoadStatistics::NavigatorAPI::UserAgent);
 79     if (m_userAgent.isNull())
<span class="line-modified"> 80         m_userAgent = frame-&gt;loader().userAgent(frame-&gt;document()-&gt;url());</span>
 81     return m_userAgent;
 82 }
 83 
 84 String Navigator::platform() const
 85 {
 86     auto* frame = this-&gt;frame();
 87     if (!frame || !frame-&gt;page())
 88         return m_platform;
 89 
 90     if (m_platform.isNull())
 91         m_platform = frame-&gt;loader().navigatorPlatform();
 92 
 93     if (m_platform.isNull())
 94         m_platform = NavigatorBase::platform();
 95     return m_platform;
 96 }
 97 
 98 void Navigator::userAgentChanged()
 99 {
100     m_userAgent = String();
</pre>
<hr />
<pre>
110     auto* frame = this-&gt;frame();
111     if (!frame || !frame-&gt;page()) {
112         promise-&gt;reject(TypeError);
113         return;
114     }
115 
116     if (data.title.isEmpty() &amp;&amp; data.url.isEmpty() &amp;&amp; data.text.isEmpty()) {
117         promise-&gt;reject(TypeError);
118         return;
119     }
120 
121     Optional&lt;URL&gt; url;
122     if (!data.url.isEmpty()) {
123         url = context.completeURL(data.url);
124         if (!url-&gt;isValid()) {
125             promise-&gt;reject(TypeError);
126             return;
127         }
128     }
129 
<span class="line-modified">130     auto* window = this-&gt;window();</span>
<span class="line-added">131     // Note that the specification does not indicate we should consume user activation. We are intentionally stricter here.</span>
<span class="line-added">132     if (!window || !window-&gt;consumeTransientActivation()) {</span>
133         promise-&gt;reject(NotAllowedError);
134         return;
135     }
136 
137     ShareDataWithParsedURL shareData = {
138         data,
139         url,
140     };
141 
142     frame-&gt;page()-&gt;chrome().showShareSheet(shareData, [promise = WTFMove(promise)] (bool completed) {
143         if (completed) {
144             promise-&gt;resolve();
145             return;
146         }
147         promise-&gt;reject(Exception { AbortError, &quot;Abort due to cancellation of share.&quot;_s });
148     });
149 }
150 
151 DOMPluginArray&amp; Navigator::plugins()
152 {
</pre>
</td>
</tr>
</table>
<center><a href="MemoryRelease.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Navigator.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>