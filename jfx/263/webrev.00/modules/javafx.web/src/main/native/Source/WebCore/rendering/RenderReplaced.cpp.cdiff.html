<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderReplaced.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="RenderQuote.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderScrollbar.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderReplaced.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 27,19 ***</span>
<span class="line-new-header">--- 27,22 ---</span>
  #include &quot;DocumentMarkerController.h&quot;
  #include &quot;FloatRoundedRect.h&quot;
  #include &quot;Frame.h&quot;
  #include &quot;GraphicsContext.h&quot;
  #include &quot;HTMLElement.h&quot;
<span class="line-added">+ #include &quot;HTMLImageElement.h&quot;</span>
<span class="line-added">+ #include &quot;HTMLParserIdioms.h&quot;</span>
  #include &quot;InlineElementBox.h&quot;
  #include &quot;LayoutRepainter.h&quot;
  #include &quot;RenderBlock.h&quot;
  #include &quot;RenderFragmentedFlow.h&quot;
  #include &quot;RenderImage.h&quot;
  #include &quot;RenderLayer.h&quot;
  #include &quot;RenderTheme.h&quot;
  #include &quot;RenderView.h&quot;
  #include &quot;RenderedDocumentMarker.h&quot;
<span class="line-added">+ #include &quot;Settings.h&quot;</span>
  #include &quot;VisiblePosition.h&quot;
  #include &lt;wtf/IsoMallocInlines.h&gt;
  #include &lt;wtf/StackStats.h&gt;
  
  namespace WebCore {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 435,13 ***</span>
      // If there&#39;s an embeddedContentBox() of a remote, referenced document available, this code-path should never be used.
      ASSERT(!embeddedContentBox());
      intrinsicSize = FloatSize(intrinsicLogicalWidth(), intrinsicLogicalHeight());
  
      // Figure out if we need to compute an intrinsic ratio.
<span class="line-modified">!     if (intrinsicSize.isEmpty() || !hasAspectRatio())</span>
          return;
  
      intrinsicRatio = intrinsicSize.width() / intrinsicSize.height();
  }
  
  LayoutUnit RenderReplaced::computeConstrainedLogicalWidth(ShouldComputePreferred shouldComputePreferred) const
  {
<span class="line-new-header">--- 438,32 ---</span>
      // If there&#39;s an embeddedContentBox() of a remote, referenced document available, this code-path should never be used.
      ASSERT(!embeddedContentBox());
      intrinsicSize = FloatSize(intrinsicLogicalWidth(), intrinsicLogicalHeight());
  
      // Figure out if we need to compute an intrinsic ratio.
<span class="line-modified">!     if (!hasAspectRatio())</span>
          return;
  
<span class="line-added">+     if (intrinsicSize.isEmpty()) {</span>
<span class="line-added">+         if (!settings().aspectRatioOfImgFromWidthAndHeightEnabled())</span>
<span class="line-added">+             return;</span>
<span class="line-added">+ </span>
<span class="line-added">+         auto* node = element();</span>
<span class="line-added">+         // The aspectRatioOfImgFromWidthAndHeight only applies to &lt;img&gt;.</span>
<span class="line-added">+         if (!node || !is&lt;HTMLImageElement&gt;(*node) || !node-&gt;hasAttribute(HTMLNames::widthAttr) || !node-&gt;hasAttribute(HTMLNames::heightAttr))</span>
<span class="line-added">+             return;</span>
<span class="line-added">+ </span>
<span class="line-added">+         // We shouldn&#39;t override the aspect-ratio when the &lt;img&gt; element has an empty src attribute.</span>
<span class="line-added">+         if (!is&lt;RenderImage&gt;(*this) || !downcast&lt;RenderImage&gt;(*this).cachedImage())</span>
<span class="line-added">+             return;</span>
<span class="line-added">+ </span>
<span class="line-added">+         intrinsicSize.setWidth(parseValidHTMLFloatingPointNumber(node-&gt;getAttribute(HTMLNames::widthAttr)).valueOr(0));</span>
<span class="line-added">+         intrinsicSize.setHeight(parseValidHTMLFloatingPointNumber(node-&gt;getAttribute(HTMLNames::heightAttr)).valueOr(0));</span>
<span class="line-added">+         if (intrinsicSize.isEmpty())</span>
<span class="line-added">+             return;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      intrinsicRatio = intrinsicSize.width() / intrinsicSize.height();
  }
  
  LayoutUnit RenderReplaced::computeConstrainedLogicalWidth(ShouldComputePreferred shouldComputePreferred) const
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 456,11 ***</span>
      LayoutUnit logicalWidth = containingBlock()-&gt;availableLogicalWidth();
  
      // This solves above equation for &#39;width&#39; (== logicalWidth).
      LayoutUnit marginStart = minimumValueForLength(style().marginStart(), logicalWidth);
      LayoutUnit marginEnd = minimumValueForLength(style().marginEnd(), logicalWidth);
<span class="line-modified">!     logicalWidth = std::max(0_lu, (logicalWidth - (marginStart + marginEnd + (size().width() - clientWidth()))));</span>
      return computeReplacedLogicalWidthRespectingMinMaxWidth(logicalWidth, shouldComputePreferred);
  }
  
  LayoutUnit RenderReplaced::computeReplacedLogicalWidth(ShouldComputePreferred shouldComputePreferred) const
  {
<span class="line-new-header">--- 478,13 ---</span>
      LayoutUnit logicalWidth = containingBlock()-&gt;availableLogicalWidth();
  
      // This solves above equation for &#39;width&#39; (== logicalWidth).
      LayoutUnit marginStart = minimumValueForLength(style().marginStart(), logicalWidth);
      LayoutUnit marginEnd = minimumValueForLength(style().marginEnd(), logicalWidth);
<span class="line-modified">! </span>
<span class="line-added">+     // FIXME: This expression does not align with the comment above, which is quoting https://www.w3.org/TR/CSS22/visudet.html#blockwidth.</span>
<span class="line-added">+     logicalWidth = std::max(0_lu, (logicalWidth - (marginStart + marginEnd + borderLeft() + borderRight())));</span>
      return computeReplacedLogicalWidthRespectingMinMaxWidth(logicalWidth, shouldComputePreferred);
  }
  
  LayoutUnit RenderReplaced::computeReplacedLogicalWidth(ShouldComputePreferred shouldComputePreferred) const
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 663,12 ***</span>
      if (state == SelectionNone)
          return false;
      if (state == SelectionInside)
          return true;
  
<span class="line-modified">!     auto selectionStart = view().selection().startPosition();</span>
<span class="line-modified">!     auto selectionEnd = view().selection().endPosition();</span>
      if (state == SelectionStart)
          return !selectionStart;
  
      unsigned end = element()-&gt;hasChildNodes() ? element()-&gt;countChildNodes() : 1;
      if (state == SelectionEnd)
<span class="line-new-header">--- 687,12 ---</span>
      if (state == SelectionNone)
          return false;
      if (state == SelectionInside)
          return true;
  
<span class="line-modified">!     auto selectionStart = view().selection().startOffset();</span>
<span class="line-modified">!     auto selectionEnd = view().selection().endOffset();</span>
      if (state == SelectionStart)
          return !selectionStart;
  
      unsigned end = element()-&gt;hasChildNodes() ? element()-&gt;countChildNodes() : 1;
      if (state == SelectionEnd)
</pre>
<center><a href="RenderQuote.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderScrollbar.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>