<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/platform/network/java/NetworkStorageSessionJava.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2018, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;NetworkStorageSession.h&quot;
 28 
 29 #include &quot;Cookie.h&quot;
 30 #include &quot;CookieRequestHeaderFieldProxy.h&quot;
 31 #include &quot;HTTPCookieAcceptPolicy.h&quot;
 32 #include &quot;NetworkingContext.h&quot;
 33 #include &quot;NotImplemented.h&quot;
 34 #include &quot;ResourceHandle.h&quot;
 35 
 36 #include &lt;wtf/MainThread.h&gt;
 37 #include &lt;wtf/NeverDestroyed.h&gt;
 38 #include &lt;wtf/URL.h&gt;
 39 #include &quot;PlatformJavaClasses.h&quot;
 40 
 41 namespace WebCore {
 42 
 43 namespace CookieInternalJava {
 44 
 45 static JGClass cookieJarClass;
 46 static jmethodID getMethod;
 47 static jmethodID putMethod;
 48 
 49 static void initRefs(JNIEnv* env)
 50 {
 51     if (!cookieJarClass) {
 52         cookieJarClass = JLClass(env-&gt;FindClass(
 53                 &quot;com/sun/webkit/network/CookieJar&quot;));
 54         ASSERT(cookieJarClass);
 55 
 56         getMethod = env-&gt;GetStaticMethodID(
 57                 cookieJarClass,
 58                 &quot;fwkGet&quot;,
 59                 &quot;(Ljava/lang/String;Z)Ljava/lang/String;&quot;);
 60         ASSERT(getMethod);
 61 
 62         putMethod = env-&gt;GetStaticMethodID(
 63                 cookieJarClass,
 64                 &quot;fwkPut&quot;,
 65                 &quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;);
 66         ASSERT(putMethod);
 67     }
 68 }
 69 
 70 static String getCookies(const URL&amp; url, bool includeHttpOnlyCookies)
 71 {
 72     using namespace CookieInternalJava;
 73     JNIEnv* env = WTF::GetJavaEnv();
 74     initRefs(env);
 75 
 76     JLString result = static_cast&lt;jstring&gt;(env-&gt;CallStaticObjectMethod(
 77             cookieJarClass,
 78             getMethod,
 79             (jstring) url.string().toJavaString(env),
 80             bool_to_jbool(includeHttpOnlyCookies)));
 81     WTF::CheckAndClearException(env);
 82 
 83     return result ? String(env, result) : emptyString();
 84 }
 85 }
 86 
 87 NetworkStorageSession::NetworkStorageSession(PAL::SessionID sessionID)
 88     : m_sessionID(sessionID)
 89 {
 90 }
 91 
 92 NetworkStorageSession::~NetworkStorageSession()
 93 {
 94 }
 95 
 96 void NetworkStorageSession::setCookiesFromDOM(const URL&amp; /*firstParty*/, const SameSiteInfo&amp;, const URL&amp; url, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, ShouldAskITP, const String&amp; value) const
 97 {
 98     using namespace CookieInternalJava;
 99     JNIEnv* env = WTF::GetJavaEnv();
100     initRefs(env);
101 
102     env-&gt;CallStaticVoidMethod(
103             cookieJarClass,
104             putMethod,
105             (jstring) url.string().toJavaString(env),
106             (jstring) value.toJavaString(env));
107     WTF::CheckAndClearException(env);
108 }
109 
110 std::pair&lt;String, bool&gt; NetworkStorageSession::cookiesForDOM(const URL&amp;, const SameSiteInfo&amp;, const URL&amp; url, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, IncludeSecureCookies, ShouldAskITP) const
111 {
112     // &#39;HttpOnly&#39; cookies should no be accessible from scripts, so we filter them out here.
113     return { CookieInternalJava::getCookies(url, false), false };
114 }
115 
116 std::pair&lt;String, bool&gt; NetworkStorageSession::cookieRequestHeaderFieldValue(const URL&amp; /*firstParty*/, const SameSiteInfo&amp;, const URL&amp; url, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, IncludeSecureCookies, ShouldAskITP) const
117 {
118     return { CookieInternalJava::getCookies(url, true), true };
119 }
120 
121 std::pair&lt;String, bool&gt; NetworkStorageSession::cookieRequestHeaderFieldValue(const CookieRequestHeaderFieldProxy&amp; headerFieldProxy) const
122 {
123     return { CookieInternalJava::getCookies(headerFieldProxy.firstParty, true), true };
124 }
125 
126 bool NetworkStorageSession::getRawCookies(const URL&amp; /*firstParty*/, const SameSiteInfo&amp;, const URL&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, ShouldAskITP, Vector&lt;Cookie&gt;&amp;) const
127 {
128     notImplemented();
129     return false;
130 }
131 
132 HTTPCookieAcceptPolicy NetworkStorageSession::cookieAcceptPolicy() const
133 {
134     return HTTPCookieAcceptPolicy::AlwaysAccept;
135 }
136 
137 void NetworkStorageSession::setCookies(const Vector&lt;Cookie&gt;&amp;, const URL&amp;, const URL&amp;)
138 {
139     // FIXME: Implement for WebKit to use.
140 }
141 
142 void NetworkStorageSession::setCookie(const Cookie&amp;)
143 {
144     // FIXME: Implement for WebKit to use.
145 }
146 
147 void NetworkStorageSession::deleteCookie(const Cookie&amp;)
148 {
149     // FIXME: Implement for WebKit to use.
150 }
151 
152 void NetworkStorageSession::deleteCookie(const URL&amp;, const String&amp;) const
153 {
154     // FIXME: Implement for WebKit to use.
155 }
156 
157 Vector&lt;Cookie&gt; NetworkStorageSession::getAllCookies()
158 {
159     // FIXME: Implement for WebKit to use.
160     return { };
161 }
162 
163 Vector&lt;Cookie&gt; NetworkStorageSession::getCookies(const URL&amp;)
164 {
165     // FIXME: Implement for WebKit to use.
166     return { };
167 }
168 
169 void NetworkStorageSession::flushCookieStore()
170 {
171     // FIXME: Implement for WebKit to use.
172 }
173 
174 } // namespace WebCore
175 
    </pre>
  </body>
</html>