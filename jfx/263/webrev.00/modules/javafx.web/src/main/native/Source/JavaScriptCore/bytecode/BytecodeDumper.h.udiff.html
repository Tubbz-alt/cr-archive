<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/BytecodeDumper.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="BytecodeDumper.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="BytecodeGeneratorification.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/BytecodeDumper.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -24,25 +24,25 @@</span>
   * THE POSSIBILITY OF SUCH DAMAGE.
   */
  
  #pragma once
  
<span class="udiff-line-added">+ #include &quot;BytecodeGeneratorBase.h&quot;</span>
  #include &quot;CallLinkInfo.h&quot;
  #include &quot;ICStatusMap.h&quot;
  #include &quot;InstructionStream.h&quot;
<span class="udiff-line-removed">- #include &quot;Label.h&quot;</span>
  #include &quot;StructureStubInfo.h&quot;
  
  namespace JSC {
  
  struct Instruction;
  
<span class="udiff-line-modified-removed">- template&lt;class Block&gt;</span>
<span class="udiff-line-removed">- class BytecodeDumper {</span>
<span class="udiff-line-modified-added">+ class BytecodeDumperBase {</span>
  public:
<span class="udiff-line-modified-removed">-     static void dumpBytecode(Block*, PrintStream&amp; out, const InstructionStream::Ref&amp; it, const ICStatusMap&amp; = ICStatusMap());</span>
<span class="udiff-line-modified-removed">-     static void dumpBlock(Block*, const InstructionStream&amp;, PrintStream&amp; out, const ICStatusMap&amp; = ICStatusMap());</span>
<span class="udiff-line-modified-added">+     virtual ~BytecodeDumperBase()</span>
<span class="udiff-line-modified-added">+     {</span>
<span class="udiff-line-added">+     }</span>
  
      void printLocationAndOp(InstructionStream::Offset location, const char* op);
  
      template&lt;typename T&gt;
      void dumpOperand(T operand, bool isFirst = false)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -50,44 +50,97 @@</span>
          if (!isFirst)
              m_out.print(&quot;, &quot;);
          dumpValue(operand);
      }
  
<span class="udiff-line-modified-removed">-     void dumpValue(VirtualRegister reg) { m_out.printf(&quot;%s&quot;, registerName(reg.offset()).data()); }</span>
<span class="udiff-line-modified-removed">-     void dumpValue(BoundLabel label)</span>
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-         InstructionStream::Offset targetOffset = label.target() + m_currentLocation;</span>
<span class="udiff-line-modified-removed">-         m_out.print(label.target(), &quot;(-&gt;&quot;, targetOffset, &quot;)&quot;);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     void dumpValue(VirtualRegister);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     template&lt;typename Traits&gt;</span>
<span class="udiff-line-modified-added">+     void dumpValue(GenericBoundLabel&lt;Traits&gt;);</span>
<span class="udiff-line-modified-added">+ </span>
      template&lt;typename T&gt;
      void dumpValue(T v) { m_out.print(v); }
  
<span class="udiff-line-modified-removed">- private:</span>
<span class="udiff-line-modified-added">+ protected:</span>
<span class="udiff-line-added">+     virtual CString registerName(VirtualRegister) const = 0;</span>
<span class="udiff-line-added">+     virtual int outOfLineJumpOffset(InstructionStream::Offset) const = 0;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     BytecodeDumperBase(PrintStream&amp; out)</span>
<span class="udiff-line-added">+         : m_out(out)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     PrintStream&amp; m_out;</span>
<span class="udiff-line-added">+     InstructionStream::Offset m_currentLocation { 0 };</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ template&lt;class Block&gt;</span>
<span class="udiff-line-added">+ class BytecodeDumper : public BytecodeDumperBase {</span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+     static void dumpBytecode(Block*, PrintStream&amp; out, const InstructionStream::Ref&amp; it, const ICStatusMap&amp; = ICStatusMap());</span>
<span class="udiff-line-added">+ </span>
      BytecodeDumper(Block* block, PrintStream&amp; out)
<span class="udiff-line-modified-removed">-         : m_block(block)</span>
<span class="udiff-line-modified-removed">-         , m_out(out)</span>
<span class="udiff-line-modified-added">+         : BytecodeDumperBase(out)</span>
<span class="udiff-line-modified-added">+         , m_block(block)</span>
      {
      }
  
<span class="udiff-line-added">+     virtual ~BytecodeDumper() { }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ protected:</span>
      Block* block() const { return m_block; }
  
<span class="udiff-line-modified-removed">-     ALWAYS_INLINE VM&amp; vm() const;</span>
<span class="udiff-line-modified-added">+     void dumpBytecode(const InstructionStream::Ref&amp; it, const ICStatusMap&amp;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     CString registerName(VirtualRegister) const override;</span>
<span class="udiff-line-added">+     int outOfLineJumpOffset(InstructionStream::Offset offset) const override;</span>
  
<span class="udiff-line-modified-removed">-     CString registerName(int r) const;</span>
<span class="udiff-line-modified-removed">-     CString constantName(int index) const;</span>
<span class="udiff-line-modified-added">+ private:</span>
<span class="udiff-line-modified-added">+     virtual CString constantName(VirtualRegister) const;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     Block* m_block;</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ template&lt;class Block&gt;</span>
<span class="udiff-line-added">+ class CodeBlockBytecodeDumper : public BytecodeDumper&lt;Block&gt; {</span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+     static void dumpBlock(Block*, const InstructionStream&amp;, PrintStream&amp; out, const ICStatusMap&amp; = ICStatusMap());</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ private:</span>
<span class="udiff-line-added">+     using BytecodeDumper&lt;Block&gt;::BytecodeDumper;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ALWAYS_INLINE VM&amp; vm() const;</span>
  
      const Identifier&amp; identifier(int index) const;
  
      void dumpIdentifiers();
      void dumpConstants();
      void dumpExceptionHandlers();
      void dumpSwitchJumpTables();
      void dumpStringSwitchJumpTables();
<span class="udiff-line-added">+ };</span>
  
<span class="udiff-line-modified-removed">-     void dumpBytecode(const InstructionStream::Ref&amp; it, const ICStatusMap&amp;);</span>
<span class="udiff-line-modified-added">+ #if ENABLE(WEBASSEMBLY)</span>
  
<span class="udiff-line-modified-removed">-     Block* m_block;</span>
<span class="udiff-line-modified-removed">-     PrintStream&amp; m_out;</span>
<span class="udiff-line-modified-removed">-     InstructionStream::Offset m_currentLocation { 0 };</span>
<span class="udiff-line-modified-added">+ namespace Wasm {</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ class FunctionCodeBlock;</span>
<span class="udiff-line-added">+ struct ModuleInformation;</span>
<span class="udiff-line-added">+ enum Type : int8_t;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ class BytecodeDumper : public JSC::BytecodeDumper&lt;FunctionCodeBlock&gt; {</span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+     static void dumpBlock(FunctionCodeBlock*, const ModuleInformation&amp;, PrintStream&amp; out);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ private:</span>
<span class="udiff-line-added">+     using JSC::BytecodeDumper&lt;FunctionCodeBlock&gt;::BytecodeDumper;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     void dumpConstants();</span>
<span class="udiff-line-added">+     CString constantName(VirtualRegister index) const override;</span>
<span class="udiff-line-added">+     CString formatConstant(Type, uint64_t) const;</span>
  };
  
<span class="udiff-line-added">+ } // namespace Wasm</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #endif // ENABLE(WEBASSEMBLY)</span>
<span class="udiff-line-added">+ </span>
  }
</pre>
<center><a href="BytecodeDumper.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="BytecodeGeneratorification.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>