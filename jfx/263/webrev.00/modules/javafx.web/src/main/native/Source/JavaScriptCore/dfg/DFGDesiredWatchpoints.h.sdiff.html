<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGDesiredWatchpoints.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DFGDesiredWatchpoints.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGDesiredWeakReferences.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGDesiredWatchpoints.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 28 #if ENABLE(DFG_JIT)
 29 
 30 #include &quot;DFGCommonData.h&quot;
 31 #include &quot;FunctionExecutable.h&quot;
 32 #include &quot;JSArrayBufferView.h&quot;
 33 #include &quot;ObjectPropertyCondition.h&quot;
 34 #include &quot;SymbolTable.h&quot;
 35 #include &quot;Watchpoint.h&quot;
 36 #include &lt;wtf/CommaPrinter.h&gt;
 37 #include &lt;wtf/HashSet.h&gt;
 38 
 39 namespace JSC { namespace DFG {
 40 
 41 class Graph;
 42 struct Prefix;
 43 
 44 template&lt;typename T&gt;
 45 struct SetPointerAdaptor {
 46     static void add(CodeBlock* codeBlock, T set, CommonData&amp; common)
 47     {
<span class="line-modified"> 48         return set-&gt;add(common.watchpoints.add(codeBlock));</span>





 49     }
 50     static bool hasBeenInvalidated(T set)
 51     {
 52         return set-&gt;hasBeenInvalidated();
 53     }
 54     static void dumpInContext(PrintStream&amp; out, T set, DumpContext*)
 55     {
 56         out.print(RawPointer(set));
 57     }
 58 };
 59 
 60 struct SymbolTableAdaptor {
 61     static void add(CodeBlock*, SymbolTable*, CommonData&amp;);
 62     static bool hasBeenInvalidated(SymbolTable* symbolTable)
 63     {
 64         return symbolTable-&gt;singleton().hasBeenInvalidated();
 65     }
 66     static void dumpInContext(PrintStream&amp; out, SymbolTable* symbolTable, DumpContext*)
 67     {
 68         out.print(RawPointer(symbolTable));
</pre>
<hr />
<pre>
 91     {
 92         out.print(inContext(JSValue(view), context));
 93     }
 94 };
 95 
 96 struct AdaptiveStructureWatchpointAdaptor {
 97     static void add(CodeBlock*, const ObjectPropertyCondition&amp;, CommonData&amp;);
 98     static bool hasBeenInvalidated(const ObjectPropertyCondition&amp; key)
 99     {
100         return !key.isWatchable();
101     }
102     static void dumpInContext(
103         PrintStream&amp; out, const ObjectPropertyCondition&amp; key, DumpContext* context)
104     {
105         out.print(inContext(key, context));
106     }
107 };
108 
109 template&lt;typename WatchpointSetType, typename Adaptor = SetPointerAdaptor&lt;WatchpointSetType&gt;&gt;
110 class GenericDesiredWatchpoints {
<span class="line-modified">111 #if !ASSERT_DISABLED</span>
112     typedef HashMap&lt;WatchpointSetType, bool&gt; StateMap;
113 #endif
114 public:
115     GenericDesiredWatchpoints()
116         : m_reallyAdded(false)
117     {
118     }
119 
120     void addLazily(const WatchpointSetType&amp; set)
121     {
122         m_sets.add(set);
123     }
124 
125     void reallyAdd(CodeBlock* codeBlock, CommonData&amp; common)
126     {
127         RELEASE_ASSERT(!m_reallyAdded);
128 
129         for (auto&amp; set : m_sets)
130             Adaptor::add(codeBlock, set, common);
131 
</pre>
</td>
<td>
<hr />
<pre>
 28 #if ENABLE(DFG_JIT)
 29 
 30 #include &quot;DFGCommonData.h&quot;
 31 #include &quot;FunctionExecutable.h&quot;
 32 #include &quot;JSArrayBufferView.h&quot;
 33 #include &quot;ObjectPropertyCondition.h&quot;
 34 #include &quot;SymbolTable.h&quot;
 35 #include &quot;Watchpoint.h&quot;
 36 #include &lt;wtf/CommaPrinter.h&gt;
 37 #include &lt;wtf/HashSet.h&gt;
 38 
 39 namespace JSC { namespace DFG {
 40 
 41 class Graph;
 42 struct Prefix;
 43 
 44 template&lt;typename T&gt;
 45 struct SetPointerAdaptor {
 46     static void add(CodeBlock* codeBlock, T set, CommonData&amp; common)
 47     {
<span class="line-modified"> 48         CodeBlockJettisoningWatchpoint* watchpoint = nullptr;</span>
<span class="line-added"> 49         {</span>
<span class="line-added"> 50             ConcurrentJSLocker locker(codeBlock-&gt;m_lock);</span>
<span class="line-added"> 51             watchpoint = common.watchpoints.add(codeBlock);</span>
<span class="line-added"> 52         }</span>
<span class="line-added"> 53         return set-&gt;add(WTFMove(watchpoint));</span>
 54     }
 55     static bool hasBeenInvalidated(T set)
 56     {
 57         return set-&gt;hasBeenInvalidated();
 58     }
 59     static void dumpInContext(PrintStream&amp; out, T set, DumpContext*)
 60     {
 61         out.print(RawPointer(set));
 62     }
 63 };
 64 
 65 struct SymbolTableAdaptor {
 66     static void add(CodeBlock*, SymbolTable*, CommonData&amp;);
 67     static bool hasBeenInvalidated(SymbolTable* symbolTable)
 68     {
 69         return symbolTable-&gt;singleton().hasBeenInvalidated();
 70     }
 71     static void dumpInContext(PrintStream&amp; out, SymbolTable* symbolTable, DumpContext*)
 72     {
 73         out.print(RawPointer(symbolTable));
</pre>
<hr />
<pre>
 96     {
 97         out.print(inContext(JSValue(view), context));
 98     }
 99 };
100 
101 struct AdaptiveStructureWatchpointAdaptor {
102     static void add(CodeBlock*, const ObjectPropertyCondition&amp;, CommonData&amp;);
103     static bool hasBeenInvalidated(const ObjectPropertyCondition&amp; key)
104     {
105         return !key.isWatchable();
106     }
107     static void dumpInContext(
108         PrintStream&amp; out, const ObjectPropertyCondition&amp; key, DumpContext* context)
109     {
110         out.print(inContext(key, context));
111     }
112 };
113 
114 template&lt;typename WatchpointSetType, typename Adaptor = SetPointerAdaptor&lt;WatchpointSetType&gt;&gt;
115 class GenericDesiredWatchpoints {
<span class="line-modified">116 #if ASSERT_ENABLED</span>
117     typedef HashMap&lt;WatchpointSetType, bool&gt; StateMap;
118 #endif
119 public:
120     GenericDesiredWatchpoints()
121         : m_reallyAdded(false)
122     {
123     }
124 
125     void addLazily(const WatchpointSetType&amp; set)
126     {
127         m_sets.add(set);
128     }
129 
130     void reallyAdd(CodeBlock* codeBlock, CommonData&amp; common)
131     {
132         RELEASE_ASSERT(!m_reallyAdded);
133 
134         for (auto&amp; set : m_sets)
135             Adaptor::add(codeBlock, set, common);
136 
</pre>
</td>
</tr>
</table>
<center><a href="DFGDesiredWatchpoints.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGDesiredWeakReferences.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>