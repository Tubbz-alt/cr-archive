<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/DFGExitProfile.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DFGExitProfile.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DeferredSourceDump.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/DFGExitProfile.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (C) 2011-2018 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (C) 2011-2019 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
</pre>
<hr />
<pre>
<span class="line-old-header">*** 37,42 ***</span>
  namespace JSC { namespace DFG {
  
  class FrequentExitSite {
  public:
      FrequentExitSite()
<span class="line-modified">!         : m_bytecodeOffset(0) // 0 = empty value</span>
          , m_kind(ExitKindUnset)
          , m_jitType(ExitFromAnything)
          , m_inlineKind(ExitFromAnyInlineKind)
      {
      }
  
      FrequentExitSite(WTF::HashTableDeletedValueType)
<span class="line-modified">!         : m_bytecodeOffset(1) // 1 = deleted value</span>
          , m_kind(ExitKindUnset)
          , m_jitType(ExitFromAnything)
          , m_inlineKind(ExitFromAnyInlineKind)
      {
      }
  
<span class="line-modified">!     explicit FrequentExitSite(unsigned bytecodeOffset, ExitKind kind, ExitingJITType jitType = ExitFromAnything, ExitingInlineKind inlineKind = ExitFromAnyInlineKind)</span>
<span class="line-modified">!         : m_bytecodeOffset(bytecodeOffset)</span>
          , m_kind(kind)
          , m_jitType(jitType)
          , m_inlineKind(inlineKind)
      {
          if (m_kind == ArgumentsEscaped) {
              // Count this one globally. It doesn&#39;t matter where in the code block the arguments excaped;
              // the fact that they did is not associated with any particular instruction.
<span class="line-modified">!             m_bytecodeOffset = 0;</span>
          }
      }
  
      // Use this constructor if you wish for the exit site to be counted globally within its
      // code block.
      explicit FrequentExitSite(ExitKind kind, ExitingJITType jitType = ExitFromAnything, ExitingInlineKind inlineKind = ExitFromAnyInlineKind)
<span class="line-modified">!         : m_bytecodeOffset(0)</span>
          , m_kind(kind)
          , m_jitType(jitType)
          , m_inlineKind(inlineKind)
      {
      }
<span class="line-new-header">--- 37,42 ---</span>
  namespace JSC { namespace DFG {
  
  class FrequentExitSite {
  public:
      FrequentExitSite()
<span class="line-modified">!         : m_bytecodeIndex(BytecodeIndex(0))</span>
          , m_kind(ExitKindUnset)
          , m_jitType(ExitFromAnything)
          , m_inlineKind(ExitFromAnyInlineKind)
      {
      }
  
      FrequentExitSite(WTF::HashTableDeletedValueType)
<span class="line-modified">!         : m_bytecodeIndex(WTF::HashTableDeletedValue)</span>
          , m_kind(ExitKindUnset)
          , m_jitType(ExitFromAnything)
          , m_inlineKind(ExitFromAnyInlineKind)
      {
      }
  
<span class="line-modified">!     explicit FrequentExitSite(BytecodeIndex bytecodeIndex, ExitKind kind, ExitingJITType jitType = ExitFromAnything, ExitingInlineKind inlineKind = ExitFromAnyInlineKind)</span>
<span class="line-modified">!         : m_bytecodeIndex(bytecodeIndex)</span>
          , m_kind(kind)
          , m_jitType(jitType)
          , m_inlineKind(inlineKind)
      {
          if (m_kind == ArgumentsEscaped) {
              // Count this one globally. It doesn&#39;t matter where in the code block the arguments excaped;
              // the fact that they did is not associated with any particular instruction.
<span class="line-modified">!             m_bytecodeIndex = BytecodeIndex(0);</span>
          }
      }
  
      // Use this constructor if you wish for the exit site to be counted globally within its
      // code block.
      explicit FrequentExitSite(ExitKind kind, ExitingJITType jitType = ExitFromAnything, ExitingInlineKind inlineKind = ExitFromAnyInlineKind)
<span class="line-modified">!         : m_bytecodeIndex(BytecodeIndex(0))</span>
          , m_kind(kind)
          , m_jitType(jitType)
          , m_inlineKind(inlineKind)
      {
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 82,19 ***</span>
          return m_kind == ExitKindUnset;
      }
  
      bool operator==(const FrequentExitSite&amp; other) const
      {
<span class="line-modified">!         return m_bytecodeOffset == other.m_bytecodeOffset</span>
              &amp;&amp; m_kind == other.m_kind
              &amp;&amp; m_jitType == other.m_jitType
              &amp;&amp; m_inlineKind == other.m_inlineKind;
      }
  
      bool subsumes(const FrequentExitSite&amp; other) const
      {
<span class="line-modified">!         if (m_bytecodeOffset != other.m_bytecodeOffset)</span>
              return false;
          if (m_kind != other.m_kind)
              return false;
          if (m_jitType != ExitFromAnything
              &amp;&amp; m_jitType != other.m_jitType)
<span class="line-new-header">--- 82,19 ---</span>
          return m_kind == ExitKindUnset;
      }
  
      bool operator==(const FrequentExitSite&amp; other) const
      {
<span class="line-modified">!         return m_bytecodeIndex == other.m_bytecodeIndex</span>
              &amp;&amp; m_kind == other.m_kind
              &amp;&amp; m_jitType == other.m_jitType
              &amp;&amp; m_inlineKind == other.m_inlineKind;
      }
  
      bool subsumes(const FrequentExitSite&amp; other) const
      {
<span class="line-modified">!         if (m_bytecodeIndex != other.m_bytecodeIndex)</span>
              return false;
          if (m_kind != other.m_kind)
              return false;
          if (m_jitType != ExitFromAnything
              &amp;&amp; m_jitType != other.m_jitType)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 105,14 ***</span>
          return true;
      }
  
      unsigned hash() const
      {
<span class="line-modified">!         return WTF::intHash(m_bytecodeOffset) + m_kind + static_cast&lt;unsigned&gt;(m_jitType) * 7 + static_cast&lt;unsigned&gt;(m_inlineKind) * 11;</span>
      }
  
<span class="line-modified">!     unsigned bytecodeOffset() const { return m_bytecodeOffset; }</span>
      ExitKind kind() const { return m_kind; }
      ExitingJITType jitType() const { return m_jitType; }
      ExitingInlineKind inlineKind() const { return m_inlineKind; }
  
      FrequentExitSite withJITType(ExitingJITType jitType) const
<span class="line-new-header">--- 105,14 ---</span>
          return true;
      }
  
      unsigned hash() const
      {
<span class="line-modified">!         return m_bytecodeIndex.hash() + m_kind + static_cast&lt;unsigned&gt;(m_jitType) * 7 + static_cast&lt;unsigned&gt;(m_inlineKind) * 11;</span>
      }
  
<span class="line-modified">!     BytecodeIndex bytecodeIndex() const { return m_bytecodeIndex; }</span>
      ExitKind kind() const { return m_kind; }
      ExitingJITType jitType() const { return m_jitType; }
      ExitingInlineKind inlineKind() const { return m_inlineKind; }
  
      FrequentExitSite withJITType(ExitingJITType jitType) const
</pre>
<hr />
<pre>
<span class="line-old-header">*** 129,26 ***</span>
          return result;
      }
  
      bool isHashTableDeletedValue() const
      {
<span class="line-modified">!         return m_kind == ExitKindUnset &amp;&amp; m_bytecodeOffset;</span>
      }
  
      void dump(PrintStream&amp; out) const;
  
  private:
<span class="line-modified">!     unsigned m_bytecodeOffset;</span>
      ExitKind m_kind;
      ExitingJITType m_jitType;
      ExitingInlineKind m_inlineKind;
  };
  
  struct FrequentExitSiteHash {
      static unsigned hash(const FrequentExitSite&amp; key) { return key.hash(); }
      static bool equal(const FrequentExitSite&amp; a, const FrequentExitSite&amp; b) { return a == b; }
<span class="line-modified">!     static const bool safeToCompareToEmptyOrDeleted = true;</span>
  };
  
  } } // namespace JSC::DFG
  
  
<span class="line-new-header">--- 129,26 ---</span>
          return result;
      }
  
      bool isHashTableDeletedValue() const
      {
<span class="line-modified">!         return m_kind == ExitKindUnset &amp;&amp; m_bytecodeIndex.isHashTableDeletedValue();</span>
      }
  
      void dump(PrintStream&amp; out) const;
  
  private:
<span class="line-modified">!     BytecodeIndex m_bytecodeIndex;</span>
      ExitKind m_kind;
      ExitingJITType m_jitType;
      ExitingInlineKind m_inlineKind;
  };
  
  struct FrequentExitSiteHash {
      static unsigned hash(const FrequentExitSite&amp; key) { return key.hash(); }
      static bool equal(const FrequentExitSite&amp; a, const FrequentExitSite&amp; b) { return a == b; }
<span class="line-modified">!     static constexpr bool safeToCompareToEmptyOrDeleted = true;</span>
  };
  
  } } // namespace JSC::DFG
  
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 181,11 ***</span>
      // anyway.
      static bool add(CodeBlock*, const FrequentExitSite&amp;);
  
      // Get the frequent exit sites for a bytecode index. This is O(n), and is
      // meant to only be used from debugging/profiling code.
<span class="line-modified">!     Vector&lt;FrequentExitSite&gt; exitSitesFor(unsigned bytecodeIndex);</span>
  
      // This is O(n) and should be called on less-frequently executed code paths
      // in the compiler. It should be strictly cheaper than building a
      // QueryableExitProfile, if you really expect this to be called infrequently
      // and you believe that there are few exit sites.
<span class="line-new-header">--- 181,11 ---</span>
      // anyway.
      static bool add(CodeBlock*, const FrequentExitSite&amp;);
  
      // Get the frequent exit sites for a bytecode index. This is O(n), and is
      // meant to only be used from debugging/profiling code.
<span class="line-modified">!     Vector&lt;FrequentExitSite&gt; exitSitesFor(BytecodeIndex);</span>
  
      // This is O(n) and should be called on less-frequently executed code paths
      // in the compiler. It should be strictly cheaper than building a
      // QueryableExitProfile, if you really expect this to be called infrequently
      // and you believe that there are few exit sites.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 220,11 ***</span>
      bool hasExitSite(ExitKind kind) const
      {
          return hasExitSite(FrequentExitSite(kind));
      }
  
<span class="line-modified">!     bool hasExitSite(unsigned bytecodeIndex, ExitKind kind) const</span>
      {
          return hasExitSite(FrequentExitSite(bytecodeIndex, kind));
      }
  private:
      bool hasExitSiteWithSpecificJITType(const FrequentExitSite&amp; site) const
<span class="line-new-header">--- 220,11 ---</span>
      bool hasExitSite(ExitKind kind) const
      {
          return hasExitSite(FrequentExitSite(kind));
      }
  
<span class="line-modified">!     bool hasExitSite(BytecodeIndex bytecodeIndex, ExitKind kind) const</span>
      {
          return hasExitSite(FrequentExitSite(bytecodeIndex, kind));
      }
  private:
      bool hasExitSiteWithSpecificJITType(const FrequentExitSite&amp; site) const
</pre>
<center><a href="DFGExitProfile.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DeferredSourceDump.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>