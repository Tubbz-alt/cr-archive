<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/css/CSSVariableReferenceValue.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CSSValuePool.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CSSVariableReferenceValue.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/css/CSSVariableReferenceValue.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -29,10 +29,11 @@</span>
  
  #include &quot;config.h&quot;
  #include &quot;CSSVariableReferenceValue.h&quot;
  
  #include &quot;RenderStyle.h&quot;
<span class="udiff-line-added">+ #include &quot;StyleBuilder.h&quot;</span>
  #include &quot;StyleResolver.h&quot;
  
  namespace WebCore {
  
  String CSSVariableReferenceValue::customCSSText() const
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -42,37 +43,37 @@</span>
          m_stringValue = m_data-&gt;tokenRange().serialize();
      }
      return m_stringValue;
  }
  
<span class="udiff-line-modified-removed">- static bool resolveTokenRange(CSSParserTokenRange, Vector&lt;CSSParserToken&gt;&amp;, ApplyCascadedPropertyState&amp;);</span>
<span class="udiff-line-modified-added">+ static bool resolveTokenRange(CSSParserTokenRange, Vector&lt;CSSParserToken&gt;&amp;, Style::BuilderState&amp;);</span>
  
<span class="udiff-line-modified-removed">- static bool resolveVariableFallback(CSSParserTokenRange range, Vector&lt;CSSParserToken&gt;&amp; result, ApplyCascadedPropertyState&amp; state)</span>
<span class="udiff-line-modified-added">+ static bool resolveVariableFallback(CSSParserTokenRange range, Vector&lt;CSSParserToken&gt;&amp; result, Style::BuilderState&amp; builderState)</span>
  {
      if (range.atEnd())
          return false;
      ASSERT(range.peek().type() == CommaToken);
      range.consume();
<span class="udiff-line-modified-removed">-     return resolveTokenRange(range, result, state);</span>
<span class="udiff-line-modified-added">+     return resolveTokenRange(range, result, builderState);</span>
  }
  
<span class="udiff-line-modified-removed">- static bool resolveVariableReference(CSSParserTokenRange range, Vector&lt;CSSParserToken&gt;&amp; result, ApplyCascadedPropertyState&amp; state)</span>
<span class="udiff-line-modified-added">+ static bool resolveVariableReference(CSSParserTokenRange range, Vector&lt;CSSParserToken&gt;&amp; result, Style::BuilderState&amp; builderState)</span>
  {
<span class="udiff-line-modified-removed">-     auto&amp; registeredProperties = state.styleResolver-&gt;document().getCSSRegisteredCustomPropertySet();</span>
<span class="udiff-line-modified-removed">-     auto&amp; style = *state.styleResolver-&gt;style();</span>
<span class="udiff-line-modified-added">+     auto&amp; registeredProperties = builderState.document().getCSSRegisteredCustomPropertySet();</span>
<span class="udiff-line-modified-added">+     auto&amp; style = builderState.style();</span>
  
      range.consumeWhitespace();
      ASSERT(range.peek().type() == IdentToken);
      String variableName = range.consumeIncludingWhitespace().value().toString();
      ASSERT(range.atEnd() || (range.peek().type() == CommaToken));
  
      // Apply this variable first, in case it is still unresolved
<span class="udiff-line-modified-removed">-     state.styleResolver-&gt;applyCascadedCustomProperty(variableName, state);</span>
<span class="udiff-line-modified-added">+     builderState.builder().applyCustomProperty(variableName);</span>
  
      // Apply fallback to detect cycles
      Vector&lt;CSSParserToken&gt; fallbackResult;
<span class="udiff-line-modified-removed">-     bool fallbackReturn = resolveVariableFallback(CSSParserTokenRange(range), fallbackResult, state);</span>
<span class="udiff-line-modified-added">+     bool fallbackReturn = resolveVariableFallback(CSSParserTokenRange(range), fallbackResult, builderState);</span>
  
      auto* property = style.getCustomProperty(variableName);
  
      if (!property || property-&gt;isUnset()) {
          auto* registered = registeredProperties.get(variableName);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -90,28 +91,28 @@</span>
      result.appendVector(property-&gt;tokens());
  
      return true;
  }
  
<span class="udiff-line-modified-removed">- static bool resolveTokenRange(CSSParserTokenRange range, Vector&lt;CSSParserToken&gt;&amp; result, ApplyCascadedPropertyState&amp; state)</span>
<span class="udiff-line-modified-added">+ static bool resolveTokenRange(CSSParserTokenRange range, Vector&lt;CSSParserToken&gt;&amp; result, Style::BuilderState&amp; builderState)</span>
  {
      bool success = true;
      while (!range.atEnd()) {
          if (range.peek().functionId() == CSSValueVar || range.peek().functionId() == CSSValueEnv)
<span class="udiff-line-modified-removed">-             success &amp;= resolveVariableReference(range.consumeBlock(), result, state);</span>
<span class="udiff-line-modified-added">+             success &amp;= resolveVariableReference(range.consumeBlock(), result, builderState);</span>
          else
              result.append(range.consume());
      }
      return success;
  }
  
<span class="udiff-line-modified-removed">- RefPtr&lt;CSSVariableData&gt; CSSVariableReferenceValue::resolveVariableReferences(ApplyCascadedPropertyState&amp; state) const</span>
<span class="udiff-line-modified-added">+ RefPtr&lt;CSSVariableData&gt; CSSVariableReferenceValue::resolveVariableReferences(Style::BuilderState&amp; builderState) const</span>
  {
      Vector&lt;CSSParserToken&gt; resolvedTokens;
      CSSParserTokenRange range = m_data-&gt;tokenRange();
  
<span class="udiff-line-modified-removed">-     if (!resolveTokenRange(range, resolvedTokens, state))</span>
<span class="udiff-line-modified-added">+     if (!resolveTokenRange(range, resolvedTokens, builderState))</span>
          return nullptr;
  
      return CSSVariableData::create(resolvedTokens);
  }
  
</pre>
<center><a href="CSSValuePool.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CSSVariableReferenceValue.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>