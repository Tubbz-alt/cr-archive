<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/BytecodeDumper.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2017 Yusuke Suzuki &lt;utatane.tea@gmail.com&gt;
  3  * Copyright (C) 2018-2019 Apple Inc. All rights reserved.
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  * 1. Redistributions of source code must retain the above copyright
  9  *    notice, this list of conditions and the following disclaimer.
 10  * 2. Redistributions in binary form must reproduce the above copyright
 11  *    notice, this list of conditions and the following disclaimer in the
 12  *    documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 15  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 16  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 18  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 19  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 20  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 21  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 22  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 23  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 24  * THE POSSIBILITY OF SUCH DAMAGE.
 25  */
 26 
 27 #pragma once
 28 
 29 #include &quot;BytecodeGeneratorBase.h&quot;
 30 #include &quot;CallLinkInfo.h&quot;
 31 #include &quot;ICStatusMap.h&quot;
 32 #include &quot;InstructionStream.h&quot;
 33 #include &quot;StructureStubInfo.h&quot;
 34 
 35 namespace JSC {
 36 
 37 struct Instruction;
 38 
 39 class BytecodeDumperBase {
 40 public:
 41     virtual ~BytecodeDumperBase()
 42     {
 43     }
 44 
 45     void printLocationAndOp(InstructionStream::Offset location, const char* op);
 46 
 47     template&lt;typename T&gt;
 48     void dumpOperand(T operand, bool isFirst = false)
 49     {
 50         if (!isFirst)
 51             m_out.print(&quot;, &quot;);
 52         dumpValue(operand);
 53     }
 54 
 55     void dumpValue(VirtualRegister);
 56 
 57     template&lt;typename Traits&gt;
 58     void dumpValue(GenericBoundLabel&lt;Traits&gt;);
 59 
 60     template&lt;typename T&gt;
 61     void dumpValue(T v) { m_out.print(v); }
 62 
 63 protected:
 64     virtual CString registerName(VirtualRegister) const = 0;
 65     virtual int outOfLineJumpOffset(InstructionStream::Offset) const = 0;
 66 
 67     BytecodeDumperBase(PrintStream&amp; out)
 68         : m_out(out)
 69     {
 70     }
 71 
 72     PrintStream&amp; m_out;
 73     InstructionStream::Offset m_currentLocation { 0 };
 74 };
 75 
 76 template&lt;class Block&gt;
 77 class BytecodeDumper : public BytecodeDumperBase {
 78 public:
 79     static void dumpBytecode(Block*, PrintStream&amp; out, const InstructionStream::Ref&amp; it, const ICStatusMap&amp; = ICStatusMap());
 80 
 81     BytecodeDumper(Block* block, PrintStream&amp; out)
 82         : BytecodeDumperBase(out)
 83         , m_block(block)
 84     {
 85     }
 86 
 87     virtual ~BytecodeDumper() { }
 88 
 89 protected:
 90     Block* block() const { return m_block; }
 91 
 92     void dumpBytecode(const InstructionStream::Ref&amp; it, const ICStatusMap&amp;);
 93 
 94     CString registerName(VirtualRegister) const override;
 95     int outOfLineJumpOffset(InstructionStream::Offset offset) const override;
 96 
 97 private:
 98     virtual CString constantName(VirtualRegister) const;
 99 
100     Block* m_block;
101 };
102 
103 template&lt;class Block&gt;
104 class CodeBlockBytecodeDumper : public BytecodeDumper&lt;Block&gt; {
105 public:
106     static void dumpBlock(Block*, const InstructionStream&amp;, PrintStream&amp; out, const ICStatusMap&amp; = ICStatusMap());
107 
108 private:
109     using BytecodeDumper&lt;Block&gt;::BytecodeDumper;
110 
111     ALWAYS_INLINE VM&amp; vm() const;
112 
113     const Identifier&amp; identifier(int index) const;
114 
115     void dumpIdentifiers();
116     void dumpConstants();
117     void dumpExceptionHandlers();
118     void dumpSwitchJumpTables();
119     void dumpStringSwitchJumpTables();
120 };
121 
122 #if ENABLE(WEBASSEMBLY)
123 
124 namespace Wasm {
125 
126 class FunctionCodeBlock;
127 struct ModuleInformation;
128 enum Type : int8_t;
129 
130 class BytecodeDumper : public JSC::BytecodeDumper&lt;FunctionCodeBlock&gt; {
131 public:
132     static void dumpBlock(FunctionCodeBlock*, const ModuleInformation&amp;, PrintStream&amp; out);
133 
134 private:
135     using JSC::BytecodeDumper&lt;FunctionCodeBlock&gt;::BytecodeDumper;
136 
137     void dumpConstants();
138     CString constantName(VirtualRegister index) const override;
139     CString formatConstant(Type, uint64_t) const;
140 };
141 
142 } // namespace Wasm
143 
144 #endif // ENABLE(WEBASSEMBLY)
145 
146 }
    </pre>
  </body>
</html>