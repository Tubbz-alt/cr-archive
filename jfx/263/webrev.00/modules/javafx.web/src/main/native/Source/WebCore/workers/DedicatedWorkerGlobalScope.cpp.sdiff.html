<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/workers/DedicatedWorkerGlobalScope.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../testing/js/WebCoreTestSupportPrefix.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DedicatedWorkerGlobalScope.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/workers/DedicatedWorkerGlobalScope.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
27  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
28  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
29  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
30  */
31 
32 #include &quot;config.h&quot;
33 #include &quot;DedicatedWorkerGlobalScope.h&quot;
34 
35 #include &quot;ContentSecurityPolicyResponseHeaders.h&quot;
36 #include &quot;DOMWindow.h&quot;
37 #include &quot;DedicatedWorkerThread.h&quot;
38 #include &quot;MessageEvent.h&quot;
39 #include &quot;SecurityOrigin.h&quot;
40 #include &quot;WorkerObjectProxy.h&quot;
41 #include &lt;wtf/IsoMallocInlines.h&gt;
42 
43 namespace WebCore {
44 
45 WTF_MAKE_ISO_ALLOCATED_IMPL(DedicatedWorkerGlobalScope);
46 
<span class="line-modified">47 Ref&lt;DedicatedWorkerGlobalScope&gt; DedicatedWorkerGlobalScope::create(const URL&amp; url, Ref&lt;SecurityOrigin&gt;&amp;&amp; origin, const String&amp; name, const String&amp; identifier, const String&amp; userAgent, bool isOnline, DedicatedWorkerThread&amp; thread, const ContentSecurityPolicyResponseHeaders&amp; contentSecurityPolicyResponseHeaders, bool shouldBypassMainWorldContentSecurityPolicy, Ref&lt;SecurityOrigin&gt;&amp;&amp; topOrigin, MonotonicTime timeOrigin, IDBClient::IDBConnectionProxy* connectionProxy, SocketProvider* socketProvider, PAL::SessionID sessionID)</span>
48 {
<span class="line-modified">49     auto context = adoptRef(*new DedicatedWorkerGlobalScope(url, WTFMove(origin), name, identifier, userAgent, isOnline, thread, shouldBypassMainWorldContentSecurityPolicy, WTFMove(topOrigin), timeOrigin, connectionProxy, socketProvider, sessionID));</span>
<span class="line-modified">50     if (!shouldBypassMainWorldContentSecurityPolicy)</span>
<span class="line-modified">51         context-&gt;applyContentSecurityPolicyResponseHeaders(contentSecurityPolicyResponseHeaders);</span>
52     return context;
53 }
54 
<span class="line-modified">55 DedicatedWorkerGlobalScope::DedicatedWorkerGlobalScope(const URL&amp; url, Ref&lt;SecurityOrigin&gt;&amp;&amp; origin, const String&amp; name, const String&amp; identifier, const String&amp; userAgent, bool isOnline, DedicatedWorkerThread&amp; thread, bool shouldBypassMainWorldContentSecurityPolicy, Ref&lt;SecurityOrigin&gt;&amp;&amp; topOrigin, MonotonicTime timeOrigin, IDBClient::IDBConnectionProxy* connectionProxy, SocketProvider* socketProvider, PAL::SessionID sessionID)</span>
<span class="line-modified">56     : WorkerGlobalScope(url, WTFMove(origin), identifier, userAgent, isOnline, thread, shouldBypassMainWorldContentSecurityPolicy, WTFMove(topOrigin), timeOrigin, connectionProxy, socketProvider, sessionID)</span>
<span class="line-modified">57     , m_name(name)</span>
58 {
59 }
60 
61 DedicatedWorkerGlobalScope::~DedicatedWorkerGlobalScope() = default;
62 
63 EventTargetInterface DedicatedWorkerGlobalScope::eventTargetInterface() const
64 {
65     return DedicatedWorkerGlobalScopeEventTargetInterfaceType;
66 }
67 
<span class="line-modified">68 ExceptionOr&lt;void&gt; DedicatedWorkerGlobalScope::postMessage(JSC::ExecState&amp; state, JSC::JSValue messageValue, Vector&lt;JSC::Strong&lt;JSC::JSObject&gt;&gt;&amp;&amp; transfer)</span>
69 {
70     Vector&lt;RefPtr&lt;MessagePort&gt;&gt; ports;
<span class="line-modified">71     auto message = SerializedScriptValue::create(state, messageValue, WTFMove(transfer), ports, SerializationContext::WorkerPostMessage);</span>
72     if (message.hasException())
73         return message.releaseException();
74 
75     // Disentangle the port in preparation for sending it to the remote context.
76     auto channels = MessagePort::disentanglePorts(WTFMove(ports));
77     if (channels.hasException())
78         return channels.releaseException();
79 
80     thread().workerObjectProxy().postMessageToWorkerObject({ message.releaseReturnValue(), channels.releaseReturnValue() });
81     return { };
82 }
83 
84 ExceptionOr&lt;void&gt; DedicatedWorkerGlobalScope::importScripts(const Vector&lt;String&gt;&amp; urls)
85 {
86     auto result = Base::importScripts(urls);
87     thread().workerObjectProxy().reportPendingActivity(hasPendingActivity());
88     return result;
89 }
90 
91 DedicatedWorkerThread&amp; DedicatedWorkerGlobalScope::thread()
</pre>
</td>
<td>
<hr />
<pre>
27  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
28  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
29  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
30  */
31 
32 #include &quot;config.h&quot;
33 #include &quot;DedicatedWorkerGlobalScope.h&quot;
34 
35 #include &quot;ContentSecurityPolicyResponseHeaders.h&quot;
36 #include &quot;DOMWindow.h&quot;
37 #include &quot;DedicatedWorkerThread.h&quot;
38 #include &quot;MessageEvent.h&quot;
39 #include &quot;SecurityOrigin.h&quot;
40 #include &quot;WorkerObjectProxy.h&quot;
41 #include &lt;wtf/IsoMallocInlines.h&gt;
42 
43 namespace WebCore {
44 
45 WTF_MAKE_ISO_ALLOCATED_IMPL(DedicatedWorkerGlobalScope);
46 
<span class="line-modified">47 Ref&lt;DedicatedWorkerGlobalScope&gt; DedicatedWorkerGlobalScope::create(const WorkerParameters&amp; params, Ref&lt;SecurityOrigin&gt;&amp;&amp; origin, DedicatedWorkerThread&amp; thread, Ref&lt;SecurityOrigin&gt;&amp;&amp; topOrigin, IDBClient::IDBConnectionProxy* connectionProxy, SocketProvider* socketProvider)</span>
48 {
<span class="line-modified">49     auto context = adoptRef(*new DedicatedWorkerGlobalScope(params, WTFMove(origin), thread, WTFMove(topOrigin), connectionProxy, socketProvider));</span>
<span class="line-modified">50     if (!params.shouldBypassMainWorldContentSecurityPolicy)</span>
<span class="line-modified">51         context-&gt;applyContentSecurityPolicyResponseHeaders(params.contentSecurityPolicyResponseHeaders);</span>
52     return context;
53 }
54 
<span class="line-modified">55 DedicatedWorkerGlobalScope::DedicatedWorkerGlobalScope(const WorkerParameters&amp; params, Ref&lt;SecurityOrigin&gt;&amp;&amp; origin, DedicatedWorkerThread&amp; thread, Ref&lt;SecurityOrigin&gt;&amp;&amp; topOrigin, IDBClient::IDBConnectionProxy* connectionProxy, SocketProvider* socketProvider)</span>
<span class="line-modified">56     : WorkerGlobalScope(params, WTFMove(origin), thread, WTFMove(topOrigin), connectionProxy, socketProvider)</span>
<span class="line-modified">57     , m_name(params.name)</span>
58 {
59 }
60 
61 DedicatedWorkerGlobalScope::~DedicatedWorkerGlobalScope() = default;
62 
63 EventTargetInterface DedicatedWorkerGlobalScope::eventTargetInterface() const
64 {
65     return DedicatedWorkerGlobalScopeEventTargetInterfaceType;
66 }
67 
<span class="line-modified">68 ExceptionOr&lt;void&gt; DedicatedWorkerGlobalScope::postMessage(JSC::JSGlobalObject&amp; state, JSC::JSValue messageValue, PostMessageOptions&amp;&amp; options)</span>
69 {
70     Vector&lt;RefPtr&lt;MessagePort&gt;&gt; ports;
<span class="line-modified">71     auto message = SerializedScriptValue::create(state, messageValue, WTFMove(options.transfer), ports, SerializationContext::WorkerPostMessage);</span>
72     if (message.hasException())
73         return message.releaseException();
74 
75     // Disentangle the port in preparation for sending it to the remote context.
76     auto channels = MessagePort::disentanglePorts(WTFMove(ports));
77     if (channels.hasException())
78         return channels.releaseException();
79 
80     thread().workerObjectProxy().postMessageToWorkerObject({ message.releaseReturnValue(), channels.releaseReturnValue() });
81     return { };
82 }
83 
84 ExceptionOr&lt;void&gt; DedicatedWorkerGlobalScope::importScripts(const Vector&lt;String&gt;&amp; urls)
85 {
86     auto result = Base::importScripts(urls);
87     thread().workerObjectProxy().reportPendingActivity(hasPendingActivity());
88     return result;
89 }
90 
91 DedicatedWorkerThread&amp; DedicatedWorkerGlobalScope::thread()
</pre>
</td>
</tr>
</table>
<center><a href="../testing/js/WebCoreTestSupportPrefix.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DedicatedWorkerGlobalScope.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>