<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/b3/air/AirCustom.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AirCustom.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="AirDisassembler.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/b3/air/AirCustom.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 31,10 ***</span>
<span class="line-new-header">--- 31,11 ---</span>
  #include &quot;AirGenerationContext.h&quot;
  #include &quot;AirInst.h&quot;
  #include &quot;AirSpecial.h&quot;
  #include &quot;B3ValueInlines.h&quot;
  #include &quot;B3WasmBoundsCheckValue.h&quot;
<span class="line-added">+ #include &quot;MacroAssembler.h&quot;</span>
  
  namespace JSC { namespace B3 { namespace Air {
  
  // This defines the behavior of custom instructions - i.e. those whose behavior cannot be
  // described using AirOpcode.opcodes. If you define an opcode as &quot;custom Foo&quot; in that file, then
</pre>
<hr />
<pre>
<span class="line-old-header">*** 106,11 ***</span>
      static bool hasNonArgNonControlEffects(Inst&amp; inst)
      {
          return inst.args[0].special()-&gt;hasNonArgNonControlEffects(inst);
      }
  
<span class="line-modified">!     static CCallHelpers::Jump generate(</span>
          Inst&amp; inst, CCallHelpers&amp; jit, GenerationContext&amp; context)
      {
          return inst.args[0].special()-&gt;generate(inst, jit, context);
      }
  };
<span class="line-new-header">--- 107,11 ---</span>
      static bool hasNonArgNonControlEffects(Inst&amp; inst)
      {
          return inst.args[0].special()-&gt;hasNonArgNonControlEffects(inst);
      }
  
<span class="line-modified">!     static MacroAssembler::Jump generate(</span>
          Inst&amp; inst, CCallHelpers&amp; jit, GenerationContext&amp; context)
      {
          return inst.args[0].special()-&gt;generate(inst, jit, context);
      }
  };
</pre>
<hr />
<pre>
<span class="line-old-header">*** 179,11 ***</span>
      {
          return true;
      }
  
      // This just crashes, since we expect C calls to be lowered before generation.
<span class="line-modified">!     static CCallHelpers::Jump generate(Inst&amp;, CCallHelpers&amp;, GenerationContext&amp;);</span>
  };
  
  struct ColdCCallCustom : CCallCustom {
      template&lt;typename Functor&gt;
      static void forEachArg(Inst&amp; inst, const Functor&amp; functor)
<span class="line-new-header">--- 180,11 ---</span>
      {
          return true;
      }
  
      // This just crashes, since we expect C calls to be lowered before generation.
<span class="line-modified">!     static MacroAssembler::Jump generate(Inst&amp;, CCallHelpers&amp;, GenerationContext&amp;);</span>
  };
  
  struct ColdCCallCustom : CCallCustom {
      template&lt;typename Functor&gt;
      static void forEachArg(Inst&amp; inst, const Functor&amp; functor)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 246,11 ***</span>
      static bool hasNonArgNonControlEffects(Inst&amp;)
      {
          return false;
      }
  
<span class="line-modified">!     static CCallHelpers::Jump generate(Inst&amp;, CCallHelpers&amp;, GenerationContext&amp;);</span>
  };
  
  struct EntrySwitchCustom : public CommonCustomBase&lt;EntrySwitchCustom&gt; {
      template&lt;typename Func&gt;
      static void forEachArg(Inst&amp;, const Func&amp;)
<span class="line-new-header">--- 247,11 ---</span>
      static bool hasNonArgNonControlEffects(Inst&amp;)
      {
          return false;
      }
  
<span class="line-modified">!     static MacroAssembler::Jump generate(Inst&amp;, CCallHelpers&amp;, GenerationContext&amp;);</span>
  };
  
  struct EntrySwitchCustom : public CommonCustomBase&lt;EntrySwitchCustom&gt; {
      template&lt;typename Func&gt;
      static void forEachArg(Inst&amp;, const Func&amp;)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 286,16 ***</span>
      static bool hasNonArgNonControlEffects(Inst&amp;)
      {
          return false;
      }
  
<span class="line-modified">!     static CCallHelpers::Jump generate(Inst&amp;, CCallHelpers&amp;, GenerationContext&amp;)</span>
      {
          // This should never be reached because we should have lowered EntrySwitch before
          // generation.
          UNREACHABLE_FOR_PLATFORM();
<span class="line-modified">!         return CCallHelpers::Jump();</span>
      }
  };
  
  struct WasmBoundsCheckCustom : public CommonCustomBase&lt;WasmBoundsCheckCustom&gt; {
      template&lt;typename Func&gt;
<span class="line-new-header">--- 287,16 ---</span>
      static bool hasNonArgNonControlEffects(Inst&amp;)
      {
          return false;
      }
  
<span class="line-modified">!     static MacroAssembler::Jump generate(Inst&amp;, CCallHelpers&amp;, GenerationContext&amp;)</span>
      {
          // This should never be reached because we should have lowered EntrySwitch before
          // generation.
          UNREACHABLE_FOR_PLATFORM();
<span class="line-modified">!         return MacroAssembler::Jump();</span>
      }
  };
  
  struct WasmBoundsCheckCustom : public CommonCustomBase&lt;WasmBoundsCheckCustom&gt; {
      template&lt;typename Func&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 331,32 ***</span>
      static bool hasNonArgNonControlEffects(Inst&amp;)
      {
          return true;
      }
  
<span class="line-modified">!     static CCallHelpers::Jump generate(Inst&amp; inst, CCallHelpers&amp; jit, GenerationContext&amp; context)</span>
<span class="line-removed">-     {</span>
<span class="line-removed">-         WasmBoundsCheckValue* value = inst.origin-&gt;as&lt;WasmBoundsCheckValue&gt;();</span>
<span class="line-removed">-         CCallHelpers::Jump outOfBounds = Inst(Air::Branch64, value, Arg::relCond(CCallHelpers::AboveOrEqual), inst.args[0], inst.args[1]).generate(jit, context);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         context.latePaths.append(createSharedTask&lt;GenerationContext::LatePathFunction&gt;(</span>
<span class="line-removed">-             [outOfBounds, value] (CCallHelpers&amp; jit, Air::GenerationContext&amp; context) {</span>
<span class="line-removed">-                 outOfBounds.link(&amp;jit);</span>
<span class="line-removed">-                 switch (value-&gt;boundsType()) {</span>
<span class="line-removed">-                 case WasmBoundsCheckValue::Type::Pinned:</span>
<span class="line-removed">-                     context.code-&gt;wasmBoundsCheckGenerator()-&gt;run(jit, value-&gt;bounds().pinnedSize);</span>
<span class="line-removed">-                     break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 case WasmBoundsCheckValue::Type::Maximum:</span>
<span class="line-removed">-                     context.code-&gt;wasmBoundsCheckGenerator()-&gt;run(jit, InvalidGPRReg);</span>
<span class="line-removed">-                     break;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }));</span>
<span class="line-removed">- </span>
<span class="line-removed">-         // We said we were not a terminal.</span>
<span class="line-removed">-         return CCallHelpers::Jump();</span>
<span class="line-removed">-     }</span>
  };
  
  } } } // namespace JSC::B3::Air
  
  #endif // ENABLE(B3_JIT)
<span class="line-new-header">--- 332,11 ---</span>
      static bool hasNonArgNonControlEffects(Inst&amp;)
      {
          return true;
      }
  
<span class="line-modified">!     static MacroAssembler::Jump generate(Inst&amp;, CCallHelpers&amp;, GenerationContext&amp;);</span>
  };
  
  } } } // namespace JSC::B3::Air
  
  #endif // ENABLE(B3_JIT)
</pre>
<center><a href="AirCustom.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="AirDisassembler.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>