<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/html/canvas/WebGLProgram.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="WebGLObject.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="WebGLProgram.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/html/canvas/WebGLProgram.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -26,14 +26,15 @@</span>
  #include &quot;config.h&quot;
  #include &quot;WebGLProgram.h&quot;
  
  #if ENABLE(WEBGL)
  
<span class="udiff-line-added">+ #include &quot;InspectorInstrumentation.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;ScriptExecutionContext.h&quot;</span>
  #include &quot;WebGLContextGroup.h&quot;
  #include &quot;WebGLRenderingContextBase.h&quot;
  #include &quot;WebGLShader.h&quot;
<span class="udiff-line-removed">- #include &lt;wtf/HashMap.h&gt;</span>
  #include &lt;wtf/Lock.h&gt;
  #include &lt;wtf/NeverDestroyed.h&gt;
  
  namespace WebCore {
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -58,31 +59,43 @@</span>
      return adoptRef(*new WebGLProgram(ctx));
  }
  
  WebGLProgram::WebGLProgram(WebGLRenderingContextBase&amp; ctx)
      : WebGLSharedObject(ctx)
<span class="udiff-line-added">+     , ContextDestructionObserver(ctx.scriptExecutionContext())</span>
  {
<span class="udiff-line-added">+     ASSERT(scriptExecutionContext());</span>
<span class="udiff-line-added">+ </span>
      {
          LockHolder lock(instancesMutex());
          instances(lock).add(this, &amp;ctx);
      }
  
<span class="udiff-line-modified-removed">-     setObject(ctx.graphicsContext3D()-&gt;createProgram());</span>
<span class="udiff-line-modified-added">+     setObject(ctx.graphicsContextGL()-&gt;createProgram());</span>
  }
  
  WebGLProgram::~WebGLProgram()
  {
<span class="udiff-line-added">+     InspectorInstrumentation::willDestroyWebGLProgram(*this);</span>
<span class="udiff-line-added">+ </span>
      deleteObject(0);
  
      {
          LockHolder lock(instancesMutex());
          ASSERT(instances(lock).contains(this));
          instances(lock).remove(this);
      }
  }
  
<span class="udiff-line-modified-removed">- void WebGLProgram::deleteObjectImpl(GraphicsContext3D* context3d, Platform3DObject obj)</span>
<span class="udiff-line-modified-added">+ void WebGLProgram::contextDestroyed()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     InspectorInstrumentation::willDestroyWebGLProgram(*this);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ContextDestructionObserver::contextDestroyed();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void WebGLProgram::deleteObjectImpl(GraphicsContextGLOpenGL* context3d, PlatformGLObject obj)</span>
  {
      context3d-&gt;deleteProgram(obj);
      if (m_vertexShader) {
          m_vertexShader-&gt;onDetached(context3d);
          m_vertexShader = nullptr;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -97,11 +110,11 @@</span>
  {
      cacheInfoIfNeeded();
      return m_activeAttribLocations.size();
  }
  
<span class="udiff-line-modified-removed">- GC3Dint WebGLProgram::getActiveAttribLocation(GC3Duint index)</span>
<span class="udiff-line-modified-added">+ GCGLint WebGLProgram::getActiveAttribLocation(GCGLuint index)</span>
  {
      cacheInfoIfNeeded();
      if (index &gt;= numActiveAttribLocations())
          return -1;
      return m_activeAttribLocations[index];
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -133,16 +146,16 @@</span>
  {
      ++m_linkCount;
      m_infoValid = false;
  }
  
<span class="udiff-line-modified-removed">- WebGLShader* WebGLProgram::getAttachedShader(GC3Denum type)</span>
<span class="udiff-line-modified-added">+ WebGLShader* WebGLProgram::getAttachedShader(GCGLenum type)</span>
  {
      switch (type) {
<span class="udiff-line-modified-removed">-     case GraphicsContext3D::VERTEX_SHADER:</span>
<span class="udiff-line-modified-added">+     case GraphicsContextGL::VERTEX_SHADER:</span>
          return m_vertexShader.get();
<span class="udiff-line-modified-removed">-     case GraphicsContext3D::FRAGMENT_SHADER:</span>
<span class="udiff-line-modified-added">+     case GraphicsContextGL::FRAGMENT_SHADER:</span>
          return m_fragmentShader.get();
      default:
          return 0;
      }
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -150,16 +163,16 @@</span>
  bool WebGLProgram::attachShader(WebGLShader* shader)
  {
      if (!shader || !shader-&gt;object())
          return false;
      switch (shader-&gt;getType()) {
<span class="udiff-line-modified-removed">-     case GraphicsContext3D::VERTEX_SHADER:</span>
<span class="udiff-line-modified-added">+     case GraphicsContextGL::VERTEX_SHADER:</span>
          if (m_vertexShader)
              return false;
          m_vertexShader = shader;
          return true;
<span class="udiff-line-modified-removed">-     case GraphicsContext3D::FRAGMENT_SHADER:</span>
<span class="udiff-line-modified-added">+     case GraphicsContextGL::FRAGMENT_SHADER:</span>
          if (m_fragmentShader)
              return false;
          m_fragmentShader = shader;
          return true;
      default:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -170,34 +183,34 @@</span>
  bool WebGLProgram::detachShader(WebGLShader* shader)
  {
      if (!shader || !shader-&gt;object())
          return false;
      switch (shader-&gt;getType()) {
<span class="udiff-line-modified-removed">-     case GraphicsContext3D::VERTEX_SHADER:</span>
<span class="udiff-line-modified-added">+     case GraphicsContextGL::VERTEX_SHADER:</span>
          if (m_vertexShader != shader)
              return false;
          m_vertexShader = nullptr;
          return true;
<span class="udiff-line-modified-removed">-     case GraphicsContext3D::FRAGMENT_SHADER:</span>
<span class="udiff-line-modified-added">+     case GraphicsContextGL::FRAGMENT_SHADER:</span>
          if (m_fragmentShader != shader)
              return false;
          m_fragmentShader = nullptr;
          return true;
      default:
          return false;
      }
  }
  
<span class="udiff-line-modified-removed">- void WebGLProgram::cacheActiveAttribLocations(GraphicsContext3D* context3d)</span>
<span class="udiff-line-modified-added">+ void WebGLProgram::cacheActiveAttribLocations(GraphicsContextGLOpenGL* context3d)</span>
  {
      m_activeAttribLocations.clear();
  
<span class="udiff-line-modified-removed">-     GC3Dint numAttribs = 0;</span>
<span class="udiff-line-modified-removed">-     context3d-&gt;getProgramiv(object(), GraphicsContext3D::ACTIVE_ATTRIBUTES, &amp;numAttribs);</span>
<span class="udiff-line-modified-added">+     GCGLint numAttribs = 0;</span>
<span class="udiff-line-modified-added">+     context3d-&gt;getProgramiv(object(), GraphicsContextGL::ACTIVE_ATTRIBUTES, &amp;numAttribs);</span>
      m_activeAttribLocations.resize(static_cast&lt;size_t&gt;(numAttribs));
      for (int i = 0; i &lt; numAttribs; ++i) {
<span class="udiff-line-modified-removed">-         ActiveInfo info;</span>
<span class="udiff-line-modified-added">+         GraphicsContextGL::ActiveInfo info;</span>
          context3d-&gt;getActiveAttribImpl(object(), i, info);
          m_activeAttribLocations[i] = context3d-&gt;getAttribLocation(object(), info.name);
      }
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -207,15 +220,15 @@</span>
          return;
  
      if (!object())
          return;
  
<span class="udiff-line-modified-removed">-     GraphicsContext3D* context = getAGraphicsContext3D();</span>
<span class="udiff-line-modified-added">+     GraphicsContextGLOpenGL* context = getAGraphicsContextGL();</span>
      if (!context)
          return;
<span class="udiff-line-modified-removed">-     GC3Dint linkStatus = 0;</span>
<span class="udiff-line-modified-removed">-     context-&gt;getProgramiv(object(), GraphicsContext3D::LINK_STATUS, &amp;linkStatus);</span>
<span class="udiff-line-modified-added">+     GCGLint linkStatus = 0;</span>
<span class="udiff-line-modified-added">+     context-&gt;getProgramiv(object(), GraphicsContextGL::LINK_STATUS, &amp;linkStatus);</span>
      m_linkStatus = linkStatus;
      if (m_linkStatus)
          cacheActiveAttribLocations(context);
      m_infoValid = true;
  }
</pre>
<center><a href="WebGLObject.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="WebGLProgram.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>