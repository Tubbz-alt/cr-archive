<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGDesiredWatchpoints.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DFGDesiredTransitions.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGDesiredWatchpoints.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGDesiredWatchpoints.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -26,57 +26,80 @@</span>
  #include &quot;config.h&quot;
  #include &quot;DFGDesiredWatchpoints.h&quot;
  
  #if ENABLE(DFG_JIT)
  
<span class="udiff-line-removed">- #include &quot;ArrayBufferNeuteringWatchpointSet.h&quot;</span>
  #include &quot;CodeBlock.h&quot;
  #include &quot;DFGGraph.h&quot;
  #include &quot;JSCInlines.h&quot;
  
  namespace JSC { namespace DFG {
  
  void ArrayBufferViewWatchpointAdaptor::add(
      CodeBlock* codeBlock, JSArrayBufferView* view, CommonData&amp; common)
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = codeBlock-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     Watchpoint* watchpoint = common.watchpoints.add(codeBlock);</span>
<span class="udiff-line-modified-removed">-     ArrayBufferNeuteringWatchpointSet* neuteringWatchpoint =</span>
<span class="udiff-line-modified-removed">-         ArrayBufferNeuteringWatchpointSet::create(vm);</span>
<span class="udiff-line-modified-removed">-     neuteringWatchpoint-&gt;set().add(watchpoint);</span>
<span class="udiff-line-modified-removed">-     codeBlock-&gt;addConstant(neuteringWatchpoint);</span>
<span class="udiff-line-modified-added">+     // view is already frozen. If it is deallocated, jettisoning happens.</span>
<span class="udiff-line-modified-added">+     CodeBlockJettisoningWatchpoint* watchpoint = nullptr;</span>
<span class="udiff-line-modified-added">+     {</span>
<span class="udiff-line-modified-added">+         ConcurrentJSLocker locker(codeBlock-&gt;m_lock);</span>
<span class="udiff-line-modified-added">+         watchpoint = common.watchpoints.add(codeBlock);</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-added">+     ArrayBuffer* arrayBuffer = view-&gt;possiblySharedBuffer();</span>
<span class="udiff-line-added">+     RELEASE_ASSERT(arrayBuffer);</span>
      // FIXME: We don&#39;t need to set this watchpoint at all for shared buffers.
      // https://bugs.webkit.org/show_bug.cgi?id=164108
<span class="udiff-line-modified-removed">-     vm.heap.addReference(neuteringWatchpoint, view-&gt;possiblySharedBuffer());</span>
<span class="udiff-line-modified-added">+     arrayBuffer-&gt;neuteringWatchpointSet().add(WTFMove(watchpoint));</span>
  }
  
  void SymbolTableAdaptor::add(
      CodeBlock* codeBlock, SymbolTable* symbolTable, CommonData&amp; common)
  {
<span class="udiff-line-modified-removed">-     codeBlock-&gt;addConstant(symbolTable); // For common users, it doesn&#39;t really matter if it&#39;s weak or not. If references to it go away, we go away, too.</span>
<span class="udiff-line-modified-removed">-     symbolTable-&gt;singleton().add(common.watchpoints.add(codeBlock));</span>
<span class="udiff-line-modified-added">+     codeBlock-&gt;addConstant(ConcurrentJSLocker(codeBlock-&gt;m_lock), symbolTable); // For common users, it doesn&#39;t really matter if it&#39;s weak or not. If references to it go away, we go away, too.</span>
<span class="udiff-line-modified-added">+     CodeBlockJettisoningWatchpoint* watchpoint = nullptr;</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         ConcurrentJSLocker locker(codeBlock-&gt;m_lock);</span>
<span class="udiff-line-added">+         watchpoint = common.watchpoints.add(codeBlock);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     symbolTable-&gt;singleton().add(WTFMove(watchpoint));</span>
  }
  
  void FunctionExecutableAdaptor::add(
      CodeBlock* codeBlock, FunctionExecutable* executable, CommonData&amp; common)
  {
<span class="udiff-line-modified-removed">-     codeBlock-&gt;addConstant(executable); // For common users, it doesn&#39;t really matter if it&#39;s weak or not. If references to it go away, we go away, too.</span>
<span class="udiff-line-modified-removed">-     executable-&gt;singleton().add(common.watchpoints.add(codeBlock));</span>
<span class="udiff-line-modified-added">+     codeBlock-&gt;addConstant(ConcurrentJSLocker(codeBlock-&gt;m_lock), executable); // For common users, it doesn&#39;t really matter if it&#39;s weak or not. If references to it go away, we go away, too.</span>
<span class="udiff-line-modified-added">+     CodeBlockJettisoningWatchpoint* watchpoint = nullptr;</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         ConcurrentJSLocker locker(codeBlock-&gt;m_lock);</span>
<span class="udiff-line-added">+         watchpoint = common.watchpoints.add(codeBlock);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     executable-&gt;singleton().add(WTFMove(watchpoint));</span>
  }
  
  void AdaptiveStructureWatchpointAdaptor::add(
      CodeBlock* codeBlock, const ObjectPropertyCondition&amp; key, CommonData&amp; common)
  {
      VM&amp; vm = codeBlock-&gt;vm();
      switch (key.kind()) {
<span class="udiff-line-modified-removed">-     case PropertyCondition::Equivalence:</span>
<span class="udiff-line-modified-removed">-         common.adaptiveInferredPropertyValueWatchpoints.add(key, codeBlock)-&gt;install(vm);</span>
<span class="udiff-line-modified-added">+     case PropertyCondition::Equivalence: {</span>
<span class="udiff-line-modified-added">+         AdaptiveInferredPropertyValueWatchpoint* watchpoint = nullptr;</span>
<span class="udiff-line-added">+         {</span>
<span class="udiff-line-added">+             ConcurrentJSLocker locker(codeBlock-&gt;m_lock);</span>
<span class="udiff-line-added">+             watchpoint = common.adaptiveInferredPropertyValueWatchpoints.add(key, codeBlock);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         watchpoint-&gt;install(vm);</span>
          break;
<span class="udiff-line-modified-removed">-     default:</span>
<span class="udiff-line-modified-removed">-         common.adaptiveStructureWatchpoints.add(key, codeBlock)-&gt;install(vm);</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+     default: {</span>
<span class="udiff-line-added">+         AdaptiveStructureWatchpoint* watchpoint = nullptr;</span>
<span class="udiff-line-added">+         {</span>
<span class="udiff-line-added">+             ConcurrentJSLocker locker(codeBlock-&gt;m_lock);</span>
<span class="udiff-line-added">+             watchpoint = common.adaptiveStructureWatchpoints.add(key, codeBlock);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         watchpoint-&gt;install(vm);</span>
          break;
      }
<span class="udiff-line-added">+     }</span>
  }
  
  DesiredWatchpoints::DesiredWatchpoints() { }
  DesiredWatchpoints::~DesiredWatchpoints() { }
  
</pre>
<center><a href="DFGDesiredTransitions.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGDesiredWatchpoints.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>