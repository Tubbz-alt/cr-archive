<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/PropertyDescriptor.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ProgramExecutable.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PropertyDescriptor.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/PropertyDescriptor.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2009, 2016 Apple Inc. All rights reserved.</span>
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
</pre>
<hr />
<pre>
 55 {
 56     return m_value || (m_seenAttributes &amp; WritablePresent);
 57 }
 58 
 59 bool PropertyDescriptor::isGenericDescriptor() const
 60 {
 61     return !isAccessorDescriptor() &amp;&amp; !isDataDescriptor();
 62 }
 63 
 64 bool PropertyDescriptor::isAccessorDescriptor() const
 65 {
 66     return m_getter || m_setter;
 67 }
 68 
 69 void PropertyDescriptor::setUndefined()
 70 {
 71     m_value = jsUndefined();
 72     m_attributes = PropertyAttribute::ReadOnly | PropertyAttribute::DontDelete | PropertyAttribute::DontEnum;
 73 }
 74 
<span class="line-modified"> 75 GetterSetter* PropertyDescriptor::slowGetterSetter(ExecState* exec)</span>
 76 {
<span class="line-modified"> 77     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-removed"> 78     JSGlobalObject* globalObject = exec-&gt;lexicalGlobalObject();</span>
 79     JSValue getter = m_getter &amp;&amp; !m_getter.isUndefined() ? jsCast&lt;JSObject*&gt;(m_getter) : jsUndefined();
 80     JSValue setter = m_setter &amp;&amp; !m_setter.isUndefined() ? jsCast&lt;JSObject*&gt;(m_setter) : jsUndefined();
 81     return GetterSetter::create(vm, globalObject, getter, setter);
 82 }
 83 
 84 JSValue PropertyDescriptor::getter() const
 85 {
 86     ASSERT(isAccessorDescriptor());
 87     return m_getter;
 88 }
 89 
 90 JSValue PropertyDescriptor::setter() const
 91 {
 92     ASSERT(isAccessorDescriptor());
 93     return m_setter;
 94 }
 95 
 96 JSObject* PropertyDescriptor::getterObject() const
 97 {
 98     ASSERT(isAccessorDescriptor() &amp;&amp; getterPresent());
</pre>
<hr />
<pre>
176         m_attributes &amp;= ~PropertyAttribute::DontDelete;
177     else
178         m_attributes |= PropertyAttribute::DontDelete;
179     m_seenAttributes |= ConfigurablePresent;
180 }
181 
182 void PropertyDescriptor::setSetter(JSValue setter)
183 {
184     m_setter = setter;
185     m_attributes |= PropertyAttribute::Accessor;
186     m_attributes &amp;= ~PropertyAttribute::ReadOnly;
187 }
188 
189 void PropertyDescriptor::setGetter(JSValue getter)
190 {
191     m_getter = getter;
192     m_attributes |= PropertyAttribute::Accessor;
193     m_attributes &amp;= ~PropertyAttribute::ReadOnly;
194 }
195 
<span class="line-modified">196 bool PropertyDescriptor::equalTo(ExecState* exec, const PropertyDescriptor&amp; other) const</span>
197 {


198     if (other.m_value.isEmpty() != m_value.isEmpty()
199         || other.m_getter.isEmpty() != m_getter.isEmpty()
200         || other.m_setter.isEmpty() != m_setter.isEmpty())
201         return false;
<span class="line-modified">202     return (!m_value || sameValue(exec, other.m_value, m_value))</span>
<span class="line-modified">203         &amp;&amp; (!m_getter || JSValue::strictEqual(exec, other.m_getter, m_getter))</span>
<span class="line-modified">204         &amp;&amp; (!m_setter || JSValue::strictEqual(exec, other.m_setter, m_setter))</span>





205         &amp;&amp; attributesEqual(other);
206 }
207 
208 bool PropertyDescriptor::attributesEqual(const PropertyDescriptor&amp; other) const
209 {
210     unsigned mismatch = other.m_attributes ^ m_attributes;
211     unsigned sharedSeen = other.m_seenAttributes &amp; m_seenAttributes;
212     if (sharedSeen &amp; WritablePresent &amp;&amp; mismatch &amp; PropertyAttribute::ReadOnly)
213         return false;
214     if (sharedSeen &amp; ConfigurablePresent &amp;&amp; mismatch &amp; PropertyAttribute::DontDelete)
215         return false;
216     if (sharedSeen &amp; EnumerablePresent &amp;&amp; mismatch &amp; PropertyAttribute::DontEnum)
217         return false;
218     return true;
219 }
220 
221 unsigned PropertyDescriptor::attributesOverridingCurrent(const PropertyDescriptor&amp; current) const
222 {
223     unsigned currentAttributes = current.m_attributes;
224     if (isDataDescriptor() &amp;&amp; current.isAccessorDescriptor())
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2009-2019 Apple Inc. All rights reserved.</span>
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
</pre>
<hr />
<pre>
 55 {
 56     return m_value || (m_seenAttributes &amp; WritablePresent);
 57 }
 58 
 59 bool PropertyDescriptor::isGenericDescriptor() const
 60 {
 61     return !isAccessorDescriptor() &amp;&amp; !isDataDescriptor();
 62 }
 63 
 64 bool PropertyDescriptor::isAccessorDescriptor() const
 65 {
 66     return m_getter || m_setter;
 67 }
 68 
 69 void PropertyDescriptor::setUndefined()
 70 {
 71     m_value = jsUndefined();
 72     m_attributes = PropertyAttribute::ReadOnly | PropertyAttribute::DontDelete | PropertyAttribute::DontEnum;
 73 }
 74 
<span class="line-modified"> 75 GetterSetter* PropertyDescriptor::slowGetterSetter(JSGlobalObject* globalObject)</span>
 76 {
<span class="line-modified"> 77     VM&amp; vm = globalObject-&gt;vm();</span>

 78     JSValue getter = m_getter &amp;&amp; !m_getter.isUndefined() ? jsCast&lt;JSObject*&gt;(m_getter) : jsUndefined();
 79     JSValue setter = m_setter &amp;&amp; !m_setter.isUndefined() ? jsCast&lt;JSObject*&gt;(m_setter) : jsUndefined();
 80     return GetterSetter::create(vm, globalObject, getter, setter);
 81 }
 82 
 83 JSValue PropertyDescriptor::getter() const
 84 {
 85     ASSERT(isAccessorDescriptor());
 86     return m_getter;
 87 }
 88 
 89 JSValue PropertyDescriptor::setter() const
 90 {
 91     ASSERT(isAccessorDescriptor());
 92     return m_setter;
 93 }
 94 
 95 JSObject* PropertyDescriptor::getterObject() const
 96 {
 97     ASSERT(isAccessorDescriptor() &amp;&amp; getterPresent());
</pre>
<hr />
<pre>
175         m_attributes &amp;= ~PropertyAttribute::DontDelete;
176     else
177         m_attributes |= PropertyAttribute::DontDelete;
178     m_seenAttributes |= ConfigurablePresent;
179 }
180 
181 void PropertyDescriptor::setSetter(JSValue setter)
182 {
183     m_setter = setter;
184     m_attributes |= PropertyAttribute::Accessor;
185     m_attributes &amp;= ~PropertyAttribute::ReadOnly;
186 }
187 
188 void PropertyDescriptor::setGetter(JSValue getter)
189 {
190     m_getter = getter;
191     m_attributes |= PropertyAttribute::Accessor;
192     m_attributes &amp;= ~PropertyAttribute::ReadOnly;
193 }
194 
<span class="line-modified">195 bool PropertyDescriptor::equalTo(JSGlobalObject* globalObject, const PropertyDescriptor&amp; other) const</span>
196 {
<span class="line-added">197     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-added">198     auto scope = DECLARE_THROW_SCOPE(vm);</span>
199     if (other.m_value.isEmpty() != m_value.isEmpty()
200         || other.m_getter.isEmpty() != m_getter.isEmpty()
201         || other.m_setter.isEmpty() != m_setter.isEmpty())
202         return false;
<span class="line-modified">203     if (m_value) {</span>
<span class="line-modified">204         bool isSame = sameValue(globalObject, other.m_value, m_value);</span>
<span class="line-modified">205         RETURN_IF_EXCEPTION(scope, false);</span>
<span class="line-added">206         if (!isSame)</span>
<span class="line-added">207             return false;</span>
<span class="line-added">208     }</span>
<span class="line-added">209     return (!m_getter || JSValue::strictEqual(globalObject, other.m_getter, m_getter))</span>
<span class="line-added">210         &amp;&amp; (!m_setter || JSValue::strictEqual(globalObject, other.m_setter, m_setter))</span>
211         &amp;&amp; attributesEqual(other);
212 }
213 
214 bool PropertyDescriptor::attributesEqual(const PropertyDescriptor&amp; other) const
215 {
216     unsigned mismatch = other.m_attributes ^ m_attributes;
217     unsigned sharedSeen = other.m_seenAttributes &amp; m_seenAttributes;
218     if (sharedSeen &amp; WritablePresent &amp;&amp; mismatch &amp; PropertyAttribute::ReadOnly)
219         return false;
220     if (sharedSeen &amp; ConfigurablePresent &amp;&amp; mismatch &amp; PropertyAttribute::DontDelete)
221         return false;
222     if (sharedSeen &amp; EnumerablePresent &amp;&amp; mismatch &amp; PropertyAttribute::DontEnum)
223         return false;
224     return true;
225 }
226 
227 unsigned PropertyDescriptor::attributesOverridingCurrent(const PropertyDescriptor&amp; current) const
228 {
229     unsigned currentAttributes = current.m_attributes;
230     if (isDataDescriptor() &amp;&amp; current.isAccessorDescriptor())
</pre>
</td>
</tr>
</table>
<center><a href="ProgramExecutable.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PropertyDescriptor.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>