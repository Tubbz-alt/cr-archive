<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/java/com/sun/javafx/webkit/drt/UIClientImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package com.sun.javafx.webkit.drt;
 27 
 28 import com.sun.webkit.LoadListenerClient;
 29 import com.sun.webkit.UIClient;
 30 import com.sun.webkit.WebPage;
 31 import com.sun.webkit.graphics.WCImage;
 32 import com.sun.webkit.graphics.WCRectangle;
 33 
 34 import java.io.File;
 35 import java.util.ArrayList;
 36 import java.util.Iterator;
 37 import java.util.List;
 38 
 39 /**
 40  * {@link UIClient} implementation for DRT tests.
 41  */
 42 final class UIClientImpl implements UIClient {
 43 
 44     private WebPage webPage;
 45     private final List&lt;UIClient&gt; clients = new ArrayList&lt;UIClient&gt;();
 46 
 47     private WCRectangle bounds = new WCRectangle(0, 0, 800, 600);
 48 
 49     UIClientImpl() {
 50     }
 51 
 52     void setWebPage(WebPage webPage) {
 53         this.webPage = webPage;
 54     }
 55 
 56     /**
 57      * {@inheritDoc}
 58      */
 59     @Override
 60     public WebPage createPage(boolean menu, boolean status, boolean toolbar,
 61             boolean resizable)
 62     {
 63         UIClientImpl client = new UIClientImpl();
 64         final WebPage page = new WebPage(null, client, null, null, new DumpRenderTree.ThemeClientImplStub(), false);
 65         client.setWebPage(page);
 66 
 67         page.setBounds(0, 0, 800, 600);
 68 //        webPage.setUsePageCache(true);
 69 
 70         page.addLoadListenerClient(new LoadListenerClient() {
 71             @Override
 72             public void dispatchLoadEvent(long frame, int state, String url, String contentType, double progress, int errorCode) {
 73                 if (state == DOCUMENT_AVAILABLE) {
 74                     DumpRenderTree.drt.dumpUnloadListeners(page, frame);
 75                 }
 76             }
 77             @Override
 78             public void dispatchResourceLoadEvent(long frame, int state, String url, String contentType, double progress, int errorCode) {
 79             }
 80         });
 81 
 82         page.resetToConsistentStateBeforeTesting();
 83 
 84         // This call is needed to add the main frame to WebPage.frames list.
 85         // TODO: investigate why it&#39;s not added automatically (via WebPage.fwkFrameCreated) and fix.
 86         page.getMainFrame();
 87 
 88         clients.add(client);
 89         return client.webPage;
 90     }
 91 
 92     /**
 93      * {@inheritDoc}
 94      */
 95     @Override
 96     public void closePage() {
 97         Iterator&lt;UIClient&gt; it = clients.iterator();
 98         while (it.hasNext()) {
 99             it.next().closePage();
100             it.remove();
101         }
102         if (webPage.getMainFrame() != 0) {
103             webPage.dispose();
104         }
105     }
106 
107     /**
108      * {@inheritDoc}
109      */
110     @Override
111     public void showView() {
112         // look, I&#39;m showing!
113     }
114 
115     /**
116      * {@inheritDoc}
117      */
118     @Override
119     public WCRectangle getViewBounds() {
120         return bounds;
121     }
122 
123     /**
124      * {@inheritDoc}
125      */
126     @Override
127     public void setViewBounds(WCRectangle bounds) {
128         this.bounds = bounds;
129     }
130 
131     /**
132      * {@inheritDoc}
133      */
134     @Override
135     public void setStatusbarText(String text) {
136     }
137 
138     /**
139      * {@inheritDoc}
140      */
141     @Override
142     public void alert(String text) {
143         if (!DumpRenderTree.drt.complete()) {
144             DumpRenderTree.out.printf(&quot;ALERT: %s\n&quot;, text);
145         }
146     }
147 
148     /**
149      * {@inheritDoc}
150      */
151     @Override
152     public boolean confirm(String text) {
153         if (!DumpRenderTree.drt.complete()) {
154             DumpRenderTree.out.printf(&quot;CONFIRM: %s\n&quot;, text);
155         }
156         return false;
157     }
158 
159     /**
160      * {@inheritDoc}
161      */
162     @Override
163     public String prompt(String text, String defaultValue) {
164         if (!DumpRenderTree.drt.complete()) {
165             DumpRenderTree.out.printf(&quot;PROMPT: %s, default text: %s\n&quot;, text, defaultValue);
166         }
167         return defaultValue;
168     }
169 
170     @Override
171     public boolean canRunBeforeUnloadConfirmPanel() {
172         return true;
173     }
174 
175     @Override
176     public boolean runBeforeUnloadConfirmPanel(String message) {
177         if (!DumpRenderTree.drt.complete()) {
178             DumpRenderTree.out.printf(&quot;CONFIRM NAVIGATION: %s\n&quot;, message);
179         }
180         return !DumpRenderTree.drt.shouldStayOnPageAfterHandlingBeforeUnload();
181     }
182 
183     /**
184      * {@inheritDoc}
185      */
186     @Override
187     public String[] chooseFile(String initialFileName, boolean multiple, String mimeFilters) {
188         if (DumpRenderTree.drt.complete()) {
189             return null;
190         }
191         DumpRenderTree.out.printf(&quot;OPEN FILE PANEL\n&quot;);
192         String[] openPanelFiles = DumpRenderTree.drt.openPanelFiles();
193         if (openPanelFiles == null || openPanelFiles.length == 0) {
194             return null;
195         }
196 
197         final File testURLFile = new File(DumpRenderTree.drt.getTestURL());
198         String testURLFileParent = testURLFile.getParent();
199         if (multiple) {
200             String[] result = new String[openPanelFiles.length];
201             for (int i = 0; i &lt; openPanelFiles.length; i++) {
202                 result[i] = new File(testURLFileParent, openPanelFiles[i]).getAbsolutePath();
203             }
204             return result;
205         } else {
206             return new String[] { new File(testURLFileParent, openPanelFiles[0]).getAbsolutePath() };
207         }
208     }
209 
210     /**
211      * {@inheritDoc}
212      */
213     @Override
214     public void print() {
215         throw new UnsupportedOperationException(&quot;Not supported yet&quot;);
216     }
217 
218     /**
219      * {@inheritDoc}
220      */
221     @Override
222     public void startDrag(WCImage frame, int imageOffsetX, int imageOffsetY,
223             int eventPosX, int eventPosY, String[] mimeTypes, Object[] values, boolean isImageSource)
224     {
225         throw new UnsupportedOperationException(&quot;Not supported yet&quot;);
226     }
227 
228     /**
229      * {@inheritDoc}
230      */
231     @Override
232     public void confirmStartDrag() {
233         throw new UnsupportedOperationException(&quot;Not supported yet.&quot;);
234     }
235 
236     /**
237      * {@inheritDoc}
238      */
239     @Override
240     public boolean isDragConfirmed() {
241         return false;
242     }
243 }
    </pre>
  </body>
</html>