<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff tests/system/src/test/java/test/javafx/scene/web/HTMLEditorTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../../modules/javafx.web/src/main/java/javafx/scene/web/HTMLEditorSkin.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>tests/system/src/test/java/test/javafx/scene/web/HTMLEditorTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,10 +23,11 @@</span>
   * questions.
   */
  
  package test.javafx.scene.web;
  
<span class="udiff-line-added">+ import com.sun.javafx.PlatformUtil;</span>
  import java.util.concurrent.atomic.AtomicReference;
  import java.util.concurrent.CountDownLatch;
  import java.util.concurrent.TimeUnit;
  import javafx.application.Application;
  import javafx.application.Platform;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -43,10 +44,12 @@</span>
  import org.junit.AfterClass;
  import org.junit.Before;
  import org.junit.BeforeClass;
  import org.junit.Ignore;
  import org.junit.Test;
<span class="udiff-line-added">+ import test.com.sun.javafx.scene.control.infrastructure.KeyEventFirer;</span>
<span class="udiff-line-added">+ import test.com.sun.javafx.scene.control.infrastructure.KeyModifier;</span>
  import test.util.Util;
  
  import static javafx.concurrent.Worker.State.SUCCEEDED;
  import static org.junit.Assert.assertEquals;
  import static org.junit.Assert.assertNotNull;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -58,10 +61,11 @@</span>
      // Maintain one application instance
      static HTMLEditorTestApp htmlEditorTestApp;
  
      private HTMLEditor htmlEditor;
      private WebView webView;
<span class="udiff-line-added">+     private Scene scene;</span>
  
      public static class HTMLEditorTestApp extends Application {
          Stage primaryStage = null;
  
          public HTMLEditorTestApp() {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -103,11 +107,11 @@</span>
  
      @Before
      public void setupTestObjects() {
          Platform.runLater(() -&gt; {
              htmlEditor = new HTMLEditor();
<span class="udiff-line-modified-removed">-             Scene scene = new Scene(htmlEditor);</span>
<span class="udiff-line-modified-added">+             scene = new Scene(htmlEditor);</span>
              htmlEditorTestApp.primaryStage.setScene(scene);
              htmlEditorTestApp.primaryStage.show();
  
              webView = (WebView) htmlEditor.lookup(&quot;.web-view&quot;);
              assertNotNull(webView);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -352,6 +356,110 @@</span>
          assertTrue(&quot;Timeout when waiting for focus change &quot;, Util.await(editorStateLatch));
          assertNotNull(&quot;result must have a valid reference &quot;, result.get());
          assertTrue(&quot;font-family must be &#39;WebKit Layout Test 2&#39; &quot;, result.get().
              contains(&quot;font-family: &amp;quot;WebKit Layout Tests 2&amp;quot;&quot;));
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * @test</span>
<span class="udiff-line-added">+      * @bug 8230809</span>
<span class="udiff-line-added">+      * Summary HTMLEditor formatting lost when selecting all (CTRL-A)</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     @Test</span>
<span class="udiff-line-added">+     public void checkFontSizeOnSelectAll_ctrl_A() throws Exception {</span>
<span class="udiff-line-added">+         final CountDownLatch editorStateLatch = new CountDownLatch(1);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         final String editorCommand1 =</span>
<span class="udiff-line-added">+             &quot;document.execCommand(&#39;fontSize&#39;, false, &#39;7&#39;);&quot; +</span>
<span class="udiff-line-added">+             &quot;document.execCommand(&#39;insertText&#39;, false, &#39;First_word &#39;);&quot;;</span>
<span class="udiff-line-added">+         final String editorCommand2 =</span>
<span class="udiff-line-added">+             &quot;document.execCommand(&#39;fontSize&#39;, false, &#39;1&#39;);&quot; +</span>
<span class="udiff-line-added">+             &quot;document.execCommand(&#39;insertText&#39;, false, &#39;Second_word&#39;);&quot;;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         Util.runAndWait(() -&gt; {</span>
<span class="udiff-line-added">+             webView.getEngine().getLoadWorker().stateProperty().</span>
<span class="udiff-line-added">+                 addListener((observable, oldValue, newValue) -&gt; {</span>
<span class="udiff-line-added">+                 if (newValue == SUCCEEDED) {</span>
<span class="udiff-line-added">+                     htmlEditor.requestFocus();</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             });</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             htmlEditor.setHtmlText(htmlEditor.getHtmlText());</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             webView.focusedProperty().addListener((observable, oldValue, newValue) -&gt; {</span>
<span class="udiff-line-added">+                 if (newValue) {</span>
<span class="udiff-line-added">+                     webView.getEngine().executeScript(&quot;document.body.focus();&quot;);</span>
<span class="udiff-line-added">+                     webView.getEngine().executeScript(editorCommand1);</span>
<span class="udiff-line-added">+                     webView.getEngine().executeScript(editorCommand2);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                     editorStateLatch.countDown();</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             });</span>
<span class="udiff-line-added">+         });</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         assertTrue(&quot;Timeout while waiting for test html text setup&quot;, Util.await(editorStateLatch));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         String expectedHtmlText = htmlEditor.getHtmlText();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // Select entire text using Ctrl+A (on mac Cmd + A)</span>
<span class="udiff-line-added">+         Util.runAndWait(() -&gt; {</span>
<span class="udiff-line-added">+             KeyEventFirer keyboard = new KeyEventFirer(htmlEditor, scene);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             keyboard.doKeyPress(KeyCode.A,</span>
<span class="udiff-line-added">+                                 PlatformUtil.isMac()? KeyModifier.META : KeyModifier.CTRL);</span>
<span class="udiff-line-added">+         });</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         String actualHtmlText = htmlEditor.getHtmlText();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         assertEquals(&quot;Expected and Actual HTML text does not match. &quot;, expectedHtmlText, actualHtmlText);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @Test</span>
<span class="udiff-line-added">+     public void checkFontSizeOnSelectAll_Shift_LeftArrowKey() throws Exception {</span>
<span class="udiff-line-added">+         final CountDownLatch editorStateLatch = new CountDownLatch(1);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         final String editorCommand1 =</span>
<span class="udiff-line-added">+             &quot;document.execCommand(&#39;fontSize&#39;, false, &#39;7&#39;);&quot; +</span>
<span class="udiff-line-added">+             &quot;document.execCommand(&#39;insertText&#39;, false, &#39;Hello&#39;);&quot;;</span>
<span class="udiff-line-added">+         final String editorCommand2 =</span>
<span class="udiff-line-added">+             &quot;document.execCommand(&#39;fontSize&#39;, false, &#39;1&#39;);&quot; +</span>
<span class="udiff-line-added">+             &quot;document.execCommand(&#39;insertText&#39;, false, &#39;World&#39;);&quot;;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         Util.runAndWait(() -&gt; {</span>
<span class="udiff-line-added">+             webView.getEngine().getLoadWorker().stateProperty().</span>
<span class="udiff-line-added">+                 addListener((observable, oldValue, newValue) -&gt; {</span>
<span class="udiff-line-added">+                 if (newValue == SUCCEEDED) {</span>
<span class="udiff-line-added">+                     htmlEditor.requestFocus();</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             });</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             htmlEditor.setHtmlText(htmlEditor.getHtmlText());</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             webView.focusedProperty().addListener((observable, oldValue, newValue) -&gt; {</span>
<span class="udiff-line-added">+                 if (newValue) {</span>
<span class="udiff-line-added">+                     webView.getEngine().executeScript(&quot;document.body.focus();&quot;);</span>
<span class="udiff-line-added">+                     webView.getEngine().executeScript(editorCommand1);</span>
<span class="udiff-line-added">+                     webView.getEngine().executeScript(editorCommand2);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                     editorStateLatch.countDown();</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             });</span>
<span class="udiff-line-added">+         });</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         assertTrue(&quot;Timeout while waiting for test html text setup&quot;, Util.await(editorStateLatch));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         String expectedHtmlText = htmlEditor.getHtmlText();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // Select entire text using SHIFT + series of Left arrows</span>
<span class="udiff-line-added">+         Util.runAndWait(() -&gt; {</span>
<span class="udiff-line-added">+             KeyEventFirer keyboard = new KeyEventFirer(htmlEditor, scene);</span>
<span class="udiff-line-added">+             for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-added">+                 keyboard.doLeftArrowPress(KeyModifier.SHIFT);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         });</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         String actualHtmlText = htmlEditor.getHtmlText();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         assertEquals(&quot;Expected and Actual HTML text does not match. &quot;, expectedHtmlText, actualHtmlText);</span>
<span class="udiff-line-added">+     }</span>
  }
</pre>
<center><a href="../../../../../../../../../modules/javafx.web/src/main/java/javafx/scene/web/HTMLEditorSkin.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>