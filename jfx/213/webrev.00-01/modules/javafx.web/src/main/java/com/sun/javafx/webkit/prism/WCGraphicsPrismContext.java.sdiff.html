<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/java/com/sun/javafx/webkit/prism/WCGraphicsPrismContext.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>modules/javafx.web/src/main/java/com/sun/javafx/webkit/prism/WCGraphicsPrismContext.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 534                     state.getTransformNoClone().transform(rect, transformedRect);
 535                     RTTexture paintRtTexture = g.getResourceFactory().createRTTexture(
 536                             (int) Math.ceil(transformedRect.width),
 537                             (int) Math.ceil(transformedRect.height),
 538                             Texture.WrapMode.CLAMP_NOT_NEEDED);
 539                     Graphics g1 = paintRtTexture.createGraphics();
 540                     g1.setPaint(paint);
 541                     g1.setTransform(PrismGraphicsManager.getPixelScaleTransform());
 542                     g1.fillRect(0, 0, paintRtTexture.getContentWidth(), paintRtTexture.getContentHeight());
 543 
 544                     RTImage maskImage = (RTImage) (state.getClipMaskImageNoClone());
 545                     Image nativeMaskImage = Image.fromByteBgraPreData(maskImage.getPixelBuffer(), maskImage.getWidth(),
 546                             maskImage.getHeight(), 0, maskImage.getPixelScale());
 547                     Texture maskTexture = g.getResourceFactory().createTexture(nativeMaskImage, Texture.Usage.STATIC,
 548                             Texture.WrapMode.CLAMP_NOT_NEEDED);
 549                     RTTexture maskRtTexture = g.getResourceFactory().createRTTexture(nativeMaskImage.getWidth(),
 550                             nativeMaskImage.getHeight(), Texture.WrapMode.CLAMP_NOT_NEEDED);
 551                     Graphics g2 = maskRtTexture.createGraphics();
 552                     g2.setTransform(PrismGraphicsManager.getPixelScaleTransform());
 553                     g2.drawTexture(maskTexture, 0, 0, nativeMaskImage.getWidth(), nativeMaskImage.getHeight());

 554                     if(g instanceof MaskTextureGraphics) {
 555                         MaskTextureGraphics mg = (MaskTextureGraphics) (g);
 556                         mg.drawPixelsMasked(paintRtTexture, maskRtTexture, transformedRect.x, transformedRect.y,
 557                                 transformedRect.width, transformedRect.height, 0, 0, 0, 0);
 558                     } else {
 559                         Screen screen = g.getAssociatedScreen();
 560                         FilterContext filterContext;
 561                         if (screen == null) {
 562                             ResourceFactory factory = g.getResourceFactory();
 563                             filterContext = PrFilterContext.getPrinterContext(factory);
 564                         } else {
 565                             filterContext = PrFilterContext.getInstance(screen);
 566                         }
 567                         PrDrawable imagePrDrawable = PrDrawable.create(filterContext, paintRtTexture);
 568                         PrDrawable maskPrDrawable = PrDrawable.create(filterContext, maskRtTexture);
 569                         Blend blend = new Blend(Blend.Mode.SRC_IN,
 570                                 new PassThrough(maskPrDrawable, transformedRect.width, transformedRect.height),
 571                                 new PassThrough(imagePrDrawable, transformedRect.width, transformedRect.height));
 572                         Affine3D tx = new Affine3D(g.getTransformNoClone());
 573                         g.setTransform(BaseTransform.IDENTITY_TRANSFORM);
 574                         PrEffectHelper.render(blend, g, transformedRect.x, transformedRect.y, null);
 575                         g.setTransform(tx);
 576                     }


 577                 } else {
 578                     g.setPaint(paint);
 579                     g.fillRect(x, y, w, h);
 580                 }
 581             }
 582         }.paint();
 583     }
 584 
 585     @Override
 586     public void fillRoundedRect(final float x, final float y, final float w, final float h,
 587         final float topLeftW, final float topLeftH, final float topRightW, final float topRightH,
 588         final float bottomLeftW, final float bottomLeftH, final float bottomRightW, final float bottomRightH,
 589         final int rgba)
 590     {
 591         if (log.isLoggable(Level.FINE)) {
 592             log.fine(String.format(&quot;fillRoundedRect(%f, %f, %f, %f, &quot;
 593                     + &quot;%f, %f, %f, %f, %f, %f, %f, %f, 0x%x)&quot;,
 594                     x, y, w, h, topLeftW, topLeftH, topRightW, topRightH,
 595                     bottomLeftW, bottomLeftH, bottomRightW, bottomRightH, rgba));
 596         }
</pre>
</td>
<td>
<hr />
<pre>
 534                     state.getTransformNoClone().transform(rect, transformedRect);
 535                     RTTexture paintRtTexture = g.getResourceFactory().createRTTexture(
 536                             (int) Math.ceil(transformedRect.width),
 537                             (int) Math.ceil(transformedRect.height),
 538                             Texture.WrapMode.CLAMP_NOT_NEEDED);
 539                     Graphics g1 = paintRtTexture.createGraphics();
 540                     g1.setPaint(paint);
 541                     g1.setTransform(PrismGraphicsManager.getPixelScaleTransform());
 542                     g1.fillRect(0, 0, paintRtTexture.getContentWidth(), paintRtTexture.getContentHeight());
 543 
 544                     RTImage maskImage = (RTImage) (state.getClipMaskImageNoClone());
 545                     Image nativeMaskImage = Image.fromByteBgraPreData(maskImage.getPixelBuffer(), maskImage.getWidth(),
 546                             maskImage.getHeight(), 0, maskImage.getPixelScale());
 547                     Texture maskTexture = g.getResourceFactory().createTexture(nativeMaskImage, Texture.Usage.STATIC,
 548                             Texture.WrapMode.CLAMP_NOT_NEEDED);
 549                     RTTexture maskRtTexture = g.getResourceFactory().createRTTexture(nativeMaskImage.getWidth(),
 550                             nativeMaskImage.getHeight(), Texture.WrapMode.CLAMP_NOT_NEEDED);
 551                     Graphics g2 = maskRtTexture.createGraphics();
 552                     g2.setTransform(PrismGraphicsManager.getPixelScaleTransform());
 553                     g2.drawTexture(maskTexture, 0, 0, nativeMaskImage.getWidth(), nativeMaskImage.getHeight());
<span class="line-added"> 554                     maskTexture.dispose();</span>
 555                     if(g instanceof MaskTextureGraphics) {
 556                         MaskTextureGraphics mg = (MaskTextureGraphics) (g);
 557                         mg.drawPixelsMasked(paintRtTexture, maskRtTexture, transformedRect.x, transformedRect.y,
 558                                 transformedRect.width, transformedRect.height, 0, 0, 0, 0);
 559                     } else {
 560                         Screen screen = g.getAssociatedScreen();
 561                         FilterContext filterContext;
 562                         if (screen == null) {
 563                             ResourceFactory factory = g.getResourceFactory();
 564                             filterContext = PrFilterContext.getPrinterContext(factory);
 565                         } else {
 566                             filterContext = PrFilterContext.getInstance(screen);
 567                         }
 568                         PrDrawable imagePrDrawable = PrDrawable.create(filterContext, paintRtTexture);
 569                         PrDrawable maskPrDrawable = PrDrawable.create(filterContext, maskRtTexture);
 570                         Blend blend = new Blend(Blend.Mode.SRC_IN,
 571                                 new PassThrough(maskPrDrawable, transformedRect.width, transformedRect.height),
 572                                 new PassThrough(imagePrDrawable, transformedRect.width, transformedRect.height));
 573                         Affine3D tx = new Affine3D(g.getTransformNoClone());
 574                         g.setTransform(BaseTransform.IDENTITY_TRANSFORM);
 575                         PrEffectHelper.render(blend, g, transformedRect.x, transformedRect.y, null);
 576                         g.setTransform(tx);
 577                     }
<span class="line-added"> 578                     paintRtTexture.dispose();</span>
<span class="line-added"> 579                     maskRtTexture.dispose();</span>
 580                 } else {
 581                     g.setPaint(paint);
 582                     g.fillRect(x, y, w, h);
 583                 }
 584             }
 585         }.paint();
 586     }
 587 
 588     @Override
 589     public void fillRoundedRect(final float x, final float y, final float w, final float h,
 590         final float topLeftW, final float topLeftH, final float topRightW, final float topRightH,
 591         final float bottomLeftW, final float bottomLeftH, final float bottomRightW, final float bottomRightH,
 592         final int rgba)
 593     {
 594         if (log.isLoggable(Level.FINE)) {
 595             log.fine(String.format(&quot;fillRoundedRect(%f, %f, %f, %f, &quot;
 596                     + &quot;%f, %f, %f, %f, %f, %f, %f, %f, 0x%x)&quot;,
 597                     x, y, w, h, topLeftW, topLeftH, topRightW, topRightH,
 598                     bottomLeftW, bottomLeftH, bottomRightW, bottomRightH, rgba));
 599         }
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>