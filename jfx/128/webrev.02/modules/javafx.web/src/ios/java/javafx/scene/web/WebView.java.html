<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/ios/java/javafx/scene/web/WebView.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 /*
   2  * Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package javafx.scene.web;
  27 
  28 
  29 import javafx.css.CssMetaData;
  30 import javafx.css.StyleableBooleanProperty;
  31 import javafx.css.StyleableDoubleProperty;
  32 import javafx.css.StyleableObjectProperty;
  33 import javafx.css.StyleableProperty;
  34 import javafx.css.converter.BooleanConverter;
  35 import javafx.css.converter.EnumConverter;
  36 import javafx.css.converter.SizeConverter;
  37 import com.sun.javafx.geom.BaseBounds;
  38 import com.sun.javafx.geom.PickRay;
  39 import com.sun.javafx.geom.transform.Affine3D;
  40 import com.sun.javafx.geom.transform.BaseTransform;
  41 import com.sun.javafx.scene.DirtyBits;
  42 import com.sun.javafx.scene.NodeHelper;
  43 import com.sun.javafx.scene.input.PickResultChooser;
  44 import com.sun.javafx.scene.SceneHelper;
  45 import com.sun.java.scene.web.WebViewHelper;
  46 
  47 import com.sun.javafx.sg.prism.NGNode;
  48 import com.sun.javafx.tk.TKPulseListener;
  49 import com.sun.javafx.tk.Toolkit;
  50 import java.util.ArrayList;
  51 import java.util.Collections;
  52 import java.util.List;
  53 import javafx.beans.property.*;
  54 import javafx.beans.value.ChangeListener;
  55 import javafx.beans.value.ObservableValue;
  56 import javafx.collections.ObservableList;
  57 import javafx.css.Styleable;
  58 import javafx.geometry.Bounds;
  59 import javafx.scene.Node;
  60 import javafx.scene.Parent;
  61 import javafx.scene.text.FontSmoothingType;
  62 
  63 /**
  64  * {@code WebView} is a {@link javafx.scene.Node} that manages a
  65  * {@link WebEngine} and displays its content. The associated {@code WebEngine}
  66  * is created automatically at construction time and cannot be changed
  67  * afterwards. {@code WebView} handles mouse and some keyboard events, and
  68  * manages scrolling automatically, so there&#39;s no need to put it into a
  69  * {@code ScrollPane}.
  70  *
  71  * &lt;p&gt;{@code WebView} objects must be created and accessed solely from the
  72  * FX thread.
  73  * @since JavaFX 2.0
  74  */
  75 final public class WebView extends Parent {
  76     static {
  77         WebViewHelper.setWebViewAccessor(new WebViewHelper.WebViewAccessor() {
  78             @Override
  79                 public NGNode doCreatePeer(Node node) {
  80                 return ((WebView) node).doCreatePeer();
  81             }
  82 
  83             @Override
  84                 public void doUpdatePeer(Node node) {
  85                 ((WebView) node).doUpdatePeer();
  86             }
  87 
  88             @Override
  89             public void doTransformsChanged(Node node) {
  90                 ((WebView) node).doTransformsChanged();
  91             }
  92 
  93             @Override
  94             public BaseBounds doComputeGeomBounds(Node node,
  95                     BaseBounds bounds, BaseTransform tx) {
  96                 return ((WebView) node).doComputeGeomBounds(bounds, tx);
  97             }
  98 
  99             @Override
 100             public boolean doComputeContains(Node node, double localX, double localY) {
 101                 return ((WebView) node).doComputeContains(localX, localY);
 102             }
 103 
 104             @Override
 105             public void doPickNodeLocal(Node node, PickRay localPickRay, PickResultChooser result) {
 106                 throw new UnsupportedOperationException(&quot;Not supported yet.&quot;); //To change body of generated methods, choose Tools | Templates.
 107             }
 108         });
 109     }
 110 
 111     private static final boolean DEFAULT_CONTEXT_MENU_ENABLED = true;
 112     private static final FontSmoothingType DEFAULT_FONT_SMOOTHING_TYPE = FontSmoothingType.LCD;
 113     private static final double DEFAULT_ZOOM = 1.0;
 114     private static final double DEFAULT_FONT_SCALE = 1.0;
 115     private static final double DEFAULT_MIN_WIDTH = 0;
 116     private static final double DEFAULT_MIN_HEIGHT = 0;
 117     private static final double DEFAULT_PREF_WIDTH = 800;
 118     private static final double DEFAULT_PREF_HEIGHT = 600;
 119     private static final double DEFAULT_MAX_WIDTH = Double.MAX_VALUE;
 120     private static final double DEFAULT_MAX_HEIGHT = Double.MAX_VALUE;
 121 
 122     private final WebEngine engine;
 123     // pointer to native WebViewImpl
 124     private final long handle;
 125 
 126     /**
 127      * The stage pulse listener registered with the toolkit.
 128      * This field guarantees that the listener will exist throughout
 129      * the whole lifetime of the WebView node. This field is necessary
 130      * because the toolkit references its stage pulse listeners weakly.
 131      */
 132     private final TKPulseListener stagePulseListener;
 133 
 134     /**
 135      * Returns the {@code WebEngine} object.
 136      */
 137     public final WebEngine getEngine() {
 138         return engine;
 139     }
 140 
 141     private final ReadOnlyDoubleWrapper width = new ReadOnlyDoubleWrapper(this, &quot;width&quot;);
 142 
 143     /**
 144      * Returns width of this {@code WebView}.
 145      */
 146     public final double getWidth() {
 147         return width.get();
 148     }
 149 
 150     /**
 151      * Width of this {@code WebView}.
 152      */
 153     public ReadOnlyDoubleProperty widthProperty() {
 154         return width.getReadOnlyProperty();
 155     }
 156 
 157     private final ReadOnlyDoubleWrapper height = new ReadOnlyDoubleWrapper(this, &quot;height&quot;);
 158 
 159     /**
 160      * Returns height of this {@code WebView}.
 161      */
 162     public final double getHeight() {
 163         return height.get();
 164     }
 165 
 166     /**
 167      * Height of this {@code WebView}.
 168      */
 169     public ReadOnlyDoubleProperty heightProperty() {
 170         return height.getReadOnlyProperty();
 171     }
 172 
 173     /**
 174      * Zoom factor applied to the whole page contents.
 175      *
 176      * @defaultValue 1.0
 177      */
 178     private DoubleProperty zoom;
 179 
 180     /**
 181      * Sets current zoom factor applied to the whole page contents.
 182      * @param value zoom factor to be set
 183      * @see #zoomProperty()
 184      * @see #getZoom()
 185      * @since JavaFX 8.0
 186      */
 187     public final void setZoom(double value) {
 188         WebEngine.checkThread();
 189         zoomProperty().set(value);
 190     }
 191 
 192     /**
 193      * Returns current zoom factor applied to the whole page contents.
 194      * @return current zoom factor
 195      * @see #zoomProperty()
 196      * @see #setZoom(double value)
 197      * @since JavaFX 8.0
 198      */
 199     public final double getZoom() {
 200         return (this.zoom != null)
 201                 ? this.zoom.get()
 202                 : DEFAULT_ZOOM;
 203     }
 204 
 205     /**
 206      * Returns zoom property object.
 207      * @return zoom property object
 208      * @see #getZoom()
 209      * @see #setZoom(double value)
 210      * @since JavaFX 8.0
 211      */
 212     public final DoubleProperty zoomProperty() {
 213         if (zoom == null) {
 214             zoom = new StyleableDoubleProperty(DEFAULT_ZOOM) {
 215                 @Override public void invalidated() {
 216                     Toolkit.getToolkit().checkFxUserThread();
 217                 }
 218 
 219                 @Override public CssMetaData&lt;WebView, Number&gt; getCssMetaData() {
 220                     return StyleableProperties.ZOOM;
 221                 }
 222                 @Override public Object getBean() {
 223                     return WebView.this;
 224                 }
 225                 @Override public String getName() {
 226                     return &quot;zoom&quot;;
 227                 }
 228             };
 229         }
 230         return zoom;
 231     }
 232 
 233     /**
 234      * Specifies scale factor applied to font. This setting affects
 235      * text content but not images and fixed size elements.
 236      *
 237      * @defaultValue 1.0
 238      */
 239     private DoubleProperty fontScale;
 240 
 241     public final void setFontScale(double value) {
 242         WebEngine.checkThread();
 243         fontScaleProperty().set(value);
 244     }
 245 
 246     public final double getFontScale() {
 247         return (this.fontScale != null)
 248                 ? this.fontScale.get()
 249                 : DEFAULT_FONT_SCALE;
 250     }
 251 
 252     public DoubleProperty fontScaleProperty() {
 253         if (fontScale == null) {
 254             fontScale = new StyleableDoubleProperty(DEFAULT_FONT_SCALE) {
 255                 @Override public void invalidated() {
 256                     Toolkit.getToolkit().checkFxUserThread();
 257                 }
 258                 @Override public CssMetaData&lt;WebView, Number&gt; getCssMetaData() {
 259                     return StyleableProperties.FONT_SCALE;
 260                 }
 261                 @Override public Object getBean() {
 262                     return WebView.this;
 263                 }
 264                 @Override public String getName() {
 265                     return &quot;fontScale&quot;;
 266                 }
 267             };
 268         }
 269         return fontScale;
 270     }
 271 
 272     /**
 273      * Creates a {@code WebView} object.
 274      */
 275     public WebView() {
 276         long[] nativeHandle = new long[1];
 277         _initWebView(nativeHandle);
 278         getStyleClass().add(&quot;web-view&quot;);
 279         handle = nativeHandle[0];
 280         engine = new WebEngine();
 281         engine.setView(this);
 282 
 283         stagePulseListener = () -&gt; {
 284             handleStagePulse();
 285         };
 286         focusedProperty().addListener((ov, t, t1) -&gt; {
 287         });
 288         Toolkit.getToolkit().addStageTkPulseListener(stagePulseListener);
 289 
 290         final ChangeListener&lt;Bounds&gt; chListener = new ChangeListener&lt;Bounds&gt;() {
 291 
 292             @Override
 293             public void changed(ObservableValue&lt;? extends Bounds&gt; observable, Bounds oldValue, Bounds newValue) {
 294                 NodeHelper.transformsChanged(WebView.this);
 295             }
 296         };
 297 
 298         parentProperty().addListener(new ChangeListener&lt;Parent&gt;(){
 299 
 300             @Override
 301             public void changed(ObservableValue&lt;? extends Parent&gt; observable, Parent oldValue, Parent newValue) {
 302                 if (oldValue != null &amp;&amp; newValue == null) {
 303                     // webview has been removed from scene
 304                     _removeWebView(handle);
 305                 }
 306 
 307                 if (oldValue != null) {
 308                     do {
 309                         oldValue.boundsInParentProperty().removeListener(chListener);
 310                         oldValue = oldValue.getParent();
 311                     } while (oldValue != null);
 312                 }
 313 
 314                 if (newValue != null) {
 315                     do {
 316                         final Node n = newValue;
 317                         newValue.boundsInParentProperty().addListener(chListener);
 318                         newValue = newValue.getParent();
 319                     } while (newValue != null);
 320                 }
 321             }
 322 
 323         });
 324 
 325         layoutBoundsProperty().addListener(new ChangeListener&lt;Bounds&gt;() {
 326 
 327             @Override
 328             public void changed(ObservableValue&lt;? extends Bounds&gt; observable, Bounds oldValue, Bounds newValue) {
 329                 Affine3D trans = calculateNodeToSceneTransform(WebView.this);
 330                 _setTransform(handle,
 331                 trans.getMxx(), trans.getMxy(), trans.getMxz(), trans.getMxt(),
 332                 trans.getMyx(), trans.getMyy(), trans.getMyz(), trans.getMyt(),
 333                 trans.getMzx(), trans.getMzy(), trans.getMzz(), trans.getMzt());
 334 
 335             }
 336 
 337         });
 338 
 339         NodeHelper.treeVisibleProperty(this).addListener(new ChangeListener&lt;Boolean&gt;() {
 340 
 341             @Override
 342             public void changed(ObservableValue&lt;? extends Boolean&gt; observable, Boolean oldValue, Boolean newValue) {
 343                 _setVisible(handle, newValue);
 344             }
 345         });
 346     }
 347     // Resizing support. Allows arbitrary growing and shrinking.
 348     // Designed after javafx.scene.control.Control
 349 
 350     @Override public boolean isResizable() {
 351         return true;
 352     }
 353 
 354     @Override public void resize(double width, double height) {
 355         this.width.set(width);
 356         this.height.set(height);
 357         NodeHelper.markDirty(this, DirtyBits.NODE_GEOMETRY);
 358         NodeHelper.geomChanged(this);
 359         _setWidth(handle, width);
 360         _setHeight(handle, height);
 361     }
 362 
 363     /**
 364      * Called during layout to determine the minimum width for this node.
 365      *
 366      * @return the minimum width that this node should be resized to during layout
 367      */
 368     @Override public final double minWidth(double height) {
 369         return getMinWidth();
 370     }
 371 
 372     /**
 373      * Called during layout to determine the minimum height for this node.
 374      *
 375      * @return the minimum height that this node should be resized to during layout
 376      */
 377     @Override public final double minHeight(double width) {
 378         return getMinHeight();
 379     }
 380 
 381 
 382     /**
 383      * Called during layout to determine the preferred width for this node.
 384      *
 385      * @return the preferred width that this node should be resized to during layout
 386      */
 387     @Override public final double prefWidth(double height) {
 388         return getPrefWidth();
 389     }
 390 
 391     /**
 392      * Called during layout to determine the preferred height for this node.
 393      *
 394      * @return the preferred height that this node should be resized to during layout
 395      */
 396     @Override public final double prefHeight(double width) {
 397         return getPrefHeight();
 398     }
 399     /**
 400      * Called during layout to determine the maximum width for this node.
 401      *
 402      * @return the maximum width that this node should be resized to during layout
 403      */
 404     @Override public final double maxWidth(double height) {
 405         return getMaxWidth();
 406     }
 407 
 408     /**
 409      * Called during layout to determine the maximum height for this node.
 410      *
 411      * @return the maximum height that this node should be resized to during layout
 412      */
 413     @Override public final double maxHeight(double width) {
 414         return getMaxHeight();
 415     }
 416 
 417     /**
 418      * Minimum width property.
 419      */
 420     public DoubleProperty minWidthProperty() {
 421         if (minWidth == null) {
 422             minWidth = new StyleableDoubleProperty(DEFAULT_MIN_WIDTH) {
 423                 @Override
 424                 public void invalidated() {
 425                     if (getParent() != null) {
 426                         getParent().requestLayout();
 427                     }
 428                 }
 429                 @Override
 430                 public CssMetaData&lt;WebView, Number&gt; getCssMetaData() {
 431                     return StyleableProperties.MIN_WIDTH;
 432                 }
 433                 @Override
 434                 public Object getBean() {
 435                     return WebView.this;
 436                 }
 437                 @Override
 438                 public String getName() {
 439                     return &quot;minWidth&quot;;
 440                 }
 441             };
 442         }
 443         return minWidth;
 444     }
 445     private DoubleProperty minWidth;
 446 
 447     /**
 448      * Sets minimum width.
 449      */
 450     public final void setMinWidth(double value) {
 451         minWidthProperty().set(value);
 452         _setWidth(handle, value);
 453     }
 454 
 455     /**
 456      * Returns minimum width.
 457      */
 458     public final double getMinWidth() {
 459         return (this.minWidth != null)
 460                 ? this.minWidth.get()
 461                 : DEFAULT_MIN_WIDTH;
 462     }
 463 
 464     /**
 465      * Minimum height property.
 466      */
 467     public DoubleProperty minHeightProperty() {
 468         if (minHeight == null) {
 469             minHeight = new StyleableDoubleProperty(DEFAULT_MIN_HEIGHT) {
 470                 @Override
 471                 public void invalidated() {
 472                     if (getParent() != null) {
 473                         getParent().requestLayout();
 474                     }
 475                 }
 476                 @Override
 477                 public CssMetaData&lt;WebView, Number&gt; getCssMetaData() {
 478                     return StyleableProperties.MIN_HEIGHT;
 479                 }
 480                 @Override
 481                 public Object getBean() {
 482                     return WebView.this;
 483                 }
 484                 @Override
 485                 public String getName() {
 486                     return &quot;minHeight&quot;;
 487                 }
 488             };
 489         }
 490         return minHeight;
 491     }
 492     private DoubleProperty minHeight;
 493 
 494     /**
 495      * Sets minimum height.
 496      */
 497     public final void setMinHeight(double value) {
 498         minHeightProperty().set(value);
 499         _setHeight(handle, value);
 500     }
 501 
 502     /**
 503      * Sets minimum height.
 504      */
 505     public final double getMinHeight() {
 506         return (this.minHeight != null)
 507                 ? this.minHeight.get()
 508                 : DEFAULT_MIN_HEIGHT;
 509     }
 510 
 511     /**
 512      * Convenience method for setting minimum width and height.
 513      */
 514     public void setMinSize(double minWidth, double minHeight) {
 515         setMinWidth(minWidth);
 516         setMinHeight(minHeight);
 517         _setWidth(handle, minWidth);
 518         _setHeight(handle, minHeight);
 519     }
 520 
 521     /**
 522      * Preferred width property.
 523      */
 524     public DoubleProperty prefWidthProperty() {
 525         if (prefWidth == null) {
 526             prefWidth = new StyleableDoubleProperty(DEFAULT_PREF_WIDTH) {
 527                 @Override
 528                 public void invalidated() {
 529                     if (getParent() != null) {
 530                         getParent().requestLayout();
 531                     }
 532                 }
 533                 @Override
 534                 public CssMetaData&lt;WebView, Number&gt; getCssMetaData() {
 535                     return StyleableProperties.PREF_WIDTH;
 536                 }
 537                 @Override
 538                 public Object getBean() {
 539                     return WebView.this;
 540                 }
 541                 @Override
 542                 public String getName() {
 543                     return &quot;prefWidth&quot;;
 544                 }
 545             };
 546         }
 547         return prefWidth;
 548     }
 549     private DoubleProperty prefWidth;
 550 
 551     /**
 552      * Sets preferred width.
 553      */
 554     public final void setPrefWidth(double value) {
 555         prefWidthProperty().set(value);
 556         _setWidth(handle, value);
 557     }
 558 
 559     /**
 560      * Returns preferred width.
 561      */
 562     public final double getPrefWidth() {
 563         return (this.prefWidth != null)
 564                 ? this.prefWidth.get()
 565                 : DEFAULT_PREF_WIDTH;
 566     }
 567 
 568     /**
 569      * Preferred height property.
 570      */
 571     public DoubleProperty prefHeightProperty() {
 572         if (prefHeight == null) {
 573             prefHeight = new StyleableDoubleProperty(DEFAULT_PREF_HEIGHT) {
 574                 @Override
 575                 public void invalidated() {
 576                     if (getParent() != null) {
 577                         getParent().requestLayout();
 578                     }
 579                 }
 580                 @Override
 581                 public CssMetaData&lt;WebView, Number&gt; getCssMetaData() {
 582                     return StyleableProperties.PREF_HEIGHT;
 583                 }
 584                 @Override
 585                 public Object getBean() {
 586                     return WebView.this;
 587                 }
 588                 @Override
 589                 public String getName() {
 590                     return &quot;prefHeight&quot;;
 591                 }
 592             };
 593         }
 594         return prefHeight;
 595     }
 596     private DoubleProperty prefHeight;
 597 
 598     /**
 599      * Sets preferred height.
 600      */
 601     public final void setPrefHeight(double value) {
 602         prefHeightProperty().set(value);
 603         _setHeight(handle, value);
 604     }
 605 
 606     /**
 607      * Returns preferred height.
 608      */
 609     public final double getPrefHeight() {
 610         return (this.prefHeight != null)
 611                 ? this.prefHeight.get()
 612                 : DEFAULT_PREF_HEIGHT;
 613     }
 614 
 615     /**
 616      * Convenience method for setting preferred width and height.
 617      */
 618     public void setPrefSize(double prefWidth, double prefHeight) {
 619         setPrefWidth(prefWidth);
 620         setPrefHeight(prefHeight);
 621         _setWidth(handle, prefWidth);
 622         _setHeight(handle, prefHeight);
 623     }
 624 
 625     /**
 626      * Maximum width property.
 627      */
 628     public DoubleProperty maxWidthProperty() {
 629         if (maxWidth == null) {
 630             maxWidth = new StyleableDoubleProperty(DEFAULT_MAX_WIDTH) {
 631                 @Override
 632                 public void invalidated() {
 633                     if (getParent() != null) {
 634                         getParent().requestLayout();
 635                     }
 636                 }
 637                 @Override
 638                 public CssMetaData&lt;WebView, Number&gt; getCssMetaData() {
 639                     return StyleableProperties.MAX_WIDTH;
 640                 }
 641                 @Override
 642                 public Object getBean() {
 643                     return WebView.this;
 644                 }
 645                 @Override
 646                 public String getName() {
 647                     return &quot;maxWidth&quot;;
 648                 }
 649             };
 650         }
 651         return maxWidth;
 652     }
 653     private DoubleProperty maxWidth;
 654 
 655     /**
 656      * Sets maximum width.
 657      */
 658     public final void setMaxWidth(double value) {
 659         maxWidthProperty().set(value);
 660         _setWidth(handle, value);
 661     }
 662 
 663     /**
 664      * Returns maximum width.
 665      */
 666     public final double getMaxWidth() {
 667         return (this.maxWidth != null)
 668                 ? this.maxWidth.get()
 669                 : DEFAULT_MAX_WIDTH;
 670     }
 671 
 672     /**
 673      * Maximum height property.
 674      */
 675     public DoubleProperty maxHeightProperty() {
 676         if (maxHeight == null) {
 677             maxHeight = new StyleableDoubleProperty(DEFAULT_MAX_HEIGHT) {
 678                 @Override
 679                 public void invalidated() {
 680                     if (getParent() != null) {
 681                         getParent().requestLayout();
 682                     }
 683                 }
 684                 @Override
 685                 public CssMetaData&lt;WebView, Number&gt; getCssMetaData() {
 686                     return StyleableProperties.MAX_HEIGHT;
 687                 }
 688                 @Override
 689                 public Object getBean() {
 690                     return WebView.this;
 691                 }
 692                 @Override
 693                 public String getName() {
 694                     return &quot;maxHeight&quot;;
 695                 }
 696             };
 697         }
 698         return maxHeight;
 699     }
 700     private DoubleProperty maxHeight;
 701 
 702     /**
 703      * Sets maximum height.
 704      */
 705     public final void setMaxHeight(double value) {
 706         maxHeightProperty().set(value);
 707         _setHeight(handle, value);
 708     }
 709 
 710     /**
 711      * Returns maximum height.
 712      */
 713     public final double getMaxHeight() {
 714         return (this.maxHeight != null)
 715                 ? this.maxHeight.get()
 716                 : DEFAULT_MAX_HEIGHT;
 717     }
 718 
 719     /**
 720      * Convenience method for setting maximum width and height.
 721      */
 722     public void setMaxSize(double maxWidth, double maxHeight) {
 723         setMaxWidth(maxWidth);
 724         setMaxHeight(maxHeight);
 725         _setWidth(handle, maxWidth);
 726         _setHeight(handle, maxHeight);
 727     }
 728 
 729 
 730     /**
 731      * Specifies a requested font smoothing type : gray or LCD.
 732      *
 733      * The width of the bounding box is defined by the widest row.
 734      *
 735      * Note: LCD mode doesn&#39;t apply in numerous cases, such as various
 736      * compositing modes, where effects are applied and very large glyphs.
 737      *
 738      * @defaultValue FontSmoothingType.LCD
 739      * @since JavaFX 2.2
 740      */
 741     private ObjectProperty&lt;FontSmoothingType&gt; fontSmoothingType;
 742 
 743     public final void setFontSmoothingType(FontSmoothingType value) {
 744         fontSmoothingTypeProperty().set(value);
 745     }
 746 
 747     public final FontSmoothingType getFontSmoothingType() {
 748         return (this.fontSmoothingType != null)
 749                 ? this.fontSmoothingType.get()
 750                 : DEFAULT_FONT_SMOOTHING_TYPE;
 751     }
 752 
 753     public final ObjectProperty&lt;FontSmoothingType&gt; fontSmoothingTypeProperty() {
 754         if (this.fontSmoothingType == null) {
 755             this.fontSmoothingType = new StyleableObjectProperty&lt;FontSmoothingType&gt;(DEFAULT_FONT_SMOOTHING_TYPE) {
 756                 @Override
 757                 public void invalidated() {
 758                     Toolkit.getToolkit().checkFxUserThread();
 759                 }
 760                 @Override
 761                 public CssMetaData&lt;WebView, FontSmoothingType&gt; getCssMetaData() {
 762                     return StyleableProperties.FONT_SMOOTHING_TYPE;
 763                 }
 764                 @Override
 765                 public Object getBean() {
 766                     return WebView.this;
 767                 }
 768                 @Override
 769                 public String getName() {
 770                     return &quot;fontSmoothingType&quot;;
 771                 }
 772             };
 773         }
 774         return this.fontSmoothingType;
 775     }
 776 
 777     /**
 778      * Specifies whether context menu is enabled.
 779      *
 780      * @defaultValue true
 781      * @since JavaFX 2.2
 782      */
 783     private BooleanProperty contextMenuEnabled;
 784 
 785     public final void setContextMenuEnabled(boolean value) {
 786         contextMenuEnabledProperty().set(value);
 787     }
 788 
 789     public final boolean isContextMenuEnabled() {
 790         return contextMenuEnabled == null
 791                 ? DEFAULT_CONTEXT_MENU_ENABLED
 792                 : contextMenuEnabled.get();
 793     }
 794 
 795     public final BooleanProperty contextMenuEnabledProperty() {
 796         if (contextMenuEnabled == null) {
 797             contextMenuEnabled = new StyleableBooleanProperty(DEFAULT_CONTEXT_MENU_ENABLED) {
 798                 @Override public void invalidated() {
 799                     Toolkit.getToolkit().checkFxUserThread();
 800                 }
 801 
 802                 @Override public CssMetaData&lt;WebView, Boolean&gt; getCssMetaData() {
 803                     return StyleableProperties.CONTEXT_MENU_ENABLED;
 804                 }
 805 
 806                 @Override public Object getBean() {
 807                     return WebView.this;
 808                 }
 809 
 810                 @Override public String getName() {
 811                     return &quot;contextMenuEnabled&quot;;
 812                 }
 813             };
 814         }
 815         return contextMenuEnabled;
 816     }
 817 
 818     /**
 819      * Super-lazy instantiation pattern from Bill Pugh.
 820      */
 821     private static final class StyleableProperties {
 822 
 823         private static final CssMetaData&lt;WebView, Boolean&gt; CONTEXT_MENU_ENABLED
 824                 = new CssMetaData&lt;WebView, Boolean&gt;(
 825                 &quot;-fx-context-menu-enabled&quot;,
 826                 BooleanConverter.getInstance(),
 827                 DEFAULT_CONTEXT_MENU_ENABLED)
 828         {
 829             @Override public boolean isSettable(WebView view) {
 830                 return view.contextMenuEnabled == null || !view.contextMenuEnabled.isBound();
 831             }
 832             @Override public StyleableProperty&lt;Boolean&gt; getStyleableProperty(WebView view) {
 833                 return (StyleableProperty&lt;Boolean&gt;)view.contextMenuEnabledProperty();
 834             }
 835         };
 836 
 837         private static final CssMetaData&lt;WebView, FontSmoothingType&gt; FONT_SMOOTHING_TYPE
 838                 = new CssMetaData&lt;WebView, FontSmoothingType&gt;(
 839                 &quot;-fx-font-smoothing-type&quot;,
 840                 new EnumConverter&lt;FontSmoothingType&gt;(FontSmoothingType.class),
 841                 DEFAULT_FONT_SMOOTHING_TYPE) {
 842             @Override
 843             public boolean isSettable(WebView view) {
 844                 return view.fontSmoothingType == null || !view.fontSmoothingType.isBound();
 845             }
 846             @Override
 847             public StyleableProperty&lt;FontSmoothingType&gt; getStyleableProperty(WebView view) {
 848                 return (StyleableProperty&lt;FontSmoothingType&gt;)view.fontSmoothingTypeProperty();
 849             }
 850         };
 851 
 852         private static final CssMetaData&lt;WebView, Number&gt; ZOOM
 853                 = new CssMetaData&lt;WebView, Number&gt;(
 854                 &quot;-fx-zoom&quot;,
 855                 SizeConverter.getInstance(),
 856                 DEFAULT_ZOOM) {
 857             @Override public boolean isSettable(WebView view) {
 858                 return view.zoom == null || !view.zoom.isBound();
 859             }
 860             @Override public StyleableProperty&lt;Number&gt; getStyleableProperty(WebView view) {
 861                 return (StyleableProperty&lt;Number&gt;)view.zoomProperty();
 862             }
 863         };
 864 
 865         private static final CssMetaData&lt;WebView, Number&gt; FONT_SCALE
 866                 = new CssMetaData&lt;WebView, Number&gt;(
 867                 &quot;-fx-font-scale&quot;,
 868                 SizeConverter.getInstance(),
 869                 DEFAULT_FONT_SCALE) {
 870             @Override
 871             public boolean isSettable(WebView view) {
 872                 return view.fontScale == null || !view.fontScale.isBound();
 873             }
 874             @Override
 875             public StyleableProperty&lt;Number&gt; getStyleableProperty(WebView view) {
 876                 return (StyleableProperty&lt;Number&gt;)view.fontScaleProperty();
 877             }
 878         };
 879 
 880         private static final CssMetaData&lt;WebView, Number&gt; MIN_WIDTH
 881                 = new CssMetaData&lt;WebView, Number&gt;(
 882                 &quot;-fx-min-width&quot;,
 883                 SizeConverter.getInstance(),
 884                 DEFAULT_MIN_WIDTH) {
 885             @Override
 886             public boolean isSettable(WebView view) {
 887                 return view.minWidth == null || !view.minWidth.isBound();
 888             }
 889             @Override
 890             public StyleableProperty&lt;Number&gt; getStyleableProperty(WebView view) {
 891                 return (StyleableProperty&lt;Number&gt;)view.minWidthProperty();
 892             }
 893         };
 894 
 895         private static final CssMetaData&lt;WebView, Number&gt; MIN_HEIGHT
 896                 = new CssMetaData&lt;WebView, Number&gt;(
 897                 &quot;-fx-min-height&quot;,
 898                 SizeConverter.getInstance(),
 899                 DEFAULT_MIN_HEIGHT) {
 900             @Override
 901             public boolean isSettable(WebView view) {
 902                 return view.minHeight == null || !view.minHeight.isBound();
 903             }
 904             @Override
 905             public StyleableProperty&lt;Number&gt; getStyleableProperty(WebView view) {
 906                 return (StyleableProperty&lt;Number&gt;)view.minHeightProperty();
 907             }
 908         };
 909 
 910         private static final CssMetaData&lt;WebView, Number&gt; MAX_WIDTH
 911                 = new CssMetaData&lt;WebView, Number&gt;(
 912                 &quot;-fx-max-width&quot;,
 913                 SizeConverter.getInstance(),
 914                 DEFAULT_MAX_WIDTH) {
 915             @Override
 916             public boolean isSettable(WebView view) {
 917                 return view.maxWidth == null || !view.maxWidth.isBound();
 918             }
 919             @Override
 920             public StyleableProperty&lt;Number&gt; getStyleableProperty(WebView view) {
 921                 return (StyleableProperty&lt;Number&gt;)view.maxWidthProperty();
 922             }
 923         };
 924 
 925         private static final CssMetaData&lt;WebView, Number&gt; MAX_HEIGHT
 926                 = new CssMetaData&lt;WebView, Number&gt;(
 927                 &quot;-fx-max-height&quot;,
 928                 SizeConverter.getInstance(),
 929                 DEFAULT_MAX_HEIGHT) {
 930             @Override
 931             public boolean isSettable(WebView view) {
 932                 return view.maxHeight == null || !view.maxHeight.isBound();
 933             }
 934             @Override
 935             public StyleableProperty&lt;Number&gt; getStyleableProperty(WebView view) {
 936                 return (StyleableProperty&lt;Number&gt;)view.maxHeightProperty();
 937             }
 938         };
 939 
 940         private static final CssMetaData&lt;WebView, Number&gt; PREF_WIDTH
 941                 = new CssMetaData&lt;WebView, Number&gt;(
 942                 &quot;-fx-pref-width&quot;,
 943                 SizeConverter.getInstance(),
 944                 DEFAULT_PREF_WIDTH) {
 945             @Override
 946             public boolean isSettable(WebView view) {
 947                 return view.prefWidth == null || !view.prefWidth.isBound();
 948             }
 949             @Override
 950             public StyleableProperty&lt;Number&gt; getStyleableProperty(WebView view) {
 951                 return (StyleableProperty&lt;Number&gt;)view.prefWidthProperty();
 952             }
 953         };
 954 
 955         private static final CssMetaData&lt;WebView, Number&gt; PREF_HEIGHT
 956                 = new CssMetaData&lt;WebView, Number&gt;(
 957                 &quot;-fx-pref-height&quot;,
 958                 SizeConverter.getInstance(),
 959                 DEFAULT_PREF_HEIGHT) {
 960             @Override
 961             public boolean isSettable(WebView view) {
 962                 return view.prefHeight == null || !view.prefHeight.isBound();
 963             }
 964             @Override
 965             public StyleableProperty&lt;Number&gt; getStyleableProperty(WebView view) {
 966                 return (StyleableProperty&lt;Number&gt;)view.prefHeightProperty();
 967             }
 968         };
 969 
 970         private static final List&lt;CssMetaData&lt;? extends Styleable, ?&gt;&gt; STYLEABLES;
 971 
 972         static {
 973             List&lt;CssMetaData&lt;? extends Styleable, ?&gt;&gt; styleables
 974                     = new ArrayList&lt;CssMetaData&lt;? extends Styleable, ?&gt;&gt;(Parent.getClassCssMetaData());
 975             styleables.add(CONTEXT_MENU_ENABLED);
 976             styleables.add(FONT_SMOOTHING_TYPE);
 977             styleables.add(ZOOM);
 978             styleables.add(FONT_SCALE);
 979             styleables.add(MIN_WIDTH);
 980             styleables.add(PREF_WIDTH);
 981             styleables.add(MAX_WIDTH);
 982             styleables.add(MIN_HEIGHT);
 983             styleables.add(PREF_HEIGHT);
 984             styleables.add(MAX_HEIGHT);
 985             STYLEABLES = Collections.unmodifiableList(styleables);
 986          }
 987     }
 988 
 989     /**
 990      * @return The CssMetaData associated with this class, which may include the
 991      * CssMetaData of its superclasses.
 992      * @since JavaFX 8.0
 993      */
 994     public static List&lt;CssMetaData&lt;? extends Styleable, ?&gt;&gt; getClassCssMetaData() {
 995         return StyleableProperties.STYLEABLES;
 996     }
 997 
 998     /**
 999      * {@inheritDoc}
1000      * @since JavaFX 8.0
1001      */
1002     @Override
1003     public List&lt;CssMetaData&lt;? extends Styleable, ?&gt;&gt; getCssMetaData() {
1004         return getClassCssMetaData();
1005     }
1006 
1007     // event handling
1008 
1009     private void handleStagePulse() {
1010         // The stage pulse occurs before the scene pulse.
1011         // Here the page content is updated before CSS/Layout/Sync pass
1012         // is initiated by the scene pulse. The update may
1013         // change the WebView children and, if so, the children should be
1014         // processed right away during the scene pulse.
1015 
1016         // The WebView node does not render its pending render queues
1017         // while it is invisible. Therefore, we should not schedule new
1018         // render queues while the WebView is invisible to prevent
1019         // the list of render queues from growing infinitely.
1020         // Also, if and when the WebView becomes invisible, the currently
1021         // pending render queues, if any, become obsolete and should be
1022         // discarded.
1023 
1024         boolean reallyVisible = NodeHelper.isTreeVisible(this)
1025                 &amp;&amp; getScene() != null
1026                 &amp;&amp; getScene().getWindow() != null
1027                 &amp;&amp; getScene().getWindow().isShowing();
1028 
1029         if (reallyVisible) {
1030             if (NodeHelper.isDirty(this, DirtyBits.WEBVIEW_VIEW)) {
1031                 SceneHelper.setAllowPGAccess(true);
1032                 //getPGWebView().update(); // creates new render queues
1033                 SceneHelper.setAllowPGAccess(false);
1034             }
1035         } else {
1036             _setVisible(handle, false);
1037         }
1038     }
1039 
1040     @Override protected ObservableList&lt;Node&gt; getChildren() {
1041         return super.getChildren();
1042     }
1043 
1044     // Node stuff
1045 
1046     /*
1047      * Note: This method MUST only be called via its accessor method.
1048      */
1049     private NGNode doCreatePeer() {
1050         // return new NGWebView();
1051         return null; // iOS doesn&#39;t need this method.
1052     }
1053 
1054     /*
1055      * Note: This method MUST only be called via its accessor method.
1056      */
1057     private BaseBounds doComputeGeomBounds(BaseBounds bounds, BaseTransform tx) {
1058         bounds.deriveWithNewBounds(0, 0, 0, (float) getWidth(), (float)getHeight(), 0);
1059         tx.transform(bounds, bounds);
1060         return bounds;
1061     }
1062 
1063     /*
1064      * Note: This method MUST only be called via its accessor method.
1065      */
1066     private boolean doComputeContains(double localX, double localY) {
1067         // Note: Local bounds contain test is already done by the caller. (Node.contains()).
1068         return true;
1069     }
1070 
1071     /*
1072      * Note: This method MUST only be called via its accessor method.
1073      */
1074     private void doUpdatePeer() {
1075         //PGWebView peer = getPGWebView();
1076 
1077         if (NodeHelper.isDirty(this, DirtyBits.NODE_GEOMETRY)) {
1078             //peer.resize((float)getWidth(), (float)getHeight());
1079         }
1080         if (NodeHelper.isDirty(this, DirtyBits.WEBVIEW_VIEW)) {
1081             //peer.requestRender();
1082         }
1083     }
1084 
1085     private static Affine3D calculateNodeToSceneTransform(Node node) {
1086         final Affine3D transform = new Affine3D();
1087         do {
1088             transform.preConcatenate(NodeHelper.getLeafTransform(node));
1089             node = node.getParent();
1090         } while (node != null);
1091 
1092         return transform;
1093     }
1094 
1095     /*
1096      * Note: This method MUST only be called via its accessor method.
1097      */
1098     private void doTransformsChanged() {
1099         Affine3D trans = calculateNodeToSceneTransform(this);
1100         _setTransform(handle,
1101                 trans.getMxx(), trans.getMxy(), trans.getMxz(), trans.getMxt(),
1102                 trans.getMyx(), trans.getMyy(), trans.getMyz(), trans.getMyt(),
1103                 trans.getMzx(), trans.getMzy(), trans.getMzz(), trans.getMzt());
1104     }
1105 
1106     long getNativeHandle() {
1107         return handle;
1108     }
1109 
1110 
1111     // native callbacks
1112     private void notifyLoadStarted() {
1113         engine.notifyLoadStarted();
1114     }
1115     private void notifyLoadFinished(String loc, String content) {
1116         engine.notifyLoadFinished(loc, content);
1117     }
1118     private void notifyLoadFailed() {
1119         engine.notifyLoadFailed();
1120     }
1121     private void notifyJavaCall(String arg) {
1122         engine.notifyJavaCall(arg);
1123     }
1124 
1125 
1126     /* Inits native WebView and returns its pointer in the given array */
1127     private native void _initWebView(long[] nativeHandle);
1128 
1129     /* Sets width of the native WebView  */
1130     private native void _setWidth(long handle, double w);
1131 
1132     /* Sets height of the native WebView  */
1133     private native void _setHeight(long handle, double h);
1134 
1135     /* Sets visibility of the native WebView  */
1136     private native void _setVisible(long handle, boolean v);
1137 
1138     /* Removes the native WebView from scene */
1139     private native void _removeWebView(long handle);
1140 
1141     /* Applies transform on the native WebView  */
1142     private native void _setTransform(long handle,
1143             double mxx, double mxy, double mxz, double mxt,
1144             double myx, double myy, double myz, double myt,
1145             double mzx, double mzy, double mzz, double mzt);
1146 }
    </pre>
  </body>
</html>