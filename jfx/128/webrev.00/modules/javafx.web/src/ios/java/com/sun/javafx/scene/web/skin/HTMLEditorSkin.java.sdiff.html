<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/ios/java/com/sun/javafx/scene/web/skin/HTMLEditorSkin.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../behavior/HTMLEditorBehavior.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../javafx/scene/web/HTMLEditor.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/ios/java/com/sun/javafx/scene/web/skin/HTMLEditorSkin.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2010, 2016, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
<span class="line-modified">  26 package com.sun.javafx.scene.web.skin;</span>
  27 
  28 import java.util.ResourceBundle;
  29 import com.sun.javafx.scene.ParentHelper;
  30 import com.sun.javafx.application.PlatformImpl;
  31 import com.sun.javafx.scene.traversal.Algorithm;
  32 import com.sun.javafx.scene.traversal.Direction;
  33 import com.sun.javafx.scene.traversal.ParentTraversalEngine;
  34 import com.sun.javafx.scene.traversal.TraversalContext;
  35 import javafx.geometry.Orientation;
  36 import org.w3c.dom.html.HTMLDocument;
  37 import org.w3c.dom.html.HTMLElement;
  38 
  39 import javafx.application.ConditionalFeature;
  40 import javafx.application.Platform;
  41 import javafx.beans.value.ChangeListener;
  42 import javafx.beans.value.ObservableValue;
  43 import javafx.collections.FXCollections;
  44 import javafx.collections.ObservableList;
  45 import javafx.css.StyleableProperty;
  46 import javafx.event.ActionEvent;
</pre>
<hr />
<pre>
  60 import javafx.scene.control.Tooltip;
  61 import javafx.scene.image.Image;
  62 import javafx.scene.image.ImageView;
  63 import javafx.scene.input.KeyCode;
  64 import javafx.scene.input.KeyEvent;
  65 import javafx.scene.input.MouseEvent;
  66 import javafx.scene.layout.ColumnConstraints;
  67 import javafx.scene.layout.GridPane;
  68 import javafx.scene.layout.Priority;
  69 import javafx.scene.paint.Color;
  70 import javafx.scene.text.Font;
  71 import javafx.scene.web.HTMLEditor;
  72 import javafx.scene.web.WebView;
  73 import javafx.util.Callback;
  74 
  75 import javafx.scene.control.skin.ColorPickerSkin;
  76 import com.sun.javafx.scene.control.skin.FXVK;
  77 import com.sun.javafx.scene.web.behavior.HTMLEditorBehavior;
  78 import com.sun.javafx.scene.traversal.TraversalEngine;
  79 import com.sun.javafx.scene.traversal.TraverseListener;
<span class="line-removed">  80 //import com.sun.webkit.WebPage;</span>
<span class="line-removed">  81 //import com.sun.webkit.event.WCFocusEvent;</span>
<span class="line-removed">  82 //import com.sun.javafx.webkit.Accessor;</span>
  83 
  84 import java.security.AccessController;
  85 import java.security.PrivilegedAction;
  86 
  87 import java.util.HashMap;
  88 import java.util.Locale;
  89 import java.util.Map;
  90 import javafx.scene.Scene;
  91 import javafx.scene.control.*;
  92 import javafx.scene.layout.*;
<span class="line-removed">  93 import com.sun.javafx.scene.control.skin.BehaviorSkinBase;</span>
  94 import javafx.collections.ListChangeListener;
  95 
  96 import static javafx.geometry.NodeOrientation.*;
  97 



  98 /**
  99  * HTML editor skin.
 100  */
<span class="line-modified"> 101 public class HTMLEditorSkin extends BehaviorSkinBase&lt;HTMLEditor, HTMLEditorBehavior&gt; implements TraverseListener {</span>
 102     private GridPane gridPane;
 103 
 104     private ToolBar toolbar1;
 105     private ToolBar toolbar2;
 106 
 107     private Button cutButton;
 108     private Button copyButton;
 109     private Button pasteButton;
 110 
<span class="line-removed"> 111 //    private Button undoButton;</span>
<span class="line-removed"> 112 //    private Button redoButton;</span>
 113 
 114     private Button insertHorizontalRuleButton;
 115 
 116     private ToggleGroup alignmentToggleGroup;
 117     private ToggleButton alignLeftButton;
 118     private ToggleButton alignCenterButton;
 119     private ToggleButton alignRightButton;
 120     private ToggleButton alignJustifyButton;
 121 
 122     private ToggleButton bulletsButton;
 123     private ToggleButton numbersButton;
 124 
 125     private Button indentButton;
 126     private Button outdentButton;
 127 
 128     private ComboBox&lt;String&gt; formatComboBox;
 129     private Map&lt;String, String&gt; formatStyleMap;
 130     private Map&lt;String, String&gt; styleFormatMap;
 131 
 132     private ComboBox&lt;String&gt; fontFamilyComboBox;
 133 
 134     private ComboBox&lt;String&gt; fontSizeComboBox;
 135     private Map&lt;String, String&gt; fontSizeMap;
 136     private Map&lt;String, String&gt; sizeFontMap;
 137 
 138     private ToggleButton boldButton;
 139     private ToggleButton italicButton;
 140     private ToggleButton underlineButton;
 141     private ToggleButton strikethroughButton;
 142 
 143     private ColorPicker fgColorButton;
 144     private ColorPicker bgColorButton;
 145 
 146     private WebView webView;
<span class="line-removed"> 147 //    private WebPage webPage;</span>
 148 
 149     private static final String CUT_COMMAND = &quot;cut&quot;;
 150     private static final String COPY_COMMAND = &quot;copy&quot;;
 151     private static final String PASTE_COMMAND = &quot;paste&quot;;
 152 
 153     private static final String UNDO_COMMAND = &quot;undo&quot;;
 154     private static final String REDO_COMMAND = &quot;redo&quot;;
 155 
 156     private static final String INSERT_HORIZONTAL_RULE_COMMAND = &quot;inserthorizontalrule&quot;;
 157 
 158     private static final String ALIGN_LEFT_COMMAND = &quot;justifyleft&quot;;
 159     private static final String ALIGN_CENTER_COMMAND = &quot;justifycenter&quot;;
 160     private static final String ALIGN_RIGHT_COMMAND = &quot;justifyright&quot;;
 161     private static final String ALIGN_JUSTIFY_COMMAND = &quot;justifyfull&quot;;
 162 
 163     private static final String BULLETS_COMMAND = &quot;insertUnorderedList&quot;;
 164     private static final String NUMBERS_COMMAND = &quot;insertOrderedList&quot;;
 165 
 166     private static final String INDENT_COMMAND = &quot;indent&quot;;
 167     private static final String OUTDENT_COMMAND = &quot;outdent&quot;;
</pre>
<hr />
<pre>
 241 
 242     private ParentTraversalEngine engine;
 243 
 244     private boolean resetToolbarState = false;
 245     private String cachedHTMLText = &quot;&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;&quot;;
 246     private ListChangeListener&lt;Node&gt; itemsListener = new ListChangeListener&lt;Node&gt;() {
 247         @Override public void onChanged(ListChangeListener.Change&lt;? extends Node&gt; c) {
 248 //            while (c.next()) {
 249 //                if (c.getRemovedSize() &gt; 0) {
 250 //                    for (Node n : c.getList()) {
 251 //                        if (n instanceof WebView) {
 252 //                            // RT-28611 webView removed - set associated webPage to null
 253 //                            webPage.dispose();
 254 //                        }
 255 //                    }
 256 //                }
 257 //            }
 258         }
 259     };
 260     public HTMLEditorSkin(HTMLEditor htmlEditor) {
<span class="line-modified"> 261         super(htmlEditor, new HTMLEditorBehavior(htmlEditor));</span>
 262 
 263         getChildren().clear();
 264 
 265         gridPane = new GridPane();
 266         gridPane.getStyleClass().add(&quot;grid&quot;);
 267         getChildren().addAll(gridPane);
 268 
 269         toolbar1 = new ToolBar();
 270         toolbar1.getStyleClass().add(&quot;top-toolbar&quot;);
 271         gridPane.add(toolbar1, 0, 0);
 272 
 273         toolbar2 = new ToolBar();
 274         toolbar2.getStyleClass().add(&quot;bottom-toolbar&quot;);
 275         gridPane.add(toolbar2, 0, 1);
 276 
 277 //        populateToolbars();
 278 
 279         webView = new WebView();
 280         gridPane.add(/*webView*/IOS_UNSUPPORTED_LABEL, 0, 2);
 281 
</pre>
<hr />
<pre>
 747 
 748         toolbar2.getItems().add(new Separator());
 749 
 750         insertHorizontalRuleButton = addButton(toolbar2, resources.getString(&quot;insertHorizontalRuleIcon&quot;),
 751             resources.getString(&quot;insertHorizontalRule&quot;), INSERT_HORIZONTAL_RULE_COMMAND, &quot;html-editor-hr&quot;);
 752         // We override setOnAction to insert a new line.  This fixes RT-16453
 753         insertHorizontalRuleButton.setOnAction(new EventHandler&lt;ActionEvent&gt;() {
 754             @Override
 755             public void handle(ActionEvent event) {
 756                 executeCommand(INSERT_NEW_LINE_COMMAND, null);
 757                 executeCommand(INSERT_HORIZONTAL_RULE_COMMAND, null);
 758                 updateToolbarState(false);
 759             }
 760         });
 761 
 762         fgColorButton = new ColorPicker();
 763         fgColorButton.getStyleClass().add(&quot;html-editor-foreground&quot;);
 764         fgColorButton.setFocusTraversable(false);
 765         toolbar1.getItems().add(fgColorButton);
 766 
<span class="line-modified"> 767         fgColorButton.applyCss();</span>
<span class="line-modified"> 768         ColorPickerSkin fgColorPickerSkin = (ColorPickerSkin) fgColorButton.getSkin();</span>
<span class="line-modified"> 769         String fgIcon = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;() {</span>
<span class="line-modified"> 770             @Override public String run() {</span>
<span class="line-modified"> 771                 return HTMLEditorSkin.class.getResource(resources.getString(&quot;foregroundColorIcon&quot;)).toString();</span>
<span class="line-modified"> 772             }</span>
<span class="line-modified"> 773         });</span>
<span class="line-modified"> 774         ((StyleableProperty)fgColorPickerSkin.imageUrlProperty()).applyStyle(null,fgIcon);</span>
 775 
 776         fgColorButton.setValue(DEFAULT_FG_COLOR);
 777         fgColorButton.setTooltip(new Tooltip(resources.getString(&quot;foregroundColor&quot;)));
 778         fgColorButton.setOnAction(new EventHandler&lt;ActionEvent&gt;() {
 779             @Override public void handle(ActionEvent ev) {
 780                 Color newValue = fgColorButton.getValue();
 781                 if (newValue != null) {
 782                     executeCommand(FOREGROUND_COLOR_COMMAND, colorValueToHex(newValue));
 783                     fgColorButton.hide();
 784                 }
 785             }
 786         });
 787 
 788         bgColorButton = new ColorPicker();
 789         bgColorButton.getStyleClass().add(&quot;html-editor-background&quot;);
 790         bgColorButton.setFocusTraversable(false);
 791         toolbar1.getItems().add(bgColorButton);
 792 
<span class="line-modified"> 793         bgColorButton.applyCss();</span>
<span class="line-modified"> 794         ColorPickerSkin  bgColorPickerSkin = (ColorPickerSkin) bgColorButton.getSkin();</span>
<span class="line-modified"> 795         String bgIcon = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;() {</span>
<span class="line-modified"> 796             @Override public String run() {</span>
<span class="line-modified"> 797                 return HTMLEditorSkin.class.getResource(resources.getString(&quot;backgroundColorIcon&quot;)).toString();</span>
<span class="line-modified"> 798             }</span>
<span class="line-modified"> 799         });</span>
<span class="line-modified"> 800         ((StyleableProperty)bgColorPickerSkin.imageUrlProperty()).applyStyle(null,bgIcon);</span>
 801 
 802         bgColorButton.setValue(DEFAULT_BG_COLOR);
 803         bgColorButton.setTooltip(new Tooltip(resources.getString(&quot;backgroundColor&quot;)));
 804 
 805         bgColorButton.setOnAction(new EventHandler&lt;ActionEvent&gt;() {
 806             @Override public void handle(ActionEvent ev) {
 807                 Color newValue = bgColorButton.getValue();
 808                 if (newValue != null) {
 809                     executeCommand(BACKGROUND_COLOR_COMMAND, colorValueToHex(newValue));
 810                     bgColorButton.hide();
 811                 }
 812             }
 813         });
 814     }
 815 
 816     private String colorValueToHex(Color c) {
 817         return String.format((Locale)null, &quot;#%02x%02x%02x&quot;,
 818                              Math.round(c.getRed() * 255),
 819                              Math.round(c.getGreen() * 255),
 820                              Math.round(c.getBlue() * 255));
</pre>
<hr />
<pre>
1203     @Override
1204     protected void layoutChildren(final double x, final double y,
1205             final double w, final double h) {
1206 
1207         if (isFirstRun) {
1208             populateToolbars();
1209             isFirstRun = false;
1210         }
1211         super.layoutChildren(x,y,w,h);
1212         double toolbarWidth = Math.max(toolbar1.prefWidth(-1), toolbar2.prefWidth(-1));
1213         toolbar1.setMinWidth(toolbarWidth);
1214         toolbar1.setPrefWidth(toolbarWidth);
1215         toolbar2.setMinWidth(toolbarWidth);
1216         toolbar2.setPrefWidth(toolbarWidth);
1217     }
1218 
1219     private static final int FONT_FAMILY_MENUBUTTON_WIDTH = 150;
1220     private static final int FONT_FAMILY_MENU_WIDTH = 100;
1221     private static final int FONT_SIZE_MENUBUTTON_WIDTH = 80;
1222 

























































1223 }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2010, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
<span class="line-modified">  26 package javafx.scene.web;</span>
  27 
  28 import java.util.ResourceBundle;
  29 import com.sun.javafx.scene.ParentHelper;
  30 import com.sun.javafx.application.PlatformImpl;
  31 import com.sun.javafx.scene.traversal.Algorithm;
  32 import com.sun.javafx.scene.traversal.Direction;
  33 import com.sun.javafx.scene.traversal.ParentTraversalEngine;
  34 import com.sun.javafx.scene.traversal.TraversalContext;
  35 import javafx.geometry.Orientation;
  36 import org.w3c.dom.html.HTMLDocument;
  37 import org.w3c.dom.html.HTMLElement;
  38 
  39 import javafx.application.ConditionalFeature;
  40 import javafx.application.Platform;
  41 import javafx.beans.value.ChangeListener;
  42 import javafx.beans.value.ObservableValue;
  43 import javafx.collections.FXCollections;
  44 import javafx.collections.ObservableList;
  45 import javafx.css.StyleableProperty;
  46 import javafx.event.ActionEvent;
</pre>
<hr />
<pre>
  60 import javafx.scene.control.Tooltip;
  61 import javafx.scene.image.Image;
  62 import javafx.scene.image.ImageView;
  63 import javafx.scene.input.KeyCode;
  64 import javafx.scene.input.KeyEvent;
  65 import javafx.scene.input.MouseEvent;
  66 import javafx.scene.layout.ColumnConstraints;
  67 import javafx.scene.layout.GridPane;
  68 import javafx.scene.layout.Priority;
  69 import javafx.scene.paint.Color;
  70 import javafx.scene.text.Font;
  71 import javafx.scene.web.HTMLEditor;
  72 import javafx.scene.web.WebView;
  73 import javafx.util.Callback;
  74 
  75 import javafx.scene.control.skin.ColorPickerSkin;
  76 import com.sun.javafx.scene.control.skin.FXVK;
  77 import com.sun.javafx.scene.web.behavior.HTMLEditorBehavior;
  78 import com.sun.javafx.scene.traversal.TraversalEngine;
  79 import com.sun.javafx.scene.traversal.TraverseListener;



  80 
  81 import java.security.AccessController;
  82 import java.security.PrivilegedAction;
  83 
  84 import java.util.HashMap;
  85 import java.util.Locale;
  86 import java.util.Map;
  87 import javafx.scene.Scene;
  88 import javafx.scene.control.*;
  89 import javafx.scene.layout.*;

  90 import javafx.collections.ListChangeListener;
  91 
  92 import static javafx.geometry.NodeOrientation.*;
  93 
<span class="line-added">  94 import static javafx.scene.web.HTMLEditorSkin.Command.*;</span>
<span class="line-added">  95 </span>
<span class="line-added">  96 </span>
  97 /**
  98  * HTML editor skin.
  99  */
<span class="line-modified"> 100 public class HTMLEditorSkin extends SkinBase&lt;HTMLEditor&gt; implements TraverseListener {</span>
 101     private GridPane gridPane;
 102 
 103     private ToolBar toolbar1;
 104     private ToolBar toolbar2;
 105 
 106     private Button cutButton;
 107     private Button copyButton;
 108     private Button pasteButton;
 109 


 110 
 111     private Button insertHorizontalRuleButton;
 112 
 113     private ToggleGroup alignmentToggleGroup;
 114     private ToggleButton alignLeftButton;
 115     private ToggleButton alignCenterButton;
 116     private ToggleButton alignRightButton;
 117     private ToggleButton alignJustifyButton;
 118 
 119     private ToggleButton bulletsButton;
 120     private ToggleButton numbersButton;
 121 
 122     private Button indentButton;
 123     private Button outdentButton;
 124 
 125     private ComboBox&lt;String&gt; formatComboBox;
 126     private Map&lt;String, String&gt; formatStyleMap;
 127     private Map&lt;String, String&gt; styleFormatMap;
 128 
 129     private ComboBox&lt;String&gt; fontFamilyComboBox;
 130 
 131     private ComboBox&lt;String&gt; fontSizeComboBox;
 132     private Map&lt;String, String&gt; fontSizeMap;
 133     private Map&lt;String, String&gt; sizeFontMap;
 134 
 135     private ToggleButton boldButton;
 136     private ToggleButton italicButton;
 137     private ToggleButton underlineButton;
 138     private ToggleButton strikethroughButton;
 139 
 140     private ColorPicker fgColorButton;
 141     private ColorPicker bgColorButton;
 142 
 143     private WebView webView;

 144 
 145     private static final String CUT_COMMAND = &quot;cut&quot;;
 146     private static final String COPY_COMMAND = &quot;copy&quot;;
 147     private static final String PASTE_COMMAND = &quot;paste&quot;;
 148 
 149     private static final String UNDO_COMMAND = &quot;undo&quot;;
 150     private static final String REDO_COMMAND = &quot;redo&quot;;
 151 
 152     private static final String INSERT_HORIZONTAL_RULE_COMMAND = &quot;inserthorizontalrule&quot;;
 153 
 154     private static final String ALIGN_LEFT_COMMAND = &quot;justifyleft&quot;;
 155     private static final String ALIGN_CENTER_COMMAND = &quot;justifycenter&quot;;
 156     private static final String ALIGN_RIGHT_COMMAND = &quot;justifyright&quot;;
 157     private static final String ALIGN_JUSTIFY_COMMAND = &quot;justifyfull&quot;;
 158 
 159     private static final String BULLETS_COMMAND = &quot;insertUnorderedList&quot;;
 160     private static final String NUMBERS_COMMAND = &quot;insertOrderedList&quot;;
 161 
 162     private static final String INDENT_COMMAND = &quot;indent&quot;;
 163     private static final String OUTDENT_COMMAND = &quot;outdent&quot;;
</pre>
<hr />
<pre>
 237 
 238     private ParentTraversalEngine engine;
 239 
 240     private boolean resetToolbarState = false;
 241     private String cachedHTMLText = &quot;&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;&quot;;
 242     private ListChangeListener&lt;Node&gt; itemsListener = new ListChangeListener&lt;Node&gt;() {
 243         @Override public void onChanged(ListChangeListener.Change&lt;? extends Node&gt; c) {
 244 //            while (c.next()) {
 245 //                if (c.getRemovedSize() &gt; 0) {
 246 //                    for (Node n : c.getList()) {
 247 //                        if (n instanceof WebView) {
 248 //                            // RT-28611 webView removed - set associated webPage to null
 249 //                            webPage.dispose();
 250 //                        }
 251 //                    }
 252 //                }
 253 //            }
 254         }
 255     };
 256     public HTMLEditorSkin(HTMLEditor htmlEditor) {
<span class="line-modified"> 257         super(htmlEditor);</span>
 258 
 259         getChildren().clear();
 260 
 261         gridPane = new GridPane();
 262         gridPane.getStyleClass().add(&quot;grid&quot;);
 263         getChildren().addAll(gridPane);
 264 
 265         toolbar1 = new ToolBar();
 266         toolbar1.getStyleClass().add(&quot;top-toolbar&quot;);
 267         gridPane.add(toolbar1, 0, 0);
 268 
 269         toolbar2 = new ToolBar();
 270         toolbar2.getStyleClass().add(&quot;bottom-toolbar&quot;);
 271         gridPane.add(toolbar2, 0, 1);
 272 
 273 //        populateToolbars();
 274 
 275         webView = new WebView();
 276         gridPane.add(/*webView*/IOS_UNSUPPORTED_LABEL, 0, 2);
 277 
</pre>
<hr />
<pre>
 743 
 744         toolbar2.getItems().add(new Separator());
 745 
 746         insertHorizontalRuleButton = addButton(toolbar2, resources.getString(&quot;insertHorizontalRuleIcon&quot;),
 747             resources.getString(&quot;insertHorizontalRule&quot;), INSERT_HORIZONTAL_RULE_COMMAND, &quot;html-editor-hr&quot;);
 748         // We override setOnAction to insert a new line.  This fixes RT-16453
 749         insertHorizontalRuleButton.setOnAction(new EventHandler&lt;ActionEvent&gt;() {
 750             @Override
 751             public void handle(ActionEvent event) {
 752                 executeCommand(INSERT_NEW_LINE_COMMAND, null);
 753                 executeCommand(INSERT_HORIZONTAL_RULE_COMMAND, null);
 754                 updateToolbarState(false);
 755             }
 756         });
 757 
 758         fgColorButton = new ColorPicker();
 759         fgColorButton.getStyleClass().add(&quot;html-editor-foreground&quot;);
 760         fgColorButton.setFocusTraversable(false);
 761         toolbar1.getItems().add(fgColorButton);
 762 
<span class="line-modified"> 763         // fgColorButton.applyCss();</span>
<span class="line-modified"> 764         // ColorPickerSkin fgColorPickerSkin = (ColorPickerSkin) fgColorButton.getSkin();</span>
<span class="line-modified"> 765         // String fgIcon = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;() {</span>
<span class="line-modified"> 766             // @Override public String run() {</span>
<span class="line-modified"> 767                 // return HTMLEditorSkin.class.getResource(resources.getString(&quot;foregroundColorIcon&quot;)).toString();</span>
<span class="line-modified"> 768             // }</span>
<span class="line-modified"> 769         // });</span>
<span class="line-modified"> 770         // ((StyleableProperty)fgColorPickerSkin.imageUrlProperty()).applyStyle(null,fgIcon);</span>
 771 
 772         fgColorButton.setValue(DEFAULT_FG_COLOR);
 773         fgColorButton.setTooltip(new Tooltip(resources.getString(&quot;foregroundColor&quot;)));
 774         fgColorButton.setOnAction(new EventHandler&lt;ActionEvent&gt;() {
 775             @Override public void handle(ActionEvent ev) {
 776                 Color newValue = fgColorButton.getValue();
 777                 if (newValue != null) {
 778                     executeCommand(FOREGROUND_COLOR_COMMAND, colorValueToHex(newValue));
 779                     fgColorButton.hide();
 780                 }
 781             }
 782         });
 783 
 784         bgColorButton = new ColorPicker();
 785         bgColorButton.getStyleClass().add(&quot;html-editor-background&quot;);
 786         bgColorButton.setFocusTraversable(false);
 787         toolbar1.getItems().add(bgColorButton);
 788 
<span class="line-modified"> 789         // bgColorButton.applyCss();</span>
<span class="line-modified"> 790         // ColorPickerSkin  bgColorPickerSkin = (ColorPickerSkin) bgColorButton.getSkin();</span>
<span class="line-modified"> 791         // String bgIcon = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;() {</span>
<span class="line-modified"> 792             // @Override public String run() {</span>
<span class="line-modified"> 793                 // return HTMLEditorSkin.class.getResource(resources.getString(&quot;backgroundColorIcon&quot;)).toString();</span>
<span class="line-modified"> 794             // }</span>
<span class="line-modified"> 795         // });</span>
<span class="line-modified"> 796         // ((StyleableProperty)bgColorPickerSkin.imageUrlProperty()).applyStyle(null,bgIcon);</span>
 797 
 798         bgColorButton.setValue(DEFAULT_BG_COLOR);
 799         bgColorButton.setTooltip(new Tooltip(resources.getString(&quot;backgroundColor&quot;)));
 800 
 801         bgColorButton.setOnAction(new EventHandler&lt;ActionEvent&gt;() {
 802             @Override public void handle(ActionEvent ev) {
 803                 Color newValue = bgColorButton.getValue();
 804                 if (newValue != null) {
 805                     executeCommand(BACKGROUND_COLOR_COMMAND, colorValueToHex(newValue));
 806                     bgColorButton.hide();
 807                 }
 808             }
 809         });
 810     }
 811 
 812     private String colorValueToHex(Color c) {
 813         return String.format((Locale)null, &quot;#%02x%02x%02x&quot;,
 814                              Math.round(c.getRed() * 255),
 815                              Math.round(c.getGreen() * 255),
 816                              Math.round(c.getBlue() * 255));
</pre>
<hr />
<pre>
1199     @Override
1200     protected void layoutChildren(final double x, final double y,
1201             final double w, final double h) {
1202 
1203         if (isFirstRun) {
1204             populateToolbars();
1205             isFirstRun = false;
1206         }
1207         super.layoutChildren(x,y,w,h);
1208         double toolbarWidth = Math.max(toolbar1.prefWidth(-1), toolbar2.prefWidth(-1));
1209         toolbar1.setMinWidth(toolbarWidth);
1210         toolbar1.setPrefWidth(toolbarWidth);
1211         toolbar2.setMinWidth(toolbarWidth);
1212         toolbar2.setPrefWidth(toolbarWidth);
1213     }
1214 
1215     private static final int FONT_FAMILY_MENUBUTTON_WIDTH = 150;
1216     private static final int FONT_FAMILY_MENU_WIDTH = 100;
1217     private static final int FONT_SIZE_MENUBUTTON_WIDTH = 80;
1218 
<span class="line-added">1219     public void performCommand(final Command command) {</span>
<span class="line-added">1220         switch (command) {</span>
<span class="line-added">1221             case BOLD: boldButton.fire(); break;</span>
<span class="line-added">1222             case ITALIC: italicButton.setSelected(!italicButton.isSelected()); break;</span>
<span class="line-added">1223             case UNDERLINE: underlineButton.setSelected(!underlineButton.isSelected()); break;</span>
<span class="line-added">1224         }</span>
<span class="line-added">1225     }</span>
<span class="line-added">1226 </span>
<span class="line-added">1227     public enum Command {</span>
<span class="line-added">1228         CUT(&quot;cut&quot;),</span>
<span class="line-added">1229         COPY(&quot;copy&quot;),</span>
<span class="line-added">1230         PASTE(&quot;paste&quot;),</span>
<span class="line-added">1231 </span>
<span class="line-added">1232         UNDO(&quot;undo&quot;),</span>
<span class="line-added">1233         REDO(&quot;redo&quot;),</span>
<span class="line-added">1234 </span>
<span class="line-added">1235         INSERT_HORIZONTAL_RULE(&quot;inserthorizontalrule&quot;),</span>
<span class="line-added">1236 </span>
<span class="line-added">1237         ALIGN_LEFT(&quot;justifyleft&quot;),</span>
<span class="line-added">1238         ALIGN_CENTER(&quot;justifycenter&quot;),</span>
<span class="line-added">1239         ALIGN_RIGHT(&quot;justifyright&quot;),</span>
<span class="line-added">1240         ALIGN_JUSTIFY(&quot;justifyfull&quot;),</span>
<span class="line-added">1241 </span>
<span class="line-added">1242         BULLETS(&quot;insertUnorderedList&quot;),</span>
<span class="line-added">1243         NUMBERS(&quot;insertOrderedList&quot;),</span>
<span class="line-added">1244 </span>
<span class="line-added">1245         INDENT(&quot;indent&quot;),</span>
<span class="line-added">1246         OUTDENT(&quot;outdent&quot;),</span>
<span class="line-added">1247 </span>
<span class="line-added">1248         FORMAT(&quot;formatblock&quot;),</span>
<span class="line-added">1249         FONT_FAMILY(&quot;fontname&quot;),</span>
<span class="line-added">1250         FONT_SIZE(&quot;fontsize&quot;),</span>
<span class="line-added">1251 </span>
<span class="line-added">1252         BOLD(&quot;bold&quot;),</span>
<span class="line-added">1253         ITALIC(&quot;italic&quot;),</span>
<span class="line-added">1254         UNDERLINE(&quot;underline&quot;),</span>
<span class="line-added">1255         STRIKETHROUGH(&quot;strikethrough&quot;),</span>
<span class="line-added">1256 </span>
<span class="line-added">1257         FOREGROUND_COLOR(&quot;forecolor&quot;),</span>
<span class="line-added">1258         BACKGROUND_COLOR(&quot;backcolor&quot;),</span>
<span class="line-added">1259         STYLEWITHCSS(&quot;styleWithCSS&quot;),</span>
<span class="line-added">1260 </span>
<span class="line-added">1261         INSERT_NEW_LINE(&quot;insertnewline&quot;),</span>
<span class="line-added">1262         INSERT_TAB(&quot;inserttab&quot;);</span>
<span class="line-added">1263 </span>
<span class="line-added">1264         private final String command;</span>
<span class="line-added">1265 </span>
<span class="line-added">1266         Command(String command) {</span>
<span class="line-added">1267             this.command = command;</span>
<span class="line-added">1268         }</span>
<span class="line-added">1269 </span>
<span class="line-added">1270         public String getCommand() {</span>
<span class="line-added">1271             return command;</span>
<span class="line-added">1272         }</span>
<span class="line-added">1273     }</span>
<span class="line-added">1274 </span>
<span class="line-added">1275 </span>
1276 }
</pre>
</td>
</tr>
</table>
<center><a href="../behavior/HTMLEditorBehavior.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../javafx/scene/web/HTMLEditor.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>