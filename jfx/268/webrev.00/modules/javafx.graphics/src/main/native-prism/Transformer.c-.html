<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old modules/javafx.graphics/src/main/native-prism/Transformer.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &lt;jni.h&gt;
 27 
 28 #include &quot;Transformer.h&quot;
 29 
 30 #define this (*((Transformer *) pTransformer))
 31 
 32 #define TX_Declare(TX_TYPE)                     \
 33 static MoveToFunc       TX_TYPE ## _moveTo;     \
 34 static LineToFunc       TX_TYPE ## _lineTo;     \
 35 static QuadToFunc       TX_TYPE ## _quadTo;     \
 36 static CurveToFunc      TX_TYPE ## _curveTo;
 37 
 38 TX_Declare(Translate)
 39 TX_Declare(DeltaScale)
 40 TX_Declare(ScaleTranslate)
 41 TX_Declare(DeltaTransform)
 42 TX_Declare(Transform)
 43 
 44 static ClosePathFunc    Transformer_closePath;
 45 static PathDoneFunc     Transformer_pathDone;
 46 
 47 #define TX_Init(TX_TYPE)                          \
 48     PathConsumer_init(&amp;pTransformer-&gt;consumer,    \
 49                       TX_TYPE ## _moveTo,         \
 50                       TX_TYPE ## _lineTo,         \
 51                       TX_TYPE ## _quadTo,         \
 52                       TX_TYPE ## _curveTo,        \
 53                       Transformer_closePath,      \
 54                       Transformer_pathDone)
 55 
 56 PathConsumer *Transformer_init(Transformer *pTransformer,
 57                                PathConsumer *out,
 58                                jdouble mxx, jdouble mxy, jdouble mxt,
 59                                jdouble myx, jdouble myy, jdouble myt)
 60 {
 61     if (mxy == 0.0 &amp;&amp; myx == 0.0) {
 62         if (mxx == 1.0 &amp;&amp; myy == 1.0) {
 63             if (mxt == 0.0 &amp;&amp; myt == 0.0) {
 64                 return out;
 65             } else {
 66                 TX_Init(Translate);
 67             }
 68         } else {
 69             if (mxt == 0.0 &amp;&amp; myt == 0.0) {
 70                 TX_Init(DeltaScale);
 71             } else {
 72                 TX_Init(ScaleTranslate);
 73             }
 74         }
 75     } else if (mxt == 0.0 &amp;&amp; myt == 0.0) {
 76         TX_Init(DeltaTransform);
 77     } else {
 78         TX_Init(Transform);
 79     }
 80 
 81     this.out = out;
 82     this.mxx = mxx;
 83     this.mxy = mxy;
 84     this.mxt = mxt;
 85     this.myx = myx;
 86     this.myy = myy;
 87     this.myt = myt;
 88     return &amp;pTransformer-&gt;consumer;
 89 }
 90 
 91 static jint Translate_moveTo(PathConsumer *pTransformer,
 92                              jfloat x0, jfloat y0)
 93 {
 94     return this.out-&gt;moveTo(this.out,
 95                      (jfloat) (x0 + this.mxt),
 96                      (jfloat) (y0 + this.myt));
 97 }
 98 
 99 static jint Translate_lineTo(PathConsumer *pTransformer,
100                              jfloat x1, jfloat y1)
101 {
102     return this.out-&gt;lineTo(this.out,
103                      (jfloat) (x1 + this.mxt),
104                      (jfloat) (y1 + this.myt));
105 }
106 
107 static jint Translate_quadTo(PathConsumer *pTransformer,
108                              jfloat xc, jfloat yc,
109                              jfloat x1, jfloat y1)
110 {
111     return this.out-&gt;quadTo(this.out,
112                      (jfloat) (xc + this.mxt),
113                      (jfloat) (yc + this.myt),
114                      (jfloat) (x1 + this.mxt),
115                      (jfloat) (y1 + this.myt));
116 }
117 
118 static jint Translate_curveTo(PathConsumer *pTransformer,
119                               jfloat xc0, jfloat yc0,
120                               jfloat xc1, jfloat yc1,
121                               jfloat x1, jfloat y1)
122 {
123     return this.out-&gt;curveTo(this.out,
124                       (jfloat) (xc0 + this.mxt),
125                       (jfloat) (yc0 + this.myt),
126                       (jfloat) (xc1 + this.mxt),
127                       (jfloat) (yc1 + this.myt),
128                       (jfloat) (x1  + this.mxt),
129                       (jfloat) (y1  + this.myt));
130 }
131 
132 static jint DeltaScale_moveTo(PathConsumer *pTransformer,
133                               jfloat x0, jfloat y0)
134 {
135     return this.out-&gt;moveTo(this.out,
136                      (jfloat) (x0 * this.mxx),
137                      (jfloat) (y0 * this.myy));
138 }
139 
140 static jint DeltaScale_lineTo(PathConsumer *pTransformer,
141                               jfloat x1, jfloat y1)
142 {
143     return this.out-&gt;lineTo(this.out,
144                      (jfloat) (x1 * this.mxx),
145                      (jfloat) (y1 * this.myy));
146 }
147 
148 static jint DeltaScale_quadTo(PathConsumer *pTransformer,
149                               jfloat xc, jfloat yc,
150                               jfloat x1, jfloat y1)
151 {
152     return this.out-&gt;quadTo(this.out,
153                      (jfloat) (xc * this.mxx),
154                      (jfloat) (yc * this.myy),
155                      (jfloat) (x1 * this.mxx),
156                      (jfloat) (y1 * this.myy));
157 }
158 
159 static jint DeltaScale_curveTo(PathConsumer *pTransformer,
160                                jfloat xc0, jfloat yc0,
161                                jfloat xc1, jfloat yc1,
162                                jfloat x1, jfloat y1)
163 {
164     return this.out-&gt;curveTo(this.out,
165                       (jfloat) (xc0 * this.mxx),
166                       (jfloat) (yc0 * this.myy),
167                       (jfloat) (xc1 * this.mxx),
168                       (jfloat) (yc1 * this.myy),
169                       (jfloat) (x1  * this.mxx),
170                       (jfloat) (y1  * this.myy));
171 }
172 
173 static jint DeltaTransform_moveTo(PathConsumer *pTransformer,
174                                   jfloat x0, jfloat y0)
175 {
176     return this.out-&gt;moveTo(this.out,
177                      (jfloat) (x0 * this.mxx + y0 * this.mxy),
178                      (jfloat) (x0 * this.myx + y0 * this.myy));
179 }
180 
181 static jint DeltaTransform_lineTo(PathConsumer *pTransformer,
182                                   jfloat x1, jfloat y1)
183 {
184     return this.out-&gt;lineTo(this.out,
185                      (jfloat) (x1 * this.mxx + y1 * this.mxy),
186                      (jfloat) (x1 * this.myx + y1 * this.myy));
187 }
188 
189 static jint DeltaTransform_quadTo(PathConsumer *pTransformer,
190                                   jfloat xc, jfloat yc,
191                                   jfloat x1, jfloat y1)
192 {
193     return this.out-&gt;quadTo(this.out,
194                      (jfloat) (xc * this.mxx + yc * this.mxy),
195                      (jfloat) (xc * this.myx + yc * this.myy),
196                      (jfloat) (x1 * this.mxx + y1 * this.mxy),
197                      (jfloat) (x1 * this.myx + y1 * this.myy));
198 }
199 
200 static jint DeltaTransform_curveTo(PathConsumer *pTransformer,
201                                    jfloat xc0, jfloat yc0,
202                                    jfloat xc1, jfloat yc1,
203                                    jfloat x1, jfloat y1)
204 {
205     return this.out-&gt;curveTo(this.out,
206                       (jfloat) (xc0 * this.mxx + yc0 * this.mxy),
207                       (jfloat) (xc0 * this.myx + yc0 * this.myy),
208                       (jfloat) (xc1 * this.mxx + yc1 * this.mxy),
209                       (jfloat) (xc1 * this.myx + yc1 * this.myy),
210                       (jfloat) (x1  * this.mxx + y1  * this.mxy),
211                       (jfloat) (x1  * this.myx + y1  * this.myy));
212 }
213 
214 static jint ScaleTranslate_moveTo(PathConsumer *pTransformer,
215                                   jfloat x0, jfloat y0)
216 {
217     return this.out-&gt;moveTo(this.out,
218                      (jfloat) (x0 * this.mxx + this.mxt),
219                      (jfloat) (y0 * this.myy + this.myt));
220 }
221 
222 static jint ScaleTranslate_lineTo(PathConsumer *pTransformer,
223                                   jfloat x1, jfloat y1)
224 {
225     return this.out-&gt;lineTo(this.out,
226                      (jfloat) (x1 * this.mxx + this.mxt),
227                      (jfloat) (y1 * this.myy + this.myt));
228 }
229 
230 static jint ScaleTranslate_quadTo(PathConsumer *pTransformer,
231                                   jfloat xc, jfloat yc,
232                                   jfloat x1, jfloat y1)
233 {
234     return this.out-&gt;quadTo(this.out,
235                      (jfloat) (xc * this.mxx + this.mxt),
236                      (jfloat) (yc * this.myy + this.myt),
237                      (jfloat) (x1 * this.mxx + this.mxt),
238                      (jfloat) (y1 * this.myy + this.myt));
239 }
240 
241 static jint ScaleTranslate_curveTo(PathConsumer *pTransformer,
242                                    jfloat xc0, jfloat yc0,
243                                    jfloat xc1, jfloat yc1,
244                                    jfloat x1, jfloat y1)
245 {
246     return this.out-&gt;curveTo(this.out,
247                       (jfloat) (xc0 * this.mxx + this.mxt),
248                       (jfloat) (yc0 * this.myy + this.myt),
249                       (jfloat) (xc1 * this.mxx + this.mxt),
250                       (jfloat) (yc1 * this.myy + this.myt),
251                       (jfloat) (x1  * this.mxx + this.mxt),
252                       (jfloat) (y1  * this.myy + this.myt));
253 }
254 
255 static jint Transform_moveTo(PathConsumer *pTransformer,
256                              jfloat x0, jfloat y0)
257 {
258     return this.out-&gt;moveTo(this.out,
259                      (jfloat) (x0 * this.mxx + y0 * this.mxy + this.mxt),
260                      (jfloat) (x0 * this.myx + y0 * this.myy + this.myt));
261 }
262 
263 static jint Transform_lineTo(PathConsumer *pTransformer,
264                              jfloat x1, jfloat y1)
265 {
266     return this.out-&gt;lineTo(this.out,
267                      (jfloat) (x1 * this.mxx + y1 * this.mxy + this.mxt),
268                      (jfloat) (x1 * this.myx + y1 * this.myy + this.myt));
269 }
270 
271 static jint Transform_quadTo(PathConsumer *pTransformer,
272                              jfloat xc, jfloat yc,
273                              jfloat x1, jfloat y1)
274 {
275     return this.out-&gt;quadTo(this.out,
276                      (jfloat) (xc * this.mxx + yc * this.mxy + this.mxt),
277                      (jfloat) (xc * this.myx + yc * this.myy + this.myt),
278                      (jfloat) (x1 * this.mxx + y1 * this.mxy + this.mxt),
279                      (jfloat) (x1 * this.myx + y1 * this.myy + this.myt));
280 }
281 
282 static jint Transform_curveTo(PathConsumer *pTransformer,
283                               jfloat xc0, jfloat yc0,
284                               jfloat xc1, jfloat yc1,
285                               jfloat x1, jfloat y1)
286 {
287     return this.out-&gt;curveTo(this.out,
288                       (jfloat) (xc0 * this.mxx + yc0 * this.mxy + this.mxt),
289                       (jfloat) (xc0 * this.myx + yc0 * this.myy + this.myt),
290                       (jfloat) (xc1 * this.mxx + yc1 * this.mxy + this.mxt),
291                       (jfloat) (xc1 * this.myx + yc1 * this.myy + this.myt),
292                       (jfloat) (x1  * this.mxx + y1  * this.mxy + this.mxt),
293                       (jfloat) (x1  * this.myx + y1  * this.myy + this.myt));
294 }
295 
296 static jint Transformer_closePath(PathConsumer *pTransformer) {
297     return this.out-&gt;closePath(this.out);
298 }
299 
300 static jint Transformer_pathDone(PathConsumer *pTransformer) {
301     return this.out-&gt;pathDone(this.out);
302 }
    </pre>
  </body>
</html>