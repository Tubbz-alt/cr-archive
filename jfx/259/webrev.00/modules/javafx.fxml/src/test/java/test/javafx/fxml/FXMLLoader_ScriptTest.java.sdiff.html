<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.fxml/src/test/java/test/javafx/fxml/FXMLLoader_ScriptTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>modules/javafx.fxml/src/test/java/test/javafx/fxml/FXMLLoader_ScriptTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 package test.javafx.fxml;
  2 /*
<span class="line-modified">  3  * Copyright (c) 2011, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * This code is free software; you can redistribute it and/or modify it
  7  * under the terms of the GNU General Public License version 2 only, as
  8  * published by the Free Software Foundation.  Oracle designates this
  9  * particular file as subject to the &quot;Classpath&quot; exception as provided
 10  * by Oracle in the LICENSE file that accompanied this code.
 11  *
 12  * This code is distributed in the hope that it will be useful, but WITHOUT
 13  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 14  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 15  * version 2 for more details (a copy is included in the LICENSE file that
 16  * accompanied this code).
 17  *
 18  * You should have received a copy of the GNU General Public License version
 19  * 2 along with this work; if not, write to the Free Software Foundation,
 20  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 21  *
 22  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 23  * or visit www.oracle.com if you need additional information or have any
 24  * questions.
 25  */
 26 
 27 import com.sun.javafx.fxml.FXMLLoaderHelper;
 28 import org.junit.Test;
 29 
 30 import java.io.IOException;
 31 import java.util.concurrent.atomic.AtomicBoolean;
 32 import javafx.fxml.FXMLLoader;
 33 import javafx.fxml.LoadListener;


 34 
 35 import static org.junit.Assert.*;

 36 
 37 public class FXMLLoader_ScriptTest {
 38     @Test
 39     @SuppressWarnings(&quot;deprecation&quot;)
 40     public void testStaticScriptLoad() throws IOException {
 41         FXMLLoader fxmlLoader = new FXMLLoader(getClass().getResource(&quot;static_script_load.fxml&quot;));
 42         FXMLLoaderHelper.setStaticLoad(fxmlLoader, true);
 43         AtomicBoolean scriptCalled = new AtomicBoolean();
 44         AtomicBoolean scriptEndCalled = new AtomicBoolean();
 45         fxmlLoader.setLoadListener(new LoadListener() {
 46 
 47             @Override
 48             public void readImportProcessingInstruction(String target) {
 49             }
 50 
 51             @Override
 52             public void readLanguageProcessingInstruction(String language) {
 53             }
 54 
 55             @Override
</pre>
<hr />
<pre>
113             public void readEventHandlerAttribute(String name, String value) {
114             }
115 
116             @Override
117             public void endElement(Object value) {
118                 if (value instanceof String &amp;&amp; ((String) value).contains(&quot;doSomething&quot;)) {
119                     assertTrue(scriptCalled.get());
120                     assertFalse(scriptEndCalled.getAndSet(true));
121                 }
122             }
123         });
124 
125         fxmlLoader.load();
126         assertTrue(scriptCalled.get());
127         assertTrue(scriptEndCalled.get());
128     }
129 
130     @Test
131     public void testScriptHandler() throws IOException {
132 




133         FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;script_handler.fxml&quot;));
134         loader.load();
135 
136         Widget w = (Widget) loader.getNamespace().get(&quot;w&quot;);
137         assertNotNull(w);
138         loader.getNamespace().put(&quot;actionDone&quot;, new AtomicBoolean(false));
139         w.fire();
140         assertTrue(((AtomicBoolean) loader.getNamespace().get(&quot;actionDone&quot;)).get());
141     }
142 
143     @Test
144     public void testExternalScriptHandler() throws IOException {
145 




146         FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;script_handler_external.fxml&quot;));
147         loader.load();
148 
149         Widget w = (Widget) loader.getNamespace().get(&quot;w&quot;);
150         assertNotNull(w);
151         loader.getNamespace().put(&quot;actionDone&quot;, new AtomicBoolean(false));
152         w.fire();
153         assertTrue(((AtomicBoolean)loader.getNamespace().get(&quot;actionDone&quot;)).get());
154     }







155 }
</pre>
</td>
<td>
<hr />
<pre>
  1 package test.javafx.fxml;
  2 /*
<span class="line-modified">  3  * Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * This code is free software; you can redistribute it and/or modify it
  7  * under the terms of the GNU General Public License version 2 only, as
  8  * published by the Free Software Foundation.  Oracle designates this
  9  * particular file as subject to the &quot;Classpath&quot; exception as provided
 10  * by Oracle in the LICENSE file that accompanied this code.
 11  *
 12  * This code is distributed in the hope that it will be useful, but WITHOUT
 13  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 14  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 15  * version 2 for more details (a copy is included in the LICENSE file that
 16  * accompanied this code).
 17  *
 18  * You should have received a copy of the GNU General Public License version
 19  * 2 along with this work; if not, write to the Free Software Foundation,
 20  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 21  *
 22  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 23  * or visit www.oracle.com if you need additional information or have any
 24  * questions.
 25  */
 26 
 27 import com.sun.javafx.fxml.FXMLLoaderHelper;
 28 import org.junit.Test;
 29 
 30 import java.io.IOException;
 31 import java.util.concurrent.atomic.AtomicBoolean;
 32 import javafx.fxml.FXMLLoader;
 33 import javafx.fxml.LoadListener;
<span class="line-added"> 34 import javax.script.ScriptEngineManager;</span>
<span class="line-added"> 35 import javax.script.ScriptEngine;</span>
 36 
 37 import static org.junit.Assert.*;
<span class="line-added"> 38 import static org.junit.Assume.assumeTrue;</span>
 39 
 40 public class FXMLLoader_ScriptTest {
 41     @Test
 42     @SuppressWarnings(&quot;deprecation&quot;)
 43     public void testStaticScriptLoad() throws IOException {
 44         FXMLLoader fxmlLoader = new FXMLLoader(getClass().getResource(&quot;static_script_load.fxml&quot;));
 45         FXMLLoaderHelper.setStaticLoad(fxmlLoader, true);
 46         AtomicBoolean scriptCalled = new AtomicBoolean();
 47         AtomicBoolean scriptEndCalled = new AtomicBoolean();
 48         fxmlLoader.setLoadListener(new LoadListener() {
 49 
 50             @Override
 51             public void readImportProcessingInstruction(String target) {
 52             }
 53 
 54             @Override
 55             public void readLanguageProcessingInstruction(String language) {
 56             }
 57 
 58             @Override
</pre>
<hr />
<pre>
116             public void readEventHandlerAttribute(String name, String value) {
117             }
118 
119             @Override
120             public void endElement(Object value) {
121                 if (value instanceof String &amp;&amp; ((String) value).contains(&quot;doSomething&quot;)) {
122                     assertTrue(scriptCalled.get());
123                     assertFalse(scriptEndCalled.getAndSet(true));
124                 }
125             }
126         });
127 
128         fxmlLoader.load();
129         assertTrue(scriptCalled.get());
130         assertTrue(scriptEndCalled.get());
131     }
132 
133     @Test
134     public void testScriptHandler() throws IOException {
135 
<span class="line-added">136         // This test needs Nashorn script engine.</span>
<span class="line-added">137         // Test will be rewritten under - JDK-8245568</span>
<span class="line-added">138         assumeTrue(isNashornEngineAvailable());</span>
<span class="line-added">139 </span>
140         FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;script_handler.fxml&quot;));
141         loader.load();
142 
143         Widget w = (Widget) loader.getNamespace().get(&quot;w&quot;);
144         assertNotNull(w);
145         loader.getNamespace().put(&quot;actionDone&quot;, new AtomicBoolean(false));
146         w.fire();
147         assertTrue(((AtomicBoolean) loader.getNamespace().get(&quot;actionDone&quot;)).get());
148     }
149 
150     @Test
151     public void testExternalScriptHandler() throws IOException {
152 
<span class="line-added">153         // This test needs Nashorn script engine.</span>
<span class="line-added">154         // Test will be rewritten under - JDK-8245568</span>
<span class="line-added">155         assumeTrue(isNashornEngineAvailable());</span>
<span class="line-added">156 </span>
157         FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;script_handler_external.fxml&quot;));
158         loader.load();
159 
160         Widget w = (Widget) loader.getNamespace().get(&quot;w&quot;);
161         assertNotNull(w);
162         loader.getNamespace().put(&quot;actionDone&quot;, new AtomicBoolean(false));
163         w.fire();
164         assertTrue(((AtomicBoolean)loader.getNamespace().get(&quot;actionDone&quot;)).get());
165     }
<span class="line-added">166 </span>
<span class="line-added">167     private boolean isNashornEngineAvailable() {</span>
<span class="line-added">168         ScriptEngineManager factory = new ScriptEngineManager();</span>
<span class="line-added">169         ScriptEngine engine = factory.getEngineByName(&quot;nashorn&quot;);</span>
<span class="line-added">170 </span>
<span class="line-added">171         return (engine != null);</span>
<span class="line-added">172     }</span>
173 }
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>