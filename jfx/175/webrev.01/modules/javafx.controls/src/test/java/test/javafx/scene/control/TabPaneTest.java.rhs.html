<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.controls/src/test/java/test/javafx/scene/control/TabPaneTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
   2  * Copyright (c) 2010, 2020, Oracle and/or its affiliates. All rights reserved.
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package test.javafx.scene.control;
  27 
  28 import com.sun.javafx.scene.SceneHelper;
  29 import static test.com.sun.javafx.scene.control.infrastructure.ControlTestUtils.assertPseudoClassDoesNotExist;
  30 import static test.com.sun.javafx.scene.control.infrastructure.ControlTestUtils.assertPseudoClassExists;
  31 import static test.com.sun.javafx.scene.control.infrastructure.ControlTestUtils.assertStyleClassContains;
  32 import static org.junit.Assert.assertEquals;
  33 import static org.junit.Assert.assertFalse;
  34 import static org.junit.Assert.assertNotNull;
  35 import static org.junit.Assert.assertNull;
  36 import static org.junit.Assert.assertSame;
  37 import static org.junit.Assert.assertTrue;
  38 import static org.junit.Assert.fail;
  39 
<a name="1" id="anc1"></a><span class="line-added">  40 import javafx.scene.control.SelectionModel;</span>
<span class="line-added">  41 import javafx.scene.control.Skin;</span>
  42 import test.com.sun.javafx.scene.control.infrastructure.StageLoader;
  43 import javafx.application.Platform;
  44 import javafx.beans.property.BooleanProperty;
  45 import javafx.beans.property.DoubleProperty;
  46 import javafx.beans.property.ObjectProperty;
  47 import javafx.beans.property.SimpleBooleanProperty;
  48 import javafx.beans.property.SimpleDoubleProperty;
  49 import javafx.beans.property.SimpleObjectProperty;
  50 import javafx.beans.value.ChangeListener;
  51 import javafx.css.CssMetaData;
  52 import javafx.css.StyleableProperty;
  53 import javafx.event.Event;
  54 import javafx.geometry.Bounds;
  55 import javafx.geometry.Side;
  56 import javafx.scene.Group;
  57 import javafx.scene.Scene;
  58 import javafx.scene.input.KeyEvent;
  59 import javafx.scene.input.MouseEvent;
  60 import javafx.scene.layout.StackPane;
  61 import javafx.scene.layout.VBox;
  62 import javafx.stage.Stage;
  63 
  64 import org.junit.Before;
  65 import org.junit.Ignore;
  66 import org.junit.Test;
  67 
  68 import test.com.sun.javafx.pgstub.StubToolkit;
  69 import test.com.sun.javafx.scene.control.infrastructure.KeyEventFirer;
  70 import test.com.sun.javafx.scene.control.infrastructure.MouseEventGenerator;
  71 import com.sun.javafx.scene.input.KeyCodeMap;
  72 import com.sun.javafx.tk.Toolkit;
  73 
  74 import java.util.Arrays;
  75 import java.util.HashMap;
  76 import java.util.LinkedList;
  77 import java.util.List;
  78 import java.util.Map;
  79 import javafx.scene.control.Button;
  80 import javafx.scene.control.ContextMenu;
  81 import javafx.scene.control.ScrollPane;
  82 import javafx.scene.control.SingleSelectionModel;
  83 import javafx.scene.control.SingleSelectionModelShim;
  84 import javafx.scene.control.skin.TabPaneSkin;
  85 import javafx.scene.control.skin.TabPaneSkinShim;
  86 import javafx.scene.control.SplitPane;
  87 import javafx.scene.control.Tab;
  88 import javafx.scene.control.TabPane;
  89 import javafx.scene.control.TabPaneShim;
  90 
  91 import java.lang.ref.WeakReference;
  92 
  93 public class TabPaneTest {
  94     private TabPane tabPane;//Empty string
  95     private Toolkit tk;
  96     private SingleSelectionModel&lt;Tab&gt; sm;
  97     private Tab tab1;
  98     private Tab tab2;
  99     private Tab tab3;
 100     private Scene scene;
 101     private Stage stage;
 102     private StackPane root;
 103 
 104     @Before public void setup() {
 105         tk = (StubToolkit)Toolkit.getToolkit();//This step is not needed (Just to make sure StubToolkit is loaded into VM)
 106         tabPane = new TabPane();
 107         tab1 = new Tab(&quot;one&quot;);
 108         tab2 = new Tab(&quot;two&quot;);
 109         tab3 = new Tab(&quot;three&quot;);
 110         sm = TabPaneShim.getTabPaneSelectionModel(tabPane);
 111         root = new StackPane();
 112         scene = new Scene(root);
 113         stage = new Stage();
 114         stage.setScene(scene);
 115     }
 116 
 117     /*********************************************************************
 118      * Helper methods                                                    *
 119      ********************************************************************/
 120 
 121     private void show() {
 122         stage.show();
 123         stage.requestFocus();
 124     }
 125 
 126     /*********************************************************************
 127      * Tests for default values                                         *
 128      ********************************************************************/
 129 
 130     @Test public void defaultConstructorShouldSetStyleClassTo_tabpane() {
 131         assertStyleClassContains(tabPane, &quot;tab-pane&quot;);
 132     }
 133 
 134     @Test public void defaultConstructorSelectionModelNotNull() {
 135         assertNotNull(tabPane.getSelectionModel());
 136     }
 137 
 138     @Test public void defaultConstructorInitialTabsEmpty() {
 139         assertNotNull(tabPane.getTabs());
 140         assertEquals(tabPane.getTabs().size(), 0.0, 0.0);
 141     }
 142 
 143     @Test public void defaultSideIsTop() {
 144         assertSame(tabPane.getSide(), Side.TOP);
 145     }
 146 
 147     @Test public void defaultConstructorTabClosingPolicy() {
 148         assertNotNull(tabPane.getTabClosingPolicy());
 149         assertSame(tabPane.getTabClosingPolicy(), TabPane.TabClosingPolicy.SELECTED_TAB);
 150     }
 151 
 152     @Test public void defaultConstructorRotateGraphic() {
 153         assertFalse(tabPane.isRotateGraphic());
 154     }
 155 
 156     @Test public void defaultTabMinWidth() {
 157         assertEquals(tabPane.getTabMinWidth(), 0.0, 0.0);
 158     }
 159 
 160     @Test public void defaultTabMaxWidth() {
 161         assertEquals(tabPane.getTabMaxWidth(), Double.MAX_VALUE, 0.0);
 162     }
 163 
 164     @Test public void defaultTabMinHeight() {
 165         assertEquals(tabPane.getTabMinHeight(), 0.0, 0.0);
 166     }
 167 
 168     @Test public void defaultTabMaxHeight() {
 169         assertEquals(tabPane.getTabMaxHeight(), Double.MAX_VALUE, 0.0);
 170     }
 171 
 172     @Test public void defaultSelectionModelEmpty() {
 173         assertTrue(tabPane.getSelectionModel().isEmpty());
 174     }
 175 
 176     @Test public void initialBoundsInParentMatchesWidthAndHeight() {
 177         TabPane testPane = new TabPane();
 178         testPane.resize(400, 400);
 179         testPane.setSkin(new TabPaneSkin(testPane));
 180         Bounds boundsInParent = testPane.getBoundsInParent();
 181         assertEquals(testPane.getWidth(), boundsInParent.getWidth(), 0.0);
 182         assertEquals(testPane.getHeight(), boundsInParent.getHeight(), 0.0);
 183     }
 184 
 185     /*********************************************************************
 186      * Tests for property binding                                        *
 187      ********************************************************************/
 188 
 189     @Test public void checkSelectionModelPropertyBind() {
 190         ObjectProperty objPr = new SimpleObjectProperty&lt;SingleSelectionModel&lt;Tab&gt;&gt;(null);
 191         tabPane.selectionModelProperty().bind(objPr);
 192         assertNull(&quot;selectionModel cannot be bound&quot;, tabPane.selectionModelProperty().getValue());
 193         objPr.setValue(sm);
 194         assertSame(&quot;selectionModel cannot be bound&quot;, tabPane.selectionModelProperty().getValue(), sm);
 195     }
 196 
 197     @Test public void checkSidePropertyBind() {
 198         ObjectProperty objPr = new SimpleObjectProperty&lt;Side&gt;(Side.BOTTOM);
 199         tabPane.sideProperty().bind(objPr);
 200         assertSame(&quot;side cannot be bound&quot;, tabPane.sideProperty().getValue(), Side.BOTTOM);
 201         objPr.setValue(Side.RIGHT);
 202         assertSame(&quot;side cannot be bound&quot;, tabPane.sideProperty().getValue(), Side.RIGHT);
 203     }
 204 
 205     @Test public void checkTabClosingPropertyBind() {
 206         ObjectProperty objPr = new SimpleObjectProperty&lt;TabPane.TabClosingPolicy&gt;(TabPane.TabClosingPolicy.UNAVAILABLE);
 207         tabPane.tabClosingPolicyProperty().bind(objPr);
 208         assertSame(&quot;side cannot be bound&quot;, tabPane.tabClosingPolicyProperty().getValue(), TabPane.TabClosingPolicy.UNAVAILABLE);
 209         objPr.setValue(TabPane.TabClosingPolicy.ALL_TABS);
 210         assertSame(&quot;side cannot be bound&quot;, tabPane.tabClosingPolicyProperty().getValue(), TabPane.TabClosingPolicy.ALL_TABS);
 211     }
 212 
 213     @Test public void checkRotateGraphicsPropertyBind() {
 214         BooleanProperty objPr = new SimpleBooleanProperty(false);
 215         tabPane.rotateGraphicProperty().bind(objPr);
 216         assertFalse(&quot;rotateGraphic cannot be bound&quot;, tabPane.rotateGraphicProperty().getValue());
 217         objPr.setValue(true);
 218         assertTrue(&quot;rotateGraphic cannot be bound&quot;, tabPane.rotateGraphicProperty().getValue());
 219     }
 220 
 221     @Test public void checkTabMinWidthPropertyBind() {
 222         DoubleProperty objPr = new SimpleDoubleProperty(2.0);
 223         tabPane.tabMinWidthProperty().bind(objPr);
 224         assertEquals(&quot;tabMinWidthProperty cannot be bound&quot;, tabPane.tabMinWidthProperty().getValue(), 2.0, 0.0);
 225         objPr.setValue(5.0);
 226         assertEquals(&quot;tabMinWidthProperty cannot be bound&quot;, tabPane.tabMinWidthProperty().getValue(), 5.0, 0.0);
 227     }
 228 
 229     @Test public void checkTabMaxWidthPropertyBind() {
 230         DoubleProperty objPr = new SimpleDoubleProperty(2.0);
 231         tabPane.tabMaxWidthProperty().bind(objPr);
 232         assertEquals(&quot;tabMaxWidthProperty cannot be bound&quot;, tabPane.tabMaxWidthProperty().getValue(), 2.0, 0.0);
 233         objPr.setValue(5.0);
 234         assertEquals(&quot;tabMaxWidthProperty cannot be bound&quot;, tabPane.tabMaxWidthProperty().getValue(), 5.0, 0.0);
 235     }
 236 
 237 
 238     @Test public void checkTabMinHeightPropertyBind() {
 239         DoubleProperty objPr = new SimpleDoubleProperty(2.0);
 240         tabPane.tabMinHeightProperty().bind(objPr);
 241         assertEquals(&quot;tabMinHeightProperty cannot be bound&quot;, tabPane.tabMinHeightProperty().getValue(), 2.0, 0.0);
 242         objPr.setValue(5.0);
 243         assertEquals(&quot;tabMinHeightProperty cannot be bound&quot;, tabPane.tabMinHeightProperty().getValue(), 5.0, 0.0);
 244     }
 245 
 246     @Test public void checkTabMaxHeightPropertyBind() {
 247         DoubleProperty objPr = new SimpleDoubleProperty(2.0);
 248         tabPane.tabMaxHeightProperty().bind(objPr);
 249         assertEquals(&quot;tabMaxHeightProperty cannot be bound&quot;, tabPane.tabMaxHeightProperty().getValue(), 2.0, 0.0);
 250         objPr.setValue(5.0);
 251         assertEquals(&quot;tabMaxHeightProperty cannot be bound&quot;, tabPane.tabMaxHeightProperty().getValue(), 5.0, 0.0);
 252     }
 253 
 254     @Test public void selectionModelPropertyHasBeanReference() {
 255         assertSame(tabPane, tabPane.selectionModelProperty().getBean());
 256     }
 257 
 258     @Test public void selectionModelPropertyHasName() {
 259         assertEquals(&quot;selectionModel&quot;, tabPane.selectionModelProperty().getName());
 260     }
 261 
 262     @Test public void sidePropertyHasBeanReference() {
 263         assertSame(tabPane, tabPane.sideProperty().getBean());
 264     }
 265 
 266     @Test public void sidePropertyHasName() {
 267         assertEquals(&quot;side&quot;, tabPane.sideProperty().getName());
 268     }
 269 
 270     @Test public void tabClosingPolicyPropertyHasBeanReference() {
 271         assertSame(tabPane, tabPane.tabClosingPolicyProperty().getBean());
 272     }
 273 
 274     @Test public void tabClosingPolicyPropertyHasName() {
 275         assertEquals(&quot;tabClosingPolicy&quot;, tabPane.tabClosingPolicyProperty().getName());
 276     }
 277 
 278     @Test public void rotateGraphicPropertyHasBeanReference() {
 279         assertSame(tabPane, tabPane.rotateGraphicProperty().getBean());
 280     }
 281 
 282     @Test public void rotateGraphicPropertyHasName() {
 283         assertEquals(&quot;rotateGraphic&quot;, tabPane.rotateGraphicProperty().getName());
 284     }
 285 
 286     @Test public void tabMinWidthPropertyHasBeanReference() {
 287         assertSame(tabPane, tabPane.tabMinWidthProperty().getBean());
 288     }
 289 
 290     @Test public void tabMinWidthPropertyHasName() {
 291         assertEquals(&quot;tabMinWidth&quot;, tabPane.tabMinWidthProperty().getName());
 292     }
 293 
 294     @Test public void tabMaxWidthPropertyHasBeanReference() {
 295         assertSame(tabPane, tabPane.tabMaxWidthProperty().getBean());
 296     }
 297 
 298     @Test public void tabMaxWidthPropertyHasName() {
 299         assertEquals(&quot;tabMaxWidth&quot;, tabPane.tabMaxWidthProperty().getName());
 300     }
 301 
 302     @Test public void tabMinHeightPropertyHasBeanReference() {
 303         assertSame(tabPane, tabPane.tabMinHeightProperty().getBean());
 304     }
 305 
 306     @Test public void tabMinHeightPropertyHasName() {
 307         assertEquals(&quot;tabMinHeight&quot;, tabPane.tabMinHeightProperty().getName());
 308     }
 309 
 310     @Test public void tabMaxHeightPropertyHasBeanReference() {
 311         assertSame(tabPane, tabPane.tabMaxHeightProperty().getBean());
 312     }
 313 
 314     @Test public void tabMaxHeightPropertyHasName() {
 315         assertEquals(&quot;tabMaxHeight&quot;, tabPane.tabMaxHeightProperty().getName());
 316     }
 317 
 318 
 319     /*********************************************************************
 320      * Check for Pseudo classes                                          *
 321      ********************************************************************/
 322 
 323     @Test public void settingSideSetsPseudoClass() {
 324         tabPane.setSide(Side.BOTTOM);
 325         assertPseudoClassExists(tabPane, &quot;bottom&quot;);
 326         assertPseudoClassDoesNotExist(tabPane, &quot;top&quot;);
 327         assertPseudoClassDoesNotExist(tabPane, &quot;left&quot;);
 328         assertPseudoClassDoesNotExist(tabPane, &quot;right&quot;);
 329     }
 330 
 331     @Test public void clearingSideClearsPseudoClass() {
 332         tabPane.setSide(Side.BOTTOM);
 333         tabPane.setSide(Side.LEFT);
 334         assertPseudoClassExists(tabPane, &quot;left&quot;);
 335         assertPseudoClassDoesNotExist(tabPane, &quot;bottom&quot;);
 336         assertPseudoClassDoesNotExist(tabPane, &quot;top&quot;);
 337         assertPseudoClassDoesNotExist(tabPane, &quot;right&quot;);
 338     }
 339 
 340 
 341     /*********************************************************************
 342      * CSS related Tests                                                 *
 343      ********************************************************************/
 344 
 345     @Test public void whenTabMinWidthIsBound_impl_cssSettable_ReturnsFalse() {
 346         CssMetaData styleable = ((StyleableProperty)tabPane.tabMinWidthProperty()).getCssMetaData();
 347         assertTrue(styleable.isSettable(tabPane));
 348         DoubleProperty other = new SimpleDoubleProperty(30.0);
 349         tabPane.tabMinWidthProperty().bind(other);
 350         assertFalse(styleable.isSettable(tabPane));
 351     }
 352 
 353     @Test public void whenTabMinWidthIsSpecifiedViaCSSAndIsNotBound_impl_cssSettable_ReturnsTrue() {
 354         CssMetaData styleable = ((StyleableProperty)tabPane.tabMinWidthProperty()).getCssMetaData();
 355         assertTrue(styleable.isSettable(tabPane));
 356     }
 357 
 358     @Test public void canSpecifyTabMinWidthViaCSS() {
 359         ((StyleableProperty)tabPane.tabMinWidthProperty()).applyStyle(null, 34.0);
 360         assertEquals(34.0, tabPane.getTabMinWidth(), 0.0);
 361     }
 362 
 363     @Test public void whenTabMaxWidthIsBound_impl_cssSettable_ReturnsFalse() {
 364         CssMetaData styleable = ((StyleableProperty)tabPane.tabMaxWidthProperty()).getCssMetaData();
 365         assertTrue(styleable.isSettable(tabPane));
 366         DoubleProperty other = new SimpleDoubleProperty(30.0);
 367         tabPane.tabMaxWidthProperty().bind(other);
 368         assertFalse(styleable.isSettable(tabPane));
 369     }
 370 
 371     @Test public void whenTabMaxWidthIsSpecifiedViaCSSAndIsNotBound_impl_cssSettable_ReturnsTrue() {
 372         CssMetaData styleable = ((StyleableProperty)tabPane.tabMaxWidthProperty()).getCssMetaData();
 373         assertTrue(styleable.isSettable(tabPane));
 374     }
 375 
 376     @Test public void canSpecifyTabMaxWidthViaCSS() {
 377         ((StyleableProperty)tabPane.tabMaxWidthProperty()).applyStyle(null, 34.0);
 378         assertEquals(34.0, tabPane.getTabMaxWidth(), 0.0);
 379     }
 380 
 381     @Test public void whenTabMinHeightIsBound_impl_cssSettable_ReturnsFalse() {
 382         CssMetaData styleable = ((StyleableProperty)tabPane.tabMinHeightProperty()).getCssMetaData();
 383         assertTrue(styleable.isSettable(tabPane));
 384         DoubleProperty other = new SimpleDoubleProperty(30.0);
 385         tabPane.tabMinHeightProperty().bind(other);
 386         assertFalse(styleable.isSettable(tabPane));
 387     }
 388 
 389     @Test public void whenTabMinHeightIsSpecifiedViaCSSAndIsNotBound_impl_cssSettable_ReturnsTrue() {
 390         CssMetaData styleable = ((StyleableProperty)tabPane.tabMinHeightProperty()).getCssMetaData();
 391         assertTrue(styleable.isSettable(tabPane));
 392     }
 393 
 394     @Test public void canSpecifyTabMinHeightViaCSS() {
 395         ((StyleableProperty)tabPane.tabMinHeightProperty()).applyStyle(null, 34.0);
 396         assertEquals(34.0, tabPane.getTabMinHeight(), 0.0);
 397     }
 398 
 399     @Test public void whenTabMaxHeightIsBound_impl_cssSettable_ReturnsFalse() {
 400         CssMetaData styleable = ((StyleableProperty)tabPane.tabMaxHeightProperty()).getCssMetaData();
 401         assertTrue(styleable.isSettable(tabPane));
 402         DoubleProperty other = new SimpleDoubleProperty(30.0);
 403         tabPane.tabMaxHeightProperty().bind(other);
 404         assertFalse(styleable.isSettable(tabPane));
 405     }
 406 
 407     @Test public void whenTabMaxHeightIsSpecifiedViaCSSAndIsNotBound_impl_cssSettable_ReturnsTrue() {
 408         CssMetaData styleable = ((StyleableProperty)tabPane.tabMaxHeightProperty()).getCssMetaData();
 409         assertTrue(styleable.isSettable(tabPane));
 410     }
 411 
 412     @Test public void canSpecifyTabMaxHeightViaCSS() {
 413         ((StyleableProperty)tabPane.tabMaxHeightProperty()).applyStyle(null, 34.0);
 414         assertEquals(34.0, tabPane.getTabMaxHeight(), 0.0);
 415     }
 416 
 417 
 418     /*********************************************************************
 419      * Miscellaneous Tests                                               *
 420      ********************************************************************/
 421 
 422     @Test public void setSelectionModelAndSeeValueIsReflectedInModel() {
 423         tabPane.setSelectionModel(sm);
 424         assertSame(tabPane.selectionModelProperty().getValue(), sm);
 425     }
 426 
 427     @Test public void setselectionModelAndSeeValue() {
 428         tabPane.setSelectionModel(sm);
 429         assertSame(tabPane.getSelectionModel(), sm);
 430     }
 431 
 432     @Test public void setSideAndSeeValueIsReflectedInModel() {
 433         tabPane.setSide(Side.BOTTOM);
 434         assertSame(tabPane.sideProperty().getValue(), Side.BOTTOM);
 435     }
 436 
 437     @Test public void setSideAndSeeValue() {
 438         tabPane.setSide(Side.LEFT);
 439         assertSame(tabPane.getSide(), Side.LEFT);
 440     }
 441 
 442     @Test public void setTabClosingPolicyAndSeeValueIsReflectedInModel() {
 443         tabPane.setTabClosingPolicy(TabPane.TabClosingPolicy.ALL_TABS);
 444         assertSame(tabPane.tabClosingPolicyProperty().getValue(), TabPane.TabClosingPolicy.ALL_TABS);
 445     }
 446 
 447     @Test public void setTabClosingPolicyAndSeeValue() {
 448         tabPane.setTabClosingPolicy(TabPane.TabClosingPolicy.UNAVAILABLE);
 449         assertSame(tabPane.getTabClosingPolicy(), TabPane.TabClosingPolicy.UNAVAILABLE);
 450     }
 451 
 452     @Test public void setTabDragPolicyAndSeeValueIsReflectedInModel() {
 453         tabPane.setTabDragPolicy(TabPane.TabDragPolicy.REORDER);
 454         assertSame(TabPane.TabDragPolicy.REORDER, tabPane.tabDragPolicyProperty().getValue());
 455 
 456         tabPane.setTabDragPolicy(TabPane.TabDragPolicy.FIXED);
 457         assertSame(TabPane.TabDragPolicy.FIXED, tabPane.tabDragPolicyProperty().getValue());
 458     }
 459 
 460     @Test public void setTabDragPolicyAndSeeValue() {
 461         tabPane.setTabDragPolicy(TabPane.TabDragPolicy.REORDER);
 462         assertSame(TabPane.TabDragPolicy.REORDER, tabPane.getTabDragPolicy());
 463 
 464         tabPane.setTabDragPolicy(TabPane.TabDragPolicy.FIXED);
 465         assertSame(TabPane.TabDragPolicy.FIXED, tabPane.getTabDragPolicy());
 466     }
 467 
 468     @Test public void tabDragPolicyReorderAndAsymmetricMouseEvent() {
 469         tabPane.setTabDragPolicy(TabPane.TabDragPolicy.REORDER);
 470         tabPane.getTabs().add(tab1);
 471         tabPane.getTabs().add(tab2);
 472         root.getChildren().add(tabPane);
 473         show();
 474 
 475         root.layout();
 476 
 477         double xval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinX();
 478         double yval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinY();
 479 
 480         SceneHelper.processMouseEvent(scene,
 481             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_RELEASED, xval+75, yval+20));
 482         tk.firePulse();
 483 
 484         SceneHelper.processMouseEvent(scene,
 485                 MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_DRAGGED, xval+75, yval+20));
 486         tk.firePulse();
 487     }
 488 
 489     @Test public void setRotateGraphicAndSeeValueIsReflectedInModel() {
 490         tabPane.setRotateGraphic(true);
 491         assertTrue(tabPane.rotateGraphicProperty().getValue());
 492     }
 493 
 494     @Test public void setRotateGraphicAndSeeValue() {
 495         tabPane.setRotateGraphic(true);
 496         assertTrue(tabPane.isRotateGraphic());
 497     }
 498 
 499     @Test public void setTabMinWidthAndSeeValueIsReflectedInModel() {
 500         tabPane.setTabMinWidth(30.0);
 501         assertEquals(tabPane.tabMinWidthProperty().getValue(), 30.0, 0.0);
 502     }
 503 
 504     @Test public void setTabMinWidthAndSeeValue() {
 505         tabPane.setTabMinWidth(30.0);
 506         assertEquals(tabPane.getTabMinWidth(), 30.0, 0.0);
 507     }
 508 
 509     @Test public void setTabMaxWidthAndSeeValueIsReflectedInModel() {
 510         tabPane.setTabMaxWidth(30.0);
 511         assertEquals(tabPane.tabMaxWidthProperty().getValue(), 30.0, 0.0);
 512     }
 513 
 514     @Test public void setTabMaxWidthAndSeeValue() {
 515         tabPane.setTabMaxWidth(30.0);
 516         assertEquals(tabPane.getTabMaxWidth(), 30.0, 0.0);
 517     }
 518 
 519     @Test public void setTabMinHeightAndSeeValueIsReflectedInModel() {
 520         tabPane.setTabMinHeight(30.0);
 521         assertEquals(tabPane.tabMinHeightProperty().getValue(), 30.0, 0.0);
 522     }
 523 
 524     @Test public void setTabMinHeightAndSeeValue() {
 525         tabPane.setTabMinHeight(30.0);
 526         assertEquals(tabPane.getTabMinHeight(), 30.0, 0.0);
 527     }
 528 
 529     @Test public void setTabMaxHeightAndSeeValueIsReflectedInModel() {
 530         tabPane.setTabMaxHeight(30.0);
 531         assertEquals(tabPane.tabMaxHeightProperty().getValue(), 30.0, 0.0);
 532     }
 533 
 534     @Test public void setTabMaxHeightAndSeeValue() {
 535         tabPane.setTabMaxHeight(30.0);
 536         assertEquals(tabPane.getTabMaxHeight(), 30.0, 0.0);
 537     }
 538 
 539     @Test public void addTabsCheckItemCountInSelectionModel() {
 540         tabPane.getTabs().add(tab1);
 541         tabPane.getTabs().add(tab2);
 542         assertEquals(SingleSelectionModelShim.getItemCount(tabPane.getSelectionModel()), 2.0, 0.0);
 543     }
 544 
 545     @Test public void addTabsCheckItemInSelectionModel() {
 546         tabPane.getTabs().add(tab1);
 547         tabPane.getTabs().add(tab2);
 548         assertSame(SingleSelectionModelShim.getModelItem(tabPane.getSelectionModel(), 0), tab1);
 549         assertSame(SingleSelectionModelShim.getModelItem(tabPane.getSelectionModel(), 1), tab2);
 550     }
 551 
 552     @Test public void addTabsCheckSelectUsingObjInSelectionModel() {
 553         tabPane.getTabs().add(tab1);
 554         tabPane.getTabs().add(tab2);
 555         tabPane.getSelectionModel().select(tab1);
 556         assertTrue(tabPane.getSelectionModel().isSelected(0));
 557     }
 558 
 559     @Test public void addTabsCheckSelectUsingIndexInSelectionModel() {
 560         tabPane.getTabs().add(tab1);
 561         tabPane.getTabs().add(tab2);
 562         tabPane.getSelectionModel().select(1);
 563         assertTrue(tabPane.getSelectionModel().isSelected(1));
 564     }
 565 
 566     @Test public void addTabsCheckClearAndSelectUsingIndexInSelectionModel() {
 567         tabPane.getTabs().add(tab1);
 568         tabPane.getTabs().add(tab2);
 569         tabPane.getSelectionModel().clearAndSelect(1);
 570         assertTrue(tabPane.getSelectionModel().isSelected(1));
 571     }
 572 
 573     @Test public void addTabsCheckSelectMultipleItemsAndClearOneItemInSelectionModel() {
 574         tabPane.getTabs().add(tab1);
 575         tabPane.getTabs().add(tab2);
 576         tabPane.getSelectionModel().select(0);
 577         tabPane.getSelectionModel().select(1);
 578         tabPane.getSelectionModel().clearSelection(0);
 579         assertFalse(tabPane.getSelectionModel().isSelected(0));
 580         assertTrue(tabPane.getSelectionModel().isSelected(1));
 581     }
 582 
 583     @Test public void addTabsCheckSelectMultipleItemsAndClearAllSelectionInSelectionModel() {
 584         tabPane.getTabs().add(tab1);
 585         tabPane.getTabs().add(tab2);
 586         tabPane.getSelectionModel().select(0);
 587         tabPane.getSelectionModel().select(1);
 588         tabPane.getSelectionModel().clearSelection();
 589         assertFalse(tabPane.getSelectionModel().isSelected(0));
 590         assertFalse(tabPane.getSelectionModel().isSelected(1));
 591         assertTrue(tabPane.getSelectionModel().isEmpty());
 592     }
 593 
 594     @Test public void addTabsCheckSelectUsingIteratorKindOfMethodsInSelectionModel() {
 595         tabPane.getTabs().add(tab1);
 596         tabPane.getTabs().add(tab2);
 597         tabPane.getSelectionModel().selectFirst();
 598         assertTrue(tabPane.getSelectionModel().isSelected(0));
 599         assertFalse(tabPane.getSelectionModel().isSelected(1));
 600         tabPane.getSelectionModel().selectNext();
 601         assertFalse(tabPane.getSelectionModel().isSelected(0));
 602         assertTrue(tabPane.getSelectionModel().isSelected(1));
 603         tabPane.getSelectionModel().clearSelection();
 604         tabPane.getSelectionModel().selectLast();
 605         assertFalse(tabPane.getSelectionModel().isSelected(0));
 606         assertTrue(tabPane.getSelectionModel().isSelected(1));
 607         tabPane.getSelectionModel().selectPrevious();
 608         assertTrue(tabPane.getSelectionModel().isSelected(0));
 609         assertFalse(tabPane.getSelectionModel().isSelected(1));
 610     }
 611 
 612     @Test public void flipTabOrder_RT20156() {
 613         tabPane.setSkin(new TabPaneSkin(tabPane));
 614         tabPane.getTabs().add(tab1);
 615         tabPane.getTabs().add(tab2);
 616         tabPane.getTabs().add(tab3);
 617 
 618         assertEquals(&quot;one&quot;, tabPane.getTabs().get(0).getText());
 619         assertEquals(&quot;two&quot;, tabPane.getTabs().get(1).getText());
 620         assertEquals(&quot;three&quot;, tabPane.getTabs().get(2).getText());
 621 
 622         final int lastTabIndex = tabPane.getTabs().size()-1;
 623         final Tab lastTab = tabPane.getTabs().get(lastTabIndex);
 624         tabPane.getTabs().remove(lastTabIndex);
 625         tabPane.getTabs().add(0, lastTab);
 626 
 627         assertEquals(&quot;three&quot;, tabPane.getTabs().get(0).getText());
 628         assertEquals(&quot;one&quot;, tabPane.getTabs().get(1).getText());
 629         assertEquals(&quot;two&quot;, tabPane.getTabs().get(2).getText());
 630         assertTrue(tabPane.getSelectionModel().isSelected(1));
 631     }
 632 
 633     @Test public void disableAllTabs() {
 634         tabPane.setSkin(new TabPaneSkin(tabPane));
 635         tabPane.getTabs().add(tab1);
 636         tabPane.getTabs().add(tab2);
 637         tabPane.getTabs().add(tab3);
 638 
 639         tab1.setDisable(true);
 640         tab2.setDisable(true);
 641         tab3.setDisable(true);
 642 
 643         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 644         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 645     }
 646 
 647     @Test public void disableFirstTabs() {
 648         tabPane.setSkin(new TabPaneSkin(tabPane));
 649         tabPane.getTabs().add(tab1);
 650         tabPane.getTabs().add(tab2);
 651         tabPane.getTabs().add(tab3);
 652 
 653         tab1.setDisable(true);
 654         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 655         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 656     }
 657 
 658     @Test public void disableATabAndSelectItByIndex() {
 659         tabPane.setSkin(new TabPaneSkin(tabPane));
 660         tabPane.getTabs().add(tab1);
 661         tabPane.getTabs().add(tab2);
 662         tabPane.getTabs().add(tab3);
 663 
 664         tab2.setDisable(true);
 665         tabPane.getSelectionModel().select(1);
 666         assertEquals(1, tabPane.getSelectionModel().getSelectedIndex());
 667         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 668     }
 669 
 670     @Test public void selectByIndexADisableTab() {
 671         tabPane.setSkin(new TabPaneSkin(tabPane));
 672         tabPane.getTabs().add(tab1);
 673         tabPane.getTabs().add(tab2);
 674         tabPane.getTabs().add(tab3);
 675 
 676         tabPane.getSelectionModel().select(1);
 677         tab2.setDisable(true);
 678         assertEquals(1, tabPane.getSelectionModel().getSelectedIndex());
 679         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 680         assertTrue(tab2.isDisable());
 681     }
 682 
 683     @Test public void disableATabAndSelectItByTab() {
 684         tabPane.setSkin(new TabPaneSkin(tabPane));
 685         tabPane.getTabs().add(tab1);
 686         tabPane.getTabs().add(tab2);
 687         tabPane.getTabs().add(tab3);
 688 
 689         tab2.setDisable(true);
 690         tabPane.getSelectionModel().select(tab2);
 691         assertEquals(1, tabPane.getSelectionModel().getSelectedIndex());
 692         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 693     }
 694 
 695     @Test public void selectByTabADisableTab() {
 696         tabPane.setSkin(new TabPaneSkin(tabPane));
 697         tabPane.getTabs().add(tab1);
 698         tabPane.getTabs().add(tab2);
 699         tabPane.getTabs().add(tab3);
 700 
 701         tabPane.getSelectionModel().select(tab2);
 702         tab2.setDisable(true);
 703         assertEquals(1, tabPane.getSelectionModel().getSelectedIndex());
 704         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 705         assertTrue(tab2.isDisable());
 706     }
 707 
 708     @Test public void navigateOverDisableTab() {
 709         tabPane.getTabs().add(tab1);
 710         tabPane.getTabs().add(tab2);
 711         tabPane.getTabs().add(tab3);
 712 
 713         root.getChildren().add(tabPane);
 714         show();
 715         tabPane.requestFocus();
 716 
 717         assertTrue(tabPane.isFocused());
 718 
 719         tab2.setDisable(true);
 720         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 721         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 722         assertTrue(tab2.isDisable());
 723 
 724         KeyEventFirer keyboard = new KeyEventFirer(tabPane);
 725         keyboard.doRightArrowPress();
 726 
 727         assertEquals(2, tabPane.getSelectionModel().getSelectedIndex());
 728         assertEquals(tab3, tabPane.getSelectionModel().getSelectedItem());
 729 
 730         keyboard.doLeftArrowPress();
 731 
 732         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 733         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 734     }
 735 
 736     @Ignore
 737     @Test public void mousePressSelectsATab_RT20476() {
 738         tabPane.getTabs().add(tab1);
 739         tabPane.getTabs().add(tab2);
 740         tabPane.getTabs().add(tab3);
 741 
 742         tab1.setContent(new Button(&quot;TAB1&quot;));
 743         tab2.setContent(new Button(&quot;TAB2&quot;));
 744         tab3.setContent(new Button(&quot;TAB3&quot;));
 745 
 746         root.getChildren().add(tabPane);
 747         show();
 748 
 749         root.applyCss();
 750         root.resize(300, 300);
 751         root.layout();
 752 
 753         tk.firePulse();
 754         assertTrue(tabPane.isFocused());
 755 
 756         double xval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinX();
 757         double yval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinY();
 758 
 759         SceneHelper.processMouseEvent(scene,
 760             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval+75, yval+20));
 761         tk.firePulse();
 762 
 763         assertEquals(1, tabPane.getSelectionModel().getSelectedIndex());
 764         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 765     }
 766 
 767     private int counter = 0;
 768     @Ignore
 769     @Test public void setOnSelectionChangedFiresTwice_RT21089() {
 770         tabPane.getTabs().add(tab1);
 771         tabPane.getTabs().add(tab2);
 772 
 773         tab1.setContent(new Button(&quot;TAB1&quot;));
 774         tab2.setContent(new Button(&quot;TAB2&quot;));
 775 
 776         root.getChildren().add(tabPane);
 777         show();
 778 
 779         root.applyCss();
 780         root.resize(300, 300);
 781         root.layout();
 782 
 783         tk.firePulse();
 784         assertTrue(tabPane.isFocused());
 785 
 786         tab2.setOnSelectionChanged(event -&gt; {
 787             assertEquals(0, counter++);
 788         });
 789 
 790         double xval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinX();
 791         double yval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinY();
 792 
 793         SceneHelper.processMouseEvent(scene,
 794             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval+75, yval+20));
 795         tk.firePulse();
 796 
 797         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 798 
 799         SceneHelper.processMouseEvent(scene,
 800             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval+75, yval+20));
 801         tk.firePulse();
 802         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 803     }
 804 
 805     @Test public void unableToSelectNextTabWhenFirstTabIsClosed_RT22326() {
 806         tabPane.getTabs().add(tab1);
 807         tabPane.getTabs().add(tab2);
 808         tabPane.getTabs().add(tab3);
 809 
 810         assertEquals(&quot;one&quot;, tabPane.getTabs().get(0).getText());
 811         assertEquals(&quot;two&quot;, tabPane.getTabs().get(1).getText());
 812         assertEquals(&quot;three&quot;, tabPane.getTabs().get(2).getText());
 813 
 814         tabPane.getTabs().remove(tab1);
 815 
 816         assertEquals(2, tabPane.getTabs().size());
 817         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 818         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 819         tabPane.getSelectionModel().selectNext();
 820         assertEquals(tab3, tabPane.getSelectionModel().getSelectedItem());
 821     }
 822 
 823     @Test public void removeFirstTabNextTabShouldBeSelected() {
 824         tabPane.getTabs().add(tab1);
 825         tabPane.getTabs().add(tab2);
 826         tabPane.getTabs().add(tab3);
 827 
 828         assertEquals(&quot;one&quot;, tabPane.getTabs().get(0).getText());
 829         assertEquals(&quot;two&quot;, tabPane.getTabs().get(1).getText());
 830         assertEquals(&quot;three&quot;, tabPane.getTabs().get(2).getText());
 831 
 832         tabPane.getTabs().remove(tab1);
 833 
 834         assertEquals(2, tabPane.getTabs().size());
 835         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 836         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 837     }
 838 
 839     @Test public void selectionModelShouldNotBeNullWhenClosingFirstTab_RT22925() {
 840         tabPane.getTabs().add(tab1);
 841         tabPane.getTabs().add(tab2);
 842         tabPane.getTabs().add(tab3);
 843 
 844         tabPane.getSelectionModel().selectedItemProperty().addListener((ov, t, t1) -&gt; {
 845             assertEquals(t.getText(), &quot;one&quot;);
 846             assertEquals(t1.getText(), &quot;two&quot;);
 847         });
 848 
 849         assertEquals(&quot;one&quot;, tabPane.getTabs().get(0).getText());
 850         assertEquals(&quot;two&quot;, tabPane.getTabs().get(1).getText());
 851         assertEquals(&quot;three&quot;, tabPane.getTabs().get(2).getText());
 852 
 853         tabPane.getTabs().remove(tab1);
 854 
 855         assertEquals(2, tabPane.getTabs().size());
 856         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 857         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 858     }
 859 
 860 
 861     boolean button1Focused = false;
 862     @Test public void focusTraversalShouldLookInsideEmbeddedEngines() {
 863 
 864         Button b1 = new Button(&quot;Button1&quot;);
 865         final ChangeListener&lt;Boolean&gt; focusListener = (observable, oldVal, newVal) -&gt; {
 866             button1Focused = true;
 867         };
 868         b1.focusedProperty().addListener(focusListener);
 869 
 870         final ScrollPane sp = new ScrollPane();
 871         final VBox vbox1 = new VBox();
 872         vbox1.setSpacing(10);
 873         vbox1.setTranslateX(10);
 874         vbox1.setTranslateY(10);
 875         vbox1.getChildren().addAll(b1);
 876         tab1.setContent(vbox1);
 877         sp.setContent(vbox1);
 878         tab1.setContent(sp);
 879         tabPane.getTabs().add(tab1);
 880 
 881         tabPane.getTabs().add(tab2);
 882 
 883         final Scene scene1 = new Scene(new Group(), 400, 400);
 884         ((Group)scene1.getRoot()).getChildren().add(tabPane);
 885 
 886         stage.setScene(scene1);
 887         stage.show();
 888         stage.requestFocus();
 889 
 890         final KeyEvent tabEvent = new KeyEvent(KeyEvent.KEY_PRESSED, &quot;&quot;, &quot;&quot;, KeyCodeMap.valueOf(0x09),
 891                                                          false, false, false, false);
 892         Platform.runLater(() -&gt; {
 893             tabPane.requestFocus();
 894             Event.fireEvent(tabPane, tabEvent);
 895 
 896         });
 897 
 898         assertTrue(button1Focused);
 899 
 900     }
 901 
 902     @Test public void test_rt_35013() {
 903         SplitPane splitPane = new SplitPane();
 904         splitPane.getItems().addAll(new Button(&quot;Button1&quot;), new Button(&quot;Button2&quot;));
 905 
 906         TabPane tabPane = new TabPane();
 907         Tab emptyTab;
 908         Tab splitTab = new Tab(&quot;SplitPane Tab&quot;);
 909         splitTab.setContent(splitPane);
 910         tabPane.getTabs().addAll(emptyTab = new Tab(&quot;Empty Tab&quot;), splitTab);
 911 
 912         StageLoader sl = new StageLoader(tabPane);
 913 
 914         tabPane.getSelectionModel().select(emptyTab);
 915         Toolkit.getToolkit().firePulse();
 916         assertFalse(splitPane.getParent().isVisible());
 917 
 918         tabPane.getSelectionModel().select(splitTab);
 919         Toolkit.getToolkit().firePulse();
 920         assertTrue(splitPane.getParent().isVisible());
 921 
 922         sl.dispose();
 923     }
 924 
 925     @Test public void test_rt_36456_default_selectionMovesBackwardOne() {
 926         Tab tab0 = new Tab(&quot;Tab 0&quot;);
 927         Tab tab1 = new Tab(&quot;Tab 1&quot;);
 928         Tab tab2 = new Tab(&quot;Tab 2&quot;);
 929 
 930         TabPane tabPane = new TabPane();
 931         tabPane.getTabs().addAll(tab0, tab1, tab2);
 932         tabPane.getSelectionModel().select(tab1);
 933 
 934         StageLoader sl = new StageLoader(tabPane);
 935 
 936         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 937         tabPane.getTabs().remove(tab1);
 938         assertEquals(tab0, tabPane.getSelectionModel().getSelectedItem());
 939 
 940         sl.dispose();
 941     }
 942 
 943     @Test public void test_rt_36456_selectionMovesBackwardTwoSkippingDisabledTab() {
 944         Tab tab0 = new Tab(&quot;Tab 0&quot;);
 945         Tab tab1 = new Tab(&quot;Tab 1&quot;);
 946         tab1.setDisable(true);
 947         Tab tab2 = new Tab(&quot;Tab 2&quot;);
 948 
 949         TabPane tabPane = new TabPane();
 950         tabPane.getTabs().addAll(tab0, tab1, tab2);
 951         tabPane.getSelectionModel().select(tab2);
 952 
 953         StageLoader sl = new StageLoader(tabPane);
 954 
 955         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 956         tabPane.getTabs().remove(tab2);
 957 
 958         // selection should jump from tab2 to tab0, as tab1 is disabled
 959         assertEquals(tab0, tabPane.getSelectionModel().getSelectedItem());
 960 
 961         sl.dispose();
 962     }
 963 
 964     @Test public void test_rt_36456_selectionMovesForwardOne() {
 965         Tab tab0 = new Tab(&quot;Tab 0&quot;);
 966         tab0.setDisable(true);
 967         Tab tab1 = new Tab(&quot;Tab 1&quot;);
 968         Tab tab2 = new Tab(&quot;Tab 2&quot;);
 969 
 970         TabPane tabPane = new TabPane();
 971         tabPane.getTabs().addAll(tab0, tab1, tab2);
 972         tabPane.getSelectionModel().select(tab1);
 973 
 974         StageLoader sl = new StageLoader(tabPane);
 975 
 976         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 977         tabPane.getTabs().remove(tab1);
 978 
 979         // selection should move to the next non-disabled tab - in this case tab2
 980         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 981 
 982         sl.dispose();
 983     }
 984 
 985     @Test public void test_rt_36456_selectionMovesForwardTwoSkippingDisabledTab() {
 986         Tab tab0 = new Tab(&quot;Tab 0&quot;);
 987         Tab tab1 = new Tab(&quot;Tab 1&quot;);
 988         tab1.setDisable(true);
 989         Tab tab2 = new Tab(&quot;Tab 2&quot;);
 990 
 991         TabPane tabPane = new TabPane();
 992         tabPane.getTabs().addAll(tab0, tab1, tab2);
 993         tabPane.getSelectionModel().select(tab0);
 994 
 995         StageLoader sl = new StageLoader(tabPane);
 996 
 997         Tab selectedTab = tabPane.getSelectionModel().getSelectedItem();
 998         assertEquals(tab0, selectedTab);
 999         tabPane.getTabs().remove(tab0);
1000 
1001         // selection should move to the next non-disabled tab - in this case tab2
1002         selectedTab = tabPane.getSelectionModel().getSelectedItem();
1003         assertEquals(tab2.getText() + &quot; != &quot; +  tab2.getText(), tab2, selectedTab);
1004 
1005         sl.dispose();
1006     }
1007 
1008     @Test public void test_rt_36908() {
1009         TabPane pane = new TabPane();
1010         final Tab disabled = new Tab(&quot;Disabled&quot;);
1011         disabled.setDisable(true);
1012 
1013         Tab tab1 = new Tab(&quot;Tab 1&quot;);
1014         Tab tab2 = new Tab(&quot;Tab 2&quot;);
1015         pane.getTabs().addAll(disabled, tab1, tab2);
1016 
1017         assertEquals(1, pane.getSelectionModel().getSelectedIndex());
1018         assertEquals(tab1, pane.getSelectionModel().getSelectedItem());
1019     }
1020 
1021     @Test public void test_rt_24658() {
1022         Button btn = new Button(&quot;Button&quot;);
1023         final Tab disabled = new Tab(&quot;Disabled&quot;);
1024         disabled.setContent(btn);
1025 
1026         TabPane pane = new TabPane();
1027         pane.getTabs().addAll(disabled);
1028 
1029         assertEquals(0, pane.getSelectionModel().getSelectedIndex());
1030         assertEquals(disabled, pane.getSelectionModel().getSelectedItem());
1031         assertFalse(btn.isDisabled());
1032 
1033         disabled.setDisable(true);
1034         assertTrue(btn.isDisabled());
1035 
1036         disabled.setDisable(false);
1037         assertFalse(btn.isDisabled());
1038     }
1039 
1040     @Test public void test_rt_38382_noAddToTabPane() {
1041         test_rt_38382(false);
1042     }
1043 
1044     @Test public void test_rt_38382_addToTabPane() {
1045         test_rt_38382(true);
1046     }
1047 
1048     public void test_rt_38382(boolean addToTabPane) {
1049         final List&lt;String&gt; names = Arrays.asList(
1050                 &quot;Biomass&quot;,
1051                 &quot;Exploitable Population Biomass&quot;,
1052                 &quot;MSY&quot;,
1053                 &quot;Yield&quot;,
1054                 &quot;Recruitment&quot;,
1055                 &quot;Catch&quot;,
1056                 &quot;Effort&quot;);
1057         final Map&lt;Tab, List&lt;String&gt;&gt; fooMap = new HashMap&lt;&gt;();
1058         final List&lt;Tab&gt; tabList = new LinkedList&lt;&gt;();
1059         for (String name : names) {
1060             final Tab tab = new Tab();
1061             tab.setText(name);
1062             fooMap.put(tab, new LinkedList&lt;&gt;());
1063             tabList.add(tab);
1064         }
1065         TabPane tabPane = new TabPane();
1066 
1067         if (addToTabPane) {
1068             tabPane.getTabs().setAll(tabList);
1069         }
1070 
1071         fooMap.entrySet().forEach(entry -&gt; {
1072             final Tab tab = entry.getKey();
1073             assertTrue(tabList.contains(tab));
1074             assertTrue(fooMap.containsKey(tab));
1075         });
1076     }
1077 
1078     // Test for JDK-8189424
1079     int selectionChangeCount = 0;
1080     @Test public void testTabClosingEventAndSelectionChange() {
1081         Tab t1 = new Tab(&quot;&quot;);
1082         Tab t2 = new Tab(&quot;&quot;);
1083         tabPane.getTabs().add(t1);
1084         tabPane.getTabs().add(t2);
1085         tabPane.setTabClosingPolicy(TabPane.TabClosingPolicy.ALL_TABS);
1086 
1087         tabPane.getSelectionModel().selectedItemProperty().addListener((ov, oldTab, newTab) -&gt; {
1088             selectionChangeCount++;
1089         });
1090         t1.setOnCloseRequest((event) -&gt; {
1091             event.consume();
1092             tabPane.getTabs().remove(t1);
1093         });
1094 
1095         root.getChildren().add(tabPane);
1096         show();
1097 
1098         root.applyCss();
1099         root.resize(300, 300);
1100         root.layout();
1101 
1102         tk.firePulse();
1103         assertTrue(tabPane.isFocused());
1104 
1105         tabPane.getSelectionModel().select(t1);
1106 
1107         double xval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinX();
1108         double yval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinY();
1109 
1110         SceneHelper.processMouseEvent(scene,
1111             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval + 19, yval + 17));
1112         tk.firePulse();
1113         SceneHelper.processMouseEvent(scene,
1114             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_RELEASED, xval + 19, yval + 17));
1115         tk.firePulse();
1116 
1117         assertEquals(1, tabPane.getTabs().size());
1118         assertEquals(t2, tabPane.getSelectionModel().getSelectedItem());
1119         assertEquals(1, selectionChangeCount);
1120 
1121         tabPane.getTabs().remove(t2);
1122     }
1123 
1124     // Test for JDK-8193495
1125     @Test public void testQuickRemoveAddTab() {
1126         int tabHeaderMinWidth = 200;
1127         int tabHeaderMinHeight = 50;
1128         tabPane.setMaxSize(400, 200);
1129         tabPane.setTabMinWidth(tabHeaderMinWidth);
1130         tabPane.setTabMinHeight(tabHeaderMinHeight);
1131         tabPane.getTabs().addAll(tab1, tab2, tab3);
1132         tabPane.setTabClosingPolicy(TabPane.TabClosingPolicy.UNAVAILABLE);
1133 
1134         root.getChildren().add(tabPane);
1135         show();
1136         tabPane.requestFocus();
1137         tk.firePulse();
1138         assertTrue(tabPane.isFocused());
1139 
1140         tabPane.getTabs().add(1, tabPane.getTabs().remove(0));
1141         tk.firePulse();
1142         tabPane.getSelectionModel().select(tab1);
1143         tk.firePulse();
1144 
1145         double xval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinX();
1146         double yval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinY();
1147 
1148         SceneHelper.processMouseEvent(scene,
1149             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval + 19, yval + 17));
1150         tk.firePulse();
1151         SceneHelper.processMouseEvent(scene,
1152             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval + 19, yval + 17));
1153         tk.firePulse();
1154 
1155         assertEquals(&quot;Tabpane should have 3 tabs.&quot;, 3, tabPane.getTabs().size());
1156         assertEquals(&quot;tab2 should be at index 0.&quot;, tab2, tabPane.getSelectionModel().getSelectedItem());
1157     }
1158 
1159     // Test for JDK-8154039
<a name="2" id="anc2"></a>
1160     @Test public void testSelectNonChildTab() {
1161         tabPane.getTabs().addAll(tab1);
1162         root.getChildren().add(tabPane);
1163         show();
1164         tk.firePulse();
<a name="3" id="anc3"></a><span class="line-modified">1165         WeakReference&lt;Tab&gt; weakTab = new WeakReference&lt;&gt;(new Tab(&quot;NonChildTab&quot;));</span>
1166         tabPane.getSelectionModel().select(weakTab.get());
1167         tk.firePulse();
<a name="4" id="anc4"></a><span class="line-modified">1168         attemptGC(10, weakTab);</span>
1169         tk.firePulse();
1170         assertNull(weakTab.get());
1171     }
1172 
<a name="5" id="anc5"></a><span class="line-modified">1173     private void attemptGC(int n, WeakReference&lt;?&gt; weakRef) {</span>
1174         // Attempt gc n times
1175         for (int i = 0; i &lt; n; i++) {
1176             System.gc();
1177             System.runFinalization();
1178 
<a name="6" id="anc6"></a><span class="line-modified">1179             if (weakRef.get() == null) {</span>
1180                 break;
1181             }
1182             try {
1183                 Thread.sleep(500);
1184             } catch (InterruptedException e) {
1185                 fail(&quot;InterruptedException occurred during Thread.sleep()&quot;);
1186             }
1187         }
1188     }
1189 
1190     // Test for JDK-8157690
1191     @Test public void testPopupItemsOnSortingTabs() {
1192         tabPane.setMaxSize(20, 20);
1193         root.getChildren().add(tabPane);
1194         tabPane.getTabs().addAll(tab1, tab2, tab3);
1195         show();
1196         tk.firePulse();
1197         TabPaneSkin tbSkin = (TabPaneSkin) tabPane.getSkin();
1198         assertNotNull(tbSkin);
1199         ContextMenu tabsMenu = TabPaneSkinShim.getTabsMenu(tbSkin);
1200         assertNotNull(tabsMenu);
1201         assertEquals(&quot;ContextMenu should contain 3 items.&quot;, 3, tabsMenu.getItems().size());
1202 
1203         tabPane.getTabs().sort((o1, o2) -&gt; sortCompare(o1, o2));
1204         tk.firePulse();
1205         assertEquals(&quot;ContextMenu should contain 3 items.&quot;, 3, tabsMenu.getItems().size());
1206     }
1207 
1208     private int sortCompare(Tab t1, Tab t2) {
1209         return t2.getText().compareTo(t1.getText());
1210     }
<a name="7" id="anc7"></a><span class="line-added">1211 </span>
<span class="line-added">1212     class TabPaneSkin1 extends TabPaneSkin {</span>
<span class="line-added">1213         TabPaneSkin1(TabPane tabPane) {</span>
<span class="line-added">1214             super(tabPane);</span>
<span class="line-added">1215         }</span>
<span class="line-added">1216     }</span>
<span class="line-added">1217 </span>
<span class="line-added">1218     @Ignore(&quot;JDK-8242621&quot;)</span>
<span class="line-added">1219     @Test</span>
<span class="line-added">1220     public void testNPEOnSwitchSkinAndChangeSelection() {</span>
<span class="line-added">1221         // Because of JDK-8242621, this test fails with NPE.</span>
<span class="line-added">1222         tabPane.getTabs().addAll(tab1, tab2);</span>
<span class="line-added">1223         root.getChildren().add(tabPane);</span>
<span class="line-added">1224         stage.show();</span>
<span class="line-added">1225         tk.firePulse();</span>
<span class="line-added">1226 </span>
<span class="line-added">1227         tabPane.setSkin(new TabPaneSkin1(tabPane));</span>
<span class="line-added">1228         tk.firePulse();</span>
<span class="line-added">1229         tabPane.getSelectionModel().select(1);</span>
<span class="line-added">1230         tk.firePulse();</span>
<span class="line-added">1231     }</span>
<span class="line-added">1232 </span>
<span class="line-added">1233     @Test</span>
<span class="line-added">1234     public void testSMLeakOnSwitchSkinAndSM() {</span>
<span class="line-added">1235         tabPane.getTabs().addAll(tab1, tab2);</span>
<span class="line-added">1236         root.getChildren().add(tabPane);</span>
<span class="line-added">1237         stage.show();</span>
<span class="line-added">1238         tk.firePulse();</span>
<span class="line-added">1239 </span>
<span class="line-added">1240         WeakReference&lt;SelectionModel&lt;Tab&gt;&gt; weakSMRef = new WeakReference&lt;&gt;(tabPane.getSelectionModel());</span>
<span class="line-added">1241         tabPane.setSkin(new TabPaneSkin1(tabPane));</span>
<span class="line-added">1242         tk.firePulse();</span>
<span class="line-added">1243         tabPane.setSelectionModel(TabPaneShim.getTabPaneSelectionModel(tabPane));</span>
<span class="line-added">1244         tk.firePulse();</span>
<span class="line-added">1245         attemptGC(10, weakSMRef);</span>
<span class="line-added">1246         assertNull(weakSMRef.get());</span>
<span class="line-added">1247     }</span>
1248 }
<a name="8" id="anc8"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="8" type="hidden" />
</body>
</html>