<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.graphics/src/main/native-prism-d3d/D3DPipeline.cc</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../native-glass/win/Utils.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="D3DShader.cc.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/native-prism-d3d/D3DPipeline.cc</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -34,13 +34,11 @@</span>
  typedef HRESULT WINAPI FnDirect3DCreate9Ex(UINT SDKVersion, IDirect3D9Ex**);
  
  FnDirect3DCreate9 * pD3D9FactoryFunction = 0;
  FnDirect3DCreate9Ex * pD3D9FactoryExFunction = 0;
  
<span class="udiff-line-modified-removed">- extern jboolean checkAndClearException(JNIEnv *env);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- jboolean checkAndClearException(JNIEnv *env) {</span>
<span class="udiff-line-modified-added">+ static jboolean checkAndClearException(JNIEnv *env) {</span>
      if (!env-&gt;ExceptionCheck()) {
          return JNI_FALSE;
      }
      env-&gt;ExceptionClear();
      return JNI_TRUE;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -75,10 +73,11 @@</span>
      IDirect3D9Ex * pD3D = 0;
      HRESULT hr = pD3D9FactoryExFunction ? pD3D9FactoryExFunction(D3D_SDK_VERSION, &amp;pD3D) : E_FAIL;
      return SUCCEEDED(hr) ? pD3D : 0;
  }
  
<span class="udiff-line-added">+ #ifndef STATIC_BUILD</span>
  BOOL APIENTRY DllMain( HANDLE hModule,
                         DWORD  ul_reason_for_call,
                         LPVOID lpReserved)
  {
      switch (ul_reason_for_call) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -89,10 +88,11 @@</span>
          freeD3DLibrary();
          break;
      }
      return TRUE;
  }
<span class="udiff-line-added">+ #endif // STATIC_BUILD</span>
  
  struct ConfigJavaStaticClass : IConfig {
      JNIEnv *_env; jclass _psClass;
      ConfigJavaStaticClass(JNIEnv *env, jclass psClass)  :
      _env(env), _psClass(psClass) {}
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -125,10 +125,14 @@</span>
      if (FAILED(D3DPipelineManager::CheckOSVersion())) {
          D3DPipelineManager::SetErrorMessage(&quot;Wrong operating system version&quot;);
          return false;
      }
  
<span class="udiff-line-added">+ #ifdef STATIC_BUILD</span>
<span class="udiff-line-added">+     loadD3DLibrary();</span>
<span class="udiff-line-added">+ #endif // STATIC_BUILD</span>
<span class="udiff-line-added">+ </span>
      TraceLn(NWT_TRACE_INFO, &quot;D3DPipeline_nInit&quot;);
      D3DPipelineManager *pMgr = D3DPipelineManager::CreateInstance(ConfigJavaStaticClass(env, psClass));
  
      if (!pMgr &amp;&amp; !D3DPipelineManager::GetErrorMessage()) {
          D3DPipelineManager::SetErrorMessage(&quot;Direct3D initialization failed&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -152,10 +156,14 @@</span>
  {
      TraceLn(NWT_TRACE_INFO, &quot;D3DPipeline_nDispose&quot;);
      if (D3DPipelineManager::GetInstance()) {
          D3DPipelineManager::DeleteInstance();
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #ifdef STATIC_BUILD</span>
<span class="udiff-line-added">+     freeD3DLibrary();</span>
<span class="udiff-line-added">+ #endif // STATIC_BUILD</span>
  }
  
  
  JNIEXPORT jint JNICALL Java_com_sun_prism_d3d_D3DPipeline_nGetAdapterOrdinal(JNIEnv *, jclass, jlong hMonitor) {
      D3DPipelineManager *pMgr = D3DPipelineManager::GetInstance();
</pre>
<center><a href="../native-glass/win/Utils.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="D3DShader.cc.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>