<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff build.gradle</title>
    <link rel="stylesheet" href="style.css" />
  </head>
<body>
<center>&lt; prev <a href="index.html" target="_top">index</a> next &gt;</center>    <h2>build.gradle</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1247,21 +1247,29 @@</span>
      logger.warn(&quot;*****************************************************************&quot;);
  }
  
  // Look for stub runtime in bundled sdk, standalone sdk, or boot JDK
  
<span class="udiff-line-added">+ // Allows automatic provisioning of webkit+media shared libraries</span>
<span class="udiff-line-added">+ // from official OpenJFX releases, downloaded from MavenCentral</span>
<span class="udiff-line-added">+ defineProperty(&quot;STUB_RUNTIME_OPENJFX&quot;, &quot;&quot;)</span>
<span class="udiff-line-added">+ ext.IS_STUB_RUNTIME_OPENJFX = !STUB_RUNTIME_OPENJFX.isBlank()</span>
<span class="udiff-line-added">+ </span>
  def String cachedBundledRuntime = cygpath(&quot;$projectDir&quot;) + &quot;/../caches/modular-sdk&quot;
  def String cachedStandaloneRuntime = cygpath(&quot;$projectDir&quot;) + &quot;/../caches/sdk&quot;
  def String jdkStubRuntime = cygpath(&quot;$JDK_HOME&quot;)
<span class="udiff-line-added">+ def String openjfxStubRuntime = cygpath(&quot;$projectDir&quot;) + &quot;/buildSrc/build/openjfxStub&quot;</span>
  
  def defaultStubRuntime = &quot;&quot;
  if (file(cachedBundledRuntime).exists()) {
      defaultStubRuntime = cachedBundledRuntime
  } else if (file(cachedStandaloneRuntime).exists()) {
      defaultStubRuntime = cachedStandaloneRuntime
  } else if (BUILD_CLOSED) {
      defaultStubRuntime = cachedBundledRuntime
<span class="udiff-line-added">+ } else if (IS_STUB_RUNTIME_OPENJFX) {</span>
<span class="udiff-line-added">+     defaultStubRuntime = openjfxStubRuntime</span>
  } else {
      defaultStubRuntime = jdkStubRuntime
  }
  
  defineProperty(&quot;STUB_RUNTIME&quot;, defaultStubRuntime)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3379,20 +3387,25 @@</span>
  
      compileJava.dependsOn(copyWrappers);
  
      test {
          doFirst {
<span class="udiff-line-modified-removed">-             if (!IS_COMPILE_WEBKIT) {</span>
<span class="udiff-line-modified-removed">-                 println &quot;*****************************************************&quot;</span>
<span class="udiff-line-modified-added">+             if (IS_STUB_RUNTIME_OPENJFX) {</span>
<span class="udiff-line-modified-added">+                 println &quot;********************************************************&quot;</span>
<span class="udiff-line-added">+                 println &quot;WARNING: running web tests with officially built webkit.&quot;</span>
<span class="udiff-line-added">+                 println &quot;The webkit native library may not be compatible with the&quot;</span>
<span class="udiff-line-added">+                 println &quot;source tree you are using.&quot;</span>
<span class="udiff-line-added">+                 println &quot;If tests fail, try compiling webkit instead.&quot;</span>
<span class="udiff-line-added">+                 println &quot;See WEBKIT-MEDIA-STUBS.md&quot;</span>
<span class="udiff-line-added">+                 println &quot;********************************************************&quot;</span>
<span class="udiff-line-added">+             } else if (!IS_COMPILE_WEBKIT) {</span>
<span class="udiff-line-added">+                 println &quot;******************************************************&quot;</span>
                  println &quot;WARNING: running web tests without building webkit.&quot;
                  println &quot;The webkit native library will be copied from the JDK,&quot;
                  println &quot;which might lead to failures in some web tests.&quot;
<span class="udiff-line-modified-removed">-                 println &quot;To avoid these failures, you should either build&quot;</span>
<span class="udiff-line-modified-removed">-                 println &quot;webkit locally, copy the native webkit library from a&quot;</span>
<span class="udiff-line-removed">-                 println &quot;recent build, or skip execution of web test cases with&quot;</span>
<span class="udiff-line-removed">-                 println &quot;&#39;-x :web:test&#39;&quot;</span>
<span class="udiff-line-removed">-                 println &quot;*****************************************************&quot;</span>
<span class="udiff-line-modified-added">+                 println &quot;See WEBKIT-MEDIA-STUBS.md&quot;</span>
<span class="udiff-line-modified-added">+                 println &quot;******************************************************&quot;</span>
              }
          }
          // Run web tests in headless mode
          systemProperty &#39;glass.platform&#39;, &#39;Monocle&#39;
          systemProperty &#39;monocle.platform&#39;, &#39;Headless&#39;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4319,10 +4332,40 @@</span>
          zipsTask.dependsOn(zipJmodsTask)
      }
  }
  
  
<span class="udiff-line-added">+ /******************************************************************************</span>
<span class="udiff-line-added">+  *                                                                            *</span>
<span class="udiff-line-added">+  *                             OpenJFX Stubs                                  *</span>
<span class="udiff-line-added">+  *                                                                            *</span>
<span class="udiff-line-added">+  *****************************************************************************/</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ configurations {</span>
<span class="udiff-line-added">+     openjfxStubs</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ if (IS_STUB_RUNTIME_OPENJFX) {</span>
<span class="udiff-line-added">+     def String platform = IS_MAC ? &quot;mac&quot; : IS_WINDOWS ? &quot;win&quot; : IS_LINUX ? &quot;linux&quot; : &quot;&quot;</span>
<span class="udiff-line-added">+     dependencies {</span>
<span class="udiff-line-added">+         openjfxStubs &quot;org.openjfx:javafx-media:$STUB_RUNTIME_OPENJFX:$platform@jar&quot;</span>
<span class="udiff-line-added">+         openjfxStubs &quot;org.openjfx:javafx-web:$STUB_RUNTIME_OPENJFX:$platform@jar&quot;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ // Extract binary libraries from OpenJFX artifacts for use as stubs</span>
<span class="udiff-line-added">+ task prepOpenJfxStubs(type: Copy) {</span>
<span class="udiff-line-added">+     enabled = IS_STUB_RUNTIME_OPENJFX</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     from configurations.openjfxStubs.files.collect { zipTree(it) }</span>
<span class="udiff-line-added">+     include(&quot;*.dll&quot;)</span>
<span class="udiff-line-added">+     include(&quot;*.dylib&quot;)</span>
<span class="udiff-line-added">+     include(&quot;*.so&quot;)</span>
<span class="udiff-line-added">+     into IS_WINDOWS ? file(&quot;$openjfxStubRuntime/bin&quot;) : file(&quot;$openjfxStubRuntime/lib&quot;)</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
  /******************************************************************************
   *                                                                            *
   *                               Modules                                      *
   *                                                                            *
   *****************************************************************************/
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4913,11 +4956,11 @@</span>
                      from (&quot;$winsdklib&quot;);
                  }
              }
          }
  
<span class="udiff-line-modified-removed">-         def buildModuleMediaTask = task(&quot;buildModuleMedia$t.capital&quot;, type: Copy, dependsOn: mediaProject.assemble) {</span>
<span class="udiff-line-modified-added">+         def buildModuleMediaTask = task(&quot;buildModuleMedia$t.capital&quot;, type: Copy, dependsOn: [mediaProject.assemble, prepOpenJfxStubs]) {</span>
              group = &quot;Basic&quot;
              description = &quot;copies javafx.media native libraries&quot;
  
              into &quot;${mediaProject.buildDir}/${moduleNativeDirName}&quot;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4950,11 +4993,11 @@</span>
                      from (&quot;$MEDIA_STUB/${library(&quot;glib-lite&quot;)}&quot;)
                  }
              }
          }
  
<span class="udiff-line-modified-removed">-         def buildModuleWeb = task(&quot;buildModuleWeb$t.capital&quot;, type: Copy, dependsOn: webProject.assemble) {</span>
<span class="udiff-line-modified-added">+         def buildModuleWeb = task(&quot;buildModuleWeb$t.capital&quot;, type: Copy, dependsOn: [webProject.assemble, prepOpenJfxStubs]) {</span>
              group = &quot;Basic&quot;
              description = &quot;copies javafx.web native libraries&quot;
  
              into &quot;${webProject.buildDir}/${moduleNativeDirName}&quot;
  
</pre>
<center>&lt; prev <a href="index.html" target="_top">index</a> next &gt;</center>  </body>
</html>