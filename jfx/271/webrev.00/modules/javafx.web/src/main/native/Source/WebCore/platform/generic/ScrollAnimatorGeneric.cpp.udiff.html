<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/generic/ScrollAnimatorGeneric.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../ScrollAnimationKinetic.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ScrollAnimatorGeneric.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/generic/ScrollAnimatorGeneric.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -38,28 +38,31 @@</span>
  
  namespace WebCore {
  
  static const Seconds overflowScrollbarsAnimationDuration { 1_s };
  static const Seconds overflowScrollbarsAnimationHideDelay { 2_s };
<span class="udiff-line-removed">- static const Seconds scrollCaptureThreshold { 150_ms };</span>
  
  std::unique_ptr&lt;ScrollAnimator&gt; ScrollAnimator::create(ScrollableArea&amp; scrollableArea)
  {
      return makeUnique&lt;ScrollAnimatorGeneric&gt;(scrollableArea);
  }
  
  ScrollAnimatorGeneric::ScrollAnimatorGeneric(ScrollableArea&amp; scrollableArea)
      : ScrollAnimator(scrollableArea)
      , m_overlayScrollbarAnimationTimer(*this, &amp;ScrollAnimatorGeneric::overlayScrollbarAnimationTimerFired)
  {
<span class="udiff-line-modified-removed">-     m_kineticAnimation = makeUnique&lt;ScrollAnimationKinetic&gt;(m_scrollableArea, [this](FloatPoint&amp;&amp; position) {</span>
<span class="udiff-line-modified-added">+     m_kineticAnimation = makeUnique&lt;ScrollAnimationKinetic&gt;(</span>
<span class="udiff-line-added">+         [this]() -&gt; ScrollAnimationKinetic::ScrollExtents {</span>
<span class="udiff-line-added">+             return { m_scrollableArea.minimumScrollPosition(), m_scrollableArea.maximumScrollPosition() };</span>
<span class="udiff-line-added">+         },</span>
<span class="udiff-line-added">+         [this](FloatPoint&amp;&amp; position) {</span>
  #if ENABLE(SMOOTH_SCROLLING)
<span class="udiff-line-modified-removed">-         if (m_smoothAnimation)</span>
<span class="udiff-line-modified-removed">-             m_smoothAnimation-&gt;setCurrentPosition(position);</span>
<span class="udiff-line-modified-added">+             if (m_smoothAnimation)</span>
<span class="udiff-line-modified-added">+                 m_smoothAnimation-&gt;setCurrentPosition(position);</span>
  #endif
<span class="udiff-line-modified-removed">-         updatePosition(WTFMove(position));</span>
<span class="udiff-line-modified-removed">-     });</span>
<span class="udiff-line-modified-added">+             updatePosition(WTFMove(position));</span>
<span class="udiff-line-modified-added">+         });</span>
  
  #if ENABLE(SMOOTH_SCROLLING)
      if (scrollableArea.scrollAnimatorEnabled())
          ensureSmoothScrollingAnimation();
  #endif
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -92,70 +95,43 @@</span>
  
  void ScrollAnimatorGeneric::scrollToOffsetWithoutAnimation(const FloatPoint&amp; offset, ScrollClamping)
  {
      FloatPoint position = ScrollableArea::scrollPositionFromOffset(offset, toFloatSize(m_scrollableArea.scrollOrigin()));
      m_kineticAnimation-&gt;stop();
<span class="udiff-line-modified-removed">-     m_scrollHistory.clear();</span>
<span class="udiff-line-modified-added">+     m_kineticAnimation-&gt;clearScrollHistory();</span>
  
  #if ENABLE(SMOOTH_SCROLLING)
      if (m_smoothAnimation)
          m_smoothAnimation-&gt;setCurrentPosition(position);
  #endif
  
      updatePosition(WTFMove(position));
  }
  
<span class="udiff-line-removed">- FloatPoint ScrollAnimatorGeneric::computeVelocity()</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     if (m_scrollHistory.isEmpty())</span>
<span class="udiff-line-removed">-         return { };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     auto first = m_scrollHistory[0].timestamp();</span>
<span class="udiff-line-removed">-     auto last = m_scrollHistory.rbegin()-&gt;timestamp();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if (last == first)</span>
<span class="udiff-line-removed">-         return { };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     FloatPoint accumDelta;</span>
<span class="udiff-line-removed">-     for (const auto&amp; scrollEvent : m_scrollHistory)</span>
<span class="udiff-line-removed">-         accumDelta += FloatPoint(scrollEvent.deltaX(), scrollEvent.deltaY());</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     m_scrollHistory.clear();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return FloatPoint(accumDelta.x() * -1 / (last - first).value(), accumDelta.y() * -1 / (last - first).value());</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  bool ScrollAnimatorGeneric::handleWheelEvent(const PlatformWheelEvent&amp; event)
  {
      m_kineticAnimation-&gt;stop();
  
<span class="udiff-line-removed">-     m_scrollHistory.removeAllMatching([&amp;event] (PlatformWheelEvent&amp; otherEvent) -&gt; bool {</span>
<span class="udiff-line-removed">-         return (event.timestamp() - otherEvent.timestamp()) &gt; scrollCaptureThreshold;</span>
<span class="udiff-line-removed">-     });</span>
<span class="udiff-line-removed">- </span>
  #if ENABLE(KINETIC_SCROLLING)
<span class="udiff-line-added">+     m_kineticAnimation-&gt;appendToScrollHistory(event);</span>
<span class="udiff-line-added">+ </span>
      if (event.isEndOfNonMomentumScroll()) {
<span class="udiff-line-modified-removed">-         // We don&#39;t need to add the event to the history as its delta will be (0, 0).</span>
<span class="udiff-line-removed">-         static_cast&lt;ScrollAnimationKinetic*&gt;(m_kineticAnimation.get())-&gt;start(m_currentPosition, computeVelocity(), m_scrollableArea.horizontalScrollbar(), m_scrollableArea.verticalScrollbar());</span>
<span class="udiff-line-modified-added">+         m_kineticAnimation-&gt;start(m_currentPosition, m_kineticAnimation-&gt;computeVelocity(), m_scrollableArea.horizontalScrollbar(), m_scrollableArea.verticalScrollbar());</span>
          return true;
      }
      if (event.isTransitioningToMomentumScroll()) {
<span class="udiff-line-modified-removed">-         m_scrollHistory.clear();</span>
<span class="udiff-line-modified-removed">-         static_cast&lt;ScrollAnimationKinetic*&gt;(m_kineticAnimation.get())-&gt;start(m_currentPosition, event.swipeVelocity(), m_scrollableArea.horizontalScrollbar(), m_scrollableArea.verticalScrollbar());</span>
<span class="udiff-line-modified-added">+         m_kineticAnimation-&gt;clearScrollHistory();</span>
<span class="udiff-line-modified-added">+         m_kineticAnimation-&gt;start(m_currentPosition, event.swipeVelocity(), m_scrollableArea.horizontalScrollbar(), m_scrollableArea.verticalScrollbar());</span>
          return true;
      }
  #endif
  
<span class="udiff-line-removed">-     m_scrollHistory.append(event);</span>
<span class="udiff-line-removed">- </span>
      return ScrollAnimator::handleWheelEvent(event);
  }
  
  void ScrollAnimatorGeneric::willEndLiveResize()
  {
<span class="udiff-line-removed">-     m_kineticAnimation-&gt;updateVisibleLengths();</span>
<span class="udiff-line-removed">- </span>
  #if ENABLE(SMOOTH_SCROLLING)
      if (m_smoothAnimation)
          m_smoothAnimation-&gt;updateVisibleLengths();
  #endif
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -167,12 +143,10 @@</span>
      notifyPositionChanged(delta);
  }
  
  void ScrollAnimatorGeneric::didAddVerticalScrollbar(Scrollbar* scrollbar)
  {
<span class="udiff-line-removed">-     m_kineticAnimation-&gt;updateVisibleLengths();</span>
<span class="udiff-line-removed">- </span>
  #if ENABLE(SMOOTH_SCROLLING)
      if (m_smoothAnimation)
          m_smoothAnimation-&gt;updateVisibleLengths();
  #endif
      if (!scrollbar-&gt;isOverlayScrollbar())
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -184,12 +158,10 @@</span>
      hideOverlayScrollbars();
  }
  
  void ScrollAnimatorGeneric::didAddHorizontalScrollbar(Scrollbar* scrollbar)
  {
<span class="udiff-line-removed">-     m_kineticAnimation-&gt;updateVisibleLengths();</span>
<span class="udiff-line-removed">- </span>
  #if ENABLE(SMOOTH_SCROLLING)
      if (m_smoothAnimation)
          m_smoothAnimation-&gt;updateVisibleLengths();
  #endif
      if (!scrollbar-&gt;isOverlayScrollbar())
</pre>
<center><a href="../ScrollAnimationKinetic.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ScrollAnimatorGeneric.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>