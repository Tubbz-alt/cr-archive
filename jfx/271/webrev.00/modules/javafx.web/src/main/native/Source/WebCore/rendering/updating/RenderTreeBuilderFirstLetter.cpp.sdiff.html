<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/rendering/updating/RenderTreeBuilderFirstLetter.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../svg/RenderSVGResourceContainer.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../svg/SVGClipPathElement.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/rendering/updating/RenderTreeBuilderFirstLetter.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
234 
235         // Account for first grapheme cluster.
236         length += numCodeUnitsInGraphemeClusters(StringView(oldText).substring(length), 1);
237 
238         // Keep looking for whitespace and allowed punctuation, but avoid
239         // accumulating just whitespace into the :first-letter.
240         unsigned numCodeUnits = 0;
241         for (unsigned scanLength = length; scanLength &lt; oldText.length(); scanLength += numCodeUnits) {
242             UChar32 c = oldText.characterStartingAt(scanLength);
243 
244             if (!shouldSkipForFirstLetter(c))
245                 break;
246 
247             numCodeUnits = numCodeUnitsInGraphemeClusters(StringView(oldText).substring(scanLength), 1);
248 
249             if (isPunctuationForFirstLetter(c))
250                 length = scanLength + numCodeUnits;
251         }
252 
253         auto* textNode = currentTextChild.textNode();
<span class="line-modified">254         auto* beforeChild = currentTextChild.nextSibling();</span>
255         auto inlineWrapperForDisplayContents = makeWeakPtr(currentTextChild.inlineWrapperForDisplayContents());
256         auto hasInlineWrapperForDisplayContents = inlineWrapperForDisplayContents.get();
257         m_builder.destroy(currentTextChild);
258 
259         // Construct a text fragment for the text after the first letter.
260         // This text fragment might be empty.
261         RenderPtr&lt;RenderTextFragment&gt; newRemainingText;
262         if (textNode) {
263             newRemainingText = createRenderer&lt;RenderTextFragment&gt;(*textNode, oldText, length, oldText.length() - length);
264             textNode-&gt;setRenderer(newRemainingText.get());
265         } else
266             newRemainingText = createRenderer&lt;RenderTextFragment&gt;(firstLetterBlock.document(), oldText, length, oldText.length() - length);
267 
268         RenderTextFragment&amp; remainingText = *newRemainingText;
269         ASSERT_UNUSED(hasInlineWrapperForDisplayContents, hasInlineWrapperForDisplayContents == inlineWrapperForDisplayContents.get());
270         remainingText.setInlineWrapperForDisplayContents(inlineWrapperForDisplayContents.get());
<span class="line-modified">271         m_builder.attach(*textContentParent, WTFMove(newRemainingText), beforeChild);</span>
272 
273         // FIXME: Make attach the final step so that we don&#39;t need to keep firstLetter around.
274         auto&amp; firstLetter = *newFirstLetter;
275         remainingText.setFirstLetter(firstLetter);
276         firstLetter.setFirstLetterRemainingText(remainingText);
277         m_builder.attach(*firstLetterContainer, WTFMove(newFirstLetter), &amp;remainingText);
278 
279         // Construct text fragment for the first letter.
280         auto letter = createRenderer&lt;RenderTextFragment&gt;(firstLetterBlock.document(), oldText, 0, length);
281         m_builder.attach(firstLetter, WTFMove(letter));
282     }
283 }
284 
285 };
</pre>
</td>
<td>
<hr />
<pre>
234 
235         // Account for first grapheme cluster.
236         length += numCodeUnitsInGraphemeClusters(StringView(oldText).substring(length), 1);
237 
238         // Keep looking for whitespace and allowed punctuation, but avoid
239         // accumulating just whitespace into the :first-letter.
240         unsigned numCodeUnits = 0;
241         for (unsigned scanLength = length; scanLength &lt; oldText.length(); scanLength += numCodeUnits) {
242             UChar32 c = oldText.characterStartingAt(scanLength);
243 
244             if (!shouldSkipForFirstLetter(c))
245                 break;
246 
247             numCodeUnits = numCodeUnitsInGraphemeClusters(StringView(oldText).substring(scanLength), 1);
248 
249             if (isPunctuationForFirstLetter(c))
250                 length = scanLength + numCodeUnits;
251         }
252 
253         auto* textNode = currentTextChild.textNode();
<span class="line-modified">254         auto beforeChild = makeWeakPtr(currentTextChild.nextSibling());</span>
255         auto inlineWrapperForDisplayContents = makeWeakPtr(currentTextChild.inlineWrapperForDisplayContents());
256         auto hasInlineWrapperForDisplayContents = inlineWrapperForDisplayContents.get();
257         m_builder.destroy(currentTextChild);
258 
259         // Construct a text fragment for the text after the first letter.
260         // This text fragment might be empty.
261         RenderPtr&lt;RenderTextFragment&gt; newRemainingText;
262         if (textNode) {
263             newRemainingText = createRenderer&lt;RenderTextFragment&gt;(*textNode, oldText, length, oldText.length() - length);
264             textNode-&gt;setRenderer(newRemainingText.get());
265         } else
266             newRemainingText = createRenderer&lt;RenderTextFragment&gt;(firstLetterBlock.document(), oldText, length, oldText.length() - length);
267 
268         RenderTextFragment&amp; remainingText = *newRemainingText;
269         ASSERT_UNUSED(hasInlineWrapperForDisplayContents, hasInlineWrapperForDisplayContents == inlineWrapperForDisplayContents.get());
270         remainingText.setInlineWrapperForDisplayContents(inlineWrapperForDisplayContents.get());
<span class="line-modified">271         m_builder.attach(*textContentParent, WTFMove(newRemainingText), beforeChild.get());</span>
272 
273         // FIXME: Make attach the final step so that we don&#39;t need to keep firstLetter around.
274         auto&amp; firstLetter = *newFirstLetter;
275         remainingText.setFirstLetter(firstLetter);
276         firstLetter.setFirstLetterRemainingText(remainingText);
277         m_builder.attach(*firstLetterContainer, WTFMove(newFirstLetter), &amp;remainingText);
278 
279         // Construct text fragment for the first letter.
280         auto letter = createRenderer&lt;RenderTextFragment&gt;(firstLetterBlock.document(), oldText, 0, length);
281         m_builder.attach(firstLetter, WTFMove(letter));
282     }
283 }
284 
285 };
</pre>
</td>
</tr>
</table>
<center><a href="../svg/RenderSVGResourceContainer.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../svg/SVGClipPathElement.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>