<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.controls/src/test/java/test/javafx/scene/control/TableViewHorizontalArrowsTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package test.javafx.scene.control;
 27 
 28 import java.util.Arrays;
 29 import java.util.Collection;
<a name="1" id="anc1"></a>
 30 
 31 import org.junit.After;
 32 import org.junit.Before;
 33 import org.junit.Test;
 34 import org.junit.runner.RunWith;
 35 import org.junit.runners.Parameterized;
 36 
 37 import static org.junit.Assert.*;
 38 import static test.com.sun.javafx.scene.control.infrastructure.KeyModifier.*;
 39 
<a name="2" id="anc2"></a><span class="line-added"> 40 import com.sun.javafx.util.Utils;</span>
 41 import javafx.geometry.NodeOrientation;
<a name="3" id="anc3"></a><span class="line-added"> 42 import javafx.scene.input.KeyCode;</span>
 43 import javafx.scene.control.SelectionMode;
 44 import javafx.scene.control.TableColumn;
 45 import javafx.scene.control.TablePosition;
 46 import javafx.scene.control.TableView;
<a name="4" id="anc4"></a><span class="line-added"> 47 import test.com.sun.javafx.scene.control.behavior.TableViewAnchorRetriever;</span>
 48 import test.com.sun.javafx.scene.control.infrastructure.KeyEventFirer;
 49 import test.com.sun.javafx.scene.control.infrastructure.KeyModifier;
 50 import test.com.sun.javafx.scene.control.infrastructure.StageLoader;
 51 
<a name="5" id="anc5"></a><span class="line-added"> 52 </span>
 53 /**
<a name="6" id="anc6"></a><span class="line-modified"> 54  * Test basic horizontal navigation mappings for TableView.</span>
<span class="line-added"> 55  * It is parameterized on NodeOrientation</span>
 56  */
 57 @RunWith(Parameterized.class)
 58 public class TableViewHorizontalArrowsTest {
 59     @Parameterized.Parameters
 60     public static Collection&lt;?&gt; implementations() {
 61         return Arrays.asList(new Object[][] {
 62             {NodeOrientation.LEFT_TO_RIGHT},
 63             {NodeOrientation.RIGHT_TO_LEFT}
 64         });
 65     }
 66 
 67     private TableView&lt;String&gt; tableView;
 68     private TableView.TableViewSelectionModel&lt;String&gt; sm;
 69     private TableView.TableViewFocusModel&lt;String&gt; fm;
 70 
 71     private TableColumn&lt;String, String&gt; col0;
 72     private TableColumn&lt;String, String&gt; col1;
 73     private TableColumn&lt;String, String&gt; col2;
 74     private TableColumn&lt;String, String&gt; col3;
 75     private TableColumn&lt;String, String&gt; col4;
 76 
 77     private KeyEventFirer keyboard;
 78     private StageLoader stageLoader;
 79     private NodeOrientation orientation;
 80 
 81     public TableViewHorizontalArrowsTest(NodeOrientation val) {
 82         orientation = val;
 83     }
 84 
 85     @Before
 86     public void setup() {
 87         tableView = new TableView&lt;String&gt;();
 88         tableView.setNodeOrientation(orientation);
 89         sm = tableView.getSelectionModel();
 90         fm = tableView.getFocusModel();
 91 
 92         sm.setSelectionMode(SelectionMode.MULTIPLE);
<a name="7" id="anc7"></a><span class="line-modified"> 93         sm.setCellSelectionEnabled(true);</span>
 94 
<a name="8" id="anc8"></a><span class="line-modified"> 95         tableView.getItems().setAll(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;);</span>

 96 
 97         col0 = new TableColumn&lt;String, String&gt;(&quot;col0&quot;);
 98         col1 = new TableColumn&lt;String, String&gt;(&quot;col1&quot;);
 99         col2 = new TableColumn&lt;String, String&gt;(&quot;col2&quot;);
100         col3 = new TableColumn&lt;String, String&gt;(&quot;col3&quot;);
101         col4 = new TableColumn&lt;String, String&gt;(&quot;col4&quot;);
102         tableView.getColumns().setAll(col0, col1, col2, col3, col4);
103 
104         keyboard = new KeyEventFirer(tableView);
105 
106         stageLoader = new StageLoader(tableView);
107         stageLoader.getStage().show();
108     }
109 
110     @After
111     public void tearDown() {
112         tableView.getSkin().dispose();
113         stageLoader.dispose();
114     }
115 
116     // ---------------- Helper methods -------------------------
117     /**
118      * Toggles the nodeOrientation of tableView.
119      */
120     private void changeNodeOrientation() {
121         orientation = (orientation == NodeOrientation.LEFT_TO_RIGHT?
122             NodeOrientation.RIGHT_TO_LEFT : NodeOrientation.LEFT_TO_RIGHT);
123         tableView.setNodeOrientation(orientation);
124     }
125 
126     /**
127      * Orientation-aware forward horizontal navigation with arrow keys.
128      * @param modifiers the modifiers to use on keyboard
129      */
130     private void forward(KeyModifier... modifiers) {
131         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {
132             keyboard.doRightArrowPress(modifiers);
133         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {
134             keyboard.doLeftArrowPress(modifiers);
135         }
136     }
137 
138     /**
139      * Orientation-aware backward horizontal navigation with arrow keys.
140      * @param modifiers the modifiers to use on keyboard
141      */
142     private void backward(KeyModifier... modifiers) {
143         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {
144             keyboard.doLeftArrowPress(modifiers);
145         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {
146             keyboard.doRightArrowPress(modifiers);
147         }
148     }
149 
<a name="9" id="anc9"></a><span class="line-added">150     private TablePosition getAnchor() {</span>
<span class="line-added">151         return TableViewAnchorRetriever.getAnchor(tableView);</span>
<span class="line-added">152     }</span>
<span class="line-added">153 </span>
<span class="line-added">154     private boolean isAnchor(int row) {</span>
<span class="line-added">155         TablePosition tp = new TablePosition(tableView, row, null);</span>
<span class="line-added">156         return getAnchor() != null &amp;&amp; getAnchor().equals(tp);</span>
<span class="line-added">157     }</span>
<span class="line-added">158 </span>
<span class="line-added">159     private boolean isAnchor(int row, int col) {</span>
<span class="line-added">160         TablePosition tp = new TablePosition(tableView, row, tableView.getColumns().get(col));</span>
<span class="line-added">161         return getAnchor() != null &amp;&amp; getAnchor().equals(tp);</span>
<span class="line-added">162     }</span>
<span class="line-added">163 </span>
164 
165     // ----------------------- Tests ----------------------------
166 
167     @Test
168     public void testForwardSelect() {
<a name="10" id="anc10"></a>
169         sm.select(0, col0);
170         forward();
171         assertTrue(&quot;next cell must be selected&quot;, sm.isSelected(0, col1));
172         assertFalse(&quot;old cell not be selected&quot;, sm.isSelected(0, col0));
173     }
174 
175     @Test
176     public void testBackwardSelect() {
<a name="11" id="anc11"></a>
177         sm.select(0, col4);
178         backward();
179         assertTrue(&quot;next cell must be selected&quot;, sm.isSelected(0, col3));
180         assertFalse(&quot;old cell not be selected&quot;, sm.isSelected(0, col4));
181     }
182 
183     @Test
184     public void testForwardFocus() {
<a name="12" id="anc12"></a>
185         sm.select(0, col0);
186         forward(getShortcutKey());
187         assertTrue(&quot;selected cell must still be selected&quot;, sm.isSelected(0, col0));
188         assertFalse(&quot;next cell must not be selected&quot;, sm.isSelected(0, col1));
189         TablePosition&lt;?, ?&gt; focusedCell = fm.getFocusedCell();
190         assertEquals(&quot;focused cell must moved to next&quot;, col1, focusedCell.getTableColumn());
191     }
192 
193     @Test
194     public void testBackwardFocus() {
<a name="13" id="anc13"></a>
195         sm.select(0, col4);
196         backward(getShortcutKey());
197         assertTrue(&quot;selected cell must still be selected&quot;, sm.isSelected(0, col4));
198         assertFalse(&quot;previous cell must not be selected&quot;, sm.isSelected(0, col3));
199         TablePosition&lt;?, ?&gt; focusedCell = fm.getFocusedCell();
200         assertEquals(&quot;focused cell must moved to prev&quot;, col3, focusedCell.getTableColumn());
201     }
202 
203 
<a name="14" id="anc14"></a><span class="line-modified">204     // Note : Any test that changs NodeOrientation must restore it back at the end of it</span>
205     @Test
206     public void testChangeOrientationSimpleForwardSelect() {
<a name="15" id="anc15"></a>
207         sm.select(0, col0);
208         forward();
209         assertTrue(sm.isSelected(0, col1));
210         assertFalse(sm.isSelected(0, col0));
211 
212         changeNodeOrientation();
213 
<a name="16" id="anc16"></a><span class="line-modified">214         // Now, test that the forward select respects change in NodeOrientation</span>
215         forward();
216 
217         assertFalse(sm.isSelected(0, col1));
218         assertTrue(sm.isSelected(0, col2));
<a name="17" id="anc17"></a><span class="line-added">219 </span>
<span class="line-added">220         // Restore Node orientation</span>
<span class="line-added">221         changeNodeOrientation();</span>
222     }
223 
<a name="18" id="anc18"></a><span class="line-added">224     // Note : Any test that changs NodeOrientation must restore it back at the end of it</span>
225     @Test
226     public void testChangeOrientationSimpleBackwardSelect() {
<a name="19" id="anc19"></a>
227         sm.select(0, col4);
228         backward();
229         assertTrue(sm.isSelected(0, col3));
230         assertFalse(sm.isSelected(0, col4));
231 
232         changeNodeOrientation();
233 
<a name="20" id="anc20"></a><span class="line-modified">234         // Now, test that the backward select respects change in NodeOrientation</span>
235         backward();
236         assertFalse(sm.isSelected(0, col3));
237         assertTrue(sm.isSelected(0, col2));
<a name="21" id="anc21"></a><span class="line-added">238 </span>
<span class="line-added">239         // Restore Node orientation</span>
<span class="line-added">240         changeNodeOrientation();</span>
<span class="line-added">241     }</span>
<span class="line-added">242 </span>
<span class="line-added">243     @Test public void testShiftBackwardWhenAtFirstCol() {</span>
<span class="line-added">244         sm.select(0, col0);</span>
<span class="line-added">245         backward(KeyModifier.SHIFT);</span>
<span class="line-added">246 </span>
<span class="line-added">247         assertTrue(&quot;Selected cell remains selected&quot;, sm.isSelected(0, col0));</span>
<span class="line-added">248 </span>
<span class="line-added">249         // We are at the first colum, there is no backward cell</span>
<span class="line-added">250         assertFalse(&quot;sanity - forward cell must not be selected&quot;, sm.isSelected(0, col1));</span>
<span class="line-added">251     }</span>
<span class="line-added">252 </span>
<span class="line-added">253     @Test public void testShiftForwardWhenAtFirstCol() {</span>
<span class="line-added">254         sm.select(0, col0);</span>
<span class="line-added">255         forward(KeyModifier.SHIFT);</span>
<span class="line-added">256 </span>
<span class="line-added">257         assertTrue(&quot;Selected cell remains selected&quot;, sm.isSelected(0, col0));</span>
<span class="line-added">258         assertTrue(&quot;forward cell must also be selected&quot;, sm.isSelected(0, col1));</span>
<span class="line-added">259     }</span>
<span class="line-added">260     </span>
<span class="line-added">261     @Test public void testShiftBackwardWhenAtLastCol() {</span>
<span class="line-added">262         sm.select(0, col4);</span>
<span class="line-added">263         backward(KeyModifier.SHIFT);</span>
<span class="line-added">264         assertTrue(&quot;Selected cell remains selected&quot;, sm.isSelected(0, col4));</span>
<span class="line-added">265         assertTrue(&quot;backward cell must also be selected&quot;, sm.isSelected(0, col3));</span>
266     }
267 
<a name="22" id="anc22"></a><span class="line-modified">268     @Test public void testShiftForwardWhenAtLastCol() {</span>
<span class="line-added">269         sm.select(0, col4);</span>
<span class="line-added">270         forward(KeyModifier.SHIFT);</span>
<span class="line-added">271         assertTrue(&quot;Selected cell remains selected&quot;, sm.isSelected(0, col4));</span>
<span class="line-added">272 </span>
<span class="line-added">273         // We are at the last colum, there is no forward cell</span>
<span class="line-added">274         assertFalse(&quot;sanity - backward cell must not be selected&quot;, sm.isSelected(0, col3));</span>
<span class="line-added">275     }</span>
<span class="line-added">276 </span>
<span class="line-added">277     @Test public void testCtrlBackwardDoesNotMoveRowFocus() {</span>
<span class="line-added">278         // Select first row</span>
<span class="line-added">279         sm.clearAndSelect(0);</span>
<span class="line-added">280         assertTrue(fm.isFocused(0));</span>
<span class="line-added">281 </span>
<span class="line-added">282         backward(KeyModifier.getShortcutKey());</span>
<span class="line-added">283 </span>
<span class="line-added">284         assertTrue(&quot;Focus should not change&quot;, fm.isFocused(0));</span>
<span class="line-added">285         assertTrue(&quot;Selection should not change&quot;, sm.isSelected(0));</span>
<span class="line-added">286     }</span>
<span class="line-added">287 </span>
<span class="line-added">288     @Test public void testCtrlForwardDoesNotMoveRowFocus() {</span>
<span class="line-added">289         // Select first row</span>
<span class="line-added">290         sm.clearAndSelect(0);</span>
<span class="line-added">291         assertTrue(fm.isFocused(0));</span>
<span class="line-added">292 </span>
<span class="line-added">293         forward(KeyModifier.getShortcutKey());</span>
<span class="line-added">294 </span>
<span class="line-added">295         assertTrue(&quot;Focus should not change&quot;, fm.isFocused(0));</span>
<span class="line-added">296         assertTrue(&quot;Selection should not change&quot;, sm.isSelected(0));</span>
<span class="line-added">297     }</span>
<span class="line-added">298 </span>
<span class="line-added">299     // Tests for discontinuous multiple cell selection (RT-18951)</span>
<span class="line-added">300     @Test public void test_rt18591_select_forward_then_backward() {</span>
<span class="line-added">301         sm.select(0, col0);</span>
<span class="line-added">302 </span>
<span class="line-added">303         forward(KeyModifier.getShortcutKey());</span>
<span class="line-added">304         forward(KeyModifier.getShortcutKey());</span>
<span class="line-added">305         keyboard.doKeyPress(KeyCode.SPACE,</span>
<span class="line-added">306                 KeyModifier.getShortcutKey(),</span>
<span class="line-added">307                 (Utils.isMac()? KeyModifier.CTRL : null));</span>
<span class="line-added">308         assertTrue(sm.isSelected(0, col0));</span>
<span class="line-added">309         assertFalse(sm.isSelected(0, col1));</span>
<span class="line-added">310         assertTrue(sm.isSelected(0, col2));</span>
<span class="line-added">311         assertTrue(isAnchor(0, 2));</span>
<span class="line-added">312 </span>
<span class="line-added">313         forward(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">314         forward(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">315 </span>
<span class="line-added">316         assertTrue(sm.isSelected(0, col0));</span>
<span class="line-added">317         assertFalse(sm.isSelected(0, col1));</span>
<span class="line-added">318         assertTrue(sm.isSelected(0, col2));</span>
<span class="line-added">319         assertTrue(sm.isSelected(0, col3));</span>
<span class="line-added">320         assertTrue(sm.isSelected(0, col4));</span>
<span class="line-added">321         assertTrue(isAnchor(0,2));</span>
<span class="line-added">322 </span>
<span class="line-added">323 </span>
<span class="line-added">324         backward(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">325         backward(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">326         backward(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">327 </span>
<span class="line-added">328         assertTrue(sm.isSelected(0, col0));</span>
<span class="line-added">329         assertTrue(sm.isSelected(0, col1));</span>
<span class="line-added">330         assertTrue(sm.isSelected(0, col2));</span>
<span class="line-added">331         assertTrue(sm.isSelected(0, col3));</span>
<span class="line-added">332         assertTrue(sm.isSelected(0, col4));</span>
<span class="line-added">333     }</span>
<span class="line-added">334 </span>
<span class="line-added">335     @Test public void test_rt18591_select_backward_then_forward() {</span>
<span class="line-added">336         sm.select(0, col4);</span>
<span class="line-added">337 </span>
<span class="line-added">338         backward(KeyModifier.getShortcutKey());</span>
<span class="line-added">339         backward(KeyModifier.getShortcutKey());</span>
<span class="line-added">340         keyboard.doKeyPress(KeyCode.SPACE,</span>
<span class="line-added">341                 KeyModifier.getShortcutKey(),</span>
<span class="line-added">342                 (Utils.isMac()? KeyModifier.CTRL : null));</span>
<span class="line-added">343 </span>
<span class="line-added">344         assertTrue(sm.isSelected(0, col4));</span>
<span class="line-added">345         assertFalse(sm.isSelected(0, col3));</span>
<span class="line-added">346         assertTrue(sm.isSelected(0, col2));</span>
<span class="line-added">347         assertTrue(isAnchor(0, 2));</span>
<span class="line-added">348 </span>
<span class="line-added">349         backward(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">350         backward(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">351 </span>
<span class="line-added">352         assertTrue(sm.isSelected(0, col4));</span>
<span class="line-added">353         assertFalse(sm.isSelected(0, col3));</span>
<span class="line-added">354         assertTrue(sm.isSelected(0, col2));</span>
<span class="line-added">355         assertTrue(sm.isSelected(0, col1));</span>
<span class="line-added">356         assertTrue(sm.isSelected(0, col0));</span>
<span class="line-added">357         assertTrue(isAnchor(0,2));</span>
<span class="line-added">358 </span>
<span class="line-added">359         forward(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">360         forward(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">361         forward(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">362 </span>
<span class="line-added">363         assertTrue(sm.isSelected(0, col4));</span>
<span class="line-added">364         assertTrue(sm.isSelected(0, col3));</span>
<span class="line-added">365         assertTrue(sm.isSelected(0, col2));</span>
<span class="line-added">366         assertTrue(sm.isSelected(0, col1));</span>
<span class="line-added">367         assertTrue(sm.isSelected(0, col0));</span>
<span class="line-added">368     }</span>
<span class="line-added">369 </span>
<span class="line-added">370     @Test public void test_rt18536_forward_focus_and_selectAll() {</span>
<span class="line-added">371         // Test shift selection when focus is elsewhere (so as to select a range)</span>
<span class="line-added">372         sm.clearAndSelect(1, col0);</span>
<span class="line-added">373 </span>
<span class="line-added">374         // move focus by holding down ctrl button</span>
<span class="line-added">375         forward(KeyModifier.getShortcutKey());   // move focus to (1, col1)</span>
<span class="line-added">376         forward(KeyModifier.getShortcutKey());   // move focus to (1, col2)</span>
<span class="line-added">377         forward(KeyModifier.getShortcutKey());   // move focus to (1, col3)</span>
<span class="line-added">378         forward(KeyModifier.getShortcutKey());   // move focus to (1, col4)</span>
<span class="line-added">379         assertTrue(fm.isFocused(1, col4));</span>
<span class="line-added">380 </span>
<span class="line-added">381         // press shift + space to select all cells between (1, col0) and (1, col4)</span>
<span class="line-added">382         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);</span>
<span class="line-added">383         assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">384         assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">385         assertTrue(sm.isSelected(1, col2));</span>
<span class="line-added">386         assertTrue(sm.isSelected(1, col3));</span>
<span class="line-added">387         assertTrue(sm.isSelected(1, col4));</span>
<span class="line-added">388     }</span>
<span class="line-added">389 </span>
<span class="line-added">390     @Test public void test_rt18536_backward_focus_and_selectAll() {</span>
<span class="line-added">391         // Test shift selection when focus is elsewhere (so as to select a range)</span>
<span class="line-added">392         sm.clearAndSelect(1, col4);</span>
<span class="line-added">393 </span>
<span class="line-added">394         // move focus by holding down ctrl button</span>
<span class="line-added">395         backward(KeyModifier.getShortcutKey());   // move focus to (1, col3)</span>
<span class="line-added">396         backward(KeyModifier.getShortcutKey());   // move focus to (1, col2)</span>
<span class="line-added">397         backward(KeyModifier.getShortcutKey());   // move focus to (1, col1)</span>
<span class="line-added">398         backward(KeyModifier.getShortcutKey());   // move focus to (1, col0)</span>
<span class="line-added">399         assertTrue(fm.isFocused(1, col0));</span>
<span class="line-added">400 </span>
<span class="line-added">401         // press shift + space to select all cells between (1, col0) and (1, col4)</span>
<span class="line-added">402         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);</span>
<span class="line-added">403         assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">404         assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">405         assertTrue(sm.isSelected(1, col2));</span>
<span class="line-added">406         assertTrue(sm.isSelected(1, col3));</span>
<span class="line-added">407         assertTrue(sm.isSelected(1, col4));</span>
<span class="line-added">408     }</span>
409 }
<a name="23" id="anc23"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="23" type="hidden" />
</body>
</html>