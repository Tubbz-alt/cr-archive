<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.graphics/src/main/native-iio/libjpeg/jpeglib.h</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
   2  * jpeglib.h
   3  *
   4  * Copyright (C) 1991-1998, Thomas G. Lane.
<a name="1" id="anc1"></a><span class="line-modified">   5  * Modified 2002-2019 by Guido Vollbeding.</span>
   6  * This file is part of the Independent JPEG Group&#39;s software.
   7  * For conditions of distribution and use, see the accompanying README file.
   8  *
   9  * This file defines the application interface for the JPEG library.
  10  * Most applications using the library need only include this file,
  11  * and perhaps jerror.h if they want to know the exact error codes.
  12  */
  13 
  14 #ifndef JPEGLIB_H
  15 #define JPEGLIB_H
  16 
  17 /*
  18  * First we include the configuration files that record how this
  19  * installation of the JPEG library is set up.  jconfig.h can be
  20  * generated automatically for many systems.  jmorecfg.h contains
  21  * manual configuration options that most people need not worry about.
  22  */
  23 
  24 #ifndef JCONFIG_INCLUDED    /* in case jinclude.h already did */
  25 #include &quot;jconfig.h&quot;        /* widely used configuration options */
  26 #endif
  27 #include &quot;jmorecfg.h&quot;        /* seldom changed options */
  28 
  29 
  30 #ifdef __cplusplus
  31 #ifndef DONT_USE_EXTERN_C
  32 extern &quot;C&quot; {
  33 #endif
  34 #endif
  35 
  36 /* Version IDs for the JPEG library.
  37  * Might be useful for tests like &quot;#if JPEG_LIB_VERSION &gt;= 90&quot;.
  38  */
  39 
  40 #define JPEG_LIB_VERSION        90    /* Compatibility version 9.0 */
  41 #define JPEG_LIB_VERSION_MAJOR  9
<a name="2" id="anc2"></a><span class="line-modified">  42 #define JPEG_LIB_VERSION_MINOR  4</span>
  43 
  44 
  45 /* Various constants determining the sizes of things.
  46  * All of these are specified by the JPEG standard,
  47  * so don&#39;t change them if you want to be compatible.
  48  */
  49 
  50 #define DCTSIZE            8    /* The basic DCT block is 8x8 coefficients */
  51 #define DCTSIZE2        64    /* DCTSIZE squared; # of elements in a block */
  52 #define NUM_QUANT_TBLS      4    /* Quantization tables are numbered 0..3 */
  53 #define NUM_HUFF_TBLS       4    /* Huffman tables are numbered 0..3 */
  54 #define NUM_ARITH_TBLS      16    /* Arith-coding tables are numbered 0..15 */
  55 #define MAX_COMPS_IN_SCAN   4    /* JPEG limit on # of components in one scan */
  56 #define MAX_SAMP_FACTOR     4    /* JPEG limit on sampling factors */
  57 /* Unfortunately, some bozo at Adobe saw no reason to be bound by the standard;
  58  * the PostScript DCT filter can emit files with many more than 10 blocks/MCU.
  59  * If you happen to run across such a file, you can up D_MAX_BLOCKS_IN_MCU
  60  * to handle it.  We even let you do this from the jconfig.h file.  However,
  61  * we strongly discourage changing C_MAX_BLOCKS_IN_MCU; just because Adobe
  62  * sometimes emits noncompliant files doesn&#39;t mean you should too.
  63  */
  64 #define C_MAX_BLOCKS_IN_MCU   10 /* compressor&#39;s limit on blocks per MCU */
  65 #ifndef D_MAX_BLOCKS_IN_MCU
  66 #define D_MAX_BLOCKS_IN_MCU   10 /* decompressor&#39;s limit on blocks per MCU */
  67 #endif
  68 
  69 
  70 /* Data structures for images (arrays of samples and of DCT coefficients).
  71  * On 80x86 machines, the image arrays are too big for near pointers,
  72  * but the pointer arrays can fit in near memory.
  73  */
  74 
  75 typedef JSAMPLE FAR *JSAMPROW;    /* ptr to one image row of pixel samples. */
  76 typedef JSAMPROW *JSAMPARRAY;    /* ptr to some rows (a 2-D sample array) */
  77 typedef JSAMPARRAY *JSAMPIMAGE;    /* a 3-D sample array: top index is color */
  78 
  79 typedef JCOEF JBLOCK[DCTSIZE2];    /* one block of coefficients */
  80 typedef JBLOCK FAR *JBLOCKROW;    /* pointer to one row of coefficient blocks */
  81 typedef JBLOCKROW *JBLOCKARRAY;        /* a 2-D array of coefficient blocks */
  82 typedef JBLOCKARRAY *JBLOCKIMAGE;    /* a 3-D array of coefficient blocks */
  83 
  84 typedef JCOEF FAR *JCOEFPTR;    /* useful in a couple of places */
  85 
  86 
  87 /* Types for JPEG compression parameters and working tables. */
  88 
  89 
  90 /* DCT coefficient quantization tables. */
  91 
  92 typedef struct {
  93   /* This array gives the coefficient quantizers in natural array order
  94    * (not the zigzag order in which they are stored in a JPEG DQT marker).
  95    * CAUTION: IJG versions prior to v6a kept this array in zigzag order.
  96    */
  97   UINT16 quantval[DCTSIZE2];    /* quantization step for each coefficient */
  98   /* This field is used only during compression.  It&#39;s initialized FALSE when
  99    * the table is created, and set TRUE when it&#39;s been output to the file.
 100    * You could suppress output of a table by setting this to TRUE.
 101    * (See jpeg_suppress_tables for an example.)
 102    */
 103   boolean sent_table;        /* TRUE when table has been output */
 104 } JQUANT_TBL;
 105 
 106 
 107 /* Huffman coding tables. */
 108 
 109 typedef struct {
 110   /* These two fields directly represent the contents of a JPEG DHT marker */
 111   UINT8 bits[17];        /* bits[k] = # of symbols with codes of */
 112                 /* length k bits; bits[0] is unused */
 113   UINT8 huffval[256];        /* The symbols, in order of incr code length */
 114   /* This field is used only during compression.  It&#39;s initialized FALSE when
 115    * the table is created, and set TRUE when it&#39;s been output to the file.
 116    * You could suppress output of a table by setting this to TRUE.
 117    * (See jpeg_suppress_tables for an example.)
 118    */
 119   boolean sent_table;        /* TRUE when table has been output */
 120 } JHUFF_TBL;
 121 
 122 
 123 /* Basic info about one component (color channel). */
 124 
 125 typedef struct {
 126   /* These values are fixed over the whole image. */
 127   /* For compression, they must be supplied by parameter setup; */
 128   /* for decompression, they are read from the SOF marker. */
 129   int component_id;        /* identifier for this component (0..255) */
 130   int component_index;        /* its index in SOF or cinfo-&gt;comp_info[] */
 131   int h_samp_factor;        /* horizontal sampling factor (1..4) */
 132   int v_samp_factor;        /* vertical sampling factor (1..4) */
 133   int quant_tbl_no;        /* quantization table selector (0..3) */
 134   /* These values may vary between scans. */
 135   /* For compression, they must be supplied by parameter setup; */
 136   /* for decompression, they are read from the SOS marker. */
 137   /* The decompressor output side may not use these variables. */
 138   int dc_tbl_no;        /* DC entropy table selector (0..3) */
 139   int ac_tbl_no;        /* AC entropy table selector (0..3) */
 140 
 141   /* Remaining fields should be treated as private by applications. */
 142 
 143   /* These values are computed during compression or decompression startup: */
 144   /* Component&#39;s size in DCT blocks.
 145    * Any dummy blocks added to complete an MCU are not counted; therefore
 146    * these values do not depend on whether a scan is interleaved or not.
 147    */
 148   JDIMENSION width_in_blocks;
 149   JDIMENSION height_in_blocks;
 150   /* Size of a DCT block in samples,
 151    * reflecting any scaling we choose to apply during the DCT step.
 152    * Values from 1 to 16 are supported.
 153    * Note that different components may receive different DCT scalings.
 154    */
 155   int DCT_h_scaled_size;
 156   int DCT_v_scaled_size;
 157   /* The downsampled dimensions are the component&#39;s actual, unpadded number
 158    * of samples at the main buffer (preprocessing/compression interface);
 159    * DCT scaling is included, so
 160    * downsampled_width =
 161    *   ceil(image_width * Hi/Hmax * DCT_h_scaled_size/block_size)
 162    * and similarly for height.
 163    */
 164   JDIMENSION downsampled_width;     /* actual width in samples */
 165   JDIMENSION downsampled_height; /* actual height in samples */
 166   /* For decompression, in cases where some of the components will be
 167    * ignored (eg grayscale output from YCbCr image), we can skip most
 168    * computations for the unused components.
 169    * For compression, some of the components will need further quantization
 170    * scale by factor of 2 after DCT (eg BG_YCC output from normal RGB input).
 171    * The field is first set TRUE for decompression, FALSE for compression
 172    * in initial_setup, and then adapted in color conversion setup.
 173    */
 174   boolean component_needed;
 175 
 176   /* These values are computed before starting a scan of the component. */
 177   /* The decompressor output side may not use these variables. */
 178   int MCU_width;        /* number of blocks per MCU, horizontally */
 179   int MCU_height;        /* number of blocks per MCU, vertically */
 180   int MCU_blocks;        /* MCU_width * MCU_height */
 181   int MCU_sample_width;    /* MCU width in samples: MCU_width * DCT_h_scaled_size */
 182   int last_col_width;        /* # of non-dummy blocks across in last MCU */
 183   int last_row_height;        /* # of non-dummy blocks down in last MCU */
 184 
 185   /* Saved quantization table for component; NULL if none yet saved.
 186    * See jdinput.c comments about the need for this information.
 187    * This field is currently used only for decompression.
 188    */
 189   JQUANT_TBL * quant_table;
 190 
 191   /* Private per-component storage for DCT or IDCT subsystem. */
 192   void * dct_table;
 193 } jpeg_component_info;
 194 
 195 
 196 /* The script for encoding a multiple-scan file is an array of these: */
 197 
 198 typedef struct {
 199   int comps_in_scan;        /* number of components encoded in this scan */
 200   int component_index[MAX_COMPS_IN_SCAN]; /* their SOF/comp_info[] indexes */
 201   int Ss, Se;            /* progressive JPEG spectral selection parms */
 202   int Ah, Al;            /* progressive JPEG successive approx. parms */
 203 } jpeg_scan_info;
 204 
 205 /* The decompressor can save APPn and COM markers in a list of these: */
 206 
 207 typedef struct jpeg_marker_struct FAR * jpeg_saved_marker_ptr;
 208 
 209 struct jpeg_marker_struct {
 210   jpeg_saved_marker_ptr next;    /* next in list, or NULL */
 211   UINT8 marker;            /* marker code: JPEG_COM, or JPEG_APP0+n */
 212   unsigned int original_length;    /* # bytes of data in the file */
 213   unsigned int data_length;    /* # bytes of data saved at data[] */
 214   JOCTET FAR * data;        /* the data contained in the marker */
 215   /* the marker length word is not counted in data_length or original_length */
 216 };
 217 
 218 /* Known color spaces. */
 219 
 220 typedef enum {
 221     JCS_UNKNOWN,        /* error/unspecified */
 222     JCS_GRAYSCALE,        /* monochrome */
 223     JCS_RGB,        /* red/green/blue, standard RGB (sRGB) */
 224     JCS_YCbCr,        /* Y/Cb/Cr (also known as YUV), standard YCC */
 225     JCS_CMYK,        /* C/M/Y/K */
 226     JCS_YCCK,        /* Y/Cb/Cr/K */
 227     JCS_BG_RGB,        /* big gamut red/green/blue, bg-sRGB */
 228     JCS_BG_YCC        /* big gamut Y/Cb/Cr, bg-sYCC */
 229 } J_COLOR_SPACE;
 230 
 231 /* Supported color transforms. */
 232 
 233 typedef enum {
 234     JCT_NONE           = 0,
 235     JCT_SUBTRACT_GREEN = 1
 236 } J_COLOR_TRANSFORM;
 237 
 238 /* DCT/IDCT algorithm options. */
 239 
 240 typedef enum {
 241     JDCT_ISLOW,        /* slow but accurate integer algorithm */
 242     JDCT_IFAST,        /* faster, less accurate integer method */
 243     JDCT_FLOAT        /* floating-point: accurate, fast on fast HW */
 244 } J_DCT_METHOD;
 245 
 246 #ifndef JDCT_DEFAULT        /* may be overridden in jconfig.h */
 247 #define JDCT_DEFAULT  JDCT_ISLOW
 248 #endif
 249 #ifndef JDCT_FASTEST        /* may be overridden in jconfig.h */
 250 #define JDCT_FASTEST  JDCT_IFAST
 251 #endif
 252 
 253 /* Dithering options for decompression. */
 254 
 255 typedef enum {
 256     JDITHER_NONE,        /* no dithering */
 257     JDITHER_ORDERED,    /* simple ordered dither */
 258     JDITHER_FS        /* Floyd-Steinberg error diffusion dither */
 259 } J_DITHER_MODE;
 260 
 261 
 262 /* Common fields between JPEG compression and decompression master structs. */
 263 
 264 #define jpeg_common_fields \
 265   struct jpeg_error_mgr * err;    /* Error handler module */\
 266   struct jpeg_memory_mgr * mem;    /* Memory manager module */\
 267   struct jpeg_progress_mgr * progress; /* Progress monitor, or NULL if none */\
 268   void * client_data;        /* Available for use by application */\
 269   boolean is_decompressor;    /* So common code can tell which is which */\
 270   int global_state        /* For checking call sequence validity */
 271 
 272 /* Routines that are to be used by both halves of the library are declared
 273  * to receive a pointer to this structure.  There are no actual instances of
 274  * jpeg_common_struct, only of jpeg_compress_struct and jpeg_decompress_struct.
 275  */
 276 struct jpeg_common_struct {
 277   jpeg_common_fields;        /* Fields common to both master struct types */
 278   /* Additional fields follow in an actual jpeg_compress_struct or
 279    * jpeg_decompress_struct.  All three structs must agree on these
 280    * initial fields!  (This would be a lot cleaner in C++.)
 281    */
 282 };
 283 
 284 typedef struct jpeg_common_struct * j_common_ptr;
 285 typedef struct jpeg_compress_struct * j_compress_ptr;
 286 typedef struct jpeg_decompress_struct * j_decompress_ptr;
 287 
 288 
 289 /* Master record for a compression instance */
 290 
 291 struct jpeg_compress_struct {
 292   jpeg_common_fields;        /* Fields shared with jpeg_decompress_struct */
 293 
 294   /* Destination for compressed data */
 295   struct jpeg_destination_mgr * dest;
 296 
 297   /* Description of source image --- these fields must be filled in by
 298    * outer application before starting compression.  in_color_space must
 299    * be correct before you can even call jpeg_set_defaults().
 300    */
 301 
 302   JDIMENSION image_width;    /* input image width */
 303   JDIMENSION image_height;    /* input image height */
 304   int input_components;        /* # of color components in input image */
 305   J_COLOR_SPACE in_color_space;    /* colorspace of input image */
 306 
 307   double input_gamma;        /* image gamma of input image */
 308 
 309   /* Compression parameters --- these fields must be set before calling
 310    * jpeg_start_compress().  We recommend calling jpeg_set_defaults() to
 311    * initialize everything to reasonable defaults, then changing anything
 312    * the application specifically wants to change.  That way you won&#39;t get
 313    * burnt when new parameters are added.  Also note that there are several
 314    * helper routines to simplify changing parameters.
 315    */
 316 
 317   unsigned int scale_num, scale_denom; /* fraction by which to scale image */
 318 
 319   JDIMENSION jpeg_width;    /* scaled JPEG image width */
 320   JDIMENSION jpeg_height;    /* scaled JPEG image height */
 321   /* Dimensions of actual JPEG image that will be written to file,
 322    * derived from input dimensions by scaling factors above.
 323    * These fields are computed by jpeg_start_compress().
 324    * You can also use jpeg_calc_jpeg_dimensions() to determine these values
 325    * in advance of calling jpeg_start_compress().
 326    */
 327 
 328   int data_precision;        /* bits of precision in image data */
 329 
 330   int num_components;        /* # of color components in JPEG image */
 331   J_COLOR_SPACE jpeg_color_space; /* colorspace of JPEG image */
 332 
 333   jpeg_component_info * comp_info;
 334   /* comp_info[i] describes component that appears i&#39;th in SOF */
 335 
 336   JQUANT_TBL * quant_tbl_ptrs[NUM_QUANT_TBLS];
 337   int q_scale_factor[NUM_QUANT_TBLS];
 338   /* ptrs to coefficient quantization tables, or NULL if not defined,
 339    * and corresponding scale factors (percentage, initialized 100).
 340    */
 341 
 342   JHUFF_TBL * dc_huff_tbl_ptrs[NUM_HUFF_TBLS];
 343   JHUFF_TBL * ac_huff_tbl_ptrs[NUM_HUFF_TBLS];
 344   /* ptrs to Huffman coding tables, or NULL if not defined */
 345 
 346   UINT8 arith_dc_L[NUM_ARITH_TBLS]; /* L values for DC arith-coding tables */
 347   UINT8 arith_dc_U[NUM_ARITH_TBLS]; /* U values for DC arith-coding tables */
 348   UINT8 arith_ac_K[NUM_ARITH_TBLS]; /* Kx values for AC arith-coding tables */
 349 
 350   int num_scans;        /* # of entries in scan_info array */
 351   const jpeg_scan_info * scan_info; /* script for multi-scan file, or NULL */
 352   /* The default value of scan_info is NULL, which causes a single-scan
 353    * sequential JPEG file to be emitted.  To create a multi-scan file,
 354    * set num_scans and scan_info to point to an array of scan definitions.
 355    */
 356 
 357   boolean raw_data_in;        /* TRUE=caller supplies downsampled data */
 358   boolean arith_code;        /* TRUE=arithmetic coding, FALSE=Huffman */
 359   boolean optimize_coding;    /* TRUE=optimize entropy encoding parms */
 360   boolean CCIR601_sampling;    /* TRUE=first samples are cosited */
 361   boolean do_fancy_downsampling; /* TRUE=apply fancy downsampling */
 362   int smoothing_factor;        /* 1..100, or 0 for no input smoothing */
 363   J_DCT_METHOD dct_method;    /* DCT algorithm selector */
 364 
 365   /* The restart interval can be specified in absolute MCUs by setting
 366    * restart_interval, or in MCU rows by setting restart_in_rows
 367    * (in which case the correct restart_interval will be figured
 368    * for each scan).
 369    */
 370   unsigned int restart_interval; /* MCUs per restart, or 0 for no restart */
 371   int restart_in_rows;        /* if &gt; 0, MCU rows per restart interval */
 372 
 373   /* Parameters controlling emission of special markers. */
 374 
 375   boolean write_JFIF_header;    /* should a JFIF marker be written? */
 376   UINT8 JFIF_major_version;    /* What to write for the JFIF version number */
 377   UINT8 JFIF_minor_version;
 378   /* These three values are not used by the JPEG code, merely copied */
 379   /* into the JFIF APP0 marker.  density_unit can be 0 for unknown, */
 380   /* 1 for dots/inch, or 2 for dots/cm.  Note that the pixel aspect */
 381   /* ratio is defined by X_density/Y_density even when density_unit=0. */
 382   UINT8 density_unit;        /* JFIF code for pixel size units */
 383   UINT16 X_density;        /* Horizontal pixel density */
 384   UINT16 Y_density;        /* Vertical pixel density */
 385   boolean write_Adobe_marker;    /* should an Adobe marker be written? */
 386 
 387   J_COLOR_TRANSFORM color_transform;
 388   /* Color transform identifier, writes LSE marker if nonzero */
 389 
 390   /* State variable: index of next scanline to be written to
 391    * jpeg_write_scanlines().  Application may use this to control its
 392    * processing loop, e.g., &quot;while (next_scanline &lt; image_height)&quot;.
 393    */
 394 
 395   JDIMENSION next_scanline;    /* 0 .. image_height-1  */
 396 
 397   /* Remaining fields are known throughout compressor, but generally
 398    * should not be touched by a surrounding application.
 399    */
 400 
 401   /*
 402    * These fields are computed during compression startup
 403    */
 404   boolean progressive_mode;    /* TRUE if scan script uses progressive mode */
 405   int max_h_samp_factor;    /* largest h_samp_factor */
 406   int max_v_samp_factor;    /* largest v_samp_factor */
 407 
 408   int min_DCT_h_scaled_size;    /* smallest DCT_h_scaled_size of any component */
 409   int min_DCT_v_scaled_size;    /* smallest DCT_v_scaled_size of any component */
 410 
 411   JDIMENSION total_iMCU_rows;    /* # of iMCU rows to be input to coef ctlr */
 412   /* The coefficient controller receives data in units of MCU rows as defined
 413    * for fully interleaved scans (whether the JPEG file is interleaved or not).
 414    * There are v_samp_factor * DCT_v_scaled_size sample rows of each component
 415    * in an &quot;iMCU&quot; (interleaved MCU) row.
 416    */
 417 
 418   /*
 419    * These fields are valid during any one scan.
 420    * They describe the components and MCUs actually appearing in the scan.
 421    */
 422   int comps_in_scan;        /* # of JPEG components in this scan */
 423   jpeg_component_info * cur_comp_info[MAX_COMPS_IN_SCAN];
 424   /* *cur_comp_info[i] describes component that appears i&#39;th in SOS */
 425 
 426   JDIMENSION MCUs_per_row;    /* # of MCUs across the image */
 427   JDIMENSION MCU_rows_in_scan;    /* # of MCU rows in the image */
 428 
 429   int blocks_in_MCU;        /* # of DCT blocks per MCU */
 430   int MCU_membership[C_MAX_BLOCKS_IN_MCU];
 431   /* MCU_membership[i] is index in cur_comp_info of component owning */
 432   /* i&#39;th block in an MCU */
 433 
 434   int Ss, Se, Ah, Al;        /* progressive JPEG parameters for scan */
 435 
 436   int block_size;        /* the basic DCT block size: 1..16 */
 437   const int * natural_order;    /* natural-order position array */
 438   int lim_Se;            /* min( Se, DCTSIZE2-1 ) */
 439 
 440   /*
 441    * Links to compression subobjects (methods and private variables of modules)
 442    */
 443   struct jpeg_comp_master * master;
 444   struct jpeg_c_main_controller * main;
 445   struct jpeg_c_prep_controller * prep;
 446   struct jpeg_c_coef_controller * coef;
 447   struct jpeg_marker_writer * marker;
 448   struct jpeg_color_converter * cconvert;
 449   struct jpeg_downsampler * downsample;
 450   struct jpeg_forward_dct * fdct;
 451   struct jpeg_entropy_encoder * entropy;
 452   jpeg_scan_info * script_space; /* workspace for jpeg_simple_progression */
 453   int script_space_size;
 454 };
 455 
 456 
 457 /* Master record for a decompression instance */
 458 
 459 struct jpeg_decompress_struct {
 460   jpeg_common_fields;        /* Fields shared with jpeg_compress_struct */
 461 
 462   /* Source of compressed data */
 463   struct jpeg_source_mgr * src;
 464 
 465   /* Basic description of image --- filled in by jpeg_read_header(). */
 466   /* Application may inspect these values to decide how to process image. */
 467 
 468   JDIMENSION image_width;    /* nominal image width (from SOF marker) */
 469   JDIMENSION image_height;    /* nominal image height */
 470   int num_components;        /* # of color components in JPEG image */
 471   J_COLOR_SPACE jpeg_color_space; /* colorspace of JPEG image */
 472 
 473   /* Decompression processing parameters --- these fields must be set before
 474    * calling jpeg_start_decompress().  Note that jpeg_read_header() initializes
 475    * them to default values.
 476    */
 477 
 478   J_COLOR_SPACE out_color_space; /* colorspace for output */
 479 
 480   unsigned int scale_num, scale_denom; /* fraction by which to scale image */
 481 
 482   double output_gamma;        /* image gamma wanted in output */
 483 
 484   boolean buffered_image;    /* TRUE=multiple output passes */
 485   boolean raw_data_out;        /* TRUE=downsampled data wanted */
 486 
 487   J_DCT_METHOD dct_method;    /* IDCT algorithm selector */
 488   boolean do_fancy_upsampling;    /* TRUE=apply fancy upsampling */
 489   boolean do_block_smoothing;    /* TRUE=apply interblock smoothing */
 490 
 491   boolean quantize_colors;    /* TRUE=colormapped output wanted */
 492   /* the following are ignored if not quantize_colors: */
 493   J_DITHER_MODE dither_mode;    /* type of color dithering to use */
 494   boolean two_pass_quantize;    /* TRUE=use two-pass color quantization */
 495   int desired_number_of_colors;    /* max # colors to use in created colormap */
 496   /* these are significant only in buffered-image mode: */
 497   boolean enable_1pass_quant;    /* enable future use of 1-pass quantizer */
 498   boolean enable_external_quant;/* enable future use of external colormap */
 499   boolean enable_2pass_quant;    /* enable future use of 2-pass quantizer */
 500 
 501   /* Description of actual output image that will be returned to application.
 502    * These fields are computed by jpeg_start_decompress().
 503    * You can also use jpeg_calc_output_dimensions() to determine these values
 504    * in advance of calling jpeg_start_decompress().
 505    */
 506 
 507   JDIMENSION output_width;    /* scaled image width */
 508   JDIMENSION output_height;    /* scaled image height */
 509   int out_color_components;    /* # of color components in out_color_space */
 510   int output_components;    /* # of color components returned */
 511   /* output_components is 1 (a colormap index) when quantizing colors;
 512    * otherwise it equals out_color_components.
 513    */
 514   int rec_outbuf_height;    /* min recommended height of scanline buffer */
 515   /* If the buffer passed to jpeg_read_scanlines() is less than this many rows
 516    * high, space and time will be wasted due to unnecessary data copying.
 517    * Usually rec_outbuf_height will be 1 or 2, at most 4.
 518    */
 519 
 520   /* When quantizing colors, the output colormap is described by these fields.
 521    * The application can supply a colormap by setting colormap non-NULL before
 522    * calling jpeg_start_decompress; otherwise a colormap is created during
 523    * jpeg_start_decompress or jpeg_start_output.
 524    * The map has out_color_components rows and actual_number_of_colors columns.
 525    */
 526   int actual_number_of_colors;    /* number of entries in use */
 527   JSAMPARRAY colormap;        /* The color map as a 2-D pixel array */
 528 
 529   /* State variables: these variables indicate the progress of decompression.
 530    * The application may examine these but must not modify them.
 531    */
 532 
 533   /* Row index of next scanline to be read from jpeg_read_scanlines().
 534    * Application may use this to control its processing loop, e.g.,
 535    * &quot;while (output_scanline &lt; output_height)&quot;.
 536    */
 537   JDIMENSION output_scanline;    /* 0 .. output_height-1  */
 538 
 539   /* Current input scan number and number of iMCU rows completed in scan.
 540    * These indicate the progress of the decompressor input side.
 541    */
 542   int input_scan_number;    /* Number of SOS markers seen so far */
 543   JDIMENSION input_iMCU_row;    /* Number of iMCU rows completed */
 544 
 545   /* The &quot;output scan number&quot; is the notional scan being displayed by the
 546    * output side.  The decompressor will not allow output scan/row number
 547    * to get ahead of input scan/row, but it can fall arbitrarily far behind.
 548    */
 549   int output_scan_number;    /* Nominal scan number being displayed */
 550   JDIMENSION output_iMCU_row;    /* Number of iMCU rows read */
 551 
 552   /* Current progression status.  coef_bits[c][i] indicates the precision
 553    * with which component c&#39;s DCT coefficient i (in zigzag order) is known.
 554    * It is -1 when no data has yet been received, otherwise it is the point
 555    * transform (shift) value for the most recent scan of the coefficient
 556    * (thus, 0 at completion of the progression).
 557    * This pointer is NULL when reading a non-progressive file.
 558    */
 559   int (*coef_bits)[DCTSIZE2];    /* -1 or current Al value for each coef */
 560 
 561   /* Internal JPEG parameters --- the application usually need not look at
 562    * these fields.  Note that the decompressor output side may not use
 563    * any parameters that can change between scans.
 564    */
 565 
 566   /* Quantization and Huffman tables are carried forward across input
 567    * datastreams when processing abbreviated JPEG datastreams.
 568    */
 569 
 570   JQUANT_TBL * quant_tbl_ptrs[NUM_QUANT_TBLS];
 571   /* ptrs to coefficient quantization tables, or NULL if not defined */
 572 
 573   JHUFF_TBL * dc_huff_tbl_ptrs[NUM_HUFF_TBLS];
 574   JHUFF_TBL * ac_huff_tbl_ptrs[NUM_HUFF_TBLS];
 575   /* ptrs to Huffman coding tables, or NULL if not defined */
 576 
 577   /* These parameters are never carried across datastreams, since they
 578    * are given in SOF/SOS markers or defined to be reset by SOI.
 579    */
 580 
 581   int data_precision;        /* bits of precision in image data */
 582 
 583   jpeg_component_info * comp_info;
 584   /* comp_info[i] describes component that appears i&#39;th in SOF */
 585 
 586   boolean is_baseline;        /* TRUE if Baseline SOF0 encountered */
 587   boolean progressive_mode;    /* TRUE if SOFn specifies progressive mode */
 588   boolean arith_code;        /* TRUE=arithmetic coding, FALSE=Huffman */
 589 
 590   UINT8 arith_dc_L[NUM_ARITH_TBLS]; /* L values for DC arith-coding tables */
 591   UINT8 arith_dc_U[NUM_ARITH_TBLS]; /* U values for DC arith-coding tables */
 592   UINT8 arith_ac_K[NUM_ARITH_TBLS]; /* Kx values for AC arith-coding tables */
 593 
 594   unsigned int restart_interval; /* MCUs per restart interval, or 0 for no restart */
 595 
 596   /* These fields record data obtained from optional markers recognized by
 597    * the JPEG library.
 598    */
 599   boolean saw_JFIF_marker;    /* TRUE iff a JFIF APP0 marker was found */
 600   /* Data copied from JFIF marker; only valid if saw_JFIF_marker is TRUE: */
 601   UINT8 JFIF_major_version;    /* JFIF version number */
 602   UINT8 JFIF_minor_version;
 603   UINT8 density_unit;        /* JFIF code for pixel size units */
 604   UINT16 X_density;        /* Horizontal pixel density */
 605   UINT16 Y_density;        /* Vertical pixel density */
 606   boolean saw_Adobe_marker;    /* TRUE iff an Adobe APP14 marker was found */
 607   UINT8 Adobe_transform;    /* Color transform code from Adobe marker */
 608 
 609   J_COLOR_TRANSFORM color_transform;
 610   /* Color transform identifier derived from LSE marker, otherwise zero */
 611 
 612   boolean CCIR601_sampling;    /* TRUE=first samples are cosited */
 613 
 614   /* Aside from the specific data retained from APPn markers known to the
 615    * library, the uninterpreted contents of any or all APPn and COM markers
 616    * can be saved in a list for examination by the application.
 617    */
 618   jpeg_saved_marker_ptr marker_list; /* Head of list of saved markers */
 619 
 620   /* Remaining fields are known throughout decompressor, but generally
 621    * should not be touched by a surrounding application.
 622    */
 623 
 624   /*
 625    * These fields are computed during decompression startup
 626    */
 627   int max_h_samp_factor;    /* largest h_samp_factor */
 628   int max_v_samp_factor;    /* largest v_samp_factor */
 629 
 630   int min_DCT_h_scaled_size;    /* smallest DCT_h_scaled_size of any component */
 631   int min_DCT_v_scaled_size;    /* smallest DCT_v_scaled_size of any component */
 632 
 633   JDIMENSION total_iMCU_rows;    /* # of iMCU rows in image */
 634   /* The coefficient controller&#39;s input and output progress is measured in
 635    * units of &quot;iMCU&quot; (interleaved MCU) rows.  These are the same as MCU rows
 636    * in fully interleaved JPEG scans, but are used whether the scan is
 637    * interleaved or not.  We define an iMCU row as v_samp_factor DCT block
 638    * rows of each component.  Therefore, the IDCT output contains
 639    * v_samp_factor * DCT_v_scaled_size sample rows of a component per iMCU row.
 640    */
 641 
 642   JSAMPLE * sample_range_limit; /* table for fast range-limiting */
 643 
 644   /*
 645    * These fields are valid during any one scan.
 646    * They describe the components and MCUs actually appearing in the scan.
 647    * Note that the decompressor output side must not use these fields.
 648    */
 649   int comps_in_scan;        /* # of JPEG components in this scan */
 650   jpeg_component_info * cur_comp_info[MAX_COMPS_IN_SCAN];
 651   /* *cur_comp_info[i] describes component that appears i&#39;th in SOS */
 652 
 653   JDIMENSION MCUs_per_row;    /* # of MCUs across the image */
 654   JDIMENSION MCU_rows_in_scan;    /* # of MCU rows in the image */
 655 
 656   int blocks_in_MCU;        /* # of DCT blocks per MCU */
 657   int MCU_membership[D_MAX_BLOCKS_IN_MCU];
 658   /* MCU_membership[i] is index in cur_comp_info of component owning */
 659   /* i&#39;th block in an MCU */
 660 
 661   int Ss, Se, Ah, Al;        /* progressive JPEG parameters for scan */
 662 
 663   /* These fields are derived from Se of first SOS marker.
 664    */
 665   int block_size;        /* the basic DCT block size: 1..16 */
 666   const int * natural_order; /* natural-order position array for entropy decode */
 667   int lim_Se;            /* min( Se, DCTSIZE2-1 ) for entropy decode */
 668 
 669   /* This field is shared between entropy decoder and marker parser.
 670    * It is either zero or the code of a JPEG marker that has been
 671    * read from the data source, but has not yet been processed.
 672    */
 673   int unread_marker;
 674 
 675   /*
 676    * Links to decompression subobjects (methods, private variables of modules)
 677    */
 678   struct jpeg_decomp_master * master;
 679   struct jpeg_d_main_controller * main;
 680   struct jpeg_d_coef_controller * coef;
 681   struct jpeg_d_post_controller * post;
 682   struct jpeg_input_controller * inputctl;
 683   struct jpeg_marker_reader * marker;
 684   struct jpeg_entropy_decoder * entropy;
 685   struct jpeg_inverse_dct * idct;
 686   struct jpeg_upsampler * upsample;
 687   struct jpeg_color_deconverter * cconvert;
 688   struct jpeg_color_quantizer * cquantize;
 689 };
 690 
 691 
 692 /* &quot;Object&quot; declarations for JPEG modules that may be supplied or called
 693  * directly by the surrounding application.
 694  * As with all objects in the JPEG library, these structs only define the
 695  * publicly visible methods and state variables of a module.  Additional
 696  * private fields may exist after the public ones.
 697  */
 698 
 699 
 700 /* Error handler object */
 701 
 702 struct jpeg_error_mgr {
 703   /* Error exit handler: does not return to caller */
 704   JMETHOD(noreturn_t, error_exit, (j_common_ptr cinfo));
 705   /* Conditionally emit a trace or warning message */
 706   JMETHOD(void, emit_message, (j_common_ptr cinfo, int msg_level));
 707   /* Routine that actually outputs a trace or error message */
 708   JMETHOD(void, output_message, (j_common_ptr cinfo));
 709   /* Format a message string for the most recent JPEG error or message */
 710   JMETHOD(void, format_message, (j_common_ptr cinfo, char * buffer));
 711 #define JMSG_LENGTH_MAX  200    /* recommended size of format_message buffer */
 712   /* Reset error state variables at start of a new image */
 713   JMETHOD(void, reset_error_mgr, (j_common_ptr cinfo));
 714 
 715   /* The message ID code and any parameters are saved here.
 716    * A message can have one string parameter or up to 8 int parameters.
 717    */
 718   int msg_code;
 719 #define JMSG_STR_PARM_MAX  80
 720   union {
 721     int i[8];
 722     char s[JMSG_STR_PARM_MAX];
 723   } msg_parm;
 724 
 725   /* Standard state variables for error facility */
 726 
 727   int trace_level;        /* max msg_level that will be displayed */
 728 
 729   /* For recoverable corrupt-data errors, we emit a warning message,
 730    * but keep going unless emit_message chooses to abort.  emit_message
 731    * should count warnings in num_warnings.  The surrounding application
 732    * can check for bad data by seeing if num_warnings is nonzero at the
 733    * end of processing.
 734    */
 735   long num_warnings;        /* number of corrupt-data warnings */
 736 
 737   /* These fields point to the table(s) of error message strings.
 738    * An application can change the table pointer to switch to a different
 739    * message list (typically, to change the language in which errors are
 740    * reported).  Some applications may wish to add additional error codes
 741    * that will be handled by the JPEG library error mechanism; the second
 742    * table pointer is used for this purpose.
 743    *
 744    * First table includes all errors generated by JPEG library itself.
 745    * Error code 0 is reserved for a &quot;no such error string&quot; message.
 746    */
 747   const char * const * jpeg_message_table; /* Library errors */
 748   int last_jpeg_message;    /* Table contains strings 0..last_jpeg_message */
 749   /* Second table can be added by application (see cjpeg/djpeg for example).
 750    * It contains strings numbered first_addon_message..last_addon_message.
 751    */
 752   const char * const * addon_message_table; /* Non-library errors */
 753   int first_addon_message;    /* code for first string in addon table */
 754   int last_addon_message;    /* code for last string in addon table */
 755 };
 756 
 757 
 758 /* Progress monitor object */
 759 
 760 struct jpeg_progress_mgr {
 761   JMETHOD(void, progress_monitor, (j_common_ptr cinfo));
 762 
 763   long pass_counter;        /* work units completed in this pass */
 764   long pass_limit;        /* total number of work units in this pass */
 765   int completed_passes;        /* passes completed so far */
 766   int total_passes;        /* total number of passes expected */
 767 };
 768 
 769 
 770 /* Data destination object for compression */
 771 
 772 struct jpeg_destination_mgr {
 773   JOCTET * next_output_byte;    /* =&gt; next byte to write in buffer */
 774   size_t free_in_buffer;    /* # of byte spaces remaining in buffer */
 775 
 776   JMETHOD(void, init_destination, (j_compress_ptr cinfo));
 777   JMETHOD(boolean, empty_output_buffer, (j_compress_ptr cinfo));
 778   JMETHOD(void, term_destination, (j_compress_ptr cinfo));
 779 };
 780 
 781 
 782 /* Data source object for decompression */
 783 
 784 struct jpeg_source_mgr {
 785   const JOCTET * next_input_byte; /* =&gt; next byte to read from buffer */
 786   size_t bytes_in_buffer;    /* # of bytes remaining in buffer */
 787 
 788   JMETHOD(void, init_source, (j_decompress_ptr cinfo));
 789   JMETHOD(boolean, fill_input_buffer, (j_decompress_ptr cinfo));
 790   JMETHOD(void, skip_input_data, (j_decompress_ptr cinfo, long num_bytes));
 791   JMETHOD(boolean, resync_to_restart, (j_decompress_ptr cinfo, int desired));
 792   JMETHOD(void, term_source, (j_decompress_ptr cinfo));
 793 };
 794 
 795 
 796 /* Memory manager object.
 797  * Allocates &quot;small&quot; objects (a few K total), &quot;large&quot; objects (tens of K),
 798  * and &quot;really big&quot; objects (virtual arrays with backing store if needed).
 799  * The memory manager does not allow individual objects to be freed; rather,
 800  * each created object is assigned to a pool, and whole pools can be freed
 801  * at once.  This is faster and more convenient than remembering exactly what
 802  * to free, especially where malloc()/free() are not too speedy.
 803  * NB: alloc routines never return NULL.  They exit to error_exit if not
 804  * successful.
 805  */
 806 
 807 #define JPOOL_PERMANENT    0    /* lasts until master record is destroyed */
 808 #define JPOOL_IMAGE    1    /* lasts until done with image/datastream */
 809 #define JPOOL_NUMPOOLS    2
 810 
 811 typedef struct jvirt_sarray_control * jvirt_sarray_ptr;
 812 typedef struct jvirt_barray_control * jvirt_barray_ptr;
 813 
 814 
 815 struct jpeg_memory_mgr {
 816   /* Method pointers */
 817   JMETHOD(void *, alloc_small, (j_common_ptr cinfo, int pool_id,
 818                 size_t sizeofobject));
 819   JMETHOD(void FAR *, alloc_large, (j_common_ptr cinfo, int pool_id,
 820                      size_t sizeofobject));
 821   JMETHOD(JSAMPARRAY, alloc_sarray, (j_common_ptr cinfo, int pool_id,
 822                      JDIMENSION samplesperrow,
 823                      JDIMENSION numrows));
 824   JMETHOD(JBLOCKARRAY, alloc_barray, (j_common_ptr cinfo, int pool_id,
 825                       JDIMENSION blocksperrow,
 826                       JDIMENSION numrows));
 827   JMETHOD(jvirt_sarray_ptr, request_virt_sarray, (j_common_ptr cinfo,
 828                           int pool_id,
 829                           boolean pre_zero,
 830                           JDIMENSION samplesperrow,
 831                           JDIMENSION numrows,
 832                           JDIMENSION maxaccess));
 833   JMETHOD(jvirt_barray_ptr, request_virt_barray, (j_common_ptr cinfo,
 834                           int pool_id,
 835                           boolean pre_zero,
 836                           JDIMENSION blocksperrow,
 837                           JDIMENSION numrows,
 838                           JDIMENSION maxaccess));
 839   JMETHOD(void, realize_virt_arrays, (j_common_ptr cinfo));
 840   JMETHOD(JSAMPARRAY, access_virt_sarray, (j_common_ptr cinfo,
 841                        jvirt_sarray_ptr ptr,
 842                        JDIMENSION start_row,
 843                        JDIMENSION num_rows,
 844                        boolean writable));
 845   JMETHOD(JBLOCKARRAY, access_virt_barray, (j_common_ptr cinfo,
 846                         jvirt_barray_ptr ptr,
 847                         JDIMENSION start_row,
 848                         JDIMENSION num_rows,
 849                         boolean writable));
 850   JMETHOD(void, free_pool, (j_common_ptr cinfo, int pool_id));
 851   JMETHOD(void, self_destruct, (j_common_ptr cinfo));
 852 
 853   /* Limit on memory allocation for this JPEG object.  (Note that this is
 854    * merely advisory, not a guaranteed maximum; it only affects the space
 855    * used for virtual-array buffers.)  May be changed by outer application
 856    * after creating the JPEG object.
 857    */
 858   long max_memory_to_use;
 859 
 860   /* Maximum allocation request accepted by alloc_large. */
 861   long max_alloc_chunk;
 862 };
 863 
 864 
 865 /* Routine signature for application-supplied marker processing methods.
 866  * Need not pass marker code since it is stored in cinfo-&gt;unread_marker.
 867  */
 868 typedef JMETHOD(boolean, jpeg_marker_parser_method, (j_decompress_ptr cinfo));
 869 
 870 
 871 /* Declarations for routines called by application.
 872  * The JPP macro hides prototype parameters from compilers that can&#39;t cope.
 873  * Note JPP requires double parentheses.
 874  */
 875 
 876 #ifdef HAVE_PROTOTYPES
 877 #define JPP(arglist)    arglist
 878 #else
 879 #define JPP(arglist)    ()
 880 #endif
 881 
 882 
 883 /* Short forms of external names for systems with brain-damaged linkers.
 884  * We shorten external names to be unique in the first six letters, which
 885  * is good enough for all known systems.
 886  * (If your compiler itself needs names to be unique in less than 15
 887  * characters, you are out of luck.  Get a better compiler.)
 888  */
 889 
 890 #ifdef NEED_SHORT_EXTERNAL_NAMES
 891 #define jpeg_std_error        jStdError
 892 #define jpeg_CreateCompress    jCreaCompress
 893 #define jpeg_CreateDecompress    jCreaDecompress
 894 #define jpeg_destroy_compress    jDestCompress
 895 #define jpeg_destroy_decompress    jDestDecompress
 896 #define jpeg_stdio_dest        jStdDest
 897 #define jpeg_stdio_src        jStdSrc
 898 #define jpeg_mem_dest        jMemDest
 899 #define jpeg_mem_src        jMemSrc
 900 #define jpeg_set_defaults    jSetDefaults
 901 #define jpeg_set_colorspace    jSetColorspace
 902 #define jpeg_default_colorspace    jDefColorspace
 903 #define jpeg_set_quality    jSetQuality
 904 #define jpeg_set_linear_quality    jSetLQuality
 905 #define jpeg_default_qtables    jDefQTables
 906 #define jpeg_add_quant_table    jAddQuantTable
 907 #define jpeg_quality_scaling    jQualityScaling
 908 #define jpeg_simple_progression    jSimProgress
 909 #define jpeg_suppress_tables    jSuppressTables
 910 #define jpeg_alloc_quant_table    jAlcQTable
 911 #define jpeg_alloc_huff_table    jAlcHTable
<a name="3" id="anc3"></a><span class="line-added"> 912 #define jpeg_std_huff_table    jStdHTable</span>
 913 #define jpeg_start_compress    jStrtCompress
 914 #define jpeg_write_scanlines    jWrtScanlines
 915 #define jpeg_finish_compress    jFinCompress
 916 #define jpeg_calc_jpeg_dimensions    jCjpegDimensions
 917 #define jpeg_write_raw_data    jWrtRawData
 918 #define jpeg_write_marker    jWrtMarker
 919 #define jpeg_write_m_header    jWrtMHeader
 920 #define jpeg_write_m_byte    jWrtMByte
 921 #define jpeg_write_tables    jWrtTables
 922 #define jpeg_read_header    jReadHeader
 923 #define jpeg_start_decompress    jStrtDecompress
 924 #define jpeg_read_scanlines    jReadScanlines
 925 #define jpeg_finish_decompress    jFinDecompress
 926 #define jpeg_read_raw_data    jReadRawData
 927 #define jpeg_has_multiple_scans    jHasMultScn
 928 #define jpeg_start_output    jStrtOutput
 929 #define jpeg_finish_output    jFinOutput
 930 #define jpeg_input_complete    jInComplete
 931 #define jpeg_new_colormap    jNewCMap
 932 #define jpeg_consume_input    jConsumeInput
 933 #define jpeg_core_output_dimensions    jCoreDimensions
 934 #define jpeg_calc_output_dimensions    jCalcDimensions
 935 #define jpeg_save_markers    jSaveMarkers
 936 #define jpeg_set_marker_processor    jSetMarker
 937 #define jpeg_read_coefficients    jReadCoefs
 938 #define jpeg_write_coefficients    jWrtCoefs
 939 #define jpeg_copy_critical_parameters    jCopyCrit
 940 #define jpeg_abort_compress    jAbrtCompress
 941 #define jpeg_abort_decompress    jAbrtDecompress
 942 #define jpeg_abort        jAbort
 943 #define jpeg_destroy        jDestroy
 944 #define jpeg_resync_to_restart    jResyncRestart
 945 #endif /* NEED_SHORT_EXTERNAL_NAMES */
 946 
 947 
 948 /* Default error-management setup */
 949 EXTERN(struct jpeg_error_mgr *) jpeg_std_error
 950     JPP((struct jpeg_error_mgr * err));
 951 
 952 /* Initialization of JPEG compression objects.
 953  * jpeg_create_compress() and jpeg_create_decompress() are the exported
 954  * names that applications should call.  These expand to calls on
 955  * jpeg_CreateCompress and jpeg_CreateDecompress with additional information
 956  * passed for version mismatch checking.
 957  * NB: you must set up the error-manager BEFORE calling jpeg_create_xxx.
 958  */
 959 #define jpeg_create_compress(cinfo) \
 960     jpeg_CreateCompress((cinfo), JPEG_LIB_VERSION, \
 961             (size_t) sizeof(struct jpeg_compress_struct))
 962 #define jpeg_create_decompress(cinfo) \
 963     jpeg_CreateDecompress((cinfo), JPEG_LIB_VERSION, \
 964               (size_t) sizeof(struct jpeg_decompress_struct))
 965 EXTERN(void) jpeg_CreateCompress JPP((j_compress_ptr cinfo,
 966                       int version, size_t structsize));
 967 EXTERN(void) jpeg_CreateDecompress JPP((j_decompress_ptr cinfo,
 968                     int version, size_t structsize));
 969 /* Destruction of JPEG compression objects */
 970 EXTERN(void) jpeg_destroy_compress JPP((j_compress_ptr cinfo));
 971 EXTERN(void) jpeg_destroy_decompress JPP((j_decompress_ptr cinfo));
 972 
 973 /* Standard data source and destination managers: stdio streams. */
 974 /* Caller is responsible for opening the file before and closing after. */
 975 EXTERN(void) jpeg_stdio_dest JPP((j_compress_ptr cinfo, FILE * outfile));
 976 EXTERN(void) jpeg_stdio_src JPP((j_decompress_ptr cinfo, FILE * infile));
 977 
 978 /* Data source and destination managers: memory buffers. */
 979 EXTERN(void) jpeg_mem_dest JPP((j_compress_ptr cinfo,
 980                    unsigned char ** outbuffer,
<a name="4" id="anc4"></a><span class="line-modified"> 981                    size_t * outsize));</span>
 982 EXTERN(void) jpeg_mem_src JPP((j_decompress_ptr cinfo,
 983                   const unsigned char * inbuffer,
<a name="5" id="anc5"></a><span class="line-modified"> 984                   size_t insize));</span>
 985 
 986 /* Default parameter setup for compression */
 987 EXTERN(void) jpeg_set_defaults JPP((j_compress_ptr cinfo));
 988 /* Compression parameter setup aids */
 989 EXTERN(void) jpeg_set_colorspace JPP((j_compress_ptr cinfo,
 990                       J_COLOR_SPACE colorspace));
 991 EXTERN(void) jpeg_default_colorspace JPP((j_compress_ptr cinfo));
 992 EXTERN(void) jpeg_set_quality JPP((j_compress_ptr cinfo, int quality,
 993                    boolean force_baseline));
 994 EXTERN(void) jpeg_set_linear_quality JPP((j_compress_ptr cinfo,
 995                       int scale_factor,
 996                       boolean force_baseline));
 997 EXTERN(void) jpeg_default_qtables JPP((j_compress_ptr cinfo,
 998                        boolean force_baseline));
 999 EXTERN(void) jpeg_add_quant_table JPP((j_compress_ptr cinfo, int which_tbl,
1000                        const unsigned int *basic_table,
1001                        int scale_factor,
1002                        boolean force_baseline));
1003 EXTERN(int) jpeg_quality_scaling JPP((int quality));
1004 EXTERN(void) jpeg_simple_progression JPP((j_compress_ptr cinfo));
1005 EXTERN(void) jpeg_suppress_tables JPP((j_compress_ptr cinfo,
1006                        boolean suppress));
1007 EXTERN(JQUANT_TBL *) jpeg_alloc_quant_table JPP((j_common_ptr cinfo));
1008 EXTERN(JHUFF_TBL *) jpeg_alloc_huff_table JPP((j_common_ptr cinfo));
<a name="6" id="anc6"></a><span class="line-added">1009 EXTERN(JHUFF_TBL *) jpeg_std_huff_table JPP((j_common_ptr cinfo,</span>
<span class="line-added">1010                          boolean isDC, int tblno));</span>
1011 
1012 /* Main entry points for compression */
1013 EXTERN(void) jpeg_start_compress JPP((j_compress_ptr cinfo,
1014                       boolean write_all_tables));
1015 EXTERN(JDIMENSION) jpeg_write_scanlines JPP((j_compress_ptr cinfo,
1016                          JSAMPARRAY scanlines,
1017                          JDIMENSION num_lines));
1018 EXTERN(void) jpeg_finish_compress JPP((j_compress_ptr cinfo));
1019 
1020 /* Precalculate JPEG dimensions for current compression parameters. */
1021 EXTERN(void) jpeg_calc_jpeg_dimensions JPP((j_compress_ptr cinfo));
1022 
1023 /* Replaces jpeg_write_scanlines when writing raw downsampled data. */
1024 EXTERN(JDIMENSION) jpeg_write_raw_data JPP((j_compress_ptr cinfo,
1025                         JSAMPIMAGE data,
1026                         JDIMENSION num_lines));
1027 
1028 /* Write a special marker.  See libjpeg.txt concerning safe usage. */
1029 EXTERN(void) jpeg_write_marker
1030     JPP((j_compress_ptr cinfo, int marker,
1031          const JOCTET * dataptr, unsigned int datalen));
1032 /* Same, but piecemeal. */
1033 EXTERN(void) jpeg_write_m_header
1034     JPP((j_compress_ptr cinfo, int marker, unsigned int datalen));
1035 EXTERN(void) jpeg_write_m_byte
1036     JPP((j_compress_ptr cinfo, int val));
1037 
1038 /* Alternate compression function: just write an abbreviated table file */
1039 EXTERN(void) jpeg_write_tables JPP((j_compress_ptr cinfo));
1040 
1041 /* Decompression startup: read start of JPEG datastream to see what&#39;s there */
1042 EXTERN(int) jpeg_read_header JPP((j_decompress_ptr cinfo,
1043                   boolean require_image));
1044 /* Return value is one of: */
1045 #define JPEG_SUSPENDED        0 /* Suspended due to lack of input data */
1046 #define JPEG_HEADER_OK        1 /* Found valid image datastream */
1047 #define JPEG_HEADER_TABLES_ONLY    2 /* Found valid table-specs-only datastream */
1048 /* If you pass require_image = TRUE (normal case), you need not check for
1049  * a TABLES_ONLY return code; an abbreviated file will cause an error exit.
1050  * JPEG_SUSPENDED is only possible if you use a data source module that can
1051  * give a suspension return (the stdio source module doesn&#39;t).
1052  */
1053 
1054 /* Main entry points for decompression */
1055 EXTERN(boolean) jpeg_start_decompress JPP((j_decompress_ptr cinfo));
1056 EXTERN(JDIMENSION) jpeg_read_scanlines JPP((j_decompress_ptr cinfo,
1057                         JSAMPARRAY scanlines,
1058                         JDIMENSION max_lines));
1059 EXTERN(boolean) jpeg_finish_decompress JPP((j_decompress_ptr cinfo));
1060 
1061 /* Replaces jpeg_read_scanlines when reading raw downsampled data. */
1062 EXTERN(JDIMENSION) jpeg_read_raw_data JPP((j_decompress_ptr cinfo,
1063                        JSAMPIMAGE data,
1064                        JDIMENSION max_lines));
1065 
1066 /* Additional entry points for buffered-image mode. */
1067 EXTERN(boolean) jpeg_has_multiple_scans JPP((j_decompress_ptr cinfo));
1068 EXTERN(boolean) jpeg_start_output JPP((j_decompress_ptr cinfo,
1069                        int scan_number));
1070 EXTERN(boolean) jpeg_finish_output JPP((j_decompress_ptr cinfo));
1071 EXTERN(boolean) jpeg_input_complete JPP((j_decompress_ptr cinfo));
1072 EXTERN(void) jpeg_new_colormap JPP((j_decompress_ptr cinfo));
1073 EXTERN(int) jpeg_consume_input JPP((j_decompress_ptr cinfo));
1074 /* Return value is one of: */
1075 /* #define JPEG_SUSPENDED    0    Suspended due to lack of input data */
1076 #define JPEG_REACHED_SOS    1 /* Reached start of new scan */
1077 #define JPEG_REACHED_EOI    2 /* Reached end of image */
1078 #define JPEG_ROW_COMPLETED    3 /* Completed one iMCU row */
1079 #define JPEG_SCAN_COMPLETED    4 /* Completed last iMCU row of a scan */
1080 
1081 /* Precalculate output dimensions for current decompression parameters. */
1082 EXTERN(void) jpeg_core_output_dimensions JPP((j_decompress_ptr cinfo));
1083 EXTERN(void) jpeg_calc_output_dimensions JPP((j_decompress_ptr cinfo));
1084 
1085 /* Control saving of COM and APPn markers into marker_list. */
1086 EXTERN(void) jpeg_save_markers
1087     JPP((j_decompress_ptr cinfo, int marker_code,
1088          unsigned int length_limit));
1089 
1090 /* Install a special processing method for COM or APPn markers. */
1091 EXTERN(void) jpeg_set_marker_processor
1092     JPP((j_decompress_ptr cinfo, int marker_code,
1093          jpeg_marker_parser_method routine));
1094 
1095 /* Read or write raw DCT coefficients --- useful for lossless transcoding. */
1096 EXTERN(jvirt_barray_ptr *) jpeg_read_coefficients JPP((j_decompress_ptr cinfo));
1097 EXTERN(void) jpeg_write_coefficients JPP((j_compress_ptr cinfo,
1098                       jvirt_barray_ptr * coef_arrays));
1099 EXTERN(void) jpeg_copy_critical_parameters JPP((j_decompress_ptr srcinfo,
1100                         j_compress_ptr dstinfo));
1101 
1102 /* If you choose to abort compression or decompression before completing
1103  * jpeg_finish_(de)compress, then you need to clean up to release memory,
1104  * temporary files, etc.  You can just call jpeg_destroy_(de)compress
1105  * if you&#39;re done with the JPEG object, but if you want to clean it up and
1106  * reuse it, call this:
1107  */
1108 EXTERN(void) jpeg_abort_compress JPP((j_compress_ptr cinfo));
1109 EXTERN(void) jpeg_abort_decompress JPP((j_decompress_ptr cinfo));
1110 
1111 /* Generic versions of jpeg_abort and jpeg_destroy that work on either
1112  * flavor of JPEG object.  These may be more convenient in some places.
1113  */
1114 EXTERN(void) jpeg_abort JPP((j_common_ptr cinfo));
1115 EXTERN(void) jpeg_destroy JPP((j_common_ptr cinfo));
1116 
1117 /* Default restart-marker-resync procedure for use by data source modules */
1118 EXTERN(boolean) jpeg_resync_to_restart JPP((j_decompress_ptr cinfo,
1119                         int desired));
1120 
1121 
1122 /* These marker codes are exported since applications and data source modules
1123  * are likely to want to use them.
1124  */
1125 
1126 #define JPEG_RST0    0xD0    /* RST0 marker code */
1127 #define JPEG_EOI    0xD9    /* EOI marker code */
1128 #define JPEG_APP0    0xE0    /* APP0 marker code */
1129 #define JPEG_COM    0xFE    /* COM marker code */
1130 
1131 
1132 /* If we have a brain-damaged compiler that emits warnings (or worse, errors)
1133  * for structure definitions that are never filled in, keep it quiet by
1134  * supplying dummy definitions for the various substructures.
1135  */
1136 
1137 #ifdef INCOMPLETE_TYPES_BROKEN
1138 #ifndef JPEG_INTERNALS        /* will be defined in jpegint.h */
1139 struct jvirt_sarray_control { long dummy; };
1140 struct jvirt_barray_control { long dummy; };
1141 struct jpeg_comp_master { long dummy; };
1142 struct jpeg_c_main_controller { long dummy; };
1143 struct jpeg_c_prep_controller { long dummy; };
1144 struct jpeg_c_coef_controller { long dummy; };
1145 struct jpeg_marker_writer { long dummy; };
1146 struct jpeg_color_converter { long dummy; };
1147 struct jpeg_downsampler { long dummy; };
1148 struct jpeg_forward_dct { long dummy; };
1149 struct jpeg_entropy_encoder { long dummy; };
1150 struct jpeg_decomp_master { long dummy; };
1151 struct jpeg_d_main_controller { long dummy; };
1152 struct jpeg_d_coef_controller { long dummy; };
1153 struct jpeg_d_post_controller { long dummy; };
1154 struct jpeg_input_controller { long dummy; };
1155 struct jpeg_marker_reader { long dummy; };
1156 struct jpeg_entropy_decoder { long dummy; };
1157 struct jpeg_inverse_dct { long dummy; };
1158 struct jpeg_upsampler { long dummy; };
1159 struct jpeg_color_deconverter { long dummy; };
1160 struct jpeg_color_quantizer { long dummy; };
1161 #endif /* JPEG_INTERNALS */
1162 #endif /* INCOMPLETE_TYPES_BROKEN */
1163 
1164 
1165 /*
1166  * The JPEG library modules define JPEG_INTERNALS before including this file.
1167  * The internal structure declarations are read only when that is true.
1168  * Applications using the library should not include jpegint.h, but may wish
1169  * to include jerror.h.
1170  */
1171 
1172 #ifdef JPEG_INTERNALS
1173 #include &quot;jpegint.h&quot;        /* fetch private declarations */
1174 #include &quot;jerror.h&quot;        /* fetch error codes too */
1175 #endif
1176 
1177 #ifdef __cplusplus
1178 #ifndef DONT_USE_EXTERN_C
1179 }
1180 #endif
1181 #endif
1182 
1183 #endif /* JPEGLIB_H */
<a name="7" id="anc7"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="7" type="hidden" />
</body>
</html>