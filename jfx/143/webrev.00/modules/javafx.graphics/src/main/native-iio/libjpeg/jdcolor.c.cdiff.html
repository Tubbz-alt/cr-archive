<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.graphics/src/main/native-iio/libjpeg/jdcolor.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="jcparam.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="jdct.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/native-iio/libjpeg/jdcolor.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,10 ***</span>
  /*
   * jdcolor.c
   *
   * Copyright (C) 1991-1997, Thomas G. Lane.
<span class="line-modified">!  * Modified 2011-2017 by Guido Vollbeding.</span>
   * This file is part of the Independent JPEG Group&#39;s software.
   * For conditions of distribution and use, see the accompanying README file.
   *
   * This file contains output colorspace conversion routines.
   */
<span class="line-new-header">--- 1,10 ---</span>
  /*
   * jdcolor.c
   *
   * Copyright (C) 1991-1997, Thomas G. Lane.
<span class="line-modified">!  * Modified 2011-2019 by Guido Vollbeding.</span>
   * This file is part of the Independent JPEG Group&#39;s software.
   * For conditions of distribution and use, see the accompanying README file.
   *
   * This file contains output colorspace conversion routines.
   */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 122,32 ***</span>
    my_cconvert_ptr cconvert = (my_cconvert_ptr) cinfo-&gt;cconvert;
    int i;
    INT32 x;
    SHIFT_TEMPS
  
<span class="line-modified">!   cconvert-&gt;Cr_r_tab = (int *)</span>
<span class="line-modified">!     (*cinfo-&gt;mem-&gt;alloc_small) ((j_common_ptr) cinfo, JPOOL_IMAGE,</span>
<span class="line-modified">!                 (MAXJSAMPLE+1) * SIZEOF(int));</span>
<span class="line-modified">!   cconvert-&gt;Cb_b_tab = (int *)</span>
<span class="line-modified">!     (*cinfo-&gt;mem-&gt;alloc_small) ((j_common_ptr) cinfo, JPOOL_IMAGE,</span>
<span class="line-modified">!                 (MAXJSAMPLE+1) * SIZEOF(int));</span>
<span class="line-modified">!   cconvert-&gt;Cr_g_tab = (INT32 *)</span>
<span class="line-modified">!     (*cinfo-&gt;mem-&gt;alloc_small) ((j_common_ptr) cinfo, JPOOL_IMAGE,</span>
<span class="line-removed">-                 (MAXJSAMPLE+1) * SIZEOF(INT32));</span>
<span class="line-removed">-   cconvert-&gt;Cb_g_tab = (INT32 *)</span>
<span class="line-removed">-     (*cinfo-&gt;mem-&gt;alloc_small) ((j_common_ptr) cinfo, JPOOL_IMAGE,</span>
<span class="line-removed">-                 (MAXJSAMPLE+1) * SIZEOF(INT32));</span>
  
    for (i = 0, x = -CENTERJSAMPLE; i &lt;= MAXJSAMPLE; i++, x++) {
      /* i is the actual input pixel value, in the range 0..MAXJSAMPLE */
      /* The Cb or Cr value we are thinking of is x = i - CENTERJSAMPLE */
      /* Cr=&gt;R value is nearest int to 1.402 * x */
<span class="line-modified">!     cconvert-&gt;Cr_r_tab[i] = (int)</span>
<span class="line-removed">-             RIGHT_SHIFT(FIX(1.402) * x + ONE_HALF, SCALEBITS);</span>
      /* Cb=&gt;B value is nearest int to 1.772 * x */
<span class="line-modified">!     cconvert-&gt;Cb_b_tab[i] = (int)</span>
<span class="line-removed">-             RIGHT_SHIFT(FIX(1.772) * x + ONE_HALF, SCALEBITS);</span>
      /* Cr=&gt;G value is scaled-up -0.714136286 * x */
      cconvert-&gt;Cr_g_tab[i] = (- FIX(0.714136286)) * x;
      /* Cb=&gt;G value is scaled-up -0.344136286 * x */
      /* We also add in ONE_HALF so that need not do it in inner loop */
      cconvert-&gt;Cb_g_tab[i] = (- FIX(0.344136286)) * x + ONE_HALF;
<span class="line-new-header">--- 122,26 ---</span>
    my_cconvert_ptr cconvert = (my_cconvert_ptr) cinfo-&gt;cconvert;
    int i;
    INT32 x;
    SHIFT_TEMPS
  
<span class="line-modified">!   cconvert-&gt;Cr_r_tab = (int *) (*cinfo-&gt;mem-&gt;alloc_small)</span>
<span class="line-modified">!     ((j_common_ptr) cinfo, JPOOL_IMAGE, (MAXJSAMPLE+1) * SIZEOF(int));</span>
<span class="line-modified">!   cconvert-&gt;Cb_b_tab = (int *) (*cinfo-&gt;mem-&gt;alloc_small)</span>
<span class="line-modified">!     ((j_common_ptr) cinfo, JPOOL_IMAGE, (MAXJSAMPLE+1) * SIZEOF(int));</span>
<span class="line-modified">!   cconvert-&gt;Cr_g_tab = (INT32 *) (*cinfo-&gt;mem-&gt;alloc_small)</span>
<span class="line-modified">!     ((j_common_ptr) cinfo, JPOOL_IMAGE, (MAXJSAMPLE+1) * SIZEOF(INT32));</span>
<span class="line-modified">!   cconvert-&gt;Cb_g_tab = (INT32 *) (*cinfo-&gt;mem-&gt;alloc_small)</span>
<span class="line-modified">!     ((j_common_ptr) cinfo, JPOOL_IMAGE, (MAXJSAMPLE+1) * SIZEOF(INT32));</span>
  
    for (i = 0, x = -CENTERJSAMPLE; i &lt;= MAXJSAMPLE; i++, x++) {
      /* i is the actual input pixel value, in the range 0..MAXJSAMPLE */
      /* The Cb or Cr value we are thinking of is x = i - CENTERJSAMPLE */
      /* Cr=&gt;R value is nearest int to 1.402 * x */
<span class="line-modified">!     cconvert-&gt;Cr_r_tab[i] = (int) DESCALE(FIX(1.402) * x, SCALEBITS);</span>
      /* Cb=&gt;B value is nearest int to 1.772 * x */
<span class="line-modified">!     cconvert-&gt;Cb_b_tab[i] = (int) DESCALE(FIX(1.772) * x, SCALEBITS);</span>
      /* Cr=&gt;G value is scaled-up -0.714136286 * x */
      cconvert-&gt;Cr_g_tab[i] = (- FIX(0.714136286)) * x;
      /* Cb=&gt;G value is scaled-up -0.344136286 * x */
      /* We also add in ONE_HALF so that need not do it in inner loop */
      cconvert-&gt;Cb_g_tab[i] = (- FIX(0.344136286)) * x + ONE_HALF;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 162,32 ***</span>
    my_cconvert_ptr cconvert = (my_cconvert_ptr) cinfo-&gt;cconvert;
    int i;
    INT32 x;
    SHIFT_TEMPS
  
<span class="line-modified">!   cconvert-&gt;Cr_r_tab = (int *)</span>
<span class="line-modified">!     (*cinfo-&gt;mem-&gt;alloc_small) ((j_common_ptr) cinfo, JPOOL_IMAGE,</span>
<span class="line-modified">!                 (MAXJSAMPLE+1) * SIZEOF(int));</span>
<span class="line-modified">!   cconvert-&gt;Cb_b_tab = (int *)</span>
<span class="line-modified">!     (*cinfo-&gt;mem-&gt;alloc_small) ((j_common_ptr) cinfo, JPOOL_IMAGE,</span>
<span class="line-modified">!                 (MAXJSAMPLE+1) * SIZEOF(int));</span>
<span class="line-modified">!   cconvert-&gt;Cr_g_tab = (INT32 *)</span>
<span class="line-modified">!     (*cinfo-&gt;mem-&gt;alloc_small) ((j_common_ptr) cinfo, JPOOL_IMAGE,</span>
<span class="line-removed">-                 (MAXJSAMPLE+1) * SIZEOF(INT32));</span>
<span class="line-removed">-   cconvert-&gt;Cb_g_tab = (INT32 *)</span>
<span class="line-removed">-     (*cinfo-&gt;mem-&gt;alloc_small) ((j_common_ptr) cinfo, JPOOL_IMAGE,</span>
<span class="line-removed">-                 (MAXJSAMPLE+1) * SIZEOF(INT32));</span>
  
    for (i = 0, x = -CENTERJSAMPLE; i &lt;= MAXJSAMPLE; i++, x++) {
      /* i is the actual input pixel value, in the range 0..MAXJSAMPLE */
      /* The Cb or Cr value we are thinking of is x = i - CENTERJSAMPLE */
      /* Cr=&gt;R value is nearest int to 2.804 * x */
<span class="line-modified">!     cconvert-&gt;Cr_r_tab[i] = (int)</span>
<span class="line-removed">-             RIGHT_SHIFT(FIX(2.804) * x + ONE_HALF, SCALEBITS);</span>
      /* Cb=&gt;B value is nearest int to 3.544 * x */
<span class="line-modified">!     cconvert-&gt;Cb_b_tab[i] = (int)</span>
<span class="line-removed">-             RIGHT_SHIFT(FIX(3.544) * x + ONE_HALF, SCALEBITS);</span>
      /* Cr=&gt;G value is scaled-up -1.428272572 * x */
      cconvert-&gt;Cr_g_tab[i] = (- FIX(1.428272572)) * x;
      /* Cb=&gt;G value is scaled-up -0.688272572 * x */
      /* We also add in ONE_HALF so that need not do it in inner loop */
      cconvert-&gt;Cb_g_tab[i] = (- FIX(0.688272572)) * x + ONE_HALF;
<span class="line-new-header">--- 156,26 ---</span>
    my_cconvert_ptr cconvert = (my_cconvert_ptr) cinfo-&gt;cconvert;
    int i;
    INT32 x;
    SHIFT_TEMPS
  
<span class="line-modified">!   cconvert-&gt;Cr_r_tab = (int *) (*cinfo-&gt;mem-&gt;alloc_small)</span>
<span class="line-modified">!     ((j_common_ptr) cinfo, JPOOL_IMAGE, (MAXJSAMPLE+1) * SIZEOF(int));</span>
<span class="line-modified">!   cconvert-&gt;Cb_b_tab = (int *) (*cinfo-&gt;mem-&gt;alloc_small)</span>
<span class="line-modified">!     ((j_common_ptr) cinfo, JPOOL_IMAGE, (MAXJSAMPLE+1) * SIZEOF(int));</span>
<span class="line-modified">!   cconvert-&gt;Cr_g_tab = (INT32 *) (*cinfo-&gt;mem-&gt;alloc_small)</span>
<span class="line-modified">!     ((j_common_ptr) cinfo, JPOOL_IMAGE, (MAXJSAMPLE+1) * SIZEOF(INT32));</span>
<span class="line-modified">!   cconvert-&gt;Cb_g_tab = (INT32 *) (*cinfo-&gt;mem-&gt;alloc_small)</span>
<span class="line-modified">!     ((j_common_ptr) cinfo, JPOOL_IMAGE, (MAXJSAMPLE+1) * SIZEOF(INT32));</span>
  
    for (i = 0, x = -CENTERJSAMPLE; i &lt;= MAXJSAMPLE; i++, x++) {
      /* i is the actual input pixel value, in the range 0..MAXJSAMPLE */
      /* The Cb or Cr value we are thinking of is x = i - CENTERJSAMPLE */
      /* Cr=&gt;R value is nearest int to 2.804 * x */
<span class="line-modified">!     cconvert-&gt;Cr_r_tab[i] = (int) DESCALE(FIX(2.804) * x, SCALEBITS);</span>
      /* Cb=&gt;B value is nearest int to 3.544 * x */
<span class="line-modified">!     cconvert-&gt;Cb_b_tab[i] = (int) DESCALE(FIX(3.544) * x, SCALEBITS);</span>
      /* Cr=&gt;G value is scaled-up -1.428272572 * x */
      cconvert-&gt;Cr_g_tab[i] = (- FIX(1.428272572)) * x;
      /* Cb=&gt;G value is scaled-up -0.688272572 * x */
      /* We also add in ONE_HALF so that need not do it in inner loop */
      cconvert-&gt;Cb_g_tab[i] = (- FIX(0.688272572)) * x + ONE_HALF;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 199,10 ***</span>
<span class="line-new-header">--- 187,11 ---</span>
   * Convert some rows of samples to the output colorspace.
   *
   * Note that we change from noninterleaved, one-plane-per-component format
   * to interleaved-pixel format.  The output buffer is therefore three times
   * as wide as the input buffer.
<span class="line-added">+  *</span>
   * A starting row offset is provided only for the input buffer.  The caller
   * can easily adjust the passed output_buf value to accommodate any row
   * offset required on that side.
   */
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 262,13 ***</span>
    my_cconvert_ptr cconvert = (my_cconvert_ptr) cinfo-&gt;cconvert;
    INT32 * rgb_y_tab;
    INT32 i;
  
    /* Allocate and fill in the conversion tables. */
<span class="line-modified">!   cconvert-&gt;rgb_y_tab = rgb_y_tab = (INT32 *)</span>
<span class="line-modified">!     (*cinfo-&gt;mem-&gt;alloc_small) ((j_common_ptr) cinfo, JPOOL_IMAGE,</span>
<span class="line-removed">-                 (TABLE_SIZE * SIZEOF(INT32)));</span>
  
    for (i = 0; i &lt;= MAXJSAMPLE; i++) {
      rgb_y_tab[i+R_Y_OFF] = FIX(0.299) * i;
      rgb_y_tab[i+G_Y_OFF] = FIX(0.587) * i;
      rgb_y_tab[i+B_Y_OFF] = FIX(0.114) * i + ONE_HALF;
<span class="line-new-header">--- 251,12 ---</span>
    my_cconvert_ptr cconvert = (my_cconvert_ptr) cinfo-&gt;cconvert;
    INT32 * rgb_y_tab;
    INT32 i;
  
    /* Allocate and fill in the conversion tables. */
<span class="line-modified">!   cconvert-&gt;rgb_y_tab = rgb_y_tab = (INT32 *) (*cinfo-&gt;mem-&gt;alloc_small)</span>
<span class="line-modified">!     ((j_common_ptr) cinfo, JPOOL_IMAGE, TABLE_SIZE * SIZEOF(INT32));</span>
  
    for (i = 0; i &lt;= MAXJSAMPLE; i++) {
      rgb_y_tab[i+R_Y_OFF] = FIX(0.299) * i;
      rgb_y_tab[i+G_Y_OFF] = FIX(0.587) * i;
      rgb_y_tab[i+B_Y_OFF] = FIX(0.114) * i + ONE_HALF;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 284,12 ***</span>
  rgb_gray_convert (j_decompress_ptr cinfo,
            JSAMPIMAGE input_buf, JDIMENSION input_row,
            JSAMPARRAY output_buf, int num_rows)
  {
    my_cconvert_ptr cconvert = (my_cconvert_ptr) cinfo-&gt;cconvert;
<span class="line-removed">-   register INT32 * ctab = cconvert-&gt;rgb_y_tab;</span>
    register int r, g, b;
    register JSAMPROW outptr;
    register JSAMPROW inptr0, inptr1, inptr2;
    register JDIMENSION col;
    JDIMENSION num_cols = cinfo-&gt;output_width;
  
<span class="line-new-header">--- 272,12 ---</span>
  rgb_gray_convert (j_decompress_ptr cinfo,
            JSAMPIMAGE input_buf, JDIMENSION input_row,
            JSAMPARRAY output_buf, int num_rows)
  {
    my_cconvert_ptr cconvert = (my_cconvert_ptr) cinfo-&gt;cconvert;
    register int r, g, b;
<span class="line-added">+   register INT32 * ctab = cconvert-&gt;rgb_y_tab;</span>
    register JSAMPROW outptr;
    register JSAMPROW inptr0, inptr1, inptr2;
    register JDIMENSION col;
    JDIMENSION num_cols = cinfo-&gt;output_width;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 311,10 ***</span>
<span class="line-new-header">--- 299,11 ---</span>
    }
  }
  
  
  /*
<span class="line-added">+  * Convert some rows of samples to the output colorspace.</span>
   * [R-G,G,B-G] to [R,G,B] conversion with modulo calculation
   * (inverse color transform).
   * This can be seen as an adaption of the general YCbCr-&gt;RGB
   * conversion equation with Kr = Kb = 0, while replacing the
   * normalization by modulo calculation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 362,12 ***</span>
  rgb1_gray_convert (j_decompress_ptr cinfo,
             JSAMPIMAGE input_buf, JDIMENSION input_row,
             JSAMPARRAY output_buf, int num_rows)
  {
    my_cconvert_ptr cconvert = (my_cconvert_ptr) cinfo-&gt;cconvert;
<span class="line-removed">-   register INT32 * ctab = cconvert-&gt;rgb_y_tab;</span>
    register int r, g, b;
    register JSAMPROW outptr;
    register JSAMPROW inptr0, inptr1, inptr2;
    register JDIMENSION col;
    JDIMENSION num_cols = cinfo-&gt;output_width;
  
<span class="line-new-header">--- 351,12 ---</span>
  rgb1_gray_convert (j_decompress_ptr cinfo,
             JSAMPIMAGE input_buf, JDIMENSION input_row,
             JSAMPARRAY output_buf, int num_rows)
  {
    my_cconvert_ptr cconvert = (my_cconvert_ptr) cinfo-&gt;cconvert;
    register int r, g, b;
<span class="line-added">+   register INT32 * ctab = cconvert-&gt;rgb_y_tab;</span>
    register JSAMPROW outptr;
    register JSAMPROW inptr0, inptr1, inptr2;
    register JDIMENSION col;
    JDIMENSION num_cols = cinfo-&gt;output_width;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 394,10 ***</span>
<span class="line-new-header">--- 383,11 ---</span>
    }
  }
  
  
  /*
<span class="line-added">+  * Convert some rows of samples to the output colorspace.</span>
   * No colorspace change, but conversion from separate-planes
   * to interleaved representation.
   */
  
  METHODDEF(void)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 428,31 ***</span>
  
  
  /*
   * Color conversion for no colorspace change: just copy the data,
   * converting from separate-planes to interleaved representation.
   */
  
  METHODDEF(void)
  null_convert (j_decompress_ptr cinfo,
            JSAMPIMAGE input_buf, JDIMENSION input_row,
            JSAMPARRAY output_buf, int num_rows)
  {
<span class="line-removed">-   int ci;</span>
<span class="line-removed">-   register int nc = cinfo-&gt;num_components;</span>
    register JSAMPROW outptr;
    register JSAMPROW inptr;
<span class="line-modified">!   register JDIMENSION col;</span>
    JDIMENSION num_cols = cinfo-&gt;output_width;
  
    while (--num_rows &gt;= 0) {
<span class="line-modified">!     for (ci = 0; ci &lt; nc; ci++) {</span>
        inptr = input_buf[ci][input_row];
        outptr = output_buf[0] + ci;
<span class="line-modified">!       for (col = 0; col &lt; num_cols; col++) {</span>
<span class="line-modified">!     *outptr = *inptr++;    /* needn&#39;t bother with GETJSAMPLE() here */</span>
<span class="line-modified">!     outptr += nc;</span>
        }
      }
      input_row++;
      output_buf++;
    }
<span class="line-new-header">--- 418,33 ---</span>
  
  
  /*
   * Color conversion for no colorspace change: just copy the data,
   * converting from separate-planes to interleaved representation.
<span class="line-added">+  * We assume out_color_components == num_components.</span>
   */
  
  METHODDEF(void)
  null_convert (j_decompress_ptr cinfo,
            JSAMPIMAGE input_buf, JDIMENSION input_row,
            JSAMPARRAY output_buf, int num_rows)
  {
    register JSAMPROW outptr;
    register JSAMPROW inptr;
<span class="line-modified">!   register JDIMENSION count;</span>
<span class="line-added">+   register int num_comps = cinfo-&gt;num_components;</span>
    JDIMENSION num_cols = cinfo-&gt;output_width;
<span class="line-added">+   int ci;</span>
  
    while (--num_rows &gt;= 0) {
<span class="line-modified">!     /* It seems fastest to make a separate pass for each component. */</span>
<span class="line-added">+     for (ci = 0; ci &lt; num_comps; ci++) {</span>
        inptr = input_buf[ci][input_row];
        outptr = output_buf[0] + ci;
<span class="line-modified">!       for (count = num_cols; count &gt; 0; count--) {</span>
<span class="line-modified">!     *outptr = *inptr++;    /* don&#39;t need GETJSAMPLE() here */</span>
<span class="line-modified">!     outptr += num_comps;</span>
        }
      }
      input_row++;
      output_buf++;
    }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 614,13 ***</span>
    }
  }
  
  
  /*
<span class="line-modified">!  * Adobe-style YCCK-&gt;CMYK conversion.</span>
<span class="line-modified">!  * We convert YCbCr to R=1-C, G=1-M, and B=1-Y using the same</span>
<span class="line-modified">!  * conversion as above, while passing K (black) unchanged.</span>
   * We assume build_ycc_rgb_table has been called.
   */
  
  METHODDEF(void)
  ycck_cmyk_convert (j_decompress_ptr cinfo,
<span class="line-new-header">--- 606,14 ---</span>
    }
  }
  
  
  /*
<span class="line-modified">!  * Convert some rows of samples to the output colorspace.</span>
<span class="line-modified">!  * This version handles Adobe-style YCCK-&gt;CMYK conversion,</span>
<span class="line-modified">!  * where we convert YCbCr to R=1-C, G=1-M, and B=1-Y using the</span>
<span class="line-added">+  * same conversion as above, while passing K (black) unchanged.</span>
   * We assume build_ycc_rgb_table has been called.
   */
  
  METHODDEF(void)
  ycck_cmyk_convert (j_decompress_ptr cinfo,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 687,13 ***</span>
  jinit_color_deconverter (j_decompress_ptr cinfo)
  {
    my_cconvert_ptr cconvert;
    int ci;
  
<span class="line-modified">!   cconvert = (my_cconvert_ptr)</span>
<span class="line-modified">!     (*cinfo-&gt;mem-&gt;alloc_small) ((j_common_ptr) cinfo, JPOOL_IMAGE,</span>
<span class="line-removed">-                 SIZEOF(my_color_deconverter));</span>
    cinfo-&gt;cconvert = &amp;cconvert-&gt;pub;
    cconvert-&gt;pub.start_pass = start_pass_dcolor;
  
    /* Make sure num_components agrees with jpeg_color_space */
    switch (cinfo-&gt;jpeg_color_space) {
<span class="line-new-header">--- 680,12 ---</span>
  jinit_color_deconverter (j_decompress_ptr cinfo)
  {
    my_cconvert_ptr cconvert;
    int ci;
  
<span class="line-modified">!   cconvert = (my_cconvert_ptr) (*cinfo-&gt;mem-&gt;alloc_small)</span>
<span class="line-modified">!     ((j_common_ptr) cinfo, JPOOL_IMAGE, SIZEOF(my_color_deconverter));</span>
    cinfo-&gt;cconvert = &amp;cconvert-&gt;pub;
    cconvert-&gt;pub.start_pass = start_pass_dcolor;
  
    /* Make sure num_components agrees with jpeg_color_space */
    switch (cinfo-&gt;jpeg_color_space) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 717,11 ***</span>
      break;
  
    default:            /* JCS_UNKNOWN can be anything */
      if (cinfo-&gt;num_components &lt; 1)
        ERREXIT(cinfo, JERR_BAD_J_COLORSPACE);
<span class="line-removed">-     break;</span>
    }
  
    /* Support color transform only for RGB colorspaces */
    if (cinfo-&gt;color_transform &amp;&amp;
        cinfo-&gt;jpeg_color_space != JCS_RGB &amp;&amp;
<span class="line-new-header">--- 709,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 778,17 ***</span>
        build_bg_ycc_rgb_table(cinfo);
        break;
      case JCS_RGB:
        switch (cinfo-&gt;color_transform) {
        case JCT_NONE:
<span class="line-modified">!         cconvert-&gt;pub.color_convert = rgb_convert;</span>
<span class="line-modified">!         break;</span>
        case JCT_SUBTRACT_GREEN:
<span class="line-modified">!         cconvert-&gt;pub.color_convert = rgb1_rgb_convert;</span>
<span class="line-modified">!         break;</span>
        default:
<span class="line-modified">!         ERREXIT(cinfo, JERR_CONVERSION_NOTIMPL);</span>
        }
        break;
      case JCS_YCCK:
        cconvert-&gt;pub.color_convert = ycck_rgb_convert;
        build_ycc_rgb_table(cinfo);
<span class="line-new-header">--- 769,17 ---</span>
        build_bg_ycc_rgb_table(cinfo);
        break;
      case JCS_RGB:
        switch (cinfo-&gt;color_transform) {
        case JCT_NONE:
<span class="line-modified">!     cconvert-&gt;pub.color_convert = rgb_convert;</span>
<span class="line-modified">!     break;</span>
        case JCT_SUBTRACT_GREEN:
<span class="line-modified">!     cconvert-&gt;pub.color_convert = rgb1_rgb_convert;</span>
<span class="line-modified">!     break;</span>
        default:
<span class="line-modified">!     ERREXIT(cinfo, JERR_CONVERSION_NOTIMPL);</span>
        }
        break;
      case JCS_YCCK:
        cconvert-&gt;pub.color_convert = ycck_rgb_convert;
        build_ycc_rgb_table(cinfo);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 801,23 ***</span>
      }
      break;
  
    case JCS_BG_RGB:
      cinfo-&gt;out_color_components = RGB_PIXELSIZE;
<span class="line-modified">!     if (cinfo-&gt;jpeg_color_space == JCS_BG_RGB) {</span>
<span class="line-modified">!       switch (cinfo-&gt;color_transform) {</span>
<span class="line-modified">!       case JCT_NONE:</span>
<span class="line-modified">!     cconvert-&gt;pub.color_convert = rgb_convert;</span>
<span class="line-modified">!     break;</span>
<span class="line-modified">!       case JCT_SUBTRACT_GREEN:</span>
<span class="line-modified">!     cconvert-&gt;pub.color_convert = rgb1_rgb_convert;</span>
<span class="line-modified">!     break;</span>
<span class="line-modified">!       default:</span>
<span class="line-modified">!     ERREXIT(cinfo, JERR_CONVERSION_NOTIMPL);</span>
<span class="line-removed">-       }</span>
<span class="line-removed">-     } else</span>
        ERREXIT(cinfo, JERR_CONVERSION_NOTIMPL);
      break;
  
    case JCS_CMYK:
      cinfo-&gt;out_color_components = 4;
      switch (cinfo-&gt;jpeg_color_space) {
<span class="line-new-header">--- 792,22 ---</span>
      }
      break;
  
    case JCS_BG_RGB:
      cinfo-&gt;out_color_components = RGB_PIXELSIZE;
<span class="line-modified">!     if (cinfo-&gt;jpeg_color_space != JCS_BG_RGB)</span>
<span class="line-modified">!       ERREXIT(cinfo, JERR_CONVERSION_NOTIMPL);</span>
<span class="line-modified">!     switch (cinfo-&gt;color_transform) {</span>
<span class="line-modified">!     case JCT_NONE:</span>
<span class="line-modified">!       cconvert-&gt;pub.color_convert = rgb_convert;</span>
<span class="line-modified">!       break;</span>
<span class="line-modified">!     case JCT_SUBTRACT_GREEN:</span>
<span class="line-modified">!       cconvert-&gt;pub.color_convert = rgb1_rgb_convert;</span>
<span class="line-modified">!       break;</span>
<span class="line-modified">!     default:</span>
        ERREXIT(cinfo, JERR_CONVERSION_NOTIMPL);
<span class="line-added">+     }</span>
      break;
  
    case JCS_CMYK:
      cinfo-&gt;out_color_components = 4;
      switch (cinfo-&gt;jpeg_color_space) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 831,18 ***</span>
      default:
        ERREXIT(cinfo, JERR_CONVERSION_NOTIMPL);
      }
      break;
  
<span class="line-modified">!   default:</span>
<span class="line-modified">!     /* Permit null conversion to same output space */</span>
<span class="line-modified">!     if (cinfo-&gt;out_color_space == cinfo-&gt;jpeg_color_space) {</span>
<span class="line-removed">-       cinfo-&gt;out_color_components = cinfo-&gt;num_components;</span>
<span class="line-removed">-       cconvert-&gt;pub.color_convert = null_convert;</span>
<span class="line-removed">-     } else            /* unsupported non-null conversion */</span>
        ERREXIT(cinfo, JERR_CONVERSION_NOTIMPL);
<span class="line-modified">!     break;</span>
    }
  
    if (cinfo-&gt;quantize_colors)
      cinfo-&gt;output_components = 1; /* single colormapped output component */
    else
<span class="line-new-header">--- 821,16 ---</span>
      default:
        ERREXIT(cinfo, JERR_CONVERSION_NOTIMPL);
      }
      break;
  
<span class="line-modified">!   default:        /* permit null conversion to same output space */</span>
<span class="line-modified">!     if (cinfo-&gt;out_color_space != cinfo-&gt;jpeg_color_space)</span>
<span class="line-modified">!       /* unsupported non-null conversion */</span>
        ERREXIT(cinfo, JERR_CONVERSION_NOTIMPL);
<span class="line-modified">!     cinfo-&gt;out_color_components = cinfo-&gt;num_components;</span>
<span class="line-added">+     cconvert-&gt;pub.color_convert = null_convert;</span>
    }
  
    if (cinfo-&gt;quantize_colors)
      cinfo-&gt;output_components = 1; /* single colormapped output component */
    else
</pre>
<center><a href="jcparam.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="jdct.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>