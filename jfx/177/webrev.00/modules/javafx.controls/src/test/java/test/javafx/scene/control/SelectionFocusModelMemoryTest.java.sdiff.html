<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.controls/src/test/java/test/javafx/scene/control/SelectionFocusModelMemoryTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../shims/java/javafx/scene/control/skin/ChoiceBoxSkinNodesShim.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>modules/javafx.controls/src/test/java/test/javafx/scene/control/SelectionFocusModelMemoryTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
204         SingleSelectionModel&lt;Tab&gt; replacingSm = TabPaneShim.getTabPaneSelectionModel(control);
205         maybeShowControl(control);
206         control.setSelectionModel(replacingSm);
207         attemptGC(weakRef, 10);
208         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
209     }
210 
211     @Test
212     public void testComboBoxSelectionModel() {
213         ComboBox&lt;String&gt; control = new ComboBox&lt;&gt;(FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;));
214         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
215         SingleSelectionModel&lt;String&gt; replacingSm = ComboBoxShim.get_ComboBoxSelectionModel(control);
216         maybeShowControl(control);
217         control.setSelectionModel(replacingSm);
218         attemptGC(weakRef, 10);
219         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
220     }
221 
222     @Test
223     public void testChoiceBoxSelectionModel() {
<span class="line-removed">224         // FIXME</span>
<span class="line-removed">225         // can&#39;t formally ignore just one parameter, so backing out if showBeforeReplaceSM</span>
<span class="line-removed">226         // will be fixed as side-effect of skin cleanup</span>
<span class="line-removed">227         if (showBeforeReplaceSM) return; //@Ignore(&quot;8087555&quot;)</span>
228         ChoiceBox&lt;String&gt; control = new ChoiceBox&lt;&gt;(FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;));
229         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
230         SingleSelectionModel&lt;String&gt; replacingSm = ChoiceBoxShim.get_ChoiceBoxSelectionModel(control);
231         maybeShowControl(control);
232         control.setSelectionModel(replacingSm);
233         attemptGC(weakRef, 10);
234         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
235     }
236 
237     private void attemptGC(WeakReference&lt;?&gt; weakRef, int n) {
238         // Attempt gc n times
239         for (int i = 0; i &lt; n; i++) {
240             System.gc();
241             System.runFinalization();
242 
243             if (weakRef.get() == null) {
244                 break;
245             }
246             try {
247                 Thread.sleep(500);
</pre>
</td>
<td>
<hr />
<pre>
204         SingleSelectionModel&lt;Tab&gt; replacingSm = TabPaneShim.getTabPaneSelectionModel(control);
205         maybeShowControl(control);
206         control.setSelectionModel(replacingSm);
207         attemptGC(weakRef, 10);
208         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
209     }
210 
211     @Test
212     public void testComboBoxSelectionModel() {
213         ComboBox&lt;String&gt; control = new ComboBox&lt;&gt;(FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;));
214         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
215         SingleSelectionModel&lt;String&gt; replacingSm = ComboBoxShim.get_ComboBoxSelectionModel(control);
216         maybeShowControl(control);
217         control.setSelectionModel(replacingSm);
218         attemptGC(weakRef, 10);
219         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
220     }
221 
222     @Test
223     public void testChoiceBoxSelectionModel() {




224         ChoiceBox&lt;String&gt; control = new ChoiceBox&lt;&gt;(FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;));
225         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
226         SingleSelectionModel&lt;String&gt; replacingSm = ChoiceBoxShim.get_ChoiceBoxSelectionModel(control);
227         maybeShowControl(control);
228         control.setSelectionModel(replacingSm);
229         attemptGC(weakRef, 10);
230         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
231     }
232 
233     private void attemptGC(WeakReference&lt;?&gt; weakRef, int n) {
234         // Attempt gc n times
235         for (int i = 0; i &lt; n; i++) {
236             System.gc();
237             System.runFinalization();
238 
239             if (weakRef.get() == null) {
240                 break;
241             }
242             try {
243                 Thread.sleep(500);
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../shims/java/javafx/scene/control/skin/ChoiceBoxSkinNodesShim.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>