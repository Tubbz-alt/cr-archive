<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.base/src/test/java/test/javafx/binding/GenericBindingTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../main/java/javafx/beans/binding/StringBinding.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>modules/javafx.base/src/test/java/test/javafx/binding/GenericBindingTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 36,47 ***</span>
  import org.junit.Before;
  import org.junit.Test;
  import org.junit.runner.RunWith;
  import org.junit.runners.Parameterized;
  
  import java.util.Arrays;
  import java.util.Collection;
  
  import static org.junit.Assert.assertEquals;
  import static org.junit.Assert.fail;
  
  @RunWith(Parameterized.class)
  public class GenericBindingTest&lt;T&gt; {
  
      private static final Object UNDEFINED = null;
  
<span class="line-modified">!     private final ObservableStub dependency1;</span>
<span class="line-modified">!     private final ObservableStub dependency2;</span>
<span class="line-removed">-     private final BindingMock&lt;T&gt; binding0;</span>
<span class="line-removed">-     private final BindingMock&lt;T&gt; binding1;</span>
<span class="line-removed">-     private final BindingMock&lt;T&gt; binding2;</span>
      private final T value1;
      private final T value2;
      private InvalidationListenerMock invalidationListener;
      private ChangeListenerMock&lt;Object&gt; changeListener;
  
      public GenericBindingTest(
              T value1, T value2,
<span class="line-modified">!             ObservableStub dependency1,</span>
<span class="line-removed">-             ObservableStub dependency2,</span>
<span class="line-removed">-             BindingMock&lt;T&gt; binding0, BindingMock&lt;T&gt; binding1, BindingMock&lt;T&gt; binding2) {</span>
          this.value1 = value1;
          this.value2 = value2;
<span class="line-modified">!         this.dependency1 = dependency1;</span>
<span class="line-removed">-         this.dependency2 = dependency2;</span>
<span class="line-removed">-         this.binding0 = binding0;</span>
<span class="line-removed">-         this.binding1 = binding1;</span>
<span class="line-removed">-         this.binding2 = binding2;</span>
      }
  
      @Before
<span class="line-modified">!     public void setUp() {</span>
          invalidationListener = new InvalidationListenerMock();
          changeListener = new ChangeListenerMock&lt;Object&gt;(UNDEFINED);
          binding0.setValue(value2);
          binding1.setValue(value2);
          binding2.setValue(value2);
<span class="line-new-header">--- 36,51 ---</span>
  import org.junit.Before;
  import org.junit.Test;
  import org.junit.runner.RunWith;
  import org.junit.runners.Parameterized;
  
<span class="line-added">+ import java.lang.reflect.Constructor;</span>
  import java.util.Arrays;
  import java.util.Collection;
  
  import static org.junit.Assert.assertEquals;
<span class="line-added">+ import static org.junit.Assert.assertFalse;</span>
<span class="line-added">+ import static org.junit.Assert.assertTrue;</span>
  import static org.junit.Assert.fail;
  
  @RunWith(Parameterized.class)
  public class GenericBindingTest&lt;T&gt; {
  
      private static final Object UNDEFINED = null;
  
<span class="line-modified">!     private final ObservableStub dependency1 = new ObservableStub();</span>
<span class="line-modified">!     private final ObservableStub dependency2 = new ObservableStub();</span>
      private final T value1;
      private final T value2;
<span class="line-added">+     private final Constructor&lt;BindingMock&lt;T&gt;&gt; bindingMockClassConstructor;</span>
<span class="line-added">+ </span>
<span class="line-added">+     private BindingMock&lt;T&gt; binding0;</span>
<span class="line-added">+     private BindingMock&lt;T&gt; binding1;</span>
<span class="line-added">+     private BindingMock&lt;T&gt; binding2;</span>
      private InvalidationListenerMock invalidationListener;
      private ChangeListenerMock&lt;Object&gt; changeListener;
  
      public GenericBindingTest(
              T value1, T value2,
<span class="line-modified">!             Class&lt;BindingMock&lt;T&gt;&gt; bindingMockClass) throws Exception {</span>
          this.value1 = value1;
          this.value2 = value2;
<span class="line-modified">!         this.bindingMockClassConstructor = bindingMockClass.getConstructor(Observable[].class);</span>
      }
  
      @Before
<span class="line-modified">!     public void setUp() throws Exception {</span>
<span class="line-added">+         // Recreate bindings as they may have been altered by one of the tests</span>
<span class="line-added">+         binding0 = bindingMockClassConstructor.newInstance((Object)new Observable[] {});</span>
<span class="line-added">+         binding1 = bindingMockClassConstructor.newInstance((Object)new Observable[] {dependency1});</span>
<span class="line-added">+         binding2 = bindingMockClassConstructor.newInstance((Object)new Observable[] {dependency1, dependency2});</span>
<span class="line-added">+ </span>
          invalidationListener = new InvalidationListenerMock();
          changeListener = new ChangeListenerMock&lt;Object&gt;(UNDEFINED);
          binding0.setValue(value2);
          binding1.setValue(value2);
          binding2.setValue(value2);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 290,71 ***</span>
          assertEquals(1, binding2.getComputeValueCounter());
          invalidationListener.check(null, 0);
          assertEquals(true, binding2.isValid());
      }
  
      @Parameterized.Parameters
      public static Collection&lt;Object[]&gt; parameters() {
<span class="line-removed">-         final ObservableStub dependency1 = new ObservableStub();</span>
<span class="line-removed">-         final ObservableStub dependency2 = new ObservableStub();</span>
          return Arrays.asList(new Object[][] {
              {
                  Float.MIN_VALUE, Float.MAX_VALUE,
<span class="line-modified">!                 dependency1, dependency2,</span>
<span class="line-removed">-                 new FloatBindingImpl(),</span>
<span class="line-removed">-                 new FloatBindingImpl(dependency1),</span>
<span class="line-removed">-                 new FloatBindingImpl(dependency1, dependency2),</span>
              },
              {
                  Double.MIN_VALUE, Double.MAX_VALUE,
<span class="line-modified">!                 dependency1, dependency2,</span>
<span class="line-removed">-                 new DoubleBindingImpl(),</span>
<span class="line-removed">-                 new DoubleBindingImpl(dependency1),</span>
<span class="line-removed">-                 new DoubleBindingImpl(dependency1, dependency2),</span>
              },
              {
                  Long.MIN_VALUE, Long.MAX_VALUE,
<span class="line-modified">!                 dependency1, dependency2,</span>
<span class="line-removed">-                 new LongBindingImpl(),</span>
<span class="line-removed">-                 new LongBindingImpl(dependency1),</span>
<span class="line-removed">-                 new LongBindingImpl(dependency1, dependency2),</span>
              },
              {
                  Integer.MIN_VALUE, Integer.MAX_VALUE,
<span class="line-modified">!                 dependency1, dependency2,</span>
<span class="line-removed">-                 new IntegerBindingImpl(),</span>
<span class="line-removed">-                 new IntegerBindingImpl(dependency1),</span>
<span class="line-removed">-                 new IntegerBindingImpl(dependency1, dependency2),</span>
              },
              {
                  true, false,
<span class="line-modified">!                 dependency1, dependency2,</span>
<span class="line-removed">-                 new BooleanBindingImpl(),</span>
<span class="line-removed">-                 new BooleanBindingImpl(dependency1),</span>
<span class="line-removed">-                 new BooleanBindingImpl(dependency1, dependency2),</span>
              },
              {
                  &quot;Hello World&quot;, &quot;Goodbye&quot;,
<span class="line-modified">!                 dependency1, dependency2,</span>
<span class="line-removed">-                 new StringBindingImpl(),</span>
<span class="line-removed">-                 new StringBindingImpl(dependency1),</span>
<span class="line-removed">-                 new StringBindingImpl(dependency1, dependency2),</span>
              },
              {
<span class="line-modified">!                     new Object(), new Object(),</span>
<span class="line-modified">!                     dependency1, dependency2,</span>
<span class="line-removed">-                     new ObjectBindingImpl(),</span>
<span class="line-removed">-                     new ObjectBindingImpl(dependency1),</span>
<span class="line-removed">-                     new ObjectBindingImpl(dependency1, dependency2),</span>
              },
              {
<span class="line-modified">!                     FXCollections.observableArrayList(), FXCollections.observableArrayList(),</span>
<span class="line-modified">!                     dependency1, dependency2,</span>
<span class="line-modified">!                     new ListBindingImpl(),</span>
<span class="line-removed">-                     new ListBindingImpl(dependency1),</span>
<span class="line-removed">-                     new ListBindingImpl(dependency1, dependency2),</span>
<span class="line-removed">-             },</span>
          });
      }
  
      public static class ObservableStub extends ObservableValueBase&lt;Object&gt; {
          @Override public void fireValueChangedEvent() {super.fireValueChangedEvent();}
<span class="line-new-header">--- 294,90 ---</span>
          assertEquals(1, binding2.getComputeValueCounter());
          invalidationListener.check(null, 0);
          assertEquals(true, binding2.isValid());
      }
  
<span class="line-added">+     @Test</span>
<span class="line-added">+     public void testUnbindDependencies() {</span>
<span class="line-added">+         // Start by making binding valid:</span>
<span class="line-added">+         binding2.getValue();</span>
<span class="line-added">+         assertTrue(binding2.isValid());</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Changing dependency1 should cause binding to become invalid:</span>
<span class="line-added">+         dependency1.fireValueChangedEvent();</span>
<span class="line-added">+         assertFalse(binding2.isValid());</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Make valid again:</span>
<span class="line-added">+         binding2.getValue();</span>
<span class="line-added">+         assertTrue(binding2.isValid());</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Changing dependency2 should cause binding to become invalid:</span>
<span class="line-added">+         dependency2.fireValueChangedEvent();</span>
<span class="line-added">+         assertFalse(binding2.isValid());</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Make valid again:</span>
<span class="line-added">+         binding2.getValue();</span>
<span class="line-added">+         assertTrue(binding2.isValid());</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Remove dependency1:</span>
<span class="line-added">+         binding2.publicUnbind(dependency1);</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Check that binding2 is no longer affected by changes in dependency1:</span>
<span class="line-added">+         dependency1.fireValueChangedEvent();</span>
<span class="line-added">+         assertTrue(binding2.isValid());</span>
<span class="line-added">+ </span>
<span class="line-added">+         // But still affected by changes in dependency2:</span>
<span class="line-added">+         dependency2.fireValueChangedEvent();</span>
<span class="line-added">+         assertFalse(binding2.isValid());</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Make valid again:</span>
<span class="line-added">+         binding2.getValue();</span>
<span class="line-added">+         assertTrue(binding2.isValid());</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Remove dependency2:</span>
<span class="line-added">+         binding2.publicUnbind(dependency2);</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Check that binding2 is no longer affected by changes in dependency2:</span>
<span class="line-added">+         dependency2.fireValueChangedEvent();</span>
<span class="line-added">+         assertTrue(binding2.isValid());   // Fixed by 8243115</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      @Parameterized.Parameters
      public static Collection&lt;Object[]&gt; parameters() {
          return Arrays.asList(new Object[][] {
              {
                  Float.MIN_VALUE, Float.MAX_VALUE,
<span class="line-modified">!                 FloatBindingImpl.class</span>
              },
              {
                  Double.MIN_VALUE, Double.MAX_VALUE,
<span class="line-modified">!                 DoubleBindingImpl.class</span>
              },
              {
                  Long.MIN_VALUE, Long.MAX_VALUE,
<span class="line-modified">!                 LongBindingImpl.class</span>
              },
              {
                  Integer.MIN_VALUE, Integer.MAX_VALUE,
<span class="line-modified">!                 IntegerBindingImpl.class</span>
              },
              {
                  true, false,
<span class="line-modified">!                 BooleanBindingImpl.class</span>
              },
              {
                  &quot;Hello World&quot;, &quot;Goodbye&quot;,
<span class="line-modified">!                 StringBindingImpl.class</span>
              },
              {
<span class="line-modified">!                 new Object(), new Object(),</span>
<span class="line-modified">!                 ObjectBindingImpl.class</span>
              },
              {
<span class="line-modified">!                 FXCollections.observableArrayList(), FXCollections.observableArrayList(),</span>
<span class="line-modified">!                 ListBindingImpl.class</span>
<span class="line-modified">!             }</span>
          });
      }
  
      public static class ObservableStub extends ObservableValueBase&lt;Object&gt; {
          @Override public void fireValueChangedEvent() {super.fireValueChangedEvent();}
</pre>
<hr />
<pre>
<span class="line-old-header">*** 367,10 ***</span>
<span class="line-new-header">--- 390,11 ---</span>
  
      public static interface BindingMock&lt;T&gt; extends Binding&lt;T&gt; {
          int getComputeValueCounter();
          void reset();
          void setValue(T value);
<span class="line-added">+         void publicUnbind(Observable... observables);</span>
      }
  
      private static class DoubleBindingImpl extends DoubleBinding implements BindingMock&lt;Number&gt; {
  
          private int computeValueCounter = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 399,10 ***</span>
<span class="line-new-header">--- 423,14 ---</span>
  
          public ObservableList&lt;?&gt; getDependencies() {
              fail(&quot;Should not reach here&quot;);
              return null;
          }
<span class="line-added">+ </span>
<span class="line-added">+         public void publicUnbind(Observable... observables) {</span>
<span class="line-added">+             super.unbind(observables);</span>
<span class="line-added">+         }</span>
      }
  
      private static class FloatBindingImpl extends FloatBinding implements BindingMock&lt;Number&gt; {
  
          private int computeValueCounter = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 431,10 ***</span>
<span class="line-new-header">--- 459,14 ---</span>
  
          public ObservableList&lt;?&gt; getDependencies() {
              fail(&quot;Should not reach here&quot;);
              return null;
          }
<span class="line-added">+ </span>
<span class="line-added">+         public void publicUnbind(Observable... observables) {</span>
<span class="line-added">+             super.unbind(observables);</span>
<span class="line-added">+         }</span>
      }
  
      private static class LongBindingImpl extends LongBinding implements BindingMock&lt;Number&gt; {
  
          private int computeValueCounter = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 463,10 ***</span>
<span class="line-new-header">--- 495,14 ---</span>
  
          public ObservableList&lt;?&gt; getDependencies() {
              fail(&quot;Should not reach here&quot;);
              return null;
          }
<span class="line-added">+ </span>
<span class="line-added">+         public void publicUnbind(Observable... observables) {</span>
<span class="line-added">+             super.unbind(observables);</span>
<span class="line-added">+         }</span>
      }
  
      private static class IntegerBindingImpl extends IntegerBinding implements BindingMock&lt;Number&gt; {
  
          private int computeValueCounter = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 495,10 ***</span>
<span class="line-new-header">--- 531,14 ---</span>
  
          public ObservableList&lt;?&gt; getDependencies() {
              fail(&quot;Should not reach here&quot;);
              return null;
          }
<span class="line-added">+ </span>
<span class="line-added">+         public void publicUnbind(Observable... observables) {</span>
<span class="line-added">+             super.unbind(observables);</span>
<span class="line-added">+         }</span>
      }
  
      private static class BooleanBindingImpl extends BooleanBinding implements BindingMock&lt;Boolean&gt; {
  
          private int computeValueCounter = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 527,10 ***</span>
<span class="line-new-header">--- 567,14 ---</span>
  
          public ObservableList&lt;?&gt; getDependencies() {
              fail(&quot;Should not reach here&quot;);
              return null;
          }
<span class="line-added">+ </span>
<span class="line-added">+         public void publicUnbind(Observable... observables) {</span>
<span class="line-added">+             super.unbind(observables);</span>
<span class="line-added">+         }</span>
      }
  
      private static class ObjectBindingImpl extends ObjectBinding&lt;Object&gt; implements BindingMock&lt;Object&gt; {
  
          private int computeValueCounter = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 559,10 ***</span>
<span class="line-new-header">--- 603,14 ---</span>
  
          public ObservableList&lt;?&gt; getDependencies() {
              fail(&quot;Should not reach here&quot;);
              return null;
          }
<span class="line-added">+ </span>
<span class="line-added">+         public void publicUnbind(Observable... observables) {</span>
<span class="line-added">+             super.unbind(observables);</span>
<span class="line-added">+         }</span>
      }
  
      private static class StringBindingImpl extends StringBinding implements BindingMock&lt;String&gt; {
  
          private int computeValueCounter = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 591,10 ***</span>
<span class="line-new-header">--- 639,14 ---</span>
  
          public ObservableList&lt;?&gt; getDependencies() {
              fail(&quot;Should not reach here&quot;);
              return null;
          }
<span class="line-added">+ </span>
<span class="line-added">+         public void publicUnbind(Observable... observables) {</span>
<span class="line-added">+             super.unbind(observables);</span>
<span class="line-added">+         }</span>
      }
  
      private static class ListBindingImpl extends ListBinding&lt;Object&gt; implements BindingMock&lt;ObservableList&lt;Object&gt;&gt; {
  
          private int computeValueCounter = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 623,9 ***</span>
<span class="line-new-header">--- 675,13 ---</span>
  
          public ObservableList&lt;?&gt; getDependencies() {
              fail(&quot;Should not reach here&quot;);
              return null;
          }
<span class="line-added">+ </span>
<span class="line-added">+         public void publicUnbind(Observable... observables) {</span>
<span class="line-added">+             super.unbind(observables);</span>
<span class="line-added">+         }</span>
      }
  
  
  }
</pre>
<center><a href="../../../../../main/java/javafx/beans/binding/StringBinding.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>