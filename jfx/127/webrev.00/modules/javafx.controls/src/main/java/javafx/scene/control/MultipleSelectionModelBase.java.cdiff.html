<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.controls/src/main/java/javafx/scene/control/MultipleSelectionModelBase.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../com/sun/javafx/scene/control/ReadOnlyUnbackedObservableList.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>modules/javafx.controls/src/main/java/javafx/scene/control/MultipleSelectionModelBase.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 624,10 ***</span>
<span class="line-new-header">--- 624,11 ---</span>
       **********************************************************************/
  
      class SelectedIndicesList extends ReadOnlyUnbackedObservableList&lt;Integer&gt; {
          private final BitSet bitset;
  
<span class="line-added">+         private int size = -1;</span>
          private int lastGetIndex = -1;
          private int lastGetValue = -1;
  
          // Fix for RT-20945 (and numerous other issues!)
          private int atomicityCount = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 692,10 ***</span>
<span class="line-new-header">--- 693,11 ---</span>
              if (!isValidIndex(index) || isSelected(index)) {
                  return;
              }
  
              _beginChange();
<span class="line-added">+             size = -1;</span>
              bitset.set(index);
              int indicesIndex = indexOf(index);
              _nextAdd(indicesIndex, indicesIndex + 1);
              _endChange();
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 712,10 ***</span>
<span class="line-new-header">--- 714,11 ---</span>
              }
          }
  
          public void set(int index, int end, boolean isSet) {
              _beginChange();
<span class="line-added">+             size = -1;</span>
              if (isSet) {
                  bitset.set(index, end, isSet);
                  int indicesIndex = indexOf(index);
                  int span = end - index;
                  _nextAdd(indicesIndex, indicesIndex + span);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 789,19 ***</span>
<span class="line-new-header">--- 792,21 ---</span>
          }
  
          public void clear() {
              _beginChange();
              List&lt;Integer&gt; removed = bitset.stream().boxed().collect(Collectors.toList());
<span class="line-added">+             size = 0;</span>
              bitset.clear();
              _nextRemove(0, removed);
              _endChange();
          }
  
          public void clear(int index) {
              if (!bitset.get(index)) return;
  
              _beginChange();
<span class="line-added">+             size = -1;</span>
              bitset.clear(index);
              _nextRemove(index, index);
              _endChange();
          }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 853,21 ***</span>
              return !isSelected(index);
          }
  
          /** Returns number of true bits in BitSet */
          @Override public int size() {
<span class="line-modified">!             return bitset.cardinality();</span>
          }
  
          /** Returns the number of bits reserved in the BitSet */
          public int bitsetSize() {
              return bitset.size();
          }
  
          @Override public int indexOf(Object obj) {
<span class="line-modified">!             reset();</span>
<span class="line-modified">!             return super.indexOf(obj);</span>
          }
  
          @Override public boolean contains(Object o) {
              if (o instanceof Number) {
                  Number n = (Number) o;
<span class="line-new-header">--- 858,65 ---</span>
              return !isSelected(index);
          }
  
          /** Returns number of true bits in BitSet */
          @Override public int size() {
<span class="line-modified">!             if(size&gt;=0){</span>
<span class="line-added">+                 return size;</span>
<span class="line-added">+             }</span>
<span class="line-added">+             size = bitset.cardinality();</span>
<span class="line-added">+             return size;</span>
          }
  
          /** Returns the number of bits reserved in the BitSet */
          public int bitsetSize() {
              return bitset.size();
          }
  
          @Override public int indexOf(Object obj) {
<span class="line-modified">!             if (!(obj instanceof Number)) {</span>
<span class="line-modified">!                 return -1;</span>
<span class="line-added">+             }</span>
<span class="line-added">+             Number n = (Number) obj;</span>
<span class="line-added">+             int index = n.intValue();</span>
<span class="line-added">+             if(!bitset.get(index)) {</span>
<span class="line-added">+                 return -1;</span>
<span class="line-added">+             }</span>
<span class="line-added">+             // is left most bit</span>
<span class="line-added">+             if(index==0) {</span>
<span class="line-added">+                 return 0;</span>
<span class="line-added">+             }</span>
<span class="line-added">+ </span>
<span class="line-added">+             // is right most bit</span>
<span class="line-added">+             if( index == bitset.length()-1 ){</span>
<span class="line-added">+                 return size()-1;</span>
<span class="line-added">+             }</span>
<span class="line-added">+ </span>
<span class="line-added">+             // count right bit</span>
<span class="line-added">+             if( index &gt; bitset.length()/2 ) {</span>
<span class="line-added">+                 int count = 1;</span>
<span class="line-added">+                 for (;;) {</span>
<span class="line-added">+                     index = bitset.nextSetBit(index + 1);</span>
<span class="line-added">+                     if (index &lt; 0) {</span>
<span class="line-added">+                         break;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                     count++;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 return size() - count;</span>
<span class="line-added">+             }</span>
<span class="line-added">+ </span>
<span class="line-added">+             // count left bit</span>
<span class="line-added">+             // return (int)bitset.stream().takeWhile(i-&gt;i&lt;index).count();</span>
<span class="line-added">+             int count = 0;</span>
<span class="line-added">+             for(;;){</span>
<span class="line-added">+                 index = bitset.previousSetBit(index-1);</span>
<span class="line-added">+                 if(index&lt;0){</span>
<span class="line-added">+                     break;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 count++;</span>
<span class="line-added">+             }</span>
<span class="line-added">+             return count;</span>
          }
  
          @Override public boolean contains(Object o) {
              if (o instanceof Number) {
                  Number n = (Number) o;
</pre>
<center><a href="../../../com/sun/javafx/scene/control/ReadOnlyUnbackedObservableList.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>