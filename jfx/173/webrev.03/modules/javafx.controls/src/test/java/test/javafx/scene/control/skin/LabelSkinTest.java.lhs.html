<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.controls/src/test/java/test/javafx/scene/control/skin/LabelSkinTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
   2  * Copyright (c) 2011, 2017, Oracle and/or its affiliates. All rights reserved.
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package test.javafx.scene.control.skin;
  27 
  28 import static org.junit.Assert.assertEquals;
  29 import static org.junit.Assert.assertFalse;
  30 import static org.junit.Assert.assertTrue;
  31 
  32 import com.sun.javafx.scene.control.skin.Utils;
  33 import javafx.beans.value.ObservableValue;
  34 import javafx.geometry.Insets;
  35 import javafx.geometry.Pos;
  36 import javafx.scene.control.ContentDisplay;
  37 import javafx.scene.control.Label;
  38 import javafx.scene.control.OverrunStyle;
  39 import javafx.scene.control.SkinBaseShim;
  40 import javafx.scene.control.skin.LabelSkin;
  41 import javafx.scene.control.skin.LabeledSkinBaseShim;
  42 import javafx.scene.effect.BlendMode;
  43 import javafx.scene.paint.Color;
  44 import javafx.scene.shape.Rectangle;
  45 import javafx.scene.text.Font;
  46 import javafx.scene.text.Text;
  47 import javafx.scene.text.TextAlignment;
  48 import com.sun.javafx.tk.Toolkit;
  49 import javafx.scene.Group;
  50 import javafx.scene.Scene;
  51 import javafx.stage.Stage;
  52 
  53 import org.junit.Before;
  54 import org.junit.Test;
  55 
  56 /**
  57  * Need to test:
  58  *  - String truncation works correctly
  59  *  - min/max/pref width/height when multiline text is turned on
  60  */
  61 public class LabelSkinTest {
  62     private Label label;
  63     private LabelSkinMock skin;
  64     private Text text;
  65 
  66     @Before public void setup() {
  67         label = new Label();
  68         skin = new LabelSkinMock(label);
  69         // Set some padding so that any places where padding was being
  70         // computed but wasn&#39;t expected will be caught.
  71         label.setPadding(new Insets(10, 10, 10, 10));
  72         label.setSkin(skin);
  73         // It so happens that a brand new LabelSkin on a plain Label
  74         // will have as its only child the Text node
  75         text = (Text) SkinBaseShim.getChildren(skin).get(0);
  76     }
  77 
  78     /****************************************************************************
  79      *                                                                          *
  80      * Tests for change notification                                            *
  81      *                                                                          *
  82      ***************************************************************************/
  83 
  84     @Test public void sizeChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
  85         skin.addWatchedProperty(label.widthProperty());
  86         skin.addWatchedProperty(label.heightProperty());
  87         assertFalse(skin.propertyChanged); // sanity check
  88         label.resize(500, label.getHeight());
  89         assertTrue(skin.propertyChanged);
  90         assertEquals(1, skin.propertyChangeCount); // sanity check
  91         label.resize(label.getWidth(), label.prefHeight(label.getWidth()));
  92         assertEquals(2, skin.propertyChangeCount); // sanity check
  93     }
  94 
  95     @Test public void textFillChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
  96         skin.addWatchedProperty(label.textFillProperty());
  97         label.setTextFill(Color.PURPLE);
  98         assertTrue(skin.propertyChanged);
  99     }
 100 
 101     @Test public void fontChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
 102         skin.addWatchedProperty(label.fontProperty());
 103         final Font f = Font.font(&quot;Arial&quot;, 64);
 104         label.setFont(f);
 105         assertTrue(skin.propertyChanged);
 106     }
 107 
 108     @Test public void graphicChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
 109         skin.addWatchedProperty(label.graphicProperty());
 110         label.setGraphic(new Rectangle());
 111         assertTrue(skin.propertyChanged);
 112     }
 113 
 114     @Test public void contentDisplayChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
 115         skin.addWatchedProperty(label.contentDisplayProperty());
 116         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
 117         assertTrue(skin.propertyChanged);
 118     }
 119 
 120     @Test public void graphicTextGapChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
 121         skin.addWatchedProperty(label.graphicTextGapProperty());
 122         label.setGraphicTextGap(60.34);
 123         assertTrue(skin.propertyChanged);
 124     }
 125 
 126     @Test public void hposChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
 127         skin.addWatchedProperty(label.alignmentProperty());
 128         label.setAlignment(Pos.CENTER_RIGHT);
 129         label.setAlignment(Pos.CENTER_RIGHT);
 130         assertTrue(skin.propertyChanged);
 131     }
 132 
 133     @Test public void vposChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
 134         skin.addWatchedProperty(label.alignmentProperty());
 135         label.setAlignment(Pos.TOP_CENTER);
 136         assertTrue(skin.propertyChanged);
 137     }
 138 
<a name="1" id="anc1"></a>





 139     @Test public void textChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
 140         skin.addWatchedProperty(label.textProperty());
 141         label.setText(&quot;Bust my buffers!&quot;);
 142         assertTrue(skin.propertyChanged);
 143     }
 144 
 145     @Test public void textAlignmentChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
 146         skin.addWatchedProperty(label.textAlignmentProperty());
 147         label.setTextAlignment(TextAlignment.JUSTIFY);
 148         assertTrue(skin.propertyChanged);
 149     }
 150 
 151     @Test public void textOverrunChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
 152         skin.addWatchedProperty(label.textOverrunProperty());
 153         label.setTextOverrun(OverrunStyle.CENTER_WORD_ELLIPSIS);
 154         assertTrue(skin.propertyChanged);
 155     }
 156 
 157     @Test public void wrapTextChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
 158         skin.addWatchedProperty(label.wrapTextProperty());
 159         label.setWrapText(true);
 160         assertTrue(skin.propertyChanged);
 161     }
 162 
 163     @Test public void underlineChangesOnLabelShouldInvoke_handleControlPropertyChanged() {
 164         skin.addWatchedProperty(label.underlineProperty());
 165         label.setUnderline(true);
 166         assertTrue(skin.propertyChanged);
 167     }
 168 
 169     @Test public void uninterestingChangesOnLabelShouldNotInvoke_handleControlPropertyChanged() {
 170         label.setBlendMode(BlendMode.BLUE);
 171         assertFalse(skin.propertyChanged);
 172     }
 173 
 174     /****************************************************************************
 175      *                                                                          *
 176      * Tests for invalidation. When each of various properties change, we need  *
 177      * to invalidate some state, such as via requestLayout().                   *
 178      *                                                                          *
 179      ***************************************************************************/
 180 
 181     @Test public void graphicLayoutBoundsChangeShouldInvalidateLayoutAndDisplayText() {
 182         final Rectangle r = new Rectangle(20, 20);
 183         label.setGraphic(r);
 184         label.layout();
 185         skin.updateDisplayedText();
 186 
 187         r.setWidth(30);
 188         assertTrue(label.isNeedsLayout());
 189         assertTrue(skin.get_invalidText());
 190     }
 191 
 192     @Test public void widthChangesOnLabelShouldInvalidateLayoutAndDisplayText() {
 193         label.layout();
 194         skin.updateDisplayedText();
 195 
 196         label.resize(500, label.getHeight());
 197         assertTrue(label.isNeedsLayout());
 198         assertTrue(skin.get_invalidText());
 199     }
 200 
 201     @Test public void widthChangesWhenWrapTextIsTrueUpdatesTheWrappingWidth() {
 202         // Assert that the wrapping width changes with the label width if wrapText is true.
 203         // However, this will only be required if the longest line in the text is itself
 204         // wider than the label&#39;s available width.
 205         label.setText(&quot;A long line which is wider than 100 pixels.&quot;);
 206         label.setWrapText(true);
 207         label.autosize();
 208         //label.layout();
 209         skin.updateDisplayedText();
 210 
 211         final double oldWrappingWidth = text.getWrappingWidth();
 212         label.resize(100, label.getHeight());
 213         skin.updateDisplayedText();
 214         assertFalse(oldWrappingWidth == text.getWrappingWidth());
 215         assertTrue(text.getWrappingWidth() &gt; 0);
 216     }
 217 
 218     @Test public void widthChangesWhenWrapTextIsFalseKeepsWrappingWidthAtZero() {
 219         label.layout();
 220         skin.updateDisplayedText();
 221 
 222         label.resize(500, label.getHeight());
 223         assertEquals(0, text.getWrappingWidth(), 0);
 224     }
 225 
 226     @Test public void fontChangesOnLabelShouldInvalidateLayoutAndDisplayTextAndEllipsesWidthAndTextWidth() {
 227         label.layout();
 228         skin.updateDisplayedText();
 229 
 230         label.setFont(Font.font(&quot;Arial&quot;, 37));
 231         assertTrue(label.isNeedsLayout());
 232         assertTrue(skin.get_invalidText());
 233         assertEquals(Double.NEGATIVE_INFINITY, skin.get_textWidth(), 0);
 234         assertEquals(Double.NEGATIVE_INFINITY, skin.get_ellipsisWidth(), 0);
 235     }
 236 
 237     @Test public void graphicChangesOnLabelShouldInvalidateLayoutAndDisplayText() {
 238         label.layout();
 239         skin.updateDisplayedText();
 240 
 241         label.setGraphic(new Rectangle(20, 20));
 242         assertTrue(label.isNeedsLayout());
 243         assertTrue(skin.get_invalidText());
 244     }
 245 
 246     @Test public void contentDisplayChangesOnLabelShouldInvalidateLayoutAndDisplayText() {
 247         label.layout();
 248         skin.updateDisplayedText();
 249 
 250         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
 251         assertTrue(label.isNeedsLayout());
 252         assertTrue(skin.get_invalidText());
 253     }
 254 
 255     @Test public void graphicTextGapChangesOnLabelShouldInvalidateLayoutAndDisplayText() {
 256         label.layout();
 257         skin.updateDisplayedText();
 258 
 259         label.setGraphicTextGap(8.37);
 260         assertTrue(label.isNeedsLayout());
 261         assertTrue(skin.get_invalidText());
 262     }
 263 
 264     @Test public void hposChangesOnLabelShouldInvalidateLayout() {
 265         label.layout();
 266         skin.updateDisplayedText();
 267 
 268         label.setAlignment(Pos.CENTER_RIGHT);
 269         assertTrue(label.isNeedsLayout());
 270         assertFalse(skin.get_invalidText());
 271     }
 272 
 273     @Test public void vposChangesOnLabelShouldInvalidateLayout() {
 274         label.layout();
 275         skin.updateDisplayedText();
 276 
 277         label.setAlignment(Pos.TOP_CENTER);
 278         assertTrue(label.isNeedsLayout());
 279         assertFalse(skin.get_invalidText());
 280     }
 281 
<a name="2" id="anc2"></a>








 282     @Test public void textChangesOnLabelShouldInvalidateLayoutAndDisplayTextAndTextWidth() {
 283         label.layout();
 284         skin.updateDisplayedText();
 285 
 286         label.setText(&quot;Apples and Oranges&quot;);
 287         assertTrue(label.isNeedsLayout());
 288         assertTrue(skin.get_invalidText());
 289         assertEquals(Double.NEGATIVE_INFINITY, skin.get_textWidth(), 0);
 290     }
 291 // TODO(aim): changing textAlignment doesn&#39;t actually change Text layoutBounds
 292 //
 293 //    @Test public void textAlignmentChangesOnLabelShouldInvalidateLayout() {
 294 //        label.layout();
 295 //        skin.updateDisplayedText();
 296 //
 297 //        label.setTextAlignment(TextAlignment.JUSTIFY);
 298 //        assertTrue(label.isNeedsLayout());
 299 //        assertFalse(skin.invalidText());
 300 //    }
 301 
 302     @Test public void textOverrunChangesOnLabelShouldInvalidateLayoutAndDisplayText() {
 303         label.layout();
 304         skin.updateDisplayedText();
 305 
 306         label.setTextOverrun(OverrunStyle.CENTER_WORD_ELLIPSIS);
 307         assertTrue(label.isNeedsLayout());
 308         assertTrue(skin.get_invalidText());
 309     }
 310 
 311     @Test public void wrapTextChangesOnLabelShouldInvalidateLayoutAndDisplayTextAndWrappingWidth() {
 312         label.setText(&quot;A long line which is wider than 100 pixels.&quot;);
 313         label.resize(100, 30);
 314         label.layout();
 315         skin.updateDisplayedText();
 316 
 317         final double oldWrappingWidth = text.getWrappingWidth();
 318         label.setWrapText(true);
 319         assertTrue(label.isNeedsLayout());
 320         assertTrue(skin.get_invalidText());
 321         assertFalse(oldWrappingWidth == text.getWrappingWidth());
 322         assertTrue(text.getWrappingWidth() &gt; 0);
 323     }
 324 
 325     @Test public void underlineChangesOnLabelShouldInvalidateLayoutAndDisplayText() {
 326         label.layout();
 327         skin.updateDisplayedText();
 328 
 329         label.setUnderline(true);
 330         assertTrue(label.isNeedsLayout());
 331         assertTrue(skin.get_invalidText());
 332     }
 333 
 334     /****************************************************************************
 335      *                                                                          *
 336      * Tests for minWidth                                                       *
 337      *                                                                          *
 338      ***************************************************************************/
 339 
 340     @Test public void whenTextIsNullAndNoGraphic_computeMinWidth_ReturnsZero() {
 341         label.setPadding(new Insets(7, 7, 7, 7));
 342         label.setText(null);
 343         assertEquals(0.0 + 14, label.minWidth(-1), 0);
 344     }
 345 
 346     @Test public void whenTextIsEmptyAndNoGraphic_computeMinWidth_ReturnsZero() {
 347         label.setPadding(new Insets(7, 7, 7, 7));
 348         label.setText(&quot;&quot;);
 349         assertEquals(0.0 + 14, label.minWidth(-1), 0);
 350     }
 351 
 352     @Test public void whenTextIsShorterThanEllipsisAndNoGraphic_computeMinWidth_ReturnsTextWidth() {
 353         label.setPadding(new Insets(7, 7, 7, 7));
 354         label.setText(&quot;.&quot;);
 355         assertTrue(label.minWidth(-1) &gt;= 0);
 356         assertEquals(skin.get_textWidth() + 14, label.minWidth(-1), 0);
 357     }
 358 
 359     @Test public void whenTextIsGreaterThanEllipsisAndNoGraphic_computeMinWidth_ReturnsEllipsisWidth() {
 360         label.setPadding(new Insets(7, 7, 7, 7));
 361         label.setText(&quot;These are the times that try men&#39;s souls.&quot;);
 362         assertTrue(label.minWidth(-1) &gt;= 0);
 363         assertEquals(skin.get_ellipsisWidth() + 14, label.minWidth(-1), 0);
 364     }
 365 
 366     @Test public void whenTextIsNullAndGraphicIsUnmanaged_computeMinWidth_ReturnsZero() {
 367         label.setPadding(new Insets(7, 7, 7, 7));
 368         Rectangle r = new Rectangle(23, 500);
 369         r.setManaged(false);
 370         label.setGraphic(r);
 371         label.setText(null);
 372         assertEquals(0.0 + 14, label.minWidth(-1), 0);
 373     }
 374 
 375     @Test public void whenTextIsEmptyAndGraphicIsUnmanaged_computeMinWidth_ReturnsZero() {
 376         label.setPadding(new Insets(7, 7, 7, 7));
 377         Rectangle r = new Rectangle(23, 500);
 378         r.setManaged(false);
 379         label.setGraphic(r);
 380         label.setText(&quot;&quot;);
 381         assertEquals(0.0 + 14, label.minWidth(-1), 0);
 382     }
 383 
 384     @Test public void whenTextIsShorterThanEllipsisAndGraphicIsUnmanaged_computeMinWidth_ReturnsTextWidth() {
 385         label.setPadding(new Insets(7, 7, 7, 7));
 386         Rectangle r = new Rectangle(23, 500);
 387         r.setManaged(false);
 388         label.setGraphic(r);
 389         label.setText(&quot;.&quot;);
 390         assertTrue(label.minWidth(-1) &gt;= 0);
 391         assertEquals(skin.get_textWidth() + 14, label.minWidth(-1), 0);
 392     }
 393 
 394     @Test public void whenTextIsGreaterThanEllipsisAndGraphicIsUnmanaged_computeMinWidth_ReturnsEllipsisWidth() {
 395         label.setPadding(new Insets(7, 7, 7, 7));
 396         Rectangle r = new Rectangle(23, 500);
 397         r.setManaged(false);
 398         label.setGraphic(r);
 399         label.setText(&quot;These are the times that try men&#39;s souls.&quot;);
 400         assertTrue(label.minWidth(-1) &gt;= 0);
 401         assertEquals(skin.get_ellipsisWidth() + 14, label.minWidth(-1), 0);
 402     }
 403 
 404     @Test public void whenTextIsNullAndGraphicIsSet_computeMinWidth_ReturnsGraphicWidth() {
 405         label.setPadding(new Insets(7, 7, 7, 7));
 406         Rectangle r = new Rectangle(23, 23);
 407         label.setGraphic(r);
 408         label.setText(null);
 409         assertTrue(label.minWidth(-1) &gt;= 0);
 410         assertEquals(23 + 14, label.minWidth(-1), 0);
 411     }
 412 
 413     @Test public void whenTextIsEmptyAndGraphicIsSet_computeMinWidth_ReturnsGraphicWidth() {
 414         label.setPadding(new Insets(7, 7, 7, 7));
 415         Rectangle r = new Rectangle(23, 23);
 416         label.setGraphic(r);
 417         label.setText(&quot;&quot;);
 418         assertTrue(label.minWidth(-1) &gt;= 0);
 419         assertEquals(23 + 14, label.minWidth(-1), 0);
 420     }
 421 
 422     @Test public void whenTextIsShorterThanEllipsisAndGraphicIsSetAndContentDisplayIsLEFT_computeMinWidth_ReturnsGraphicWidthPlusGraphicTextGapPlusTextWidth() {
 423         label.setPadding(new Insets(7, 7, 7, 7));
 424         Rectangle r = new Rectangle(23, 23);
 425         label.setGraphicTextGap(2);
 426         label.setGraphic(r);
 427         label.setContentDisplay(ContentDisplay.LEFT);
 428         label.setText(&quot;.&quot;);
 429         assertTrue(label.minWidth(-1) &gt;= 0);
 430         assertEquals(23 + 2 + skin.get_textWidth() + 14, label.minWidth(-1), 0);
 431     }
 432 
 433     @Test public void whenTextIsLongThanEllipsisAndGraphicIsSetAndContentDisplayIsLEFT_computeMinWidth_ReturnsGraphicWidthPlusGraphicTextGapPlusEllipsisWidth() {
 434         label.setPadding(new Insets(7, 7, 7, 7));
 435         Rectangle r = new Rectangle(23, 23);
 436         label.setGraphicTextGap(2);
 437         label.setGraphic(r);
 438         label.setContentDisplay(ContentDisplay.LEFT);
 439         label.setText(&quot;Wherefore art thou Romeo?&quot;);
 440         assertTrue(label.minWidth(-1) &gt;= 0);
 441         assertEquals(23 + 2 + skin.get_ellipsisWidth() + 14, label.minWidth(-1), 0);
 442     }
 443 
 444     @Test public void whenTextIsShorterThanEllipsisAndGraphicIsSetAndContentDisplayIsRIGHT_computeMinWidth_ReturnsGraphicWidthPlusGraphicTextGapPlusTextWidth() {
 445         label.setPadding(new Insets(7, 7, 7, 7));
 446         Rectangle r = new Rectangle(23, 23);
 447         label.setGraphicTextGap(2);
 448         label.setGraphic(r);
 449         label.setContentDisplay(ContentDisplay.RIGHT);
 450         label.setText(&quot;.&quot;);
 451         assertTrue(label.minWidth(-1) &gt;= 0);
 452         assertEquals(23 + 2 + skin.get_textWidth() + 14, label.minWidth(-1), 0);
 453     }
 454 
 455     @Test public void whenTextIsLongThanEllipsisAndGraphicIsSetAndContentDisplayIsRIGHT_computeMinWidth_ReturnsGraphicWidthPlusGraphicTextGapPlusEllipsisWidth() {
 456         label.setPadding(new Insets(7, 7, 7, 7));
 457         Rectangle r = new Rectangle(23, 23);
 458         label.setGraphicTextGap(2);
 459         label.setGraphic(r);
 460         label.setContentDisplay(ContentDisplay.RIGHT);
 461         label.setText(&quot;Wherefore art thou Romeo?&quot;);
 462         assertTrue(label.minWidth(-1) &gt;= 0);
 463         assertEquals(23 + 2 + skin.get_ellipsisWidth() + 14, label.minWidth(-1), 0);
 464     }
 465 
 466     @Test public void whenTextIsShorterThanEllipsisAndGraphicIsSetAndContentDisplayIsCENTER_computeMinWidth_ReturnsRightAnswer() {
 467         label.setPadding(new Insets(7, 7, 7, 7));
 468         Rectangle r = new Rectangle(23, 23);
 469         label.setGraphicTextGap(2);
 470         label.setGraphic(r);
 471         label.setContentDisplay(ContentDisplay.CENTER);
 472         label.setText(&quot;.&quot;);
 473         assertTrue(label.minWidth(-1) &gt;= 0);
 474         assertEquals(Math.max(23, skin.get_textWidth()) + 14, label.minWidth(-1), 0);
 475     }
 476 
 477     @Test public void whenTextIsLongThanEllipsisAndGraphicIsSetAndContentDisplayIsCENTER_computeMinWidth_ReturnsRightAnswer() {
 478         label.setPadding(new Insets(7, 7, 7, 7));
 479         Rectangle r = new Rectangle(23, 23);
 480         label.setGraphicTextGap(2);
 481         label.setGraphic(r);
 482         label.setContentDisplay(ContentDisplay.CENTER);
 483         label.setText(&quot;Wherefore art thou Romeo?&quot;);
 484         assertTrue(label.minWidth(-1) &gt;= 0);
 485         assertEquals(Math.max(23, skin.get_ellipsisWidth()) + 14, label.minWidth(-1), 0);
 486     }
 487 
 488     @Test public void whenTextIsShorterThanEllipsisAndGraphicIsSetAndContentDisplayIsTOP_computeMinWidth_ReturnsRightAnswer() {
 489         label.setPadding(new Insets(7, 7, 7, 7));
 490         Rectangle r = new Rectangle(23, 23);
 491         label.setGraphicTextGap(2);
 492         label.setGraphic(r);
 493         label.setContentDisplay(ContentDisplay.TOP);
 494         label.setText(&quot;.&quot;);
 495         assertTrue(label.minWidth(-1) &gt;= 0);
 496         assertEquals(Math.max(23, skin.get_textWidth()) + 14, label.minWidth(-1), 0);
 497     }
 498 
 499     @Test public void whenTextIsLongThanEllipsisAndGraphicIsSetAndContentDisplayIsTOP_computeMinWidth_ReturnsRightAnswer() {
 500         label.setPadding(new Insets(7, 7, 7, 7));
 501         Rectangle r = new Rectangle(23, 23);
 502         label.setGraphicTextGap(2);
 503         label.setGraphic(r);
 504         label.setContentDisplay(ContentDisplay.TOP);
 505         label.setText(&quot;Wherefore art thou Romeo?&quot;);
 506         assertTrue(label.minWidth(-1) &gt;= 0);
 507         assertEquals(Math.max(23, skin.get_ellipsisWidth()) + 14, label.minWidth(-1), 0);
 508     }
 509 
 510     @Test public void whenTextIsShorterThanEllipsisAndGraphicIsSetAndContentDisplayIsBOTTOM_computeMinWidth_ReturnsRightAnswer() {
 511         label.setPadding(new Insets(7, 7, 7, 7));
 512         Rectangle r = new Rectangle(23, 23);
 513         label.setGraphicTextGap(2);
 514         label.setGraphic(r);
 515         label.setContentDisplay(ContentDisplay.BOTTOM);
 516         label.setText(&quot;.&quot;);
 517         assertTrue(label.minWidth(-1) &gt;= 0);
 518         assertEquals(Math.max(23, skin.get_textWidth()) + 14, label.minWidth(-1), 0);
 519     }
 520 
 521     @Test public void whenTextIsLongThanEllipsisAndGraphicIsSetAndContentDisplayIsBOTTOM_computeMinWidth_ReturnsRightAnswer() {
 522         label.setPadding(new Insets(7, 7, 7, 7));
 523         Rectangle r = new Rectangle(23, 23);
 524         label.setGraphicTextGap(2);
 525         label.setGraphic(r);
 526         label.setContentDisplay(ContentDisplay.BOTTOM);
 527         label.setText(&quot;Wherefore art thou Romeo?&quot;);
 528         assertTrue(label.minWidth(-1) &gt;= 0);
 529         assertEquals(Math.max(23, skin.get_ellipsisWidth()) + 14, label.minWidth(-1), 0);
 530     }
 531 
 532     @Test public void whenTextIsShorterThanEllipsisAndGraphicIsSetAndContentDisplayIsGRAPHIC_ONLY_computeMinWidth_ReturnsRightAnswer() {
 533         label.setPadding(new Insets(7, 7, 7, 7));
 534         Rectangle r = new Rectangle(3, 3);
 535         label.setGraphicTextGap(2);
 536         label.setGraphic(r);
 537         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
 538         label.setText(&quot;.&quot;);
 539         assertTrue(label.minWidth(-1) &gt;= 0);
 540         assertEquals(3 + 14, label.minWidth(-1), 0);
 541     }
 542 
 543     @Test public void whenTextIsLongThanEllipsisAndGraphicIsSetAndContentDisplayIsGRAPHIC_ONLY_computeMinWidth_ReturnsRightAnswer() {
 544         label.setPadding(new Insets(7, 7, 7, 7));
 545         Rectangle r = new Rectangle(3, 3);
 546         label.setGraphicTextGap(2);
 547         label.setGraphic(r);
 548         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
 549         label.setText(&quot;Wherefore art thou Romeo?&quot;);
 550         assertTrue(label.minWidth(-1) &gt;= 0);
 551         assertEquals(3 + 14, label.minWidth(-1), 0);
 552     }
 553 
 554     @Test public void whenTextIsShorterThanEllipsisAndGraphicIsSetAndContentDisplayIsTEXT_ONLY_computeMinWidth_ReturnsRightAnswer() {
 555         label.setPadding(new Insets(7, 7, 7, 7));
 556         Rectangle r = new Rectangle(230, 230);
 557         label.setGraphicTextGap(2);
 558         label.setGraphic(r);
 559         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
 560         label.setText(&quot;.&quot;);
 561         assertTrue(label.minWidth(-1) &gt;= 0);
 562         assertEquals(skin.get_textWidth() + 14, label.minWidth(-1), 0);
 563     }
 564 
 565     @Test public void whenTextIsLongThanEllipsisAndGraphicIsSetAndContentDisplayIsTEXT_ONLY_computeMinWidth_ReturnsRightAnswer() {
 566         label.setPadding(new Insets(7, 7, 7, 7));
 567         Rectangle r = new Rectangle(230, 230);
 568         label.setGraphicTextGap(2);
 569         label.setGraphic(r);
 570         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
 571         label.setText(&quot;Wherefore art thou Romeo?&quot;);
 572         assertTrue(label.minWidth(-1) &gt;= 0);
 573         assertEquals(skin.get_ellipsisWidth() + 14, label.minWidth(-1), 0);
 574     }
 575 
 576     /****************************************************************************
 577      *                                                                          *
 578      * Tests for minHeight                                                      *
 579      *                                                                          *
 580      ***************************************************************************/
 581 
 582     @Test public void whenTextIsNullAndNoGraphic_computeMinHeight_ReturnsSingleLineStringHeight() {
 583         label.setText(null);
 584         label.setPadding(new Insets(7, 7, 7, 7));
 585         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 586         assertEquals(lineHeight + 14, label.minHeight(-1), 0);
 587     }
 588 
 589     @Test public void whenTextIsEmptyAndNoGraphic_computeMinHeight_ReturnsSingleLineStringHeight() {
 590         label.setText(&quot;&quot;);
 591         label.setPadding(new Insets(7, 7, 7, 7));
 592         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 593         assertEquals(lineHeight + 14, label.minHeight(-1), 0);
 594     }
 595 
 596     @Test public void whenTextIsSetAndNoGraphic_computeMinHeight_ReturnsSingleLineStringHeight() {
 597         label.setText(&quot;Howdy Pardner&quot;);
 598         label.setPadding(new Insets(7, 7, 7, 7));
 599         assertTrue(label.minHeight(-1) &gt;= 0);
 600         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 601         assertEquals(lineHeight + 14, label.minHeight(-1), 0);
 602     }
 603 
 604     @Test public void whenTextIsNullAndUnmanagedGraphic_computeMinHeight_ReturnsSingleLineStringHeight() {
 605         label.setText(null);
 606         label.setPadding(new Insets(7, 7, 7, 7));
 607         Rectangle r = new Rectangle(23, 500);
 608         r.setManaged(false);
 609         label.setGraphic(r);
 610         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 611         assertEquals(lineHeight + 14, label.minHeight(-1), 0);
 612     }
 613 
 614     @Test public void whenTextIsEmptyAndUnmanagedGraphic_computeMinHeight_ReturnsSingleLineStringHeight() {
 615         label.setText(&quot;&quot;);
 616         label.setPadding(new Insets(7, 7, 7, 7));
 617         Rectangle r = new Rectangle(23, 500);
 618         r.setManaged(false);
 619         label.setGraphic(r);
 620         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 621         assertEquals(lineHeight + 14, label.minHeight(-1), 0);
 622     }
 623 
 624     @Test public void whenTextIsSetAndUnmanagedGraphic_computeMinHeight_ReturnsSingleLineStringHeight() {
 625         label.setText(&quot;Howdy Pardner&quot;);
 626         label.setPadding(new Insets(7, 7, 7, 7));
 627         Rectangle r = new Rectangle(23, 500);
 628         r.setManaged(false);
 629         label.setGraphic(r);
 630         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 631         assertTrue(label.minHeight(-1) &gt;= 0);
 632         assertEquals(lineHeight + 14, label.minHeight(-1), 0);
 633     }
 634 
 635     @Test public void whenTextIsNullAndGraphicIsSetWithTOPContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 636         label.setText(null);
 637         label.setPadding(new Insets(7, 7, 7, 7));
 638         Rectangle r = new Rectangle(23, 23);
 639         label.setGraphicTextGap(2);
 640         label.setGraphic(r);
 641         label.setContentDisplay(ContentDisplay.TOP);
 642         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 643         assertEquals(23 + lineHeight + 2 + 14, label.minHeight(-1), 0);
 644     }
 645 
 646     @Test public void whenTextIsEmptyAndGraphicIsSetWithTOPContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 647         label.setText(&quot;&quot;);
 648         label.setPadding(new Insets(7, 7, 7, 7));
 649         Rectangle r = new Rectangle(23, 23);
 650         label.setGraphicTextGap(2);
 651         label.setGraphic(r);
 652         label.setContentDisplay(ContentDisplay.TOP);
 653         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 654         assertEquals(23 + lineHeight + 2 + 14, label.minHeight(-1), 0);
 655     }
 656 
 657     @Test public void whenTextIsSetAndGraphicIsSetWithTOPContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 658         label.setText(&quot;For crying in the mud&quot;);
 659         label.setPadding(new Insets(7, 7, 7, 7));
 660         Rectangle r = new Rectangle(23, 23);
 661         label.setGraphic(r);
 662         label.setGraphicTextGap(2);
 663         label.setContentDisplay(ContentDisplay.TOP);
 664         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 665         assertEquals(23 + lineHeight + 2 + 14, label.minHeight(-1), 0);
 666     }
 667 
 668     @Test public void whenTextIsNullAndGraphicIsSetWithRIGHTContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 669         label.setText(null);
 670         label.setPadding(new Insets(7, 7, 7, 7));
 671         Rectangle r = new Rectangle(23, 23);
 672         label.setGraphic(r);
 673         label.setContentDisplay(ContentDisplay.RIGHT);
 674         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 675         assertEquals(Math.max(23, lineHeight) + 14, label.minHeight(-1), 0);
 676     }
 677 
 678     @Test public void whenTextIsEmptyAndGraphicIsSetWithRIGHTContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 679         label.setText(&quot;&quot;);
 680         label.setPadding(new Insets(7, 7, 7, 7));
 681         Rectangle r = new Rectangle(23, 23);
 682         label.setGraphic(r);
 683         label.setContentDisplay(ContentDisplay.RIGHT);
 684         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 685         assertEquals(Math.max(23, lineHeight) + 14, label.minHeight(-1), 0);
 686     }
 687 
 688     @Test public void whenTextIsSetAndGraphicIsSetWithRIGHTContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 689         label.setText(&quot;For crying in the mud&quot;);
 690         label.setPadding(new Insets(7, 7, 7, 7));
 691         Rectangle r = new Rectangle(23, 23);
 692         label.setGraphic(r);
 693         label.setContentDisplay(ContentDisplay.RIGHT);
 694         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 695         assertEquals(Math.max(23, lineHeight) + 14, label.minHeight(-1), 0);
 696     }
 697 
 698     @Test public void whenTextIsNullAndGraphicIsSetWithBOTTOMContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 699         label.setText(null);
 700         label.setPadding(new Insets(7, 7, 7, 7));
 701         Rectangle r = new Rectangle(23, 23);
 702         label.setGraphicTextGap(2);
 703         label.setGraphic(r);
 704         label.setContentDisplay(ContentDisplay.BOTTOM);
 705         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 706         assertEquals(23 + lineHeight + 2 + 14, label.minHeight(-1), 0);
 707     }
 708 
 709     @Test public void whenTextIsEmptyAndGraphicIsSetWithBOTTOMContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 710         label.setText(&quot;&quot;);
 711         label.setPadding(new Insets(7, 7, 7, 7));
 712         Rectangle r = new Rectangle(23, 23);
 713         label.setGraphicTextGap(2);
 714         label.setGraphic(r);
 715         label.setContentDisplay(ContentDisplay.BOTTOM);
 716         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 717         assertEquals(23 + lineHeight + 2 + 14, label.minHeight(-1), 0);
 718     }
 719 
 720     @Test public void whenTextIsSetAndGraphicIsSetWithBOTTOMContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 721         label.setText(&quot;For crying in the mud&quot;);
 722         label.setPadding(new Insets(7, 7, 7, 7));
 723         Rectangle r = new Rectangle(23, 23);
 724         label.setGraphic(r);
 725         label.setGraphicTextGap(2);
 726         label.setContentDisplay(ContentDisplay.BOTTOM);
 727         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 728         assertEquals(23 + lineHeight + 2 + 14, label.minHeight(-1), 0);
 729     }
 730 
 731     @Test public void whenTextIsNullAndGraphicIsSetWithLEFTContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 732         label.setText(null);
 733         label.setPadding(new Insets(7, 7, 7, 7));
 734         Rectangle r = new Rectangle(23, 23);
 735         label.setGraphic(r);
 736         label.setContentDisplay(ContentDisplay.LEFT);
 737         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 738         assertEquals(Math.max(23, lineHeight) + 14, label.minHeight(-1), 0);
 739     }
 740 
 741     @Test public void whenTextIsEmptyAndGraphicIsSetWithLEFTContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 742         label.setText(&quot;&quot;);
 743         label.setPadding(new Insets(7, 7, 7, 7));
 744         Rectangle r = new Rectangle(23, 23);
 745         label.setGraphic(r);
 746         label.setContentDisplay(ContentDisplay.LEFT);
 747         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 748         assertEquals(Math.max(23, lineHeight) + 14, label.minHeight(-1), 0);
 749     }
 750 
 751     @Test public void whenTextIsSetAndGraphicIsSetWithLEFTContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 752         label.setText(&quot;For crying in the mud&quot;);
 753         label.setPadding(new Insets(7, 7, 7, 7));
 754         Rectangle r = new Rectangle(23, 23);
 755         label.setGraphic(r);
 756         label.setContentDisplay(ContentDisplay.LEFT);
 757         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 758         assertEquals(Math.max(23, lineHeight) + 14, label.minHeight(-1), 0);
 759     }
 760 
 761     @Test public void whenTextIsNullAndGraphicIsSetWithCENTERContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 762         label.setText(null);
 763         label.setPadding(new Insets(7, 7, 7, 7));
 764         Rectangle r = new Rectangle(23, 23);
 765         label.setGraphic(r);
 766         label.setContentDisplay(ContentDisplay.CENTER);
 767         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 768         assertEquals(Math.max(23, lineHeight) + 14, label.minHeight(-1), 0);
 769     }
 770 
 771     @Test public void whenTextIsEmptyAndGraphicIsSetWithCENTERContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 772         label.setText(&quot;&quot;);
 773         label.setPadding(new Insets(7, 7, 7, 7));
 774         Rectangle r = new Rectangle(23, 23);
 775         label.setGraphic(r);
 776         label.setContentDisplay(ContentDisplay.CENTER);
 777         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 778         assertEquals(Math.max(23, lineHeight) + 14, label.minHeight(-1), 0);
 779     }
 780 
 781     @Test public void whenTextIsSetAndGraphicIsSetWithCENTERContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 782         label.setText(&quot;For crying in the mud&quot;);
 783         label.setPadding(new Insets(7, 7, 7, 7));
 784         Rectangle r = new Rectangle(23, 23);
 785         label.setGraphic(r);
 786         label.setContentDisplay(ContentDisplay.CENTER);
 787         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 788         assertEquals(Math.max(23, lineHeight) + 14, label.minHeight(-1), 0);
 789     }
 790 
 791     @Test public void whenTextIsNullAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 792         label.setText(null);
 793         label.setPadding(new Insets(7, 7, 7, 7));
 794         Rectangle r = new Rectangle(23, 23);
 795         label.setGraphic(r);
 796         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
 797         assertEquals(23 + 14, label.minHeight(-1), 0);
 798     }
 799 
 800     @Test public void whenTextIsEmptyAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 801         label.setText(&quot;&quot;);
 802         label.setPadding(new Insets(7, 7, 7, 7));
 803         Rectangle r = new Rectangle(23, 23);
 804         label.setGraphic(r);
 805         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
 806         assertEquals(23 + 14, label.minHeight(-1), 0);
 807     }
 808 
 809     @Test public void whenTextIsSetAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 810         label.setText(&quot;For crying in the mud&quot;);
 811         label.setPadding(new Insets(7, 7, 7, 7));
 812         Rectangle r = new Rectangle(23, 23);
 813         label.setGraphic(r);
 814         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
 815         assertEquals(23 + 14, label.minHeight(-1), 0);
 816     }
 817 
 818     @Test public void whenTextIsNullAndGraphicIsSetWithTEXT_ONLYContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 819         label.setText(null);
 820         label.setPadding(new Insets(7, 7, 7, 7));
 821         Rectangle r = new Rectangle(23, 23);
 822         label.setGraphic(r);
 823         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
 824         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 825         assertEquals(lineHeight + 14, label.minHeight(-1), 0);
 826     }
 827 
 828     @Test public void whenTextIsEmptyAndGraphicIsSetWithTEXT_ONLYContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 829         label.setText(&quot;&quot;);
 830         label.setPadding(new Insets(7, 7, 7, 7));
 831         Rectangle r = new Rectangle(23, 23);
 832         label.setGraphic(r);
 833         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
 834         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 835         assertEquals(lineHeight + 14, label.minHeight(-1), 0);
 836     }
 837 
 838     @Test public void whenTextIsSetAndGraphicIsSetWithTEXT_ONLYContentDisplay_computeMinHeight_ReturnsRightAnswer() {
 839         label.setText(&quot;For crying in the mud&quot;);
 840         label.setPadding(new Insets(7, 7, 7, 7));
 841         Rectangle r = new Rectangle(23, 23);
 842         label.setGraphic(r);
 843         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
 844         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
 845         assertEquals(lineHeight + 14, label.minHeight(-1), 0);
 846     }
 847 
 848     /****************************************************************************
 849      *                                                                          *
 850      * Tests for prefWidth                                                      *
 851      *                                                                          *
 852      ***************************************************************************/
 853 
 854     @Test public void whenTextIsNullAndNoGraphic_computePrefWidth_ReturnsPadding() {
 855         label.setText(null);
 856         label.setPadding(new Insets(7, 7, 7, 7));
 857         assertEquals(14, label.prefWidth(-1), 0);
 858     }
 859 
 860     @Test public void whenTextIsEmptyAndNoGraphic_computePrefWidth_ReturnsPadding() {
 861         label.setText(&quot;&quot;);
 862         label.setPadding(new Insets(7, 7, 7, 7));
 863         assertEquals(14, label.prefWidth(-1), 0);
 864     }
 865 
 866     @Test public void whenTextIsSetAndNoGraphic_computePrefWidth_ReturnsTextWidthPlusPadding() {
 867         label.setText(&quot;Lollipop&quot;);
 868         label.setPadding(new Insets(7, 7, 7, 7));
 869         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;Lollipop&quot;, 0);
 870         assertEquals(14 + textWidth, label.prefWidth(-1), 0);
 871     }
 872 
 873     @Test public void whenTextIsNullAndUnmanagedGraphic_computePrefWidth_ReturnsPadding() {
 874         label.setText(null);
 875         Rectangle r = new Rectangle(0, 0, 50, 50);
 876         r.setManaged(false);
 877         label.setGraphic(r);
 878         label.setPadding(new Insets(7, 7, 7, 7));
 879         assertEquals(14, label.prefWidth(-1), 0);
 880     }
 881 
 882     @Test public void whenTextIsEmptyAndUnmanagedGraphic_computePrefWidth_ReturnsPadding() {
 883         label.setText(&quot;&quot;);
 884         Rectangle r = new Rectangle(0, 0, 50, 50);
 885         r.setManaged(false);
 886         label.setGraphic(r);
 887         label.setPadding(new Insets(7, 7, 7, 7));
 888         assertEquals(14, label.prefWidth(-1), 0);
 889     }
 890 
 891     @Test public void whenTextIsSetAndUnmanagedGraphic_computePrefWidth_ReturnsTextWidthPlusPadding() {
 892         label.setText(&quot;Lollipop&quot;);
 893         Rectangle r = new Rectangle(0, 0, 50, 50);
 894         r.setManaged(false);
 895         label.setGraphic(r);
 896         label.setPadding(new Insets(7, 7, 7, 7));
 897         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;Lollipop&quot;, 0);
 898         assertEquals(14 + textWidth, label.prefWidth(-1), 0);
 899     }
 900 
 901     @Test public void whenTextIsNullAndGraphicIsSetWithTOPContentDisplay_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
 902         label.setText(null);
 903         label.setGraphic(new Rectangle(0, 0, 20, 20));
 904         label.setGraphicTextGap(6.5);
 905         label.setContentDisplay(ContentDisplay.TOP);
 906         label.setPadding(new Insets(7, 7, 7, 7));
 907         assertEquals(14 + 20, label.prefWidth(-1), 0);
 908     }
 909 
 910     @Test public void whenTextIsEmptyAndGraphicIsSetWithTOPContentDisplay_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
 911         label.setText(&quot;&quot;);
 912         label.setGraphic(new Rectangle(0, 0, 20, 20));
 913         label.setGraphicTextGap(6.5);
 914         label.setContentDisplay(ContentDisplay.TOP);
 915         label.setPadding(new Insets(7, 7, 7, 7));
 916         assertEquals(14 + 20, label.prefWidth(-1), 0);
 917     }
 918 
 919     @Test public void whenTextIsSetAndGraphicIsSetWithTOPContentDisplayAndGraphicIsWider_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
 920         label.setText(&quot;Lollipop&quot;);
 921         label.setGraphic(new Rectangle(0, 0, 200, 20));
 922         label.setGraphicTextGap(6.5);
 923         label.setContentDisplay(ContentDisplay.TOP);
 924         label.setPadding(new Insets(7, 7, 7, 7));
 925         assertEquals(14 + 200, label.prefWidth(-1), 0);
 926     }
 927 
 928     @Test public void whenTextIsSetAndGraphicIsSetWithTOPContentDisplayAndTextIsWider_computePrefWidth_ReturnsTextWidthPlusPadding() {
 929         label.setText(&quot;This is the right place&quot;);
 930         label.setGraphic(new Rectangle(0, 0, 20, 20));
 931         label.setGraphicTextGap(6.5);
 932         label.setContentDisplay(ContentDisplay.TOP);
 933         label.setPadding(new Insets(7, 7, 7, 7));
 934         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;This is the right place&quot;, 0);
 935         assertEquals(14 + textWidth, label.prefWidth(-1), 0);
 936     }
 937 
 938     @Test public void whenTextIsNullAndGraphicIsSetWithRIGHTContentDisplay_computePrefWidth_ReturnsGraphicPlusPaddingNotIncludingGap() {
 939         label.setText(null);
 940         label.setGraphic(new Rectangle(0, 0, 20, 20));
 941         label.setGraphicTextGap(6.5);
 942         label.setContentDisplay(ContentDisplay.RIGHT);
 943         label.setPadding(new Insets(7, 7, 7, 7));
 944         assertEquals(20 + 14, label.prefWidth(-1), 0);
 945     }
 946 
 947     @Test public void whenTextIsEmptyAndGraphicIsSetWithRIGHTContentDisplay_computePrefWidth_ReturnsGraphicPlusPaddingNotIncludingGap() {
 948         label.setText(&quot;&quot;);
 949         label.setGraphic(new Rectangle(0, 0, 20, 20));
 950         label.setGraphicTextGap(6.5);
 951         label.setContentDisplay(ContentDisplay.RIGHT);
 952         label.setPadding(new Insets(7, 7, 7, 7));
 953         assertEquals(20 + 14, label.prefWidth(-1), 0);
 954     }
 955 
 956     @Test public void whenTextIsSetAndGraphicIsSetWithRIGHTContentDisplay_computePrefWidth_ReturnsTextWidthPlusGraphicWidthPlusGapPlusPadding() {
 957         label.setText(&quot;Howdy&quot;);
 958         label.setGraphic(new Rectangle(0, 0, 20, 20));
 959         label.setGraphicTextGap(6.5);
 960         label.setContentDisplay(ContentDisplay.RIGHT);
 961         label.setPadding(new Insets(7, 7, 7, 7));
 962         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;Howdy&quot;, 0);
 963         assertEquals(14 + textWidth + 6.5 + 20, label.prefWidth(-1), 0);
 964     }
 965 
 966     @Test public void whenTextIsNullAndGraphicIsSetWithBOTTOMContentDisplay_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
 967         label.setText(null);
 968         label.setGraphic(new Rectangle(0, 0, 20, 20));
 969         label.setGraphicTextGap(6.5);
 970         label.setContentDisplay(ContentDisplay.BOTTOM);
 971         label.setPadding(new Insets(7, 7, 7, 7));
 972         assertEquals(14 + 20, label.prefWidth(-1), 0);
 973     }
 974 
 975     @Test public void whenTextIsEmptyAndGraphicIsSetWithBOTTOMContentDisplay_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
 976         label.setText(null);
 977         label.setGraphic(new Rectangle(0, 0, 20, 20));
 978         label.setGraphicTextGap(6.5);
 979         label.setContentDisplay(ContentDisplay.BOTTOM);
 980         label.setPadding(new Insets(7, 7, 7, 7));
 981         assertEquals(14 + 20, label.prefWidth(-1), 0);
 982     }
 983 
 984     @Test public void whenTextIsSetAndGraphicIsSetWithBOTTOMContentDisplayAndGraphicIsWider_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
 985         label.setText(&quot;Lollipop&quot;);
 986         label.setGraphic(new Rectangle(0, 0, 200, 20));
 987         label.setGraphicTextGap(6.5);
 988         label.setContentDisplay(ContentDisplay.BOTTOM);
 989         label.setPadding(new Insets(7, 7, 7, 7));
 990         assertEquals(14 + 200, label.prefWidth(-1), 0);
 991     }
 992 
 993     @Test public void whenTextIsSetAndGraphicIsSetWithBOTTOMContentDisplayAndTextIsWider_computePrefWidth_ReturnsTextWidthPlusPadding() {
 994         label.setText(&quot;This is the right place&quot;);
 995         label.setGraphic(new Rectangle(0, 0, 20, 20));
 996         label.setGraphicTextGap(6.5);
 997         label.setContentDisplay(ContentDisplay.BOTTOM);
 998         label.setPadding(new Insets(7, 7, 7, 7));
 999         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;This is the right place&quot;, 0);
1000         assertEquals(14 + textWidth, label.prefWidth(-1), 0);
1001     }
1002 
1003     @Test public void whenTextIsNullAndGraphicIsSetWithLEFTContentDisplay_computePrefWidth_ReturnsGraphicPlusPaddingNotIncludingGap() {
1004         label.setText(null);
1005         label.setGraphic(new Rectangle(0, 0, 20, 20));
1006         label.setGraphicTextGap(6.5);
1007         label.setContentDisplay(ContentDisplay.LEFT);
1008         label.setPadding(new Insets(7, 7, 7, 7));
1009         assertEquals(20 + 14, label.prefWidth(-1), 0);
1010     }
1011 
1012     @Test public void whenTextIsEmptyAndGraphicIsSetWithLEFTContentDisplay_computePrefWidth_ReturnsGraphicPlusPaddingNotIncludingGap() {
1013         label.setText(&quot;&quot;);
1014         label.setGraphic(new Rectangle(0, 0, 20, 20));
1015         label.setGraphicTextGap(6.5);
1016         label.setContentDisplay(ContentDisplay.LEFT);
1017         label.setPadding(new Insets(7, 7, 7, 7));
1018         assertEquals(20 + 14, label.prefWidth(-1), 0);
1019     }
1020 
1021     @Test public void whenTextIsSetAndGraphicIsSetWithLEFTContentDisplay_computePrefWidth_ReturnsTextWidthPlusGraphicWidthPlusGapPlusPadding() {
1022         label.setText(&quot;Howdy&quot;);
1023         label.setGraphic(new Rectangle(0, 0, 20, 20));
1024         label.setGraphicTextGap(6.5);
1025         label.setContentDisplay(ContentDisplay.LEFT);
1026         label.setPadding(new Insets(7, 7, 7, 7));
1027         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;Howdy&quot;, 0);
1028         assertEquals(14 + textWidth + 6.5 + 20, label.prefWidth(-1), 0);
1029     }
1030 
1031     @Test public void whenTextIsNullAndGraphicIsSetWithCENTERContentDisplay_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
1032         label.setText(null);
1033         label.setGraphic(new Rectangle(0, 0, 20, 20));
1034         label.setGraphicTextGap(6.5);
1035         label.setContentDisplay(ContentDisplay.CENTER);
1036         label.setPadding(new Insets(7, 7, 7, 7));
1037         assertEquals(14 + 20, label.prefWidth(-1), 0);
1038     }
1039 
1040     @Test public void whenTextIsEmptyAndGraphicIsSetWithCENTERContentDisplay_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
1041         label.setText(&quot;&quot;);
1042         label.setGraphic(new Rectangle(0, 0, 20, 20));
1043         label.setGraphicTextGap(6.5);
1044         label.setContentDisplay(ContentDisplay.CENTER);
1045         label.setPadding(new Insets(7, 7, 7, 7));
1046         assertEquals(14 + 20, label.prefWidth(-1), 0);
1047     }
1048 
1049     @Test public void whenTextIsSetAndGraphicIsSetWithCENTERContentDisplayAndGraphicIsWider_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
1050         label.setText(&quot;Lollipop&quot;);
1051         label.setGraphic(new Rectangle(0, 0, 200, 20));
1052         label.setGraphicTextGap(6.5);
1053         label.setContentDisplay(ContentDisplay.CENTER);
1054         label.setPadding(new Insets(7, 7, 7, 7));
1055         assertEquals(14 + 200, label.prefWidth(-1), 0);
1056     }
1057 
1058     @Test public void whenTextIsSetAndGraphicIsSetWithCENTERContentDisplayAndTextIsWider_computePrefWidth_ReturnsTextWidthPlusPadding() {
1059         label.setText(&quot;This is the right place&quot;);
1060         label.setGraphic(new Rectangle(0, 0, 20, 20));
1061         label.setGraphicTextGap(6.5);
1062         label.setContentDisplay(ContentDisplay.CENTER);
1063         label.setPadding(new Insets(7, 7, 7, 7));
1064         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;This is the right place&quot;, 0);
1065         assertEquals(14 + textWidth, label.prefWidth(-1), 0);
1066     }
1067 
1068     @Test public void whenTextIsNullAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
1069         label.setText(null);
1070         label.setGraphic(new Rectangle(0, 0, 20, 20));
1071         label.setGraphicTextGap(6.5);
1072         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1073         label.setPadding(new Insets(7, 7, 7, 7));
1074         assertEquals(14 + 20, label.prefWidth(-1), 0);
1075     }
1076 
1077     @Test public void whenTextIsEmptyAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
1078         label.setText(&quot;&quot;);
1079         label.setGraphic(new Rectangle(0, 0, 20, 20));
1080         label.setGraphicTextGap(6.5);
1081         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1082         label.setPadding(new Insets(7, 7, 7, 7));
1083         assertEquals(14 + 20, label.prefWidth(-1), 0);
1084     }
1085 
1086     @Test public void whenTextIsSetAndGraphicIsSetWithGRAPHIC_ONLYContentDisplayAndGraphicIsWider_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
1087         label.setText(&quot;Howdy&quot;);
1088         label.setGraphic(new Rectangle(0, 0, 200, 20));
1089         label.setGraphicTextGap(6.5);
1090         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1091         label.setPadding(new Insets(7, 7, 7, 7));
1092         assertEquals(14 + 200, label.prefWidth(-1), 0);
1093     }
1094 
1095     @Test public void whenTextIsSetAndGraphicIsSetWithGRAPHIC_ONLYContentDisplayAndTextIsWider_computePrefWidth_ReturnsGraphicWidthPlusPadding() {
1096         label.setText(&quot;Tally ho, off to the races&quot;);
1097         label.setGraphic(new Rectangle(0, 0, 20, 20));
1098         label.setGraphicTextGap(6.5);
1099         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1100         label.setPadding(new Insets(7, 7, 7, 7));
1101         assertEquals(14 + 20, label.prefWidth(-1), 0);
1102     }
1103 
1104     // TODO should this include the gap??
1105     @Test public void whenTextIsNullAndGraphicIsSetWithTEXT_ONLYContentDisplay_computePrefWidth_ReturnsPadding() {
1106         label.setText(null);
1107         label.setGraphic(new Rectangle(0, 0, 20, 20));
1108         label.setGraphicTextGap(6.5);
1109         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1110         label.setPadding(new Insets(7, 7, 7, 7));
1111         assertEquals(14, label.prefWidth(-1), 0);
1112     }
1113 
1114     @Test public void whenTextIsEmptyAndGraphicIsSetWithTEXT_ONLYContentDisplay_computePrefWidth_ReturnsPadding() {
1115         label.setText(&quot;&quot;);
1116         label.setGraphic(new Rectangle(0, 0, 20, 20));
1117         label.setGraphicTextGap(6.5);
1118         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1119         label.setPadding(new Insets(7, 7, 7, 7));
1120         assertEquals(14, label.prefWidth(-1), 0);
1121     }
1122 
1123     // TODO should this include the gap? I guess not, otherwise our gap would have to default to 0
1124     @Test public void whenTextIsSetAndGraphicIsSetWithTEXT_ONLYContentDisplay_computePrefWidth_ReturnsTextWidthPlusPadding() {
1125         label.setText(&quot;Yippee Skippee&quot;);
1126         label.setGraphic(new Rectangle(0, 0, 20, 20));
1127         label.setGraphicTextGap(6.5);
1128         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1129         label.setPadding(new Insets(7, 7, 7, 7));
1130         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;Yippee Skippee&quot;, 0);
1131         assertEquals(14 + textWidth, label.prefWidth(-1), 0);
1132     }
1133 
1134     /****************************************************************************
1135      *                                                                          *
1136      * Tests for prefHeight                                                     *
1137      *                                                                          *
1138      ***************************************************************************/
1139 
1140     @Test public void whenTextHasNewlines_computePrefHeight_IncludesTheMultipleLinesInThePrefHeight() {
1141         label.setText(&quot;This\nis a test\nof the emergency\nbroadcast system.\nThis is only a test&quot;);
1142         label.setPadding(new Insets(0, 0, 0, 0));
1143         final double singleLineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1144         final double height = label.prefHeight(-1);
1145         assertTrue(height &gt;= singleLineHeight * 5);
1146     }
1147 
<a name="3" id="anc3"></a>



















1148     @Test public void whenTextHasNewlinesAfterPreviousComputationOf_computePrefHeight_IncludesTheMultipleLinesInThePrefHeight() {
1149         label.setText(&quot;This is a test&quot;);
1150         final double oldPrefHeight = label.prefHeight(-1);
1151         label.setText(&quot;This\nis a test\nof the emergency\nbroadcast system.\nThis is only a test&quot;);
1152         final double newPrefHeight = label.prefHeight(-1);
1153         assertTrue(oldPrefHeight != newPrefHeight);
1154     }
1155 
1156     @Test public void whenTextIsNullAndNoGraphic_computePrefHeight_ReturnsSingleLineStringHeightPlusPadding() {
1157         label.setText(null);
1158         label.setPadding(new Insets(7, 7, 7, 7));
1159         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1160         assertEquals(14 + lineHeight, label.prefHeight(-1), 0);
1161     }
1162 
1163     @Test public void whenTextIsEmptyAndNoGraphic_computePrefHeight_ReturnsSingleLineStringHeightPlusPadding() {
1164         label.setText(&quot;&quot;);
1165         label.setPadding(new Insets(7, 7, 7, 7));
1166         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1167         assertEquals(14 + lineHeight, label.prefHeight(-1), 0);
1168     }
1169 
1170     @Test public void whenTextIsSetAndNoGraphic_computePrefHeight_ReturnsSingleLineStringHeightPlusPadding() {
1171         label.setText(&quot;Howdy Pardner&quot;);
1172         label.setPadding(new Insets(7, 7, 7, 7));
1173         assertTrue(label.prefHeight(-1) &gt;= 0);
1174         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1175         assertEquals(14 + lineHeight, label.prefHeight(-1), 0);
1176     }
1177 
1178     @Test public void whenTextIsNullAndUnmanagedGraphic_computePrefHeight_ReturnsSingleLineStringHeightPlusPadding() {
1179         label.setText(null);
1180         label.setPadding(new Insets(7, 7, 7, 7));
1181         Rectangle r = new Rectangle(23, 500);
1182         r.setManaged(false);
1183         label.setGraphic(r);
1184         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1185         assertEquals(14 + lineHeight, label.prefHeight(-1), 0);
1186     }
1187 
1188     @Test public void whenTextIsEmptyAndUnmanagedGraphic_computePrefHeight_ReturnsSingleLineStringHeightPlusPadding() {
1189         label.setText(&quot;&quot;);
1190         label.setPadding(new Insets(7, 7, 7, 7));
1191         Rectangle r = new Rectangle(23, 500);
1192         r.setManaged(false);
1193         label.setGraphic(r);
1194         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1195         assertEquals(14 + lineHeight, label.prefHeight(-1), 0);
1196     }
1197 
1198     @Test public void whenTextIsSetAndUnmanagedGraphic_computePrefHeight_ReturnsSingleLineStringHeightPlusPadding() {
1199         label.setText(&quot;Howdy Pardner&quot;);
1200         label.setPadding(new Insets(7, 7, 7, 7));
1201         Rectangle r = new Rectangle(23, 500);
1202         r.setManaged(false);
1203         label.setGraphic(r);
1204         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1205         assertTrue(label.prefHeight(-1) &gt;= 0);
1206         assertEquals(14 + lineHeight, label.prefHeight(-1), 0);
1207     }
1208 
1209     @Test public void whenTextIsNullAndGraphicIsSetWithTOPContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1210         label.setText(null);
1211         label.setPadding(new Insets(7, 7, 7, 7));
1212         Rectangle r = new Rectangle(23, 23);
1213         label.setGraphicTextGap(2);
1214         label.setGraphic(r);
1215         label.setContentDisplay(ContentDisplay.TOP);
1216         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1217         assertEquals(14 + 23 + lineHeight + 2, label.prefHeight(-1), 0);
1218     }
1219 
1220     @Test public void whenTextIsEmptyAndGraphicIsSetWithTOPContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1221         label.setText(&quot;&quot;);
1222         label.setPadding(new Insets(7, 7, 7, 7));
1223         Rectangle r = new Rectangle(23, 23);
1224         label.setGraphicTextGap(2);
1225         label.setGraphic(r);
1226         label.setContentDisplay(ContentDisplay.TOP);
1227         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1228         assertEquals(14 + 23 + lineHeight + 2, label.prefHeight(-1), 0);
1229     }
1230 
1231     @Test public void whenTextIsSetAndGraphicIsSetWithTOPContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1232         label.setText(&quot;For crying in the mud&quot;);
1233         label.setPadding(new Insets(7, 7, 7, 7));
1234         Rectangle r = new Rectangle(23, 23);
1235         label.setGraphic(r);
1236         label.setGraphicTextGap(2);
1237         label.setContentDisplay(ContentDisplay.TOP);
1238         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1239         assertEquals(14 + 23 + lineHeight + 2, label.prefHeight(-1), 0);
1240     }
1241 
1242     @Test public void whenTextIsNullAndGraphicIsSetWithRIGHTContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1243         label.setText(null);
1244         label.setPadding(new Insets(7, 7, 7, 7));
1245         Rectangle r = new Rectangle(23, 23);
1246         label.setGraphic(r);
1247         label.setContentDisplay(ContentDisplay.RIGHT);
1248         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1249         assertEquals(14 + Math.max(23, lineHeight), label.prefHeight(-1), 0);
1250     }
1251 
1252     @Test public void whenTextIsEmptyAndGraphicIsSetWithRIGHTContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1253         label.setText(&quot;&quot;);
1254         label.setPadding(new Insets(7, 7, 7, 7));
1255         Rectangle r = new Rectangle(23, 23);
1256         label.setGraphic(r);
1257         label.setContentDisplay(ContentDisplay.RIGHT);
1258         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1259         assertEquals(14 + Math.max(23, lineHeight), label.prefHeight(-1), 0);
1260     }
1261 
1262     @Test public void whenTextIsSetAndGraphicIsSetWithRIGHTContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1263         label.setText(&quot;For crying in the mud&quot;);
1264         label.setPadding(new Insets(7, 7, 7, 7));
1265         Rectangle r = new Rectangle(23, 23);
1266         label.setGraphic(r);
1267         label.setContentDisplay(ContentDisplay.RIGHT);
1268         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1269         assertEquals(14 + Math.max(23, lineHeight), label.prefHeight(-1), 0);
1270     }
1271 
1272     @Test public void whenTextIsNullAndGraphicIsSetWithBOTTOMContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1273         label.setText(null);
1274         label.setPadding(new Insets(7, 7, 7, 7));
1275         Rectangle r = new Rectangle(23, 23);
1276         label.setGraphicTextGap(2);
1277         label.setGraphic(r);
1278         label.setContentDisplay(ContentDisplay.BOTTOM);
1279         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1280         assertEquals(14 + 23 + lineHeight + 2, label.prefHeight(-1), 0);
1281     }
1282 
1283     @Test public void whenTextIsEmptyAndGraphicIsSetWithBOTTOMContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1284         label.setText(&quot;&quot;);
1285         label.setPadding(new Insets(7, 7, 7, 7));
1286         Rectangle r = new Rectangle(23, 23);
1287         label.setGraphicTextGap(2);
1288         label.setGraphic(r);
1289         label.setContentDisplay(ContentDisplay.BOTTOM);
1290         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1291         assertEquals(14 + 23 + lineHeight + 2, label.prefHeight(-1), 0);
1292     }
1293 
1294     @Test public void whenTextIsSetAndGraphicIsSetWithBOTTOMContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1295         label.setText(&quot;For crying in the mud&quot;);
1296         label.setPadding(new Insets(7, 7, 7, 7));
1297         Rectangle r = new Rectangle(23, 23);
1298         label.setGraphic(r);
1299         label.setGraphicTextGap(2);
1300         label.setContentDisplay(ContentDisplay.BOTTOM);
1301         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1302         assertEquals(14 + 23 + lineHeight + 2, label.prefHeight(-1), 0);
1303     }
1304 
1305     @Test public void whenTextIsNullAndGraphicIsSetWithLEFTContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1306         label.setText(null);
1307         label.setPadding(new Insets(7, 7, 7, 7));
1308         Rectangle r = new Rectangle(23, 23);
1309         label.setGraphic(r);
1310         label.setContentDisplay(ContentDisplay.LEFT);
1311         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1312         assertEquals(14 + Math.max(23, lineHeight), label.prefHeight(-1), 0);
1313     }
1314 
1315     @Test public void whenTextIsEmptyAndGraphicIsSetWithLEFTContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1316         label.setText(&quot;&quot;);
1317         label.setPadding(new Insets(7, 7, 7, 7));
1318         Rectangle r = new Rectangle(23, 23);
1319         label.setGraphic(r);
1320         label.setContentDisplay(ContentDisplay.LEFT);
1321         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1322         assertEquals(14 + Math.max(23, lineHeight), label.prefHeight(-1), 0);
1323     }
1324 
1325     @Test public void whenTextIsSetAndGraphicIsSetWithLEFTContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1326         label.setText(&quot;For crying in the mud&quot;);
1327         label.setPadding(new Insets(7, 7, 7, 7));
1328         Rectangle r = new Rectangle(23, 23);
1329         label.setGraphic(r);
1330         label.setContentDisplay(ContentDisplay.LEFT);
1331         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1332         assertEquals(14 + Math.max(23, lineHeight), label.prefHeight(-1), 0);
1333     }
1334 
1335     @Test public void whenTextIsNullAndGraphicIsSetWithCENTERContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1336         label.setText(null);
1337         label.setPadding(new Insets(7, 7, 7, 7));
1338         Rectangle r = new Rectangle(23, 23);
1339         label.setGraphic(r);
1340         label.setContentDisplay(ContentDisplay.CENTER);
1341         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1342         assertEquals(14 + Math.max(23, lineHeight), label.prefHeight(-1), 0);
1343     }
1344 
1345     @Test public void whenTextIsEmptyAndGraphicIsSetWithCENTERContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1346         label.setText(&quot;&quot;);
1347         label.setPadding(new Insets(7, 7, 7, 7));
1348         Rectangle r = new Rectangle(23, 23);
1349         label.setGraphic(r);
1350         label.setContentDisplay(ContentDisplay.CENTER);
1351         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1352         assertEquals(14 + Math.max(23, lineHeight), label.prefHeight(-1), 0);
1353     }
1354 
1355     @Test public void whenTextIsSetAndGraphicIsSetWithCENTERContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1356         label.setText(&quot;For crying in the mud&quot;);
1357         label.setPadding(new Insets(7, 7, 7, 7));
1358         Rectangle r = new Rectangle(23, 23);
1359         label.setGraphic(r);
1360         label.setContentDisplay(ContentDisplay.CENTER);
1361         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1362         assertEquals(14 + Math.max(23, lineHeight), label.prefHeight(-1), 0);
1363     }
1364 
1365     @Test public void whenTextIsNullAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1366         label.setText(null);
1367         label.setPadding(new Insets(7, 7, 7, 7));
1368         Rectangle r = new Rectangle(23, 23);
1369         label.setGraphic(r);
1370         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1371         assertEquals(14 + 23, label.prefHeight(-1), 0);
1372     }
1373 
1374     @Test public void whenTextIsEmptyAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1375         label.setText(&quot;&quot;);
1376         label.setPadding(new Insets(7, 7, 7, 7));
1377         Rectangle r = new Rectangle(23, 23);
1378         label.setGraphic(r);
1379         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1380         assertEquals(14 + 23, label.prefHeight(-1), 0);
1381     }
1382 
1383     @Test public void whenTextIsSetAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1384         label.setText(&quot;For crying in the mud&quot;);
1385         label.setPadding(new Insets(7, 7, 7, 7));
1386         Rectangle r = new Rectangle(23, 23);
1387         label.setGraphic(r);
1388         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1389         assertEquals(14 + 23, label.prefHeight(-1), 0);
1390     }
1391 
1392     @Test public void whenTextIsNullAndGraphicIsSetWithTEXT_ONLYContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1393         label.setText(null);
1394         label.setPadding(new Insets(7, 7, 7, 7));
1395         Rectangle r = new Rectangle(23, 23);
1396         label.setGraphic(r);
1397         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1398         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1399         assertEquals(14 + lineHeight, label.prefHeight(-1), 0);
1400     }
1401 
1402     @Test public void whenTextIsEmptyAndGraphicIsSetWithTEXT_ONLYContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1403         label.setText(&quot;&quot;);
1404         label.setPadding(new Insets(7, 7, 7, 7));
1405         Rectangle r = new Rectangle(23, 23);
1406         label.setGraphic(r);
1407         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1408         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1409         assertEquals(14 + lineHeight, label.prefHeight(-1), 0);
1410     }
1411 
1412     @Test public void whenTextIsSetAndGraphicIsSetWithTEXT_ONLYContentDisplay_computePrefHeight_ReturnsRightAnswer() {
1413         label.setText(&quot;For crying in the mud&quot;);
1414         label.setPadding(new Insets(7, 7, 7, 7));
1415         Rectangle r = new Rectangle(23, 23);
1416         label.setGraphic(r);
1417         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1418         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1419         assertEquals(14 + lineHeight, label.prefHeight(-1), 0);
1420     }
1421 
1422     /****************************************************************************
1423      *                                                                          *
1424      * Tests maxWidth                                                           *
1425      *                                                                          *
1426      ***************************************************************************/
1427 
1428     @Test public void whenTextIsNullAndNoGraphic_computeMaxWidth_ReturnsPadding() {
1429         label.setText(null);
1430         label.setPadding(new Insets(7, 7, 7, 7));
1431         assertEquals(14, label.maxWidth(-1), 0);
1432     }
1433 
1434     @Test public void whenTextIsEmptyAndNoGraphic_computeMaxWidth_ReturnsPadding() {
1435         label.setText(&quot;&quot;);
1436         label.setPadding(new Insets(7, 7, 7, 7));
1437         assertEquals(14, label.maxWidth(-1), 0);
1438     }
1439 
1440     @Test public void whenTextIsSetAndNoGraphic_computeMaxWidth_ReturnsTextWidthPlusPadding() {
1441         label.setText(&quot;Lollipop&quot;);
1442         label.setPadding(new Insets(7, 7, 7, 7));
1443         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;Lollipop&quot;, 0);
1444         assertEquals(14 + textWidth, label.maxWidth(-1), 0);
1445     }
1446 
1447     @Test public void whenTextIsNullAndUnmanagedGraphic_computeMaxWidth_ReturnsPadding() {
1448         label.setText(null);
1449         Rectangle r = new Rectangle(0, 0, 50, 50);
1450         r.setManaged(false);
1451         label.setGraphic(r);
1452         label.setPadding(new Insets(7, 7, 7, 7));
1453         assertEquals(14, label.maxWidth(-1), 0);
1454     }
1455 
1456     @Test public void whenTextIsEmptyAndUnmanagedGraphic_computeMaxWidth_ReturnsPadding() {
1457         label.setText(&quot;&quot;);
1458         Rectangle r = new Rectangle(0, 0, 50, 50);
1459         r.setManaged(false);
1460         label.setGraphic(r);
1461         label.setPadding(new Insets(7, 7, 7, 7));
1462         assertEquals(14, label.maxWidth(-1), 0);
1463     }
1464 
1465     @Test public void whenTextIsSetAndUnmanagedGraphic_computeMaxWidth_ReturnsTextWidthPlusPadding() {
1466         label.setText(&quot;Lollipop&quot;);
1467         Rectangle r = new Rectangle(0, 0, 50, 50);
1468         r.setManaged(false);
1469         label.setGraphic(r);
1470         label.setPadding(new Insets(7, 7, 7, 7));
1471         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;Lollipop&quot;, 0);
1472         assertEquals(14 + textWidth, label.maxWidth(-1), 0);
1473     }
1474 
1475     @Test public void whenTextIsNullAndGraphicIsSetWithTOPContentDisplay_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1476         label.setText(null);
1477         label.setGraphic(new Rectangle(0, 0, 20, 20));
1478         label.setGraphicTextGap(6.5);
1479         label.setContentDisplay(ContentDisplay.TOP);
1480         label.setPadding(new Insets(7, 7, 7, 7));
1481         assertEquals(14 + 20, label.maxWidth(-1), 0);
1482     }
1483 
1484     @Test public void whenTextIsEmptyAndGraphicIsSetWithTOPContentDisplay_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1485         label.setText(&quot;&quot;);
1486         label.setGraphic(new Rectangle(0, 0, 20, 20));
1487         label.setGraphicTextGap(6.5);
1488         label.setContentDisplay(ContentDisplay.TOP);
1489         label.setPadding(new Insets(7, 7, 7, 7));
1490         assertEquals(14 + 20, label.maxWidth(-1), 0);
1491     }
1492 
1493     @Test public void whenTextIsSetAndGraphicIsSetWithTOPContentDisplayAndGraphicIsWider_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1494         label.setText(&quot;Lollipop&quot;);
1495         label.setGraphic(new Rectangle(0, 0, 200, 20));
1496         label.setGraphicTextGap(6.5);
1497         label.setContentDisplay(ContentDisplay.TOP);
1498         label.setPadding(new Insets(7, 7, 7, 7));
1499         assertEquals(14 + 200, label.maxWidth(-1), 0);
1500     }
1501 
1502     @Test public void whenTextIsSetAndGraphicIsSetWithTOPContentDisplayAndTextIsWider_computeMaxWidth_ReturnsTextWidthPlusPadding() {
1503         label.setText(&quot;This is the right place&quot;);
1504         label.setGraphic(new Rectangle(0, 0, 20, 20));
1505         label.setGraphicTextGap(6.5);
1506         label.setContentDisplay(ContentDisplay.TOP);
1507         label.setPadding(new Insets(7, 7, 7, 7));
1508         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;This is the right place&quot;, 0);
1509         assertEquals(14 + textWidth, label.maxWidth(-1), 0);
1510     }
1511 
1512     @Test public void whenTextIsNullAndGraphicIsSetWithRIGHTContentDisplay_computeMaxWidth_ReturnsGraphicPlusPaddingNotIncludingGap() {
1513         label.setText(null);
1514         label.setGraphic(new Rectangle(0, 0, 20, 20));
1515         label.setGraphicTextGap(6.5);
1516         label.setContentDisplay(ContentDisplay.RIGHT);
1517         label.setPadding(new Insets(7, 7, 7, 7));
1518         assertEquals(20 + 14, label.maxWidth(-1), 0);
1519     }
1520 
1521     @Test public void whenTextIsEmptyAndGraphicIsSetWithRIGHTContentDisplay_computeMaxWidth_ReturnsGraphicPlusPaddingNotIncludingGap() {
1522         label.setText(&quot;&quot;);
1523         label.setGraphic(new Rectangle(0, 0, 20, 20));
1524         label.setGraphicTextGap(6.5);
1525         label.setContentDisplay(ContentDisplay.RIGHT);
1526         label.setPadding(new Insets(7, 7, 7, 7));
1527         assertEquals(20 + 14, label.maxWidth(-1), 0);
1528     }
1529 
1530     @Test public void whenTextIsSetAndGraphicIsSetWithRIGHTContentDisplay_computeMaxWidth_ReturnsTextWidthPlusGraphicWidthPlusGapPlusPadding() {
1531         label.setText(&quot;Howdy&quot;);
1532         label.setGraphic(new Rectangle(0, 0, 20, 20));
1533         label.setGraphicTextGap(6.5);
1534         label.setContentDisplay(ContentDisplay.RIGHT);
1535         label.setPadding(new Insets(7, 7, 7, 7));
1536         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;Howdy&quot;, 0);
1537         assertEquals(14 + textWidth + 6.5 + 20, label.maxWidth(-1), 0);
1538     }
1539 
1540     @Test public void whenTextIsNullAndGraphicIsSetWithBOTTOMContentDisplay_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1541         label.setText(null);
1542         label.setGraphic(new Rectangle(0, 0, 20, 20));
1543         label.setGraphicTextGap(6.5);
1544         label.setContentDisplay(ContentDisplay.BOTTOM);
1545         label.setPadding(new Insets(7, 7, 7, 7));
1546         assertEquals(14 + 20, label.maxWidth(-1), 0);
1547     }
1548 
1549     @Test public void whenTextIsEmptyAndGraphicIsSetWithBOTTOMContentDisplay_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1550         label.setText(null);
1551         label.setGraphic(new Rectangle(0, 0, 20, 20));
1552         label.setGraphicTextGap(6.5);
1553         label.setContentDisplay(ContentDisplay.BOTTOM);
1554         label.setPadding(new Insets(7, 7, 7, 7));
1555         assertEquals(14 + 20, label.maxWidth(-1), 0);
1556     }
1557 
1558     @Test public void whenTextIsSetAndGraphicIsSetWithBOTTOMContentDisplayAndGraphicIsWider_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1559         label.setText(&quot;Lollipop&quot;);
1560         label.setGraphic(new Rectangle(0, 0, 200, 20));
1561         label.setGraphicTextGap(6.5);
1562         label.setContentDisplay(ContentDisplay.BOTTOM);
1563         label.setPadding(new Insets(7, 7, 7, 7));
1564         assertEquals(14 + 200, label.maxWidth(-1), 0);
1565     }
1566 
1567     @Test public void whenTextIsSetAndGraphicIsSetWithBOTTOMContentDisplayAndTextIsWider_computeMaxWidth_ReturnsTextWidthPlusPadding() {
1568         label.setText(&quot;This is the right place&quot;);
1569         label.setGraphic(new Rectangle(0, 0, 20, 20));
1570         label.setGraphicTextGap(6.5);
1571         label.setContentDisplay(ContentDisplay.BOTTOM);
1572         label.setPadding(new Insets(7, 7, 7, 7));
1573         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;This is the right place&quot;, 0);
1574         assertEquals(14 + textWidth, label.maxWidth(-1), 0);
1575     }
1576 
1577     @Test public void whenTextIsNullAndGraphicIsSetWithLEFTContentDisplay_computeMaxWidth_ReturnsGraphicPlusPaddingNotIncludingGap() {
1578         label.setText(null);
1579         label.setGraphic(new Rectangle(0, 0, 20, 20));
1580         label.setGraphicTextGap(6.5);
1581         label.setContentDisplay(ContentDisplay.LEFT);
1582         label.setPadding(new Insets(7, 7, 7, 7));
1583         assertEquals(20 + 14, label.maxWidth(-1), 0);
1584     }
1585 
1586     @Test public void whenTextIsEmptyAndGraphicIsSetWithLEFTContentDisplay_computeMaxWidth_ReturnsGraphicPlusPaddingNotIncludingGap() {
1587         label.setText(&quot;&quot;);
1588         label.setGraphic(new Rectangle(0, 0, 20, 20));
1589         label.setGraphicTextGap(6.5);
1590         label.setContentDisplay(ContentDisplay.LEFT);
1591         label.setPadding(new Insets(7, 7, 7, 7));
1592         assertEquals(20 + 14, label.maxWidth(-1), 0);
1593     }
1594 
1595     @Test public void whenTextIsSetAndGraphicIsSetWithLEFTContentDisplay_computeMaxWidth_ReturnsTextWidthPlusGraphicWidthPlusGapPlusPadding() {
1596         label.setText(&quot;Howdy&quot;);
1597         label.setGraphic(new Rectangle(0, 0, 20, 20));
1598         label.setGraphicTextGap(6.5);
1599         label.setContentDisplay(ContentDisplay.LEFT);
1600         label.setPadding(new Insets(7, 7, 7, 7));
1601         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;Howdy&quot;, 0);
1602         assertEquals(14 + textWidth + 6.5 + 20, label.maxWidth(-1), 0);
1603     }
1604 
1605     @Test public void whenTextIsNullAndGraphicIsSetWithCENTERContentDisplay_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1606         label.setText(null);
1607         label.setGraphic(new Rectangle(0, 0, 20, 20));
1608         label.setGraphicTextGap(6.5);
1609         label.setContentDisplay(ContentDisplay.CENTER);
1610         label.setPadding(new Insets(7, 7, 7, 7));
1611         assertEquals(14 + 20, label.maxWidth(-1), 0);
1612     }
1613 
1614     @Test public void whenTextIsEmptyAndGraphicIsSetWithCENTERContentDisplay_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1615         label.setText(&quot;&quot;);
1616         label.setGraphic(new Rectangle(0, 0, 20, 20));
1617         label.setGraphicTextGap(6.5);
1618         label.setContentDisplay(ContentDisplay.CENTER);
1619         label.setPadding(new Insets(7, 7, 7, 7));
1620         assertEquals(14 + 20, label.maxWidth(-1), 0);
1621     }
1622 
1623     @Test public void whenTextIsSetAndGraphicIsSetWithCENTERContentDisplayAndGraphicIsWider_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1624         label.setText(&quot;Lollipop&quot;);
1625         label.setGraphic(new Rectangle(0, 0, 200, 20));
1626         label.setGraphicTextGap(6.5);
1627         label.setContentDisplay(ContentDisplay.CENTER);
1628         label.setPadding(new Insets(7, 7, 7, 7));
1629         assertEquals(14 + 200, label.maxWidth(-1), 0);
1630     }
1631 
1632     @Test public void whenTextIsSetAndGraphicIsSetWithCENTERContentDisplayAndTextIsWider_computeMaxWidth_ReturnsTextWidthPlusPadding() {
1633         label.setText(&quot;This is the right place&quot;);
1634         label.setGraphic(new Rectangle(0, 0, 20, 20));
1635         label.setGraphicTextGap(6.5);
1636         label.setContentDisplay(ContentDisplay.CENTER);
1637         label.setPadding(new Insets(7, 7, 7, 7));
1638         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;This is the right place&quot;, 0);
1639         assertEquals(14 + textWidth, label.maxWidth(-1), 0);
1640     }
1641 
1642     @Test public void whenTextIsNullAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1643         label.setText(null);
1644         label.setGraphic(new Rectangle(0, 0, 20, 20));
1645         label.setGraphicTextGap(6.5);
1646         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1647         label.setPadding(new Insets(7, 7, 7, 7));
1648         assertEquals(14 + 20, label.maxWidth(-1), 0);
1649     }
1650 
1651     @Test public void whenTextIsEmptyAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1652         label.setText(&quot;&quot;);
1653         label.setGraphic(new Rectangle(0, 0, 20, 20));
1654         label.setGraphicTextGap(6.5);
1655         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1656         label.setPadding(new Insets(7, 7, 7, 7));
1657         assertEquals(14 + 20, label.maxWidth(-1), 0);
1658     }
1659 
1660     @Test public void whenTextIsSetAndGraphicIsSetWithGRAPHIC_ONLYContentDisplayAndGraphicIsWider_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1661         label.setText(&quot;Howdy&quot;);
1662         label.setGraphic(new Rectangle(0, 0, 200, 20));
1663         label.setGraphicTextGap(6.5);
1664         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1665         label.setPadding(new Insets(7, 7, 7, 7));
1666         assertEquals(14 + 200, label.maxWidth(-1), 0);
1667     }
1668 
1669     @Test public void whenTextIsSetAndGraphicIsSetWithGRAPHIC_ONLYContentDisplayAndTextIsWider_computeMaxWidth_ReturnsGraphicWidthPlusPadding() {
1670         label.setText(&quot;Tally ho, off to the races&quot;);
1671         label.setGraphic(new Rectangle(0, 0, 20, 20));
1672         label.setGraphicTextGap(6.5);
1673         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1674         label.setPadding(new Insets(7, 7, 7, 7));
1675         assertEquals(14 + 20, label.maxWidth(-1), 0);
1676     }
1677 
1678     // TODO should this include the gap??
1679     @Test public void whenTextIsNullAndGraphicIsSetWithTEXT_ONLYContentDisplay_computeMaxWidth_ReturnsPadding() {
1680         label.setText(null);
1681         label.setGraphic(new Rectangle(0, 0, 20, 20));
1682         label.setGraphicTextGap(6.5);
1683         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1684         label.setPadding(new Insets(7, 7, 7, 7));
1685         assertEquals(14, label.maxWidth(-1), 0);
1686     }
1687 
1688     @Test public void whenTextIsEmptyAndGraphicIsSetWithTEXT_ONLYContentDisplay_computeMaxWidth_ReturnsPadding() {
1689         label.setText(&quot;&quot;);
1690         label.setGraphic(new Rectangle(0, 0, 20, 20));
1691         label.setGraphicTextGap(6.5);
1692         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1693         label.setPadding(new Insets(7, 7, 7, 7));
1694         assertEquals(14, label.maxWidth(-1), 0);
1695     }
1696 
1697     // TODO should this include the gap? I guess not, otherwise our gap would have to default to 0
1698     @Test public void whenTextIsSetAndGraphicIsSetWithTEXT_ONLYContentDisplay_computeMaxWidth_ReturnsTextWidthPlusPadding() {
1699         label.setText(&quot;Yippee Skippee&quot;);
1700         label.setGraphic(new Rectangle(0, 0, 20, 20));
1701         label.setGraphicTextGap(6.5);
1702         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1703         label.setPadding(new Insets(7, 7, 7, 7));
1704         final double textWidth = Utils.computeTextWidth(label.getFont(), &quot;Yippee Skippee&quot;, 0);
1705         assertEquals(14 + textWidth, label.maxWidth(-1), 0);
1706     }
1707 
1708     /****************************************************************************
1709      *                                                                          *
1710      * Tests for maxHeight.                                                     *
1711      *                                                                          *
1712      ***************************************************************************/
1713 
1714     @Test public void whenTextIsNullAndNoGraphic_computeMaxHeight_ReturnsSingleLineStringHeightPlusPadding() {
1715         label.setText(null);
1716         label.setPadding(new Insets(7, 7, 7, 7));
1717         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1718         assertEquals(14 + lineHeight, label.maxHeight(-1), 0);
1719     }
1720 
1721     @Test public void whenTextIsEmptyAndNoGraphic_computeMaxHeight_ReturnsSingleLineStringHeightPlusPadding() {
1722         label.setText(&quot;&quot;);
1723         label.setPadding(new Insets(7, 7, 7, 7));
1724         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1725         assertEquals(14 + lineHeight, label.maxHeight(-1), 0);
1726     }
1727 
1728     @Test public void whenTextIsSetAndNoGraphic_computeMaxHeight_ReturnsSingleLineStringHeightPlusPadding() {
1729         label.setText(&quot;Howdy Pardner&quot;);
1730         label.setPadding(new Insets(7, 7, 7, 7));
1731         assertTrue(label.maxHeight(-1) &gt;= 0);
1732         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1733         assertEquals(14 + lineHeight, label.maxHeight(-1), 0);
1734     }
1735 
1736     @Test public void whenTextIsNullAndUnmanagedGraphic_computeMaxHeight_ReturnsSingleLineStringHeightPlusPadding() {
1737         label.setText(null);
1738         label.setPadding(new Insets(7, 7, 7, 7));
1739         Rectangle r = new Rectangle(23, 500);
1740         r.setManaged(false);
1741         label.setGraphic(r);
1742         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1743         assertEquals(14 + lineHeight, label.maxHeight(-1), 0);
1744     }
1745 
1746     @Test public void whenTextIsEmptyAndUnmanagedGraphic_computeMaxHeight_ReturnsSingleLineStringHeightPlusPadding() {
1747         label.setText(&quot;&quot;);
1748         label.setPadding(new Insets(7, 7, 7, 7));
1749         Rectangle r = new Rectangle(23, 500);
1750         r.setManaged(false);
1751         label.setGraphic(r);
1752         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1753         assertEquals(14 + lineHeight, label.maxHeight(-1), 0);
1754     }
1755 
1756     @Test public void whenTextIsSetAndUnmanagedGraphic_computeMaxHeight_ReturnsSingleLineStringHeightPlusPadding() {
1757         label.setText(&quot;Howdy Pardner&quot;);
1758         label.setPadding(new Insets(7, 7, 7, 7));
1759         Rectangle r = new Rectangle(23, 500);
1760         r.setManaged(false);
1761         label.setGraphic(r);
1762         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1763         assertTrue(label.maxHeight(-1) &gt;= 0);
1764         assertEquals(14 + lineHeight, label.maxHeight(-1), 0);
1765     }
1766 
1767     @Test public void whenTextIsNullAndGraphicIsSetWithTOPContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1768         label.setText(null);
1769         label.setPadding(new Insets(7, 7, 7, 7));
1770         Rectangle r = new Rectangle(23, 23);
1771         label.setGraphicTextGap(2);
1772         label.setGraphic(r);
1773         label.setContentDisplay(ContentDisplay.TOP);
1774         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1775         assertEquals(14 + 23 + lineHeight + 2, label.maxHeight(-1), 0);
1776     }
1777 
1778     @Test public void whenTextIsEmptyAndGraphicIsSetWithTOPContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1779         label.setText(&quot;&quot;);
1780         label.setPadding(new Insets(7, 7, 7, 7));
1781         Rectangle r = new Rectangle(23, 23);
1782         label.setGraphicTextGap(2);
1783         label.setGraphic(r);
1784         label.setContentDisplay(ContentDisplay.TOP);
1785         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1786         assertEquals(14 + 23 + lineHeight + 2, label.maxHeight(-1), 0);
1787     }
1788 
1789     @Test public void whenTextIsSetAndGraphicIsSetWithTOPContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1790         label.setText(&quot;For crying in the mud&quot;);
1791         label.setPadding(new Insets(7, 7, 7, 7));
1792         Rectangle r = new Rectangle(23, 23);
1793         label.setGraphic(r);
1794         label.setGraphicTextGap(2);
1795         label.setContentDisplay(ContentDisplay.TOP);
1796         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1797         assertEquals(14 + 23 + lineHeight + 2, label.maxHeight(-1), 0);
1798     }
1799 
1800     @Test public void whenTextIsNullAndGraphicIsSetWithRIGHTContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1801         label.setText(null);
1802         label.setPadding(new Insets(7, 7, 7, 7));
1803         Rectangle r = new Rectangle(23, 23);
1804         label.setGraphic(r);
1805         label.setContentDisplay(ContentDisplay.RIGHT);
1806         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1807         assertEquals(14 + Math.max(23, lineHeight), label.maxHeight(-1), 0);
1808     }
1809 
1810     @Test public void whenTextIsEmptyAndGraphicIsSetWithRIGHTContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1811         label.setText(&quot;&quot;);
1812         label.setPadding(new Insets(7, 7, 7, 7));
1813         Rectangle r = new Rectangle(23, 23);
1814         label.setGraphic(r);
1815         label.setContentDisplay(ContentDisplay.RIGHT);
1816         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1817         assertEquals(14 + Math.max(23, lineHeight), label.maxHeight(-1), 0);
1818     }
1819 
1820     @Test public void whenTextIsSetAndGraphicIsSetWithRIGHTContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1821         label.setText(&quot;For crying in the mud&quot;);
1822         label.setPadding(new Insets(7, 7, 7, 7));
1823         Rectangle r = new Rectangle(23, 23);
1824         label.setGraphic(r);
1825         label.setContentDisplay(ContentDisplay.RIGHT);
1826         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1827         assertEquals(14 + Math.max(23, lineHeight), label.maxHeight(-1), 0);
1828     }
1829 
1830     @Test public void whenTextIsNullAndGraphicIsSetWithBOTTOMContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1831         label.setText(null);
1832         label.setPadding(new Insets(7, 7, 7, 7));
1833         Rectangle r = new Rectangle(23, 23);
1834         label.setGraphicTextGap(2);
1835         label.setGraphic(r);
1836         label.setContentDisplay(ContentDisplay.BOTTOM);
1837         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1838         assertEquals(14 + 23 + lineHeight + 2, label.maxHeight(-1), 0);
1839     }
1840 
1841     @Test public void whenTextIsEmptyAndGraphicIsSetWithBOTTOMContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1842         label.setText(&quot;&quot;);
1843         label.setPadding(new Insets(7, 7, 7, 7));
1844         Rectangle r = new Rectangle(23, 23);
1845         label.setGraphicTextGap(2);
1846         label.setGraphic(r);
1847         label.setContentDisplay(ContentDisplay.BOTTOM);
1848         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1849         assertEquals(14 + 23 + lineHeight + 2, label.maxHeight(-1), 0);
1850     }
1851 
1852     @Test public void whenTextIsSetAndGraphicIsSetWithBOTTOMContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1853         label.setText(&quot;For crying in the mud&quot;);
1854         label.setPadding(new Insets(7, 7, 7, 7));
1855         Rectangle r = new Rectangle(23, 23);
1856         label.setGraphic(r);
1857         label.setGraphicTextGap(2);
1858         label.setContentDisplay(ContentDisplay.BOTTOM);
1859         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1860         assertEquals(14 + 23 + lineHeight + 2, label.maxHeight(-1), 0);
1861     }
1862 
1863     @Test public void whenTextIsNullAndGraphicIsSetWithLEFTContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1864         label.setText(null);
1865         label.setPadding(new Insets(7, 7, 7, 7));
1866         Rectangle r = new Rectangle(23, 23);
1867         label.setGraphic(r);
1868         label.setContentDisplay(ContentDisplay.LEFT);
1869         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1870         assertEquals(14 + Math.max(23, lineHeight), label.maxHeight(-1), 0);
1871     }
1872 
1873     @Test public void whenTextIsEmptyAndGraphicIsSetWithLEFTContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1874         label.setText(&quot;&quot;);
1875         label.setPadding(new Insets(7, 7, 7, 7));
1876         Rectangle r = new Rectangle(23, 23);
1877         label.setGraphic(r);
1878         label.setContentDisplay(ContentDisplay.LEFT);
1879         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1880         assertEquals(14 + Math.max(23, lineHeight), label.maxHeight(-1), 0);
1881     }
1882 
1883     @Test public void whenTextIsSetAndGraphicIsSetWithLEFTContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1884         label.setText(&quot;For crying in the mud&quot;);
1885         label.setPadding(new Insets(7, 7, 7, 7));
1886         Rectangle r = new Rectangle(23, 23);
1887         label.setGraphic(r);
1888         label.setContentDisplay(ContentDisplay.LEFT);
1889         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1890         assertEquals(14 + Math.max(23, lineHeight), label.maxHeight(-1), 0);
1891     }
1892 
1893     @Test public void whenTextIsNullAndGraphicIsSetWithCENTERContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1894         label.setText(null);
1895         label.setPadding(new Insets(7, 7, 7, 7));
1896         Rectangle r = new Rectangle(23, 23);
1897         label.setGraphic(r);
1898         label.setContentDisplay(ContentDisplay.CENTER);
1899         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1900         assertEquals(14 + Math.max(23, lineHeight), label.maxHeight(-1), 0);
1901     }
1902 
1903     @Test public void whenTextIsEmptyAndGraphicIsSetWithCENTERContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1904         label.setText(&quot;&quot;);
1905         label.setPadding(new Insets(7, 7, 7, 7));
1906         Rectangle r = new Rectangle(23, 23);
1907         label.setGraphic(r);
1908         label.setContentDisplay(ContentDisplay.CENTER);
1909         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1910         assertEquals(14 + Math.max(23, lineHeight), label.maxHeight(-1), 0);
1911     }
1912 
1913     @Test public void whenTextIsSetAndGraphicIsSetWithCENTERContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1914         label.setText(&quot;For crying in the mud&quot;);
1915         label.setPadding(new Insets(7, 7, 7, 7));
1916         Rectangle r = new Rectangle(23, 23);
1917         label.setGraphic(r);
1918         label.setContentDisplay(ContentDisplay.CENTER);
1919         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1920         assertEquals(14 + Math.max(23, lineHeight), label.maxHeight(-1), 0);
1921     }
1922 
1923     @Test public void whenTextIsNullAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1924         label.setText(null);
1925         label.setPadding(new Insets(7, 7, 7, 7));
1926         Rectangle r = new Rectangle(23, 23);
1927         label.setGraphic(r);
1928         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1929         assertEquals(14 + 23, label.maxHeight(-1), 0);
1930     }
1931 
1932     @Test public void whenTextIsEmptyAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1933         label.setText(&quot;&quot;);
1934         label.setPadding(new Insets(7, 7, 7, 7));
1935         Rectangle r = new Rectangle(23, 23);
1936         label.setGraphic(r);
1937         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1938         assertEquals(14 + 23, label.maxHeight(-1), 0);
1939     }
1940 
1941     @Test public void whenTextIsSetAndGraphicIsSetWithGRAPHIC_ONLYContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1942         label.setText(&quot;For crying in the mud&quot;);
1943         label.setPadding(new Insets(7, 7, 7, 7));
1944         Rectangle r = new Rectangle(23, 23);
1945         label.setGraphic(r);
1946         label.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);
1947         assertEquals(14 + 23, label.maxHeight(-1), 0);
1948     }
1949 
1950     @Test public void whenTextIsNullAndGraphicIsSetWithTEXT_ONLYContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1951         label.setText(null);
1952         label.setPadding(new Insets(7, 7, 7, 7));
1953         Rectangle r = new Rectangle(23, 23);
1954         label.setGraphic(r);
1955         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1956         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1957         assertEquals(14 + lineHeight, label.maxHeight(-1), 0);
1958     }
1959 
1960     @Test public void whenTextIsEmptyAndGraphicIsSetWithTEXT_ONLYContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1961         label.setText(&quot;&quot;);
1962         label.setPadding(new Insets(7, 7, 7, 7));
1963         Rectangle r = new Rectangle(23, 23);
1964         label.setGraphic(r);
1965         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1966         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1967         assertEquals(14 + lineHeight, label.maxHeight(-1), 0);
1968     }
1969 
1970     @Test public void whenTextIsSetAndGraphicIsSetWithTEXT_ONLYContentDisplay_computeMaxHeight_ReturnsRightAnswer() {
1971         label.setText(&quot;For crying in the mud&quot;);
1972         label.setPadding(new Insets(7, 7, 7, 7));
1973         Rectangle r = new Rectangle(23, 23);
1974         label.setGraphic(r);
1975         label.setContentDisplay(ContentDisplay.TEXT_ONLY);
1976         final double lineHeight = Utils.computeTextHeight(label.getFont(), &quot; &quot;, 0, text.getBoundsType());
1977         assertEquals(14 + lineHeight, label.maxHeight(-1), 0);
1978     }
1979 
1980     @Test public void maxWidthTracksPreferred() {
1981         label.setPrefWidth(500);
1982         assertEquals(500, label.maxWidth(-1), 0);
1983     }
1984 
1985     @Test public void maxHeightTracksPreferred() {
1986         label.setPrefHeight(500);
1987         assertEquals(500, label.maxHeight(-1), 0);
1988     }
1989 
1990     /* Test for checking width of label with/without mnemonic */
1991     @Test public void labelMnemonicTest() {
1992         Label l1 = new Label(&quot;Hello&quot;);
1993         Label l2 = new Label(&quot;_Hello&quot;);
1994         Label l3 = new Label(&quot;He_llo&quot;);
1995         Label l4 = new Label(&quot;Hello_&quot;);
1996         Label l5 = new Label(&quot;_Hello&quot;);
1997 
1998         l1.setMnemonicParsing(true);
1999         l2.setMnemonicParsing(true);
2000         l3.setMnemonicParsing(true);
2001         l4.setMnemonicParsing(true);
2002         l5.setMnemonicParsing(false);
2003 
2004         Toolkit tk = Toolkit.getToolkit();
2005 
2006         Scene scene = new Scene(new Group(l1, l2, l3, l4, l5));
2007         Stage stage = new Stage();
2008         stage.setScene(scene);
2009         stage.show();
2010         tk.firePulse();
2011 
2012         assertEquals(l1.getWidth(), l2.getWidth(), 0);
2013         assertEquals(l2.getWidth(), l3.getWidth(), 0);
2014 
2015         // l4 label does not have a mnemonic ==&gt; l4 width is greater than l1 width
2016         int x = Double.compare(l1.getWidth(), l4.getWidth());
2017         assertTrue(x &lt; 0);
2018 
2019         // labels with no mnemonic
2020         assertEquals(l4.getWidth(), l5.getWidth(), 0);
2021     }
2022 
2023 
2024     /****************************************************************************
2025      *                                                                          *
2026      * Tests for updateDisplayedText                                            *
2027      *                                                                          *
2028      ***************************************************************************/
2029 
2030     // tests for updateDisplayedText (not even sure how to test it exactly yet)
2031 
2032 
2033     public static final class LabelSkinMock extends LabelSkin {
2034         boolean propertyChanged = false;
2035         int propertyChangeCount = 0;
2036 
2037         public LabelSkinMock(Label label) {
2038             super(label);
2039         }
2040 
2041         public void addWatchedProperty(ObservableValue&lt;?&gt; p) {
2042             p.addListener(o -&gt; {
2043                 propertyChanged = true;
2044                 propertyChangeCount++;
2045             });
2046         }
2047 
2048         public boolean get_invalidText() {
2049             return LabeledSkinBaseShim.get_invalidText(this);
2050 
2051         }
2052 
2053         public void updateDisplayedText() {
2054             LabeledSkinBaseShim.updateDisplayedText(this);
2055         }
2056 
2057         public double get_textWidth() {
2058             return LabeledSkinBaseShim.get_textWidth(this);
2059         }
2060 
2061         public double get_ellipsisWidth() {
2062             return LabeledSkinBaseShim.get_ellipsisWidth(this);
2063         }
2064     }
2065 }
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>