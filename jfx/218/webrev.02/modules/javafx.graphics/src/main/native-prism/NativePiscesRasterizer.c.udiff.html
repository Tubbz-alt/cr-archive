<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.graphics/src/main/native-prism/NativePiscesRasterizer.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="Dasher.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="PathConsumer.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/native-prism/NativePiscesRasterizer.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2012, 2016, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -43,10 +43,11 @@</span>
  #define SEG_CUBICTO  SEG(CUBICTO)
  #define SEG_CLOSE    SEG(CLOSE)
  
  #define NPException    &quot;java/lang/NullPointerException&quot;
  #define AIOOBException &quot;java/lang/ArrayIndexOutOfBoundsException&quot;
<span class="udiff-line-added">+ #define OOMError       &quot;java/lang/OutOfMemoryError&quot;</span>
  #define IError         &quot;java/lang/InternalError&quot;
  
  #define CheckNPE(env, a)                                \
      do {                                                \
          if (a == NULL) {                                \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -69,15 +70,29 @@</span>
      if (throw_class != NULL) {
          (*env)-&gt;ThrowNew(env, throw_class, detail);
      }
  }
  
<span class="udiff-line-added">+ static char * errorToString(jint errorCode) {</span>
<span class="udiff-line-added">+     switch (errorCode) {</span>
<span class="udiff-line-added">+         case ERROR_NONE:</span>
<span class="udiff-line-added">+             return NULL;</span>
<span class="udiff-line-added">+         case ERROR_OOM:</span>
<span class="udiff-line-added">+             return &quot;Out of Memory&quot;;</span>
<span class="udiff-line-added">+         case ERROR_AIOOBE:</span>
<span class="udiff-line-added">+             return &quot;[PathConsumer&quot;;</span>
<span class="udiff-line-added">+         default:</span>
<span class="udiff-line-added">+             return &quot;Unknown error&quot;;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  static char * feedConsumer
      (JNIEnv *env, PathConsumer *consumer,
       jfloatArray coordsArray, jint coordSize,
       jbyteArray commandsArray, jint numCommands)
  {
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      char *failure = NULL;
      jfloat *coords;
  
      coords = (*env)-&gt;GetPrimitiveArrayCritical(env, coordsArray, 0);
      if (coords == NULL) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -92,58 +107,76 @@</span>
                  switch (commands[cmdoff]) {
                      case SEG_MOVETO:
                          if (coordoff + 2 &gt; coordSize) {
                              failure = &quot;[not enough coordinates for moveTo&quot;;
                          } else {
<span class="udiff-line-modified-removed">-                             consumer-&gt;moveTo(consumer,</span>
<span class="udiff-line-modified-added">+                             status = consumer-&gt;moveTo(consumer,</span>
                                               coords[coordoff+0], coords[coordoff+1]);
<span class="udiff-line-added">+                             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                                 failure = errorToString(status);</span>
<span class="udiff-line-added">+                             }</span>
                              coordoff += 2;
                          }
                          break;
                      case SEG_LINETO:
                          if (coordoff + 2 &gt; coordSize) {
                              failure = &quot;[not enough coordinates for lineTo&quot;;
                          } else {
<span class="udiff-line-modified-removed">-                             consumer-&gt;lineTo(consumer,</span>
<span class="udiff-line-modified-added">+                             status = consumer-&gt;lineTo(consumer,</span>
                                               coords[coordoff+0], coords[coordoff+1]);
<span class="udiff-line-added">+                             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                                 failure = errorToString(status);</span>
<span class="udiff-line-added">+                             }</span>
                              coordoff += 2;
                          }
                          break;
                      case SEG_QUADTO:
                          if (coordoff + 4 &gt; coordSize) {
                              failure = &quot;[not enough coordinates for quadTo&quot;;
                          } else {
<span class="udiff-line-modified-removed">-                             consumer-&gt;quadTo(consumer,</span>
<span class="udiff-line-modified-added">+                             status = consumer-&gt;quadTo(consumer,</span>
                                               coords[coordoff+0], coords[coordoff+1],
                                               coords[coordoff+2], coords[coordoff+3]);
<span class="udiff-line-added">+                             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                                 failure = errorToString(status);</span>
<span class="udiff-line-added">+                             }</span>
                              coordoff += 4;
                          }
                          break;
                      case SEG_CUBICTO:
                          if (coordoff + 6 &gt; coordSize) {
                              failure = &quot;[not enough coordinates for curveTo&quot;;
                          } else {
<span class="udiff-line-modified-removed">-                             consumer-&gt;curveTo(consumer,</span>
<span class="udiff-line-modified-added">+                             status = consumer-&gt;curveTo(consumer,</span>
                                                coords[coordoff+0], coords[coordoff+1],
                                                coords[coordoff+2], coords[coordoff+3],
                                                coords[coordoff+4], coords[coordoff+5]);
<span class="udiff-line-added">+                             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                                 failure = errorToString(status);</span>
<span class="udiff-line-added">+                             }</span>
                              coordoff += 6;
                          }
                          break;
                      case SEG_CLOSE:
<span class="udiff-line-modified-removed">-                         consumer-&gt;closePath(consumer);</span>
<span class="udiff-line-modified-added">+                         status = consumer-&gt;closePath(consumer);</span>
<span class="udiff-line-added">+                         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                             failure = errorToString(status);</span>
<span class="udiff-line-added">+                         }</span>
                          break;
                      default:
                          failure = &quot;unrecognized Path segment&quot;;
                          break;
                  }
              }
              (*env)-&gt;ReleasePrimitiveArrayCritical(env, commandsArray, commands, JNI_ABORT);
          }
          (*env)-&gt;ReleasePrimitiveArrayCritical(env, coordsArray, coords, JNI_ABORT);
          if (failure == NULL) {
<span class="udiff-line-modified-removed">-             consumer-&gt;pathDone(consumer);</span>
<span class="udiff-line-modified-added">+             status = consumer-&gt;pathDone(consumer);</span>
<span class="udiff-line-added">+             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                 failure = errorToString(status);</span>
<span class="udiff-line-added">+             }</span>
          }
      }
      return failure;
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -209,11 +242,18 @@</span>
              if ((*env)-&gt;GetArrayLength(env, maskArray) / ac.width &lt; ac.height) {
                  Throw(env, AIOOBException, &quot;maskArray&quot;);
              } else {
                  ac.alphas = (*env)-&gt;GetPrimitiveArrayCritical(env, maskArray, 0);
                  if (ac.alphas != NULL) {
<span class="udiff-line-modified-removed">-                     Renderer_produceAlphas(&amp;renderer, &amp;ac);</span>
<span class="udiff-line-modified-added">+                     jint status;</span>
<span class="udiff-line-added">+                     if ((status = Renderer_produceAlphas(&amp;renderer, &amp;ac)) != ERROR_NONE) {</span>
<span class="udiff-line-added">+                         if (status == ERROR_OOM) {</span>
<span class="udiff-line-added">+                             Throw(env, OOMError, &quot;produceAlphas&quot;);</span>
<span class="udiff-line-added">+                         } else {</span>
<span class="udiff-line-added">+                             Throw(env, AIOOBException, &quot;produceAlphas&quot;);</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                     }</span>
                      (*env)-&gt;ReleasePrimitiveArrayCritical(env, maskArray, ac.alphas, 0);
                  }
              }
          }
      } else if (*failure != 0) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -298,11 +338,18 @@</span>
              if ((*env)-&gt;GetArrayLength(env, maskArray) / ac.width &lt; ac.height) {
                  Throw(env, AIOOBException, &quot;Mask&quot;);
              } else {
                  ac.alphas = (*env)-&gt;GetPrimitiveArrayCritical(env, maskArray, 0);
                  if (ac.alphas != NULL) {
<span class="udiff-line-modified-removed">-                     Renderer_produceAlphas(&amp;renderer, &amp;ac);</span>
<span class="udiff-line-modified-added">+                     jint status;</span>
<span class="udiff-line-added">+                     if ((status = Renderer_produceAlphas(&amp;renderer, &amp;ac)) != ERROR_NONE) {</span>
<span class="udiff-line-added">+                         if (status == ERROR_OOM) {</span>
<span class="udiff-line-added">+                             Throw(env, OOMError, &quot;produceAlphas&quot;);</span>
<span class="udiff-line-added">+                         } else {</span>
<span class="udiff-line-added">+                             Throw(env, AIOOBException, &quot;produceAlphas&quot;);</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                     }</span>
                      (*env)-&gt;ReleasePrimitiveArrayCritical(env, maskArray, ac.alphas, 0);
                  }
              }
          }
      } else if (*failure != 0) {
</pre>
<center><a href="Dasher.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="PathConsumer.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>