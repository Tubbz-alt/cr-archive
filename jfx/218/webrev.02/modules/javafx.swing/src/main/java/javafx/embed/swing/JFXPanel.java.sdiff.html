<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.swing/src/main/java/javafx/embed/swing/JFXPanel.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../javafx.media/src/main/native/vs_project/plugins/plugins.vcxproj.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../javafx.swt/src/main/java/javafx/embed/swt/FXCanvas.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.swing/src/main/java/javafx/embed/swing/JFXPanel.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 432             scenePeer.menuEvent(e.getX(), e.getY(), e.getXOnScreen(), e.getYOnScreen(), false);
 433         }
 434     }
 435 
 436     /**
 437      * Overrides the {@link java.awt.Component#processMouseEvent(MouseEvent)}
 438      * method to dispatch the mouse event to the JavaFX scene attached to this
 439      * {@code JFXPanel}.
 440      *
 441      * @param e the mouse event to dispatch to the JavaFX scene
 442      */
 443     @Override
 444     protected void processMouseEvent(MouseEvent e) {
 445         if ((e.getID() == MouseEvent.MOUSE_PRESSED) &amp;&amp;
 446             (e.getButton() == MouseEvent.BUTTON1)) {
 447             if (isFocusable() &amp;&amp; !hasFocus()) {
 448                 requestFocus();
 449                 // The extra simulated mouse pressed event is removed by making the JavaFX scene focused.
 450                 // It is safe, because in JavaFX only the method &quot;setFocused(true)&quot; is called,
 451                 // which doesn&#39;t have any side-effects when called multiple times.
<span class="line-modified"> 452                 int focusCause = AbstractEvents.FOCUSEVENT_ACTIVATED;</span>
<span class="line-modified"> 453                 stagePeer.setFocused(true, focusCause);</span>


 454             }
 455         }
 456 
 457         sendMouseEventToFX(e);
 458         super.processMouseEvent(e);
 459     }
 460 
 461     /**
 462      * Overrides the {@link java.awt.Component#processMouseMotionEvent(MouseEvent)}
 463      * method to dispatch the mouse motion event to the JavaFX scene attached to
 464      * this {@code JFXPanel}.
 465      *
 466      * @param e the mouse motion event to dispatch to the JavaFX scene
 467      */
 468     @Override
 469     protected void processMouseMotionEvent(MouseEvent e) {
 470         sendMouseEventToFX(e);
 471         super.processMouseMotionEvent(e);
 472     }
 473 
</pre>
<hr />
<pre>
 668     protected void processFocusEvent(FocusEvent e) {
 669         sendFocusEventToFX(e);
 670         super.processFocusEvent(e);
 671     }
 672 
 673     // called on EDT only
 674     private void createResizePixelBuffer(double newScaleFactorX, double newScaleFactorY) {
 675         if (scenePeer == null || pWidth &lt;= 0 || pHeight &lt;= 0) {
 676             pixelsIm = null;
 677         } else {
 678             BufferedImage oldIm = pixelsIm;
 679             int newPixelW = (int) Math.ceil(pWidth * newScaleFactorX);
 680             int newPixelH = (int) Math.ceil(pHeight * newScaleFactorY);
 681             pixelsIm = new BufferedImage(newPixelW, newPixelH,
 682                                          SwingFXUtils.getBestBufferedImageType(
 683                                              scenePeer.getPixelFormat(), null, false));
 684             if (oldIm != null) {
 685                 double ratioX = newScaleFactorX / scaleFactorX;
 686                 double ratioY = newScaleFactorY / scaleFactorY;
 687                 // Transform old size to the new coordinate space.
<span class="line-modified"> 688                 int oldW = (int)Math.round(oldIm.getWidth() * ratioX);</span>
<span class="line-modified"> 689                 int oldH = (int)Math.round(oldIm.getHeight() * ratioY);</span>
 690 
 691                 Graphics g = pixelsIm.getGraphics();
 692                 try {
 693                     g.drawImage(oldIm, 0, 0, oldW, oldH, null);
 694                 } finally {
 695                     g.dispose();
 696                 }
 697             }
 698         }
 699     }
 700 
 701     @Override
 702     protected void processInputMethodEvent(InputMethodEvent e) {
 703         if (e.getID() == InputMethodEvent.INPUT_METHOD_TEXT_CHANGED) {
 704             sendInputMethodEventToFX(e);
 705         }
 706         super.processInputMethodEvent(e);
 707     }
 708 
 709     private void sendInputMethodEventToFX(InputMethodEvent e) {
</pre>
<hr />
<pre>
 913         pWidth = 0;
 914         pHeight = 0;
 915 
 916         super.removeNotify();
 917 
 918         AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
 919             JFXPanel.this.getToolkit().removeAWTEventListener(ungrabListener);
 920             return null;
 921         });
 922 
 923         /* see CR 4867453 */
 924         getInputContext().removeNotify(this);
 925 
 926         deregisterFinishListener();
 927     }
 928 
 929     private void invokeOnClientEDT(Runnable r) {
 930         jfxPanelIOP.postEvent(this, new InvocationEvent(this, r));
 931     }
 932 





 933     private class HostContainer implements HostInterface {
 934 
 935         @Override
 936         public void setEmbeddedStage(EmbeddedStageInterface embeddedStage) {
 937             stagePeer = embeddedStage;
 938             if (stagePeer == null) {
 939                 return;
 940             }
 941             if (pWidth &gt; 0 &amp;&amp; pHeight &gt; 0) {
 942                 stagePeer.setSize(pWidth, pHeight);
 943             }
 944             invokeOnClientEDT(() -&gt; {
 945                 if (stagePeer != null &amp;&amp; JFXPanel.this.isFocusOwner()) {
 946                     stagePeer.setFocused(true, AbstractEvents.FOCUSEVENT_ACTIVATED);
 947                 }
 948             });
 949             sendMoveEventToFX();
 950         }
 951 
 952         @Override
</pre>
</td>
<td>
<hr />
<pre>
 432             scenePeer.menuEvent(e.getX(), e.getY(), e.getXOnScreen(), e.getYOnScreen(), false);
 433         }
 434     }
 435 
 436     /**
 437      * Overrides the {@link java.awt.Component#processMouseEvent(MouseEvent)}
 438      * method to dispatch the mouse event to the JavaFX scene attached to this
 439      * {@code JFXPanel}.
 440      *
 441      * @param e the mouse event to dispatch to the JavaFX scene
 442      */
 443     @Override
 444     protected void processMouseEvent(MouseEvent e) {
 445         if ((e.getID() == MouseEvent.MOUSE_PRESSED) &amp;&amp;
 446             (e.getButton() == MouseEvent.BUTTON1)) {
 447             if (isFocusable() &amp;&amp; !hasFocus()) {
 448                 requestFocus();
 449                 // The extra simulated mouse pressed event is removed by making the JavaFX scene focused.
 450                 // It is safe, because in JavaFX only the method &quot;setFocused(true)&quot; is called,
 451                 // which doesn&#39;t have any side-effects when called multiple times.
<span class="line-modified"> 452                 if (stagePeer != null) {</span>
<span class="line-modified"> 453                     int focusCause = AbstractEvents.FOCUSEVENT_ACTIVATED;</span>
<span class="line-added"> 454                     stagePeer.setFocused(true, focusCause);</span>
<span class="line-added"> 455                 }</span>
 456             }
 457         }
 458 
 459         sendMouseEventToFX(e);
 460         super.processMouseEvent(e);
 461     }
 462 
 463     /**
 464      * Overrides the {@link java.awt.Component#processMouseMotionEvent(MouseEvent)}
 465      * method to dispatch the mouse motion event to the JavaFX scene attached to
 466      * this {@code JFXPanel}.
 467      *
 468      * @param e the mouse motion event to dispatch to the JavaFX scene
 469      */
 470     @Override
 471     protected void processMouseMotionEvent(MouseEvent e) {
 472         sendMouseEventToFX(e);
 473         super.processMouseMotionEvent(e);
 474     }
 475 
</pre>
<hr />
<pre>
 670     protected void processFocusEvent(FocusEvent e) {
 671         sendFocusEventToFX(e);
 672         super.processFocusEvent(e);
 673     }
 674 
 675     // called on EDT only
 676     private void createResizePixelBuffer(double newScaleFactorX, double newScaleFactorY) {
 677         if (scenePeer == null || pWidth &lt;= 0 || pHeight &lt;= 0) {
 678             pixelsIm = null;
 679         } else {
 680             BufferedImage oldIm = pixelsIm;
 681             int newPixelW = (int) Math.ceil(pWidth * newScaleFactorX);
 682             int newPixelH = (int) Math.ceil(pHeight * newScaleFactorY);
 683             pixelsIm = new BufferedImage(newPixelW, newPixelH,
 684                                          SwingFXUtils.getBestBufferedImageType(
 685                                              scenePeer.getPixelFormat(), null, false));
 686             if (oldIm != null) {
 687                 double ratioX = newScaleFactorX / scaleFactorX;
 688                 double ratioY = newScaleFactorY / scaleFactorY;
 689                 // Transform old size to the new coordinate space.
<span class="line-modified"> 690                 int oldW = (int)Math.ceil(oldIm.getWidth() * ratioX);</span>
<span class="line-modified"> 691                 int oldH = (int)Math.ceil(oldIm.getHeight() * ratioY);</span>
 692 
 693                 Graphics g = pixelsIm.getGraphics();
 694                 try {
 695                     g.drawImage(oldIm, 0, 0, oldW, oldH, null);
 696                 } finally {
 697                     g.dispose();
 698                 }
 699             }
 700         }
 701     }
 702 
 703     @Override
 704     protected void processInputMethodEvent(InputMethodEvent e) {
 705         if (e.getID() == InputMethodEvent.INPUT_METHOD_TEXT_CHANGED) {
 706             sendInputMethodEventToFX(e);
 707         }
 708         super.processInputMethodEvent(e);
 709     }
 710 
 711     private void sendInputMethodEventToFX(InputMethodEvent e) {
</pre>
<hr />
<pre>
 915         pWidth = 0;
 916         pHeight = 0;
 917 
 918         super.removeNotify();
 919 
 920         AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
 921             JFXPanel.this.getToolkit().removeAWTEventListener(ungrabListener);
 922             return null;
 923         });
 924 
 925         /* see CR 4867453 */
 926         getInputContext().removeNotify(this);
 927 
 928         deregisterFinishListener();
 929     }
 930 
 931     private void invokeOnClientEDT(Runnable r) {
 932         jfxPanelIOP.postEvent(this, new InvocationEvent(this, r));
 933     }
 934 
<span class="line-added"> 935     // Package scope method for testing</span>
<span class="line-added"> 936     final BufferedImage test_getPixelsIm() {</span>
<span class="line-added"> 937         return pixelsIm;</span>
<span class="line-added"> 938     }</span>
<span class="line-added"> 939 </span>
 940     private class HostContainer implements HostInterface {
 941 
 942         @Override
 943         public void setEmbeddedStage(EmbeddedStageInterface embeddedStage) {
 944             stagePeer = embeddedStage;
 945             if (stagePeer == null) {
 946                 return;
 947             }
 948             if (pWidth &gt; 0 &amp;&amp; pHeight &gt; 0) {
 949                 stagePeer.setSize(pWidth, pHeight);
 950             }
 951             invokeOnClientEDT(() -&gt; {
 952                 if (stagePeer != null &amp;&amp; JFXPanel.this.isFocusOwner()) {
 953                     stagePeer.setFocused(true, AbstractEvents.FOCUSEVENT_ACTIVATED);
 954                 }
 955             });
 956             sendMoveEventToFX();
 957         }
 958 
 959         @Override
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../javafx.media/src/main/native/vs_project/plugins/plugins.vcxproj.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../javafx.swt/src/main/java/javafx/embed/swt/FXCanvas.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>