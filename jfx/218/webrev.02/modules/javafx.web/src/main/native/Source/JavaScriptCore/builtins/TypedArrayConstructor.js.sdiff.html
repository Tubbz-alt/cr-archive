<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/TypedArrayConstructor.js</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="StringPrototype.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="TypedArrayPrototype.js.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/TypedArrayConstructor.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 // According to the spec we are supposed to crawl the prototype chain looking
 27 // for the a TypedArray constructor. The way we implement this is with a
 28 // private function, @alloctateTypedArray, on each of the prototypes.
 29 // This enables us to optimize this lookup in the inline cache.
 30 
 31 function of(/* items... */)
 32 {
 33     &quot;use strict&quot;;
<span class="line-modified"> 34     let len = arguments.length;</span>
<span class="line-modified"> 35     let constructFunction = @getByIdDirectPrivate(this, &quot;allocateTypedArray&quot;);</span>
 36     if (constructFunction === @undefined)
 37         @throwTypeError(&quot;TypedArray.of requires its this argument to subclass a TypedArray constructor&quot;);
 38 
<span class="line-modified"> 39     let result = constructFunction(len);</span>
 40 
<span class="line-modified"> 41     for (let i = 0; i &lt; len; i++)</span>
 42         result[i] = arguments[i];
 43 
 44     return result;
 45 }
 46 
 47 function from(items /* [ , mapfn [ , thisArg ] ] */)
 48 {
 49     &quot;use strict&quot;;
 50 
<span class="line-modified"> 51     let mapFn = @argument(1);</span>
 52 
<span class="line-modified"> 53     let thisArg;</span>
 54 
 55     if (mapFn !== @undefined) {
 56         if (typeof mapFn !== &quot;function&quot;)
 57             @throwTypeError(&quot;TypedArray.from requires that the second argument, when provided, be a function&quot;);
 58 
 59         thisArg = @argument(2);
 60     }
 61 
<span class="line-modified"> 62     let arrayLike = @toObject(items, &quot;TypedArray.from requires an array-like object - not null or undefined&quot;);</span>
 63 
<span class="line-modified"> 64     let iteratorMethod = items.@iteratorSymbol;</span>
 65     if (iteratorMethod != null) {
 66         if (typeof iteratorMethod !== &quot;function&quot;)
 67             @throwTypeError(&quot;TypedArray.from requires that the property of the first argument, items[Symbol.iterator], when exists, be a function&quot;);
 68 
<span class="line-modified"> 69         let accumulator = [];</span>
 70 
<span class="line-modified"> 71         let k = 0;</span>
<span class="line-modified"> 72         let iterator = iteratorMethod.@call(items);</span>
 73 
 74         // Since for-of loop once more looks up the @@iterator property of a given iterable,
 75         // it could be observable if the user defines a getter for @@iterator.
 76         // To avoid this situation, we define a wrapper object that @@iterator just returns a given iterator.
<span class="line-modified"> 77         let wrapper = {};</span>
 78         wrapper.@iteratorSymbol = function() { return iterator; }
 79 
<span class="line-modified"> 80         for (let value of wrapper) {</span>
 81             if (mapFn)
 82                 @putByValDirect(accumulator, k, thisArg === @undefined ? mapFn(value, k) : mapFn.@call(thisArg, value, k));
 83             else
 84                 @putByValDirect(accumulator, k, value);
 85             k++;
 86         }
 87 
<span class="line-modified"> 88         let constructFunction = @getByIdDirectPrivate(this, &quot;allocateTypedArray&quot;);</span>
 89         if (constructFunction === @undefined)
 90             @throwTypeError(&quot;TypedArray.from requires its this argument subclass a TypedArray constructor&quot;);
 91 
<span class="line-modified"> 92         let result = constructFunction(k);</span>
 93 
<span class="line-modified"> 94         for (let i = 0; i &lt; k; i++) </span>
 95             result[i] = accumulator[i];
 96 
 97 
 98         return result;
 99     }
100 
<span class="line-modified">101     let arrayLikeLength = @toLength(arrayLike.length);</span>
102 
<span class="line-modified">103     let constructFunction = @getByIdDirectPrivate(this, &quot;allocateTypedArray&quot;);</span>
104     if (constructFunction === @undefined)
105         @throwTypeError(&quot;this does not subclass a TypedArray constructor&quot;);
106 
<span class="line-modified">107     let result = constructFunction(arrayLikeLength);</span>
108 
<span class="line-modified">109     let k = 0;</span>
110     while (k &lt; arrayLikeLength) {
<span class="line-modified">111         let value = arrayLike[k];</span>
112         if (mapFn)
113             result[k] = thisArg === @undefined ? mapFn(value, k) : mapFn.@call(thisArg, value, k);
114         else
115             result[k] = value;
116         k++;
117     }
118 
119     return result;
120 }
121 
122 function allocateInt8Array(length)
123 {
124     return new @Int8Array(length);
125 }
126 
127 function allocateInt16Array(length)
128 {
129     return new @Int16Array(length);    
130 }
131 
</pre>
</td>
<td>
<hr />
<pre>
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 // According to the spec we are supposed to crawl the prototype chain looking
 27 // for the a TypedArray constructor. The way we implement this is with a
 28 // private function, @alloctateTypedArray, on each of the prototypes.
 29 // This enables us to optimize this lookup in the inline cache.
 30 
 31 function of(/* items... */)
 32 {
 33     &quot;use strict&quot;;
<span class="line-modified"> 34     var len = arguments.length;</span>
<span class="line-modified"> 35     var constructFunction = @getByIdDirectPrivate(this, &quot;allocateTypedArray&quot;);</span>
 36     if (constructFunction === @undefined)
 37         @throwTypeError(&quot;TypedArray.of requires its this argument to subclass a TypedArray constructor&quot;);
 38 
<span class="line-modified"> 39     var result = constructFunction(len);</span>
 40 
<span class="line-modified"> 41     for (var i = 0; i &lt; len; i++)</span>
 42         result[i] = arguments[i];
 43 
 44     return result;
 45 }
 46 
 47 function from(items /* [ , mapfn [ , thisArg ] ] */)
 48 {
 49     &quot;use strict&quot;;
 50 
<span class="line-modified"> 51     var mapFn = @argument(1);</span>
 52 
<span class="line-modified"> 53     var thisArg;</span>
 54 
 55     if (mapFn !== @undefined) {
 56         if (typeof mapFn !== &quot;function&quot;)
 57             @throwTypeError(&quot;TypedArray.from requires that the second argument, when provided, be a function&quot;);
 58 
 59         thisArg = @argument(2);
 60     }
 61 
<span class="line-modified"> 62     var arrayLike = @toObject(items, &quot;TypedArray.from requires an array-like object - not null or undefined&quot;);</span>
 63 
<span class="line-modified"> 64     var iteratorMethod = items.@iteratorSymbol;</span>
 65     if (iteratorMethod != null) {
 66         if (typeof iteratorMethod !== &quot;function&quot;)
 67             @throwTypeError(&quot;TypedArray.from requires that the property of the first argument, items[Symbol.iterator], when exists, be a function&quot;);
 68 
<span class="line-modified"> 69         var accumulator = [];</span>
 70 
<span class="line-modified"> 71         var k = 0;</span>
<span class="line-modified"> 72         var iterator = iteratorMethod.@call(items);</span>
 73 
 74         // Since for-of loop once more looks up the @@iterator property of a given iterable,
 75         // it could be observable if the user defines a getter for @@iterator.
 76         // To avoid this situation, we define a wrapper object that @@iterator just returns a given iterator.
<span class="line-modified"> 77         var wrapper = {};</span>
 78         wrapper.@iteratorSymbol = function() { return iterator; }
 79 
<span class="line-modified"> 80         for (var value of wrapper) {</span>
 81             if (mapFn)
 82                 @putByValDirect(accumulator, k, thisArg === @undefined ? mapFn(value, k) : mapFn.@call(thisArg, value, k));
 83             else
 84                 @putByValDirect(accumulator, k, value);
 85             k++;
 86         }
 87 
<span class="line-modified"> 88         var constructFunction = @getByIdDirectPrivate(this, &quot;allocateTypedArray&quot;);</span>
 89         if (constructFunction === @undefined)
 90             @throwTypeError(&quot;TypedArray.from requires its this argument subclass a TypedArray constructor&quot;);
 91 
<span class="line-modified"> 92         var result = constructFunction(k);</span>
 93 
<span class="line-modified"> 94         for (var i = 0; i &lt; k; i++)</span>
 95             result[i] = accumulator[i];
 96 
 97 
 98         return result;
 99     }
100 
<span class="line-modified">101     var arrayLikeLength = @toLength(arrayLike.length);</span>
102 
<span class="line-modified">103     var constructFunction = @getByIdDirectPrivate(this, &quot;allocateTypedArray&quot;);</span>
104     if (constructFunction === @undefined)
105         @throwTypeError(&quot;this does not subclass a TypedArray constructor&quot;);
106 
<span class="line-modified">107     var result = constructFunction(arrayLikeLength);</span>
108 
<span class="line-modified">109     var k = 0;</span>
110     while (k &lt; arrayLikeLength) {
<span class="line-modified">111         var value = arrayLike[k];</span>
112         if (mapFn)
113             result[k] = thisArg === @undefined ? mapFn(value, k) : mapFn.@call(thisArg, value, k);
114         else
115             result[k] = value;
116         k++;
117     }
118 
119     return result;
120 }
121 
122 function allocateInt8Array(length)
123 {
124     return new @Int8Array(length);
125 }
126 
127 function allocateInt16Array(length)
128 {
129     return new @Int16Array(length);    
130 }
131 
</pre>
</td>
</tr>
</table>
<center><a href="StringPrototype.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="TypedArrayPrototype.js.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>