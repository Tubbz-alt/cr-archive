<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/html/canvas/WebGLProgram.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="WebGLObject.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="WebGLProgram.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/html/canvas/WebGLProgram.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 26,14 ***</span>
  #include &quot;config.h&quot;
  #include &quot;WebGLProgram.h&quot;
  
  #if ENABLE(WEBGL)
  
  #include &quot;WebGLContextGroup.h&quot;
  #include &quot;WebGLRenderingContextBase.h&quot;
  #include &quot;WebGLShader.h&quot;
<span class="line-removed">- #include &lt;wtf/HashMap.h&gt;</span>
  #include &lt;wtf/Lock.h&gt;
  #include &lt;wtf/NeverDestroyed.h&gt;
  
  namespace WebCore {
  
<span class="line-new-header">--- 26,15 ---</span>
  #include &quot;config.h&quot;
  #include &quot;WebGLProgram.h&quot;
  
  #if ENABLE(WEBGL)
  
<span class="line-added">+ #include &quot;InspectorInstrumentation.h&quot;</span>
<span class="line-added">+ #include &quot;ScriptExecutionContext.h&quot;</span>
  #include &quot;WebGLContextGroup.h&quot;
  #include &quot;WebGLRenderingContextBase.h&quot;
  #include &quot;WebGLShader.h&quot;
  #include &lt;wtf/Lock.h&gt;
  #include &lt;wtf/NeverDestroyed.h&gt;
  
  namespace WebCore {
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 58,31 ***</span>
      return adoptRef(*new WebGLProgram(ctx));
  }
  
  WebGLProgram::WebGLProgram(WebGLRenderingContextBase&amp; ctx)
      : WebGLSharedObject(ctx)
  {
      {
          LockHolder lock(instancesMutex());
          instances(lock).add(this, &amp;ctx);
      }
  
<span class="line-modified">!     setObject(ctx.graphicsContext3D()-&gt;createProgram());</span>
  }
  
  WebGLProgram::~WebGLProgram()
  {
      deleteObject(0);
  
      {
          LockHolder lock(instancesMutex());
          ASSERT(instances(lock).contains(this));
          instances(lock).remove(this);
      }
  }
  
<span class="line-modified">! void WebGLProgram::deleteObjectImpl(GraphicsContext3D* context3d, Platform3DObject obj)</span>
  {
      context3d-&gt;deleteProgram(obj);
      if (m_vertexShader) {
          m_vertexShader-&gt;onDetached(context3d);
          m_vertexShader = nullptr;
<span class="line-new-header">--- 59,43 ---</span>
      return adoptRef(*new WebGLProgram(ctx));
  }
  
  WebGLProgram::WebGLProgram(WebGLRenderingContextBase&amp; ctx)
      : WebGLSharedObject(ctx)
<span class="line-added">+     , ContextDestructionObserver(ctx.scriptExecutionContext())</span>
  {
<span class="line-added">+     ASSERT(scriptExecutionContext());</span>
<span class="line-added">+ </span>
      {
          LockHolder lock(instancesMutex());
          instances(lock).add(this, &amp;ctx);
      }
  
<span class="line-modified">!     setObject(ctx.graphicsContextGL()-&gt;createProgram());</span>
  }
  
  WebGLProgram::~WebGLProgram()
  {
<span class="line-added">+     InspectorInstrumentation::willDestroyWebGLProgram(*this);</span>
<span class="line-added">+ </span>
      deleteObject(0);
  
      {
          LockHolder lock(instancesMutex());
          ASSERT(instances(lock).contains(this));
          instances(lock).remove(this);
      }
  }
  
<span class="line-modified">! void WebGLProgram::contextDestroyed()</span>
<span class="line-added">+ {</span>
<span class="line-added">+     InspectorInstrumentation::willDestroyWebGLProgram(*this);</span>
<span class="line-added">+ </span>
<span class="line-added">+     ContextDestructionObserver::contextDestroyed();</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ void WebGLProgram::deleteObjectImpl(GraphicsContextGLOpenGL* context3d, PlatformGLObject obj)</span>
  {
      context3d-&gt;deleteProgram(obj);
      if (m_vertexShader) {
          m_vertexShader-&gt;onDetached(context3d);
          m_vertexShader = nullptr;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 97,11 ***</span>
  {
      cacheInfoIfNeeded();
      return m_activeAttribLocations.size();
  }
  
<span class="line-modified">! GC3Dint WebGLProgram::getActiveAttribLocation(GC3Duint index)</span>
  {
      cacheInfoIfNeeded();
      if (index &gt;= numActiveAttribLocations())
          return -1;
      return m_activeAttribLocations[index];
<span class="line-new-header">--- 110,11 ---</span>
  {
      cacheInfoIfNeeded();
      return m_activeAttribLocations.size();
  }
  
<span class="line-modified">! GCGLint WebGLProgram::getActiveAttribLocation(GCGLuint index)</span>
  {
      cacheInfoIfNeeded();
      if (index &gt;= numActiveAttribLocations())
          return -1;
      return m_activeAttribLocations[index];
</pre>
<hr />
<pre>
<span class="line-old-header">*** 133,16 ***</span>
  {
      ++m_linkCount;
      m_infoValid = false;
  }
  
<span class="line-modified">! WebGLShader* WebGLProgram::getAttachedShader(GC3Denum type)</span>
  {
      switch (type) {
<span class="line-modified">!     case GraphicsContext3D::VERTEX_SHADER:</span>
          return m_vertexShader.get();
<span class="line-modified">!     case GraphicsContext3D::FRAGMENT_SHADER:</span>
          return m_fragmentShader.get();
      default:
          return 0;
      }
  }
<span class="line-new-header">--- 146,16 ---</span>
  {
      ++m_linkCount;
      m_infoValid = false;
  }
  
<span class="line-modified">! WebGLShader* WebGLProgram::getAttachedShader(GCGLenum type)</span>
  {
      switch (type) {
<span class="line-modified">!     case GraphicsContextGL::VERTEX_SHADER:</span>
          return m_vertexShader.get();
<span class="line-modified">!     case GraphicsContextGL::FRAGMENT_SHADER:</span>
          return m_fragmentShader.get();
      default:
          return 0;
      }
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 150,16 ***</span>
  bool WebGLProgram::attachShader(WebGLShader* shader)
  {
      if (!shader || !shader-&gt;object())
          return false;
      switch (shader-&gt;getType()) {
<span class="line-modified">!     case GraphicsContext3D::VERTEX_SHADER:</span>
          if (m_vertexShader)
              return false;
          m_vertexShader = shader;
          return true;
<span class="line-modified">!     case GraphicsContext3D::FRAGMENT_SHADER:</span>
          if (m_fragmentShader)
              return false;
          m_fragmentShader = shader;
          return true;
      default:
<span class="line-new-header">--- 163,16 ---</span>
  bool WebGLProgram::attachShader(WebGLShader* shader)
  {
      if (!shader || !shader-&gt;object())
          return false;
      switch (shader-&gt;getType()) {
<span class="line-modified">!     case GraphicsContextGL::VERTEX_SHADER:</span>
          if (m_vertexShader)
              return false;
          m_vertexShader = shader;
          return true;
<span class="line-modified">!     case GraphicsContextGL::FRAGMENT_SHADER:</span>
          if (m_fragmentShader)
              return false;
          m_fragmentShader = shader;
          return true;
      default:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 170,34 ***</span>
  bool WebGLProgram::detachShader(WebGLShader* shader)
  {
      if (!shader || !shader-&gt;object())
          return false;
      switch (shader-&gt;getType()) {
<span class="line-modified">!     case GraphicsContext3D::VERTEX_SHADER:</span>
          if (m_vertexShader != shader)
              return false;
          m_vertexShader = nullptr;
          return true;
<span class="line-modified">!     case GraphicsContext3D::FRAGMENT_SHADER:</span>
          if (m_fragmentShader != shader)
              return false;
          m_fragmentShader = nullptr;
          return true;
      default:
          return false;
      }
  }
  
<span class="line-modified">! void WebGLProgram::cacheActiveAttribLocations(GraphicsContext3D* context3d)</span>
  {
      m_activeAttribLocations.clear();
  
<span class="line-modified">!     GC3Dint numAttribs = 0;</span>
<span class="line-modified">!     context3d-&gt;getProgramiv(object(), GraphicsContext3D::ACTIVE_ATTRIBUTES, &amp;numAttribs);</span>
      m_activeAttribLocations.resize(static_cast&lt;size_t&gt;(numAttribs));
      for (int i = 0; i &lt; numAttribs; ++i) {
<span class="line-modified">!         ActiveInfo info;</span>
          context3d-&gt;getActiveAttribImpl(object(), i, info);
          m_activeAttribLocations[i] = context3d-&gt;getAttribLocation(object(), info.name);
      }
  }
  
<span class="line-new-header">--- 183,34 ---</span>
  bool WebGLProgram::detachShader(WebGLShader* shader)
  {
      if (!shader || !shader-&gt;object())
          return false;
      switch (shader-&gt;getType()) {
<span class="line-modified">!     case GraphicsContextGL::VERTEX_SHADER:</span>
          if (m_vertexShader != shader)
              return false;
          m_vertexShader = nullptr;
          return true;
<span class="line-modified">!     case GraphicsContextGL::FRAGMENT_SHADER:</span>
          if (m_fragmentShader != shader)
              return false;
          m_fragmentShader = nullptr;
          return true;
      default:
          return false;
      }
  }
  
<span class="line-modified">! void WebGLProgram::cacheActiveAttribLocations(GraphicsContextGLOpenGL* context3d)</span>
  {
      m_activeAttribLocations.clear();
  
<span class="line-modified">!     GCGLint numAttribs = 0;</span>
<span class="line-modified">!     context3d-&gt;getProgramiv(object(), GraphicsContextGL::ACTIVE_ATTRIBUTES, &amp;numAttribs);</span>
      m_activeAttribLocations.resize(static_cast&lt;size_t&gt;(numAttribs));
      for (int i = 0; i &lt; numAttribs; ++i) {
<span class="line-modified">!         GraphicsContextGL::ActiveInfo info;</span>
          context3d-&gt;getActiveAttribImpl(object(), i, info);
          m_activeAttribLocations[i] = context3d-&gt;getAttribLocation(object(), info.name);
      }
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 207,15 ***</span>
          return;
  
      if (!object())
          return;
  
<span class="line-modified">!     GraphicsContext3D* context = getAGraphicsContext3D();</span>
      if (!context)
          return;
<span class="line-modified">!     GC3Dint linkStatus = 0;</span>
<span class="line-modified">!     context-&gt;getProgramiv(object(), GraphicsContext3D::LINK_STATUS, &amp;linkStatus);</span>
      m_linkStatus = linkStatus;
      if (m_linkStatus)
          cacheActiveAttribLocations(context);
      m_infoValid = true;
  }
<span class="line-new-header">--- 220,15 ---</span>
          return;
  
      if (!object())
          return;
  
<span class="line-modified">!     GraphicsContextGLOpenGL* context = getAGraphicsContextGL();</span>
      if (!context)
          return;
<span class="line-modified">!     GCGLint linkStatus = 0;</span>
<span class="line-modified">!     context-&gt;getProgramiv(object(), GraphicsContextGL::LINK_STATUS, &amp;linkStatus);</span>
      m_linkStatus = linkStatus;
      if (m_linkStatus)
          cacheActiveAttribLocations(context);
      m_infoValid = true;
  }
</pre>
<center><a href="WebGLObject.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="WebGLProgram.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>