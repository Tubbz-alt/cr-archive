<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/testing/MockCDMFactory.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MockCDMFactory.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MockContentFilter.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/testing/MockCDMFactory.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 82     Vector&lt;Ref&lt;SharedBuffer&gt;&gt; removeKeysFromSessionWithID(const String&amp; id);
 83 
 84 private:
 85     MockCDMFactory();
 86     std::unique_ptr&lt;CDMPrivate&gt; createCDM(const String&amp;) final;
 87     bool supportsKeySystem(const String&amp;) final;
 88 
 89     MediaKeysRequirement m_distinctiveIdentifiersRequirement { MediaKeysRequirement::Optional };
 90     MediaKeysRequirement m_persistentStateRequirement { MediaKeysRequirement::Optional };
 91     Vector&lt;AtomString&gt; m_supportedDataTypes;
 92     Vector&lt;MediaKeySessionType&gt; m_supportedSessionTypes;
 93     Vector&lt;String&gt; m_supportedRobustness;
 94     Vector&lt;MediaKeyEncryptionScheme&gt; m_supportedEncryptionSchemes;
 95     bool m_registered { true };
 96     bool m_canCreateInstances { true };
 97     bool m_supportsServerCertificates { true };
 98     bool m_supportsSessions { true };
 99     HashMap&lt;String, Vector&lt;Ref&lt;SharedBuffer&gt;&gt;&gt; m_sessions;
100 };
101 





102 class MockCDM : public CDMPrivate, public CanMakeWeakPtr&lt;MockCDM&gt; {
103     WTF_MAKE_FAST_ALLOCATED;
104 public:
105     MockCDM(WeakPtr&lt;MockCDMFactory&gt;);
106 
107     MockCDMFactory* factory() { return m_factory.get(); }
108 
109 private:
110     friend class MockCDMInstance;
111 
112     bool supportsInitDataType(const AtomString&amp;) const final;
113     bool supportsConfiguration(const MediaKeySystemConfiguration&amp;) const final;
114     bool supportsConfigurationWithRestrictions(const MediaKeySystemConfiguration&amp;, const MediaKeysRestrictions&amp;) const final;
115     bool supportsSessionTypeWithConfiguration(MediaKeySessionType&amp;, const MediaKeySystemConfiguration&amp;) const final;
116     bool supportsRobustness(const String&amp;) const final;
117     MediaKeysRequirement distinctiveIdentifiersRequirement(const MediaKeySystemConfiguration&amp;, const MediaKeysRestrictions&amp;) const final;
118     MediaKeysRequirement persistentStateRequirement(const MediaKeySystemConfiguration&amp;, const MediaKeysRestrictions&amp;) const final;
119     bool distinctiveIdentifiersAreUniquePerOriginAndClearable(const MediaKeySystemConfiguration&amp;) const final;
120     RefPtr&lt;CDMInstance&gt; createInstance() final;
121     void loadAndInitialize() final;
</pre>
<hr />
<pre>
128     WeakPtr&lt;MockCDMFactory&gt; m_factory;
129 };
130 
131 class MockCDMInstance : public CDMInstance, public CanMakeWeakPtr&lt;MockCDMInstance&gt; {
132 public:
133     MockCDMInstance(WeakPtr&lt;MockCDM&gt;);
134 
135     MockCDMFactory* factory() const { return m_cdm ? m_cdm-&gt;factory() : nullptr; }
136     bool distinctiveIdentifiersAllowed() const { return m_distinctiveIdentifiersAllowed; }
137     bool persistentStateAllowed() const { return m_persistentStateAllowed; }
138 
139 private:
140     ImplementationType implementationType() const final { return ImplementationType::Mock; }
141     SuccessValue initializeWithConfiguration(const MediaKeySystemConfiguration&amp;) final;
142     SuccessValue setDistinctiveIdentifiersAllowed(bool) final;
143     SuccessValue setPersistentStateAllowed(bool) final;
144     SuccessValue setServerCertificate(Ref&lt;SharedBuffer&gt;&amp;&amp;) final;
145     SuccessValue setStorageDirectory(const String&amp;) final;
146     const String&amp; keySystem() const final;
147     RefPtr&lt;CDMInstanceSession&gt; createSession() final;

148 
149     WeakPtr&lt;MockCDM&gt; m_cdm;
150     bool m_distinctiveIdentifiersAllowed { true };
151     bool m_persistentStateAllowed { true };
152 };
153 
154 class MockCDMInstanceSession : public CDMInstanceSession {
155 public:
156     MockCDMInstanceSession(WeakPtr&lt;MockCDMInstance&gt;&amp;&amp;);
157 
158 private:
159     void requestLicense(LicenseType, const AtomString&amp; initDataType, Ref&lt;SharedBuffer&gt;&amp;&amp; initData, LicenseCallback&amp;&amp;) final;
160     void updateLicense(const String&amp;, LicenseType, const SharedBuffer&amp;, LicenseUpdateCallback&amp;&amp;) final;
161     void loadSession(LicenseType, const String&amp;, const String&amp;, LoadSessionCallback&amp;&amp;) final;
162     void closeSession(const String&amp;, CloseSessionCallback&amp;&amp;) final;
163     void removeSessionData(const String&amp;, LicenseType, RemoveSessionDataCallback&amp;&amp;) final;
164     void storeRecordOfKeyUsage(const String&amp;) final;
165 
166     WeakPtr&lt;MockCDMInstance&gt; m_instance;
167 };
</pre>
</td>
<td>
<hr />
<pre>
 82     Vector&lt;Ref&lt;SharedBuffer&gt;&gt; removeKeysFromSessionWithID(const String&amp; id);
 83 
 84 private:
 85     MockCDMFactory();
 86     std::unique_ptr&lt;CDMPrivate&gt; createCDM(const String&amp;) final;
 87     bool supportsKeySystem(const String&amp;) final;
 88 
 89     MediaKeysRequirement m_distinctiveIdentifiersRequirement { MediaKeysRequirement::Optional };
 90     MediaKeysRequirement m_persistentStateRequirement { MediaKeysRequirement::Optional };
 91     Vector&lt;AtomString&gt; m_supportedDataTypes;
 92     Vector&lt;MediaKeySessionType&gt; m_supportedSessionTypes;
 93     Vector&lt;String&gt; m_supportedRobustness;
 94     Vector&lt;MediaKeyEncryptionScheme&gt; m_supportedEncryptionSchemes;
 95     bool m_registered { true };
 96     bool m_canCreateInstances { true };
 97     bool m_supportsServerCertificates { true };
 98     bool m_supportsSessions { true };
 99     HashMap&lt;String, Vector&lt;Ref&lt;SharedBuffer&gt;&gt;&gt; m_sessions;
100 };
101 
<span class="line-added">102 class ProxyCDMMock final : public ProxyCDM {</span>
<span class="line-added">103 public:</span>
<span class="line-added">104     virtual ~ProxyCDMMock();</span>
<span class="line-added">105 };</span>
<span class="line-added">106 </span>
107 class MockCDM : public CDMPrivate, public CanMakeWeakPtr&lt;MockCDM&gt; {
108     WTF_MAKE_FAST_ALLOCATED;
109 public:
110     MockCDM(WeakPtr&lt;MockCDMFactory&gt;);
111 
112     MockCDMFactory* factory() { return m_factory.get(); }
113 
114 private:
115     friend class MockCDMInstance;
116 
117     bool supportsInitDataType(const AtomString&amp;) const final;
118     bool supportsConfiguration(const MediaKeySystemConfiguration&amp;) const final;
119     bool supportsConfigurationWithRestrictions(const MediaKeySystemConfiguration&amp;, const MediaKeysRestrictions&amp;) const final;
120     bool supportsSessionTypeWithConfiguration(MediaKeySessionType&amp;, const MediaKeySystemConfiguration&amp;) const final;
121     bool supportsRobustness(const String&amp;) const final;
122     MediaKeysRequirement distinctiveIdentifiersRequirement(const MediaKeySystemConfiguration&amp;, const MediaKeysRestrictions&amp;) const final;
123     MediaKeysRequirement persistentStateRequirement(const MediaKeySystemConfiguration&amp;, const MediaKeysRestrictions&amp;) const final;
124     bool distinctiveIdentifiersAreUniquePerOriginAndClearable(const MediaKeySystemConfiguration&amp;) const final;
125     RefPtr&lt;CDMInstance&gt; createInstance() final;
126     void loadAndInitialize() final;
</pre>
<hr />
<pre>
133     WeakPtr&lt;MockCDMFactory&gt; m_factory;
134 };
135 
136 class MockCDMInstance : public CDMInstance, public CanMakeWeakPtr&lt;MockCDMInstance&gt; {
137 public:
138     MockCDMInstance(WeakPtr&lt;MockCDM&gt;);
139 
140     MockCDMFactory* factory() const { return m_cdm ? m_cdm-&gt;factory() : nullptr; }
141     bool distinctiveIdentifiersAllowed() const { return m_distinctiveIdentifiersAllowed; }
142     bool persistentStateAllowed() const { return m_persistentStateAllowed; }
143 
144 private:
145     ImplementationType implementationType() const final { return ImplementationType::Mock; }
146     SuccessValue initializeWithConfiguration(const MediaKeySystemConfiguration&amp;) final;
147     SuccessValue setDistinctiveIdentifiersAllowed(bool) final;
148     SuccessValue setPersistentStateAllowed(bool) final;
149     SuccessValue setServerCertificate(Ref&lt;SharedBuffer&gt;&amp;&amp;) final;
150     SuccessValue setStorageDirectory(const String&amp;) final;
151     const String&amp; keySystem() const final;
152     RefPtr&lt;CDMInstanceSession&gt; createSession() final;
<span class="line-added">153     RefPtr&lt;ProxyCDM&gt; proxyCDM() const final;</span>
154 
155     WeakPtr&lt;MockCDM&gt; m_cdm;
156     bool m_distinctiveIdentifiersAllowed { true };
157     bool m_persistentStateAllowed { true };
158 };
159 
160 class MockCDMInstanceSession : public CDMInstanceSession {
161 public:
162     MockCDMInstanceSession(WeakPtr&lt;MockCDMInstance&gt;&amp;&amp;);
163 
164 private:
165     void requestLicense(LicenseType, const AtomString&amp; initDataType, Ref&lt;SharedBuffer&gt;&amp;&amp; initData, LicenseCallback&amp;&amp;) final;
166     void updateLicense(const String&amp;, LicenseType, const SharedBuffer&amp;, LicenseUpdateCallback&amp;&amp;) final;
167     void loadSession(LicenseType, const String&amp;, const String&amp;, LoadSessionCallback&amp;&amp;) final;
168     void closeSession(const String&amp;, CloseSessionCallback&amp;&amp;) final;
169     void removeSessionData(const String&amp;, LicenseType, RemoveSessionDataCallback&amp;&amp;) final;
170     void storeRecordOfKeyUsage(const String&amp;) final;
171 
172     WeakPtr&lt;MockCDMInstance&gt; m_instance;
173 };
</pre>
</td>
</tr>
</table>
<center><a href="MockCDMFactory.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MockContentFilter.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>