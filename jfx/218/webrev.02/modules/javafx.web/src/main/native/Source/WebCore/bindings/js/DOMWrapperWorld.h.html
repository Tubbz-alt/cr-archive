<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/bindings/js/DOMWrapperWorld.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  *  Copyright (C) 1999-2001 Harri Porten (porten@kde.org)
  3  *  Copyright (C) 2003, 2004, 2005, 2006, 2008, 2009 Apple Inc. All rights reserved.
  4  *  Copyright (C) 2007 Samuel Weinig &lt;sam@webkit.org&gt;
  5  *  Copyright (C) 2009 Google, Inc. All rights reserved.
  6  *
  7  *  This library is free software; you can redistribute it and/or
  8  *  modify it under the terms of the GNU Lesser General Public
  9  *  License as published by the Free Software Foundation; either
 10  *  version 2 of the License, or (at your option) any later version.
 11  *
 12  *  This library is distributed in the hope that it will be useful,
 13  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 14  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 15  *  Lesser General Public License for more details.
 16  *
 17  *  You should have received a copy of the GNU Lesser General Public
 18  *  License along with this library; if not, write to the Free Software
 19  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 20  */
 21 
 22 #pragma once
 23 
 24 #include &quot;JSDOMGlobalObject.h&quot;
 25 #include &lt;wtf/Forward.h&gt;
 26 
 27 namespace WebCore {
 28 
 29 class WindowProxy;
 30 
 31 typedef HashMap&lt;void*, JSC::Weak&lt;JSC::JSObject&gt;&gt; DOMObjectWrapperMap;
 32 
 33 class DOMWrapperWorld : public RefCounted&lt;DOMWrapperWorld&gt; {
 34 public:
 35     enum class Type {
 36         Normal,   // Main (e.g. Page)
 37         User,     // User Scripts (e.g. Extensions)
 38         Internal, // WebKit Internal (e.g. Media Controls)
 39     };
 40 
 41     static Ref&lt;DOMWrapperWorld&gt; create(JSC::VM&amp; vm, Type type = Type::Internal, const String&amp; name = { })
 42     {
 43         return adoptRef(*new DOMWrapperWorld(vm, type, name));
 44     }
 45     WEBCORE_EXPORT ~DOMWrapperWorld();
 46 
 47     // Free as much memory held onto by this world as possible.
 48     WEBCORE_EXPORT void clearWrappers();
 49 
 50     void didCreateWindowProxy(WindowProxy* controller) { m_jsWindowProxies.add(controller); }
 51     void didDestroyWindowProxy(WindowProxy* controller) { m_jsWindowProxies.remove(controller); }
 52 
 53     void setShadowRootIsAlwaysOpen() { m_shadowRootIsAlwaysOpen = true; }
 54     bool shadowRootIsAlwaysOpen() const { return m_shadowRootIsAlwaysOpen; }
 55 
 56     void disableOverrideBuiltinsBehavior() { m_shouldDisableOverrideBuiltinsBehavior = true; }
 57     bool shouldDisableOverrideBuiltinsBehavior() const { return m_shouldDisableOverrideBuiltinsBehavior; }
 58 
 59     DOMObjectWrapperMap&amp; wrappers() { return m_wrappers; }
 60 
 61     Type type() const { return m_type; }
 62     bool isNormal() const { return m_type == Type::Normal; }
 63 
 64     const String&amp; name() const { return m_name; }
 65 
 66     JSC::VM&amp; vm() const { return m_vm; }
 67 
 68 protected:
 69     DOMWrapperWorld(JSC::VM&amp;, Type, const String&amp; name);
 70 
 71 private:
 72     JSC::VM&amp; m_vm;
 73     HashSet&lt;WindowProxy*&gt; m_jsWindowProxies;
 74     DOMObjectWrapperMap m_wrappers;
 75 
 76     String m_name;
 77     Type m_type { Type::Internal };
 78 
 79     bool m_shadowRootIsAlwaysOpen { false };
 80     bool m_shouldDisableOverrideBuiltinsBehavior { false };
 81 };
 82 
 83 DOMWrapperWorld&amp; normalWorld(JSC::VM&amp;);
 84 WEBCORE_EXPORT DOMWrapperWorld&amp; mainThreadNormalWorld();
 85 
 86 inline DOMWrapperWorld&amp; debuggerWorld() { return mainThreadNormalWorld(); }
 87 inline DOMWrapperWorld&amp; pluginWorld() { return mainThreadNormalWorld(); }
 88 
 89 DOMWrapperWorld&amp; currentWorld(JSC::JSGlobalObject&amp;);
 90 DOMWrapperWorld&amp; worldForDOMObject(JSC::JSObject&amp;);
 91 
 92 // Helper function for code paths that must not share objects across isolated DOM worlds.
 93 bool isWorldCompatible(JSC::JSGlobalObject&amp;, JSC::JSValue);
 94 
 95 inline DOMWrapperWorld&amp; currentWorld(JSC::JSGlobalObject&amp; lexicalGlobalObject)
 96 {
 97     return JSC::jsCast&lt;JSDOMGlobalObject*&gt;(&amp;lexicalGlobalObject)-&gt;world();
 98 }
 99 
100 inline DOMWrapperWorld&amp; worldForDOMObject(JSC::JSObject&amp; object)
101 {
102     return JSC::jsCast&lt;JSDOMGlobalObject*&gt;(object.globalObject())-&gt;world();
103 }
104 
105 inline bool isWorldCompatible(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::JSValue value)
106 {
107     return !value.isObject() || &amp;worldForDOMObject(*value.getObject()) == &amp;currentWorld(lexicalGlobalObject);
108 }
109 
110 } // namespace WebCore
    </pre>
  </body>
</html>