<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/css/StyleProperties.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="StyleProperties.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StyleRule.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/css/StyleProperties.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -48,11 +48,11 @@</span>
  
  class StylePropertiesBase : public RefCounted&lt;StylePropertiesBase&gt; {
  public:
      // Override RefCounted&#39;s deref() to ensure operator delete is called on
      // the appropriate subclass type.
<span class="udiff-line-modified-removed">-     void deref();</span>
<span class="udiff-line-modified-added">+     void deref() const;</span>
  
      StylePropertiesType type() const { return static_cast&lt;StylePropertiesType&gt;(m_type); }
  
      CSSParserMode cssParserMode() const { return static_cast&lt;CSSParserMode&gt;(m_cssParserMode); }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -72,11 +72,13 @@</span>
      unsigned m_cssParserMode : 3;
      mutable unsigned m_type : 2;
      unsigned m_arraySize : 27;
  };
  
<span class="udiff-line-added">+ DECLARE_ALLOCATOR_WITH_HEAP_IDENTIFIER(StyleProperties);</span>
  class StyleProperties : public StylePropertiesBase {
<span class="udiff-line-added">+     WTF_MAKE_FAST_ALLOCATED_WITH_HEAP_IDENTIFIER(StyleProperties);</span>
      friend class PropertyReference;
  public:
      class PropertyReference {
      public:
          PropertyReference(const StylePropertyMetadata&amp; metadata, const CSSValue* value)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -157,11 +159,12 @@</span>
  
      int findPropertyIndex(CSSPropertyID) const;
      int findCustomPropertyIndex(const String&amp; propertyName) const;
  
  private:
<span class="udiff-line-modified-removed">-     String getShorthandValue(const StylePropertyShorthand&amp;) const;</span>
<span class="udiff-line-modified-added">+     String getGridShorthandValue(const StylePropertyShorthand&amp;) const;</span>
<span class="udiff-line-added">+     String getShorthandValue(const StylePropertyShorthand&amp;, const char* separator = &quot; &quot;) const;</span>
      String getCommonValue(const StylePropertyShorthand&amp;) const;
      String getAlignmentShorthandValue(const StylePropertyShorthand&amp;) const;
      String borderPropertyValue(const StylePropertyShorthand&amp;, const StylePropertyShorthand&amp;, const StylePropertyShorthand&amp;) const;
      String pageBreakPropertyValue(const StylePropertyShorthand&amp;) const;
      String getLayeredShorthandValue(const StylePropertyShorthand&amp;) const;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -174,44 +177,48 @@</span>
      RefPtr&lt;CSSValue&gt; getPropertyCSSValueInternal(CSSPropertyID) const;
  
      friend class PropertySetCSSStyleDeclaration;
  };
  
<span class="udiff-line-added">+ DECLARE_ALLOCATOR_WITH_HEAP_IDENTIFIER(ImmutableStyleProperties);</span>
  class ImmutableStyleProperties final : public StyleProperties {
<span class="udiff-line-added">+     WTF_MAKE_FAST_ALLOCATED_WITH_HEAP_IDENTIFIER(ImmutableStyleProperties);</span>
  public:
      WEBCORE_EXPORT ~ImmutableStyleProperties();
      static Ref&lt;ImmutableStyleProperties&gt; create(const CSSProperty* properties, unsigned count, CSSParserMode);
  
      unsigned propertyCount() const { return m_arraySize; }
      bool isEmpty() const { return !propertyCount(); }
      PropertyReference propertyAt(unsigned index) const;
  
<span class="udiff-line-removed">-     const CSSValue** valueArray() const;</span>
<span class="udiff-line-removed">-     const StylePropertyMetadata* metadataArray() const;</span>
      int findPropertyIndex(CSSPropertyID) const;
      int findCustomPropertyIndex(const String&amp; propertyName) const;
  
      void* m_storage;
  
  private:
<span class="udiff-line-added">+     PackedPtr&lt;const CSSValue&gt;* valueArray() const;</span>
<span class="udiff-line-added">+     const StylePropertyMetadata* metadataArray() const;</span>
      ImmutableStyleProperties(const CSSProperty*, unsigned count, CSSParserMode);
  };
  
<span class="udiff-line-modified-removed">- inline const CSSValue** ImmutableStyleProperties::valueArray() const</span>
<span class="udiff-line-modified-added">+ inline PackedPtr&lt;const CSSValue&gt;* ImmutableStyleProperties::valueArray() const</span>
  {
<span class="udiff-line-modified-removed">-     return reinterpret_cast&lt;const CSSValue**&gt;(const_cast&lt;const void**&gt;((&amp;(this-&gt;m_storage))));</span>
<span class="udiff-line-modified-added">+     return bitwise_cast&lt;PackedPtr&lt;const CSSValue&gt;*&gt;(bitwise_cast&lt;const uint8_t*&gt;(metadataArray()) + (m_arraySize * sizeof(StylePropertyMetadata)));</span>
  }
  
  inline const StylePropertyMetadata* ImmutableStyleProperties::metadataArray() const
  {
<span class="udiff-line-modified-removed">-     return reinterpret_cast_ptr&lt;const StylePropertyMetadata*&gt;(&amp;reinterpret_cast_ptr&lt;const char*&gt;(&amp;(this-&gt;m_storage))[m_arraySize * sizeof(CSSValue*)]);</span>
<span class="udiff-line-modified-added">+     return reinterpret_cast&lt;const StylePropertyMetadata*&gt;(const_cast&lt;const void**&gt;((&amp;(this-&gt;m_storage))));</span>
  }
  
<span class="udiff-line-added">+ DECLARE_ALLOCATOR_WITH_HEAP_IDENTIFIER(MutableStyleProperties);</span>
  class MutableStyleProperties final : public StyleProperties {
<span class="udiff-line-added">+     WTF_MAKE_FAST_ALLOCATED_WITH_HEAP_IDENTIFIER(MutableStyleProperties);</span>
  public:
      WEBCORE_EXPORT static Ref&lt;MutableStyleProperties&gt; create(CSSParserMode = HTMLQuirksMode);
<span class="udiff-line-modified-removed">-     static Ref&lt;MutableStyleProperties&gt; create(const CSSProperty* properties, unsigned count);</span>
<span class="udiff-line-modified-added">+     static Ref&lt;MutableStyleProperties&gt; create(Vector&lt;CSSProperty&gt;&amp;&amp;);</span>
  
      WEBCORE_EXPORT ~MutableStyleProperties();
  
      unsigned propertyCount() const { return m_propertyVector.size(); }
      bool isEmpty() const { return !propertyCount(); }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -254,11 +261,11 @@</span>
      bool removeCustomProperty(const String&amp; propertyName, String* returnText = nullptr);
  
  private:
      explicit MutableStyleProperties(CSSParserMode);
      explicit MutableStyleProperties(const StyleProperties&amp;);
<span class="udiff-line-modified-removed">-     MutableStyleProperties(const CSSProperty* properties, unsigned count);</span>
<span class="udiff-line-modified-added">+     MutableStyleProperties(Vector&lt;CSSProperty&gt;&amp;&amp;);</span>
  
      bool removeShorthandProperty(CSSPropertyID);
      CSSProperty* findCSSPropertyWithID(CSSPropertyID);
      CSSProperty* findCustomCSSPropertyWithName(const String&amp;);
      std::unique_ptr&lt;PropertySetCSSStyleDeclaration&gt; m_cssomWrapper;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -280,11 +287,11 @@</span>
      Ref&lt;CSSDeferredParser&gt; m_parser;
  };
  
  inline ImmutableStyleProperties::PropertyReference ImmutableStyleProperties::propertyAt(unsigned index) const
  {
<span class="udiff-line-modified-removed">-     return PropertyReference(metadataArray()[index], valueArray()[index]);</span>
<span class="udiff-line-modified-added">+     return PropertyReference(metadataArray()[index], valueArray()[index].get());</span>
  }
  
  inline MutableStyleProperties::PropertyReference MutableStyleProperties::propertyAt(unsigned index) const
  {
      const CSSProperty&amp; property = m_propertyVector[index];
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -303,11 +310,11 @@</span>
      if (is&lt;MutableStyleProperties&gt;(*this))
          return downcast&lt;MutableStyleProperties&gt;(*this).propertyCount();
      return downcast&lt;ImmutableStyleProperties&gt;(*this).propertyCount();
  }
  
<span class="udiff-line-modified-removed">- inline void StylePropertiesBase::deref()</span>
<span class="udiff-line-modified-added">+ inline void StylePropertiesBase::deref() const</span>
  {
      if (!derefBase())
          return;
  
      if (is&lt;MutableStyleProperties&gt;(*this))
</pre>
<center><a href="StyleProperties.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StyleRule.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>