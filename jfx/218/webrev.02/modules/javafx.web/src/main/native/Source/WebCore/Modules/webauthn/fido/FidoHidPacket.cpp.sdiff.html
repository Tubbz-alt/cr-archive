<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/Modules/webauthn/fido/FidoHidPacket.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FidoHidMessage.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="U2fCommandConstructor.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/webauthn/fido/FidoHidPacket.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 82 // 7      (s-7)   Payload data
 83 FidoHidInitPacket::FidoHidInitPacket(uint32_t channelId, FidoHidDeviceCommand cmd, Vector&lt;uint8_t&gt;&amp;&amp; data, uint16_t payloadLength)
 84     : FidoHidPacket(WTFMove(data), channelId)
 85     , m_command(cmd)
 86     , m_payloadLength(payloadLength)
 87 {
 88 }
 89 
 90 Vector&lt;uint8_t&gt; FidoHidInitPacket::getSerializedData() const
 91 {
 92     Vector&lt;uint8_t&gt; serialized;
 93     serialized.reserveInitialCapacity(kHidPacketSize);
 94     serialized.append((m_channelId &gt;&gt; 24) &amp; 0xff);
 95     serialized.append((m_channelId &gt;&gt; 16) &amp; 0xff);
 96     serialized.append((m_channelId &gt;&gt; 8) &amp; 0xff);
 97     serialized.append(m_channelId &amp; 0xff);
 98     serialized.append(static_cast&lt;uint8_t&gt;(m_command) | 0x80);
 99     serialized.append((m_payloadLength &gt;&gt; 8) &amp; 0xff);
100     serialized.append(m_payloadLength &amp; 0xff);
101     serialized.append(m_data.begin(), m_data.size());

102     serialized.grow(kHidPacketSize);

103 
104     return serialized;
105 }
106 
107 // static
108 std::unique_ptr&lt;FidoHidContinuationPacket&gt; FidoHidContinuationPacket::createFromSerializedData(const Vector&lt;uint8_t&gt;&amp; serialized, size_t* remainingSize)
109 {
110     if (!remainingSize || serialized.size() != kHidPacketSize)
111         return nullptr;
112 
113     size_t index = 0;
114     auto channelId = (serialized[index++] &amp; 0xff) &lt;&lt; 24;
115     channelId |= (serialized[index++] &amp; 0xff) &lt;&lt; 16;
116     channelId |= (serialized[index++] &amp; 0xff) &lt;&lt; 8;
117     channelId |= serialized[index++] &amp; 0xff;
118     auto sequence = serialized[index++];
119 
120     // Check to see if packet payload is less than maximum size and padded with 0s.
121     size_t dataSize = std::min(*remainingSize, kHidPacketSize - index);
122     *remainingSize -= dataSize;
</pre>
<hr />
<pre>
130 // Offset Length
131 // 0      4       Channel ID
132 // 4      1       Packet sequence 0x00..0x7f
133 // 5      (s-5)   Payload data
134 FidoHidContinuationPacket::FidoHidContinuationPacket(const uint32_t channelId, const uint8_t sequence, Vector&lt;uint8_t&gt;&amp;&amp; data)
135     : FidoHidPacket(WTFMove(data), channelId)
136     , m_sequence(sequence)
137 {
138 }
139 
140 Vector&lt;uint8_t&gt; FidoHidContinuationPacket::getSerializedData() const
141 {
142     Vector&lt;uint8_t&gt; serialized;
143     serialized.reserveInitialCapacity(kHidPacketSize);
144     serialized.append((m_channelId &gt;&gt; 24) &amp; 0xff);
145     serialized.append((m_channelId &gt;&gt; 16) &amp; 0xff);
146     serialized.append((m_channelId &gt;&gt; 8) &amp; 0xff);
147     serialized.append(m_channelId &amp; 0xff);
148     serialized.append(m_sequence);
149     serialized.append(m_data.begin(), m_data.size());

150     serialized.grow(kHidPacketSize);

151 
152     return serialized;
153 }
154 
155 } // namespace fido
156 
157 #endif // ENABLE(WEB_AUTHN)
</pre>
</td>
<td>
<hr />
<pre>
 82 // 7      (s-7)   Payload data
 83 FidoHidInitPacket::FidoHidInitPacket(uint32_t channelId, FidoHidDeviceCommand cmd, Vector&lt;uint8_t&gt;&amp;&amp; data, uint16_t payloadLength)
 84     : FidoHidPacket(WTFMove(data), channelId)
 85     , m_command(cmd)
 86     , m_payloadLength(payloadLength)
 87 {
 88 }
 89 
 90 Vector&lt;uint8_t&gt; FidoHidInitPacket::getSerializedData() const
 91 {
 92     Vector&lt;uint8_t&gt; serialized;
 93     serialized.reserveInitialCapacity(kHidPacketSize);
 94     serialized.append((m_channelId &gt;&gt; 24) &amp; 0xff);
 95     serialized.append((m_channelId &gt;&gt; 16) &amp; 0xff);
 96     serialized.append((m_channelId &gt;&gt; 8) &amp; 0xff);
 97     serialized.append(m_channelId &amp; 0xff);
 98     serialized.append(static_cast&lt;uint8_t&gt;(m_command) | 0x80);
 99     serialized.append((m_payloadLength &gt;&gt; 8) &amp; 0xff);
100     serialized.append(m_payloadLength &amp; 0xff);
101     serialized.append(m_data.begin(), m_data.size());
<span class="line-added">102     auto offset = serialized.size();</span>
103     serialized.grow(kHidPacketSize);
<span class="line-added">104     memset(serialized.data() + offset, 0, kHidPacketSize - offset);</span>
105 
106     return serialized;
107 }
108 
109 // static
110 std::unique_ptr&lt;FidoHidContinuationPacket&gt; FidoHidContinuationPacket::createFromSerializedData(const Vector&lt;uint8_t&gt;&amp; serialized, size_t* remainingSize)
111 {
112     if (!remainingSize || serialized.size() != kHidPacketSize)
113         return nullptr;
114 
115     size_t index = 0;
116     auto channelId = (serialized[index++] &amp; 0xff) &lt;&lt; 24;
117     channelId |= (serialized[index++] &amp; 0xff) &lt;&lt; 16;
118     channelId |= (serialized[index++] &amp; 0xff) &lt;&lt; 8;
119     channelId |= serialized[index++] &amp; 0xff;
120     auto sequence = serialized[index++];
121 
122     // Check to see if packet payload is less than maximum size and padded with 0s.
123     size_t dataSize = std::min(*remainingSize, kHidPacketSize - index);
124     *remainingSize -= dataSize;
</pre>
<hr />
<pre>
132 // Offset Length
133 // 0      4       Channel ID
134 // 4      1       Packet sequence 0x00..0x7f
135 // 5      (s-5)   Payload data
136 FidoHidContinuationPacket::FidoHidContinuationPacket(const uint32_t channelId, const uint8_t sequence, Vector&lt;uint8_t&gt;&amp;&amp; data)
137     : FidoHidPacket(WTFMove(data), channelId)
138     , m_sequence(sequence)
139 {
140 }
141 
142 Vector&lt;uint8_t&gt; FidoHidContinuationPacket::getSerializedData() const
143 {
144     Vector&lt;uint8_t&gt; serialized;
145     serialized.reserveInitialCapacity(kHidPacketSize);
146     serialized.append((m_channelId &gt;&gt; 24) &amp; 0xff);
147     serialized.append((m_channelId &gt;&gt; 16) &amp; 0xff);
148     serialized.append((m_channelId &gt;&gt; 8) &amp; 0xff);
149     serialized.append(m_channelId &amp; 0xff);
150     serialized.append(m_sequence);
151     serialized.append(m_data.begin(), m_data.size());
<span class="line-added">152     auto offset = serialized.size();</span>
153     serialized.grow(kHidPacketSize);
<span class="line-added">154     memset(serialized.data() + offset, 0, kHidPacketSize - offset);</span>
155 
156     return serialized;
157 }
158 
159 } // namespace fido
160 
161 #endif // ENABLE(WEB_AUTHN)
</pre>
</td>
</tr>
</table>
<center><a href="FidoHidMessage.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="U2fCommandConstructor.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>