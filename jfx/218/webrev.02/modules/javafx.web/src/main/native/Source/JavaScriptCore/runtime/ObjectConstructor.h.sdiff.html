<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ObjectConstructor.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ObjectConstructor.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ObjectInitializationScope.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ObjectConstructor.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
  2  *  Copyright (C) 1999-2000 Harri Porten (porten@kde.org)
<span class="line-modified">  3  *  Copyright (C) 2008, 2016-2017 Apple Inc. All rights reserved.</span>
  4  *
  5  *  This library is free software; you can redistribute it and/or
  6  *  modify it under the terms of the GNU Lesser General Public
  7  *  License as published by the Free Software Foundation; either
  8  *  version 2 of the License, or (at your option) any later version.
  9  *
 10  *  This library is distributed in the hope that it will be useful,
 11  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 12  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 13  *  Lesser General Public License for more details.
 14  *
 15  *  You should have received a copy of the GNU Lesser General Public
 16  *  License along with this library; if not, write to the Free Software
 17  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 18  *
 19  */
 20 
 21 #pragma once
 22 
 23 #include &quot;InternalFunction.h&quot;
 24 #include &quot;JSGlobalObject.h&quot;
 25 #include &quot;ObjectPrototype.h&quot;
 26 
 27 namespace JSC {
 28 
<span class="line-modified"> 29 EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyDescriptor(ExecState*);</span>
<span class="line-modified"> 30 EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyDescriptors(ExecState*);</span>
<span class="line-modified"> 31 EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertySymbols(ExecState*);</span>
<span class="line-modified"> 32 EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyNames(ExecState*);</span>
<span class="line-modified"> 33 EncodedJSValue JSC_HOST_CALL objectConstructorKeys(ExecState*);</span>
 34 
 35 class ObjectPrototype;
 36 
 37 class ObjectConstructor final : public InternalFunction {
 38 public:
 39     typedef InternalFunction Base;
<span class="line-modified"> 40     static const unsigned StructureFlags = Base::StructureFlags | HasStaticPropertyTable;</span>
 41 
 42     static ObjectConstructor* create(VM&amp; vm, JSGlobalObject* globalObject, Structure* structure, ObjectPrototype* objectPrototype)
 43     {
 44         ObjectConstructor* constructor = new (NotNull, allocateCell&lt;ObjectConstructor&gt;(vm.heap)) ObjectConstructor(vm, structure);
 45         constructor-&gt;finishCreation(vm, globalObject, objectPrototype);
 46         return constructor;
 47     }
 48 
 49     DECLARE_INFO;
 50 
 51     static Structure* createStructure(VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
 52     {
 53         return Structure::create(vm, globalObject, prototype, TypeInfo(InternalFunctionType, StructureFlags), info());
 54     }
 55 
 56 protected:
 57     void finishCreation(VM&amp;, JSGlobalObject*, ObjectPrototype*);
 58 
 59 private:
 60     ObjectConstructor(VM&amp;, Structure*);
 61 };

 62 
<span class="line-modified"> 63 inline JSFinalObject* constructEmptyObject(ExecState* exec, Structure* structure)</span>
 64 {
<span class="line-modified"> 65     return JSFinalObject::create(exec, structure);</span>
 66 }
 67 
<span class="line-modified"> 68 inline JSFinalObject* constructEmptyObject(ExecState* exec, JSObject* prototype, unsigned inlineCapacity)</span>
 69 {
<span class="line-modified"> 70     JSGlobalObject* globalObject = exec-&gt;lexicalGlobalObject();</span>
<span class="line-modified"> 71     StructureCache&amp; structureCache = globalObject-&gt;vm().structureCache;</span>
 72     Structure* structure = structureCache.emptyObjectStructureForPrototype(globalObject, prototype, inlineCapacity);
<span class="line-modified"> 73     return constructEmptyObject(exec, structure);</span>
 74 }
 75 
<span class="line-modified"> 76 inline JSFinalObject* constructEmptyObject(ExecState* exec, JSObject* prototype)</span>
 77 {
<span class="line-modified"> 78     return constructEmptyObject(exec, prototype, JSFinalObject::defaultInlineCapacity());</span>
 79 }
 80 
<span class="line-modified"> 81 inline JSFinalObject* constructEmptyObject(ExecState* exec)</span>
 82 {
<span class="line-modified"> 83     return constructEmptyObject(exec, exec-&gt;lexicalGlobalObject()-&gt;objectStructureForObjectConstructor());</span>
 84 }
 85 
<span class="line-modified"> 86 inline JSObject* constructObject(ExecState* exec, JSGlobalObject* globalObject, JSValue arg)</span>
 87 {
 88     if (arg.isUndefinedOrNull())
<span class="line-modified"> 89         return constructEmptyObject(exec, globalObject-&gt;objectPrototype());</span>
<span class="line-modified"> 90     return arg.toObject(exec, globalObject);</span>
 91 }
 92 
 93 // Section 6.2.4.4 of the ES6 specification.
 94 // https://tc39.github.io/ecma262/#sec-frompropertydescriptor
<span class="line-modified"> 95 inline JSObject* constructObjectFromPropertyDescriptor(ExecState* exec, const PropertyDescriptor&amp; descriptor)</span>
 96 {
<span class="line-modified"> 97     VM&amp; vm = exec-&gt;vm();</span>
 98     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified"> 99     JSObject* description = constructEmptyObject(exec);</span>
100     RETURN_IF_EXCEPTION(scope, nullptr);
101 
102     if (!descriptor.isAccessorDescriptor()) {
103         description-&gt;putDirect(vm, vm.propertyNames-&gt;value, descriptor.value() ? descriptor.value() : jsUndefined(), 0);
104         description-&gt;putDirect(vm, vm.propertyNames-&gt;writable, jsBoolean(descriptor.writable()), 0);
105     } else {
106         ASSERT(descriptor.getter() || descriptor.setter());
107         if (descriptor.getter())
108             description-&gt;putDirect(vm, vm.propertyNames-&gt;get, descriptor.getter(), 0);
109         if (descriptor.setter())
110             description-&gt;putDirect(vm, vm.propertyNames-&gt;set, descriptor.setter(), 0);
111     }
112 
113     description-&gt;putDirect(vm, vm.propertyNames-&gt;enumerable, jsBoolean(descriptor.enumerable()), 0);
114     description-&gt;putDirect(vm, vm.propertyNames-&gt;configurable, jsBoolean(descriptor.configurable()), 0);
115 
116     return description;
117 }
118 
119 
<span class="line-modified">120 JS_EXPORT_PRIVATE JSObject* objectConstructorFreeze(ExecState*, JSObject*);</span>
<span class="line-modified">121 JS_EXPORT_PRIVATE JSObject* objectConstructorSeal(ExecState*, JSObject*);</span>
<span class="line-modified">122 JSValue objectConstructorGetOwnPropertyDescriptor(ExecState*, JSObject*, const Identifier&amp;);</span>
<span class="line-modified">123 JSValue objectConstructorGetOwnPropertyDescriptors(ExecState*, JSObject*);</span>
<span class="line-modified">124 JSArray* ownPropertyKeys(ExecState*, JSObject*, PropertyNameMode, DontEnumPropertiesMode);</span>
<span class="line-modified">125 bool toPropertyDescriptor(ExecState*, JSValue, PropertyDescriptor&amp;);</span>
126 
127 } // namespace JSC
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
  2  *  Copyright (C) 1999-2000 Harri Porten (porten@kde.org)
<span class="line-modified">  3  *  Copyright (C) 2008-2019 Apple Inc. All rights reserved.</span>
  4  *
  5  *  This library is free software; you can redistribute it and/or
  6  *  modify it under the terms of the GNU Lesser General Public
  7  *  License as published by the Free Software Foundation; either
  8  *  version 2 of the License, or (at your option) any later version.
  9  *
 10  *  This library is distributed in the hope that it will be useful,
 11  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 12  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 13  *  Lesser General Public License for more details.
 14  *
 15  *  You should have received a copy of the GNU Lesser General Public
 16  *  License along with this library; if not, write to the Free Software
 17  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 18  *
 19  */
 20 
 21 #pragma once
 22 
 23 #include &quot;InternalFunction.h&quot;
 24 #include &quot;JSGlobalObject.h&quot;
 25 #include &quot;ObjectPrototype.h&quot;
 26 
 27 namespace JSC {
 28 
<span class="line-modified"> 29 EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyDescriptor(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 30 EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyDescriptors(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 31 EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertySymbols(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 32 EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyNames(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 33 EncodedJSValue JSC_HOST_CALL objectConstructorKeys(JSGlobalObject*, CallFrame*);</span>
 34 
 35 class ObjectPrototype;
 36 
 37 class ObjectConstructor final : public InternalFunction {
 38 public:
 39     typedef InternalFunction Base;
<span class="line-modified"> 40     static constexpr unsigned StructureFlags = Base::StructureFlags | HasStaticPropertyTable;</span>
 41 
 42     static ObjectConstructor* create(VM&amp; vm, JSGlobalObject* globalObject, Structure* structure, ObjectPrototype* objectPrototype)
 43     {
 44         ObjectConstructor* constructor = new (NotNull, allocateCell&lt;ObjectConstructor&gt;(vm.heap)) ObjectConstructor(vm, structure);
 45         constructor-&gt;finishCreation(vm, globalObject, objectPrototype);
 46         return constructor;
 47     }
 48 
 49     DECLARE_INFO;
 50 
 51     static Structure* createStructure(VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
 52     {
 53         return Structure::create(vm, globalObject, prototype, TypeInfo(InternalFunctionType, StructureFlags), info());
 54     }
 55 
 56 protected:
 57     void finishCreation(VM&amp;, JSGlobalObject*, ObjectPrototype*);
 58 
 59 private:
 60     ObjectConstructor(VM&amp;, Structure*);
 61 };
<span class="line-added"> 62 STATIC_ASSERT_ISO_SUBSPACE_SHARABLE(ObjectConstructor, InternalFunction);</span>
 63 
<span class="line-modified"> 64 inline JSFinalObject* constructEmptyObject(VM&amp; vm, Structure* structure)</span>
 65 {
<span class="line-modified"> 66     return JSFinalObject::create(vm, structure);</span>
 67 }
 68 
<span class="line-modified"> 69 inline JSFinalObject* constructEmptyObject(JSGlobalObject* globalObject, JSObject* prototype, unsigned inlineCapacity)</span>
 70 {
<span class="line-modified"> 71     VM&amp; vm = getVM(globalObject);</span>
<span class="line-modified"> 72     StructureCache&amp; structureCache = vm.structureCache;</span>
 73     Structure* structure = structureCache.emptyObjectStructureForPrototype(globalObject, prototype, inlineCapacity);
<span class="line-modified"> 74     return constructEmptyObject(vm, structure);</span>
 75 }
 76 
<span class="line-modified"> 77 inline JSFinalObject* constructEmptyObject(JSGlobalObject* globalObject, JSObject* prototype)</span>
 78 {
<span class="line-modified"> 79     return constructEmptyObject(globalObject, prototype, JSFinalObject::defaultInlineCapacity());</span>
 80 }
 81 
<span class="line-modified"> 82 inline JSFinalObject* constructEmptyObject(JSGlobalObject* globalObject)</span>
 83 {
<span class="line-modified"> 84     return constructEmptyObject(getVM(globalObject), globalObject-&gt;objectStructureForObjectConstructor());</span>
 85 }
 86 
<span class="line-modified"> 87 inline JSObject* constructObject(JSGlobalObject* globalObject, JSValue arg)</span>
 88 {
 89     if (arg.isUndefinedOrNull())
<span class="line-modified"> 90         return constructEmptyObject(globalObject, globalObject-&gt;objectPrototype());</span>
<span class="line-modified"> 91     return arg.toObject(globalObject);</span>
 92 }
 93 
 94 // Section 6.2.4.4 of the ES6 specification.
 95 // https://tc39.github.io/ecma262/#sec-frompropertydescriptor
<span class="line-modified"> 96 inline JSObject* constructObjectFromPropertyDescriptor(JSGlobalObject* globalObject, const PropertyDescriptor&amp; descriptor)</span>
 97 {
<span class="line-modified"> 98     VM&amp; vm = getVM(globalObject);</span>
 99     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">100     JSObject* description = constructEmptyObject(globalObject);</span>
101     RETURN_IF_EXCEPTION(scope, nullptr);
102 
103     if (!descriptor.isAccessorDescriptor()) {
104         description-&gt;putDirect(vm, vm.propertyNames-&gt;value, descriptor.value() ? descriptor.value() : jsUndefined(), 0);
105         description-&gt;putDirect(vm, vm.propertyNames-&gt;writable, jsBoolean(descriptor.writable()), 0);
106     } else {
107         ASSERT(descriptor.getter() || descriptor.setter());
108         if (descriptor.getter())
109             description-&gt;putDirect(vm, vm.propertyNames-&gt;get, descriptor.getter(), 0);
110         if (descriptor.setter())
111             description-&gt;putDirect(vm, vm.propertyNames-&gt;set, descriptor.setter(), 0);
112     }
113 
114     description-&gt;putDirect(vm, vm.propertyNames-&gt;enumerable, jsBoolean(descriptor.enumerable()), 0);
115     description-&gt;putDirect(vm, vm.propertyNames-&gt;configurable, jsBoolean(descriptor.configurable()), 0);
116 
117     return description;
118 }
119 
120 
<span class="line-modified">121 JS_EXPORT_PRIVATE JSObject* objectConstructorFreeze(JSGlobalObject*, JSObject*);</span>
<span class="line-modified">122 JS_EXPORT_PRIVATE JSObject* objectConstructorSeal(JSGlobalObject*, JSObject*);</span>
<span class="line-modified">123 JSValue objectConstructorGetOwnPropertyDescriptor(JSGlobalObject*, JSObject*, const Identifier&amp;);</span>
<span class="line-modified">124 JSValue objectConstructorGetOwnPropertyDescriptors(JSGlobalObject*, JSObject*);</span>
<span class="line-modified">125 JSArray* ownPropertyKeys(JSGlobalObject*, JSObject*, PropertyNameMode, DontEnumPropertiesMode);</span>
<span class="line-modified">126 bool toPropertyDescriptor(JSGlobalObject*, JSValue, PropertyDescriptor&amp;);</span>
127 
128 } // namespace JSC
</pre>
</td>
</tr>
</table>
<center><a href="ObjectConstructor.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ObjectInitializationScope.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>