<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WTF/wtf/DateMath.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DateMath.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DeferrableRefCounted.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WTF/wtf/DateMath.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 87,50 ***</span>
  
  void initializeDates();
  int equivalentYearForDST(int year);
  
  // Not really math related, but this is currently the only shared place to put these.
<span class="line-modified">! WTF_EXPORT_PRIVATE double parseES5DateFromNullTerminatedCharacters(const char* dateString);</span>
  WTF_EXPORT_PRIVATE double parseDateFromNullTerminatedCharacters(const char* dateString);
<span class="line-modified">! WTF_EXPORT_PRIVATE double parseDateFromNullTerminatedCharacters(const char* dateString, bool&amp; haveTZ, int&amp; offset);</span>
<span class="line-removed">- WTF_EXPORT_PRIVATE double timeClip(double);</span>
  // dayOfWeek: [0, 6] 0 being Monday, day: [1, 31], month: [0, 11], year: ex: 2011, hours: [0, 23], minutes: [0, 59], seconds: [0, 59], utcOffset: [-720,720].
  String makeRFC2822DateString(unsigned dayOfWeek, unsigned day, unsigned month, unsigned year, unsigned hours, unsigned minutes, unsigned seconds, int utcOffset);
  
  inline double jsCurrentTime()
  {
      // JavaScript doesn&#39;t recognize fractions of a millisecond.
      return floor(WallTime::now().secondsSinceEpoch().milliseconds());
  }
  
<span class="line-modified">! const char* const weekdayName[7] = { &quot;Mon&quot;, &quot;Tue&quot;, &quot;Wed&quot;, &quot;Thu&quot;, &quot;Fri&quot;, &quot;Sat&quot;, &quot;Sun&quot; };</span>
<span class="line-modified">! const char* const monthName[12] = { &quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot; };</span>
<span class="line-modified">! const char* const monthFullName[12] = { &quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;, &quot;October&quot;, &quot;November&quot;, &quot;December&quot; };</span>
  
<span class="line-modified">! const double hoursPerDay = 24.0;</span>
<span class="line-modified">! const double minutesPerHour = 60.0;</span>
<span class="line-modified">! const double secondsPerMinute = 60.0;</span>
<span class="line-modified">! const double msPerSecond = 1000.0;</span>
<span class="line-modified">! const double msPerMonth = 2592000000.0;</span>
<span class="line-modified">! const double secondsPerHour = secondsPerMinute * minutesPerHour;</span>
<span class="line-modified">! const double secondsPerDay = secondsPerHour * hoursPerDay;</span>
<span class="line-modified">! const double msPerMinute = msPerSecond * secondsPerMinute;</span>
<span class="line-modified">! const double msPerHour = msPerSecond * secondsPerHour;</span>
<span class="line-modified">! const double msPerDay = msPerSecond * secondsPerDay;</span>
  
<span class="line-modified">! WTF_EXPORT_PRIVATE bool isLeapYear(int year);</span>
  
  // Returns the number of days from 1970-01-01 to the specified date.
<span class="line-modified">! WTF_EXPORT_PRIVATE double dateToDaysFrom1970(int year, int month, int day);</span>
<span class="line-modified">! WTF_EXPORT_PRIVATE int msToYear(double ms);</span>
<span class="line-modified">! WTF_EXPORT_PRIVATE double msToDays(double ms);</span>
<span class="line-modified">! WTF_EXPORT_PRIVATE int msToMinutes(double ms);</span>
<span class="line-modified">! WTF_EXPORT_PRIVATE int msToHours(double ms);</span>
<span class="line-modified">! WTF_EXPORT_PRIVATE int dayInYear(int year, int month, int day);</span>
<span class="line-modified">! WTF_EXPORT_PRIVATE int dayInYear(double ms, int year);</span>
<span class="line-modified">! WTF_EXPORT_PRIVATE int monthFromDayInYear(int dayInYear, bool leapYear);</span>
<span class="line-modified">! WTF_EXPORT_PRIVATE int dayInMonthFromDayInYear(int dayInYear, bool leapYear);</span>
  
  // Returns combined offset in millisecond (UTC + DST).
  WTF_EXPORT_PRIVATE LocalTimeOffset calculateLocalTimeOffset(double utcInMilliseconds, TimeType = UTCTime);
  
  } // namespace WTF
<span class="line-new-header">--- 87,309 ---</span>
  
  void initializeDates();
  int equivalentYearForDST(int year);
  
  // Not really math related, but this is currently the only shared place to put these.
<span class="line-modified">! WTF_EXPORT_PRIVATE double parseES5DateFromNullTerminatedCharacters(const char* dateString, bool&amp; isLocalTime);</span>
  WTF_EXPORT_PRIVATE double parseDateFromNullTerminatedCharacters(const char* dateString);
<span class="line-modified">! WTF_EXPORT_PRIVATE double parseDateFromNullTerminatedCharacters(const char* dateString, bool&amp; isLocalTime);</span>
  // dayOfWeek: [0, 6] 0 being Monday, day: [1, 31], month: [0, 11], year: ex: 2011, hours: [0, 23], minutes: [0, 59], seconds: [0, 59], utcOffset: [-720,720].
  String makeRFC2822DateString(unsigned dayOfWeek, unsigned day, unsigned month, unsigned year, unsigned hours, unsigned minutes, unsigned seconds, int utcOffset);
  
  inline double jsCurrentTime()
  {
      // JavaScript doesn&#39;t recognize fractions of a millisecond.
      return floor(WallTime::now().secondsSinceEpoch().milliseconds());
  }
  
<span class="line-modified">! extern WTF_EXPORT_PRIVATE const char* const weekdayName[7];</span>
<span class="line-modified">! extern WTF_EXPORT_PRIVATE const char* const monthName[12];</span>
<span class="line-modified">! extern WTF_EXPORT_PRIVATE const char* const monthFullName[12];</span>
<span class="line-added">+ extern WTF_EXPORT_PRIVATE const int firstDayOfMonth[2][12];</span>
  
<span class="line-modified">! static constexpr double hoursPerDay = 24.0;</span>
<span class="line-modified">! static constexpr double minutesPerHour = 60.0;</span>
<span class="line-modified">! static constexpr double secondsPerMinute = 60.0;</span>
<span class="line-modified">! static constexpr double msPerSecond = 1000.0;</span>
<span class="line-modified">! static constexpr double msPerMonth = 2592000000.0;</span>
<span class="line-modified">! static constexpr double secondsPerHour = secondsPerMinute * minutesPerHour;</span>
<span class="line-modified">! static constexpr double secondsPerDay = secondsPerHour * hoursPerDay;</span>
<span class="line-modified">! static constexpr double msPerMinute = msPerSecond * secondsPerMinute;</span>
<span class="line-modified">! static constexpr double msPerHour = msPerSecond * secondsPerHour;</span>
<span class="line-modified">! static constexpr double msPerDay = msPerSecond * secondsPerDay;</span>
  
<span class="line-modified">! static constexpr double maxUnixTime = 2145859200.0; // 12/31/2037</span>
<span class="line-added">+ // ECMAScript asks not to support for a date of which total</span>
<span class="line-added">+ // millisecond value is larger than the following value.</span>
<span class="line-added">+ // See 15.9.1.14 of ECMA-262 5th edition.</span>
<span class="line-added">+ static constexpr double maxECMAScriptTime = 8.64E15;</span>
<span class="line-added">+ </span>
<span class="line-added">+ class TimeClippedPositiveMilliseconds {</span>
<span class="line-added">+ public:</span>
<span class="line-added">+     static constexpr int64_t hoursPerDay = 24;</span>
<span class="line-added">+     static constexpr int64_t minutesPerHour = 60;</span>
<span class="line-added">+     static constexpr int64_t secondsPerMinute = 60;</span>
<span class="line-added">+     static constexpr int64_t msPerSecond = 1000;</span>
<span class="line-added">+     static constexpr int64_t msPerMonth = 2592000000;</span>
<span class="line-added">+     static constexpr int64_t secondsPerHour = secondsPerMinute * minutesPerHour;</span>
<span class="line-added">+     static constexpr int64_t secondsPerDay = secondsPerHour * hoursPerDay;</span>
<span class="line-added">+     static constexpr int64_t msPerMinute = msPerSecond * secondsPerMinute;</span>
<span class="line-added">+     static constexpr int64_t msPerHour = msPerSecond * secondsPerHour;</span>
<span class="line-added">+     static constexpr int64_t msPerDay = msPerSecond * secondsPerDay;</span>
<span class="line-added">+     static constexpr int64_t maxECMAScriptTime = 8.64E15;</span>
<span class="line-added">+ </span>
<span class="line-added">+     explicit TimeClippedPositiveMilliseconds(int64_t value)</span>
<span class="line-added">+         : m_value(value)</span>
<span class="line-added">+     {</span>
<span class="line-added">+         ASSERT(value &gt;= 0);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     int64_t value() const { return m_value; }</span>
<span class="line-added">+     double asDouble() const { return static_cast&lt;double&gt;(m_value); }</span>
<span class="line-added">+ private:</span>
<span class="line-added">+     int64_t m_value;</span>
<span class="line-added">+ };</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline double timeClip(double t)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (std::abs(t) &gt; maxECMAScriptTime)</span>
<span class="line-added">+         return std::numeric_limits&lt;double&gt;::quiet_NaN();</span>
<span class="line-added">+     return std::trunc(t) + 0.0;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline double daysFrom1970ToYear(int year)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     // The Gregorian Calendar rules for leap years:</span>
<span class="line-added">+     // Every fourth year is a leap year. 2004, 2008, and 2012 are leap years.</span>
<span class="line-added">+     // However, every hundredth year is not a leap year. 1900 and 2100 are not leap years.</span>
<span class="line-added">+     // Every four hundred years, there&#39;s a leap year after all. 2000 and 2400 are leap years.</span>
<span class="line-added">+ </span>
<span class="line-added">+     static constexpr int leapDaysBefore1971By4Rule = 1970 / 4;</span>
<span class="line-added">+     static constexpr int excludedLeapDaysBefore1971By100Rule = 1970 / 100;</span>
<span class="line-added">+     static constexpr int leapDaysBefore1971By400Rule = 1970 / 400;</span>
<span class="line-added">+ </span>
<span class="line-added">+     const double yearMinusOne = year - 1;</span>
<span class="line-added">+     const double yearsToAddBy4Rule = floor(yearMinusOne / 4.0) - leapDaysBefore1971By4Rule;</span>
<span class="line-added">+     const double yearsToExcludeBy100Rule = floor(yearMinusOne / 100.0) - excludedLeapDaysBefore1971By100Rule;</span>
<span class="line-added">+     const double yearsToAddBy400Rule = floor(yearMinusOne / 400.0) - leapDaysBefore1971By400Rule;</span>
<span class="line-added">+ </span>
<span class="line-added">+     return 365.0 * (year - 1970.0) + yearsToAddBy4Rule - yearsToExcludeBy100Rule + yearsToAddBy400Rule;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int64_t daysFrom1970ToYearTimeClippedPositive(int year)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     static constexpr int leapDaysBefore1971By4Rule = 1970 / 4;</span>
<span class="line-added">+     static constexpr int excludedLeapDaysBefore1971By100Rule = 1970 / 100;</span>
<span class="line-added">+     static constexpr int leapDaysBefore1971By400Rule = 1970 / 400;</span>
<span class="line-added">+ </span>
<span class="line-added">+     ASSERT(year &gt;= 1970);</span>
<span class="line-added">+     const int64_t yearMinusOne = year - 1;</span>
<span class="line-added">+     const int64_t yearsToAddBy4Rule = yearMinusOne / 4.0 - leapDaysBefore1971By4Rule;</span>
<span class="line-added">+     const int64_t yearsToExcludeBy100Rule = yearMinusOne / 100.0 - excludedLeapDaysBefore1971By100Rule;</span>
<span class="line-added">+     const int64_t yearsToAddBy400Rule = yearMinusOne / 400.0 - leapDaysBefore1971By400Rule;</span>
<span class="line-added">+ </span>
<span class="line-added">+     return 365 * (year - 1970) + yearsToAddBy4Rule - yearsToExcludeBy100Rule + yearsToAddBy400Rule;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline bool isLeapYear(int year)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (year % 4 != 0)</span>
<span class="line-added">+         return false;</span>
<span class="line-added">+     if (year % 400 == 0)</span>
<span class="line-added">+         return true;</span>
<span class="line-added">+     if (year % 100 == 0)</span>
<span class="line-added">+         return false;</span>
<span class="line-added">+     return true;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int daysInYear(int year)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     return 365 + isLeapYear(year);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline double msToDays(double ms)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     return floor(ms / msPerDay);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int64_t msToDays(TimeClippedPositiveMilliseconds ms)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     return ms.value() / TimeClippedPositiveMilliseconds::msPerDay;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int dayInYear(int year, int month, int day)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     return firstDayOfMonth[isLeapYear(year)][month] + day - 1;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int dayInYear(double ms, int year)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     return static_cast&lt;int&gt;(msToDays(ms) - daysFrom1970ToYear(year));</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int dayInYear(TimeClippedPositiveMilliseconds ms, int year)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     return static_cast&lt;int&gt;(msToDays(ms) - daysFrom1970ToYearTimeClippedPositive(year));</span>
<span class="line-added">+ }</span>
  
  // Returns the number of days from 1970-01-01 to the specified date.
<span class="line-modified">! inline double dateToDaysFrom1970(int year, int month, int day)</span>
<span class="line-modified">! {</span>
<span class="line-modified">!     year += month / 12;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     month %= 12;</span>
<span class="line-modified">!     if (month &lt; 0) {</span>
<span class="line-modified">!         month += 12;</span>
<span class="line-modified">!         --year;</span>
<span class="line-modified">!     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     double yearday = floor(daysFrom1970ToYear(year));</span>
<span class="line-added">+     ASSERT((year &gt;= 1970 &amp;&amp; yearday &gt;= 0) || (year &lt; 1970 &amp;&amp; yearday &lt; 0));</span>
<span class="line-added">+     return yearday + dayInYear(year, month, day);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int msToYear(double ms)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     int approxYear = static_cast&lt;int&gt;(floor(ms / (msPerDay * 365.2425)) + 1970);</span>
<span class="line-added">+     double msFromApproxYearTo1970 = msPerDay * daysFrom1970ToYear(approxYear);</span>
<span class="line-added">+     if (msFromApproxYearTo1970 &gt; ms)</span>
<span class="line-added">+         return approxYear - 1;</span>
<span class="line-added">+     if (msFromApproxYearTo1970 + msPerDay * daysInYear(approxYear) &lt;= ms)</span>
<span class="line-added">+         return approxYear + 1;</span>
<span class="line-added">+     return approxYear;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int msToMinutes(double ms)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     double result = fmod(floor(ms / msPerMinute), minutesPerHour);</span>
<span class="line-added">+     if (result &lt; 0)</span>
<span class="line-added">+         result += minutesPerHour;</span>
<span class="line-added">+     return static_cast&lt;int&gt;(result);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int msToMinutes(TimeClippedPositiveMilliseconds ms)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     int64_t result = (ms.value() / TimeClippedPositiveMilliseconds::msPerMinute) % TimeClippedPositiveMilliseconds::minutesPerHour;</span>
<span class="line-added">+     ASSERT(result &gt;= 0);</span>
<span class="line-added">+     return static_cast&lt;int&gt;(result);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int msToHours(double ms)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     double result = fmod(floor(ms / msPerHour), hoursPerDay);</span>
<span class="line-added">+     if (result &lt; 0)</span>
<span class="line-added">+         result += hoursPerDay;</span>
<span class="line-added">+     return static_cast&lt;int&gt;(result);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int msToHours(TimeClippedPositiveMilliseconds ms)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     int64_t result = (ms.value() / TimeClippedPositiveMilliseconds::msPerHour) % TimeClippedPositiveMilliseconds::hoursPerDay;</span>
<span class="line-added">+     ASSERT(result &gt;= 0);</span>
<span class="line-added">+     return static_cast&lt;int&gt;(result);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int msToSeconds(double ms)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     double result = fmod(floor(ms / msPerSecond), secondsPerMinute);</span>
<span class="line-added">+     if (result &lt; 0)</span>
<span class="line-added">+         result += secondsPerMinute;</span>
<span class="line-added">+     return static_cast&lt;int&gt;(result);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int msToSeconds(TimeClippedPositiveMilliseconds ms)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     int64_t result = ms.value() / TimeClippedPositiveMilliseconds::msPerSecond % TimeClippedPositiveMilliseconds::secondsPerMinute;</span>
<span class="line-added">+     ASSERT(result &gt;= 0);</span>
<span class="line-added">+     return static_cast&lt;int&gt;(result);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ // 0: Sunday, 1: Monday, etc.</span>
<span class="line-added">+ inline int msToWeekDay(double ms)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     int wd = (static_cast&lt;int&gt;(msToDays(ms)) + 4) % 7;</span>
<span class="line-added">+     if (wd &lt; 0)</span>
<span class="line-added">+         wd += 7;</span>
<span class="line-added">+     return wd;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int msToWeekDay(TimeClippedPositiveMilliseconds ms)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     int result = (static_cast&lt;int&gt;(msToDays(ms)) + 4) % 7;</span>
<span class="line-added">+     ASSERT(result &gt;= 0);</span>
<span class="line-added">+     return result;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int monthFromDayInYear(int dayInYear, bool leapYear)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     const int d = dayInYear;</span>
<span class="line-added">+     int step;</span>
<span class="line-added">+ </span>
<span class="line-added">+     if (d &lt; (step = 31))</span>
<span class="line-added">+         return 0;</span>
<span class="line-added">+     step += (leapYear ? 29 : 28);</span>
<span class="line-added">+     if (d &lt; step)</span>
<span class="line-added">+         return 1;</span>
<span class="line-added">+     if (d &lt; (step += 31))</span>
<span class="line-added">+         return 2;</span>
<span class="line-added">+     if (d &lt; (step += 30))</span>
<span class="line-added">+         return 3;</span>
<span class="line-added">+     if (d &lt; (step += 31))</span>
<span class="line-added">+         return 4;</span>
<span class="line-added">+     if (d &lt; (step += 30))</span>
<span class="line-added">+         return 5;</span>
<span class="line-added">+     if (d &lt; (step += 31))</span>
<span class="line-added">+         return 6;</span>
<span class="line-added">+     if (d &lt; (step += 31))</span>
<span class="line-added">+         return 7;</span>
<span class="line-added">+     if (d &lt; (step += 30))</span>
<span class="line-added">+         return 8;</span>
<span class="line-added">+     if (d &lt; (step += 31))</span>
<span class="line-added">+         return 9;</span>
<span class="line-added">+     if (d &lt; (step += 30))</span>
<span class="line-added">+         return 10;</span>
<span class="line-added">+     return 11;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ inline int dayInMonthFromDayInYear(int dayInYear, bool leapYear)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     auto checkMonth = [] (int dayInYear, int&amp; startDayOfThisMonth, int&amp; startDayOfNextMonth, int daysInThisMonth) -&gt; bool {</span>
<span class="line-added">+         startDayOfThisMonth = startDayOfNextMonth;</span>
<span class="line-added">+         startDayOfNextMonth += daysInThisMonth;</span>
<span class="line-added">+         return (dayInYear &lt;= startDayOfNextMonth);</span>
<span class="line-added">+     };</span>
<span class="line-added">+ </span>
<span class="line-added">+     const int d = dayInYear;</span>
<span class="line-added">+     int step;</span>
<span class="line-added">+     int next = 30;</span>
<span class="line-added">+ </span>
<span class="line-added">+     if (d &lt;= next)</span>
<span class="line-added">+         return d + 1;</span>
<span class="line-added">+     const int daysInFeb = (leapYear ? 29 : 28);</span>
<span class="line-added">+     if (checkMonth(d, step, next, daysInFeb))</span>
<span class="line-added">+         return d - step;</span>
<span class="line-added">+     if (checkMonth(d, step, next, 31))</span>
<span class="line-added">+         return d - step;</span>
<span class="line-added">+     if (checkMonth(d, step, next, 30))</span>
<span class="line-added">+         return d - step;</span>
<span class="line-added">+     if (checkMonth(d, step, next, 31))</span>
<span class="line-added">+         return d - step;</span>
<span class="line-added">+     if (checkMonth(d, step, next, 30))</span>
<span class="line-added">+         return d - step;</span>
<span class="line-added">+     if (checkMonth(d, step, next, 31))</span>
<span class="line-added">+         return d - step;</span>
<span class="line-added">+     if (checkMonth(d, step, next, 31))</span>
<span class="line-added">+         return d - step;</span>
<span class="line-added">+     if (checkMonth(d, step, next, 30))</span>
<span class="line-added">+         return d - step;</span>
<span class="line-added">+     if (checkMonth(d, step, next, 31))</span>
<span class="line-added">+         return d - step;</span>
<span class="line-added">+     if (checkMonth(d, step, next, 30))</span>
<span class="line-added">+         return d - step;</span>
<span class="line-added">+     step = next;</span>
<span class="line-added">+     return d - step;</span>
<span class="line-added">+ }</span>
  
  // Returns combined offset in millisecond (UTC + DST).
  WTF_EXPORT_PRIVATE LocalTimeOffset calculateLocalTimeOffset(double utcInMilliseconds, TimeType = UTCTime);
  
  } // namespace WTF
</pre>
<hr />
<pre>
<span class="line-old-header">*** 153,5 ***</span>
<span class="line-new-header">--- 412,7 ---</span>
  using WTF::secondsPerMinute;
  using WTF::parseDateFromNullTerminatedCharacters;
  using WTF::makeRFC2822DateString;
  using WTF::LocalTimeOffset;
  using WTF::calculateLocalTimeOffset;
<span class="line-added">+ using WTF::timeClip;</span>
<span class="line-added">+ using WTF::jsCurrentTime;</span>
</pre>
<center><a href="DateMath.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DeferrableRefCounted.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>