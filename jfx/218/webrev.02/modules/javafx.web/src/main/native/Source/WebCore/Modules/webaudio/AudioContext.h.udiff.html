<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/Modules/webaudio/AudioContext.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AudioContext.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="AudioContext.idl.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/webaudio/AudioContext.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -28,11 +28,10 @@</span>
  #include &quot;ActiveDOMObject.h&quot;
  #include &quot;AsyncAudioDecoder.h&quot;
  #include &quot;AudioBus.h&quot;
  #include &quot;AudioDestinationNode.h&quot;
  #include &quot;EventTarget.h&quot;
<span class="udiff-line-removed">- #include &quot;JSDOMPromiseDeferred.h&quot;</span>
  #include &quot;MediaCanStartListener.h&quot;
  #include &quot;MediaProducer.h&quot;
  #include &quot;PlatformMediaSession.h&quot;
  #include &quot;ScriptExecutionContext.h&quot;
  #include &quot;VisibilityChangeClient.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -43,10 +42,11 @@</span>
  #include &lt;wtf/LoggerHelper.h&gt;
  #include &lt;wtf/MainThread.h&gt;
  #include &lt;wtf/RefPtr.h&gt;
  #include &lt;wtf/ThreadSafeRefCounted.h&gt;
  #include &lt;wtf/Threading.h&gt;
<span class="udiff-line-added">+ #include &lt;wtf/UniqueRef.h&gt;</span>
  #include &lt;wtf/Vector.h&gt;
  #include &lt;wtf/text/AtomStringHash.h&gt;
  
  namespace WebCore {
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -62,12 +62,12 @@</span>
  class ConvolverNode;
  class DelayNode;
  class Document;
  class DynamicsCompressorNode;
  class GainNode;
<span class="udiff-line-removed">- class GenericEventQueue;</span>
  class HTMLMediaElement;
<span class="udiff-line-added">+ class MainThreadGenericEventQueue;</span>
  class MediaElementAudioSourceNode;
  class MediaStream;
  class MediaStreamAudioDestinationNode;
  class MediaStreamAudioSourceNode;
  class OscillatorNode;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -75,10 +75,12 @@</span>
  class PeriodicWave;
  class ScriptProcessorNode;
  class SecurityOrigin;
  class WaveShaperNode;
  
<span class="udiff-line-added">+ template&lt;typename IDLType&gt; class DOMPromiseDeferred;</span>
<span class="udiff-line-added">+ </span>
  // AudioContext is the cornerstone of the web audio API and all AudioNodes are created from it.
  // For thread safety between the audio thread and the main thread, it has a rendering graph locking mechanism.
  
  class AudioContext
      : public ActiveDOMObject
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -122,15 +124,12 @@</span>
      // Asynchronous audio file data decoding.
      void decodeAudioData(Ref&lt;ArrayBuffer&gt;&amp;&amp;, RefPtr&lt;AudioBufferCallback&gt;&amp;&amp;, RefPtr&lt;AudioBufferCallback&gt;&amp;&amp;);
  
      AudioListener* listener() { return m_listener.get(); }
  
<span class="udiff-line-modified-removed">-     using ActiveDOMObject::suspend;</span>
<span class="udiff-line-modified-removed">-     using ActiveDOMObject::resume;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     void suspend(DOMPromiseDeferred&lt;void&gt;&amp;&amp;);</span>
<span class="udiff-line-removed">-     void resume(DOMPromiseDeferred&lt;void&gt;&amp;&amp;);</span>
<span class="udiff-line-modified-added">+     void suspendRendering(DOMPromiseDeferred&lt;void&gt;&amp;&amp;);</span>
<span class="udiff-line-modified-added">+     void resumeRendering(DOMPromiseDeferred&lt;void&gt;&amp;&amp;);</span>
      void close(DOMPromiseDeferred&lt;void&gt;&amp;&amp;);
  
      enum class State { Suspended, Running, Interrupted, Closed };
      State state() const;
      bool isClosed() const { return m_state == State::Closed; }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -290,13 +289,16 @@</span>
      void postTask(WTF::Function&lt;void()&gt;&amp;&amp;);
      bool isStopped() const { return m_isStopScheduled; }
      const SecurityOrigin* origin() const;
      void addConsoleMessage(MessageSource, MessageLevel, const String&amp; message);
  
<span class="udiff-line-added">+     // EventTarget</span>
<span class="udiff-line-added">+     ScriptExecutionContext* scriptExecutionContext() const final;</span>
<span class="udiff-line-added">+ </span>
  protected:
      explicit AudioContext(Document&amp;);
<span class="udiff-line-modified-removed">-     AudioContext(Document&amp;, unsigned numberOfChannels, size_t numberOfFrames, float sampleRate);</span>
<span class="udiff-line-modified-added">+     AudioContext(Document&amp;, AudioBuffer* renderTarget);</span>
  
      static bool isSampleRateRangeGood(float sampleRate);
      void clearPendingActivity();
      void makePendingActivity();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -319,11 +321,10 @@</span>
      void scheduleNodeDeletion();
  
      void mediaCanStart(Document&amp;) override;
  
      // EventTarget
<span class="udiff-line-removed">-     ScriptExecutionContext* scriptExecutionContext() const final;</span>
      void dispatchEvent(Event&amp;) final;
  
      // MediaProducer
      MediaProducer::MediaStateFlags mediaState() const override;
      void pageMutedStateDidChange() override;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -334,12 +335,13 @@</span>
      // uniquely connected to.  See the AudioNode::ref() and AudioNode::deref() methods for more details.
      void refNode(AudioNode&amp;);
      void derefNode(AudioNode&amp;);
  
      // ActiveDOMObject API.
<span class="udiff-line-added">+     void suspend(ReasonForSuspension) final;</span>
<span class="udiff-line-added">+     void resume() final;</span>
      void stop() override;
<span class="udiff-line-removed">-     bool canSuspendForDocumentSuspension() const override;</span>
      const char* activeDOMObjectName() const override;
  
      // When the context goes away, there might still be some sources which haven&#39;t finished playing.
      // Make sure to dereference them here.
      void derefUnfinishedSourceNodes();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -415,11 +417,11 @@</span>
      // Only accessed in the audio thread.
      Vector&lt;AudioNode*&gt; m_deferredFinishDerefList;
      Vector&lt;Vector&lt;DOMPromiseDeferred&lt;void&gt;&gt;&gt; m_stateReactions;
  
      std::unique_ptr&lt;PlatformMediaSession&gt; m_mediaSession;
<span class="udiff-line-modified-removed">-     std::unique_ptr&lt;GenericEventQueue&gt; m_eventQueue;</span>
<span class="udiff-line-modified-added">+     UniqueRef&lt;MainThreadGenericEventQueue&gt; m_eventQueue;</span>
  
      RefPtr&lt;AudioBuffer&gt; m_renderTarget;
      RefPtr&lt;AudioDestinationNode&gt; m_destinationNode;
      RefPtr&lt;AudioListener&gt; m_listener;
  
</pre>
<center><a href="AudioContext.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="AudioContext.idl.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>