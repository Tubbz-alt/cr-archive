<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/CodeBlockHash.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * Copyright (C) 2012, 2013 Apple Inc. All rights reserved.
 3  *
 4  * Redistribution and use in source and binary forms, with or without
 5  * modification, are permitted provided that the following conditions
 6  * are met:
 7  * 1. Redistributions of source code must retain the above copyright
 8  *    notice, this list of conditions and the following disclaimer.
 9  * 2. Redistributions in binary form must reproduce the above copyright
10  *    notice, this list of conditions and the following disclaimer in the
11  *    documentation and/or other materials provided with the distribution.
12  *
13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
24  */
25 
26 #include &quot;config.h&quot;
27 #include &quot;CodeBlockHash.h&quot;
28 
29 #include &quot;SourceCode.h&quot;
30 #include &lt;wtf/SHA1.h&gt;
31 #include &lt;wtf/SixCharacterHash.h&gt;
32 
33 namespace JSC {
34 
35 CodeBlockHash::CodeBlockHash(const char* string)
36     : m_hash(sixCharacterHashStringToInteger(string))
37 {
38 }
39 
40 CodeBlockHash::CodeBlockHash(const SourceCode&amp; sourceCode, CodeSpecializationKind kind)
41     : m_hash(0)
42 {
43     SHA1 sha1;
44     sha1.addBytes(sourceCode.toUTF8());
45     SHA1::Digest digest;
46     sha1.computeHash(digest);
47     m_hash = digest[0] | (digest[1] &lt;&lt; 8) | (digest[2] &lt;&lt; 16) | (digest[3] &lt;&lt; 24);
48 
49     if (m_hash == 0 || m_hash == 1)
50         m_hash += 0x2d5a93d0; // Ensures a non-zero hash, and gets us #Azero0 for CodeForCall and #Azero1 for CodeForConstruct.
51     static_assert(static_cast&lt;unsigned&gt;(CodeForCall) == 0, &quot;&quot;);
52     static_assert(static_cast&lt;unsigned&gt;(CodeForConstruct) == 1, &quot;&quot;);
53     m_hash ^= static_cast&lt;unsigned&gt;(kind);
54     ASSERT(m_hash);
55 }
56 
57 void CodeBlockHash::dump(PrintStream&amp; out) const
58 {
59     std::array&lt;char, 7&gt; buffer = integerToSixCharacterHashString(m_hash);
60 
61 #if !ASSERT_DISABLED
62     CodeBlockHash recompute(buffer.data());
63     ASSERT(recompute == *this);
64 #endif // !ASSERT_DISABLED
65 
66     out.print(buffer.data());
67 }
68 
69 } // namespace JSC
70 
    </pre>
  </body>
</html>