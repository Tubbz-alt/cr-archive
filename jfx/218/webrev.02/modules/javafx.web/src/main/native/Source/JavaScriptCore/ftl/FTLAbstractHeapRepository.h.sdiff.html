<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/ftl/FTLAbstractHeapRepository.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FTLAbstractHeapRepository.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FTLCapabilities.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/ftl/FTLAbstractHeapRepository.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #if ENABLE(FTL_JIT)
 29 
 30 #include &quot;B3Value.h&quot;
 31 #include &quot;DFGArrayMode.h&quot;
 32 #include &quot;FTLAbstractHeap.h&quot;
 33 #include &quot;HasOwnPropertyCache.h&quot;
 34 #include &quot;IndexingType.h&quot;
<span class="line-removed"> 35 #include &quot;JSFixedArray.h&quot;</span>
 36 #include &quot;JSGlobalObject.h&quot;
 37 #include &quot;JSMap.h&quot;
 38 #include &quot;JSSet.h&quot;
 39 #include &quot;JSWeakMap.h&quot;
 40 #include &quot;Symbol.h&quot;
 41 
 42 namespace JSC { namespace FTL {
 43 
 44 #define FOR_EACH_ABSTRACT_HEAP(macro) \
 45     macro(typedArrayProperties)
 46 
 47 #define FOR_EACH_ABSTRACT_FIELD(macro) \
 48     macro(ArrayBuffer_data, ArrayBuffer::offsetOfData()) \
 49     macro(ArrayStorage_numValuesInVector, ArrayStorage::numValuesInVectorOffset()) \
 50     macro(Butterfly_arrayBuffer, Butterfly::offsetOfArrayBuffer()) \
 51     macro(Butterfly_publicLength, Butterfly::offsetOfPublicLength()) \
 52     macro(Butterfly_vectorLength, Butterfly::offsetOfVectorLength()) \
 53     macro(CallFrame_callerFrame, CallFrame::callerFrameOffset()) \
 54     macro(ClassInfo_parentClass, ClassInfo::offsetOfParentClass()) \




















 55     macro(DirectArguments_callee, DirectArguments::offsetOfCallee()) \
 56     macro(DirectArguments_length, DirectArguments::offsetOfLength()) \
 57     macro(DirectArguments_minCapacity, DirectArguments::offsetOfMinCapacity()) \
 58     macro(DirectArguments_mappedArguments, DirectArguments::offsetOfMappedArguments()) \
 59     macro(DirectArguments_modifiedArgumentsDescriptor, DirectArguments::offsetOfModifiedArgumentsDescriptor()) \
 60     macro(FunctionRareData_allocator, FunctionRareData::offsetOfObjectAllocationProfile() + ObjectAllocationProfileWithPrototype::offsetOfAllocator()) \
 61     macro(FunctionRareData_structure, FunctionRareData::offsetOfObjectAllocationProfile() + ObjectAllocationProfileWithPrototype::offsetOfStructure()) \
 62     macro(FunctionRareData_prototype, FunctionRareData::offsetOfObjectAllocationProfile() + ObjectAllocationProfileWithPrototype::offsetOfPrototype()) \
<span class="line-modified"> 63     macro(FunctionRareData_objectAllocationProfileWatchpoint, FunctionRareData::offsetOfObjectAllocationProfileWatchpoint()) \</span>

 64     macro(FunctionRareData_internalFunctionAllocationProfile_structure, FunctionRareData::offsetOfInternalFunctionAllocationProfile() + InternalFunctionAllocationProfile::offsetOfStructure()) \
 65     macro(FunctionRareData_boundFunctionStructure, FunctionRareData::offsetOfBoundFunctionStructure()) \
 66     macro(FunctionRareData_allocationProfileClearingWatchpoint, FunctionRareData::offsetOfAllocationProfileClearingWatchpoint()) \
<span class="line-removed"> 67     macro(FunctionRareData_hasReifiedLength, FunctionRareData::offsetOfHasReifiedLength()) \</span>
<span class="line-removed"> 68     macro(FunctionRareData_hasReifiedName, FunctionRareData::offsetOfHasReifiedName()) \</span>
 69     macro(GetterSetter_getter, GetterSetter::offsetOfGetter()) \
 70     macro(GetterSetter_setter, GetterSetter::offsetOfSetter()) \
 71     macro(JSArrayBufferView_length, JSArrayBufferView::offsetOfLength()) \
 72     macro(JSArrayBufferView_mode, JSArrayBufferView::offsetOfMode()) \
 73     macro(JSArrayBufferView_vector, JSArrayBufferView::offsetOfVector()) \
 74     macro(JSBigInt_length, JSBigInt::offsetOfLength()) \
 75     macro(JSCell_cellState, JSCell::cellStateOffset()) \
 76     macro(JSCell_header, 0) \
 77     macro(JSCell_indexingTypeAndMisc, JSCell::indexingTypeAndMiscOffset()) \
 78     macro(JSCell_structureID, JSCell::structureIDOffset()) \
 79     macro(JSCell_typeInfoFlags, JSCell::typeInfoFlagsOffset()) \
 80     macro(JSCell_typeInfoType, JSCell::typeInfoTypeOffset()) \
 81     macro(JSCell_usefulBytes, JSCell::indexingTypeAndMiscOffset()) \
 82     macro(JSDestructibleObject_classInfo, JSDestructibleObject::classInfoOffset()) \
<span class="line-modified"> 83     macro(JSFunction_executable, JSFunction::offsetOfExecutable()) \</span>
 84     macro(JSFunction_scope, JSFunction::offsetOfScopeChain()) \
<span class="line-removed"> 85     macro(JSFunction_rareData, JSFunction::offsetOfRareData()) \</span>
 86     macro(JSGlobalObject_regExpGlobalData_cachedResult_lastRegExp, JSGlobalObject::regExpGlobalDataOffset() + RegExpGlobalData::offsetOfCachedResult() + RegExpCachedResult::offsetOfLastRegExp()) \
 87     macro(JSGlobalObject_regExpGlobalData_cachedResult_lastInput, JSGlobalObject::regExpGlobalDataOffset() + RegExpGlobalData::offsetOfCachedResult() + RegExpCachedResult::offsetOfLastInput()) \
 88     macro(JSGlobalObject_regExpGlobalData_cachedResult_result_start, JSGlobalObject::regExpGlobalDataOffset() + RegExpGlobalData::offsetOfCachedResult() + RegExpCachedResult::offsetOfResult() + OBJECT_OFFSETOF(MatchResult, start)) \
 89     macro(JSGlobalObject_regExpGlobalData_cachedResult_result_end, JSGlobalObject::regExpGlobalDataOffset() + RegExpGlobalData::offsetOfCachedResult() + RegExpCachedResult::offsetOfResult() + OBJECT_OFFSETOF(MatchResult, end)) \
 90     macro(JSGlobalObject_regExpGlobalData_cachedResult_reified, JSGlobalObject::regExpGlobalDataOffset() + RegExpGlobalData::offsetOfCachedResult() + RegExpCachedResult::offsetOfReified()) \
 91     macro(JSObject_butterfly, JSObject::butterflyOffset()) \
 92     macro(JSPropertyNameEnumerator_cachedInlineCapacity, JSPropertyNameEnumerator::cachedInlineCapacityOffset()) \
 93     macro(JSPropertyNameEnumerator_cachedPropertyNamesVector, JSPropertyNameEnumerator::cachedPropertyNamesVectorOffset()) \
 94     macro(JSPropertyNameEnumerator_cachedStructureID, JSPropertyNameEnumerator::cachedStructureIDOffset()) \
 95     macro(JSPropertyNameEnumerator_endGenericPropertyIndex, JSPropertyNameEnumerator::endGenericPropertyIndexOffset()) \
 96     macro(JSPropertyNameEnumerator_endStructurePropertyIndex, JSPropertyNameEnumerator::endStructurePropertyIndexOffset()) \
 97     macro(JSPropertyNameEnumerator_indexLength, JSPropertyNameEnumerator::indexedLengthOffset()) \
 98     macro(JSRopeString_flags, JSRopeString::offsetOfFlags()) \
 99     macro(JSRopeString_length, JSRopeString::offsetOfLength()) \
100     macro(JSRopeString_fiber0, JSRopeString::offsetOfFiber0()) \
101     macro(JSRopeString_fiber1, JSRopeString::offsetOfFiber1()) \
102     macro(JSRopeString_fiber2, JSRopeString::offsetOfFiber2()) \
103     macro(JSScope_next, JSScope::offsetOfNext()) \
104     macro(JSSymbolTableObject_symbolTable, JSSymbolTableObject::offsetOfSymbolTable()) \
105     macro(JSWrapperObject_internalValue, JSWrapperObject::internalValueOffset()) \
106     macro(RegExpObject_regExpAndLastIndexIsNotWritableFlag, RegExpObject::offsetOfRegExpAndLastIndexIsNotWritableFlag()) \
107     macro(RegExpObject_lastIndex, RegExpObject::offsetOfLastIndex()) \
108     macro(ShadowChicken_Packet_callee, OBJECT_OFFSETOF(ShadowChicken::Packet, callee)) \
109     macro(ShadowChicken_Packet_frame, OBJECT_OFFSETOF(ShadowChicken::Packet, frame)) \
110     macro(ShadowChicken_Packet_callerFrame, OBJECT_OFFSETOF(ShadowChicken::Packet, callerFrame)) \
111     macro(ShadowChicken_Packet_thisValue, OBJECT_OFFSETOF(ShadowChicken::Packet, thisValue)) \
112     macro(ShadowChicken_Packet_scope, OBJECT_OFFSETOF(ShadowChicken::Packet, scope)) \
113     macro(ShadowChicken_Packet_codeBlock, OBJECT_OFFSETOF(ShadowChicken::Packet, codeBlock)) \
114     macro(ShadowChicken_Packet_callSiteIndex, OBJECT_OFFSETOF(ShadowChicken::Packet, callSiteIndex)) \
<span class="line-modified">115     macro(ScopedArguments_Storage_overrodeThings, ScopedArguments::offsetOfOverrodeThingsInStorage()) \</span>
<span class="line-removed">116     macro(ScopedArguments_Storage_totalLength, ScopedArguments::offsetOfTotalLengthInStorage()) \</span>
<span class="line-removed">117     macro(ScopedArguments_storage, ScopedArguments::offsetOfStorage()) \</span>
118     macro(ScopedArguments_scope, ScopedArguments::offsetOfScope()) \

119     macro(ScopedArguments_table, ScopedArguments::offsetOfTable()) \

120     macro(ScopedArgumentsTable_arguments, ScopedArgumentsTable::offsetOfArguments()) \
121     macro(ScopedArgumentsTable_length, ScopedArgumentsTable::offsetOfLength()) \
122     macro(StringImpl_data, StringImpl::dataOffset()) \
123     macro(StringImpl_hashAndFlags, StringImpl::flagsOffset()) \
124     macro(StringImpl_length, StringImpl::lengthMemoryOffset()) \
125     macro(Structure_classInfo, Structure::classInfoOffset()) \
126     macro(Structure_globalObject, Structure::globalObjectOffset()) \
127     macro(Structure_indexingModeIncludingHistory, Structure::indexingModeIncludingHistoryOffset()) \
128     macro(Structure_inlineCapacity, Structure::inlineCapacityOffset()) \
129     macro(Structure_previousOrRareData, Structure::previousOrRareDataOffset()) \
130     macro(Structure_prototype, Structure::prototypeOffset()) \
131     macro(Structure_structureID, Structure::structureIDOffset()) \
132     macro(StructureRareData_cachedOwnKeys, StructureRareData::offsetOfCachedOwnKeys()) \
133     macro(HashMapImpl_capacity, HashMapImpl&lt;HashMapBucket&lt;HashMapBucketDataKey&gt;&gt;::offsetOfCapacity()) \
134     macro(HashMapImpl_buffer,  HashMapImpl&lt;HashMapBucket&lt;HashMapBucketDataKey&gt;&gt;::offsetOfBuffer()) \
135     macro(HashMapImpl_head,  HashMapImpl&lt;HashMapBucket&lt;HashMapBucketDataKey&gt;&gt;::offsetOfHead()) \
136     macro(HashMapBucket_value, HashMapBucket&lt;HashMapBucketDataKeyValue&gt;::offsetOfValue()) \
137     macro(HashMapBucket_key, HashMapBucket&lt;HashMapBucketDataKeyValue&gt;::offsetOfKey()) \
138     macro(HashMapBucket_next, HashMapBucket&lt;HashMapBucketDataKeyValue&gt;::offsetOfNext()) \
139     macro(WeakMapImpl_capacity, WeakMapImpl&lt;WeakMapBucket&lt;WeakMapBucketDataKey&gt;&gt;::offsetOfCapacity()) \
140     macro(WeakMapImpl_buffer,  WeakMapImpl&lt;WeakMapBucket&lt;WeakMapBucketDataKey&gt;&gt;::offsetOfBuffer()) \
141     macro(WeakMapBucket_value, WeakMapBucket&lt;WeakMapBucketDataKeyValue&gt;::offsetOfValue()) \
142     macro(WeakMapBucket_key, WeakMapBucket&lt;WeakMapBucketDataKeyValue&gt;::offsetOfKey()) \
143     macro(Symbol_symbolImpl, Symbol::offsetOfSymbolImpl()) \
<span class="line-removed">144     macro(JSFixedArray_size, JSFixedArray::offsetOfSize()) \</span>
145 
146 #define FOR_EACH_INDEXED_ABSTRACT_HEAP(macro) \
147     macro(ArrayStorage_vector, ArrayStorage::vectorOffset(), sizeof(WriteBarrier&lt;Unknown&gt;)) \
148     macro(CompleteSubspace_allocatorForSizeStep, CompleteSubspace::offsetOfAllocatorForSizeStep(), sizeof(Allocator)) \
149     macro(DirectArguments_storage, DirectArguments::storageOffset(), sizeof(EncodedJSValue)) \
150     macro(JSLexicalEnvironment_variables, JSLexicalEnvironment::offsetOfVariables(), sizeof(EncodedJSValue)) \
151     macro(JSPropertyNameEnumerator_cachedPropertyNamesVectorContents, 0, sizeof(WriteBarrier&lt;JSString&gt;)) \

152     macro(ScopedArguments_Storage_storage, 0, sizeof(EncodedJSValue)) \
153     macro(WriteBarrierBuffer_bufferContents, 0, sizeof(JSCell*)) \
154     macro(characters8, 0, sizeof(LChar)) \
155     macro(characters16, 0, sizeof(UChar)) \
156     macro(indexedInt32Properties, 0, sizeof(EncodedJSValue)) \
157     macro(indexedDoubleProperties, 0, sizeof(double)) \
158     macro(indexedContiguousProperties, 0, sizeof(EncodedJSValue)) \
159     macro(scopedArgumentsTableArguments, 0, sizeof(int32_t)) \
160     macro(singleCharacterStrings, 0, sizeof(JSString*)) \
161     macro(structureTable, 0, sizeof(Structure*)) \
162     macro(variables, 0, sizeof(Register)) \
163     macro(HasOwnPropertyCache, 0, sizeof(HasOwnPropertyCache::Entry)) \
<span class="line-removed">164     macro(JSFixedArray_buffer, JSFixedArray::offsetOfData(), sizeof(EncodedJSValue)) \</span>
165 
166 #define FOR_EACH_NUMBERED_ABSTRACT_HEAP(macro) \
167     macro(properties)
168 
169 // This class is meant to be cacheable between compilations, but it doesn&#39;t have to be.
170 // Doing so saves on creation of nodes. But clearing it will save memory.
171 
172 class AbstractHeapRepository {
173     WTF_MAKE_NONCOPYABLE(AbstractHeapRepository);
174 public:
175     AbstractHeapRepository();
176     ~AbstractHeapRepository();
177 
178     AbstractHeap root;
179 
180 #define ABSTRACT_HEAP_DECLARATION(name) AbstractHeap name;
181     FOR_EACH_ABSTRACT_HEAP(ABSTRACT_HEAP_DECLARATION)
182 #undef ABSTRACT_HEAP_DECLARATION
183 
184 #define ABSTRACT_FIELD_DECLARATION(name, offset) AbstractHeap name;
</pre>
</td>
<td>
<hr />
<pre>
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #if ENABLE(FTL_JIT)
 29 
 30 #include &quot;B3Value.h&quot;
 31 #include &quot;DFGArrayMode.h&quot;
 32 #include &quot;FTLAbstractHeap.h&quot;
 33 #include &quot;HasOwnPropertyCache.h&quot;
 34 #include &quot;IndexingType.h&quot;

 35 #include &quot;JSGlobalObject.h&quot;
 36 #include &quot;JSMap.h&quot;
 37 #include &quot;JSSet.h&quot;
 38 #include &quot;JSWeakMap.h&quot;
 39 #include &quot;Symbol.h&quot;
 40 
 41 namespace JSC { namespace FTL {
 42 
 43 #define FOR_EACH_ABSTRACT_HEAP(macro) \
 44     macro(typedArrayProperties)
 45 
 46 #define FOR_EACH_ABSTRACT_FIELD(macro) \
 47     macro(ArrayBuffer_data, ArrayBuffer::offsetOfData()) \
 48     macro(ArrayStorage_numValuesInVector, ArrayStorage::numValuesInVectorOffset()) \
 49     macro(Butterfly_arrayBuffer, Butterfly::offsetOfArrayBuffer()) \
 50     macro(Butterfly_publicLength, Butterfly::offsetOfPublicLength()) \
 51     macro(Butterfly_vectorLength, Butterfly::offsetOfVectorLength()) \
 52     macro(CallFrame_callerFrame, CallFrame::callerFrameOffset()) \
 53     macro(ClassInfo_parentClass, ClassInfo::offsetOfParentClass()) \
<span class="line-added"> 54     macro(DateInstance_internalNumber, DateInstance::offsetOfInternalNumber()) \</span>
<span class="line-added"> 55     macro(DateInstance_data, DateInstance::offsetOfData()) \</span>
<span class="line-added"> 56     macro(DateInstanceData_gregorianDateTimeCachedForMS, DateInstanceData::offsetOfGregorianDateTimeCachedForMS()) \</span>
<span class="line-added"> 57     macro(DateInstanceData_gregorianDateTimeUTCCachedForMS, DateInstanceData::offsetOfGregorianDateTimeUTCCachedForMS()) \</span>
<span class="line-added"> 58     macro(DateInstanceData_cachedGregorianDateTime_year, DateInstanceData::offsetOfCachedGregorianDateTime() + GregorianDateTime::offsetOfYear()) \</span>
<span class="line-added"> 59     macro(DateInstanceData_cachedGregorianDateTimeUTC_year, DateInstanceData::offsetOfCachedGregorianDateTimeUTC() + GregorianDateTime::offsetOfYear()) \</span>
<span class="line-added"> 60     macro(DateInstanceData_cachedGregorianDateTime_month, DateInstanceData::offsetOfCachedGregorianDateTime() + GregorianDateTime::offsetOfMonth()) \</span>
<span class="line-added"> 61     macro(DateInstanceData_cachedGregorianDateTimeUTC_month, DateInstanceData::offsetOfCachedGregorianDateTimeUTC() + GregorianDateTime::offsetOfMonth()) \</span>
<span class="line-added"> 62     macro(DateInstanceData_cachedGregorianDateTime_monthDay, DateInstanceData::offsetOfCachedGregorianDateTime() + GregorianDateTime::offsetOfMonthDay()) \</span>
<span class="line-added"> 63     macro(DateInstanceData_cachedGregorianDateTimeUTC_monthDay, DateInstanceData::offsetOfCachedGregorianDateTimeUTC() + GregorianDateTime::offsetOfMonthDay()) \</span>
<span class="line-added"> 64     macro(DateInstanceData_cachedGregorianDateTime_weekDay, DateInstanceData::offsetOfCachedGregorianDateTime() + GregorianDateTime::offsetOfWeekDay()) \</span>
<span class="line-added"> 65     macro(DateInstanceData_cachedGregorianDateTimeUTC_weekDay, DateInstanceData::offsetOfCachedGregorianDateTimeUTC() + GregorianDateTime::offsetOfWeekDay()) \</span>
<span class="line-added"> 66     macro(DateInstanceData_cachedGregorianDateTime_hour, DateInstanceData::offsetOfCachedGregorianDateTime() + GregorianDateTime::offsetOfHour()) \</span>
<span class="line-added"> 67     macro(DateInstanceData_cachedGregorianDateTimeUTC_hour, DateInstanceData::offsetOfCachedGregorianDateTimeUTC() + GregorianDateTime::offsetOfHour()) \</span>
<span class="line-added"> 68     macro(DateInstanceData_cachedGregorianDateTime_minute, DateInstanceData::offsetOfCachedGregorianDateTime() + GregorianDateTime::offsetOfMinute()) \</span>
<span class="line-added"> 69     macro(DateInstanceData_cachedGregorianDateTimeUTC_minute, DateInstanceData::offsetOfCachedGregorianDateTimeUTC() + GregorianDateTime::offsetOfMinute()) \</span>
<span class="line-added"> 70     macro(DateInstanceData_cachedGregorianDateTime_second, DateInstanceData::offsetOfCachedGregorianDateTime() + GregorianDateTime::offsetOfSecond()) \</span>
<span class="line-added"> 71     macro(DateInstanceData_cachedGregorianDateTimeUTC_second, DateInstanceData::offsetOfCachedGregorianDateTimeUTC() + GregorianDateTime::offsetOfSecond()) \</span>
<span class="line-added"> 72     macro(DateInstanceData_cachedGregorianDateTime_utcOffsetInMinute, DateInstanceData::offsetOfCachedGregorianDateTime() + GregorianDateTime::offsetOfUTCOffsetInMinute()) \</span>
<span class="line-added"> 73     macro(DateInstanceData_cachedGregorianDateTimeUTC_utcOffsetInMinute, DateInstanceData::offsetOfCachedGregorianDateTimeUTC() + GregorianDateTime::offsetOfUTCOffsetInMinute()) \</span>
 74     macro(DirectArguments_callee, DirectArguments::offsetOfCallee()) \
 75     macro(DirectArguments_length, DirectArguments::offsetOfLength()) \
 76     macro(DirectArguments_minCapacity, DirectArguments::offsetOfMinCapacity()) \
 77     macro(DirectArguments_mappedArguments, DirectArguments::offsetOfMappedArguments()) \
 78     macro(DirectArguments_modifiedArgumentsDescriptor, DirectArguments::offsetOfModifiedArgumentsDescriptor()) \
 79     macro(FunctionRareData_allocator, FunctionRareData::offsetOfObjectAllocationProfile() + ObjectAllocationProfileWithPrototype::offsetOfAllocator()) \
 80     macro(FunctionRareData_structure, FunctionRareData::offsetOfObjectAllocationProfile() + ObjectAllocationProfileWithPrototype::offsetOfStructure()) \
 81     macro(FunctionRareData_prototype, FunctionRareData::offsetOfObjectAllocationProfile() + ObjectAllocationProfileWithPrototype::offsetOfPrototype()) \
<span class="line-modified"> 82     macro(FunctionRareData_allocationProfileWatchpointSet, FunctionRareData::offsetOfAllocationProfileWatchpointSet()) \</span>
<span class="line-added"> 83     macro(FunctionRareData_executable, FunctionRareData::offsetOfExecutable()) \</span>
 84     macro(FunctionRareData_internalFunctionAllocationProfile_structure, FunctionRareData::offsetOfInternalFunctionAllocationProfile() + InternalFunctionAllocationProfile::offsetOfStructure()) \
 85     macro(FunctionRareData_boundFunctionStructure, FunctionRareData::offsetOfBoundFunctionStructure()) \
 86     macro(FunctionRareData_allocationProfileClearingWatchpoint, FunctionRareData::offsetOfAllocationProfileClearingWatchpoint()) \


 87     macro(GetterSetter_getter, GetterSetter::offsetOfGetter()) \
 88     macro(GetterSetter_setter, GetterSetter::offsetOfSetter()) \
 89     macro(JSArrayBufferView_length, JSArrayBufferView::offsetOfLength()) \
 90     macro(JSArrayBufferView_mode, JSArrayBufferView::offsetOfMode()) \
 91     macro(JSArrayBufferView_vector, JSArrayBufferView::offsetOfVector()) \
 92     macro(JSBigInt_length, JSBigInt::offsetOfLength()) \
 93     macro(JSCell_cellState, JSCell::cellStateOffset()) \
 94     macro(JSCell_header, 0) \
 95     macro(JSCell_indexingTypeAndMisc, JSCell::indexingTypeAndMiscOffset()) \
 96     macro(JSCell_structureID, JSCell::structureIDOffset()) \
 97     macro(JSCell_typeInfoFlags, JSCell::typeInfoFlagsOffset()) \
 98     macro(JSCell_typeInfoType, JSCell::typeInfoTypeOffset()) \
 99     macro(JSCell_usefulBytes, JSCell::indexingTypeAndMiscOffset()) \
100     macro(JSDestructibleObject_classInfo, JSDestructibleObject::classInfoOffset()) \
<span class="line-modified">101     macro(JSFunction_executableOrRareData, JSFunction::offsetOfExecutableOrRareData()) \</span>
102     macro(JSFunction_scope, JSFunction::offsetOfScopeChain()) \

103     macro(JSGlobalObject_regExpGlobalData_cachedResult_lastRegExp, JSGlobalObject::regExpGlobalDataOffset() + RegExpGlobalData::offsetOfCachedResult() + RegExpCachedResult::offsetOfLastRegExp()) \
104     macro(JSGlobalObject_regExpGlobalData_cachedResult_lastInput, JSGlobalObject::regExpGlobalDataOffset() + RegExpGlobalData::offsetOfCachedResult() + RegExpCachedResult::offsetOfLastInput()) \
105     macro(JSGlobalObject_regExpGlobalData_cachedResult_result_start, JSGlobalObject::regExpGlobalDataOffset() + RegExpGlobalData::offsetOfCachedResult() + RegExpCachedResult::offsetOfResult() + OBJECT_OFFSETOF(MatchResult, start)) \
106     macro(JSGlobalObject_regExpGlobalData_cachedResult_result_end, JSGlobalObject::regExpGlobalDataOffset() + RegExpGlobalData::offsetOfCachedResult() + RegExpCachedResult::offsetOfResult() + OBJECT_OFFSETOF(MatchResult, end)) \
107     macro(JSGlobalObject_regExpGlobalData_cachedResult_reified, JSGlobalObject::regExpGlobalDataOffset() + RegExpGlobalData::offsetOfCachedResult() + RegExpCachedResult::offsetOfReified()) \
108     macro(JSObject_butterfly, JSObject::butterflyOffset()) \
109     macro(JSPropertyNameEnumerator_cachedInlineCapacity, JSPropertyNameEnumerator::cachedInlineCapacityOffset()) \
110     macro(JSPropertyNameEnumerator_cachedPropertyNamesVector, JSPropertyNameEnumerator::cachedPropertyNamesVectorOffset()) \
111     macro(JSPropertyNameEnumerator_cachedStructureID, JSPropertyNameEnumerator::cachedStructureIDOffset()) \
112     macro(JSPropertyNameEnumerator_endGenericPropertyIndex, JSPropertyNameEnumerator::endGenericPropertyIndexOffset()) \
113     macro(JSPropertyNameEnumerator_endStructurePropertyIndex, JSPropertyNameEnumerator::endStructurePropertyIndexOffset()) \
114     macro(JSPropertyNameEnumerator_indexLength, JSPropertyNameEnumerator::indexedLengthOffset()) \
115     macro(JSRopeString_flags, JSRopeString::offsetOfFlags()) \
116     macro(JSRopeString_length, JSRopeString::offsetOfLength()) \
117     macro(JSRopeString_fiber0, JSRopeString::offsetOfFiber0()) \
118     macro(JSRopeString_fiber1, JSRopeString::offsetOfFiber1()) \
119     macro(JSRopeString_fiber2, JSRopeString::offsetOfFiber2()) \
120     macro(JSScope_next, JSScope::offsetOfNext()) \
121     macro(JSSymbolTableObject_symbolTable, JSSymbolTableObject::offsetOfSymbolTable()) \
122     macro(JSWrapperObject_internalValue, JSWrapperObject::internalValueOffset()) \
123     macro(RegExpObject_regExpAndLastIndexIsNotWritableFlag, RegExpObject::offsetOfRegExpAndLastIndexIsNotWritableFlag()) \
124     macro(RegExpObject_lastIndex, RegExpObject::offsetOfLastIndex()) \
125     macro(ShadowChicken_Packet_callee, OBJECT_OFFSETOF(ShadowChicken::Packet, callee)) \
126     macro(ShadowChicken_Packet_frame, OBJECT_OFFSETOF(ShadowChicken::Packet, frame)) \
127     macro(ShadowChicken_Packet_callerFrame, OBJECT_OFFSETOF(ShadowChicken::Packet, callerFrame)) \
128     macro(ShadowChicken_Packet_thisValue, OBJECT_OFFSETOF(ShadowChicken::Packet, thisValue)) \
129     macro(ShadowChicken_Packet_scope, OBJECT_OFFSETOF(ShadowChicken::Packet, scope)) \
130     macro(ShadowChicken_Packet_codeBlock, OBJECT_OFFSETOF(ShadowChicken::Packet, codeBlock)) \
131     macro(ShadowChicken_Packet_callSiteIndex, OBJECT_OFFSETOF(ShadowChicken::Packet, callSiteIndex)) \
<span class="line-modified">132     macro(ScopedArguments_overrodeThings, ScopedArguments::offsetOfOverrodeThings()) \</span>


133     macro(ScopedArguments_scope, ScopedArguments::offsetOfScope()) \
<span class="line-added">134     macro(ScopedArguments_storage, ScopedArguments::offsetOfStorage()) \</span>
135     macro(ScopedArguments_table, ScopedArguments::offsetOfTable()) \
<span class="line-added">136     macro(ScopedArguments_totalLength, ScopedArguments::offsetOfTotalLength()) \</span>
137     macro(ScopedArgumentsTable_arguments, ScopedArgumentsTable::offsetOfArguments()) \
138     macro(ScopedArgumentsTable_length, ScopedArgumentsTable::offsetOfLength()) \
139     macro(StringImpl_data, StringImpl::dataOffset()) \
140     macro(StringImpl_hashAndFlags, StringImpl::flagsOffset()) \
141     macro(StringImpl_length, StringImpl::lengthMemoryOffset()) \
142     macro(Structure_classInfo, Structure::classInfoOffset()) \
143     macro(Structure_globalObject, Structure::globalObjectOffset()) \
144     macro(Structure_indexingModeIncludingHistory, Structure::indexingModeIncludingHistoryOffset()) \
145     macro(Structure_inlineCapacity, Structure::inlineCapacityOffset()) \
146     macro(Structure_previousOrRareData, Structure::previousOrRareDataOffset()) \
147     macro(Structure_prototype, Structure::prototypeOffset()) \
148     macro(Structure_structureID, Structure::structureIDOffset()) \
149     macro(StructureRareData_cachedOwnKeys, StructureRareData::offsetOfCachedOwnKeys()) \
150     macro(HashMapImpl_capacity, HashMapImpl&lt;HashMapBucket&lt;HashMapBucketDataKey&gt;&gt;::offsetOfCapacity()) \
151     macro(HashMapImpl_buffer,  HashMapImpl&lt;HashMapBucket&lt;HashMapBucketDataKey&gt;&gt;::offsetOfBuffer()) \
152     macro(HashMapImpl_head,  HashMapImpl&lt;HashMapBucket&lt;HashMapBucketDataKey&gt;&gt;::offsetOfHead()) \
153     macro(HashMapBucket_value, HashMapBucket&lt;HashMapBucketDataKeyValue&gt;::offsetOfValue()) \
154     macro(HashMapBucket_key, HashMapBucket&lt;HashMapBucketDataKeyValue&gt;::offsetOfKey()) \
155     macro(HashMapBucket_next, HashMapBucket&lt;HashMapBucketDataKeyValue&gt;::offsetOfNext()) \
156     macro(WeakMapImpl_capacity, WeakMapImpl&lt;WeakMapBucket&lt;WeakMapBucketDataKey&gt;&gt;::offsetOfCapacity()) \
157     macro(WeakMapImpl_buffer,  WeakMapImpl&lt;WeakMapBucket&lt;WeakMapBucketDataKey&gt;&gt;::offsetOfBuffer()) \
158     macro(WeakMapBucket_value, WeakMapBucket&lt;WeakMapBucketDataKeyValue&gt;::offsetOfValue()) \
159     macro(WeakMapBucket_key, WeakMapBucket&lt;WeakMapBucketDataKeyValue&gt;::offsetOfKey()) \
160     macro(Symbol_symbolImpl, Symbol::offsetOfSymbolImpl()) \

161 
162 #define FOR_EACH_INDEXED_ABSTRACT_HEAP(macro) \
163     macro(ArrayStorage_vector, ArrayStorage::vectorOffset(), sizeof(WriteBarrier&lt;Unknown&gt;)) \
164     macro(CompleteSubspace_allocatorForSizeStep, CompleteSubspace::offsetOfAllocatorForSizeStep(), sizeof(Allocator)) \
165     macro(DirectArguments_storage, DirectArguments::storageOffset(), sizeof(EncodedJSValue)) \
166     macro(JSLexicalEnvironment_variables, JSLexicalEnvironment::offsetOfVariables(), sizeof(EncodedJSValue)) \
167     macro(JSPropertyNameEnumerator_cachedPropertyNamesVectorContents, 0, sizeof(WriteBarrier&lt;JSString&gt;)) \
<span class="line-added">168     macro(JSInternalFieldObjectImpl_internalFields, JSInternalFieldObjectImpl&lt;&gt;::offsetOfInternalFields(), sizeof(WriteBarrier&lt;Unknown&gt;)) \</span>
169     macro(ScopedArguments_Storage_storage, 0, sizeof(EncodedJSValue)) \
170     macro(WriteBarrierBuffer_bufferContents, 0, sizeof(JSCell*)) \
171     macro(characters8, 0, sizeof(LChar)) \
172     macro(characters16, 0, sizeof(UChar)) \
173     macro(indexedInt32Properties, 0, sizeof(EncodedJSValue)) \
174     macro(indexedDoubleProperties, 0, sizeof(double)) \
175     macro(indexedContiguousProperties, 0, sizeof(EncodedJSValue)) \
176     macro(scopedArgumentsTableArguments, 0, sizeof(int32_t)) \
177     macro(singleCharacterStrings, 0, sizeof(JSString*)) \
178     macro(structureTable, 0, sizeof(Structure*)) \
179     macro(variables, 0, sizeof(Register)) \
180     macro(HasOwnPropertyCache, 0, sizeof(HasOwnPropertyCache::Entry)) \

181 
182 #define FOR_EACH_NUMBERED_ABSTRACT_HEAP(macro) \
183     macro(properties)
184 
185 // This class is meant to be cacheable between compilations, but it doesn&#39;t have to be.
186 // Doing so saves on creation of nodes. But clearing it will save memory.
187 
188 class AbstractHeapRepository {
189     WTF_MAKE_NONCOPYABLE(AbstractHeapRepository);
190 public:
191     AbstractHeapRepository();
192     ~AbstractHeapRepository();
193 
194     AbstractHeap root;
195 
196 #define ABSTRACT_HEAP_DECLARATION(name) AbstractHeap name;
197     FOR_EACH_ABSTRACT_HEAP(ABSTRACT_HEAP_DECLARATION)
198 #undef ABSTRACT_HEAP_DECLARATION
199 
200 #define ABSTRACT_FIELD_DECLARATION(name, offset) AbstractHeap name;
</pre>
</td>
</tr>
</table>
<center><a href="FTLAbstractHeapRepository.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FTLCapabilities.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>