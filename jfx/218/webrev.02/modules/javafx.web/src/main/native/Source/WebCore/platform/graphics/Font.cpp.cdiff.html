<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/Font.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FloatSize.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="Font.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/Font.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 31,14 ***</span>
<span class="line-new-header">--- 31,17 ---</span>
  #include &quot;Font.h&quot;
  
  #if PLATFORM(COCOA)
  #include &lt;pal/spi/cocoa/CoreTextSPI.h&gt;
  #endif
<span class="line-added">+ #include &quot;CachedFont.h&quot;</span>
  #include &quot;CharacterProperties.h&quot;
  #include &quot;FontCache.h&quot;
  #include &quot;FontCascade.h&quot;
<span class="line-added">+ #include &quot;FontCustomPlatformData.h&quot;</span>
  #include &quot;OpenTypeMathData.h&quot;
<span class="line-added">+ #include &quot;SharedBuffer.h&quot;</span>
  #include &lt;wtf/MathExtras.h&gt;
  #include &lt;wtf/NeverDestroyed.h&gt;
  #include &lt;wtf/text/AtomStringHash.h&gt;
  
  #if ENABLE(OPENTYPE_VERTICAL)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 50,20 ***</span>
<span class="line-new-header">--- 53,23 ---</span>
  unsigned GlyphPage::s_count = 0;
  
  const float smallCapsFontSizeMultiplier = 0.7f;
  const float emphasisMarkFontSizeMultiplier = 0.5f;
  
<span class="line-added">+ DEFINE_ALLOCATOR_WITH_HEAP_IDENTIFIER(Font);</span>
<span class="line-added">+ </span>
  Font::Font(const FontPlatformData&amp; platformData, Origin origin, Interstitial interstitial, Visibility visibility, OrientationFallback orientationFallback)
      : m_platformData(platformData)
      , m_origin(origin)
      , m_visibility(visibility)
      , m_treatAsFixedPitch(false)
      , m_isInterstitial(interstitial == Interstitial::Yes)
      , m_isTextOrientationFallback(orientationFallback == OrientationFallback::Yes)
      , m_isBrokenIdeographFallback(false)
      , m_hasVerticalGlyphs(false)
      , m_isUsedInSystemFallbackCache(false)
<span class="line-added">+     , m_allowsAntialiasing(true)</span>
  #if PLATFORM(IOS_FAMILY)
      , m_shouldNotBeUsedForArabic(false)
  #endif
  {
      platformInit();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 117,23 ***</span>
      // Nasty hack to determine if we should round or ceil space widths.
      // If the font is monospace or fake monospace we ceil to ensure that
      // every character and the space are the same width. Otherwise we round.
      if (glyphPageSpace)
          m_spaceGlyph = glyphPageSpace-&gt;glyphDataForCharacter(space).glyph;
<span class="line-removed">-     float width = widthForGlyph(m_spaceGlyph);</span>
<span class="line-removed">-     m_spaceWidth = width;</span>
      if (glyphPageCharacterZero)
          m_zeroGlyph = glyphPageCharacterZero-&gt;glyphDataForCharacter(&#39;0&#39;).glyph;
<span class="line-removed">-     m_fontMetrics.setZeroWidth(widthForGlyph(m_zeroGlyph));</span>
<span class="line-removed">-     determinePitch();</span>
<span class="line-removed">-     m_adjustedSpaceWidth = m_treatAsFixedPitch ? ceilf(width) : roundf(width);</span>
  
      // Force the glyph for ZERO WIDTH SPACE to have zero width, unless it is shared with SPACE.
      // Helvetica is an example of a non-zero width ZERO WIDTH SPACE glyph.
      // See &lt;http://bugs.webkit.org/show_bug.cgi?id=13178&gt; and Font::isZeroWidthSpaceGlyph()
      if (m_zeroWidthSpaceGlyph == m_spaceGlyph)
          m_zeroWidthSpaceGlyph = 0;
  }
  
  Font::~Font()
  {
      removeFromSystemFallbackCache();
<span class="line-new-header">--- 123,24 ---</span>
      // Nasty hack to determine if we should round or ceil space widths.
      // If the font is monospace or fake monospace we ceil to ensure that
      // every character and the space are the same width. Otherwise we round.
      if (glyphPageSpace)
          m_spaceGlyph = glyphPageSpace-&gt;glyphDataForCharacter(space).glyph;
      if (glyphPageCharacterZero)
          m_zeroGlyph = glyphPageCharacterZero-&gt;glyphDataForCharacter(&#39;0&#39;).glyph;
  
      // Force the glyph for ZERO WIDTH SPACE to have zero width, unless it is shared with SPACE.
      // Helvetica is an example of a non-zero width ZERO WIDTH SPACE glyph.
      // See &lt;http://bugs.webkit.org/show_bug.cgi?id=13178&gt; and Font::isZeroWidthSpaceGlyph()
      if (m_zeroWidthSpaceGlyph == m_spaceGlyph)
          m_zeroWidthSpaceGlyph = 0;
<span class="line-added">+ </span>
<span class="line-added">+     float width = widthForGlyph(m_spaceGlyph);</span>
<span class="line-added">+     m_spaceWidth = width;</span>
<span class="line-added">+     m_fontMetrics.setZeroWidth(widthForGlyph(m_zeroGlyph));</span>
<span class="line-added">+     determinePitch();</span>
<span class="line-added">+     m_adjustedSpaceWidth = m_treatAsFixedPitch ? ceilf(width) : roundf(width);</span>
  }
  
  Font::~Font()
  {
      removeFromSystemFallbackCache();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 490,24 ***</span>
  RefPtr&lt;Font&gt; Font::createScaledFont(const FontDescription&amp; fontDescription, float scaleFactor) const
  {
      return platformCreateScaledFont(fontDescription, scaleFactor);
  }
  
<span class="line-modified">! bool Font::applyTransforms(GlyphBufferGlyph* glyphs, GlyphBufferAdvance* advances, size_t glyphCount, bool enableKerning, bool requiresShaping) const</span>
  {
<span class="line-removed">- #if PLATFORM(COCOA)</span>
<span class="line-removed">-     CTFontTransformOptions options = (enableKerning ? kCTFontTransformApplyPositioning : 0) | (requiresShaping ? kCTFontTransformApplyShaping : 0);</span>
<span class="line-removed">-     return CTFontTransformGlyphs(m_platformData.ctFont(), glyphs, reinterpret_cast&lt;CGSize*&gt;(advances), glyphCount, options);</span>
<span class="line-removed">- #else</span>
<span class="line-removed">-     UNUSED_PARAM(glyphs);</span>
<span class="line-removed">-     UNUSED_PARAM(advances);</span>
<span class="line-removed">-     UNUSED_PARAM(glyphCount);</span>
<span class="line-removed">-     UNUSED_PARAM(enableKerning);</span>
<span class="line-removed">-     UNUSED_PARAM(requiresShaping);</span>
<span class="line-removed">-     return false;</span>
<span class="line-removed">- #endif</span>
  }
  
  class CharacterFallbackMapKey {
  public:
      CharacterFallbackMapKey()
      {
<span class="line-new-header">--- 497,15 ---</span>
  RefPtr&lt;Font&gt; Font::createScaledFont(const FontDescription&amp; fontDescription, float scaleFactor) const
  {
      return platformCreateScaledFont(fontDescription, scaleFactor);
  }
  
<span class="line-modified">! #if !PLATFORM(COCOA)</span>
<span class="line-added">+ void Font::applyTransforms(GlyphBuffer&amp;, unsigned, bool, bool, const AtomString&amp;) const</span>
  {
  }
<span class="line-added">+ #endif</span>
  
  class CharacterFallbackMapKey {
  public:
      CharacterFallbackMapKey()
      {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 699,6 ***</span>
<span class="line-new-header">--- 697,20 ---</span>
      auto path = platformPathForGlyph(glyph);
      m_glyphPathMap.setMetricsForGlyph(glyph, path);
      return *m_glyphPathMap.existingMetricsForGlyph(glyph);
  }
  
<span class="line-added">+ void Font::setFontFaceData(RefPtr&lt;SharedBuffer&gt;&amp;&amp; fontFaceData)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     m_fontFaceData = WTFMove(fontFaceData);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ FontHandle::FontHandle(Ref&lt;SharedBuffer&gt;&amp;&amp; fontFaceData, Font::Origin origin, float fontSize, bool syntheticBold, bool syntheticItalic)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     bool wrapping;</span>
<span class="line-added">+     auto customFontData = CachedFont::createCustomFontData(fontFaceData.get(), { }, wrapping);</span>
<span class="line-added">+     FontDescription description;</span>
<span class="line-added">+     description.setComputedSize(fontSize);</span>
<span class="line-added">+     font = Font::create(CachedFont::platformDataFromCustomData(*customFontData, description, syntheticBold, syntheticItalic, { }, { }), origin);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  } // namespace WebCore
</pre>
<center><a href="FloatSize.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="Font.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>