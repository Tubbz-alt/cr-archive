<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/bmalloc/bmalloc/IsoHeapInlines.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="IsoHeapImplInlines.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="IsoPage.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/bmalloc/bmalloc/IsoHeapInlines.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (C) 2017 Apple Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2017-2019 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -41,10 +41,20 @@</span>
  #include &quot;IsoTLSEntryInlines.h&quot;
  #include &quot;IsoTLSInlines.h&quot;
  
  namespace bmalloc { namespace api {
  
<span class="udiff-line-added">+ #if BENABLE_MALLOC_HEAP_BREAKDOWN</span>
<span class="udiff-line-added">+ template&lt;typename Type&gt;</span>
<span class="udiff-line-added">+ IsoHeap&lt;Type&gt;::IsoHeap(const char* heapClass)</span>
<span class="udiff-line-added">+     : m_zone(malloc_create_zone(0, 0))</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (heapClass)</span>
<span class="udiff-line-added">+         malloc_set_zone_name(m_zone, heapClass);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
  template&lt;typename Type&gt;
  void* IsoHeap&lt;Type&gt;::allocate()
  {
      bool abortOnFailure = true;
      return IsoTLS::allocate(*this, abortOnFailure);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -83,10 +93,11 @@</span>
      // IsoHeap::isInitialized gets m_impl with &quot;acquire&quot;, and IsoHeap::initialize stores
      // the value to m_impl with &quot;release&quot;. To make IsoHeap changes visible to any threads
      // when IsoHeap::isInitialized returns true, we need to store the value to m_impl *after*
      // all the initialization finishes.
      auto* heap = new IsoHeapImpl&lt;Config&gt;();
<span class="udiff-line-added">+     heap-&gt;addToAllIsoHeaps();</span>
      setAllocatorOffset(heap-&gt;allocatorOffset());
      setDeallocatorOffset(heap-&gt;deallocatorOffset());
      auto* atomic = reinterpret_cast&lt;std::atomic&lt;IsoHeapImpl&lt;Config&gt;*&gt;*&gt;(&amp;m_impl);
      atomic-&gt;store(heap, std::memory_order_release);
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -101,11 +112,11 @@</span>
  // This is most appropraite for template classes.
  #define MAKE_BISO_MALLOCED_INLINE(isoType) \
  public: \
      static ::bmalloc::api::IsoHeap&lt;isoType&gt;&amp; bisoHeap() \
      { \
<span class="udiff-line-modified-removed">-         static ::bmalloc::api::IsoHeap&lt;isoType&gt; heap; \</span>
<span class="udiff-line-modified-added">+         static ::bmalloc::api::IsoHeap&lt;isoType&gt; heap(&quot;WebKit_&quot;#isoType); \</span>
          return heap; \
      } \
      \
      void* operator new(size_t, void* p) { return p; } \
      void* operator new[](size_t, void* p) { return p; } \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -128,11 +139,11 @@</span>
  using __makeBisoMallocedInlineMacroSemicolonifier = int
  
  #define MAKE_BISO_MALLOCED_IMPL(isoType) \
  ::bmalloc::api::IsoHeap&lt;isoType&gt;&amp; isoType::bisoHeap() \
  { \
<span class="udiff-line-modified-removed">-     static ::bmalloc::api::IsoHeap&lt;isoType&gt; heap; \</span>
<span class="udiff-line-modified-added">+     static ::bmalloc::api::IsoHeap&lt;isoType&gt; heap(&quot;WebKit &quot;#isoType); \</span>
      return heap; \
  } \
  \
  void* isoType::operator new(size_t size) \
  { \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -149,11 +160,11 @@</span>
  
  #define MAKE_BISO_MALLOCED_IMPL_TEMPLATE(isoType) \
  template&lt;&gt; \
  ::bmalloc::api::IsoHeap&lt;isoType&gt;&amp; isoType::bisoHeap() \
  { \
<span class="udiff-line-modified-removed">-     static ::bmalloc::api::IsoHeap&lt;isoType&gt; heap; \</span>
<span class="udiff-line-modified-added">+     static ::bmalloc::api::IsoHeap&lt;isoType&gt; heap(&quot;WebKit_&quot;#isoType); \</span>
      return heap; \
  } \
  \
  template&lt;&gt; \
  void* isoType::operator new(size_t size) \
</pre>
<center><a href="IsoHeapImplInlines.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="IsoPage.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>