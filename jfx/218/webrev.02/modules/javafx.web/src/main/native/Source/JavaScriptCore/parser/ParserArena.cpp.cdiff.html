<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/parser/ParserArena.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Parser.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ParserArena.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/parser/ParserArena.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 24,15 ***</span>
<span class="line-new-header">--- 24,20 ---</span>
   */
  
  #include &quot;config.h&quot;
  #include &quot;ParserArena.h&quot;
  
<span class="line-added">+ #include &quot;CatchScope.h&quot;</span>
<span class="line-added">+ #include &quot;JSBigInt.h&quot;</span>
  #include &quot;Nodes.h&quot;
  #include &quot;JSCInlines.h&quot;
  
  namespace JSC {
  
<span class="line-added">+ DEFINE_ALLOCATOR_WITH_HEAP_IDENTIFIER(IdentifierArena);</span>
<span class="line-added">+ DEFINE_ALLOCATOR_WITH_HEAP_IDENTIFIER(ParserArena);</span>
<span class="line-added">+ </span>
  ParserArena::ParserArena()
      : m_freeableMemory(0)
      , m_freeablePoolEnd(0)
  {
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 48,15 ***</span>
      size_t size = m_deletableObjects.size();
      for (size_t i = 0; i &lt; size; ++i)
          m_deletableObjects[i]-&gt;~ParserArenaDeletable();
  
      if (m_freeablePoolEnd)
<span class="line-modified">!         fastFree(freeablePool());</span>
  
      size = m_freeablePools.size();
      for (size_t i = 0; i &lt; size; ++i)
<span class="line-modified">!         fastFree(m_freeablePools[i]);</span>
  }
  
  ParserArena::~ParserArena()
  {
      deallocateObjects();
<span class="line-new-header">--- 53,15 ---</span>
      size_t size = m_deletableObjects.size();
      for (size_t i = 0; i &lt; size; ++i)
          m_deletableObjects[i]-&gt;~ParserArenaDeletable();
  
      if (m_freeablePoolEnd)
<span class="line-modified">!         ParserArenaMalloc::free(freeablePool());</span>
  
      size = m_freeablePools.size();
      for (size_t i = 0; i &lt; size; ++i)
<span class="line-modified">!         ParserArenaMalloc::free(m_freeablePools[i]);</span>
  }
  
  ParserArena::~ParserArena()
  {
      deallocateObjects();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 65,12 ***</span>
  void ParserArena::allocateFreeablePool()
  {
      if (m_freeablePoolEnd)
          m_freeablePools.append(freeablePool());
  
<span class="line-modified">!     char* pool = static_cast&lt;char*&gt;(fastMalloc(freeablePoolSize));</span>
      m_freeableMemory = pool;
      m_freeablePoolEnd = pool + freeablePoolSize;
      ASSERT(freeablePool() == pool);
  }
  
  }
<span class="line-new-header">--- 70,32 ---</span>
  void ParserArena::allocateFreeablePool()
  {
      if (m_freeablePoolEnd)
          m_freeablePools.append(freeablePool());
  
<span class="line-modified">!     char* pool = static_cast&lt;char*&gt;(ParserArenaMalloc::malloc(freeablePoolSize));</span>
      m_freeableMemory = pool;
      m_freeablePoolEnd = pool + freeablePoolSize;
      ASSERT(freeablePool() == pool);
  }
  
<span class="line-added">+ const Identifier&amp; IdentifierArena::makeBigIntDecimalIdentifier(VM&amp; vm, const Identifier&amp; identifier, uint8_t radix)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (radix == 10)</span>
<span class="line-added">+         return identifier;</span>
<span class="line-added">+ </span>
<span class="line-added">+     // FIXME: We are allocating a JSBigInt just to be able to use</span>
<span class="line-added">+     // JSBigInt::tryGetString when radix is not 10.</span>
<span class="line-added">+     // This creates some GC pressure, but since these identifiers</span>
<span class="line-added">+     // will only be created when BigInt literal is used as a property name,</span>
<span class="line-added">+     // it wont be much problematic, given such cases are very rare.</span>
<span class="line-added">+     // There is a lot of optimizations we can apply here when necessary.</span>
<span class="line-added">+     // https://bugs.webkit.org/show_bug.cgi?id=207627</span>
<span class="line-added">+ </span>
<span class="line-added">+     auto scope = DECLARE_CATCH_SCOPE(vm);</span>
<span class="line-added">+     JSBigInt* bigInt = JSBigInt::parseInt(nullptr, vm, identifier.string(), radix, JSBigInt::ErrorParseMode::ThrowExceptions, JSBigInt::ParseIntSign::Unsigned);</span>
<span class="line-added">+     scope.assertNoException();</span>
<span class="line-added">+     m_identifiers.append(Identifier::fromString(vm, JSBigInt::tryGetString(vm, bigInt, 10)));</span>
<span class="line-added">+     return m_identifiers.last();</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  }
</pre>
<center><a href="Parser.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ParserArena.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>