<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/API/JSCallbackObject.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSCallbackObject.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSCallbackObjectFunctions.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/API/JSCallbackObject.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
107         {
108             LockHolder locker(m_lock);
109             for (auto&amp; pair : m_propertyMap) {
110                 if (pair.value)
111                     visitor.append(pair.value);
112             }
113         }
114 
115     private:
116         typedef HashMap&lt;RefPtr&lt;UniquedStringImpl&gt;, WriteBarrier&lt;Unknown&gt;, IdentifierRepHash&gt; PrivatePropertyMap;
117         PrivatePropertyMap m_propertyMap;
118         Lock m_lock;
119     };
120     std::unique_ptr&lt;JSPrivatePropertyMap&gt; m_privateProperties;
121 };
122 
123 
124 template &lt;class Parent&gt;
125 class JSCallbackObject final : public Parent {
126 protected:
<span class="line-modified">127     JSCallbackObject(ExecState*, Structure*, JSClassRef, void* data);</span>
128     JSCallbackObject(VM&amp;, JSClassRef, Structure*);
129 
<span class="line-modified">130     void finishCreation(ExecState*);</span>
131     void finishCreation(VM&amp;);
132 
133 public:
<span class="line-modified">134     typedef Parent Base;</span>
<span class="line-modified">135     static const unsigned StructureFlags = Base::StructureFlags | ProhibitsPropertyCaching | OverridesGetOwnPropertySlot | InterceptsGetOwnPropertySlotByIndexEvenWhenLengthIsNotZero | ImplementsHasInstance | OverridesGetPropertyNames | OverridesGetCallData;</span>
136     static_assert(!(StructureFlags &amp; ImplementsDefaultHasInstance), &quot;using customHasInstance&quot;);
137 
138     ~JSCallbackObject();
139 
<span class="line-modified">140     static JSCallbackObject* create(ExecState* exec, JSGlobalObject* globalObject, Structure* structure, JSClassRef classRef, void* data)</span>
141     {
<span class="line-modified">142         VM&amp; vm = exec-&gt;vm();</span>
143         ASSERT_UNUSED(globalObject, !structure-&gt;globalObject() || structure-&gt;globalObject() == globalObject);
<span class="line-modified">144         JSCallbackObject* callbackObject = new (NotNull, allocateCell&lt;JSCallbackObject&gt;(vm.heap)) JSCallbackObject(exec, structure, classRef, data);</span>
<span class="line-modified">145         callbackObject-&gt;finishCreation(exec);</span>
146         return callbackObject;
147     }
148     static JSCallbackObject&lt;Parent&gt;* create(VM&amp;, JSClassRef, Structure*);
149 
150     static const bool needsDestruction;
151     static void destroy(JSCell* cell)
152     {
153         static_cast&lt;JSCallbackObject*&gt;(cell)-&gt;JSCallbackObject::~JSCallbackObject();
154     }
155 






156     void setPrivate(void* data);
157     void* getPrivate();
158 
159     // FIXME: We should fix the warnings for extern-template in JSObject template classes: https://bugs.webkit.org/show_bug.cgi?id=161979
160     IGNORE_CLANG_WARNINGS_BEGIN(&quot;undefined-var-template&quot;)
161     DECLARE_INFO;
162     IGNORE_CLANG_WARNINGS_END
163 
164     JSClassRef classRef() const { return m_callbackObjectData-&gt;jsClass; }
165     bool inherits(JSClassRef) const;
166 
167     static Structure* createStructure(VM&amp;, JSGlobalObject*, JSValue);
168 
169     JSValue getPrivateProperty(const Identifier&amp; propertyName) const
170     {
171         return m_callbackObjectData-&gt;getPrivateProperty(propertyName);
172     }
173 
174     void setPrivateProperty(VM&amp; vm, const Identifier&amp; propertyName, JSValue value)
175     {
176         m_callbackObjectData-&gt;setPrivateProperty(vm, this, propertyName, value);
177     }
178 
179     void deletePrivateProperty(const Identifier&amp; propertyName)
180     {
181         m_callbackObjectData-&gt;deletePrivateProperty(propertyName);
182     }
183 
184     using Parent::methodTable;
185 
186 private:

187     static String className(const JSObject*, VM&amp;);
<span class="line-modified">188     static String toStringName(const JSObject*, ExecState*);</span>
189 
<span class="line-modified">190     static JSValue defaultValue(const JSObject*, ExecState*, PreferredPrimitiveType);</span>
191 
<span class="line-modified">192     static bool getOwnPropertySlot(JSObject*, ExecState*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">193     static bool getOwnPropertySlotByIndex(JSObject*, ExecState*, unsigned propertyName, PropertySlot&amp;);</span>
194 
<span class="line-modified">195     static bool put(JSCell*, ExecState*, PropertyName, JSValue, PutPropertySlot&amp;);</span>
<span class="line-modified">196     static bool putByIndex(JSCell*, ExecState*, unsigned, JSValue, bool shouldThrow);</span>
197 
<span class="line-modified">198     static bool deleteProperty(JSCell*, ExecState*, PropertyName);</span>
<span class="line-modified">199     static bool deletePropertyByIndex(JSCell*, ExecState*, unsigned);</span>
200 
<span class="line-modified">201     static bool customHasInstance(JSObject*, ExecState*, JSValue);</span>
202 
<span class="line-modified">203     static void getOwnNonIndexPropertyNames(JSObject*, ExecState*, PropertyNameArray&amp;, EnumerationMode);</span>
204 
205     static ConstructType getConstructData(JSCell*, ConstructData&amp;);
206     static CallType getCallData(JSCell*, CallData&amp;);
207 
208     static void visitChildren(JSCell* cell, SlotVisitor&amp; visitor)
209     {
210         JSCallbackObject* thisObject = jsCast&lt;JSCallbackObject*&gt;(cell);
211         ASSERT_GC_OBJECT_INHERITS((static_cast&lt;Parent*&gt;(thisObject)), JSCallbackObject&lt;Parent&gt;::info());
212         Parent::visitChildren(thisObject, visitor);
213         thisObject-&gt;m_callbackObjectData-&gt;visitChildren(visitor);
214     }
215 
<span class="line-modified">216     void init(ExecState*);</span>
217 
218     static JSCallbackObject* asCallbackObject(JSValue);
219     static JSCallbackObject* asCallbackObject(EncodedJSValue);
220 
<span class="line-modified">221     static EncodedJSValue JSC_HOST_CALL call(ExecState*);</span>
<span class="line-modified">222     static EncodedJSValue JSC_HOST_CALL construct(ExecState*);</span>
223 
<span class="line-modified">224     JSValue getStaticValue(ExecState*, PropertyName);</span>
<span class="line-modified">225     static EncodedJSValue staticFunctionGetter(ExecState*, EncodedJSValue, PropertyName);</span>
<span class="line-modified">226     static EncodedJSValue callbackGetter(ExecState*, EncodedJSValue, PropertyName);</span>
227 
228     std::unique_ptr&lt;JSCallbackObjectData&gt; m_callbackObjectData;
229     const ClassInfo* m_classInfo { nullptr };
230 };
231 
232 } // namespace JSC
233 
234 // include the actual template class implementation
235 #include &quot;JSCallbackObjectFunctions.h&quot;
236 
237 #endif // JSCallbackObject_h
</pre>
</td>
<td>
<hr />
<pre>
107         {
108             LockHolder locker(m_lock);
109             for (auto&amp; pair : m_propertyMap) {
110                 if (pair.value)
111                     visitor.append(pair.value);
112             }
113         }
114 
115     private:
116         typedef HashMap&lt;RefPtr&lt;UniquedStringImpl&gt;, WriteBarrier&lt;Unknown&gt;, IdentifierRepHash&gt; PrivatePropertyMap;
117         PrivatePropertyMap m_propertyMap;
118         Lock m_lock;
119     };
120     std::unique_ptr&lt;JSPrivatePropertyMap&gt; m_privateProperties;
121 };
122 
123 
124 template &lt;class Parent&gt;
125 class JSCallbackObject final : public Parent {
126 protected:
<span class="line-modified">127     JSCallbackObject(JSGlobalObject*, Structure*, JSClassRef, void* data);</span>
128     JSCallbackObject(VM&amp;, JSClassRef, Structure*);
129 
<span class="line-modified">130     void finishCreation(JSGlobalObject*);</span>
131     void finishCreation(VM&amp;);
132 
133 public:
<span class="line-modified">134     using Base = Parent;</span>
<span class="line-modified">135     static constexpr unsigned StructureFlags = Base::StructureFlags | ProhibitsPropertyCaching | OverridesGetOwnPropertySlot | InterceptsGetOwnPropertySlotByIndexEvenWhenLengthIsNotZero | ImplementsHasInstance | OverridesGetPropertyNames | OverridesGetCallData;</span>
136     static_assert(!(StructureFlags &amp; ImplementsDefaultHasInstance), &quot;using customHasInstance&quot;);
137 
138     ~JSCallbackObject();
139 
<span class="line-modified">140     static JSCallbackObject* create(JSGlobalObject* globalObject, Structure* structure, JSClassRef classRef, void* data)</span>
141     {
<span class="line-modified">142         VM&amp; vm = getVM(globalObject);</span>
143         ASSERT_UNUSED(globalObject, !structure-&gt;globalObject() || structure-&gt;globalObject() == globalObject);
<span class="line-modified">144         JSCallbackObject* callbackObject = new (NotNull, allocateCell&lt;JSCallbackObject&gt;(vm.heap)) JSCallbackObject(globalObject, structure, classRef, data);</span>
<span class="line-modified">145         callbackObject-&gt;finishCreation(globalObject);</span>
146         return callbackObject;
147     }
148     static JSCallbackObject&lt;Parent&gt;* create(VM&amp;, JSClassRef, Structure*);
149 
150     static const bool needsDestruction;
151     static void destroy(JSCell* cell)
152     {
153         static_cast&lt;JSCallbackObject*&gt;(cell)-&gt;JSCallbackObject::~JSCallbackObject();
154     }
155 
<span class="line-added">156     template&lt;typename CellType, SubspaceAccess mode&gt;</span>
<span class="line-added">157     static IsoSubspace* subspaceFor(VM&amp; vm)</span>
<span class="line-added">158     {</span>
<span class="line-added">159         return subspaceForImpl(vm, mode);</span>
<span class="line-added">160     }</span>
<span class="line-added">161 </span>
162     void setPrivate(void* data);
163     void* getPrivate();
164 
165     // FIXME: We should fix the warnings for extern-template in JSObject template classes: https://bugs.webkit.org/show_bug.cgi?id=161979
166     IGNORE_CLANG_WARNINGS_BEGIN(&quot;undefined-var-template&quot;)
167     DECLARE_INFO;
168     IGNORE_CLANG_WARNINGS_END
169 
170     JSClassRef classRef() const { return m_callbackObjectData-&gt;jsClass; }
171     bool inherits(JSClassRef) const;
172 
173     static Structure* createStructure(VM&amp;, JSGlobalObject*, JSValue);
174 
175     JSValue getPrivateProperty(const Identifier&amp; propertyName) const
176     {
177         return m_callbackObjectData-&gt;getPrivateProperty(propertyName);
178     }
179 
180     void setPrivateProperty(VM&amp; vm, const Identifier&amp; propertyName, JSValue value)
181     {
182         m_callbackObjectData-&gt;setPrivateProperty(vm, this, propertyName, value);
183     }
184 
185     void deletePrivateProperty(const Identifier&amp; propertyName)
186     {
187         m_callbackObjectData-&gt;deletePrivateProperty(propertyName);
188     }
189 
190     using Parent::methodTable;
191 
192 private:
<span class="line-added">193     static IsoSubspace* subspaceForImpl(VM&amp;, SubspaceAccess);</span>
194     static String className(const JSObject*, VM&amp;);
<span class="line-modified">195     static String toStringName(const JSObject*, JSGlobalObject*);</span>
196 
<span class="line-modified">197     static JSValue defaultValue(const JSObject*, JSGlobalObject*, PreferredPrimitiveType);</span>
198 
<span class="line-modified">199     static bool getOwnPropertySlot(JSObject*, JSGlobalObject*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">200     static bool getOwnPropertySlotByIndex(JSObject*, JSGlobalObject*, unsigned propertyName, PropertySlot&amp;);</span>
201 
<span class="line-modified">202     static bool put(JSCell*, JSGlobalObject*, PropertyName, JSValue, PutPropertySlot&amp;);</span>
<span class="line-modified">203     static bool putByIndex(JSCell*, JSGlobalObject*, unsigned, JSValue, bool shouldThrow);</span>
204 
<span class="line-modified">205     static bool deleteProperty(JSCell*, JSGlobalObject*, PropertyName);</span>
<span class="line-modified">206     static bool deletePropertyByIndex(JSCell*, JSGlobalObject*, unsigned);</span>
207 
<span class="line-modified">208     static bool customHasInstance(JSObject*, JSGlobalObject*, JSValue);</span>
209 
<span class="line-modified">210     static void getOwnNonIndexPropertyNames(JSObject*, JSGlobalObject*, PropertyNameArray&amp;, EnumerationMode);</span>
211 
212     static ConstructType getConstructData(JSCell*, ConstructData&amp;);
213     static CallType getCallData(JSCell*, CallData&amp;);
214 
215     static void visitChildren(JSCell* cell, SlotVisitor&amp; visitor)
216     {
217         JSCallbackObject* thisObject = jsCast&lt;JSCallbackObject*&gt;(cell);
218         ASSERT_GC_OBJECT_INHERITS((static_cast&lt;Parent*&gt;(thisObject)), JSCallbackObject&lt;Parent&gt;::info());
219         Parent::visitChildren(thisObject, visitor);
220         thisObject-&gt;m_callbackObjectData-&gt;visitChildren(visitor);
221     }
222 
<span class="line-modified">223     void init(JSGlobalObject*);</span>
224 
225     static JSCallbackObject* asCallbackObject(JSValue);
226     static JSCallbackObject* asCallbackObject(EncodedJSValue);
227 
<span class="line-modified">228     static EncodedJSValue JSC_HOST_CALL call(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified">229     static EncodedJSValue JSC_HOST_CALL construct(JSGlobalObject*, CallFrame*);</span>
230 
<span class="line-modified">231     JSValue getStaticValue(JSGlobalObject*, PropertyName);</span>
<span class="line-modified">232     static EncodedJSValue staticFunctionGetter(JSGlobalObject*, EncodedJSValue, PropertyName);</span>
<span class="line-modified">233     static EncodedJSValue callbackGetter(JSGlobalObject*, EncodedJSValue, PropertyName);</span>
234 
235     std::unique_ptr&lt;JSCallbackObjectData&gt; m_callbackObjectData;
236     const ClassInfo* m_classInfo { nullptr };
237 };
238 
239 } // namespace JSC
240 
241 // include the actual template class implementation
242 #include &quot;JSCallbackObjectFunctions.h&quot;
243 
244 #endif // JSCallbackObject_h
</pre>
</td>
</tr>
</table>
<center><a href="JSCallbackObject.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSCallbackObjectFunctions.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>