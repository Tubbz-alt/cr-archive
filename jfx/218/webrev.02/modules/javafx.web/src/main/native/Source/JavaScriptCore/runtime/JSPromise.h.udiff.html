<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSPromise.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSPromise.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSPromiseConstructor.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSPromise.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -23,40 +23,69 @@</span>
   * THE POSSIBILITY OF SUCH DAMAGE.
   */
  
  #pragma once
  
<span class="udiff-line-modified-removed">- #include &quot;JSObject.h&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;JSInternalFieldObjectImpl.h&quot;</span>
  
  namespace JSC {
  
<span class="udiff-line-modified-removed">- class JSPromise : public JSNonFinalObject {</span>
<span class="udiff-line-modified-added">+ class JSPromiseConstructor;</span>
<span class="udiff-line-added">+ class JSPromise : public JSInternalFieldObjectImpl&lt;2&gt; {</span>
  public:
<span class="udiff-line-modified-removed">-     using Base = JSNonFinalObject;</span>
<span class="udiff-line-modified-added">+     using Base = JSInternalFieldObjectImpl&lt;2&gt;;</span>
  
<span class="udiff-line-modified-removed">-     static JSPromise* create(VM&amp;, Structure*);</span>
<span class="udiff-line-modified-added">+     template&lt;typename CellType, SubspaceAccess mode&gt;</span>
<span class="udiff-line-added">+     static IsoSubspace* subspaceFor(VM&amp; vm)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         return &amp;vm.promiseSpace;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     JS_EXPORT_PRIVATE static JSPromise* create(VM&amp;, Structure*);</span>
      static Structure* createStructure(VM&amp;, JSGlobalObject*, JSValue);
  
      DECLARE_EXPORT_INFO;
  
      enum class Status : unsigned {
<span class="udiff-line-modified-removed">-         Pending = 1,</span>
<span class="udiff-line-modified-removed">-         Fulfilled,</span>
<span class="udiff-line-modified-removed">-         Rejected</span>
<span class="udiff-line-modified-added">+         Pending = 0, // Making this as 0, so that, we can change the status from Pending to others without masking.</span>
<span class="udiff-line-modified-added">+         Fulfilled = 1,</span>
<span class="udiff-line-modified-added">+         Rejected = 2,</span>
<span class="udiff-line-added">+     };</span>
<span class="udiff-line-added">+     static constexpr uint32_t isHandledFlag = 4;</span>
<span class="udiff-line-added">+     static constexpr uint32_t isFirstResolvingFunctionCalledFlag = 8;</span>
<span class="udiff-line-added">+     static constexpr uint32_t stateMask = 0b11;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     enum class Field : unsigned {</span>
<span class="udiff-line-added">+         Flags = 0,</span>
<span class="udiff-line-added">+         ReactionsOrResult = 1,</span>
      };
<span class="udiff-line-added">+     static_assert(numberOfInternalFields == 2);</span>
  
      JS_EXPORT_PRIVATE Status status(VM&amp;) const;
      JS_EXPORT_PRIVATE JSValue result(VM&amp;) const;
      JS_EXPORT_PRIVATE bool isHandled(VM&amp;) const;
  
<span class="udiff-line-modified-removed">-     // Initialize the promise with the executor.</span>
<span class="udiff-line-removed">-     // This may raise a JS exception.</span>
<span class="udiff-line-removed">-     void initialize(ExecState*, JSGlobalObject*, JSValue executor);</span>
<span class="udiff-line-modified-added">+     JS_EXPORT_PRIVATE static JSPromise* resolvedPromise(JSGlobalObject*, JSValue);</span>
  
<span class="udiff-line-modified-removed">-     JS_EXPORT_PRIVATE static JSPromise* resolve(JSGlobalObject&amp;, JSValue);</span>
<span class="udiff-line-modified-added">+     JS_EXPORT_PRIVATE void resolve(JSGlobalObject*, JSValue);</span>
<span class="udiff-line-added">+     JS_EXPORT_PRIVATE void reject(JSGlobalObject*, JSValue);</span>
<span class="udiff-line-added">+     JS_EXPORT_PRIVATE void reject(JSGlobalObject*, Exception*);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     struct DeferredData {</span>
<span class="udiff-line-added">+         WTF_FORBID_HEAP_ALLOCATION;</span>
<span class="udiff-line-added">+     public:</span>
<span class="udiff-line-added">+         JSPromise* promise { nullptr };</span>
<span class="udiff-line-added">+         JSFunction* resolve { nullptr };</span>
<span class="udiff-line-added">+         JSFunction* reject { nullptr };</span>
<span class="udiff-line-added">+     };</span>
<span class="udiff-line-added">+     static DeferredData createDeferredData(JSGlobalObject*, JSPromiseConstructor*);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     static void visitChildren(JSCell*, SlotVisitor&amp;);</span>
  
  protected:
      JSPromise(VM&amp;, Structure*);
      void finishCreation(VM&amp;);
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     uint32_t flags() const;</span>
  };
  
  } // namespace JSC
</pre>
<center><a href="JSPromise.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSPromiseConstructor.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>