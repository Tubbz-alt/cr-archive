<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMSetLike.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2019 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;JSDOMBinding.h&quot;
 29 #include &quot;JSDOMConvert.h&quot;
 30 #include &quot;JSDOMGlobalObject.h&quot;
 31 #include &lt;JavaScriptCore/BuiltinNames.h&gt;
 32 #include &lt;JavaScriptCore/CommonIdentifiers.h&gt;
 33 
 34 namespace WebCore {
 35 
 36 WEBCORE_EXPORT std::pair&lt;bool, std::reference_wrapper&lt;JSC::JSObject&gt;&gt; getBackingSet(JSC::JSGlobalObject&amp;, JSC::JSObject&amp; setLike);
 37 WEBCORE_EXPORT JSC::JSValue forwardForEachCallToBackingSet(JSDOMGlobalObject&amp;, JSC::CallFrame&amp;, JSC::JSObject&amp; setLike);
 38 WEBCORE_EXPORT JSC::JSValue forwardAttributeGetterToBackingSet(JSC::JSGlobalObject&amp;, JSC::JSObject&amp;, const JSC::Identifier&amp;);
 39 WEBCORE_EXPORT JSC::JSValue forwardFunctionCallToBackingSet(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, JSC::JSObject&amp;, const JSC::Identifier&amp;);
 40 WEBCORE_EXPORT void clearBackingSet(JSC::JSGlobalObject&amp;, JSC::JSObject&amp;);
 41 WEBCORE_EXPORT void addToBackingSet(JSC::JSGlobalObject&amp;, JSC::JSObject&amp;, JSC::JSValue item);
 42 
 43 template&lt;typename WrapperClass&gt; JSC::JSObject&amp; getAndInitializeBackingSet(JSC::JSGlobalObject&amp;, WrapperClass&amp;);
 44 template&lt;typename WrapperClass&gt; JSC::JSValue forwardSizeToSetLike(JSC::JSGlobalObject&amp;, WrapperClass&amp;);
 45 template&lt;typename WrapperClass&gt; JSC::JSValue forwardEntriesToSetLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;);
 46 template&lt;typename WrapperClass&gt; JSC::JSValue forwardKeysToSetLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;);
 47 template&lt;typename WrapperClass&gt; JSC::JSValue forwardValuesToSetLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;);
 48 template&lt;typename WrapperClass, typename Callback&gt; JSC::JSValue forwardForEachToSetLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;, Callback&amp;&amp;);
 49 template&lt;typename WrapperClass&gt; JSC::JSValue forwardClearToSetLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;);
 50 
 51 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardHasToSetLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;, ItemType&amp;&amp;);
 52 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardAddToSetLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;, ItemType&amp;&amp;);
 53 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardDeleteToSetLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;, ItemType&amp;&amp;);
 54 
 55 class DOMSetAdapter {
 56 public:
 57     DOMSetAdapter(JSC::JSGlobalObject&amp;, JSC::JSObject&amp;);
 58     template&lt;typename IDLType&gt; void add(typename IDLType::ParameterType value);
 59     void clear();
 60 
 61 private:
 62     JSC::JSGlobalObject&amp; m_lexicalGlobalObject;
 63     JSC::JSObject&amp; m_backingSet;
 64 };
 65 
 66 inline DOMSetAdapter::DOMSetAdapter(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::JSObject&amp; backingSet)
 67     : m_lexicalGlobalObject(lexicalGlobalObject)
 68     , m_backingSet(backingSet)
 69 {
 70 }
 71 
 72 template&lt;typename IDLType&gt;
 73 void DOMSetAdapter::add(typename IDLType::ParameterType value)
 74 {
 75     JSC::JSLockHolder locker(&amp;m_lexicalGlobalObject);
 76     auto item = toJS&lt;IDLType&gt;(m_lexicalGlobalObject, *JSC::jsCast&lt;JSDOMGlobalObject*&gt;(&amp;m_lexicalGlobalObject), std::forward&lt;typename IDLType::ParameterType&gt;(value));
 77     addToBackingSet(m_lexicalGlobalObject, m_backingSet, item);
 78 }
 79 
 80 template&lt;typename WrapperClass&gt;
 81 JSC::JSObject&amp; getAndInitializeBackingSet(JSC::JSGlobalObject&amp; lexicalGlobalObject, WrapperClass&amp; setLike)
 82 {
 83     auto pair = getBackingSet(lexicalGlobalObject, setLike);
 84     if (pair.first) {
 85         DOMSetAdapter adapter { lexicalGlobalObject, pair.second.get() };
 86         setLike.wrapped().initializeSetLike(adapter);
 87     }
 88     return pair.second.get();
 89 }
 90 
 91 template&lt;typename WrapperClass&gt;
 92 JSC::JSValue forwardSizeToSetLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, WrapperClass&amp; setLike)
 93 {
 94     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);
 95     return forwardAttributeGetterToBackingSet(lexicalGlobalObject, getAndInitializeBackingSet(lexicalGlobalObject, setLike), vm.propertyNames-&gt;size);
 96 }
 97 
 98 template&lt;typename WrapperClass&gt;
 99 JSC::JSValue forwardEntriesToSetLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; setLike)
100 {
101     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);
102     return forwardFunctionCallToBackingSet(lexicalGlobalObject, callFrame, getAndInitializeBackingSet(lexicalGlobalObject, setLike), vm.propertyNames-&gt;builtinNames().entriesPublicName());
103 }
104 
105 template&lt;typename WrapperClass&gt;
106 JSC::JSValue forwardKeysToSetLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; setLike)
107 {
108     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);
109     return forwardFunctionCallToBackingSet(lexicalGlobalObject, callFrame, getAndInitializeBackingSet(lexicalGlobalObject, setLike), vm.propertyNames-&gt;builtinNames().keysPublicName());
110 }
111 
112 template&lt;typename WrapperClass&gt;
113 JSC::JSValue forwardValuesToSetLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; setLike)
114 {
115     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);
116     return forwardFunctionCallToBackingSet(lexicalGlobalObject, callFrame, getAndInitializeBackingSet(lexicalGlobalObject, setLike), vm.propertyNames-&gt;builtinNames().valuesPublicName());
117 }
118 
119 template&lt;typename WrapperClass, typename Callback&gt;
120 JSC::JSValue forwardForEachToSetLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; setLike, Callback&amp;&amp;)
121 {
122     getAndInitializeBackingSet(lexicalGlobalObject, setLike);
123     return forwardForEachCallToBackingSet(*JSC::jsCast&lt;JSDOMGlobalObject*&gt;(&amp;lexicalGlobalObject), callFrame, setLike);
124 }
125 
126 template&lt;typename WrapperClass&gt;
127 JSC::JSValue forwardClearToSetLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; setLike)
128 {
129     setLike.wrapped().clearFromSetLike();
130 
131     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);
132     return forwardFunctionCallToBackingSet(lexicalGlobalObject, callFrame, getAndInitializeBackingSet(lexicalGlobalObject, setLike), vm.propertyNames-&gt;clear);
133 }
134 
135 template&lt;typename WrapperClass, typename ItemType&gt;
136 JSC::JSValue forwardHasToSetLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; setLike, ItemType&amp;&amp;)
137 {
138     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);
139     return forwardFunctionCallToBackingSet(lexicalGlobalObject, callFrame, getAndInitializeBackingSet(lexicalGlobalObject, setLike), vm.propertyNames-&gt;builtinNames().hasPublicName());
140 }
141 
142 template&lt;typename WrapperClass, typename ItemType&gt;
143 JSC::JSValue forwardAddToSetLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; setLike, ItemType&amp;&amp; item)
144 {
145     setLike.wrapped().addToSetLike(std::forward&lt;ItemType&gt;(item));
146 
147     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);
148     forwardFunctionCallToBackingSet(lexicalGlobalObject, callFrame, getAndInitializeBackingSet(lexicalGlobalObject, setLike), vm.propertyNames-&gt;add);
149     return &amp;setLike;
150 }
151 
152 template&lt;typename WrapperClass, typename ItemType&gt;
153 JSC::JSValue forwardDeleteToSetLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; setLike, ItemType&amp;&amp; item)
154 {
155     auto isDeleted = setLike.wrapped().removeFromSetLike(std::forward&lt;ItemType&gt;(item));
156     UNUSED_PARAM(isDeleted);
157 
158     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);
159     auto result = forwardFunctionCallToBackingSet(lexicalGlobalObject, callFrame, getAndInitializeBackingSet(lexicalGlobalObject, setLike), vm.propertyNames-&gt;deleteKeyword);
160     ASSERT_UNUSED(result, result.asBoolean() == isDeleted);
161     return result;
162 }
163 
164 }
    </pre>
  </body>
</html>