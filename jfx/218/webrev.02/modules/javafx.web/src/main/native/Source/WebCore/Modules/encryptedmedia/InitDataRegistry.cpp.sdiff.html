<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/Modules/encryptedmedia/InitDataRegistry.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CDM.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaKeyEncryptionScheme.idl.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/encryptedmedia/InitDataRegistry.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
154 
155 Optional&lt;Vector&lt;Ref&lt;SharedBuffer&gt;&gt;&gt; InitDataRegistry::extractKeyIDsCenc(const SharedBuffer&amp; buffer)
156 {
157     Vector&lt;Ref&lt;SharedBuffer&gt;&gt; keyIDs;
158 
159     auto psshBoxes = extractPsshBoxesFromCenc(buffer);
160     if (!psshBoxes)
161         return WTF::nullopt;
162 
163     for (auto&amp; psshBox : psshBoxes.value()) {
164         ASSERT(psshBox);
165         if (!psshBox)
166             return WTF::nullopt;
167 
168 #if HAVE(FAIRPLAYSTREAMING_CENC_INITDATA)
169         if (is&lt;ISOFairPlayStreamingPsshBox&gt;(*psshBox)) {
170             ISOFairPlayStreamingPsshBox&amp; fpsPssh = downcast&lt;ISOFairPlayStreamingPsshBox&gt;(*psshBox);
171 
172             FourCC scheme = fpsPssh.initDataBox().info().scheme();
173             if (CDMPrivateFairPlayStreaming::validFairPlayStreamingSchemes().contains(scheme)) {
<span class="line-modified">174                 for (auto request : fpsPssh.initDataBox().requests()) {</span>
175                     auto&amp; keyID = request.requestInfo().keyID();
176                     keyIDs.append(SharedBuffer::create(keyID.data(), keyID.size()));
177                 }
178             }
179         }
180 #endif
181 
182         for (auto&amp; value : psshBox-&gt;keyIDs())
183             keyIDs.append(SharedBuffer::create(WTFMove(value)));
184     }
185 
186     return keyIDs;
187 }
188 
189 RefPtr&lt;SharedBuffer&gt; InitDataRegistry::sanitizeCenc(const SharedBuffer&amp; buffer)
190 {
191     // 4. Common SystemID and PSSH Box Format
192     // https://w3c.github.io/encrypted-media/format-registry/initdata/cenc.html#common-system
193     if (!extractKeyIDsCenc(buffer))
194         return nullptr;
</pre>
</td>
<td>
<hr />
<pre>
154 
155 Optional&lt;Vector&lt;Ref&lt;SharedBuffer&gt;&gt;&gt; InitDataRegistry::extractKeyIDsCenc(const SharedBuffer&amp; buffer)
156 {
157     Vector&lt;Ref&lt;SharedBuffer&gt;&gt; keyIDs;
158 
159     auto psshBoxes = extractPsshBoxesFromCenc(buffer);
160     if (!psshBoxes)
161         return WTF::nullopt;
162 
163     for (auto&amp; psshBox : psshBoxes.value()) {
164         ASSERT(psshBox);
165         if (!psshBox)
166             return WTF::nullopt;
167 
168 #if HAVE(FAIRPLAYSTREAMING_CENC_INITDATA)
169         if (is&lt;ISOFairPlayStreamingPsshBox&gt;(*psshBox)) {
170             ISOFairPlayStreamingPsshBox&amp; fpsPssh = downcast&lt;ISOFairPlayStreamingPsshBox&gt;(*psshBox);
171 
172             FourCC scheme = fpsPssh.initDataBox().info().scheme();
173             if (CDMPrivateFairPlayStreaming::validFairPlayStreamingSchemes().contains(scheme)) {
<span class="line-modified">174                 for (const auto&amp; request : fpsPssh.initDataBox().requests()) {</span>
175                     auto&amp; keyID = request.requestInfo().keyID();
176                     keyIDs.append(SharedBuffer::create(keyID.data(), keyID.size()));
177                 }
178             }
179         }
180 #endif
181 
182         for (auto&amp; value : psshBox-&gt;keyIDs())
183             keyIDs.append(SharedBuffer::create(WTFMove(value)));
184     }
185 
186     return keyIDs;
187 }
188 
189 RefPtr&lt;SharedBuffer&gt; InitDataRegistry::sanitizeCenc(const SharedBuffer&amp; buffer)
190 {
191     // 4. Common SystemID and PSSH Box Format
192     // https://w3c.github.io/encrypted-media/format-registry/initdata/cenc.html#common-system
193     if (!extractKeyIDsCenc(buffer))
194         return nullptr;
</pre>
</td>
</tr>
</table>
<center><a href="CDM.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaKeyEncryptionScheme.idl.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>