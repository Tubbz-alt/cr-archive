<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old modules/javafx.web/src/main/native/Source/WebCore/crypto/CommonCryptoUtilities.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2013-2018 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 14  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 15  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;CommonCryptoUtilities.h&quot;
 28 
 29 #if ENABLE(WEB_CRYPTO)
 30 
 31 #if !HAVE(CCRSAGetCRTComponents)
 32 
 33 #if USE(APPLE_INTERNAL_SDK)
 34 #include &lt;CommonCrypto/CommonBigNum.h&gt;
 35 #endif
 36 
 37 extern &quot;C&quot; CCBigNumRef CCBigNumFromData(CCStatus *status, const void *s, size_t len);
 38 extern &quot;C&quot; size_t CCBigNumToData(CCStatus *status, const CCBigNumRef bn, void *to);
 39 extern &quot;C&quot; uint32_t CCBigNumByteCount(const CCBigNumRef bn);
 40 extern &quot;C&quot; CCBigNumRef CCCreateBigNum(CCStatus *status);
 41 extern &quot;C&quot; void CCBigNumFree(CCBigNumRef bn);
 42 extern &quot;C&quot; CCBigNumRef CCBigNumCopy(CCStatus *status, const CCBigNumRef bn);
 43 extern &quot;C&quot; CCStatus CCBigNumSubI(CCBigNumRef result, const CCBigNumRef a, const uint32_t b);
 44 extern &quot;C&quot; CCStatus CCBigNumMod(CCBigNumRef result, CCBigNumRef dividend, CCBigNumRef modulus);
 45 extern &quot;C&quot; CCStatus CCBigNumInverseMod(CCBigNumRef result, const CCBigNumRef a, const CCBigNumRef modulus);
 46 
 47 #endif
 48 
 49 namespace WebCore {
 50 
 51 bool getCommonCryptoDigestAlgorithm(CryptoAlgorithmIdentifier hashFunction, CCDigestAlgorithm&amp; algorithm)
 52 {
 53     switch (hashFunction) {
 54     case CryptoAlgorithmIdentifier::SHA_1:
 55         ALLOW_DEPRECATED_DECLARATIONS_BEGIN
 56         algorithm = kCCDigestSHA1;
 57         ALLOW_DEPRECATED_DECLARATIONS_END
 58         return true;
 59     case CryptoAlgorithmIdentifier::SHA_224:
 60         algorithm = kCCDigestSHA224;
 61         return true;
 62     case CryptoAlgorithmIdentifier::SHA_256:
 63         algorithm = kCCDigestSHA256;
 64         return true;
 65     case CryptoAlgorithmIdentifier::SHA_384:
 66         algorithm = kCCDigestSHA384;
 67         return true;
 68     case CryptoAlgorithmIdentifier::SHA_512:
 69         algorithm = kCCDigestSHA512;
 70         return true;
 71     default:
 72         return false;
 73     }
 74 }
 75 
 76 #if !HAVE(CCRSAGetCRTComponents)
 77 
 78 CCBigNum::CCBigNum(CCBigNumRef number)
 79     : m_number(number)
 80 {
 81 }
 82 
 83 CCBigNum::CCBigNum(const uint8_t* data, size_t size)
 84 {
 85     CCStatus status = kCCSuccess;
 86     m_number = CCBigNumFromData(&amp;status, data, size);
 87     RELEASE_ASSERT(!status);
 88 }
 89 
 90 CCBigNum::~CCBigNum()
 91 {
 92     CCBigNumFree(m_number);
 93 }
 94 
 95 CCBigNum::CCBigNum(const CCBigNum&amp; other)
 96 {
 97     CCStatus status = kCCSuccess;
 98     m_number = CCBigNumCopy(&amp;status, other.m_number);
 99     RELEASE_ASSERT(!status);
100 }
101 
102 CCBigNum::CCBigNum(CCBigNum&amp;&amp; other)
103 {
104     m_number = other.m_number;
105     other.m_number = nullptr;
106 }
107 
108 CCBigNum&amp; CCBigNum::operator=(const CCBigNum&amp; other)
109 {
110     if (this == &amp;other)
111         return *this;
112 
113     CCBigNumFree(m_number);
114 
115     CCStatus status = kCCSuccess;
116     m_number = CCBigNumCopy(&amp;status, other.m_number);
117     RELEASE_ASSERT(!status);
118     return *this;
119 }
120 
121 CCBigNum&amp; CCBigNum::operator=(CCBigNum&amp;&amp; other)
122 {
123     if (this == &amp;other)
124         return *this;
125 
126     m_number = other.m_number;
127     other.m_number = nullptr;
128 
129     return *this;
130 }
131 
132 Vector&lt;uint8_t&gt; CCBigNum::data() const
133 {
134     Vector&lt;uint8_t&gt; result(CCBigNumByteCount(m_number));
135     CCStatus status = kCCSuccess;
136     CCBigNumToData(&amp;status, m_number, result.data());
137     RELEASE_ASSERT(!status);
138 
139     return result;
140 }
141 
142 CCBigNum CCBigNum::operator-(uint32_t b) const
143 {
144     CCStatus status = kCCSuccess;
145     CCBigNumRef result = CCCreateBigNum(&amp;status);
146     RELEASE_ASSERT(!status);
147 
148     status = CCBigNumSubI(result, m_number, b);
149     RELEASE_ASSERT(!status);
150 
151     return result;
152 }
153 
154 CCBigNum CCBigNum::operator%(const CCBigNum&amp; modulus) const
155 {
156     CCStatus status = kCCSuccess;
157     CCBigNumRef result = CCCreateBigNum(&amp;status);
158     RELEASE_ASSERT(!status);
159 
160     status = CCBigNumMod(result, m_number, modulus.m_number);
161     RELEASE_ASSERT(!status);
162 
163     return result;
164 }
165 
166 CCBigNum CCBigNum::inverse(const CCBigNum&amp; modulus) const
167 {
168     CCStatus status = kCCSuccess;
169     CCBigNumRef result = CCCreateBigNum(&amp;status);
170     RELEASE_ASSERT(!status);
171 
172     status = CCBigNumInverseMod(result, m_number, modulus.m_number);
173     RELEASE_ASSERT(!status);
174 
175     return result;
176 }
177 
178 #endif
179 
180 } // namespace WebCore
181 
182 #endif // ENABLE(WEB_CRYPTO)
    </pre>
  </body>
</html>