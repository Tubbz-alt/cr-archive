<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/network/java/NetworkStorageSessionJava.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../create-http-header-name-table.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../playstation/MIMETypeRegistryPlayStation.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/network/java/NetworkStorageSessionJava.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;NetworkStorageSession.h&quot;
 28 
 29 #include &quot;Cookie.h&quot;
 30 #include &quot;CookieRequestHeaderFieldProxy.h&quot;

 31 #include &quot;NetworkingContext.h&quot;
 32 #include &quot;NotImplemented.h&quot;
 33 #include &quot;ResourceHandle.h&quot;
 34 
 35 #include &lt;wtf/MainThread.h&gt;
 36 #include &lt;wtf/NeverDestroyed.h&gt;
 37 #include &lt;wtf/URL.h&gt;
 38 #include &quot;PlatformJavaClasses.h&quot;
 39 
 40 namespace WebCore {
 41 
 42 namespace CookieInternalJava {
 43 
 44 static JGClass cookieJarClass;
 45 static jmethodID getMethod;
 46 static jmethodID putMethod;
 47 
 48 static void initRefs(JNIEnv* env)
 49 {
 50     if (!cookieJarClass) {
</pre>
<hr />
<pre>
 75     JLString result = static_cast&lt;jstring&gt;(env-&gt;CallStaticObjectMethod(
 76             cookieJarClass,
 77             getMethod,
 78             (jstring) url.string().toJavaString(env),
 79             bool_to_jbool(includeHttpOnlyCookies)));
 80     WTF::CheckAndClearException(env);
 81 
 82     return result ? String(env, result) : emptyString();
 83 }
 84 }
 85 
 86 NetworkStorageSession::NetworkStorageSession(PAL::SessionID sessionID)
 87     : m_sessionID(sessionID)
 88 {
 89 }
 90 
 91 NetworkStorageSession::~NetworkStorageSession()
 92 {
 93 }
 94 
<span class="line-modified"> 95 void NetworkStorageSession::setCookiesFromDOM(const URL&amp; /*firstParty*/, const SameSiteInfo&amp;, const URL&amp; url, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, const String&amp; value) const</span>
 96 {
 97     using namespace CookieInternalJava;
 98     JNIEnv* env = WTF::GetJavaEnv();
 99     initRefs(env);
100 
101     env-&gt;CallStaticVoidMethod(
102             cookieJarClass,
103             putMethod,
104             (jstring) url.string().toJavaString(env),
105             (jstring) value.toJavaString(env));
106     WTF::CheckAndClearException(env);
107 }
108 
<span class="line-modified">109 std::pair&lt;String, bool&gt; NetworkStorageSession::cookiesForDOM(const URL&amp;, const SameSiteInfo&amp;, const URL&amp; url, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, IncludeSecureCookies) const</span>
110 {
111     // &#39;HttpOnly&#39; cookies should no be accessible from scripts, so we filter them out here.
112     return { CookieInternalJava::getCookies(url, false), false };
113 }
114 
<span class="line-modified">115 std::pair&lt;String, bool&gt; NetworkStorageSession::cookieRequestHeaderFieldValue(const URL&amp; /*firstParty*/, const SameSiteInfo&amp;, const URL&amp; url, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, IncludeSecureCookies) const</span>
116 {
117     return { CookieInternalJava::getCookies(url, true), true };
118 }
119 
120 std::pair&lt;String, bool&gt; NetworkStorageSession::cookieRequestHeaderFieldValue(const CookieRequestHeaderFieldProxy&amp; headerFieldProxy) const
121 {
122     return { CookieInternalJava::getCookies(headerFieldProxy.firstParty, true), true };
123 }
124 
<span class="line-modified">125 bool NetworkStorageSession::cookiesEnabled() const</span>
126 {
<span class="line-modified">127     return true;</span>

128 }
129 
<span class="line-modified">130 bool NetworkStorageSession::getRawCookies(const URL&amp; /*firstParty*/, const SameSiteInfo&amp;, const URL&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, Vector&lt;Cookie&gt;&amp;) const</span>
131 {
<span class="line-modified">132     notImplemented();</span>
<span class="line-removed">133     return false;</span>
134 }
135 
136 void NetworkStorageSession::setCookies(const Vector&lt;Cookie&gt;&amp;, const URL&amp;, const URL&amp;)
137 {
138     // FIXME: Implement for WebKit to use.
139 }
140 
141 void NetworkStorageSession::setCookie(const Cookie&amp;)
142 {
143     // FIXME: Implement for WebKit to use.
144 }
145 
146 void NetworkStorageSession::deleteCookie(const Cookie&amp;)
147 {
148     // FIXME: Implement for WebKit to use.
149 }
150 
151 void NetworkStorageSession::deleteCookie(const URL&amp;, const String&amp;) const
152 {
153     // FIXME: Implement for WebKit to use.
</pre>
</td>
<td>
<hr />
<pre>
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;NetworkStorageSession.h&quot;
 28 
 29 #include &quot;Cookie.h&quot;
 30 #include &quot;CookieRequestHeaderFieldProxy.h&quot;
<span class="line-added"> 31 #include &quot;HTTPCookieAcceptPolicy.h&quot;</span>
 32 #include &quot;NetworkingContext.h&quot;
 33 #include &quot;NotImplemented.h&quot;
 34 #include &quot;ResourceHandle.h&quot;
 35 
 36 #include &lt;wtf/MainThread.h&gt;
 37 #include &lt;wtf/NeverDestroyed.h&gt;
 38 #include &lt;wtf/URL.h&gt;
 39 #include &quot;PlatformJavaClasses.h&quot;
 40 
 41 namespace WebCore {
 42 
 43 namespace CookieInternalJava {
 44 
 45 static JGClass cookieJarClass;
 46 static jmethodID getMethod;
 47 static jmethodID putMethod;
 48 
 49 static void initRefs(JNIEnv* env)
 50 {
 51     if (!cookieJarClass) {
</pre>
<hr />
<pre>
 76     JLString result = static_cast&lt;jstring&gt;(env-&gt;CallStaticObjectMethod(
 77             cookieJarClass,
 78             getMethod,
 79             (jstring) url.string().toJavaString(env),
 80             bool_to_jbool(includeHttpOnlyCookies)));
 81     WTF::CheckAndClearException(env);
 82 
 83     return result ? String(env, result) : emptyString();
 84 }
 85 }
 86 
 87 NetworkStorageSession::NetworkStorageSession(PAL::SessionID sessionID)
 88     : m_sessionID(sessionID)
 89 {
 90 }
 91 
 92 NetworkStorageSession::~NetworkStorageSession()
 93 {
 94 }
 95 
<span class="line-modified"> 96 void NetworkStorageSession::setCookiesFromDOM(const URL&amp; /*firstParty*/, const SameSiteInfo&amp;, const URL&amp; url, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, ShouldAskITP, const String&amp; value) const</span>
 97 {
 98     using namespace CookieInternalJava;
 99     JNIEnv* env = WTF::GetJavaEnv();
100     initRefs(env);
101 
102     env-&gt;CallStaticVoidMethod(
103             cookieJarClass,
104             putMethod,
105             (jstring) url.string().toJavaString(env),
106             (jstring) value.toJavaString(env));
107     WTF::CheckAndClearException(env);
108 }
109 
<span class="line-modified">110 std::pair&lt;String, bool&gt; NetworkStorageSession::cookiesForDOM(const URL&amp;, const SameSiteInfo&amp;, const URL&amp; url, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, IncludeSecureCookies, ShouldAskITP) const</span>
111 {
112     // &#39;HttpOnly&#39; cookies should no be accessible from scripts, so we filter them out here.
113     return { CookieInternalJava::getCookies(url, false), false };
114 }
115 
<span class="line-modified">116 std::pair&lt;String, bool&gt; NetworkStorageSession::cookieRequestHeaderFieldValue(const URL&amp; /*firstParty*/, const SameSiteInfo&amp;, const URL&amp; url, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, IncludeSecureCookies, ShouldAskITP) const</span>
117 {
118     return { CookieInternalJava::getCookies(url, true), true };
119 }
120 
121 std::pair&lt;String, bool&gt; NetworkStorageSession::cookieRequestHeaderFieldValue(const CookieRequestHeaderFieldProxy&amp; headerFieldProxy) const
122 {
123     return { CookieInternalJava::getCookies(headerFieldProxy.firstParty, true), true };
124 }
125 
<span class="line-modified">126 bool NetworkStorageSession::getRawCookies(const URL&amp; /*firstParty*/, const SameSiteInfo&amp;, const URL&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, ShouldAskITP, Vector&lt;Cookie&gt;&amp;) const</span>
127 {
<span class="line-modified">128     notImplemented();</span>
<span class="line-added">129     return false;</span>
130 }
131 
<span class="line-modified">132 HTTPCookieAcceptPolicy NetworkStorageSession::cookieAcceptPolicy() const</span>
133 {
<span class="line-modified">134     return HTTPCookieAcceptPolicy::AlwaysAccept;</span>

135 }
136 
137 void NetworkStorageSession::setCookies(const Vector&lt;Cookie&gt;&amp;, const URL&amp;, const URL&amp;)
138 {
139     // FIXME: Implement for WebKit to use.
140 }
141 
142 void NetworkStorageSession::setCookie(const Cookie&amp;)
143 {
144     // FIXME: Implement for WebKit to use.
145 }
146 
147 void NetworkStorageSession::deleteCookie(const Cookie&amp;)
148 {
149     // FIXME: Implement for WebKit to use.
150 }
151 
152 void NetworkStorageSession::deleteCookie(const URL&amp;, const String&amp;) const
153 {
154     // FIXME: Implement for WebKit to use.
</pre>
</td>
</tr>
</table>
<center><a href="../create-http-header-name-table.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../playstation/MIMETypeRegistryPlayStation.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>