<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/css/makeprop.pl</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="html.css.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="parser/CSSParser.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/css/makeprop.pl</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  49     $input = &lt;JSON&gt;;
  50     close(JSON);
  51 }
  52 
  53 my $jsonDecoder = JSON::PP-&gt;new-&gt;utf8;
  54 my $jsonHashRef = $jsonDecoder-&gt;decode($input);
  55 my $propertiesHashRef = $jsonHashRef-&gt;{properties};
  56 my @allNames = keys(%$propertiesHashRef);
  57 die &quot;We&#39;ve reached more than 1024 CSS properties, please make sure to update CSSProperty/StylePropertyMetadata accordingly&quot; if @allNames &gt; 1024;
  58 
  59 my %defines = map { $_ =&gt; 1 } split(/ /, $defines);
  60 
  61 my @names;
  62 my @internalProprerties;
  63 my %runtimeFlags;
  64 my $numPredefinedProperties = 2;
  65 my %nameIsInherited;
  66 my %nameIsHighPriority;
  67 my %propertiesWithStyleBuilderOptions;
  68 my %styleBuilderOptions = (
<span class="line-modified">  69     &quot;animatable&quot; =&gt; 1, # Defined in Source/WebCore/css/StyleBuilderConverter.h</span>
  70     &quot;auto-functions&quot; =&gt; 1,
  71     &quot;conditional-converter&quot; =&gt; 1,
  72     &quot;converter&quot; =&gt; 1,
  73     &quot;custom&quot; =&gt; 1,
  74     &quot;fill-layer-property&quot; =&gt; 1,
  75     &quot;font-property&quot; =&gt; 1,
  76     &quot;getter&quot; =&gt; 1,
  77     &quot;initial&quot; =&gt; 1,
  78     &quot;longhands&quot; =&gt; 1,
  79     &quot;name-for-methods&quot; =&gt; 1,
  80     &quot;no-default-color&quot; =&gt; 1,
  81     &quot;svg&quot; =&gt; 1,
  82     &quot;skip-builder&quot; =&gt; 1,
  83     &quot;setter&quot; =&gt; 1,
  84     &quot;visited-link-color-support&quot; =&gt; 1,
  85 );
  86 my %nameToId;
  87 my %nameToAliases;
  88 
  89 for my $name (@allNames) {
</pre>
<hr />
<pre>
 463 my $first = $numPredefinedProperties;
 464 my $i = $numPredefinedProperties;
 465 my $maxLen = 0;
 466 my $lastHighPriorityPropertyName;
 467 foreach my $name (@names) {
 468   $lastHighPriorityPropertyName = $name if $nameIsHighPriority{$name}; # Assumes that @names is sorted by descending priorities.
 469   print HEADER &quot;    CSSProperty&quot; . $nameToId{$name} . &quot; = &quot; . $i . &quot;,\n&quot;;
 470   $i = $i + 1;
 471   if (length($name) &gt; $maxLen) {
 472     $maxLen = length($name);
 473   }
 474 }
 475 my $num = $i - $first;
 476 my $last = $i - 1;
 477 
 478 print HEADER &quot;};\n\n&quot;;
 479 print HEADER &quot;const int firstCSSProperty = $first;\n&quot;;
 480 print HEADER &quot;const int numCSSProperties = $num;\n&quot;;
 481 print HEADER &quot;const int lastCSSProperty = $last;\n&quot;;
 482 print HEADER &quot;const size_t maxCSSPropertyNameLength = $maxLen;\n&quot;;
<span class="line-modified"> 483 print HEADER &quot;const CSSPropertyID lastHighPriorityProperty = CSSProperty&quot; . $nameToId{$lastHighPriorityPropertyName} . &quot;;\n&quot;;</span>









































 484 
 485 print HEADER &lt;&lt; &quot;EOF&quot;;
 486 
 487 bool isInternalCSSProperty(const CSSPropertyID);
 488 bool isEnabledCSSProperty(const CSSPropertyID);
 489 const char* getPropertyName(CSSPropertyID);
 490 const WTF::AtomString&amp; getPropertyNameAtomString(CSSPropertyID id);
 491 WTF::String getPropertyNameString(CSSPropertyID id);
 492 WTF::String getJSPropertyName(CSSPropertyID);
 493 
 494 inline CSSPropertyID convertToCSSPropertyID(int value)
 495 {
 496     ASSERT((value &gt;= firstCSSProperty &amp;&amp; value &lt;= lastCSSProperty) || value == CSSPropertyInvalid || value == CSSPropertyCustom);
 497     return static_cast&lt;CSSPropertyID&gt;(value);
 498 }
 499 
 500 } // namespace WebCore
 501 
 502 namespace WTF {
 503 template&lt;&gt; struct DefaultHash&lt;WebCore::CSSPropertyID&gt; { typedef IntHash&lt;unsigned&gt; Hash; };
 504 template&lt;&gt; struct HashTraits&lt;WebCore::CSSPropertyID&gt; : GenericHashTraits&lt;WebCore::CSSPropertyID&gt; {
 505     static const bool emptyValueIsZero = true;
 506     static void constructDeletedValue(WebCore::CSSPropertyID&amp; slot) { slot = static_cast&lt;WebCore::CSSPropertyID&gt;(WebCore::lastCSSProperty + 1); }
 507     static bool isDeletedValue(WebCore::CSSPropertyID value) { return value == (WebCore::lastCSSProperty + 1); }
 508 };
 509 } // namespace WTF
 510 
 511 EOF
 512 
 513 close HEADER;
 514 
 515 #
<span class="line-modified"> 516 # StyleBuilder.cpp generator.</span>
 517 #
 518 
 519 sub getScopeForFunction {
 520   my $name = shift;
 521   my $builderFunction = shift;
 522 
<span class="line-modified"> 523   return $propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;}{$builderFunction} ? &quot;StyleBuilderCustom&quot; : &quot;StyleBuilderFunctions&quot;;</span>
 524 }
 525 
 526 sub getNameForMethods {
 527   my $name = shift;
 528 
 529   my $nameForMethods = $nameToId{$name};
 530   $nameForMethods =~ s/Webkit//g;
 531   if (exists($propertiesWithStyleBuilderOptions{$name}{&quot;name-for-methods&quot;})) {
 532     $nameForMethods = $propertiesWithStyleBuilderOptions{$name}{&quot;name-for-methods&quot;};
 533   }
 534   return $nameForMethods;
 535 }
 536 
 537 sub getAutoGetter {
 538   my $name = shift;
 539   my $renderStyle = shift;
 540 
<span class="line-modified"> 541   return $renderStyle . &quot;-&gt;hasAuto&quot; . getNameForMethods($name) . &quot;()&quot;;</span>
 542 }
 543 
 544 sub getAutoSetter {
 545   my $name = shift;
 546   my $renderStyle = shift;
 547 
<span class="line-modified"> 548   return $renderStyle . &quot;-&gt;setHasAuto&quot; . getNameForMethods($name) . &quot;()&quot;;</span>
 549 }
 550 
 551 sub getVisitedLinkSetter {
 552   my $name = shift;
 553   my $renderStyle = shift;
 554 
<span class="line-modified"> 555   return $renderStyle . &quot;-&gt;setVisitedLink&quot; . getNameForMethods($name);</span>
 556 }
 557 
 558 sub getClearFunction {
 559   my $name = shift;
 560 
 561   return &quot;clear&quot; . getNameForMethods($name);
 562 }
 563 
 564 sub getEnsureAnimationsOrTransitionsMethod {
 565   my $name = shift;
 566 
 567   return &quot;ensureAnimations&quot; if $name =~ /animation-/;
 568   return &quot;ensureTransitions&quot; if $name =~ /transition-/;
 569   die &quot;Unrecognized animation property name.&quot;;
 570 }
 571 
 572 sub getAnimationsOrTransitionsMethod {
 573   my $name = shift;
 574 
 575   return &quot;animations&quot; if $name =~ /animation-/;
</pre>
<hr />
<pre>
 641   }
 642   # FIXME: Convert option custom from a string to an array.
 643   if (!exists($propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;})) {
 644     $propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;} = &quot;&quot;;
 645   } elsif ($propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;} eq &quot;All&quot;) {
 646     $propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;} = &quot;Initial|Inherit|Value&quot;;
 647   }
 648   my %customValues = map { $_ =&gt; 1 } split(/\|/, $propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;});
 649   $propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;} = \%customValues;
 650 }
 651 
 652 use constant {
 653   NOT_FOR_VISITED_LINK =&gt; 0,
 654   FOR_VISITED_LINK =&gt; 1,
 655 };
 656 
 657 sub colorFromPrimitiveValue {
 658   my $primitiveValue = shift;
 659   my $forVisitedLink = @_ ? shift : NOT_FOR_VISITED_LINK;
 660 
<span class="line-modified"> 661   return &quot;styleResolver.colorFromPrimitiveValue(&quot; . $primitiveValue . &quot;, /* forVisitedLink */ &quot; . ($forVisitedLink ? &quot;true&quot; : &quot;false&quot;) . &quot;)&quot;;</span>
 662 }
 663 
 664 use constant {
 665   VALUE_IS_COLOR =&gt; 0,
 666   VALUE_IS_PRIMITIVE =&gt; 1,
 667 };
 668 
 669 sub generateColorValueSetter {
 670   my $name = shift;
 671   my $value = shift;
 672   my $indent = shift;
 673   my $valueIsPrimitive = @_ ? shift : VALUE_IS_COLOR;
 674 
<span class="line-modified"> 675   my $style = &quot;styleResolver.style()&quot;;</span>
<span class="line-modified"> 676   my $setterContent .= $indent . &quot;if (styleResolver.applyPropertyToRegularStyle())\n&quot;;</span>
<span class="line-modified"> 677   my $setValue = $style . &quot;-&gt;&quot; . $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};</span>
 678   my $color = $valueIsPrimitive ? colorFromPrimitiveValue($value) : $value;
 679   $setterContent .= $indent . &quot;    &quot; . $setValue . &quot;(&quot; . $color . &quot;);\n&quot;;
<span class="line-modified"> 680   $setterContent .= $indent . &quot;if (styleResolver.applyPropertyToVisitedLinkStyle())\n&quot;;</span>
 681   $color = $valueIsPrimitive ? colorFromPrimitiveValue($value, FOR_VISITED_LINK) : $value;
 682   $setterContent .= $indent . &quot;    &quot; . getVisitedLinkSetter($name, $style) . &quot;(&quot; . $color . &quot;);\n&quot;;
 683 
 684   return $setterContent;
 685 }
 686 
 687 sub handleCurrentColorValue {
 688   my $name = shift;
 689   my $primitiveValue = shift;
 690   my $indent = shift;
 691 
 692   my $code = $indent . &quot;if (&quot; . $primitiveValue . &quot;.valueID() == CSSValueCurrentcolor) {\n&quot;;
<span class="line-modified"> 693   $code .= $indent . &quot;    applyInherit&quot; . $nameToId{$name} . &quot;(styleResolver);\n&quot;;</span>
 694   $code .= $indent . &quot;    return;\n&quot;;
 695   $code .= $indent . &quot;}\n&quot;;
 696   return $code;
 697 }
 698 
 699 sub generateAnimationPropertyInitialValueSetter {
 700   my $name = shift;
 701   my $indent = shift;
 702 
 703   my $setterContent = &quot;&quot;;
<span class="line-modified"> 704   $setterContent .= $indent . &quot;AnimationList&amp; list = styleResolver.style()-&gt;&quot; . getEnsureAnimationsOrTransitionsMethod($name) . &quot;();\n&quot;;</span>
 705   $setterContent .= $indent . &quot;if (list.isEmpty())\n&quot;;
 706   $setterContent .= $indent . &quot;    list.append(Animation::create());\n&quot;;
 707   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 708   my $initial = $propertiesWithStyleBuilderOptions{$name}{&quot;initial&quot;};
 709   $setterContent .= $indent . &quot;list.animation(0).&quot; . $setter . &quot;(Animation::&quot; . $initial . &quot;());\n&quot;;
 710   if ($name eq &quot;-webkit-transition-property&quot;) {
 711     $setterContent .= $indent . &quot;list.animation(0).setAnimationMode(Animation::AnimateAll);\n&quot;;
 712   }
 713   $setterContent .= $indent . &quot;for (size_t i = 1; i &lt; list.size(); ++i)\n&quot;;
 714   $setterContent .= $indent . &quot;    list.animation(i).&quot; . getClearFunction($name) . &quot;();\n&quot;;
 715 
 716   return $setterContent;
 717 }
 718 
 719 sub generateAnimationPropertyInheritValueSetter {
 720   my $name = shift;
 721   my $indent = shift;
 722 
 723   my $setterContent = &quot;&quot;;
<span class="line-modified"> 724   $setterContent .= $indent . &quot;auto&amp; list = styleResolver.style()-&gt;&quot; . getEnsureAnimationsOrTransitionsMethod($name) . &quot;();\n&quot;;</span>
<span class="line-modified"> 725   $setterContent .= $indent . &quot;auto* parentList = styleResolver.parentStyle()-&gt;&quot; . getAnimationsOrTransitionsMethod($name) . &quot;();\n&quot;;</span>
 726   $setterContent .= $indent . &quot;size_t i = 0, parentSize = parentList ? parentList-&gt;size() : 0;\n&quot;;
 727   $setterContent .= $indent . &quot;for ( ; i &lt; parentSize &amp;&amp; parentList-&gt;animation(i).&quot; . getTestFunction($name) . &quot;(); ++i) {\n&quot;;
 728   $setterContent .= $indent . &quot;    if (list.size() &lt;= i)\n&quot;;
 729   $setterContent .= $indent . &quot;        list.append(Animation::create());\n&quot;;
 730   my $getter = $propertiesWithStyleBuilderOptions{$name}{&quot;getter&quot;};
 731   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 732   $setterContent .= $indent . &quot;    list.animation(i).&quot; . $setter . &quot;(parentList-&gt;animation(i).&quot; . $getter . &quot;());\n&quot;;
 733   $setterContent .= $indent . &quot;    list.animation(i).setAnimationMode(parentList-&gt;animation(i).animationMode());\n&quot;;
 734   $setterContent .= $indent . &quot;}\n&quot;;
 735   $setterContent .= &quot;\n&quot;;
 736   $setterContent .= $indent . &quot;// Reset any remaining animations to not have the property set.\n&quot;;
 737   $setterContent .= $indent . &quot;for ( ; i &lt; list.size(); ++i)\n&quot;;
 738   $setterContent .= $indent . &quot;    list.animation(i).&quot; . getClearFunction($name) . &quot;();\n&quot;;
 739 
 740   return $setterContent;
 741 }
 742 
 743 sub generateAnimationPropertyValueSetter {
 744   my $name = shift;
 745   my $indent = shift;
 746 
 747   my $setterContent = &quot;&quot;;
<span class="line-modified"> 748   $setterContent .= $indent . &quot;AnimationList&amp; list = styleResolver.style()-&gt;&quot; . getEnsureAnimationsOrTransitionsMethod($name) . &quot;();\n&quot;;</span>
 749   $setterContent .= $indent . &quot;size_t childIndex = 0;\n&quot;;
 750   $setterContent .= $indent . &quot;if (is&lt;CSSValueList&gt;(value)) {\n&quot;;
 751   $setterContent .= $indent . &quot;    /* Walk each value and put it into an animation, creating new animations as needed. */\n&quot;;
 752   $setterContent .= $indent . &quot;    for (auto&amp; currentValue : downcast&lt;CSSValueList&gt;(value)) {\n&quot;;
 753   $setterContent .= $indent . &quot;        if (childIndex &lt;= list.size())\n&quot;;
 754   $setterContent .= $indent . &quot;            list.append(Animation::create());\n&quot;;
<span class="line-modified"> 755   $setterContent .= $indent . &quot;        styleResolver.styleMap()-&gt;&quot; . getAnimationMapfunction($name) . &quot;(list.animation(childIndex), currentValue);\n&quot;;</span>
 756   $setterContent .= $indent . &quot;        ++childIndex;\n&quot;;
 757   $setterContent .= $indent . &quot;    }\n&quot;;
 758   $setterContent .= $indent . &quot;} else {\n&quot;;
 759   $setterContent .= $indent . &quot;    if (list.isEmpty())\n&quot;;
 760   $setterContent .= $indent . &quot;        list.append(Animation::create());\n&quot;;
<span class="line-modified"> 761   $setterContent .= $indent . &quot;    styleResolver.styleMap()-&gt;&quot; . getAnimationMapfunction($name) . &quot;(list.animation(childIndex), value);\n&quot;;</span>
 762   $setterContent .= $indent . &quot;    childIndex = 1;\n&quot;;
 763   $setterContent .= $indent . &quot;}\n&quot;;
 764   $setterContent .= $indent . &quot;for ( ; childIndex &lt; list.size(); ++childIndex) {\n&quot;;
 765   $setterContent .= $indent . &quot;    /* Reset all remaining animations to not have the property set. */\n&quot;;
 766   $setterContent .= $indent . &quot;    list.animation(childIndex).&quot; . getClearFunction($name) . &quot;();\n&quot;;
 767   $setterContent .= $indent . &quot;}\n&quot;;
 768 
 769   return $setterContent;
 770 }
 771 
 772 sub generateFillLayerPropertyInitialValueSetter {
 773   my $name = shift;
 774   my $indent = shift;
 775 
 776   my $getter = $propertiesWithStyleBuilderOptions{$name}{&quot;getter&quot;};
 777   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 778   my $clearFunction = getClearFunction($name);
 779   my $testFunction = getTestFunction($name);
 780   my $initial = &quot;FillLayer::&quot; . $propertiesWithStyleBuilderOptions{$name}{&quot;initial&quot;} . &quot;(&quot; . getFillLayerType($name) . &quot;)&quot;;
 781 
 782   my $setterContent = &quot;&quot;;
 783   $setterContent .= $indent . &quot;// Check for (single-layer) no-op before clearing anything.\n&quot;;
<span class="line-modified"> 784   $setterContent .= $indent . &quot;auto&amp; layers = styleResolver.style()-&gt;&quot; . getLayersFunction($name) . &quot;();\n&quot;;</span>
 785   $setterContent .= $indent . &quot;if (!layers.next() &amp;&amp; (!layers.&quot; . $testFunction . &quot;() || layers.&quot; . $getter . &quot;() == $initial))\n&quot;;
 786   $setterContent .= $indent . &quot;    return;\n&quot;;
 787   $setterContent .= &quot;\n&quot;;
<span class="line-modified"> 788   $setterContent .= $indent . &quot;auto* child = &amp;styleResolver.style()-&gt;&quot; . getLayersAccessorFunction($name) . &quot;();\n&quot;;</span>
 789   $setterContent .= $indent . &quot;child-&gt;&quot; . $setter . &quot;(&quot; . $initial . &quot;);\n&quot;;
 790   $setterContent .= $indent . &quot;for (child = child-&gt;next(); child; child = child-&gt;next())\n&quot;;
 791   $setterContent .= $indent . &quot;    child-&gt;&quot; . $clearFunction . &quot;();\n&quot;;
 792 
 793   return $setterContent;
 794 }
 795 
 796 sub generateFillLayerPropertyInheritValueSetter {
 797   my $name = shift;
 798   my $indent = shift;
 799 
 800   my $getter = $propertiesWithStyleBuilderOptions{$name}{&quot;getter&quot;};
 801   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 802   my $clearFunction = getClearFunction($name);
 803   my $testFunction = getTestFunction($name);
 804 
 805   my $setterContent = &quot;&quot;;
 806   $setterContent .= $indent . &quot;// Check for no-op before copying anything.\n&quot;;
<span class="line-modified"> 807   $setterContent .= $indent . &quot;if (styleResolver.parentStyle()-&gt;&quot; . getLayersFunction($name) .&quot;() == styleResolver.style()-&gt;&quot; . getLayersFunction($name) . &quot;())\n&quot;;</span>
 808   $setterContent .= $indent . &quot;    return;\n&quot;;
 809   $setterContent .= &quot;\n&quot;;
<span class="line-modified"> 810   $setterContent .= $indent . &quot;auto* child = &amp;styleResolver.style()-&gt;&quot; . getLayersAccessorFunction($name) . &quot;();\n&quot;;</span>
 811   $setterContent .= $indent . &quot;FillLayer* previousChild = nullptr;\n&quot;;
<span class="line-modified"> 812   $setterContent .= $indent . &quot;for (auto* parent = &amp;styleResolver.parentStyle()-&gt;&quot; . getLayersFunction($name) . &quot;(); parent &amp;&amp; parent-&gt;&quot; . $testFunction . &quot;(); parent = parent-&gt;next()) {\n&quot;;</span>
 813   $setterContent .= $indent . &quot;    if (!child) {\n&quot;;
 814   $setterContent .= $indent . &quot;        previousChild-&gt;setNext(makeUnique&lt;FillLayer&gt;(&quot; . getFillLayerType($name) . &quot;));\n&quot;;
 815   $setterContent .= $indent . &quot;        child = previousChild-&gt;next();\n&quot;;
 816   $setterContent .= $indent . &quot;    }\n&quot;;
 817   $setterContent .= $indent . &quot;    child-&gt;&quot; . $setter . &quot;(parent-&gt;&quot; . $getter . &quot;());\n&quot;;
 818   $setterContent .= $indent . &quot;    previousChild = child;\n&quot;;
 819   $setterContent .= $indent . &quot;    child = previousChild-&gt;next();\n&quot;;
 820   $setterContent .= $indent . &quot;}\n&quot;;
 821   $setterContent .= $indent . &quot;for (; child; child = child-&gt;next())\n&quot;;
 822   $setterContent .= $indent . &quot;    child-&gt;&quot; . $clearFunction . &quot;();\n&quot;;
 823 
 824   return $setterContent;
 825 }
 826 
 827 sub generateFillLayerPropertyValueSetter {
 828   my $name = shift;
 829   my $indent = shift;
 830 
 831   my $CSSPropertyId = &quot;CSSProperty&quot; . $nameToId{$name};
 832 
 833   my $setterContent = &quot;&quot;;
<span class="line-modified"> 834   $setterContent .= $indent . &quot;auto* child = &amp;styleResolver.style()-&gt;&quot; . getLayersAccessorFunction($name) . &quot;();\n&quot;;</span>
 835   $setterContent .= $indent . &quot;FillLayer* previousChild = nullptr;\n&quot;;
 836   $setterContent .= $indent . &quot;if (is&lt;CSSValueList&gt;(value) &amp;&amp; !is&lt;CSSImageSetValue&gt;(value)) {\n&quot;;
 837   $setterContent .= $indent . &quot;    // Walk each value and put it into a layer, creating new layers as needed.\n&quot;;
 838   $setterContent .= $indent . &quot;    for (auto&amp; item : downcast&lt;CSSValueList&gt;(value)) {\n&quot;;
 839   $setterContent .= $indent . &quot;        if (!child) {\n&quot;;
 840   $setterContent .= $indent . &quot;            previousChild-&gt;setNext(makeUnique&lt;FillLayer&gt;(&quot; . getFillLayerType($name) . &quot;));\n&quot;;
 841   $setterContent .= $indent . &quot;            child = previousChild-&gt;next();\n&quot;;
 842   $setterContent .= $indent . &quot;        }\n&quot;;
<span class="line-modified"> 843   $setterContent .= $indent . &quot;        styleResolver.styleMap()-&gt;&quot; . getFillLayerMapfunction($name) . &quot;(&quot; . $CSSPropertyId . &quot;, *child, item);\n&quot;;</span>
 844   $setterContent .= $indent . &quot;        previousChild = child;\n&quot;;
 845   $setterContent .= $indent . &quot;        child = child-&gt;next();\n&quot;;
 846   $setterContent .= $indent . &quot;    }\n&quot;;
 847   $setterContent .= $indent . &quot;} else {\n&quot;;
<span class="line-modified"> 848   $setterContent .= $indent . &quot;    styleResolver.styleMap()-&gt;&quot; . getFillLayerMapfunction($name) . &quot;(&quot; . $CSSPropertyId . &quot;, *child, value);\n&quot;;</span>
 849   $setterContent .= $indent . &quot;    child = child-&gt;next();\n&quot;;
 850   $setterContent .= $indent . &quot;}\n&quot;;
 851   $setterContent .= $indent . &quot;for (; child; child = child-&gt;next())\n&quot;;
 852   $setterContent .= $indent . &quot;    child-&gt;&quot; . getClearFunction($name) . &quot;();\n&quot;;
 853 
 854   return $setterContent;
 855 }
 856 
 857 sub generateSetValueStatement
 858 {
 859   my $name = shift;
 860   my $value = shift;
 861 
 862   my $isSVG = exists $propertiesWithStyleBuilderOptions{$name}{&quot;svg&quot;};
 863   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
<span class="line-modified"> 864   return &quot;styleResolver.style()-&gt;&quot; .  ($isSVG ? &quot;accessSVGStyle().&quot; : &quot;&quot;) . $setter . &quot;(&quot; . $value . &quot;)&quot;;</span>
 865 }
 866 
 867 sub generateInitialValueSetter {
 868   my $name = shift;
 869   my $indent = shift;
 870 
 871   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 872   my $initial = $propertiesWithStyleBuilderOptions{$name}{&quot;initial&quot;};
 873   my $isSVG = exists $propertiesWithStyleBuilderOptions{$name}{&quot;svg&quot;};
 874   my $setterContent = &quot;&quot;;
<span class="line-modified"> 875   $setterContent .= $indent . &quot;static void applyInitial&quot; . $nameToId{$name} . &quot;(StyleResolver&amp; styleResolver)\n&quot;;</span>
 876   $setterContent .= $indent . &quot;{\n&quot;;
<span class="line-modified"> 877   my $style = &quot;styleResolver.style()&quot;;</span>
 878   if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;auto-functions&quot;}) {
 879     $setterContent .= $indent . &quot;    &quot; . getAutoSetter($name, $style) . &quot;;\n&quot;;
 880   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;visited-link-color-support&quot;}) {
 881       my $initialColor = &quot;RenderStyle::&quot; . $initial . &quot;()&quot;;
 882       $setterContent .= generateColorValueSetter($name, $initialColor, $indent . &quot;    &quot;);
 883   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;animatable&quot;}) {
 884     $setterContent .= generateAnimationPropertyInitialValueSetter($name, $indent . &quot;    &quot;);
 885   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;font-property&quot;}) {
<span class="line-modified"> 886     $setterContent .= $indent . &quot;    auto fontDescription = styleResolver.fontDescription();\n&quot;;</span>
 887     $setterContent .= $indent . &quot;    fontDescription.&quot; . $setter . &quot;(FontCascadeDescription::&quot; . $initial . &quot;());\n&quot;;
<span class="line-modified"> 888     $setterContent .= $indent . &quot;    styleResolver.setFontDescription(WTFMove(fontDescription));\n&quot;;</span>
 889   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;fill-layer-property&quot;}) {
 890     $setterContent .= generateFillLayerPropertyInitialValueSetter($name, $indent . &quot;    &quot;);
 891   } else {
 892     my $initialValue = ($isSVG ? &quot;SVGRenderStyle&quot; : &quot;RenderStyle&quot;) . &quot;::&quot; . $initial . &quot;()&quot;;
 893     $setterContent .= $indent . &quot;    &quot; . generateSetValueStatement($name, $initialValue) . &quot;;\n&quot;;
 894   }
 895   $setterContent .= $indent . &quot;}\n&quot;;
 896 
 897   return $setterContent;
 898 }
 899 
 900 sub generateInheritValueSetter {
 901   my $name = shift;
 902   my $indent = shift;
 903 
 904   my $setterContent = &quot;&quot;;
<span class="line-modified"> 905   $setterContent .= $indent . &quot;static void applyInherit&quot; . $nameToId{$name} . &quot;(StyleResolver&amp; styleResolver)\n&quot;;</span>
 906   $setterContent .= $indent . &quot;{\n&quot;;
 907   my $isSVG = exists $propertiesWithStyleBuilderOptions{$name}{&quot;svg&quot;};
<span class="line-modified"> 908   my $parentStyle = &quot;styleResolver.parentStyle()&quot;;</span>
<span class="line-modified"> 909   my $style = &quot;styleResolver.style()&quot;;</span>
 910   my $getter = $propertiesWithStyleBuilderOptions{$name}{&quot;getter&quot;};
 911   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 912   my $didCallSetValue = 0;
 913   if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;auto-functions&quot;}) {
 914     $setterContent .= $indent . &quot;    if (&quot; . getAutoGetter($name, $parentStyle) . &quot;) {\n&quot;;
 915     $setterContent .= $indent . &quot;        &quot; . getAutoSetter($name, $style) . &quot;;\n&quot;;
 916     $setterContent .= $indent . &quot;        return;\n&quot;;
 917     $setterContent .= $indent . &quot;    }\n&quot;;
 918   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;visited-link-color-support&quot;}) {
<span class="line-modified"> 919     $setterContent .= $indent . &quot;    Color color = &quot; . $parentStyle . &quot;-&gt;&quot; . $getter . &quot;();\n&quot;;</span>
 920     if (!exists($propertiesWithStyleBuilderOptions{$name}{&quot;no-default-color&quot;})) {
 921       $setterContent .= $indent . &quot;    if (!color.isValid())\n&quot;;
<span class="line-modified"> 922       $setterContent .= $indent . &quot;        color = &quot; . $parentStyle . &quot;-&gt;color();\n&quot;;</span>
 923     }
 924     $setterContent .= generateColorValueSetter($name, &quot;color&quot;, $indent . &quot;    &quot;);
 925     $didCallSetValue = 1;
 926   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;animatable&quot;}) {
 927     $setterContent .= generateAnimationPropertyInheritValueSetter($name, $indent . &quot;    &quot;);
 928     $didCallSetValue = 1;
 929   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;font-property&quot;}) {
<span class="line-modified"> 930     $setterContent .= $indent . &quot;    auto fontDescription = styleResolver.fontDescription();\n&quot;;</span>
<span class="line-modified"> 931     $setterContent .= $indent . &quot;    fontDescription.&quot; . $setter . &quot;(styleResolver.parentFontDescription().&quot; . $getter . &quot;());\n&quot;;</span>
<span class="line-modified"> 932     $setterContent .= $indent . &quot;    styleResolver.setFontDescription(WTFMove(fontDescription));\n&quot;;</span>
 933     $didCallSetValue = 1;
 934   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;fill-layer-property&quot;}) {
 935     $setterContent .= generateFillLayerPropertyInheritValueSetter($name, $indent . &quot;    &quot;);
 936     $didCallSetValue = 1;
 937   }
 938   if (!$didCallSetValue) {
<span class="line-modified"> 939     my $inheritedValue = $parentStyle . &quot;-&gt;&quot; . ($isSVG ? &quot;svgStyle().&quot; : &quot;&quot;) .  $getter . &quot;()&quot;;</span>
 940     $setterContent .= $indent . &quot;    &quot; . generateSetValueStatement($name, &quot;forwardInheritedValue(&quot; . $inheritedValue . &quot;)&quot;) . &quot;;\n&quot;;
 941   }
 942   $setterContent .= $indent . &quot;}\n&quot;;
 943 
 944   return $setterContent;
 945 }
 946 
 947 sub generateValueSetter {
 948   my $name = shift;
 949   my $indent = shift;
 950 
 951   my $setterContent = &quot;&quot;;
<span class="line-modified"> 952   $setterContent .= $indent . &quot;static void applyValue&quot; . $nameToId{$name} . &quot;(StyleResolver&amp; styleResolver, CSSValue&amp; value)\n&quot;;</span>
 953   $setterContent .= $indent . &quot;{\n&quot;;
 954   my $convertedValue;
 955   if (exists($propertiesWithStyleBuilderOptions{$name}{&quot;converter&quot;})) {
<span class="line-modified"> 956     $convertedValue = &quot;StyleBuilderConverter::convert&quot; . $propertiesWithStyleBuilderOptions{$name}{&quot;converter&quot;} . &quot;(styleResolver, value)&quot;;</span>
 957   } elsif (exists($propertiesWithStyleBuilderOptions{$name}{&quot;conditional-converter&quot;})) {
<span class="line-modified"> 958     $setterContent .= $indent . &quot;    auto convertedValue = StyleBuilderConverter::convert&quot; . $propertiesWithStyleBuilderOptions{$name}{&quot;conditional-converter&quot;} . &quot;(styleResolver, value);\n&quot;;</span>
 959     $convertedValue = &quot;WTFMove(convertedValue.value())&quot;;
 960   } else {
 961     $convertedValue = &quot;downcast&lt;CSSPrimitiveValue&gt;(value)&quot;;
 962   }
 963 
 964   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
<span class="line-modified"> 965   my $style = &quot;styleResolver.style()&quot;;</span>
 966   my $didCallSetValue = 0;
 967   if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;auto-functions&quot;}) {
 968     $setterContent .= $indent . &quot;    if (downcast&lt;CSSPrimitiveValue&gt;(value).valueID() == CSSValueAuto) {\n&quot;;
 969     $setterContent .= $indent . &quot;        &quot;. getAutoSetter($name, $style) . &quot;;\n&quot;;
 970     $setterContent .= $indent . &quot;        return;\n&quot;;
 971     $setterContent .= $indent . &quot;    }\n&quot;;
 972   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;visited-link-color-support&quot;}) {
 973     $setterContent .= $indent . &quot;    auto&amp; primitiveValue = downcast&lt;CSSPrimitiveValue&gt;(value);\n&quot;;
 974     if ($name eq &quot;color&quot;) {
 975       # The &quot;color&quot; property supports &quot;currentColor&quot; value. We should add a parameter.
 976       $setterContent .= handleCurrentColorValue($name, &quot;primitiveValue&quot;, $indent . &quot;    &quot;);
 977     }
 978     $setterContent .= generateColorValueSetter($name, &quot;primitiveValue&quot;, $indent . &quot;    &quot;, VALUE_IS_PRIMITIVE);
 979     $didCallSetValue = 1;
 980   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;animatable&quot;}) {
 981     $setterContent .= generateAnimationPropertyValueSetter($name, $indent . &quot;    &quot;);
 982     $didCallSetValue = 1;
 983   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;font-property&quot;}) {
<span class="line-modified"> 984     $setterContent .= $indent . &quot;    auto fontDescription = styleResolver.fontDescription();\n&quot;;</span>
 985     $setterContent .= $indent . &quot;    fontDescription.&quot; . $setter . &quot;(&quot; . $convertedValue . &quot;);\n&quot;;
<span class="line-modified"> 986     $setterContent .= $indent . &quot;    styleResolver.setFontDescription(WTFMove(fontDescription));\n&quot;;</span>
 987     $didCallSetValue = 1;
 988   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;fill-layer-property&quot;}) {
 989     $setterContent .= generateFillLayerPropertyValueSetter($name, $indent . &quot;    &quot;);
 990     $didCallSetValue = 1;
 991   }
 992   if (!$didCallSetValue) {
 993     if (exists($propertiesWithStyleBuilderOptions{$name}{&quot;conditional-converter&quot;})) {
 994       $setterContent .= $indent . &quot;    if (convertedValue)\n&quot;;
 995       $setterContent .= &quot;    &quot;;
 996     }
 997     $setterContent .= $indent . &quot;    &quot; . generateSetValueStatement($name, $convertedValue) . &quot;;\n&quot;;
 998   }
 999   $setterContent .= $indent . &quot;}\n&quot;;
1000 
1001   return $setterContent;
1002 }
1003 
<span class="line-modified">1004 open STYLEBUILDER, &quot;&gt;StyleBuilder.cpp&quot; || die &quot;Could not open StyleBuilder.cpp for writing&quot;;</span>
1005 print STYLEBUILDER &lt;&lt; &quot;EOF&quot;;
1006 /* This file is automatically generated from $inputFile by makeprop, do not edit */
1007 
1008 #include &quot;config.h&quot;
<span class="line-modified">1009 #include &quot;StyleBuilder.h&quot;</span>
1010 
1011 #include &quot;CSSPrimitiveValueMappings.h&quot;
1012 #include &quot;CSSProperty.h&quot;
1013 #include &quot;RenderStyle.h&quot;

1014 #include &quot;StyleBuilderConverter.h&quot;
1015 #include &quot;StyleBuilderCustom.h&quot;
1016 #include &quot;StylePropertyShorthand.h&quot;
<span class="line-removed">1017 #include &quot;StyleResolver.h&quot;</span>
1018 
1019 namespace WebCore {

1020 
<span class="line-modified">1021 class StyleBuilderFunctions {</span>
1022 public:
1023 EOF
1024 
1025 foreach my $name (@names) {
1026   # Skip Shorthand properties and properties that do not use the StyleBuilder.
1027   next if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;longhands&quot;});
1028   next if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;skip-builder&quot;});
1029 
1030   my $indent = &quot;    &quot;;
1031   if (!$propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;}{&quot;Initial&quot;}) {
1032     print STYLEBUILDER generateInitialValueSetter($name, $indent);
1033   }
1034   if (!$propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;}{&quot;Inherit&quot;}) {
1035     print STYLEBUILDER generateInheritValueSetter($name, $indent);
1036   }
1037   if (!$propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;}{&quot;Value&quot;}) {
1038     print STYLEBUILDER generateValueSetter($name, $indent);
1039   }
1040 }
1041 
1042 print STYLEBUILDER &lt;&lt; &quot;EOF&quot;;
1043 };
1044 
<span class="line-modified">1045 void StyleBuilder::applyProperty(CSSPropertyID property, StyleResolver&amp; styleResolver, CSSValue&amp; value, bool isInitial, bool isInherit, const CSSRegisteredCustomProperty* registered)</span>
1046 {
1047     switch (property) {
1048     case CSSPropertyInvalid:
1049         break;
1050     case CSSPropertyCustom: {
1051         auto&amp; customProperty = downcast&lt;CSSCustomPropertyValue&gt;(value);
1052         if (isInitial)
<span class="line-modified">1053             StyleBuilderCustom::applyInitialCustomProperty(styleResolver, registered, customProperty.name());</span>
1054         else if (isInherit)
<span class="line-modified">1055             StyleBuilderCustom::applyInheritCustomProperty(styleResolver, registered, customProperty.name());</span>
1056         else
<span class="line-modified">1057             StyleBuilderCustom::applyValueCustomProperty(styleResolver, registered, customProperty);</span>
1058         break;
1059     }
1060 EOF
1061 
1062 foreach my $name (@names) {
1063   print STYLEBUILDER &quot;    case CSSProperty&quot; . $nameToId{$name} . &quot;:\n&quot;;
1064   if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;longhands&quot;}) {
1065     print STYLEBUILDER &quot;        ASSERT(isShorthandCSSProperty(property));\n&quot;;
1066     print STYLEBUILDER &quot;        ASSERT_NOT_REACHED();\n&quot;;
1067   } elsif (!exists $propertiesWithStyleBuilderOptions{$name}{&quot;skip-builder&quot;}) {
1068     print STYLEBUILDER &quot;        if (isInitial)\n&quot;;
<span class="line-modified">1069     print STYLEBUILDER &quot;            &quot; . getScopeForFunction($name, &quot;Initial&quot;) . &quot;::applyInitial&quot; . $nameToId{$name} . &quot;(styleResolver);\n&quot;;</span>
1070     print STYLEBUILDER &quot;        else if (isInherit)\n&quot;;
<span class="line-modified">1071     print STYLEBUILDER &quot;            &quot; . getScopeForFunction($name, &quot;Inherit&quot;) . &quot;::applyInherit&quot; . $nameToId{$name} . &quot;(styleResolver);\n&quot;;</span>
1072     print STYLEBUILDER &quot;        else\n&quot;;
<span class="line-modified">1073     print STYLEBUILDER &quot;            &quot; . getScopeForFunction($name, &quot;Value&quot;) . &quot;::applyValue&quot; . $nameToId{$name} . &quot;(styleResolver, value);\n&quot;;</span>
1074   }
1075   print STYLEBUILDER &quot;        break;\n&quot;;
1076 }
1077 
1078 print STYLEBUILDER &lt;&lt; &quot;EOF&quot;;
1079     };
1080 }
1081 

1082 } // namespace WebCore
1083 EOF
1084 
1085 close STYLEBUILDER;
1086 
1087 # Generate StylePropertyShorthandsFunctions.
1088 open SHORTHANDS_H, &quot;&gt;&quot;, &quot;StylePropertyShorthandFunctions.h&quot; or die &quot;Could not open StylePropertyShorthandFunctions.h for writing\n&quot;;
1089 print SHORTHANDS_H &lt;&lt; &quot;EOF&quot;;
1090 // This file is automatically generated from $inputFile by the makeprop.pl script. Do not edit it.
1091 
1092 #pragma once
1093 
1094 namespace WebCore {
1095 
1096 class StylePropertyShorthand;
1097 
1098 EOF
1099 
1100 foreach my $name (@names) {
1101   # Skip non-Shorthand properties.
</pre>
</td>
<td>
<hr />
<pre>
  49     $input = &lt;JSON&gt;;
  50     close(JSON);
  51 }
  52 
  53 my $jsonDecoder = JSON::PP-&gt;new-&gt;utf8;
  54 my $jsonHashRef = $jsonDecoder-&gt;decode($input);
  55 my $propertiesHashRef = $jsonHashRef-&gt;{properties};
  56 my @allNames = keys(%$propertiesHashRef);
  57 die &quot;We&#39;ve reached more than 1024 CSS properties, please make sure to update CSSProperty/StylePropertyMetadata accordingly&quot; if @allNames &gt; 1024;
  58 
  59 my %defines = map { $_ =&gt; 1 } split(/ /, $defines);
  60 
  61 my @names;
  62 my @internalProprerties;
  63 my %runtimeFlags;
  64 my $numPredefinedProperties = 2;
  65 my %nameIsInherited;
  66 my %nameIsHighPriority;
  67 my %propertiesWithStyleBuilderOptions;
  68 my %styleBuilderOptions = (
<span class="line-modified">  69     &quot;animatable&quot; =&gt; 1, # Defined in Source/WebCore/style/StyleBuilderConverter.h</span>
  70     &quot;auto-functions&quot; =&gt; 1,
  71     &quot;conditional-converter&quot; =&gt; 1,
  72     &quot;converter&quot; =&gt; 1,
  73     &quot;custom&quot; =&gt; 1,
  74     &quot;fill-layer-property&quot; =&gt; 1,
  75     &quot;font-property&quot; =&gt; 1,
  76     &quot;getter&quot; =&gt; 1,
  77     &quot;initial&quot; =&gt; 1,
  78     &quot;longhands&quot; =&gt; 1,
  79     &quot;name-for-methods&quot; =&gt; 1,
  80     &quot;no-default-color&quot; =&gt; 1,
  81     &quot;svg&quot; =&gt; 1,
  82     &quot;skip-builder&quot; =&gt; 1,
  83     &quot;setter&quot; =&gt; 1,
  84     &quot;visited-link-color-support&quot; =&gt; 1,
  85 );
  86 my %nameToId;
  87 my %nameToAliases;
  88 
  89 for my $name (@allNames) {
</pre>
<hr />
<pre>
 463 my $first = $numPredefinedProperties;
 464 my $i = $numPredefinedProperties;
 465 my $maxLen = 0;
 466 my $lastHighPriorityPropertyName;
 467 foreach my $name (@names) {
 468   $lastHighPriorityPropertyName = $name if $nameIsHighPriority{$name}; # Assumes that @names is sorted by descending priorities.
 469   print HEADER &quot;    CSSProperty&quot; . $nameToId{$name} . &quot; = &quot; . $i . &quot;,\n&quot;;
 470   $i = $i + 1;
 471   if (length($name) &gt; $maxLen) {
 472     $maxLen = length($name);
 473   }
 474 }
 475 my $num = $i - $first;
 476 my $last = $i - 1;
 477 
 478 print HEADER &quot;};\n\n&quot;;
 479 print HEADER &quot;const int firstCSSProperty = $first;\n&quot;;
 480 print HEADER &quot;const int numCSSProperties = $num;\n&quot;;
 481 print HEADER &quot;const int lastCSSProperty = $last;\n&quot;;
 482 print HEADER &quot;const size_t maxCSSPropertyNameLength = $maxLen;\n&quot;;
<span class="line-modified"> 483 print HEADER &quot;const CSSPropertyID lastHighPriorityProperty = CSSProperty&quot; . $nameToId{$lastHighPriorityPropertyName} . &quot;;\n\n&quot;;</span>
<span class="line-added"> 484 </span>
<span class="line-added"> 485 print HEADER &quot;static const CSSPropertyID computedPropertyIDs[] = {\n&quot;;</span>
<span class="line-added"> 486 my $numComputedPropertyIDs = 0;</span>
<span class="line-added"> 487 sub sortWithPrefixedPropertiesLast</span>
<span class="line-added"> 488 {</span>
<span class="line-added"> 489     my $aStartsWithPrefix = substr($a, 0, 1) eq &quot;-&quot;;</span>
<span class="line-added"> 490     my $bStartsWithPrefix = substr($b, 0, 1) eq &quot;-&quot;;</span>
<span class="line-added"> 491     if ($aStartsWithPrefix &amp;&amp; !$bStartsWithPrefix) {</span>
<span class="line-added"> 492         return 1;</span>
<span class="line-added"> 493     }</span>
<span class="line-added"> 494     if (!$aStartsWithPrefix &amp;&amp; $bStartsWithPrefix) {</span>
<span class="line-added"> 495         return -1;</span>
<span class="line-added"> 496     }</span>
<span class="line-added"> 497     return $a cmp $b;</span>
<span class="line-added"> 498 }</span>
<span class="line-added"> 499 foreach my $name (sort sortWithPrefixedPropertiesLast @names) {</span>
<span class="line-added"> 500   next if (exists($propertiesWithStyleBuilderOptions{$name}{&quot;skip-builder&quot;}));</span>
<span class="line-added"> 501   next if (grep { $_ eq $name } @internalProprerties);</span>
<span class="line-added"> 502 </span>
<span class="line-added"> 503   # Skip properties if they have a non-internal longhand property.</span>
<span class="line-added"> 504   if (exists($propertiesWithStyleBuilderOptions{$name}{&quot;longhands&quot;})) {</span>
<span class="line-added"> 505     my @longhands = @{$propertiesWithStyleBuilderOptions{$name}{&quot;longhands&quot;}};</span>
<span class="line-added"> 506     if (scalar @longhands != 1) {</span>
<span class="line-added"> 507       my $hasNonInternalLonghand = 0;</span>
<span class="line-added"> 508       foreach my $longhand (@longhands) {</span>
<span class="line-added"> 509         if (!exists($propertiesWithStyleBuilderOptions{$longhand}{&quot;skip-builder&quot;}) &amp;&amp; !grep { $_ eq $longhand } @internalProprerties) {</span>
<span class="line-added"> 510           $hasNonInternalLonghand = 1;</span>
<span class="line-added"> 511           last;</span>
<span class="line-added"> 512         }</span>
<span class="line-added"> 513       }</span>
<span class="line-added"> 514       if ($hasNonInternalLonghand) {</span>
<span class="line-added"> 515         next;</span>
<span class="line-added"> 516       }</span>
<span class="line-added"> 517     }</span>
<span class="line-added"> 518   }</span>
<span class="line-added"> 519 </span>
<span class="line-added"> 520   print HEADER &quot;    CSSProperty&quot; . $nameToId{$name} . &quot;,\n&quot;;</span>
<span class="line-added"> 521   $numComputedPropertyIDs += 1;</span>
<span class="line-added"> 522 }</span>
<span class="line-added"> 523 print HEADER &quot;};\n&quot;;</span>
<span class="line-added"> 524 print HEADER &quot;const size_t numComputedPropertyIDs = $numComputedPropertyIDs;\n&quot;;</span>
 525 
 526 print HEADER &lt;&lt; &quot;EOF&quot;;
 527 
 528 bool isInternalCSSProperty(const CSSPropertyID);
 529 bool isEnabledCSSProperty(const CSSPropertyID);
 530 const char* getPropertyName(CSSPropertyID);
 531 const WTF::AtomString&amp; getPropertyNameAtomString(CSSPropertyID id);
 532 WTF::String getPropertyNameString(CSSPropertyID id);
 533 WTF::String getJSPropertyName(CSSPropertyID);
 534 
 535 inline CSSPropertyID convertToCSSPropertyID(int value)
 536 {
 537     ASSERT((value &gt;= firstCSSProperty &amp;&amp; value &lt;= lastCSSProperty) || value == CSSPropertyInvalid || value == CSSPropertyCustom);
 538     return static_cast&lt;CSSPropertyID&gt;(value);
 539 }
 540 
 541 } // namespace WebCore
 542 
 543 namespace WTF {
 544 template&lt;&gt; struct DefaultHash&lt;WebCore::CSSPropertyID&gt; { typedef IntHash&lt;unsigned&gt; Hash; };
 545 template&lt;&gt; struct HashTraits&lt;WebCore::CSSPropertyID&gt; : GenericHashTraits&lt;WebCore::CSSPropertyID&gt; {
 546     static const bool emptyValueIsZero = true;
 547     static void constructDeletedValue(WebCore::CSSPropertyID&amp; slot) { slot = static_cast&lt;WebCore::CSSPropertyID&gt;(WebCore::lastCSSProperty + 1); }
 548     static bool isDeletedValue(WebCore::CSSPropertyID value) { return value == (WebCore::lastCSSProperty + 1); }
 549 };
 550 } // namespace WTF
 551 
 552 EOF
 553 
 554 close HEADER;
 555 
 556 #
<span class="line-modified"> 557 # StyleBuilderGenerated.cpp generator.</span>
 558 #
 559 
 560 sub getScopeForFunction {
 561   my $name = shift;
 562   my $builderFunction = shift;
 563 
<span class="line-modified"> 564   return $propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;}{$builderFunction} ? &quot;BuilderCustom&quot; : &quot;BuilderFunctions&quot;;</span>
 565 }
 566 
 567 sub getNameForMethods {
 568   my $name = shift;
 569 
 570   my $nameForMethods = $nameToId{$name};
 571   $nameForMethods =~ s/Webkit//g;
 572   if (exists($propertiesWithStyleBuilderOptions{$name}{&quot;name-for-methods&quot;})) {
 573     $nameForMethods = $propertiesWithStyleBuilderOptions{$name}{&quot;name-for-methods&quot;};
 574   }
 575   return $nameForMethods;
 576 }
 577 
 578 sub getAutoGetter {
 579   my $name = shift;
 580   my $renderStyle = shift;
 581 
<span class="line-modified"> 582   return $renderStyle . &quot;.hasAuto&quot; . getNameForMethods($name) . &quot;()&quot;;</span>
 583 }
 584 
 585 sub getAutoSetter {
 586   my $name = shift;
 587   my $renderStyle = shift;
 588 
<span class="line-modified"> 589   return $renderStyle . &quot;.setHasAuto&quot; . getNameForMethods($name) . &quot;()&quot;;</span>
 590 }
 591 
 592 sub getVisitedLinkSetter {
 593   my $name = shift;
 594   my $renderStyle = shift;
 595 
<span class="line-modified"> 596   return $renderStyle . &quot;.setVisitedLink&quot; . getNameForMethods($name);</span>
 597 }
 598 
 599 sub getClearFunction {
 600   my $name = shift;
 601 
 602   return &quot;clear&quot; . getNameForMethods($name);
 603 }
 604 
 605 sub getEnsureAnimationsOrTransitionsMethod {
 606   my $name = shift;
 607 
 608   return &quot;ensureAnimations&quot; if $name =~ /animation-/;
 609   return &quot;ensureTransitions&quot; if $name =~ /transition-/;
 610   die &quot;Unrecognized animation property name.&quot;;
 611 }
 612 
 613 sub getAnimationsOrTransitionsMethod {
 614   my $name = shift;
 615 
 616   return &quot;animations&quot; if $name =~ /animation-/;
</pre>
<hr />
<pre>
 682   }
 683   # FIXME: Convert option custom from a string to an array.
 684   if (!exists($propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;})) {
 685     $propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;} = &quot;&quot;;
 686   } elsif ($propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;} eq &quot;All&quot;) {
 687     $propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;} = &quot;Initial|Inherit|Value&quot;;
 688   }
 689   my %customValues = map { $_ =&gt; 1 } split(/\|/, $propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;});
 690   $propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;} = \%customValues;
 691 }
 692 
 693 use constant {
 694   NOT_FOR_VISITED_LINK =&gt; 0,
 695   FOR_VISITED_LINK =&gt; 1,
 696 };
 697 
 698 sub colorFromPrimitiveValue {
 699   my $primitiveValue = shift;
 700   my $forVisitedLink = @_ ? shift : NOT_FOR_VISITED_LINK;
 701 
<span class="line-modified"> 702   return &quot;builderState.colorFromPrimitiveValue(&quot; . $primitiveValue . &quot;, /* forVisitedLink */ &quot; . ($forVisitedLink ? &quot;true&quot; : &quot;false&quot;) . &quot;)&quot;;</span>
 703 }
 704 
 705 use constant {
 706   VALUE_IS_COLOR =&gt; 0,
 707   VALUE_IS_PRIMITIVE =&gt; 1,
 708 };
 709 
 710 sub generateColorValueSetter {
 711   my $name = shift;
 712   my $value = shift;
 713   my $indent = shift;
 714   my $valueIsPrimitive = @_ ? shift : VALUE_IS_COLOR;
 715 
<span class="line-modified"> 716   my $style = &quot;builderState.style()&quot;;</span>
<span class="line-modified"> 717   my $setterContent .= $indent . &quot;if (builderState.applyPropertyToRegularStyle())\n&quot;;</span>
<span class="line-modified"> 718   my $setValue = $style . &quot;.&quot; . $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};</span>
 719   my $color = $valueIsPrimitive ? colorFromPrimitiveValue($value) : $value;
 720   $setterContent .= $indent . &quot;    &quot; . $setValue . &quot;(&quot; . $color . &quot;);\n&quot;;
<span class="line-modified"> 721   $setterContent .= $indent . &quot;if (builderState.applyPropertyToVisitedLinkStyle())\n&quot;;</span>
 722   $color = $valueIsPrimitive ? colorFromPrimitiveValue($value, FOR_VISITED_LINK) : $value;
 723   $setterContent .= $indent . &quot;    &quot; . getVisitedLinkSetter($name, $style) . &quot;(&quot; . $color . &quot;);\n&quot;;
 724 
 725   return $setterContent;
 726 }
 727 
 728 sub handleCurrentColorValue {
 729   my $name = shift;
 730   my $primitiveValue = shift;
 731   my $indent = shift;
 732 
 733   my $code = $indent . &quot;if (&quot; . $primitiveValue . &quot;.valueID() == CSSValueCurrentcolor) {\n&quot;;
<span class="line-modified"> 734   $code .= $indent . &quot;    applyInherit&quot; . $nameToId{$name} . &quot;(builderState);\n&quot;;</span>
 735   $code .= $indent . &quot;    return;\n&quot;;
 736   $code .= $indent . &quot;}\n&quot;;
 737   return $code;
 738 }
 739 
 740 sub generateAnimationPropertyInitialValueSetter {
 741   my $name = shift;
 742   my $indent = shift;
 743 
 744   my $setterContent = &quot;&quot;;
<span class="line-modified"> 745   $setterContent .= $indent . &quot;AnimationList&amp; list = builderState.style().&quot; . getEnsureAnimationsOrTransitionsMethod($name) . &quot;();\n&quot;;</span>
 746   $setterContent .= $indent . &quot;if (list.isEmpty())\n&quot;;
 747   $setterContent .= $indent . &quot;    list.append(Animation::create());\n&quot;;
 748   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 749   my $initial = $propertiesWithStyleBuilderOptions{$name}{&quot;initial&quot;};
 750   $setterContent .= $indent . &quot;list.animation(0).&quot; . $setter . &quot;(Animation::&quot; . $initial . &quot;());\n&quot;;
 751   if ($name eq &quot;-webkit-transition-property&quot;) {
 752     $setterContent .= $indent . &quot;list.animation(0).setAnimationMode(Animation::AnimateAll);\n&quot;;
 753   }
 754   $setterContent .= $indent . &quot;for (size_t i = 1; i &lt; list.size(); ++i)\n&quot;;
 755   $setterContent .= $indent . &quot;    list.animation(i).&quot; . getClearFunction($name) . &quot;();\n&quot;;
 756 
 757   return $setterContent;
 758 }
 759 
 760 sub generateAnimationPropertyInheritValueSetter {
 761   my $name = shift;
 762   my $indent = shift;
 763 
 764   my $setterContent = &quot;&quot;;
<span class="line-modified"> 765   $setterContent .= $indent . &quot;auto&amp; list = builderState.style().&quot; . getEnsureAnimationsOrTransitionsMethod($name) . &quot;();\n&quot;;</span>
<span class="line-modified"> 766   $setterContent .= $indent . &quot;auto* parentList = builderState.parentStyle().&quot; . getAnimationsOrTransitionsMethod($name) . &quot;();\n&quot;;</span>
 767   $setterContent .= $indent . &quot;size_t i = 0, parentSize = parentList ? parentList-&gt;size() : 0;\n&quot;;
 768   $setterContent .= $indent . &quot;for ( ; i &lt; parentSize &amp;&amp; parentList-&gt;animation(i).&quot; . getTestFunction($name) . &quot;(); ++i) {\n&quot;;
 769   $setterContent .= $indent . &quot;    if (list.size() &lt;= i)\n&quot;;
 770   $setterContent .= $indent . &quot;        list.append(Animation::create());\n&quot;;
 771   my $getter = $propertiesWithStyleBuilderOptions{$name}{&quot;getter&quot;};
 772   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 773   $setterContent .= $indent . &quot;    list.animation(i).&quot; . $setter . &quot;(parentList-&gt;animation(i).&quot; . $getter . &quot;());\n&quot;;
 774   $setterContent .= $indent . &quot;    list.animation(i).setAnimationMode(parentList-&gt;animation(i).animationMode());\n&quot;;
 775   $setterContent .= $indent . &quot;}\n&quot;;
 776   $setterContent .= &quot;\n&quot;;
 777   $setterContent .= $indent . &quot;// Reset any remaining animations to not have the property set.\n&quot;;
 778   $setterContent .= $indent . &quot;for ( ; i &lt; list.size(); ++i)\n&quot;;
 779   $setterContent .= $indent . &quot;    list.animation(i).&quot; . getClearFunction($name) . &quot;();\n&quot;;
 780 
 781   return $setterContent;
 782 }
 783 
 784 sub generateAnimationPropertyValueSetter {
 785   my $name = shift;
 786   my $indent = shift;
 787 
 788   my $setterContent = &quot;&quot;;
<span class="line-modified"> 789   $setterContent .= $indent . &quot;AnimationList&amp; list = builderState.style().&quot; . getEnsureAnimationsOrTransitionsMethod($name) . &quot;();\n&quot;;</span>
 790   $setterContent .= $indent . &quot;size_t childIndex = 0;\n&quot;;
 791   $setterContent .= $indent . &quot;if (is&lt;CSSValueList&gt;(value)) {\n&quot;;
 792   $setterContent .= $indent . &quot;    /* Walk each value and put it into an animation, creating new animations as needed. */\n&quot;;
 793   $setterContent .= $indent . &quot;    for (auto&amp; currentValue : downcast&lt;CSSValueList&gt;(value)) {\n&quot;;
 794   $setterContent .= $indent . &quot;        if (childIndex &lt;= list.size())\n&quot;;
 795   $setterContent .= $indent . &quot;            list.append(Animation::create());\n&quot;;
<span class="line-modified"> 796   $setterContent .= $indent . &quot;        builderState.styleMap().&quot; . getAnimationMapfunction($name) . &quot;(list.animation(childIndex), currentValue);\n&quot;;</span>
 797   $setterContent .= $indent . &quot;        ++childIndex;\n&quot;;
 798   $setterContent .= $indent . &quot;    }\n&quot;;
 799   $setterContent .= $indent . &quot;} else {\n&quot;;
 800   $setterContent .= $indent . &quot;    if (list.isEmpty())\n&quot;;
 801   $setterContent .= $indent . &quot;        list.append(Animation::create());\n&quot;;
<span class="line-modified"> 802   $setterContent .= $indent . &quot;    builderState.styleMap().&quot; . getAnimationMapfunction($name) . &quot;(list.animation(childIndex), value);\n&quot;;</span>
 803   $setterContent .= $indent . &quot;    childIndex = 1;\n&quot;;
 804   $setterContent .= $indent . &quot;}\n&quot;;
 805   $setterContent .= $indent . &quot;for ( ; childIndex &lt; list.size(); ++childIndex) {\n&quot;;
 806   $setterContent .= $indent . &quot;    /* Reset all remaining animations to not have the property set. */\n&quot;;
 807   $setterContent .= $indent . &quot;    list.animation(childIndex).&quot; . getClearFunction($name) . &quot;();\n&quot;;
 808   $setterContent .= $indent . &quot;}\n&quot;;
 809 
 810   return $setterContent;
 811 }
 812 
 813 sub generateFillLayerPropertyInitialValueSetter {
 814   my $name = shift;
 815   my $indent = shift;
 816 
 817   my $getter = $propertiesWithStyleBuilderOptions{$name}{&quot;getter&quot;};
 818   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 819   my $clearFunction = getClearFunction($name);
 820   my $testFunction = getTestFunction($name);
 821   my $initial = &quot;FillLayer::&quot; . $propertiesWithStyleBuilderOptions{$name}{&quot;initial&quot;} . &quot;(&quot; . getFillLayerType($name) . &quot;)&quot;;
 822 
 823   my $setterContent = &quot;&quot;;
 824   $setterContent .= $indent . &quot;// Check for (single-layer) no-op before clearing anything.\n&quot;;
<span class="line-modified"> 825   $setterContent .= $indent . &quot;auto&amp; layers = builderState.style().&quot; . getLayersFunction($name) . &quot;();\n&quot;;</span>
 826   $setterContent .= $indent . &quot;if (!layers.next() &amp;&amp; (!layers.&quot; . $testFunction . &quot;() || layers.&quot; . $getter . &quot;() == $initial))\n&quot;;
 827   $setterContent .= $indent . &quot;    return;\n&quot;;
 828   $setterContent .= &quot;\n&quot;;
<span class="line-modified"> 829   $setterContent .= $indent . &quot;auto* child = &amp;builderState.style().&quot; . getLayersAccessorFunction($name) . &quot;();\n&quot;;</span>
 830   $setterContent .= $indent . &quot;child-&gt;&quot; . $setter . &quot;(&quot; . $initial . &quot;);\n&quot;;
 831   $setterContent .= $indent . &quot;for (child = child-&gt;next(); child; child = child-&gt;next())\n&quot;;
 832   $setterContent .= $indent . &quot;    child-&gt;&quot; . $clearFunction . &quot;();\n&quot;;
 833 
 834   return $setterContent;
 835 }
 836 
 837 sub generateFillLayerPropertyInheritValueSetter {
 838   my $name = shift;
 839   my $indent = shift;
 840 
 841   my $getter = $propertiesWithStyleBuilderOptions{$name}{&quot;getter&quot;};
 842   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 843   my $clearFunction = getClearFunction($name);
 844   my $testFunction = getTestFunction($name);
 845 
 846   my $setterContent = &quot;&quot;;
 847   $setterContent .= $indent . &quot;// Check for no-op before copying anything.\n&quot;;
<span class="line-modified"> 848   $setterContent .= $indent . &quot;if (builderState.parentStyle().&quot; . getLayersFunction($name) .&quot;() == builderState.style().&quot; . getLayersFunction($name) . &quot;())\n&quot;;</span>
 849   $setterContent .= $indent . &quot;    return;\n&quot;;
 850   $setterContent .= &quot;\n&quot;;
<span class="line-modified"> 851   $setterContent .= $indent . &quot;auto* child = &amp;builderState.style().&quot; . getLayersAccessorFunction($name) . &quot;();\n&quot;;</span>
 852   $setterContent .= $indent . &quot;FillLayer* previousChild = nullptr;\n&quot;;
<span class="line-modified"> 853   $setterContent .= $indent . &quot;for (auto* parent = &amp;builderState.parentStyle().&quot; . getLayersFunction($name) . &quot;(); parent &amp;&amp; parent-&gt;&quot; . $testFunction . &quot;(); parent = parent-&gt;next()) {\n&quot;;</span>
 854   $setterContent .= $indent . &quot;    if (!child) {\n&quot;;
 855   $setterContent .= $indent . &quot;        previousChild-&gt;setNext(makeUnique&lt;FillLayer&gt;(&quot; . getFillLayerType($name) . &quot;));\n&quot;;
 856   $setterContent .= $indent . &quot;        child = previousChild-&gt;next();\n&quot;;
 857   $setterContent .= $indent . &quot;    }\n&quot;;
 858   $setterContent .= $indent . &quot;    child-&gt;&quot; . $setter . &quot;(parent-&gt;&quot; . $getter . &quot;());\n&quot;;
 859   $setterContent .= $indent . &quot;    previousChild = child;\n&quot;;
 860   $setterContent .= $indent . &quot;    child = previousChild-&gt;next();\n&quot;;
 861   $setterContent .= $indent . &quot;}\n&quot;;
 862   $setterContent .= $indent . &quot;for (; child; child = child-&gt;next())\n&quot;;
 863   $setterContent .= $indent . &quot;    child-&gt;&quot; . $clearFunction . &quot;();\n&quot;;
 864 
 865   return $setterContent;
 866 }
 867 
 868 sub generateFillLayerPropertyValueSetter {
 869   my $name = shift;
 870   my $indent = shift;
 871 
 872   my $CSSPropertyId = &quot;CSSProperty&quot; . $nameToId{$name};
 873 
 874   my $setterContent = &quot;&quot;;
<span class="line-modified"> 875   $setterContent .= $indent . &quot;auto* child = &amp;builderState.style().&quot; . getLayersAccessorFunction($name) . &quot;();\n&quot;;</span>
 876   $setterContent .= $indent . &quot;FillLayer* previousChild = nullptr;\n&quot;;
 877   $setterContent .= $indent . &quot;if (is&lt;CSSValueList&gt;(value) &amp;&amp; !is&lt;CSSImageSetValue&gt;(value)) {\n&quot;;
 878   $setterContent .= $indent . &quot;    // Walk each value and put it into a layer, creating new layers as needed.\n&quot;;
 879   $setterContent .= $indent . &quot;    for (auto&amp; item : downcast&lt;CSSValueList&gt;(value)) {\n&quot;;
 880   $setterContent .= $indent . &quot;        if (!child) {\n&quot;;
 881   $setterContent .= $indent . &quot;            previousChild-&gt;setNext(makeUnique&lt;FillLayer&gt;(&quot; . getFillLayerType($name) . &quot;));\n&quot;;
 882   $setterContent .= $indent . &quot;            child = previousChild-&gt;next();\n&quot;;
 883   $setterContent .= $indent . &quot;        }\n&quot;;
<span class="line-modified"> 884   $setterContent .= $indent . &quot;        builderState.styleMap().&quot; . getFillLayerMapfunction($name) . &quot;(&quot; . $CSSPropertyId . &quot;, *child, item);\n&quot;;</span>
 885   $setterContent .= $indent . &quot;        previousChild = child;\n&quot;;
 886   $setterContent .= $indent . &quot;        child = child-&gt;next();\n&quot;;
 887   $setterContent .= $indent . &quot;    }\n&quot;;
 888   $setterContent .= $indent . &quot;} else {\n&quot;;
<span class="line-modified"> 889   $setterContent .= $indent . &quot;    builderState.styleMap().&quot; . getFillLayerMapfunction($name) . &quot;(&quot; . $CSSPropertyId . &quot;, *child, value);\n&quot;;</span>
 890   $setterContent .= $indent . &quot;    child = child-&gt;next();\n&quot;;
 891   $setterContent .= $indent . &quot;}\n&quot;;
 892   $setterContent .= $indent . &quot;for (; child; child = child-&gt;next())\n&quot;;
 893   $setterContent .= $indent . &quot;    child-&gt;&quot; . getClearFunction($name) . &quot;();\n&quot;;
 894 
 895   return $setterContent;
 896 }
 897 
 898 sub generateSetValueStatement
 899 {
 900   my $name = shift;
 901   my $value = shift;
 902 
 903   my $isSVG = exists $propertiesWithStyleBuilderOptions{$name}{&quot;svg&quot;};
 904   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
<span class="line-modified"> 905   return &quot;builderState.style().&quot; .  ($isSVG ? &quot;accessSVGStyle().&quot; : &quot;&quot;) . $setter . &quot;(&quot; . $value . &quot;)&quot;;</span>
 906 }
 907 
 908 sub generateInitialValueSetter {
 909   my $name = shift;
 910   my $indent = shift;
 911 
 912   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 913   my $initial = $propertiesWithStyleBuilderOptions{$name}{&quot;initial&quot;};
 914   my $isSVG = exists $propertiesWithStyleBuilderOptions{$name}{&quot;svg&quot;};
 915   my $setterContent = &quot;&quot;;
<span class="line-modified"> 916   $setterContent .= $indent . &quot;static void applyInitial&quot; . $nameToId{$name} . &quot;(BuilderState&amp; builderState)\n&quot;;</span>
 917   $setterContent .= $indent . &quot;{\n&quot;;
<span class="line-modified"> 918   my $style = &quot;builderState.style()&quot;;</span>
 919   if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;auto-functions&quot;}) {
 920     $setterContent .= $indent . &quot;    &quot; . getAutoSetter($name, $style) . &quot;;\n&quot;;
 921   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;visited-link-color-support&quot;}) {
 922       my $initialColor = &quot;RenderStyle::&quot; . $initial . &quot;()&quot;;
 923       $setterContent .= generateColorValueSetter($name, $initialColor, $indent . &quot;    &quot;);
 924   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;animatable&quot;}) {
 925     $setterContent .= generateAnimationPropertyInitialValueSetter($name, $indent . &quot;    &quot;);
 926   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;font-property&quot;}) {
<span class="line-modified"> 927     $setterContent .= $indent . &quot;    auto fontDescription = builderState.fontDescription();\n&quot;;</span>
 928     $setterContent .= $indent . &quot;    fontDescription.&quot; . $setter . &quot;(FontCascadeDescription::&quot; . $initial . &quot;());\n&quot;;
<span class="line-modified"> 929     $setterContent .= $indent . &quot;    builderState.setFontDescription(WTFMove(fontDescription));\n&quot;;</span>
 930   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;fill-layer-property&quot;}) {
 931     $setterContent .= generateFillLayerPropertyInitialValueSetter($name, $indent . &quot;    &quot;);
 932   } else {
 933     my $initialValue = ($isSVG ? &quot;SVGRenderStyle&quot; : &quot;RenderStyle&quot;) . &quot;::&quot; . $initial . &quot;()&quot;;
 934     $setterContent .= $indent . &quot;    &quot; . generateSetValueStatement($name, $initialValue) . &quot;;\n&quot;;
 935   }
 936   $setterContent .= $indent . &quot;}\n&quot;;
 937 
 938   return $setterContent;
 939 }
 940 
 941 sub generateInheritValueSetter {
 942   my $name = shift;
 943   my $indent = shift;
 944 
 945   my $setterContent = &quot;&quot;;
<span class="line-modified"> 946   $setterContent .= $indent . &quot;static void applyInherit&quot; . $nameToId{$name} . &quot;(BuilderState&amp; builderState)\n&quot;;</span>
 947   $setterContent .= $indent . &quot;{\n&quot;;
 948   my $isSVG = exists $propertiesWithStyleBuilderOptions{$name}{&quot;svg&quot;};
<span class="line-modified"> 949   my $parentStyle = &quot;builderState.parentStyle()&quot;;</span>
<span class="line-modified"> 950   my $style = &quot;builderState.style()&quot;;</span>
 951   my $getter = $propertiesWithStyleBuilderOptions{$name}{&quot;getter&quot;};
 952   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
 953   my $didCallSetValue = 0;
 954   if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;auto-functions&quot;}) {
 955     $setterContent .= $indent . &quot;    if (&quot; . getAutoGetter($name, $parentStyle) . &quot;) {\n&quot;;
 956     $setterContent .= $indent . &quot;        &quot; . getAutoSetter($name, $style) . &quot;;\n&quot;;
 957     $setterContent .= $indent . &quot;        return;\n&quot;;
 958     $setterContent .= $indent . &quot;    }\n&quot;;
 959   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;visited-link-color-support&quot;}) {
<span class="line-modified"> 960     $setterContent .= $indent . &quot;    Color color = &quot; . $parentStyle . &quot;.&quot; . $getter . &quot;();\n&quot;;</span>
 961     if (!exists($propertiesWithStyleBuilderOptions{$name}{&quot;no-default-color&quot;})) {
 962       $setterContent .= $indent . &quot;    if (!color.isValid())\n&quot;;
<span class="line-modified"> 963       $setterContent .= $indent . &quot;        color = &quot; . $parentStyle . &quot;.color();\n&quot;;</span>
 964     }
 965     $setterContent .= generateColorValueSetter($name, &quot;color&quot;, $indent . &quot;    &quot;);
 966     $didCallSetValue = 1;
 967   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;animatable&quot;}) {
 968     $setterContent .= generateAnimationPropertyInheritValueSetter($name, $indent . &quot;    &quot;);
 969     $didCallSetValue = 1;
 970   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;font-property&quot;}) {
<span class="line-modified"> 971     $setterContent .= $indent . &quot;    auto fontDescription = builderState.fontDescription();\n&quot;;</span>
<span class="line-modified"> 972     $setterContent .= $indent . &quot;    fontDescription.&quot; . $setter . &quot;(builderState.parentFontDescription().&quot; . $getter . &quot;());\n&quot;;</span>
<span class="line-modified"> 973     $setterContent .= $indent . &quot;    builderState.setFontDescription(WTFMove(fontDescription));\n&quot;;</span>
 974     $didCallSetValue = 1;
 975   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;fill-layer-property&quot;}) {
 976     $setterContent .= generateFillLayerPropertyInheritValueSetter($name, $indent . &quot;    &quot;);
 977     $didCallSetValue = 1;
 978   }
 979   if (!$didCallSetValue) {
<span class="line-modified"> 980     my $inheritedValue = $parentStyle . &quot;.&quot; . ($isSVG ? &quot;svgStyle().&quot; : &quot;&quot;) .  $getter . &quot;()&quot;;</span>
 981     $setterContent .= $indent . &quot;    &quot; . generateSetValueStatement($name, &quot;forwardInheritedValue(&quot; . $inheritedValue . &quot;)&quot;) . &quot;;\n&quot;;
 982   }
 983   $setterContent .= $indent . &quot;}\n&quot;;
 984 
 985   return $setterContent;
 986 }
 987 
 988 sub generateValueSetter {
 989   my $name = shift;
 990   my $indent = shift;
 991 
 992   my $setterContent = &quot;&quot;;
<span class="line-modified"> 993   $setterContent .= $indent . &quot;static void applyValue&quot; . $nameToId{$name} . &quot;(BuilderState&amp; builderState, CSSValue&amp; value)\n&quot;;</span>
 994   $setterContent .= $indent . &quot;{\n&quot;;
 995   my $convertedValue;
 996   if (exists($propertiesWithStyleBuilderOptions{$name}{&quot;converter&quot;})) {
<span class="line-modified"> 997     $convertedValue = &quot;BuilderConverter::convert&quot; . $propertiesWithStyleBuilderOptions{$name}{&quot;converter&quot;} . &quot;(builderState, value)&quot;;</span>
 998   } elsif (exists($propertiesWithStyleBuilderOptions{$name}{&quot;conditional-converter&quot;})) {
<span class="line-modified"> 999     $setterContent .= $indent . &quot;    auto convertedValue = BuilderConverter::convert&quot; . $propertiesWithStyleBuilderOptions{$name}{&quot;conditional-converter&quot;} . &quot;(builderState, value);\n&quot;;</span>
1000     $convertedValue = &quot;WTFMove(convertedValue.value())&quot;;
1001   } else {
1002     $convertedValue = &quot;downcast&lt;CSSPrimitiveValue&gt;(value)&quot;;
1003   }
1004 
1005   my $setter = $propertiesWithStyleBuilderOptions{$name}{&quot;setter&quot;};
<span class="line-modified">1006   my $style = &quot;builderState.style()&quot;;</span>
1007   my $didCallSetValue = 0;
1008   if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;auto-functions&quot;}) {
1009     $setterContent .= $indent . &quot;    if (downcast&lt;CSSPrimitiveValue&gt;(value).valueID() == CSSValueAuto) {\n&quot;;
1010     $setterContent .= $indent . &quot;        &quot;. getAutoSetter($name, $style) . &quot;;\n&quot;;
1011     $setterContent .= $indent . &quot;        return;\n&quot;;
1012     $setterContent .= $indent . &quot;    }\n&quot;;
1013   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;visited-link-color-support&quot;}) {
1014     $setterContent .= $indent . &quot;    auto&amp; primitiveValue = downcast&lt;CSSPrimitiveValue&gt;(value);\n&quot;;
1015     if ($name eq &quot;color&quot;) {
1016       # The &quot;color&quot; property supports &quot;currentColor&quot; value. We should add a parameter.
1017       $setterContent .= handleCurrentColorValue($name, &quot;primitiveValue&quot;, $indent . &quot;    &quot;);
1018     }
1019     $setterContent .= generateColorValueSetter($name, &quot;primitiveValue&quot;, $indent . &quot;    &quot;, VALUE_IS_PRIMITIVE);
1020     $didCallSetValue = 1;
1021   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;animatable&quot;}) {
1022     $setterContent .= generateAnimationPropertyValueSetter($name, $indent . &quot;    &quot;);
1023     $didCallSetValue = 1;
1024   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;font-property&quot;}) {
<span class="line-modified">1025     $setterContent .= $indent . &quot;    auto fontDescription = builderState.fontDescription();\n&quot;;</span>
1026     $setterContent .= $indent . &quot;    fontDescription.&quot; . $setter . &quot;(&quot; . $convertedValue . &quot;);\n&quot;;
<span class="line-modified">1027     $setterContent .= $indent . &quot;    builderState.setFontDescription(WTFMove(fontDescription));\n&quot;;</span>
1028     $didCallSetValue = 1;
1029   } elsif (exists $propertiesWithStyleBuilderOptions{$name}{&quot;fill-layer-property&quot;}) {
1030     $setterContent .= generateFillLayerPropertyValueSetter($name, $indent . &quot;    &quot;);
1031     $didCallSetValue = 1;
1032   }
1033   if (!$didCallSetValue) {
1034     if (exists($propertiesWithStyleBuilderOptions{$name}{&quot;conditional-converter&quot;})) {
1035       $setterContent .= $indent . &quot;    if (convertedValue)\n&quot;;
1036       $setterContent .= &quot;    &quot;;
1037     }
1038     $setterContent .= $indent . &quot;    &quot; . generateSetValueStatement($name, $convertedValue) . &quot;;\n&quot;;
1039   }
1040   $setterContent .= $indent . &quot;}\n&quot;;
1041 
1042   return $setterContent;
1043 }
1044 
<span class="line-modified">1045 open STYLEBUILDER, &quot;&gt;StyleBuilderGenerated.cpp&quot; || die &quot;Could not open StyleBuilderGenerated.cpp for writing&quot;;</span>
1046 print STYLEBUILDER &lt;&lt; &quot;EOF&quot;;
1047 /* This file is automatically generated from $inputFile by makeprop, do not edit */
1048 
1049 #include &quot;config.h&quot;
<span class="line-modified">1050 #include &quot;StyleBuilderGenerated.h&quot;</span>
1051 
1052 #include &quot;CSSPrimitiveValueMappings.h&quot;
1053 #include &quot;CSSProperty.h&quot;
1054 #include &quot;RenderStyle.h&quot;
<span class="line-added">1055 #include &quot;StyleBuilderState.h&quot;</span>
1056 #include &quot;StyleBuilderConverter.h&quot;
1057 #include &quot;StyleBuilderCustom.h&quot;
1058 #include &quot;StylePropertyShorthand.h&quot;

1059 
1060 namespace WebCore {
<span class="line-added">1061 namespace Style {</span>
1062 
<span class="line-modified">1063 class BuilderFunctions {</span>
1064 public:
1065 EOF
1066 
1067 foreach my $name (@names) {
1068   # Skip Shorthand properties and properties that do not use the StyleBuilder.
1069   next if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;longhands&quot;});
1070   next if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;skip-builder&quot;});
1071 
1072   my $indent = &quot;    &quot;;
1073   if (!$propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;}{&quot;Initial&quot;}) {
1074     print STYLEBUILDER generateInitialValueSetter($name, $indent);
1075   }
1076   if (!$propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;}{&quot;Inherit&quot;}) {
1077     print STYLEBUILDER generateInheritValueSetter($name, $indent);
1078   }
1079   if (!$propertiesWithStyleBuilderOptions{$name}{&quot;custom&quot;}{&quot;Value&quot;}) {
1080     print STYLEBUILDER generateValueSetter($name, $indent);
1081   }
1082 }
1083 
1084 print STYLEBUILDER &lt;&lt; &quot;EOF&quot;;
1085 };
1086 
<span class="line-modified">1087 void BuilderGenerated::applyProperty(CSSPropertyID property, BuilderState&amp; builderState, CSSValue&amp; value, bool isInitial, bool isInherit, const CSSRegisteredCustomProperty* registered)</span>
1088 {
1089     switch (property) {
1090     case CSSPropertyInvalid:
1091         break;
1092     case CSSPropertyCustom: {
1093         auto&amp; customProperty = downcast&lt;CSSCustomPropertyValue&gt;(value);
1094         if (isInitial)
<span class="line-modified">1095             BuilderCustom::applyInitialCustomProperty(builderState, registered, customProperty.name());</span>
1096         else if (isInherit)
<span class="line-modified">1097             BuilderCustom::applyInheritCustomProperty(builderState, registered, customProperty.name());</span>
1098         else
<span class="line-modified">1099             BuilderCustom::applyValueCustomProperty(builderState, registered, customProperty);</span>
1100         break;
1101     }
1102 EOF
1103 
1104 foreach my $name (@names) {
1105   print STYLEBUILDER &quot;    case CSSProperty&quot; . $nameToId{$name} . &quot;:\n&quot;;
1106   if (exists $propertiesWithStyleBuilderOptions{$name}{&quot;longhands&quot;}) {
1107     print STYLEBUILDER &quot;        ASSERT(isShorthandCSSProperty(property));\n&quot;;
1108     print STYLEBUILDER &quot;        ASSERT_NOT_REACHED();\n&quot;;
1109   } elsif (!exists $propertiesWithStyleBuilderOptions{$name}{&quot;skip-builder&quot;}) {
1110     print STYLEBUILDER &quot;        if (isInitial)\n&quot;;
<span class="line-modified">1111     print STYLEBUILDER &quot;            &quot; . getScopeForFunction($name, &quot;Initial&quot;) . &quot;::applyInitial&quot; . $nameToId{$name} . &quot;(builderState);\n&quot;;</span>
1112     print STYLEBUILDER &quot;        else if (isInherit)\n&quot;;
<span class="line-modified">1113     print STYLEBUILDER &quot;            &quot; . getScopeForFunction($name, &quot;Inherit&quot;) . &quot;::applyInherit&quot; . $nameToId{$name} . &quot;(builderState);\n&quot;;</span>
1114     print STYLEBUILDER &quot;        else\n&quot;;
<span class="line-modified">1115     print STYLEBUILDER &quot;            &quot; . getScopeForFunction($name, &quot;Value&quot;) . &quot;::applyValue&quot; . $nameToId{$name} . &quot;(builderState, value);\n&quot;;</span>
1116   }
1117   print STYLEBUILDER &quot;        break;\n&quot;;
1118 }
1119 
1120 print STYLEBUILDER &lt;&lt; &quot;EOF&quot;;
1121     };
1122 }
1123 
<span class="line-added">1124 } // namespace Style</span>
1125 } // namespace WebCore
1126 EOF
1127 
1128 close STYLEBUILDER;
1129 
1130 # Generate StylePropertyShorthandsFunctions.
1131 open SHORTHANDS_H, &quot;&gt;&quot;, &quot;StylePropertyShorthandFunctions.h&quot; or die &quot;Could not open StylePropertyShorthandFunctions.h for writing\n&quot;;
1132 print SHORTHANDS_H &lt;&lt; &quot;EOF&quot;;
1133 // This file is automatically generated from $inputFile by the makeprop.pl script. Do not edit it.
1134 
1135 #pragma once
1136 
1137 namespace WebCore {
1138 
1139 class StylePropertyShorthand;
1140 
1141 EOF
1142 
1143 foreach my $name (@names) {
1144   # Skip non-Shorthand properties.
</pre>
</td>
</tr>
</table>
<center><a href="html.css.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="parser/CSSParser.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>