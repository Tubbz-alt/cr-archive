<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/loader/FetchOptions.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2016 Canon Inc.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted, provided that the following conditions
  6  * are required to be met:
  7  *
  8  * 1.  Redistributions of source code must retain the above copyright
  9  *     notice, this list of conditions and the following disclaimer.
 10  * 2.  Redistributions in binary form must reproduce the above copyright
 11  *     notice, this list of conditions and the following disclaimer in the
 12  *     documentation and/or other materials provided with the distribution.
 13  * 3.  Neither the name of Canon Inc. nor the names of
 14  *     its contributors may be used to endorse or promote products derived
 15  *     from this software without specific prior written permission.
 16  *
 17  * THIS SOFTWARE IS PROVIDED BY CANON INC. AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 18  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 19  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 20  * DISCLAIMED. IN NO EVENT SHALL CANON INC. AND ITS CONTRIBUTORS BE LIABLE FOR
 21  * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 22  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 23  * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 24  * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 25  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 26  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 27  */
 28 
 29 #pragma once
 30 
 31 #include &quot;DocumentIdentifier.h&quot;
 32 #include &quot;ReferrerPolicy.h&quot;
<a name="1" id="anc1"></a><span class="line-added"> 33 #include &lt;wtf/Markable.h&gt;</span>
 34 #include &lt;wtf/text/WTFString.h&gt;
 35 
 36 namespace WebCore {
 37 
 38 struct FetchOptions {
 39     enum class Destination : uint8_t { EmptyString, Audio, Document, Embed, Font, Image, Manifest, Object, Report, Script, Serviceworker, Sharedworker, Style, Track, Video, Worker, Xslt };
 40     enum class Mode : uint8_t { Navigate, SameOrigin, NoCors, Cors };
 41     enum class Credentials : uint8_t { Omit, SameOrigin, Include };
 42     enum class Cache : uint8_t { Default, NoStore, Reload, NoCache, ForceCache, OnlyIfCached };
 43     enum class Redirect : uint8_t { Follow, Error, Manual };
 44 
 45     FetchOptions() = default;
 46     FetchOptions(Destination, Mode, Credentials, Cache, Redirect, ReferrerPolicy, String&amp;&amp;, bool);
 47     FetchOptions isolatedCopy() const { return { destination, mode, credentials, cache, redirect, referrerPolicy, integrity.isolatedCopy(), keepAlive }; }
 48 
 49     template&lt;class Encoder&gt; void encodePersistent(Encoder&amp;) const;
 50     template&lt;class Decoder&gt; static bool decodePersistent(Decoder&amp;, FetchOptions&amp;);
 51     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
 52     template&lt;class Decoder&gt; static Optional&lt;FetchOptions&gt; decode(Decoder&amp;);
 53 
 54     Destination destination { Destination::EmptyString };
 55     Mode mode { Mode::NoCors };
 56     Credentials credentials { Credentials::Omit };
 57     Cache cache { Cache::Default };
 58     Redirect redirect { Redirect::Follow };
 59     ReferrerPolicy referrerPolicy { ReferrerPolicy::EmptyString };
 60     bool keepAlive { false };
 61     String integrity;
<a name="2" id="anc2"></a><span class="line-modified"> 62     Markable&lt;DocumentIdentifier, DocumentIdentifier::MarkableTraits&gt; clientIdentifier;</span>
 63 };
 64 
 65 inline FetchOptions::FetchOptions(Destination destination, Mode mode, Credentials credentials, Cache cache, Redirect redirect, ReferrerPolicy referrerPolicy, String&amp;&amp; integrity, bool keepAlive)
 66     : destination(destination)
 67     , mode(mode)
 68     , credentials(credentials)
 69     , cache(cache)
 70     , redirect(redirect)
 71     , referrerPolicy(referrerPolicy)
 72     , keepAlive(keepAlive)
 73     , integrity(WTFMove(integrity))
 74 {
 75 }
 76 
 77 inline bool isPotentialNavigationOrSubresourceRequest(FetchOptions::Destination destination)
 78 {
 79     return destination == FetchOptions::Destination::Object
 80         || destination == FetchOptions::Destination::Embed;
 81 }
 82 
 83 inline bool isNonSubresourceRequest(FetchOptions::Destination destination)
 84 {
 85     return destination == FetchOptions::Destination::Document
 86         || destination == FetchOptions::Destination::Report
 87         || destination == FetchOptions::Destination::Serviceworker
 88         || destination == FetchOptions::Destination::Sharedworker
 89         || destination == FetchOptions::Destination::Worker;
 90 }
 91 
 92 inline bool isScriptLikeDestination(FetchOptions::Destination destination)
 93 {
 94     return destination == FetchOptions::Destination::Script
 95         || destination == FetchOptions::Destination::Serviceworker
 96         || destination == FetchOptions::Destination::Worker;
 97 }
 98 
 99 }
100 
101 namespace WTF {
102 
103 template&lt;&gt; struct EnumTraits&lt;WebCore::FetchOptions::Destination&gt; {
104     using values = EnumValues&lt;
105         WebCore::FetchOptions::Destination,
106         WebCore::FetchOptions::Destination::EmptyString,
107         WebCore::FetchOptions::Destination::Audio,
108         WebCore::FetchOptions::Destination::Document,
109         WebCore::FetchOptions::Destination::Embed,
110         WebCore::FetchOptions::Destination::Font,
111         WebCore::FetchOptions::Destination::Image,
112         WebCore::FetchOptions::Destination::Manifest,
113         WebCore::FetchOptions::Destination::Object,
114         WebCore::FetchOptions::Destination::Report,
115         WebCore::FetchOptions::Destination::Script,
116         WebCore::FetchOptions::Destination::Serviceworker,
117         WebCore::FetchOptions::Destination::Sharedworker,
118         WebCore::FetchOptions::Destination::Style,
119         WebCore::FetchOptions::Destination::Track,
120         WebCore::FetchOptions::Destination::Video,
121         WebCore::FetchOptions::Destination::Worker,
122         WebCore::FetchOptions::Destination::Xslt
123     &gt;;
124 };
125 
126 template&lt;&gt; struct EnumTraits&lt;WebCore::FetchOptions::Mode&gt; {
127     using values = EnumValues&lt;
128         WebCore::FetchOptions::Mode,
129         WebCore::FetchOptions::Mode::Navigate,
130         WebCore::FetchOptions::Mode::SameOrigin,
131         WebCore::FetchOptions::Mode::NoCors,
132         WebCore::FetchOptions::Mode::Cors
133     &gt;;
134 };
135 
136 template&lt;&gt; struct EnumTraits&lt;WebCore::FetchOptions::Credentials&gt; {
137     using values = EnumValues&lt;
138         WebCore::FetchOptions::Credentials,
139         WebCore::FetchOptions::Credentials::Omit,
140         WebCore::FetchOptions::Credentials::SameOrigin,
141         WebCore::FetchOptions::Credentials::Include
142     &gt;;
143 };
144 
145 template&lt;&gt; struct EnumTraits&lt;WebCore::FetchOptions::Cache&gt; {
146     using values = EnumValues&lt;
147         WebCore::FetchOptions::Cache,
148         WebCore::FetchOptions::Cache::Default,
149         WebCore::FetchOptions::Cache::NoStore,
150         WebCore::FetchOptions::Cache::Reload,
151         WebCore::FetchOptions::Cache::NoCache,
152         WebCore::FetchOptions::Cache::ForceCache,
153         WebCore::FetchOptions::Cache::OnlyIfCached
154     &gt;;
155 };
156 
157 template&lt;&gt; struct EnumTraits&lt;WebCore::FetchOptions::Redirect&gt; {
158     using values = EnumValues&lt;
159         WebCore::FetchOptions::Redirect,
160         WebCore::FetchOptions::Redirect::Follow,
161         WebCore::FetchOptions::Redirect::Error,
162         WebCore::FetchOptions::Redirect::Manual
163     &gt;;
164 };
165 
166 }
167 
168 namespace WebCore {
169 
170 template&lt;class Encoder&gt; inline void FetchOptions::encodePersistent(Encoder&amp; encoder) const
171 {
172     // Changes to encoding here should bump NetworkCache Storage format version.
173     encoder &lt;&lt; destination;
174     encoder &lt;&lt; mode;
175     encoder &lt;&lt; credentials;
176     encoder &lt;&lt; cache;
177     encoder &lt;&lt; redirect;
178     encoder &lt;&lt; referrerPolicy;
179     encoder &lt;&lt; integrity;
180     encoder &lt;&lt; keepAlive;
181 }
182 
183 template&lt;class Decoder&gt; inline bool FetchOptions::decodePersistent(Decoder&amp; decoder, FetchOptions&amp; options)
184 {
185     FetchOptions::Destination destination;
186     if (!decoder.decode(destination))
187         return false;
188 
189     FetchOptions::Mode mode;
190     if (!decoder.decode(mode))
191         return false;
192 
193     FetchOptions::Credentials credentials;
194     if (!decoder.decode(credentials))
195         return false;
196 
197     FetchOptions::Cache cache;
198     if (!decoder.decode(cache))
199         return false;
200 
201     FetchOptions::Redirect redirect;
202     if (!decoder.decode(redirect))
203         return false;
204 
205     ReferrerPolicy referrerPolicy;
206     if (!decoder.decode(referrerPolicy))
207         return false;
208 
209     String integrity;
210     if (!decoder.decode(integrity))
211         return false;
212 
213     bool keepAlive;
214     if (!decoder.decode(keepAlive))
215         return false;
216 
217     options.destination = destination;
218     options.mode = mode;
219     options.credentials = credentials;
220     options.cache = cache;
221     options.redirect = redirect;
222     options.referrerPolicy = referrerPolicy;
223     options.integrity = WTFMove(integrity);
224     options.keepAlive = keepAlive;
225 
226     return true;
227 }
228 
229 template&lt;class Encoder&gt; inline void FetchOptions::encode(Encoder&amp; encoder) const
230 {
231     encodePersistent(encoder);
<a name="3" id="anc3"></a><span class="line-modified">232     encoder &lt;&lt; clientIdentifier.asOptional();</span>
233 }
234 
235 template&lt;class Decoder&gt; inline Optional&lt;FetchOptions&gt; FetchOptions::decode(Decoder&amp; decoder)
236 {
237     FetchOptions options;
238     if (!decodePersistent(decoder, options))
239         return WTF::nullopt;
240 
241     Optional&lt;Optional&lt;DocumentIdentifier&gt;&gt; clientIdentifier;
242     decoder &gt;&gt; clientIdentifier;
243     if (!clientIdentifier)
244         return WTF::nullopt;
245     options.clientIdentifier = WTFMove(clientIdentifier.value());
246 
247     return options;
248 }
249 
250 } // namespace WebCore
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>