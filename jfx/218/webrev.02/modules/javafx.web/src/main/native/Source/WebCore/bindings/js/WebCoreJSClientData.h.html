<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/bindings/js/WebCoreJSClientData.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  *  Copyright (C) 1999-2001 Harri Porten (porten@kde.org)
  3  *  Copyright (C) 2003-2017 Apple Inc. All rights reserved.
  4  *  Copyright (C) 2007 Samuel Weinig &lt;sam@webkit.org&gt;
  5  *  Copyright (C) 2009 Google, Inc. All rights reserved.
  6  *
  7  *  This library is free software; you can redistribute it and/or
  8  *  modify it under the terms of the GNU Lesser General Public
  9  *  License as published by the Free Software Foundation; either
 10  *  version 2 of the License, or (at your option) any later version.
 11  *
 12  *  This library is distributed in the hope that it will be useful,
 13  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 14  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 15  *  Lesser General Public License for more details.
 16  *
 17  *  You should have received a copy of the GNU Lesser General Public
 18  *  License along with this library; if not, write to the Free Software
 19  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 20  */
 21 
 22 #pragma once
 23 
 24 #include &quot;DOMWrapperWorld.h&quot;
 25 #include &quot;WebCoreBuiltinNames.h&quot;
 26 #include &quot;WebCoreJSBuiltins.h&quot;
 27 #include &lt;wtf/HashSet.h&gt;
 28 #include &lt;wtf/RefPtr.h&gt;
 29 
 30 namespace WebCore {
 31 
 32 class JSVMClientData : public JSC::VM::ClientData {
 33     WTF_MAKE_NONCOPYABLE(JSVMClientData); WTF_MAKE_FAST_ALLOCATED;
 34     friend class VMWorldIterator;
 35 
 36 public:
 37     explicit JSVMClientData(JSC::VM&amp;);
 38 
 39     virtual ~JSVMClientData();
 40 
 41     WEBCORE_EXPORT static void initNormalWorld(JSC::VM*);
 42 
 43     DOMWrapperWorld&amp; normalWorld() { return *m_normalWorld; }
 44 
 45     void getAllWorlds(Vector&lt;Ref&lt;DOMWrapperWorld&gt;&gt;&amp;);
 46 
 47     void rememberWorld(DOMWrapperWorld&amp; world)
 48     {
 49         ASSERT(!m_worldSet.contains(&amp;world));
 50         m_worldSet.add(&amp;world);
 51     }
 52 
 53     void forgetWorld(DOMWrapperWorld&amp; world)
 54     {
 55         ASSERT(m_worldSet.contains(&amp;world));
 56         m_worldSet.remove(&amp;world);
 57     }
 58 
 59     WebCoreBuiltinNames&amp; builtinNames() { return m_builtinNames; }
 60     JSBuiltinFunctions&amp; builtinFunctions() { return m_builtinFunctions; }
 61 
 62     JSC::IsoSubspace&amp; domBuiltinConstructorSpace() { return m_domBuiltinConstructorSpace; }
 63     JSC::IsoSubspace&amp; domConstructorSpace() { return m_domConstructorSpace; }
 64     JSC::IsoSubspace&amp; domWindowPropertiesSpace() { return m_domWindowPropertiesSpace; }
 65     JSC::IsoSubspace&amp; runtimeArraySpace() { return m_runtimeArraySpace; }
 66     JSC::IsoSubspace&amp; runtimeMethodSpace() { return m_runtimeMethodSpace; }
 67     JSC::IsoSubspace&amp; runtimeObjectSpace() { return m_runtimeObjectSpace; }
 68     JSC::IsoSubspace&amp; windowProxySpace() { return m_windowProxySpace; }
 69 
 70     JSC::CompleteSubspace&amp; outputConstraintSpace() { return m_outputConstraintSpace; }
 71 
 72     JSC::IsoSubspace&amp; subspaceForJSDOMWindow() { return m_subspaceForJSDOMWindow; }
 73     JSC::IsoSubspace&amp; subspaceForJSDedicatedWorkerGlobalScope() { return m_subspaceForJSDedicatedWorkerGlobalScope; }
 74     JSC::IsoSubspace&amp; subspaceForJSRemoteDOMWindow() { return m_subspaceForJSRemoteDOMWindow; }
 75     JSC::IsoSubspace&amp; subspaceForJSWorkerGlobalScope() { return m_subspaceForJSWorkerGlobalScope; }
 76 #if ENABLE(SERVICE_WORKER)
 77     JSC::IsoSubspace&amp; subspaceForJSServiceWorkerGlobalScope() { return m_subspaceForJSServiceWorkerGlobalScope; }
 78 #endif
 79 #if ENABLE(CSS_PAINTING_API)
 80     JSC::IsoSubspace&amp; subspaceForJSPaintWorkletGlobalScope() { return m_subspaceForJSPaintWorkletGlobalScope; }
 81     JSC::IsoSubspace&amp; subspaceForJSWorkletGlobalScope() { return m_subspaceForJSWorkletGlobalScope; }
 82 #endif
 83 
 84     template&lt;typename Func&gt;
 85     void forEachOutputConstraintSpace(const Func&amp; func)
 86     {
 87         func(m_outputConstraintSpace);
 88         func(m_subspaceForJSDOMWindow);
 89         func(m_subspaceForJSDedicatedWorkerGlobalScope);
 90         func(m_subspaceForJSRemoteDOMWindow);
 91         func(m_subspaceForJSWorkerGlobalScope);
 92 #if ENABLE(SERVICE_WORKER)
 93         func(m_subspaceForJSServiceWorkerGlobalScope);
 94 #endif
 95 #if ENABLE(CSS_PAINTING_API)
 96         func(m_subspaceForJSPaintWorkletGlobalScope);
 97         func(m_subspaceForJSWorkletGlobalScope);
 98 #endif
 99     }
100 
101 private:
102     HashSet&lt;DOMWrapperWorld*&gt; m_worldSet;
103     RefPtr&lt;DOMWrapperWorld&gt; m_normalWorld;
104 
105     JSBuiltinFunctions m_builtinFunctions;
106     WebCoreBuiltinNames m_builtinNames;
107 
108     std::unique_ptr&lt;JSC::HeapCellType&gt; m_runtimeArrayHeapCellType;
109     std::unique_ptr&lt;JSC::HeapCellType&gt; m_runtimeObjectHeapCellType;
110     std::unique_ptr&lt;JSC::HeapCellType&gt; m_windowProxyHeapCellType;
111 
112     std::unique_ptr&lt;JSC::HeapCellType&gt; m_heapCellTypeForJSDOMWindow;
113     std::unique_ptr&lt;JSC::HeapCellType&gt; m_heapCellTypeForJSDedicatedWorkerGlobalScope;
114     std::unique_ptr&lt;JSC::HeapCellType&gt; m_heapCellTypeForJSRemoteDOMWindow;
115     std::unique_ptr&lt;JSC::HeapCellType&gt; m_heapCellTypeForJSWorkerGlobalScope;
116 #if ENABLE(SERVICE_WORKER)
117     std::unique_ptr&lt;JSC::HeapCellType&gt; m_heapCellTypeForJSServiceWorkerGlobalScope;
118 #endif
119 #if ENABLE(CSS_PAINTING_API)
120     std::unique_ptr&lt;JSC::HeapCellType&gt; m_heapCellTypeForJSPaintWorkletGlobalScope;
121     std::unique_ptr&lt;JSC::HeapCellType&gt; m_heapCellTypeForJSWorkletGlobalScope;
122 #endif
123 
124     JSC::IsoSubspace m_domBuiltinConstructorSpace;
125     JSC::IsoSubspace m_domConstructorSpace;
126     JSC::IsoSubspace m_domWindowPropertiesSpace;
127     JSC::IsoSubspace m_runtimeArraySpace;
128     JSC::IsoSubspace m_runtimeMethodSpace;
129     JSC::IsoSubspace m_runtimeObjectSpace;
130     JSC::IsoSubspace m_windowProxySpace;
131 
132     JSC::IsoSubspace m_subspaceForJSDOMWindow;
133     JSC::IsoSubspace m_subspaceForJSDedicatedWorkerGlobalScope;
134     JSC::IsoSubspace m_subspaceForJSRemoteDOMWindow;
135     JSC::IsoSubspace m_subspaceForJSWorkerGlobalScope;
136 #if ENABLE(SERVICE_WORKER)
137     JSC::IsoSubspace m_subspaceForJSServiceWorkerGlobalScope;
138 #endif
139 #if ENABLE(CSS_PAINTING_API)
140     JSC::IsoSubspace m_subspaceForJSPaintWorkletGlobalScope;
141     JSC::IsoSubspace m_subspaceForJSWorkletGlobalScope;
142 #endif
143 
144     JSC::CompleteSubspace m_outputConstraintSpace;
145 };
146 
147 } // namespace WebCore
    </pre>
  </body>
</html>