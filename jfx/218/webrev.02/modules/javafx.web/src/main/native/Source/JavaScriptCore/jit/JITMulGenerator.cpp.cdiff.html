<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/JITMulGenerator.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JITMathIC.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JITMulGenerator.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/JITMulGenerator.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (C) 2015-2016 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (C) 2015-2019 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
</pre>
<hr />
<pre>
<span class="line-old-header">*** 31,11 ***</span>
  #include &quot;ArithProfile.h&quot;
  #include &quot;JITMathIC.h&quot;
  
  namespace JSC {
  
<span class="line-modified">! JITMathICInlineResult JITMulGenerator::generateInline(CCallHelpers&amp; jit, MathICGenerationState&amp; state, const ArithProfile* arithProfile)</span>
  {
      // We default to speculating int32.
      ObservedType lhs = ObservedType().withInt32();
      ObservedType rhs = ObservedType().withInt32();
      if (arithProfile) {
<span class="line-new-header">--- 31,11 ---</span>
  #include &quot;ArithProfile.h&quot;
  #include &quot;JITMathIC.h&quot;
  
  namespace JSC {
  
<span class="line-modified">! JITMathICInlineResult JITMulGenerator::generateInline(CCallHelpers&amp; jit, MathICGenerationState&amp; state, const BinaryArithProfile* arithProfile)</span>
  {
      // We default to speculating int32.
      ObservedType lhs = ObservedType().withInt32();
      ObservedType rhs = ObservedType().withInt32();
      if (arithProfile) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 87,11 ***</span>
      }
  
      return JITMathICInlineResult::GenerateFullSnippet;
  }
  
<span class="line-modified">! bool JITMulGenerator::generateFastPath(CCallHelpers&amp; jit, CCallHelpers::JumpList&amp; endJumpList, CCallHelpers::JumpList&amp; slowPathJumpList, const ArithProfile* arithProfile, bool shouldEmitProfiling)</span>
  {
      ASSERT(m_scratchGPR != InvalidGPRReg);
      ASSERT(m_scratchGPR != m_left.payloadGPR());
      ASSERT(m_scratchGPR != m_right.payloadGPR());
  #if USE(JSVALUE64)
<span class="line-new-header">--- 87,11 ---</span>
      }
  
      return JITMathICInlineResult::GenerateFullSnippet;
  }
  
<span class="line-modified">! bool JITMulGenerator::generateFastPath(CCallHelpers&amp; jit, CCallHelpers::JumpList&amp; endJumpList, CCallHelpers::JumpList&amp; slowPathJumpList, const BinaryArithProfile* arithProfile, bool shouldEmitProfiling)</span>
  {
      ASSERT(m_scratchGPR != InvalidGPRReg);
      ASSERT(m_scratchGPR != m_left.payloadGPR());
      ASSERT(m_scratchGPR != m_right.payloadGPR());
  #if USE(JSVALUE64)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 203,44 ***</span>
  #if USE(JSVALUE64)
          jit.moveDoubleTo64(m_leftFPR, m_result.payloadGPR());
  
          CCallHelpers::Jump notNegativeZero = jit.branch64(CCallHelpers::NotEqual, m_result.payloadGPR(), CCallHelpers::TrustedImm64(negativeZeroBits));
  
<span class="line-modified">!         jit.or32(CCallHelpers::TrustedImm32(ArithProfile::NegZeroDouble), CCallHelpers::AbsoluteAddress(arithProfile-&gt;addressOfBits()));</span>
          CCallHelpers::Jump done = jit.jump();
  
          notNegativeZero.link(&amp;jit);
<span class="line-modified">!         jit.or32(CCallHelpers::TrustedImm32(ArithProfile::NonNegZeroDouble), CCallHelpers::AbsoluteAddress(arithProfile-&gt;addressOfBits()));</span>
  
          jit.move(m_result.payloadGPR(), m_scratchGPR);
          jit.urshiftPtr(CCallHelpers::Imm32(52), m_scratchGPR);
          jit.and32(CCallHelpers::Imm32(0x7ff), m_scratchGPR);
          CCallHelpers::Jump noInt52Overflow = jit.branch32(CCallHelpers::LessThanOrEqual, m_scratchGPR, CCallHelpers::TrustedImm32(0x431));
  
<span class="line-modified">!         jit.or32(CCallHelpers::TrustedImm32(ArithProfile::Int52Overflow), CCallHelpers::AbsoluteAddress(arithProfile-&gt;addressOfBits()));</span>
          noInt52Overflow.link(&amp;jit);
  
          done.link(&amp;jit);
<span class="line-modified">!         jit.sub64(GPRInfo::tagTypeNumberRegister, m_result.payloadGPR()); // Box the double.</span>
  #else
          jit.boxDouble(m_leftFPR, m_result);
          CCallHelpers::JumpList notNegativeZero;
          notNegativeZero.append(jit.branch32(CCallHelpers::NotEqual, m_result.payloadGPR(), CCallHelpers::TrustedImm32(0)));
          notNegativeZero.append(jit.branch32(CCallHelpers::NotEqual, m_result.tagGPR(), CCallHelpers::TrustedImm32(negativeZeroBits &gt;&gt; 32)));
  
<span class="line-modified">!         jit.or32(CCallHelpers::TrustedImm32(ArithProfile::NegZeroDouble), CCallHelpers::AbsoluteAddress(arithProfile-&gt;addressOfBits()));</span>
          CCallHelpers::Jump done = jit.jump();
  
          notNegativeZero.link(&amp;jit);
<span class="line-modified">!         jit.or32(CCallHelpers::TrustedImm32(ArithProfile::NonNegZeroDouble), CCallHelpers::AbsoluteAddress(arithProfile-&gt;addressOfBits()));</span>
  
          jit.move(m_result.tagGPR(), m_scratchGPR);
          jit.urshiftPtr(CCallHelpers::Imm32(52 - 32), m_scratchGPR);
          jit.and32(CCallHelpers::Imm32(0x7ff), m_scratchGPR);
          CCallHelpers::Jump noInt52Overflow = jit.branch32(CCallHelpers::LessThanOrEqual, m_scratchGPR, CCallHelpers::TrustedImm32(0x431));
  
<span class="line-modified">!         jit.or32(CCallHelpers::TrustedImm32(ArithProfile::Int52Overflow), CCallHelpers::AbsoluteAddress(arithProfile-&gt;addressOfBits()));</span>
  
          endJumpList.append(noInt52Overflow);
          if (m_scratchGPR == m_result.tagGPR() || m_scratchGPR == m_result.payloadGPR())
              jit.boxDouble(m_leftFPR, m_result);
  
<span class="line-new-header">--- 203,44 ---</span>
  #if USE(JSVALUE64)
          jit.moveDoubleTo64(m_leftFPR, m_result.payloadGPR());
  
          CCallHelpers::Jump notNegativeZero = jit.branch64(CCallHelpers::NotEqual, m_result.payloadGPR(), CCallHelpers::TrustedImm64(negativeZeroBits));
  
<span class="line-modified">!         arithProfile-&gt;emitUnconditionalSet(jit, ObservedResults::NegZeroDouble);</span>
          CCallHelpers::Jump done = jit.jump();
  
          notNegativeZero.link(&amp;jit);
<span class="line-modified">!         arithProfile-&gt;emitUnconditionalSet(jit, ObservedResults::NonNegZeroDouble);</span>
  
          jit.move(m_result.payloadGPR(), m_scratchGPR);
          jit.urshiftPtr(CCallHelpers::Imm32(52), m_scratchGPR);
          jit.and32(CCallHelpers::Imm32(0x7ff), m_scratchGPR);
          CCallHelpers::Jump noInt52Overflow = jit.branch32(CCallHelpers::LessThanOrEqual, m_scratchGPR, CCallHelpers::TrustedImm32(0x431));
  
<span class="line-modified">!         arithProfile-&gt;emitUnconditionalSet(jit, ObservedResults::Int52Overflow);</span>
          noInt52Overflow.link(&amp;jit);
  
          done.link(&amp;jit);
<span class="line-modified">!         jit.sub64(GPRInfo::numberTagRegister, m_result.payloadGPR()); // Box the double.</span>
  #else
          jit.boxDouble(m_leftFPR, m_result);
          CCallHelpers::JumpList notNegativeZero;
          notNegativeZero.append(jit.branch32(CCallHelpers::NotEqual, m_result.payloadGPR(), CCallHelpers::TrustedImm32(0)));
          notNegativeZero.append(jit.branch32(CCallHelpers::NotEqual, m_result.tagGPR(), CCallHelpers::TrustedImm32(negativeZeroBits &gt;&gt; 32)));
  
<span class="line-modified">!         arithProfile-&gt;emitUnconditionalSet(jit, ObservedResults::NegZeroDouble);</span>
          CCallHelpers::Jump done = jit.jump();
  
          notNegativeZero.link(&amp;jit);
<span class="line-modified">!         arithProfile-&gt;emitUnconditionalSet(jit, ObservedResults::NonNegZeroDouble);</span>
  
          jit.move(m_result.tagGPR(), m_scratchGPR);
          jit.urshiftPtr(CCallHelpers::Imm32(52 - 32), m_scratchGPR);
          jit.and32(CCallHelpers::Imm32(0x7ff), m_scratchGPR);
          CCallHelpers::Jump noInt52Overflow = jit.branch32(CCallHelpers::LessThanOrEqual, m_scratchGPR, CCallHelpers::TrustedImm32(0x431));
  
<span class="line-modified">!         arithProfile-&gt;emitUnconditionalSet(jit, ObservedResults::Int52Overflow);</span>
  
          endJumpList.append(noInt52Overflow);
          if (m_scratchGPR == m_result.tagGPR() || m_scratchGPR == m_result.payloadGPR())
              jit.boxDouble(m_leftFPR, m_result);
  
</pre>
<center><a href="JITMathIC.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JITMulGenerator.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>