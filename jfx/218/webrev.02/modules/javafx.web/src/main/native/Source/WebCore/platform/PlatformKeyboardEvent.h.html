<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/platform/PlatformKeyboardEvent.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2004, 2005, 2006 Apple Inc.  All rights reserved.
  3  * Copyright (C) 2008 Collabora, Ltd.  All rights reserved.
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  * 1. Redistributions of source code must retain the above copyright
  9  *    notice, this list of conditions and the following disclaimer.
 10  * 2. Redistributions in binary form must reproduce the above copyright
 11  *    notice, this list of conditions and the following disclaimer in the
 12  *    documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 15  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 16  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 18  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 19  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 20  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 21  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 22  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 24  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 25  */
 26 
 27 #pragma once
 28 
 29 #include &quot;CompositionUnderline.h&quot;
 30 #include &quot;KeypressCommand.h&quot;
 31 #include &quot;PlatformEvent.h&quot;
 32 #include &lt;wtf/WindowsExtras.h&gt;
 33 #include &lt;wtf/text/WTFString.h&gt;
 34 
 35 #if PLATFORM(COCOA)
 36 #include &lt;wtf/RetainPtr.h&gt;
 37 OBJC_CLASS NSEvent;
 38 #endif
 39 
 40 #if PLATFORM(IOS_FAMILY)
 41 OBJC_CLASS WebEvent;
 42 #endif
 43 
 44 #if PLATFORM(JAVA)
 45 #include &lt;jni.h&gt;
 46 #endif
 47 
 48 namespace WebCore {
 49 
 50     class PlatformKeyboardEvent : public PlatformEvent {
 51         WTF_MAKE_FAST_ALLOCATED;
 52     public:
 53         PlatformKeyboardEvent()
 54             : PlatformEvent(PlatformEvent::KeyDown)
 55             , m_windowsVirtualKeyCode(0)
 56             , m_autoRepeat(false)
 57             , m_isKeypad(false)
 58             , m_isSystemKey(false)
 59         {
 60         }
 61 
 62         PlatformKeyboardEvent(Type type, const String&amp; text, const String&amp; unmodifiedText, const String&amp; key, const String&amp; code,
 63         const String&amp; keyIdentifier, int windowsVirtualKeyCode, bool isAutoRepeat, bool isKeypad, bool isSystemKey, OptionSet&lt;Modifier&gt; modifiers, WallTime timestamp)
 64             : PlatformEvent(type, modifiers, timestamp)
 65             , m_text(text)
 66             , m_unmodifiedText(unmodifiedText)
 67             , m_key(key)
 68             , m_code(code)
 69             , m_keyIdentifier(keyIdentifier)
 70             , m_windowsVirtualKeyCode(windowsVirtualKeyCode)
 71             , m_autoRepeat(isAutoRepeat)
 72             , m_isKeypad(isKeypad)
 73             , m_isSystemKey(isSystemKey)
 74         {
 75         }
 76 
 77         WEBCORE_EXPORT void disambiguateKeyDownEvent(Type, bool backwardCompatibilityMode = false); // Only used on platforms that need it, i.e. those that generate KeyDown events.
 78 
 79         // Text as as generated by processing a virtual key code with a keyboard layout
 80         // (in most cases, just a character code, but the layout can emit several
 81         // characters in a single keypress event on some platforms).
 82         // This may bear no resemblance to the ultimately inserted text if an input method
 83         // processes the input.
 84         // Will be null for KeyUp and RawKeyDown events.
 85         String text() const { return m_text; }
 86 
 87         // Text that would have been generated by the keyboard if no modifiers were pressed
 88         // (except for Shift); useful for shortcut (accelerator) key handling.
 89         // Otherwise, same as text().
 90         String unmodifiedText() const { return m_unmodifiedText; }
 91 
 92         String keyIdentifier() const { return m_keyIdentifier; }
 93         const String&amp; key() const { return m_key; }
 94         const String&amp; code() const { return m_code; }
 95 
 96         // Most compatible Windows virtual key code associated with the event.
 97         // Zero for Char events.
 98         int windowsVirtualKeyCode() const { return m_windowsVirtualKeyCode; }
 99         void setWindowsVirtualKeyCode(int code) { m_windowsVirtualKeyCode = code; }
100 
101 #if USE(APPKIT) || USE(UIKIT_KEYBOARD_ADDITIONS) || PLATFORM(GTK) || USE(LIBWPE)
102         bool handledByInputMethod() const { return m_handledByInputMethod; }
103 #endif
104 #if PLATFORM(GTK) || USE(LIBWPE)
105         const Optional&lt;Vector&lt;WebCore::CompositionUnderline&gt;&gt;&amp; preeditUnderlines() const { return m_preeditUnderlines; }
106         const Optional&lt;uint64_t&gt;&amp; preeditSelectionRangeStart() const { return m_preeditSelectionRangeStart; }
107         const Optional&lt;uint64_t&gt;&amp; preeditSelectionRangeLength() const { return m_preeditSelectionRangeLength; }
108 #endif
109 #if USE(APPKIT)
110         const Vector&lt;KeypressCommand&gt;&amp; commands() const { return m_commands; }
111 #elif PLATFORM(GTK)
112         const Vector&lt;String&gt;&amp; commands() const { return m_commands; }
113 #endif
114 
115         bool isAutoRepeat() const { return m_autoRepeat; }
116         bool isKeypad() const { return m_isKeypad; }
117         bool isSystemKey() const { return m_isSystemKey; }
118 
119         bool isSyntheticEvent() const { return m_isSyntheticEvent; }
120         void setIsSyntheticEvent() { m_isSyntheticEvent = true; }
121 
122         WEBCORE_EXPORT static bool currentCapsLockState();
123         WEBCORE_EXPORT static void getCurrentModifierState(bool&amp; shiftKey, bool&amp; ctrlKey, bool&amp; altKey, bool&amp; metaKey);
124         WEBCORE_EXPORT static void setCurrentModifierState(OptionSet&lt;Modifier&gt;);
125         WEBCORE_EXPORT static OptionSet&lt;Modifier&gt; currentStateOfModifierKeys();
126 
127 #if PLATFORM(COCOA)
128 #if !PLATFORM(IOS_FAMILY)
129         NSEvent* macEvent() const { return m_macEvent.get(); }
130 #else
131         ::WebEvent *event() const { return m_Event.get(); }
132 #endif
133 #endif
134 
135 #if PLATFORM(WIN)
136         PlatformKeyboardEvent(HWND, WPARAM, LPARAM, Type, bool);
137 #endif
138 
139 #if PLATFORM(GTK)
140         // Used by WebKit2
141         static String keyValueForGdkKeyCode(unsigned);
142         static String keyCodeForHardwareKeyCode(unsigned);
143         static String keyIdentifierForGdkKeyCode(unsigned);
144         static int windowsKeyCodeForGdkKeyCode(unsigned);
145         static String singleCharacterString(unsigned);
146         static bool modifiersContainCapsLock(unsigned);
147 #endif
148 
149 #if PLATFORM(JAVA)
150         PlatformKeyboardEvent(jint type, jstring text, jstring keyIdentifier,
151                               jint windowsVirtualKeyCode, jboolean shift,
152                               jboolean ctrl, jboolean alt, jboolean meta, jdouble timestamp);
153 #endif
154 
155 #if USE(LIBWPE)
156         static String keyValueForWPEKeyCode(unsigned);
157         static String keyCodeForHardwareKeyCode(unsigned);
158         static String keyIdentifierForWPEKeyCode(unsigned);
159         static int windowsKeyCodeForWPEKeyCode(unsigned);
160         static String singleCharacterString(unsigned);
161 #endif
162 
163     protected:
164         String m_text;
165         String m_unmodifiedText;
166         String m_key;
167         String m_code;
168         String m_keyIdentifier;
169         int m_windowsVirtualKeyCode;
170 #if USE(APPKIT) || USE(UIKIT_KEYBOARD_ADDITIONS) || PLATFORM(GTK) || USE(LIBWPE)
171         bool m_handledByInputMethod { false };
172 #endif
173 #if PLATFORM(GTK) || USE(LIBWPE)
174         Optional&lt;Vector&lt;WebCore::CompositionUnderline&gt;&gt; m_preeditUnderlines;
175         Optional&lt;uint64_t&gt; m_preeditSelectionRangeStart;
176         Optional&lt;uint64_t&gt; m_preeditSelectionRangeLength;
177 #endif
178 #if USE(APPKIT)
179         Vector&lt;KeypressCommand&gt; m_commands;
180 #elif PLATFORM(GTK)
181         Vector&lt;String&gt; m_commands;
182 #endif
183         bool m_autoRepeat;
184         bool m_isKeypad;
185         bool m_isSystemKey;
186 
187         bool m_isSyntheticEvent { false };
188 
189 #if PLATFORM(COCOA)
190 #if !PLATFORM(IOS_FAMILY)
191         RetainPtr&lt;NSEvent&gt; m_macEvent;
192 #else
193         RetainPtr&lt;::WebEvent&gt; m_Event;
194 #endif
195 #endif
196         // The modifier state is optional, since it is not needed in the UI process or in legacy WebKit.
197         static Optional&lt;OptionSet&lt;Modifier&gt;&gt; s_currentModifiers;
198     };
199 
200 } // namespace WebCore
    </pre>
  </body>
</html>