<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/dom/MouseEvent.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Microtasks.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MouseEvent.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/dom/MouseEvent.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 21,24 ***</span>
   */
  
  #include &quot;config.h&quot;
  #include &quot;MouseEvent.h&quot;
  
<span class="line-removed">- #include &quot;DataTransfer.h&quot;</span>
  #include &quot;EventNames.h&quot;
  #include &quot;Frame.h&quot;
  #include &quot;FrameView.h&quot;
  #include &quot;HTMLIFrameElement.h&quot;
  #include &quot;JSDOMConvertInterface.h&quot;
  #include &quot;JSDOMConvertNullable.h&quot;
  #include &quot;JSEventTarget.h&quot;
  #include &quot;JSEventTargetCustom.h&quot;
  #include &quot;PlatformMouseEvent.h&quot;
  #include &quot;RuntimeApplicationChecks.h&quot;
  
  namespace WebCore {
  
  using namespace JSC;
  
  Ref&lt;MouseEvent&gt; MouseEvent::create(const AtomString&amp; type, const MouseEventInit&amp; initializer)
  {
      return adoptRef(*new MouseEvent(type, initializer));
<span class="line-new-header">--- 21,28 ---</span>
   */
  
  #include &quot;config.h&quot;
  #include &quot;MouseEvent.h&quot;
  
  #include &quot;EventNames.h&quot;
  #include &quot;Frame.h&quot;
  #include &quot;FrameView.h&quot;
  #include &quot;HTMLIFrameElement.h&quot;
  #include &quot;JSDOMConvertInterface.h&quot;
  #include &quot;JSDOMConvertNullable.h&quot;
  #include &quot;JSEventTarget.h&quot;
  #include &quot;JSEventTargetCustom.h&quot;
  #include &quot;PlatformMouseEvent.h&quot;
  #include &quot;RuntimeApplicationChecks.h&quot;
<span class="line-added">+ #include &lt;JavaScriptCore/CallFrame.h&gt;</span>
<span class="line-added">+ #include &lt;JavaScriptCore/JSGlobalObjectInlines.h&gt;</span>
<span class="line-added">+ #include &lt;wtf/IsoMallocInlines.h&gt;</span>
  
  namespace WebCore {
  
<span class="line-added">+ WTF_MAKE_ISO_ALLOCATED_IMPL(MouseEvent);</span>
<span class="line-added">+ </span>
  using namespace JSC;
  
  Ref&lt;MouseEvent&gt; MouseEvent::create(const AtomString&amp; type, const MouseEventInit&amp; initializer)
  {
      return adoptRef(*new MouseEvent(type, initializer));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 61,14 ***</span>
          event.modifiers(), event.button(), event.buttons(), relatedTarget, event.force(), event.syntheticClickType());
  }
  
  Ref&lt;MouseEvent&gt; MouseEvent::create(const AtomString&amp; type, CanBubble canBubble, IsCancelable isCancelable, IsComposed isComposed, MonotonicTime timestamp, RefPtr&lt;WindowProxy&gt;&amp;&amp; view, int detail,
      const IntPoint&amp; screenLocation, const IntPoint&amp; windowLocation, const IntPoint&amp; movementDelta, OptionSet&lt;Modifier&gt; modifiers, short button, unsigned short buttons,
<span class="line-modified">!     EventTarget* relatedTarget, double force, unsigned short syntheticClickType, DataTransfer* dataTransfer, IsSimulated isSimulated, IsTrusted isTrusted)</span>
  {
      return adoptRef(*new MouseEvent(type, canBubble, isCancelable, isComposed, timestamp, WTFMove(view), detail,
<span class="line-modified">!         screenLocation, windowLocation, movementDelta, modifiers, button, buttons, relatedTarget, force, syntheticClickType, dataTransfer, isSimulated, isTrusted));</span>
  }
  
  Ref&lt;MouseEvent&gt; MouseEvent::create(const AtomString&amp; eventType, CanBubble canBubble, IsCancelable isCancelable, IsComposed isComposed, RefPtr&lt;WindowProxy&gt;&amp;&amp; view, int detail,
      int screenX, int screenY, int clientX, int clientY, OptionSet&lt;Modifier&gt; modifiers, short button, unsigned short buttons,
      unsigned short syntheticClickType, EventTarget* relatedTarget)
<span class="line-new-header">--- 65,14 ---</span>
          event.modifiers(), event.button(), event.buttons(), relatedTarget, event.force(), event.syntheticClickType());
  }
  
  Ref&lt;MouseEvent&gt; MouseEvent::create(const AtomString&amp; type, CanBubble canBubble, IsCancelable isCancelable, IsComposed isComposed, MonotonicTime timestamp, RefPtr&lt;WindowProxy&gt;&amp;&amp; view, int detail,
      const IntPoint&amp; screenLocation, const IntPoint&amp; windowLocation, const IntPoint&amp; movementDelta, OptionSet&lt;Modifier&gt; modifiers, short button, unsigned short buttons,
<span class="line-modified">!     EventTarget* relatedTarget, double force, unsigned short syntheticClickType, IsSimulated isSimulated, IsTrusted isTrusted)</span>
  {
      return adoptRef(*new MouseEvent(type, canBubble, isCancelable, isComposed, timestamp, WTFMove(view), detail,
<span class="line-modified">!         screenLocation, windowLocation, movementDelta, modifiers, button, buttons, relatedTarget, force, syntheticClickType, isSimulated, isTrusted));</span>
  }
  
  Ref&lt;MouseEvent&gt; MouseEvent::create(const AtomString&amp; eventType, CanBubble canBubble, IsCancelable isCancelable, IsComposed isComposed, RefPtr&lt;WindowProxy&gt;&amp;&amp; view, int detail,
      int screenX, int screenY, int clientX, int clientY, OptionSet&lt;Modifier&gt; modifiers, short button, unsigned short buttons,
      unsigned short syntheticClickType, EventTarget* relatedTarget)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 79,19 ***</span>
  MouseEvent::MouseEvent() = default;
  
  MouseEvent::MouseEvent(const AtomString&amp; eventType, CanBubble canBubble, IsCancelable isCancelable, IsComposed isComposed,
      MonotonicTime timestamp, RefPtr&lt;WindowProxy&gt;&amp;&amp; view, int detail,
      const IntPoint&amp; screenLocation, const IntPoint&amp; windowLocation, const IntPoint&amp; movementDelta, OptionSet&lt;Modifier&gt; modifiers, short button, unsigned short buttons,
<span class="line-modified">!     EventTarget* relatedTarget, double force, unsigned short syntheticClickType, DataTransfer* dataTransfer, IsSimulated isSimulated, IsTrusted isTrusted)</span>
      : MouseRelatedEvent(eventType, canBubble, isCancelable, isComposed, timestamp, WTFMove(view), detail, screenLocation, windowLocation, movementDelta, modifiers, isSimulated, isTrusted)
      , m_button(button == -2 ? 0 : button)
      , m_buttons(buttons)
      , m_syntheticClickType(button == -2 ? 0 : syntheticClickType)
      , m_buttonDown(button != -2)
      , m_relatedTarget(relatedTarget)
      , m_force(force)
<span class="line-removed">-     , m_dataTransfer(dataTransfer)</span>
  {
  }
  
  MouseEvent::MouseEvent(const AtomString&amp; eventType, CanBubble canBubble, IsCancelable isCancelable, IsComposed isComposed,
      RefPtr&lt;WindowProxy&gt;&amp;&amp; view, int detail, const IntPoint&amp; screenLocation, const IntPoint&amp; clientLocation,
<span class="line-new-header">--- 83,18 ---</span>
  MouseEvent::MouseEvent() = default;
  
  MouseEvent::MouseEvent(const AtomString&amp; eventType, CanBubble canBubble, IsCancelable isCancelable, IsComposed isComposed,
      MonotonicTime timestamp, RefPtr&lt;WindowProxy&gt;&amp;&amp; view, int detail,
      const IntPoint&amp; screenLocation, const IntPoint&amp; windowLocation, const IntPoint&amp; movementDelta, OptionSet&lt;Modifier&gt; modifiers, short button, unsigned short buttons,
<span class="line-modified">!     EventTarget* relatedTarget, double force, unsigned short syntheticClickType, IsSimulated isSimulated, IsTrusted isTrusted)</span>
      : MouseRelatedEvent(eventType, canBubble, isCancelable, isComposed, timestamp, WTFMove(view), detail, screenLocation, windowLocation, movementDelta, modifiers, isSimulated, isTrusted)
      , m_button(button == -2 ? 0 : button)
      , m_buttons(buttons)
      , m_syntheticClickType(button == -2 ? 0 : syntheticClickType)
      , m_buttonDown(button != -2)
      , m_relatedTarget(relatedTarget)
      , m_force(force)
  {
  }
  
  MouseEvent::MouseEvent(const AtomString&amp; eventType, CanBubble canBubble, IsCancelable isCancelable, IsComposed isComposed,
      RefPtr&lt;WindowProxy&gt;&amp;&amp; view, int detail, const IntPoint&amp; screenLocation, const IntPoint&amp; clientLocation,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 134,16 ***</span>
      m_relatedTarget = relatedTarget;
  
      initCoordinates(IntPoint(clientX, clientY));
  
      setIsSimulated(false);
<span class="line-removed">-     m_dataTransfer = nullptr;</span>
  }
  
  // FIXME: We need this quirk because iAd Producer is calling this function with a relatedTarget that is not an EventTarget (rdar://problem/30640101).
  // We should remove this quirk when possible.
<span class="line-modified">! void MouseEvent::initMouseEventQuirk(ExecState&amp; state, ScriptExecutionContext&amp; scriptExecutionContext, const AtomString&amp; type, bool canBubble, bool cancelable, RefPtr&lt;WindowProxy&gt;&amp;&amp; view, int detail, int screenX, int screenY, int clientX, int clientY, bool ctrlKey, bool altKey, bool shiftKey, bool metaKey, short button, JSValue relatedTargetValue)</span>
  {
      EventTarget* relatedTarget = nullptr;
  #if PLATFORM(MAC)
      // Impacts iBooks too because of widgets generated by iAd Producer (rdar://problem/30797958).
      if (MacApplication::isIAdProducer() || MacApplication::isIBooks()) {
<span class="line-new-header">--- 137,15 ---</span>
      m_relatedTarget = relatedTarget;
  
      initCoordinates(IntPoint(clientX, clientY));
  
      setIsSimulated(false);
  }
  
  // FIXME: We need this quirk because iAd Producer is calling this function with a relatedTarget that is not an EventTarget (rdar://problem/30640101).
  // We should remove this quirk when possible.
<span class="line-modified">! void MouseEvent::initMouseEventQuirk(JSGlobalObject&amp; state, ScriptExecutionContext&amp; scriptExecutionContext, const AtomString&amp; type, bool canBubble, bool cancelable, RefPtr&lt;WindowProxy&gt;&amp;&amp; view, int detail, int screenX, int screenY, int clientX, int clientY, bool ctrlKey, bool altKey, bool shiftKey, bool metaKey, short button, JSValue relatedTargetValue)</span>
  {
      EventTarget* relatedTarget = nullptr;
  #if PLATFORM(MAC)
      // Impacts iBooks too because of widgets generated by iAd Producer (rdar://problem/30797958).
      if (MacApplication::isIAdProducer() || MacApplication::isIBooks()) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 156,11 ***</span>
  #else
      UNUSED_PARAM(scriptExecutionContext);
  #endif
          // This is what the bindings generator would have produced.
          auto throwScope = DECLARE_THROW_SCOPE(state.vm());
<span class="line-modified">!         relatedTarget = convert&lt;IDLNullable&lt;IDLInterface&lt;EventTarget&gt;&gt;&gt;(state, relatedTargetValue, [](ExecState&amp; state, ThrowScope&amp; scope) {</span>
              throwArgumentTypeError(state, scope, 14, &quot;relatedTarget&quot;, &quot;MouseEvent&quot;, &quot;initMouseEvent&quot;, &quot;EventTarget&quot;);
          });
          RETURN_IF_EXCEPTION(throwScope, void());
  #if PLATFORM(MAC)
      }
<span class="line-new-header">--- 158,11 ---</span>
  #else
      UNUSED_PARAM(scriptExecutionContext);
  #endif
          // This is what the bindings generator would have produced.
          auto throwScope = DECLARE_THROW_SCOPE(state.vm());
<span class="line-modified">!         relatedTarget = convert&lt;IDLNullable&lt;IDLInterface&lt;EventTarget&gt;&gt;&gt;(state, relatedTargetValue, [](JSGlobalObject&amp; state, ThrowScope&amp; scope) {</span>
              throwArgumentTypeError(state, scope, 14, &quot;relatedTarget&quot;, &quot;MouseEvent&quot;, &quot;initMouseEvent&quot;, &quot;EventTarget&quot;);
          });
          RETURN_IF_EXCEPTION(throwScope, void());
  #if PLATFORM(MAC)
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 176,25 ***</span>
  bool MouseEvent::isMouseEvent() const
  {
      return true;
  }
  
<span class="line-removed">- bool MouseEvent::isDragEvent() const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     // This function is only used to decide to return nullptr for dataTransfer even when m_dataTransfer is non-null.</span>
<span class="line-removed">-     // FIXME: Is that really valuable? Why will m_dataTransfer be non-null but we need to return null for dataTransfer?</span>
<span class="line-removed">-     // Quite peculiar to decide based on the type string; may have been be provided by call to JavaScript constructor.</span>
<span class="line-removed">-     auto&amp; type = this-&gt;type();</span>
<span class="line-removed">-     return type == eventNames().dragEvent</span>
<span class="line-removed">-         || type == eventNames().dragendEvent</span>
<span class="line-removed">-         || type == eventNames().dragenterEvent</span>
<span class="line-removed">-         || type == eventNames().dragleaveEvent</span>
<span class="line-removed">-         || type == eventNames().dragoverEvent</span>
<span class="line-removed">-         || type == eventNames().dragstartEvent</span>
<span class="line-removed">-         || type == eventNames().dropEvent;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  bool MouseEvent::canTriggerActivationBehavior(const Event&amp; event)
  {
      return event.type() == eventNames().clickEvent &amp;&amp; (!is&lt;MouseEvent&gt;(event) || downcast&lt;MouseEvent&gt;(event).button() != RightButton);
  }
  
<span class="line-new-header">--- 178,10 ---</span>
</pre>
<center><a href="Microtasks.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MouseEvent.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>