<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/svg/SVGSVGElement.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SVGRectElement.idl.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SVGSVGElement.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/svg/SVGSVGElement.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (C) 2004, 2005, 2006 Nikolas Zimmermann &lt;zimmermann@kde.org&gt;</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2004, 2005, 2006, 2019 Nikolas Zimmermann &lt;zimmermann@kde.org&gt;</span>
   * Copyright (C) 2004, 2005, 2006, 2007, 2008, 2010 Rob Buis &lt;buis@kde.org&gt;
   * Copyright (C) 2007-2019 Apple Inc. All rights reserved.
   * Copyright (C) 2014 Adobe Systems Incorporated. All rights reserved.
   *
   * This library is free software; you can redistribute it and/or
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -22,10 +22,11 @@</span>
  
  #include &quot;config.h&quot;
  #include &quot;SVGSVGElement.h&quot;
  
  #include &quot;CSSHelper.h&quot;
<span class="udiff-line-added">+ #include &quot;DOMMatrix2DInit.h&quot;</span>
  #include &quot;DOMWrapperWorld.h&quot;
  #include &quot;ElementIterator.h&quot;
  #include &quot;EventNames.h&quot;
  #include &quot;Frame.h&quot;
  #include &quot;FrameSelection.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -51,11 +52,10 @@</span>
  
  WTF_MAKE_ISO_ALLOCATED_IMPL(SVGSVGElement);
  
  inline SVGSVGElement::SVGSVGElement(const QualifiedName&amp; tagName, Document&amp; document)
      : SVGGraphicsElement(tagName, document)
<span class="udiff-line-removed">-     , SVGExternalResourcesRequired(this)</span>
      , SVGFitToViewBox(this)
      , m_timeContainer(SMILTimeContainer::create(*this))
  {
      ASSERT(hasTagName(SVGNames::svgTag));
      document.registerForDocumentSuspensionCallbacks(*this);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -92,62 +92,10 @@</span>
      oldDocument.unregisterForDocumentSuspensionCallbacks(*this);
      document().registerForDocumentSuspensionCallbacks(*this);
      SVGGraphicsElement::didMoveToNewDocument(oldDocument, newDocument);
  }
  
<span class="udiff-line-removed">- const AtomString&amp; SVGSVGElement::contentScriptType() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     static NeverDestroyed&lt;AtomString&gt; defaultScriptType { &quot;text/ecmascript&quot; };</span>
<span class="udiff-line-removed">-     const AtomString&amp; type = attributeWithoutSynchronization(SVGNames::contentScriptTypeAttr);</span>
<span class="udiff-line-removed">-     return type.isNull() ? defaultScriptType.get() : type;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- void SVGSVGElement::setContentScriptType(const AtomString&amp; type)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     setAttributeWithoutSynchronization(SVGNames::contentScriptTypeAttr, type);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- const AtomString&amp; SVGSVGElement::contentStyleType() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     static NeverDestroyed&lt;AtomString&gt; defaultStyleType { &quot;text/css&quot; };</span>
<span class="udiff-line-removed">-     const AtomString&amp; type = attributeWithoutSynchronization(SVGNames::contentStyleTypeAttr);</span>
<span class="udiff-line-removed">-     return type.isNull() ? defaultStyleType.get() : type;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- void SVGSVGElement::setContentStyleType(const AtomString&amp; type)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     setAttributeWithoutSynchronization(SVGNames::contentStyleTypeAttr, type);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- Ref&lt;SVGRect&gt; SVGSVGElement::viewport() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     // FIXME: Not implemented.</span>
<span class="udiff-line-removed">-     return SVGRect::create();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- float SVGSVGElement::pixelUnitToMillimeterX() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     // There are 25.4 millimeters in an inch.</span>
<span class="udiff-line-removed">-     return 25.4f / cssPixelsPerInch;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- float SVGSVGElement::pixelUnitToMillimeterY() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     // There are 25.4 millimeters in an inch.</span>
<span class="udiff-line-removed">-     return 25.4f / cssPixelsPerInch;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- float SVGSVGElement::screenPixelToMillimeterX() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return pixelUnitToMillimeterX();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- float SVGSVGElement::screenPixelToMillimeterY() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return pixelUnitToMillimeterY();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  SVGViewSpec&amp; SVGSVGElement::currentView()
  {
      if (!m_viewSpec)
          m_viewSpec = SVGViewSpec::create(*this);
      return *m_viewSpec;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -193,11 +141,11 @@</span>
          document().renderView()-&gt;repaint();
  }
  
  void SVGSVGElement::parseAttribute(const QualifiedName&amp; name, const AtomString&amp; value)
  {
<span class="udiff-line-modified-removed">-     if (!nearestViewportElement()) {</span>
<span class="udiff-line-modified-added">+     if (!nearestViewportElement() &amp;&amp; isConnected()) {</span>
          // For these events, the outermost &lt;svg&gt; element works like a &lt;body&gt; element does,
          // setting certain event handlers directly on the window object.
          if (name == HTMLNames::onunloadAttr) {
              document().setWindowAttributeEventListener(eventNames().unloadEvent, name, value, mainThreadNormalWorld());
              return;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -212,52 +160,47 @@</span>
          }
          if (name == SVGNames::onzoomAttr) {
              document().setWindowAttributeEventListener(eventNames().zoomEvent, name, value, mainThreadNormalWorld());
              return;
          }
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-     // For these events, any &lt;svg&gt; element works like a &lt;body&gt; element does,</span>
<span class="udiff-line-modified-removed">-     // setting certain event handlers directly on the window object.</span>
<span class="udiff-line-modified-removed">-     // FIXME: Why different from the events above that work only on the outermost &lt;svg&gt; element?</span>
<span class="udiff-line-modified-removed">-     if (name == HTMLNames::onabortAttr) {</span>
<span class="udiff-line-modified-removed">-         document().setWindowAttributeEventListener(eventNames().abortEvent, name, value, mainThreadNormalWorld());</span>
<span class="udiff-line-modified-removed">-         return;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     if (name == HTMLNames::onerrorAttr) {</span>
<span class="udiff-line-removed">-         document().setWindowAttributeEventListener(eventNames().errorEvent, name, value, mainThreadNormalWorld());</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-modified-added">+         if (name == HTMLNames::onabortAttr) {</span>
<span class="udiff-line-modified-added">+             document().setWindowAttributeEventListener(eventNames().abortEvent, name, value, mainThreadNormalWorld());</span>
<span class="udiff-line-modified-added">+             return;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         if (name == HTMLNames::onerrorAttr) {</span>
<span class="udiff-line-modified-added">+             document().setWindowAttributeEventListener(eventNames().errorEvent, name, value, mainThreadNormalWorld());</span>
<span class="udiff-line-modified-added">+             return;</span>
<span class="udiff-line-modified-added">+         }</span>
      }
  
      SVGParsingError parseError = NoError;
  
      if (name == SVGNames::xAttr)
<span class="udiff-line-modified-removed">-         m_x-&gt;setBaseValInternal(SVGLengthValue::construct(LengthModeWidth, value, parseError));</span>
<span class="udiff-line-modified-added">+         m_x-&gt;setBaseValInternal(SVGLengthValue::construct(SVGLengthMode::Width, value, parseError));</span>
      else if (name == SVGNames::yAttr)
<span class="udiff-line-modified-removed">-         m_y-&gt;setBaseValInternal(SVGLengthValue::construct(LengthModeHeight, value, parseError));</span>
<span class="udiff-line-modified-added">+         m_y-&gt;setBaseValInternal(SVGLengthValue::construct(SVGLengthMode::Height, value, parseError));</span>
      else if (name == SVGNames::widthAttr) {
<span class="udiff-line-modified-removed">-         auto length = SVGLengthValue::construct(LengthModeWidth, value, parseError, ForbidNegativeLengths);</span>
<span class="udiff-line-modified-added">+         auto length = SVGLengthValue::construct(SVGLengthMode::Width, value, parseError, SVGLengthNegativeValuesMode::Forbid);</span>
          if (parseError != NoError || value.isEmpty()) {
              // FIXME: This is definitely the correct behavior for a missing/removed attribute.
              // Not sure it&#39;s correct for the empty string or for something that can&#39;t be parsed.
<span class="udiff-line-modified-removed">-             length = SVGLengthValue(LengthModeWidth, &quot;100%&quot;_s);</span>
<span class="udiff-line-modified-added">+             length = SVGLengthValue(SVGLengthMode::Width, &quot;100%&quot;_s);</span>
          }
          m_width-&gt;setBaseValInternal(length);
      } else if (name == SVGNames::heightAttr) {
<span class="udiff-line-modified-removed">-         auto length = SVGLengthValue::construct(LengthModeHeight, value, parseError, ForbidNegativeLengths);</span>
<span class="udiff-line-modified-added">+         auto length = SVGLengthValue::construct(SVGLengthMode::Height, value, parseError, SVGLengthNegativeValuesMode::Forbid);</span>
          if (parseError != NoError || value.isEmpty()) {
              // FIXME: This is definitely the correct behavior for a removed attribute.
              // Not sure it&#39;s correct for the empty string or for something that can&#39;t be parsed.
<span class="udiff-line-modified-removed">-             length = SVGLengthValue(LengthModeHeight, &quot;100%&quot;_s);</span>
<span class="udiff-line-modified-added">+             length = SVGLengthValue(SVGLengthMode::Height, &quot;100%&quot;_s);</span>
          }
          m_height-&gt;setBaseValInternal(length);
      }
  
      reportAttributeParsingError(parseError, name, value);
  
      SVGGraphicsElement::parseAttribute(name, value);
<span class="udiff-line-removed">-     SVGExternalResourcesRequired::parseAttribute(name, value);</span>
      SVGFitToViewBox::parseAttribute(name, value);
      SVGZoomAndPan::parseAttribute(name, value);
  }
  
  void SVGSVGElement::svgAttributeChanged(const QualifiedName&amp; attrName)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -278,28 +221,10 @@</span>
          }
          return;
      }
  
      SVGGraphicsElement::svgAttributeChanged(attrName);
<span class="udiff-line-removed">-     SVGExternalResourcesRequired::svgAttributeChanged(attrName);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- unsigned SVGSVGElement::suspendRedraw(unsigned)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return 0;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- void SVGSVGElement::unsuspendRedraw(unsigned)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- void SVGSVGElement::unsuspendRedrawAll()</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- void SVGSVGElement::forceRedraw()</span>
<span class="udiff-line-removed">- {</span>
  }
  
  Ref&lt;NodeList&gt; SVGSVGElement::collectIntersectionOrEnclosureList(SVGRect&amp; rect, SVGElement* referenceElement, bool (*checkFunction)(SVGElement&amp;, SVGRect&amp;))
  {
      Vector&lt;Ref&lt;Element&gt;&gt; elements;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -330,24 +255,20 @@</span>
  {
      document().updateLayoutIgnorePendingStylesheets();
      return collectIntersectionOrEnclosureList(rect, referenceElement, checkEnclosureWithoutUpdatingLayout);
  }
  
<span class="udiff-line-modified-removed">- bool SVGSVGElement::checkIntersection(RefPtr&lt;SVGElement&gt;&amp;&amp; element, SVGRect&amp; rect)</span>
<span class="udiff-line-modified-added">+ bool SVGSVGElement::checkIntersection(Ref&lt;SVGElement&gt;&amp;&amp; element, SVGRect&amp; rect)</span>
  {
<span class="udiff-line-removed">-     if (!element)</span>
<span class="udiff-line-removed">-         return false;</span>
      element-&gt;document().updateLayoutIgnorePendingStylesheets();
<span class="udiff-line-modified-removed">-     return checkIntersectionWithoutUpdatingLayout(*element, rect);</span>
<span class="udiff-line-modified-added">+     return checkIntersectionWithoutUpdatingLayout(element, rect);</span>
  }
  
<span class="udiff-line-modified-removed">- bool SVGSVGElement::checkEnclosure(RefPtr&lt;SVGElement&gt;&amp;&amp; element, SVGRect&amp; rect)</span>
<span class="udiff-line-modified-added">+ bool SVGSVGElement::checkEnclosure(Ref&lt;SVGElement&gt;&amp;&amp; element, SVGRect&amp; rect)</span>
  {
<span class="udiff-line-removed">-     if (!element)</span>
<span class="udiff-line-removed">-         return false;</span>
      element-&gt;document().updateLayoutIgnorePendingStylesheets();
<span class="udiff-line-modified-removed">-     return checkEnclosureWithoutUpdatingLayout(*element, rect);</span>
<span class="udiff-line-modified-added">+     return checkEnclosureWithoutUpdatingLayout(element, rect);</span>
  }
  
  void SVGSVGElement::deselectAll()
  {
      if (auto frame = makeRefPtr(document().frame()))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -387,13 +308,26 @@</span>
  Ref&lt;SVGTransform&gt; SVGSVGElement::createSVGTransform()
  {
      return SVGTransform::create(SVGTransformValue::SVG_TRANSFORM_MATRIX);
  }
  
<span class="udiff-line-modified-removed">- Ref&lt;SVGTransform&gt; SVGSVGElement::createSVGTransformFromMatrix(SVGMatrix&amp; matrix)</span>
<span class="udiff-line-modified-added">+ Ref&lt;SVGTransform&gt; SVGSVGElement::createSVGTransformFromMatrix(DOMMatrix2DInit&amp;&amp; matrixInit)</span>
  {
<span class="udiff-line-modified-removed">-     return SVGTransform::create(matrix.value());</span>
<span class="udiff-line-modified-added">+     AffineTransform transform;</span>
<span class="udiff-line-added">+     if (matrixInit.a.hasValue())</span>
<span class="udiff-line-added">+         transform.setA(matrixInit.a.value());</span>
<span class="udiff-line-added">+     if (matrixInit.b.hasValue())</span>
<span class="udiff-line-added">+         transform.setB(matrixInit.b.value());</span>
<span class="udiff-line-added">+     if (matrixInit.c.hasValue())</span>
<span class="udiff-line-added">+         transform.setC(matrixInit.c.value());</span>
<span class="udiff-line-added">+     if (matrixInit.d.hasValue())</span>
<span class="udiff-line-added">+         transform.setD(matrixInit.d.value());</span>
<span class="udiff-line-added">+     if (matrixInit.e.hasValue())</span>
<span class="udiff-line-added">+         transform.setE(matrixInit.e.value());</span>
<span class="udiff-line-added">+     if (matrixInit.f.hasValue())</span>
<span class="udiff-line-added">+         transform.setF(matrixInit.f.value());</span>
<span class="udiff-line-added">+     return SVGTransform::create(transform);</span>
  }
  
  AffineTransform SVGSVGElement::localCoordinateSpaceTransform(SVGLocatable::CTMScope mode) const
  {
      AffineTransform viewBoxTransform;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -574,30 +508,30 @@</span>
      return FloatSize(floatValueForLength(intrinsicWidth(), 0), floatValueForLength(intrinsicHeight(), 0));
  }
  
  bool SVGSVGElement::hasIntrinsicWidth() const
  {
<span class="udiff-line-modified-removed">-     return width().unitType() != LengthTypePercentage;</span>
<span class="udiff-line-modified-added">+     return width().lengthType() != SVGLengthType::Percentage;</span>
  }
  
  bool SVGSVGElement::hasIntrinsicHeight() const
  {
<span class="udiff-line-modified-removed">-     return height().unitType() != LengthTypePercentage;</span>
<span class="udiff-line-modified-added">+     return height().lengthType() != SVGLengthType::Percentage;</span>
  }
  
  Length SVGSVGElement::intrinsicWidth() const
  {
<span class="udiff-line-modified-removed">-     if (width().unitType() == LengthTypePercentage)</span>
<span class="udiff-line-modified-added">+     if (width().lengthType() == SVGLengthType::Percentage)</span>
          return Length(0, Fixed);
  
      SVGLengthContext lengthContext(this);
      return Length(width().value(lengthContext), Fixed);
  }
  
  Length SVGSVGElement::intrinsicHeight() const
  {
<span class="udiff-line-modified-removed">-     if (height().unitType() == LengthTypePercentage)</span>
<span class="udiff-line-modified-added">+     if (height().lengthType() == SVGLengthType::Percentage)</span>
          return Length(0, Fixed);
  
      SVGLengthContext lengthContext(this);
      return Length(height().value(lengthContext), Fixed);
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -664,10 +598,23 @@</span>
      // or MyDrawing.svg#xpointer(id(&#39;MyView&#39;))) then the closest ancestor &quot;svg&quot; element is displayed in the viewport.
      // Any view specification attributes included on the given &quot;view&quot; element override the corresponding view specification
      // attributes on the closest ancestor &quot;svg&quot; element.
      if (auto* viewElement = findViewAnchor(fragmentIdentifier)) {
          if (auto* rootElement = findRootAnchor(viewElement)) {
<span class="udiff-line-added">+             if (rootElement-&gt;m_currentViewElement) {</span>
<span class="udiff-line-added">+                 ASSERT(rootElement-&gt;m_currentViewElement-&gt;targetElement() == rootElement);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 // If the viewElement has changed, remove the link from the SVGViewElement to the previously selected SVGSVGElement.</span>
<span class="udiff-line-added">+                 if (rootElement-&gt;m_currentViewElement != viewElement)</span>
<span class="udiff-line-added">+                     rootElement-&gt;m_currentViewElement-&gt;resetTargetElement();</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             if (rootElement-&gt;m_currentViewElement != viewElement) {</span>
<span class="udiff-line-added">+                 rootElement-&gt;m_currentViewElement = viewElement;</span>
<span class="udiff-line-added">+                 rootElement-&gt;m_currentViewElement-&gt;setTargetElement(*rootElement);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ </span>
              rootElement-&gt;inheritViewAttributes(*viewElement);
              if (auto* renderer = rootElement-&gt;renderer())
                  RenderSVGResource::markForLayoutAndParentResourceInvalidation(*renderer);
              m_currentViewFragmentIdentifier = fragmentIdentifier;
              return true;
</pre>
<center><a href="SVGRectElement.idl.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SVGSVGElement.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>