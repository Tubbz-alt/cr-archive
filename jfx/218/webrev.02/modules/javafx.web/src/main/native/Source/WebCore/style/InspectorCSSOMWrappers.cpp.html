<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/style/InspectorCSSOMWrappers.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 1999 Lars Knoll (knoll@kde.org)
  3  *           (C) 2004-2005 Allan Sandfeld Jensen (kde@carewolf.com)
  4  * Copyright (C) 2006, 2007 Nicholas Shanks (webkit@nickshanks.com)
  5  * Copyright (C) 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012 Apple Inc. All rights reserved.
  6  * Copyright (C) 2007 Alexey Proskuryakov &lt;ap@webkit.org&gt;
  7  * Copyright (C) 2007, 2008 Eric Seidel &lt;eric@webkit.org&gt;
  8  * Copyright (C) 2008, 2009 Torch Mobile Inc. All rights reserved. (http://www.torchmobile.com/)
  9  * Copyright (c) 2011, Code Aurora Forum. All rights reserved.
 10  * Copyright (C) Research In Motion Limited 2011. All rights reserved.
 11  * Copyright (C) 2012 Google Inc. All rights reserved.
 12  *
 13  * This library is free software; you can redistribute it and/or
 14  * modify it under the terms of the GNU Library General Public
 15  * License as published by the Free Software Foundation; either
 16  * version 2 of the License, or (at your option) any later version.
 17  *
 18  * This library is distributed in the hope that it will be useful,
 19  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 20  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 21  * Library General Public License for more details.
 22  *
 23  * You should have received a copy of the GNU Library General Public License
 24  * along with this library; see the file COPYING.LIB.  If not, write to
 25  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 26  * Boston, MA 02110-1301, USA.
 27  */
 28 
 29 #include &quot;config.h&quot;
 30 #include &quot;InspectorCSSOMWrappers.h&quot;
 31 
 32 #include &quot;CSSImportRule.h&quot;
 33 #include &quot;CSSMediaRule.h&quot;
 34 #include &quot;CSSRule.h&quot;
 35 #include &quot;CSSStyleRule.h&quot;
 36 #include &quot;CSSStyleSheet.h&quot;
 37 #include &quot;CSSSupportsRule.h&quot;
 38 #include &quot;ExtensionStyleSheets.h&quot;
 39 #include &quot;StyleScope.h&quot;
 40 #include &quot;StyleSheetContents.h&quot;
 41 #include &quot;UserAgentStyle.h&quot;
 42 
 43 namespace WebCore {
 44 namespace Style {
 45 
 46 void InspectorCSSOMWrappers::collectFromStyleSheetIfNeeded(CSSStyleSheet* styleSheet)
 47 {
 48     if (!m_styleRuleToCSSOMWrapperMap.isEmpty())
 49         collect(styleSheet);
 50 }
 51 
 52 template &lt;class ListType&gt;
 53 void InspectorCSSOMWrappers::collect(ListType* listType)
 54 {
 55     if (!listType)
 56         return;
 57     unsigned size = listType-&gt;length();
 58     for (unsigned i = 0; i &lt; size; ++i) {
 59         CSSRule* cssRule = listType-&gt;item(i);
 60         switch (cssRule-&gt;type()) {
 61         case CSSRule::IMPORT_RULE:
 62             collect(downcast&lt;CSSImportRule&gt;(*cssRule).styleSheet());
 63             break;
 64         case CSSRule::MEDIA_RULE:
 65             collect(downcast&lt;CSSMediaRule&gt;(cssRule));
 66             break;
 67         case CSSRule::SUPPORTS_RULE:
 68             collect(downcast&lt;CSSSupportsRule&gt;(cssRule));
 69             break;
 70         case CSSRule::STYLE_RULE:
 71             m_styleRuleToCSSOMWrapperMap.add(&amp;downcast&lt;CSSStyleRule&gt;(*cssRule).styleRule(), downcast&lt;CSSStyleRule&gt;(cssRule));
 72             break;
 73         default:
 74             break;
 75         }
 76     }
 77 }
 78 
 79 void InspectorCSSOMWrappers::collectFromStyleSheetContents(StyleSheetContents* styleSheet)
 80 {
 81     if (!styleSheet)
 82         return;
 83     auto styleSheetWrapper = CSSStyleSheet::create(*styleSheet);
 84     m_styleSheetCSSOMWrapperSet.add(styleSheetWrapper.copyRef());
 85     collect(styleSheetWrapper.ptr());
 86 }
 87 
 88 void InspectorCSSOMWrappers::collectFromStyleSheets(const Vector&lt;RefPtr&lt;CSSStyleSheet&gt;&gt;&amp; sheets)
 89 {
 90     for (auto&amp; sheet : sheets)
 91         collect(sheet.get());
 92 }
 93 
 94 void InspectorCSSOMWrappers::maybeCollectFromStyleSheets(const Vector&lt;RefPtr&lt;CSSStyleSheet&gt;&gt;&amp; sheets)
 95 {
 96     for (auto&amp; sheet : sheets) {
 97         if (!m_styleSheetCSSOMWrapperSet.contains(sheet.get())) {
 98             m_styleSheetCSSOMWrapperSet.add(sheet);
 99             collect(sheet.get());
100         }
101     }
102 }
103 
104 void InspectorCSSOMWrappers::collectDocumentWrappers(ExtensionStyleSheets&amp; extensionStyleSheets)
105 {
106     if (m_styleRuleToCSSOMWrapperMap.isEmpty()) {
107         collectFromStyleSheetContents(UserAgentStyle::simpleDefaultStyleSheet);
108         collectFromStyleSheetContents(UserAgentStyle::defaultStyleSheet);
109         collectFromStyleSheetContents(UserAgentStyle::quirksStyleSheet);
110         collectFromStyleSheetContents(UserAgentStyle::dialogStyleSheet);
111         collectFromStyleSheetContents(UserAgentStyle::svgStyleSheet);
112         collectFromStyleSheetContents(UserAgentStyle::mathMLStyleSheet);
113         collectFromStyleSheetContents(UserAgentStyle::mediaControlsStyleSheet);
114         collectFromStyleSheetContents(UserAgentStyle::fullscreenStyleSheet);
115 #if ENABLE(DATALIST_ELEMENT)
116         collectFromStyleSheetContents(UserAgentStyle::dataListStyleSheet);
117 #endif
118 #if ENABLE(INPUT_TYPE_COLOR)
119         collectFromStyleSheetContents(UserAgentStyle::colorInputStyleSheet);
120 #endif
121         collectFromStyleSheetContents(UserAgentStyle::plugInsStyleSheet);
122         collectFromStyleSheetContents(UserAgentStyle::mediaQueryStyleSheet);
123 
124         collect(extensionStyleSheets.pageUserSheet());
125         collectFromStyleSheets(extensionStyleSheets.injectedUserStyleSheets());
126         collectFromStyleSheets(extensionStyleSheets.documentUserStyleSheets());
127         collectFromStyleSheets(extensionStyleSheets.injectedAuthorStyleSheets());
128         collectFromStyleSheets(extensionStyleSheets.authorStyleSheetsForTesting());
129     }
130 }
131 
132 void InspectorCSSOMWrappers::collectScopeWrappers(Scope&amp; styleScope)
133 {
134     maybeCollectFromStyleSheets(styleScope.activeStyleSheets());
135 }
136 
137 CSSStyleRule* InspectorCSSOMWrappers::getWrapperForRuleInSheets(const StyleRule* rule)
138 {
139     return m_styleRuleToCSSOMWrapperMap.get(rule);
140 }
141 
142 } // namespace Style
143 } // namespace WebCore
    </pre>
  </body>
</html>