<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/IntlCollatorPrototype.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="IntlCollatorConstructor.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="IntlCollatorPrototype.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/IntlCollatorPrototype.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 34,12 ***</span>
  #include &quot;JSBoundFunction.h&quot;
  #include &quot;JSCInlines.h&quot;
  
  namespace JSC {
  
<span class="line-modified">! static EncodedJSValue JSC_HOST_CALL IntlCollatorPrototypeGetterCompare(ExecState*);</span>
<span class="line-modified">! static EncodedJSValue JSC_HOST_CALL IntlCollatorPrototypeFuncResolvedOptions(ExecState*);</span>
  
  }
  
  #include &quot;IntlCollatorPrototype.lut.h&quot;
  
<span class="line-new-header">--- 34,12 ---</span>
  #include &quot;JSBoundFunction.h&quot;
  #include &quot;JSCInlines.h&quot;
  
  namespace JSC {
  
<span class="line-modified">! static EncodedJSValue JSC_HOST_CALL IntlCollatorPrototypeGetterCompare(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified">! static EncodedJSValue JSC_HOST_CALL IntlCollatorPrototypeFuncResolvedOptions(JSGlobalObject*, CallFrame*);</span>
  
  }
  
  #include &quot;IntlCollatorPrototype.lut.h&quot;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 73,82 ***</span>
  
  void IntlCollatorPrototype::finishCreation(VM&amp; vm)
  {
      Base::finishCreation(vm);
  
<span class="line-modified">!     putDirectWithoutTransition(vm, vm.propertyNames-&gt;toStringTagSymbol, jsString(vm, &quot;Object&quot;), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);</span>
  }
  
<span class="line-modified">! static EncodedJSValue JSC_HOST_CALL IntlCollatorFuncCompare(ExecState* state)</span>
  {
<span class="line-modified">!     VM&amp; vm = state-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      // 10.3.4 Collator Compare Functions (ECMA-402 2.0)
      // 1. Let collator be the this value.
      // 2. Assert: Type(collator) is Object and collator has an [[initializedCollator]] internal slot whose value is true.
<span class="line-modified">!     IntlCollator* collator = jsCast&lt;IntlCollator*&gt;(state-&gt;thisValue());</span>
  
      // 3. If x is not provided, let x be undefined.
      // 4. If y is not provided, let y be undefined.
      // 5. Let X be ToString(x).
<span class="line-modified">!     JSString* x = state-&gt;argument(0).toString(state);</span>
      // 6. ReturnIfAbrupt(X).
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      // 7. Let Y be ToString(y).
<span class="line-modified">!     JSString* y = state-&gt;argument(1).toString(state);</span>
      // 8. ReturnIfAbrupt(Y).
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      // 9. Return CompareStrings(collator, X, Y).
<span class="line-modified">!     auto xViewWithString = x-&gt;viewWithUnderlyingString(state);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
<span class="line-modified">!     auto yViewWithString = y-&gt;viewWithUnderlyingString(state);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
<span class="line-modified">!     RELEASE_AND_RETURN(scope, JSValue::encode(collator-&gt;compareStrings(*state, xViewWithString.view, yViewWithString.view)));</span>
  }
  
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL IntlCollatorPrototypeGetterCompare(ExecState* state)</span>
  {
<span class="line-modified">!     VM&amp; vm = state-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      // 10.3.3 Intl.Collator.prototype.compare (ECMA-402 2.0)
      // 1. Let collator be this Collator object.
<span class="line-modified">!     IntlCollator* collator = jsDynamicCast&lt;IntlCollator*&gt;(vm, state-&gt;thisValue());</span>
      if (!collator)
<span class="line-modified">!         return JSValue::encode(throwTypeError(state, scope, &quot;Intl.Collator.prototype.compare called on value that&#39;s not an object initialized as a Collator&quot;_s));</span>
  
      JSBoundFunction* boundCompare = collator-&gt;boundCompare();
      // 2. If collator.[[boundCompare]] is undefined,
      if (!boundCompare) {
          JSGlobalObject* globalObject = collator-&gt;globalObject(vm);
          // a. Let F be a new built-in function object as defined in 11.3.4.
          // b. The value of F’s length property is 2.
          JSFunction* targetObject = JSFunction::create(vm, globalObject, 2, &quot;compare&quot;_s, IntlCollatorFuncCompare, NoIntrinsic);
  
          // c. Let bc be BoundFunctionCreate(F, «this value»).
<span class="line-modified">!         boundCompare = JSBoundFunction::create(vm, state, globalObject, targetObject, collator, nullptr, 2, &quot;compare&quot;_s);</span>
          RETURN_IF_EXCEPTION(scope, encodedJSValue());
          // d. Set collator.[[boundCompare]] to bc.
          collator-&gt;setBoundCompare(vm, boundCompare);
      }
      // 3. Return collator.[[boundCompare]].
      return JSValue::encode(boundCompare);
  }
  
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL IntlCollatorPrototypeFuncResolvedOptions(ExecState* state)</span>
  {
<span class="line-modified">!     VM&amp; vm = state-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      // 10.3.5 Intl.Collator.prototype.resolvedOptions() (ECMA-402 2.0)
<span class="line-modified">!     IntlCollator* collator = jsDynamicCast&lt;IntlCollator*&gt;(vm, state-&gt;thisValue());</span>
      if (!collator)
<span class="line-modified">!         return JSValue::encode(throwTypeError(state, scope, &quot;Intl.Collator.prototype.resolvedOptions called on value that&#39;s not an object initialized as a Collator&quot;_s));</span>
  
<span class="line-modified">!     RELEASE_AND_RETURN(scope, JSValue::encode(collator-&gt;resolvedOptions(*state)));</span>
  }
  
  } // namespace JSC
  
  #endif // ENABLE(INTL)
<span class="line-new-header">--- 73,82 ---</span>
  
  void IntlCollatorPrototype::finishCreation(VM&amp; vm)
  {
      Base::finishCreation(vm);
  
<span class="line-modified">!     putDirectWithoutTransition(vm, vm.propertyNames-&gt;toStringTagSymbol, jsNontrivialString(vm, &quot;Object&quot;_s), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);</span>
  }
  
<span class="line-modified">! static EncodedJSValue JSC_HOST_CALL IntlCollatorFuncCompare(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      // 10.3.4 Collator Compare Functions (ECMA-402 2.0)
      // 1. Let collator be the this value.
      // 2. Assert: Type(collator) is Object and collator has an [[initializedCollator]] internal slot whose value is true.
<span class="line-modified">!     IntlCollator* collator = jsCast&lt;IntlCollator*&gt;(callFrame-&gt;thisValue());</span>
  
      // 3. If x is not provided, let x be undefined.
      // 4. If y is not provided, let y be undefined.
      // 5. Let X be ToString(x).
<span class="line-modified">!     JSString* x = callFrame-&gt;argument(0).toString(globalObject);</span>
      // 6. ReturnIfAbrupt(X).
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      // 7. Let Y be ToString(y).
<span class="line-modified">!     JSString* y = callFrame-&gt;argument(1).toString(globalObject);</span>
      // 8. ReturnIfAbrupt(Y).
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
  
      // 9. Return CompareStrings(collator, X, Y).
<span class="line-modified">!     auto xViewWithString = x-&gt;viewWithUnderlyingString(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
<span class="line-modified">!     auto yViewWithString = y-&gt;viewWithUnderlyingString(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, encodedJSValue());
<span class="line-modified">!     RELEASE_AND_RETURN(scope, JSValue::encode(collator-&gt;compareStrings(globalObject, xViewWithString.view, yViewWithString.view)));</span>
  }
  
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL IntlCollatorPrototypeGetterCompare(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      // 10.3.3 Intl.Collator.prototype.compare (ECMA-402 2.0)
      // 1. Let collator be this Collator object.
<span class="line-modified">!     IntlCollator* collator = jsDynamicCast&lt;IntlCollator*&gt;(vm, callFrame-&gt;thisValue());</span>
      if (!collator)
<span class="line-modified">!         return JSValue::encode(throwTypeError(globalObject, scope, &quot;Intl.Collator.prototype.compare called on value that&#39;s not an object initialized as a Collator&quot;_s));</span>
  
      JSBoundFunction* boundCompare = collator-&gt;boundCompare();
      // 2. If collator.[[boundCompare]] is undefined,
      if (!boundCompare) {
          JSGlobalObject* globalObject = collator-&gt;globalObject(vm);
          // a. Let F be a new built-in function object as defined in 11.3.4.
          // b. The value of F’s length property is 2.
          JSFunction* targetObject = JSFunction::create(vm, globalObject, 2, &quot;compare&quot;_s, IntlCollatorFuncCompare, NoIntrinsic);
  
          // c. Let bc be BoundFunctionCreate(F, «this value»).
<span class="line-modified">!         boundCompare = JSBoundFunction::create(vm, globalObject, targetObject, collator, nullptr, 2, nullptr);</span>
          RETURN_IF_EXCEPTION(scope, encodedJSValue());
          // d. Set collator.[[boundCompare]] to bc.
          collator-&gt;setBoundCompare(vm, boundCompare);
      }
      // 3. Return collator.[[boundCompare]].
      return JSValue::encode(boundCompare);
  }
  
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL IntlCollatorPrototypeFuncResolvedOptions(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      // 10.3.5 Intl.Collator.prototype.resolvedOptions() (ECMA-402 2.0)
<span class="line-modified">!     IntlCollator* collator = jsDynamicCast&lt;IntlCollator*&gt;(vm, callFrame-&gt;thisValue());</span>
      if (!collator)
<span class="line-modified">!         return JSValue::encode(throwTypeError(globalObject, scope, &quot;Intl.Collator.prototype.resolvedOptions called on value that&#39;s not an object initialized as a Collator&quot;_s));</span>
  
<span class="line-modified">!     RELEASE_AND_RETURN(scope, JSValue::encode(collator-&gt;resolvedOptions(globalObject)));</span>
  }
  
  } // namespace JSC
  
  #endif // ENABLE(INTL)
</pre>
<center><a href="IntlCollatorConstructor.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="IntlCollatorPrototype.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>