<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSGlobalObject.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSGlobalLexicalEnvironment.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSGlobalObject.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSGlobalObject.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  62 #include &quot;ECMAScriptSpecInternalFunctions.h&quot;
  63 #include &quot;Error.h&quot;
  64 #include &quot;ErrorConstructor.h&quot;
  65 #include &quot;ErrorPrototype.h&quot;
  66 #include &quot;Exception.h&quot;
  67 #include &quot;FunctionConstructor.h&quot;
  68 #include &quot;FunctionPrototype.h&quot;
  69 #include &quot;GeneratorFunctionConstructor.h&quot;
  70 #include &quot;GeneratorFunctionPrototype.h&quot;
  71 #include &quot;GeneratorPrototype.h&quot;
  72 #include &quot;GetterSetter.h&quot;
  73 #include &quot;HeapIterationScope.h&quot;
  74 #include &quot;IndirectEvalExecutable.h&quot;
  75 #include &quot;InspectorInstrumentationObject.h&quot;
  76 #include &quot;Interpreter.h&quot;
  77 #include &quot;IteratorPrototype.h&quot;
  78 #include &quot;JSAPIWrapperObject.h&quot;
  79 #include &quot;JSArrayBuffer.h&quot;
  80 #include &quot;JSArrayBufferConstructor.h&quot;
  81 #include &quot;JSArrayBufferPrototype.h&quot;

  82 #include &quot;JSAsyncFunction.h&quot;

  83 #include &quot;JSAsyncGeneratorFunction.h&quot;
  84 #include &quot;JSBigInt.h&quot;
  85 #include &quot;JSBoundFunction.h&quot;
  86 #include &quot;JSCInlines.h&quot;
  87 #include &quot;JSCallbackConstructor.h&quot;
  88 #include &quot;JSCallbackFunction.h&quot;
  89 #include &quot;JSCallbackObject.h&quot;
  90 #include &quot;JSCustomGetterSetterFunction.h&quot;
  91 #include &quot;JSDataView.h&quot;
  92 #include &quot;JSDataViewPrototype.h&quot;
  93 #include &quot;JSDollarVM.h&quot;
  94 #include &quot;JSFunction.h&quot;

  95 #include &quot;JSGeneratorFunction.h&quot;
  96 #include &quot;JSGenericTypedArrayViewConstructorInlines.h&quot;
  97 #include &quot;JSGenericTypedArrayViewInlines.h&quot;
  98 #include &quot;JSGenericTypedArrayViewPrototypeInlines.h&quot;
  99 #include &quot;JSGlobalObjectFunctions.h&quot;
 100 #include &quot;JSInternalPromise.h&quot;
 101 #include &quot;JSInternalPromiseConstructor.h&quot;
 102 #include &quot;JSInternalPromisePrototype.h&quot;
 103 #include &quot;JSLexicalEnvironment.h&quot;
 104 #include &quot;JSLock.h&quot;
 105 #include &quot;JSMap.h&quot;
 106 #include &quot;JSMicrotask.h&quot;
 107 #include &quot;JSModuleEnvironment.h&quot;
 108 #include &quot;JSModuleLoader.h&quot;
 109 #include &quot;JSModuleNamespaceObject.h&quot;
 110 #include &quot;JSModuleRecord.h&quot;
 111 #include &quot;JSNativeStdFunction.h&quot;
<span class="line-removed"> 112 #include &quot;JSNonDestructibleProxy.h&quot;</span>
 113 #include &quot;JSONObject.h&quot;
 114 #include &quot;JSPromise.h&quot;
 115 #include &quot;JSPromiseConstructor.h&quot;
 116 #include &quot;JSPromisePrototype.h&quot;
 117 #include &quot;JSSet.h&quot;
 118 #include &quot;JSStringIterator.h&quot;
 119 #include &quot;JSTypedArrayConstructors.h&quot;
 120 #include &quot;JSTypedArrayPrototypes.h&quot;
 121 #include &quot;JSTypedArrayViewConstructor.h&quot;
 122 #include &quot;JSTypedArrayViewPrototype.h&quot;
 123 #include &quot;JSTypedArrays.h&quot;
 124 #include &quot;JSWeakMap.h&quot;
 125 #include &quot;JSWeakObjectRef.h&quot;
 126 #include &quot;JSWeakSet.h&quot;
 127 #include &quot;JSWebAssembly.h&quot;
 128 #include &quot;JSWebAssemblyCompileError.h&quot;

 129 #include &quot;JSWebAssemblyInstance.h&quot;
 130 #include &quot;JSWebAssemblyLinkError.h&quot;
 131 #include &quot;JSWebAssemblyMemory.h&quot;
 132 #include &quot;JSWebAssemblyModule.h&quot;
 133 #include &quot;JSWebAssemblyRuntimeError.h&quot;
 134 #include &quot;JSWebAssemblyTable.h&quot;
 135 #include &quot;JSWithScope.h&quot;
 136 #include &quot;LazyClassStructureInlines.h&quot;
 137 #include &quot;LazyPropertyInlines.h&quot;

 138 #include &quot;Lookup.h&quot;
 139 #include &quot;MapConstructor.h&quot;
 140 #include &quot;MapIteratorPrototype.h&quot;
 141 #include &quot;MapPrototype.h&quot;
 142 #include &quot;MarkedSpaceInlines.h&quot;
 143 #include &quot;MathObject.h&quot;
 144 #include &quot;Microtask.h&quot;
 145 #include &quot;NativeErrorConstructor.h&quot;
 146 #include &quot;NativeErrorPrototype.h&quot;
 147 #include &quot;NullGetterFunction.h&quot;
 148 #include &quot;NullSetterFunction.h&quot;
 149 #include &quot;NumberConstructor.h&quot;
 150 #include &quot;NumberPrototype.h&quot;
 151 #include &quot;ObjCCallbackFunction.h&quot;
 152 #include &quot;ObjectConstructor.h&quot;
 153 #include &quot;ObjectPropertyChangeAdaptiveWatchpoint.h&quot;
 154 #include &quot;ObjectPropertyConditionSet.h&quot;
 155 #include &quot;ObjectPrototype.h&quot;
 156 #include &quot;ParserError.h&quot;
 157 #include &quot;ProxyConstructor.h&quot;
</pre>
<hr />
<pre>
 171 #include &quot;StrictEvalActivation.h&quot;
 172 #include &quot;StringConstructor.h&quot;
 173 #include &quot;StringIteratorPrototype.h&quot;
 174 #include &quot;StringPrototype.h&quot;
 175 #include &quot;Symbol.h&quot;
 176 #include &quot;SymbolConstructor.h&quot;
 177 #include &quot;SymbolObject.h&quot;
 178 #include &quot;SymbolPrototype.h&quot;
 179 #include &quot;VariableWriteFireDetail.h&quot;
 180 #include &quot;WasmCapabilities.h&quot;
 181 #include &quot;WeakGCMapInlines.h&quot;
 182 #include &quot;WeakMapConstructor.h&quot;
 183 #include &quot;WeakMapPrototype.h&quot;
 184 #include &quot;WeakObjectRefConstructor.h&quot;
 185 #include &quot;WeakObjectRefPrototype.h&quot;
 186 #include &quot;WeakSetConstructor.h&quot;
 187 #include &quot;WeakSetPrototype.h&quot;
 188 #include &quot;WebAssemblyCompileErrorConstructor.h&quot;
 189 #include &quot;WebAssemblyCompileErrorPrototype.h&quot;
 190 #include &quot;WebAssemblyFunction.h&quot;


 191 #include &quot;WebAssemblyInstanceConstructor.h&quot;
 192 #include &quot;WebAssemblyInstancePrototype.h&quot;
 193 #include &quot;WebAssemblyLinkErrorConstructor.h&quot;
 194 #include &quot;WebAssemblyLinkErrorPrototype.h&quot;
 195 #include &quot;WebAssemblyMemoryConstructor.h&quot;
 196 #include &quot;WebAssemblyMemoryPrototype.h&quot;
 197 #include &quot;WebAssemblyModuleConstructor.h&quot;
 198 #include &quot;WebAssemblyModulePrototype.h&quot;
 199 #include &quot;WebAssemblyModuleRecord.h&quot;
 200 #include &quot;WebAssemblyRuntimeErrorConstructor.h&quot;
 201 #include &quot;WebAssemblyRuntimeErrorPrototype.h&quot;
 202 #include &quot;WebAssemblyTableConstructor.h&quot;
 203 #include &quot;WebAssemblyTablePrototype.h&quot;
<span class="line-removed"> 204 #include &quot;WebAssemblyToJSCallee.h&quot;</span>
 205 #include &lt;wtf/RandomNumber.h&gt;
 206 
 207 #if ENABLE(INTL)
 208 #include &quot;IntlCollator.h&quot;
 209 #include &quot;IntlCollatorPrototype.h&quot;
 210 #include &quot;IntlDateTimeFormat.h&quot;
 211 #include &quot;IntlDateTimeFormatPrototype.h&quot;
 212 #include &quot;IntlNumberFormat.h&quot;
 213 #include &quot;IntlNumberFormatPrototype.h&quot;
 214 #include &quot;IntlObject.h&quot;
 215 #include &quot;IntlPluralRules.h&quot;
 216 #include &quot;IntlPluralRulesPrototype.h&quot;
<span class="line-removed"> 217 #include &lt;unicode/ucol.h&gt;</span>
<span class="line-removed"> 218 #include &lt;unicode/udat.h&gt;</span>
<span class="line-removed"> 219 #include &lt;unicode/unum.h&gt;</span>
 220 #endif // ENABLE(INTL)
 221 
 222 #if ENABLE(REMOTE_INSPECTOR)
 223 #include &quot;JSGlobalObjectDebuggable.h&quot;
 224 #include &quot;JSGlobalObjectInspectorController.h&quot;
 225 #endif
 226 
 227 #ifdef JSC_GLIB_API_ENABLED
 228 #include &quot;JSCCallbackFunction.h&quot;
 229 #include &quot;JSCWrapperMap.h&quot;
 230 #endif
 231 
 232 namespace JSC {
 233 
 234 #define CHECK_FEATURE_FLAG_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 235 static_assert(std::is_same_v&lt;std::remove_cv_t&lt;decltype(featureFlag)&gt;, bool&gt; || std::is_same_v&lt;std::remove_cv_t&lt;decltype(featureFlag)&gt;, bool&amp;&gt;);
 236 
 237 FOR_EACH_SIMPLE_BUILTIN_TYPE(CHECK_FEATURE_FLAG_TYPE)
 238 FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(CHECK_FEATURE_FLAG_TYPE)
 239 FOR_EACH_LAZY_BUILTIN_TYPE(CHECK_FEATURE_FLAG_TYPE)
</pre>
<hr />
<pre>
 248 {
 249     JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);
 250     return JSONObject::create(vm, JSONObject::createStructure(vm, global, global-&gt;objectPrototype()));
 251 }
 252 
 253 static JSValue createMathProperty(VM&amp; vm, JSObject* object)
 254 {
 255     JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);
 256     return MathObject::create(vm, global, MathObject::createStructure(vm, global, global-&gt;objectPrototype()));
 257 }
 258 
 259 static JSValue createReflectProperty(VM&amp; vm, JSObject* object)
 260 {
 261     JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);
 262     return ReflectObject::create(vm, global, ReflectObject::createStructure(vm, global, global-&gt;objectPrototype()));
 263 }
 264 
 265 static JSValue createConsoleProperty(VM&amp; vm, JSObject* object)
 266 {
 267     JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);
<span class="line-modified"> 268     return ConsoleObject::create(vm, global, ConsoleObject::createStructure(vm, global, constructEmptyObject(global-&gt;globalExec())));</span>
 269 }
 270 
<span class="line-modified"> 271 static EncodedJSValue JSC_HOST_CALL makeBoundFunction(ExecState* exec)</span>
 272 {
<span class="line-modified"> 273     VM&amp; vm = exec-&gt;vm();</span>
 274     auto scope = DECLARE_THROW_SCOPE(vm);
 275 
<span class="line-modified"> 276     JSGlobalObject* globalObject = exec-&gt;lexicalGlobalObject();</span>
<span class="line-modified"> 277 </span>
<span class="line-modified"> 278     JSObject* target = asObject(exec-&gt;uncheckedArgument(0));</span>
<span class="line-modified"> 279     JSValue boundThis = exec-&gt;uncheckedArgument(1);</span>
<span class="line-modified"> 280     JSValue boundArgs = exec-&gt;uncheckedArgument(2);</span>
<span class="line-removed"> 281     JSValue lengthValue = exec-&gt;uncheckedArgument(3);</span>
<span class="line-removed"> 282     JSString* nameString = asString(exec-&gt;uncheckedArgument(4));</span>
 283 
 284     ASSERT(lengthValue.isInt32AsAnyInt());
 285     int32_t length = lengthValue.asInt32AsAnyInt();
 286 
<span class="line-modified"> 287     String name = nameString-&gt;value(exec);</span>
<span class="line-removed"> 288     RETURN_IF_EXCEPTION(scope, { });</span>
<span class="line-removed"> 289 </span>
<span class="line-removed"> 290     RELEASE_AND_RETURN(scope, JSValue::encode(JSBoundFunction::create(vm, exec, globalObject, target, boundThis, boundArgs.isCell() ? jsCast&lt;JSArray*&gt;(boundArgs) : nullptr, length, WTFMove(name))));</span>
 291 }
 292 
<span class="line-modified"> 293 static EncodedJSValue JSC_HOST_CALL hasOwnLengthProperty(ExecState* exec)</span>
 294 {
<span class="line-modified"> 295     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-modified"> 296     JSObject* target = asObject(exec-&gt;uncheckedArgument(0));</span>
<span class="line-modified"> 297     return JSValue::encode(jsBoolean(target-&gt;hasOwnProperty(exec, vm.propertyNames-&gt;length)));</span>




 298 }
 299 
<span class="line-modified"> 300 #if !ASSERT_DISABLED</span>
<span class="line-modified"> 301 static EncodedJSValue JSC_HOST_CALL assertCall(ExecState* exec)</span>
 302 {
<span class="line-modified"> 303     RELEASE_ASSERT(exec-&gt;argument(0).isBoolean());</span>
<span class="line-modified"> 304     if (exec-&gt;argument(0).asBoolean())</span>
 305         return JSValue::encode(jsUndefined());
 306 
 307     bool iteratedOnce = false;
 308     CodeBlock* codeBlock = nullptr;
 309     unsigned line;
<span class="line-modified"> 310     exec-&gt;iterate([&amp;] (StackVisitor&amp; visitor) {</span>
 311         if (!iteratedOnce) {
 312             iteratedOnce = true;
 313             return StackVisitor::Continue;
 314         }
 315 
 316         RELEASE_ASSERT(visitor-&gt;hasLineAndColumnInfo());
 317         unsigned column;
 318         visitor-&gt;computeLineAndColumn(line, column);
 319         codeBlock = visitor-&gt;codeBlock();
 320         return StackVisitor::Done;
 321     });
 322     RELEASE_ASSERT(!!codeBlock);
 323     RELEASE_ASSERT_WITH_MESSAGE(false, &quot;JS assertion failed at line %u in:\n%s\n&quot;, line, codeBlock-&gt;sourceCodeForTools().data());
 324     return JSValue::encode(jsUndefined());
 325 }
<span class="line-modified"> 326 #endif</span>
 327 
 328 } // namespace JSC
 329 
 330 #include &quot;JSGlobalObject.lut.h&quot;
 331 
 332 namespace JSC {
 333 
 334 const ClassInfo JSGlobalObject::s_info = { &quot;GlobalObject&quot;, &amp;Base::s_info, &amp;globalObjectTable, nullptr, CREATE_METHOD_TABLE(JSGlobalObject) };
 335 
 336 const GlobalObjectMethodTable JSGlobalObject::s_globalObjectMethodTable = {
 337     &amp;supportsRichSourceInfo,
 338     &amp;shouldInterruptScript,
 339     &amp;javaScriptRuntimeFlags,
 340     nullptr, // queueTaskToEventLoop
 341     &amp;shouldInterruptScriptBeforeTimeout,
 342     nullptr, // moduleLoaderImportModule
 343     nullptr, // moduleLoaderResolve
 344     nullptr, // moduleLoaderFetch
 345     nullptr, // moduleLoaderCreateImportMetaProperties
 346     nullptr, // moduleLoaderEvaluate
</pre>
<hr />
<pre>
 372   TypeError             JSGlobalObject::m_typeErrorStructure         DontEnum|ClassStructure
 373   URIError              JSGlobalObject::m_URIErrorStructure          DontEnum|ClassStructure
 374   Proxy                 createProxyProperty                          DontEnum|PropertyCallback
 375   Reflect               createReflectProperty                        DontEnum|PropertyCallback
 376   JSON                  createJSONProperty                           DontEnum|PropertyCallback
 377   Math                  createMathProperty                           DontEnum|PropertyCallback
 378   console               createConsoleProperty                        DontEnum|PropertyCallback
 379   Int8Array             JSGlobalObject::m_typedArrayInt8             DontEnum|ClassStructure
 380   Int16Array            JSGlobalObject::m_typedArrayInt16            DontEnum|ClassStructure
 381   Int32Array            JSGlobalObject::m_typedArrayInt32            DontEnum|ClassStructure
 382   Uint8Array            JSGlobalObject::m_typedArrayUint8            DontEnum|ClassStructure
 383   Uint8ClampedArray     JSGlobalObject::m_typedArrayUint8Clamped     DontEnum|ClassStructure
 384   Uint16Array           JSGlobalObject::m_typedArrayUint16           DontEnum|ClassStructure
 385   Uint32Array           JSGlobalObject::m_typedArrayUint32           DontEnum|ClassStructure
 386   Float32Array          JSGlobalObject::m_typedArrayFloat32          DontEnum|ClassStructure
 387   Float64Array          JSGlobalObject::m_typedArrayFloat64          DontEnum|ClassStructure
 388   DataView              JSGlobalObject::m_typedArrayDataView         DontEnum|ClassStructure
 389   Date                  JSGlobalObject::m_dateStructure              DontEnum|ClassStructure
 390   Error                 JSGlobalObject::m_errorStructure             DontEnum|ClassStructure
 391   Boolean               JSGlobalObject::m_booleanObjectStructure     DontEnum|ClassStructure

 392   Number                JSGlobalObject::m_numberObjectStructure      DontEnum|ClassStructure

 393   Symbol                JSGlobalObject::m_symbolObjectStructure      DontEnum|ClassStructure
 394   WeakMap               JSGlobalObject::m_weakMapStructure           DontEnum|ClassStructure
 395   WeakSet               JSGlobalObject::m_weakSetStructure           DontEnum|ClassStructure
 396 @end
 397 */
 398 
<span class="line-modified"> 399 static EncodedJSValue JSC_HOST_CALL enqueueJob(ExecState* exec)</span>
 400 {
<span class="line-modified"> 401     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-removed"> 402     JSGlobalObject* globalObject = exec-&gt;lexicalGlobalObject();</span>
 403 
<span class="line-modified"> 404     JSValue job = exec-&gt;argument(0);</span>
<span class="line-modified"> 405     JSValue arguments = exec-&gt;argument(1);</span>
<span class="line-modified"> 406     ASSERT(arguments.inherits&lt;JSArray&gt;(vm));</span>

 407 
<span class="line-modified"> 408     globalObject-&gt;queueMicrotask(createJSMicrotask(vm, job, jsCast&lt;JSArray*&gt;(arguments)));</span>
 409 
 410     return JSValue::encode(jsUndefined());
 411 }
 412 
 413 JSGlobalObject::JSGlobalObject(VM&amp; vm, Structure* structure, const GlobalObjectMethodTable* globalObjectMethodTable)
 414     : Base(vm, structure, 0)
<span class="line-modified"> 415     , m_vm(vm)</span>

 416     , m_masqueradesAsUndefinedWatchpoint(adoptRef(new WatchpointSet(IsWatched)))
 417     , m_havingABadTimeWatchpoint(adoptRef(new WatchpointSet(IsWatched)))
 418     , m_varInjectionWatchpoint(adoptRef(new WatchpointSet(IsWatched)))
 419     , m_weakRandom(Options::forceWeakRandomSeed() ? Options::forcedWeakRandomSeed() : static_cast&lt;unsigned&gt;(randomNumber() * (std::numeric_limits&lt;unsigned&gt;::max() + 1.0)))
 420     , m_arrayIteratorProtocolWatchpointSet(IsWatched)
 421     , m_mapIteratorProtocolWatchpointSet(IsWatched)
 422     , m_setIteratorProtocolWatchpointSet(IsWatched)
 423     , m_stringIteratorProtocolWatchpointSet(IsWatched)
 424     , m_mapSetWatchpointSet(IsWatched)
 425     , m_setAddWatchpointSet(IsWatched)
 426     , m_arraySpeciesWatchpointSet(ClearWatchpoint)
 427     , m_arrayJoinWatchpointSet(IsWatched)
 428     , m_numberToStringWatchpointSet(IsWatched)
 429     , m_runtimeFlags()
 430     , m_stackTraceLimit(Options::defaultErrorStackTraceLimit())
 431     , m_globalObjectMethodTable(globalObjectMethodTable ? globalObjectMethodTable : &amp;s_globalObjectMethodTable)
 432 {
 433 }
 434 
 435 JSGlobalObject::~JSGlobalObject()
 436 {
 437 #if ENABLE(REMOTE_INSPECTOR)
 438     m_inspectorController-&gt;globalObjectDestroyed();
 439 #endif
 440 
 441     if (m_debugger)
 442         m_debugger-&gt;detach(this, Debugger::GlobalObjectIsDestructing);
 443 }
 444 
 445 void JSGlobalObject::destroy(JSCell* cell)
 446 {
 447     static_cast&lt;JSGlobalObject*&gt;(cell)-&gt;JSGlobalObject::~JSGlobalObject();
 448 }
 449 
 450 void JSGlobalObject::setGlobalThis(VM&amp; vm, JSObject* globalThis)
 451 {
 452     m_globalThis.set(vm, this, globalThis);
 453 }
 454 
<span class="line-modified"> 455 static JSObject* getGetterById(ExecState* exec, JSObject* base, const Identifier&amp; ident)</span>
 456 {
 457     JSValue baseValue = JSValue(base);
 458     PropertySlot slot(baseValue, PropertySlot::InternalMethodType::VMInquiry);
<span class="line-modified"> 459     baseValue.getPropertySlot(exec, ident, slot);</span>
<span class="line-modified"> 460     return slot.getPureResult().toObject(exec);</span>























 461 }
 462 
 463 template&lt;ErrorType errorType&gt;
 464 void JSGlobalObject::initializeErrorConstructor(LazyClassStructure::Initializer&amp; init)
 465 {
 466     init.setPrototype(NativeErrorPrototype::create(init.vm, NativeErrorPrototype::createStructure(init.vm, this, m_errorStructure.prototype(this)), errorTypeName(errorType)));
 467     init.setStructure(ErrorInstance::createStructure(init.vm, this, init.prototype));
 468     init.setConstructor(NativeErrorConstructor&lt;errorType&gt;::create(init.vm, NativeErrorConstructor&lt;errorType&gt;::createStructure(init.vm, this, m_errorStructure.constructor(this)), jsCast&lt;NativeErrorPrototype*&gt;(init.prototype)));
 469 }
 470 
 471 void JSGlobalObject::init(VM&amp; vm)
 472 {
 473     ASSERT(vm.currentThreadIsHoldingAPILock());
 474     auto catchScope = DECLARE_CATCH_SCOPE(vm);
 475 
 476     Base::setStructure(vm, Structure::toCacheableDictionaryTransition(vm, structure(vm)));
 477 
 478     m_debugger = 0;
 479 
 480 #if ENABLE(REMOTE_INSPECTOR)
 481     m_inspectorController = makeUnique&lt;Inspector::JSGlobalObjectInspectorController&gt;(*this);
 482     m_inspectorDebuggable = makeUnique&lt;JSGlobalObjectDebuggable&gt;(*this);
 483     m_inspectorDebuggable-&gt;init();
 484     m_consoleClient = m_inspectorController-&gt;consoleClient();
 485 #endif
 486 
 487     m_functionPrototype.set(vm, this, FunctionPrototype::create(vm, FunctionPrototype::createStructure(vm, this, jsNull()))); // The real prototype will be set once ObjectPrototype is created.
 488     m_calleeStructure.set(vm, this, JSCallee::createStructure(vm, this, jsNull()));
 489 
 490     m_globalLexicalEnvironment.set(vm, this, JSGlobalLexicalEnvironment::create(vm, JSGlobalLexicalEnvironment::createStructure(vm, this), this));

 491     // Need to create the callee structure (above) before creating the callee.
 492     JSCallee* globalCallee = JSCallee::create(vm, this, globalScope());
 493     m_globalCallee.set(vm, this, globalCallee);
 494 
<span class="line-modified"> 495     ExecState::initGlobalExec(JSGlobalObject::globalExec(), globalCallee);</span>
<span class="line-removed"> 496     ExecState* exec = JSGlobalObject::globalExec();</span>
 497 
 498     JSCallee* stackOverflowFrameCallee = JSCallee::create(vm, this, globalScope());
 499     m_stackOverflowFrameCallee.set(vm, this, stackOverflowFrameCallee);
 500 
 501     m_hostFunctionStructure.set(vm, this, JSFunction::createStructure(vm, this, m_functionPrototype.get()));
 502 
 503     auto initFunctionStructures = [&amp;] (FunctionStructures&amp; structures) {
 504         structures.strictFunctionStructure.set(vm, this, JSStrictFunction::createStructure(vm, this, m_functionPrototype.get()));
 505         structures.sloppyFunctionStructure.set(vm, this, JSSloppyFunction::createStructure(vm, this, m_functionPrototype.get()));
 506         structures.arrowFunctionStructure.set(vm, this, JSArrowFunction::createStructure(vm, this, m_functionPrototype.get()));
 507     };
 508     initFunctionStructures(m_builtinFunctions);
 509     initFunctionStructures(m_ordinaryFunctions);
 510 
 511     m_customGetterSetterFunctionStructure.initLater(
 512         [] (const Initializer&lt;Structure&gt;&amp; init) {
 513             init.set(JSCustomGetterSetterFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 514         });
 515     m_boundFunctionStructure.initLater(
 516         [] (const Initializer&lt;Structure&gt;&amp; init) {
 517             init.set(JSBoundFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 518         });
<span class="line-removed"> 519     m_getterSetterStructure.set(vm, this, GetterSetter::createStructure(vm, this, jsNull()));</span>
 520     m_nativeStdFunctionStructure.initLater(
 521         [] (const Initializer&lt;Structure&gt;&amp; init) {
 522             init.set(JSNativeStdFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 523         });
 524     JSFunction* callFunction = nullptr;
 525     JSFunction* applyFunction = nullptr;
 526     JSFunction* hasInstanceSymbolFunction = nullptr;
 527     m_functionPrototype-&gt;addFunctionProperties(vm, this, &amp;callFunction, &amp;applyFunction, &amp;hasInstanceSymbolFunction);
<span class="line-removed"> 528     m_callFunction.set(vm, this, callFunction);</span>
<span class="line-removed"> 529     m_applyFunction.set(vm, this, applyFunction);</span>
 530     m_arrayProtoToStringFunction.initLater(
 531         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
 532             init.set(JSFunction::create(init.vm, init.owner, 0, init.vm.propertyNames-&gt;toString.string(), arrayProtoFuncToString, NoIntrinsic));
 533         });
 534     m_arrayProtoValuesFunction.initLater(
 535         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
<span class="line-modified"> 536             init.set(JSFunction::create(init.vm, arrayPrototypeValuesCodeGenerator(init.vm), init.owner));</span>
<span class="line-removed"> 537         });</span>
<span class="line-removed"> 538     m_initializePromiseFunction.initLater(</span>
<span class="line-removed"> 539         [] (const Initializer&lt;JSFunction&gt;&amp; init) {</span>
<span class="line-removed"> 540             init.set(JSFunction::create(init.vm, promiseOperationsInitializePromiseCodeGenerator(init.vm), init.owner));</span>
 541         });
 542 
 543     m_iteratorProtocolFunction.initLater(
 544         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
 545             init.set(JSFunction::create(init.vm, iteratorHelpersPerformIterationCodeGenerator(init.vm), init.owner));
 546         });
 547 
 548     m_promiseResolveFunction.initLater(
 549         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
 550             init.set(JSFunction::create(init.vm, promiseConstructorResolveCodeGenerator(init.vm), init.owner));
 551         });
 552 
<span class="line-modified"> 553     m_newPromiseCapabilityFunction.set(vm, this, JSFunction::create(vm, promiseOperationsNewPromiseCapabilityCodeGenerator(vm), this));</span>




 554     m_functionProtoHasInstanceSymbolFunction.set(vm, this, hasInstanceSymbolFunction);
 555     m_throwTypeErrorGetterSetter.initLater(
 556         [] (const Initializer&lt;GetterSetter&gt;&amp; init) {
 557             JSFunction* thrower = init.owner-&gt;throwTypeErrorFunction();
 558             GetterSetter* getterSetter = GetterSetter::create(init.vm, init.owner, thrower, thrower);
 559             init.set(getterSetter);
 560         });
 561 
 562     m_nullGetterFunction.set(vm, this, NullGetterFunction::create(vm, NullGetterFunction::createStructure(vm, this, m_functionPrototype.get())));
 563     m_nullSetterFunction.set(vm, this, NullSetterFunction::create(vm, NullSetterFunction::createStructure(vm, this, m_functionPrototype.get())));
 564     m_objectPrototype.set(vm, this, ObjectPrototype::create(vm, this, ObjectPrototype::createStructure(vm, this, jsNull())));
 565     // We have to manually set this here because we make it a prototype without transition below.
 566     m_objectPrototype.get()-&gt;didBecomePrototype();
 567     GetterSetter* protoAccessor = GetterSetter::create(vm, this,
 568         JSFunction::create(vm, this, 0, makeString(&quot;get &quot;, vm.propertyNames-&gt;underscoreProto.string()), globalFuncProtoGetter, UnderscoreProtoIntrinsic),
 569         JSFunction::create(vm, this, 0, makeString(&quot;set &quot;, vm.propertyNames-&gt;underscoreProto.string()), globalFuncProtoSetter));
 570     m_objectPrototype-&gt;putDirectNonIndexAccessorWithoutTransition(vm, vm.propertyNames-&gt;underscoreProto, protoAccessor, PropertyAttribute::Accessor | PropertyAttribute::DontEnum);
 571     m_functionPrototype-&gt;structure(vm)-&gt;setPrototypeWithoutTransition(vm, m_objectPrototype.get());
 572     m_objectStructureForObjectConstructor.set(vm, this, vm.structureCache.emptyObjectStructureForPrototype(this, m_objectPrototype.get(), JSFinalObject::defaultInlineCapacity()));
 573     m_objectProtoValueOfFunction.set(vm, this, jsCast&lt;JSFunction*&gt;(objectPrototype()-&gt;getDirect(vm, vm.propertyNames-&gt;valueOf)));
</pre>
<hr />
<pre>
 584         [] (const Initializer&lt;JSTypedArrayViewPrototype&gt;&amp; init) {
 585             init.set(JSTypedArrayViewPrototype::create(init.vm, init.owner, JSTypedArrayViewPrototype::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get())));
 586 
 587             // Make sure that the constructor gets initialized, too.
 588             init.owner-&gt;m_typedArraySuperConstructor.get(init.owner);
 589         });
 590     m_typedArraySuperConstructor.initLater(
 591         [] (const Initializer&lt;JSTypedArrayViewConstructor&gt;&amp; init) {
 592             JSTypedArrayViewPrototype* prototype = init.owner-&gt;m_typedArrayProto.get(init.owner);
 593             JSTypedArrayViewConstructor* constructor = JSTypedArrayViewConstructor::create(init.vm, init.owner, JSTypedArrayViewConstructor::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()), prototype, init.owner-&gt;m_speciesGetterSetter.get());
 594             prototype-&gt;putDirectWithoutTransition(init.vm, init.vm.propertyNames-&gt;constructor, constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 595             init.set(constructor);
 596         });
 597 
 598 #define INIT_TYPED_ARRAY_LATER(type) \
 599     m_typedArray ## type.initLater( \
 600         [] (LazyClassStructure::Initializer&amp; init) { \
 601             init.setPrototype(JS ## type ## ArrayPrototype::create(init.vm, init.global, JS ## type ## ArrayPrototype::createStructure(init.vm, init.global, init.global-&gt;m_typedArrayProto.get(init.global)))); \
 602             init.setStructure(JS ## type ## Array::createStructure(init.vm, init.global, init.prototype)); \
 603             init.setConstructor(JS ## type ## ArrayConstructor::create(init.vm, init.global, JS ## type ## ArrayConstructor::createStructure(init.vm, init.global, init.global-&gt;m_typedArraySuperConstructor.get(init.global)), init.prototype, #type &quot;Array&quot;_s, typedArrayConstructorAllocate ## type ## ArrayCodeGenerator(init.vm))); \
<span class="line-modified"> 604             init.global-&gt;putDirectWithoutTransition(init.vm, init.vm.propertyNames-&gt;builtinNames().type ## ArrayPrivateName(), init.constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum)); \</span>
 605         });
 606     FOR_EACH_TYPED_ARRAY_TYPE_EXCLUDING_DATA_VIEW(INIT_TYPED_ARRAY_LATER)
 607 #undef INIT_TYPED_ARRAY_LATER
 608 
 609     m_typedArrayDataView.initLater(
 610         [] (LazyClassStructure::Initializer&amp; init) {
 611             init.setPrototype(JSDataViewPrototype::create(init.vm, JSDataViewPrototype::createStructure(init.vm, init.global, init.global-&gt;m_objectPrototype.get())));
 612             init.setStructure(JSDataView::createStructure(init.vm, init.global, init.prototype));
 613             init.setConstructor(JSDataViewConstructor::create(init.vm, init.global, JSDataViewConstructor::createStructure(init.vm, init.global, init.global-&gt;m_functionPrototype.get()), init.prototype, &quot;DataView&quot;_s, nullptr));
 614         });
 615 
 616     m_lexicalEnvironmentStructure.set(vm, this, JSLexicalEnvironment::createStructure(vm, this));
 617     m_moduleEnvironmentStructure.initLater(
 618         [] (const Initializer&lt;Structure&gt;&amp; init) {
 619             init.set(JSModuleEnvironment::createStructure(init.vm, init.owner));
 620         });
 621     m_strictEvalActivationStructure.initLater(
 622         [] (const Initializer&lt;Structure&gt;&amp; init) {
 623             init.set(StrictEvalActivation::createStructure(init.vm, init.owner, jsNull()));
 624         });
</pre>
<hr />
<pre>
 629     m_withScopeStructure.initLater(
 630         [] (const Initializer&lt;Structure&gt;&amp; init) {
 631             init.set(JSWithScope::createStructure(init.vm, init.owner, jsNull()));
 632         });
 633 
 634     m_nullPrototypeObjectStructure.set(vm, this, JSFinalObject::createStructure(vm, this, jsNull(), JSFinalObject::defaultInlineCapacity()));
 635 
 636     m_callbackFunctionStructure.initLater(
 637         [] (const Initializer&lt;Structure&gt;&amp; init) {
 638             init.set(JSCallbackFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 639         });
 640     m_directArgumentsStructure.set(vm, this, DirectArguments::createStructure(vm, this, m_objectPrototype.get()));
 641     m_scopedArgumentsStructure.set(vm, this, ScopedArguments::createStructure(vm, this, m_objectPrototype.get()));
 642     m_clonedArgumentsStructure.set(vm, this, ClonedArguments::createStructure(vm, this, m_objectPrototype.get()));
 643     m_callbackConstructorStructure.initLater(
 644         [] (const Initializer&lt;Structure&gt;&amp; init) {
 645             init.set(JSCallbackConstructor::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get()));
 646         });
 647     m_callbackObjectStructure.initLater(
 648         [] (const Initializer&lt;Structure&gt;&amp; init) {
<span class="line-modified"> 649             init.set(JSCallbackObject&lt;JSDestructibleObject&gt;::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get()));</span>
 650         });
 651 
 652 #if JSC_OBJC_API_ENABLED
 653     m_objcCallbackFunctionStructure.initLater(
 654         [] (const Initializer&lt;Structure&gt;&amp; init) {
 655             init.set(ObjCCallbackFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 656         });
 657     m_objcWrapperObjectStructure.initLater(
 658         [] (const Initializer&lt;Structure&gt;&amp; init) {
 659             init.set(JSCallbackObject&lt;JSAPIWrapperObject&gt;::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get()));
 660         });
 661 #endif
 662 #ifdef JSC_GLIB_API_ENABLED
 663     m_glibCallbackFunctionStructure.initLater(
 664         [] (const Initializer&lt;Structure&gt;&amp; init) {
 665             init.set(JSCCallbackFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 666         });
 667     m_glibWrapperObjectStructure.initLater(
 668         [] (const Initializer&lt;Structure&gt;&amp; init) {
 669             init.set(JSCallbackObject&lt;JSAPIWrapperObject&gt;::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get()));
 670         });
 671 #endif
 672     m_arrayPrototype.set(vm, this, ArrayPrototype::create(vm, this, ArrayPrototype::createStructure(vm, this, m_objectPrototype.get())));
 673 
 674     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(UndecidedShape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithUndecided));
 675     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(Int32Shape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithInt32));
 676     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(DoubleShape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithDouble));
 677     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(ContiguousShape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithContiguous));
 678     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(ArrayStorageShape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithArrayStorage));
 679     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(SlowPutArrayStorageShape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithSlowPutArrayStorage));
 680     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(CopyOnWriteArrayWithInt32)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), CopyOnWriteArrayWithInt32));
 681     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(CopyOnWriteArrayWithDouble)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), CopyOnWriteArrayWithDouble));
 682     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(CopyOnWriteArrayWithContiguous)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), CopyOnWriteArrayWithContiguous));
 683     for (unsigned i = 0; i &lt; NumberOfArrayIndexingModes; ++i)
 684         m_arrayStructureForIndexingShapeDuringAllocation[i] = m_originalArrayStructureForIndexingShape[i];
 685 
 686     m_regExpPrototype.set(vm, this, RegExpPrototype::create(vm, this, RegExpPrototype::createStructure(vm, this, m_objectPrototype.get())));
 687     m_regExpStructure.set(vm, this, RegExpObject::createStructure(vm, this, m_regExpPrototype.get()));
 688     m_regExpMatchesArrayStructure.set(vm, this, createRegExpMatchesArrayStructure(vm, this));
<span class="line-removed"> 689     m_regExpMatchesArrayWithGroupsStructure.set(vm, this, createRegExpMatchesArrayWithGroupsStructure(vm, this));</span>
 690 
 691     m_moduleRecordStructure.initLater(
 692         [] (const Initializer&lt;Structure&gt;&amp; init) {
 693             init.set(JSModuleRecord::createStructure(init.vm, init.owner, jsNull()));
 694         });
 695     m_moduleNamespaceObjectStructure.initLater(
 696         [] (const Initializer&lt;Structure&gt;&amp; init) {
 697             init.set(JSModuleNamespaceObject::createStructure(init.vm, init.owner, jsNull()));
 698         });
 699     m_proxyObjectStructure.initLater(
 700         [] (const Initializer&lt;Structure&gt;&amp; init) {
 701             bool isCallable = false;
 702             init.set(ProxyObject::createStructure(init.vm, init.owner, jsNull(), isCallable));
 703         });
 704     m_callableProxyObjectStructure.initLater(
 705         [] (const Initializer&lt;Structure&gt;&amp; init) {
 706             bool isCallable = true;
 707             init.set(ProxyObject::createStructure(init.vm, init.owner, jsNull(), isCallable));
 708         });
 709     m_proxyRevokeStructure.initLater(
</pre>
<hr />
<pre>
 714     m_parseIntFunction.initLater(
 715         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
 716             init.set(JSFunction::create(init.vm, init.owner, 2, init.vm.propertyNames-&gt;parseInt.string(), globalFuncParseInt, ParseIntIntrinsic));
 717         });
 718     m_parseFloatFunction.initLater(
 719         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
 720             init.set(JSFunction::create(init.vm, init.owner, 1, init.vm.propertyNames-&gt;parseFloat.string(), globalFuncParseFloat, NoIntrinsic));
 721         });
 722 
 723 #if ENABLE(SHARED_ARRAY_BUFFER)
 724     m_sharedArrayBufferPrototype.set(vm, this, JSArrayBufferPrototype::create(vm, this, JSArrayBufferPrototype::createStructure(vm, this, m_objectPrototype.get()), ArrayBufferSharingMode::Shared));
 725     m_sharedArrayBufferStructure.set(vm, this, JSArrayBuffer::createStructure(vm, this, m_sharedArrayBufferPrototype.get()));
 726 #endif
 727 
 728     m_iteratorPrototype.set(vm, this, IteratorPrototype::create(vm, this, IteratorPrototype::createStructure(vm, this, m_objectPrototype.get())));
 729     m_asyncIteratorPrototype.set(vm, this, AsyncIteratorPrototype::create(vm, this, AsyncIteratorPrototype::createStructure(vm, this, m_objectPrototype.get())));
 730 
 731     m_generatorPrototype.set(vm, this, GeneratorPrototype::create(vm, this, GeneratorPrototype::createStructure(vm, this, m_iteratorPrototype.get())));
 732     m_asyncGeneratorPrototype.set(vm, this, AsyncGeneratorPrototype::create(vm, this, AsyncGeneratorPrototype::createStructure(vm, this, m_asyncIteratorPrototype.get())));
 733 







 734 #define CREATE_PROTOTYPE_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) { \
 735         m_ ## lowerName ## Prototype.set(vm, this, capitalName##Prototype::create(vm, this, capitalName##Prototype::createStructure(vm, this, m_ ## prototypeBase ## Prototype.get()))); \
 736         m_ ## properName ## Structure.set(vm, this, instanceType::createStructure(vm, this, m_ ## lowerName ## Prototype.get())); \
 737     }
 738 
 739     FOR_EACH_SIMPLE_BUILTIN_TYPE(CREATE_PROTOTYPE_FOR_SIMPLE_TYPE)
 740     FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(CREATE_PROTOTYPE_FOR_SIMPLE_TYPE)
 741 
 742 #undef CREATE_PROTOTYPE_FOR_SIMPLE_TYPE
 743 
 744 #define CREATE_PROTOTYPE_FOR_LAZY_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) {  \
 745     m_ ## properName ## Structure.initLater(\
 746         [] (LazyClassStructure::Initializer&amp; init) { \
 747             init.setPrototype(capitalName##Prototype::create(init.vm, init.global, capitalName##Prototype::createStructure(init.vm, init.global, init.global-&gt;m_ ## prototypeBase ## Prototype.get()))); \
 748             init.setStructure(instanceType::createStructure(init.vm, init.global, init.prototype)); \
 749             init.setConstructor(capitalName ## Constructor::create(init.vm, capitalName ## Constructor::createStructure(init.vm, init.global, init.global-&gt;m_functionPrototype.get()), jsCast&lt;capitalName ## Prototype*&gt;(init.prototype), init.global-&gt;m_speciesGetterSetter.get())); \
 750         }); \
 751     }
 752 
 753     FOR_EACH_LAZY_BUILTIN_TYPE(CREATE_PROTOTYPE_FOR_LAZY_TYPE)
 754 
 755     // Constructors
 756 
 757     ObjectConstructor* objectConstructor = ObjectConstructor::create(vm, this, ObjectConstructor::createStructure(vm, this, m_functionPrototype.get()), m_objectPrototype.get());
 758     m_objectConstructor.set(vm, this, objectConstructor);

 759 
 760     JSFunction* throwTypeErrorFunction = JSFunction::create(vm, this, 0, String(), globalFuncThrowTypeError);
<span class="line-modified"> 761     m_throwTypeErrorFunction.set(vm, this, throwTypeErrorFunction);</span>
 762 
<span class="line-modified"> 763     JSCell* functionConstructor = FunctionConstructor::create(vm, FunctionConstructor::createStructure(vm, this, m_functionPrototype.get()), m_functionPrototype.get());</span>

 764 
 765     ArrayConstructor* arrayConstructor = ArrayConstructor::create(vm, this, ArrayConstructor::createStructure(vm, this, m_functionPrototype.get()), m_arrayPrototype.get(), m_speciesGetterSetter.get());
 766     m_arrayConstructor.set(vm, this, arrayConstructor);

 767 
 768     RegExpConstructor* regExpConstructor = RegExpConstructor::create(vm, RegExpConstructor::createStructure(vm, this, m_functionPrototype.get()), m_regExpPrototype.get(), m_speciesGetterSetter.get());


 769     m_regExpGlobalData.cachedResult().record(vm, this, nullptr, jsEmptyString(vm), MatchResult(0, 0));
 770 
 771 #if ENABLE(SHARED_ARRAY_BUFFER)
 772     JSSharedArrayBufferConstructor* sharedArrayBufferConstructor = nullptr;
 773     sharedArrayBufferConstructor = JSSharedArrayBufferConstructor::create(vm, JSSharedArrayBufferConstructor::createStructure(vm, this, m_functionPrototype.get()), m_sharedArrayBufferPrototype.get(), m_speciesGetterSetter.get());
 774     m_sharedArrayBufferPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, sharedArrayBufferConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 775 
 776     AtomicsObject* atomicsObject = AtomicsObject::create(vm, this, AtomicsObject::createStructure(vm, this, m_objectPrototype.get()));
 777 #endif
 778 
 779 #define CREATE_CONSTRUCTOR_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 780 capitalName ## Constructor* lowerName ## Constructor = featureFlag ? capitalName ## Constructor::create(vm, capitalName ## Constructor::createStructure(vm, this, m_functionPrototype.get()), m_ ## lowerName ## Prototype.get(), m_speciesGetterSetter.get()) : nullptr; \
 781     if (featureFlag) \
 782         m_ ## lowerName ## Prototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, lowerName ## Constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum)); \
 783 
 784     FOR_EACH_SIMPLE_BUILTIN_TYPE(CREATE_CONSTRUCTOR_FOR_SIMPLE_TYPE)
 785 
 786 #undef CREATE_CONSTRUCTOR_FOR_SIMPLE_TYPE
 787 
 788     m_promiseConstructor.set(vm, this, promiseConstructor);
 789     m_internalPromiseConstructor.set(vm, this, internalPromiseConstructor);


 790 
 791     m_evalErrorStructure.initLater(
 792         [] (LazyClassStructure::Initializer&amp; init) {
 793             init.global-&gt;initializeErrorConstructor&lt;ErrorType::EvalError&gt;(init);
 794         });
 795     m_rangeErrorStructure.initLater(
 796         [] (LazyClassStructure::Initializer&amp; init) {
 797             init.global-&gt;initializeErrorConstructor&lt;ErrorType::RangeError&gt;(init);
 798         });
 799     m_referenceErrorStructure.initLater(
 800         [] (LazyClassStructure::Initializer&amp; init) {
 801             init.global-&gt;initializeErrorConstructor&lt;ErrorType::ReferenceError&gt;(init);
 802         });
 803     m_syntaxErrorStructure.initLater(
 804         [] (LazyClassStructure::Initializer&amp; init) {
 805             init.global-&gt;initializeErrorConstructor&lt;ErrorType::SyntaxError&gt;(init);
 806         });
 807     m_typeErrorStructure.initLater(
 808         [] (LazyClassStructure::Initializer&amp; init) {
 809             init.global-&gt;initializeErrorConstructor&lt;ErrorType::TypeError&gt;(init);
 810         });
 811     m_URIErrorStructure.initLater(
 812         [] (LazyClassStructure::Initializer&amp; init) {
 813             init.global-&gt;initializeErrorConstructor&lt;ErrorType::URIError&gt;(init);
 814         });
 815 
 816     m_generatorFunctionPrototype.set(vm, this, GeneratorFunctionPrototype::create(vm, GeneratorFunctionPrototype::createStructure(vm, this, m_functionPrototype.get())));
 817     GeneratorFunctionConstructor* generatorFunctionConstructor = GeneratorFunctionConstructor::create(vm, GeneratorFunctionConstructor::createStructure(vm, this, functionConstructor), m_generatorFunctionPrototype.get());
 818     m_generatorFunctionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, generatorFunctionConstructor, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
 819     m_generatorFunctionStructure.set(vm, this, JSGeneratorFunction::createStructure(vm, this, m_generatorFunctionPrototype.get()));
 820 
 821     m_generatorPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, m_generatorFunctionPrototype.get(), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
 822     m_generatorFunctionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;prototype, m_generatorPrototype.get(), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);

 823 
 824     m_asyncFunctionPrototype.set(vm, this, AsyncFunctionPrototype::create(vm, AsyncFunctionPrototype::createStructure(vm, this, m_functionPrototype.get())));
 825     AsyncFunctionConstructor* asyncFunctionConstructor = AsyncFunctionConstructor::create(vm, AsyncFunctionConstructor::createStructure(vm, this, functionConstructor), m_asyncFunctionPrototype.get());
 826     m_asyncFunctionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, asyncFunctionConstructor, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
 827     m_asyncFunctionStructure.set(vm, this, JSAsyncFunction::createStructure(vm, this, m_asyncFunctionPrototype.get()));
 828 
 829     m_asyncGeneratorFunctionPrototype.set(vm, this, AsyncGeneratorFunctionPrototype::create(vm, AsyncGeneratorFunctionPrototype::createStructure(vm, this, m_functionPrototype.get())));
 830     AsyncGeneratorFunctionConstructor* asyncGeneratorFunctionConstructor = AsyncGeneratorFunctionConstructor::create(vm, AsyncGeneratorFunctionConstructor::createStructure(vm, this, functionConstructor), m_asyncGeneratorFunctionPrototype.get());
 831     m_asyncGeneratorFunctionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, asyncGeneratorFunctionConstructor, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
 832     m_asyncGeneratorFunctionStructure.set(vm, this, JSAsyncGeneratorFunction::createStructure(vm, this, m_asyncGeneratorFunctionPrototype.get()));
 833 
 834     m_asyncGeneratorPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, m_asyncGeneratorFunctionPrototype.get(), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
 835     m_asyncGeneratorFunctionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;prototype, m_asyncGeneratorPrototype.get(), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);

 836 
 837     m_objectPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, objectConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 838     m_functionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, functionConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 839     m_arrayPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, arrayConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 840     m_regExpPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, regExpConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 841 
 842     putDirectWithoutTransition(vm, vm.propertyNames-&gt;Object, objectConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 843     putDirectWithoutTransition(vm, vm.propertyNames-&gt;Function, functionConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 844     putDirectWithoutTransition(vm, vm.propertyNames-&gt;Array, arrayConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 845     putDirectWithoutTransition(vm, vm.propertyNames-&gt;RegExp, regExpConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 846 
<span class="line-removed"> 847     putDirectWithoutTransition(vm, vm.propertyNames-&gt;builtinNames().ObjectPrivateName(), objectConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly);</span>
<span class="line-removed"> 848     putDirectWithoutTransition(vm, vm.propertyNames-&gt;builtinNames().ArrayPrivateName(), arrayConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly);</span>
<span class="line-removed"> 849 </span>
 850 #if ENABLE(SHARED_ARRAY_BUFFER)
 851     putDirectWithoutTransition(vm, vm.propertyNames-&gt;SharedArrayBuffer, sharedArrayBufferConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 852     putDirectWithoutTransition(vm, Identifier::fromString(vm, &quot;Atomics&quot;), atomicsObject, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 853 #endif
 854 
 855 #define PUT_CONSTRUCTOR_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 856     if (featureFlag) \
 857         putDirectWithoutTransition(vm, vm.propertyNames-&gt; jsName, lowerName ## Constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 858 
 859 
 860     FOR_EACH_SIMPLE_BUILTIN_TYPE_WITH_CONSTRUCTOR(PUT_CONSTRUCTOR_FOR_SIMPLE_TYPE)
 861 
 862 #undef PUT_CONSTRUCTOR_FOR_SIMPLE_TYPE
 863     m_iteratorResultObjectStructure.initLater(
 864         [] (const Initializer&lt;Structure&gt;&amp; init) {
 865             init.set(createIteratorResultObjectStructure(init.vm, *init.owner));
 866         });
 867 
 868     m_evalFunction.initLater(
 869         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
</pre>
<hr />
<pre>
 878             init.set(IntlCollator::createStructure(init.vm, globalObject, collatorPrototype));
 879         });
 880     m_numberFormatStructure.initLater(
 881         [] (const Initializer&lt;Structure&gt;&amp; init) {
 882             JSGlobalObject* globalObject = jsCast&lt;JSGlobalObject*&gt;(init.owner);
 883             IntlNumberFormatPrototype* numberFormatPrototype = IntlNumberFormatPrototype::create(init.vm, globalObject, IntlNumberFormatPrototype::createStructure(init.vm, globalObject, globalObject-&gt;objectPrototype()));
 884             init.set(IntlNumberFormat::createStructure(init.vm, globalObject, numberFormatPrototype));
 885         });
 886     m_dateTimeFormatStructure.initLater(
 887         [] (const Initializer&lt;Structure&gt;&amp; init) {
 888             JSGlobalObject* globalObject = jsCast&lt;JSGlobalObject*&gt;(init.owner);
 889             IntlDateTimeFormatPrototype* dateTimeFormatPrototype = IntlDateTimeFormatPrototype::create(init.vm, globalObject, IntlDateTimeFormatPrototype::createStructure(init.vm, globalObject, globalObject-&gt;objectPrototype()));
 890             init.set(IntlDateTimeFormat::createStructure(init.vm, globalObject, dateTimeFormatPrototype));
 891         });
 892     m_pluralRulesStructure.initLater(
 893         [] (const Initializer&lt;Structure&gt;&amp; init) {
 894             JSGlobalObject* globalObject = jsCast&lt;JSGlobalObject*&gt;(init.owner);
 895             IntlPluralRulesPrototype* pluralRulesPrototype = IntlPluralRulesPrototype::create(init.vm, globalObject, IntlPluralRulesPrototype::createStructure(init.vm, globalObject, globalObject-&gt;objectPrototype()));
 896             init.set(IntlPluralRules::createStructure(init.vm, globalObject, pluralRulesPrototype));
 897         });










 898 
 899     IntlObject* intl = IntlObject::create(vm, IntlObject::createStructure(vm, this, m_objectPrototype.get()));
 900     putDirectWithoutTransition(vm, vm.propertyNames-&gt;Intl, intl, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 901 #endif // ENABLE(INTL)
 902 
 903     m_moduleLoader.initLater(
 904         [] (const Initializer&lt;JSModuleLoader&gt;&amp; init) {
 905             auto catchScope = DECLARE_CATCH_SCOPE(init.vm);
<span class="line-modified"> 906             init.set(JSModuleLoader::create(init.owner-&gt;globalExec(), init.vm, init.owner, JSModuleLoader::createStructure(init.vm, init.owner, jsNull())));</span>
 907             catchScope.releaseAssertNoException();
 908         });
 909     if (Options::exposeInternalModuleLoader())
 910         putDirectWithoutTransition(vm, vm.propertyNames-&gt;Loader, moduleLoader(), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 911 
<span class="line-modified"> 912     JSFunction* builtinLog = JSFunction::create(vm, this, 1, vm.propertyNames-&gt;emptyIdentifier.string(), globalFuncBuiltinLog);</span>
<span class="line-removed"> 913     JSFunction* builtinDescribe = JSFunction::create(vm, this, 1, vm.propertyNames-&gt;emptyIdentifier.string(), globalFuncBuiltinDescribe);</span>
<span class="line-removed"> 914 </span>
<span class="line-removed"> 915     JSFunction* privateFuncTrunc = JSFunction::create(vm, this, 0, String(), mathProtoFuncTrunc, TruncIntrinsic);</span>
<span class="line-removed"> 916 </span>
<span class="line-removed"> 917     JSFunction* privateFuncPropertyIsEnumerable = JSFunction::create(vm, this, 0, String(), globalFuncPropertyIsEnumerable);</span>
<span class="line-removed"> 918     JSFunction* privateFuncOwnKeys = JSFunction::create(vm, this, 0, String(), globalFuncOwnKeys);</span>
<span class="line-removed"> 919     JSFunction* privateFuncImportModule = JSFunction::create(vm, this, 0, String(), globalFuncImportModule);</span>
<span class="line-removed"> 920     JSFunction* privateFuncMakeTypeError = JSFunction::create(vm, this, 0, String(), globalFuncMakeTypeError);</span>
<span class="line-removed"> 921     JSFunction* privateFuncTypedArrayLength = JSFunction::create(vm, this, 0, String(), typedArrayViewPrivateFuncLength);</span>
<span class="line-removed"> 922     JSFunction* privateFuncTypedArrayGetOriginalConstructor = JSFunction::create(vm, this, 0, String(), typedArrayViewPrivateFuncGetOriginalConstructor);</span>
<span class="line-removed"> 923     JSFunction* privateFuncTypedArraySort = JSFunction::create(vm, this, 0, String(), typedArrayViewPrivateFuncSort);</span>
<span class="line-removed"> 924     JSFunction* privateFuncIsTypedArrayView = JSFunction::create(vm, this, 0, String(), typedArrayViewPrivateFuncIsTypedArrayView, IsTypedArrayViewIntrinsic);</span>
<span class="line-removed"> 925     JSFunction* privateFuncTypedArraySubarrayCreate = JSFunction::create(vm, this, 0, String(), typedArrayViewPrivateFuncSubarrayCreate);</span>
<span class="line-removed"> 926     JSFunction* privateFuncIsBoundFunction = JSFunction::create(vm, this, 0, String(), isBoundFunction);</span>
<span class="line-removed"> 927     JSFunction* privateFuncHasInstanceBoundFunction = JSFunction::create(vm, this, 0, String(), hasInstanceBoundFunction);</span>
<span class="line-removed"> 928     JSFunction* privateFuncInstanceOf = JSFunction::create(vm, this, 0, String(), objectPrivateFuncInstanceOf);</span>
<span class="line-removed"> 929     JSFunction* privateFuncThisTimeValue = JSFunction::create(vm, this, 0, String(), dateProtoFuncGetTime);</span>
<span class="line-removed"> 930 #if ENABLE(INTL)</span>
<span class="line-removed"> 931     JSFunction* privateFuncDateTimeFormat = JSFunction::create(vm, this, 0, String(), globalFuncDateTimeFormat);</span>
<span class="line-removed"> 932 #endif</span>
<span class="line-removed"> 933     JSFunction* privateFuncIsArraySlow = JSFunction::create(vm, this, 0, String(), arrayConstructorPrivateFuncIsArraySlow);</span>
<span class="line-removed"> 934     JSFunction* privateFuncConcatMemcpy = JSFunction::create(vm, this, 0, String(), arrayProtoPrivateFuncConcatMemcpy);</span>
<span class="line-removed"> 935     JSFunction* privateFuncAppendMemcpy = JSFunction::create(vm, this, 0, String(), arrayProtoPrivateFuncAppendMemcpy);</span>
<span class="line-removed"> 936     JSFunction* privateFuncMapBucketHead = JSFunction::create(vm, this, 0, String(), mapPrivateFuncMapBucketHead, JSMapBucketHeadIntrinsic);</span>
<span class="line-removed"> 937     JSFunction* privateFuncMapBucketNext = JSFunction::create(vm, this, 0, String(), mapPrivateFuncMapBucketNext, JSMapBucketNextIntrinsic);</span>
<span class="line-removed"> 938     JSFunction* privateFuncMapBucketKey = JSFunction::create(vm, this, 0, String(), mapPrivateFuncMapBucketKey, JSMapBucketKeyIntrinsic);</span>
<span class="line-removed"> 939     JSFunction* privateFuncMapBucketValue = JSFunction::create(vm, this, 0, String(), mapPrivateFuncMapBucketValue, JSMapBucketValueIntrinsic);</span>
<span class="line-removed"> 940     JSFunction* privateFuncSetBucketHead = JSFunction::create(vm, this, 0, String(), setPrivateFuncSetBucketHead, JSSetBucketHeadIntrinsic);</span>
<span class="line-removed"> 941     JSFunction* privateFuncSetBucketNext = JSFunction::create(vm, this, 0, String(), setPrivateFuncSetBucketNext, JSSetBucketNextIntrinsic);</span>
<span class="line-removed"> 942     JSFunction* privateFuncSetBucketKey = JSFunction::create(vm, this, 0, String(), setPrivateFuncSetBucketKey, JSSetBucketKeyIntrinsic);</span>
<span class="line-removed"> 943 </span>
<span class="line-removed"> 944     JSObject* regExpProtoFlagsGetterObject = getGetterById(exec, m_regExpPrototype.get(), vm.propertyNames-&gt;flags);</span>
 945     catchScope.assertNoException();
<span class="line-modified"> 946     JSObject* regExpProtoGlobalGetterObject = getGetterById(exec, m_regExpPrototype.get(), vm.propertyNames-&gt;global);</span>

 947     catchScope.assertNoException();
<span class="line-modified"> 948     m_regExpProtoGlobalGetter.set(vm, this, regExpProtoGlobalGetterObject);</span>
<span class="line-modified"> 949     JSObject* regExpProtoIgnoreCaseGetterObject = getGetterById(exec, m_regExpPrototype.get(), vm.propertyNames-&gt;ignoreCase);</span>
 950     catchScope.assertNoException();
<span class="line-modified"> 951     JSObject* regExpProtoMultilineGetterObject = getGetterById(exec, m_regExpPrototype.get(), vm.propertyNames-&gt;multiline);</span>

 952     catchScope.assertNoException();
<span class="line-modified"> 953     JSObject* regExpProtoSourceGetterObject = getGetterById(exec, m_regExpPrototype.get(), vm.propertyNames-&gt;source);</span>

 954     catchScope.assertNoException();
<span class="line-modified"> 955     JSObject* regExpProtoStickyGetterObject = getGetterById(exec, m_regExpPrototype.get(), vm.propertyNames-&gt;sticky);</span>

 956     catchScope.assertNoException();
<span class="line-modified"> 957     JSObject* regExpProtoUnicodeGetterObject = getGetterById(exec, m_regExpPrototype.get(), vm.propertyNames-&gt;unicode);</span>

 958     catchScope.assertNoException();
<span class="line-modified"> 959     m_regExpProtoUnicodeGetter.set(vm, this, regExpProtoUnicodeGetterObject);</span>
<span class="line-modified"> 960     JSObject* builtinRegExpExec = asObject(m_regExpPrototype-&gt;getDirect(vm, vm.propertyNames-&gt;exec).asCell());</span>
<span class="line-removed"> 961     m_regExpProtoExec.set(vm, this, builtinRegExpExec);</span>
<span class="line-removed"> 962     JSObject* regExpSymbolReplace = asObject(m_regExpPrototype-&gt;getDirect(vm, vm.propertyNames-&gt;replaceSymbol).asCell());</span>
 963     m_regExpProtoSymbolReplace.set(vm, this, regExpSymbolReplace);


 964 
<span class="line-modified"> 965 #define CREATE_PRIVATE_GLOBAL_FUNCTION(varName, funcName, code) JSFunction* varName ## PrivateFunction = JSFunction::create(vm, code ## CodeGenerator(vm), this);</span>
<span class="line-modified"> 966     JSC_FOREACH_BUILTIN_FUNCTION_PRIVATE_GLOBAL_NAME(CREATE_PRIVATE_GLOBAL_FUNCTION)</span>
<span class="line-modified"> 967 #undef CREATE_PRIVATE_GLOBAL_FUNCTION</span>
 968 
<span class="line-modified"> 969     JSObject* arrayIteratorPrototype = ArrayIteratorPrototype::create(vm, this, ArrayIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));</span>
<span class="line-modified"> 970     arrayIteratorConstructorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, arrayIteratorPrototype);</span>





 971 


 972     JSObject* asyncFromSyncIteratorPrototype = AsyncFromSyncIteratorPrototype::create(vm, this, AsyncFromSyncIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="line-modified"> 973     asyncFromSyncIteratorConstructorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, asyncFromSyncIteratorPrototype);</span>
 974 
 975     JSObject* mapIteratorPrototype = MapIteratorPrototype::create(vm, this, MapIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="line-modified"> 976     mapIteratorConstructorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, mapIteratorPrototype);</span>
 977 
 978     JSObject* regExpStringIteratorPrototype = RegExpStringIteratorPrototype::create(vm, this, RegExpStringIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="line-modified"> 979     regExpStringIteratorConstructorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, regExpStringIteratorPrototype);</span>
 980 
 981     JSObject* setIteratorPrototype = SetIteratorPrototype::create(vm, this, SetIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="line-modified"> 982     setIteratorConstructorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, setIteratorPrototype);</span>














































































































































 983 
<span class="line-removed"> 984     GlobalPropertyInfo staticGlobals[] = {</span>
<span class="line-removed"> 985 #define INIT_PRIVATE_GLOBAL(varName, funcName, code) GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().funcName ## PrivateName(), varName ## PrivateFunction, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 986         JSC_FOREACH_BUILTIN_FUNCTION_PRIVATE_GLOBAL_NAME(INIT_PRIVATE_GLOBAL)</span>
<span class="line-removed"> 987 #undef INIT_PRIVATE_GLOBAL</span>
<span class="line-removed"> 988         GlobalPropertyInfo(vm.propertyNames-&gt;NaN, jsNaN(), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 989         GlobalPropertyInfo(vm.propertyNames-&gt;Infinity, jsNumber(std::numeric_limits&lt;double&gt;::infinity()), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 990         GlobalPropertyInfo(vm.propertyNames-&gt;undefinedKeyword, jsUndefined(), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 991         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().propertyIsEnumerablePrivateName(), privateFuncPropertyIsEnumerable, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 992         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().ownKeysPrivateName(), privateFuncOwnKeys, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 993         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().importModulePrivateName(), privateFuncImportModule, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 994         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().enqueueJobPrivateName(), JSFunction::create(vm, this, 0, String(), enqueueJob), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 995         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().makeTypeErrorPrivateName(), privateFuncMakeTypeError, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 996         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().typedArrayLengthPrivateName(), privateFuncTypedArrayLength, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 997         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().typedArrayGetOriginalConstructorPrivateName(), privateFuncTypedArrayGetOriginalConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 998         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().typedArraySortPrivateName(), privateFuncTypedArraySort, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed"> 999         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().isTypedArrayViewPrivateName(), privateFuncIsTypedArrayView, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1000         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().typedArraySubarrayCreatePrivateName(), privateFuncTypedArraySubarrayCreate, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1001         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().isBoundFunctionPrivateName(), privateFuncIsBoundFunction, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1002         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().hasInstanceBoundFunctionPrivateName(), privateFuncHasInstanceBoundFunction, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1003         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().instanceOfPrivateName(), privateFuncInstanceOf, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1004         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().BuiltinLogPrivateName(), builtinLog, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1005         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().BuiltinDescribePrivateName(), builtinDescribe, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1006         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().RegExpPrivateName(), regExpConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1007         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().truncPrivateName(), privateFuncTrunc, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1008         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().PromisePrivateName(), promiseConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1009         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().InternalPromisePrivateName(), internalPromiseConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1010 </span>
<span class="line-removed">1011         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().repeatCharacterPrivateName(), JSFunction::create(vm, this, 2, String(), stringProtoFuncRepeatCharacter), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1012         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().arraySpeciesCreatePrivateName(), JSFunction::create(vm, this, 2, String(), arrayProtoFuncSpeciesCreate), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1013         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().isArrayPrivateName(), arrayConstructor-&gt;getDirect(vm, vm.propertyNames-&gt;isArray), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1014         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().isArraySlowPrivateName(), privateFuncIsArraySlow, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1015         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().concatMemcpyPrivateName(), privateFuncConcatMemcpy, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1016         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().appendMemcpyPrivateName(), privateFuncAppendMemcpy, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1017 </span>
<span class="line-removed">1018         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().hostPromiseRejectionTrackerPrivateName(), JSFunction::create(vm, this, 2, String(), globalFuncHostPromiseRejectionTracker), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1019         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().InspectorInstrumentationPrivateName(), InspectorInstrumentationObject::create(vm, this, InspectorInstrumentationObject::createStructure(vm, this, m_objectPrototype.get())), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1020         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().SetPrivateName(), setConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1021         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().thisTimeValuePrivateName(), privateFuncThisTimeValue, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
1022 #if ENABLE(INTL)
<span class="line-modified">1023         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().dateTimeFormatPrivateName(), privateFuncDateTimeFormat, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>


1024 #endif // ENABLE(INTL)
<span class="line-removed">1025 </span>
<span class="line-removed">1026         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().isConstructorPrivateName(), JSFunction::create(vm, this, 1, String(), esSpecIsConstructor, NoIntrinsic), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1027 </span>
<span class="line-removed">1028         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpProtoFlagsGetterPrivateName(), regExpProtoFlagsGetterObject, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1029         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpProtoGlobalGetterPrivateName(), regExpProtoGlobalGetterObject, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1030         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpProtoIgnoreCaseGetterPrivateName(), regExpProtoIgnoreCaseGetterObject, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1031         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpProtoMultilineGetterPrivateName(), regExpProtoMultilineGetterObject, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1032         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpProtoSourceGetterPrivateName(), regExpProtoSourceGetterObject, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1033         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpProtoStickyGetterPrivateName(), regExpProtoStickyGetterObject, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1034         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpProtoUnicodeGetterPrivateName(), regExpProtoUnicodeGetterObject, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1035 </span>
<span class="line-removed">1036         // RegExp.prototype helpers.</span>
<span class="line-removed">1037         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpBuiltinExecPrivateName(), builtinRegExpExec, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1038         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpCreatePrivateName(), JSFunction::create(vm, this, 2, String(), esSpecRegExpCreate, NoIntrinsic), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1039         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpMatchFastPrivateName(), JSFunction::create(vm, this, 1, String(), regExpProtoFuncMatchFast, RegExpMatchFastIntrinsic), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1040         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpSearchFastPrivateName(), JSFunction::create(vm, this, 1, String(), regExpProtoFuncSearchFast), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1041         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpSplitFastPrivateName(), JSFunction::create(vm, this, 2, String(), regExpProtoFuncSplitFast), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1042         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpPrototypeSymbolReplacePrivateName(), m_regExpPrototype-&gt;getDirect(vm, vm.propertyNames-&gt;replaceSymbol), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1043         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().regExpTestFastPrivateName(), JSFunction::create(vm, this, 1, String(), regExpProtoFuncTestFast, RegExpTestFastIntrinsic), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1044 </span>
<span class="line-removed">1045         // String.prototype helpers.</span>
<span class="line-removed">1046         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().stringIncludesInternalPrivateName(), JSFunction::create(vm, this, 1, String(), builtinStringIncludesInternal), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1047         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().stringSplitFastPrivateName(), JSFunction::create(vm, this, 2, String(), stringProtoFuncSplitFast), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1048         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().stringSubstrInternalPrivateName(), JSFunction::create(vm, this, 2, String(), builtinStringSubstrInternal), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1049 </span>
<span class="line-removed">1050         // Function prototype helpers.</span>
<span class="line-removed">1051         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().makeBoundFunctionPrivateName(), JSFunction::create(vm, this, 5, String(), makeBoundFunction), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1052         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().hasOwnLengthPropertyPrivateName(), JSFunction::create(vm, this, 1, String(), hasOwnLengthProperty), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1053 </span>
<span class="line-removed">1054         // Map and Set helpers.</span>
<span class="line-removed">1055         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().mapBucketHeadPrivateName(), privateFuncMapBucketHead, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1056         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().mapBucketNextPrivateName(), privateFuncMapBucketNext, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1057         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().mapBucketKeyPrivateName(), privateFuncMapBucketKey, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1058         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().mapBucketValuePrivateName(), privateFuncMapBucketValue, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1059         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().setBucketHeadPrivateName(), privateFuncSetBucketHead, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1060         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().setBucketNextPrivateName(), privateFuncSetBucketNext, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-removed">1061         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().setBucketKeyPrivateName(), privateFuncSetBucketKey, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
1062 #if ENABLE(WEBASSEMBLY) &amp;&amp; ENABLE(WEBASSEMBLY_STREAMING_API)
<span class="line-modified">1063         // WebAssembly Streaming API</span>
<span class="line-modified">1064         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().webAssemblyCompileStreamingInternalPrivateName(), JSFunction::create(vm, this, 1, String(), webAssemblyCompileStreamingInternal), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-modified">1065         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().webAssemblyInstantiateStreamingInternalPrivateName(), JSFunction::create(vm, this, 1, String(), webAssemblyInstantiateStreamingInternal), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>




1066 #endif
<span class="line-modified">1067 #if !ASSERT_DISABLED</span>





1068         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().assertPrivateName(), JSFunction::create(vm, this, 1, String(), assertCall), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
1069 #endif
1070     };
1071     addStaticGlobals(staticGlobals, WTF_ARRAY_LENGTH(staticGlobals));
1072 
<span class="line-removed">1073     m_specialPointers[Special::CallFunction] = m_callFunction.get();</span>
<span class="line-removed">1074     m_specialPointers[Special::ApplyFunction] = m_applyFunction.get();</span>
<span class="line-removed">1075     m_specialPointers[Special::ObjectConstructor] = objectConstructor;</span>
<span class="line-removed">1076     m_specialPointers[Special::ArrayConstructor] = arrayConstructor;</span>
<span class="line-removed">1077 </span>
<span class="line-removed">1078     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::ThrowTypeErrorFunction)] = m_throwTypeErrorFunction.get();</span>
<span class="line-removed">1079 </span>
1080     if (UNLIKELY(Options::useDollarVM()))
1081         exposeDollarVM(vm);
1082 
1083 #if ENABLE(WEBASSEMBLY)
1084     if (Wasm::isSupported()) {
1085         m_webAssemblyModuleRecordStructure.initLater(
1086             [] (const Initializer&lt;Structure&gt;&amp; init) {
1087                 init.set(WebAssemblyModuleRecord::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get()));
1088             });
1089         m_webAssemblyFunctionStructure.initLater(
1090             [] (const Initializer&lt;Structure&gt;&amp; init) {
1091                 init.set(WebAssemblyFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
1092             });
1093         m_jsToWasmICCalleeStructure.initLater(
1094             [] (const Initializer&lt;Structure&gt;&amp; init) {
1095                 init.set(JSToWasmICCallee::createStructure(init.vm, init.owner, jsNull()));
1096             });
1097         m_webAssemblyWrapperFunctionStructure.initLater(
1098             [] (const Initializer&lt;Structure&gt;&amp; init) {
1099                 init.set(WebAssemblyWrapperFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
1100             });
<span class="line-removed">1101         m_webAssemblyToJSCalleeStructure.initLater(</span>
<span class="line-removed">1102             [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="line-removed">1103                 init.set(WebAssemblyToJSCallee::createStructure(init.vm, init.owner, jsNull()));</span>
<span class="line-removed">1104             });</span>
1105         auto* webAssembly = JSWebAssembly::create(vm, this, JSWebAssembly::createStructure(vm, this, m_objectPrototype.get()));
1106         putDirectWithoutTransition(vm, Identifier::fromString(vm, &quot;WebAssembly&quot;), webAssembly, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
1107 
1108 #define CREATE_WEBASSEMBLY_PROTOTYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
1109     if (featureFlag) {\
1110         m_ ## properName ## Structure.initLater(\
1111             [] (LazyClassStructure::Initializer&amp; init) { \
1112                 init.setPrototype(capitalName##Prototype::create(init.vm, init.global, capitalName##Prototype::createStructure(init.vm, init.global, init.global-&gt;prototypeBase ## Prototype()))); \
1113                 init.setStructure(instanceType::createStructure(init.vm, init.global, init.prototype)); \
1114                 init.setConstructor(capitalName ## Constructor::create(init.vm, capitalName ## Constructor::createStructure(init.vm, init.global, init.global-&gt;functionPrototype()), jsCast&lt;capitalName ## Prototype*&gt;(init.prototype))); \
1115             }); \
1116     }
1117 
1118         FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(CREATE_WEBASSEMBLY_PROTOTYPE)
1119 
1120 #undef CREATE_WEBASSEMBLY_CONSTRUCTOR
1121     }
1122 #endif // ENABLE(WEBASSEMBLY)
1123 
1124 #undef CREATE_PROTOTYPE_FOR_LAZY_TYPE
1125 
<span class="line-removed">1126     auto setupAdaptiveWatchpoint = [&amp;] (JSObject* base, const Identifier&amp; ident) -&gt; ObjectPropertyCondition {</span>
<span class="line-removed">1127         // Performing these gets should not throw.</span>
<span class="line-removed">1128         ExecState* exec = globalExec();</span>
<span class="line-removed">1129         PropertySlot slot(base, PropertySlot::InternalMethodType::Get);</span>
<span class="line-removed">1130         bool result = base-&gt;getOwnPropertySlot(base, exec, ident, slot);</span>
<span class="line-removed">1131         ASSERT_UNUSED(result, result);</span>
<span class="line-removed">1132         catchScope.assertNoException();</span>
<span class="line-removed">1133         RELEASE_ASSERT(slot.isCacheableValue());</span>
<span class="line-removed">1134         JSValue functionValue = slot.getValue(exec, ident);</span>
<span class="line-removed">1135         catchScope.assertNoException();</span>
<span class="line-removed">1136         ASSERT(jsDynamicCast&lt;JSFunction*&gt;(vm, functionValue));</span>
<span class="line-removed">1137 </span>
<span class="line-removed">1138         ObjectPropertyCondition condition = generateConditionForSelfEquivalence(m_vm, nullptr, base, ident.impl());</span>
<span class="line-removed">1139         RELEASE_ASSERT(condition.requiredValue() == functionValue);</span>
<span class="line-removed">1140 </span>
<span class="line-removed">1141         bool isWatchable = condition.isWatchable(PropertyCondition::EnsureWatchability);</span>
<span class="line-removed">1142         RELEASE_ASSERT(isWatchable); // We allow this to install the necessary watchpoints.</span>
<span class="line-removed">1143 </span>
<span class="line-removed">1144         return condition;</span>
<span class="line-removed">1145     };</span>
1146 
1147     {
<span class="line-modified">1148         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(arrayIteratorPrototype, m_vm.propertyNames-&gt;next);</span>
1149         m_arrayIteratorPrototypeNext = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_arrayIteratorProtocolWatchpointSet);
1150         m_arrayIteratorPrototypeNext-&gt;install(vm);
1151     }
1152     {
<span class="line-modified">1153         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this-&gt;arrayPrototype(), m_vm.propertyNames-&gt;iteratorSymbol);</span>
1154         m_arrayPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_arrayIteratorProtocolWatchpointSet);
1155         m_arrayPrototypeSymbolIteratorWatchpoint-&gt;install(vm);
1156     }
1157     {
<span class="line-modified">1158         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this-&gt;arrayPrototype(), m_vm.propertyNames-&gt;join);</span>
1159         m_arrayPrototypeJoinWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_arrayJoinWatchpointSet);
1160         m_arrayPrototypeJoinWatchpoint-&gt;install(vm);
1161     }
1162 
1163     {
<span class="line-modified">1164         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(mapIteratorPrototype, m_vm.propertyNames-&gt;next);</span>
1165         m_mapIteratorPrototypeNextWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_mapIteratorProtocolWatchpointSet);
1166         m_mapIteratorPrototypeNextWatchpoint-&gt;install(vm);
1167     }
1168     {
<span class="line-modified">1169         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_mapPrototype.get(), m_vm.propertyNames-&gt;iteratorSymbol);</span>
<span class="line-removed">1170         m_mapPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_mapIteratorProtocolWatchpointSet);</span>
<span class="line-removed">1171         m_mapPrototypeSymbolIteratorWatchpoint-&gt;install(vm);</span>
<span class="line-removed">1172     }</span>
<span class="line-removed">1173 </span>
<span class="line-removed">1174     {</span>
<span class="line-removed">1175         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(setIteratorPrototype, m_vm.propertyNames-&gt;next);</span>
1176         m_setIteratorPrototypeNextWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_setIteratorProtocolWatchpointSet);
1177         m_setIteratorPrototypeNextWatchpoint-&gt;install(vm);
1178     }
1179     {
<span class="line-modified">1180         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_setPrototype.get(), m_vm.propertyNames-&gt;iteratorSymbol);</span>
<span class="line-removed">1181         m_setPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_setIteratorProtocolWatchpointSet);</span>
<span class="line-removed">1182         m_setPrototypeSymbolIteratorWatchpoint-&gt;install(vm);</span>
<span class="line-removed">1183     }</span>
<span class="line-removed">1184 </span>
<span class="line-removed">1185     {</span>
<span class="line-removed">1186         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_stringIteratorPrototype.get(), m_vm.propertyNames-&gt;next);</span>
1187         m_stringIteratorPrototypeNextWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_stringIteratorProtocolWatchpointSet);
1188         m_stringIteratorPrototypeNextWatchpoint-&gt;install(vm);
1189     }
1190     {
<span class="line-modified">1191         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_stringPrototype.get(), m_vm.propertyNames-&gt;iteratorSymbol);</span>
1192         m_stringPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_stringIteratorProtocolWatchpointSet);
1193         m_stringPrototypeSymbolIteratorWatchpoint-&gt;install(vm);
1194     }
1195 
<span class="line-removed">1196     {</span>
<span class="line-removed">1197         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_mapPrototype.get(), m_vm.propertyNames-&gt;set);</span>
<span class="line-removed">1198         m_mapPrototypeSetWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_mapSetWatchpointSet);</span>
<span class="line-removed">1199         m_mapPrototypeSetWatchpoint-&gt;install(vm);</span>
<span class="line-removed">1200     }</span>
<span class="line-removed">1201 </span>
<span class="line-removed">1202     {</span>
<span class="line-removed">1203         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_setPrototype.get(), m_vm.propertyNames-&gt;add);</span>
<span class="line-removed">1204         m_setPrototypeAddWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_setAddWatchpointSet);</span>
<span class="line-removed">1205         m_setPrototypeAddWatchpoint-&gt;install(vm);</span>
<span class="line-removed">1206     }</span>
<span class="line-removed">1207 </span>
1208     // Unfortunately, the prototype objects of the builtin objects can be touched from concurrent compilers. So eagerly initialize them only if we use JIT.
1209     if (VM::canUseJIT()) {
1210         this-&gt;booleanPrototype();
<span class="line-modified">1211         auto* numberPrototype = this-&gt;numberPrototype();</span>
1212         this-&gt;symbolPrototype();
<span class="line-removed">1213 </span>
<span class="line-removed">1214         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(numberPrototype, m_vm.propertyNames-&gt;toString);</span>
<span class="line-removed">1215         m_numberPrototypeToStringWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_numberToStringWatchpointSet);</span>
<span class="line-removed">1216         m_numberPrototypeToStringWatchpoint-&gt;install(vm);</span>
<span class="line-removed">1217         m_numberProtoToStringFunction.set(vm, this, jsCast&lt;JSFunction*&gt;(numberPrototype-&gt;getDirect(vm, vm.propertyNames-&gt;toString)));</span>
1218     }
1219 
1220     fixupPrototypeChainWithObjectPrototype(vm);
1221 }
1222 
<span class="line-modified">1223 bool JSGlobalObject::put(JSCell* cell, ExecState* exec, PropertyName propertyName, JSValue value, PutPropertySlot&amp; slot)</span>
1224 {
<span class="line-modified">1225     VM&amp; vm = exec-&gt;vm();</span>
1226     auto scope = DECLARE_THROW_SCOPE(vm);
1227     JSGlobalObject* thisObject = jsCast&lt;JSGlobalObject*&gt;(cell);
1228     ASSERT(!Heap::heap(value) || Heap::heap(value) == Heap::heap(thisObject));
1229 
1230     if (UNLIKELY(isThisValueAltered(slot, thisObject)))
<span class="line-modified">1231         RELEASE_AND_RETURN(scope, ordinarySetSlow(exec, thisObject, propertyName, value, slot.thisValue(), slot.isStrictMode()));</span>
1232 
1233     bool shouldThrowReadOnlyError = slot.isStrictMode();
1234     bool ignoreReadOnlyErrors = false;
1235     bool putResult = false;
<span class="line-modified">1236     bool done = symbolTablePutTouchWatchpointSet(thisObject, exec, propertyName, value, shouldThrowReadOnlyError, ignoreReadOnlyErrors, putResult);</span>
1237     EXCEPTION_ASSERT((!!scope.exception() == (done &amp;&amp; !putResult)) || !shouldThrowReadOnlyError);
1238     if (done)
1239         return putResult;
<span class="line-modified">1240     RELEASE_AND_RETURN(scope, Base::put(thisObject, exec, propertyName, value, slot));</span>
1241 }
1242 
<span class="line-modified">1243 bool JSGlobalObject::defineOwnProperty(JSObject* object, ExecState* exec, PropertyName propertyName, const PropertyDescriptor&amp; descriptor, bool shouldThrow)</span>
1244 {
1245     JSGlobalObject* thisObject = jsCast&lt;JSGlobalObject*&gt;(object);
1246     PropertySlot slot(thisObject, PropertySlot::InternalMethodType::VMInquiry);
1247     // silently ignore attempts to add accessors aliasing vars.
1248     if (descriptor.isAccessorDescriptor() &amp;&amp; symbolTableGet(thisObject, propertyName, slot))
1249         return false;
<span class="line-modified">1250     return Base::defineOwnProperty(thisObject, exec, propertyName, descriptor, shouldThrow);</span>
1251 }
1252 
1253 void JSGlobalObject::addGlobalVar(const Identifier&amp; ident)
1254 {
1255     ConcurrentJSLocker locker(symbolTable()-&gt;m_lock);
1256     SymbolTableEntry entry = symbolTable()-&gt;get(locker, ident.impl());
1257     if (!entry.isNull())
1258         return;
1259 
1260     ScopeOffset offset = symbolTable()-&gt;takeNextScopeOffset(locker);
1261     SymbolTableEntry newEntry(VarOffset(offset), 0);
1262     newEntry.prepareToWatch();
1263     symbolTable()-&gt;add(locker, ident.impl(), WTFMove(newEntry));
1264 
1265     ScopeOffset offsetForAssert = addVariables(1, jsUndefined());
1266     RELEASE_ASSERT(offsetForAssert == offset);
1267 }
1268 
<span class="line-modified">1269 void JSGlobalObject::addFunction(ExecState* exec, const Identifier&amp; propertyName)</span>
1270 {
<span class="line-modified">1271     VM&amp; vm = exec-&gt;vm();</span>
1272     VM::DeletePropertyModeScope scope(vm, VM::DeletePropertyMode::IgnoreConfigurable);
<span class="line-modified">1273     methodTable(vm)-&gt;deleteProperty(this, exec, propertyName);</span>
1274     addGlobalVar(propertyName);
1275 }
1276 
1277 void JSGlobalObject::setGlobalScopeExtension(JSScope* scope)
1278 {
1279     m_globalScopeExtension.set(vm(), this, scope);
1280 }
1281 
1282 void JSGlobalObject::clearGlobalScopeExtension()
1283 {
1284     m_globalScopeExtension.clear();
1285 }
1286 
1287 static inline JSObject* lastInPrototypeChain(VM&amp; vm, JSObject* object)
1288 {
1289     JSObject* o = object;
1290     while (o-&gt;getPrototypeDirect(vm).isObject())
1291         o = asObject(o-&gt;getPrototypeDirect(vm));
1292     return o;
1293 }
</pre>
<hr />
<pre>
1449             current = asObject(prototypeValue);
1450         }
1451         RELEASE_ASSERT_NOT_REACHED();
1452     };
1453 
1454     if (JSFunction* function = jsDynamicCast&lt;JSFunction*&gt;(vm, object)) {
1455         if (FunctionRareData* rareData = function-&gt;rareData()) {
1456             // We only use this to cache JSFinalObjects. They do not start off with a broken indexing type.
1457             ASSERT(!(rareData-&gt;objectAllocationStructure() &amp;&amp; hasBrokenIndexing(rareData-&gt;objectAllocationStructure()-&gt;indexingType())));
1458 
1459             if (Structure* structure = rareData-&gt;internalFunctionAllocationStructure()) {
1460                 if (hasBrokenIndexing(structure-&gt;indexingType())) {
1461                     bool isRelevantGlobalObject =
1462                         (mode == BadTimeFinderMode::SingleGlobal
1463                             ? m_globalObject == structure-&gt;globalObject()
1464                             : m_globalObjects-&gt;contains(structure-&gt;globalObject()))
1465                         || (structure-&gt;hasMonoProto() &amp;&amp; !structure-&gt;storedPrototype().isNull() &amp;&amp; isInAffectedGlobalObject(asObject(structure-&gt;storedPrototype())));
1466                     if (mode == BadTimeFinderMode::SingleGlobal &amp;&amp; m_needsMultiGlobalsScan)
1467                         return IterationStatus::Done; // Bailing early and let the MultipleGlobals path handle everything.
1468                     if (isRelevantGlobalObject)
<span class="line-modified">1469                         rareData-&gt;clearInternalFunctionAllocationProfile();</span>
1470                 }
1471             }
1472         }
1473     }
1474 
1475     // Run this filter first, since it&#39;s cheap, and ought to filter out a lot of objects.
1476     if (!hasBrokenIndexing(object))
1477         return IterationStatus::Continue;
1478 
1479     if (isInAffectedGlobalObject(object))
1480         m_foundObjects.append(object);
1481 
1482     if (mode == BadTimeFinderMode::SingleGlobal &amp;&amp; m_needsMultiGlobalsScan)
1483         return IterationStatus::Done; // Bailing early and let the MultipleGlobals path handle everything.
1484 
1485     return IterationStatus::Continue;
1486 }
1487 
1488 template&lt;BadTimeFinderMode mode&gt;
1489 IterationStatus ObjectsWithBrokenIndexingFinder&lt;mode&gt;::operator()(HeapCell* cell, HeapCell::Kind kind) const
1490 {
1491     if (isJSCellKind(kind) &amp;&amp; static_cast&lt;JSCell*&gt;(cell)-&gt;isObject()) {
1492         // FIXME: This const_cast exists because this isn&#39;t a C++ lambda.
1493         // https://bugs.webkit.org/show_bug.cgi?id=159644
1494         return const_cast&lt;ObjectsWithBrokenIndexingFinder*&gt;(this)-&gt;visit(jsCast&lt;JSObject*&gt;(static_cast&lt;JSCell*&gt;(cell)));
1495     }
1496     return IterationStatus::Continue;
1497 }
1498 
1499 } // end private namespace for helpers for JSGlobalObject::haveABadTime()
1500 
1501 void JSGlobalObject::fireWatchpointAndMakeAllArrayStructuresSlowPut(VM&amp; vm)
1502 {
1503     if (isHavingABadTime())
1504         return;
1505 
<span class="line-removed">1506     // Make sure that all allocations or indexed storage transitions that are inlining</span>
<span class="line-removed">1507     // the assumption that it&#39;s safe to transition to a non-SlowPut array storage don&#39;t</span>
<span class="line-removed">1508     // do so anymore.</span>
<span class="line-removed">1509     m_havingABadTimeWatchpoint-&gt;fireAll(vm, &quot;Having a bad time&quot;);</span>
<span class="line-removed">1510     ASSERT(isHavingABadTime()); // The watchpoint is what tells us that we&#39;re having a bad time.</span>
<span class="line-removed">1511 </span>
1512     // Make sure that all JSArray allocations that load the appropriate structure from
1513     // this object now load a structure that uses SlowPut.
1514     for (unsigned i = 0; i &lt; NumberOfArrayIndexingModes; ++i)
1515         m_arrayStructureForIndexingShapeDuringAllocation[i].set(vm, this, originalArrayStructureForIndexingType(ArrayWithSlowPutArrayStorage));
1516 
1517     // Same for any special array structures.
1518     Structure* slowPutStructure;
1519     slowPutStructure = createRegExpMatchesArraySlowPutStructure(vm, this);
1520     m_regExpMatchesArrayStructure.set(vm, this, slowPutStructure);
<span class="line-removed">1521     slowPutStructure = createRegExpMatchesArrayWithGroupsSlowPutStructure(vm, this);</span>
<span class="line-removed">1522     m_regExpMatchesArrayWithGroupsStructure.set(vm, this, slowPutStructure);</span>
1523     slowPutStructure = ClonedArguments::createSlowPutStructure(vm, this, m_objectPrototype.get());
1524     m_clonedArgumentsStructure.set(vm, this, slowPutStructure);










1525 };
1526 
1527 void JSGlobalObject::haveABadTime(VM&amp; vm)
1528 {
1529     ASSERT(&amp;vm == &amp;this-&gt;vm());
1530 
1531     if (isHavingABadTime())
1532         return;
1533 
1534     vm.structureCache.clear(); // We may be caching array structures in here.
1535 
1536     DeferGC deferGC(vm.heap);
1537 
1538     // Consider the following objects and prototype chains:
1539     //    O (of global G1) -&gt; A (of global G1)
1540     //    B (of global G2) where G2 has a bad time
1541     //
1542     // If we set B as the prototype of A, G1 will need to have a bad time.
1543     // See comments in Structure::mayInterceptIndexedAccesses() for why.
1544     //
</pre>
<hr />
<pre>
1641         object-&gt;switchToSlowPutArrayStorage(vm);
1642     }
1643 }
1644 
1645 void JSGlobalObject::fixupPrototypeChainWithObjectPrototype(VM&amp; vm)
1646 {
1647     JSObject* oldLastInPrototypeChain = lastInPrototypeChain(vm, this);
1648     JSObject* objectPrototype = m_objectPrototype.get();
1649     if (oldLastInPrototypeChain != objectPrototype)
1650         oldLastInPrototypeChain-&gt;setPrototypeDirect(vm, objectPrototype);
1651 }
1652 
1653 // Set prototype, and also insert the object prototype at the end of the chain.
1654 void JSGlobalObject::resetPrototype(VM&amp; vm, JSValue prototype)
1655 {
1656     if (getPrototypeDirect(vm) == prototype)
1657         return;
1658     setPrototypeDirect(vm, prototype);
1659     fixupPrototypeChainWithObjectPrototype(vm);
1660     // Whenever we change the prototype of the global object, we need to create a new JSProxy with the correct prototype.
<span class="line-modified">1661     setGlobalThis(vm, JSNonDestructibleProxy::create(vm, JSNonDestructibleProxy::createStructure(vm, this, prototype, PureForwardingProxyType), this));</span>
1662 }
1663 
1664 void JSGlobalObject::visitChildren(JSCell* cell, SlotVisitor&amp; visitor)
1665 {
1666     JSGlobalObject* thisObject = jsCast&lt;JSGlobalObject*&gt;(cell);
1667     ASSERT_GC_OBJECT_INHERITS(thisObject, info());
1668     Base::visitChildren(thisObject, visitor);
1669 
1670     visitor.append(thisObject-&gt;m_globalThis);
1671 
1672     visitor.append(thisObject-&gt;m_globalLexicalEnvironment);
1673     visitor.append(thisObject-&gt;m_globalScopeExtension);
1674     visitor.append(thisObject-&gt;m_globalCallee);
1675     visitor.append(thisObject-&gt;m_stackOverflowFrameCallee);
1676     thisObject-&gt;m_evalErrorStructure.visit(visitor);
1677     thisObject-&gt;m_rangeErrorStructure.visit(visitor);
1678     thisObject-&gt;m_referenceErrorStructure.visit(visitor);
1679     thisObject-&gt;m_syntaxErrorStructure.visit(visitor);
1680     thisObject-&gt;m_typeErrorStructure.visit(visitor);
1681     thisObject-&gt;m_URIErrorStructure.visit(visitor);


1682     visitor.append(thisObject-&gt;m_objectConstructor);

1683     visitor.append(thisObject-&gt;m_promiseConstructor);

1684 
1685 #if ENABLE(INTL)
<span class="line-modified">1686     visitor.append(thisObject-&gt;m_defaultCollator);</span>
1687     thisObject-&gt;m_collatorStructure.visit(visitor);
1688     thisObject-&gt;m_numberFormatStructure.visit(visitor);
1689     thisObject-&gt;m_dateTimeFormatStructure.visit(visitor);
1690     thisObject-&gt;m_pluralRulesStructure.visit(visitor);
1691 #endif
1692     visitor.append(thisObject-&gt;m_nullGetterFunction);
1693     visitor.append(thisObject-&gt;m_nullSetterFunction);
1694 
1695     thisObject-&gt;m_parseIntFunction.visit(visitor);
1696     thisObject-&gt;m_parseFloatFunction.visit(visitor);
<span class="line-removed">1697     visitor.append(thisObject-&gt;m_callFunction);</span>
<span class="line-removed">1698     visitor.append(thisObject-&gt;m_applyFunction);</span>
<span class="line-removed">1699     visitor.append(thisObject-&gt;m_throwTypeErrorFunction);</span>
1700     thisObject-&gt;m_arrayProtoToStringFunction.visit(visitor);
1701     thisObject-&gt;m_arrayProtoValuesFunction.visit(visitor);
1702     thisObject-&gt;m_evalFunction.visit(visitor);
<span class="line-removed">1703     thisObject-&gt;m_initializePromiseFunction.visit(visitor);</span>
1704     thisObject-&gt;m_iteratorProtocolFunction.visit(visitor);
1705     thisObject-&gt;m_promiseResolveFunction.visit(visitor);
1706     visitor.append(thisObject-&gt;m_objectProtoValueOfFunction);
<span class="line-modified">1707     visitor.append(thisObject-&gt;m_numberProtoToStringFunction);</span>
<span class="line-removed">1708     visitor.append(thisObject-&gt;m_newPromiseCapabilityFunction);</span>
1709     visitor.append(thisObject-&gt;m_functionProtoHasInstanceSymbolFunction);
1710     thisObject-&gt;m_throwTypeErrorGetterSetter.visit(visitor);

1711     visitor.append(thisObject-&gt;m_throwTypeErrorArgumentsCalleeAndCallerGetterSetter);
1712     thisObject-&gt;m_moduleLoader.visit(visitor);
1713 
1714     visitor.append(thisObject-&gt;m_objectPrototype);
1715     visitor.append(thisObject-&gt;m_functionPrototype);
1716     visitor.append(thisObject-&gt;m_arrayPrototype);
1717     visitor.append(thisObject-&gt;m_iteratorPrototype);
1718     visitor.append(thisObject-&gt;m_generatorFunctionPrototype);
1719     visitor.append(thisObject-&gt;m_generatorPrototype);

1720     visitor.append(thisObject-&gt;m_asyncFunctionPrototype);
1721     visitor.append(thisObject-&gt;m_asyncGeneratorPrototype);
1722     visitor.append(thisObject-&gt;m_asyncIteratorPrototype);
1723     visitor.append(thisObject-&gt;m_asyncGeneratorFunctionPrototype);
1724 
1725     thisObject-&gt;m_debuggerScopeStructure.visit(visitor);
1726     thisObject-&gt;m_withScopeStructure.visit(visitor);
1727     thisObject-&gt;m_strictEvalActivationStructure.visit(visitor);
1728     visitor.append(thisObject-&gt;m_lexicalEnvironmentStructure);
1729     thisObject-&gt;m_moduleEnvironmentStructure.visit(visitor);
1730     visitor.append(thisObject-&gt;m_directArgumentsStructure);
1731     visitor.append(thisObject-&gt;m_scopedArgumentsStructure);
1732     visitor.append(thisObject-&gt;m_clonedArgumentsStructure);
1733     visitor.append(thisObject-&gt;m_objectStructureForObjectConstructor);
1734     for (unsigned i = 0; i &lt; NumberOfArrayIndexingModes; ++i)
1735         visitor.append(thisObject-&gt;m_originalArrayStructureForIndexingShape[i]);
1736     for (unsigned i = 0; i &lt; NumberOfArrayIndexingModes; ++i)
1737         visitor.append(thisObject-&gt;m_arrayStructureForIndexingShapeDuringAllocation[i]);
1738     thisObject-&gt;m_callbackConstructorStructure.visit(visitor);
1739     thisObject-&gt;m_callbackFunctionStructure.visit(visitor);
</pre>
<hr />
<pre>
1743     thisObject-&gt;m_objcWrapperObjectStructure.visit(visitor);
1744 #endif
1745 #ifdef JSC_GLIB_API_ENABLED
1746     thisObject-&gt;m_glibCallbackFunctionStructure.visit(visitor);
1747     thisObject-&gt;m_glibWrapperObjectStructure.visit(visitor);
1748 #endif
1749     visitor.append(thisObject-&gt;m_nullPrototypeObjectStructure);
1750     visitor.append(thisObject-&gt;m_calleeStructure);
1751 
1752     visitor.append(thisObject-&gt;m_hostFunctionStructure);
1753     auto visitFunctionStructures = [&amp;] (FunctionStructures&amp; structures) {
1754         visitor.append(structures.arrowFunctionStructure);
1755         visitor.append(structures.sloppyFunctionStructure);
1756         visitor.append(structures.strictFunctionStructure);
1757     };
1758     visitFunctionStructures(thisObject-&gt;m_builtinFunctions);
1759     visitFunctionStructures(thisObject-&gt;m_ordinaryFunctions);
1760 
1761     thisObject-&gt;m_customGetterSetterFunctionStructure.visit(visitor);
1762     thisObject-&gt;m_boundFunctionStructure.visit(visitor);
<span class="line-removed">1763     visitor.append(thisObject-&gt;m_getterSetterStructure);</span>
1764     thisObject-&gt;m_nativeStdFunctionStructure.visit(visitor);
1765     visitor.append(thisObject-&gt;m_regExpStructure);
1766     visitor.append(thisObject-&gt;m_generatorFunctionStructure);
1767     visitor.append(thisObject-&gt;m_asyncFunctionStructure);
1768     visitor.append(thisObject-&gt;m_asyncGeneratorFunctionStructure);



1769     thisObject-&gt;m_iteratorResultObjectStructure.visit(visitor);
1770     visitor.append(thisObject-&gt;m_regExpMatchesArrayStructure);
<span class="line-removed">1771     visitor.append(thisObject-&gt;m_regExpMatchesArrayWithGroupsStructure);</span>
1772     thisObject-&gt;m_moduleRecordStructure.visit(visitor);
1773     thisObject-&gt;m_moduleNamespaceObjectStructure.visit(visitor);
1774     thisObject-&gt;m_proxyObjectStructure.visit(visitor);
1775     thisObject-&gt;m_callableProxyObjectStructure.visit(visitor);
1776     thisObject-&gt;m_proxyRevokeStructure.visit(visitor);
1777 



1778 #if ENABLE(SHARED_ARRAY_BUFFER)
1779     visitor.append(thisObject-&gt;m_sharedArrayBufferPrototype);
1780     visitor.append(thisObject-&gt;m_sharedArrayBufferStructure);
1781 #endif
1782 
1783 #define VISIT_SIMPLE_TYPE(CapitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) { \
1784         visitor.append(thisObject-&gt;m_ ## lowerName ## Prototype); \
1785         visitor.append(thisObject-&gt;m_ ## properName ## Structure); \
1786     }
1787 
1788     FOR_EACH_SIMPLE_BUILTIN_TYPE(VISIT_SIMPLE_TYPE)
1789     FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(VISIT_SIMPLE_TYPE)
1790 
1791 #define VISIT_LAZY_TYPE(CapitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) \
1792         thisObject-&gt;m_ ## properName ## Structure.visit(visitor);
1793 
1794     FOR_EACH_LAZY_BUILTIN_TYPE(VISIT_LAZY_TYPE)
1795 
1796 #if ENABLE(WEBASSEMBLY)
1797     thisObject-&gt;m_webAssemblyModuleRecordStructure.visit(visitor);
1798     thisObject-&gt;m_webAssemblyFunctionStructure.visit(visitor);
1799     thisObject-&gt;m_jsToWasmICCalleeStructure.visit(visitor);
1800     thisObject-&gt;m_webAssemblyWrapperFunctionStructure.visit(visitor);
<span class="line-removed">1801     thisObject-&gt;m_webAssemblyToJSCalleeStructure.visit(visitor);</span>
1802     FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(VISIT_LAZY_TYPE)
1803 #endif // ENABLE(WEBASSEMBLY)
1804 
1805 #undef VISIT_SIMPLE_TYPE
1806 #undef VISIT_LAZY_TYPE
1807 
1808     for (unsigned i = NumberOfTypedArrayTypes; i--;)
1809         thisObject-&gt;lazyTypedArrayStructure(indexToTypedArrayType(i)).visit(visitor);
1810 
1811     visitor.append(thisObject-&gt;m_speciesGetterSetter);
1812     thisObject-&gt;m_typedArrayProto.visit(visitor);
1813     thisObject-&gt;m_typedArraySuperConstructor.visit(visitor);
1814     thisObject-&gt;m_regExpGlobalData.visitAggregate(visitor);
1815 }
1816 
<span class="line-modified">1817 ExecState* JSGlobalObject::globalExec()</span>
1818 {
<span class="line-modified">1819     return CallFrame::create(m_globalCallFrame);</span>
1820 }
1821 
1822 void JSGlobalObject::exposeDollarVM(VM&amp; vm)
1823 {
<span class="line-modified">1824     if (hasOwnProperty(globalExec(), vm.propertyNames-&gt;builtinNames().dollarVMPrivateName()))</span>

1825         return;
1826 
1827     JSDollarVM* dollarVM = JSDollarVM::create(vm, JSDollarVM::createStructure(vm, this, m_objectPrototype.get()));
1828 
1829     GlobalPropertyInfo extraStaticGlobals[] = {
1830         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().dollarVMPrivateName(), dollarVM, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
1831     };
1832     addStaticGlobals(extraStaticGlobals, WTF_ARRAY_LENGTH(extraStaticGlobals));
1833 
1834     putDirect(vm, Identifier::fromString(vm, &quot;$vm&quot;), dollarVM, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
1835 }
1836 
1837 void JSGlobalObject::addStaticGlobals(GlobalPropertyInfo* globals, int count)
1838 {
1839     ScopeOffset startOffset = addVariables(count, jsUndefined());
1840 
1841     for (int i = 0; i &lt; count; ++i) {
1842         GlobalPropertyInfo&amp; global = globals[i];
1843         // This `configurable = false` is necessary condition for static globals,
1844         // otherwise lexical bindings can change the result of GlobalVar queries too.
1845         // We won&#39;t be able to declare a global lexical variable with the sanem name to
1846         // the static globals because configurable = false.
1847         ASSERT(global.attributes &amp; PropertyAttribute::DontDelete);
1848 
1849         WatchpointSet* watchpointSet = nullptr;
1850         WriteBarrierBase&lt;Unknown&gt;* variable = nullptr;
1851         {
1852             ConcurrentJSLocker locker(symbolTable()-&gt;m_lock);
1853             ScopeOffset offset = symbolTable()-&gt;takeNextScopeOffset(locker);
1854             RELEASE_ASSERT(offset == startOffset + i);
1855             SymbolTableEntry newEntry(VarOffset(offset), global.attributes);
1856             newEntry.prepareToWatch();
1857             watchpointSet = newEntry.watchpointSet();
1858             symbolTable()-&gt;add(locker, global.identifier.impl(), WTFMove(newEntry));
1859             variable = &amp;variableAt(offset);
1860         }
1861         symbolTablePutTouchWatchpointSet(vm(), this, global.identifier, global.value, variable, watchpointSet);
1862     }
1863 }
1864 
<span class="line-modified">1865 bool JSGlobalObject::getOwnPropertySlot(JSObject* object, ExecState* exec, PropertyName propertyName, PropertySlot&amp; slot)</span>
1866 {
<span class="line-modified">1867     if (Base::getOwnPropertySlot(object, exec, propertyName, slot))</span>
1868         return true;
1869     return symbolTableGet(jsCast&lt;JSGlobalObject*&gt;(object), propertyName, slot);
1870 }
1871 
1872 void JSGlobalObject::clearRareData(JSCell* cell)
1873 {
1874     jsCast&lt;JSGlobalObject*&gt;(cell)-&gt;m_rareData = nullptr;
1875 }
1876 
<span class="line-modified">1877 void JSGlobalObject::tryInstallArraySpeciesWatchpoint(ExecState* exec)</span>
1878 {
1879     RELEASE_ASSERT(!m_arrayPrototypeConstructorWatchpoint);
1880     RELEASE_ASSERT(!m_arrayConstructorSpeciesWatchpoint);
1881 
<span class="line-modified">1882     VM&amp; vm = exec-&gt;vm();</span>
1883     auto scope = DECLARE_THROW_SCOPE(vm);
1884 
1885     // First we need to make sure that the Array.prototype.constructor property points to Array
1886     // and that Array[Symbol.species] is the primordial GetterSetter.
1887     ArrayPrototype* arrayPrototype = this-&gt;arrayPrototype();
1888 
1889     // We only initialize once so flattening the structures does not have any real cost.
1890     Structure* prototypeStructure = arrayPrototype-&gt;structure(vm);
1891     if (prototypeStructure-&gt;isDictionary())
1892         prototypeStructure = prototypeStructure-&gt;flattenDictionaryStructure(vm, arrayPrototype);
1893     RELEASE_ASSERT(!prototypeStructure-&gt;isDictionary());
1894 
1895     ArrayConstructor* arrayConstructor = this-&gt;arrayConstructor();
1896 
1897     auto invalidateWatchpoint = [&amp;] {
1898         m_arraySpeciesWatchpointSet.invalidate(vm, StringFireDetail(&quot;Was not able to set up array species watchpoint.&quot;));
1899     };
1900 
1901     PropertySlot constructorSlot(arrayPrototype, PropertySlot::InternalMethodType::VMInquiry);
<span class="line-modified">1902     arrayPrototype-&gt;getOwnPropertySlot(arrayPrototype, exec, vm.propertyNames-&gt;constructor, constructorSlot);</span>
1903     scope.assertNoException();
1904     if (constructorSlot.slotBase() != arrayPrototype
1905         || !constructorSlot.isCacheableValue()
<span class="line-modified">1906         || constructorSlot.getValue(exec, vm.propertyNames-&gt;constructor) != arrayConstructor) {</span>
1907         invalidateWatchpoint();
1908         return;
1909     }
1910 
1911     Structure* constructorStructure = arrayConstructor-&gt;structure(vm);
1912     if (constructorStructure-&gt;isDictionary())
1913         constructorStructure = constructorStructure-&gt;flattenDictionaryStructure(vm, arrayConstructor);
1914 
1915     PropertySlot speciesSlot(arrayConstructor, PropertySlot::InternalMethodType::VMInquiry);
<span class="line-modified">1916     arrayConstructor-&gt;getOwnPropertySlot(arrayConstructor, exec, vm.propertyNames-&gt;speciesSymbol, speciesSlot);</span>
1917     scope.assertNoException();
1918     if (speciesSlot.slotBase() != arrayConstructor
1919         || !speciesSlot.isCacheableGetter()
1920         || speciesSlot.getterSetter() != speciesGetterSetter()) {
1921         invalidateWatchpoint();
1922         return;
1923     }
1924 
1925     // Now we need to setup the watchpoints to make sure these conditions remain valid.
1926     prototypeStructure-&gt;startWatchingPropertyForReplacements(vm, constructorSlot.cachedOffset());
1927     constructorStructure-&gt;startWatchingPropertyForReplacements(vm, speciesSlot.cachedOffset());
1928 
1929     ObjectPropertyCondition constructorCondition = ObjectPropertyCondition::equivalence(vm, arrayPrototype, arrayPrototype, vm.propertyNames-&gt;constructor.impl(), arrayConstructor);
1930     ObjectPropertyCondition speciesCondition = ObjectPropertyCondition::equivalence(vm, arrayPrototype, arrayConstructor, vm.propertyNames-&gt;speciesSymbol.impl(), speciesGetterSetter());
1931 
1932     if (!constructorCondition.isWatchable() || !speciesCondition.isWatchable()) {
1933         invalidateWatchpoint();
1934         return;
1935     }
1936 
1937     // We only watch this from the DFG, and the DFG makes sure to only start watching if the watchpoint is in the IsWatched state.
1938     RELEASE_ASSERT(!m_arraySpeciesWatchpointSet.isBeingWatched());
1939     m_arraySpeciesWatchpointSet.touch(vm, &quot;Set up array species watchpoint.&quot;);
1940 
1941     m_arrayPrototypeConstructorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, constructorCondition, m_arraySpeciesWatchpointSet);
1942     m_arrayPrototypeConstructorWatchpoint-&gt;install(vm);
1943 
1944     m_arrayConstructorSpeciesWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, speciesCondition, m_arraySpeciesWatchpointSet);
1945     m_arrayConstructorSpeciesWatchpoint-&gt;install(vm);
1946 }
1947 





































1948 void slowValidateCell(JSGlobalObject* globalObject)
1949 {
1950     RELEASE_ASSERT(globalObject-&gt;isGlobalObject());
1951     ASSERT_GC_OBJECT_INHERITS(globalObject, JSGlobalObject::info());
1952 }
1953 
1954 void JSGlobalObject::setRemoteDebuggingEnabled(bool enabled)
1955 {
1956 #if ENABLE(REMOTE_INSPECTOR)
1957     m_inspectorDebuggable-&gt;setRemoteDebuggingAllowed(enabled);
1958 #else
1959     UNUSED_PARAM(enabled);
1960 #endif
1961 }
1962 
1963 bool JSGlobalObject::remoteDebuggingEnabled() const
1964 {
1965 #if ENABLE(REMOTE_INSPECTOR)
1966     return m_inspectorDebuggable-&gt;remoteDebuggingAllowed();
1967 #else
1968     return false;
1969 #endif
1970 }
1971 
1972 void JSGlobalObject::setName(const String&amp; name)
1973 {
1974     m_name = name;
1975 
1976 #if ENABLE(REMOTE_INSPECTOR)
1977     m_inspectorDebuggable-&gt;update();
1978 #endif
1979 }
1980 
<span class="line-removed">1981 # if ENABLE(INTL)</span>
<span class="line-removed">1982 static void addMissingScriptLocales(HashSet&lt;String&gt;&amp; availableLocales)</span>
<span class="line-removed">1983 {</span>
<span class="line-removed">1984     if (availableLocales.contains(&quot;pa-Arab-PK&quot;))</span>
<span class="line-removed">1985         availableLocales.add(&quot;pa-PK&quot;_s);</span>
<span class="line-removed">1986     if (availableLocales.contains(&quot;zh-Hans-CN&quot;))</span>
<span class="line-removed">1987         availableLocales.add(&quot;zh-CN&quot;_s);</span>
<span class="line-removed">1988     if (availableLocales.contains(&quot;zh-Hant-HK&quot;))</span>
<span class="line-removed">1989         availableLocales.add(&quot;zh-HK&quot;_s);</span>
<span class="line-removed">1990     if (availableLocales.contains(&quot;zh-Hans-SG&quot;))</span>
<span class="line-removed">1991         availableLocales.add(&quot;zh-SG&quot;_s);</span>
<span class="line-removed">1992     if (availableLocales.contains(&quot;zh-Hant-TW&quot;))</span>
<span class="line-removed">1993         availableLocales.add(&quot;zh-TW&quot;_s);</span>
<span class="line-removed">1994 }</span>
<span class="line-removed">1995 </span>
<span class="line-removed">1996 const HashSet&lt;String&gt;&amp; JSGlobalObject::intlCollatorAvailableLocales()</span>
<span class="line-removed">1997 {</span>
<span class="line-removed">1998     if (m_intlCollatorAvailableLocales.isEmpty()) {</span>
<span class="line-removed">1999         int32_t count = ucol_countAvailable();</span>
<span class="line-removed">2000         for (int32_t i = 0; i &lt; count; ++i) {</span>
<span class="line-removed">2001             String locale = convertICULocaleToBCP47LanguageTag(ucol_getAvailable(i));</span>
<span class="line-removed">2002             if (!locale.isEmpty())</span>
<span class="line-removed">2003                 m_intlCollatorAvailableLocales.add(locale);</span>
<span class="line-removed">2004         }</span>
<span class="line-removed">2005         addMissingScriptLocales(m_intlCollatorAvailableLocales);</span>
<span class="line-removed">2006     }</span>
<span class="line-removed">2007     return m_intlCollatorAvailableLocales;</span>
<span class="line-removed">2008 }</span>
<span class="line-removed">2009 </span>
<span class="line-removed">2010 const HashSet&lt;String&gt;&amp; JSGlobalObject::intlDateTimeFormatAvailableLocales()</span>
<span class="line-removed">2011 {</span>
<span class="line-removed">2012     if (m_intlDateTimeFormatAvailableLocales.isEmpty()) {</span>
<span class="line-removed">2013         int32_t count = udat_countAvailable();</span>
<span class="line-removed">2014         for (int32_t i = 0; i &lt; count; ++i) {</span>
<span class="line-removed">2015             String locale = convertICULocaleToBCP47LanguageTag(udat_getAvailable(i));</span>
<span class="line-removed">2016             if (!locale.isEmpty())</span>
<span class="line-removed">2017                 m_intlDateTimeFormatAvailableLocales.add(locale);</span>
<span class="line-removed">2018         }</span>
<span class="line-removed">2019         addMissingScriptLocales(m_intlDateTimeFormatAvailableLocales);</span>
<span class="line-removed">2020     }</span>
<span class="line-removed">2021     return m_intlDateTimeFormatAvailableLocales;</span>
<span class="line-removed">2022 }</span>
<span class="line-removed">2023 </span>
<span class="line-removed">2024 const HashSet&lt;String&gt;&amp; JSGlobalObject::intlNumberFormatAvailableLocales()</span>
<span class="line-removed">2025 {</span>
<span class="line-removed">2026     if (m_intlNumberFormatAvailableLocales.isEmpty()) {</span>
<span class="line-removed">2027         int32_t count = unum_countAvailable();</span>
<span class="line-removed">2028         for (int32_t i = 0; i &lt; count; ++i) {</span>
<span class="line-removed">2029             String locale = convertICULocaleToBCP47LanguageTag(unum_getAvailable(i));</span>
<span class="line-removed">2030             if (!locale.isEmpty())</span>
<span class="line-removed">2031                 m_intlNumberFormatAvailableLocales.add(locale);</span>
<span class="line-removed">2032         }</span>
<span class="line-removed">2033         addMissingScriptLocales(m_intlNumberFormatAvailableLocales);</span>
<span class="line-removed">2034     }</span>
<span class="line-removed">2035     return m_intlNumberFormatAvailableLocales;</span>
<span class="line-removed">2036 }</span>
<span class="line-removed">2037 </span>
<span class="line-removed">2038 const HashSet&lt;String&gt;&amp; JSGlobalObject::intlPluralRulesAvailableLocales()</span>
<span class="line-removed">2039 {</span>
<span class="line-removed">2040     if (m_intlPluralRulesAvailableLocales.isEmpty()) {</span>
<span class="line-removed">2041         int32_t count = uloc_countAvailable();</span>
<span class="line-removed">2042         for (int32_t i = 0; i &lt; count; ++i) {</span>
<span class="line-removed">2043             String locale = convertICULocaleToBCP47LanguageTag(uloc_getAvailable(i));</span>
<span class="line-removed">2044             if (!locale.isEmpty())</span>
<span class="line-removed">2045                 m_intlPluralRulesAvailableLocales.add(locale);</span>
<span class="line-removed">2046         }</span>
<span class="line-removed">2047         addMissingScriptLocales(m_intlPluralRulesAvailableLocales);</span>
<span class="line-removed">2048     }</span>
<span class="line-removed">2049     return m_intlPluralRulesAvailableLocales;</span>
<span class="line-removed">2050 }</span>
<span class="line-removed">2051 </span>
<span class="line-removed">2052 IntlCollator* JSGlobalObject::defaultCollator(ExecState* exec)</span>
<span class="line-removed">2053 {</span>
<span class="line-removed">2054     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-removed">2055     auto scope = DECLARE_THROW_SCOPE(vm);</span>
<span class="line-removed">2056 </span>
<span class="line-removed">2057     if (m_defaultCollator)</span>
<span class="line-removed">2058         return m_defaultCollator.get();</span>
<span class="line-removed">2059 </span>
<span class="line-removed">2060     IntlCollator* collator = IntlCollator::create(vm, collatorStructure());</span>
<span class="line-removed">2061     collator-&gt;initializeCollator(*exec, jsUndefined(), jsUndefined());</span>
<span class="line-removed">2062     RETURN_IF_EXCEPTION(scope, nullptr);</span>
<span class="line-removed">2063     m_defaultCollator.set(vm, this, collator);</span>
<span class="line-removed">2064     return collator;</span>
<span class="line-removed">2065 }</span>
<span class="line-removed">2066 </span>
<span class="line-removed">2067 #endif // ENABLE(INTL)</span>
<span class="line-removed">2068 </span>
2069 void JSGlobalObject::bumpGlobalLexicalBindingEpoch(VM&amp; vm)
2070 {
2071     if (++m_globalLexicalBindingEpoch == Options::thresholdForGlobalLexicalBindingEpoch()) {
2072         // Since the epoch overflows, we should rewrite all the CodeBlock to adjust to the newly started generation.
2073         m_globalLexicalBindingEpoch = 1;
2074         vm.heap.codeBlockSet().iterate([&amp;] (CodeBlock* codeBlock) {
2075             if (codeBlock-&gt;globalObject() != this)
2076                 return;
2077             codeBlock-&gt;notifyLexicalBindingUpdate();
2078         });
2079     }
2080 }
2081 
2082 void JSGlobalObject::queueMicrotask(Ref&lt;Microtask&gt;&amp;&amp; task)
2083 {
2084     if (globalObjectMethodTable()-&gt;queueTaskToEventLoop) {
2085         globalObjectMethodTable()-&gt;queueTaskToEventLoop(*this, WTFMove(task));
2086         return;
2087     }
2088 
</pre>
<hr />
<pre>
2118     ConcurrentJSLocker locker(m_referencedGlobalPropertyWatchpointSetsLock);
2119     return m_referencedGlobalPropertyWatchpointSets.ensure(uid, [] {
2120         return WatchpointSet::create(IsWatched);
2121     }).iterator-&gt;value.get();
2122 }
2123 #endif
2124 
2125 JSGlobalObject* JSGlobalObject::create(VM&amp; vm, Structure* structure)
2126 {
2127     JSGlobalObject* globalObject = new (NotNull, allocateCell&lt;JSGlobalObject&gt;(vm.heap)) JSGlobalObject(vm, structure);
2128     globalObject-&gt;finishCreation(vm);
2129     return globalObject;
2130 }
2131 
2132 void JSGlobalObject::finishCreation(VM&amp; vm)
2133 {
2134     Base::finishCreation(vm);
2135     structure(vm)-&gt;setGlobalObject(vm, this);
2136     m_runtimeFlags = m_globalObjectMethodTable-&gt;javaScriptRuntimeFlags(this);
2137     init(vm);
<span class="line-modified">2138     setGlobalThis(vm, JSNonDestructibleProxy::create(vm, JSNonDestructibleProxy::createStructure(vm, this, getPrototypeDirect(vm), PureForwardingProxyType), this));</span>
2139     ASSERT(type() == GlobalObjectType);
2140 }
2141 
2142 void JSGlobalObject::finishCreation(VM&amp; vm, JSObject* thisValue)
2143 {
2144     Base::finishCreation(vm);
2145     structure(vm)-&gt;setGlobalObject(vm, this);
2146     m_runtimeFlags = m_globalObjectMethodTable-&gt;javaScriptRuntimeFlags(this);
2147     init(vm);
2148     setGlobalThis(vm, thisValue);
2149     ASSERT(type() == GlobalObjectType);
2150 }
2151 
2152 #ifdef JSC_GLIB_API_ENABLED
2153 void JSGlobalObject::setWrapperMap(std::unique_ptr&lt;WrapperMap&gt;&amp;&amp; map)
2154 {
2155     m_wrapperMap = WTFMove(map);
2156 }
2157 #endif
2158 
</pre>
</td>
<td>
<hr />
<pre>
  62 #include &quot;ECMAScriptSpecInternalFunctions.h&quot;
  63 #include &quot;Error.h&quot;
  64 #include &quot;ErrorConstructor.h&quot;
  65 #include &quot;ErrorPrototype.h&quot;
  66 #include &quot;Exception.h&quot;
  67 #include &quot;FunctionConstructor.h&quot;
  68 #include &quot;FunctionPrototype.h&quot;
  69 #include &quot;GeneratorFunctionConstructor.h&quot;
  70 #include &quot;GeneratorFunctionPrototype.h&quot;
  71 #include &quot;GeneratorPrototype.h&quot;
  72 #include &quot;GetterSetter.h&quot;
  73 #include &quot;HeapIterationScope.h&quot;
  74 #include &quot;IndirectEvalExecutable.h&quot;
  75 #include &quot;InspectorInstrumentationObject.h&quot;
  76 #include &quot;Interpreter.h&quot;
  77 #include &quot;IteratorPrototype.h&quot;
  78 #include &quot;JSAPIWrapperObject.h&quot;
  79 #include &quot;JSArrayBuffer.h&quot;
  80 #include &quot;JSArrayBufferConstructor.h&quot;
  81 #include &quot;JSArrayBufferPrototype.h&quot;
<span class="line-added">  82 #include &quot;JSArrayIterator.h&quot;</span>
  83 #include &quot;JSAsyncFunction.h&quot;
<span class="line-added">  84 #include &quot;JSAsyncGenerator.h&quot;</span>
  85 #include &quot;JSAsyncGeneratorFunction.h&quot;
  86 #include &quot;JSBigInt.h&quot;
  87 #include &quot;JSBoundFunction.h&quot;
  88 #include &quot;JSCInlines.h&quot;
  89 #include &quot;JSCallbackConstructor.h&quot;
  90 #include &quot;JSCallbackFunction.h&quot;
  91 #include &quot;JSCallbackObject.h&quot;
  92 #include &quot;JSCustomGetterSetterFunction.h&quot;
  93 #include &quot;JSDataView.h&quot;
  94 #include &quot;JSDataViewPrototype.h&quot;
  95 #include &quot;JSDollarVM.h&quot;
  96 #include &quot;JSFunction.h&quot;
<span class="line-added">  97 #include &quot;JSGenerator.h&quot;</span>
  98 #include &quot;JSGeneratorFunction.h&quot;
  99 #include &quot;JSGenericTypedArrayViewConstructorInlines.h&quot;
 100 #include &quot;JSGenericTypedArrayViewInlines.h&quot;
 101 #include &quot;JSGenericTypedArrayViewPrototypeInlines.h&quot;
 102 #include &quot;JSGlobalObjectFunctions.h&quot;
 103 #include &quot;JSInternalPromise.h&quot;
 104 #include &quot;JSInternalPromiseConstructor.h&quot;
 105 #include &quot;JSInternalPromisePrototype.h&quot;
 106 #include &quot;JSLexicalEnvironment.h&quot;
 107 #include &quot;JSLock.h&quot;
 108 #include &quot;JSMap.h&quot;
 109 #include &quot;JSMicrotask.h&quot;
 110 #include &quot;JSModuleEnvironment.h&quot;
 111 #include &quot;JSModuleLoader.h&quot;
 112 #include &quot;JSModuleNamespaceObject.h&quot;
 113 #include &quot;JSModuleRecord.h&quot;
 114 #include &quot;JSNativeStdFunction.h&quot;

 115 #include &quot;JSONObject.h&quot;
 116 #include &quot;JSPromise.h&quot;
 117 #include &quot;JSPromiseConstructor.h&quot;
 118 #include &quot;JSPromisePrototype.h&quot;
 119 #include &quot;JSSet.h&quot;
 120 #include &quot;JSStringIterator.h&quot;
 121 #include &quot;JSTypedArrayConstructors.h&quot;
 122 #include &quot;JSTypedArrayPrototypes.h&quot;
 123 #include &quot;JSTypedArrayViewConstructor.h&quot;
 124 #include &quot;JSTypedArrayViewPrototype.h&quot;
 125 #include &quot;JSTypedArrays.h&quot;
 126 #include &quot;JSWeakMap.h&quot;
 127 #include &quot;JSWeakObjectRef.h&quot;
 128 #include &quot;JSWeakSet.h&quot;
 129 #include &quot;JSWebAssembly.h&quot;
 130 #include &quot;JSWebAssemblyCompileError.h&quot;
<span class="line-added"> 131 #include &quot;JSWebAssemblyGlobal.h&quot;</span>
 132 #include &quot;JSWebAssemblyInstance.h&quot;
 133 #include &quot;JSWebAssemblyLinkError.h&quot;
 134 #include &quot;JSWebAssemblyMemory.h&quot;
 135 #include &quot;JSWebAssemblyModule.h&quot;
 136 #include &quot;JSWebAssemblyRuntimeError.h&quot;
 137 #include &quot;JSWebAssemblyTable.h&quot;
 138 #include &quot;JSWithScope.h&quot;
 139 #include &quot;LazyClassStructureInlines.h&quot;
 140 #include &quot;LazyPropertyInlines.h&quot;
<span class="line-added"> 141 #include &quot;LinkTimeConstant.h&quot;</span>
 142 #include &quot;Lookup.h&quot;
 143 #include &quot;MapConstructor.h&quot;
 144 #include &quot;MapIteratorPrototype.h&quot;
 145 #include &quot;MapPrototype.h&quot;
 146 #include &quot;MarkedSpaceInlines.h&quot;
 147 #include &quot;MathObject.h&quot;
 148 #include &quot;Microtask.h&quot;
 149 #include &quot;NativeErrorConstructor.h&quot;
 150 #include &quot;NativeErrorPrototype.h&quot;
 151 #include &quot;NullGetterFunction.h&quot;
 152 #include &quot;NullSetterFunction.h&quot;
 153 #include &quot;NumberConstructor.h&quot;
 154 #include &quot;NumberPrototype.h&quot;
 155 #include &quot;ObjCCallbackFunction.h&quot;
 156 #include &quot;ObjectConstructor.h&quot;
 157 #include &quot;ObjectPropertyChangeAdaptiveWatchpoint.h&quot;
 158 #include &quot;ObjectPropertyConditionSet.h&quot;
 159 #include &quot;ObjectPrototype.h&quot;
 160 #include &quot;ParserError.h&quot;
 161 #include &quot;ProxyConstructor.h&quot;
</pre>
<hr />
<pre>
 175 #include &quot;StrictEvalActivation.h&quot;
 176 #include &quot;StringConstructor.h&quot;
 177 #include &quot;StringIteratorPrototype.h&quot;
 178 #include &quot;StringPrototype.h&quot;
 179 #include &quot;Symbol.h&quot;
 180 #include &quot;SymbolConstructor.h&quot;
 181 #include &quot;SymbolObject.h&quot;
 182 #include &quot;SymbolPrototype.h&quot;
 183 #include &quot;VariableWriteFireDetail.h&quot;
 184 #include &quot;WasmCapabilities.h&quot;
 185 #include &quot;WeakGCMapInlines.h&quot;
 186 #include &quot;WeakMapConstructor.h&quot;
 187 #include &quot;WeakMapPrototype.h&quot;
 188 #include &quot;WeakObjectRefConstructor.h&quot;
 189 #include &quot;WeakObjectRefPrototype.h&quot;
 190 #include &quot;WeakSetConstructor.h&quot;
 191 #include &quot;WeakSetPrototype.h&quot;
 192 #include &quot;WebAssemblyCompileErrorConstructor.h&quot;
 193 #include &quot;WebAssemblyCompileErrorPrototype.h&quot;
 194 #include &quot;WebAssemblyFunction.h&quot;
<span class="line-added"> 195 #include &quot;WebAssemblyGlobalConstructor.h&quot;</span>
<span class="line-added"> 196 #include &quot;WebAssemblyGlobalPrototype.h&quot;</span>
 197 #include &quot;WebAssemblyInstanceConstructor.h&quot;
 198 #include &quot;WebAssemblyInstancePrototype.h&quot;
 199 #include &quot;WebAssemblyLinkErrorConstructor.h&quot;
 200 #include &quot;WebAssemblyLinkErrorPrototype.h&quot;
 201 #include &quot;WebAssemblyMemoryConstructor.h&quot;
 202 #include &quot;WebAssemblyMemoryPrototype.h&quot;
 203 #include &quot;WebAssemblyModuleConstructor.h&quot;
 204 #include &quot;WebAssemblyModulePrototype.h&quot;
 205 #include &quot;WebAssemblyModuleRecord.h&quot;
 206 #include &quot;WebAssemblyRuntimeErrorConstructor.h&quot;
 207 #include &quot;WebAssemblyRuntimeErrorPrototype.h&quot;
 208 #include &quot;WebAssemblyTableConstructor.h&quot;
 209 #include &quot;WebAssemblyTablePrototype.h&quot;

 210 #include &lt;wtf/RandomNumber.h&gt;
 211 
 212 #if ENABLE(INTL)
 213 #include &quot;IntlCollator.h&quot;
 214 #include &quot;IntlCollatorPrototype.h&quot;
 215 #include &quot;IntlDateTimeFormat.h&quot;
 216 #include &quot;IntlDateTimeFormatPrototype.h&quot;
 217 #include &quot;IntlNumberFormat.h&quot;
 218 #include &quot;IntlNumberFormatPrototype.h&quot;
 219 #include &quot;IntlObject.h&quot;
 220 #include &quot;IntlPluralRules.h&quot;
 221 #include &quot;IntlPluralRulesPrototype.h&quot;



 222 #endif // ENABLE(INTL)
 223 
 224 #if ENABLE(REMOTE_INSPECTOR)
 225 #include &quot;JSGlobalObjectDebuggable.h&quot;
 226 #include &quot;JSGlobalObjectInspectorController.h&quot;
 227 #endif
 228 
 229 #ifdef JSC_GLIB_API_ENABLED
 230 #include &quot;JSCCallbackFunction.h&quot;
 231 #include &quot;JSCWrapperMap.h&quot;
 232 #endif
 233 
 234 namespace JSC {
 235 
 236 #define CHECK_FEATURE_FLAG_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 237 static_assert(std::is_same_v&lt;std::remove_cv_t&lt;decltype(featureFlag)&gt;, bool&gt; || std::is_same_v&lt;std::remove_cv_t&lt;decltype(featureFlag)&gt;, bool&amp;&gt;);
 238 
 239 FOR_EACH_SIMPLE_BUILTIN_TYPE(CHECK_FEATURE_FLAG_TYPE)
 240 FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(CHECK_FEATURE_FLAG_TYPE)
 241 FOR_EACH_LAZY_BUILTIN_TYPE(CHECK_FEATURE_FLAG_TYPE)
</pre>
<hr />
<pre>
 250 {
 251     JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);
 252     return JSONObject::create(vm, JSONObject::createStructure(vm, global, global-&gt;objectPrototype()));
 253 }
 254 
 255 static JSValue createMathProperty(VM&amp; vm, JSObject* object)
 256 {
 257     JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);
 258     return MathObject::create(vm, global, MathObject::createStructure(vm, global, global-&gt;objectPrototype()));
 259 }
 260 
 261 static JSValue createReflectProperty(VM&amp; vm, JSObject* object)
 262 {
 263     JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);
 264     return ReflectObject::create(vm, global, ReflectObject::createStructure(vm, global, global-&gt;objectPrototype()));
 265 }
 266 
 267 static JSValue createConsoleProperty(VM&amp; vm, JSObject* object)
 268 {
 269     JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);
<span class="line-modified"> 270     return ConsoleObject::create(vm, global, ConsoleObject::createStructure(vm, global, constructEmptyObject(global)));</span>
 271 }
 272 
<span class="line-modified"> 273 static EncodedJSValue JSC_HOST_CALL makeBoundFunction(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
 274 {
<span class="line-modified"> 275     VM&amp; vm = globalObject-&gt;vm();</span>
 276     auto scope = DECLARE_THROW_SCOPE(vm);
 277 
<span class="line-modified"> 278     JSObject* target = asObject(callFrame-&gt;uncheckedArgument(0));</span>
<span class="line-modified"> 279     JSValue boundThis = callFrame-&gt;uncheckedArgument(1);</span>
<span class="line-modified"> 280     JSValue boundArgs = callFrame-&gt;uncheckedArgument(2);</span>
<span class="line-modified"> 281     JSValue lengthValue = callFrame-&gt;uncheckedArgument(3);</span>
<span class="line-modified"> 282     JSString* nameString = asString(callFrame-&gt;uncheckedArgument(4));</span>


 283 
 284     ASSERT(lengthValue.isInt32AsAnyInt());
 285     int32_t length = lengthValue.asInt32AsAnyInt();
 286 
<span class="line-modified"> 287     RELEASE_AND_RETURN(scope, JSValue::encode(JSBoundFunction::create(vm, globalObject, target, boundThis, boundArgs.isCell() ? jsCast&lt;JSImmutableButterfly*&gt;(boundArgs) : nullptr, length, nameString)));</span>



 288 }
 289 
<span class="line-modified"> 290 static EncodedJSValue JSC_HOST_CALL hasOwnLengthProperty(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
 291 {
<span class="line-modified"> 292     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified"> 293 </span>
<span class="line-modified"> 294     JSObject* target = asObject(callFrame-&gt;uncheckedArgument(0));</span>
<span class="line-added"> 295     JSFunction* function = jsDynamicCast&lt;JSFunction*&gt;(vm, target);</span>
<span class="line-added"> 296     if (function)</span>
<span class="line-added"> 297         return JSValue::encode(jsBoolean(function-&gt;areNameAndLengthOriginal(vm)));</span>
<span class="line-added"> 298     return JSValue::encode(jsBoolean(target-&gt;hasOwnProperty(globalObject, vm.propertyNames-&gt;length)));</span>
 299 }
 300 
<span class="line-modified"> 301 #if ASSERT_ENABLED</span>
<span class="line-modified"> 302 static EncodedJSValue JSC_HOST_CALL assertCall(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
 303 {
<span class="line-modified"> 304     RELEASE_ASSERT(callFrame-&gt;argument(0).isBoolean());</span>
<span class="line-modified"> 305     if (callFrame-&gt;argument(0).asBoolean())</span>
 306         return JSValue::encode(jsUndefined());
 307 
 308     bool iteratedOnce = false;
 309     CodeBlock* codeBlock = nullptr;
 310     unsigned line;
<span class="line-modified"> 311     callFrame-&gt;iterate(globalObject-&gt;vm(), [&amp;] (StackVisitor&amp; visitor) {</span>
 312         if (!iteratedOnce) {
 313             iteratedOnce = true;
 314             return StackVisitor::Continue;
 315         }
 316 
 317         RELEASE_ASSERT(visitor-&gt;hasLineAndColumnInfo());
 318         unsigned column;
 319         visitor-&gt;computeLineAndColumn(line, column);
 320         codeBlock = visitor-&gt;codeBlock();
 321         return StackVisitor::Done;
 322     });
 323     RELEASE_ASSERT(!!codeBlock);
 324     RELEASE_ASSERT_WITH_MESSAGE(false, &quot;JS assertion failed at line %u in:\n%s\n&quot;, line, codeBlock-&gt;sourceCodeForTools().data());
 325     return JSValue::encode(jsUndefined());
 326 }
<span class="line-modified"> 327 #endif // ASSERT_ENABLED</span>
 328 
 329 } // namespace JSC
 330 
 331 #include &quot;JSGlobalObject.lut.h&quot;
 332 
 333 namespace JSC {
 334 
 335 const ClassInfo JSGlobalObject::s_info = { &quot;GlobalObject&quot;, &amp;Base::s_info, &amp;globalObjectTable, nullptr, CREATE_METHOD_TABLE(JSGlobalObject) };
 336 
 337 const GlobalObjectMethodTable JSGlobalObject::s_globalObjectMethodTable = {
 338     &amp;supportsRichSourceInfo,
 339     &amp;shouldInterruptScript,
 340     &amp;javaScriptRuntimeFlags,
 341     nullptr, // queueTaskToEventLoop
 342     &amp;shouldInterruptScriptBeforeTimeout,
 343     nullptr, // moduleLoaderImportModule
 344     nullptr, // moduleLoaderResolve
 345     nullptr, // moduleLoaderFetch
 346     nullptr, // moduleLoaderCreateImportMetaProperties
 347     nullptr, // moduleLoaderEvaluate
</pre>
<hr />
<pre>
 373   TypeError             JSGlobalObject::m_typeErrorStructure         DontEnum|ClassStructure
 374   URIError              JSGlobalObject::m_URIErrorStructure          DontEnum|ClassStructure
 375   Proxy                 createProxyProperty                          DontEnum|PropertyCallback
 376   Reflect               createReflectProperty                        DontEnum|PropertyCallback
 377   JSON                  createJSONProperty                           DontEnum|PropertyCallback
 378   Math                  createMathProperty                           DontEnum|PropertyCallback
 379   console               createConsoleProperty                        DontEnum|PropertyCallback
 380   Int8Array             JSGlobalObject::m_typedArrayInt8             DontEnum|ClassStructure
 381   Int16Array            JSGlobalObject::m_typedArrayInt16            DontEnum|ClassStructure
 382   Int32Array            JSGlobalObject::m_typedArrayInt32            DontEnum|ClassStructure
 383   Uint8Array            JSGlobalObject::m_typedArrayUint8            DontEnum|ClassStructure
 384   Uint8ClampedArray     JSGlobalObject::m_typedArrayUint8Clamped     DontEnum|ClassStructure
 385   Uint16Array           JSGlobalObject::m_typedArrayUint16           DontEnum|ClassStructure
 386   Uint32Array           JSGlobalObject::m_typedArrayUint32           DontEnum|ClassStructure
 387   Float32Array          JSGlobalObject::m_typedArrayFloat32          DontEnum|ClassStructure
 388   Float64Array          JSGlobalObject::m_typedArrayFloat64          DontEnum|ClassStructure
 389   DataView              JSGlobalObject::m_typedArrayDataView         DontEnum|ClassStructure
 390   Date                  JSGlobalObject::m_dateStructure              DontEnum|ClassStructure
 391   Error                 JSGlobalObject::m_errorStructure             DontEnum|ClassStructure
 392   Boolean               JSGlobalObject::m_booleanObjectStructure     DontEnum|ClassStructure
<span class="line-added"> 393   Map                   JSGlobalObject::m_mapStructure               DontEnum|ClassStructure</span>
 394   Number                JSGlobalObject::m_numberObjectStructure      DontEnum|ClassStructure
<span class="line-added"> 395   Set                   JSGlobalObject::m_setStructure               DontEnum|ClassStructure</span>
 396   Symbol                JSGlobalObject::m_symbolObjectStructure      DontEnum|ClassStructure
 397   WeakMap               JSGlobalObject::m_weakMapStructure           DontEnum|ClassStructure
 398   WeakSet               JSGlobalObject::m_weakSetStructure           DontEnum|ClassStructure
 399 @end
 400 */
 401 
<span class="line-modified"> 402 static EncodedJSValue JSC_HOST_CALL enqueueJob(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
 403 {
<span class="line-modified"> 404     VM&amp; vm = globalObject-&gt;vm();</span>

 405 
<span class="line-modified"> 406     JSValue job = callFrame-&gt;argument(0);</span>
<span class="line-modified"> 407     JSValue argument0 = callFrame-&gt;argument(1);</span>
<span class="line-modified"> 408     JSValue argument1 = callFrame-&gt;argument(2);</span>
<span class="line-added"> 409     JSValue argument2 = callFrame-&gt;argument(3);</span>
 410 
<span class="line-modified"> 411     globalObject-&gt;queueMicrotask(createJSMicrotask(vm, job, argument0, argument1, argument2));</span>
 412 
 413     return JSValue::encode(jsUndefined());
 414 }
 415 
 416 JSGlobalObject::JSGlobalObject(VM&amp; vm, Structure* structure, const GlobalObjectMethodTable* globalObjectMethodTable)
 417     : Base(vm, structure, 0)
<span class="line-modified"> 418     , m_vm(&amp;vm)</span>
<span class="line-added"> 419     , m_linkTimeConstants(numberOfLinkTimeConstants)</span>
 420     , m_masqueradesAsUndefinedWatchpoint(adoptRef(new WatchpointSet(IsWatched)))
 421     , m_havingABadTimeWatchpoint(adoptRef(new WatchpointSet(IsWatched)))
 422     , m_varInjectionWatchpoint(adoptRef(new WatchpointSet(IsWatched)))
 423     , m_weakRandom(Options::forceWeakRandomSeed() ? Options::forcedWeakRandomSeed() : static_cast&lt;unsigned&gt;(randomNumber() * (std::numeric_limits&lt;unsigned&gt;::max() + 1.0)))
 424     , m_arrayIteratorProtocolWatchpointSet(IsWatched)
 425     , m_mapIteratorProtocolWatchpointSet(IsWatched)
 426     , m_setIteratorProtocolWatchpointSet(IsWatched)
 427     , m_stringIteratorProtocolWatchpointSet(IsWatched)
 428     , m_mapSetWatchpointSet(IsWatched)
 429     , m_setAddWatchpointSet(IsWatched)
 430     , m_arraySpeciesWatchpointSet(ClearWatchpoint)
 431     , m_arrayJoinWatchpointSet(IsWatched)
 432     , m_numberToStringWatchpointSet(IsWatched)
 433     , m_runtimeFlags()
 434     , m_stackTraceLimit(Options::defaultErrorStackTraceLimit())
 435     , m_globalObjectMethodTable(globalObjectMethodTable ? globalObjectMethodTable : &amp;s_globalObjectMethodTable)
 436 {
 437 }
 438 
 439 JSGlobalObject::~JSGlobalObject()
 440 {
 441 #if ENABLE(REMOTE_INSPECTOR)
 442     m_inspectorController-&gt;globalObjectDestroyed();
 443 #endif
 444 
 445     if (m_debugger)
 446         m_debugger-&gt;detach(this, Debugger::GlobalObjectIsDestructing);
 447 }
 448 
 449 void JSGlobalObject::destroy(JSCell* cell)
 450 {
 451     static_cast&lt;JSGlobalObject*&gt;(cell)-&gt;JSGlobalObject::~JSGlobalObject();
 452 }
 453 
 454 void JSGlobalObject::setGlobalThis(VM&amp; vm, JSObject* globalThis)
 455 {
 456     m_globalThis.set(vm, this, globalThis);
 457 }
 458 
<span class="line-modified"> 459 static GetterSetter* getGetterById(JSGlobalObject* globalObject, JSObject* base, const Identifier&amp; ident)</span>
 460 {
 461     JSValue baseValue = JSValue(base);
 462     PropertySlot slot(baseValue, PropertySlot::InternalMethodType::VMInquiry);
<span class="line-modified"> 463     baseValue.getPropertySlot(globalObject, ident, slot);</span>
<span class="line-modified"> 464     return jsCast&lt;GetterSetter*&gt;(slot.getPureResult());</span>
<span class="line-added"> 465 }</span>
<span class="line-added"> 466 </span>
<span class="line-added"> 467 static ObjectPropertyCondition setupAdaptiveWatchpoint(JSGlobalObject* globalObject, JSObject* base, const Identifier&amp; ident)</span>
<span class="line-added"> 468 {</span>
<span class="line-added"> 469     // Performing these gets should not throw.</span>
<span class="line-added"> 470     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-added"> 471     auto catchScope = DECLARE_CATCH_SCOPE(vm);</span>
<span class="line-added"> 472     PropertySlot slot(base, PropertySlot::InternalMethodType::Get);</span>
<span class="line-added"> 473     bool result = base-&gt;getOwnPropertySlot(base, globalObject, ident, slot);</span>
<span class="line-added"> 474     ASSERT_UNUSED(result, result);</span>
<span class="line-added"> 475     catchScope.assertNoException();</span>
<span class="line-added"> 476     RELEASE_ASSERT(slot.isCacheableValue());</span>
<span class="line-added"> 477     JSValue functionValue = slot.getValue(globalObject, ident);</span>
<span class="line-added"> 478     catchScope.assertNoException();</span>
<span class="line-added"> 479     ASSERT(jsDynamicCast&lt;JSFunction*&gt;(vm, functionValue));</span>
<span class="line-added"> 480 </span>
<span class="line-added"> 481     ObjectPropertyCondition condition = generateConditionForSelfEquivalence(vm, nullptr, base, ident.impl());</span>
<span class="line-added"> 482     RELEASE_ASSERT(condition.requiredValue() == functionValue);</span>
<span class="line-added"> 483 </span>
<span class="line-added"> 484     bool isWatchable = condition.isWatchable(PropertyCondition::EnsureWatchability);</span>
<span class="line-added"> 485     RELEASE_ASSERT(isWatchable); // We allow this to install the necessary watchpoints.</span>
<span class="line-added"> 486 </span>
<span class="line-added"> 487     return condition;</span>
 488 }
 489 
 490 template&lt;ErrorType errorType&gt;
 491 void JSGlobalObject::initializeErrorConstructor(LazyClassStructure::Initializer&amp; init)
 492 {
 493     init.setPrototype(NativeErrorPrototype::create(init.vm, NativeErrorPrototype::createStructure(init.vm, this, m_errorStructure.prototype(this)), errorTypeName(errorType)));
 494     init.setStructure(ErrorInstance::createStructure(init.vm, this, init.prototype));
 495     init.setConstructor(NativeErrorConstructor&lt;errorType&gt;::create(init.vm, NativeErrorConstructor&lt;errorType&gt;::createStructure(init.vm, this, m_errorStructure.constructor(this)), jsCast&lt;NativeErrorPrototype*&gt;(init.prototype)));
 496 }
 497 
 498 void JSGlobalObject::init(VM&amp; vm)
 499 {
 500     ASSERT(vm.currentThreadIsHoldingAPILock());
 501     auto catchScope = DECLARE_CATCH_SCOPE(vm);
 502 
 503     Base::setStructure(vm, Structure::toCacheableDictionaryTransition(vm, structure(vm)));
 504 
 505     m_debugger = 0;
 506 
 507 #if ENABLE(REMOTE_INSPECTOR)
 508     m_inspectorController = makeUnique&lt;Inspector::JSGlobalObjectInspectorController&gt;(*this);
 509     m_inspectorDebuggable = makeUnique&lt;JSGlobalObjectDebuggable&gt;(*this);
 510     m_inspectorDebuggable-&gt;init();
 511     m_consoleClient = m_inspectorController-&gt;consoleClient();
 512 #endif
 513 
 514     m_functionPrototype.set(vm, this, FunctionPrototype::create(vm, FunctionPrototype::createStructure(vm, this, jsNull()))); // The real prototype will be set once ObjectPrototype is created.
 515     m_calleeStructure.set(vm, this, JSCallee::createStructure(vm, this, jsNull()));
 516 
 517     m_globalLexicalEnvironment.set(vm, this, JSGlobalLexicalEnvironment::create(vm, JSGlobalLexicalEnvironment::createStructure(vm, this), this));
<span class="line-added"> 518 </span>
 519     // Need to create the callee structure (above) before creating the callee.
 520     JSCallee* globalCallee = JSCallee::create(vm, this, globalScope());
 521     m_globalCallee.set(vm, this, globalCallee);
 522 
<span class="line-modified"> 523     CallFrame::initDeprecatedCallFrameForDebugger(JSGlobalObject::deprecatedCallFrameForDebugger(), globalCallee);</span>

 524 
 525     JSCallee* stackOverflowFrameCallee = JSCallee::create(vm, this, globalScope());
 526     m_stackOverflowFrameCallee.set(vm, this, stackOverflowFrameCallee);
 527 
 528     m_hostFunctionStructure.set(vm, this, JSFunction::createStructure(vm, this, m_functionPrototype.get()));
 529 
 530     auto initFunctionStructures = [&amp;] (FunctionStructures&amp; structures) {
 531         structures.strictFunctionStructure.set(vm, this, JSStrictFunction::createStructure(vm, this, m_functionPrototype.get()));
 532         structures.sloppyFunctionStructure.set(vm, this, JSSloppyFunction::createStructure(vm, this, m_functionPrototype.get()));
 533         structures.arrowFunctionStructure.set(vm, this, JSArrowFunction::createStructure(vm, this, m_functionPrototype.get()));
 534     };
 535     initFunctionStructures(m_builtinFunctions);
 536     initFunctionStructures(m_ordinaryFunctions);
 537 
 538     m_customGetterSetterFunctionStructure.initLater(
 539         [] (const Initializer&lt;Structure&gt;&amp; init) {
 540             init.set(JSCustomGetterSetterFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 541         });
 542     m_boundFunctionStructure.initLater(
 543         [] (const Initializer&lt;Structure&gt;&amp; init) {
 544             init.set(JSBoundFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 545         });

 546     m_nativeStdFunctionStructure.initLater(
 547         [] (const Initializer&lt;Structure&gt;&amp; init) {
 548             init.set(JSNativeStdFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 549         });
 550     JSFunction* callFunction = nullptr;
 551     JSFunction* applyFunction = nullptr;
 552     JSFunction* hasInstanceSymbolFunction = nullptr;
 553     m_functionPrototype-&gt;addFunctionProperties(vm, this, &amp;callFunction, &amp;applyFunction, &amp;hasInstanceSymbolFunction);


 554     m_arrayProtoToStringFunction.initLater(
 555         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
 556             init.set(JSFunction::create(init.vm, init.owner, 0, init.vm.propertyNames-&gt;toString.string(), arrayProtoFuncToString, NoIntrinsic));
 557         });
 558     m_arrayProtoValuesFunction.initLater(
 559         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
<span class="line-modified"> 560             init.set(JSFunction::create(init.vm, init.owner, 0, init.vm.propertyNames-&gt;values.string(), arrayProtoFuncValues, ArrayValuesIntrinsic));</span>




 561         });
 562 
 563     m_iteratorProtocolFunction.initLater(
 564         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
 565             init.set(JSFunction::create(init.vm, iteratorHelpersPerformIterationCodeGenerator(init.vm), init.owner));
 566         });
 567 
 568     m_promiseResolveFunction.initLater(
 569         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
 570             init.set(JSFunction::create(init.vm, promiseConstructorResolveCodeGenerator(init.vm), init.owner));
 571         });
 572 
<span class="line-modified"> 573     m_numberProtoToStringFunction.initLater(</span>
<span class="line-added"> 574         [] (const Initializer&lt;JSFunction&gt;&amp; init) {</span>
<span class="line-added"> 575             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, init.vm.propertyNames-&gt;toString.string(), numberProtoFuncToString, NumberPrototypeToStringIntrinsic));</span>
<span class="line-added"> 576         });</span>
<span class="line-added"> 577 </span>
 578     m_functionProtoHasInstanceSymbolFunction.set(vm, this, hasInstanceSymbolFunction);
 579     m_throwTypeErrorGetterSetter.initLater(
 580         [] (const Initializer&lt;GetterSetter&gt;&amp; init) {
 581             JSFunction* thrower = init.owner-&gt;throwTypeErrorFunction();
 582             GetterSetter* getterSetter = GetterSetter::create(init.vm, init.owner, thrower, thrower);
 583             init.set(getterSetter);
 584         });
 585 
 586     m_nullGetterFunction.set(vm, this, NullGetterFunction::create(vm, NullGetterFunction::createStructure(vm, this, m_functionPrototype.get())));
 587     m_nullSetterFunction.set(vm, this, NullSetterFunction::create(vm, NullSetterFunction::createStructure(vm, this, m_functionPrototype.get())));
 588     m_objectPrototype.set(vm, this, ObjectPrototype::create(vm, this, ObjectPrototype::createStructure(vm, this, jsNull())));
 589     // We have to manually set this here because we make it a prototype without transition below.
 590     m_objectPrototype.get()-&gt;didBecomePrototype();
 591     GetterSetter* protoAccessor = GetterSetter::create(vm, this,
 592         JSFunction::create(vm, this, 0, makeString(&quot;get &quot;, vm.propertyNames-&gt;underscoreProto.string()), globalFuncProtoGetter, UnderscoreProtoIntrinsic),
 593         JSFunction::create(vm, this, 0, makeString(&quot;set &quot;, vm.propertyNames-&gt;underscoreProto.string()), globalFuncProtoSetter));
 594     m_objectPrototype-&gt;putDirectNonIndexAccessorWithoutTransition(vm, vm.propertyNames-&gt;underscoreProto, protoAccessor, PropertyAttribute::Accessor | PropertyAttribute::DontEnum);
 595     m_functionPrototype-&gt;structure(vm)-&gt;setPrototypeWithoutTransition(vm, m_objectPrototype.get());
 596     m_objectStructureForObjectConstructor.set(vm, this, vm.structureCache.emptyObjectStructureForPrototype(this, m_objectPrototype.get(), JSFinalObject::defaultInlineCapacity()));
 597     m_objectProtoValueOfFunction.set(vm, this, jsCast&lt;JSFunction*&gt;(objectPrototype()-&gt;getDirect(vm, vm.propertyNames-&gt;valueOf)));
</pre>
<hr />
<pre>
 608         [] (const Initializer&lt;JSTypedArrayViewPrototype&gt;&amp; init) {
 609             init.set(JSTypedArrayViewPrototype::create(init.vm, init.owner, JSTypedArrayViewPrototype::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get())));
 610 
 611             // Make sure that the constructor gets initialized, too.
 612             init.owner-&gt;m_typedArraySuperConstructor.get(init.owner);
 613         });
 614     m_typedArraySuperConstructor.initLater(
 615         [] (const Initializer&lt;JSTypedArrayViewConstructor&gt;&amp; init) {
 616             JSTypedArrayViewPrototype* prototype = init.owner-&gt;m_typedArrayProto.get(init.owner);
 617             JSTypedArrayViewConstructor* constructor = JSTypedArrayViewConstructor::create(init.vm, init.owner, JSTypedArrayViewConstructor::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()), prototype, init.owner-&gt;m_speciesGetterSetter.get());
 618             prototype-&gt;putDirectWithoutTransition(init.vm, init.vm.propertyNames-&gt;constructor, constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 619             init.set(constructor);
 620         });
 621 
 622 #define INIT_TYPED_ARRAY_LATER(type) \
 623     m_typedArray ## type.initLater( \
 624         [] (LazyClassStructure::Initializer&amp; init) { \
 625             init.setPrototype(JS ## type ## ArrayPrototype::create(init.vm, init.global, JS ## type ## ArrayPrototype::createStructure(init.vm, init.global, init.global-&gt;m_typedArrayProto.get(init.global)))); \
 626             init.setStructure(JS ## type ## Array::createStructure(init.vm, init.global, init.prototype)); \
 627             init.setConstructor(JS ## type ## ArrayConstructor::create(init.vm, init.global, JS ## type ## ArrayConstructor::createStructure(init.vm, init.global, init.global-&gt;m_typedArraySuperConstructor.get(init.global)), init.prototype, #type &quot;Array&quot;_s, typedArrayConstructorAllocate ## type ## ArrayCodeGenerator(init.vm))); \
<span class="line-modified"> 628             init.global-&gt;putDirect(init.vm, init.vm.propertyNames-&gt;builtinNames().type ## ArrayPrivateName(), init.constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum)); \</span>
 629         });
 630     FOR_EACH_TYPED_ARRAY_TYPE_EXCLUDING_DATA_VIEW(INIT_TYPED_ARRAY_LATER)
 631 #undef INIT_TYPED_ARRAY_LATER
 632 
 633     m_typedArrayDataView.initLater(
 634         [] (LazyClassStructure::Initializer&amp; init) {
 635             init.setPrototype(JSDataViewPrototype::create(init.vm, JSDataViewPrototype::createStructure(init.vm, init.global, init.global-&gt;m_objectPrototype.get())));
 636             init.setStructure(JSDataView::createStructure(init.vm, init.global, init.prototype));
 637             init.setConstructor(JSDataViewConstructor::create(init.vm, init.global, JSDataViewConstructor::createStructure(init.vm, init.global, init.global-&gt;m_functionPrototype.get()), init.prototype, &quot;DataView&quot;_s, nullptr));
 638         });
 639 
 640     m_lexicalEnvironmentStructure.set(vm, this, JSLexicalEnvironment::createStructure(vm, this));
 641     m_moduleEnvironmentStructure.initLater(
 642         [] (const Initializer&lt;Structure&gt;&amp; init) {
 643             init.set(JSModuleEnvironment::createStructure(init.vm, init.owner));
 644         });
 645     m_strictEvalActivationStructure.initLater(
 646         [] (const Initializer&lt;Structure&gt;&amp; init) {
 647             init.set(StrictEvalActivation::createStructure(init.vm, init.owner, jsNull()));
 648         });
</pre>
<hr />
<pre>
 653     m_withScopeStructure.initLater(
 654         [] (const Initializer&lt;Structure&gt;&amp; init) {
 655             init.set(JSWithScope::createStructure(init.vm, init.owner, jsNull()));
 656         });
 657 
 658     m_nullPrototypeObjectStructure.set(vm, this, JSFinalObject::createStructure(vm, this, jsNull(), JSFinalObject::defaultInlineCapacity()));
 659 
 660     m_callbackFunctionStructure.initLater(
 661         [] (const Initializer&lt;Structure&gt;&amp; init) {
 662             init.set(JSCallbackFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 663         });
 664     m_directArgumentsStructure.set(vm, this, DirectArguments::createStructure(vm, this, m_objectPrototype.get()));
 665     m_scopedArgumentsStructure.set(vm, this, ScopedArguments::createStructure(vm, this, m_objectPrototype.get()));
 666     m_clonedArgumentsStructure.set(vm, this, ClonedArguments::createStructure(vm, this, m_objectPrototype.get()));
 667     m_callbackConstructorStructure.initLater(
 668         [] (const Initializer&lt;Structure&gt;&amp; init) {
 669             init.set(JSCallbackConstructor::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get()));
 670         });
 671     m_callbackObjectStructure.initLater(
 672         [] (const Initializer&lt;Structure&gt;&amp; init) {
<span class="line-modified"> 673             init.set(JSCallbackObject&lt;JSNonFinalObject&gt;::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get()));</span>
 674         });
 675 
 676 #if JSC_OBJC_API_ENABLED
 677     m_objcCallbackFunctionStructure.initLater(
 678         [] (const Initializer&lt;Structure&gt;&amp; init) {
 679             init.set(ObjCCallbackFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 680         });
 681     m_objcWrapperObjectStructure.initLater(
 682         [] (const Initializer&lt;Structure&gt;&amp; init) {
 683             init.set(JSCallbackObject&lt;JSAPIWrapperObject&gt;::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get()));
 684         });
 685 #endif
 686 #ifdef JSC_GLIB_API_ENABLED
 687     m_glibCallbackFunctionStructure.initLater(
 688         [] (const Initializer&lt;Structure&gt;&amp; init) {
 689             init.set(JSCCallbackFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
 690         });
 691     m_glibWrapperObjectStructure.initLater(
 692         [] (const Initializer&lt;Structure&gt;&amp; init) {
 693             init.set(JSCallbackObject&lt;JSAPIWrapperObject&gt;::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get()));
 694         });
 695 #endif
 696     m_arrayPrototype.set(vm, this, ArrayPrototype::create(vm, this, ArrayPrototype::createStructure(vm, this, m_objectPrototype.get())));
 697 
 698     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(UndecidedShape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithUndecided));
 699     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(Int32Shape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithInt32));
 700     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(DoubleShape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithDouble));
 701     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(ContiguousShape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithContiguous));
 702     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(ArrayStorageShape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithArrayStorage));
 703     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(SlowPutArrayStorageShape)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), ArrayWithSlowPutArrayStorage));
 704     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(CopyOnWriteArrayWithInt32)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), CopyOnWriteArrayWithInt32));
 705     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(CopyOnWriteArrayWithDouble)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), CopyOnWriteArrayWithDouble));
 706     m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(CopyOnWriteArrayWithContiguous)].set(vm, this, JSArray::createStructure(vm, this, m_arrayPrototype.get(), CopyOnWriteArrayWithContiguous));
 707     for (unsigned i = 0; i &lt; NumberOfArrayIndexingModes; ++i)
 708         m_arrayStructureForIndexingShapeDuringAllocation[i] = m_originalArrayStructureForIndexingShape[i];
 709 
 710     m_regExpPrototype.set(vm, this, RegExpPrototype::create(vm, this, RegExpPrototype::createStructure(vm, this, m_objectPrototype.get())));
 711     m_regExpStructure.set(vm, this, RegExpObject::createStructure(vm, this, m_regExpPrototype.get()));
 712     m_regExpMatchesArrayStructure.set(vm, this, createRegExpMatchesArrayStructure(vm, this));

 713 
 714     m_moduleRecordStructure.initLater(
 715         [] (const Initializer&lt;Structure&gt;&amp; init) {
 716             init.set(JSModuleRecord::createStructure(init.vm, init.owner, jsNull()));
 717         });
 718     m_moduleNamespaceObjectStructure.initLater(
 719         [] (const Initializer&lt;Structure&gt;&amp; init) {
 720             init.set(JSModuleNamespaceObject::createStructure(init.vm, init.owner, jsNull()));
 721         });
 722     m_proxyObjectStructure.initLater(
 723         [] (const Initializer&lt;Structure&gt;&amp; init) {
 724             bool isCallable = false;
 725             init.set(ProxyObject::createStructure(init.vm, init.owner, jsNull(), isCallable));
 726         });
 727     m_callableProxyObjectStructure.initLater(
 728         [] (const Initializer&lt;Structure&gt;&amp; init) {
 729             bool isCallable = true;
 730             init.set(ProxyObject::createStructure(init.vm, init.owner, jsNull(), isCallable));
 731         });
 732     m_proxyRevokeStructure.initLater(
</pre>
<hr />
<pre>
 737     m_parseIntFunction.initLater(
 738         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
 739             init.set(JSFunction::create(init.vm, init.owner, 2, init.vm.propertyNames-&gt;parseInt.string(), globalFuncParseInt, ParseIntIntrinsic));
 740         });
 741     m_parseFloatFunction.initLater(
 742         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
 743             init.set(JSFunction::create(init.vm, init.owner, 1, init.vm.propertyNames-&gt;parseFloat.string(), globalFuncParseFloat, NoIntrinsic));
 744         });
 745 
 746 #if ENABLE(SHARED_ARRAY_BUFFER)
 747     m_sharedArrayBufferPrototype.set(vm, this, JSArrayBufferPrototype::create(vm, this, JSArrayBufferPrototype::createStructure(vm, this, m_objectPrototype.get()), ArrayBufferSharingMode::Shared));
 748     m_sharedArrayBufferStructure.set(vm, this, JSArrayBuffer::createStructure(vm, this, m_sharedArrayBufferPrototype.get()));
 749 #endif
 750 
 751     m_iteratorPrototype.set(vm, this, IteratorPrototype::create(vm, this, IteratorPrototype::createStructure(vm, this, m_objectPrototype.get())));
 752     m_asyncIteratorPrototype.set(vm, this, AsyncIteratorPrototype::create(vm, this, AsyncIteratorPrototype::createStructure(vm, this, m_objectPrototype.get())));
 753 
 754     m_generatorPrototype.set(vm, this, GeneratorPrototype::create(vm, this, GeneratorPrototype::createStructure(vm, this, m_iteratorPrototype.get())));
 755     m_asyncGeneratorPrototype.set(vm, this, AsyncGeneratorPrototype::create(vm, this, AsyncGeneratorPrototype::createStructure(vm, this, m_asyncIteratorPrototype.get())));
 756 
<span class="line-added"> 757     auto* arrayIteratorPrototype = ArrayIteratorPrototype::create(vm, this, ArrayIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));</span>
<span class="line-added"> 758     m_arrayIteratorPrototype.set(vm, this, arrayIteratorPrototype);</span>
<span class="line-added"> 759     m_arrayIteratorStructure.set(vm, this, JSArrayIterator::createStructure(vm, this, arrayIteratorPrototype));</span>
<span class="line-added"> 760 </span>
<span class="line-added"> 761     JSFunction* defaultPromiseThen = JSFunction::create(vm, promisePrototypeThenCodeGenerator(vm), this);</span>
<span class="line-added"> 762     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::defaultPromiseThen)].set(vm, this, defaultPromiseThen);</span>
<span class="line-added"> 763 </span>
 764 #define CREATE_PROTOTYPE_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) { \
 765         m_ ## lowerName ## Prototype.set(vm, this, capitalName##Prototype::create(vm, this, capitalName##Prototype::createStructure(vm, this, m_ ## prototypeBase ## Prototype.get()))); \
 766         m_ ## properName ## Structure.set(vm, this, instanceType::createStructure(vm, this, m_ ## lowerName ## Prototype.get())); \
 767     }
 768 
 769     FOR_EACH_SIMPLE_BUILTIN_TYPE(CREATE_PROTOTYPE_FOR_SIMPLE_TYPE)
 770     FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(CREATE_PROTOTYPE_FOR_SIMPLE_TYPE)
 771 
 772 #undef CREATE_PROTOTYPE_FOR_SIMPLE_TYPE
 773 
 774 #define CREATE_PROTOTYPE_FOR_LAZY_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) {  \
 775     m_ ## properName ## Structure.initLater(\
 776         [] (LazyClassStructure::Initializer&amp; init) { \
 777             init.setPrototype(capitalName##Prototype::create(init.vm, init.global, capitalName##Prototype::createStructure(init.vm, init.global, init.global-&gt;m_ ## prototypeBase ## Prototype.get()))); \
 778             init.setStructure(instanceType::createStructure(init.vm, init.global, init.prototype)); \
 779             init.setConstructor(capitalName ## Constructor::create(init.vm, capitalName ## Constructor::createStructure(init.vm, init.global, init.global-&gt;m_functionPrototype.get()), jsCast&lt;capitalName ## Prototype*&gt;(init.prototype), init.global-&gt;m_speciesGetterSetter.get())); \
 780         }); \
 781     }
 782 
 783     FOR_EACH_LAZY_BUILTIN_TYPE(CREATE_PROTOTYPE_FOR_LAZY_TYPE)
 784 
 785     // Constructors
 786 
 787     ObjectConstructor* objectConstructor = ObjectConstructor::create(vm, this, ObjectConstructor::createStructure(vm, this, m_functionPrototype.get()), m_objectPrototype.get());
 788     m_objectConstructor.set(vm, this, objectConstructor);
<span class="line-added"> 789     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::Object)].set(vm, this, objectConstructor);</span>
 790 
 791     JSFunction* throwTypeErrorFunction = JSFunction::create(vm, this, 0, String(), globalFuncThrowTypeError);
<span class="line-modified"> 792     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::throwTypeErrorFunction)].set(vm, this, throwTypeErrorFunction);</span>
 793 
<span class="line-modified"> 794     FunctionConstructor* functionConstructor = FunctionConstructor::create(vm, FunctionConstructor::createStructure(vm, this, m_functionPrototype.get()), m_functionPrototype.get());</span>
<span class="line-added"> 795     m_functionConstructor.set(vm, this, functionConstructor);</span>
 796 
 797     ArrayConstructor* arrayConstructor = ArrayConstructor::create(vm, this, ArrayConstructor::createStructure(vm, this, m_functionPrototype.get()), m_arrayPrototype.get(), m_speciesGetterSetter.get());
 798     m_arrayConstructor.set(vm, this, arrayConstructor);
<span class="line-added"> 799     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::Array)].set(vm, this, arrayConstructor);</span>
 800 
 801     RegExpConstructor* regExpConstructor = RegExpConstructor::create(vm, RegExpConstructor::createStructure(vm, this, m_functionPrototype.get()), m_regExpPrototype.get(), m_speciesGetterSetter.get());
<span class="line-added"> 802     m_regExpConstructor.set(vm, this, regExpConstructor);</span>
<span class="line-added"> 803     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::RegExp)].set(vm, this, regExpConstructor);</span>
 804     m_regExpGlobalData.cachedResult().record(vm, this, nullptr, jsEmptyString(vm), MatchResult(0, 0));
 805 
 806 #if ENABLE(SHARED_ARRAY_BUFFER)
 807     JSSharedArrayBufferConstructor* sharedArrayBufferConstructor = nullptr;
 808     sharedArrayBufferConstructor = JSSharedArrayBufferConstructor::create(vm, JSSharedArrayBufferConstructor::createStructure(vm, this, m_functionPrototype.get()), m_sharedArrayBufferPrototype.get(), m_speciesGetterSetter.get());
 809     m_sharedArrayBufferPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, sharedArrayBufferConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 810 
 811     AtomicsObject* atomicsObject = AtomicsObject::create(vm, this, AtomicsObject::createStructure(vm, this, m_objectPrototype.get()));
 812 #endif
 813 
 814 #define CREATE_CONSTRUCTOR_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 815 capitalName ## Constructor* lowerName ## Constructor = featureFlag ? capitalName ## Constructor::create(vm, capitalName ## Constructor::createStructure(vm, this, m_functionPrototype.get()), m_ ## lowerName ## Prototype.get(), m_speciesGetterSetter.get()) : nullptr; \
 816     if (featureFlag) \
 817         m_ ## lowerName ## Prototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, lowerName ## Constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum)); \
 818 
 819     FOR_EACH_SIMPLE_BUILTIN_TYPE(CREATE_CONSTRUCTOR_FOR_SIMPLE_TYPE)
 820 
 821 #undef CREATE_CONSTRUCTOR_FOR_SIMPLE_TYPE
 822 
 823     m_promiseConstructor.set(vm, this, promiseConstructor);
 824     m_internalPromiseConstructor.set(vm, this, internalPromiseConstructor);
<span class="line-added"> 825     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::Promise)].set(vm, this, promiseConstructor);</span>
<span class="line-added"> 826     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::InternalPromise)].set(vm, this, internalPromiseConstructor);</span>
 827 
 828     m_evalErrorStructure.initLater(
 829         [] (LazyClassStructure::Initializer&amp; init) {
 830             init.global-&gt;initializeErrorConstructor&lt;ErrorType::EvalError&gt;(init);
 831         });
 832     m_rangeErrorStructure.initLater(
 833         [] (LazyClassStructure::Initializer&amp; init) {
 834             init.global-&gt;initializeErrorConstructor&lt;ErrorType::RangeError&gt;(init);
 835         });
 836     m_referenceErrorStructure.initLater(
 837         [] (LazyClassStructure::Initializer&amp; init) {
 838             init.global-&gt;initializeErrorConstructor&lt;ErrorType::ReferenceError&gt;(init);
 839         });
 840     m_syntaxErrorStructure.initLater(
 841         [] (LazyClassStructure::Initializer&amp; init) {
 842             init.global-&gt;initializeErrorConstructor&lt;ErrorType::SyntaxError&gt;(init);
 843         });
 844     m_typeErrorStructure.initLater(
 845         [] (LazyClassStructure::Initializer&amp; init) {
 846             init.global-&gt;initializeErrorConstructor&lt;ErrorType::TypeError&gt;(init);
 847         });
 848     m_URIErrorStructure.initLater(
 849         [] (LazyClassStructure::Initializer&amp; init) {
 850             init.global-&gt;initializeErrorConstructor&lt;ErrorType::URIError&gt;(init);
 851         });
 852 
 853     m_generatorFunctionPrototype.set(vm, this, GeneratorFunctionPrototype::create(vm, GeneratorFunctionPrototype::createStructure(vm, this, m_functionPrototype.get())));
 854     GeneratorFunctionConstructor* generatorFunctionConstructor = GeneratorFunctionConstructor::create(vm, GeneratorFunctionConstructor::createStructure(vm, this, functionConstructor), m_generatorFunctionPrototype.get());
 855     m_generatorFunctionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, generatorFunctionConstructor, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
 856     m_generatorFunctionStructure.set(vm, this, JSGeneratorFunction::createStructure(vm, this, m_generatorFunctionPrototype.get()));
 857 
 858     m_generatorPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, m_generatorFunctionPrototype.get(), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
 859     m_generatorFunctionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;prototype, m_generatorPrototype.get(), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
<span class="line-added"> 860     m_generatorStructure.set(vm, this, JSGenerator::createStructure(vm, this, m_generatorPrototype.get()));</span>
 861 
 862     m_asyncFunctionPrototype.set(vm, this, AsyncFunctionPrototype::create(vm, AsyncFunctionPrototype::createStructure(vm, this, m_functionPrototype.get())));
 863     AsyncFunctionConstructor* asyncFunctionConstructor = AsyncFunctionConstructor::create(vm, AsyncFunctionConstructor::createStructure(vm, this, functionConstructor), m_asyncFunctionPrototype.get());
 864     m_asyncFunctionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, asyncFunctionConstructor, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
 865     m_asyncFunctionStructure.set(vm, this, JSAsyncFunction::createStructure(vm, this, m_asyncFunctionPrototype.get()));
 866 
 867     m_asyncGeneratorFunctionPrototype.set(vm, this, AsyncGeneratorFunctionPrototype::create(vm, AsyncGeneratorFunctionPrototype::createStructure(vm, this, m_functionPrototype.get())));
 868     AsyncGeneratorFunctionConstructor* asyncGeneratorFunctionConstructor = AsyncGeneratorFunctionConstructor::create(vm, AsyncGeneratorFunctionConstructor::createStructure(vm, this, functionConstructor), m_asyncGeneratorFunctionPrototype.get());
 869     m_asyncGeneratorFunctionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, asyncGeneratorFunctionConstructor, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
 870     m_asyncGeneratorFunctionStructure.set(vm, this, JSAsyncGeneratorFunction::createStructure(vm, this, m_asyncGeneratorFunctionPrototype.get()));
 871 
 872     m_asyncGeneratorPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, m_asyncGeneratorFunctionPrototype.get(), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
 873     m_asyncGeneratorFunctionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;prototype, m_asyncGeneratorPrototype.get(), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
<span class="line-added"> 874     m_asyncGeneratorStructure.set(vm, this, JSAsyncGenerator::createStructure(vm, this, m_asyncGeneratorPrototype.get()));</span>
 875 
 876     m_objectPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, objectConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 877     m_functionPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, functionConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 878     m_arrayPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, arrayConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 879     m_regExpPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, regExpConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 880 
 881     putDirectWithoutTransition(vm, vm.propertyNames-&gt;Object, objectConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 882     putDirectWithoutTransition(vm, vm.propertyNames-&gt;Function, functionConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 883     putDirectWithoutTransition(vm, vm.propertyNames-&gt;Array, arrayConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 884     putDirectWithoutTransition(vm, vm.propertyNames-&gt;RegExp, regExpConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 885 



 886 #if ENABLE(SHARED_ARRAY_BUFFER)
 887     putDirectWithoutTransition(vm, vm.propertyNames-&gt;SharedArrayBuffer, sharedArrayBufferConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 888     putDirectWithoutTransition(vm, Identifier::fromString(vm, &quot;Atomics&quot;), atomicsObject, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 889 #endif
 890 
 891 #define PUT_CONSTRUCTOR_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 892     if (featureFlag) \
 893         putDirectWithoutTransition(vm, vm.propertyNames-&gt; jsName, lowerName ## Constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 894 
 895 
 896     FOR_EACH_SIMPLE_BUILTIN_TYPE_WITH_CONSTRUCTOR(PUT_CONSTRUCTOR_FOR_SIMPLE_TYPE)
 897 
 898 #undef PUT_CONSTRUCTOR_FOR_SIMPLE_TYPE
 899     m_iteratorResultObjectStructure.initLater(
 900         [] (const Initializer&lt;Structure&gt;&amp; init) {
 901             init.set(createIteratorResultObjectStructure(init.vm, *init.owner));
 902         });
 903 
 904     m_evalFunction.initLater(
 905         [] (const Initializer&lt;JSFunction&gt;&amp; init) {
</pre>
<hr />
<pre>
 914             init.set(IntlCollator::createStructure(init.vm, globalObject, collatorPrototype));
 915         });
 916     m_numberFormatStructure.initLater(
 917         [] (const Initializer&lt;Structure&gt;&amp; init) {
 918             JSGlobalObject* globalObject = jsCast&lt;JSGlobalObject*&gt;(init.owner);
 919             IntlNumberFormatPrototype* numberFormatPrototype = IntlNumberFormatPrototype::create(init.vm, globalObject, IntlNumberFormatPrototype::createStructure(init.vm, globalObject, globalObject-&gt;objectPrototype()));
 920             init.set(IntlNumberFormat::createStructure(init.vm, globalObject, numberFormatPrototype));
 921         });
 922     m_dateTimeFormatStructure.initLater(
 923         [] (const Initializer&lt;Structure&gt;&amp; init) {
 924             JSGlobalObject* globalObject = jsCast&lt;JSGlobalObject*&gt;(init.owner);
 925             IntlDateTimeFormatPrototype* dateTimeFormatPrototype = IntlDateTimeFormatPrototype::create(init.vm, globalObject, IntlDateTimeFormatPrototype::createStructure(init.vm, globalObject, globalObject-&gt;objectPrototype()));
 926             init.set(IntlDateTimeFormat::createStructure(init.vm, globalObject, dateTimeFormatPrototype));
 927         });
 928     m_pluralRulesStructure.initLater(
 929         [] (const Initializer&lt;Structure&gt;&amp; init) {
 930             JSGlobalObject* globalObject = jsCast&lt;JSGlobalObject*&gt;(init.owner);
 931             IntlPluralRulesPrototype* pluralRulesPrototype = IntlPluralRulesPrototype::create(init.vm, globalObject, IntlPluralRulesPrototype::createStructure(init.vm, globalObject, globalObject-&gt;objectPrototype()));
 932             init.set(IntlPluralRules::createStructure(init.vm, globalObject, pluralRulesPrototype));
 933         });
<span class="line-added"> 934     m_defaultCollator.initLater(</span>
<span class="line-added"> 935         [] (const Initializer&lt;IntlCollator&gt;&amp; init) {</span>
<span class="line-added"> 936             JSGlobalObject* globalObject = jsCast&lt;JSGlobalObject*&gt;(init.owner);</span>
<span class="line-added"> 937             VM&amp; vm = init.vm;</span>
<span class="line-added"> 938             auto scope = DECLARE_CATCH_SCOPE(vm);</span>
<span class="line-added"> 939             IntlCollator* collator = IntlCollator::create(vm, globalObject-&gt;collatorStructure());</span>
<span class="line-added"> 940             collator-&gt;initializeCollator(globalObject, jsUndefined(), jsUndefined());</span>
<span class="line-added"> 941             scope.releaseAssertNoException();</span>
<span class="line-added"> 942             init.set(collator);</span>
<span class="line-added"> 943         });</span>
 944 
 945     IntlObject* intl = IntlObject::create(vm, IntlObject::createStructure(vm, this, m_objectPrototype.get()));
 946     putDirectWithoutTransition(vm, vm.propertyNames-&gt;Intl, intl, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 947 #endif // ENABLE(INTL)
 948 
 949     m_moduleLoader.initLater(
 950         [] (const Initializer&lt;JSModuleLoader&gt;&amp; init) {
 951             auto catchScope = DECLARE_CATCH_SCOPE(init.vm);
<span class="line-modified"> 952             init.set(JSModuleLoader::create(init.owner, init.vm, JSModuleLoader::createStructure(init.vm, init.owner, jsNull())));</span>
 953             catchScope.releaseAssertNoException();
 954         });
 955     if (Options::exposeInternalModuleLoader())
 956         putDirectWithoutTransition(vm, vm.propertyNames-&gt;Loader, moduleLoader(), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 957 
<span class="line-modified"> 958     GetterSetter* regExpProtoFlagsGetter = getGetterById(this, m_regExpPrototype.get(), vm.propertyNames-&gt;flags);</span>
































 959     catchScope.assertNoException();
<span class="line-modified"> 960     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpProtoFlagsGetter)].set(vm, this, regExpProtoFlagsGetter);</span>
<span class="line-added"> 961     GetterSetter* regExpProtoGlobalGetter = getGetterById(this, m_regExpPrototype.get(), vm.propertyNames-&gt;global);</span>
 962     catchScope.assertNoException();
<span class="line-modified"> 963     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpProtoGlobalGetter)].set(vm, this, regExpProtoGlobalGetter);</span>
<span class="line-modified"> 964     GetterSetter* regExpProtoIgnoreCaseGetter = getGetterById(this, m_regExpPrototype.get(), vm.propertyNames-&gt;ignoreCase);</span>
 965     catchScope.assertNoException();
<span class="line-modified"> 966     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpProtoIgnoreCaseGetter)].set(vm, this, regExpProtoIgnoreCaseGetter);</span>
<span class="line-added"> 967     GetterSetter* regExpProtoMultilineGetter = getGetterById(this, m_regExpPrototype.get(), vm.propertyNames-&gt;multiline);</span>
 968     catchScope.assertNoException();
<span class="line-modified"> 969     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpProtoMultilineGetter)].set(vm, this, regExpProtoMultilineGetter);</span>
<span class="line-added"> 970     GetterSetter* regExpProtoSourceGetter = getGetterById(this, m_regExpPrototype.get(), vm.propertyNames-&gt;source);</span>
 971     catchScope.assertNoException();
<span class="line-modified"> 972     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpProtoSourceGetter)].set(vm, this, regExpProtoSourceGetter);</span>
<span class="line-added"> 973     GetterSetter* regExpProtoStickyGetter = getGetterById(this, m_regExpPrototype.get(), vm.propertyNames-&gt;sticky);</span>
 974     catchScope.assertNoException();
<span class="line-modified"> 975     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpProtoStickyGetter)].set(vm, this, regExpProtoStickyGetter);</span>
<span class="line-added"> 976     GetterSetter* regExpProtoUnicodeGetter = getGetterById(this, m_regExpPrototype.get(), vm.propertyNames-&gt;unicode);</span>
 977     catchScope.assertNoException();
<span class="line-modified"> 978     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpProtoUnicodeGetter)].set(vm, this, regExpProtoUnicodeGetter);</span>
<span class="line-modified"> 979     JSFunction* regExpSymbolReplace = jsCast&lt;JSFunction*&gt;(m_regExpPrototype-&gt;getDirect(vm, vm.propertyNames-&gt;replaceSymbol));</span>


 980     m_regExpProtoSymbolReplace.set(vm, this, regExpSymbolReplace);
<span class="line-added"> 981     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpBuiltinExec)].set(vm, this, jsCast&lt;JSFunction*&gt;(m_regExpPrototype-&gt;getDirect(vm, vm.propertyNames-&gt;exec)));</span>
<span class="line-added"> 982     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpPrototypeSymbolReplace)].set(vm, this, m_regExpPrototype-&gt;getDirect(vm, vm.propertyNames-&gt;replaceSymbol).asCell());</span>
 983 
<span class="line-modified"> 984     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::isArray)].set(vm, this, arrayConstructor-&gt;getDirect(vm, vm.propertyNames-&gt;isArray).asCell());</span>
<span class="line-modified"> 985     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::callFunction)].set(vm, this, callFunction);</span>
<span class="line-modified"> 986     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::applyFunction)].set(vm, this, applyFunction);</span>
 987 
<span class="line-modified"> 988 #define INIT_PRIVATE_GLOBAL(funcName, code) \</span>
<span class="line-modified"> 989     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::funcName)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) { \</span>
<span class="line-added"> 990             JSGlobalObject* globalObject = jsCast&lt;JSGlobalObject*&gt;(init.owner); \</span>
<span class="line-added"> 991             init.set(JSFunction::create(init.vm, code ## CodeGenerator(init.vm), globalObject)); \</span>
<span class="line-added"> 992         });</span>
<span class="line-added"> 993     JSC_FOREACH_BUILTIN_FUNCTION_PRIVATE_GLOBAL_NAME(INIT_PRIVATE_GLOBAL)</span>
<span class="line-added"> 994 #undef INIT_PRIVATE_GLOBAL</span>
 995 
<span class="line-added"> 996     // FIXME: Initializing them lazily.</span>
<span class="line-added"> 997     // https://bugs.webkit.org/show_bug.cgi?id=203795</span>
 998     JSObject* asyncFromSyncIteratorPrototype = AsyncFromSyncIteratorPrototype::create(vm, this, AsyncFromSyncIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="line-modified"> 999     jsCast&lt;JSObject*&gt;(linkTimeConstant(LinkTimeConstant::AsyncFromSyncIterator))-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, asyncFromSyncIteratorPrototype);</span>
1000 
1001     JSObject* mapIteratorPrototype = MapIteratorPrototype::create(vm, this, MapIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="line-modified">1002     jsCast&lt;JSObject*&gt;(linkTimeConstant(LinkTimeConstant::MapIterator))-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, mapIteratorPrototype);</span>
1003 
1004     JSObject* regExpStringIteratorPrototype = RegExpStringIteratorPrototype::create(vm, this, RegExpStringIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="line-modified">1005     jsCast&lt;JSObject*&gt;(linkTimeConstant(LinkTimeConstant::RegExpStringIterator))-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, regExpStringIteratorPrototype);</span>
1006 
1007     JSObject* setIteratorPrototype = SetIteratorPrototype::create(vm, this, SetIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="line-modified">1008     jsCast&lt;JSObject*&gt;(linkTimeConstant(LinkTimeConstant::SetIterator))-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, setIteratorPrototype);</span>
<span class="line-added">1009 </span>
<span class="line-added">1010     // Map and Set helpers.</span>
<span class="line-added">1011     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::Set)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1012             init.set(jsCast&lt;JSGlobalObject*&gt;(init.owner)-&gt;setConstructor());</span>
<span class="line-added">1013         });</span>
<span class="line-added">1014     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::mapBucketHead)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1015             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), mapPrivateFuncMapBucketHead, JSMapBucketHeadIntrinsic));</span>
<span class="line-added">1016         });</span>
<span class="line-added">1017     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::mapBucketNext)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1018             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), mapPrivateFuncMapBucketNext, JSMapBucketNextIntrinsic));</span>
<span class="line-added">1019         });</span>
<span class="line-added">1020     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::mapBucketKey)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1021             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), mapPrivateFuncMapBucketKey, JSMapBucketKeyIntrinsic));</span>
<span class="line-added">1022         });</span>
<span class="line-added">1023     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::mapBucketValue)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1024             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), mapPrivateFuncMapBucketValue, JSMapBucketValueIntrinsic));</span>
<span class="line-added">1025         });</span>
<span class="line-added">1026     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::setBucketHead)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1027             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), setPrivateFuncSetBucketHead, JSSetBucketHeadIntrinsic));</span>
<span class="line-added">1028         });</span>
<span class="line-added">1029     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::setBucketNext)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1030             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), setPrivateFuncSetBucketNext, JSSetBucketNextIntrinsic));</span>
<span class="line-added">1031         });</span>
<span class="line-added">1032     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::setBucketKey)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1033             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), setPrivateFuncSetBucketKey, JSSetBucketKeyIntrinsic));</span>
<span class="line-added">1034         });</span>
<span class="line-added">1035 </span>
<span class="line-added">1036     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::importModule)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1037             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), globalFuncImportModule));</span>
<span class="line-added">1038         });</span>
<span class="line-added">1039     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::propertyIsEnumerable)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1040             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), globalFuncPropertyIsEnumerable));</span>
<span class="line-added">1041         });</span>
<span class="line-added">1042     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::ownKeys)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1043             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), globalFuncOwnKeys));</span>
<span class="line-added">1044         });</span>
<span class="line-added">1045     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::enqueueJob)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1046             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, &quot;enqueueJob&quot;_s, enqueueJob));</span>
<span class="line-added">1047         });</span>
<span class="line-added">1048     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::makeTypeError)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1049             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), globalFuncMakeTypeError));</span>
<span class="line-added">1050         });</span>
<span class="line-added">1051     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::typedArrayLength)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1052             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), typedArrayViewPrivateFuncLength));</span>
<span class="line-added">1053         });</span>
<span class="line-added">1054     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::typedArrayGetOriginalConstructor)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1055             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), typedArrayViewPrivateFuncGetOriginalConstructor));</span>
<span class="line-added">1056         });</span>
<span class="line-added">1057     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::typedArraySort)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1058             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), typedArrayViewPrivateFuncSort));</span>
<span class="line-added">1059         });</span>
<span class="line-added">1060     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::isTypedArrayView)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1061             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), typedArrayViewPrivateFuncIsTypedArrayView, IsTypedArrayViewIntrinsic));</span>
<span class="line-added">1062         });</span>
<span class="line-added">1063     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::typedArraySubarrayCreate)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1064             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), typedArrayViewPrivateFuncSubarrayCreate));</span>
<span class="line-added">1065         });</span>
<span class="line-added">1066     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::isBoundFunction)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1067             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), isBoundFunction));</span>
<span class="line-added">1068         });</span>
<span class="line-added">1069     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::hasInstanceBoundFunction)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1070             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), hasInstanceBoundFunction));</span>
<span class="line-added">1071         });</span>
<span class="line-added">1072     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::instanceOf)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1073             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), objectPrivateFuncInstanceOf));</span>
<span class="line-added">1074         });</span>
<span class="line-added">1075     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::BuiltinLog)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1076             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, String(), globalFuncBuiltinLog));</span>
<span class="line-added">1077         });</span>
<span class="line-added">1078     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::BuiltinDescribe)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1079             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, String(), globalFuncBuiltinDescribe));</span>
<span class="line-added">1080         });</span>
<span class="line-added">1081     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::trunc)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1082             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), mathProtoFuncTrunc, TruncIntrinsic));</span>
<span class="line-added">1083         });</span>
<span class="line-added">1084     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::repeatCharacter)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1085             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 2, String(), stringProtoFuncRepeatCharacter));</span>
<span class="line-added">1086         });</span>
<span class="line-added">1087     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::arraySpeciesCreate)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1088             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 2, String(), arrayProtoFuncSpeciesCreate));</span>
<span class="line-added">1089         });</span>
<span class="line-added">1090     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::isArraySlow)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1091             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), arrayConstructorPrivateFuncIsArraySlow));</span>
<span class="line-added">1092         });</span>
<span class="line-added">1093     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::concatMemcpy)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1094             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), arrayProtoPrivateFuncConcatMemcpy));</span>
<span class="line-added">1095         });</span>
<span class="line-added">1096     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::appendMemcpy)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1097             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), arrayProtoPrivateFuncAppendMemcpy));</span>
<span class="line-added">1098         });</span>
<span class="line-added">1099     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::hostPromiseRejectionTracker)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1100             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 2, String(), globalFuncHostPromiseRejectionTracker));</span>
<span class="line-added">1101         });</span>
<span class="line-added">1102     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::InspectorInstrumentation)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1103             JSGlobalObject* globalObject = jsCast&lt;JSGlobalObject*&gt;(init.owner);</span>
<span class="line-added">1104             init.set(InspectorInstrumentationObject::create(init.vm, globalObject, InspectorInstrumentationObject::createStructure(init.vm, globalObject, globalObject-&gt;m_objectPrototype.get())));</span>
<span class="line-added">1105         });</span>
<span class="line-added">1106     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::thisTimeValue)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1107             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), dateProtoFuncGetTime, DatePrototypeGetTimeIntrinsic));</span>
<span class="line-added">1108         });</span>
<span class="line-added">1109     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::isConstructor)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1110             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, String(), esSpecIsConstructor, NoIntrinsic));</span>
<span class="line-added">1111         });</span>
<span class="line-added">1112 </span>
<span class="line-added">1113     // RegExp.prototype helpers.</span>
<span class="line-added">1114     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpCreate)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1115             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 2, String(), esSpecRegExpCreate, NoIntrinsic));</span>
<span class="line-added">1116         });</span>
<span class="line-added">1117     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::isRegExp)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1118             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, String(), esSpecIsRegExp, NoIntrinsic));</span>
<span class="line-added">1119         });</span>
<span class="line-added">1120     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpMatchFast)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1121             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, String(), regExpProtoFuncMatchFast, RegExpMatchFastIntrinsic));</span>
<span class="line-added">1122         });</span>
<span class="line-added">1123     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpSearchFast)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1124             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, String(), regExpProtoFuncSearchFast));</span>
<span class="line-added">1125         });</span>
<span class="line-added">1126     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpSplitFast)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1127             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 2, String(), regExpProtoFuncSplitFast));</span>
<span class="line-added">1128         });</span>
<span class="line-added">1129     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::regExpTestFast)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1130             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, String(), regExpProtoFuncTestFast, RegExpTestFastIntrinsic));</span>
<span class="line-added">1131         });</span>
<span class="line-added">1132 </span>
<span class="line-added">1133     // String.prototype helpers.</span>
<span class="line-added">1134     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::stringIncludesInternal)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1135             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, String(), builtinStringIncludesInternal));</span>
<span class="line-added">1136         });</span>
<span class="line-added">1137     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::stringSplitFast)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1138             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 2, String(), stringProtoFuncSplitFast));</span>
<span class="line-added">1139         });</span>
<span class="line-added">1140     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::stringSubstrInternal)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1141             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 2, String(), builtinStringSubstrInternal));</span>
<span class="line-added">1142         });</span>
<span class="line-added">1143 </span>
<span class="line-added">1144     // Function prototype helpers.</span>
<span class="line-added">1145     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::makeBoundFunction)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1146             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 5, String(), makeBoundFunction));</span>
<span class="line-added">1147         });</span>
<span class="line-added">1148     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::hasOwnLengthProperty)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1149             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, String(), hasOwnLengthProperty));</span>
<span class="line-added">1150         });</span>
1151 






































1152 #if ENABLE(INTL)
<span class="line-modified">1153     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::dateTimeFormat)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1154             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 0, String(), globalFuncDateTimeFormat));</span>
<span class="line-added">1155         });</span>
1156 #endif // ENABLE(INTL)





































1157 #if ENABLE(WEBASSEMBLY) &amp;&amp; ENABLE(WEBASSEMBLY_STREAMING_API)
<span class="line-modified">1158     // WebAssembly Streaming API</span>
<span class="line-modified">1159     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::webAssemblyCompileStreamingInternal)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-modified">1160             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, String(), webAssemblyCompileStreamingInternal));</span>
<span class="line-added">1161         });</span>
<span class="line-added">1162     m_linkTimeConstants[static_cast&lt;unsigned&gt;(LinkTimeConstant::webAssemblyInstantiateStreamingInternal)].initLater([] (const Initializer&lt;JSCell&gt;&amp; init) {</span>
<span class="line-added">1163             init.set(JSFunction::create(init.vm, jsCast&lt;JSGlobalObject*&gt;(init.owner), 1, String(), webAssemblyInstantiateStreamingInternal));</span>
<span class="line-added">1164         });</span>
1165 #endif
<span class="line-modified">1166 </span>
<span class="line-added">1167     GlobalPropertyInfo staticGlobals[] = {</span>
<span class="line-added">1168         GlobalPropertyInfo(vm.propertyNames-&gt;NaN, jsNaN(), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-added">1169         GlobalPropertyInfo(vm.propertyNames-&gt;Infinity, jsNumber(std::numeric_limits&lt;double&gt;::infinity()), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-added">1170         GlobalPropertyInfo(vm.propertyNames-&gt;undefinedKeyword, jsUndefined(), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="line-added">1171 #if ASSERT_ENABLED</span>
1172         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().assertPrivateName(), JSFunction::create(vm, this, 1, String(), assertCall), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
1173 #endif
1174     };
1175     addStaticGlobals(staticGlobals, WTF_ARRAY_LENGTH(staticGlobals));
1176 







1177     if (UNLIKELY(Options::useDollarVM()))
1178         exposeDollarVM(vm);
1179 
1180 #if ENABLE(WEBASSEMBLY)
1181     if (Wasm::isSupported()) {
1182         m_webAssemblyModuleRecordStructure.initLater(
1183             [] (const Initializer&lt;Structure&gt;&amp; init) {
1184                 init.set(WebAssemblyModuleRecord::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get()));
1185             });
1186         m_webAssemblyFunctionStructure.initLater(
1187             [] (const Initializer&lt;Structure&gt;&amp; init) {
1188                 init.set(WebAssemblyFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
1189             });
1190         m_jsToWasmICCalleeStructure.initLater(
1191             [] (const Initializer&lt;Structure&gt;&amp; init) {
1192                 init.set(JSToWasmICCallee::createStructure(init.vm, init.owner, jsNull()));
1193             });
1194         m_webAssemblyWrapperFunctionStructure.initLater(
1195             [] (const Initializer&lt;Structure&gt;&amp; init) {
1196                 init.set(WebAssemblyWrapperFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
1197             });




1198         auto* webAssembly = JSWebAssembly::create(vm, this, JSWebAssembly::createStructure(vm, this, m_objectPrototype.get()));
1199         putDirectWithoutTransition(vm, Identifier::fromString(vm, &quot;WebAssembly&quot;), webAssembly, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
1200 
1201 #define CREATE_WEBASSEMBLY_PROTOTYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
1202     if (featureFlag) {\
1203         m_ ## properName ## Structure.initLater(\
1204             [] (LazyClassStructure::Initializer&amp; init) { \
1205                 init.setPrototype(capitalName##Prototype::create(init.vm, init.global, capitalName##Prototype::createStructure(init.vm, init.global, init.global-&gt;prototypeBase ## Prototype()))); \
1206                 init.setStructure(instanceType::createStructure(init.vm, init.global, init.prototype)); \
1207                 init.setConstructor(capitalName ## Constructor::create(init.vm, capitalName ## Constructor::createStructure(init.vm, init.global, init.global-&gt;functionPrototype()), jsCast&lt;capitalName ## Prototype*&gt;(init.prototype))); \
1208             }); \
1209     }
1210 
1211         FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(CREATE_WEBASSEMBLY_PROTOTYPE)
1212 
1213 #undef CREATE_WEBASSEMBLY_CONSTRUCTOR
1214     }
1215 #endif // ENABLE(WEBASSEMBLY)
1216 
1217 #undef CREATE_PROTOTYPE_FOR_LAZY_TYPE
1218 




















1219 
1220     {
<span class="line-modified">1221         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, arrayIteratorPrototype, vm.propertyNames-&gt;next);</span>
1222         m_arrayIteratorPrototypeNext = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_arrayIteratorProtocolWatchpointSet);
1223         m_arrayIteratorPrototypeNext-&gt;install(vm);
1224     }
1225     {
<span class="line-modified">1226         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, this-&gt;arrayPrototype(), vm.propertyNames-&gt;iteratorSymbol);</span>
1227         m_arrayPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_arrayIteratorProtocolWatchpointSet);
1228         m_arrayPrototypeSymbolIteratorWatchpoint-&gt;install(vm);
1229     }
1230     {
<span class="line-modified">1231         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, this-&gt;arrayPrototype(), vm.propertyNames-&gt;join);</span>
1232         m_arrayPrototypeJoinWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_arrayJoinWatchpointSet);
1233         m_arrayPrototypeJoinWatchpoint-&gt;install(vm);
1234     }
1235 
1236     {
<span class="line-modified">1237         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, mapIteratorPrototype, vm.propertyNames-&gt;next);</span>
1238         m_mapIteratorPrototypeNextWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_mapIteratorProtocolWatchpointSet);
1239         m_mapIteratorPrototypeNextWatchpoint-&gt;install(vm);
1240     }
1241     {
<span class="line-modified">1242         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, setIteratorPrototype, vm.propertyNames-&gt;next);</span>






1243         m_setIteratorPrototypeNextWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_setIteratorProtocolWatchpointSet);
1244         m_setIteratorPrototypeNextWatchpoint-&gt;install(vm);
1245     }
1246     {
<span class="line-modified">1247         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, m_stringIteratorPrototype.get(), vm.propertyNames-&gt;next);</span>






1248         m_stringIteratorPrototypeNextWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_stringIteratorProtocolWatchpointSet);
1249         m_stringIteratorPrototypeNextWatchpoint-&gt;install(vm);
1250     }
1251     {
<span class="line-modified">1252         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, m_stringPrototype.get(), vm.propertyNames-&gt;iteratorSymbol);</span>
1253         m_stringPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_stringIteratorProtocolWatchpointSet);
1254         m_stringPrototypeSymbolIteratorWatchpoint-&gt;install(vm);
1255     }
1256 












1257     // Unfortunately, the prototype objects of the builtin objects can be touched from concurrent compilers. So eagerly initialize them only if we use JIT.
1258     if (VM::canUseJIT()) {
1259         this-&gt;booleanPrototype();
<span class="line-modified">1260         this-&gt;numberPrototype();</span>
1261         this-&gt;symbolPrototype();





1262     }
1263 
1264     fixupPrototypeChainWithObjectPrototype(vm);
1265 }
1266 
<span class="line-modified">1267 bool JSGlobalObject::put(JSCell* cell, JSGlobalObject* globalObject, PropertyName propertyName, JSValue value, PutPropertySlot&amp; slot)</span>
1268 {
<span class="line-modified">1269     VM&amp; vm = globalObject-&gt;vm();</span>
1270     auto scope = DECLARE_THROW_SCOPE(vm);
1271     JSGlobalObject* thisObject = jsCast&lt;JSGlobalObject*&gt;(cell);
1272     ASSERT(!Heap::heap(value) || Heap::heap(value) == Heap::heap(thisObject));
1273 
1274     if (UNLIKELY(isThisValueAltered(slot, thisObject)))
<span class="line-modified">1275         RELEASE_AND_RETURN(scope, ordinarySetSlow(globalObject, thisObject, propertyName, value, slot.thisValue(), slot.isStrictMode()));</span>
1276 
1277     bool shouldThrowReadOnlyError = slot.isStrictMode();
1278     bool ignoreReadOnlyErrors = false;
1279     bool putResult = false;
<span class="line-modified">1280     bool done = symbolTablePutTouchWatchpointSet(thisObject, globalObject, propertyName, value, shouldThrowReadOnlyError, ignoreReadOnlyErrors, putResult);</span>
1281     EXCEPTION_ASSERT((!!scope.exception() == (done &amp;&amp; !putResult)) || !shouldThrowReadOnlyError);
1282     if (done)
1283         return putResult;
<span class="line-modified">1284     RELEASE_AND_RETURN(scope, Base::put(thisObject, globalObject, propertyName, value, slot));</span>
1285 }
1286 
<span class="line-modified">1287 bool JSGlobalObject::defineOwnProperty(JSObject* object, JSGlobalObject* globalObject, PropertyName propertyName, const PropertyDescriptor&amp; descriptor, bool shouldThrow)</span>
1288 {
1289     JSGlobalObject* thisObject = jsCast&lt;JSGlobalObject*&gt;(object);
1290     PropertySlot slot(thisObject, PropertySlot::InternalMethodType::VMInquiry);
1291     // silently ignore attempts to add accessors aliasing vars.
1292     if (descriptor.isAccessorDescriptor() &amp;&amp; symbolTableGet(thisObject, propertyName, slot))
1293         return false;
<span class="line-modified">1294     return Base::defineOwnProperty(thisObject, globalObject, propertyName, descriptor, shouldThrow);</span>
1295 }
1296 
1297 void JSGlobalObject::addGlobalVar(const Identifier&amp; ident)
1298 {
1299     ConcurrentJSLocker locker(symbolTable()-&gt;m_lock);
1300     SymbolTableEntry entry = symbolTable()-&gt;get(locker, ident.impl());
1301     if (!entry.isNull())
1302         return;
1303 
1304     ScopeOffset offset = symbolTable()-&gt;takeNextScopeOffset(locker);
1305     SymbolTableEntry newEntry(VarOffset(offset), 0);
1306     newEntry.prepareToWatch();
1307     symbolTable()-&gt;add(locker, ident.impl(), WTFMove(newEntry));
1308 
1309     ScopeOffset offsetForAssert = addVariables(1, jsUndefined());
1310     RELEASE_ASSERT(offsetForAssert == offset);
1311 }
1312 
<span class="line-modified">1313 void JSGlobalObject::addFunction(JSGlobalObject* globalObject, const Identifier&amp; propertyName)</span>
1314 {
<span class="line-modified">1315     VM&amp; vm = globalObject-&gt;vm();</span>
1316     VM::DeletePropertyModeScope scope(vm, VM::DeletePropertyMode::IgnoreConfigurable);
<span class="line-modified">1317     methodTable(vm)-&gt;deleteProperty(this, globalObject, propertyName);</span>
1318     addGlobalVar(propertyName);
1319 }
1320 
1321 void JSGlobalObject::setGlobalScopeExtension(JSScope* scope)
1322 {
1323     m_globalScopeExtension.set(vm(), this, scope);
1324 }
1325 
1326 void JSGlobalObject::clearGlobalScopeExtension()
1327 {
1328     m_globalScopeExtension.clear();
1329 }
1330 
1331 static inline JSObject* lastInPrototypeChain(VM&amp; vm, JSObject* object)
1332 {
1333     JSObject* o = object;
1334     while (o-&gt;getPrototypeDirect(vm).isObject())
1335         o = asObject(o-&gt;getPrototypeDirect(vm));
1336     return o;
1337 }
</pre>
<hr />
<pre>
1493             current = asObject(prototypeValue);
1494         }
1495         RELEASE_ASSERT_NOT_REACHED();
1496     };
1497 
1498     if (JSFunction* function = jsDynamicCast&lt;JSFunction*&gt;(vm, object)) {
1499         if (FunctionRareData* rareData = function-&gt;rareData()) {
1500             // We only use this to cache JSFinalObjects. They do not start off with a broken indexing type.
1501             ASSERT(!(rareData-&gt;objectAllocationStructure() &amp;&amp; hasBrokenIndexing(rareData-&gt;objectAllocationStructure()-&gt;indexingType())));
1502 
1503             if (Structure* structure = rareData-&gt;internalFunctionAllocationStructure()) {
1504                 if (hasBrokenIndexing(structure-&gt;indexingType())) {
1505                     bool isRelevantGlobalObject =
1506                         (mode == BadTimeFinderMode::SingleGlobal
1507                             ? m_globalObject == structure-&gt;globalObject()
1508                             : m_globalObjects-&gt;contains(structure-&gt;globalObject()))
1509                         || (structure-&gt;hasMonoProto() &amp;&amp; !structure-&gt;storedPrototype().isNull() &amp;&amp; isInAffectedGlobalObject(asObject(structure-&gt;storedPrototype())));
1510                     if (mode == BadTimeFinderMode::SingleGlobal &amp;&amp; m_needsMultiGlobalsScan)
1511                         return IterationStatus::Done; // Bailing early and let the MultipleGlobals path handle everything.
1512                     if (isRelevantGlobalObject)
<span class="line-modified">1513                         rareData-&gt;clearInternalFunctionAllocationProfile(&quot;have a bad time breaking internal function allocation&quot;);</span>
1514                 }
1515             }
1516         }
1517     }
1518 
1519     // Run this filter first, since it&#39;s cheap, and ought to filter out a lot of objects.
1520     if (!hasBrokenIndexing(object))
1521         return IterationStatus::Continue;
1522 
1523     if (isInAffectedGlobalObject(object))
1524         m_foundObjects.append(object);
1525 
1526     if (mode == BadTimeFinderMode::SingleGlobal &amp;&amp; m_needsMultiGlobalsScan)
1527         return IterationStatus::Done; // Bailing early and let the MultipleGlobals path handle everything.
1528 
1529     return IterationStatus::Continue;
1530 }
1531 
1532 template&lt;BadTimeFinderMode mode&gt;
1533 IterationStatus ObjectsWithBrokenIndexingFinder&lt;mode&gt;::operator()(HeapCell* cell, HeapCell::Kind kind) const
1534 {
1535     if (isJSCellKind(kind) &amp;&amp; static_cast&lt;JSCell*&gt;(cell)-&gt;isObject()) {
1536         // FIXME: This const_cast exists because this isn&#39;t a C++ lambda.
1537         // https://bugs.webkit.org/show_bug.cgi?id=159644
1538         return const_cast&lt;ObjectsWithBrokenIndexingFinder*&gt;(this)-&gt;visit(jsCast&lt;JSObject*&gt;(static_cast&lt;JSCell*&gt;(cell)));
1539     }
1540     return IterationStatus::Continue;
1541 }
1542 
1543 } // end private namespace for helpers for JSGlobalObject::haveABadTime()
1544 
1545 void JSGlobalObject::fireWatchpointAndMakeAllArrayStructuresSlowPut(VM&amp; vm)
1546 {
1547     if (isHavingABadTime())
1548         return;
1549 






1550     // Make sure that all JSArray allocations that load the appropriate structure from
1551     // this object now load a structure that uses SlowPut.
1552     for (unsigned i = 0; i &lt; NumberOfArrayIndexingModes; ++i)
1553         m_arrayStructureForIndexingShapeDuringAllocation[i].set(vm, this, originalArrayStructureForIndexingType(ArrayWithSlowPutArrayStorage));
1554 
1555     // Same for any special array structures.
1556     Structure* slowPutStructure;
1557     slowPutStructure = createRegExpMatchesArraySlowPutStructure(vm, this);
1558     m_regExpMatchesArrayStructure.set(vm, this, slowPutStructure);


1559     slowPutStructure = ClonedArguments::createSlowPutStructure(vm, this, m_objectPrototype.get());
1560     m_clonedArgumentsStructure.set(vm, this, slowPutStructure);
<span class="line-added">1561 </span>
<span class="line-added">1562     // Make sure that all allocations or indexed storage transitions that are inlining</span>
<span class="line-added">1563     // the assumption that it&#39;s safe to transition to a non-SlowPut array storage don&#39;t</span>
<span class="line-added">1564     // do so anymore.</span>
<span class="line-added">1565     // Note: we are deliberately firing the watchpoint here at the end only after</span>
<span class="line-added">1566     // making all the array structures SlowPut. This ensures that the concurrent</span>
<span class="line-added">1567     // JIT threads will always get the SlowPut versions of the structures if</span>
<span class="line-added">1568     // isHavingABadTime() returns true. The concurrent JIT relies on this.</span>
<span class="line-added">1569     m_havingABadTimeWatchpoint-&gt;fireAll(vm, &quot;Having a bad time&quot;);</span>
<span class="line-added">1570     ASSERT(isHavingABadTime()); // The watchpoint is what tells us that we&#39;re having a bad time.</span>
1571 };
1572 
1573 void JSGlobalObject::haveABadTime(VM&amp; vm)
1574 {
1575     ASSERT(&amp;vm == &amp;this-&gt;vm());
1576 
1577     if (isHavingABadTime())
1578         return;
1579 
1580     vm.structureCache.clear(); // We may be caching array structures in here.
1581 
1582     DeferGC deferGC(vm.heap);
1583 
1584     // Consider the following objects and prototype chains:
1585     //    O (of global G1) -&gt; A (of global G1)
1586     //    B (of global G2) where G2 has a bad time
1587     //
1588     // If we set B as the prototype of A, G1 will need to have a bad time.
1589     // See comments in Structure::mayInterceptIndexedAccesses() for why.
1590     //
</pre>
<hr />
<pre>
1687         object-&gt;switchToSlowPutArrayStorage(vm);
1688     }
1689 }
1690 
1691 void JSGlobalObject::fixupPrototypeChainWithObjectPrototype(VM&amp; vm)
1692 {
1693     JSObject* oldLastInPrototypeChain = lastInPrototypeChain(vm, this);
1694     JSObject* objectPrototype = m_objectPrototype.get();
1695     if (oldLastInPrototypeChain != objectPrototype)
1696         oldLastInPrototypeChain-&gt;setPrototypeDirect(vm, objectPrototype);
1697 }
1698 
1699 // Set prototype, and also insert the object prototype at the end of the chain.
1700 void JSGlobalObject::resetPrototype(VM&amp; vm, JSValue prototype)
1701 {
1702     if (getPrototypeDirect(vm) == prototype)
1703         return;
1704     setPrototypeDirect(vm, prototype);
1705     fixupPrototypeChainWithObjectPrototype(vm);
1706     // Whenever we change the prototype of the global object, we need to create a new JSProxy with the correct prototype.
<span class="line-modified">1707     setGlobalThis(vm, JSProxy::create(vm, JSProxy::createStructure(vm, this, prototype, PureForwardingProxyType), this));</span>
1708 }
1709 
1710 void JSGlobalObject::visitChildren(JSCell* cell, SlotVisitor&amp; visitor)
1711 {
1712     JSGlobalObject* thisObject = jsCast&lt;JSGlobalObject*&gt;(cell);
1713     ASSERT_GC_OBJECT_INHERITS(thisObject, info());
1714     Base::visitChildren(thisObject, visitor);
1715 
1716     visitor.append(thisObject-&gt;m_globalThis);
1717 
1718     visitor.append(thisObject-&gt;m_globalLexicalEnvironment);
1719     visitor.append(thisObject-&gt;m_globalScopeExtension);
1720     visitor.append(thisObject-&gt;m_globalCallee);
1721     visitor.append(thisObject-&gt;m_stackOverflowFrameCallee);
1722     thisObject-&gt;m_evalErrorStructure.visit(visitor);
1723     thisObject-&gt;m_rangeErrorStructure.visit(visitor);
1724     thisObject-&gt;m_referenceErrorStructure.visit(visitor);
1725     thisObject-&gt;m_syntaxErrorStructure.visit(visitor);
1726     thisObject-&gt;m_typeErrorStructure.visit(visitor);
1727     thisObject-&gt;m_URIErrorStructure.visit(visitor);
<span class="line-added">1728     visitor.append(thisObject-&gt;m_arrayConstructor);</span>
<span class="line-added">1729     visitor.append(thisObject-&gt;m_regExpConstructor);</span>
1730     visitor.append(thisObject-&gt;m_objectConstructor);
<span class="line-added">1731     visitor.append(thisObject-&gt;m_functionConstructor);</span>
1732     visitor.append(thisObject-&gt;m_promiseConstructor);
<span class="line-added">1733     visitor.append(thisObject-&gt;m_internalPromiseConstructor);</span>
1734 
1735 #if ENABLE(INTL)
<span class="line-modified">1736     thisObject-&gt;m_defaultCollator.visit(visitor);</span>
1737     thisObject-&gt;m_collatorStructure.visit(visitor);
1738     thisObject-&gt;m_numberFormatStructure.visit(visitor);
1739     thisObject-&gt;m_dateTimeFormatStructure.visit(visitor);
1740     thisObject-&gt;m_pluralRulesStructure.visit(visitor);
1741 #endif
1742     visitor.append(thisObject-&gt;m_nullGetterFunction);
1743     visitor.append(thisObject-&gt;m_nullSetterFunction);
1744 
1745     thisObject-&gt;m_parseIntFunction.visit(visitor);
1746     thisObject-&gt;m_parseFloatFunction.visit(visitor);



1747     thisObject-&gt;m_arrayProtoToStringFunction.visit(visitor);
1748     thisObject-&gt;m_arrayProtoValuesFunction.visit(visitor);
1749     thisObject-&gt;m_evalFunction.visit(visitor);

1750     thisObject-&gt;m_iteratorProtocolFunction.visit(visitor);
1751     thisObject-&gt;m_promiseResolveFunction.visit(visitor);
1752     visitor.append(thisObject-&gt;m_objectProtoValueOfFunction);
<span class="line-modified">1753     thisObject-&gt;m_numberProtoToStringFunction.visit(visitor);</span>

1754     visitor.append(thisObject-&gt;m_functionProtoHasInstanceSymbolFunction);
1755     thisObject-&gt;m_throwTypeErrorGetterSetter.visit(visitor);
<span class="line-added">1756     visitor.append(thisObject-&gt;m_regExpProtoSymbolReplace);</span>
1757     visitor.append(thisObject-&gt;m_throwTypeErrorArgumentsCalleeAndCallerGetterSetter);
1758     thisObject-&gt;m_moduleLoader.visit(visitor);
1759 
1760     visitor.append(thisObject-&gt;m_objectPrototype);
1761     visitor.append(thisObject-&gt;m_functionPrototype);
1762     visitor.append(thisObject-&gt;m_arrayPrototype);
1763     visitor.append(thisObject-&gt;m_iteratorPrototype);
1764     visitor.append(thisObject-&gt;m_generatorFunctionPrototype);
1765     visitor.append(thisObject-&gt;m_generatorPrototype);
<span class="line-added">1766     visitor.append(thisObject-&gt;m_arrayIteratorPrototype);</span>
1767     visitor.append(thisObject-&gt;m_asyncFunctionPrototype);
1768     visitor.append(thisObject-&gt;m_asyncGeneratorPrototype);
1769     visitor.append(thisObject-&gt;m_asyncIteratorPrototype);
1770     visitor.append(thisObject-&gt;m_asyncGeneratorFunctionPrototype);
1771 
1772     thisObject-&gt;m_debuggerScopeStructure.visit(visitor);
1773     thisObject-&gt;m_withScopeStructure.visit(visitor);
1774     thisObject-&gt;m_strictEvalActivationStructure.visit(visitor);
1775     visitor.append(thisObject-&gt;m_lexicalEnvironmentStructure);
1776     thisObject-&gt;m_moduleEnvironmentStructure.visit(visitor);
1777     visitor.append(thisObject-&gt;m_directArgumentsStructure);
1778     visitor.append(thisObject-&gt;m_scopedArgumentsStructure);
1779     visitor.append(thisObject-&gt;m_clonedArgumentsStructure);
1780     visitor.append(thisObject-&gt;m_objectStructureForObjectConstructor);
1781     for (unsigned i = 0; i &lt; NumberOfArrayIndexingModes; ++i)
1782         visitor.append(thisObject-&gt;m_originalArrayStructureForIndexingShape[i]);
1783     for (unsigned i = 0; i &lt; NumberOfArrayIndexingModes; ++i)
1784         visitor.append(thisObject-&gt;m_arrayStructureForIndexingShapeDuringAllocation[i]);
1785     thisObject-&gt;m_callbackConstructorStructure.visit(visitor);
1786     thisObject-&gt;m_callbackFunctionStructure.visit(visitor);
</pre>
<hr />
<pre>
1790     thisObject-&gt;m_objcWrapperObjectStructure.visit(visitor);
1791 #endif
1792 #ifdef JSC_GLIB_API_ENABLED
1793     thisObject-&gt;m_glibCallbackFunctionStructure.visit(visitor);
1794     thisObject-&gt;m_glibWrapperObjectStructure.visit(visitor);
1795 #endif
1796     visitor.append(thisObject-&gt;m_nullPrototypeObjectStructure);
1797     visitor.append(thisObject-&gt;m_calleeStructure);
1798 
1799     visitor.append(thisObject-&gt;m_hostFunctionStructure);
1800     auto visitFunctionStructures = [&amp;] (FunctionStructures&amp; structures) {
1801         visitor.append(structures.arrowFunctionStructure);
1802         visitor.append(structures.sloppyFunctionStructure);
1803         visitor.append(structures.strictFunctionStructure);
1804     };
1805     visitFunctionStructures(thisObject-&gt;m_builtinFunctions);
1806     visitFunctionStructures(thisObject-&gt;m_ordinaryFunctions);
1807 
1808     thisObject-&gt;m_customGetterSetterFunctionStructure.visit(visitor);
1809     thisObject-&gt;m_boundFunctionStructure.visit(visitor);

1810     thisObject-&gt;m_nativeStdFunctionStructure.visit(visitor);
1811     visitor.append(thisObject-&gt;m_regExpStructure);
1812     visitor.append(thisObject-&gt;m_generatorFunctionStructure);
1813     visitor.append(thisObject-&gt;m_asyncFunctionStructure);
1814     visitor.append(thisObject-&gt;m_asyncGeneratorFunctionStructure);
<span class="line-added">1815     visitor.append(thisObject-&gt;m_generatorStructure);</span>
<span class="line-added">1816     visitor.append(thisObject-&gt;m_asyncGeneratorStructure);</span>
<span class="line-added">1817     visitor.append(thisObject-&gt;m_arrayIteratorStructure);</span>
1818     thisObject-&gt;m_iteratorResultObjectStructure.visit(visitor);
1819     visitor.append(thisObject-&gt;m_regExpMatchesArrayStructure);

1820     thisObject-&gt;m_moduleRecordStructure.visit(visitor);
1821     thisObject-&gt;m_moduleNamespaceObjectStructure.visit(visitor);
1822     thisObject-&gt;m_proxyObjectStructure.visit(visitor);
1823     thisObject-&gt;m_callableProxyObjectStructure.visit(visitor);
1824     thisObject-&gt;m_proxyRevokeStructure.visit(visitor);
1825 
<span class="line-added">1826     for (auto&amp; property : thisObject-&gt;m_linkTimeConstants)</span>
<span class="line-added">1827         property.visit(visitor);</span>
<span class="line-added">1828 </span>
1829 #if ENABLE(SHARED_ARRAY_BUFFER)
1830     visitor.append(thisObject-&gt;m_sharedArrayBufferPrototype);
1831     visitor.append(thisObject-&gt;m_sharedArrayBufferStructure);
1832 #endif
1833 
1834 #define VISIT_SIMPLE_TYPE(CapitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) { \
1835         visitor.append(thisObject-&gt;m_ ## lowerName ## Prototype); \
1836         visitor.append(thisObject-&gt;m_ ## properName ## Structure); \
1837     }
1838 
1839     FOR_EACH_SIMPLE_BUILTIN_TYPE(VISIT_SIMPLE_TYPE)
1840     FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(VISIT_SIMPLE_TYPE)
1841 
1842 #define VISIT_LAZY_TYPE(CapitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) \
1843         thisObject-&gt;m_ ## properName ## Structure.visit(visitor);
1844 
1845     FOR_EACH_LAZY_BUILTIN_TYPE(VISIT_LAZY_TYPE)
1846 
1847 #if ENABLE(WEBASSEMBLY)
1848     thisObject-&gt;m_webAssemblyModuleRecordStructure.visit(visitor);
1849     thisObject-&gt;m_webAssemblyFunctionStructure.visit(visitor);
1850     thisObject-&gt;m_jsToWasmICCalleeStructure.visit(visitor);
1851     thisObject-&gt;m_webAssemblyWrapperFunctionStructure.visit(visitor);

1852     FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(VISIT_LAZY_TYPE)
1853 #endif // ENABLE(WEBASSEMBLY)
1854 
1855 #undef VISIT_SIMPLE_TYPE
1856 #undef VISIT_LAZY_TYPE
1857 
1858     for (unsigned i = NumberOfTypedArrayTypes; i--;)
1859         thisObject-&gt;lazyTypedArrayStructure(indexToTypedArrayType(i)).visit(visitor);
1860 
1861     visitor.append(thisObject-&gt;m_speciesGetterSetter);
1862     thisObject-&gt;m_typedArrayProto.visit(visitor);
1863     thisObject-&gt;m_typedArraySuperConstructor.visit(visitor);
1864     thisObject-&gt;m_regExpGlobalData.visitAggregate(visitor);
1865 }
1866 
<span class="line-modified">1867 CallFrame* JSGlobalObject::deprecatedCallFrameForDebugger()</span>
1868 {
<span class="line-modified">1869     return CallFrame::create(m_deprecatedCallFrameForDebugger);</span>
1870 }
1871 
1872 void JSGlobalObject::exposeDollarVM(VM&amp; vm)
1873 {
<span class="line-modified">1874     RELEASE_ASSERT(g_jscConfig.restrictedOptionsEnabled &amp;&amp; Options::useDollarVM());</span>
<span class="line-added">1875     if (hasOwnProperty(this, vm.propertyNames-&gt;builtinNames().dollarVMPrivateName()))</span>
1876         return;
1877 
1878     JSDollarVM* dollarVM = JSDollarVM::create(vm, JSDollarVM::createStructure(vm, this, m_objectPrototype.get()));
1879 
1880     GlobalPropertyInfo extraStaticGlobals[] = {
1881         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().dollarVMPrivateName(), dollarVM, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
1882     };
1883     addStaticGlobals(extraStaticGlobals, WTF_ARRAY_LENGTH(extraStaticGlobals));
1884 
1885     putDirect(vm, Identifier::fromString(vm, &quot;$vm&quot;), dollarVM, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
1886 }
1887 
1888 void JSGlobalObject::addStaticGlobals(GlobalPropertyInfo* globals, int count)
1889 {
1890     ScopeOffset startOffset = addVariables(count, jsUndefined());
1891 
1892     for (int i = 0; i &lt; count; ++i) {
1893         GlobalPropertyInfo&amp; global = globals[i];
1894         // This `configurable = false` is necessary condition for static globals,
1895         // otherwise lexical bindings can change the result of GlobalVar queries too.
1896         // We won&#39;t be able to declare a global lexical variable with the sanem name to
1897         // the static globals because configurable = false.
1898         ASSERT(global.attributes &amp; PropertyAttribute::DontDelete);
1899 
1900         WatchpointSet* watchpointSet = nullptr;
1901         WriteBarrierBase&lt;Unknown&gt;* variable = nullptr;
1902         {
1903             ConcurrentJSLocker locker(symbolTable()-&gt;m_lock);
1904             ScopeOffset offset = symbolTable()-&gt;takeNextScopeOffset(locker);
1905             RELEASE_ASSERT(offset == startOffset + i);
1906             SymbolTableEntry newEntry(VarOffset(offset), global.attributes);
1907             newEntry.prepareToWatch();
1908             watchpointSet = newEntry.watchpointSet();
1909             symbolTable()-&gt;add(locker, global.identifier.impl(), WTFMove(newEntry));
1910             variable = &amp;variableAt(offset);
1911         }
1912         symbolTablePutTouchWatchpointSet(vm(), this, global.identifier, global.value, variable, watchpointSet);
1913     }
1914 }
1915 
<span class="line-modified">1916 bool JSGlobalObject::getOwnPropertySlot(JSObject* object, JSGlobalObject* globalObject, PropertyName propertyName, PropertySlot&amp; slot)</span>
1917 {
<span class="line-modified">1918     if (Base::getOwnPropertySlot(object, globalObject, propertyName, slot))</span>
1919         return true;
1920     return symbolTableGet(jsCast&lt;JSGlobalObject*&gt;(object), propertyName, slot);
1921 }
1922 
1923 void JSGlobalObject::clearRareData(JSCell* cell)
1924 {
1925     jsCast&lt;JSGlobalObject*&gt;(cell)-&gt;m_rareData = nullptr;
1926 }
1927 
<span class="line-modified">1928 void JSGlobalObject::tryInstallArraySpeciesWatchpoint()</span>
1929 {
1930     RELEASE_ASSERT(!m_arrayPrototypeConstructorWatchpoint);
1931     RELEASE_ASSERT(!m_arrayConstructorSpeciesWatchpoint);
1932 
<span class="line-modified">1933     VM&amp; vm = this-&gt;vm();</span>
1934     auto scope = DECLARE_THROW_SCOPE(vm);
1935 
1936     // First we need to make sure that the Array.prototype.constructor property points to Array
1937     // and that Array[Symbol.species] is the primordial GetterSetter.
1938     ArrayPrototype* arrayPrototype = this-&gt;arrayPrototype();
1939 
1940     // We only initialize once so flattening the structures does not have any real cost.
1941     Structure* prototypeStructure = arrayPrototype-&gt;structure(vm);
1942     if (prototypeStructure-&gt;isDictionary())
1943         prototypeStructure = prototypeStructure-&gt;flattenDictionaryStructure(vm, arrayPrototype);
1944     RELEASE_ASSERT(!prototypeStructure-&gt;isDictionary());
1945 
1946     ArrayConstructor* arrayConstructor = this-&gt;arrayConstructor();
1947 
1948     auto invalidateWatchpoint = [&amp;] {
1949         m_arraySpeciesWatchpointSet.invalidate(vm, StringFireDetail(&quot;Was not able to set up array species watchpoint.&quot;));
1950     };
1951 
1952     PropertySlot constructorSlot(arrayPrototype, PropertySlot::InternalMethodType::VMInquiry);
<span class="line-modified">1953     arrayPrototype-&gt;getOwnPropertySlot(arrayPrototype, this, vm.propertyNames-&gt;constructor, constructorSlot);</span>
1954     scope.assertNoException();
1955     if (constructorSlot.slotBase() != arrayPrototype
1956         || !constructorSlot.isCacheableValue()
<span class="line-modified">1957         || constructorSlot.getValue(this, vm.propertyNames-&gt;constructor) != arrayConstructor) {</span>
1958         invalidateWatchpoint();
1959         return;
1960     }
1961 
1962     Structure* constructorStructure = arrayConstructor-&gt;structure(vm);
1963     if (constructorStructure-&gt;isDictionary())
1964         constructorStructure = constructorStructure-&gt;flattenDictionaryStructure(vm, arrayConstructor);
1965 
1966     PropertySlot speciesSlot(arrayConstructor, PropertySlot::InternalMethodType::VMInquiry);
<span class="line-modified">1967     arrayConstructor-&gt;getOwnPropertySlot(arrayConstructor, this, vm.propertyNames-&gt;speciesSymbol, speciesSlot);</span>
1968     scope.assertNoException();
1969     if (speciesSlot.slotBase() != arrayConstructor
1970         || !speciesSlot.isCacheableGetter()
1971         || speciesSlot.getterSetter() != speciesGetterSetter()) {
1972         invalidateWatchpoint();
1973         return;
1974     }
1975 
1976     // Now we need to setup the watchpoints to make sure these conditions remain valid.
1977     prototypeStructure-&gt;startWatchingPropertyForReplacements(vm, constructorSlot.cachedOffset());
1978     constructorStructure-&gt;startWatchingPropertyForReplacements(vm, speciesSlot.cachedOffset());
1979 
1980     ObjectPropertyCondition constructorCondition = ObjectPropertyCondition::equivalence(vm, arrayPrototype, arrayPrototype, vm.propertyNames-&gt;constructor.impl(), arrayConstructor);
1981     ObjectPropertyCondition speciesCondition = ObjectPropertyCondition::equivalence(vm, arrayPrototype, arrayConstructor, vm.propertyNames-&gt;speciesSymbol.impl(), speciesGetterSetter());
1982 
1983     if (!constructorCondition.isWatchable() || !speciesCondition.isWatchable()) {
1984         invalidateWatchpoint();
1985         return;
1986     }
1987 
1988     // We only watch this from the DFG, and the DFG makes sure to only start watching if the watchpoint is in the IsWatched state.
1989     RELEASE_ASSERT(!m_arraySpeciesWatchpointSet.isBeingWatched());
1990     m_arraySpeciesWatchpointSet.touch(vm, &quot;Set up array species watchpoint.&quot;);
1991 
1992     m_arrayPrototypeConstructorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, constructorCondition, m_arraySpeciesWatchpointSet);
1993     m_arrayPrototypeConstructorWatchpoint-&gt;install(vm);
1994 
1995     m_arrayConstructorSpeciesWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, speciesCondition, m_arraySpeciesWatchpointSet);
1996     m_arrayConstructorSpeciesWatchpoint-&gt;install(vm);
1997 }
1998 
<span class="line-added">1999 void JSGlobalObject::installNumberPrototypeWatchpoint(NumberPrototype* numberPrototype)</span>
<span class="line-added">2000 {</span>
<span class="line-added">2001     VM&amp; vm = this-&gt;vm();</span>
<span class="line-added">2002     ASSERT(m_numberToStringWatchpointSet.isStillValid());</span>
<span class="line-added">2003     ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, numberPrototype, vm.propertyNames-&gt;toString);</span>
<span class="line-added">2004     m_numberPrototypeToStringWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_numberToStringWatchpointSet);</span>
<span class="line-added">2005     m_numberPrototypeToStringWatchpoint-&gt;install(vm);</span>
<span class="line-added">2006 }</span>
<span class="line-added">2007 </span>
<span class="line-added">2008 void JSGlobalObject::installMapPrototypeWatchpoint(MapPrototype* mapPrototype)</span>
<span class="line-added">2009 {</span>
<span class="line-added">2010     VM&amp; vm = this-&gt;vm();</span>
<span class="line-added">2011     if (m_mapIteratorProtocolWatchpointSet.isStillValid()) {</span>
<span class="line-added">2012         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, mapPrototype, vm.propertyNames-&gt;iteratorSymbol);</span>
<span class="line-added">2013         m_mapPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_mapIteratorProtocolWatchpointSet);</span>
<span class="line-added">2014         m_mapPrototypeSymbolIteratorWatchpoint-&gt;install(vm);</span>
<span class="line-added">2015     }</span>
<span class="line-added">2016     ASSERT(m_mapSetWatchpointSet.isStillValid());</span>
<span class="line-added">2017     ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, mapPrototype, vm.propertyNames-&gt;set);</span>
<span class="line-added">2018     m_mapPrototypeSetWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_mapSetWatchpointSet);</span>
<span class="line-added">2019     m_mapPrototypeSetWatchpoint-&gt;install(vm);</span>
<span class="line-added">2020 }</span>
<span class="line-added">2021 </span>
<span class="line-added">2022 void JSGlobalObject::installSetPrototypeWatchpoint(SetPrototype* setPrototype)</span>
<span class="line-added">2023 {</span>
<span class="line-added">2024     VM&amp; vm = this-&gt;vm();</span>
<span class="line-added">2025     if (m_setIteratorProtocolWatchpointSet.isStillValid()) {</span>
<span class="line-added">2026         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, setPrototype, vm.propertyNames-&gt;iteratorSymbol);</span>
<span class="line-added">2027         m_setPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_setIteratorProtocolWatchpointSet);</span>
<span class="line-added">2028         m_setPrototypeSymbolIteratorWatchpoint-&gt;install(vm);</span>
<span class="line-added">2029     }</span>
<span class="line-added">2030     ASSERT(m_setAddWatchpointSet.isStillValid());</span>
<span class="line-added">2031     ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this, setPrototype, vm.propertyNames-&gt;add);</span>
<span class="line-added">2032     m_setPrototypeAddWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_setAddWatchpointSet);</span>
<span class="line-added">2033     m_setPrototypeAddWatchpoint-&gt;install(vm);</span>
<span class="line-added">2034 }</span>
<span class="line-added">2035 </span>
2036 void slowValidateCell(JSGlobalObject* globalObject)
2037 {
2038     RELEASE_ASSERT(globalObject-&gt;isGlobalObject());
2039     ASSERT_GC_OBJECT_INHERITS(globalObject, JSGlobalObject::info());
2040 }
2041 
2042 void JSGlobalObject::setRemoteDebuggingEnabled(bool enabled)
2043 {
2044 #if ENABLE(REMOTE_INSPECTOR)
2045     m_inspectorDebuggable-&gt;setRemoteDebuggingAllowed(enabled);
2046 #else
2047     UNUSED_PARAM(enabled);
2048 #endif
2049 }
2050 
2051 bool JSGlobalObject::remoteDebuggingEnabled() const
2052 {
2053 #if ENABLE(REMOTE_INSPECTOR)
2054     return m_inspectorDebuggable-&gt;remoteDebuggingAllowed();
2055 #else
2056     return false;
2057 #endif
2058 }
2059 
2060 void JSGlobalObject::setName(const String&amp; name)
2061 {
2062     m_name = name;
2063 
2064 #if ENABLE(REMOTE_INSPECTOR)
2065     m_inspectorDebuggable-&gt;update();
2066 #endif
2067 }
2068 
























































































2069 void JSGlobalObject::bumpGlobalLexicalBindingEpoch(VM&amp; vm)
2070 {
2071     if (++m_globalLexicalBindingEpoch == Options::thresholdForGlobalLexicalBindingEpoch()) {
2072         // Since the epoch overflows, we should rewrite all the CodeBlock to adjust to the newly started generation.
2073         m_globalLexicalBindingEpoch = 1;
2074         vm.heap.codeBlockSet().iterate([&amp;] (CodeBlock* codeBlock) {
2075             if (codeBlock-&gt;globalObject() != this)
2076                 return;
2077             codeBlock-&gt;notifyLexicalBindingUpdate();
2078         });
2079     }
2080 }
2081 
2082 void JSGlobalObject::queueMicrotask(Ref&lt;Microtask&gt;&amp;&amp; task)
2083 {
2084     if (globalObjectMethodTable()-&gt;queueTaskToEventLoop) {
2085         globalObjectMethodTable()-&gt;queueTaskToEventLoop(*this, WTFMove(task));
2086         return;
2087     }
2088 
</pre>
<hr />
<pre>
2118     ConcurrentJSLocker locker(m_referencedGlobalPropertyWatchpointSetsLock);
2119     return m_referencedGlobalPropertyWatchpointSets.ensure(uid, [] {
2120         return WatchpointSet::create(IsWatched);
2121     }).iterator-&gt;value.get();
2122 }
2123 #endif
2124 
2125 JSGlobalObject* JSGlobalObject::create(VM&amp; vm, Structure* structure)
2126 {
2127     JSGlobalObject* globalObject = new (NotNull, allocateCell&lt;JSGlobalObject&gt;(vm.heap)) JSGlobalObject(vm, structure);
2128     globalObject-&gt;finishCreation(vm);
2129     return globalObject;
2130 }
2131 
2132 void JSGlobalObject::finishCreation(VM&amp; vm)
2133 {
2134     Base::finishCreation(vm);
2135     structure(vm)-&gt;setGlobalObject(vm, this);
2136     m_runtimeFlags = m_globalObjectMethodTable-&gt;javaScriptRuntimeFlags(this);
2137     init(vm);
<span class="line-modified">2138     setGlobalThis(vm, JSProxy::create(vm, JSProxy::createStructure(vm, this, getPrototypeDirect(vm), PureForwardingProxyType), this));</span>
2139     ASSERT(type() == GlobalObjectType);
2140 }
2141 
2142 void JSGlobalObject::finishCreation(VM&amp; vm, JSObject* thisValue)
2143 {
2144     Base::finishCreation(vm);
2145     structure(vm)-&gt;setGlobalObject(vm, this);
2146     m_runtimeFlags = m_globalObjectMethodTable-&gt;javaScriptRuntimeFlags(this);
2147     init(vm);
2148     setGlobalThis(vm, thisValue);
2149     ASSERT(type() == GlobalObjectType);
2150 }
2151 
2152 #ifdef JSC_GLIB_API_ENABLED
2153 void JSGlobalObject::setWrapperMap(std::unique_ptr&lt;WrapperMap&gt;&amp;&amp; map)
2154 {
2155     m_wrapperMap = WTFMove(map);
2156 }
2157 #endif
2158 
</pre>
</td>
</tr>
</table>
<center><a href="JSGlobalLexicalEnvironment.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSGlobalObject.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>