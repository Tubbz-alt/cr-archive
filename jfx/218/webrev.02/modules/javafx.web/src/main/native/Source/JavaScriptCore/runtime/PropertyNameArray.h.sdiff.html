<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/PropertyNameArray.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PropertyMapHashTable.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PropertyOffset.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/PropertyNameArray.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  3  *
  4  *  This library is free software; you can redistribute it and/or
  5  *  modify it under the terms of the GNU Library General Public
  6  *  License as published by the Free Software Foundation; either
  7  *  version 2 of the License, or (at your option) any later version.
  8  *
  9  *  This library is distributed in the hope that it will be useful,
 10  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 11  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 12  *  Library General Public License for more details.
 13  *
 14  *  You should have received a copy of the GNU Library General Public License
 15  *  along with this library; see the file COPYING.LIB.  If not, write to
 16  *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 17  *  Boston, MA 02110-1301, USA.
 18  *
 19  */
 20 
 21 #pragma once
 22 
<span class="line-removed"> 23 #include &quot;CallFrame.h&quot;</span>
 24 #include &quot;Identifier.h&quot;
 25 #include &lt;wtf/HashSet.h&gt;
 26 #include &lt;wtf/Vector.h&gt;
 27 
 28 namespace JSC {
 29 
 30 // FIXME: Rename to PropertyNameArray.
 31 class PropertyNameArrayData : public RefCounted&lt;PropertyNameArrayData&gt; {
 32 public:
 33     typedef Vector&lt;Identifier, 20&gt; PropertyNameVector;
 34 
 35     static Ref&lt;PropertyNameArrayData&gt; create() { return adoptRef(*new PropertyNameArrayData); }
 36 
 37     PropertyNameVector&amp; propertyNameVector() { return m_propertyNameVector; }
 38 
 39 private:
 40     PropertyNameArrayData()
 41     {
 42     }
 43 
</pre>
<hr />
<pre>
 98 
 99 ALWAYS_INLINE void PropertyNameArray::add(const Identifier&amp; identifier)
100 {
101     add(identifier.impl());
102 }
103 
104 ALWAYS_INLINE void PropertyNameArray::addUncheckedInternal(UniquedStringImpl* identifier)
105 {
106     m_data-&gt;propertyNameVector().append(Identifier::fromUid(m_vm, identifier));
107 }
108 
109 ALWAYS_INLINE void PropertyNameArray::addUnchecked(UniquedStringImpl* identifier)
110 {
111     if (!isUidMatchedToTypeMode(identifier))
112         return;
113     addUncheckedInternal(identifier);
114 }
115 
116 ALWAYS_INLINE void PropertyNameArray::add(UniquedStringImpl* identifier)
117 {
<span class="line-modified">118     static const unsigned setThreshold = 20;</span>
119 
120     ASSERT(identifier);
121 
122     if (!isUidMatchedToTypeMode(identifier))
123         return;
124 
125     if (size() &lt; setThreshold) {
126         if (m_data-&gt;propertyNameVector().contains(identifier))
127             return;
128     } else {
129         if (m_set.isEmpty()) {
130             for (Identifier&amp; name : m_data-&gt;propertyNameVector())
131                 m_set.add(name.impl());
132         }
133         if (!m_set.add(identifier).isNewEntry)
134             return;
135     }
136 
137     addUncheckedInternal(identifier);
138 }
</pre>
</td>
<td>
<hr />
<pre>
  3  *
  4  *  This library is free software; you can redistribute it and/or
  5  *  modify it under the terms of the GNU Library General Public
  6  *  License as published by the Free Software Foundation; either
  7  *  version 2 of the License, or (at your option) any later version.
  8  *
  9  *  This library is distributed in the hope that it will be useful,
 10  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 11  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 12  *  Library General Public License for more details.
 13  *
 14  *  You should have received a copy of the GNU Library General Public License
 15  *  along with this library; see the file COPYING.LIB.  If not, write to
 16  *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 17  *  Boston, MA 02110-1301, USA.
 18  *
 19  */
 20 
 21 #pragma once
 22 

 23 #include &quot;Identifier.h&quot;
 24 #include &lt;wtf/HashSet.h&gt;
 25 #include &lt;wtf/Vector.h&gt;
 26 
 27 namespace JSC {
 28 
 29 // FIXME: Rename to PropertyNameArray.
 30 class PropertyNameArrayData : public RefCounted&lt;PropertyNameArrayData&gt; {
 31 public:
 32     typedef Vector&lt;Identifier, 20&gt; PropertyNameVector;
 33 
 34     static Ref&lt;PropertyNameArrayData&gt; create() { return adoptRef(*new PropertyNameArrayData); }
 35 
 36     PropertyNameVector&amp; propertyNameVector() { return m_propertyNameVector; }
 37 
 38 private:
 39     PropertyNameArrayData()
 40     {
 41     }
 42 
</pre>
<hr />
<pre>
 97 
 98 ALWAYS_INLINE void PropertyNameArray::add(const Identifier&amp; identifier)
 99 {
100     add(identifier.impl());
101 }
102 
103 ALWAYS_INLINE void PropertyNameArray::addUncheckedInternal(UniquedStringImpl* identifier)
104 {
105     m_data-&gt;propertyNameVector().append(Identifier::fromUid(m_vm, identifier));
106 }
107 
108 ALWAYS_INLINE void PropertyNameArray::addUnchecked(UniquedStringImpl* identifier)
109 {
110     if (!isUidMatchedToTypeMode(identifier))
111         return;
112     addUncheckedInternal(identifier);
113 }
114 
115 ALWAYS_INLINE void PropertyNameArray::add(UniquedStringImpl* identifier)
116 {
<span class="line-modified">117     static constexpr unsigned setThreshold = 20;</span>
118 
119     ASSERT(identifier);
120 
121     if (!isUidMatchedToTypeMode(identifier))
122         return;
123 
124     if (size() &lt; setThreshold) {
125         if (m_data-&gt;propertyNameVector().contains(identifier))
126             return;
127     } else {
128         if (m_set.isEmpty()) {
129             for (Identifier&amp; name : m_data-&gt;propertyNameVector())
130                 m_set.add(name.impl());
131         }
132         if (!m_set.add(identifier).isNewEntry)
133             return;
134     }
135 
136     addUncheckedInternal(identifier);
137 }
</pre>
</td>
</tr>
</table>
<center><a href="PropertyMapHashTable.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PropertyOffset.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>