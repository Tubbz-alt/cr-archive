<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/dynbench.cpp</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="disassembler/udis86/udis86_syn.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftl/FTLAbstractHeapRepository.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/dynbench.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 79 
 80         nameFilter = argv[1];
 81 
 82         if (argc &gt;= 3) {
 83             if (sscanf(argv[2], &quot;%u&quot;, &amp;requestedIterationCount) != 1) {
 84                 dataLog(&quot;Could not parse iteration count &quot;, argv[2], &quot;\n&quot;);
 85                 return 1;
 86             }
 87         }
 88     }
 89 
 90     WTF::initializeMainThread();
 91     JSC::initializeThreading();
 92 
 93     VM&amp; vm = VM::create(LargeHeap).leakRef();
 94     {
 95         JSLockHolder locker(vm);
 96 
 97         JSGlobalObject* globalObject =
 98             JSGlobalObject::create(vm, JSGlobalObject::createStructure(vm, jsNull()));
<span class="line-removed"> 99         ExecState* exec = globalObject-&gt;globalExec();</span>
100 
101         Identifier identF = Identifier::fromString(vm, &quot;f&quot;);
102         Identifier identG = Identifier::fromString(vm, &quot;g&quot;);
103 
104         Structure* objectStructure =
105             JSFinalObject::createStructure(vm, globalObject, globalObject-&gt;objectPrototype(), 2);
106 
107         // Non-strict dynamic get by id:
108         JSValue object = JSFinalObject::create(vm, objectStructure);
109         {
110             PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">111             object.putInline(exec, identF, jsNumber(42), slot);</span>
112         }
113         {
114             PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">115             object.putInline(exec, identG, jsNumber(43), slot);</span>
116         }
117         benchmarkImpl(
118             &quot;Non Strict Dynamic Get By Id&quot;,
119             1000000,
120             [&amp;] (unsigned iterationCount) {
121                 for (unsigned i = iterationCount; i--;) {
<span class="line-modified">122                     JSValue result = object.get(exec, identF);</span>
123                     CHECK(result == jsNumber(42));
<span class="line-modified">124                     result = object.get(exec, identG);</span>
125                     CHECK(result == jsNumber(43));
126                 }
127             });
128 
129         // Non-strict dynamic put by id replace:
130         object = JSFinalObject::create(vm, objectStructure);
131         {
132             PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">133             object.putInline(exec, identF, jsNumber(42), slot);</span>
134         }
135         {
136             PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">137             object.putInline(exec, identG, jsNumber(43), slot);</span>
138         }
139         benchmarkImpl(
140             &quot;Non Strict Dynamic Put By Id Replace&quot;,
141             1000000,
142             [&amp;] (unsigned iterationCount) {
143                 for (unsigned i = iterationCount; i--;) {
144                     {
145                         PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">146                         object.putInline(exec, identF, jsNumber(i), slot);</span>
147                     }
148                     {
149                         PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">150                         object.putInline(exec, identG, jsNumber(i), slot);</span>
151                     }
152                 }
153             });
154 
155         // Non-strict dynamic put by id transition with object allocation:
156         benchmarkImpl(
157             &quot;Non Strict Dynamic Allocation and Put By Id Transition&quot;,
158             1000000,
159             [&amp;] (unsigned iterationCount) {
160                 for (unsigned i = iterationCount; i--;) {
161                     JSValue object = JSFinalObject::create(vm, objectStructure);
162                     {
163                         PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">164                         object.putInline(exec, identF, jsNumber(i), slot);</span>
165                     }
166                     {
167                         PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">168                         object.putInline(exec, identG, jsNumber(i), slot);</span>
169                     }
170                 }
171             });
172 
173         // Non-strict dynamic get by id with dynamic store context:
174         object = JSFinalObject::create(vm, objectStructure);
175         {
176             PutPropertySlot slot(object, false);
<span class="line-modified">177             object.putInline(exec, identF, jsNumber(42), slot);</span>
178         }
179         {
180             PutPropertySlot slot(object, false);
<span class="line-modified">181             object.putInline(exec, identG, jsNumber(43), slot);</span>
182         }
183         benchmarkImpl(
184             &quot;Non Strict Dynamic Get By Id With Dynamic Store Context&quot;,
185             1000000,
186             [&amp;] (unsigned iterationCount) {
187                 for (unsigned i = iterationCount; i--;) {
<span class="line-modified">188                     JSValue result = object.get(exec, identF);</span>
189                     CHECK(result == jsNumber(42));
<span class="line-modified">190                     result = object.get(exec, identG);</span>
191                     CHECK(result == jsNumber(43));
192                 }
193             });
194 
195         // Non-strict dynamic put by id replace with dynamic store context:
196         object = JSFinalObject::create(vm, objectStructure);
197         {
198             PutPropertySlot slot(object, false);
<span class="line-modified">199             object.putInline(exec, identF, jsNumber(42), slot);</span>
200         }
201         {
202             PutPropertySlot slot(object, false);
<span class="line-modified">203             object.putInline(exec, identG, jsNumber(43), slot);</span>
204         }
205         benchmarkImpl(
206             &quot;Non Strict Dynamic Put By Id Replace With Dynamic Store Context&quot;,
207             1000000,
208             [&amp;] (unsigned iterationCount) {
209                 for (unsigned i = iterationCount; i--;) {
210                     {
211                         PutPropertySlot slot(object, false);
<span class="line-modified">212                         object.putInline(exec, identF, jsNumber(i), slot);</span>
213                     }
214                     {
215                         PutPropertySlot slot(object, false);
<span class="line-modified">216                         object.putInline(exec, identG, jsNumber(i), slot);</span>
217                     }
218                 }
219             });
220 
221         // Non-strict dynamic put by id transition with object allocation with dynamic store context:
222         benchmarkImpl(
223             &quot;Non Strict Dynamic Allocation and Put By Id Transition With Dynamic Store Context&quot;,
224             1000000,
225             [&amp;] (unsigned iterationCount) {
226                 for (unsigned i = iterationCount; i--;) {
227                     JSValue object = JSFinalObject::create(vm, objectStructure);
228                     {
229                         PutPropertySlot slot(object, false);
<span class="line-modified">230                         object.putInline(exec, identF, jsNumber(i), slot);</span>
231                     }
232                     {
233                         PutPropertySlot slot(object, false);
<span class="line-modified">234                         object.putInline(exec, identG, jsNumber(i), slot);</span>
235                     }
236                 }
237             });
238     }
239 
240     crashLock.lock();
241     return 0;
242 }
243 
</pre>
</td>
<td>
<hr />
<pre>
 79 
 80         nameFilter = argv[1];
 81 
 82         if (argc &gt;= 3) {
 83             if (sscanf(argv[2], &quot;%u&quot;, &amp;requestedIterationCount) != 1) {
 84                 dataLog(&quot;Could not parse iteration count &quot;, argv[2], &quot;\n&quot;);
 85                 return 1;
 86             }
 87         }
 88     }
 89 
 90     WTF::initializeMainThread();
 91     JSC::initializeThreading();
 92 
 93     VM&amp; vm = VM::create(LargeHeap).leakRef();
 94     {
 95         JSLockHolder locker(vm);
 96 
 97         JSGlobalObject* globalObject =
 98             JSGlobalObject::create(vm, JSGlobalObject::createStructure(vm, jsNull()));

 99 
100         Identifier identF = Identifier::fromString(vm, &quot;f&quot;);
101         Identifier identG = Identifier::fromString(vm, &quot;g&quot;);
102 
103         Structure* objectStructure =
104             JSFinalObject::createStructure(vm, globalObject, globalObject-&gt;objectPrototype(), 2);
105 
106         // Non-strict dynamic get by id:
107         JSValue object = JSFinalObject::create(vm, objectStructure);
108         {
109             PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">110             object.putInline(globalObject, identF, jsNumber(42), slot);</span>
111         }
112         {
113             PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">114             object.putInline(globalObject, identG, jsNumber(43), slot);</span>
115         }
116         benchmarkImpl(
117             &quot;Non Strict Dynamic Get By Id&quot;,
118             1000000,
119             [&amp;] (unsigned iterationCount) {
120                 for (unsigned i = iterationCount; i--;) {
<span class="line-modified">121                     JSValue result = object.get(globalObject, identF);</span>
122                     CHECK(result == jsNumber(42));
<span class="line-modified">123                     result = object.get(globalObject, identG);</span>
124                     CHECK(result == jsNumber(43));
125                 }
126             });
127 
128         // Non-strict dynamic put by id replace:
129         object = JSFinalObject::create(vm, objectStructure);
130         {
131             PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">132             object.putInline(globalObject, identF, jsNumber(42), slot);</span>
133         }
134         {
135             PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">136             object.putInline(globalObject, identG, jsNumber(43), slot);</span>
137         }
138         benchmarkImpl(
139             &quot;Non Strict Dynamic Put By Id Replace&quot;,
140             1000000,
141             [&amp;] (unsigned iterationCount) {
142                 for (unsigned i = iterationCount; i--;) {
143                     {
144                         PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">145                         object.putInline(globalObject, identF, jsNumber(i), slot);</span>
146                     }
147                     {
148                         PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">149                         object.putInline(globalObject, identG, jsNumber(i), slot);</span>
150                     }
151                 }
152             });
153 
154         // Non-strict dynamic put by id transition with object allocation:
155         benchmarkImpl(
156             &quot;Non Strict Dynamic Allocation and Put By Id Transition&quot;,
157             1000000,
158             [&amp;] (unsigned iterationCount) {
159                 for (unsigned i = iterationCount; i--;) {
160                     JSValue object = JSFinalObject::create(vm, objectStructure);
161                     {
162                         PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">163                         object.putInline(globalObject, identF, jsNumber(i), slot);</span>
164                     }
165                     {
166                         PutPropertySlot slot(object, false, PutPropertySlot::PutById);
<span class="line-modified">167                         object.putInline(globalObject, identG, jsNumber(i), slot);</span>
168                     }
169                 }
170             });
171 
172         // Non-strict dynamic get by id with dynamic store context:
173         object = JSFinalObject::create(vm, objectStructure);
174         {
175             PutPropertySlot slot(object, false);
<span class="line-modified">176             object.putInline(globalObject, identF, jsNumber(42), slot);</span>
177         }
178         {
179             PutPropertySlot slot(object, false);
<span class="line-modified">180             object.putInline(globalObject, identG, jsNumber(43), slot);</span>
181         }
182         benchmarkImpl(
183             &quot;Non Strict Dynamic Get By Id With Dynamic Store Context&quot;,
184             1000000,
185             [&amp;] (unsigned iterationCount) {
186                 for (unsigned i = iterationCount; i--;) {
<span class="line-modified">187                     JSValue result = object.get(globalObject, identF);</span>
188                     CHECK(result == jsNumber(42));
<span class="line-modified">189                     result = object.get(globalObject, identG);</span>
190                     CHECK(result == jsNumber(43));
191                 }
192             });
193 
194         // Non-strict dynamic put by id replace with dynamic store context:
195         object = JSFinalObject::create(vm, objectStructure);
196         {
197             PutPropertySlot slot(object, false);
<span class="line-modified">198             object.putInline(globalObject, identF, jsNumber(42), slot);</span>
199         }
200         {
201             PutPropertySlot slot(object, false);
<span class="line-modified">202             object.putInline(globalObject, identG, jsNumber(43), slot);</span>
203         }
204         benchmarkImpl(
205             &quot;Non Strict Dynamic Put By Id Replace With Dynamic Store Context&quot;,
206             1000000,
207             [&amp;] (unsigned iterationCount) {
208                 for (unsigned i = iterationCount; i--;) {
209                     {
210                         PutPropertySlot slot(object, false);
<span class="line-modified">211                         object.putInline(globalObject, identF, jsNumber(i), slot);</span>
212                     }
213                     {
214                         PutPropertySlot slot(object, false);
<span class="line-modified">215                         object.putInline(globalObject, identG, jsNumber(i), slot);</span>
216                     }
217                 }
218             });
219 
220         // Non-strict dynamic put by id transition with object allocation with dynamic store context:
221         benchmarkImpl(
222             &quot;Non Strict Dynamic Allocation and Put By Id Transition With Dynamic Store Context&quot;,
223             1000000,
224             [&amp;] (unsigned iterationCount) {
225                 for (unsigned i = iterationCount; i--;) {
226                     JSValue object = JSFinalObject::create(vm, objectStructure);
227                     {
228                         PutPropertySlot slot(object, false);
<span class="line-modified">229                         object.putInline(globalObject, identF, jsNumber(i), slot);</span>
230                     }
231                     {
232                         PutPropertySlot slot(object, false);
<span class="line-modified">233                         object.putInline(globalObject, identG, jsNumber(i), slot);</span>
234                     }
235                 }
236             });
237     }
238 
239     crashLock.lock();
240     return 0;
241 }
242 
</pre>
</td>
</tr>
</table>
<center><a href="disassembler/udis86/udis86_syn.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftl/FTLAbstractHeapRepository.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>