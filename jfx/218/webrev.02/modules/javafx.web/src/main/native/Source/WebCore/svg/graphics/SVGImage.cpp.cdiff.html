<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/svg/graphics/SVGImage.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../animation/SVGSMILElement.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="SVGImage.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/svg/graphics/SVGImage.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 216,11 ***</span>
  {
      if (!m_page)
          return nullptr;
  
      // Cairo does not use the accelerated drawing flag, so it&#39;s OK to make an unconditionally unaccelerated buffer.
<span class="line-modified">!     std::unique_ptr&lt;ImageBuffer&gt; buffer = ImageBuffer::create(size(), Unaccelerated);</span>
      if (!buffer) // failed to allocate image
          return nullptr;
  
      draw(buffer-&gt;context(), rect(), rect());
  
<span class="line-new-header">--- 216,11 ---</span>
  {
      if (!m_page)
          return nullptr;
  
      // Cairo does not use the accelerated drawing flag, so it&#39;s OK to make an unconditionally unaccelerated buffer.
<span class="line-modified">!     std::unique_ptr&lt;ImageBuffer&gt; buffer = ImageBuffer::create(size(), RenderingMode::Unaccelerated);</span>
      if (!buffer) // failed to allocate image
          return nullptr;
  
      draw(buffer-&gt;context(), rect(), rect());
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 245,18 ***</span>
          return nullptr;
  
      PlatformContextDirect2D platformContext(nativeImageTarget.get());
      GraphicsContext localContext(&amp;platformContext, GraphicsContext::BitmapRenderingContextType::GPUMemory);
  
<span class="line-modified">!     draw(localContext, rect(), rect(), CompositeSourceOver, BlendMode::Normal, DecodingMode::Synchronous, ImageOrientation::None);</span>
  
      COMPtr&lt;ID2D1Bitmap&gt; nativeImage;
      HRESULT hr = nativeImageTarget-&gt;GetBitmap(&amp;nativeImage);
      if (!SUCCEEDED(hr))
          return nullptr;
  
<span class="line-modified">! #if !ASSERT_DISABLED</span>
      auto nativeImageSize = nativeImage-&gt;GetPixelSize();
      ASSERT(nativeImageSize.height = rect().size().height());
      ASSERT(nativeImageSize.width = rect().size().width());
  #endif
  
<span class="line-new-header">--- 245,18 ---</span>
          return nullptr;
  
      PlatformContextDirect2D platformContext(nativeImageTarget.get());
      GraphicsContext localContext(&amp;platformContext, GraphicsContext::BitmapRenderingContextType::GPUMemory);
  
<span class="line-modified">!     draw(localContext, rect(), rect(), { CompositeOperator::SourceOver, BlendMode::Normal, DecodingMode::Synchronous, ImageOrientation::None });</span>
  
      COMPtr&lt;ID2D1Bitmap&gt; nativeImage;
      HRESULT hr = nativeImageTarget-&gt;GetBitmap(&amp;nativeImage);
      if (!SUCCEEDED(hr))
          return nullptr;
  
<span class="line-modified">! #if ASSERT_ENABLED</span>
      auto nativeImageSize = nativeImage-&gt;GetPixelSize();
      ASSERT(nativeImageSize.height = rect().size().height());
      ASSERT(nativeImageSize.width = rect().size().width());
  #endif
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 277,11 ***</span>
      ASSERT(imageBufferScale.height());
  
      FloatRect imageBufferSize = zoomedContainerRect;
      imageBufferSize.scale(imageBufferScale.width(), imageBufferScale.height());
  
<span class="line-modified">!     std::unique_ptr&lt;ImageBuffer&gt; buffer = ImageBuffer::createCompatibleBuffer(expandedIntSize(imageBufferSize.size()), 1, ColorSpaceSRGB, context);</span>
      if (!buffer) // Failed to allocate buffer.
          return;
      drawForContainer(buffer-&gt;context(), containerSize, containerZoom, initialFragmentURL, imageBufferSize, zoomedContainerRect);
      if (context.drawLuminanceMask())
          buffer-&gt;convertToLuminanceMask();
<span class="line-new-header">--- 277,11 ---</span>
      ASSERT(imageBufferScale.height());
  
      FloatRect imageBufferSize = zoomedContainerRect;
      imageBufferSize.scale(imageBufferScale.width(), imageBufferScale.height());
  
<span class="line-modified">!     std::unique_ptr&lt;ImageBuffer&gt; buffer = ImageBuffer::createCompatibleBuffer(expandedIntSize(imageBufferSize.size()), 1, ColorSpace::SRGB, context);</span>
      if (!buffer) // Failed to allocate buffer.
          return;
      drawForContainer(buffer-&gt;context(), containerSize, containerZoom, initialFragmentURL, imageBufferSize, zoomedContainerRect);
      if (context.drawLuminanceMask())
          buffer-&gt;convertToLuminanceMask();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 311,14 ***</span>
      GraphicsContextStateSaver stateSaver(context);
      context.setCompositeOperation(options.compositeOperator(), options.blendMode());
      context.clip(enclosingIntRect(dstRect));
  
      float alpha = context.alpha();
<span class="line-modified">!     bool compositingRequiresTransparencyLayer = options.compositeOperator() != CompositeSourceOver || options.blendMode() != BlendMode::Normal || alpha &lt; 1;</span>
      if (compositingRequiresTransparencyLayer) {
          context.beginTransparencyLayer(alpha);
<span class="line-modified">!         context.setCompositeOperation(CompositeSourceOver, BlendMode::Normal);</span>
      }
  
      FloatSize scale(dstRect.size() / srcRect.size());
  
      // We can only draw the entire frame, clipped to the rect we want. So compute where the top left
<span class="line-new-header">--- 311,14 ---</span>
      GraphicsContextStateSaver stateSaver(context);
      context.setCompositeOperation(options.compositeOperator(), options.blendMode());
      context.clip(enclosingIntRect(dstRect));
  
      float alpha = context.alpha();
<span class="line-modified">!     bool compositingRequiresTransparencyLayer = options.compositeOperator() != CompositeOperator::SourceOver || options.blendMode() != BlendMode::Normal || alpha &lt; 1;</span>
      if (compositingRequiresTransparencyLayer) {
          context.beginTransparencyLayer(alpha);
<span class="line-modified">!         context.setCompositeOperation(CompositeOperator::SourceOver, BlendMode::Normal);</span>
      }
  
      FloatSize scale(dstRect.size() / srcRect.size());
  
      // We can only draw the entire frame, clipped to the rect we want. So compute where the top left
</pre>
<hr />
<pre>
<span class="line-old-header">*** 465,11 ***</span>
      // Don&#39;t do anything; it is an empty image.
      if (!data()-&gt;size())
          return EncodedDataStatus::Complete;
  
      if (allDataReceived) {
<span class="line-modified">!         auto pageConfiguration = pageConfigurationWithEmptyClients();</span>
          m_chromeClient = makeUnique&lt;SVGImageChromeClient&gt;(this);
          pageConfiguration.chromeClient = m_chromeClient.get();
  
          // FIXME: If this SVG ends up loading itself, we might leak the world.
          // The Cache code does not know about CachedImages holding Frames and
<span class="line-new-header">--- 465,11 ---</span>
      // Don&#39;t do anything; it is an empty image.
      if (!data()-&gt;size())
          return EncodedDataStatus::Complete;
  
      if (allDataReceived) {
<span class="line-modified">!         auto pageConfiguration = pageConfigurationWithEmptyClients(PAL::SessionID::defaultSessionID());</span>
          m_chromeClient = makeUnique&lt;SVGImageChromeClient&gt;(this);
          pageConfiguration.chromeClient = m_chromeClient.get();
  
          // FIXME: If this SVG ends up loading itself, we might leak the world.
          // The Cache code does not know about CachedImages holding Frames and
</pre>
<hr />
<pre>
<span class="line-old-header">*** 481,11 ***</span>
          m_page-&gt;settings().setMediaEnabled(false);
          m_page-&gt;settings().setScriptEnabled(false);
          m_page-&gt;settings().setPluginsEnabled(false);
          m_page-&gt;settings().setAcceleratedCompositingEnabled(false);
          m_page-&gt;settings().setShouldAllowUserInstalledFonts(false);
<span class="line-removed">-         m_page-&gt;settings().setShouldAllowDesignSystemUIFonts(false);</span>
  
          Frame&amp; frame = m_page-&gt;mainFrame();
          frame.setView(FrameView::create(frame));
          frame.init();
          FrameLoader&amp; loader = frame.loader();
<span class="line-new-header">--- 481,10 ---</span>
</pre>
<center><a href="../animation/SVGSMILElement.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="SVGImage.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>