<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/bridge/testbindings.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="runtime_object.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../contentextensions/ContentExtensionCompiler.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bridge/testbindings.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
359 
360     return code;
361 }
362 
363 int main(int argc, char **argv)
364 {
365     // expecting a filename
366     if (argc &lt; 2) {
367         fprintf(stderr, &quot;You have to specify at least one filename\n&quot;);
368         return -1;
369     }
370 
371     bool ret = true;
372     {
373         JSLock lock;
374 
375         // create interpreter w/ global object
376         Object global(new GlobalImp());
377         Interpreter interp;
378         interp.setGlobalObject(global);
<span class="line-modified">379         ExecState *exec = interp.globalExec();</span>
380 
381         MyObject *myObject = (MyObject *)NPN_CreateObject (myFunctionPtrs);
382 
<span class="line-modified">383         global.put(exec, Identifier::fromString(exec, &quot;myInterface&quot;), Instance::createRuntimeObject(Instance::CLanguage, (void *)myObject));</span>
384 
385         for (int i = 1; i &lt; argc; i++) {
386             const char *code = readJavaScriptFromFile(argv[i]);
387 
388             if (code) {
389                 // run
390                 Completion comp(interp.evaluate(code));
391 
392                 if (comp.complType() == Throw) {
393                     Value exVal = comp.value();
<span class="line-modified">394                     String message = exVal.toWTFString(exec);</span>
395                     auto cstring = msg.ascii();
396                     const char* msg = cstring.data();
397                     int lineno = -1;
398                     if (exVal.type() == ObjectType) {
<span class="line-modified">399                         Value lineVal = Object::dynamicCast(exVal).get(exec, Identifier::fromString(exec, &quot;line&quot;));</span>
400                         if (lineVal.type() == NumberType)
<span class="line-modified">401                             lineno = int(lineVal.toNumber(exec));</span>
402                     }
403                     if (lineno != -1)
404                         fprintf(stderr,&quot;Exception, line %d: %s\n&quot;,lineno,msg);
405                     else
406                         fprintf(stderr,&quot;Exception: %s\n&quot;,msg);
407                     ret = false;
408                 }
409                 else if (comp.complType() == ReturnValue) {
<span class="line-modified">410                     char *msg = comp.value().toString(interp.globalExec()).ascii();</span>
411                     fprintf(stderr,&quot;Return value: %s\n&quot;,msg);
412                 }
413             }
414         }
415 
416         NPN_ReleaseObject ((NPObject *)myObject);
417 
418     } // end block, so that Interpreter and global get deleted
419 
420     return ret ? 0 : 3;
421 }
</pre>
</td>
<td>
<hr />
<pre>
359 
360     return code;
361 }
362 
363 int main(int argc, char **argv)
364 {
365     // expecting a filename
366     if (argc &lt; 2) {
367         fprintf(stderr, &quot;You have to specify at least one filename\n&quot;);
368         return -1;
369     }
370 
371     bool ret = true;
372     {
373         JSLock lock;
374 
375         // create interpreter w/ global object
376         Object global(new GlobalImp());
377         Interpreter interp;
378         interp.setGlobalObject(global);
<span class="line-modified">379         JSGlobalObject* lexicalGlobalObject = interp.globalObject();</span>
380 
381         MyObject *myObject = (MyObject *)NPN_CreateObject (myFunctionPtrs);
382 
<span class="line-modified">383         global.put(lexicalGlobalObject, Identifier::fromString(lexicalGlobalObject, &quot;myInterface&quot;), Instance::createRuntimeObject(Instance::CLanguage, (void *)myObject));</span>
384 
385         for (int i = 1; i &lt; argc; i++) {
386             const char *code = readJavaScriptFromFile(argv[i]);
387 
388             if (code) {
389                 // run
390                 Completion comp(interp.evaluate(code));
391 
392                 if (comp.complType() == Throw) {
393                     Value exVal = comp.value();
<span class="line-modified">394                     String message = exVal.toWTFString(lexicalGlobalObject);</span>
395                     auto cstring = msg.ascii();
396                     const char* msg = cstring.data();
397                     int lineno = -1;
398                     if (exVal.type() == ObjectType) {
<span class="line-modified">399                         Value lineVal = Object::dynamicCast(exVal).get(lexicalGlobalObject, Identifier::fromString(lexicalGlobalObject, &quot;line&quot;));</span>
400                         if (lineVal.type() == NumberType)
<span class="line-modified">401                             lineno = int(lineVal.toNumber(lexicalGlobalObject));</span>
402                     }
403                     if (lineno != -1)
404                         fprintf(stderr,&quot;Exception, line %d: %s\n&quot;,lineno,msg);
405                     else
406                         fprintf(stderr,&quot;Exception: %s\n&quot;,msg);
407                     ret = false;
408                 }
409                 else if (comp.complType() == ReturnValue) {
<span class="line-modified">410                     char *msg = comp.value().toString(interp.globalObject()).ascii();</span>
411                     fprintf(stderr,&quot;Return value: %s\n&quot;,msg);
412                 }
413             }
414         }
415 
416         NPN_ReleaseObject ((NPObject *)myObject);
417 
418     } // end block, so that Interpreter and global get deleted
419 
420     return ret ? 0 : 3;
421 }
</pre>
</td>
</tr>
</table>
<center><a href="runtime_object.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../contentextensions/ContentExtensionCompiler.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>