<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/html/track/VTTRegion.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="VTTCue.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="VTTRegion.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/html/track/VTTRegion.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 279,11 ***</span>
      static NeverDestroyed&lt;const AtomString&gt; trackRegionShadowPseudoId(&quot;-webkit-media-text-track-region&quot;, AtomString::ConstructFromLiteral);
  
      return trackRegionShadowPseudoId;
  }
  
<span class="line-modified">! void VTTRegion::appendTextTrackCueBox(Ref&lt;VTTCueBox&gt;&amp;&amp; displayBox)</span>
  {
      ASSERT(m_cueContainer);
  
      if (m_cueContainer-&gt;contains(displayBox.ptr()))
          return;
<span class="line-new-header">--- 279,11 ---</span>
      static NeverDestroyed&lt;const AtomString&gt; trackRegionShadowPseudoId(&quot;-webkit-media-text-track-region&quot;, AtomString::ConstructFromLiteral);
  
      return trackRegionShadowPseudoId;
  }
  
<span class="line-modified">! void VTTRegion::appendTextTrackCueBox(Ref&lt;TextTrackCueBox&gt;&amp;&amp; displayBox)</span>
  {
      ASSERT(m_cueContainer);
  
      if (m_cueContainer-&gt;contains(displayBox.ptr()))
          return;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 316,11 ***</span>
              continue;
  
          float height = childBottom - childTop;
  
          m_currentTop -= std::min(height, childBottom - regionBottom);
<span class="line-modified">!         m_cueContainer-&gt;setInlineStyleProperty(CSSPropertyTop, m_currentTop, CSSPrimitiveValue::CSS_PX);</span>
  
          startTimer();
          break;
      }
  }
<span class="line-new-header">--- 316,11 ---</span>
              continue;
  
          float height = childBottom - childTop;
  
          m_currentTop -= std::min(height, childBottom - regionBottom);
<span class="line-modified">!         m_cueContainer-&gt;setInlineStyleProperty(CSSPropertyTop, m_currentTop, CSSUnitType::CSS_PX);</span>
  
          startTimer();
          break;
      }
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 333,20 ***</span>
      double boxHeight = box-&gt;getBoundingClientRect()-&gt;bottom() - box-&gt;getBoundingClientRect()-&gt;top();
  
      m_cueContainer-&gt;classList().remove(textTrackCueContainerScrollingClass());
  
      m_currentTop += boxHeight;
<span class="line-modified">!     m_cueContainer-&gt;setInlineStyleProperty(CSSPropertyTop, m_currentTop, CSSPrimitiveValue::CSS_PX);</span>
  }
  
  HTMLDivElement&amp; VTTRegion::getDisplayTree()
  {
      if (!m_regionDisplayTree) {
          m_regionDisplayTree = HTMLDivElement::create(downcast&lt;Document&gt;(*m_scriptExecutionContext));
<span class="line-modified">!         prepareRegionDisplayTree();</span>
      }
  
      return *m_regionDisplayTree;
  }
  
  void VTTRegion::prepareRegionDisplayTree()
  {
<span class="line-new-header">--- 333,24 ---</span>
      double boxHeight = box-&gt;getBoundingClientRect()-&gt;bottom() - box-&gt;getBoundingClientRect()-&gt;top();
  
      m_cueContainer-&gt;classList().remove(textTrackCueContainerScrollingClass());
  
      m_currentTop += boxHeight;
<span class="line-modified">!     m_cueContainer-&gt;setInlineStyleProperty(CSSPropertyTop, m_currentTop, CSSUnitType::CSS_PX);</span>
  }
  
  HTMLDivElement&amp; VTTRegion::getDisplayTree()
  {
      if (!m_regionDisplayTree) {
          m_regionDisplayTree = HTMLDivElement::create(downcast&lt;Document&gt;(*m_scriptExecutionContext));
<span class="line-modified">!         m_regionDisplayTree-&gt;setPseudo(textTrackRegionShadowPseudoId());</span>
<span class="line-added">+         m_recalculateStyles = true;</span>
      }
  
<span class="line-added">+     if (m_recalculateStyles)</span>
<span class="line-added">+         prepareRegionDisplayTree();</span>
<span class="line-added">+ </span>
      return *m_regionDisplayTree;
  }
  
  void VTTRegion::prepareRegionDisplayTree()
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 357,42 ***</span>
      // FIXME: Change the code below to use viewport units when
      // http://crbug/244618 is fixed.
  
      // Let regionWidth be the text track region width.
      // Let width be &#39;regionWidth vw&#39; (&#39;vw&#39; is a CSS unit)
<span class="line-modified">!     m_regionDisplayTree-&gt;setInlineStyleProperty(CSSPropertyWidth, m_width, CSSPrimitiveValue::CSS_PERCENTAGE);</span>
  
      // Let lineHeight be &#39;0.0533vh&#39; (&#39;vh&#39; is a CSS unit) and regionHeight be
      // the text track region height. Let height be &#39;lineHeight&#39; multiplied
      // by regionHeight.
      double height = lineHeight * m_lines;
<span class="line-modified">!     m_regionDisplayTree-&gt;setInlineStyleProperty(CSSPropertyHeight, height, CSSPrimitiveValue::CSS_VH);</span>
  
      // Let viewportAnchorX be the x dimension of the text track region viewport
      // anchor and regionAnchorX be the x dimension of the text track region
      // anchor. Let leftOffset be regionAnchorX multiplied by width divided by
      // 100.0. Let left be leftOffset subtracted from &#39;viewportAnchorX vw&#39;.
      double leftOffset = m_regionAnchor.x() * m_width / 100;
<span class="line-modified">!     m_regionDisplayTree-&gt;setInlineStyleProperty(CSSPropertyLeft, m_viewportAnchor.x() - leftOffset, CSSPrimitiveValue::CSS_PERCENTAGE);</span>
  
      // Let viewportAnchorY be the y dimension of the text track region viewport
      // anchor and regionAnchorY be the y dimension of the text track region
      // anchor. Let topOffset be regionAnchorY multiplied by height divided by
      // 100.0. Let top be topOffset subtracted from &#39;viewportAnchorY vh&#39;.
      double topOffset = m_regionAnchor.y() * height / 100;
<span class="line-modified">!     m_regionDisplayTree-&gt;setInlineStyleProperty(CSSPropertyTop, m_viewportAnchor.y() - topOffset, CSSPrimitiveValue::CSS_PERCENTAGE);</span>
  
      // The cue container is used to wrap the cues and it is the object which is
      // gradually scrolled out as multiple cues are appended to the region.
<span class="line-modified">!     m_cueContainer = HTMLDivElement::create(downcast&lt;Document&gt;(*m_scriptExecutionContext));</span>
<span class="line-modified">!     m_cueContainer-&gt;setInlineStyleProperty(CSSPropertyTop, 0.0f, CSSPrimitiveValue::CSS_PX);</span>
<span class="line-modified">! </span>
<span class="line-modified">!     m_cueContainer-&gt;setPseudo(textTrackCueContainerShadowPseudoId());</span>
<span class="line-modified">!     m_regionDisplayTree-&gt;appendChild(*m_cueContainer);</span>
  
      // 7.5 Every WebVTT region object is initialised with the following CSS
<span class="line-modified">!     m_regionDisplayTree-&gt;setPseudo(textTrackRegionShadowPseudoId());</span>
  }
  
  void VTTRegion::startTimer()
  {
      LOG(Media, &quot;VTTRegion::startTimer&quot;);
<span class="line-new-header">--- 361,44 ---</span>
      // FIXME: Change the code below to use viewport units when
      // http://crbug/244618 is fixed.
  
      // Let regionWidth be the text track region width.
      // Let width be &#39;regionWidth vw&#39; (&#39;vw&#39; is a CSS unit)
<span class="line-modified">!     m_regionDisplayTree-&gt;setInlineStyleProperty(CSSPropertyWidth, m_width, CSSUnitType::CSS_PERCENTAGE);</span>
  
      // Let lineHeight be &#39;0.0533vh&#39; (&#39;vh&#39; is a CSS unit) and regionHeight be
      // the text track region height. Let height be &#39;lineHeight&#39; multiplied
      // by regionHeight.
      double height = lineHeight * m_lines;
<span class="line-modified">!     m_regionDisplayTree-&gt;setInlineStyleProperty(CSSPropertyHeight, height, CSSUnitType::CSS_VH);</span>
  
      // Let viewportAnchorX be the x dimension of the text track region viewport
      // anchor and regionAnchorX be the x dimension of the text track region
      // anchor. Let leftOffset be regionAnchorX multiplied by width divided by
      // 100.0. Let left be leftOffset subtracted from &#39;viewportAnchorX vw&#39;.
      double leftOffset = m_regionAnchor.x() * m_width / 100;
<span class="line-modified">!     m_regionDisplayTree-&gt;setInlineStyleProperty(CSSPropertyLeft, m_viewportAnchor.x() - leftOffset, CSSUnitType::CSS_PERCENTAGE);</span>
  
      // Let viewportAnchorY be the y dimension of the text track region viewport
      // anchor and regionAnchorY be the y dimension of the text track region
      // anchor. Let topOffset be regionAnchorY multiplied by height divided by
      // 100.0. Let top be topOffset subtracted from &#39;viewportAnchorY vh&#39;.
      double topOffset = m_regionAnchor.y() * height / 100;
<span class="line-modified">!     m_regionDisplayTree-&gt;setInlineStyleProperty(CSSPropertyTop, m_viewportAnchor.y() - topOffset, CSSUnitType::CSS_PERCENTAGE);</span>
  
      // The cue container is used to wrap the cues and it is the object which is
      // gradually scrolled out as multiple cues are appended to the region.
<span class="line-modified">!     if (!m_cueContainer) {</span>
<span class="line-modified">!         m_cueContainer = HTMLDivElement::create(downcast&lt;Document&gt;(*m_scriptExecutionContext));</span>
<span class="line-modified">!         m_cueContainer-&gt;setPseudo(textTrackCueContainerShadowPseudoId());</span>
<span class="line-modified">!         m_regionDisplayTree-&gt;appendChild(*m_cueContainer);</span>
<span class="line-modified">!     }</span>
<span class="line-added">+     m_cueContainer-&gt;setInlineStyleProperty(CSSPropertyTop, 0.0f, CSSUnitType::CSS_PX);</span>
  
      // 7.5 Every WebVTT region object is initialised with the following CSS
<span class="line-modified">! </span>
<span class="line-added">+     m_recalculateStyles = false;</span>
  }
  
  void VTTRegion::startTimer()
  {
      LOG(Media, &quot;VTTRegion::startTimer&quot;);
</pre>
<center><a href="VTTCue.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="VTTRegion.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>