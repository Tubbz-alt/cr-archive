<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/page/Navigator.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  *  Copyright (C) 2000 Harri Porten (porten@kde.org)
  3  *  Copyright (c) 2000 Daniel Molkentin (molkentin@kde.org)
  4  *  Copyright (c) 2000 Stefan Schimanski (schimmi@kde.org)
  5  *  Copyright (C) 2003, 2004, 2005, 2006 Apple Inc.
  6  *  Copyright (C) 2008 Nokia Corporation and/or its subsidiary(-ies)
  7  *
  8  *  This library is free software; you can redistribute it and/or
  9  *  modify it under the terms of the GNU Lesser General Public
 10  *  License as published by the Free Software Foundation; either
 11  *  version 2 of the License, or (at your option) any later version.
 12  *
 13  *  This library is distributed in the hope that it will be useful,
 14  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 15  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 16  *  Lesser General Public License for more details.
 17  *
 18  *  You should have received a copy of the GNU Lesser General Public
 19  *  License along with this library; if not, write to the Free Software
 20  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 21  */
 22 
 23 #include &quot;config.h&quot;
 24 #include &quot;Navigator.h&quot;
 25 
 26 #include &quot;Chrome.h&quot;
 27 #include &quot;CookieJar.h&quot;
 28 #include &quot;DOMMimeTypeArray.h&quot;
 29 #include &quot;DOMPluginArray.h&quot;
 30 #include &quot;Document.h&quot;
 31 #include &quot;Frame.h&quot;
 32 #include &quot;FrameLoader.h&quot;
 33 #include &quot;FrameLoaderClient.h&quot;
 34 #include &quot;Geolocation.h&quot;
 35 #include &quot;JSDOMPromiseDeferred.h&quot;
 36 #include &quot;LoaderStrategy.h&quot;
 37 #include &quot;Page.h&quot;
 38 #include &quot;PlatformStrategies.h&quot;
 39 #include &quot;PluginData.h&quot;
 40 #include &quot;ResourceLoadObserver.h&quot;
 41 #include &quot;RuntimeEnabledFeatures.h&quot;
 42 #include &quot;ScriptController.h&quot;
 43 #include &quot;SecurityOrigin.h&quot;
 44 #include &quot;Settings.h&quot;
 45 #include &lt;wtf/IsoMallocInlines.h&gt;
 46 #include &lt;wtf/Language.h&gt;
 47 #include &lt;wtf/StdLibExtras.h&gt;
 48 #include &lt;wtf/WeakPtr.h&gt;
 49 
 50 namespace WebCore {
 51 
 52 WTF_MAKE_ISO_ALLOCATED_IMPL(Navigator);
 53 
 54 Navigator::Navigator(ScriptExecutionContext* context, DOMWindow&amp; window)
 55     : NavigatorBase(context)
 56     , DOMWindowProperty(&amp;window)
 57 {
 58 }
 59 
 60 Navigator::~Navigator() = default;
 61 
 62 String Navigator::appVersion() const
 63 {
 64     auto* frame = this-&gt;frame();
 65     if (!frame)
 66         return String();
 67     if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled())
 68         ResourceLoadObserver::shared().logNavigatorAPIAccessed(*frame-&gt;document(), ResourceLoadStatistics::NavigatorAPI::AppVersion);
 69     return NavigatorBase::appVersion();
 70 }
 71 
 72 const String&amp; Navigator::userAgent() const
 73 {
 74     auto* frame = this-&gt;frame();
 75     if (!frame || !frame-&gt;page())
 76         return m_userAgent;
 77     if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled())
 78         ResourceLoadObserver::shared().logNavigatorAPIAccessed(*frame-&gt;document(), ResourceLoadStatistics::NavigatorAPI::UserAgent);
 79     if (m_userAgent.isNull())
 80         m_userAgent = frame-&gt;loader().userAgent(frame-&gt;document()-&gt;url());
 81     return m_userAgent;
 82 }
 83 
 84 String Navigator::platform() const
 85 {
 86     auto* frame = this-&gt;frame();
 87     if (!frame || !frame-&gt;page())
 88         return m_platform;
 89 
 90     if (m_platform.isNull())
 91         m_platform = frame-&gt;loader().navigatorPlatform();
 92 
 93     if (m_platform.isNull())
 94         m_platform = NavigatorBase::platform();
 95     return m_platform;
 96 }
 97 
 98 void Navigator::userAgentChanged()
 99 {
100     m_userAgent = String();
101 }
102 
103 bool Navigator::onLine() const
104 {
105     return platformStrategies()-&gt;loaderStrategy()-&gt;isOnLine();
106 }
107 
108 void Navigator::share(ScriptExecutionContext&amp; context, ShareData data, Ref&lt;DeferredPromise&gt;&amp;&amp; promise)
109 {
110     auto* frame = this-&gt;frame();
111     if (!frame || !frame-&gt;page()) {
112         promise-&gt;reject(TypeError);
113         return;
114     }
115 
116     if (data.title.isEmpty() &amp;&amp; data.url.isEmpty() &amp;&amp; data.text.isEmpty()) {
117         promise-&gt;reject(TypeError);
118         return;
119     }
120 
121     Optional&lt;URL&gt; url;
122     if (!data.url.isEmpty()) {
123         url = context.completeURL(data.url);
124         if (!url-&gt;isValid()) {
125             promise-&gt;reject(TypeError);
126             return;
127         }
128     }
129 
130     auto* window = this-&gt;window();
131     // Note that the specification does not indicate we should consume user activation. We are intentionally stricter here.
132     if (!window || !window-&gt;consumeTransientActivation()) {
133         promise-&gt;reject(NotAllowedError);
134         return;
135     }
136 
137     ShareDataWithParsedURL shareData = {
138         data,
139         url,
140     };
141 
142     frame-&gt;page()-&gt;chrome().showShareSheet(shareData, [promise = WTFMove(promise)] (bool completed) {
143         if (completed) {
144             promise-&gt;resolve();
145             return;
146         }
147         promise-&gt;reject(Exception { AbortError, &quot;Abort due to cancellation of share.&quot;_s });
148     });
149 }
150 
151 DOMPluginArray&amp; Navigator::plugins()
152 {
153     if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled()) {
154         if (auto* frame = this-&gt;frame())
155             ResourceLoadObserver::shared().logNavigatorAPIAccessed(*frame-&gt;document(), ResourceLoadStatistics::NavigatorAPI::Plugins);
156     }
157     if (!m_plugins)
158         m_plugins = DOMPluginArray::create(*this);
159     return *m_plugins;
160 }
161 
162 DOMMimeTypeArray&amp; Navigator::mimeTypes()
163 {
164     if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled()) {
165         if (auto* frame = this-&gt;frame())
166             ResourceLoadObserver::shared().logNavigatorAPIAccessed(*frame-&gt;document(), ResourceLoadStatistics::NavigatorAPI::MimeTypes);
167     }
168     if (!m_mimeTypes)
169         m_mimeTypes = DOMMimeTypeArray::create(*this);
170     return *m_mimeTypes;
171 }
172 
173 bool Navigator::cookieEnabled() const
174 {
175     auto* frame = this-&gt;frame();
176     if (!frame)
177         return false;
178 
179     if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled())
180         ResourceLoadObserver::shared().logNavigatorAPIAccessed(*frame-&gt;document(), ResourceLoadStatistics::NavigatorAPI::CookieEnabled);
181 
182     auto* page = frame-&gt;page();
183     if (!page)
184         return false;
185 
186     if (!page-&gt;settings().cookieEnabled())
187         return false;
188 
189     auto* document = frame-&gt;document();
190     if (!document)
191         return false;
192 
193     return page-&gt;cookieJar().cookiesEnabled(*document);
194 }
195 
196 bool Navigator::javaEnabled() const
197 {
198     auto* frame = this-&gt;frame();
199     if (!frame)
200         return false;
201 
202     if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled())
203         ResourceLoadObserver::shared().logNavigatorAPIAccessed(*frame-&gt;document(), ResourceLoadStatistics::NavigatorAPI::JavaEnabled);
204 
205     if (!frame-&gt;settings().isJavaEnabled())
206         return false;
207     if (frame-&gt;document()-&gt;securityOrigin().isLocal() &amp;&amp; !frame-&gt;settings().isJavaEnabledForLocalFiles())
208         return false;
209 
210     return true;
211 }
212 
213 #if PLATFORM(IOS_FAMILY)
214 
215 bool Navigator::standalone() const
216 {
217     auto* frame = this-&gt;frame();
218     return frame &amp;&amp; frame-&gt;settings().standalone();
219 }
220 
221 #endif
222 
223 void Navigator::getStorageUpdates()
224 {
225 }
226 
227 } // namespace WebCore
    </pre>
  </body>
</html>