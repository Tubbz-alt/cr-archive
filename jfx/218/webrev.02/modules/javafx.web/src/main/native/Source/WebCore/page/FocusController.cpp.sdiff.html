<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/page/FocusController.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="EventSource.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Frame.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/page/FocusController.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 818     Ref&lt;Frame&gt; protectedNewFocusedFrame = newFocusedFrame;
 819     RefPtr&lt;Frame&gt; oldFocusedFrame = focusedFrame();
 820     RefPtr&lt;Document&gt; oldDocument = oldFocusedFrame ? oldFocusedFrame-&gt;document() : nullptr;
 821 
 822     Element* oldFocusedElement = oldDocument ? oldDocument-&gt;focusedElement() : nullptr;
 823     if (oldFocusedElement == element)
 824         return true;
 825 
 826     // FIXME: Might want to disable this check for caretBrowsing
 827     if (oldFocusedElement &amp;&amp; oldFocusedElement-&gt;isRootEditableElement() &amp;&amp; !relinquishesEditingFocus(oldFocusedElement))
 828         return false;
 829 
 830     m_page.editorClient().willSetInputMethodState();
 831 
 832     if (shouldClearSelectionWhenChangingFocusedElement(m_page, oldFocusedElement, element))
 833         clearSelectionIfNeeded(oldFocusedFrame.get(), &amp;newFocusedFrame, element);
 834 
 835     if (!element) {
 836         if (oldDocument)
 837             oldDocument-&gt;setFocusedElement(nullptr);
<span class="line-modified"> 838         m_page.editorClient().setInputMethodState(false);</span>
 839         return true;
 840     }
 841 
 842     Ref&lt;Document&gt; newDocument(element-&gt;document());
 843 
 844     if (newDocument-&gt;focusedElement() == element) {
<span class="line-modified"> 845         m_page.editorClient().setInputMethodState(element-&gt;shouldUseInputMethod());</span>
 846         return true;
 847     }
 848 
 849     if (oldDocument &amp;&amp; oldDocument != newDocument.ptr())
 850         oldDocument-&gt;setFocusedElement(nullptr);
 851 
 852     if (!newFocusedFrame.page()) {
 853         setFocusedFrame(nullptr);
 854         return false;
 855     }
 856     setFocusedFrame(&amp;newFocusedFrame);
 857 
 858     Ref&lt;Element&gt; protect(*element);
 859 
 860     bool successfullyFocused = newDocument-&gt;setFocusedElement(element, direction);
 861     if (!successfullyFocused)
 862         return false;
 863 
 864     if (newDocument-&gt;focusedElement() == element)
<span class="line-modified"> 865         m_page.editorClient().setInputMethodState(element-&gt;shouldUseInputMethod());</span>
 866 
 867     m_focusSetTime = MonotonicTime::now();
 868     m_focusRepaintTimer.stop();
 869 
 870     return true;
 871 }
 872 
 873 void FocusController::setActivityState(OptionSet&lt;ActivityState::Flag&gt; activityState)
 874 {
 875     auto changed = m_activityState ^ activityState;
 876     m_activityState = activityState;
 877 
 878     if (changed &amp; ActivityState::IsFocused)
 879         setFocusedInternal(activityState.contains(ActivityState::IsFocused));
 880     if (changed &amp; ActivityState::WindowIsActive) {
 881         setActiveInternal(activityState.contains(ActivityState::WindowIsActive));
 882         if (changed &amp; ActivityState::IsVisible)
 883             setIsVisibleAndActiveInternal(activityState.contains(ActivityState::WindowIsActive));
 884     }
 885 }
</pre>
</td>
<td>
<hr />
<pre>
 818     Ref&lt;Frame&gt; protectedNewFocusedFrame = newFocusedFrame;
 819     RefPtr&lt;Frame&gt; oldFocusedFrame = focusedFrame();
 820     RefPtr&lt;Document&gt; oldDocument = oldFocusedFrame ? oldFocusedFrame-&gt;document() : nullptr;
 821 
 822     Element* oldFocusedElement = oldDocument ? oldDocument-&gt;focusedElement() : nullptr;
 823     if (oldFocusedElement == element)
 824         return true;
 825 
 826     // FIXME: Might want to disable this check for caretBrowsing
 827     if (oldFocusedElement &amp;&amp; oldFocusedElement-&gt;isRootEditableElement() &amp;&amp; !relinquishesEditingFocus(oldFocusedElement))
 828         return false;
 829 
 830     m_page.editorClient().willSetInputMethodState();
 831 
 832     if (shouldClearSelectionWhenChangingFocusedElement(m_page, oldFocusedElement, element))
 833         clearSelectionIfNeeded(oldFocusedFrame.get(), &amp;newFocusedFrame, element);
 834 
 835     if (!element) {
 836         if (oldDocument)
 837             oldDocument-&gt;setFocusedElement(nullptr);
<span class="line-modified"> 838         m_page.editorClient().setInputMethodState(nullptr);</span>
 839         return true;
 840     }
 841 
 842     Ref&lt;Document&gt; newDocument(element-&gt;document());
 843 
 844     if (newDocument-&gt;focusedElement() == element) {
<span class="line-modified"> 845         m_page.editorClient().setInputMethodState(element);</span>
 846         return true;
 847     }
 848 
 849     if (oldDocument &amp;&amp; oldDocument != newDocument.ptr())
 850         oldDocument-&gt;setFocusedElement(nullptr);
 851 
 852     if (!newFocusedFrame.page()) {
 853         setFocusedFrame(nullptr);
 854         return false;
 855     }
 856     setFocusedFrame(&amp;newFocusedFrame);
 857 
 858     Ref&lt;Element&gt; protect(*element);
 859 
 860     bool successfullyFocused = newDocument-&gt;setFocusedElement(element, direction);
 861     if (!successfullyFocused)
 862         return false;
 863 
 864     if (newDocument-&gt;focusedElement() == element)
<span class="line-modified"> 865         m_page.editorClient().setInputMethodState(element);</span>
 866 
 867     m_focusSetTime = MonotonicTime::now();
 868     m_focusRepaintTimer.stop();
 869 
 870     return true;
 871 }
 872 
 873 void FocusController::setActivityState(OptionSet&lt;ActivityState::Flag&gt; activityState)
 874 {
 875     auto changed = m_activityState ^ activityState;
 876     m_activityState = activityState;
 877 
 878     if (changed &amp; ActivityState::IsFocused)
 879         setFocusedInternal(activityState.contains(ActivityState::IsFocused));
 880     if (changed &amp; ActivityState::WindowIsActive) {
 881         setActiveInternal(activityState.contains(ActivityState::WindowIsActive));
 882         if (changed &amp; ActivityState::IsVisible)
 883             setIsVisibleAndActiveInternal(activityState.contains(ActivityState::WindowIsActive));
 884     }
 885 }
</pre>
</td>
</tr>
</table>
<center><a href="EventSource.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Frame.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>