<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/PODInterval.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MIMETypeRegistry.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PODIntervalTree.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/PODInterval.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,8 @@</span>
  /*
   * Copyright (C) 2010 Google Inc. All rights reserved.
<span class="udiff-line-added">+  * Copyright (C) 2020 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,141 +22,142 @@</span>
   * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
   * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   */
  
<span class="udiff-line-modified-removed">- #ifndef PODInterval_h</span>
<span class="udiff-line-removed">- #define PODInterval_h</span>
<span class="udiff-line-modified-added">+ #pragma once</span>
  
  #ifndef NDEBUG
<span class="udiff-line-modified-removed">- #include &lt;wtf/text/StringBuilder.h&gt;</span>
<span class="udiff-line-removed">- #include &lt;wtf/text/ValueToString.h&gt;</span>
<span class="udiff-line-modified-added">+ #include &lt;wtf/text/TextStream.h&gt;</span>
  #endif
  
  namespace WebCore {
  
<span class="udiff-line-modified-removed">- // Class representing a closed interval which can hold an arbitrary</span>
<span class="udiff-line-modified-removed">- // Plain Old Datatype (POD) as its endpoints and a piece of user</span>
<span class="udiff-line-modified-removed">- // data. An important characteristic for the algorithms we use is that</span>
<span class="udiff-line-removed">- // if two intervals have identical endpoints but different user data,</span>
<span class="udiff-line-removed">- // they are not considered to be equal. This situation can arise when</span>
<span class="udiff-line-removed">- // representing the vertical extents of bounding boxes of overlapping</span>
<span class="udiff-line-removed">- // triangles, where the pointer to the triangle is the user data of</span>
<span class="udiff-line-removed">- // the interval.</span>
<span class="udiff-line-modified-added">+ // Class template representing a closed interval which can hold arbitrary</span>
<span class="udiff-line-modified-added">+ // endpoints and a piece of user data. Ordering and equality are defined</span>
<span class="udiff-line-modified-added">+ // including the UserData, except in the special case of WeakPtr.</span>
  //
<span class="udiff-line-modified-removed">- // *Note* that the destructors of type T and UserData will *not* be</span>
<span class="udiff-line-modified-removed">- // called by this class. They must not allocate any memory that is</span>
<span class="udiff-line-modified-removed">- // required to be cleaned up in their destructors.</span>
<span class="udiff-line-removed">- //</span>
<span class="udiff-line-removed">- // The following constructors and operators must be implemented on</span>
<span class="udiff-line-removed">- // type T:</span>
<span class="udiff-line-removed">- //</span>
<span class="udiff-line-removed">- //   - Copy constructor (if user data is desired)</span>
<span class="udiff-line-removed">- //   - operator&lt;</span>
<span class="udiff-line-removed">- //   - operator==</span>
<span class="udiff-line-removed">- //   - operator=</span>
<span class="udiff-line-removed">- //</span>
<span class="udiff-line-removed">- // If the UserData type is specified, it must support a copy</span>
<span class="udiff-line-removed">- // constructor and assignment operator.</span>
<span class="udiff-line-modified-added">+ // Both the T and UserData types must support a copy constructor, operator&lt;,</span>
<span class="udiff-line-modified-added">+ // operator==, and operator=, except that this does not depend on operator&lt;</span>
<span class="udiff-line-modified-added">+ // or operator== for WeakPtr.</span>
  //
  // In debug mode, printing of intervals and the data they contain is
<span class="udiff-line-modified-removed">- // enabled. This requires the following template specializations to be</span>
<span class="udiff-line-removed">- // available:</span>
<span class="udiff-line-removed">- //</span>
<span class="udiff-line-removed">- //   template&lt;&gt; struct WebCore::ValueToString&lt;T&gt; {</span>
<span class="udiff-line-removed">- //       static String string(const T&amp; t);</span>
<span class="udiff-line-removed">- //   };</span>
<span class="udiff-line-removed">- //   template&lt;&gt; struct WebCore::ValueToString&lt;UserData&gt; {</span>
<span class="udiff-line-removed">- //       static String string(const UserData&amp; t);</span>
<span class="udiff-line-removed">- //   };</span>
<span class="udiff-line-modified-added">+ // enabled. This uses WTF::TextStream.</span>
  //
<span class="udiff-line-modified-removed">- // Note that this class requires a copy constructor and assignment</span>
<span class="udiff-line-modified-removed">- // operator in order to be stored in the red-black tree.</span>
<span class="udiff-line-modified-added">+ // Note that this class supplies a copy constructor and assignment</span>
<span class="udiff-line-modified-added">+ // operator in order so it can be stored in the red-black tree.</span>
  
<span class="udiff-line-modified-removed">- template&lt;class T, class UserData = void*&gt;</span>
<span class="udiff-line-modified-removed">- class PODInterval {</span>
<span class="udiff-line-modified-added">+ // FIXME: The prefix &quot;POD&quot; here isn&#39;t correct; this works with non-POD types.</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+ template&lt;class T, class UserData&gt; class PODIntervalBase {</span>
  public:
<span class="udiff-line-modified-removed">-     // Constructor from endpoints. This constructor only works when the</span>
<span class="udiff-line-modified-removed">-     // UserData type is a pointer or other type which can be initialized</span>
<span class="udiff-line-modified-removed">-     // with 0.</span>
<span class="udiff-line-modified-removed">-     PODInterval(const T&amp; low, const T&amp; high)</span>
<span class="udiff-line-modified-added">+     const T&amp; low() const { return m_low; }</span>
<span class="udiff-line-modified-added">+     const T&amp; high() const { return m_high; }</span>
<span class="udiff-line-modified-added">+     const UserData&amp; data() const { return m_data; }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     bool overlaps(const T&amp; low, const T&amp; high) const</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         return !(m_high &lt; low || high &lt; m_low);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     bool overlaps(const PODIntervalBase&amp; other) const</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         return overlaps(other.m_low, other.m_high);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     const T&amp; maxHigh() const { return m_maxHigh; }</span>
<span class="udiff-line-added">+     void setMaxHigh(const T&amp; maxHigh) { m_maxHigh = maxHigh; }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ protected:</span>
<span class="udiff-line-added">+     PODIntervalBase(const T&amp; low, const T&amp; high, UserData&amp;&amp; data)</span>
          : m_low(low)
          , m_high(high)
<span class="udiff-line-modified-removed">-         , m_data(0)</span>
<span class="udiff-line-modified-added">+         , m_data(WTFMove(data))</span>
          , m_maxHigh(high)
      {
      }
  
<span class="udiff-line-modified-removed">-     // Constructor from two endpoints plus explicit user data.</span>
<span class="udiff-line-modified-removed">-     PODInterval(const T&amp; low, const T&amp; high, const UserData data)</span>
<span class="udiff-line-modified-added">+ #if COMPILER(MSVC)</span>
<span class="udiff-line-modified-added">+     // Work around an MSVC bug.</span>
<span class="udiff-line-added">+     PODIntervalBase(const T&amp; low, const T&amp; high, const UserData&amp; data)</span>
          : m_low(low)
          , m_high(high)
          , m_data(data)
          , m_maxHigh(high)
      {
      }
<span class="udiff-line-added">+ #endif</span>
  
<span class="udiff-line-modified-removed">-     const T&amp; low() const { return m_low; }</span>
<span class="udiff-line-modified-removed">-     const T&amp; high() const { return m_high; }</span>
<span class="udiff-line-modified-removed">-     const UserData&amp; data() const { return m_data; }</span>
<span class="udiff-line-modified-added">+ private:</span>
<span class="udiff-line-modified-added">+     T m_low;</span>
<span class="udiff-line-modified-added">+     T m_high;</span>
<span class="udiff-line-added">+     UserData m_data { };</span>
<span class="udiff-line-added">+     T m_maxHigh;</span>
<span class="udiff-line-added">+ };</span>
  
<span class="udiff-line-modified-removed">-     bool overlaps(const T&amp; low, const T&amp; high) const</span>
<span class="udiff-line-modified-added">+ template&lt;class T, class UserData&gt; class PODInterval : public PODIntervalBase&lt;T, UserData&gt; {</span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+     PODInterval(const T&amp; low, const T&amp; high, UserData&amp;&amp; data = { })</span>
<span class="udiff-line-added">+         : PODIntervalBase&lt;T, UserData&gt;(low, high, WTFMove(data))</span>
      {
<span class="udiff-line-removed">-         if (this-&gt;high() &lt; low)</span>
<span class="udiff-line-removed">-             return false;</span>
<span class="udiff-line-removed">-         if (high &lt; this-&gt;low())</span>
<span class="udiff-line-removed">-             return false;</span>
<span class="udiff-line-removed">-         return true;</span>
      }
  
<span class="udiff-line-modified-removed">-     bool overlaps(const PODInterval&amp; other) const</span>
<span class="udiff-line-modified-added">+     PODInterval(const T&amp; low, const T&amp; high, const UserData&amp; data)</span>
<span class="udiff-line-added">+         : PODIntervalBase&lt;T, UserData&gt;(low, high, UserData { data })</span>
      {
<span class="udiff-line-removed">-         return overlaps(other.low(), other.high());</span>
      }
  
<span class="udiff-line-removed">-     // Returns true if this interval is &quot;less&quot; than the other. The</span>
<span class="udiff-line-removed">-     // comparison is performed on the low endpoints of the intervals.</span>
      bool operator&lt;(const PODInterval&amp; other) const
      {
<span class="udiff-line-modified-removed">-         return low() &lt; other.low();</span>
<span class="udiff-line-modified-added">+         if (Base::low() &lt; other.Base::low())</span>
<span class="udiff-line-added">+             return true;</span>
<span class="udiff-line-added">+         if (other.Base::low() &lt; Base::low())</span>
<span class="udiff-line-added">+             return false;</span>
<span class="udiff-line-added">+         if (Base::high() &lt; other.Base::high())</span>
<span class="udiff-line-added">+             return true;</span>
<span class="udiff-line-added">+         if (other.Base::high() &lt; Base::high())</span>
<span class="udiff-line-added">+             return false;</span>
<span class="udiff-line-added">+         return Base::data() &lt; other.Base::data();</span>
      }
  
<span class="udiff-line-removed">-     // Returns true if this interval is strictly equal to the other,</span>
<span class="udiff-line-removed">-     // including comparison of the user data.</span>
      bool operator==(const PODInterval&amp; other) const
      {
<span class="udiff-line-modified-removed">-         return (low() == other.low()</span>
<span class="udiff-line-modified-removed">-                 &amp;&amp; high() == other.high()</span>
<span class="udiff-line-modified-removed">-                 &amp;&amp; data() == other.data());</span>
<span class="udiff-line-modified-added">+         return Base::low() == other.Base::low()</span>
<span class="udiff-line-modified-added">+             &amp;&amp; Base::high() == other.Base::high()</span>
<span class="udiff-line-modified-added">+             &amp;&amp; Base::data() == other.Base::data();</span>
      }
  
<span class="udiff-line-modified-removed">-     const T&amp; maxHigh() const { return m_maxHigh; }</span>
<span class="udiff-line-modified-removed">-     void setMaxHigh(const T&amp; maxHigh) { m_maxHigh = maxHigh; }</span>
<span class="udiff-line-modified-added">+ private:</span>
<span class="udiff-line-modified-added">+     using Base = PODIntervalBase&lt;T, UserData&gt;;</span>
<span class="udiff-line-added">+ };</span>
  
<span class="udiff-line-modified-removed">- #ifndef NDEBUG</span>
<span class="udiff-line-modified-removed">-     // Support for printing PODIntervals.</span>
<span class="udiff-line-modified-removed">-     String toString() const</span>
<span class="udiff-line-modified-added">+ template&lt;class T, class U&gt; class PODInterval&lt;T, WTF::WeakPtr&lt;U&gt;&gt; : public PODIntervalBase&lt;T, WTF::WeakPtr&lt;U&gt;&gt; {</span>
<span class="udiff-line-modified-added">+ public:</span>
<span class="udiff-line-modified-added">+     PODInterval(const T&amp; low, const T&amp; high, WTF::WeakPtr&lt;U&gt;&amp;&amp; data)</span>
<span class="udiff-line-added">+         : PODIntervalBase&lt;T, WTF::WeakPtr&lt;U&gt;&gt;(low, high, WTFMove(data))</span>
      {
<span class="udiff-line-removed">-         StringBuilder builder;</span>
<span class="udiff-line-removed">-         builder.appendLiteral(&quot;[PODInterval (&quot;);</span>
<span class="udiff-line-removed">-         builder.append(ValueToString&lt;T&gt;::string(low()));</span>
<span class="udiff-line-removed">-         builder.appendLiteral(&quot;, &quot;);</span>
<span class="udiff-line-removed">-         builder.append(ValueToString&lt;T&gt;::string(high()));</span>
<span class="udiff-line-removed">-         builder.appendLiteral(&quot;), data=&quot;);</span>
<span class="udiff-line-removed">-         builder.append(ValueToString&lt;UserData&gt;::string(data()));</span>
<span class="udiff-line-removed">-         builder.appendLiteral(&quot;, maxHigh=&quot;);</span>
<span class="udiff-line-removed">-         builder.append(ValueToString&lt;T&gt;::string(maxHigh()));</span>
<span class="udiff-line-removed">-         builder.append(&#39;]&#39;);</span>
<span class="udiff-line-removed">-         return builder.toString();</span>
      }
<span class="udiff-line-modified-removed">- #endif</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     bool operator&lt;(const PODInterval&amp; other) const</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         if (Base::low() &lt; other.Base::low())</span>
<span class="udiff-line-added">+             return true;</span>
<span class="udiff-line-added">+         if (other.Base::low() &lt; Base::low())</span>
<span class="udiff-line-added">+             return false;</span>
<span class="udiff-line-added">+         return Base::high() &lt; other.Base::high();</span>
<span class="udiff-line-added">+     }</span>
  
  private:
<span class="udiff-line-modified-removed">-     T m_low;</span>
<span class="udiff-line-removed">-     T m_high;</span>
<span class="udiff-line-removed">-     UserData m_data;</span>
<span class="udiff-line-removed">-     T m_maxHigh;</span>
<span class="udiff-line-modified-added">+     using Base = PODIntervalBase&lt;T, WTF::WeakPtr&lt;U&gt;&gt;;</span>
  };
  
<span class="udiff-line-modified-removed">- } // namespace WebCore</span>
<span class="udiff-line-modified-added">+ #ifndef NDEBUG</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ template&lt;class T, class UserData&gt;</span>
<span class="udiff-line-added">+ TextStream&amp; operator&lt;&lt;(TextStream&amp; stream, const PODInterval&lt;T, UserData&gt;&amp; interval)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     return stream &lt;&lt; &quot;[PODInterval (&quot; &lt;&lt; interval.low() &lt;&lt; &quot;, &quot; &lt;&lt; interval.high() &lt;&lt; &quot;), data=&quot; &lt;&lt; *interval.data() &lt;&lt; &quot;, maxHigh=&quot; &lt;&lt; interval.maxHigh() &lt;&lt; &#39;]&#39;;</span>
<span class="udiff-line-added">+ }</span>
  
<span class="udiff-line-modified-removed">- #endif // PODInterval_h</span>
<span class="udiff-line-modified-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ } // namespace WebCore</span>
</pre>
<center><a href="MIMETypeRegistry.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PODIntervalTree.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>