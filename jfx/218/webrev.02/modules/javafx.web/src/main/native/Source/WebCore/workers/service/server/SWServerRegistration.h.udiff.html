<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/workers/service/server/SWServerRegistration.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SWServerRegistration.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SWServerToContextConnection.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/workers/service/server/SWServerRegistration.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -29,13 +29,15 @@</span>
  
  #include &quot;SWServer.h&quot;
  #include &quot;ServiceWorkerClientIdentifier.h&quot;
  #include &quot;ServiceWorkerRegistrationData.h&quot;
  #include &quot;ServiceWorkerTypes.h&quot;
<span class="udiff-line-added">+ #include &quot;Timer.h&quot;</span>
  #include &lt;wtf/HashCountedSet.h&gt;
  #include &lt;wtf/MonotonicTime.h&gt;
  #include &lt;wtf/WallTime.h&gt;
<span class="udiff-line-added">+ #include &lt;wtf/WeakPtr.h&gt;</span>
  
  namespace WebCore {
  
  class SWServer;
  class SWServerWorker;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -43,11 +45,11 @@</span>
  enum class ServiceWorkerState : uint8_t;
  struct ExceptionData;
  struct ServiceWorkerContextData;
  struct ServiceWorkerFetchResult;
  
<span class="udiff-line-modified-removed">- class SWServerRegistration {</span>
<span class="udiff-line-modified-added">+ class SWServerRegistration : public CanMakeWeakPtr&lt;SWServerRegistration&gt; {</span>
      WTF_MAKE_FAST_ALLOCATED;
  public:
      SWServerRegistration(SWServer&amp;, const ServiceWorkerRegistrationKey&amp;, ServiceWorkerUpdateViaCache, const URL&amp; scopeURL, const URL&amp; scriptURL);
      ~SWServerRegistration();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -55,15 +57,13 @@</span>
      ServiceWorkerRegistrationIdentifier identifier() const { return m_identifier; }
  
      SWServerWorker* getNewestWorker();
      WEBCORE_EXPORT ServiceWorkerRegistrationData data() const;
  
<span class="udiff-line-removed">-     bool isUninstalling() const { return m_uninstalling; }</span>
<span class="udiff-line-removed">-     void setIsUninstalling(bool);</span>
<span class="udiff-line-removed">- </span>
      void setLastUpdateTime(WallTime);
      WallTime lastUpdateTime() const { return m_lastUpdateTime; }
<span class="udiff-line-added">+     bool isStale() const { return m_lastUpdateTime &amp;&amp; (WallTime::now() - m_lastUpdateTime) &gt; 86400_s; }</span>
  
      void setUpdateViaCache(ServiceWorkerUpdateViaCache);
      ServiceWorkerUpdateViaCache updateViaCache() const { return m_updateViaCache; }
  
      void updateRegistrationState(ServiceWorkerRegistrationState, SWServerWorker*);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -92,23 +92,32 @@</span>
      void clear();
      bool tryClear();
      void tryActivate();
      void didFinishActivation(ServiceWorkerIdentifier);
  
<span class="udiff-line-added">+     bool isUnregistered() const;</span>
<span class="udiff-line-added">+ </span>
      void forEachConnection(const WTF::Function&lt;void(SWServer::Connection&amp;)&gt;&amp;);
  
<span class="udiff-line-added">+     WEBCORE_EXPORT bool shouldSoftUpdate(const FetchOptions&amp;) const;</span>
<span class="udiff-line-added">+     WEBCORE_EXPORT void scheduleSoftUpdate();</span>
<span class="udiff-line-added">+     static constexpr Seconds softUpdateDelay { 1_s };</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     URL scopeURLWithoutFragment() const { return m_scopeURL; }</span>
<span class="udiff-line-added">+     URL scriptURL() const { return m_scriptURL; }</span>
<span class="udiff-line-added">+ </span>
  private:
      void activate();
      void handleClientUnload();
<span class="udiff-line-added">+     void softUpdate();</span>
  
      ServiceWorkerRegistrationIdentifier m_identifier;
      ServiceWorkerRegistrationKey m_registrationKey;
      ServiceWorkerUpdateViaCache m_updateViaCache;
      URL m_scopeURL;
      URL m_scriptURL;
  
<span class="udiff-line-removed">-     bool m_uninstalling { false };</span>
      RefPtr&lt;SWServerWorker&gt; m_preInstallationWorker; // Implementation detail, not part of the specification.
      RefPtr&lt;SWServerWorker&gt; m_installingWorker;
      RefPtr&lt;SWServerWorker&gt; m_waitingWorker;
      RefPtr&lt;SWServerWorker&gt; m_activeWorker;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -117,10 +126,12 @@</span>
      HashCountedSet&lt;SWServerConnectionIdentifier&gt; m_connectionsWithClientRegistrations;
      SWServer&amp; m_server;
  
      MonotonicTime m_creationTime;
      HashMap&lt;SWServerConnectionIdentifier, HashSet&lt;DocumentIdentifier&gt;&gt; m_clientsUsingRegistration;
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     WebCore::Timer m_softUpdateTimer;</span>
  };
  
  } // namespace WebCore
  
  #endif // ENABLE(SERVICE_WORKER)
</pre>
<center><a href="SWServerRegistration.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SWServerToContextConnection.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>