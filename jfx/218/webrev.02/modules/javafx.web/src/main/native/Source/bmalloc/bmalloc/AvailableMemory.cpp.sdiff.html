<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/bmalloc/bmalloc/AvailableMemory.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Allocator.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="BPlatform.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/bmalloc/bmalloc/AvailableMemory.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 36 #include &lt;mutex&gt;
 37 #if BOS(DARWIN)
 38 #if BPLATFORM(IOS_FAMILY)
 39 #import &lt;algorithm&gt;
 40 #endif
 41 #import &lt;dispatch/dispatch.h&gt;
 42 #import &lt;mach/host_info.h&gt;
 43 #import &lt;mach/mach.h&gt;
 44 #import &lt;mach/mach_error.h&gt;
 45 #import &lt;math.h&gt;
 46 #elif BOS(UNIX)
 47 #if BOS(LINUX)
 48 #include &lt;algorithm&gt;
 49 #include &lt;fcntl.h&gt;
 50 #endif
 51 #include &lt;unistd.h&gt;
 52 #endif
 53 
 54 namespace bmalloc {
 55 
<span class="line-modified"> 56 static const size_t availableMemoryGuess = 512 * bmalloc::MB;</span>
 57 
 58 #if BOS(DARWIN)
 59 static size_t memorySizeAccordingToKernel()
 60 {
 61 #if BPLATFORM(IOS_FAMILY_SIMULATOR)
 62     BUNUSED_PARAM(availableMemoryGuess);
 63     // Pretend we have 1024MB of memory to make cache sizes behave like on device.
 64     return 1024 * bmalloc::MB;
 65 #else
 66     host_basic_info_data_t hostInfo;
 67 
 68     mach_port_t host = mach_host_self();
 69     mach_msg_type_number_t count = HOST_BASIC_INFO_COUNT;
 70     kern_return_t r = host_info(host, HOST_BASIC_INFO, (host_info_t)&amp;hostInfo, &amp;count);
 71     mach_port_deallocate(mach_task_self(), host);
 72     if (r != KERN_SUCCESS)
 73         return availableMemoryGuess;
 74 
 75     if (hostInfo.max_mem &gt; std::numeric_limits&lt;size_t&gt;::max())
 76         return std::numeric_limits&lt;size_t&gt;::max();
</pre>
</td>
<td>
<hr />
<pre>
 36 #include &lt;mutex&gt;
 37 #if BOS(DARWIN)
 38 #if BPLATFORM(IOS_FAMILY)
 39 #import &lt;algorithm&gt;
 40 #endif
 41 #import &lt;dispatch/dispatch.h&gt;
 42 #import &lt;mach/host_info.h&gt;
 43 #import &lt;mach/mach.h&gt;
 44 #import &lt;mach/mach_error.h&gt;
 45 #import &lt;math.h&gt;
 46 #elif BOS(UNIX)
 47 #if BOS(LINUX)
 48 #include &lt;algorithm&gt;
 49 #include &lt;fcntl.h&gt;
 50 #endif
 51 #include &lt;unistd.h&gt;
 52 #endif
 53 
 54 namespace bmalloc {
 55 
<span class="line-modified"> 56 static constexpr size_t availableMemoryGuess = 512 * bmalloc::MB;</span>
 57 
 58 #if BOS(DARWIN)
 59 static size_t memorySizeAccordingToKernel()
 60 {
 61 #if BPLATFORM(IOS_FAMILY_SIMULATOR)
 62     BUNUSED_PARAM(availableMemoryGuess);
 63     // Pretend we have 1024MB of memory to make cache sizes behave like on device.
 64     return 1024 * bmalloc::MB;
 65 #else
 66     host_basic_info_data_t hostInfo;
 67 
 68     mach_port_t host = mach_host_self();
 69     mach_msg_type_number_t count = HOST_BASIC_INFO_COUNT;
 70     kern_return_t r = host_info(host, HOST_BASIC_INFO, (host_info_t)&amp;hostInfo, &amp;count);
 71     mach_port_deallocate(mach_task_self(), host);
 72     if (r != KERN_SUCCESS)
 73         return availableMemoryGuess;
 74 
 75     if (hostInfo.max_mem &gt; std::numeric_limits&lt;size_t&gt;::max())
 76         return std::numeric_limits&lt;size_t&gt;::max();
</pre>
</td>
</tr>
</table>
<center><a href="Allocator.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="BPlatform.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>