<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/audio/PlatformMediaSessionManager.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PlatformMediaSession.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="PlatformMediaSessionManager.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/audio/PlatformMediaSessionManager.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -164,14 +164,11 @@</span>
  
      if (m_sessions.isEmpty() || std::all_of(m_sessions.begin(), m_sessions.end(), std::logical_not&lt;void&gt;())) {
          m_remoteCommandListener = nullptr;
          m_audioHardwareListener = nullptr;
  #if USE(AUDIO_SESSION)
<span class="udiff-line-modified-removed">-         if (m_becameActive &amp;&amp; shouldDeactivateAudioSession()) {</span>
<span class="udiff-line-removed">-             AudioSession::sharedSession().tryToSetActive(false);</span>
<span class="udiff-line-removed">-             m_becameActive = false;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         maybeDeactivateAudioSession();</span>
  #endif
      }
  
  #if !RELEASE_LOG_DISABLED
      m_logger-&gt;removeLogger(session.logger());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -236,11 +233,11 @@</span>
      }
      ALWAYS_LOG(LOGIDENTIFIER, session.logIdentifier(), &quot; returning true&quot;);
      return true;
  }
  
<span class="udiff-line-modified-removed">- void PlatformMediaSessionManager::sessionWillEndPlayback(PlatformMediaSession&amp; session)</span>
<span class="udiff-line-modified-added">+ void PlatformMediaSessionManager::sessionWillEndPlayback(PlatformMediaSession&amp; session, DelayCallingUpdateNowPlaying)</span>
  {
      ALWAYS_LOG(LOGIDENTIFIER, session.logIdentifier());
  
      if (m_sessions.size() &lt; 2)
          return;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -361,20 +358,18 @@</span>
  {
      if (m_processIsSuspended)
          return;
      m_processIsSuspended = true;
  
<span class="udiff-line-added">+     ALWAYS_LOG(LOGIDENTIFIER);</span>
<span class="udiff-line-added">+ </span>
      forEachSession([&amp;] (auto&amp; session) {
          session.client().processIsSuspendedChanged();
      });
  
  #if USE(AUDIO_SESSION)
<span class="udiff-line-modified-removed">-     if (m_becameActive &amp;&amp; shouldDeactivateAudioSession()) {</span>
<span class="udiff-line-removed">-         AudioSession::sharedSession().tryToSetActive(false);</span>
<span class="udiff-line-removed">-         ALWAYS_LOG(LOGIDENTIFIER, &quot;tried to set inactive AudioSession&quot;);</span>
<span class="udiff-line-removed">-         m_becameActive = false;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     maybeDeactivateAudioSession();</span>
  #endif
  }
  
  void PlatformMediaSessionManager::processDidResume()
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -410,11 +405,11 @@</span>
  
      if (session.state() != PlatformMediaSession::Interrupted)
          session.beginInterruption(PlatformMediaSession::EnteringBackground);
  }
  
<span class="udiff-line-modified-removed">- void PlatformMediaSessionManager::sessionCanProduceAudioChanged(PlatformMediaSession&amp;)</span>
<span class="udiff-line-modified-added">+ void PlatformMediaSessionManager::sessionCanProduceAudioChanged()</span>
  {
      updateSessionState();
  }
  
  void PlatformMediaSessionManager::didReceiveRemoteControlCommand(PlatformMediaSession::RemoteControlCommandType command, const PlatformMediaSession::RemoteCommandArgument* argument)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -543,10 +538,22 @@</span>
      return WTF::anyOf(m_sessions, [&amp;predicate](const auto&amp; session) {
          return predicate(*session);
      });
  }
  
<span class="udiff-line-added">+ #if USE(AUDIO_SESSION)</span>
<span class="udiff-line-added">+ void PlatformMediaSessionManager::maybeDeactivateAudioSession()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (!m_becameActive || !shouldDeactivateAudioSession())</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ALWAYS_LOG(LOGIDENTIFIER, &quot;tried to set inactive AudioSession&quot;);</span>
<span class="udiff-line-added">+     AudioSession::sharedSession().tryToSetActive(false);</span>
<span class="udiff-line-added">+     m_becameActive = false;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
  static bool&amp; deactivateAudioSession()
  {
      static bool deactivate;
      return deactivate;
  }
</pre>
<center><a href="PlatformMediaSession.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="PlatformMediaSessionManager.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>