<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WTF/wtf/RunLoop.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="RetainPtr.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SHA1.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WTF/wtf/RunLoop.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2010 Apple Inc. All rights reserved.</span>
  3  * Copyright (C) 2010 Nokia Corporation and/or its subsidiary(-ies)
  4  * Portions Copyright (c) 2010 Motorola Mobility, Inc.  All rights reserved.
  5  *
  6  * Redistribution and use in source and binary forms, with or without
  7  * modification, are permitted provided that the following conditions
  8  * are met:
  9  * 1. Redistributions of source code must retain the above copyright
 10  *    notice, this list of conditions and the following disclaimer.
 11  * 2. Redistributions in binary form must reproduce the above copyright
 12  *    notice, this list of conditions and the following disclaimer in the
 13  *    documentation and/or other materials provided with the distribution.
 14  *
 15  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 16  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 17  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 18  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 19  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 20  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 21  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 22  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 23  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 24  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 25  * THE POSSIBILITY OF SUCH DAMAGE.
 26  */
 27 
 28 #pragma once
 29 
 30 #include &lt;wtf/Condition.h&gt;
 31 #include &lt;wtf/Deque.h&gt;
 32 #include &lt;wtf/Forward.h&gt;
 33 #include &lt;wtf/FunctionDispatcher.h&gt;
 34 #include &lt;wtf/HashMap.h&gt;
 35 #include &lt;wtf/RetainPtr.h&gt;
 36 #include &lt;wtf/Seconds.h&gt;
 37 #include &lt;wtf/ThreadingPrimitives.h&gt;





 38 
 39 #if USE(GLIB_EVENT_LOOP)
 40 #include &lt;wtf/glib/GRefPtr.h&gt;
 41 #endif
 42 
 43 namespace WTF {
 44 








 45 class RunLoop : public FunctionDispatcher {
 46     WTF_MAKE_NONCOPYABLE(RunLoop);
 47 public:
 48     // Must be called from the main thread (except for the Mac platform, where it
 49     // can be called from any thread).
 50     WTF_EXPORT_PRIVATE static void initializeMainRunLoop();
 51 
 52     WTF_EXPORT_PRIVATE static RunLoop&amp; current();
 53     WTF_EXPORT_PRIVATE static RunLoop&amp; main();
 54     WTF_EXPORT_PRIVATE static bool isMain();
 55     ~RunLoop();
 56 
 57     void dispatch(Function&lt;void()&gt;&amp;&amp;) override;
 58 
 59     WTF_EXPORT_PRIVATE static void run();
 60     WTF_EXPORT_PRIVATE void stop();
 61     WTF_EXPORT_PRIVATE void wakeUp();
 62 



 63 #if USE(COCOA_EVENT_LOOP)
 64     WTF_EXPORT_PRIVATE void runForDuration(Seconds duration);
 65 #endif
 66 
 67 #if USE(GLIB_EVENT_LOOP)
 68     WTF_EXPORT_PRIVATE GMainContext* mainContext() const { return m_mainContext.get(); }
 69 #endif
 70 
 71 #if USE(GENERIC_EVENT_LOOP) || USE(WINDOWS_EVENT_LOOP)
 72     // Run the single iteration of the RunLoop. It consumes the pending tasks and expired timers, but it won&#39;t be blocked.
 73     WTF_EXPORT_PRIVATE static void iterate();
 74 #endif
 75 
 76 #if USE(WINDOWS_EVENT_LOOP)
 77     static void registerRunLoopMessageWindowClass();
 78 #endif
 79 
 80 #if USE(GLIB_EVENT_LOOP) || USE(GENERIC_EVENT_LOOP)
 81     WTF_EXPORT_PRIVATE void dispatchAfter(Seconds, Function&lt;void()&gt;&amp;&amp;);
 82 #endif
</pre>
<hr />
<pre>
197         Stopping,
198     };
199     void runImpl(RunMode);
200     bool populateTasks(RunMode, Status&amp;, Deque&lt;RefPtr&lt;TimerBase::ScheduledTask&gt;&gt;&amp;);
201 
202     friend class TimerBase;
203 
204     Lock m_loopLock;
205     Condition m_readyToRun;
206     Condition m_stopCondition;
207     Vector&lt;RefPtr&lt;TimerBase::ScheduledTask&gt;&gt; m_schedules;
208     Vector&lt;Status*&gt; m_mainLoops;
209     bool m_shutdown { false };
210     bool m_pendingTasks { false };
211 #endif
212 };
213 
214 } // namespace WTF
215 
216 using WTF::RunLoop;

</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2010-2019 Apple Inc. All rights reserved.</span>
  3  * Copyright (C) 2010 Nokia Corporation and/or its subsidiary(-ies)
  4  * Portions Copyright (c) 2010 Motorola Mobility, Inc.  All rights reserved.
  5  *
  6  * Redistribution and use in source and binary forms, with or without
  7  * modification, are permitted provided that the following conditions
  8  * are met:
  9  * 1. Redistributions of source code must retain the above copyright
 10  *    notice, this list of conditions and the following disclaimer.
 11  * 2. Redistributions in binary form must reproduce the above copyright
 12  *    notice, this list of conditions and the following disclaimer in the
 13  *    documentation and/or other materials provided with the distribution.
 14  *
 15  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 16  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 17  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 18  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 19  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 20  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 21  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 22  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 23  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 24  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 25  * THE POSSIBILITY OF SUCH DAMAGE.
 26  */
 27 
 28 #pragma once
 29 
 30 #include &lt;wtf/Condition.h&gt;
 31 #include &lt;wtf/Deque.h&gt;
 32 #include &lt;wtf/Forward.h&gt;
 33 #include &lt;wtf/FunctionDispatcher.h&gt;
 34 #include &lt;wtf/HashMap.h&gt;
 35 #include &lt;wtf/RetainPtr.h&gt;
 36 #include &lt;wtf/Seconds.h&gt;
 37 #include &lt;wtf/ThreadingPrimitives.h&gt;
<span class="line-added"> 38 #include &lt;wtf/text/WTFString.h&gt;</span>
<span class="line-added"> 39 </span>
<span class="line-added"> 40 #if USE(CF)</span>
<span class="line-added"> 41 #include &lt;CoreFoundation/CFRunLoop.h&gt;</span>
<span class="line-added"> 42 #endif</span>
 43 
 44 #if USE(GLIB_EVENT_LOOP)
 45 #include &lt;wtf/glib/GRefPtr.h&gt;
 46 #endif
 47 
 48 namespace WTF {
 49 
<span class="line-added"> 50 #if USE(CF)</span>
<span class="line-added"> 51 using RunLoopMode = CFStringRef;</span>
<span class="line-added"> 52 #define DefaultRunLoopMode kCFRunLoopDefaultMode</span>
<span class="line-added"> 53 #else</span>
<span class="line-added"> 54 using RunLoopMode = unsigned;</span>
<span class="line-added"> 55 #define DefaultRunLoopMode 0</span>
<span class="line-added"> 56 #endif</span>
<span class="line-added"> 57 </span>
 58 class RunLoop : public FunctionDispatcher {
 59     WTF_MAKE_NONCOPYABLE(RunLoop);
 60 public:
 61     // Must be called from the main thread (except for the Mac platform, where it
 62     // can be called from any thread).
 63     WTF_EXPORT_PRIVATE static void initializeMainRunLoop();
 64 
 65     WTF_EXPORT_PRIVATE static RunLoop&amp; current();
 66     WTF_EXPORT_PRIVATE static RunLoop&amp; main();
 67     WTF_EXPORT_PRIVATE static bool isMain();
 68     ~RunLoop();
 69 
 70     void dispatch(Function&lt;void()&gt;&amp;&amp;) override;
 71 
 72     WTF_EXPORT_PRIVATE static void run();
 73     WTF_EXPORT_PRIVATE void stop();
 74     WTF_EXPORT_PRIVATE void wakeUp();
 75 
<span class="line-added"> 76     enum class CycleResult { Continue, Stop };</span>
<span class="line-added"> 77     WTF_EXPORT_PRIVATE CycleResult static cycle(RunLoopMode = DefaultRunLoopMode);</span>
<span class="line-added"> 78 </span>
 79 #if USE(COCOA_EVENT_LOOP)
 80     WTF_EXPORT_PRIVATE void runForDuration(Seconds duration);
 81 #endif
 82 
 83 #if USE(GLIB_EVENT_LOOP)
 84     WTF_EXPORT_PRIVATE GMainContext* mainContext() const { return m_mainContext.get(); }
 85 #endif
 86 
 87 #if USE(GENERIC_EVENT_LOOP) || USE(WINDOWS_EVENT_LOOP)
 88     // Run the single iteration of the RunLoop. It consumes the pending tasks and expired timers, but it won&#39;t be blocked.
 89     WTF_EXPORT_PRIVATE static void iterate();
 90 #endif
 91 
 92 #if USE(WINDOWS_EVENT_LOOP)
 93     static void registerRunLoopMessageWindowClass();
 94 #endif
 95 
 96 #if USE(GLIB_EVENT_LOOP) || USE(GENERIC_EVENT_LOOP)
 97     WTF_EXPORT_PRIVATE void dispatchAfter(Seconds, Function&lt;void()&gt;&amp;&amp;);
 98 #endif
</pre>
<hr />
<pre>
213         Stopping,
214     };
215     void runImpl(RunMode);
216     bool populateTasks(RunMode, Status&amp;, Deque&lt;RefPtr&lt;TimerBase::ScheduledTask&gt;&gt;&amp;);
217 
218     friend class TimerBase;
219 
220     Lock m_loopLock;
221     Condition m_readyToRun;
222     Condition m_stopCondition;
223     Vector&lt;RefPtr&lt;TimerBase::ScheduledTask&gt;&gt; m_schedules;
224     Vector&lt;Status*&gt; m_mainLoops;
225     bool m_shutdown { false };
226     bool m_pendingTasks { false };
227 #endif
228 };
229 
230 } // namespace WTF
231 
232 using WTF::RunLoop;
<span class="line-added">233 using WTF::RunLoopMode;</span>
</pre>
</td>
</tr>
</table>
<center><a href="RetainPtr.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SHA1.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>