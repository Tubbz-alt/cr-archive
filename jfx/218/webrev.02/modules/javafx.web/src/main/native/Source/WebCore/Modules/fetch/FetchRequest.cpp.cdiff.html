<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/Modules/fetch/FetchRequest.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FetchLoader.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="FetchRequest.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/fetch/FetchRequest.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 159,11 ***</span>
  
  ExceptionOr&lt;void&gt; FetchRequest::initializeWith(const String&amp; url, Init&amp;&amp; init)
  {
      ASSERT(scriptExecutionContext());
      // FIXME: Tighten the URL parsing algorithm according https://url.spec.whatwg.org/#concept-url-parser.
<span class="line-modified">!     URL requestURL = scriptExecutionContext()-&gt;completeURL(url);</span>
      if (!requestURL.isValid() || !requestURL.user().isEmpty() || !requestURL.pass().isEmpty())
          return Exception { TypeError, &quot;URL is not valid or contains user credentials.&quot;_s };
  
      m_options.mode = Mode::Cors;
      m_options.credentials = Credentials::SameOrigin;
<span class="line-new-header">--- 159,11 ---</span>
  
  ExceptionOr&lt;void&gt; FetchRequest::initializeWith(const String&amp; url, Init&amp;&amp; init)
  {
      ASSERT(scriptExecutionContext());
      // FIXME: Tighten the URL parsing algorithm according https://url.spec.whatwg.org/#concept-url-parser.
<span class="line-modified">!     URL requestURL = scriptExecutionContext()-&gt;completeURL(url, ScriptExecutionContext::ForceUTF8::Yes);</span>
      if (!requestURL.isValid() || !requestURL.user().isEmpty() || !requestURL.pass().isEmpty())
          return Exception { TypeError, &quot;URL is not valid or contains user credentials.&quot;_s };
  
      m_options.mode = Mode::Cors;
      m_options.credentials = Credentials::SameOrigin;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 220,13 ***</span>
          }
  
      } else
          m_signal-&gt;follow(input.m_signal.get());
  
<span class="line-modified">!     auto fillResult = init.headers ? m_headers-&gt;fill(*init.headers) : m_headers-&gt;fill(input.headers());</span>
<span class="line-modified">!     if (fillResult.hasException())</span>
<span class="line-modified">!         return fillResult;</span>
  
      auto setBodyResult = init.body ? setBody(WTFMove(*init.body)) : setBody(input);
      if (setBodyResult.hasException())
          return setBodyResult;
  
<span class="line-new-header">--- 220,16 ---</span>
          }
  
      } else
          m_signal-&gt;follow(input.m_signal.get());
  
<span class="line-modified">!     if (init.hasMembers()) {</span>
<span class="line-modified">!         auto fillResult = init.headers ? m_headers-&gt;fill(*init.headers) : m_headers-&gt;fill(input.headers());</span>
<span class="line-modified">!         if (fillResult.hasException())</span>
<span class="line-added">+             return fillResult;</span>
<span class="line-added">+     } else</span>
<span class="line-added">+         m_headers-&gt;setInternalHeaders(HTTPHeaderMap { input.headers().internalHeaders() });</span>
  
      auto setBodyResult = init.body ? setBody(WTFMove(*init.body)) : setBody(input);
      if (setBodyResult.hasException())
          return setBodyResult;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 306,11 ***</span>
  
      ResourceRequest request = m_request;
      request.setHTTPHeaderFields(m_headers-&gt;internalHeaders());
  
      if (!isBodyNull())
<span class="line-modified">!         request.setHTTPBody(body().bodyAsFormData(*scriptExecutionContext()));</span>
  
      return request;
  }
  
  ExceptionOr&lt;Ref&lt;FetchRequest&gt;&gt; FetchRequest::clone(ScriptExecutionContext&amp; context)
<span class="line-new-header">--- 309,11 ---</span>
  
      ResourceRequest request = m_request;
      request.setHTTPHeaderFields(m_headers-&gt;internalHeaders());
  
      if (!isBodyNull())
<span class="line-modified">!         request.setHTTPBody(body().bodyAsFormData());</span>
  
      return request;
  }
  
  ExceptionOr&lt;Ref&lt;FetchRequest&gt;&gt; FetchRequest::clone(ScriptExecutionContext&amp; context)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 327,13 ***</span>
  const char* FetchRequest::activeDOMObjectName() const
  {
      return &quot;Request&quot;;
  }
  
<span class="line-removed">- bool FetchRequest::canSuspendForDocumentSuspension() const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     // FIXME: We can probably do the same strategy as XHR.</span>
<span class="line-removed">-     return !isActive();</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  } // namespace WebCore
  
<span class="line-new-header">--- 330,7 ---</span>
</pre>
<center><a href="FetchLoader.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="FetchRequest.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>