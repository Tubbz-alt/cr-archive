<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/rendering/TextPainter.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TableLayout.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="line/BreakingContext.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/rendering/TextPainter.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  7  * modify it under the terms of the GNU Library General Public
  8  * License as published by the Free Software Foundation; either
  9  * version 2 of the License, or (at your option) any later version.
 10  *
 11  * This library is distributed in the hope that it will be useful,
 12  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 13  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 14  * Library General Public License for more details.
 15  *
 16  * You should have received a copy of the GNU Library General Public License
 17  * along with this library; see the file COPYING.LIB.  If not, write to
 18  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 19  * Boston, MA 02110-1301, USA.
 20  *
 21  */
 22 
 23 #include &quot;config.h&quot;
 24 #include &quot;TextPainter.h&quot;
 25 
 26 #include &quot;DisplayListReplayer.h&quot;

 27 #include &quot;FilterOperations.h&quot;
 28 #include &quot;GraphicsContext.h&quot;
 29 #include &quot;InlineTextBox.h&quot;
 30 #include &quot;RenderCombineText.h&quot;
 31 #include &quot;RenderLayer.h&quot;

 32 #include &quot;ShadowData.h&quot;
 33 #include &lt;wtf/NeverDestroyed.h&gt;
 34 
 35 namespace WebCore {
 36 
 37 ShadowApplier::ShadowApplier(GraphicsContext&amp; context, const ShadowData* shadow, const FilterOperations* colorFilter, const FloatRect&amp; textRect, bool lastShadowIterationShouldDrawText, bool opaque, FontOrientation orientation)
 38     : m_context { context }
 39     , m_shadow { shadow }
 40     , m_onlyDrawsShadow { !isLastShadowIteration() || !lastShadowIterationShouldDrawText }
 41     , m_avoidDrawingShadow { shadowIsCompletelyCoveredByText(opaque) }
 42     , m_nothingToDraw { shadow &amp;&amp; m_avoidDrawingShadow &amp;&amp; m_onlyDrawsShadow }
 43     , m_didSaveContext { false }
 44 {
 45     if (!shadow || m_nothingToDraw) {
 46         m_shadow = nullptr;
 47         return;
 48     }
 49 
 50     int shadowX = orientation == FontOrientation::Horizontal ? shadow-&gt;x() : shadow-&gt;y();
 51     int shadowY = orientation == FontOrientation::Horizontal ? shadow-&gt;y() : -shadow-&gt;x();
</pre>
<hr />
<pre>
196 
197 void TextPainter::paint(const TextRun&amp; textRun, const FloatRect&amp; boxRect, const FloatPoint&amp; textOrigin)
198 {
199     paintRange(textRun, boxRect, textOrigin, 0, textRun.length());
200 }
201 
202 void TextPainter::paintRange(const TextRun&amp; textRun, const FloatRect&amp; boxRect, const FloatPoint&amp; textOrigin, unsigned start, unsigned end)
203 {
204     ASSERT(m_font);
205     ASSERT(start &lt; end);
206 
207     GraphicsContextStateSaver stateSaver(m_context, m_style.strokeWidth &gt; 0);
208     updateGraphicsContext(m_context, m_style);
209     paintTextAndEmphasisMarksIfNeeded(textRun, boxRect, textOrigin, start, end, m_style, m_shadow, m_shadowColorFilter);
210 }
211 
212 void TextPainter::clearGlyphDisplayLists()
213 {
214     GlyphDisplayListCache&lt;InlineTextBox&gt;::singleton().clear();
215     GlyphDisplayListCache&lt;SimpleLineLayout::Run&gt;::singleton().clear();




216 }
217 
218 bool TextPainter::shouldUseGlyphDisplayList(const PaintInfo&amp; paintInfo)
219 {
220     return !paintInfo.context().paintingDisabled() &amp;&amp; paintInfo.enclosingSelfPaintingLayer() &amp;&amp; paintInfo.enclosingSelfPaintingLayer()-&gt;paintingFrequently();
221 }
222 
223 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
  7  * modify it under the terms of the GNU Library General Public
  8  * License as published by the Free Software Foundation; either
  9  * version 2 of the License, or (at your option) any later version.
 10  *
 11  * This library is distributed in the hope that it will be useful,
 12  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 13  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 14  * Library General Public License for more details.
 15  *
 16  * You should have received a copy of the GNU Library General Public License
 17  * along with this library; see the file COPYING.LIB.  If not, write to
 18  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 19  * Boston, MA 02110-1301, USA.
 20  *
 21  */
 22 
 23 #include &quot;config.h&quot;
 24 #include &quot;TextPainter.h&quot;
 25 
 26 #include &quot;DisplayListReplayer.h&quot;
<span class="line-added"> 27 #include &quot;DisplayRun.h&quot;</span>
 28 #include &quot;FilterOperations.h&quot;
 29 #include &quot;GraphicsContext.h&quot;
 30 #include &quot;InlineTextBox.h&quot;
 31 #include &quot;RenderCombineText.h&quot;
 32 #include &quot;RenderLayer.h&quot;
<span class="line-added"> 33 #include &quot;RuntimeEnabledFeatures.h&quot;</span>
 34 #include &quot;ShadowData.h&quot;
 35 #include &lt;wtf/NeverDestroyed.h&gt;
 36 
 37 namespace WebCore {
 38 
 39 ShadowApplier::ShadowApplier(GraphicsContext&amp; context, const ShadowData* shadow, const FilterOperations* colorFilter, const FloatRect&amp; textRect, bool lastShadowIterationShouldDrawText, bool opaque, FontOrientation orientation)
 40     : m_context { context }
 41     , m_shadow { shadow }
 42     , m_onlyDrawsShadow { !isLastShadowIteration() || !lastShadowIterationShouldDrawText }
 43     , m_avoidDrawingShadow { shadowIsCompletelyCoveredByText(opaque) }
 44     , m_nothingToDraw { shadow &amp;&amp; m_avoidDrawingShadow &amp;&amp; m_onlyDrawsShadow }
 45     , m_didSaveContext { false }
 46 {
 47     if (!shadow || m_nothingToDraw) {
 48         m_shadow = nullptr;
 49         return;
 50     }
 51 
 52     int shadowX = orientation == FontOrientation::Horizontal ? shadow-&gt;x() : shadow-&gt;y();
 53     int shadowY = orientation == FontOrientation::Horizontal ? shadow-&gt;y() : -shadow-&gt;x();
</pre>
<hr />
<pre>
198 
199 void TextPainter::paint(const TextRun&amp; textRun, const FloatRect&amp; boxRect, const FloatPoint&amp; textOrigin)
200 {
201     paintRange(textRun, boxRect, textOrigin, 0, textRun.length());
202 }
203 
204 void TextPainter::paintRange(const TextRun&amp; textRun, const FloatRect&amp; boxRect, const FloatPoint&amp; textOrigin, unsigned start, unsigned end)
205 {
206     ASSERT(m_font);
207     ASSERT(start &lt; end);
208 
209     GraphicsContextStateSaver stateSaver(m_context, m_style.strokeWidth &gt; 0);
210     updateGraphicsContext(m_context, m_style);
211     paintTextAndEmphasisMarksIfNeeded(textRun, boxRect, textOrigin, start, end, m_style, m_shadow, m_shadowColorFilter);
212 }
213 
214 void TextPainter::clearGlyphDisplayLists()
215 {
216     GlyphDisplayListCache&lt;InlineTextBox&gt;::singleton().clear();
217     GlyphDisplayListCache&lt;SimpleLineLayout::Run&gt;::singleton().clear();
<span class="line-added">218 #if ENABLE(LAYOUT_FORMATTING_CONTEXT)</span>
<span class="line-added">219     if (RuntimeEnabledFeatures::sharedFeatures().layoutFormattingContextIntegrationEnabled())</span>
<span class="line-added">220         GlyphDisplayListCache&lt;Display::Run&gt;::singleton().clear();</span>
<span class="line-added">221 #endif</span>
222 }
223 
224 bool TextPainter::shouldUseGlyphDisplayList(const PaintInfo&amp; paintInfo)
225 {
226     return !paintInfo.context().paintingDisabled() &amp;&amp; paintInfo.enclosingSelfPaintingLayer() &amp;&amp; paintInfo.enclosingSelfPaintingLayer()-&gt;paintingFrequently();
227 }
228 
229 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="TableLayout.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="line/BreakingContext.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>