<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/css/CSSGradientValue.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2008 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;CSSImageGeneratorValue.h&quot;
 29 #include &quot;CSSPrimitiveValue.h&quot;
 30 #include &quot;Gradient.h&quot;
 31 #include &lt;wtf/Vector.h&gt;
 32 
 33 namespace WebCore {
 34 
 35 class FloatPoint;
 36 class StyleResolver;
 37 
<a name="1" id="anc1"></a><span class="line-added"> 38 namespace Style {</span>
<span class="line-added"> 39 class BuilderState;</span>
<span class="line-added"> 40 }</span>
<span class="line-added"> 41 </span>
 42 enum CSSGradientType {
 43     CSSDeprecatedLinearGradient,
 44     CSSDeprecatedRadialGradient,
 45     CSSPrefixedLinearGradient,
 46     CSSPrefixedRadialGradient,
 47     CSSLinearGradient,
 48     CSSRadialGradient,
 49     CSSConicGradient
 50 };
 51 enum CSSGradientRepeat { NonRepeating, Repeating };
 52 
 53 struct CSSGradientColorStop {
 54     RefPtr&lt;CSSPrimitiveValue&gt; m_position; // percentage or length
 55     RefPtr&lt;CSSPrimitiveValue&gt; m_color;
 56     Color m_resolvedColor;
 57     bool m_colorIsDerivedFromElement = false;
 58     bool isMidpoint = false;
 59     bool operator==(const CSSGradientColorStop&amp; other) const
 60     {
 61         return compareCSSValuePtr(m_color, other.m_color)
 62             &amp;&amp; compareCSSValuePtr(m_position, other.m_position);
 63     }
 64 };
 65 
 66 class CSSGradientValue : public CSSImageGeneratorValue {
 67 public:
 68     RefPtr&lt;Image&gt; image(RenderElement&amp;, const FloatSize&amp;);
 69 
 70     void setFirstX(RefPtr&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_firstX = WTFMove(val); }
 71     void setFirstY(RefPtr&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_firstY = WTFMove(val); }
 72     void setSecondX(RefPtr&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_secondX = WTFMove(val); }
 73     void setSecondY(RefPtr&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_secondY = WTFMove(val); }
 74 
 75     void addStop(const CSSGradientColorStop&amp; stop) { m_stops.append(stop); }
 76     void doneAddingStops() { m_stops.shrinkToFit(); }
 77 
 78     unsigned stopCount() const { return m_stops.size(); }
 79 
 80     void sortStopsIfNeeded();
 81 
 82     bool isRepeating() const { return m_repeating; }
 83 
 84     CSSGradientType gradientType() const { return m_gradientType; }
 85 
 86     bool isFixedSize() const { return false; }
 87     FloatSize fixedSize(const RenderElement&amp;) const { return FloatSize(); }
 88 
 89     bool isPending() const { return false; }
 90     bool knownToBeOpaque(const RenderElement&amp;) const;
 91 
 92     void loadSubimages(CachedResourceLoader&amp;, const ResourceLoaderOptions&amp;) { }
<a name="2" id="anc2"></a><span class="line-modified"> 93     Ref&lt;CSSGradientValue&gt; gradientWithStylesResolved(Style::BuilderState&amp;);</span>
<span class="line-added"> 94     void resolveRGBColors();</span>
 95 
 96 protected:
 97     CSSGradientValue(ClassType classType, CSSGradientRepeat repeat, CSSGradientType gradientType)
 98         : CSSImageGeneratorValue(classType)
<a name="3" id="anc3"></a>
 99         , m_gradientType(gradientType)
100         , m_repeating(repeat == Repeating)
101     {
102     }
103 
104     CSSGradientValue(const CSSGradientValue&amp; other, ClassType classType, CSSGradientType gradientType)
105         : CSSImageGeneratorValue(classType)
106         , m_firstX(other.m_firstX)
107         , m_firstY(other.m_firstY)
108         , m_secondX(other.m_secondX)
109         , m_secondY(other.m_secondY)
110         , m_stops(other.m_stops)
111         , m_stopsSorted(other.m_stopsSorted)
112         , m_gradientType(gradientType)
<a name="4" id="anc4"></a><span class="line-modified">113         , m_repeating(other.m_repeating)</span>
114     {
115     }
116 
117     template&lt;typename GradientAdapter&gt;
118     Gradient::ColorStopVector computeStops(GradientAdapter&amp;, const CSSToLengthConversionData&amp;, const RenderStyle&amp;, float maxLengthForRepeat);
119 
120     // Resolve points/radii to front end values.
121     FloatPoint computeEndPoint(CSSPrimitiveValue*, CSSPrimitiveValue*, const CSSToLengthConversionData&amp;, const FloatSize&amp;);
122 
123     bool isCacheable() const;
124 
<a name="5" id="anc5"></a><span class="line-added">125     void writeColorStop(StringBuilder&amp;, const CSSGradientColorStop&amp;) const;</span>
<span class="line-added">126 </span>
127     // Points. Some of these may be null.
128     RefPtr&lt;CSSPrimitiveValue&gt; m_firstX;
129     RefPtr&lt;CSSPrimitiveValue&gt; m_firstY;
130 
131     RefPtr&lt;CSSPrimitiveValue&gt; m_secondX;
132     RefPtr&lt;CSSPrimitiveValue&gt; m_secondY;
133 
134     // Stops
135     Vector&lt;CSSGradientColorStop, 2&gt; m_stops;
<a name="6" id="anc6"></a><span class="line-modified">136     bool m_stopsSorted { false };</span>
137     CSSGradientType m_gradientType;
<a name="7" id="anc7"></a><span class="line-modified">138     bool m_repeating { false };</span>
139 };
140 
141 class CSSLinearGradientValue final : public CSSGradientValue {
142 public:
143     static Ref&lt;CSSLinearGradientValue&gt; create(CSSGradientRepeat repeat, CSSGradientType gradientType = CSSLinearGradient)
144     {
145         return adoptRef(*new CSSLinearGradientValue(repeat, gradientType));
146     }
147 
148     void setAngle(Ref&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_angle = WTFMove(val); }
149 
150     String customCSSText() const;
151 
152     // Create the gradient for a given size.
153     Ref&lt;Gradient&gt; createGradient(RenderElement&amp;, const FloatSize&amp;);
154 
155     Ref&lt;CSSLinearGradientValue&gt; clone() const
156     {
157         return adoptRef(*new CSSLinearGradientValue(*this));
158     }
159 
160     bool equals(const CSSLinearGradientValue&amp;) const;
161 
162 private:
163     CSSLinearGradientValue(CSSGradientRepeat repeat, CSSGradientType gradientType = CSSLinearGradient)
164         : CSSGradientValue(LinearGradientClass, repeat, gradientType)
165     {
166     }
167 
168     CSSLinearGradientValue(const CSSLinearGradientValue&amp; other)
169         : CSSGradientValue(other, LinearGradientClass, other.gradientType())
170         , m_angle(other.m_angle)
171     {
172     }
173 
174     RefPtr&lt;CSSPrimitiveValue&gt; m_angle; // may be null.
175 };
176 
177 class CSSRadialGradientValue final : public CSSGradientValue {
178 public:
179     static Ref&lt;CSSRadialGradientValue&gt; create(CSSGradientRepeat repeat, CSSGradientType gradientType = CSSRadialGradient)
180     {
181         return adoptRef(*new CSSRadialGradientValue(repeat, gradientType));
182     }
183 
184     Ref&lt;CSSRadialGradientValue&gt; clone() const
185     {
186         return adoptRef(*new CSSRadialGradientValue(*this));
187     }
188 
189     String customCSSText() const;
190 
191     void setFirstRadius(RefPtr&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_firstRadius = WTFMove(val); }
192     void setSecondRadius(RefPtr&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_secondRadius = WTFMove(val); }
193 
194     void setShape(RefPtr&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_shape = WTFMove(val); }
195     void setSizingBehavior(RefPtr&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_sizingBehavior = WTFMove(val); }
196 
197     void setEndHorizontalSize(RefPtr&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_endHorizontalSize = WTFMove(val); }
198     void setEndVerticalSize(RefPtr&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_endVerticalSize = WTFMove(val); }
199 
200     // Create the gradient for a given size.
201     Ref&lt;Gradient&gt; createGradient(RenderElement&amp;, const FloatSize&amp;);
202 
203     bool equals(const CSSRadialGradientValue&amp;) const;
204 
205 private:
206     CSSRadialGradientValue(CSSGradientRepeat repeat, CSSGradientType gradientType = CSSRadialGradient)
207         : CSSGradientValue(RadialGradientClass, repeat, gradientType)
208     {
209     }
210 
211     CSSRadialGradientValue(const CSSRadialGradientValue&amp; other)
212         : CSSGradientValue(other, RadialGradientClass, other.gradientType())
213         , m_firstRadius(other.m_firstRadius)
214         , m_secondRadius(other.m_secondRadius)
215         , m_shape(other.m_shape)
216         , m_sizingBehavior(other.m_sizingBehavior)
217         , m_endHorizontalSize(other.m_endHorizontalSize)
218         , m_endVerticalSize(other.m_endVerticalSize)
219     {
220     }
221 
222     // Resolve points/radii to front end values.
223     float resolveRadius(CSSPrimitiveValue&amp;, const CSSToLengthConversionData&amp;, float* widthOrHeight = 0);
224 
225     // These may be null for non-deprecated gradients.
226     RefPtr&lt;CSSPrimitiveValue&gt; m_firstRadius;
227     RefPtr&lt;CSSPrimitiveValue&gt; m_secondRadius;
228 
229     // The below are only used for non-deprecated gradients. Any of them may be null.
230     RefPtr&lt;CSSPrimitiveValue&gt; m_shape;
231     RefPtr&lt;CSSPrimitiveValue&gt; m_sizingBehavior;
232 
233     RefPtr&lt;CSSPrimitiveValue&gt; m_endHorizontalSize;
234     RefPtr&lt;CSSPrimitiveValue&gt; m_endVerticalSize;
235 };
236 
237 class CSSConicGradientValue final : public CSSGradientValue {
238 public:
239     static Ref&lt;CSSConicGradientValue&gt; create(CSSGradientRepeat repeat)
240     {
241         return adoptRef(*new CSSConicGradientValue(repeat));
242     }
243 
244     Ref&lt;CSSConicGradientValue&gt; clone() const
245     {
246         return adoptRef(*new CSSConicGradientValue(*this));
247     }
248 
249     String customCSSText() const;
250 
251     void setAngle(RefPtr&lt;CSSPrimitiveValue&gt;&amp;&amp; val) { m_angle = WTFMove(val); }
252 
253     // Create the gradient for a given size.
254     Ref&lt;Gradient&gt; createGradient(RenderElement&amp;, const FloatSize&amp;);
255 
256     bool equals(const CSSConicGradientValue&amp;) const;
257 
258 private:
259     CSSConicGradientValue(CSSGradientRepeat repeat)
260         : CSSGradientValue(ConicGradientClass, repeat, CSSConicGradient)
261     {
262     }
263 
264     CSSConicGradientValue(const CSSConicGradientValue&amp; other)
265         : CSSGradientValue(other, ConicGradientClass, other.gradientType())
266         , m_angle(other.m_angle)
267     {
268     }
269 
270     RefPtr&lt;CSSPrimitiveValue&gt; m_angle; // may be null.
271 };
272 
273 } // namespace WebCore
274 
275 SPECIALIZE_TYPE_TRAITS_CSS_VALUE(CSSGradientValue, isGradientValue())
276 SPECIALIZE_TYPE_TRAITS_CSS_VALUE(CSSLinearGradientValue, isLinearGradientValue())
277 SPECIALIZE_TYPE_TRAITS_CSS_VALUE(CSSRadialGradientValue, isRadialGradientValue())
278 SPECIALIZE_TYPE_TRAITS_CSS_VALUE(CSSConicGradientValue, isConicGradientValue())
<a name="8" id="anc8"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="8" type="hidden" />
</body>
</html>