<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/Modules/webgpu/WHLSL/WHLSLLexer.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
   2  * Copyright (C) 2018 Apple Inc. All rights reserved.
   3  *
   4  * Redistribution and use in source and binary forms, with or without
   5  * modification, are permitted provided that the following conditions
   6  * are met:
   7  * 1. Redistributions of source code must retain the above copyright
   8  *    notice, this list of conditions and the following disclaimer.
   9  * 2. Redistributions in binary form must reproduce the above copyright
  10  *    notice, this list of conditions and the following disclaimer in the
  11  *    documentation and/or other materials provided with the distribution.
  12  *
  13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
  14  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  15  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
  17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
  18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
  19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
  20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
  21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
  22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
  23  * THE POSSIBILITY OF SUCH DAMAGE.
  24  */
  25 
  26 #include &quot;config.h&quot;
  27 #include &quot;WHLSLLexer.h&quot;
  28 
  29 #if ENABLE(WEBGPU)
  30 
  31 namespace WebCore {
  32 
  33 namespace WHLSL {
  34 
  35 const char* Token::typeName(Type type)
  36 {
  37     switch (type) {
  38     case Type::IntLiteral:
  39         return &quot;int literal&quot;;
  40     case Type::UintLiteral:
  41         return &quot;uint literal&quot;;
  42     case Type::FloatLiteral:
  43         return &quot;float literal&quot;;
  44     case Type::Struct:
  45         return &quot;struct&quot;;
  46     case Type::Typedef:
  47         return &quot;typedef&quot;;
  48     case Type::Enum:
  49         return &quot;enum&quot;;
  50     case Type::Operator:
  51         return &quot;operator&quot;;
  52     case Type::If:
  53         return &quot;if&quot;;
  54     case Type::Else:
  55         return &quot;else&quot;;
  56     case Type::Continue:
  57         return &quot;continue&quot;;
  58     case Type::Break:
  59         return &quot;break&quot;;
  60     case Type::Switch:
  61         return &quot;switch&quot;;
  62     case Type::Case:
  63         return &quot;case&quot;;
  64     case Type::Default:
  65         return &quot;default&quot;;
  66     case Type::Fallthrough:
  67         return &quot;fallthrough&quot;;
  68     case Type::For:
  69         return &quot;for&quot;;
  70     case Type::While:
  71         return &quot;while&quot;;
  72     case Type::Do:
  73         return &quot;do&quot;;
  74     case Type::Return:
  75         return &quot;return&quot;;
  76     case Type::Null:
  77         return &quot;null&quot;;
  78     case Type::True:
  79         return &quot;true&quot;;
  80     case Type::False:
  81         return &quot;false&quot;;
  82     case Type::Constant:
  83         return &quot;constant&quot;;
  84     case Type::Device:
  85         return &quot;device&quot;;
  86     case Type::Threadgroup:
  87         return &quot;threadgroup&quot;;
  88     case Type::Thread:
  89         return &quot;thread&quot;;
  90     case Type::Space:
  91         return &quot;space&quot;;
  92     case Type::Vertex:
  93         return &quot;vertex&quot;;
  94     case Type::Fragment:
  95         return &quot;fragment&quot;;
  96     case Type::Compute:
  97         return &quot;compute&quot;;
  98     case Type::NumThreads:
  99         return &quot;numthreads&quot;;
 100     case Type::SVInstanceID:
 101         return &quot;SV_InstanceID&quot;;
 102     case Type::SVVertexID:
 103         return &quot;SV_VertexID&quot;;
 104     case Type::PSize:
 105         return &quot;PSIZE&quot;;
 106     case Type::SVPosition:
 107         return &quot;SV_Position&quot;;
 108     case Type::SVIsFrontFace:
 109         return &quot;SV_IsFrontFace&quot;;
 110     case Type::SVSampleIndex:
 111         return &quot;SV_SampleIndex&quot;;
 112     case Type::SVInnerCoverage:
 113         return &quot;SV_InnerCoverage&quot;;
 114     case Type::SVTarget:
 115         return &quot;SV_Target&quot;;
 116     case Type::SVDepth:
 117         return &quot;SV_Depth&quot;;
 118     case Type::SVCoverage:
 119         return &quot;SV_Coverage&quot;;
 120     case Type::SVDispatchThreadID:
 121         return &quot;SV_DispatchThreadID&quot;;
 122     case Type::SVGroupID:
 123         return &quot;SV_GroupID&quot;;
 124     case Type::SVGroupIndex:
 125         return &quot;SV_GroupIndex&quot;;
 126     case Type::SVGroupThreadID:
 127         return &quot;SV_GroupThreadID&quot;;
 128     case Type::Attribute:
 129         return &quot;SV_Attribute&quot;;
 130     case Type::Register:
 131         return &quot;register&quot;;
 132     case Type::Specialized:
 133         return &quot;specialized&quot;;
 134     case Type::Native:
 135         return &quot;native&quot;;
 136     case Type::Restricted:
 137         return &quot;restricted&quot;;
 138     case Type::Underscore:
 139         return &quot;_&quot;;
 140     case Type::Auto:
 141         return &quot;auto&quot;;
 142     case Type::Protocol:
 143         return &quot;protocol&quot;;
 144     case Type::Const:
 145         return &quot;const&quot;;
 146     case Type::Static:
 147         return &quot;static&quot;;
 148     case Type::Qualifier:
 149         return &quot;qualifier&quot;;
 150     case Type::Identifier:
 151         return &quot;identifier&quot;;
 152     case Type::OperatorName:
 153         return &quot;operator name&quot;;
 154     case Type::EqualsSign:
 155         return &quot;=&quot;;
 156     case Type::Semicolon:
 157         return &quot;;&quot;;
 158     case Type::LeftCurlyBracket:
 159         return &quot;{&quot;;
 160     case Type::RightCurlyBracket:
 161         return &quot;}&quot;;
 162     case Type::Colon:
 163         return &quot;:&quot;;
 164     case Type::Comma:
 165         return &quot;,&quot;;
 166     case Type::LeftParenthesis:
 167         return &quot;(&quot;;
 168     case Type::RightParenthesis:
 169         return &quot;)&quot;;
 170     case Type::SquareBracketPair:
 171         return &quot;[]&quot;;
 172     case Type::LeftSquareBracket:
 173         return &quot;[&quot;;
 174     case Type::RightSquareBracket:
 175         return &quot;]&quot;;
 176     case Type::Star:
 177         return &quot;*&quot;;
 178     case Type::LessThanSign:
 179         return &quot;&lt;&quot;;
 180     case Type::GreaterThanSign:
 181         return &quot;&gt;&quot;;
 182     case Type::FullStop:
 183         return &quot;.&quot;;
 184     case Type::PlusEquals:
 185         return &quot;+=&quot;;
 186     case Type::MinusEquals:
 187         return &quot;-=&quot;;
 188     case Type::TimesEquals:
 189         return &quot;*=&quot;;
 190     case Type::DivideEquals:
 191         return &quot;/=&quot;;
 192     case Type::ModEquals:
 193         return &quot;%=&quot;;
 194     case Type::XorEquals:
 195         return &quot;^=&quot;;
 196     case Type::AndEquals:
 197         return &quot;&amp;=&quot;;
 198     case Type::OrEquals:
 199         return &quot;|=&quot;;
 200     case Type::RightShiftEquals:
 201         return &quot;&gt;&gt;=&quot;;
 202     case Type::LeftShiftEquals:
 203         return &quot;&lt;&lt;=&quot;;
 204     case Type::PlusPlus:
 205         return &quot;++&quot;;
 206     case Type::MinusMinus:
 207         return &quot;--&quot;;
 208     case Type::Arrow:
 209         return &quot;-&gt;&quot;;
 210     case Type::QuestionMark:
 211         return &quot;?&quot;;
 212     case Type::OrOr:
 213         return &quot;||&quot;;
 214     case Type::AndAnd:
 215         return &quot;&amp;&amp;&quot;;
 216     case Type::Or:
 217         return &quot;|&quot;;
 218     case Type::Xor:
 219         return &quot;^&quot;;
 220     case Type::And:
 221         return &quot;&amp;&quot;;
 222     case Type::LessThanOrEqualTo:
 223         return &quot;&lt;=&quot;;
 224     case Type::GreaterThanOrEqualTo:
 225         return &quot;&gt;=&quot;;
 226     case Type::EqualComparison:
 227         return &quot;==&quot;;
 228     case Type::NotEqual:
 229         return &quot;!=&quot;;
 230     case Type::RightShift:
 231         return &quot;&gt;&gt;&quot;;
 232     case Type::LeftShift:
 233         return &quot;&lt;&lt;&quot;;
 234     case Type::Plus:
 235         return &quot;+&quot;;
 236     case Type::Minus:
 237         return &quot;-&quot;;
 238     case Type::Divide:
 239         return &quot;/&quot;;
 240     case Type::Mod:
 241         return &quot;%&quot;;
 242     case Type::Tilde:
 243         return &quot;~&quot;;
 244     case Type::ExclamationPoint:
 245         return &quot;!&quot;;
 246     case Type::At:
 247         return &quot;@&quot;;
 248     case Type::EndOfFile:
 249         return &quot;EOF&quot;;
 250     case Type::Invalid:
 251         return &quot;LEXING_ERROR&quot;;
 252     }
 253 }
 254 
 255 static ALWAYS_INLINE bool isValidIdentifierStart(UChar theChar)
 256 {
 257     return (theChar &gt;= &#39;a&#39; &amp;&amp; theChar &lt;= &#39;z&#39;)
 258         || (theChar &gt;= &#39;A&#39; &amp;&amp; theChar &lt;= &#39;Z&#39;)
 259         || (theChar == &#39;_&#39;);
 260 }
 261 
 262 static ALWAYS_INLINE bool isValidNonStartingIdentifierChar(UChar theChar)
 263 {
 264     return (theChar &gt;= &#39;a&#39; &amp;&amp; theChar &lt;= &#39;z&#39;)
 265         || (theChar &gt;= &#39;A&#39; &amp;&amp; theChar &lt;= &#39;Z&#39;)
 266         || (theChar &gt;= &#39;0&#39; &amp;&amp; theChar &lt;= &#39;9&#39;)
 267         || (theChar == &#39;_&#39;);
 268 }
 269 
 270 static ALWAYS_INLINE bool isHexadecimalCharacter(UChar character)
 271 {
 272     return (character &gt;= &#39;0&#39; &amp;&amp; character &lt;= &#39;9&#39;)
 273         || (character &gt;= &#39;a&#39; &amp;&amp; character &lt;= &#39;f&#39;)
 274         || (character &gt;= &#39;A&#39; &amp;&amp; character &lt;= &#39;F&#39;);
 275 }
 276 
 277 static ALWAYS_INLINE bool isDigit(UChar theChar)
 278 {
 279     return theChar &gt;= &#39;0&#39; &amp;&amp; theChar &lt;= &#39;9&#39;;
 280 }
 281 
 282 auto Lexer::consumeTokenFromStream() -&gt; Token
 283 {
 284     UChar current = 0;
 285     unsigned offset = m_offset;
 286 
 287     auto peek = [&amp;] () -&gt; UChar {
 288         if (offset &lt; m_stringView.length())
 289             return m_stringView[offset];
 290         return 0;
 291     };
 292 
 293     auto shift = [&amp;] {
 294         if (offset &lt; m_stringView.length()) {
 295             current = m_stringView[offset];
 296             ++offset;
 297             return current;
 298         }
 299         current = 0;
 300         return current;
 301     };
 302 
 303     auto consume = [&amp;] (UChar theChar) {
 304         if (peek() == theChar) {
 305             shift();
 306             return true;
 307         }
 308         return false;
 309     };
 310 
 311     auto nextIsIdentifier = [&amp;] {
 312         return isValidNonStartingIdentifierChar(peek());
 313     };
 314 
 315     auto token = [&amp;] (Token::Type type) -&gt; Token {
 316         auto oldOffset = m_offset;
 317         m_offset = offset;
 318         skipWhitespaceAndComments();
 319         return { { oldOffset, offset, m_nameSpace }, type };
 320     };
 321 
 322     switch (shift()) {
 323     case &#39;A&#39;:
 324     case &#39;B&#39;:
 325     case &#39;C&#39;:
 326     case &#39;D&#39;:
 327     case &#39;E&#39;:
 328     case &#39;F&#39;:
 329     case &#39;G&#39;:
 330     case &#39;H&#39;:
 331     case &#39;I&#39;:
 332     case &#39;J&#39;:
 333     case &#39;K&#39;:
 334     case &#39;L&#39;:
 335     case &#39;M&#39;:
 336     case &#39;N&#39;:
 337     case &#39;O&#39;:
 338     case &#39;Q&#39;:
 339     case &#39;R&#39;:
 340     case &#39;T&#39;:
 341     case &#39;U&#39;:
 342     case &#39;V&#39;:
 343     case &#39;W&#39;:
 344     case &#39;X&#39;:
 345     case &#39;Y&#39;:
 346     case &#39;Z&#39;:
 347     case &#39;g&#39;:
 348     case &#39;h&#39;:
 349     case &#39;j&#39;:
 350     case &#39;k&#39;:
 351     case &#39;l&#39;:
 352     case &#39;m&#39;:
 353     case &#39;q&#39;:
 354     case &#39;x&#39;:
 355     case &#39;y&#39;:
 356     case &#39;z&#39;:
 357 parseIdentifier:
 358         while (isValidNonStartingIdentifierChar(peek()))
 359             shift();
 360         return token(Token::Type::Identifier);
 361 
 362     case &#39;s&#39;:
 363         switch (peek()) {
 364         case &#39;a&#39;:
 365             shift();
 366             if (!consume(&#39;m&#39;))
 367                 goto parseIdentifier;
 368             if (!consume(&#39;p&#39;))
 369                 goto parseIdentifier;
 370             if (!consume(&#39;l&#39;))
 371                 goto parseIdentifier;
 372             if (!consume(&#39;e&#39;))
 373                 goto parseIdentifier;
 374             if (nextIsIdentifier())
 375                 goto parseIdentifier;
 376             return token(Token::Type::Qualifier);
 377 
 378         case &#39;w&#39;:
 379             shift();
 380             if (!consume(&#39;i&#39;))
 381                 goto parseIdentifier;
 382             if (!consume(&#39;t&#39;))
 383                 goto parseIdentifier;
 384             if (!consume(&#39;c&#39;))
 385                 goto parseIdentifier;
 386             if (!consume(&#39;h&#39;))
 387                 goto parseIdentifier;
 388             if (nextIsIdentifier())
 389                 goto parseIdentifier;
 390             return token(Token::Type::Switch);
 391 
 392         case &#39;t&#39;:
 393             shift();
 394             switch (peek()) {
 395             case &#39;r&#39;:
 396                 shift();
 397                 if (!consume(&#39;u&#39;))
 398                     goto parseIdentifier;
 399                 if (!consume(&#39;c&#39;))
 400                     goto parseIdentifier;
 401                 if (!consume(&#39;t&#39;))
 402                     goto parseIdentifier;
 403                 if (nextIsIdentifier())
 404                     goto parseIdentifier;
 405                 return token(Token::Type::Struct);
 406             case &#39;a&#39;:
 407                 shift();
 408                 if (!consume(&#39;t&#39;))
 409                     goto parseIdentifier;
 410                 if (!consume(&#39;i&#39;))
 411                     goto parseIdentifier;
 412                 if (!consume(&#39;c&#39;))
 413                     goto parseIdentifier;
 414                 if (nextIsIdentifier())
 415                     goto parseIdentifier;
 416                 return token(Token::Type::Static);
 417             default:
 418                 goto parseIdentifier;
 419             }
 420             break;
 421 
 422         case &#39;p&#39;:
 423             shift();
 424             switch (peek()) {
 425             case &#39;a&#39;:
 426                 shift();
 427                 if (!consume(&#39;c&#39;))
 428                     goto parseIdentifier;
 429                 if (!consume(&#39;e&#39;))
 430                     goto parseIdentifier;
 431                 if (nextIsIdentifier())
 432                     goto parseIdentifier;
 433                 return token(Token::Type::Space);
 434             case &#39;e&#39;:
 435                 shift();
 436                 if (!consume(&#39;c&#39;))
 437                     goto parseIdentifier;
 438                 if (!consume(&#39;i&#39;))
 439                     goto parseIdentifier;
 440                 if (!consume(&#39;a&#39;))
 441                     goto parseIdentifier;
 442                 if (!consume(&#39;l&#39;))
 443                     goto parseIdentifier;
 444                 if (!consume(&#39;i&#39;))
 445                     goto parseIdentifier;
 446                 if (!consume(&#39;z&#39;))
 447                     goto parseIdentifier;
 448                 if (!consume(&#39;e&#39;))
 449                     goto parseIdentifier;
 450                 if (!consume(&#39;d&#39;))
 451                     goto parseIdentifier;
 452                 if (nextIsIdentifier())
 453                     goto parseIdentifier;
 454                 return token(Token::Type::Specialized);
 455             default:
 456                 goto parseIdentifier;
 457             }
 458         default:
 459             goto parseIdentifier;
 460         }
 461 
 462     case &#39;S&#39;:
 463         if (!consume(&#39;V&#39;))
 464             goto parseIdentifier;
 465         if (!consume(&#39;_&#39;))
 466             goto parseIdentifier;
 467 
 468         switch (peek()) {
 469         case &#39;G&#39;:
 470             shift();
 471             if (!consume(&#39;r&#39;))
 472                 goto parseIdentifier;
 473             if (!consume(&#39;o&#39;))
 474                 goto parseIdentifier;
 475             if (!consume(&#39;u&#39;))
 476                 goto parseIdentifier;
 477             if (!consume(&#39;p&#39;))
 478                 goto parseIdentifier;
 479 
 480             switch (peek()) {
 481             case &#39;I&#39;:
 482                 shift();
 483                 switch (peek()) {
 484                 case &#39;D&#39;:
 485                     shift();
 486                     if (nextIsIdentifier())
 487                         goto parseIdentifier;
 488                     return token(Token::Type::SVGroupID);
 489                 case &#39;n&#39;:
 490                     shift();
 491                     if (!consume(&#39;d&#39;))
 492                         goto parseIdentifier;
 493                     if (!consume(&#39;e&#39;))
 494                         goto parseIdentifier;
 495                     if (!consume(&#39;x&#39;))
 496                         goto parseIdentifier;
 497                     if (nextIsIdentifier())
 498                         goto parseIdentifier;
 499                     return token(Token::Type::SVGroupIndex);
 500 
 501                 default:
 502                     goto parseIdentifier;
 503                 }
 504 
 505             case &#39;T&#39;:
 506                 shift();
 507                 if (!consume(&#39;h&#39;))
 508                     goto parseIdentifier;
 509                 if (!consume(&#39;r&#39;))
 510                     goto parseIdentifier;
 511                 if (!consume(&#39;e&#39;))
 512                     goto parseIdentifier;
 513                 if (!consume(&#39;a&#39;))
 514                     goto parseIdentifier;
 515                 if (!consume(&#39;d&#39;))
 516                     goto parseIdentifier;
 517                 if (!consume(&#39;I&#39;))
 518                     goto parseIdentifier;
 519                 if (!consume(&#39;D&#39;))
 520                     goto parseIdentifier;
 521                 if (nextIsIdentifier())
 522                     goto parseIdentifier;
 523                 return token(Token::Type::SVGroupThreadID);
 524 
 525             default:
 526                 goto parseIdentifier;
 527             }
 528         case &#39;D&#39;:
 529             shift();
 530             switch (peek()) {
 531             case &#39;e&#39;:
 532                 shift();
 533                 if (!consume(&#39;p&#39;))
 534                     goto parseIdentifier;
 535                 if (!consume(&#39;t&#39;))
 536                     goto parseIdentifier;
 537                 if (!consume(&#39;h&#39;))
 538                     goto parseIdentifier;
 539                 if (nextIsIdentifier())
 540                     goto parseIdentifier;
 541                 return token(Token::Type::SVDepth);
 542             case &#39;i&#39;:
 543                 shift();
 544                 if (!consume(&#39;s&#39;))
 545                     goto parseIdentifier;
 546                 if (!consume(&#39;p&#39;))
 547                     goto parseIdentifier;
 548                 if (!consume(&#39;a&#39;))
 549                     goto parseIdentifier;
 550                 if (!consume(&#39;t&#39;))
 551                     goto parseIdentifier;
 552                 if (!consume(&#39;c&#39;))
 553                     goto parseIdentifier;
 554                 if (!consume(&#39;h&#39;))
 555                     goto parseIdentifier;
 556                 if (!consume(&#39;T&#39;))
 557                     goto parseIdentifier;
 558                 if (!consume(&#39;h&#39;))
 559                     goto parseIdentifier;
 560                 if (!consume(&#39;r&#39;))
 561                     goto parseIdentifier;
 562                 if (!consume(&#39;e&#39;))
 563                     goto parseIdentifier;
 564                 if (!consume(&#39;a&#39;))
 565                     goto parseIdentifier;
 566                 if (!consume(&#39;d&#39;))
 567                     goto parseIdentifier;
 568                 if (!consume(&#39;I&#39;))
 569                     goto parseIdentifier;
 570                 if (!consume(&#39;D&#39;))
 571                     goto parseIdentifier;
 572                 if (nextIsIdentifier())
 573                     goto parseIdentifier;
 574                 return token(Token::Type::SVDispatchThreadID);
 575             default:
 576                 goto parseIdentifier;
 577             }
 578         case &#39;C&#39;:
 579             shift();
 580             if (!consume(&#39;o&#39;))
 581                 goto parseIdentifier;
 582             if (!consume(&#39;v&#39;))
 583                 goto parseIdentifier;
 584             if (!consume(&#39;e&#39;))
 585                 goto parseIdentifier;
 586             if (!consume(&#39;r&#39;))
 587                 goto parseIdentifier;
 588             if (!consume(&#39;a&#39;))
 589                 goto parseIdentifier;
 590             if (!consume(&#39;g&#39;))
 591                 goto parseIdentifier;
 592             if (!consume(&#39;e&#39;))
 593                 goto parseIdentifier;
 594             if (nextIsIdentifier())
 595                 goto parseIdentifier;
 596             return token(Token::Type::SVCoverage);
 597         case &#39;T&#39;:
 598             shift();
 599             if (!consume(&#39;a&#39;))
 600                 goto parseIdentifier;
 601             if (!consume(&#39;r&#39;))
 602                 goto parseIdentifier;
 603             if (!consume(&#39;g&#39;))
 604                 goto parseIdentifier;
 605             if (!consume(&#39;e&#39;))
 606                 goto parseIdentifier;
 607             if (!consume(&#39;t&#39;))
 608                 goto parseIdentifier;
 609             if (nextIsIdentifier())
 610                 goto parseIdentifier;
 611             return token(Token::Type::SVTarget);
 612         case &#39;S&#39;:
 613             shift();
 614             if (!consume(&#39;a&#39;))
 615                 goto parseIdentifier;
 616             if (!consume(&#39;m&#39;))
 617                 goto parseIdentifier;
 618             if (!consume(&#39;p&#39;))
 619                 goto parseIdentifier;
 620             if (!consume(&#39;l&#39;))
 621                 goto parseIdentifier;
 622             if (!consume(&#39;e&#39;))
 623                 goto parseIdentifier;
 624             if (!consume(&#39;I&#39;))
 625                 goto parseIdentifier;
 626             if (!consume(&#39;n&#39;))
 627                 goto parseIdentifier;
 628             if (!consume(&#39;d&#39;))
 629                 goto parseIdentifier;
 630             if (!consume(&#39;e&#39;))
 631                 goto parseIdentifier;
 632             if (!consume(&#39;x&#39;))
 633                 goto parseIdentifier;
 634             if (nextIsIdentifier())
 635                 goto parseIdentifier;
 636             return token(Token::Type::SVSampleIndex);
 637         case &#39;P&#39;:
 638             shift();
 639             if (!consume(&#39;o&#39;))
 640                 goto parseIdentifier;
 641             if (!consume(&#39;s&#39;))
 642                 goto parseIdentifier;
 643             if (!consume(&#39;i&#39;))
 644                 goto parseIdentifier;
 645             if (!consume(&#39;t&#39;))
 646                 goto parseIdentifier;
 647             if (!consume(&#39;i&#39;))
 648                 goto parseIdentifier;
 649             if (!consume(&#39;o&#39;))
 650                 goto parseIdentifier;
 651             if (!consume(&#39;n&#39;))
 652                 goto parseIdentifier;
 653             if (nextIsIdentifier())
 654                 goto parseIdentifier;
 655             return token(Token::Type::SVPosition);
 656         case &#39;V&#39;:
 657             shift();
 658             if (!consume(&#39;e&#39;))
 659                 goto parseIdentifier;
 660             if (!consume(&#39;r&#39;))
 661                 goto parseIdentifier;
 662             if (!consume(&#39;t&#39;))
 663                 goto parseIdentifier;
 664             if (!consume(&#39;e&#39;))
 665                 goto parseIdentifier;
 666             if (!consume(&#39;x&#39;))
 667                 goto parseIdentifier;
 668             if (!consume(&#39;I&#39;))
 669                 goto parseIdentifier;
 670             if (!consume(&#39;D&#39;))
 671                 goto parseIdentifier;
 672             if (nextIsIdentifier())
 673                 goto parseIdentifier;
 674             return token(Token::Type::SVVertexID);
 675         case &#39;I&#39;:
 676             shift();
 677             switch (peek()) {
 678             case &#39;s&#39;:
 679                 shift();
 680                 if (!consume(&#39;F&#39;))
 681                     goto parseIdentifier;
 682                 if (!consume(&#39;r&#39;))
 683                     goto parseIdentifier;
 684                 if (!consume(&#39;o&#39;))
 685                     goto parseIdentifier;
 686                 if (!consume(&#39;n&#39;))
 687                     goto parseIdentifier;
 688                 if (!consume(&#39;t&#39;))
 689                     goto parseIdentifier;
 690                 if (!consume(&#39;F&#39;))
 691                     goto parseIdentifier;
 692                 if (!consume(&#39;a&#39;))
 693                     goto parseIdentifier;
 694                 if (!consume(&#39;c&#39;))
 695                     goto parseIdentifier;
 696                 if (!consume(&#39;e&#39;))
 697                     goto parseIdentifier;
 698                 if (nextIsIdentifier())
 699                     goto parseIdentifier;
 700                 return token(Token::Type::SVIsFrontFace);
 701             case &#39;n&#39;:
 702                 shift();
 703                 switch (peek()) {
 704                 case &#39;n&#39;:
 705                     shift();
 706                     if (!consume(&#39;e&#39;))
 707                         goto parseIdentifier;
 708                     if (!consume(&#39;r&#39;))
 709                         goto parseIdentifier;
 710                     if (!consume(&#39;C&#39;))
 711                         goto parseIdentifier;
 712                     if (!consume(&#39;o&#39;))
 713                         goto parseIdentifier;
 714                     if (!consume(&#39;v&#39;))
 715                         goto parseIdentifier;
 716                     if (!consume(&#39;e&#39;))
 717                         goto parseIdentifier;
 718                     if (!consume(&#39;r&#39;))
 719                         goto parseIdentifier;
 720                     if (!consume(&#39;a&#39;))
 721                         goto parseIdentifier;
 722                     if (!consume(&#39;g&#39;))
 723                         goto parseIdentifier;
 724                     if (!consume(&#39;e&#39;))
 725                         goto parseIdentifier;
 726                     if (nextIsIdentifier())
 727                         goto parseIdentifier;
 728                     return token(Token::Type::SVInnerCoverage);
 729                 case &#39;s&#39;:
 730                     shift();
 731                     if (!consume(&#39;t&#39;))
 732                         goto parseIdentifier;
 733                     if (!consume(&#39;a&#39;))
 734                         goto parseIdentifier;
 735                     if (!consume(&#39;n&#39;))
 736                         goto parseIdentifier;
 737                     if (!consume(&#39;c&#39;))
 738                         goto parseIdentifier;
 739                     if (!consume(&#39;e&#39;))
 740                         goto parseIdentifier;
 741                     if (!consume(&#39;I&#39;))
 742                         goto parseIdentifier;
 743                     if (!consume(&#39;D&#39;))
 744                         goto parseIdentifier;
 745                     if (nextIsIdentifier())
 746                         goto parseIdentifier;
 747                     return token(Token::Type::SVInstanceID);
 748                 default:
 749                     goto parseIdentifier;
 750                 }
 751 
 752             default:
 753                 goto parseIdentifier;
 754             }
 755         default:
 756             goto parseIdentifier;
 757         }
 758 
 759     case &#39;t&#39;:
 760         switch (peek()) {
 761         case &#39;r&#39;:
 762             shift();
 763             if (!consume(&#39;u&#39;))
 764                 goto parseIdentifier;
 765             if (!consume(&#39;e&#39;))
 766                 goto parseIdentifier;
 767             if (nextIsIdentifier())
 768                 goto parseIdentifier;
 769             return token(Token::Type::True);
 770         case &#39;y&#39;:
 771             shift();
 772             if (!consume(&#39;p&#39;))
 773                 goto parseIdentifier;
 774             if (!consume(&#39;e&#39;))
 775                 goto parseIdentifier;
 776             if (!consume(&#39;d&#39;))
 777                 goto parseIdentifier;
 778             if (!consume(&#39;e&#39;))
 779                 goto parseIdentifier;
 780             if (!consume(&#39;f&#39;))
 781                 goto parseIdentifier;
 782             if (nextIsIdentifier())
 783                 goto parseIdentifier;
 784             return token(Token::Type::Typedef);
 785         case &#39;h&#39;:
 786             shift();
 787             if (!consume(&#39;r&#39;))
 788                 goto parseIdentifier;
 789             if (!consume(&#39;e&#39;))
 790                 goto parseIdentifier;
 791             if (!consume(&#39;a&#39;))
 792                 goto parseIdentifier;
 793             if (!consume(&#39;d&#39;))
 794                 goto parseIdentifier;
 795 
 796             if (!nextIsIdentifier())
 797                 return token(Token::Type::Thread);
 798 
 799             if (peek() != &#39;g&#39;)
 800                 goto parseIdentifier;
 801 
 802             shift();
 803             RELEASE_ASSERT(current == &#39;g&#39;);
 804             if (!consume(&#39;r&#39;))
 805                 goto parseIdentifier;
 806             if (!consume(&#39;o&#39;))
 807                 goto parseIdentifier;
 808             if (!consume(&#39;u&#39;))
 809                 goto parseIdentifier;
 810             if (!consume(&#39;p&#39;))
 811                 goto parseIdentifier;
 812             if (nextIsIdentifier())
 813                 goto parseIdentifier;
 814             return token(Token::Type::Threadgroup);
 815 
 816         default:
 817             goto parseIdentifier;
 818         }
 819 
 820     case &#39;e&#39;:
 821         switch (peek()) {
 822         case &#39;n&#39;:
 823             shift();
 824             if (!consume(&#39;u&#39;))
 825                 goto parseIdentifier;
 826             if (!consume(&#39;m&#39;))
 827                 goto parseIdentifier;
 828             if (nextIsIdentifier())
 829                 goto parseIdentifier;
 830             return token(Token::Type::Enum);
 831         case &#39;l&#39;:
 832             shift();
 833             if (!consume(&#39;s&#39;))
 834                 goto parseIdentifier;
 835             if (!consume(&#39;e&#39;))
 836                 goto parseIdentifier;
 837             if (nextIsIdentifier())
 838                 goto parseIdentifier;
 839             return token(Token::Type::Else);
 840         default:
 841             goto parseIdentifier;
 842         }
 843 
 844     case &#39;o&#39;:
 845         if (!consume(&#39;p&#39;))
 846             goto parseIdentifier;
 847         if (!consume(&#39;e&#39;))
 848             goto parseIdentifier;
 849         if (!consume(&#39;r&#39;))
 850             goto parseIdentifier;
 851         if (!consume(&#39;a&#39;))
 852             goto parseIdentifier;
 853         if (!consume(&#39;t&#39;))
 854             goto parseIdentifier;
 855         if (!consume(&#39;o&#39;))
 856             goto parseIdentifier;
 857         if (!consume(&#39;r&#39;))
 858             goto parseIdentifier;
 859         if (nextIsIdentifier())
 860             goto parseIdentifier;
 861 
 862         switch (peek()) {
 863         case &#39;&amp;&#39;:
 864             shift();
<a name="1" id="anc1"></a>






















 865             return token(Token::Type::OperatorName);
 866 
 867         case &#39;&gt;&#39;:
 868             shift();
 869             if (consume(&#39;&gt;&#39;))
 870                 return token(Token::Type::OperatorName);
 871             if (consume(&#39;=&#39;))
 872                 return token(Token::Type::OperatorName);
 873             return token(Token::Type::OperatorName);
 874 
 875         case &#39;&lt;&#39;:
 876             shift();
 877             if (consume(&#39;&lt;&#39;))
 878                 return token(Token::Type::OperatorName);
 879             if (consume(&#39;=&#39;))
 880                 return token(Token::Type::OperatorName);
 881             return token(Token::Type::OperatorName);
 882 
 883         case &#39;+&#39;:
 884             shift();
 885             consume(&#39;+&#39;);
 886             return token(Token::Type::OperatorName);
 887 
 888         case &#39;-&#39;:
 889             shift();
 890             consume(&#39;-&#39;);
 891             return token(Token::Type::OperatorName);
 892 
 893         case &#39;|&#39;:
 894             shift();
 895             return token(Token::Type::OperatorName);
 896 
 897         case &#39;=&#39;:
 898             shift();
 899             if (!consume(&#39;=&#39;))
 900                 return token(Token::Type::Invalid);
 901             return token(Token::Type::OperatorName);
 902 
 903         case &#39;*&#39;:
 904             shift();
 905             return token(Token::Type::OperatorName);
 906 
 907         case &#39;/&#39;:
 908             shift();
 909             return token(Token::Type::OperatorName);
 910 
 911         case &#39;%&#39;:
 912             shift();
 913             return token(Token::Type::OperatorName);
 914 
 915         case &#39;!&#39;:
 916             shift();
 917             return token(Token::Type::OperatorName);
 918 
 919         case &#39;~&#39;:
 920             shift();
 921             return token(Token::Type::OperatorName);
 922 
 923         case &#39;^&#39;:
 924             shift();
 925             return token(Token::Type::OperatorName);
 926 
<a name="2" id="anc2"></a>








 927         default:
 928             break;
 929         }
 930 
 931         return token(Token::Type::Operator);
 932 
 933     case &#39;i&#39;:
 934         if (!consume(&#39;f&#39;))
 935             goto parseIdentifier;
 936         if (nextIsIdentifier())
 937             goto parseIdentifier;
 938         return token(Token::Type::If);
 939 
 940     case &#39;c&#39;:
 941         switch (peek()) {
 942         case &#39;a&#39;:
 943             shift();
 944             if (!consume(&#39;s&#39;))
 945                 goto parseIdentifier;
 946             if (!consume(&#39;e&#39;))
 947                 goto parseIdentifier;
 948             if (nextIsIdentifier())
 949                 goto parseIdentifier;
 950             return token(Token::Type::Case);
 951 
 952         case &#39;e&#39;:
 953             shift();
 954             if (!consume(&#39;n&#39;))
 955                 goto parseIdentifier;
 956             if (!consume(&#39;t&#39;))
 957                 goto parseIdentifier;
 958             if (!consume(&#39;r&#39;))
 959                 goto parseIdentifier;
 960             if (!consume(&#39;o&#39;))
 961                 goto parseIdentifier;
 962             if (!consume(&#39;i&#39;))
 963                 goto parseIdentifier;
 964             if (!consume(&#39;d&#39;))
 965                 goto parseIdentifier;
 966             if (nextIsIdentifier())
 967                 goto parseIdentifier;
 968             return token(Token::Type::Qualifier);
 969         case &#39;o&#39;:
 970             shift();
 971             switch (peek()) {
 972             case &#39;m&#39;:
 973                 shift();
 974                 if (!consume(&#39;p&#39;))
 975                     goto parseIdentifier;
 976                 if (!consume(&#39;u&#39;))
 977                     goto parseIdentifier;
 978                 if (!consume(&#39;t&#39;))
 979                     goto parseIdentifier;
 980                 if (!consume(&#39;e&#39;))
 981                     goto parseIdentifier;
 982                 if (nextIsIdentifier())
 983                     goto parseIdentifier;
 984                 return token(Token::Type::Compute);
 985             case &#39;n&#39;:
 986                 shift();
 987                 switch (peek()) {
 988                 case &#39;t&#39;:
 989                     shift();
 990                     if (!consume(&#39;i&#39;))
 991                         goto parseIdentifier;
 992                     if (!consume(&#39;n&#39;))
 993                         goto parseIdentifier;
 994                     if (!consume(&#39;u&#39;))
 995                         goto parseIdentifier;
 996                     if (!consume(&#39;e&#39;))
 997                         goto parseIdentifier;
 998                     if (nextIsIdentifier())
 999                         goto parseIdentifier;
1000                     return token(Token::Type::Continue);
1001                 case &#39;s&#39;:
1002                     shift();
1003                     if (!consume(&#39;t&#39;))
1004                         goto parseIdentifier;
1005 
1006                     if (!nextIsIdentifier())
1007                         return token(Token::Type::Const);
1008 
1009                     if (!consume(&#39;a&#39;))
1010                         goto parseIdentifier;
1011                     if (!consume(&#39;n&#39;))
1012                         goto parseIdentifier;
1013                     if (!consume(&#39;t&#39;))
1014                         goto parseIdentifier;
1015                     if (nextIsIdentifier())
1016                         goto parseIdentifier;
1017                     return token(Token::Type::Constant);
1018 
1019                 default:
1020                     goto parseIdentifier;
1021                 }
1022 
1023             default:
1024                 goto parseIdentifier;
1025             }
1026 
1027         default:
1028             goto parseIdentifier;
1029         }
1030 
1031     case &#39;b&#39;:
1032         if (!consume(&#39;r&#39;))
1033             goto parseIdentifier;
1034         if (!consume(&#39;e&#39;))
1035             goto parseIdentifier;
1036         if (!consume(&#39;a&#39;))
1037             goto parseIdentifier;
1038         if (!consume(&#39;k&#39;))
1039             goto parseIdentifier;
1040         if (nextIsIdentifier())
1041             goto parseIdentifier;
1042         return token(Token::Type::Break);
1043 
1044     case &#39;d&#39;:
1045         switch (peek()) {
1046         case &#39;o&#39;:
1047             shift();
1048             if (nextIsIdentifier())
1049                 goto parseIdentifier;
1050             return token(Token::Type::Do);
1051         case &#39;e&#39;:
1052             shift();
1053             switch (peek()) {
1054             case &#39;f&#39;:
1055                 shift();
1056                 if (!consume(&#39;a&#39;))
1057                     goto parseIdentifier;
1058                 if (!consume(&#39;u&#39;))
1059                     goto parseIdentifier;
1060                 if (!consume(&#39;l&#39;))
1061                     goto parseIdentifier;
1062                 if (!consume(&#39;t&#39;))
1063                     goto parseIdentifier;
1064                 if (nextIsIdentifier())
1065                     goto parseIdentifier;
1066                 return token(Token::Type::Default);
1067             case &#39;v&#39;:
1068                 shift();
1069                 if (!consume(&#39;i&#39;))
1070                     goto parseIdentifier;
1071                 if (!consume(&#39;c&#39;))
1072                     goto parseIdentifier;
1073                 if (!consume(&#39;e&#39;))
1074                     goto parseIdentifier;
1075                 if (nextIsIdentifier())
1076                     goto parseIdentifier;
1077                 return token(Token::Type::Device);
1078             default:
1079                 goto parseIdentifier;
1080             }
1081 
1082         default:
1083             goto parseIdentifier;
1084         }
1085 
1086 
1087     case &#39;f&#39;:
1088         switch (peek()) {
1089         case &#39;o&#39;:
1090             shift();
1091             if (!consume(&#39;r&#39;))
1092                 goto parseIdentifier;
1093             if (nextIsIdentifier())
1094                 goto parseIdentifier;
1095             return token(Token::Type::For);
1096         case &#39;r&#39;:
1097             shift();
1098             if (!consume(&#39;a&#39;))
1099                 goto parseIdentifier;
1100             if (!consume(&#39;g&#39;))
1101                 goto parseIdentifier;
1102             if (!consume(&#39;m&#39;))
1103                 goto parseIdentifier;
1104             if (!consume(&#39;e&#39;))
1105                 goto parseIdentifier;
1106             if (!consume(&#39;n&#39;))
1107                 goto parseIdentifier;
1108             if (!consume(&#39;t&#39;))
1109                 goto parseIdentifier;
1110             if (nextIsIdentifier())
1111                 goto parseIdentifier;
1112             return token(Token::Type::Fragment);
1113         case &#39;a&#39;:
1114             shift();
1115             if (!consume(&#39;l&#39;))
1116                 goto parseIdentifier;
1117 
1118             switch (peek()) {
1119             case &#39;l&#39;:
1120                 shift();
1121                 if (!consume(&#39;t&#39;))
1122                     goto parseIdentifier;
1123                 if (!consume(&#39;h&#39;))
1124                     goto parseIdentifier;
1125                 if (!consume(&#39;r&#39;))
1126                     goto parseIdentifier;
1127                 if (!consume(&#39;o&#39;))
1128                     goto parseIdentifier;
1129                 if (!consume(&#39;u&#39;))
1130                     goto parseIdentifier;
1131                 if (!consume(&#39;g&#39;))
1132                     goto parseIdentifier;
1133                 if (!consume(&#39;h&#39;))
1134                     goto parseIdentifier;
1135                 if (nextIsIdentifier())
1136                     goto parseIdentifier;
1137                 return token(Token::Type::Fallthrough);
1138 
1139             case &#39;s&#39;:
1140                 shift();
1141                 if (!consume(&#39;e&#39;))
1142                     goto parseIdentifier;
1143                 if (nextIsIdentifier())
1144                     goto parseIdentifier;
1145                 return token(Token::Type::False);
1146             default:
1147                 goto parseIdentifier;
1148             }
1149         case &#39;e&#39;:
1150             shift();
1151             switch (peek()) {
1152             case &#39;f&#39;:
1153                 shift();
1154                 if (!consume(&#39;a&#39;))
1155                     goto parseIdentifier;
1156                 if (!consume(&#39;u&#39;))
1157                     goto parseIdentifier;
1158                 if (!consume(&#39;l&#39;))
1159                     goto parseIdentifier;
1160                 if (!consume(&#39;t&#39;))
1161                     goto parseIdentifier;
1162                 if (nextIsIdentifier())
1163                     goto parseIdentifier;
1164                 return token(Token::Type::Default);
1165             case &#39;v&#39;:
1166                 shift();
1167                 if (!consume(&#39;i&#39;))
1168                     goto parseIdentifier;
1169                 if (!consume(&#39;c&#39;))
1170                     goto parseIdentifier;
1171                 if (!consume(&#39;e&#39;))
1172                     goto parseIdentifier;
1173                 if (nextIsIdentifier())
1174                     goto parseIdentifier;
1175                 return token(Token::Type::Device);
1176             default:
1177                 goto parseIdentifier;
1178             }
1179 
1180         default:
1181             goto parseIdentifier;
1182         }
1183 
1184     case &#39;w&#39;:
1185         if (!consume(&#39;h&#39;))
1186             goto parseIdentifier;
1187         if (!consume(&#39;i&#39;))
1188             goto parseIdentifier;
1189         if (!consume(&#39;l&#39;))
1190             goto parseIdentifier;
1191         if (!consume(&#39;e&#39;))
1192             goto parseIdentifier;
1193         if (nextIsIdentifier())
1194             goto parseIdentifier;
1195         return token(Token::Type::While);
1196 
1197     case &#39;r&#39;:
1198         if (!consume(&#39;e&#39;))
1199             goto parseIdentifier;
1200         switch (peek()) {
1201         case &#39;t&#39;:
1202             shift();
1203             if (!consume(&#39;u&#39;))
1204                 goto parseIdentifier;
1205             if (!consume(&#39;r&#39;))
1206                 goto parseIdentifier;
1207             if (!consume(&#39;n&#39;))
1208                 goto parseIdentifier;
1209             if (nextIsIdentifier())
1210                 goto parseIdentifier;
1211             return token(Token::Type::Return);
1212         case &#39;g&#39;:
1213             shift();
1214             if (!consume(&#39;i&#39;))
1215                 goto parseIdentifier;
1216             if (!consume(&#39;s&#39;))
1217                 goto parseIdentifier;
1218             if (!consume(&#39;t&#39;))
1219                 goto parseIdentifier;
1220             if (!consume(&#39;e&#39;))
1221                 goto parseIdentifier;
1222             if (!consume(&#39;r&#39;))
1223                 goto parseIdentifier;
1224             if (nextIsIdentifier())
1225                 goto parseIdentifier;
1226             return token(Token::Type::Register);
1227         case &#39;s&#39;:
1228             shift();
1229             if (!consume(&#39;t&#39;))
1230                 goto parseIdentifier;
1231             if (!consume(&#39;r&#39;))
1232                 goto parseIdentifier;
1233             if (!consume(&#39;i&#39;))
1234                 goto parseIdentifier;
1235             if (!consume(&#39;c&#39;))
1236                 goto parseIdentifier;
1237             if (!consume(&#39;t&#39;))
1238                 goto parseIdentifier;
1239             if (!consume(&#39;e&#39;))
1240                 goto parseIdentifier;
1241             if (!consume(&#39;d&#39;))
1242                 goto parseIdentifier;
1243             if (nextIsIdentifier())
1244                 goto parseIdentifier;
1245             return token(Token::Type::Restricted);
1246         default:
1247             goto parseIdentifier;
1248         }
1249 
1250     case &#39;n&#39;:
1251         switch (peek()) {
1252         case &#39;a&#39;:
1253             shift();
1254             if (!consume(&#39;t&#39;))
1255                 goto parseIdentifier;
1256             if (!consume(&#39;i&#39;))
1257                 goto parseIdentifier;
1258             if (!consume(&#39;v&#39;))
1259                 goto parseIdentifier;
1260             if (!consume(&#39;e&#39;))
1261                 goto parseIdentifier;
1262             if (nextIsIdentifier())
1263                 goto parseIdentifier;
1264             return token(Token::Type::Native);
1265         case &#39;u&#39;:
1266             shift();
1267             switch (peek()) {
1268             case &#39;l&#39;:
1269                 shift();
1270                 if (!consume(&#39;l&#39;))
1271                     goto parseIdentifier;
1272                 if (nextIsIdentifier())
1273                     goto parseIdentifier;
1274                 return token(Token::Type::Null);
1275             case &#39;m&#39;:
1276                 shift();
1277                 if (!consume(&#39;t&#39;))
1278                     goto parseIdentifier;
1279                 if (!consume(&#39;h&#39;))
1280                     goto parseIdentifier;
1281                 if (!consume(&#39;r&#39;))
1282                     goto parseIdentifier;
1283                 if (!consume(&#39;e&#39;))
1284                     goto parseIdentifier;
1285                 if (!consume(&#39;a&#39;))
1286                     goto parseIdentifier;
1287                 if (!consume(&#39;d&#39;))
1288                     goto parseIdentifier;
1289                 if (!consume(&#39;s&#39;))
1290                     goto parseIdentifier;
1291                 if (nextIsIdentifier())
1292                     goto parseIdentifier;
1293                 return token(Token::Type::NumThreads);
1294             default:
1295                 goto parseIdentifier;
1296             }
1297 
1298         case &#39;o&#39;:
1299             shift();
1300             switch (peek()) {
1301             case &#39;i&#39;:
1302                 shift();
1303                 if (!consume(&#39;n&#39;))
1304                     goto parseIdentifier;
1305                 if (!consume(&#39;t&#39;))
1306                     goto parseIdentifier;
1307                 if (!consume(&#39;e&#39;))
1308                     goto parseIdentifier;
1309                 if (!consume(&#39;r&#39;))
1310                     goto parseIdentifier;
1311                 if (!consume(&#39;p&#39;))
1312                     goto parseIdentifier;
1313                 if (!consume(&#39;o&#39;))
1314                     goto parseIdentifier;
1315                 if (!consume(&#39;l&#39;))
1316                     goto parseIdentifier;
1317                 if (!consume(&#39;a&#39;))
1318                     goto parseIdentifier;
1319                 if (!consume(&#39;t&#39;))
1320                     goto parseIdentifier;
1321                 if (!consume(&#39;i&#39;))
1322                     goto parseIdentifier;
1323                 if (!consume(&#39;o&#39;))
1324                     goto parseIdentifier;
1325                 if (!consume(&#39;n&#39;))
1326                     goto parseIdentifier;
1327                 if (nextIsIdentifier())
1328                     goto parseIdentifier;
1329                 return token(Token::Type::Qualifier);
1330             case &#39;p&#39;:
1331                 shift();
1332                 if (!consume(&#39;e&#39;))
1333                     goto parseIdentifier;
1334                 if (!consume(&#39;r&#39;))
1335                     goto parseIdentifier;
1336                 if (!consume(&#39;s&#39;))
1337                     goto parseIdentifier;
1338                 if (!consume(&#39;p&#39;))
1339                     goto parseIdentifier;
1340                 if (!consume(&#39;e&#39;))
1341                     goto parseIdentifier;
1342                 if (!consume(&#39;c&#39;))
1343                     goto parseIdentifier;
1344                 if (!consume(&#39;t&#39;))
1345                     goto parseIdentifier;
1346                 if (!consume(&#39;i&#39;))
1347                     goto parseIdentifier;
1348                 if (!consume(&#39;v&#39;))
1349                     goto parseIdentifier;
1350                 if (!consume(&#39;e&#39;))
1351                     goto parseIdentifier;
1352                 if (nextIsIdentifier())
1353                     goto parseIdentifier;
1354                 return token(Token::Type::Qualifier);
1355             default:
1356                 goto parseIdentifier;
1357             }
1358 
1359         default:
1360             goto parseIdentifier;
1361         }
1362 
1363     case &#39;v&#39;:
1364         if (!consume(&#39;e&#39;))
1365             goto parseIdentifier;
1366         if (!consume(&#39;r&#39;))
1367             goto parseIdentifier;
1368         if (!consume(&#39;t&#39;))
1369             goto parseIdentifier;
1370         if (!consume(&#39;e&#39;))
1371             goto parseIdentifier;
1372         if (!consume(&#39;x&#39;))
1373             goto parseIdentifier;
1374         if (nextIsIdentifier())
1375             goto parseIdentifier;
1376         return token(Token::Type::Vertex);
1377 
1378     case &#39;P&#39;:
1379         if (!consume(&#39;S&#39;))
1380             goto parseIdentifier;
1381         if (!consume(&#39;I&#39;))
1382             goto parseIdentifier;
1383         if (!consume(&#39;Z&#39;))
1384             goto parseIdentifier;
1385         if (!consume(&#39;E&#39;))
1386             goto parseIdentifier;
1387         if (nextIsIdentifier())
1388             goto parseIdentifier;
1389         return token(Token::Type::PSize);
1390 
1391     case &#39;u&#39;:
1392         if (!consume(&#39;n&#39;))
1393             goto parseIdentifier;
1394         if (!consume(&#39;i&#39;))
1395             goto parseIdentifier;
1396         if (!consume(&#39;f&#39;))
1397             goto parseIdentifier;
1398         if (!consume(&#39;o&#39;))
1399             goto parseIdentifier;
1400         if (!consume(&#39;r&#39;))
1401             goto parseIdentifier;
1402         if (!consume(&#39;m&#39;))
1403             goto parseIdentifier;
1404         if (nextIsIdentifier())
1405             goto parseIdentifier;
1406         return token(Token::Type::Qualifier);
1407 
1408     case &#39;p&#39;:
1409         if (!consume(&#39;r&#39;))
1410             goto parseIdentifier;
1411         if (!consume(&#39;o&#39;))
1412             goto parseIdentifier;
1413         if (!consume(&#39;t&#39;))
1414             goto parseIdentifier;
1415         if (!consume(&#39;o&#39;))
1416             goto parseIdentifier;
1417         if (!consume(&#39;c&#39;))
1418             goto parseIdentifier;
1419         if (!consume(&#39;o&#39;))
1420             goto parseIdentifier;
1421         if (!consume(&#39;l&#39;))
1422             goto parseIdentifier;
1423         if (nextIsIdentifier())
1424             goto parseIdentifier;
1425         return token(Token::Type::Protocol);
1426 
1427     case &#39;_&#39;:
1428         if (nextIsIdentifier())
1429             goto parseIdentifier;
1430         return token(Token::Type::Underscore);
1431 
1432     case &#39;a&#39;:
1433         switch (peek()) {
1434         case &#39;t&#39;:
1435             shift();
1436             if (!consume(&#39;t&#39;))
1437                 goto parseIdentifier;
1438             if (!consume(&#39;r&#39;))
1439                 goto parseIdentifier;
1440             if (!consume(&#39;i&#39;))
1441                 goto parseIdentifier;
1442             if (!consume(&#39;b&#39;))
1443                 goto parseIdentifier;
1444             if (!consume(&#39;u&#39;))
1445                 goto parseIdentifier;
1446             if (!consume(&#39;t&#39;))
1447                 goto parseIdentifier;
1448             if (!consume(&#39;e&#39;))
1449                 goto parseIdentifier;
1450             if (nextIsIdentifier())
1451                 goto parseIdentifier;
1452             return token(Token::Type::Attribute);
1453         case &#39;u&#39;:
1454             shift();
1455             if (!consume(&#39;t&#39;))
1456                 goto parseIdentifier;
1457             if (!consume(&#39;o&#39;))
1458                 goto parseIdentifier;
1459             if (nextIsIdentifier())
1460                 goto parseIdentifier;
1461             return token(Token::Type::Auto);
1462         default:
1463             goto parseIdentifier;
1464         }
1465 
1466     case &#39;&gt;&#39;:
1467         if (consume(&#39;&gt;&#39;)) {
1468             if (consume(&#39;=&#39;))
1469                 return token(Token::Type::RightShiftEquals);
1470             return token(Token::Type::RightShift);
1471         }
1472         if (consume(&#39;=&#39;))
1473             return token(Token::Type::GreaterThanOrEqualTo);
1474         return token(Token::Type::GreaterThanSign);
1475     case &#39;&lt;&#39;:
1476         if (consume(&#39;&lt;&#39;)) {
1477             if (consume(&#39;=&#39;))
1478                 return token(Token::Type::LeftShiftEquals);
1479             return token(Token::Type::LeftShift);
1480         }
1481         if (consume(&#39;=&#39;))
1482             return token(Token::Type::LessThanOrEqualTo);
1483         return token(Token::Type::LessThanSign);
1484 
1485     case &#39;+&#39;:
1486         if (consume(&#39;=&#39;))
1487             return token(Token::Type::PlusEquals);
1488         if (consume(&#39;+&#39;))
1489             return token(Token::Type::PlusPlus);
1490         return token(Token::Type::Plus);
1491 
1492     case &#39;-&#39;:
1493         if (consume(&#39;=&#39;))
1494             return token(Token::Type::MinusEquals);
1495         if (consume(&#39;-&#39;))
1496             return token(Token::Type::MinusMinus);
1497         if (consume(&#39;&gt;&#39;))
1498             return token(Token::Type::Arrow);
1499         if (isDigit(peek())) {
1500             shift();
1501             goto parseNumber;
1502         }
1503         if (consume(&#39;.&#39;))
1504             goto parseFloatAfterDot;
1505         return token(Token::Type::Minus);
1506 
1507     case &#39;*&#39;:
1508         if (consume(&#39;=&#39;))
1509             return token(Token::Type::TimesEquals);
1510         return token(Token::Type::Star);
1511 
1512     case &#39;/&#39;:
1513         if (consume(&#39;=&#39;))
1514             return token(Token::Type::DivideEquals);
1515         return token(Token::Type::Divide);
1516 
1517     case &#39;%&#39;:
1518         if (consume(&#39;=&#39;))
1519             return token(Token::Type::ModEquals);
1520         return token(Token::Type::Mod);
1521 
1522     case &#39;^&#39;:
1523         if (consume(&#39;=&#39;))
1524             return token(Token::Type::XorEquals);
1525         return token(Token::Type::Xor);
1526 
1527     case &#39;&amp;&#39;:
1528         if (consume(&#39;=&#39;))
1529             return token(Token::Type::AndEquals);
1530         if (consume(&#39;&amp;&#39;))
1531             return token(Token::Type::AndAnd);
1532         return token(Token::Type::And);
1533 
1534     case &#39;|&#39;:
1535         if (consume(&#39;=&#39;))
1536             return token(Token::Type::OrEquals);
1537         if (consume(&#39;|&#39;))
1538             return token(Token::Type::OrOr);
1539         return token(Token::Type::Or);
1540 
1541     case &#39;[&#39;:
1542         if (consume(&#39;]&#39;))
1543             return token(Token::Type::SquareBracketPair);
1544         return token(Token::Type::LeftSquareBracket);
1545 
1546     case &#39;=&#39;:
1547         if (consume(&#39;=&#39;))
1548             return token(Token::Type::EqualComparison);
1549         return token(Token::Type::EqualsSign);
1550 
1551     case &#39;!&#39;:
1552         if (consume(&#39;=&#39;))
1553             return token(Token::Type::NotEqual);
1554         return token(Token::Type::ExclamationPoint);
1555 
1556     case &#39;;&#39;:
1557         return token(Token::Type::Semicolon);
1558 
1559     case &#39;{&#39;:
1560         return token(Token::Type::LeftCurlyBracket);
1561 
1562     case &#39;}&#39;:
1563         return token(Token::Type::RightCurlyBracket);
1564 
1565     case &#39;:&#39;:
1566         return token(Token::Type::Colon);
1567 
1568     case &#39;,&#39;:
1569         return token(Token::Type::Comma);
1570 
1571     case &#39;(&#39;:
1572         return token(Token::Type::LeftParenthesis);
1573 
1574     case &#39;)&#39;:
1575         return token(Token::Type::RightParenthesis);
1576 
1577     case &#39;]&#39;:
1578         return token(Token::Type::RightSquareBracket);
1579 
1580     case &#39;.&#39;:
1581         if (isDigit(peek()))
1582             goto parseFloatAfterDot;
1583         return token(Token::Type::FullStop);
1584 
1585     case &#39;?&#39;:
1586         return token(Token::Type::QuestionMark);
1587 
1588     case &#39;~&#39;:
1589         return token(Token::Type::Tilde);
1590 
1591     case &#39;@&#39;:
1592         return token(Token::Type::At);
1593 
1594     case &#39;0&#39;:
1595     case &#39;1&#39;:
1596     case &#39;2&#39;:
1597     case &#39;3&#39;:
1598     case &#39;4&#39;:
1599     case &#39;5&#39;:
1600     case &#39;6&#39;:
1601     case &#39;7&#39;:
1602     case &#39;8&#39;:
1603     case &#39;9&#39;: {
1604 parseNumber:
1605         if (current == &#39;0&#39; &amp;&amp; consume(&#39;x&#39;)) {
1606             while (isHexadecimalCharacter(peek()))
1607                 shift();
1608             if (consume(&#39;u&#39;))
1609                 return token(Token::Type::UintLiteral);
1610             return token(Token::Type::IntLiteral);
1611         }
1612 
1613         while (isDigit(peek()))
1614             shift();
1615 
1616         if (consume(&#39;.&#39;)) {
1617 parseFloatAfterDot:
1618             while (isDigit(peek()))
1619                 shift();
1620             consume(&#39;f&#39;);
1621             return token(Token::Type::FloatLiteral);
1622         }
1623 
1624         if (consume(&#39;f&#39;))
1625             return token(Token::Type::FloatLiteral);
1626 
1627         if (consume(&#39;u&#39;))
1628             return token(Token::Type::UintLiteral);
1629 
1630         return token(Token::Type::IntLiteral);
1631     }
1632 
1633     default:
1634         break;
1635     }
1636 
1637     if (m_offset == m_stringView.length())
1638         return token(Token::Type::EndOfFile);
1639     return token(Token::Type::Invalid);
1640 }
1641 
1642 
1643 // We can take advantage of two properties of Unicode:
1644 // 1. The consitutent UTF-16 code units for all non-BMP code points are surrogates,
1645 // which means we&#39;ll never see a false match. If we see a BMP code unit, we
1646 // really have a BMP code point.
1647 // 2. Everything we&#39;re looking for is in BMP
1648 
1649 static inline bool isWhitespace(UChar codeUnit)
1650 {
1651     switch (codeUnit) {
1652     case &#39; &#39;:
1653     case &#39;\t&#39;:
1654     case &#39;\r&#39;:
1655     case &#39;\n&#39;:
1656         return true;
1657     default:
1658         return false;
1659     }
1660 }
1661 
1662 static inline bool isNewline(UChar codeUnit)
1663 {
1664     switch (codeUnit) {
1665     case &#39;\r&#39;:
1666     case &#39;\n&#39;:
1667         return true;
1668     default:
1669         return false;
1670     }
1671 }
1672 
1673 auto Lexer::lineAndColumnNumberFromOffset(const StringView&amp; stringView, unsigned targetOffset) -&gt; LineAndColumn
1674 {
1675     // Counting from 1 to match most text editors.
1676     unsigned lineNumber = 1;
1677     unsigned columnNumber = 1;
1678     for (unsigned offset = 0; offset &lt; std::min(stringView.length(), targetOffset); ++offset) {
1679         ++columnNumber;
1680         if (isNewline(stringView[offset])) {
1681             ++lineNumber;
1682             columnNumber = 1;
1683         }
1684     }
1685     return { lineNumber, columnNumber };
1686 }
1687 
1688 static Optional&lt;StringView&gt; sourceFromNameSpace(AST::NameSpace nameSpace, const String&amp; source1, const String* source2)
1689 {
1690     switch (nameSpace) {
1691     case AST::NameSpace::StandardLibrary:
1692         return WTF::nullopt;
1693     case AST::NameSpace::NameSpace1:
1694         return StringView(source1);
1695     case AST::NameSpace::NameSpace2:
1696         ASSERT(source2);
1697         return StringView(*source2);
1698     }
1699 }
1700 
1701 String Lexer::errorString(Error error, const String&amp; source1, const String* source2)
1702 {
1703     if (auto codeLocation = error.codeLocation()) {
1704         if (auto source = sourceFromNameSpace(codeLocation.nameSpace(), source1, source2)) {
1705             auto lineAndColumn = lineAndColumnNumberFromOffset(*source, error.codeLocation().startOffset());
1706             return makeString(lineAndColumn.line, &#39;:&#39;, lineAndColumn.column, &quot;: &quot;, error.message());
1707         }
1708     }
1709     return error.message();
1710 }
1711 
1712 void Lexer::skipWhitespaceAndComments()
1713 {
1714     while (m_offset &lt; m_stringView.length()) {
1715         if (isWhitespace(m_stringView[m_offset]))
1716             ++m_offset;
1717         else if (m_stringView[m_offset] == &#39;/&#39; &amp;&amp; m_offset + 1 &lt; m_stringView.length()) {
1718             if (m_stringView[m_offset + 1] == &#39;/&#39;) {
1719                 // Line comment
1720                 m_offset += 2;
1721                 // Note that in the case of \r\n this makes the comment end on the \r. It is fine, as the \n after that is simple whitespace.
1722                 for ( ; m_offset &lt; m_stringView.length() &amp;&amp; !isNewline(m_stringView[m_offset]); ++m_offset) { }
1723             } else if (m_stringView[m_offset + 1] == &#39;*&#39;) {
1724                 // Long comment
1725                 for ( ; m_offset &lt; m_stringView.length() ; ++m_offset) {
1726                     if (m_stringView[m_offset] == &#39;*&#39; &amp;&amp; m_offset + 1 &lt; m_stringView.length() &amp;&amp; m_stringView[m_offset + 1] == &#39;/&#39;) {
1727                         m_offset += 2;
1728                         break;
1729                     }
1730                 }
1731             } else
1732                 break;
1733         } else
1734             break;
1735     }
1736 }
1737 
1738 } // namespace WHLSL
1739 
1740 } // namespace WebCore
1741 
1742 #endif // ENABLE(WEBGPU)
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>