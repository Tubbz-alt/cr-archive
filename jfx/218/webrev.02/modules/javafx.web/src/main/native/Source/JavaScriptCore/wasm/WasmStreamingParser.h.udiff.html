<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/wasm/WasmStreamingParser.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="WasmStreamingParser.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="WasmTable.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/wasm/WasmStreamingParser.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -28,17 +28,23 @@</span>
  #if ENABLE(WEBASSEMBLY)
  
  #include &quot;WasmModuleInformation.h&quot;
  #include &quot;WasmParser.h&quot;
  #include &quot;WasmSections.h&quot;
<span class="udiff-line-added">+ #include &lt;wtf/CrossThreadCopier.h&gt;</span>
  #include &lt;wtf/SHA1.h&gt;
  #include &lt;wtf/Vector.h&gt;
  #include &lt;wtf/text/WTFString.h&gt;
  
  namespace JSC { namespace Wasm {
  
  class StreamingParserClient {
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+     virtual ~StreamingParserClient() = default;</span>
<span class="udiff-line-added">+     virtual bool didReceiveSectionData(Section) { return true; };</span>
<span class="udiff-line-added">+     virtual bool didReceiveFunctionData(unsigned, const FunctionData&amp;) = 0;</span>
<span class="udiff-line-added">+     virtual void didFinishParsing() { }</span>
  };
  
  class StreamingParser {
      WTF_MAKE_FAST_ALLOCATED;
  public:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -65,16 +71,18 @@</span>
          FatalError,
      };
  
      enum class IsEndOfStream { Yes, No };
  
<span class="udiff-line-modified-removed">-     StreamingParser(ModuleInformation&amp;);</span>
<span class="udiff-line-modified-added">+     StreamingParser(ModuleInformation&amp;, StreamingParserClient&amp;);</span>
  
      State addBytes(const uint8_t* bytes, size_t length) { return addBytes(bytes, length, IsEndOfStream::No); }
      State finalize();
  
<span class="udiff-line-modified-removed">-     const String&amp; errorMessage() const { return m_errorMessage; }</span>
<span class="udiff-line-modified-added">+     String errorMessage() const { return crossThreadCopy(m_errorMessage); }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     void reportError() { moveToStateIfNotFailed(failOnState(State::FatalError)); }</span>
  
  private:
      static constexpr unsigned moduleHeaderSize = 8;
      static constexpr unsigned sectionIDSize = 1;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -90,15 +98,17 @@</span>
      State parseFunctionPayload(Vector&lt;uint8_t&gt;&amp;&amp;);
  
      Optional&lt;Vector&lt;uint8_t&gt;&gt; consume(const uint8_t* bytes, size_t, size_t&amp;, size_t);
      Expected&lt;uint32_t, State&gt; consumeVarUInt32(const uint8_t* bytes, size_t, size_t&amp;, IsEndOfStream);
  
<span class="udiff-line-added">+     void moveToStateIfNotFailed(State);</span>
      template &lt;typename ...Args&gt; NEVER_INLINE State WARN_UNUSED_RETURN fail(Args...);
  
      State failOnState(State);
  
      Ref&lt;ModuleInformation&gt; m_info;
<span class="udiff-line-added">+     StreamingParserClient&amp; m_client;</span>
      Vector&lt;uint8_t&gt; m_remaining;
      String m_errorMessage;
  
      CheckedSize m_totalSize { 0 };
      size_t m_offset { 0 };
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -112,10 +122,11 @@</span>
      uint32_t m_functionCount { 0 };
      uint32_t m_functionIndex { 0 };
  
      uint32_t m_functionSize { 0 };
  
<span class="udiff-line-added">+     Lock m_stateLock;</span>
      State m_state { State::ModuleHeader };
      Section m_section { Section::Begin };
      Section m_previousKnownSection { Section::Begin };
  };
  
</pre>
<center><a href="WasmStreamingParser.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="WasmTable.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>