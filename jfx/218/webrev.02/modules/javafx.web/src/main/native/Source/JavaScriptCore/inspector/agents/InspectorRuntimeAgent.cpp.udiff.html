<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/agents/InspectorRuntimeAgent.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InspectorHeapAgent.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="InspectorRuntimeAgent.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/agents/InspectorRuntimeAgent.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (C) 2013-2015 Apple Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2013-2019 Apple Inc. All rights reserved.</span>
   * Copyright (C) 2011 Google Inc. All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions are
   * met:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -54,10 +54,17 @@</span>
  static bool asBool(const bool* b)
  {
      return b &amp;&amp; *b;
  }
  
<span class="udiff-line-added">+ static int asInt(const int* i)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (i)</span>
<span class="udiff-line-added">+         return *i;</span>
<span class="udiff-line-added">+     return 0;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  InspectorRuntimeAgent::InspectorRuntimeAgent(AgentContext&amp; context)
      : InspectorAgentBase(&quot;Runtime&quot;_s)
      , m_injectedScriptManager(context.injectedScriptManager)
      , m_scriptDebugServer(context.environment.scriptDebugServer())
      , m_vm(context.environment.vm())
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -146,11 +153,11 @@</span>
          else
              callback-&gt;sendSuccess(WTFMove(result), wasThrown, savedResultIndex);
      });
  }
  
<span class="udiff-line-modified-removed">- void InspectorRuntimeAgent::callFunctionOn(ErrorString&amp; errorString, const String&amp; objectId, const String&amp; expression, const JSON::Array* optionalArguments, const bool* doNotPauseOnExceptionsAndMuteConsole, const bool* returnByValue, const bool* generatePreview, RefPtr&lt;Protocol::Runtime::RemoteObject&gt;&amp; result, Optional&lt;bool&gt;&amp; wasThrown)</span>
<span class="udiff-line-modified-added">+ void InspectorRuntimeAgent::callFunctionOn(ErrorString&amp; errorString, const String&amp; objectId, const String&amp; expression, const JSON::Array* optionalArguments, const bool* doNotPauseOnExceptionsAndMuteConsole, const bool* returnByValue, const bool* generatePreview, const bool* /* emulateUserGesture */, RefPtr&lt;Protocol::Runtime::RemoteObject&gt;&amp; result, Optional&lt;bool&gt;&amp; wasThrown)</span>
  {
      InjectedScript injectedScript = m_injectedScriptManager.injectedScriptForObjectId(objectId);
      if (injectedScript.hasNoValue()) {
          errorString = &quot;Missing injected script for given objectId&quot;_s;
          return;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -189,58 +196,97 @@</span>
  
      unmuteConsole();
      setPauseOnExceptionsState(m_scriptDebugServer, previousPauseOnExceptionsState);
  }
  
<span class="udiff-line-modified-removed">- void InspectorRuntimeAgent::getProperties(ErrorString&amp; errorString, const String&amp; objectId, const bool* ownProperties, const bool* generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; result, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::InternalPropertyDescriptor&gt;&gt;&amp; internalProperties)</span>
<span class="udiff-line-modified-added">+ void InspectorRuntimeAgent::getProperties(ErrorString&amp; errorString, const String&amp; objectId, const bool* ownProperties, const int* fetchStart, const int* fetchCount, const bool* generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; properties, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::InternalPropertyDescriptor&gt;&gt;&amp; internalProperties)</span>
  {
      InjectedScript injectedScript = m_injectedScriptManager.injectedScriptForObjectId(objectId);
      if (injectedScript.hasNoValue()) {
          errorString = &quot;Missing injected script for given objectId&quot;_s;
          return;
      }
  
<span class="udiff-line-added">+     int start = asInt(fetchStart);</span>
<span class="udiff-line-added">+     if (start &lt; 0) {</span>
<span class="udiff-line-added">+         errorString = &quot;fetchStart cannot be negative&quot;_s;</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     int count = asInt(fetchCount);</span>
<span class="udiff-line-added">+     if (count &lt; 0) {</span>
<span class="udiff-line-added">+         errorString = &quot;fetchCount cannot be negative&quot;_s;</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      ScriptDebugServer::PauseOnExceptionsState previousPauseOnExceptionsState = setPauseOnExceptionsState(m_scriptDebugServer, ScriptDebugServer::DontPauseOnExceptions);
      muteConsole();
  
<span class="udiff-line-modified-removed">-     injectedScript.getProperties(errorString, objectId, asBool(ownProperties), asBool(generatePreview), result);</span>
<span class="udiff-line-modified-removed">-     injectedScript.getInternalProperties(errorString, objectId, asBool(generatePreview), internalProperties);</span>
<span class="udiff-line-modified-added">+     injectedScript.getProperties(errorString, objectId, asBool(ownProperties), start, count, asBool(generatePreview), properties);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     // Only include internal properties for the first fetch.</span>
<span class="udiff-line-added">+     if (!start)</span>
<span class="udiff-line-added">+         injectedScript.getInternalProperties(errorString, objectId, asBool(generatePreview), internalProperties);</span>
  
      unmuteConsole();
      setPauseOnExceptionsState(m_scriptDebugServer, previousPauseOnExceptionsState);
  }
  
<span class="udiff-line-modified-removed">- void InspectorRuntimeAgent::getDisplayableProperties(ErrorString&amp; errorString, const String&amp; objectId, const bool* generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; result, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::InternalPropertyDescriptor&gt;&gt;&amp; internalProperties)</span>
<span class="udiff-line-modified-added">+ void InspectorRuntimeAgent::getDisplayableProperties(ErrorString&amp; errorString, const String&amp; objectId, const int* fetchStart, const int* fetchCount, const bool* generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; properties, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::InternalPropertyDescriptor&gt;&gt;&amp; internalProperties)</span>
  {
      InjectedScript injectedScript = m_injectedScriptManager.injectedScriptForObjectId(objectId);
      if (injectedScript.hasNoValue()) {
          errorString = &quot;Missing injected script for given objectId&quot;_s;
          return;
      }
  
<span class="udiff-line-added">+     int start = asInt(fetchStart);</span>
<span class="udiff-line-added">+     if (start &lt; 0) {</span>
<span class="udiff-line-added">+         errorString = &quot;fetchStart cannot be negative&quot;_s;</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     int count = asInt(fetchCount);</span>
<span class="udiff-line-added">+     if (count &lt; 0) {</span>
<span class="udiff-line-added">+         errorString = &quot;fetchCount cannot be negative&quot;_s;</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      ScriptDebugServer::PauseOnExceptionsState previousPauseOnExceptionsState = setPauseOnExceptionsState(m_scriptDebugServer, ScriptDebugServer::DontPauseOnExceptions);
      muteConsole();
  
<span class="udiff-line-modified-removed">-     injectedScript.getDisplayableProperties(errorString, objectId, asBool(generatePreview), result);</span>
<span class="udiff-line-modified-removed">-     injectedScript.getInternalProperties(errorString, objectId, asBool(generatePreview), internalProperties);</span>
<span class="udiff-line-modified-added">+     injectedScript.getDisplayableProperties(errorString, objectId, start, count, asBool(generatePreview), properties);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     // Only include internal properties for the first fetch.</span>
<span class="udiff-line-added">+     if (!start)</span>
<span class="udiff-line-added">+         injectedScript.getInternalProperties(errorString, objectId, asBool(generatePreview), internalProperties);</span>
  
      unmuteConsole();
      setPauseOnExceptionsState(m_scriptDebugServer, previousPauseOnExceptionsState);
  }
  
<span class="udiff-line-modified-removed">- void InspectorRuntimeAgent::getCollectionEntries(ErrorString&amp; errorString, const String&amp; objectId, const String* objectGroup, const int* startIndex, const int* numberToFetch, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::CollectionEntry&gt;&gt;&amp; entries)</span>
<span class="udiff-line-modified-added">+ void InspectorRuntimeAgent::getCollectionEntries(ErrorString&amp; errorString, const String&amp; objectId, const String* objectGroup, const int* fetchStart, const int* fetchCount, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::CollectionEntry&gt;&gt;&amp; entries)</span>
  {
      InjectedScript injectedScript = m_injectedScriptManager.injectedScriptForObjectId(objectId);
      if (injectedScript.hasNoValue()) {
          errorString = &quot;Missing injected script for given objectId&quot;_s;
          return;
      }
  
<span class="udiff-line-modified-removed">-     int start = startIndex &amp;&amp; *startIndex &gt;= 0 ? *startIndex : 0;</span>
<span class="udiff-line-modified-removed">-     int fetch = numberToFetch &amp;&amp; *numberToFetch &gt;= 0 ? *numberToFetch : 0;</span>
<span class="udiff-line-modified-added">+     int start = asInt(fetchStart);</span>
<span class="udiff-line-modified-added">+     if (start &lt; 0) {</span>
<span class="udiff-line-added">+         errorString = &quot;fetchStart cannot be negative&quot;_s;</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     int count = asInt(fetchCount);</span>
<span class="udiff-line-added">+     if (count &lt; 0) {</span>
<span class="udiff-line-added">+         errorString = &quot;fetchCount cannot be negative&quot;_s;</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">-     injectedScript.getCollectionEntries(errorString, objectId, objectGroup ? *objectGroup : String(), start, fetch, entries);</span>
<span class="udiff-line-modified-added">+     injectedScript.getCollectionEntries(errorString, objectId, objectGroup ? *objectGroup : String(), start, count, entries);</span>
  }
  
  void InspectorRuntimeAgent::saveResult(ErrorString&amp; errorString, const JSON::Object&amp; callArgument, const int* executionContextId, Optional&lt;int&gt;&amp; savedResultIndex)
  {
      InjectedScript injectedScript;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -281,11 +327,11 @@</span>
      m_injectedScriptManager.releaseObjectGroup(objectGroup);
  }
  
  void InspectorRuntimeAgent::getRuntimeTypesForVariablesAtOffsets(ErrorString&amp; errorString, const JSON::Array&amp; locations, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::TypeDescription&gt;&gt;&amp; typeDescriptions)
  {
<span class="udiff-line-modified-removed">-     static const bool verbose = false;</span>
<span class="udiff-line-modified-added">+     static constexpr bool verbose = false;</span>
  
      typeDescriptions = JSON::ArrayOf&lt;Protocol::Runtime::TypeDescription&gt;::create();
      if (!m_vm.typeProfiler()) {
          errorString = &quot;VM has no type information&quot;_s;
          return;
</pre>
<center><a href="InspectorHeapAgent.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="InspectorRuntimeAgent.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>