<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/html/track/TrackListBase.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TrackEvent.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="TrackListBase.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/html/track/TrackListBase.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 37,17 ***</span>
  
  namespace WebCore {
  
  WTF_MAKE_ISO_ALLOCATED_IMPL(TrackListBase);
  
<span class="line-modified">! TrackListBase::TrackListBase(HTMLMediaElement* element, ScriptExecutionContext* context)</span>
<span class="line-modified">!     : ActiveDOMObject(context)</span>
      , m_element(element)
<span class="line-modified">!     , m_asyncEventQueue(*this)</span>
  {
      ASSERT(!context || is&lt;Document&gt;(context));
<span class="line-removed">-     suspendIfNeeded();</span>
  }
  
  TrackListBase::~TrackListBase()
  {
      clearElement();
<span class="line-new-header">--- 37,16 ---</span>
  
  namespace WebCore {
  
  WTF_MAKE_ISO_ALLOCATED_IMPL(TrackListBase);
  
<span class="line-modified">! TrackListBase::TrackListBase(WeakPtr&lt;HTMLMediaElement&gt; element, ScriptExecutionContext* context)</span>
<span class="line-modified">!     : ContextDestructionObserver(context)</span>
      , m_element(element)
<span class="line-modified">!     , m_asyncEventQueue(MainThreadGenericEventQueue::create(*this))</span>
  {
      ASSERT(!context || is&lt;Document&gt;(context));
  }
  
  TrackListBase::~TrackListBase()
  {
      clearElement();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 62,11 ***</span>
      }
  }
  
  Element* TrackListBase::element() const
  {
<span class="line-modified">!     return m_element;</span>
  }
  
  unsigned TrackListBase::length() const
  {
      return m_inbandTracks.size();
<span class="line-new-header">--- 61,11 ---</span>
      }
  }
  
  Element* TrackListBase::element() const
  {
<span class="line-modified">!     return m_element.get();</span>
  }
  
  unsigned TrackListBase::length() const
  {
      return m_inbandTracks.size();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 96,11 ***</span>
      return m_inbandTracks.find(&amp;track) != notFound;
  }
  
  void TrackListBase::scheduleTrackEvent(const AtomString&amp; eventName, Ref&lt;TrackBase&gt;&amp;&amp; track)
  {
<span class="line-modified">!     m_asyncEventQueue.enqueueEvent(TrackEvent::create(eventName, Event::CanBubble::No, Event::IsCancelable::No, WTFMove(track)));</span>
  }
  
  void TrackListBase::scheduleAddTrackEvent(Ref&lt;TrackBase&gt;&amp;&amp; track)
  {
      // 4.8.10.5 Loading the media resource
<span class="line-new-header">--- 95,11 ---</span>
      return m_inbandTracks.find(&amp;track) != notFound;
  }
  
  void TrackListBase::scheduleTrackEvent(const AtomString&amp; eventName, Ref&lt;TrackBase&gt;&amp;&amp; track)
  {
<span class="line-modified">!     m_asyncEventQueue-&gt;enqueueEvent(TrackEvent::create(eventName, Event::CanBubble::No, Event::IsCancelable::No, WTFMove(track)));</span>
  }
  
  void TrackListBase::scheduleAddTrackEvent(Ref&lt;TrackBase&gt;&amp;&amp; track)
  {
      // 4.8.10.5 Loading the media resource
</pre>
<hr />
<pre>
<span class="line-old-header">*** 159,16 ***</span>
      // AudioTrackList object.
      // ...
      // Whenever a track in a VideoTrackList that was previously not selected is
      // selected, the user agent must queue a task to fire a simple event named
      // change at the VideoTrackList object.
<span class="line-modified">!     m_asyncEventQueue.enqueueEvent(Event::create(eventNames().changeEvent, Event::CanBubble::No, Event::IsCancelable::No));</span>
  }
  
  bool TrackListBase::isChangeEventScheduled() const
  {
<span class="line-modified">!     return m_asyncEventQueue.hasPendingEventsOfType(eventNames().changeEvent);</span>
  }
  
  bool TrackListBase::isAnyTrackEnabled() const
  {
      for (auto&amp; track : m_inbandTracks) {
<span class="line-new-header">--- 158,16 ---</span>
      // AudioTrackList object.
      // ...
      // Whenever a track in a VideoTrackList that was previously not selected is
      // selected, the user agent must queue a task to fire a simple event named
      // change at the VideoTrackList object.
<span class="line-modified">!     m_asyncEventQueue-&gt;enqueueEvent(Event::create(eventNames().changeEvent, Event::CanBubble::No, Event::IsCancelable::No));</span>
  }
  
  bool TrackListBase::isChangeEventScheduled() const
  {
<span class="line-modified">!     return m_asyncEventQueue-&gt;hasPendingEventsOfType(eventNames().changeEvent);</span>
  }
  
  bool TrackListBase::isAnyTrackEnabled() const
  {
      for (auto&amp; track : m_inbandTracks) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 176,37 ***</span>
              return true;
      }
      return false;
  }
  
<span class="line-removed">- bool TrackListBase::canSuspendForDocumentSuspension() const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     return !m_asyncEventQueue.hasPendingEvents();</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- void TrackListBase::suspend(ReasonForSuspension reason)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     switch (reason) {</span>
<span class="line-removed">-     case ReasonForSuspension::PageCache:</span>
<span class="line-removed">-     case ReasonForSuspension::PageWillBeSuspended:</span>
<span class="line-removed">-         m_asyncEventQueue.suspend();</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case ReasonForSuspension::JavaScriptDebuggerPaused:</span>
<span class="line-removed">-     case ReasonForSuspension::WillDeferLoading:</span>
<span class="line-removed">-         // Do nothing, we don&#39;t pause media playback in these cases.</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- void TrackListBase::resume()</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     m_asyncEventQueue.resume();</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- void TrackListBase::stop()</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     m_asyncEventQueue.close();</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  } // namespace WebCore
  
  #endif
<span class="line-new-header">--- 175,8 ---</span>
</pre>
<center><a href="TrackEvent.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="TrackListBase.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>