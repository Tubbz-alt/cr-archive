<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/bindings/js/WindowProxy.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  *  Copyright (C) 1999-2001 Harri Porten (porten@kde.org)
  3  *  Copyright (C) 2001 Peter Kelly (pmk@post.com)
  4  *  Copyright (C) 2006-2018 Apple Inc. All rights reserved.
  5  *
  6  *  This library is free software; you can redistribute it and/or
  7  *  modify it under the terms of the GNU Lesser General Public
  8  *  License as published by the Free Software Foundation; either
  9  *  version 2 of the License, or (at your option) any later version.
 10  *
 11  *  This library is distributed in the hope that it will be useful,
 12  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 13  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 14  *  Lesser General Public License for more details.
 15  *
 16  *  You should have received a copy of the GNU Lesser General Public
 17  *  License along with this library; if not, write to the Free Software
 18  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 19  */
 20 
 21 #pragma once
 22 
<a name="1" id="anc1"></a>
 23 #include &lt;JavaScriptCore/Strong.h&gt;
 24 #include &lt;wtf/HashMap.h&gt;
 25 #include &lt;wtf/RefCounted.h&gt;
<a name="2" id="anc2"></a><span class="line-added"> 26 #include &lt;wtf/UniqueRef.h&gt;</span>
 27 
 28 namespace JSC {
 29 class Debugger;
 30 }
 31 
 32 namespace WebCore {
 33 
 34 class AbstractDOMWindow;
 35 class AbstractFrame;
<a name="3" id="anc3"></a><span class="line-added"> 36 class DOMWrapperWorld;</span>
 37 class JSDOMGlobalObject;
 38 class JSWindowProxy;
 39 
 40 class WindowProxy : public RefCounted&lt;WindowProxy&gt; {
 41     WTF_MAKE_FAST_ALLOCATED;
 42 public:
 43     using ProxyMap = HashMap&lt;RefPtr&lt;DOMWrapperWorld&gt;, JSC::Strong&lt;JSWindowProxy&gt;&gt;;
 44 
 45     static Ref&lt;WindowProxy&gt; create(AbstractFrame&amp; frame)
 46     {
 47         return adoptRef(*new WindowProxy(frame));
 48     }
 49 
 50     WEBCORE_EXPORT ~WindowProxy();
 51 
 52     AbstractFrame* frame() const { return m_frame; }
 53     void detachFromFrame();
 54 
 55     void destroyJSWindowProxy(DOMWrapperWorld&amp;);
 56 
<a name="4" id="anc4"></a><span class="line-modified"> 57     ProxyMap::ValuesConstIteratorRange jsWindowProxies() const;</span>
 58     Vector&lt;JSC::Strong&lt;JSWindowProxy&gt;&gt; jsWindowProxiesAsVector() const;
 59 
<a name="5" id="anc5"></a><span class="line-modified"> 60     WEBCORE_EXPORT ProxyMap releaseJSWindowProxies();</span>
<span class="line-modified"> 61     WEBCORE_EXPORT void setJSWindowProxies(ProxyMap&amp;&amp;);</span>
 62 
 63     JSWindowProxy* jsWindowProxy(DOMWrapperWorld&amp; world)
 64     {
 65         if (!m_frame)
 66             return nullptr;
 67 
 68         if (auto* existingProxy = existingJSWindowProxy(world))
 69             return existingProxy;
 70 
 71         return &amp;createJSWindowProxyWithInitializedScript(world);
 72     }
 73 
 74     JSWindowProxy* existingJSWindowProxy(DOMWrapperWorld&amp; world) const
 75     {
<a name="6" id="anc6"></a><span class="line-modified"> 76         auto it = m_jsWindowProxies-&gt;find(&amp;world);</span>
<span class="line-modified"> 77         return (it != m_jsWindowProxies-&gt;end()) ? it-&gt;value.get() : nullptr;</span>
 78     }
 79 
 80     WEBCORE_EXPORT JSDOMGlobalObject* globalObject(DOMWrapperWorld&amp;);
 81 
<a name="7" id="anc7"></a><span class="line-modified"> 82     void clearJSWindowProxiesNotMatchingDOMWindow(AbstractDOMWindow*, bool goingIntoBackForwardCache);</span>
 83 
 84     WEBCORE_EXPORT void setDOMWindow(AbstractDOMWindow*);
 85 
 86     // Debugger can be nullptr to detach any existing Debugger.
 87     void attachDebugger(JSC::Debugger*); // Attaches/detaches in all worlds/window proxies.
 88 
 89     WEBCORE_EXPORT AbstractDOMWindow* window() const;
 90 
 91 private:
 92     explicit WindowProxy(AbstractFrame&amp;);
 93 
 94     JSWindowProxy&amp; createJSWindowProxy(DOMWrapperWorld&amp;);
 95     WEBCORE_EXPORT JSWindowProxy&amp; createJSWindowProxyWithInitializedScript(DOMWrapperWorld&amp;);
 96 
 97     AbstractFrame* m_frame;
<a name="8" id="anc8"></a><span class="line-modified"> 98     UniqueRef&lt;ProxyMap&gt; m_jsWindowProxies;</span>
 99 };
100 
101 } // namespace WebCore
<a name="9" id="anc9"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="9" type="hidden" />
</body>
</html>