<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/Modules/indexeddb/server/SQLiteIDBBackingStore.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SQLiteIDBBackingStore.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SQLiteIDBCursor.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/indexeddb/server/SQLiteIDBBackingStore.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #if ENABLE(INDEXED_DATABASE)
 29 
 30 #include &quot;IDBBackingStore.h&quot;
 31 #include &quot;IDBDatabaseIdentifier.h&quot;
 32 #include &quot;IDBDatabaseInfo.h&quot;
 33 #include &quot;IDBResourceIdentifier.h&quot;
 34 #include &quot;SQLiteIDBTransaction.h&quot;
 35 #include &lt;JavaScriptCore/Strong.h&gt;

 36 #include &lt;wtf/HashMap.h&gt;
 37 
 38 namespace WebCore {
 39 
 40 class IndexKey;
 41 class SQLiteDatabase;
 42 class SQLiteStatement;
 43 
 44 namespace IDBServer {
 45 


 46 class IDBSerializationContext;
 47 class SQLiteIDBCursor;
 48 
 49 class SQLiteIDBBackingStore : public IDBBackingStore {
 50     WTF_MAKE_FAST_ALLOCATED;
 51 public:
<span class="line-modified"> 52     SQLiteIDBBackingStore(PAL::SessionID, const IDBDatabaseIdentifier&amp;, const String&amp; databaseRootDirectory, IDBBackingStoreTemporaryFileHandler&amp;);</span>
 53 
 54     ~SQLiteIDBBackingStore() final;
 55 
 56     IDBError getOrEstablishDatabaseInfo(IDBDatabaseInfo&amp;) final;
 57 
 58     IDBError beginTransaction(const IDBTransactionInfo&amp;) final;
 59     IDBError abortTransaction(const IDBResourceIdentifier&amp; transactionIdentifier) final;
 60     IDBError commitTransaction(const IDBResourceIdentifier&amp; transactionIdentifier) final;
 61     IDBError createObjectStore(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBObjectStoreInfo&amp;) final;
 62     IDBError deleteObjectStore(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier) final;
 63     IDBError renameObjectStore(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, const String&amp; newName) final;
 64     IDBError clearObjectStore(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier) final;
 65     IDBError createIndex(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBIndexInfo&amp;) final;
 66     IDBError deleteIndex(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t indexIdentifier) final;
 67     IDBError renameIndex(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t indexIdentifier, const String&amp; newName) final;
 68     IDBError keyExistsInObjectStore(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, const IDBKeyData&amp;, bool&amp; keyExists) final;
 69     IDBError deleteRange(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, const IDBKeyRangeData&amp;) final;
 70     IDBError addRecord(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBObjectStoreInfo&amp;, const IDBKeyData&amp;, const IDBValue&amp;) final;
 71     IDBError getRecord(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, const IDBKeyRangeData&amp;, IDBGetRecordDataType, IDBGetResult&amp; outValue) final;
 72     IDBError getAllRecords(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBGetAllRecordsData&amp;, IDBGetAllResult&amp; outValue) final;
 73     IDBError getIndexRecord(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t indexIdentifier, IndexedDB::IndexRecordType, const IDBKeyRangeData&amp;, IDBGetResult&amp; outValue) final;
 74     IDBError getCount(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t indexIdentifier, const IDBKeyRangeData&amp;, uint64_t&amp; outCount) final;
 75     IDBError generateKeyNumber(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t&amp; keyNumber) final;
 76     IDBError revertGeneratedKeyNumber(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t keyNumber) final;
 77     IDBError maybeUpdateKeyGeneratorNumber(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, double newKeyNumber) final;
 78     IDBError openCursor(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBCursorInfo&amp;, IDBGetResult&amp; outResult) final;
 79     IDBError iterateCursor(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBResourceIdentifier&amp; cursorIdentifier, const IDBIterateCursorData&amp;, IDBGetResult&amp; outResult) final;
<span class="line-removed"> 80     bool prefetchCursor(const IDBResourceIdentifier&amp;, const IDBResourceIdentifier&amp;) final;</span>
 81 
 82     IDBObjectStoreInfo* infoForObjectStore(uint64_t objectStoreIdentifier) final;
 83     void deleteBackingStore() final;
 84 
 85     bool supportsSimultaneousTransactions() final { return false; }
 86     bool isEphemeral() final { return false; }
 87 
<span class="line-modified"> 88     void unregisterCursor(SQLiteIDBCursor&amp;);</span>
 89 
<span class="line-modified"> 90     IDBBackingStoreTemporaryFileHandler&amp; temporaryFileHandler() const { return m_temporaryFileHandler; }</span>
 91 
 92     IDBError getBlobRecordsForObjectStoreRecord(int64_t objectStoreRecord, Vector&lt;String&gt;&amp; blobURLs, Vector&lt;String&gt;&amp; blobFilePaths);
 93 
 94     static String databaseNameFromEncodedFilename(const String&amp;);
 95     static uint64_t databasesSizeForDirectory(const String&amp; directory);
 96 
 97     String databaseDirectory() const { return m_databaseDirectory; };
 98     static String fullDatabasePathForDirectory(const String&amp;);
 99     static String databaseNameFromFile(const String&amp;);
100 
<span class="line-removed">101     bool hasTransaction(const IDBResourceIdentifier&amp;) const final;</span>
<span class="line-removed">102 </span>
103     PAL::SessionID sessionID() const { return m_sessionID; }
104 
105 private:
106     String filenameForDatabaseName() const;
107     String fullDatabasePath() const;
108     String fullDatabaseDirectoryWithUpgrade();
109 
110     String databaseRootDirectoryIsolatedCopy() const { return m_databaseRootDirectory.isolatedCopy(); }
111 
112     bool ensureValidRecordsTable();
113     bool ensureValidIndexRecordsTable();
114     bool ensureValidIndexRecordsIndex();

115     bool ensureValidBlobTables();

116     std::unique_ptr&lt;IDBDatabaseInfo&gt; createAndPopulateInitialDatabaseInfo();
117     std::unique_ptr&lt;IDBDatabaseInfo&gt; extractExistingDatabaseInfo();
118 
119     IDBError deleteRecord(SQLiteIDBTransaction&amp;, int64_t objectStoreID, const IDBKeyData&amp;);
120     IDBError uncheckedGetKeyGeneratorValue(int64_t objectStoreID, uint64_t&amp; outValue);
121     IDBError uncheckedSetKeyGeneratorValue(int64_t objectStoreID, uint64_t value);
122 
123     IDBError updateAllIndexesForAddRecord(const IDBObjectStoreInfo&amp;, const IDBKeyData&amp;, const ThreadSafeDataBuffer&amp; value, int64_t recordID);
124     IDBError updateOneIndexForAddRecord(const IDBIndexInfo&amp;, const IDBKeyData&amp;, const ThreadSafeDataBuffer&amp; value, int64_t recordID);
125     IDBError uncheckedPutIndexKey(const IDBIndexInfo&amp;, const IDBKeyData&amp; keyValue, const IndexKey&amp;, int64_t recordID);
126     IDBError uncheckedPutIndexRecord(int64_t objectStoreID, int64_t indexID, const IDBKeyData&amp; keyValue, const IDBKeyData&amp; indexKey, int64_t recordID);
127     IDBError uncheckedHasIndexRecord(const IDBIndexInfo&amp;, const IDBKeyData&amp;, bool&amp; hasRecord);
128     IDBError uncheckedGetIndexRecordForOneKey(int64_t indexeID, int64_t objectStoreID, IndexedDB::IndexRecordType, const IDBKeyData&amp;, IDBGetResult&amp;);
129 
130     IDBError deleteUnusedBlobFileRecords(SQLiteIDBTransaction&amp;);
131 
132     IDBError getAllObjectStoreRecords(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBGetAllRecordsData&amp;, IDBGetAllResult&amp; outValue);
133     IDBError getAllIndexRecords(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBGetAllRecordsData&amp;, IDBGetAllResult&amp; outValue);
134 
135     void closeSQLiteDB();
136     void close() final;
137 
<span class="line-removed">138     uint64_t databaseSize() const final;</span>
<span class="line-removed">139 </span>
140     enum class SQL : size_t {
141         CreateObjectStoreInfo,
142         CreateObjectStoreKeyGenerator,
143         DeleteObjectStoreInfo,
144         DeleteObjectStoreKeyGenerator,
145         DeleteObjectStoreRecords,
146         DeleteObjectStoreIndexInfo,
147         DeleteObjectStoreIndexRecords,
148         DeleteObjectStoreBlobRecords,
149         RenameObjectStore,
150         ClearObjectStoreRecords,
151         ClearObjectStoreIndexRecords,
152         CreateIndexInfo,
153         DeleteIndexInfo,
154         HasIndexRecord,
155         PutIndexRecord,
156         GetIndexRecordForOneKey,
157         DeleteIndexRecords,
158         RenameIndex,
159         KeyExistsInObjectStore,
160         GetUnusedBlobFilenames,
161         DeleteUnusedBlobs,
<span class="line-modified">162         GetObjectStoreRecordID,</span>
163         DeleteBlobRecord,
164         DeleteObjectStoreRecord,
165         DeleteObjectStoreIndexRecord,
166         AddObjectStoreRecord,
167         AddBlobRecord,
168         BlobFilenameForBlobURL,
169         AddBlobFilename,
170         GetBlobURL,
171         GetKeyGeneratorValue,
172         SetKeyGeneratorValue,
173         GetAllKeyRecordsLowerOpenUpperOpen,
174         GetAllKeyRecordsLowerOpenUpperClosed,
175         GetAllKeyRecordsLowerClosedUpperOpen,
176         GetAllKeyRecordsLowerClosedUpperClosed,
177         GetValueRecordsLowerOpenUpperOpen,
178         GetValueRecordsLowerOpenUpperClosed,
179         GetValueRecordsLowerClosedUpperOpen,
180         GetValueRecordsLowerClosedUpperClosed,
181         GetKeyRecordsLowerOpenUpperOpen,
182         GetKeyRecordsLowerOpenUpperClosed,
183         GetKeyRecordsLowerClosedUpperOpen,
184         GetKeyRecordsLowerClosedUpperClosed,
<span class="line-modified">185         Count</span>








186     };
187 
188     SQLiteStatement* cachedStatement(SQL, const char*);
189     SQLiteStatement* cachedStatementForGetAllObjectStoreRecords(const IDBGetAllRecordsData&amp;);
190 
<span class="line-modified">191     std::unique_ptr&lt;SQLiteStatement&gt; m_cachedStatements[static_cast&lt;int&gt;(SQL::Count)];</span>
192 
193     PAL::SessionID m_sessionID;
194     IDBDatabaseIdentifier m_identifier;
195     std::unique_ptr&lt;IDBDatabaseInfo&gt; m_databaseInfo;
196     std::unique_ptr&lt;IDBDatabaseInfo&gt; m_originalDatabaseInfoBeforeVersionChange;
197 
198     std::unique_ptr&lt;SQLiteDatabase&gt; m_sqliteDB;
199 
200     HashMap&lt;IDBResourceIdentifier, std::unique_ptr&lt;SQLiteIDBTransaction&gt;&gt; m_transactions;
201     HashMap&lt;IDBResourceIdentifier, SQLiteIDBCursor*&gt; m_cursors;
202 
203     String m_databaseRootDirectory;
204     String m_databaseDirectory;
205 
<span class="line-removed">206     IDBBackingStoreTemporaryFileHandler&amp; m_temporaryFileHandler;</span>
<span class="line-removed">207 </span>
208     Ref&lt;IDBSerializationContext&gt; m_serializationContext;
209 };
210 
211 } // namespace IDBServer
212 } // namespace WebCore
213 
214 #endif // ENABLE(INDEXED_DATABASE)
</pre>
</td>
<td>
<hr />
<pre>
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #if ENABLE(INDEXED_DATABASE)
 29 
 30 #include &quot;IDBBackingStore.h&quot;
 31 #include &quot;IDBDatabaseIdentifier.h&quot;
 32 #include &quot;IDBDatabaseInfo.h&quot;
 33 #include &quot;IDBResourceIdentifier.h&quot;
 34 #include &quot;SQLiteIDBTransaction.h&quot;
 35 #include &lt;JavaScriptCore/Strong.h&gt;
<span class="line-added"> 36 #include &lt;pal/SessionID.h&gt;</span>
 37 #include &lt;wtf/HashMap.h&gt;
 38 
 39 namespace WebCore {
 40 
 41 class IndexKey;
 42 class SQLiteDatabase;
 43 class SQLiteStatement;
 44 
 45 namespace IDBServer {
 46 
<span class="line-added"> 47 enum class IsSchemaUpgraded : bool { No, Yes };</span>
<span class="line-added"> 48 </span>
 49 class IDBSerializationContext;
 50 class SQLiteIDBCursor;
 51 
 52 class SQLiteIDBBackingStore : public IDBBackingStore {
 53     WTF_MAKE_FAST_ALLOCATED;
 54 public:
<span class="line-modified"> 55     SQLiteIDBBackingStore(PAL::SessionID, const IDBDatabaseIdentifier&amp;, const String&amp; databaseRootDirectory);</span>
 56 
 57     ~SQLiteIDBBackingStore() final;
 58 
 59     IDBError getOrEstablishDatabaseInfo(IDBDatabaseInfo&amp;) final;
 60 
 61     IDBError beginTransaction(const IDBTransactionInfo&amp;) final;
 62     IDBError abortTransaction(const IDBResourceIdentifier&amp; transactionIdentifier) final;
 63     IDBError commitTransaction(const IDBResourceIdentifier&amp; transactionIdentifier) final;
 64     IDBError createObjectStore(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBObjectStoreInfo&amp;) final;
 65     IDBError deleteObjectStore(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier) final;
 66     IDBError renameObjectStore(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, const String&amp; newName) final;
 67     IDBError clearObjectStore(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier) final;
 68     IDBError createIndex(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBIndexInfo&amp;) final;
 69     IDBError deleteIndex(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t indexIdentifier) final;
 70     IDBError renameIndex(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t indexIdentifier, const String&amp; newName) final;
 71     IDBError keyExistsInObjectStore(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, const IDBKeyData&amp;, bool&amp; keyExists) final;
 72     IDBError deleteRange(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, const IDBKeyRangeData&amp;) final;
 73     IDBError addRecord(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBObjectStoreInfo&amp;, const IDBKeyData&amp;, const IDBValue&amp;) final;
 74     IDBError getRecord(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, const IDBKeyRangeData&amp;, IDBGetRecordDataType, IDBGetResult&amp; outValue) final;
 75     IDBError getAllRecords(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBGetAllRecordsData&amp;, IDBGetAllResult&amp; outValue) final;
 76     IDBError getIndexRecord(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t indexIdentifier, IndexedDB::IndexRecordType, const IDBKeyRangeData&amp;, IDBGetResult&amp; outValue) final;
 77     IDBError getCount(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t indexIdentifier, const IDBKeyRangeData&amp;, uint64_t&amp; outCount) final;
 78     IDBError generateKeyNumber(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t&amp; keyNumber) final;
 79     IDBError revertGeneratedKeyNumber(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, uint64_t keyNumber) final;
 80     IDBError maybeUpdateKeyGeneratorNumber(const IDBResourceIdentifier&amp; transactionIdentifier, uint64_t objectStoreIdentifier, double newKeyNumber) final;
 81     IDBError openCursor(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBCursorInfo&amp;, IDBGetResult&amp; outResult) final;
 82     IDBError iterateCursor(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBResourceIdentifier&amp; cursorIdentifier, const IDBIterateCursorData&amp;, IDBGetResult&amp; outResult) final;

 83 
 84     IDBObjectStoreInfo* infoForObjectStore(uint64_t objectStoreIdentifier) final;
 85     void deleteBackingStore() final;
 86 
 87     bool supportsSimultaneousTransactions() final { return false; }
 88     bool isEphemeral() final { return false; }
 89 
<span class="line-modified"> 90     bool hasTransaction(const IDBResourceIdentifier&amp;) const final;</span>
 91 
<span class="line-modified"> 92     void unregisterCursor(SQLiteIDBCursor&amp;);</span>
 93 
 94     IDBError getBlobRecordsForObjectStoreRecord(int64_t objectStoreRecord, Vector&lt;String&gt;&amp; blobURLs, Vector&lt;String&gt;&amp; blobFilePaths);
 95 
 96     static String databaseNameFromEncodedFilename(const String&amp;);
 97     static uint64_t databasesSizeForDirectory(const String&amp; directory);
 98 
 99     String databaseDirectory() const { return m_databaseDirectory; };
100     static String fullDatabasePathForDirectory(const String&amp;);
101     static String databaseNameFromFile(const String&amp;);
102 


103     PAL::SessionID sessionID() const { return m_sessionID; }
104 
105 private:
106     String filenameForDatabaseName() const;
107     String fullDatabasePath() const;
108     String fullDatabaseDirectoryWithUpgrade();
109 
110     String databaseRootDirectoryIsolatedCopy() const { return m_databaseRootDirectory.isolatedCopy(); }
111 
112     bool ensureValidRecordsTable();
113     bool ensureValidIndexRecordsTable();
114     bool ensureValidIndexRecordsIndex();
<span class="line-added">115     bool ensureValidIndexRecordsRecordIndex();</span>
116     bool ensureValidBlobTables();
<span class="line-added">117     Optional&lt;IsSchemaUpgraded&gt; ensureValidObjectStoreInfoTable();</span>
118     std::unique_ptr&lt;IDBDatabaseInfo&gt; createAndPopulateInitialDatabaseInfo();
119     std::unique_ptr&lt;IDBDatabaseInfo&gt; extractExistingDatabaseInfo();
120 
121     IDBError deleteRecord(SQLiteIDBTransaction&amp;, int64_t objectStoreID, const IDBKeyData&amp;);
122     IDBError uncheckedGetKeyGeneratorValue(int64_t objectStoreID, uint64_t&amp; outValue);
123     IDBError uncheckedSetKeyGeneratorValue(int64_t objectStoreID, uint64_t value);
124 
125     IDBError updateAllIndexesForAddRecord(const IDBObjectStoreInfo&amp;, const IDBKeyData&amp;, const ThreadSafeDataBuffer&amp; value, int64_t recordID);
126     IDBError updateOneIndexForAddRecord(const IDBIndexInfo&amp;, const IDBKeyData&amp;, const ThreadSafeDataBuffer&amp; value, int64_t recordID);
127     IDBError uncheckedPutIndexKey(const IDBIndexInfo&amp;, const IDBKeyData&amp; keyValue, const IndexKey&amp;, int64_t recordID);
128     IDBError uncheckedPutIndexRecord(int64_t objectStoreID, int64_t indexID, const IDBKeyData&amp; keyValue, const IDBKeyData&amp; indexKey, int64_t recordID);
129     IDBError uncheckedHasIndexRecord(const IDBIndexInfo&amp;, const IDBKeyData&amp;, bool&amp; hasRecord);
130     IDBError uncheckedGetIndexRecordForOneKey(int64_t indexeID, int64_t objectStoreID, IndexedDB::IndexRecordType, const IDBKeyData&amp;, IDBGetResult&amp;);
131 
132     IDBError deleteUnusedBlobFileRecords(SQLiteIDBTransaction&amp;);
133 
134     IDBError getAllObjectStoreRecords(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBGetAllRecordsData&amp;, IDBGetAllResult&amp; outValue);
135     IDBError getAllIndexRecords(const IDBResourceIdentifier&amp; transactionIdentifier, const IDBGetAllRecordsData&amp;, IDBGetAllResult&amp; outValue);
136 
137     void closeSQLiteDB();
138     void close() final;
139 


140     enum class SQL : size_t {
141         CreateObjectStoreInfo,
142         CreateObjectStoreKeyGenerator,
143         DeleteObjectStoreInfo,
144         DeleteObjectStoreKeyGenerator,
145         DeleteObjectStoreRecords,
146         DeleteObjectStoreIndexInfo,
147         DeleteObjectStoreIndexRecords,
148         DeleteObjectStoreBlobRecords,
149         RenameObjectStore,
150         ClearObjectStoreRecords,
151         ClearObjectStoreIndexRecords,
152         CreateIndexInfo,
153         DeleteIndexInfo,
154         HasIndexRecord,
155         PutIndexRecord,
156         GetIndexRecordForOneKey,
157         DeleteIndexRecords,
158         RenameIndex,
159         KeyExistsInObjectStore,
160         GetUnusedBlobFilenames,
161         DeleteUnusedBlobs,
<span class="line-modified">162         GetObjectStoreRecord,</span>
163         DeleteBlobRecord,
164         DeleteObjectStoreRecord,
165         DeleteObjectStoreIndexRecord,
166         AddObjectStoreRecord,
167         AddBlobRecord,
168         BlobFilenameForBlobURL,
169         AddBlobFilename,
170         GetBlobURL,
171         GetKeyGeneratorValue,
172         SetKeyGeneratorValue,
173         GetAllKeyRecordsLowerOpenUpperOpen,
174         GetAllKeyRecordsLowerOpenUpperClosed,
175         GetAllKeyRecordsLowerClosedUpperOpen,
176         GetAllKeyRecordsLowerClosedUpperClosed,
177         GetValueRecordsLowerOpenUpperOpen,
178         GetValueRecordsLowerOpenUpperClosed,
179         GetValueRecordsLowerClosedUpperOpen,
180         GetValueRecordsLowerClosedUpperClosed,
181         GetKeyRecordsLowerOpenUpperOpen,
182         GetKeyRecordsLowerOpenUpperClosed,
183         GetKeyRecordsLowerClosedUpperOpen,
184         GetKeyRecordsLowerClosedUpperClosed,
<span class="line-modified">185         CountRecordsLowerOpenUpperOpen,</span>
<span class="line-added">186         CountRecordsLowerOpenUpperClosed,</span>
<span class="line-added">187         CountRecordsLowerClosedUpperOpen,</span>
<span class="line-added">188         CountRecordsLowerClosedUpperClosed,</span>
<span class="line-added">189         CountIndexRecordsLowerOpenUpperOpen,</span>
<span class="line-added">190         CountIndexRecordsLowerOpenUpperClosed,</span>
<span class="line-added">191         CountIndexRecordsLowerClosedUpperOpen,</span>
<span class="line-added">192         CountIndexRecordsLowerClosedUpperClosed,</span>
<span class="line-added">193         Invalid,</span>
194     };
195 
196     SQLiteStatement* cachedStatement(SQL, const char*);
197     SQLiteStatement* cachedStatementForGetAllObjectStoreRecords(const IDBGetAllRecordsData&amp;);
198 
<span class="line-modified">199     std::unique_ptr&lt;SQLiteStatement&gt; m_cachedStatements[static_cast&lt;int&gt;(SQL::Invalid)];</span>
200 
201     PAL::SessionID m_sessionID;
202     IDBDatabaseIdentifier m_identifier;
203     std::unique_ptr&lt;IDBDatabaseInfo&gt; m_databaseInfo;
204     std::unique_ptr&lt;IDBDatabaseInfo&gt; m_originalDatabaseInfoBeforeVersionChange;
205 
206     std::unique_ptr&lt;SQLiteDatabase&gt; m_sqliteDB;
207 
208     HashMap&lt;IDBResourceIdentifier, std::unique_ptr&lt;SQLiteIDBTransaction&gt;&gt; m_transactions;
209     HashMap&lt;IDBResourceIdentifier, SQLiteIDBCursor*&gt; m_cursors;
210 
211     String m_databaseRootDirectory;
212     String m_databaseDirectory;
213 


214     Ref&lt;IDBSerializationContext&gt; m_serializationContext;
215 };
216 
217 } // namespace IDBServer
218 } // namespace WebCore
219 
220 #endif // ENABLE(INDEXED_DATABASE)
</pre>
</td>
</tr>
</table>
<center><a href="SQLiteIDBBackingStore.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SQLiteIDBCursor.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>