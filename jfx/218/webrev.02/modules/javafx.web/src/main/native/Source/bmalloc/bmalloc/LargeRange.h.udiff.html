<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/bmalloc/bmalloc/LargeRange.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="LargeMap.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="LineMetadata.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/bmalloc/bmalloc/LargeRange.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -35,36 +35,51 @@</span>
  public:
      LargeRange()
          : Range()
          , m_startPhysicalSize(0)
          , m_totalPhysicalSize(0)
<span class="udiff-line-added">+ #if !BUSE(PARTIAL_SCAVENGE)</span>
          , m_isEligible(true)
          , m_usedSinceLastScavenge(false)
<span class="udiff-line-added">+ #endif</span>
      {
      }
  
      LargeRange(const Range&amp; other, size_t startPhysicalSize, size_t totalPhysicalSize)
          : Range(other)
          , m_startPhysicalSize(startPhysicalSize)
          , m_totalPhysicalSize(totalPhysicalSize)
<span class="udiff-line-added">+ #if !BUSE(PARTIAL_SCAVENGE)</span>
          , m_isEligible(true)
          , m_usedSinceLastScavenge(false)
<span class="udiff-line-added">+ #endif</span>
      {
          BASSERT(this-&gt;size() &gt;= this-&gt;totalPhysicalSize());
          BASSERT(this-&gt;totalPhysicalSize() &gt;= this-&gt;startPhysicalSize());
      }
  
<span class="udiff-line-added">+ #if BUSE(PARTIAL_SCAVENGE)</span>
<span class="udiff-line-added">+     LargeRange(void* begin, size_t size, size_t startPhysicalSize, size_t totalPhysicalSize)</span>
<span class="udiff-line-added">+         : Range(begin, size)</span>
<span class="udiff-line-added">+         , m_startPhysicalSize(startPhysicalSize)</span>
<span class="udiff-line-added">+         , m_totalPhysicalSize(totalPhysicalSize)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         BASSERT(this-&gt;size() &gt;= this-&gt;totalPhysicalSize());</span>
<span class="udiff-line-added">+         BASSERT(this-&gt;totalPhysicalSize() &gt;= this-&gt;startPhysicalSize());</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ #else</span>
      LargeRange(void* begin, size_t size, size_t startPhysicalSize, size_t totalPhysicalSize, bool usedSinceLastScavenge = false)
          : Range(begin, size)
          , m_startPhysicalSize(startPhysicalSize)
          , m_totalPhysicalSize(totalPhysicalSize)
          , m_isEligible(true)
          , m_usedSinceLastScavenge(usedSinceLastScavenge)
      {
          BASSERT(this-&gt;size() &gt;= this-&gt;totalPhysicalSize());
          BASSERT(this-&gt;totalPhysicalSize() &gt;= this-&gt;startPhysicalSize());
      }
<span class="udiff-line-added">+ #endif</span>
  
      // Returns a lower bound on physical size at the start of the range. Ranges that
      // span non-physical fragments use this number to remember the physical size of
      // the first fragment.
      size_t startPhysicalSize() const { return m_startPhysicalSize; }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -87,22 +102,28 @@</span>
      std::pair&lt;LargeRange, LargeRange&gt; split(size_t) const;
  
      void setEligible(bool eligible) { m_isEligible = eligible; }
      bool isEligibile() const { return m_isEligible; }
  
<span class="udiff-line-added">+ #if !BUSE(PARTIAL_SCAVENGE)</span>
      bool usedSinceLastScavenge() const { return m_usedSinceLastScavenge; }
      void clearUsedSinceLastScavenge() { m_usedSinceLastScavenge = false; }
      void setUsedSinceLastScavenge() { m_usedSinceLastScavenge = true; }
<span class="udiff-line-added">+ #endif</span>
  
      bool operator&lt;(const void* other) const { return begin() &lt; other; }
      bool operator&lt;(const LargeRange&amp; other) const { return begin() &lt; other.begin(); }
  
  private:
      size_t m_startPhysicalSize;
      size_t m_totalPhysicalSize;
<span class="udiff-line-added">+ #if BUSE(PARTIAL_SCAVENGE)</span>
<span class="udiff-line-added">+     bool m_isEligible { true };</span>
<span class="udiff-line-added">+ #else</span>
      unsigned m_isEligible: 1;
      unsigned m_usedSinceLastScavenge: 1;
<span class="udiff-line-added">+ #endif</span>
  };
  
  inline bool canMerge(const LargeRange&amp; a, const LargeRange&amp; b)
  {
      if (!a.isEligibile() || !b.isEligibile()) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -121,26 +142,35 @@</span>
  }
  
  inline LargeRange merge(const LargeRange&amp; a, const LargeRange&amp; b)
  {
      const LargeRange&amp; left = std::min(a, b);
<span class="udiff-line-added">+ #if !BUSE(PARTIAL_SCAVENGE)</span>
      bool mergedUsedSinceLastScavenge = a.usedSinceLastScavenge() || b.usedSinceLastScavenge();
<span class="udiff-line-added">+ #endif</span>
      if (left.size() == left.startPhysicalSize()) {
          return LargeRange(
              left.begin(),
              a.size() + b.size(),
              a.startPhysicalSize() + b.startPhysicalSize(),
<span class="udiff-line-modified-removed">-             a.totalPhysicalSize() + b.totalPhysicalSize(),</span>
<span class="udiff-line-modified-removed">-             mergedUsedSinceLastScavenge);</span>
<span class="udiff-line-modified-added">+             a.totalPhysicalSize() + b.totalPhysicalSize()</span>
<span class="udiff-line-modified-added">+ #if !BUSE(PARTIAL_SCAVENGE)</span>
<span class="udiff-line-added">+             , mergedUsedSinceLastScavenge</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+         );</span>
<span class="udiff-line-added">+ </span>
      }
  
      return LargeRange(
          left.begin(),
          a.size() + b.size(),
          left.startPhysicalSize(),
<span class="udiff-line-modified-removed">-         a.totalPhysicalSize() + b.totalPhysicalSize(),</span>
<span class="udiff-line-modified-removed">-         mergedUsedSinceLastScavenge);</span>
<span class="udiff-line-modified-added">+         a.totalPhysicalSize() + b.totalPhysicalSize()</span>
<span class="udiff-line-modified-added">+ #if !BUSE(PARTIAL_SCAVENGE)</span>
<span class="udiff-line-added">+         , mergedUsedSinceLastScavenge</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+     );</span>
  }
  
  inline std::pair&lt;LargeRange, LargeRange&gt; LargeRange::split(size_t leftSize) const
  {
      BASSERT(leftSize &lt;= this-&gt;size());
</pre>
<center><a href="LargeMap.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="LineMetadata.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>