<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSDataViewPrototype.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSDataView.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSDataViewPrototype.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSDataViewPrototype.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 44   getInt16              dataViewProtoFuncGetInt16            DontEnum|Function       1  DataViewGetInt16
 45   getUint16             dataViewProtoFuncGetUint16           DontEnum|Function       1  DataViewGetUint16
 46   getInt32              dataViewProtoFuncGetInt32            DontEnum|Function       1  DataViewGetInt32
 47   getUint32             dataViewProtoFuncGetUint32           DontEnum|Function       1  DataViewGetUint32
 48   getFloat32            dataViewProtoFuncGetFloat32          DontEnum|Function       1  DataViewGetFloat32
 49   getFloat64            dataViewProtoFuncGetFloat64          DontEnum|Function       1  DataViewGetFloat64
 50   setInt8               dataViewProtoFuncSetInt8             DontEnum|Function       2  DataViewSetInt8
 51   setUint8              dataViewProtoFuncSetUint8            DontEnum|Function       2  DataViewSetUint8
 52   setInt16              dataViewProtoFuncSetInt16            DontEnum|Function       2  DataViewSetInt16
 53   setUint16             dataViewProtoFuncSetUint16           DontEnum|Function       2  DataViewSetUint16
 54   setInt32              dataViewProtoFuncSetInt32            DontEnum|Function       2  DataViewSetInt32
 55   setUint32             dataViewProtoFuncSetUint32           DontEnum|Function       2  DataViewSetUint32
 56   setFloat32            dataViewProtoFuncSetFloat32          DontEnum|Function       2  DataViewSetFloat32
 57   setFloat64            dataViewProtoFuncSetFloat64          DontEnum|Function       2  DataViewSetFloat64
 58   buffer                dataViewProtoGetterBuffer            DontEnum|Accessor       0
 59   byteLength            dataViewProtoGetterByteLength        DontEnum|Accessor       0
 60   byteOffset            dataViewProtoGetterByteOffset        DontEnum|Accessor       0
 61 @end
 62 */
 63 
<span class="line-modified"> 64 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt8(ExecState*);</span>
<span class="line-modified"> 65 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt16(ExecState*);</span>
<span class="line-modified"> 66 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt32(ExecState*);</span>
<span class="line-modified"> 67 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint8(ExecState*);</span>
<span class="line-modified"> 68 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint16(ExecState*);</span>
<span class="line-modified"> 69 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint32(ExecState*);</span>
<span class="line-modified"> 70 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetFloat32(ExecState*);</span>
<span class="line-modified"> 71 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetFloat64(ExecState*);</span>
<span class="line-modified"> 72 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt8(ExecState*);</span>
<span class="line-modified"> 73 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt16(ExecState*);</span>
<span class="line-modified"> 74 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt32(ExecState*);</span>
<span class="line-modified"> 75 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint8(ExecState*);</span>
<span class="line-modified"> 76 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint16(ExecState*);</span>
<span class="line-modified"> 77 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint32(ExecState*);</span>
<span class="line-modified"> 78 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetFloat32(ExecState*);</span>
<span class="line-modified"> 79 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetFloat64(ExecState*);</span>
<span class="line-modified"> 80 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterBuffer(ExecState*);</span>
<span class="line-modified"> 81 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterByteLength(ExecState*);</span>
<span class="line-modified"> 82 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterByteOffset(ExecState*);</span>
 83 
 84 }
 85 
 86 #include &quot;JSDataViewPrototype.lut.h&quot;
 87 
 88 namespace JSC {
 89 
 90 const ClassInfo JSDataViewPrototype::s_info = {
 91     &quot;DataViewPrototype&quot;, &amp;Base::s_info, &amp;dataViewTable, nullptr,
 92     CREATE_METHOD_TABLE(JSDataViewPrototype)
 93 };
 94 
 95 JSDataViewPrototype::JSDataViewPrototype(VM&amp; vm, Structure* structure)
 96     : Base(vm, structure)
 97 {
 98 }
 99 
100 JSDataViewPrototype* JSDataViewPrototype::create(VM&amp; vm, Structure* structure)
101 {
102     JSDataViewPrototype* prototype =
103         new (NotNull, allocateCell&lt;JSDataViewPrototype&gt;(vm.heap))
104         JSDataViewPrototype(vm, structure);
105     prototype-&gt;finishCreation(vm);
106     return prototype;
107 }
108 
109 void JSDataViewPrototype::finishCreation(JSC::VM&amp; vm)
110 {
111     Base::finishCreation(vm);
<span class="line-modified">112     putDirectWithoutTransition(vm, vm.propertyNames-&gt;toStringTagSymbol, jsString(vm, &quot;DataView&quot;), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);</span>
113 }
114 
115 Structure* JSDataViewPrototype::createStructure(
116     VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
117 {
118     return Structure::create(
119         vm, globalObject, prototype, TypeInfo(ObjectType, StructureFlags), info());
120 }
121 
122 template&lt;typename Adaptor&gt;
<span class="line-modified">123 EncodedJSValue getData(ExecState* exec)</span>
124 {
<span class="line-modified">125     VM&amp; vm = exec-&gt;vm();</span>
126     auto scope = DECLARE_THROW_SCOPE(vm);
127 
<span class="line-modified">128     JSDataView* dataView = jsDynamicCast&lt;JSDataView*&gt;(vm, exec-&gt;thisValue());</span>
129     if (!dataView)
<span class="line-modified">130         return throwVMTypeError(exec, scope, &quot;Receiver of DataView method must be a DataView&quot;_s);</span>
131 
<span class="line-modified">132     unsigned byteOffset = exec-&gt;argument(0).toIndex(exec, &quot;byteOffset&quot;);</span>
133     RETURN_IF_EXCEPTION(scope, encodedJSValue());
134 
135     bool littleEndian = false;
136     unsigned elementSize = sizeof(typename Adaptor::Type);
<span class="line-modified">137     if (elementSize &gt; 1 &amp;&amp; exec-&gt;argumentCount() &gt;= 2) {</span>
<span class="line-modified">138         littleEndian = exec-&gt;uncheckedArgument(1).toBoolean(exec);</span>
139         RETURN_IF_EXCEPTION(scope, encodedJSValue());
140     }
141 
142     unsigned byteLength = dataView-&gt;length();
143     if (elementSize &gt; byteLength || byteOffset &gt; byteLength - elementSize)
<span class="line-modified">144         return throwVMError(exec, scope, createRangeError(exec, &quot;Out of bounds access&quot;_s));</span>
145 
146     const unsigned dataSize = sizeof(typename Adaptor::Type);
147     union {
148         typename Adaptor::Type value;
149         uint8_t rawBytes[dataSize];
150     } u = { };
151 
152     uint8_t* dataPtr = static_cast&lt;uint8_t*&gt;(dataView-&gt;vector()) + byteOffset;
153 
154     if (needToFlipBytesIfLittleEndian(littleEndian)) {
155         for (unsigned i = dataSize; i--;)
156             u.rawBytes[i] = *dataPtr++;
157     } else {
158         for (unsigned i = 0; i &lt; dataSize; i++)
159             u.rawBytes[i] = *dataPtr++;
160     }
161 
162     return JSValue::encode(Adaptor::toJSValue(u.value));
163 }
164 
165 template&lt;typename Adaptor&gt;
<span class="line-modified">166 EncodedJSValue setData(ExecState* exec)</span>
167 {
<span class="line-modified">168     VM&amp; vm = exec-&gt;vm();</span>
169     auto scope = DECLARE_THROW_SCOPE(vm);
170 
<span class="line-modified">171     JSDataView* dataView = jsDynamicCast&lt;JSDataView*&gt;(vm, exec-&gt;thisValue());</span>
172     if (!dataView)
<span class="line-modified">173         return throwVMTypeError(exec, scope, &quot;Receiver of DataView method must be a DataView&quot;_s);</span>
174 
<span class="line-modified">175     unsigned byteOffset = exec-&gt;argument(0).toIndex(exec, &quot;byteOffset&quot;);</span>
176     RETURN_IF_EXCEPTION(scope, encodedJSValue());
177 
178     const unsigned dataSize = sizeof(typename Adaptor::Type);
179     union {
180         typename Adaptor::Type value;
181         uint8_t rawBytes[dataSize];
182     } u;
183 
<span class="line-modified">184     u.value = toNativeFromValue&lt;Adaptor&gt;(exec, exec-&gt;argument(1));</span>
185     RETURN_IF_EXCEPTION(scope, encodedJSValue());
186 
187     bool littleEndian = false;
188     unsigned elementSize = sizeof(typename Adaptor::Type);
<span class="line-modified">189     if (elementSize &gt; 1 &amp;&amp; exec-&gt;argumentCount() &gt;= 3) {</span>
<span class="line-modified">190         littleEndian = exec-&gt;uncheckedArgument(2).toBoolean(exec);</span>
191         RETURN_IF_EXCEPTION(scope, encodedJSValue());
192     }
193 
194     unsigned byteLength = dataView-&gt;length();
195     if (elementSize &gt; byteLength || byteOffset &gt; byteLength - elementSize)
<span class="line-modified">196         return throwVMError(exec, scope, createRangeError(exec, &quot;Out of bounds access&quot;_s));</span>
197 
198     uint8_t* dataPtr = static_cast&lt;uint8_t*&gt;(dataView-&gt;vector()) + byteOffset;
199 
200     if (needToFlipBytesIfLittleEndian(littleEndian)) {
201         for (unsigned i = dataSize; i--;)
202             *dataPtr++ = u.rawBytes[i];
203     } else {
204         for (unsigned i = 0; i &lt; dataSize; i++)
205             *dataPtr++ = u.rawBytes[i];
206     }
207 
208     return JSValue::encode(jsUndefined());
209 }
210 
211 IGNORE_CLANG_WARNINGS_BEGIN(&quot;missing-prototypes&quot;)
212 
<span class="line-modified">213 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterBuffer(ExecState* exec)</span>
214 {
<span class="line-modified">215     VM&amp; vm = exec-&gt;vm();</span>
216     auto scope = DECLARE_THROW_SCOPE(vm);
217 
<span class="line-modified">218     JSDataView* view = jsDynamicCast&lt;JSDataView*&gt;(vm, exec-&gt;thisValue());</span>
219     if (!view)
<span class="line-modified">220         return throwVMTypeError(exec, scope, &quot;DataView.prototype.buffer expects |this| to be a DataView object&quot;);</span>
221 
<span class="line-modified">222     return JSValue::encode(view-&gt;possiblySharedJSBuffer(exec));</span>
223 }
224 
<span class="line-modified">225 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterByteLength(ExecState* exec)</span>
226 {
<span class="line-modified">227     VM&amp; vm = exec-&gt;vm();</span>
228     auto scope = DECLARE_THROW_SCOPE(vm);
229 
<span class="line-modified">230     JSDataView* view = jsDynamicCast&lt;JSDataView*&gt;(vm, exec-&gt;thisValue());</span>
231     if (!view)
<span class="line-modified">232         return throwVMTypeError(exec, scope, &quot;DataView.prototype.buffer expects |this| to be a DataView object&quot;);</span>
233 
234     return JSValue::encode(jsNumber(view-&gt;length()));
235 }
236 
<span class="line-modified">237 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterByteOffset(ExecState* exec)</span>
238 {
<span class="line-modified">239     VM&amp; vm = exec-&gt;vm();</span>
240     auto scope = DECLARE_THROW_SCOPE(vm);
241 
<span class="line-modified">242     JSDataView* view = jsDynamicCast&lt;JSDataView*&gt;(vm, exec-&gt;thisValue());</span>
243     if (!view)
<span class="line-modified">244         return throwVMTypeError(exec, scope, &quot;DataView.prototype.buffer expects |this| to be a DataView object&quot;);</span>
245 
246     return JSValue::encode(jsNumber(view-&gt;byteOffset()));
247 }
248 
<span class="line-modified">249 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt8(ExecState* exec)</span>
250 {
<span class="line-modified">251     return getData&lt;Int8Adaptor&gt;(exec);</span>
252 }
253 
<span class="line-modified">254 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt16(ExecState* exec)</span>
255 {
<span class="line-modified">256     return getData&lt;Int16Adaptor&gt;(exec);</span>
257 }
258 
<span class="line-modified">259 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt32(ExecState* exec)</span>
260 {
<span class="line-modified">261     return getData&lt;Int32Adaptor&gt;(exec);</span>
262 }
263 
<span class="line-modified">264 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint8(ExecState* exec)</span>
265 {
<span class="line-modified">266     return getData&lt;Uint8Adaptor&gt;(exec);</span>
267 }
268 
<span class="line-modified">269 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint16(ExecState* exec)</span>
270 {
<span class="line-modified">271     return getData&lt;Uint16Adaptor&gt;(exec);</span>
272 }
273 
<span class="line-modified">274 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint32(ExecState* exec)</span>
275 {
<span class="line-modified">276     return getData&lt;Uint32Adaptor&gt;(exec);</span>
277 }
278 
<span class="line-modified">279 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetFloat32(ExecState* exec)</span>
280 {
<span class="line-modified">281     return getData&lt;Float32Adaptor&gt;(exec);</span>
282 }
283 
<span class="line-modified">284 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetFloat64(ExecState* exec)</span>
285 {
<span class="line-modified">286     return getData&lt;Float64Adaptor&gt;(exec);</span>
287 }
288 
<span class="line-modified">289 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt8(ExecState* exec)</span>
290 {
<span class="line-modified">291     return setData&lt;Int8Adaptor&gt;(exec);</span>
292 }
293 
<span class="line-modified">294 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt16(ExecState* exec)</span>
295 {
<span class="line-modified">296     return setData&lt;Int16Adaptor&gt;(exec);</span>
297 }
298 
<span class="line-modified">299 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt32(ExecState* exec)</span>
300 {
<span class="line-modified">301     return setData&lt;Int32Adaptor&gt;(exec);</span>
302 }
303 
<span class="line-modified">304 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint8(ExecState* exec)</span>
305 {
<span class="line-modified">306     return setData&lt;Uint8Adaptor&gt;(exec);</span>
307 }
308 
<span class="line-modified">309 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint16(ExecState* exec)</span>
310 {
<span class="line-modified">311     return setData&lt;Uint16Adaptor&gt;(exec);</span>
312 }
313 
<span class="line-modified">314 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint32(ExecState* exec)</span>
315 {
<span class="line-modified">316     return setData&lt;Uint32Adaptor&gt;(exec);</span>
317 }
318 
<span class="line-modified">319 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetFloat32(ExecState* exec)</span>
320 {
<span class="line-modified">321     return setData&lt;Float32Adaptor&gt;(exec);</span>
322 }
323 
<span class="line-modified">324 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetFloat64(ExecState* exec)</span>
325 {
<span class="line-modified">326     return setData&lt;Float64Adaptor&gt;(exec);</span>
327 }
328 IGNORE_CLANG_WARNINGS_END
329 
330 } // namespace JSC
</pre>
</td>
<td>
<hr />
<pre>
 44   getInt16              dataViewProtoFuncGetInt16            DontEnum|Function       1  DataViewGetInt16
 45   getUint16             dataViewProtoFuncGetUint16           DontEnum|Function       1  DataViewGetUint16
 46   getInt32              dataViewProtoFuncGetInt32            DontEnum|Function       1  DataViewGetInt32
 47   getUint32             dataViewProtoFuncGetUint32           DontEnum|Function       1  DataViewGetUint32
 48   getFloat32            dataViewProtoFuncGetFloat32          DontEnum|Function       1  DataViewGetFloat32
 49   getFloat64            dataViewProtoFuncGetFloat64          DontEnum|Function       1  DataViewGetFloat64
 50   setInt8               dataViewProtoFuncSetInt8             DontEnum|Function       2  DataViewSetInt8
 51   setUint8              dataViewProtoFuncSetUint8            DontEnum|Function       2  DataViewSetUint8
 52   setInt16              dataViewProtoFuncSetInt16            DontEnum|Function       2  DataViewSetInt16
 53   setUint16             dataViewProtoFuncSetUint16           DontEnum|Function       2  DataViewSetUint16
 54   setInt32              dataViewProtoFuncSetInt32            DontEnum|Function       2  DataViewSetInt32
 55   setUint32             dataViewProtoFuncSetUint32           DontEnum|Function       2  DataViewSetUint32
 56   setFloat32            dataViewProtoFuncSetFloat32          DontEnum|Function       2  DataViewSetFloat32
 57   setFloat64            dataViewProtoFuncSetFloat64          DontEnum|Function       2  DataViewSetFloat64
 58   buffer                dataViewProtoGetterBuffer            DontEnum|Accessor       0
 59   byteLength            dataViewProtoGetterByteLength        DontEnum|Accessor       0
 60   byteOffset            dataViewProtoGetterByteOffset        DontEnum|Accessor       0
 61 @end
 62 */
 63 
<span class="line-modified"> 64 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt8(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 65 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt16(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 66 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt32(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 67 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint8(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 68 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint16(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 69 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint32(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 70 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetFloat32(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 71 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetFloat64(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 72 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt8(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 73 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt16(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 74 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt32(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 75 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint8(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 76 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint16(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 77 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint32(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 78 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetFloat32(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 79 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetFloat64(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 80 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterBuffer(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 81 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterByteLength(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified"> 82 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterByteOffset(JSGlobalObject*, CallFrame*);</span>
 83 
 84 }
 85 
 86 #include &quot;JSDataViewPrototype.lut.h&quot;
 87 
 88 namespace JSC {
 89 
 90 const ClassInfo JSDataViewPrototype::s_info = {
 91     &quot;DataViewPrototype&quot;, &amp;Base::s_info, &amp;dataViewTable, nullptr,
 92     CREATE_METHOD_TABLE(JSDataViewPrototype)
 93 };
 94 
 95 JSDataViewPrototype::JSDataViewPrototype(VM&amp; vm, Structure* structure)
 96     : Base(vm, structure)
 97 {
 98 }
 99 
100 JSDataViewPrototype* JSDataViewPrototype::create(VM&amp; vm, Structure* structure)
101 {
102     JSDataViewPrototype* prototype =
103         new (NotNull, allocateCell&lt;JSDataViewPrototype&gt;(vm.heap))
104         JSDataViewPrototype(vm, structure);
105     prototype-&gt;finishCreation(vm);
106     return prototype;
107 }
108 
109 void JSDataViewPrototype::finishCreation(JSC::VM&amp; vm)
110 {
111     Base::finishCreation(vm);
<span class="line-modified">112     putDirectWithoutTransition(vm, vm.propertyNames-&gt;toStringTagSymbol, jsNontrivialString(vm, &quot;DataView&quot;_s), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);</span>
113 }
114 
115 Structure* JSDataViewPrototype::createStructure(
116     VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
117 {
118     return Structure::create(
119         vm, globalObject, prototype, TypeInfo(ObjectType, StructureFlags), info());
120 }
121 
122 template&lt;typename Adaptor&gt;
<span class="line-modified">123 EncodedJSValue getData(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
124 {
<span class="line-modified">125     VM&amp; vm = globalObject-&gt;vm();</span>
126     auto scope = DECLARE_THROW_SCOPE(vm);
127 
<span class="line-modified">128     JSDataView* dataView = jsDynamicCast&lt;JSDataView*&gt;(vm, callFrame-&gt;thisValue());</span>
129     if (!dataView)
<span class="line-modified">130         return throwVMTypeError(globalObject, scope, &quot;Receiver of DataView method must be a DataView&quot;_s);</span>
131 
<span class="line-modified">132     unsigned byteOffset = callFrame-&gt;argument(0).toIndex(globalObject, &quot;byteOffset&quot;);</span>
133     RETURN_IF_EXCEPTION(scope, encodedJSValue());
134 
135     bool littleEndian = false;
136     unsigned elementSize = sizeof(typename Adaptor::Type);
<span class="line-modified">137     if (elementSize &gt; 1 &amp;&amp; callFrame-&gt;argumentCount() &gt;= 2) {</span>
<span class="line-modified">138         littleEndian = callFrame-&gt;uncheckedArgument(1).toBoolean(globalObject);</span>
139         RETURN_IF_EXCEPTION(scope, encodedJSValue());
140     }
141 
142     unsigned byteLength = dataView-&gt;length();
143     if (elementSize &gt; byteLength || byteOffset &gt; byteLength - elementSize)
<span class="line-modified">144         return throwVMError(globalObject, scope, createRangeError(globalObject, &quot;Out of bounds access&quot;_s));</span>
145 
146     const unsigned dataSize = sizeof(typename Adaptor::Type);
147     union {
148         typename Adaptor::Type value;
149         uint8_t rawBytes[dataSize];
150     } u = { };
151 
152     uint8_t* dataPtr = static_cast&lt;uint8_t*&gt;(dataView-&gt;vector()) + byteOffset;
153 
154     if (needToFlipBytesIfLittleEndian(littleEndian)) {
155         for (unsigned i = dataSize; i--;)
156             u.rawBytes[i] = *dataPtr++;
157     } else {
158         for (unsigned i = 0; i &lt; dataSize; i++)
159             u.rawBytes[i] = *dataPtr++;
160     }
161 
162     return JSValue::encode(Adaptor::toJSValue(u.value));
163 }
164 
165 template&lt;typename Adaptor&gt;
<span class="line-modified">166 EncodedJSValue setData(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
167 {
<span class="line-modified">168     VM&amp; vm = globalObject-&gt;vm();</span>
169     auto scope = DECLARE_THROW_SCOPE(vm);
170 
<span class="line-modified">171     JSDataView* dataView = jsDynamicCast&lt;JSDataView*&gt;(vm, callFrame-&gt;thisValue());</span>
172     if (!dataView)
<span class="line-modified">173         return throwVMTypeError(globalObject, scope, &quot;Receiver of DataView method must be a DataView&quot;_s);</span>
174 
<span class="line-modified">175     unsigned byteOffset = callFrame-&gt;argument(0).toIndex(globalObject, &quot;byteOffset&quot;);</span>
176     RETURN_IF_EXCEPTION(scope, encodedJSValue());
177 
178     const unsigned dataSize = sizeof(typename Adaptor::Type);
179     union {
180         typename Adaptor::Type value;
181         uint8_t rawBytes[dataSize];
182     } u;
183 
<span class="line-modified">184     u.value = toNativeFromValue&lt;Adaptor&gt;(globalObject, callFrame-&gt;argument(1));</span>
185     RETURN_IF_EXCEPTION(scope, encodedJSValue());
186 
187     bool littleEndian = false;
188     unsigned elementSize = sizeof(typename Adaptor::Type);
<span class="line-modified">189     if (elementSize &gt; 1 &amp;&amp; callFrame-&gt;argumentCount() &gt;= 3) {</span>
<span class="line-modified">190         littleEndian = callFrame-&gt;uncheckedArgument(2).toBoolean(globalObject);</span>
191         RETURN_IF_EXCEPTION(scope, encodedJSValue());
192     }
193 
194     unsigned byteLength = dataView-&gt;length();
195     if (elementSize &gt; byteLength || byteOffset &gt; byteLength - elementSize)
<span class="line-modified">196         return throwVMError(globalObject, scope, createRangeError(globalObject, &quot;Out of bounds access&quot;_s));</span>
197 
198     uint8_t* dataPtr = static_cast&lt;uint8_t*&gt;(dataView-&gt;vector()) + byteOffset;
199 
200     if (needToFlipBytesIfLittleEndian(littleEndian)) {
201         for (unsigned i = dataSize; i--;)
202             *dataPtr++ = u.rawBytes[i];
203     } else {
204         for (unsigned i = 0; i &lt; dataSize; i++)
205             *dataPtr++ = u.rawBytes[i];
206     }
207 
208     return JSValue::encode(jsUndefined());
209 }
210 
211 IGNORE_CLANG_WARNINGS_BEGIN(&quot;missing-prototypes&quot;)
212 
<span class="line-modified">213 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterBuffer(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
214 {
<span class="line-modified">215     VM&amp; vm = globalObject-&gt;vm();</span>
216     auto scope = DECLARE_THROW_SCOPE(vm);
217 
<span class="line-modified">218     JSDataView* view = jsDynamicCast&lt;JSDataView*&gt;(vm, callFrame-&gt;thisValue());</span>
219     if (!view)
<span class="line-modified">220         return throwVMTypeError(globalObject, scope, &quot;DataView.prototype.buffer expects |this| to be a DataView object&quot;);</span>
221 
<span class="line-modified">222     return JSValue::encode(view-&gt;possiblySharedJSBuffer(globalObject));</span>
223 }
224 
<span class="line-modified">225 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterByteLength(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
226 {
<span class="line-modified">227     VM&amp; vm = globalObject-&gt;vm();</span>
228     auto scope = DECLARE_THROW_SCOPE(vm);
229 
<span class="line-modified">230     JSDataView* view = jsDynamicCast&lt;JSDataView*&gt;(vm, callFrame-&gt;thisValue());</span>
231     if (!view)
<span class="line-modified">232         return throwVMTypeError(globalObject, scope, &quot;DataView.prototype.buffer expects |this| to be a DataView object&quot;);</span>
233 
234     return JSValue::encode(jsNumber(view-&gt;length()));
235 }
236 
<span class="line-modified">237 EncodedJSValue JSC_HOST_CALL dataViewProtoGetterByteOffset(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
238 {
<span class="line-modified">239     VM&amp; vm = globalObject-&gt;vm();</span>
240     auto scope = DECLARE_THROW_SCOPE(vm);
241 
<span class="line-modified">242     JSDataView* view = jsDynamicCast&lt;JSDataView*&gt;(vm, callFrame-&gt;thisValue());</span>
243     if (!view)
<span class="line-modified">244         return throwVMTypeError(globalObject, scope, &quot;DataView.prototype.buffer expects |this| to be a DataView object&quot;);</span>
245 
246     return JSValue::encode(jsNumber(view-&gt;byteOffset()));
247 }
248 
<span class="line-modified">249 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt8(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
250 {
<span class="line-modified">251     return getData&lt;Int8Adaptor&gt;(globalObject, callFrame);</span>
252 }
253 
<span class="line-modified">254 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt16(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
255 {
<span class="line-modified">256     return getData&lt;Int16Adaptor&gt;(globalObject, callFrame);</span>
257 }
258 
<span class="line-modified">259 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetInt32(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
260 {
<span class="line-modified">261     return getData&lt;Int32Adaptor&gt;(globalObject, callFrame);</span>
262 }
263 
<span class="line-modified">264 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint8(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
265 {
<span class="line-modified">266     return getData&lt;Uint8Adaptor&gt;(globalObject, callFrame);</span>
267 }
268 
<span class="line-modified">269 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint16(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
270 {
<span class="line-modified">271     return getData&lt;Uint16Adaptor&gt;(globalObject, callFrame);</span>
272 }
273 
<span class="line-modified">274 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetUint32(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
275 {
<span class="line-modified">276     return getData&lt;Uint32Adaptor&gt;(globalObject, callFrame);</span>
277 }
278 
<span class="line-modified">279 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetFloat32(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
280 {
<span class="line-modified">281     return getData&lt;Float32Adaptor&gt;(globalObject, callFrame);</span>
282 }
283 
<span class="line-modified">284 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncGetFloat64(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
285 {
<span class="line-modified">286     return getData&lt;Float64Adaptor&gt;(globalObject, callFrame);</span>
287 }
288 
<span class="line-modified">289 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt8(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
290 {
<span class="line-modified">291     return setData&lt;Int8Adaptor&gt;(globalObject, callFrame);</span>
292 }
293 
<span class="line-modified">294 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt16(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
295 {
<span class="line-modified">296     return setData&lt;Int16Adaptor&gt;(globalObject, callFrame);</span>
297 }
298 
<span class="line-modified">299 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetInt32(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
300 {
<span class="line-modified">301     return setData&lt;Int32Adaptor&gt;(globalObject, callFrame);</span>
302 }
303 
<span class="line-modified">304 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint8(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
305 {
<span class="line-modified">306     return setData&lt;Uint8Adaptor&gt;(globalObject, callFrame);</span>
307 }
308 
<span class="line-modified">309 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint16(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
310 {
<span class="line-modified">311     return setData&lt;Uint16Adaptor&gt;(globalObject, callFrame);</span>
312 }
313 
<span class="line-modified">314 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetUint32(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
315 {
<span class="line-modified">316     return setData&lt;Uint32Adaptor&gt;(globalObject, callFrame);</span>
317 }
318 
<span class="line-modified">319 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetFloat32(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
320 {
<span class="line-modified">321     return setData&lt;Float32Adaptor&gt;(globalObject, callFrame);</span>
322 }
323 
<span class="line-modified">324 EncodedJSValue JSC_HOST_CALL dataViewProtoFuncSetFloat64(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
325 {
<span class="line-modified">326     return setData&lt;Float64Adaptor&gt;(globalObject, callFrame);</span>
327 }
328 IGNORE_CLANG_WARNINGS_END
329 
330 } // namespace JSC
</pre>
</td>
</tr>
</table>
<center><a href="JSDataView.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSDataViewPrototype.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>