<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/crypto/CommonCryptoUtilities.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2013-2018 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 14  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 15  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;CommonCryptoUtilities.h&quot;
 28 
 29 #if ENABLE(WEB_CRYPTO)
 30 
<a name="1" id="anc1"></a><span class="line-removed"> 31 #if !HAVE(CCRSAGetCRTComponents)</span>
<span class="line-removed"> 32 </span>
<span class="line-removed"> 33 #if USE(APPLE_INTERNAL_SDK)</span>
<span class="line-removed"> 34 #include &lt;CommonCrypto/CommonBigNum.h&gt;</span>
<span class="line-removed"> 35 #endif</span>
<span class="line-removed"> 36 </span>
<span class="line-removed"> 37 extern &quot;C&quot; CCBigNumRef CCBigNumFromData(CCStatus *status, const void *s, size_t len);</span>
<span class="line-removed"> 38 extern &quot;C&quot; size_t CCBigNumToData(CCStatus *status, const CCBigNumRef bn, void *to);</span>
<span class="line-removed"> 39 extern &quot;C&quot; uint32_t CCBigNumByteCount(const CCBigNumRef bn);</span>
<span class="line-removed"> 40 extern &quot;C&quot; CCBigNumRef CCCreateBigNum(CCStatus *status);</span>
<span class="line-removed"> 41 extern &quot;C&quot; void CCBigNumFree(CCBigNumRef bn);</span>
<span class="line-removed"> 42 extern &quot;C&quot; CCBigNumRef CCBigNumCopy(CCStatus *status, const CCBigNumRef bn);</span>
<span class="line-removed"> 43 extern &quot;C&quot; CCStatus CCBigNumSubI(CCBigNumRef result, const CCBigNumRef a, const uint32_t b);</span>
<span class="line-removed"> 44 extern &quot;C&quot; CCStatus CCBigNumMod(CCBigNumRef result, CCBigNumRef dividend, CCBigNumRef modulus);</span>
<span class="line-removed"> 45 extern &quot;C&quot; CCStatus CCBigNumInverseMod(CCBigNumRef result, const CCBigNumRef a, const CCBigNumRef modulus);</span>
<span class="line-removed"> 46 </span>
<span class="line-removed"> 47 #endif</span>
<span class="line-removed"> 48 </span>
 49 namespace WebCore {
 50 
 51 bool getCommonCryptoDigestAlgorithm(CryptoAlgorithmIdentifier hashFunction, CCDigestAlgorithm&amp; algorithm)
 52 {
 53     switch (hashFunction) {
 54     case CryptoAlgorithmIdentifier::SHA_1:
 55         ALLOW_DEPRECATED_DECLARATIONS_BEGIN
 56         algorithm = kCCDigestSHA1;
 57         ALLOW_DEPRECATED_DECLARATIONS_END
 58         return true;
 59     case CryptoAlgorithmIdentifier::SHA_224:
 60         algorithm = kCCDigestSHA224;
 61         return true;
 62     case CryptoAlgorithmIdentifier::SHA_256:
 63         algorithm = kCCDigestSHA256;
 64         return true;
 65     case CryptoAlgorithmIdentifier::SHA_384:
 66         algorithm = kCCDigestSHA384;
 67         return true;
 68     case CryptoAlgorithmIdentifier::SHA_512:
 69         algorithm = kCCDigestSHA512;
 70         return true;
 71     default:
 72         return false;
 73     }
 74 }
 75 
<a name="2" id="anc2"></a><span class="line-removed"> 76 #if !HAVE(CCRSAGetCRTComponents)</span>
<span class="line-removed"> 77 </span>
<span class="line-removed"> 78 CCBigNum::CCBigNum(CCBigNumRef number)</span>
<span class="line-removed"> 79     : m_number(number)</span>
<span class="line-removed"> 80 {</span>
<span class="line-removed"> 81 }</span>
<span class="line-removed"> 82 </span>
<span class="line-removed"> 83 CCBigNum::CCBigNum(const uint8_t* data, size_t size)</span>
<span class="line-removed"> 84 {</span>
<span class="line-removed"> 85     CCStatus status = kCCSuccess;</span>
<span class="line-removed"> 86     m_number = CCBigNumFromData(&amp;status, data, size);</span>
<span class="line-removed"> 87     RELEASE_ASSERT(!status);</span>
<span class="line-removed"> 88 }</span>
<span class="line-removed"> 89 </span>
<span class="line-removed"> 90 CCBigNum::~CCBigNum()</span>
<span class="line-removed"> 91 {</span>
<span class="line-removed"> 92     CCBigNumFree(m_number);</span>
<span class="line-removed"> 93 }</span>
<span class="line-removed"> 94 </span>
<span class="line-removed"> 95 CCBigNum::CCBigNum(const CCBigNum&amp; other)</span>
<span class="line-removed"> 96 {</span>
<span class="line-removed"> 97     CCStatus status = kCCSuccess;</span>
<span class="line-removed"> 98     m_number = CCBigNumCopy(&amp;status, other.m_number);</span>
<span class="line-removed"> 99     RELEASE_ASSERT(!status);</span>
<span class="line-removed">100 }</span>
<span class="line-removed">101 </span>
<span class="line-removed">102 CCBigNum::CCBigNum(CCBigNum&amp;&amp; other)</span>
<span class="line-removed">103 {</span>
<span class="line-removed">104     m_number = other.m_number;</span>
<span class="line-removed">105     other.m_number = nullptr;</span>
<span class="line-removed">106 }</span>
<span class="line-removed">107 </span>
<span class="line-removed">108 CCBigNum&amp; CCBigNum::operator=(const CCBigNum&amp; other)</span>
<span class="line-removed">109 {</span>
<span class="line-removed">110     if (this == &amp;other)</span>
<span class="line-removed">111         return *this;</span>
<span class="line-removed">112 </span>
<span class="line-removed">113     CCBigNumFree(m_number);</span>
<span class="line-removed">114 </span>
<span class="line-removed">115     CCStatus status = kCCSuccess;</span>
<span class="line-removed">116     m_number = CCBigNumCopy(&amp;status, other.m_number);</span>
<span class="line-removed">117     RELEASE_ASSERT(!status);</span>
<span class="line-removed">118     return *this;</span>
<span class="line-removed">119 }</span>
<span class="line-removed">120 </span>
<span class="line-removed">121 CCBigNum&amp; CCBigNum::operator=(CCBigNum&amp;&amp; other)</span>
<span class="line-removed">122 {</span>
<span class="line-removed">123     if (this == &amp;other)</span>
<span class="line-removed">124         return *this;</span>
<span class="line-removed">125 </span>
<span class="line-removed">126     m_number = other.m_number;</span>
<span class="line-removed">127     other.m_number = nullptr;</span>
<span class="line-removed">128 </span>
<span class="line-removed">129     return *this;</span>
<span class="line-removed">130 }</span>
<span class="line-removed">131 </span>
<span class="line-removed">132 Vector&lt;uint8_t&gt; CCBigNum::data() const</span>
<span class="line-removed">133 {</span>
<span class="line-removed">134     Vector&lt;uint8_t&gt; result(CCBigNumByteCount(m_number));</span>
<span class="line-removed">135     CCStatus status = kCCSuccess;</span>
<span class="line-removed">136     CCBigNumToData(&amp;status, m_number, result.data());</span>
<span class="line-removed">137     RELEASE_ASSERT(!status);</span>
<span class="line-removed">138 </span>
<span class="line-removed">139     return result;</span>
<span class="line-removed">140 }</span>
<span class="line-removed">141 </span>
<span class="line-removed">142 CCBigNum CCBigNum::operator-(uint32_t b) const</span>
<span class="line-removed">143 {</span>
<span class="line-removed">144     CCStatus status = kCCSuccess;</span>
<span class="line-removed">145     CCBigNumRef result = CCCreateBigNum(&amp;status);</span>
<span class="line-removed">146     RELEASE_ASSERT(!status);</span>
<span class="line-removed">147 </span>
<span class="line-removed">148     status = CCBigNumSubI(result, m_number, b);</span>
<span class="line-removed">149     RELEASE_ASSERT(!status);</span>
<span class="line-removed">150 </span>
<span class="line-removed">151     return result;</span>
<span class="line-removed">152 }</span>
<span class="line-removed">153 </span>
<span class="line-removed">154 CCBigNum CCBigNum::operator%(const CCBigNum&amp; modulus) const</span>
<span class="line-removed">155 {</span>
<span class="line-removed">156     CCStatus status = kCCSuccess;</span>
<span class="line-removed">157     CCBigNumRef result = CCCreateBigNum(&amp;status);</span>
<span class="line-removed">158     RELEASE_ASSERT(!status);</span>
<span class="line-removed">159 </span>
<span class="line-removed">160     status = CCBigNumMod(result, m_number, modulus.m_number);</span>
<span class="line-removed">161     RELEASE_ASSERT(!status);</span>
<span class="line-removed">162 </span>
<span class="line-removed">163     return result;</span>
<span class="line-removed">164 }</span>
<span class="line-removed">165 </span>
<span class="line-removed">166 CCBigNum CCBigNum::inverse(const CCBigNum&amp; modulus) const</span>
<span class="line-removed">167 {</span>
<span class="line-removed">168     CCStatus status = kCCSuccess;</span>
<span class="line-removed">169     CCBigNumRef result = CCCreateBigNum(&amp;status);</span>
<span class="line-removed">170     RELEASE_ASSERT(!status);</span>
<span class="line-removed">171 </span>
<span class="line-removed">172     status = CCBigNumInverseMod(result, m_number, modulus.m_number);</span>
<span class="line-removed">173     RELEASE_ASSERT(!status);</span>
<span class="line-removed">174 </span>
<span class="line-removed">175     return result;</span>
<span class="line-removed">176 }</span>
<span class="line-removed">177 </span>
<span class="line-removed">178 #endif</span>
<span class="line-removed">179 </span>
180 } // namespace WebCore
181 
182 #endif // ENABLE(WEB_CRYPTO)
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>