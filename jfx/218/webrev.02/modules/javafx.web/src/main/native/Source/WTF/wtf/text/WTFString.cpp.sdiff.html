<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WTF/wtf/text/WTFString.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="UniquedStringImpl.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="WTFString.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WTF/wtf/text/WTFString.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  15  *
  16  * You should have received a copy of the GNU Library General Public License
  17  * along with this library; see the file COPYING.LIB.  If not, write to
  18  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
  19  * Boston, MA 02110-1301, USA.
  20  */
  21 
  22 #include &quot;config.h&quot;
  23 #include &lt;wtf/text/WTFString.h&gt;
  24 
  25 #include &lt;stdarg.h&gt;
  26 #include &lt;wtf/ASCIICType.h&gt;
  27 #include &lt;wtf/DataLog.h&gt;
  28 #include &lt;wtf/HexNumber.h&gt;
  29 #include &lt;wtf/MathExtras.h&gt;
  30 #include &lt;wtf/NeverDestroyed.h&gt;
  31 #include &lt;wtf/Vector.h&gt;
  32 #include &lt;wtf/dtoa.h&gt;
  33 #include &lt;wtf/text/CString.h&gt;
  34 #include &lt;wtf/text/IntegerToStringConversion.h&gt;

  35 #include &lt;wtf/text/StringToIntegerConversion.h&gt;
  36 #include &lt;wtf/unicode/CharacterNames.h&gt;
  37 #include &lt;wtf/unicode/UTF8Conversion.h&gt;
  38 
  39 namespace WTF {
  40 
  41 using namespace Unicode;
  42 
  43 // Construct a string with UTF-16 data.
  44 String::String(const UChar* characters, unsigned length)
  45 {
  46     if (characters)
  47         m_impl = StringImpl::create(characters, length);
  48 }
  49 
  50 // Construct a string with UTF-16 data, from a null-terminated source.
  51 String::String(const UChar* nullTerminatedString)
  52 {
  53     if (nullTerminatedString)
  54         m_impl = StringImpl::create(nullTerminatedString, lengthOfNullTerminatedString(nullTerminatedString));
</pre>
<hr />
<pre>
1092 String* string(const char*);
1093 Vector&lt;char&gt; asciiDebug(StringImpl* impl);
1094 Vector&lt;char&gt; asciiDebug(String&amp; string);
1095 
1096 void String::show() const
1097 {
1098     dataLogF(&quot;%s\n&quot;, asciiDebug(impl()).data());
1099 }
1100 
1101 String* string(const char* s)
1102 {
1103     // Intentionally leaks memory!
1104     return new String(s);
1105 }
1106 
1107 Vector&lt;char&gt; asciiDebug(StringImpl* impl)
1108 {
1109     if (!impl)
1110         return asciiDebug(String(&quot;[null]&quot;_s).impl());
1111 
<span class="line-modified">1112     Vector&lt;char&gt; buffer;</span>
1113     for (unsigned i = 0; i &lt; impl-&gt;length(); ++i) {
1114         UChar ch = (*impl)[i];
1115         if (isASCIIPrintable(ch)) {
1116             if (ch == &#39;\\&#39;)
1117                 buffer.append(ch);
1118             buffer.append(ch);
1119         } else {
1120             buffer.append(&#39;\\&#39;);
1121             buffer.append(&#39;u&#39;);
<span class="line-modified">1122             appendUnsignedAsHexFixedSize(ch, buffer, 4);</span>
1123         }
1124     }
<span class="line-modified">1125     buffer.append(&#39;\0&#39;);</span>
<span class="line-modified">1126     return buffer;</span>


1127 }
1128 
1129 Vector&lt;char&gt; asciiDebug(String&amp; string)
1130 {
1131     return asciiDebug(string.impl());
1132 }
1133 
1134 #endif
</pre>
</td>
<td>
<hr />
<pre>
  15  *
  16  * You should have received a copy of the GNU Library General Public License
  17  * along with this library; see the file COPYING.LIB.  If not, write to
  18  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
  19  * Boston, MA 02110-1301, USA.
  20  */
  21 
  22 #include &quot;config.h&quot;
  23 #include &lt;wtf/text/WTFString.h&gt;
  24 
  25 #include &lt;stdarg.h&gt;
  26 #include &lt;wtf/ASCIICType.h&gt;
  27 #include &lt;wtf/DataLog.h&gt;
  28 #include &lt;wtf/HexNumber.h&gt;
  29 #include &lt;wtf/MathExtras.h&gt;
  30 #include &lt;wtf/NeverDestroyed.h&gt;
  31 #include &lt;wtf/Vector.h&gt;
  32 #include &lt;wtf/dtoa.h&gt;
  33 #include &lt;wtf/text/CString.h&gt;
  34 #include &lt;wtf/text/IntegerToStringConversion.h&gt;
<span class="line-added">  35 #include &lt;wtf/text/StringBuilder.h&gt;</span>
  36 #include &lt;wtf/text/StringToIntegerConversion.h&gt;
  37 #include &lt;wtf/unicode/CharacterNames.h&gt;
  38 #include &lt;wtf/unicode/UTF8Conversion.h&gt;
  39 
  40 namespace WTF {
  41 
  42 using namespace Unicode;
  43 
  44 // Construct a string with UTF-16 data.
  45 String::String(const UChar* characters, unsigned length)
  46 {
  47     if (characters)
  48         m_impl = StringImpl::create(characters, length);
  49 }
  50 
  51 // Construct a string with UTF-16 data, from a null-terminated source.
  52 String::String(const UChar* nullTerminatedString)
  53 {
  54     if (nullTerminatedString)
  55         m_impl = StringImpl::create(nullTerminatedString, lengthOfNullTerminatedString(nullTerminatedString));
</pre>
<hr />
<pre>
1093 String* string(const char*);
1094 Vector&lt;char&gt; asciiDebug(StringImpl* impl);
1095 Vector&lt;char&gt; asciiDebug(String&amp; string);
1096 
1097 void String::show() const
1098 {
1099     dataLogF(&quot;%s\n&quot;, asciiDebug(impl()).data());
1100 }
1101 
1102 String* string(const char* s)
1103 {
1104     // Intentionally leaks memory!
1105     return new String(s);
1106 }
1107 
1108 Vector&lt;char&gt; asciiDebug(StringImpl* impl)
1109 {
1110     if (!impl)
1111         return asciiDebug(String(&quot;[null]&quot;_s).impl());
1112 
<span class="line-modified">1113     StringBuilder buffer;</span>
1114     for (unsigned i = 0; i &lt; impl-&gt;length(); ++i) {
1115         UChar ch = (*impl)[i];
1116         if (isASCIIPrintable(ch)) {
1117             if (ch == &#39;\\&#39;)
1118                 buffer.append(ch);
1119             buffer.append(ch);
1120         } else {
1121             buffer.append(&#39;\\&#39;);
1122             buffer.append(&#39;u&#39;);
<span class="line-modified">1123             buffer.append(hex(ch, 4));</span>
1124         }
1125     }
<span class="line-modified">1126     CString narrowString = buffer.toString().ascii();</span>
<span class="line-modified">1127     Vector&lt;char&gt; result;</span>
<span class="line-added">1128     result.append(reinterpret_cast&lt;const char*&gt;(narrowString.data()), narrowString.length() + 1);</span>
<span class="line-added">1129     return result;</span>
1130 }
1131 
1132 Vector&lt;char&gt; asciiDebug(String&amp; string)
1133 {
1134     return asciiDebug(string.impl());
1135 }
1136 
1137 #endif
</pre>
</td>
</tr>
</table>
<center><a href="UniquedStringImpl.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="WTFString.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>