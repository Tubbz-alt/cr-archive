<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/bmalloc/bmalloc/BPlatform.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2014-2018 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;BCompiler.h&quot;
 29 
 30 #ifdef __APPLE__
 31 #include &lt;Availability.h&gt;
 32 #include &lt;AvailabilityMacros.h&gt;
 33 #include &lt;TargetConditionals.h&gt;
 34 #endif
 35 
 36 #define BPLATFORM(PLATFORM) (defined BPLATFORM_##PLATFORM &amp;&amp; BPLATFORM_##PLATFORM)
 37 #define BOS(OS) (defined BOS_##OS &amp;&amp; BOS_##OS)
 38 
 39 #ifdef __APPLE__
 40 #define BOS_DARWIN 1
 41 #endif
 42 
 43 #if defined(__unix) || defined(__unix__)
 44 #define BOS_UNIX 1
 45 #endif
 46 
 47 #ifdef __linux__
 48 #define BOS_LINUX 1
 49 #endif
 50 
 51 #if defined(__FreeBSD__) || defined(__DragonFly__) || defined(__FreeBSD_kernel__)
 52 #define BOS_FREEBSD 1
 53 #endif
 54 
 55 #if defined(WIN32) || defined(_WIN32)
 56 #define BOS_WINDOWS 1
 57 #endif
 58 
 59 #if BOS(DARWIN) &amp;&amp; !defined(BUILDING_WITH_CMAKE)
 60 #if TARGET_OS_IOS
 61 #define BOS_IOS 1
 62 #define BPLATFORM_IOS 1
 63 #if TARGET_OS_SIMULATOR
 64 #define BPLATFORM_IOS_SIMULATOR 1
 65 #endif
 66 #endif
 67 #if TARGET_OS_IPHONE
 68 #define BPLATFORM_IOS_FAMILY 1
 69 #if TARGET_OS_SIMULATOR
 70 #define BPLATFORM_IOS_FAMILY_SIMULATOR 1
 71 #endif
 72 #elif TARGET_OS_MAC
 73 #define BOS_MAC 1
 74 #define BPLATFORM_MAC 1
 75 #endif
 76 #endif
 77 
 78 #if BPLATFORM(MAC) || BPLATFORM(IOS_FAMILY)
 79 #define BPLATFORM_COCOA 1
 80 #endif
 81 
 82 #if defined(TARGET_OS_WATCH) &amp;&amp; TARGET_OS_WATCH
 83 #define BOS_WATCHOS 1
 84 #define BPLATFORM_WATCHOS 1
 85 #endif
 86 
 87 #if defined(TARGET_OS_TV) &amp;&amp; TARGET_OS_TV
 88 #define BOS_APPLETV 1
 89 #define BPLATFORM_APPLETV 1
 90 #endif
 91 
 92 /* ==== Policy decision macros: these define policy choices for a particular port. ==== */
 93 
 94 /* BUSE() - use a particular third-party library or optional OS service */
 95 #define BUSE(FEATURE) (defined BUSE_##FEATURE &amp;&amp; BUSE_##FEATURE)
 96 
 97 /* ==== Compiler adaptation macros: these describe the capabilities of the compiler. ==== */
 98 
 99 /* BCOMPILER_SUPPORTS() - check for a compiler feature */
100 #define BCOMPILER_SUPPORTS(FEATURE) (defined BCOMPILER_SUPPORTS_##FEATURE &amp;&amp; BCOMPILER_SUPPORTS_##FEATURE)
101 
102 /* ==== Platform adaptation macros: these describe properties of the target environment. ==== */
103 
104 /* BCPU() - the target CPU architecture */
105 #define BCPU(_FEATURE) (defined BCPU_##_FEATURE  &amp;&amp; BCPU_##_FEATURE)
106 
107 /* BCPU(X86) - i386 / x86 32-bit */
108 #if defined(__i386__) \
109 || defined(i386)     \
110 || defined(_M_IX86)  \
111 || defined(_X86_)    \
112 || defined(__THW_INTEL)
113 #define BCPU_X86 1
114 #endif
115 
116 /* BCPU(X86_64) - AMD64 / Intel64 / x86_64 64-bit */
117 #if defined(__x86_64__) \
118 || defined(_M_X64)
119 #define BCPU_X86_64 1
120 #endif
121 
122 /* BCPU(ARM64) - Apple */
123 #if (defined(__arm64__) &amp;&amp; defined(__APPLE__)) || defined(__aarch64__)
124 #define BCPU_ARM64 1
125 #endif
126 
127 /* BCPU(ARM) - ARM, any version*/
128 #define BARM_ARCH_AT_LEAST(N) (BCPU(ARM) &amp;&amp; BARM_ARCH_VERSION &gt;= N)
129 
130 #if   defined(arm) \
131 || defined(__arm__) \
132 || defined(ARM) \
133 || defined(_ARM_)
134 #define BCPU_ARM 1
135 
136 /* Set BARM_ARCH_VERSION */
137 #if   defined(__ARM_ARCH_4__) \
138 || defined(__ARM_ARCH_4T__) \
139 || defined(__MARM_ARMV4__)
140 #define BARM_ARCH_VERSION 4
141 
142 #elif defined(__ARM_ARCH_5__) \
143 || defined(__ARM_ARCH_5T__) \
144 || defined(__MARM_ARMV5__)
145 #define BARM_ARCH_VERSION 5
146 
147 #elif defined(__ARM_ARCH_5E__) \
148 || defined(__ARM_ARCH_5TE__) \
149 || defined(__ARM_ARCH_5TEJ__)
150 #define BARM_ARCH_VERSION 5
151 
152 #elif defined(__ARM_ARCH_6__) \
153 || defined(__ARM_ARCH_6J__) \
154 || defined(__ARM_ARCH_6K__) \
155 || defined(__ARM_ARCH_6Z__) \
156 || defined(__ARM_ARCH_6ZK__) \
157 || defined(__ARM_ARCH_6T2__) \
158 || defined(__ARMV6__)
159 #define BARM_ARCH_VERSION 6
160 
161 #elif defined(__ARM_ARCH_7A__) \
162 || defined(__ARM_ARCH_7K__) \
163 || defined(__ARM_ARCH_7R__) \
164 || defined(__ARM_ARCH_7S__)
165 #define BARM_ARCH_VERSION 7
166 
167 #elif defined(__ARM_ARCH_8__) \
168 || defined(__ARM_ARCH_8A__)
169 #define BARM_ARCH_VERSION 8
170 
171 /* MSVC sets _M_ARM */
172 #elif defined(_M_ARM)
173 #define BARM_ARCH_VERSION _M_ARM
174 
175 /* RVCT sets _TARGET_ARCH_ARM */
176 #elif defined(__TARGET_ARCH_ARM)
177 #define BARM_ARCH_VERSION __TARGET_ARCH_ARM
178 
179 #else
180 #define WTF_ARM_ARCH_VERSION 0
181 
182 #endif
183 
184 /* Set BTHUMB_ARCH_VERSION */
185 #if   defined(__ARM_ARCH_4T__)
186 #define BTHUMB_ARCH_VERSION 1
187 
188 #elif defined(__ARM_ARCH_5T__) \
189 || defined(__ARM_ARCH_5TE__) \
190 || defined(__ARM_ARCH_5TEJ__)
191 #define BTHUMB_ARCH_VERSION 2
192 
193 #elif defined(__ARM_ARCH_6J__) \
194 || defined(__ARM_ARCH_6K__) \
195 || defined(__ARM_ARCH_6Z__) \
196 || defined(__ARM_ARCH_6ZK__) \
197 || defined(__ARM_ARCH_6M__)
198 #define BTHUMB_ARCH_VERSION 3
199 
200 #elif defined(__ARM_ARCH_6T2__) \
201 || defined(__ARM_ARCH_7__) \
202 || defined(__ARM_ARCH_7A__) \
203 || defined(__ARM_ARCH_7K__) \
204 || defined(__ARM_ARCH_7M__) \
205 || defined(__ARM_ARCH_7R__) \
206 || defined(__ARM_ARCH_7S__)
207 #define BTHUMB_ARCH_VERSION 4
208 
209 /* RVCT sets __TARGET_ARCH_THUMB */
210 #elif defined(__TARGET_ARCH_THUMB)
211 #define BTHUMB_ARCH_VERSION __TARGET_ARCH_THUMB
212 
213 #else
214 #define BTHUMB_ARCH_VERSION 0
215 #endif
216 
217 /* BCPU(ARM_TRADITIONAL) - Thumb2 is not available, only traditional ARM (v4 or greater) */
218 /* BCPU(ARM_THUMB2) - Thumb2 instruction set is available */
219 /* Only one of these will be defined. */
220 #if !defined(BCPU_ARM_TRADITIONAL) &amp;&amp; !defined(BCPU_ARM_THUMB2)
221 #  if defined(thumb2) || defined(__thumb2__) \
222 || ((defined(__thumb) || defined(__thumb__)) &amp;&amp; BTHUMB_ARCH_VERSION == 4)
223 #    define BCPU_ARM_TRADITIONAL 0
224 #    define BCPU_ARM_THUMB2 1
225 #  elif BARM_ARCH_AT_LEAST(4)
226 #    define BCPU_ARM_TRADITIONAL 1
227 #    define BCPU_ARM_THUMB2 0
228 #  else
229 #    error &quot;Not supported ARM architecture&quot;
230 #  endif
231 #elif BCPU(ARM_TRADITIONAL) &amp;&amp; BCPU(ARM_THUMB2) /* Sanity Check */
232 #  error &quot;Cannot use both of BCPU_ARM_TRADITIONAL and BCPU_ARM_THUMB2 platforms&quot;
233 #endif /* !defined(BCPU_ARM_TRADITIONAL) &amp;&amp; !defined(BCPU_ARM_THUMB2) */
234 
235 #endif /* ARM */
236 
237 
238 #if BCOMPILER(GCC_COMPATIBLE)
239 /* __LP64__ is not defined on 64bit Windows since it uses LLP64. Using __SIZEOF_POINTER__ is simpler. */
240 #if __SIZEOF_POINTER__ == 8
241 #define BCPU_ADDRESS64 1
242 #elif __SIZEOF_POINTER__ == 4
243 #define BCPU_ADDRESS32 1
244 #else
245 #error &quot;Unsupported pointer width&quot;
246 #endif
247 #else
248 #error &quot;Unsupported compiler for bmalloc&quot;
249 #endif
250 
251 #if BCOMPILER(GCC_COMPATIBLE)
252 #if __BYTE_ORDER__ == __ORDER_BIG_ENDIAN__
253 #define BCPU_BIG_ENDIAN 1
254 #elif __BYTE_ORDER__ == __ORDER_LITTLE_ENDIAN__
255 #define BCPU_LITTLE_ENDIAN 1
256 #elif __BYTE_ORDER__ == __ORDER_PDP_ENDIAN__
257 #define BCPU_MIDDLE_ENDIAN 1
258 #else
259 #error &quot;Unknown endian&quot;
260 #endif
261 #else
262 #error &quot;Unsupported compiler for bmalloc&quot;
263 #endif
264 
265 #if BCPU(ADDRESS64)
266 #if (BOS(IOS) || BOS(TVOS) || BOS(WATCHOS)) &amp;&amp; BCPU(ARM64)
267 #define BOS_EFFECTIVE_ADDRESS_WIDTH 36
268 #else
269 /* We strongly assume that effective address width is &lt;= 48 in 64bit architectures (e.g. NaN boxing). */
270 #define BOS_EFFECTIVE_ADDRESS_WIDTH 48
271 #endif
272 #else
273 #define BOS_EFFECTIVE_ADDRESS_WIDTH 32
274 #endif
275 
276 #define BATTRIBUTE_PRINTF(formatStringArgument, extraArguments) __attribute__((__format__(printf, formatStringArgument, extraArguments)))
277 
278 #if BPLATFORM(MAC) || BPLATFORM(IOS_FAMILY)
279 #define BUSE_OS_LOG 1
280 #endif
281 
282 #if !defined(BUSE_EXPORT_MACROS) &amp;&amp; (BPLATFORM(MAC) || BPLATFORM(IOS_FAMILY))
283 #define BUSE_EXPORT_MACROS 1
284 #endif
285 
286 /* BUNUSED_PARAM */
287 #if !defined(BUNUSED_PARAM)
288 #define BUNUSED_PARAM(variable) (void)variable
289 #endif
290 
291 /* Enable this to put each IsoHeap and other allocation categories into their own malloc heaps, so that tools like vmmap can show how big each heap is. */
292 #define BENABLE_MALLOC_HEAP_BREAKDOWN 0
293 
294 /* This is used for debugging when hacking on how bmalloc calculates its physical footprint. */
295 #define ENABLE_PHYSICAL_PAGE_MAP 0
296 
297 #if BPLATFORM(IOS_FAMILY) &amp;&amp; (BCPU(ARM64) || BCPU(ARM))
298 #define BUSE_CHECK_NANO_MALLOC 1
299 #else
300 #define BUSE_CHECK_NANO_MALLOC 0
301 #endif
302 
303 #if BPLATFORM(MAC)
304 #define BUSE_PARTIAL_SCAVENGE 1
305 #else
306 #define BUSE_PARTIAL_SCAVENGE 0
307 #endif
308 
309 #if !defined(BUSE_PRECOMPUTED_CONSTANTS_VMPAGE4K)
310 #define BUSE_PRECOMPUTED_CONSTANTS_VMPAGE4K 1
311 #endif
312 
313 #if !defined(BUSE_PRECOMPUTED_CONSTANTS_VMPAGE16K)
314 #define BUSE_PRECOMPUTED_CONSTANTS_VMPAGE16K 1
315 #endif
    </pre>
  </body>
</html>