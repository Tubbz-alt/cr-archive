<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSGlobalObject.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSGlobalObject.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSGlobalObjectFunctions.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSGlobalObject.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  10  *  This library is distributed in the hope that it will be useful,
  11  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
  12  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  13  *  Library General Public License for more details.
  14  *
  15  *  You should have received a copy of the GNU Library General Public License
  16  *  along with this library; see the file COPYING.LIB.  If not, write to
  17  *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
  18  *  Boston, MA 02110-1301, USA.
  19  *
  20  */
  21 
  22 #pragma once
  23 
  24 #include &quot;ArrayAllocationProfile.h&quot;
  25 #include &quot;ArrayBufferSharingMode.h&quot;
  26 #include &quot;BigIntPrototype.h&quot;
  27 #include &quot;BooleanPrototype.h&quot;
  28 #include &quot;ErrorType.h&quot;
  29 #include &quot;ExceptionHelpers.h&quot;

  30 #include &quot;InternalFunction.h&quot;
  31 #include &quot;JSArray.h&quot;
  32 #include &quot;JSArrayBufferPrototype.h&quot;
  33 #include &quot;JSClassRef.h&quot;
  34 #include &quot;JSGlobalLexicalEnvironment.h&quot;
<span class="line-modified">  35 #include &quot;JSPromiseDeferred.h&quot;</span>
  36 #include &quot;JSSegmentedVariableObject.h&quot;
  37 #include &quot;JSWeakObjectMapRefInternal.h&quot;
  38 #include &quot;LazyProperty.h&quot;
  39 #include &quot;LazyClassStructure.h&quot;
  40 #include &quot;NumberPrototype.h&quot;
  41 #include &quot;ParserModes.h&quot;
  42 #include &quot;RegExpGlobalData.h&quot;
  43 #include &quot;RuntimeFlags.h&quot;
<span class="line-removed">  44 #include &quot;SpecialPointer.h&quot;</span>
  45 #include &quot;StringPrototype.h&quot;
  46 #include &quot;SymbolPrototype.h&quot;
  47 #include &quot;VM.h&quot;
  48 #include &quot;Watchpoint.h&quot;
  49 #include &lt;JavaScriptCore/JSBase.h&gt;
  50 #include &lt;array&gt;
  51 #include &lt;wtf/HashSet.h&gt;
  52 #include &lt;wtf/RetainPtr.h&gt;
  53 
  54 struct OpaqueJSClass;
  55 struct OpaqueJSClassContextData;
  56 OBJC_CLASS JSWrapperMap;
  57 
  58 namespace Inspector {
  59 class JSGlobalObjectInspectorController;
  60 }
  61 
  62 namespace JSC {
  63 class ArrayConstructor;
  64 class ArrayPrototype;

  65 class AsyncIteratorPrototype;
  66 class AsyncFunctionPrototype;
  67 class AsyncGeneratorPrototype;
  68 class AsyncGeneratorFunctionPrototype;
  69 class BooleanPrototype;
  70 class ConsoleClient;
  71 class Debugger;
  72 class ErrorConstructor;
  73 class ErrorPrototype;
  74 class EvalCodeBlock;
  75 class EvalExecutable;
  76 class FunctionConstructor;
  77 class FunctionPrototype;
  78 class GeneratorPrototype;
  79 class GeneratorFunctionPrototype;
  80 class GetterSetter;
  81 class GlobalCodeBlock;
  82 class IndirectEvalExecutable;
  83 class InputCursor;
  84 class IntlObject;
</pre>
<hr />
<pre>
 101 class LLIntOffsetsExtractor;
 102 class MapPrototype;
 103 class Microtask;
 104 class ModuleLoader;
 105 class ModuleProgramExecutable;
 106 class NativeErrorConstructorBase;
 107 class NullGetterFunction;
 108 class NullSetterFunction;
 109 class ObjectConstructor;
 110 class ProgramCodeBlock;
 111 class ProgramExecutable;
 112 class RegExpConstructor;
 113 class RegExpPrototype;
 114 class SetPrototype;
 115 class SourceCode;
 116 class SourceOrigin;
 117 class UnlinkedModuleProgramCodeBlock;
 118 class VariableEnvironment;
 119 struct ActivationStackNode;
 120 struct HashTable;

 121 
 122 #ifdef JSC_GLIB_API_ENABLED
 123 class WrapperMap;
 124 #endif
 125 
 126 template&lt;typename Watchpoint&gt; class ObjectPropertyChangeAdaptiveWatchpoint;
 127 
 128 constexpr bool typeExposedByDefault = true;
 129 
 130 #define DEFINE_STANDARD_BUILTIN(macro, upperName, lowerName) macro(upperName, lowerName, lowerName, JS ## upperName, upperName, object, typeExposedByDefault)
 131 
 132 #define FOR_EACH_SIMPLE_BUILTIN_TYPE_WITH_CONSTRUCTOR(macro) \
 133     macro(String, string, stringObject, StringObject, String, object, typeExposedByDefault) \
<span class="line-removed"> 134     macro(Map, map, map, JSMap, Map, object, typeExposedByDefault) \</span>
<span class="line-removed"> 135     macro(Set, set, set, JSSet, Set, object, typeExposedByDefault) \</span>
 136     macro(JSPromise, promise, promise, JSPromise, Promise, object, typeExposedByDefault) \
 137     macro(BigInt, bigInt, bigIntObject, BigIntObject, BigInt, object, Options::useBigInt()) \
 138     macro(WeakObjectRef, weakObjectRef, weakObjectRef, JSWeakObjectRef, WeakRef, object, Options::useWeakRefs()) \
 139 
 140 #define FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(macro) \
 141     macro(StringIterator, stringIterator, stringIterator, JSStringIterator, StringIterator, iterator, typeExposedByDefault) \
 142 
 143 #define FOR_EACH_SIMPLE_BUILTIN_TYPE(macro) \
 144     FOR_EACH_SIMPLE_BUILTIN_TYPE_WITH_CONSTRUCTOR(macro) \
 145     macro(JSInternalPromise, internalPromise, internalPromise, JSInternalPromise, InternalPromise, object, typeExposedByDefault) \
 146 
 147 #define FOR_EACH_LAZY_BUILTIN_TYPE_WITH_DECLARATION(macro) \
 148     macro(Boolean, boolean, booleanObject, BooleanObject, Boolean, object, typeExposedByDefault) \
 149     macro(Date, date, date, DateInstance, Date, object, typeExposedByDefault) \
 150     macro(Error, error, error, ErrorInstance, Error, object, typeExposedByDefault) \

 151     macro(Number, number, numberObject, NumberObject, Number, object, typeExposedByDefault) \

 152     macro(Symbol, symbol, symbolObject, SymbolObject, Symbol, object, typeExposedByDefault) \
 153     DEFINE_STANDARD_BUILTIN(macro, WeakMap, weakMap) \
 154     DEFINE_STANDARD_BUILTIN(macro, WeakSet, weakSet) \
 155 
 156 #define FOR_EACH_LAZY_BUILTIN_TYPE(macro) \
 157     FOR_EACH_LAZY_BUILTIN_TYPE_WITH_DECLARATION(macro) \
 158     macro(JSArrayBuffer, arrayBuffer, arrayBuffer, JSArrayBuffer, ArrayBuffer, object, typeExposedByDefault) \
 159 
 160 #if ENABLE(WEBASSEMBLY)
 161 #define FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(macro) \
 162     macro(WebAssemblyCompileError, webAssemblyCompileError, webAssemblyCompileError, JSWebAssemblyCompileError, CompileError, error, typeExposedByDefault) \

 163     macro(WebAssemblyInstance,     webAssemblyInstance,     webAssemblyInstance,     JSWebAssemblyInstance,     Instance,     object, typeExposedByDefault) \
 164     macro(WebAssemblyLinkError,    webAssemblyLinkError,    webAssemblyLinkError,    JSWebAssemblyLinkError,    LinkError,    error, typeExposedByDefault) \
 165     macro(WebAssemblyMemory,       webAssemblyMemory,       webAssemblyMemory,       JSWebAssemblyMemory,       Memory,       object, typeExposedByDefault) \
 166     macro(WebAssemblyModule,       webAssemblyModule,       webAssemblyModule,       JSWebAssemblyModule,       Module,       object, typeExposedByDefault) \
 167     macro(WebAssemblyRuntimeError, webAssemblyRuntimeError, webAssemblyRuntimeError, JSWebAssemblyRuntimeError, RuntimeError, error, typeExposedByDefault) \
 168     macro(WebAssemblyTable,        webAssemblyTable,        webAssemblyTable,        JSWebAssemblyTable,        Table,        object, typeExposedByDefault)
 169 #else
 170 #define FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(macro)
 171 #endif // ENABLE(WEBASSEMBLY)
 172 
 173 #define DECLARE_SIMPLE_BUILTIN_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 174     class JS ## capitalName; \
 175     class capitalName ## Prototype; \
 176     class capitalName ## Constructor;
 177 
 178 class IteratorPrototype;
 179 FOR_EACH_SIMPLE_BUILTIN_TYPE(DECLARE_SIMPLE_BUILTIN_TYPE)
 180 FOR_EACH_LAZY_BUILTIN_TYPE_WITH_DECLARATION(DECLARE_SIMPLE_BUILTIN_TYPE)
 181 FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(DECLARE_SIMPLE_BUILTIN_TYPE)
 182 FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(DECLARE_SIMPLE_BUILTIN_TYPE)
</pre>
<hr />
<pre>
 187     Reject, // When a promise is rejected without any handlers.
 188     Handle, // When a handler is added to a rejected promise for the first time.
 189 };
 190 
 191 struct GlobalObjectMethodTable {
 192     typedef bool (*SupportsRichSourceInfoFunctionPtr)(const JSGlobalObject*);
 193     SupportsRichSourceInfoFunctionPtr supportsRichSourceInfo;
 194 
 195     typedef bool (*ShouldInterruptScriptFunctionPtr)(const JSGlobalObject*);
 196     ShouldInterruptScriptFunctionPtr shouldInterruptScript;
 197 
 198     typedef RuntimeFlags (*JavaScriptRuntimeFlagsFunctionPtr)(const JSGlobalObject*);
 199     JavaScriptRuntimeFlagsFunctionPtr javaScriptRuntimeFlags;
 200 
 201     typedef void (*QueueTaskToEventLoopFunctionPtr)(JSGlobalObject&amp;, Ref&lt;Microtask&gt;&amp;&amp;);
 202     QueueTaskToEventLoopFunctionPtr queueTaskToEventLoop;
 203 
 204     typedef bool (*ShouldInterruptScriptBeforeTimeoutPtr)(const JSGlobalObject*);
 205     ShouldInterruptScriptBeforeTimeoutPtr shouldInterruptScriptBeforeTimeout;
 206 
<span class="line-modified"> 207     typedef JSInternalPromise* (*ModuleLoaderImportModulePtr)(JSGlobalObject*, ExecState*, JSModuleLoader*, JSString*, JSValue, const SourceOrigin&amp;);</span>
 208     ModuleLoaderImportModulePtr moduleLoaderImportModule;
 209 
<span class="line-modified"> 210     typedef Identifier (*ModuleLoaderResolvePtr)(JSGlobalObject*, ExecState*, JSModuleLoader*, JSValue, JSValue, JSValue);</span>
 211     ModuleLoaderResolvePtr moduleLoaderResolve;
 212 
<span class="line-modified"> 213     typedef JSInternalPromise* (*ModuleLoaderFetchPtr)(JSGlobalObject*, ExecState*, JSModuleLoader*, JSValue, JSValue, JSValue);</span>
 214     ModuleLoaderFetchPtr moduleLoaderFetch;
 215 
<span class="line-modified"> 216     typedef JSObject* (*ModuleLoaderCreateImportMetaPropertiesPtr)(JSGlobalObject*, ExecState*, JSModuleLoader*, JSValue, JSModuleRecord*, JSValue);</span>
 217     ModuleLoaderCreateImportMetaPropertiesPtr moduleLoaderCreateImportMetaProperties;
 218 
<span class="line-modified"> 219     typedef JSValue (*ModuleLoaderEvaluatePtr)(JSGlobalObject*, ExecState*, JSModuleLoader*, JSValue, JSValue, JSValue);</span>
 220     ModuleLoaderEvaluatePtr moduleLoaderEvaluate;
 221 
<span class="line-modified"> 222     typedef void (*PromiseRejectionTrackerPtr)(JSGlobalObject*, ExecState*, JSPromise*, JSPromiseRejectionOperation);</span>
 223     PromiseRejectionTrackerPtr promiseRejectionTracker;
 224 
 225     typedef String (*DefaultLanguageFunctionPtr)();
 226     DefaultLanguageFunctionPtr defaultLanguage;
 227 
<span class="line-modified"> 228     typedef void (*CompileStreamingPtr)(JSGlobalObject*, ExecState*, JSPromiseDeferred*, JSValue);</span>
 229     CompileStreamingPtr compileStreaming;
 230 
<span class="line-modified"> 231     typedef void (*InstantiateStreamingPtr)(JSGlobalObject*, ExecState*, JSPromiseDeferred*, JSValue, JSObject*);</span>
 232     InstantiateStreamingPtr instantiateStreaming;
 233 };
 234 
 235 class JSGlobalObject : public JSSegmentedVariableObject {
 236 private:
 237     typedef HashSet&lt;RefPtr&lt;OpaqueJSWeakObjectMap&gt;&gt; WeakMapSet;
 238     typedef HashMap&lt;OpaqueJSClass*, std::unique_ptr&lt;OpaqueJSClassContextData&gt;&gt; OpaqueJSClassDataMap;
 239 
 240     struct JSGlobalObjectRareData {
 241         WTF_MAKE_FAST_ALLOCATED;
 242     public:
 243         JSGlobalObjectRareData()
 244             : profileGroup(0)
 245         {
 246         }
 247 
 248         WeakMapSet weakMaps;
 249         unsigned profileGroup;
 250 
 251         OpaqueJSClassDataMap opaqueJSClassData;
 252     };
 253 




 254 // Our hashtable code-generator tries to access these properties, so we make them public.
 255 // However, we&#39;d like it better if they could be protected.
 256 public:
 257     template&lt;typename T&gt; using Initializer = typename LazyProperty&lt;JSGlobalObject, T&gt;::Initializer;
 258 
<span class="line-modified"> 259     Register m_globalCallFrame[CallFrame::headerSizeInRegisters];</span>
 260 
 261     WriteBarrier&lt;JSObject&gt; m_globalThis;
 262 
 263     WriteBarrier&lt;JSGlobalLexicalEnvironment&gt; m_globalLexicalEnvironment;
 264     WriteBarrier&lt;JSScope&gt; m_globalScopeExtension;
 265     WriteBarrier&lt;JSCallee&gt; m_globalCallee;
 266     WriteBarrier&lt;JSCallee&gt; m_stackOverflowFrameCallee;
 267 
 268     LazyClassStructure m_evalErrorStructure;
 269     LazyClassStructure m_rangeErrorStructure;
 270     LazyClassStructure m_referenceErrorStructure;
 271     LazyClassStructure m_syntaxErrorStructure;
 272     LazyClassStructure m_typeErrorStructure;
 273     LazyClassStructure m_URIErrorStructure;
 274 
 275     WriteBarrier&lt;ObjectConstructor&gt; m_objectConstructor;
 276     WriteBarrier&lt;ArrayConstructor&gt; m_arrayConstructor;


 277     WriteBarrier&lt;JSPromiseConstructor&gt; m_promiseConstructor;
 278     WriteBarrier&lt;JSInternalPromiseConstructor&gt; m_internalPromiseConstructor;
 279 
 280 #if ENABLE(INTL)
<span class="line-modified"> 281     WriteBarrier&lt;IntlCollator&gt; m_defaultCollator;</span>
 282     LazyProperty&lt;JSGlobalObject, Structure&gt; m_collatorStructure;
 283     LazyProperty&lt;JSGlobalObject, Structure&gt; m_numberFormatStructure;
 284     LazyProperty&lt;JSGlobalObject, Structure&gt; m_dateTimeFormatStructure;
 285     LazyProperty&lt;JSGlobalObject, Structure&gt; m_pluralRulesStructure;
 286 #endif
 287     WriteBarrier&lt;NullGetterFunction&gt; m_nullGetterFunction;
 288     WriteBarrier&lt;NullSetterFunction&gt; m_nullSetterFunction;
 289 
 290     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_parseIntFunction;
 291     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_parseFloatFunction;
 292 
<span class="line-removed"> 293     WriteBarrier&lt;JSFunction&gt; m_callFunction;</span>
<span class="line-removed"> 294     WriteBarrier&lt;JSFunction&gt; m_applyFunction;</span>
<span class="line-removed"> 295     WriteBarrier&lt;JSFunction&gt; m_throwTypeErrorFunction;</span>
 296     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_arrayProtoToStringFunction;
 297     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_arrayProtoValuesFunction;
 298     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_evalFunction;
<span class="line-removed"> 299     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_initializePromiseFunction;</span>
 300     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_iteratorProtocolFunction;
 301     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_promiseResolveFunction;

 302     WriteBarrier&lt;JSFunction&gt; m_objectProtoValueOfFunction;
<span class="line-removed"> 303     WriteBarrier&lt;JSFunction&gt; m_numberProtoToStringFunction;</span>
<span class="line-removed"> 304     WriteBarrier&lt;JSFunction&gt; m_newPromiseCapabilityFunction;</span>
 305     WriteBarrier&lt;JSFunction&gt; m_functionProtoHasInstanceSymbolFunction;
 306     LazyProperty&lt;JSGlobalObject, GetterSetter&gt; m_throwTypeErrorGetterSetter;
<span class="line-removed"> 307     WriteBarrier&lt;JSObject&gt; m_regExpProtoExec;</span>
 308     WriteBarrier&lt;JSObject&gt; m_regExpProtoSymbolReplace;
<span class="line-removed"> 309     WriteBarrier&lt;JSObject&gt; m_regExpProtoGlobalGetter;</span>
<span class="line-removed"> 310     WriteBarrier&lt;JSObject&gt; m_regExpProtoUnicodeGetter;</span>
 311     WriteBarrier&lt;GetterSetter&gt; m_throwTypeErrorArgumentsCalleeAndCallerGetterSetter;
 312 
 313     LazyProperty&lt;JSGlobalObject, JSModuleLoader&gt; m_moduleLoader;
 314 
 315     WriteBarrier&lt;ObjectPrototype&gt; m_objectPrototype;
 316     WriteBarrier&lt;FunctionPrototype&gt; m_functionPrototype;
 317     WriteBarrier&lt;ArrayPrototype&gt; m_arrayPrototype;
 318     WriteBarrier&lt;RegExpPrototype&gt; m_regExpPrototype;
 319     WriteBarrier&lt;IteratorPrototype&gt; m_iteratorPrototype;
 320     WriteBarrier&lt;AsyncIteratorPrototype&gt; m_asyncIteratorPrototype;
 321     WriteBarrier&lt;GeneratorFunctionPrototype&gt; m_generatorFunctionPrototype;
 322     WriteBarrier&lt;GeneratorPrototype&gt; m_generatorPrototype;
 323     WriteBarrier&lt;AsyncGeneratorPrototype&gt; m_asyncGeneratorPrototype;

 324 
 325     LazyProperty&lt;JSGlobalObject, Structure&gt; m_debuggerScopeStructure;
 326     LazyProperty&lt;JSGlobalObject, Structure&gt; m_withScopeStructure;
 327     LazyProperty&lt;JSGlobalObject, Structure&gt; m_strictEvalActivationStructure;
 328     WriteBarrier&lt;Structure&gt; m_lexicalEnvironmentStructure;
 329     LazyProperty&lt;JSGlobalObject, Structure&gt; m_moduleEnvironmentStructure;
 330     WriteBarrier&lt;Structure&gt; m_directArgumentsStructure;
 331     WriteBarrier&lt;Structure&gt; m_scopedArgumentsStructure;
 332     WriteBarrier&lt;Structure&gt; m_clonedArgumentsStructure;
 333 
 334     WriteBarrier&lt;Structure&gt; m_objectStructureForObjectConstructor;
 335 
 336     // Lists the actual structures used for having these particular indexing shapes.
 337     WriteBarrier&lt;Structure&gt; m_originalArrayStructureForIndexingShape[NumberOfArrayIndexingModes];
 338     // Lists the structures we should use during allocation for these particular indexing shapes.
 339     // These structures will differ from the originals list above when we are having a bad time.
 340     WriteBarrier&lt;Structure&gt; m_arrayStructureForIndexingShapeDuringAllocation[NumberOfArrayIndexingModes];
 341 
 342     LazyProperty&lt;JSGlobalObject, Structure&gt; m_callbackConstructorStructure;
 343     LazyProperty&lt;JSGlobalObject, Structure&gt; m_callbackFunctionStructure;
</pre>
<hr />
<pre>
 348 #endif
 349 #ifdef JSC_GLIB_API_ENABLED
 350     LazyProperty&lt;JSGlobalObject, Structure&gt; m_glibCallbackFunctionStructure;
 351     LazyProperty&lt;JSGlobalObject, Structure&gt; m_glibWrapperObjectStructure;
 352 #endif
 353     WriteBarrier&lt;Structure&gt; m_nullPrototypeObjectStructure;
 354     WriteBarrier&lt;Structure&gt; m_calleeStructure;
 355 
 356     WriteBarrier&lt;Structure&gt; m_hostFunctionStructure;
 357 
 358     struct FunctionStructures {
 359         WriteBarrier&lt;Structure&gt; arrowFunctionStructure;
 360         WriteBarrier&lt;Structure&gt; sloppyFunctionStructure;
 361         WriteBarrier&lt;Structure&gt; strictFunctionStructure;
 362     };
 363     FunctionStructures m_builtinFunctions;
 364     FunctionStructures m_ordinaryFunctions;
 365 
 366     LazyProperty&lt;JSGlobalObject, Structure&gt; m_boundFunctionStructure;
 367     LazyProperty&lt;JSGlobalObject, Structure&gt; m_customGetterSetterFunctionStructure;
<span class="line-removed"> 368     WriteBarrier&lt;Structure&gt; m_getterSetterStructure;</span>
 369     LazyProperty&lt;JSGlobalObject, Structure&gt; m_nativeStdFunctionStructure;
 370     PropertyOffset m_functionNameOffset;
 371     WriteBarrier&lt;Structure&gt; m_regExpStructure;
 372     WriteBarrier&lt;AsyncFunctionPrototype&gt; m_asyncFunctionPrototype;
 373     WriteBarrier&lt;AsyncGeneratorFunctionPrototype&gt; m_asyncGeneratorFunctionPrototype;
 374     WriteBarrier&lt;Structure&gt; m_asyncFunctionStructure;
 375     WriteBarrier&lt;Structure&gt; m_asyncGeneratorFunctionStructure;
 376     WriteBarrier&lt;Structure&gt; m_generatorFunctionStructure;



 377     LazyProperty&lt;JSGlobalObject, Structure&gt; m_iteratorResultObjectStructure;
 378     WriteBarrier&lt;Structure&gt; m_regExpMatchesArrayStructure;
<span class="line-removed"> 379     WriteBarrier&lt;Structure&gt; m_regExpMatchesArrayWithGroupsStructure;</span>
 380     LazyProperty&lt;JSGlobalObject, Structure&gt; m_moduleRecordStructure;
 381     LazyProperty&lt;JSGlobalObject, Structure&gt; m_moduleNamespaceObjectStructure;
 382     LazyProperty&lt;JSGlobalObject, Structure&gt; m_proxyObjectStructure;
 383     LazyProperty&lt;JSGlobalObject, Structure&gt; m_callableProxyObjectStructure;
 384     LazyProperty&lt;JSGlobalObject, Structure&gt; m_proxyRevokeStructure;
 385 #if ENABLE(SHARED_ARRAY_BUFFER)
 386     WriteBarrier&lt;JSArrayBufferPrototype&gt; m_sharedArrayBufferPrototype;
 387     WriteBarrier&lt;Structure&gt; m_sharedArrayBufferStructure;
 388 #endif
 389 
 390 #define DEFINE_STORAGE_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 391     WriteBarrier&lt;capitalName ## Prototype&gt; m_ ## lowerName ## Prototype; \
 392     WriteBarrier&lt;Structure&gt; m_ ## properName ## Structure;
 393 
 394 #define DEFINE_STORAGE_FOR_LAZY_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 395     LazyClassStructure m_ ## properName ## Structure;
 396 
 397     FOR_EACH_SIMPLE_BUILTIN_TYPE(DEFINE_STORAGE_FOR_SIMPLE_TYPE)
 398     FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(DEFINE_STORAGE_FOR_SIMPLE_TYPE)
 399 
 400 #if ENABLE(WEBASSEMBLY)
 401     LazyProperty&lt;JSGlobalObject, Structure&gt; m_webAssemblyModuleRecordStructure;
 402     LazyProperty&lt;JSGlobalObject, Structure&gt; m_webAssemblyFunctionStructure;
 403     LazyProperty&lt;JSGlobalObject, Structure&gt; m_jsToWasmICCalleeStructure;
 404     LazyProperty&lt;JSGlobalObject, Structure&gt; m_webAssemblyWrapperFunctionStructure;
<span class="line-removed"> 405     LazyProperty&lt;JSGlobalObject, Structure&gt; m_webAssemblyToJSCalleeStructure;</span>
 406     FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(DEFINE_STORAGE_FOR_LAZY_TYPE)
 407 #endif // ENABLE(WEBASSEMBLY)
 408 
 409     FOR_EACH_LAZY_BUILTIN_TYPE(DEFINE_STORAGE_FOR_LAZY_TYPE)
 410 
 411 #undef DEFINE_STORAGE_FOR_SIMPLE_TYPE
 412 #undef DEFINE_STORAGE_FOR_LAZY_TYPE
 413 
 414     WriteBarrier&lt;GetterSetter&gt; m_speciesGetterSetter;
 415 
 416     LazyProperty&lt;JSGlobalObject, JSTypedArrayViewPrototype&gt; m_typedArrayProto;
 417     LazyProperty&lt;JSGlobalObject, JSTypedArrayViewConstructor&gt; m_typedArraySuperConstructor;
 418 
 419 #define DECLARE_TYPED_ARRAY_TYPE_STRUCTURE(name) LazyClassStructure m_typedArray ## name;
 420     FOR_EACH_TYPED_ARRAY_TYPE(DECLARE_TYPED_ARRAY_TYPE_STRUCTURE)
 421 #undef DECLARE_TYPED_ARRAY_TYPE_STRUCTURE
 422 
<span class="line-modified"> 423     JSCell* m_specialPointers[Special::TableSize]; // Special pointers used by the LLInt and JIT.</span>
<span class="line-removed"> 424     JSCell* m_linkTimeConstants[LinkTimeConstantCount];</span>
 425 
 426     String m_name;
 427 
 428     Strong&lt;JSObject&gt; m_unhandledRejectionCallback;
 429 
 430     Debugger* m_debugger;
 431 
<span class="line-removed"> 432     VM&amp; m_vm;</span>
<span class="line-removed"> 433 </span>
 434 #if ENABLE(REMOTE_INSPECTOR)
 435     std::unique_ptr&lt;Inspector::JSGlobalObjectInspectorController&gt; m_inspectorController;
 436     std::unique_ptr&lt;JSGlobalObjectDebuggable&gt; m_inspectorDebuggable;
 437 #endif
 438 
<span class="line-removed"> 439 #if ENABLE(INTL)</span>
<span class="line-removed"> 440     HashSet&lt;String&gt; m_intlCollatorAvailableLocales;</span>
<span class="line-removed"> 441     HashSet&lt;String&gt; m_intlDateTimeFormatAvailableLocales;</span>
<span class="line-removed"> 442     HashSet&lt;String&gt; m_intlNumberFormatAvailableLocales;</span>
<span class="line-removed"> 443     HashSet&lt;String&gt; m_intlPluralRulesAvailableLocales;</span>
<span class="line-removed"> 444 #endif // ENABLE(INTL)</span>
<span class="line-removed"> 445 </span>
 446     RefPtr&lt;WatchpointSet&gt; m_masqueradesAsUndefinedWatchpoint;
 447     RefPtr&lt;WatchpointSet&gt; m_havingABadTimeWatchpoint;
 448     RefPtr&lt;WatchpointSet&gt; m_varInjectionWatchpoint;
 449 
 450     std::unique_ptr&lt;JSGlobalObjectRareData&gt; m_rareData;
 451 
 452     WeakRandom m_weakRandom;
 453     RegExpGlobalData m_regExpGlobalData;
 454 
 455     JSCallee* stackOverflowFrameCallee() const { return m_stackOverflowFrameCallee.get(); }
 456 
 457     InlineWatchpointSet&amp; arrayIteratorProtocolWatchpointSet() { return m_arrayIteratorProtocolWatchpointSet; }
 458     InlineWatchpointSet&amp; mapIteratorProtocolWatchpointSet() { return m_mapIteratorProtocolWatchpointSet; }
 459     InlineWatchpointSet&amp; setIteratorProtocolWatchpointSet() { return m_setIteratorProtocolWatchpointSet; }
 460     InlineWatchpointSet&amp; stringIteratorProtocolWatchpointSet() { return m_stringIteratorProtocolWatchpointSet; }
 461     InlineWatchpointSet&amp; mapSetWatchpointSet() { return m_mapSetWatchpointSet; }
 462     InlineWatchpointSet&amp; setAddWatchpointSet() { return m_setAddWatchpointSet; }
 463     InlineWatchpointSet&amp; arraySpeciesWatchpointSet() { return m_arraySpeciesWatchpointSet; }
 464     InlineWatchpointSet&amp; arrayJoinWatchpointSet() { return m_arrayJoinWatchpointSet; }
 465     InlineWatchpointSet&amp; numberToStringWatchpointSet()
</pre>
<hr />
<pre>
 498     bool isSetPrototypeIteratorProtocolFastAndNonObservable();
 499     bool isStringPrototypeIteratorProtocolFastAndNonObservable();
 500     bool isMapPrototypeSetFastAndNonObservable();
 501     bool isSetPrototypeAddFastAndNonObservable();
 502 
 503 #if ENABLE(DFG_JIT)
 504     using ReferencedGlobalPropertyWatchpointSets = HashMap&lt;RefPtr&lt;UniquedStringImpl&gt;, Ref&lt;WatchpointSet&gt;, IdentifierRepHash&gt;;
 505     ReferencedGlobalPropertyWatchpointSets m_referencedGlobalPropertyWatchpointSets;
 506     ConcurrentJSLock m_referencedGlobalPropertyWatchpointSetsLock;
 507 #endif
 508 
 509     bool m_evalEnabled { true };
 510     bool m_webAssemblyEnabled { true };
 511     unsigned m_globalLexicalBindingEpoch { 1 };
 512     String m_evalDisabledErrorMessage;
 513     String m_webAssemblyDisabledErrorMessage;
 514     RuntimeFlags m_runtimeFlags;
 515     ConsoleClient* m_consoleClient { nullptr };
 516     Optional&lt;unsigned&gt; m_stackTraceLimit;
 517 
<span class="line-modified"> 518 #if !ASSERT_DISABLED</span>
<span class="line-modified"> 519     const ExecState* m_callFrameAtDebuggerEntry { nullptr };</span>
 520 #endif
 521 
 522     static JS_EXPORT_PRIVATE const GlobalObjectMethodTable s_globalObjectMethodTable;
 523     const GlobalObjectMethodTable* m_globalObjectMethodTable;
 524 
 525     void createRareDataIfNeeded()
 526     {
 527         if (m_rareData)
 528             return;
 529         m_rareData = makeUnique&lt;JSGlobalObjectRareData&gt;();
 530     }
 531 
 532 public:
<span class="line-modified"> 533     typedef JSSegmentedVariableObject Base;</span>
<span class="line-modified"> 534     static const unsigned StructureFlags = Base::StructureFlags | HasStaticPropertyTable | OverridesGetOwnPropertySlot | OverridesGetPropertyNames | IsImmutablePrototypeExoticObject;</span>







 535 
 536     JS_EXPORT_PRIVATE static JSGlobalObject* create(VM&amp;, Structure*);
 537 
 538     DECLARE_EXPORT_INFO;
 539 
 540     bool hasDebugger() const;
 541     bool hasInteractiveDebugger() const;
 542     const RuntimeFlags&amp; runtimeFlags() const { return m_runtimeFlags; }
 543 
 544 #if ENABLE(DFG_JIT)
 545     WatchpointSet* getReferencedPropertyWatchpointSet(UniquedStringImpl*);
 546     WatchpointSet&amp; ensureReferencedPropertyWatchpointSet(UniquedStringImpl*);
 547 #endif
 548 
 549     Optional&lt;unsigned&gt; stackTraceLimit() const { return m_stackTraceLimit; }
 550     void setStackTraceLimit(Optional&lt;unsigned&gt; value) { m_stackTraceLimit = value; }
 551 
 552 protected:
 553     JS_EXPORT_PRIVATE explicit JSGlobalObject(VM&amp;, Structure*, const GlobalObjectMethodTable* = nullptr);
 554 
 555     JS_EXPORT_PRIVATE void finishCreation(VM&amp;);
 556 
 557     JS_EXPORT_PRIVATE void finishCreation(VM&amp;, JSObject*);
 558 
 559     void addGlobalVar(const Identifier&amp;);
 560 
 561 public:
 562     JS_EXPORT_PRIVATE ~JSGlobalObject();
 563     JS_EXPORT_PRIVATE static void destroy(JSCell*);
 564 
 565     JS_EXPORT_PRIVATE static void visitChildren(JSCell*, SlotVisitor&amp;);
 566 
<span class="line-modified"> 567     JS_EXPORT_PRIVATE static bool getOwnPropertySlot(JSObject*, ExecState*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified"> 568     JS_EXPORT_PRIVATE static bool put(JSCell*, ExecState*, PropertyName, JSValue, PutPropertySlot&amp;);</span>
 569 
<span class="line-modified"> 570     JS_EXPORT_PRIVATE static void defineGetter(JSObject*, ExecState*, PropertyName, JSObject* getterFunc, unsigned attributes);</span>
<span class="line-modified"> 571     JS_EXPORT_PRIVATE static void defineSetter(JSObject*, ExecState*, PropertyName, JSObject* setterFunc, unsigned attributes);</span>
<span class="line-modified"> 572     JS_EXPORT_PRIVATE static bool defineOwnProperty(JSObject*, ExecState*, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow);</span>
 573 
<span class="line-modified"> 574     void addVar(ExecState* exec, const Identifier&amp; propertyName)</span>
 575     {
<span class="line-modified"> 576         if (!hasOwnProperty(exec, propertyName))</span>
 577             addGlobalVar(propertyName);
 578     }
<span class="line-modified"> 579     void addFunction(ExecState*, const Identifier&amp;);</span>
 580 
 581     JSScope* globalScope() { return m_globalLexicalEnvironment.get(); }
 582     JSGlobalLexicalEnvironment* globalLexicalEnvironment() { return m_globalLexicalEnvironment.get(); }
 583 
 584     JSScope* globalScopeExtension() { return m_globalScopeExtension.get(); }
 585     void setGlobalScopeExtension(JSScope*);
 586     void clearGlobalScopeExtension();
 587 


 588     // The following accessors return pristine values, even if a script
 589     // replaces the global object&#39;s associated property.
 590 
 591     GetterSetter* speciesGetterSetter() const { return m_speciesGetterSetter.get(); }
 592 
 593     ArrayConstructor* arrayConstructor() const { return m_arrayConstructor.get(); }

 594     ObjectConstructor* objectConstructor() const { return m_objectConstructor.get(); }

 595     JSPromiseConstructor* promiseConstructor() const { return m_promiseConstructor.get(); }
 596     JSInternalPromiseConstructor* internalPromiseConstructor() const { return m_internalPromiseConstructor.get(); }
 597 
 598 #if ENABLE(INTL)
<span class="line-modified"> 599     IntlCollator* defaultCollator(ExecState*);</span>
 600 #endif
 601 
 602     NullGetterFunction* nullGetterFunction() const { return m_nullGetterFunction.get(); }
 603     NullSetterFunction* nullSetterFunction() const { return m_nullSetterFunction.get(); }
 604 
 605     JSFunction* parseIntFunction() const { return m_parseIntFunction.get(this); }
 606     JSFunction* parseFloatFunction() const { return m_parseFloatFunction.get(this); }
 607 
 608     JSFunction* evalFunction() const { return m_evalFunction.get(this); }
<span class="line-modified"> 609     JSFunction* callFunction() const { return m_callFunction.get(); }</span>
<span class="line-removed"> 610     JSFunction* applyFunction() const { return m_applyFunction.get(); }</span>
<span class="line-removed"> 611     JSFunction* throwTypeErrorFunction() const { return m_throwTypeErrorFunction.get(); }</span>
 612     JSFunction* arrayProtoToStringFunction() const { return m_arrayProtoToStringFunction.get(this); }
 613     JSFunction* arrayProtoValuesFunction() const { return m_arrayProtoValuesFunction.get(this); }
<span class="line-removed"> 614     JSFunction* initializePromiseFunction() const { return m_initializePromiseFunction.get(this); }</span>
 615     JSFunction* iteratorProtocolFunction() const { return m_iteratorProtocolFunction.get(this); }

 616     JSFunction* promiseResolveFunction() const { return m_promiseResolveFunction.get(this); }



 617     JSFunction* objectProtoValueOfFunction() const { return m_objectProtoValueOfFunction.get(); }
<span class="line-modified"> 618     JSFunction* numberProtoToStringFunction() const { return m_numberProtoToStringFunction.get(); }</span>
<span class="line-removed"> 619     JSFunction* newPromiseCapabilityFunction() const { return m_newPromiseCapabilityFunction.get(); }</span>
 620     JSFunction* functionProtoHasInstanceSymbolFunction() const { return m_functionProtoHasInstanceSymbolFunction.get(); }
<span class="line-modified"> 621     JSObject* regExpProtoExecFunction() const { return m_regExpProtoExec.get(); }</span>
 622     JSObject* regExpProtoSymbolReplaceFunction() const { return m_regExpProtoSymbolReplace.get(); }
<span class="line-modified"> 623     JSObject* regExpProtoGlobalGetter() const { return m_regExpProtoGlobalGetter.get(); }</span>
<span class="line-modified"> 624     JSObject* regExpProtoUnicodeGetter() const { return m_regExpProtoUnicodeGetter.get(); }</span>
 625     GetterSetter* throwTypeErrorArgumentsCalleeAndCallerGetterSetter()
 626     {
 627         return m_throwTypeErrorArgumentsCalleeAndCallerGetterSetter.get();
 628     }
 629 
 630     JSModuleLoader* moduleLoader() const { return m_moduleLoader.get(this); }
 631 
 632     ObjectPrototype* objectPrototype() const { return m_objectPrototype.get(); }
 633     FunctionPrototype* functionPrototype() const { return m_functionPrototype.get(); }
 634     ArrayPrototype* arrayPrototype() const { return m_arrayPrototype.get(); }
 635     JSObject* booleanPrototype() const { return m_booleanObjectStructure.prototypeInitializedOnMainThread(this); }
 636     StringPrototype* stringPrototype() const { return m_stringPrototype.get(); }
 637     JSObject* numberPrototype() const { return m_numberObjectStructure.prototypeInitializedOnMainThread(this); }
 638     BigIntPrototype* bigIntPrototype() const { return m_bigIntPrototype.get(); }
 639     JSObject* datePrototype() const { return m_dateStructure.prototype(this); }
 640     JSObject* symbolPrototype() const { return m_symbolObjectStructure.prototypeInitializedOnMainThread(this); }
 641     RegExpPrototype* regExpPrototype() const { return m_regExpPrototype.get(); }
 642     JSObject* errorPrototype() const { return m_errorStructure.prototype(this); }
 643     IteratorPrototype* iteratorPrototype() const { return m_iteratorPrototype.get(); }
 644     AsyncIteratorPrototype* asyncIteratorPrototype() const { return m_asyncIteratorPrototype.get(); }
 645     GeneratorFunctionPrototype* generatorFunctionPrototype() const { return m_generatorFunctionPrototype.get(); }
 646     GeneratorPrototype* generatorPrototype() const { return m_generatorPrototype.get(); }
 647     AsyncFunctionPrototype* asyncFunctionPrototype() const { return m_asyncFunctionPrototype.get(); }
<span class="line-modified"> 648     MapPrototype* mapPrototype() const { return m_mapPrototype.get(); }</span>

 649     // Workaround for the name conflict between JSCell::setPrototype.
<span class="line-modified"> 650     SetPrototype* jsSetPrototype() const { return m_setPrototype.get(); }</span>
 651     JSPromisePrototype* promisePrototype() const { return m_promisePrototype.get(); }
 652     AsyncGeneratorPrototype* asyncGeneratorPrototype() const { return m_asyncGeneratorPrototype.get(); }
 653     AsyncGeneratorFunctionPrototype* asyncGeneratorFunctionPrototype() const { return m_asyncGeneratorFunctionPrototype.get(); }
 654 
 655     Structure* debuggerScopeStructure() const { return m_debuggerScopeStructure.get(this); }
 656     Structure* withScopeStructure() const { return m_withScopeStructure.get(this); }
 657     Structure* strictEvalActivationStructure() const { return m_strictEvalActivationStructure.get(this); }
 658     Structure* activationStructure() const { return m_lexicalEnvironmentStructure.get(); }
 659     Structure* moduleEnvironmentStructure() const { return m_moduleEnvironmentStructure.get(this); }
 660     Structure* directArgumentsStructure() const { return m_directArgumentsStructure.get(); }
 661     Structure* scopedArgumentsStructure() const { return m_scopedArgumentsStructure.get(); }
 662     Structure* clonedArgumentsStructure() const { return m_clonedArgumentsStructure.get(); }
 663     Structure* objectStructureForObjectConstructor() const { return m_objectStructureForObjectConstructor.get(); }
 664     Structure* originalArrayStructureForIndexingType(IndexingType indexingType) const
 665     {
 666         ASSERT(indexingType &amp; IsArray);
 667         return m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(indexingType)].get();
 668     }
 669     Structure* arrayStructureForIndexingTypeDuringAllocation(IndexingType indexingType) const
 670     {
 671         ASSERT(indexingType &amp; IsArray);
 672         return m_arrayStructureForIndexingShapeDuringAllocation[arrayIndexFromIndexingType(indexingType)].get();
 673     }
<span class="line-modified"> 674     Structure* arrayStructureForIndexingTypeDuringAllocation(ExecState* exec, IndexingType indexingType, JSValue newTarget) const</span>
<span class="line-modified"> 675     {</span>
<span class="line-removed"> 676         return InternalFunction::createSubclassStructure(exec, newTarget, arrayStructureForIndexingTypeDuringAllocation(indexingType));</span>
<span class="line-removed"> 677     }</span>
<span class="line-removed"> 678     Structure* arrayStructureForProfileDuringAllocation(ExecState* exec, ArrayAllocationProfile* profile, JSValue newTarget) const</span>
 679     {
<span class="line-modified"> 680         return arrayStructureForIndexingTypeDuringAllocation(exec, ArrayAllocationProfile::selectIndexingTypeFor(profile), newTarget);</span>
 681     }
 682 
 683     bool isOriginalArrayStructure(Structure* structure)
 684     {
 685         return originalArrayStructureForIndexingType(structure-&gt;indexingMode() | IsArray) == structure;
 686     }
 687 
 688     Structure* booleanObjectStructure() const { return m_booleanObjectStructure.get(this); }
 689     Structure* callbackConstructorStructure() const { return m_callbackConstructorStructure.get(this); }
 690     Structure* callbackFunctionStructure() const { return m_callbackFunctionStructure.get(this); }
 691     Structure* callbackObjectStructure() const { return m_callbackObjectStructure.get(this); }
 692 #if JSC_OBJC_API_ENABLED
 693     Structure* objcCallbackFunctionStructure() const { return m_objcCallbackFunctionStructure.get(this); }
 694     Structure* objcWrapperObjectStructure() const { return m_objcWrapperObjectStructure.get(this); }
 695 #endif
 696 #ifdef JSC_GLIB_API_ENABLED
 697     Structure* glibCallbackFunctionStructure() const { return m_glibCallbackFunctionStructure.get(this); }
 698     Structure* glibWrapperObjectStructure() const { return m_glibWrapperObjectStructure.get(this); }
 699 #endif
 700     Structure* dateStructure() const { return m_dateStructure.get(this); }
</pre>
<hr />
<pre>
 729     {
 730         if (isBuiltin)
 731             return m_builtinFunctions.arrowFunctionStructure.get();
 732         return m_ordinaryFunctions.arrowFunctionStructure.get();
 733     }
 734     Structure* sloppyFunctionStructure(bool isBuiltin) const
 735     {
 736         if (isBuiltin)
 737             return m_builtinFunctions.sloppyFunctionStructure.get();
 738         return m_ordinaryFunctions.sloppyFunctionStructure.get();
 739     }
 740     Structure* strictFunctionStructure(bool isBuiltin) const
 741     {
 742         if (isBuiltin)
 743             return m_builtinFunctions.strictFunctionStructure.get();
 744         return m_ordinaryFunctions.strictFunctionStructure.get();
 745     }
 746 
 747     Structure* boundFunctionStructure() const { return m_boundFunctionStructure.get(this); }
 748     Structure* customGetterSetterFunctionStructure() const { return m_customGetterSetterFunctionStructure.get(this); }
<span class="line-removed"> 749     Structure* getterSetterStructure() const { return m_getterSetterStructure.get(); }</span>
 750     Structure* nativeStdFunctionStructure() const { return m_nativeStdFunctionStructure.get(this); }
 751     PropertyOffset functionNameOffset() const { return m_functionNameOffset; }
 752     Structure* numberObjectStructure() const { return m_numberObjectStructure.get(this); }
<span class="line-removed"> 753     Structure* mapStructure() const { return m_mapStructure.get(); }</span>
 754     Structure* regExpStructure() const { return m_regExpStructure.get(); }


 755     Structure* generatorFunctionStructure() const { return m_generatorFunctionStructure.get(); }
 756     Structure* asyncFunctionStructure() const { return m_asyncFunctionStructure.get(); }
 757     Structure* asyncGeneratorFunctionStructure() const { return m_asyncGeneratorFunctionStructure.get(); }

 758     Structure* stringObjectStructure() const { return m_stringObjectStructure.get(); }
 759     Structure* iteratorResultObjectStructure() const { return m_iteratorResultObjectStructure.get(this); }
 760     Structure* regExpMatchesArrayStructure() const { return m_regExpMatchesArrayStructure.get(); }
<span class="line-removed"> 761     Structure* regExpMatchesArrayWithGroupsStructure() const { return m_regExpMatchesArrayWithGroupsStructure.get(); }</span>
 762     Structure* moduleRecordStructure() const { return m_moduleRecordStructure.get(this); }
 763     Structure* moduleNamespaceObjectStructure() const { return m_moduleNamespaceObjectStructure.get(this); }
 764     Structure* proxyObjectStructure() const { return m_proxyObjectStructure.get(this); }
 765     Structure* callableProxyObjectStructure() const { return m_callableProxyObjectStructure.get(this); }
 766     Structure* proxyRevokeStructure() const { return m_proxyRevokeStructure.get(this); }
 767     Structure* restParameterStructure() const { return arrayStructureForIndexingTypeDuringAllocation(ArrayWithContiguous); }
 768     Structure* originalRestParameterStructure() const { return originalArrayStructureForIndexingType(ArrayWithContiguous); }
 769 #if ENABLE(WEBASSEMBLY)
 770     Structure* webAssemblyModuleRecordStructure() const { return m_webAssemblyModuleRecordStructure.get(this); }
 771     Structure* webAssemblyFunctionStructure() const { return m_webAssemblyFunctionStructure.get(this); }
 772     Structure* jsToWasmICCalleeStructure() const { return m_jsToWasmICCalleeStructure.get(this); }
 773     Structure* webAssemblyWrapperFunctionStructure() const { return m_webAssemblyWrapperFunctionStructure.get(this); }
<span class="line-removed"> 774     Structure* webAssemblyToJSCalleeStructure() const { return m_webAssemblyToJSCalleeStructure.get(this); }</span>
 775 #endif // ENABLE(WEBASSEMBLY)
 776 #if ENABLE(INTL)
 777     Structure* collatorStructure() { return m_collatorStructure.get(this); }
 778     Structure* numberFormatStructure() { return m_numberFormatStructure.get(this); }
 779     Structure* dateTimeFormatStructure() { return m_dateTimeFormatStructure.get(this); }
 780     Structure* pluralRulesStructure() { return m_pluralRulesStructure.get(this); }
 781 #endif // ENABLE(INTL)
 782 
 783     JS_EXPORT_PRIVATE void setRemoteDebuggingEnabled(bool);
 784     JS_EXPORT_PRIVATE bool remoteDebuggingEnabled() const;
 785 
 786     RegExpGlobalData&amp; regExpGlobalData() { return m_regExpGlobalData; }
 787     static ptrdiff_t regExpGlobalDataOffset() { return OBJECT_OFFSETOF(JSGlobalObject, m_regExpGlobalData); }
 788 
 789 #if ENABLE(REMOTE_INSPECTOR)
 790     Inspector::JSGlobalObjectInspectorController&amp; inspectorController() const { return *m_inspectorController.get(); }
 791     JSGlobalObjectDebuggable&amp; inspectorDebuggable() { return *m_inspectorDebuggable.get(); }
 792 #endif
 793 
<span class="line-removed"> 794 #if ENABLE(INTL)</span>
<span class="line-removed"> 795     const HashSet&lt;String&gt;&amp; intlCollatorAvailableLocales();</span>
<span class="line-removed"> 796     const HashSet&lt;String&gt;&amp; intlDateTimeFormatAvailableLocales();</span>
<span class="line-removed"> 797     const HashSet&lt;String&gt;&amp; intlNumberFormatAvailableLocales();</span>
<span class="line-removed"> 798     const HashSet&lt;String&gt;&amp; intlPluralRulesAvailableLocales();</span>
<span class="line-removed"> 799 #endif // ENABLE(INTL)</span>
<span class="line-removed"> 800 </span>
 801     void bumpGlobalLexicalBindingEpoch(VM&amp;);
 802     unsigned globalLexicalBindingEpoch() const { return m_globalLexicalBindingEpoch; }
 803     static ptrdiff_t globalLexicalBindingEpochOffset() { return OBJECT_OFFSETOF(JSGlobalObject, m_globalLexicalBindingEpoch); }
 804     unsigned* addressOfGlobalLexicalBindingEpoch() { return &amp;m_globalLexicalBindingEpoch; }
 805 
 806     void setConsoleClient(ConsoleClient* consoleClient) { m_consoleClient = consoleClient; }
 807     ConsoleClient* consoleClient() const { return m_consoleClient; }
 808 
 809     void setName(const String&amp;);
 810     const String&amp; name() const { return m_name; }
 811 
 812     void setUnhandledRejectionCallback(VM&amp; vm, JSObject* function) { m_unhandledRejectionCallback.set(vm, function); }
 813     JSObject* unhandledRejectionCallback() const { return m_unhandledRejectionCallback.get(); }
 814 
 815     JSObject* arrayBufferConstructor() const { return m_arrayBufferStructure.constructor(this); }
 816 
 817     JSObject* arrayBufferPrototype(ArrayBufferSharingMode sharingMode) const
 818     {
 819         switch (sharingMode) {
 820         case ArrayBufferSharingMode::Default:
</pre>
<hr />
<pre>
 884     {
 885         return lazyTypedArrayStructure(type).get(this);
 886     }
 887     Structure* typedArrayStructureConcurrently(TypedArrayType type) const
 888     {
 889         return lazyTypedArrayStructure(type).getConcurrently();
 890     }
 891     bool isOriginalTypedArrayStructure(Structure* structure)
 892     {
 893         TypedArrayType type = structure-&gt;classInfo()-&gt;typedArrayStorageType;
 894         if (type == NotTypedArray)
 895             return false;
 896         return typedArrayStructureConcurrently(type) == structure;
 897     }
 898 
 899     JSObject* typedArrayConstructor(TypedArrayType type) const
 900     {
 901         return lazyTypedArrayStructure(type).constructor(this);
 902     }
 903 
<span class="line-modified"> 904     JSCell* actualPointerFor(Special::Pointer pointer)</span>
<span class="line-removed"> 905     {</span>
<span class="line-removed"> 906         ASSERT(pointer &lt; Special::TableSize);</span>
<span class="line-removed"> 907         return m_specialPointers[pointer];</span>
<span class="line-removed"> 908     }</span>
<span class="line-removed"> 909     JSCell* jsCellForLinkTimeConstant(LinkTimeConstant type)</span>
 910     {
<span class="line-modified"> 911         unsigned index = static_cast&lt;unsigned&gt;(type);</span>
<span class="line-modified"> 912         ASSERT(index &lt; LinkTimeConstantCount);</span>
<span class="line-modified"> 913         return m_linkTimeConstants[index];</span>
 914     }
 915 
 916     WatchpointSet* masqueradesAsUndefinedWatchpoint() { return m_masqueradesAsUndefinedWatchpoint.get(); }
 917     WatchpointSet* havingABadTimeWatchpoint() { return m_havingABadTimeWatchpoint.get(); }
 918     WatchpointSet* varInjectionWatchpoint() { return m_varInjectionWatchpoint.get(); }
 919 
 920     bool isHavingABadTime() const
 921     {
 922         return m_havingABadTimeWatchpoint-&gt;hasBeenInvalidated();
 923     }
 924 
 925     void haveABadTime(VM&amp;);
 926 
 927     bool objectPrototypeIsSane();
 928     bool arrayPrototypeChainIsSane();
 929     bool stringPrototypeChainIsSane();
 930 
 931     void setProfileGroup(unsigned value) { createRareDataIfNeeded(); m_rareData-&gt;profileGroup = value; }
 932     unsigned profileGroup() const
 933     {
 934         if (!m_rareData)
 935             return 0;
 936         return m_rareData-&gt;profileGroup;
 937     }
 938 
 939     Debugger* debugger() const { return m_debugger; }
 940     void setDebugger(Debugger*);
 941 
 942     const GlobalObjectMethodTable* globalObjectMethodTable() const { return m_globalObjectMethodTable; }
 943 
<span class="line-modified"> 944     static bool supportsRichSourceInfo(const JSGlobalObject*) { return true; }</span>
 945 
<span class="line-modified"> 946     JS_EXPORT_PRIVATE ExecState* globalExec();</span>
 947 
 948     static bool shouldInterruptScript(const JSGlobalObject*) { return true; }
 949     static bool shouldInterruptScriptBeforeTimeout(const JSGlobalObject*) { return false; }
 950     static RuntimeFlags javaScriptRuntimeFlags(const JSGlobalObject*) { return RuntimeFlags(); }
 951 
 952     JS_EXPORT_PRIVATE void queueMicrotask(Ref&lt;Microtask&gt;&amp;&amp;);
 953 
 954     bool evalEnabled() const { return m_evalEnabled; }
 955     bool webAssemblyEnabled() const { return m_webAssemblyEnabled; }
 956     const String&amp; evalDisabledErrorMessage() const { return m_evalDisabledErrorMessage; }
 957     const String&amp; webAssemblyDisabledErrorMessage() const { return m_webAssemblyDisabledErrorMessage; }
 958     void setEvalEnabled(bool enabled, const String&amp; errorMessage = String())
 959     {
 960         m_evalEnabled = enabled;
 961         m_evalDisabledErrorMessage = errorMessage;
 962     }
 963     void setWebAssemblyEnabled(bool enabled, const String&amp; errorMessage = String())
 964     {
 965         m_webAssemblyEnabled = enabled;
 966         m_webAssemblyDisabledErrorMessage = errorMessage;
 967     }
 968 
<span class="line-modified"> 969 #if !ASSERT_DISABLED</span>
<span class="line-modified"> 970     const ExecState* callFrameAtDebuggerEntry() const { return m_callFrameAtDebuggerEntry; }</span>
<span class="line-modified"> 971     void setCallFrameAtDebuggerEntry(const ExecState* callFrame) { m_callFrameAtDebuggerEntry = callFrame; }</span>
 972 #endif
 973 
 974     void resetPrototype(VM&amp;, JSValue prototype);
 975 
<span class="line-modified"> 976     VM&amp; vm() const { return m_vm; }</span>
 977     JSObject* globalThis() const;
 978     WriteBarrier&lt;JSObject&gt;* addressOfGlobalThis() { return &amp;m_globalThis; }
 979     OptionSet&lt;CodeGenerationMode&gt; defaultCodeGenerationMode() const;
 980 
 981     static Structure* createStructure(VM&amp; vm, JSValue prototype)
 982     {
 983         Structure* result = Structure::create(vm, 0, prototype, TypeInfo(GlobalObjectType, StructureFlags), info());
 984         result-&gt;setTransitionWatchpointIsLikelyToBeFired(true);
 985         return result;
 986     }
 987 
 988     void registerWeakMap(OpaqueJSWeakObjectMap* map)
 989     {
 990         createRareDataIfNeeded();
 991         m_rareData-&gt;weakMaps.add(map);
 992     }
 993 
 994     void unregisterWeakMap(OpaqueJSWeakObjectMap* map)
 995     {
 996         if (m_rareData)
</pre>
<hr />
<pre>
1003         return m_rareData-&gt;opaqueJSClassData;
1004     }
1005 
1006     static ptrdiff_t weakRandomOffset() { return OBJECT_OFFSETOF(JSGlobalObject, m_weakRandom); }
1007     double weakRandomNumber() { return m_weakRandom.get(); }
1008     unsigned weakRandomInteger() { return m_weakRandom.getUint32(); }
1009     WeakRandom&amp; weakRandom() { return m_weakRandom; }
1010 
1011     bool needsSiteSpecificQuirks() const { return m_needsSiteSpecificQuirks; }
1012     JS_EXPORT_PRIVATE void exposeDollarVM(VM&amp;);
1013 
1014 #if JSC_OBJC_API_ENABLED
1015     JSWrapperMap* wrapperMap() const { return m_wrapperMap.get(); }
1016     void setWrapperMap(JSWrapperMap* map) { m_wrapperMap = map; }
1017 #endif
1018 #ifdef JSC_GLIB_API_ENABLED
1019     WrapperMap* wrapperMap() const { return m_wrapperMap.get(); }
1020     void setWrapperMap(std::unique_ptr&lt;WrapperMap&gt;&amp;&amp;);
1021 #endif
1022 
<span class="line-modified">1023     void tryInstallArraySpeciesWatchpoint(ExecState*);</span>



1024 
1025 protected:
1026     struct GlobalPropertyInfo {
1027         GlobalPropertyInfo(const Identifier&amp; i, JSValue v, unsigned a)
1028             : identifier(i)
1029             , value(v)
1030             , attributes(a)
1031         {
1032         }
1033 
1034         const Identifier identifier;
1035         JSValue value;
1036         unsigned attributes;
1037     };
1038     JS_EXPORT_PRIVATE void addStaticGlobals(GlobalPropertyInfo*, int count);
1039 
1040     void setNeedsSiteSpecificQuirks(bool needQuirks) { m_needsSiteSpecificQuirks = needQuirks; }
1041 
1042 private:
1043     friend class LLIntOffsetsExtractor;
</pre>
<hr />
<pre>
1045     void fireWatchpointAndMakeAllArrayStructuresSlowPut(VM&amp;);
1046     void setGlobalThis(VM&amp;, JSObject* globalThis);
1047 
1048     template&lt;ErrorType errorType&gt;
1049     void initializeErrorConstructor(LazyClassStructure::Initializer&amp;);
1050 
1051     JS_EXPORT_PRIVATE void init(VM&amp;);
1052     void fixupPrototypeChainWithObjectPrototype(VM&amp;);
1053 
1054     JS_EXPORT_PRIVATE static void clearRareData(JSCell*);
1055 
1056     bool m_needsSiteSpecificQuirks { false };
1057 #if JSC_OBJC_API_ENABLED
1058     RetainPtr&lt;JSWrapperMap&gt; m_wrapperMap;
1059 #endif
1060 #ifdef JSC_GLIB_API_ENABLED
1061     std::unique_ptr&lt;WrapperMap&gt; m_wrapperMap;
1062 #endif
1063 };
1064 
<span class="line-modified">1065 inline JSArray* constructEmptyArray(ExecState* exec, ArrayAllocationProfile* profile, JSGlobalObject* globalObject, unsigned initialLength = 0, JSValue newTarget = JSValue())</span>
1066 {
<span class="line-modified">1067     VM&amp; vm = globalObject-&gt;vm();</span>
1068     auto scope = DECLARE_THROW_SCOPE(vm);
1069     Structure* structure;
1070     if (initialLength &gt;= MIN_ARRAY_STORAGE_CONSTRUCTION_LENGTH)
<span class="line-modified">1071         structure = globalObject-&gt;arrayStructureForIndexingTypeDuringAllocation(exec, ArrayWithArrayStorage, newTarget);</span>
1072     else
<span class="line-modified">1073         structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(exec, profile, newTarget);</span>
1074     RETURN_IF_EXCEPTION(scope, nullptr);
1075 
1076     JSArray* result = JSArray::tryCreate(vm, structure, initialLength);
1077     if (UNLIKELY(!result)) {
<span class="line-modified">1078         throwOutOfMemoryError(exec, scope);</span>
1079         return nullptr;
1080     }
1081     return ArrayAllocationProfile::updateLastAllocationFor(profile, result);
1082 }
1083 
<span class="line-modified">1084 inline JSArray* constructEmptyArray(ExecState* exec, ArrayAllocationProfile* profile, unsigned initialLength = 0, JSValue newTarget = JSValue())</span>
<span class="line-removed">1085 {</span>
<span class="line-removed">1086     return constructEmptyArray(exec, profile, exec-&gt;lexicalGlobalObject(), initialLength, newTarget);</span>
<span class="line-removed">1087 }</span>
<span class="line-removed">1088 </span>
<span class="line-removed">1089 inline JSArray* constructArray(ExecState* exec, ArrayAllocationProfile* profile, JSGlobalObject* globalObject, const ArgList&amp; values, JSValue newTarget = JSValue())</span>
1090 {
<span class="line-modified">1091     VM&amp; vm = globalObject-&gt;vm();</span>
1092     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">1093     Structure* structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(exec, profile, newTarget);</span>
1094     RETURN_IF_EXCEPTION(scope, nullptr);
<span class="line-modified">1095     return ArrayAllocationProfile::updateLastAllocationFor(profile, constructArray(exec, structure, values));</span>
<span class="line-removed">1096 }</span>
<span class="line-removed">1097 </span>
<span class="line-removed">1098 inline JSArray* constructArray(ExecState* exec, ArrayAllocationProfile* profile, const ArgList&amp; values, JSValue newTarget = JSValue())</span>
<span class="line-removed">1099 {</span>
<span class="line-removed">1100     return constructArray(exec, profile, exec-&gt;lexicalGlobalObject(), values, newTarget);</span>
1101 }
1102 
<span class="line-modified">1103 inline JSArray* constructArray(ExecState* exec, ArrayAllocationProfile* profile, JSGlobalObject* globalObject, const JSValue* values, unsigned length, JSValue newTarget = JSValue())</span>
1104 {
<span class="line-modified">1105     VM&amp; vm = globalObject-&gt;vm();</span>
1106     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">1107     Structure* structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(exec, profile, newTarget);</span>
1108     RETURN_IF_EXCEPTION(scope, nullptr);
<span class="line-modified">1109     return ArrayAllocationProfile::updateLastAllocationFor(profile, constructArray(exec, structure, values, length));</span>
1110 }
1111 
<span class="line-modified">1112 inline JSArray* constructArray(ExecState* exec, ArrayAllocationProfile* profile, const JSValue* values, unsigned length, JSValue newTarget = JSValue())</span>
1113 {
<span class="line-modified">1114     return constructArray(exec, profile, exec-&gt;lexicalGlobalObject(), values, length, newTarget);</span>
<span class="line-removed">1115 }</span>
<span class="line-removed">1116 </span>
<span class="line-removed">1117 inline JSArray* constructArrayNegativeIndexed(ExecState* exec, ArrayAllocationProfile* profile, JSGlobalObject* globalObject, const JSValue* values, unsigned length, JSValue newTarget = JSValue())</span>
<span class="line-removed">1118 {</span>
<span class="line-removed">1119     VM&amp; vm = globalObject-&gt;vm();</span>
1120     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">1121     Structure* structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(exec, profile, newTarget);</span>
1122     RETURN_IF_EXCEPTION(scope, nullptr);
<span class="line-modified">1123     return ArrayAllocationProfile::updateLastAllocationFor(profile, constructArrayNegativeIndexed(exec, structure, values, length));</span>
<span class="line-removed">1124 }</span>
<span class="line-removed">1125 </span>
<span class="line-removed">1126 inline JSArray* constructArrayNegativeIndexed(ExecState* exec, ArrayAllocationProfile* profile, const JSValue* values, unsigned length, JSValue newTarget = JSValue())</span>
<span class="line-removed">1127 {</span>
<span class="line-removed">1128     return constructArrayNegativeIndexed(exec, profile, exec-&gt;lexicalGlobalObject(), values, length, newTarget);</span>
<span class="line-removed">1129 }</span>
<span class="line-removed">1130 </span>
<span class="line-removed">1131 inline JSObject* ExecState::globalThisValue() const</span>
<span class="line-removed">1132 {</span>
<span class="line-removed">1133     return lexicalGlobalObject()-&gt;globalThis();</span>
1134 }
1135 
1136 inline JSObject* JSScope::globalThis()
1137 {
1138     return globalObject()-&gt;globalThis();
1139 }
1140 
1141 inline JSObject* JSGlobalObject::globalThis() const
1142 {
1143     return m_globalThis.get();
1144 }
1145 
1146 inline OptionSet&lt;CodeGenerationMode&gt; JSGlobalObject::defaultCodeGenerationMode() const
1147 {
1148     OptionSet&lt;CodeGenerationMode&gt; codeGenerationMode;
1149     if (hasInteractiveDebugger() || Options::forceDebuggerBytecodeGeneration())
1150         codeGenerationMode.add(CodeGenerationMode::Debugger);
<span class="line-modified">1151     if (m_vm.typeProfiler())</span>
1152         codeGenerationMode.add(CodeGenerationMode::TypeProfiler);
<span class="line-modified">1153     if (m_vm.controlFlowProfiler())</span>
1154         codeGenerationMode.add(CodeGenerationMode::ControlFlowProfiler);
1155     return codeGenerationMode;
1156 }
1157 
1158 } // namespace JSC
</pre>
</td>
<td>
<hr />
<pre>
  10  *  This library is distributed in the hope that it will be useful,
  11  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
  12  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  13  *  Library General Public License for more details.
  14  *
  15  *  You should have received a copy of the GNU Library General Public License
  16  *  along with this library; see the file COPYING.LIB.  If not, write to
  17  *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
  18  *  Boston, MA 02110-1301, USA.
  19  *
  20  */
  21 
  22 #pragma once
  23 
  24 #include &quot;ArrayAllocationProfile.h&quot;
  25 #include &quot;ArrayBufferSharingMode.h&quot;
  26 #include &quot;BigIntPrototype.h&quot;
  27 #include &quot;BooleanPrototype.h&quot;
  28 #include &quot;ErrorType.h&quot;
  29 #include &quot;ExceptionHelpers.h&quot;
<span class="line-added">  30 #include &quot;GetVM.h&quot;</span>
  31 #include &quot;InternalFunction.h&quot;
  32 #include &quot;JSArray.h&quot;
  33 #include &quot;JSArrayBufferPrototype.h&quot;
  34 #include &quot;JSClassRef.h&quot;
  35 #include &quot;JSGlobalLexicalEnvironment.h&quot;
<span class="line-modified">  36 #include &quot;JSPromise.h&quot;</span>
  37 #include &quot;JSSegmentedVariableObject.h&quot;
  38 #include &quot;JSWeakObjectMapRefInternal.h&quot;
  39 #include &quot;LazyProperty.h&quot;
  40 #include &quot;LazyClassStructure.h&quot;
  41 #include &quot;NumberPrototype.h&quot;
  42 #include &quot;ParserModes.h&quot;
  43 #include &quot;RegExpGlobalData.h&quot;
  44 #include &quot;RuntimeFlags.h&quot;

  45 #include &quot;StringPrototype.h&quot;
  46 #include &quot;SymbolPrototype.h&quot;
  47 #include &quot;VM.h&quot;
  48 #include &quot;Watchpoint.h&quot;
  49 #include &lt;JavaScriptCore/JSBase.h&gt;
  50 #include &lt;array&gt;
  51 #include &lt;wtf/HashSet.h&gt;
  52 #include &lt;wtf/RetainPtr.h&gt;
  53 
  54 struct OpaqueJSClass;
  55 struct OpaqueJSClassContextData;
  56 OBJC_CLASS JSWrapperMap;
  57 
  58 namespace Inspector {
  59 class JSGlobalObjectInspectorController;
  60 }
  61 
  62 namespace JSC {
  63 class ArrayConstructor;
  64 class ArrayPrototype;
<span class="line-added">  65 class ArrayIteratorPrototype;</span>
  66 class AsyncIteratorPrototype;
  67 class AsyncFunctionPrototype;
  68 class AsyncGeneratorPrototype;
  69 class AsyncGeneratorFunctionPrototype;
  70 class BooleanPrototype;
  71 class ConsoleClient;
  72 class Debugger;
  73 class ErrorConstructor;
  74 class ErrorPrototype;
  75 class EvalCodeBlock;
  76 class EvalExecutable;
  77 class FunctionConstructor;
  78 class FunctionPrototype;
  79 class GeneratorPrototype;
  80 class GeneratorFunctionPrototype;
  81 class GetterSetter;
  82 class GlobalCodeBlock;
  83 class IndirectEvalExecutable;
  84 class InputCursor;
  85 class IntlObject;
</pre>
<hr />
<pre>
 102 class LLIntOffsetsExtractor;
 103 class MapPrototype;
 104 class Microtask;
 105 class ModuleLoader;
 106 class ModuleProgramExecutable;
 107 class NativeErrorConstructorBase;
 108 class NullGetterFunction;
 109 class NullSetterFunction;
 110 class ObjectConstructor;
 111 class ProgramCodeBlock;
 112 class ProgramExecutable;
 113 class RegExpConstructor;
 114 class RegExpPrototype;
 115 class SetPrototype;
 116 class SourceCode;
 117 class SourceOrigin;
 118 class UnlinkedModuleProgramCodeBlock;
 119 class VariableEnvironment;
 120 struct ActivationStackNode;
 121 struct HashTable;
<span class="line-added"> 122 enum class LinkTimeConstant : int32_t;</span>
 123 
 124 #ifdef JSC_GLIB_API_ENABLED
 125 class WrapperMap;
 126 #endif
 127 
 128 template&lt;typename Watchpoint&gt; class ObjectPropertyChangeAdaptiveWatchpoint;
 129 
 130 constexpr bool typeExposedByDefault = true;
 131 
 132 #define DEFINE_STANDARD_BUILTIN(macro, upperName, lowerName) macro(upperName, lowerName, lowerName, JS ## upperName, upperName, object, typeExposedByDefault)
 133 
 134 #define FOR_EACH_SIMPLE_BUILTIN_TYPE_WITH_CONSTRUCTOR(macro) \
 135     macro(String, string, stringObject, StringObject, String, object, typeExposedByDefault) \


 136     macro(JSPromise, promise, promise, JSPromise, Promise, object, typeExposedByDefault) \
 137     macro(BigInt, bigInt, bigIntObject, BigIntObject, BigInt, object, Options::useBigInt()) \
 138     macro(WeakObjectRef, weakObjectRef, weakObjectRef, JSWeakObjectRef, WeakRef, object, Options::useWeakRefs()) \
 139 
 140 #define FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(macro) \
 141     macro(StringIterator, stringIterator, stringIterator, JSStringIterator, StringIterator, iterator, typeExposedByDefault) \
 142 
 143 #define FOR_EACH_SIMPLE_BUILTIN_TYPE(macro) \
 144     FOR_EACH_SIMPLE_BUILTIN_TYPE_WITH_CONSTRUCTOR(macro) \
 145     macro(JSInternalPromise, internalPromise, internalPromise, JSInternalPromise, InternalPromise, object, typeExposedByDefault) \
 146 
 147 #define FOR_EACH_LAZY_BUILTIN_TYPE_WITH_DECLARATION(macro) \
 148     macro(Boolean, boolean, booleanObject, BooleanObject, Boolean, object, typeExposedByDefault) \
 149     macro(Date, date, date, DateInstance, Date, object, typeExposedByDefault) \
 150     macro(Error, error, error, ErrorInstance, Error, object, typeExposedByDefault) \
<span class="line-added"> 151     macro(Map, map, map, JSMap, Map, object, typeExposedByDefault) \</span>
 152     macro(Number, number, numberObject, NumberObject, Number, object, typeExposedByDefault) \
<span class="line-added"> 153     macro(Set, set, set, JSSet, Set, object, typeExposedByDefault) \</span>
 154     macro(Symbol, symbol, symbolObject, SymbolObject, Symbol, object, typeExposedByDefault) \
 155     DEFINE_STANDARD_BUILTIN(macro, WeakMap, weakMap) \
 156     DEFINE_STANDARD_BUILTIN(macro, WeakSet, weakSet) \
 157 
 158 #define FOR_EACH_LAZY_BUILTIN_TYPE(macro) \
 159     FOR_EACH_LAZY_BUILTIN_TYPE_WITH_DECLARATION(macro) \
 160     macro(JSArrayBuffer, arrayBuffer, arrayBuffer, JSArrayBuffer, ArrayBuffer, object, typeExposedByDefault) \
 161 
 162 #if ENABLE(WEBASSEMBLY)
 163 #define FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(macro) \
 164     macro(WebAssemblyCompileError, webAssemblyCompileError, webAssemblyCompileError, JSWebAssemblyCompileError, CompileError, error, typeExposedByDefault) \
<span class="line-added"> 165     macro(WebAssemblyGlobal,       webAssemblyGlobal,       webAssemblyGlobal,       JSWebAssemblyGlobal,       Global,       object, typeExposedByDefault) \</span>
 166     macro(WebAssemblyInstance,     webAssemblyInstance,     webAssemblyInstance,     JSWebAssemblyInstance,     Instance,     object, typeExposedByDefault) \
 167     macro(WebAssemblyLinkError,    webAssemblyLinkError,    webAssemblyLinkError,    JSWebAssemblyLinkError,    LinkError,    error, typeExposedByDefault) \
 168     macro(WebAssemblyMemory,       webAssemblyMemory,       webAssemblyMemory,       JSWebAssemblyMemory,       Memory,       object, typeExposedByDefault) \
 169     macro(WebAssemblyModule,       webAssemblyModule,       webAssemblyModule,       JSWebAssemblyModule,       Module,       object, typeExposedByDefault) \
 170     macro(WebAssemblyRuntimeError, webAssemblyRuntimeError, webAssemblyRuntimeError, JSWebAssemblyRuntimeError, RuntimeError, error, typeExposedByDefault) \
 171     macro(WebAssemblyTable,        webAssemblyTable,        webAssemblyTable,        JSWebAssemblyTable,        Table,        object, typeExposedByDefault)
 172 #else
 173 #define FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(macro)
 174 #endif // ENABLE(WEBASSEMBLY)
 175 
 176 #define DECLARE_SIMPLE_BUILTIN_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 177     class JS ## capitalName; \
 178     class capitalName ## Prototype; \
 179     class capitalName ## Constructor;
 180 
 181 class IteratorPrototype;
 182 FOR_EACH_SIMPLE_BUILTIN_TYPE(DECLARE_SIMPLE_BUILTIN_TYPE)
 183 FOR_EACH_LAZY_BUILTIN_TYPE_WITH_DECLARATION(DECLARE_SIMPLE_BUILTIN_TYPE)
 184 FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(DECLARE_SIMPLE_BUILTIN_TYPE)
 185 FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(DECLARE_SIMPLE_BUILTIN_TYPE)
</pre>
<hr />
<pre>
 190     Reject, // When a promise is rejected without any handlers.
 191     Handle, // When a handler is added to a rejected promise for the first time.
 192 };
 193 
 194 struct GlobalObjectMethodTable {
 195     typedef bool (*SupportsRichSourceInfoFunctionPtr)(const JSGlobalObject*);
 196     SupportsRichSourceInfoFunctionPtr supportsRichSourceInfo;
 197 
 198     typedef bool (*ShouldInterruptScriptFunctionPtr)(const JSGlobalObject*);
 199     ShouldInterruptScriptFunctionPtr shouldInterruptScript;
 200 
 201     typedef RuntimeFlags (*JavaScriptRuntimeFlagsFunctionPtr)(const JSGlobalObject*);
 202     JavaScriptRuntimeFlagsFunctionPtr javaScriptRuntimeFlags;
 203 
 204     typedef void (*QueueTaskToEventLoopFunctionPtr)(JSGlobalObject&amp;, Ref&lt;Microtask&gt;&amp;&amp;);
 205     QueueTaskToEventLoopFunctionPtr queueTaskToEventLoop;
 206 
 207     typedef bool (*ShouldInterruptScriptBeforeTimeoutPtr)(const JSGlobalObject*);
 208     ShouldInterruptScriptBeforeTimeoutPtr shouldInterruptScriptBeforeTimeout;
 209 
<span class="line-modified"> 210     typedef JSInternalPromise* (*ModuleLoaderImportModulePtr)(JSGlobalObject*, JSModuleLoader*, JSString*, JSValue, const SourceOrigin&amp;);</span>
 211     ModuleLoaderImportModulePtr moduleLoaderImportModule;
 212 
<span class="line-modified"> 213     typedef Identifier (*ModuleLoaderResolvePtr)(JSGlobalObject*, JSModuleLoader*, JSValue, JSValue, JSValue);</span>
 214     ModuleLoaderResolvePtr moduleLoaderResolve;
 215 
<span class="line-modified"> 216     typedef JSInternalPromise* (*ModuleLoaderFetchPtr)(JSGlobalObject*, JSModuleLoader*, JSValue, JSValue, JSValue);</span>
 217     ModuleLoaderFetchPtr moduleLoaderFetch;
 218 
<span class="line-modified"> 219     typedef JSObject* (*ModuleLoaderCreateImportMetaPropertiesPtr)(JSGlobalObject*, JSModuleLoader*, JSValue, JSModuleRecord*, JSValue);</span>
 220     ModuleLoaderCreateImportMetaPropertiesPtr moduleLoaderCreateImportMetaProperties;
 221 
<span class="line-modified"> 222     typedef JSValue (*ModuleLoaderEvaluatePtr)(JSGlobalObject*, JSModuleLoader*, JSValue, JSValue, JSValue);</span>
 223     ModuleLoaderEvaluatePtr moduleLoaderEvaluate;
 224 
<span class="line-modified"> 225     typedef void (*PromiseRejectionTrackerPtr)(JSGlobalObject*, JSPromise*, JSPromiseRejectionOperation);</span>
 226     PromiseRejectionTrackerPtr promiseRejectionTracker;
 227 
 228     typedef String (*DefaultLanguageFunctionPtr)();
 229     DefaultLanguageFunctionPtr defaultLanguage;
 230 
<span class="line-modified"> 231     typedef void (*CompileStreamingPtr)(JSGlobalObject*, JSPromise*, JSValue);</span>
 232     CompileStreamingPtr compileStreaming;
 233 
<span class="line-modified"> 234     typedef void (*InstantiateStreamingPtr)(JSGlobalObject*, JSPromise*, JSValue, JSObject*);</span>
 235     InstantiateStreamingPtr instantiateStreaming;
 236 };
 237 
 238 class JSGlobalObject : public JSSegmentedVariableObject {
 239 private:
 240     typedef HashSet&lt;RefPtr&lt;OpaqueJSWeakObjectMap&gt;&gt; WeakMapSet;
 241     typedef HashMap&lt;OpaqueJSClass*, std::unique_ptr&lt;OpaqueJSClassContextData&gt;&gt; OpaqueJSClassDataMap;
 242 
 243     struct JSGlobalObjectRareData {
 244         WTF_MAKE_FAST_ALLOCATED;
 245     public:
 246         JSGlobalObjectRareData()
 247             : profileGroup(0)
 248         {
 249         }
 250 
 251         WeakMapSet weakMaps;
 252         unsigned profileGroup;
 253 
 254         OpaqueJSClassDataMap opaqueJSClassData;
 255     };
 256 
<span class="line-added"> 257     // m_vm must be a pointer (instead of a reference) because the JSCLLIntOffsetsExtractor</span>
<span class="line-added"> 258     // cannot handle it being a reference.</span>
<span class="line-added"> 259     VM* m_vm;</span>
<span class="line-added"> 260 </span>
 261 // Our hashtable code-generator tries to access these properties, so we make them public.
 262 // However, we&#39;d like it better if they could be protected.
 263 public:
 264     template&lt;typename T&gt; using Initializer = typename LazyProperty&lt;JSGlobalObject, T&gt;::Initializer;
 265 
<span class="line-modified"> 266     Register m_deprecatedCallFrameForDebugger[CallFrame::headerSizeInRegisters];</span>
 267 
 268     WriteBarrier&lt;JSObject&gt; m_globalThis;
 269 
 270     WriteBarrier&lt;JSGlobalLexicalEnvironment&gt; m_globalLexicalEnvironment;
 271     WriteBarrier&lt;JSScope&gt; m_globalScopeExtension;
 272     WriteBarrier&lt;JSCallee&gt; m_globalCallee;
 273     WriteBarrier&lt;JSCallee&gt; m_stackOverflowFrameCallee;
 274 
 275     LazyClassStructure m_evalErrorStructure;
 276     LazyClassStructure m_rangeErrorStructure;
 277     LazyClassStructure m_referenceErrorStructure;
 278     LazyClassStructure m_syntaxErrorStructure;
 279     LazyClassStructure m_typeErrorStructure;
 280     LazyClassStructure m_URIErrorStructure;
 281 
 282     WriteBarrier&lt;ObjectConstructor&gt; m_objectConstructor;
 283     WriteBarrier&lt;ArrayConstructor&gt; m_arrayConstructor;
<span class="line-added"> 284     WriteBarrier&lt;RegExpConstructor&gt; m_regExpConstructor;</span>
<span class="line-added"> 285     WriteBarrier&lt;FunctionConstructor&gt; m_functionConstructor;</span>
 286     WriteBarrier&lt;JSPromiseConstructor&gt; m_promiseConstructor;
 287     WriteBarrier&lt;JSInternalPromiseConstructor&gt; m_internalPromiseConstructor;
 288 
 289 #if ENABLE(INTL)
<span class="line-modified"> 290     LazyProperty&lt;JSGlobalObject, IntlCollator&gt; m_defaultCollator;</span>
 291     LazyProperty&lt;JSGlobalObject, Structure&gt; m_collatorStructure;
 292     LazyProperty&lt;JSGlobalObject, Structure&gt; m_numberFormatStructure;
 293     LazyProperty&lt;JSGlobalObject, Structure&gt; m_dateTimeFormatStructure;
 294     LazyProperty&lt;JSGlobalObject, Structure&gt; m_pluralRulesStructure;
 295 #endif
 296     WriteBarrier&lt;NullGetterFunction&gt; m_nullGetterFunction;
 297     WriteBarrier&lt;NullSetterFunction&gt; m_nullSetterFunction;
 298 
 299     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_parseIntFunction;
 300     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_parseFloatFunction;
 301 



 302     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_arrayProtoToStringFunction;
 303     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_arrayProtoValuesFunction;
 304     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_evalFunction;

 305     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_iteratorProtocolFunction;
 306     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_promiseResolveFunction;
<span class="line-added"> 307     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_numberProtoToStringFunction;</span>
 308     WriteBarrier&lt;JSFunction&gt; m_objectProtoValueOfFunction;


 309     WriteBarrier&lt;JSFunction&gt; m_functionProtoHasInstanceSymbolFunction;
 310     LazyProperty&lt;JSGlobalObject, GetterSetter&gt; m_throwTypeErrorGetterSetter;

 311     WriteBarrier&lt;JSObject&gt; m_regExpProtoSymbolReplace;


 312     WriteBarrier&lt;GetterSetter&gt; m_throwTypeErrorArgumentsCalleeAndCallerGetterSetter;
 313 
 314     LazyProperty&lt;JSGlobalObject, JSModuleLoader&gt; m_moduleLoader;
 315 
 316     WriteBarrier&lt;ObjectPrototype&gt; m_objectPrototype;
 317     WriteBarrier&lt;FunctionPrototype&gt; m_functionPrototype;
 318     WriteBarrier&lt;ArrayPrototype&gt; m_arrayPrototype;
 319     WriteBarrier&lt;RegExpPrototype&gt; m_regExpPrototype;
 320     WriteBarrier&lt;IteratorPrototype&gt; m_iteratorPrototype;
 321     WriteBarrier&lt;AsyncIteratorPrototype&gt; m_asyncIteratorPrototype;
 322     WriteBarrier&lt;GeneratorFunctionPrototype&gt; m_generatorFunctionPrototype;
 323     WriteBarrier&lt;GeneratorPrototype&gt; m_generatorPrototype;
 324     WriteBarrier&lt;AsyncGeneratorPrototype&gt; m_asyncGeneratorPrototype;
<span class="line-added"> 325     WriteBarrier&lt;ArrayIteratorPrototype&gt; m_arrayIteratorPrototype;</span>
 326 
 327     LazyProperty&lt;JSGlobalObject, Structure&gt; m_debuggerScopeStructure;
 328     LazyProperty&lt;JSGlobalObject, Structure&gt; m_withScopeStructure;
 329     LazyProperty&lt;JSGlobalObject, Structure&gt; m_strictEvalActivationStructure;
 330     WriteBarrier&lt;Structure&gt; m_lexicalEnvironmentStructure;
 331     LazyProperty&lt;JSGlobalObject, Structure&gt; m_moduleEnvironmentStructure;
 332     WriteBarrier&lt;Structure&gt; m_directArgumentsStructure;
 333     WriteBarrier&lt;Structure&gt; m_scopedArgumentsStructure;
 334     WriteBarrier&lt;Structure&gt; m_clonedArgumentsStructure;
 335 
 336     WriteBarrier&lt;Structure&gt; m_objectStructureForObjectConstructor;
 337 
 338     // Lists the actual structures used for having these particular indexing shapes.
 339     WriteBarrier&lt;Structure&gt; m_originalArrayStructureForIndexingShape[NumberOfArrayIndexingModes];
 340     // Lists the structures we should use during allocation for these particular indexing shapes.
 341     // These structures will differ from the originals list above when we are having a bad time.
 342     WriteBarrier&lt;Structure&gt; m_arrayStructureForIndexingShapeDuringAllocation[NumberOfArrayIndexingModes];
 343 
 344     LazyProperty&lt;JSGlobalObject, Structure&gt; m_callbackConstructorStructure;
 345     LazyProperty&lt;JSGlobalObject, Structure&gt; m_callbackFunctionStructure;
</pre>
<hr />
<pre>
 350 #endif
 351 #ifdef JSC_GLIB_API_ENABLED
 352     LazyProperty&lt;JSGlobalObject, Structure&gt; m_glibCallbackFunctionStructure;
 353     LazyProperty&lt;JSGlobalObject, Structure&gt; m_glibWrapperObjectStructure;
 354 #endif
 355     WriteBarrier&lt;Structure&gt; m_nullPrototypeObjectStructure;
 356     WriteBarrier&lt;Structure&gt; m_calleeStructure;
 357 
 358     WriteBarrier&lt;Structure&gt; m_hostFunctionStructure;
 359 
 360     struct FunctionStructures {
 361         WriteBarrier&lt;Structure&gt; arrowFunctionStructure;
 362         WriteBarrier&lt;Structure&gt; sloppyFunctionStructure;
 363         WriteBarrier&lt;Structure&gt; strictFunctionStructure;
 364     };
 365     FunctionStructures m_builtinFunctions;
 366     FunctionStructures m_ordinaryFunctions;
 367 
 368     LazyProperty&lt;JSGlobalObject, Structure&gt; m_boundFunctionStructure;
 369     LazyProperty&lt;JSGlobalObject, Structure&gt; m_customGetterSetterFunctionStructure;

 370     LazyProperty&lt;JSGlobalObject, Structure&gt; m_nativeStdFunctionStructure;
 371     PropertyOffset m_functionNameOffset;
 372     WriteBarrier&lt;Structure&gt; m_regExpStructure;
 373     WriteBarrier&lt;AsyncFunctionPrototype&gt; m_asyncFunctionPrototype;
 374     WriteBarrier&lt;AsyncGeneratorFunctionPrototype&gt; m_asyncGeneratorFunctionPrototype;
 375     WriteBarrier&lt;Structure&gt; m_asyncFunctionStructure;
 376     WriteBarrier&lt;Structure&gt; m_asyncGeneratorFunctionStructure;
 377     WriteBarrier&lt;Structure&gt; m_generatorFunctionStructure;
<span class="line-added"> 378     WriteBarrier&lt;Structure&gt; m_generatorStructure;</span>
<span class="line-added"> 379     WriteBarrier&lt;Structure&gt; m_asyncGeneratorStructure;</span>
<span class="line-added"> 380     WriteBarrier&lt;Structure&gt; m_arrayIteratorStructure;</span>
 381     LazyProperty&lt;JSGlobalObject, Structure&gt; m_iteratorResultObjectStructure;
 382     WriteBarrier&lt;Structure&gt; m_regExpMatchesArrayStructure;

 383     LazyProperty&lt;JSGlobalObject, Structure&gt; m_moduleRecordStructure;
 384     LazyProperty&lt;JSGlobalObject, Structure&gt; m_moduleNamespaceObjectStructure;
 385     LazyProperty&lt;JSGlobalObject, Structure&gt; m_proxyObjectStructure;
 386     LazyProperty&lt;JSGlobalObject, Structure&gt; m_callableProxyObjectStructure;
 387     LazyProperty&lt;JSGlobalObject, Structure&gt; m_proxyRevokeStructure;
 388 #if ENABLE(SHARED_ARRAY_BUFFER)
 389     WriteBarrier&lt;JSArrayBufferPrototype&gt; m_sharedArrayBufferPrototype;
 390     WriteBarrier&lt;Structure&gt; m_sharedArrayBufferStructure;
 391 #endif
 392 
 393 #define DEFINE_STORAGE_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 394     WriteBarrier&lt;capitalName ## Prototype&gt; m_ ## lowerName ## Prototype; \
 395     WriteBarrier&lt;Structure&gt; m_ ## properName ## Structure;
 396 
 397 #define DEFINE_STORAGE_FOR_LAZY_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \
 398     LazyClassStructure m_ ## properName ## Structure;
 399 
 400     FOR_EACH_SIMPLE_BUILTIN_TYPE(DEFINE_STORAGE_FOR_SIMPLE_TYPE)
 401     FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(DEFINE_STORAGE_FOR_SIMPLE_TYPE)
 402 
 403 #if ENABLE(WEBASSEMBLY)
 404     LazyProperty&lt;JSGlobalObject, Structure&gt; m_webAssemblyModuleRecordStructure;
 405     LazyProperty&lt;JSGlobalObject, Structure&gt; m_webAssemblyFunctionStructure;
 406     LazyProperty&lt;JSGlobalObject, Structure&gt; m_jsToWasmICCalleeStructure;
 407     LazyProperty&lt;JSGlobalObject, Structure&gt; m_webAssemblyWrapperFunctionStructure;

 408     FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(DEFINE_STORAGE_FOR_LAZY_TYPE)
 409 #endif // ENABLE(WEBASSEMBLY)
 410 
 411     FOR_EACH_LAZY_BUILTIN_TYPE(DEFINE_STORAGE_FOR_LAZY_TYPE)
 412 
 413 #undef DEFINE_STORAGE_FOR_SIMPLE_TYPE
 414 #undef DEFINE_STORAGE_FOR_LAZY_TYPE
 415 
 416     WriteBarrier&lt;GetterSetter&gt; m_speciesGetterSetter;
 417 
 418     LazyProperty&lt;JSGlobalObject, JSTypedArrayViewPrototype&gt; m_typedArrayProto;
 419     LazyProperty&lt;JSGlobalObject, JSTypedArrayViewConstructor&gt; m_typedArraySuperConstructor;
 420 
 421 #define DECLARE_TYPED_ARRAY_TYPE_STRUCTURE(name) LazyClassStructure m_typedArray ## name;
 422     FOR_EACH_TYPED_ARRAY_TYPE(DECLARE_TYPED_ARRAY_TYPE_STRUCTURE)
 423 #undef DECLARE_TYPED_ARRAY_TYPE_STRUCTURE
 424 
<span class="line-modified"> 425     Vector&lt;LazyProperty&lt;JSGlobalObject, JSCell&gt;&gt; m_linkTimeConstants;</span>

 426 
 427     String m_name;
 428 
 429     Strong&lt;JSObject&gt; m_unhandledRejectionCallback;
 430 
 431     Debugger* m_debugger;
 432 


 433 #if ENABLE(REMOTE_INSPECTOR)
 434     std::unique_ptr&lt;Inspector::JSGlobalObjectInspectorController&gt; m_inspectorController;
 435     std::unique_ptr&lt;JSGlobalObjectDebuggable&gt; m_inspectorDebuggable;
 436 #endif
 437 







 438     RefPtr&lt;WatchpointSet&gt; m_masqueradesAsUndefinedWatchpoint;
 439     RefPtr&lt;WatchpointSet&gt; m_havingABadTimeWatchpoint;
 440     RefPtr&lt;WatchpointSet&gt; m_varInjectionWatchpoint;
 441 
 442     std::unique_ptr&lt;JSGlobalObjectRareData&gt; m_rareData;
 443 
 444     WeakRandom m_weakRandom;
 445     RegExpGlobalData m_regExpGlobalData;
 446 
 447     JSCallee* stackOverflowFrameCallee() const { return m_stackOverflowFrameCallee.get(); }
 448 
 449     InlineWatchpointSet&amp; arrayIteratorProtocolWatchpointSet() { return m_arrayIteratorProtocolWatchpointSet; }
 450     InlineWatchpointSet&amp; mapIteratorProtocolWatchpointSet() { return m_mapIteratorProtocolWatchpointSet; }
 451     InlineWatchpointSet&amp; setIteratorProtocolWatchpointSet() { return m_setIteratorProtocolWatchpointSet; }
 452     InlineWatchpointSet&amp; stringIteratorProtocolWatchpointSet() { return m_stringIteratorProtocolWatchpointSet; }
 453     InlineWatchpointSet&amp; mapSetWatchpointSet() { return m_mapSetWatchpointSet; }
 454     InlineWatchpointSet&amp; setAddWatchpointSet() { return m_setAddWatchpointSet; }
 455     InlineWatchpointSet&amp; arraySpeciesWatchpointSet() { return m_arraySpeciesWatchpointSet; }
 456     InlineWatchpointSet&amp; arrayJoinWatchpointSet() { return m_arrayJoinWatchpointSet; }
 457     InlineWatchpointSet&amp; numberToStringWatchpointSet()
</pre>
<hr />
<pre>
 490     bool isSetPrototypeIteratorProtocolFastAndNonObservable();
 491     bool isStringPrototypeIteratorProtocolFastAndNonObservable();
 492     bool isMapPrototypeSetFastAndNonObservable();
 493     bool isSetPrototypeAddFastAndNonObservable();
 494 
 495 #if ENABLE(DFG_JIT)
 496     using ReferencedGlobalPropertyWatchpointSets = HashMap&lt;RefPtr&lt;UniquedStringImpl&gt;, Ref&lt;WatchpointSet&gt;, IdentifierRepHash&gt;;
 497     ReferencedGlobalPropertyWatchpointSets m_referencedGlobalPropertyWatchpointSets;
 498     ConcurrentJSLock m_referencedGlobalPropertyWatchpointSetsLock;
 499 #endif
 500 
 501     bool m_evalEnabled { true };
 502     bool m_webAssemblyEnabled { true };
 503     unsigned m_globalLexicalBindingEpoch { 1 };
 504     String m_evalDisabledErrorMessage;
 505     String m_webAssemblyDisabledErrorMessage;
 506     RuntimeFlags m_runtimeFlags;
 507     ConsoleClient* m_consoleClient { nullptr };
 508     Optional&lt;unsigned&gt; m_stackTraceLimit;
 509 
<span class="line-modified"> 510 #if ASSERT_ENABLED</span>
<span class="line-modified"> 511     const JSGlobalObject* m_globalObjectAtDebuggerEntry { nullptr };</span>
 512 #endif
 513 
 514     static JS_EXPORT_PRIVATE const GlobalObjectMethodTable s_globalObjectMethodTable;
 515     const GlobalObjectMethodTable* m_globalObjectMethodTable;
 516 
 517     void createRareDataIfNeeded()
 518     {
 519         if (m_rareData)
 520             return;
 521         m_rareData = makeUnique&lt;JSGlobalObjectRareData&gt;();
 522     }
 523 
 524 public:
<span class="line-modified"> 525     using Base = JSSegmentedVariableObject;</span>
<span class="line-modified"> 526     static constexpr unsigned StructureFlags = Base::StructureFlags | HasStaticPropertyTable | OverridesGetOwnPropertySlot | OverridesGetPropertyNames | IsImmutablePrototypeExoticObject;</span>
<span class="line-added"> 527 </span>
<span class="line-added"> 528     static constexpr bool needsDestruction = true;</span>
<span class="line-added"> 529     template&lt;typename CellType, SubspaceAccess mode&gt;</span>
<span class="line-added"> 530     static IsoSubspace* subspaceFor(VM&amp; vm)</span>
<span class="line-added"> 531     {</span>
<span class="line-added"> 532         return vm.globalObjectSpace&lt;mode&gt;();</span>
<span class="line-added"> 533     }</span>
 534 
 535     JS_EXPORT_PRIVATE static JSGlobalObject* create(VM&amp;, Structure*);
 536 
 537     DECLARE_EXPORT_INFO;
 538 
 539     bool hasDebugger() const;
 540     bool hasInteractiveDebugger() const;
 541     const RuntimeFlags&amp; runtimeFlags() const { return m_runtimeFlags; }
 542 
 543 #if ENABLE(DFG_JIT)
 544     WatchpointSet* getReferencedPropertyWatchpointSet(UniquedStringImpl*);
 545     WatchpointSet&amp; ensureReferencedPropertyWatchpointSet(UniquedStringImpl*);
 546 #endif
 547 
 548     Optional&lt;unsigned&gt; stackTraceLimit() const { return m_stackTraceLimit; }
 549     void setStackTraceLimit(Optional&lt;unsigned&gt; value) { m_stackTraceLimit = value; }
 550 
 551 protected:
 552     JS_EXPORT_PRIVATE explicit JSGlobalObject(VM&amp;, Structure*, const GlobalObjectMethodTable* = nullptr);
 553 
 554     JS_EXPORT_PRIVATE void finishCreation(VM&amp;);
 555 
 556     JS_EXPORT_PRIVATE void finishCreation(VM&amp;, JSObject*);
 557 
 558     void addGlobalVar(const Identifier&amp;);
 559 
 560 public:
 561     JS_EXPORT_PRIVATE ~JSGlobalObject();
 562     JS_EXPORT_PRIVATE static void destroy(JSCell*);
 563 
 564     JS_EXPORT_PRIVATE static void visitChildren(JSCell*, SlotVisitor&amp;);
 565 
<span class="line-modified"> 566     JS_EXPORT_PRIVATE static bool getOwnPropertySlot(JSObject*, JSGlobalObject*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified"> 567     JS_EXPORT_PRIVATE static bool put(JSCell*, JSGlobalObject*, PropertyName, JSValue, PutPropertySlot&amp;);</span>
 568 
<span class="line-modified"> 569     JS_EXPORT_PRIVATE static void defineGetter(JSObject*, JSGlobalObject*, PropertyName, JSObject* getterFunc, unsigned attributes);</span>
<span class="line-modified"> 570     JS_EXPORT_PRIVATE static void defineSetter(JSObject*, JSGlobalObject*, PropertyName, JSObject* setterFunc, unsigned attributes);</span>
<span class="line-modified"> 571     JS_EXPORT_PRIVATE static bool defineOwnProperty(JSObject*, JSGlobalObject*, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow);</span>
 572 
<span class="line-modified"> 573     void addVar(JSGlobalObject* globalObject, const Identifier&amp; propertyName)</span>
 574     {
<span class="line-modified"> 575         if (!hasOwnProperty(globalObject, propertyName))</span>
 576             addGlobalVar(propertyName);
 577     }
<span class="line-modified"> 578     void addFunction(JSGlobalObject*, const Identifier&amp;);</span>
 579 
 580     JSScope* globalScope() { return m_globalLexicalEnvironment.get(); }
 581     JSGlobalLexicalEnvironment* globalLexicalEnvironment() { return m_globalLexicalEnvironment.get(); }
 582 
 583     JSScope* globalScopeExtension() { return m_globalScopeExtension.get(); }
 584     void setGlobalScopeExtension(JSScope*);
 585     void clearGlobalScopeExtension();
 586 
<span class="line-added"> 587     JSCallee* globalCallee() { return m_globalCallee.get(); }</span>
<span class="line-added"> 588 </span>
 589     // The following accessors return pristine values, even if a script
 590     // replaces the global object&#39;s associated property.
 591 
 592     GetterSetter* speciesGetterSetter() const { return m_speciesGetterSetter.get(); }
 593 
 594     ArrayConstructor* arrayConstructor() const { return m_arrayConstructor.get(); }
<span class="line-added"> 595     RegExpConstructor* regExpConstructor() const { return m_regExpConstructor.get(); }</span>
 596     ObjectConstructor* objectConstructor() const { return m_objectConstructor.get(); }
<span class="line-added"> 597     FunctionConstructor* functionConstructor() const { return m_functionConstructor.get(); }</span>
 598     JSPromiseConstructor* promiseConstructor() const { return m_promiseConstructor.get(); }
 599     JSInternalPromiseConstructor* internalPromiseConstructor() const { return m_internalPromiseConstructor.get(); }
 600 
 601 #if ENABLE(INTL)
<span class="line-modified"> 602     IntlCollator* defaultCollator() const { return m_defaultCollator.get(this); }</span>
 603 #endif
 604 
 605     NullGetterFunction* nullGetterFunction() const { return m_nullGetterFunction.get(); }
 606     NullSetterFunction* nullSetterFunction() const { return m_nullSetterFunction.get(); }
 607 
 608     JSFunction* parseIntFunction() const { return m_parseIntFunction.get(this); }
 609     JSFunction* parseFloatFunction() const { return m_parseFloatFunction.get(this); }
 610 
 611     JSFunction* evalFunction() const { return m_evalFunction.get(this); }
<span class="line-modified"> 612     JSFunction* throwTypeErrorFunction() const;</span>


 613     JSFunction* arrayProtoToStringFunction() const { return m_arrayProtoToStringFunction.get(this); }
 614     JSFunction* arrayProtoValuesFunction() const { return m_arrayProtoValuesFunction.get(this); }

 615     JSFunction* iteratorProtocolFunction() const { return m_iteratorProtocolFunction.get(this); }
<span class="line-added"> 616     JSFunction* newPromiseCapabilityFunction() const;</span>
 617     JSFunction* promiseResolveFunction() const { return m_promiseResolveFunction.get(this); }
<span class="line-added"> 618     JSFunction* resolvePromiseFunction() const;</span>
<span class="line-added"> 619     JSFunction* rejectPromiseFunction() const;</span>
<span class="line-added"> 620     JSFunction* promiseProtoThenFunction() const;</span>
 621     JSFunction* objectProtoValueOfFunction() const { return m_objectProtoValueOfFunction.get(); }
<span class="line-modified"> 622     JSFunction* numberProtoToStringFunction() const { return m_numberProtoToStringFunction.getInitializedOnMainThread(this); }</span>

 623     JSFunction* functionProtoHasInstanceSymbolFunction() const { return m_functionProtoHasInstanceSymbolFunction.get(); }
<span class="line-modified"> 624     JSFunction* regExpProtoExecFunction() const;</span>
 625     JSObject* regExpProtoSymbolReplaceFunction() const { return m_regExpProtoSymbolReplace.get(); }
<span class="line-modified"> 626     GetterSetter* regExpProtoGlobalGetter() const;</span>
<span class="line-modified"> 627     GetterSetter* regExpProtoUnicodeGetter() const;</span>
 628     GetterSetter* throwTypeErrorArgumentsCalleeAndCallerGetterSetter()
 629     {
 630         return m_throwTypeErrorArgumentsCalleeAndCallerGetterSetter.get();
 631     }
 632 
 633     JSModuleLoader* moduleLoader() const { return m_moduleLoader.get(this); }
 634 
 635     ObjectPrototype* objectPrototype() const { return m_objectPrototype.get(); }
 636     FunctionPrototype* functionPrototype() const { return m_functionPrototype.get(); }
 637     ArrayPrototype* arrayPrototype() const { return m_arrayPrototype.get(); }
 638     JSObject* booleanPrototype() const { return m_booleanObjectStructure.prototypeInitializedOnMainThread(this); }
 639     StringPrototype* stringPrototype() const { return m_stringPrototype.get(); }
 640     JSObject* numberPrototype() const { return m_numberObjectStructure.prototypeInitializedOnMainThread(this); }
 641     BigIntPrototype* bigIntPrototype() const { return m_bigIntPrototype.get(); }
 642     JSObject* datePrototype() const { return m_dateStructure.prototype(this); }
 643     JSObject* symbolPrototype() const { return m_symbolObjectStructure.prototypeInitializedOnMainThread(this); }
 644     RegExpPrototype* regExpPrototype() const { return m_regExpPrototype.get(); }
 645     JSObject* errorPrototype() const { return m_errorStructure.prototype(this); }
 646     IteratorPrototype* iteratorPrototype() const { return m_iteratorPrototype.get(); }
 647     AsyncIteratorPrototype* asyncIteratorPrototype() const { return m_asyncIteratorPrototype.get(); }
 648     GeneratorFunctionPrototype* generatorFunctionPrototype() const { return m_generatorFunctionPrototype.get(); }
 649     GeneratorPrototype* generatorPrototype() const { return m_generatorPrototype.get(); }
 650     AsyncFunctionPrototype* asyncFunctionPrototype() const { return m_asyncFunctionPrototype.get(); }
<span class="line-modified"> 651     ArrayIteratorPrototype* arrayIteratorPrototype() const { return m_arrayIteratorPrototype.get(); }</span>
<span class="line-added"> 652     JSObject* mapPrototype() const { return m_mapStructure.prototype(this); }</span>
 653     // Workaround for the name conflict between JSCell::setPrototype.
<span class="line-modified"> 654     JSObject* jsSetPrototype() const { return m_setStructure.prototype(this); }</span>
 655     JSPromisePrototype* promisePrototype() const { return m_promisePrototype.get(); }
 656     AsyncGeneratorPrototype* asyncGeneratorPrototype() const { return m_asyncGeneratorPrototype.get(); }
 657     AsyncGeneratorFunctionPrototype* asyncGeneratorFunctionPrototype() const { return m_asyncGeneratorFunctionPrototype.get(); }
 658 
 659     Structure* debuggerScopeStructure() const { return m_debuggerScopeStructure.get(this); }
 660     Structure* withScopeStructure() const { return m_withScopeStructure.get(this); }
 661     Structure* strictEvalActivationStructure() const { return m_strictEvalActivationStructure.get(this); }
 662     Structure* activationStructure() const { return m_lexicalEnvironmentStructure.get(); }
 663     Structure* moduleEnvironmentStructure() const { return m_moduleEnvironmentStructure.get(this); }
 664     Structure* directArgumentsStructure() const { return m_directArgumentsStructure.get(); }
 665     Structure* scopedArgumentsStructure() const { return m_scopedArgumentsStructure.get(); }
 666     Structure* clonedArgumentsStructure() const { return m_clonedArgumentsStructure.get(); }
 667     Structure* objectStructureForObjectConstructor() const { return m_objectStructureForObjectConstructor.get(); }
 668     Structure* originalArrayStructureForIndexingType(IndexingType indexingType) const
 669     {
 670         ASSERT(indexingType &amp; IsArray);
 671         return m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(indexingType)].get();
 672     }
 673     Structure* arrayStructureForIndexingTypeDuringAllocation(IndexingType indexingType) const
 674     {
 675         ASSERT(indexingType &amp; IsArray);
 676         return m_arrayStructureForIndexingShapeDuringAllocation[arrayIndexFromIndexingType(indexingType)].get();
 677     }
<span class="line-modified"> 678     Structure* arrayStructureForIndexingTypeDuringAllocation(JSGlobalObject* globalObject, IndexingType indexingType, JSValue newTarget) const;</span>
<span class="line-modified"> 679     Structure* arrayStructureForProfileDuringAllocation(JSGlobalObject* globalObject, ArrayAllocationProfile* profile, JSValue newTarget) const</span>



 680     {
<span class="line-modified"> 681         return arrayStructureForIndexingTypeDuringAllocation(globalObject, ArrayAllocationProfile::selectIndexingTypeFor(profile), newTarget);</span>
 682     }
 683 
 684     bool isOriginalArrayStructure(Structure* structure)
 685     {
 686         return originalArrayStructureForIndexingType(structure-&gt;indexingMode() | IsArray) == structure;
 687     }
 688 
 689     Structure* booleanObjectStructure() const { return m_booleanObjectStructure.get(this); }
 690     Structure* callbackConstructorStructure() const { return m_callbackConstructorStructure.get(this); }
 691     Structure* callbackFunctionStructure() const { return m_callbackFunctionStructure.get(this); }
 692     Structure* callbackObjectStructure() const { return m_callbackObjectStructure.get(this); }
 693 #if JSC_OBJC_API_ENABLED
 694     Structure* objcCallbackFunctionStructure() const { return m_objcCallbackFunctionStructure.get(this); }
 695     Structure* objcWrapperObjectStructure() const { return m_objcWrapperObjectStructure.get(this); }
 696 #endif
 697 #ifdef JSC_GLIB_API_ENABLED
 698     Structure* glibCallbackFunctionStructure() const { return m_glibCallbackFunctionStructure.get(this); }
 699     Structure* glibWrapperObjectStructure() const { return m_glibWrapperObjectStructure.get(this); }
 700 #endif
 701     Structure* dateStructure() const { return m_dateStructure.get(this); }
</pre>
<hr />
<pre>
 730     {
 731         if (isBuiltin)
 732             return m_builtinFunctions.arrowFunctionStructure.get();
 733         return m_ordinaryFunctions.arrowFunctionStructure.get();
 734     }
 735     Structure* sloppyFunctionStructure(bool isBuiltin) const
 736     {
 737         if (isBuiltin)
 738             return m_builtinFunctions.sloppyFunctionStructure.get();
 739         return m_ordinaryFunctions.sloppyFunctionStructure.get();
 740     }
 741     Structure* strictFunctionStructure(bool isBuiltin) const
 742     {
 743         if (isBuiltin)
 744             return m_builtinFunctions.strictFunctionStructure.get();
 745         return m_ordinaryFunctions.strictFunctionStructure.get();
 746     }
 747 
 748     Structure* boundFunctionStructure() const { return m_boundFunctionStructure.get(this); }
 749     Structure* customGetterSetterFunctionStructure() const { return m_customGetterSetterFunctionStructure.get(this); }

 750     Structure* nativeStdFunctionStructure() const { return m_nativeStdFunctionStructure.get(this); }
 751     PropertyOffset functionNameOffset() const { return m_functionNameOffset; }
 752     Structure* numberObjectStructure() const { return m_numberObjectStructure.get(this); }

 753     Structure* regExpStructure() const { return m_regExpStructure.get(); }
<span class="line-added"> 754     Structure* generatorStructure() const { return m_generatorStructure.get(); }</span>
<span class="line-added"> 755     Structure* asyncGeneratorStructure() const { return m_asyncGeneratorStructure.get(); }</span>
 756     Structure* generatorFunctionStructure() const { return m_generatorFunctionStructure.get(); }
 757     Structure* asyncFunctionStructure() const { return m_asyncFunctionStructure.get(); }
 758     Structure* asyncGeneratorFunctionStructure() const { return m_asyncGeneratorFunctionStructure.get(); }
<span class="line-added"> 759     Structure* arrayIteratorStructure() const { return m_arrayIteratorStructure.get(); }</span>
 760     Structure* stringObjectStructure() const { return m_stringObjectStructure.get(); }
 761     Structure* iteratorResultObjectStructure() const { return m_iteratorResultObjectStructure.get(this); }
 762     Structure* regExpMatchesArrayStructure() const { return m_regExpMatchesArrayStructure.get(); }

 763     Structure* moduleRecordStructure() const { return m_moduleRecordStructure.get(this); }
 764     Structure* moduleNamespaceObjectStructure() const { return m_moduleNamespaceObjectStructure.get(this); }
 765     Structure* proxyObjectStructure() const { return m_proxyObjectStructure.get(this); }
 766     Structure* callableProxyObjectStructure() const { return m_callableProxyObjectStructure.get(this); }
 767     Structure* proxyRevokeStructure() const { return m_proxyRevokeStructure.get(this); }
 768     Structure* restParameterStructure() const { return arrayStructureForIndexingTypeDuringAllocation(ArrayWithContiguous); }
 769     Structure* originalRestParameterStructure() const { return originalArrayStructureForIndexingType(ArrayWithContiguous); }
 770 #if ENABLE(WEBASSEMBLY)
 771     Structure* webAssemblyModuleRecordStructure() const { return m_webAssemblyModuleRecordStructure.get(this); }
 772     Structure* webAssemblyFunctionStructure() const { return m_webAssemblyFunctionStructure.get(this); }
 773     Structure* jsToWasmICCalleeStructure() const { return m_jsToWasmICCalleeStructure.get(this); }
 774     Structure* webAssemblyWrapperFunctionStructure() const { return m_webAssemblyWrapperFunctionStructure.get(this); }

 775 #endif // ENABLE(WEBASSEMBLY)
 776 #if ENABLE(INTL)
 777     Structure* collatorStructure() { return m_collatorStructure.get(this); }
 778     Structure* numberFormatStructure() { return m_numberFormatStructure.get(this); }
 779     Structure* dateTimeFormatStructure() { return m_dateTimeFormatStructure.get(this); }
 780     Structure* pluralRulesStructure() { return m_pluralRulesStructure.get(this); }
 781 #endif // ENABLE(INTL)
 782 
 783     JS_EXPORT_PRIVATE void setRemoteDebuggingEnabled(bool);
 784     JS_EXPORT_PRIVATE bool remoteDebuggingEnabled() const;
 785 
 786     RegExpGlobalData&amp; regExpGlobalData() { return m_regExpGlobalData; }
 787     static ptrdiff_t regExpGlobalDataOffset() { return OBJECT_OFFSETOF(JSGlobalObject, m_regExpGlobalData); }
 788 
 789 #if ENABLE(REMOTE_INSPECTOR)
 790     Inspector::JSGlobalObjectInspectorController&amp; inspectorController() const { return *m_inspectorController.get(); }
 791     JSGlobalObjectDebuggable&amp; inspectorDebuggable() { return *m_inspectorDebuggable.get(); }
 792 #endif
 793 







 794     void bumpGlobalLexicalBindingEpoch(VM&amp;);
 795     unsigned globalLexicalBindingEpoch() const { return m_globalLexicalBindingEpoch; }
 796     static ptrdiff_t globalLexicalBindingEpochOffset() { return OBJECT_OFFSETOF(JSGlobalObject, m_globalLexicalBindingEpoch); }
 797     unsigned* addressOfGlobalLexicalBindingEpoch() { return &amp;m_globalLexicalBindingEpoch; }
 798 
 799     void setConsoleClient(ConsoleClient* consoleClient) { m_consoleClient = consoleClient; }
 800     ConsoleClient* consoleClient() const { return m_consoleClient; }
 801 
 802     void setName(const String&amp;);
 803     const String&amp; name() const { return m_name; }
 804 
 805     void setUnhandledRejectionCallback(VM&amp; vm, JSObject* function) { m_unhandledRejectionCallback.set(vm, function); }
 806     JSObject* unhandledRejectionCallback() const { return m_unhandledRejectionCallback.get(); }
 807 
 808     JSObject* arrayBufferConstructor() const { return m_arrayBufferStructure.constructor(this); }
 809 
 810     JSObject* arrayBufferPrototype(ArrayBufferSharingMode sharingMode) const
 811     {
 812         switch (sharingMode) {
 813         case ArrayBufferSharingMode::Default:
</pre>
<hr />
<pre>
 877     {
 878         return lazyTypedArrayStructure(type).get(this);
 879     }
 880     Structure* typedArrayStructureConcurrently(TypedArrayType type) const
 881     {
 882         return lazyTypedArrayStructure(type).getConcurrently();
 883     }
 884     bool isOriginalTypedArrayStructure(Structure* structure)
 885     {
 886         TypedArrayType type = structure-&gt;classInfo()-&gt;typedArrayStorageType;
 887         if (type == NotTypedArray)
 888             return false;
 889         return typedArrayStructureConcurrently(type) == structure;
 890     }
 891 
 892     JSObject* typedArrayConstructor(TypedArrayType type) const
 893     {
 894         return lazyTypedArrayStructure(type).constructor(this);
 895     }
 896 
<span class="line-modified"> 897     JSCell* linkTimeConstant(LinkTimeConstant value) const</span>





 898     {
<span class="line-modified"> 899         JSCell* result = m_linkTimeConstants[static_cast&lt;unsigned&gt;(value)].getInitializedOnMainThread(this);</span>
<span class="line-modified"> 900         ASSERT(result);</span>
<span class="line-modified"> 901         return result;</span>
 902     }
 903 
 904     WatchpointSet* masqueradesAsUndefinedWatchpoint() { return m_masqueradesAsUndefinedWatchpoint.get(); }
 905     WatchpointSet* havingABadTimeWatchpoint() { return m_havingABadTimeWatchpoint.get(); }
 906     WatchpointSet* varInjectionWatchpoint() { return m_varInjectionWatchpoint.get(); }
 907 
 908     bool isHavingABadTime() const
 909     {
 910         return m_havingABadTimeWatchpoint-&gt;hasBeenInvalidated();
 911     }
 912 
 913     void haveABadTime(VM&amp;);
 914 
 915     bool objectPrototypeIsSane();
 916     bool arrayPrototypeChainIsSane();
 917     bool stringPrototypeChainIsSane();
 918 
 919     void setProfileGroup(unsigned value) { createRareDataIfNeeded(); m_rareData-&gt;profileGroup = value; }
 920     unsigned profileGroup() const
 921     {
 922         if (!m_rareData)
 923             return 0;
 924         return m_rareData-&gt;profileGroup;
 925     }
 926 
 927     Debugger* debugger() const { return m_debugger; }
 928     void setDebugger(Debugger*);
 929 
 930     const GlobalObjectMethodTable* globalObjectMethodTable() const { return m_globalObjectMethodTable; }
 931 
<span class="line-modified"> 932     JS_EXPORT_PRIVATE CallFrame* deprecatedCallFrameForDebugger();</span>
 933 
<span class="line-modified"> 934     static bool supportsRichSourceInfo(const JSGlobalObject*) { return true; }</span>
 935 
 936     static bool shouldInterruptScript(const JSGlobalObject*) { return true; }
 937     static bool shouldInterruptScriptBeforeTimeout(const JSGlobalObject*) { return false; }
 938     static RuntimeFlags javaScriptRuntimeFlags(const JSGlobalObject*) { return RuntimeFlags(); }
 939 
 940     JS_EXPORT_PRIVATE void queueMicrotask(Ref&lt;Microtask&gt;&amp;&amp;);
 941 
 942     bool evalEnabled() const { return m_evalEnabled; }
 943     bool webAssemblyEnabled() const { return m_webAssemblyEnabled; }
 944     const String&amp; evalDisabledErrorMessage() const { return m_evalDisabledErrorMessage; }
 945     const String&amp; webAssemblyDisabledErrorMessage() const { return m_webAssemblyDisabledErrorMessage; }
 946     void setEvalEnabled(bool enabled, const String&amp; errorMessage = String())
 947     {
 948         m_evalEnabled = enabled;
 949         m_evalDisabledErrorMessage = errorMessage;
 950     }
 951     void setWebAssemblyEnabled(bool enabled, const String&amp; errorMessage = String())
 952     {
 953         m_webAssemblyEnabled = enabled;
 954         m_webAssemblyDisabledErrorMessage = errorMessage;
 955     }
 956 
<span class="line-modified"> 957 #if ASSERT_ENABLED</span>
<span class="line-modified"> 958     const JSGlobalObject* globalObjectAtDebuggerEntry() const { return m_globalObjectAtDebuggerEntry; }</span>
<span class="line-modified"> 959     void setGlobalObjectAtDebuggerEntry(const JSGlobalObject* globalObject) { m_globalObjectAtDebuggerEntry = globalObject; }</span>
 960 #endif
 961 
 962     void resetPrototype(VM&amp;, JSValue prototype);
 963 
<span class="line-modified"> 964     VM&amp; vm() const { return *m_vm; }</span>
 965     JSObject* globalThis() const;
 966     WriteBarrier&lt;JSObject&gt;* addressOfGlobalThis() { return &amp;m_globalThis; }
 967     OptionSet&lt;CodeGenerationMode&gt; defaultCodeGenerationMode() const;
 968 
 969     static Structure* createStructure(VM&amp; vm, JSValue prototype)
 970     {
 971         Structure* result = Structure::create(vm, 0, prototype, TypeInfo(GlobalObjectType, StructureFlags), info());
 972         result-&gt;setTransitionWatchpointIsLikelyToBeFired(true);
 973         return result;
 974     }
 975 
 976     void registerWeakMap(OpaqueJSWeakObjectMap* map)
 977     {
 978         createRareDataIfNeeded();
 979         m_rareData-&gt;weakMaps.add(map);
 980     }
 981 
 982     void unregisterWeakMap(OpaqueJSWeakObjectMap* map)
 983     {
 984         if (m_rareData)
</pre>
<hr />
<pre>
 991         return m_rareData-&gt;opaqueJSClassData;
 992     }
 993 
 994     static ptrdiff_t weakRandomOffset() { return OBJECT_OFFSETOF(JSGlobalObject, m_weakRandom); }
 995     double weakRandomNumber() { return m_weakRandom.get(); }
 996     unsigned weakRandomInteger() { return m_weakRandom.getUint32(); }
 997     WeakRandom&amp; weakRandom() { return m_weakRandom; }
 998 
 999     bool needsSiteSpecificQuirks() const { return m_needsSiteSpecificQuirks; }
1000     JS_EXPORT_PRIVATE void exposeDollarVM(VM&amp;);
1001 
1002 #if JSC_OBJC_API_ENABLED
1003     JSWrapperMap* wrapperMap() const { return m_wrapperMap.get(); }
1004     void setWrapperMap(JSWrapperMap* map) { m_wrapperMap = map; }
1005 #endif
1006 #ifdef JSC_GLIB_API_ENABLED
1007     WrapperMap* wrapperMap() const { return m_wrapperMap.get(); }
1008     void setWrapperMap(std::unique_ptr&lt;WrapperMap&gt;&amp;&amp;);
1009 #endif
1010 
<span class="line-modified">1011     void tryInstallArraySpeciesWatchpoint();</span>
<span class="line-added">1012     void installNumberPrototypeWatchpoint(NumberPrototype*);</span>
<span class="line-added">1013     void installMapPrototypeWatchpoint(MapPrototype*);</span>
<span class="line-added">1014     void installSetPrototypeWatchpoint(SetPrototype*);</span>
1015 
1016 protected:
1017     struct GlobalPropertyInfo {
1018         GlobalPropertyInfo(const Identifier&amp; i, JSValue v, unsigned a)
1019             : identifier(i)
1020             , value(v)
1021             , attributes(a)
1022         {
1023         }
1024 
1025         const Identifier identifier;
1026         JSValue value;
1027         unsigned attributes;
1028     };
1029     JS_EXPORT_PRIVATE void addStaticGlobals(GlobalPropertyInfo*, int count);
1030 
1031     void setNeedsSiteSpecificQuirks(bool needQuirks) { m_needsSiteSpecificQuirks = needQuirks; }
1032 
1033 private:
1034     friend class LLIntOffsetsExtractor;
</pre>
<hr />
<pre>
1036     void fireWatchpointAndMakeAllArrayStructuresSlowPut(VM&amp;);
1037     void setGlobalThis(VM&amp;, JSObject* globalThis);
1038 
1039     template&lt;ErrorType errorType&gt;
1040     void initializeErrorConstructor(LazyClassStructure::Initializer&amp;);
1041 
1042     JS_EXPORT_PRIVATE void init(VM&amp;);
1043     void fixupPrototypeChainWithObjectPrototype(VM&amp;);
1044 
1045     JS_EXPORT_PRIVATE static void clearRareData(JSCell*);
1046 
1047     bool m_needsSiteSpecificQuirks { false };
1048 #if JSC_OBJC_API_ENABLED
1049     RetainPtr&lt;JSWrapperMap&gt; m_wrapperMap;
1050 #endif
1051 #ifdef JSC_GLIB_API_ENABLED
1052     std::unique_ptr&lt;WrapperMap&gt; m_wrapperMap;
1053 #endif
1054 };
1055 
<span class="line-modified">1056 inline JSArray* constructEmptyArray(JSGlobalObject* globalObject, ArrayAllocationProfile* profile, unsigned initialLength = 0, JSValue newTarget = JSValue())</span>
1057 {
<span class="line-modified">1058     VM&amp; vm = getVM(globalObject);</span>
1059     auto scope = DECLARE_THROW_SCOPE(vm);
1060     Structure* structure;
1061     if (initialLength &gt;= MIN_ARRAY_STORAGE_CONSTRUCTION_LENGTH)
<span class="line-modified">1062         structure = globalObject-&gt;arrayStructureForIndexingTypeDuringAllocation(globalObject, ArrayWithArrayStorage, newTarget);</span>
1063     else
<span class="line-modified">1064         structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(globalObject, profile, newTarget);</span>
1065     RETURN_IF_EXCEPTION(scope, nullptr);
1066 
1067     JSArray* result = JSArray::tryCreate(vm, structure, initialLength);
1068     if (UNLIKELY(!result)) {
<span class="line-modified">1069         throwOutOfMemoryError(globalObject, scope);</span>
1070         return nullptr;
1071     }
1072     return ArrayAllocationProfile::updateLastAllocationFor(profile, result);
1073 }
1074 
<span class="line-modified">1075 inline JSArray* constructArray(JSGlobalObject* globalObject, ArrayAllocationProfile* profile, const ArgList&amp; values, JSValue newTarget = JSValue())</span>





1076 {
<span class="line-modified">1077     VM&amp; vm = getVM(globalObject);</span>
1078     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">1079     Structure* structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(globalObject, profile, newTarget);</span>
1080     RETURN_IF_EXCEPTION(scope, nullptr);
<span class="line-modified">1081     return ArrayAllocationProfile::updateLastAllocationFor(profile, constructArray(globalObject, structure, values));</span>





1082 }
1083 
<span class="line-modified">1084 inline JSArray* constructArray(JSGlobalObject* globalObject, ArrayAllocationProfile* profile, const JSValue* values, unsigned length, JSValue newTarget = JSValue())</span>
1085 {
<span class="line-modified">1086     VM&amp; vm = getVM(globalObject);</span>
1087     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">1088     Structure* structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(globalObject, profile, newTarget);</span>
1089     RETURN_IF_EXCEPTION(scope, nullptr);
<span class="line-modified">1090     return ArrayAllocationProfile::updateLastAllocationFor(profile, constructArray(globalObject, structure, values, length));</span>
1091 }
1092 
<span class="line-modified">1093 inline JSArray* constructArrayNegativeIndexed(JSGlobalObject* globalObject, ArrayAllocationProfile* profile, const JSValue* values, unsigned length, JSValue newTarget = JSValue())</span>
1094 {
<span class="line-modified">1095     VM&amp; vm = getVM(globalObject);</span>





1096     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">1097     Structure* structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(globalObject, profile, newTarget);</span>
1098     RETURN_IF_EXCEPTION(scope, nullptr);
<span class="line-modified">1099     return ArrayAllocationProfile::updateLastAllocationFor(profile, constructArrayNegativeIndexed(globalObject, structure, values, length));</span>










1100 }
1101 
1102 inline JSObject* JSScope::globalThis()
1103 {
1104     return globalObject()-&gt;globalThis();
1105 }
1106 
1107 inline JSObject* JSGlobalObject::globalThis() const
1108 {
1109     return m_globalThis.get();
1110 }
1111 
1112 inline OptionSet&lt;CodeGenerationMode&gt; JSGlobalObject::defaultCodeGenerationMode() const
1113 {
1114     OptionSet&lt;CodeGenerationMode&gt; codeGenerationMode;
1115     if (hasInteractiveDebugger() || Options::forceDebuggerBytecodeGeneration())
1116         codeGenerationMode.add(CodeGenerationMode::Debugger);
<span class="line-modified">1117     if (vm().typeProfiler())</span>
1118         codeGenerationMode.add(CodeGenerationMode::TypeProfiler);
<span class="line-modified">1119     if (vm().controlFlowProfiler())</span>
1120         codeGenerationMode.add(CodeGenerationMode::ControlFlowProfiler);
1121     return codeGenerationMode;
1122 }
1123 
1124 } // namespace JSC
</pre>
</td>
</tr>
</table>
<center><a href="JSGlobalObject.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSGlobalObjectFunctions.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>