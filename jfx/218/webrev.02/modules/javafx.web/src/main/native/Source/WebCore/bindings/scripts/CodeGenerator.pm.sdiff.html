<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/bindings/scripts/CodeGenerator.pm</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../js/WorkerScriptController.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="CodeGeneratorJS.pm.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bindings/scripts/CodeGenerator.pm</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  26 
  27 package CodeGenerator;
  28 
  29 use strict;
  30 
  31 use File::Basename;
  32 use File::Find;
  33 use Carp qw&lt;longmess&gt;;
  34 use Data::Dumper;
  35 
  36 my $useDocument = &quot;&quot;;
  37 my $useGenerator = &quot;&quot;;
  38 my $useOutputDir = &quot;&quot;;
  39 my $useOutputHeadersDir = &quot;&quot;;
  40 my $useDirectories = &quot;&quot;;
  41 my $preprocessor;
  42 my $idlAttributes;
  43 my $writeDependencies = 0;
  44 my $defines = &quot;&quot;;
  45 my $targetIdlFilePath = &quot;&quot;;

  46 
  47 my $codeGenerator = 0;
  48 
  49 my $verbose = 0;
  50 
  51 my %integerTypeHash = (
  52     &quot;byte&quot; =&gt; 1,
  53     &quot;long long&quot; =&gt; 1,
  54     &quot;long&quot; =&gt; 1,
  55     &quot;octet&quot; =&gt; 1,
  56     &quot;short&quot; =&gt; 1,
  57     &quot;unsigned long long&quot; =&gt; 1,
  58     &quot;unsigned long&quot; =&gt; 1,
  59     &quot;unsigned short&quot; =&gt; 1,
  60 );
  61 
  62 my %floatingPointTypeHash = (
  63     &quot;float&quot; =&gt; 1,
  64     &quot;unrestricted float&quot; =&gt; 1,
  65     &quot;double&quot; =&gt; 1,
</pre>
<hr />
<pre>
 130     print Dumper($mess);
 131 
 132     die $message;
 133 }
 134 
 135 # Default constructor
 136 sub new
 137 {
 138     my $object = shift;
 139     my $reference = { };
 140 
 141     $useDirectories = shift;
 142     $useGenerator = shift;
 143     $useOutputDir = shift;
 144     $useOutputHeadersDir = shift;
 145     $preprocessor = shift;
 146     $writeDependencies = shift;
 147     $verbose = shift;
 148     $targetIdlFilePath = shift;
 149     $idlAttributes = shift;

 150 
 151     bless($reference, $object);
 152     return $reference;
 153 }
 154 
 155 sub ProcessDocument
 156 {
 157     my $object = shift;
 158     $useDocument = shift;
 159     $defines = shift;
 160 


 161     my $ifaceName = &quot;CodeGenerator&quot; . $useGenerator;
 162     require $ifaceName . &quot;.pm&quot;;
 163 
 164     foreach my $dictionary (@{$useDocument-&gt;dictionaries}) {
 165         if ($dictionary-&gt;extendedAttributes-&gt;{&quot;ImplementedAs&quot;}) {
 166             $dictionaryTypeImplementationNameOverrides{$dictionary-&gt;type-&gt;name} = $dictionary-&gt;extendedAttributes-&gt;{&quot;ImplementedAs&quot;};
 167         }
 168     }
 169 
 170     foreach my $enumeration (@{$useDocument-&gt;enumerations}) {
 171         if ($enumeration-&gt;extendedAttributes-&gt;{&quot;ImplementedAs&quot;}) {
 172             $enumTypeImplementationNameOverrides{$enumeration-&gt;type-&gt;name} = $enumeration-&gt;extendedAttributes-&gt;{&quot;ImplementedAs&quot;};
 173         }
 174     }
 175 
 176     # Dynamically load external code generation perl module
 177     $codeGenerator = $ifaceName-&gt;new($object, $writeDependencies, $verbose, $targetIdlFilePath);
 178     unless (defined($codeGenerator)) {
 179         my $interfaces = $useDocument-&gt;interfaces;
 180         foreach my $interface (@$interfaces) {
</pre>
<hr />
<pre>
 226         print &quot;Generating $useGenerator bindings code for IDL dictionary \&quot;&quot; . $dictionary-&gt;type-&gt;name . &quot;\&quot;...\n&quot; if $verbose;
 227         $codeGenerator-&gt;GenerateDictionary($dictionary, $useDocument-&gt;enumerations, $otherDictionaries);
 228         $codeGenerator-&gt;WriteData($dictionary, $useOutputDir, $useOutputHeadersDir);
 229         return;
 230     }
 231     
 232     my $enumerations = $useDocument-&gt;enumerations;
 233     if (@$enumerations) {
 234         die &quot;Multiple standalone enumerations per document are not supported&quot; if @$enumerations &gt; 1;
 235 
 236         my $enumeration = @$enumerations[0];
 237         print &quot;Generating $useGenerator bindings code for IDL enumeration \&quot;&quot; . $enumeration-&gt;type-&gt;name . &quot;\&quot;...\n&quot; if $verbose;
 238         $codeGenerator-&gt;GenerateEnumeration($enumeration);
 239         $codeGenerator-&gt;WriteData($enumeration, $useOutputDir, $useOutputHeadersDir);
 240         return;
 241     }
 242 
 243     die &quot;Processing document &quot; . $useDocument-&gt;fileName . &quot; did not generate anything&quot;
 244 }
 245 
































































































































 246 sub FileNamePrefix
 247 {
 248     my $object = shift;
 249 
 250     my $ifaceName = &quot;CodeGenerator&quot; . $useGenerator;
 251     require $ifaceName . &quot;.pm&quot;;
 252 
 253     # Dynamically load external code generation perl module
 254     $codeGenerator = $ifaceName-&gt;new($object, $writeDependencies, $verbose);
 255     return $codeGenerator-&gt;FileNamePrefix();
 256 }
 257 
 258 sub UpdateFile
 259 {
 260     my $object = shift;
 261     my $fileName = shift;
 262     my $contents = shift;
 263 
 264     # FIXME: We should only write content if it is different from what is in the file.
 265     # But that would mean running more often the binding generator, see https://bugs.webkit.org/show_bug.cgi?id=131756
</pre>
<hr />
<pre>
 536 
 537     die &quot;GetDictionaryByType() was called with an undefined dictionary name&quot; unless defined($name);
 538 
 539     for my $dictionary (@{$useDocument-&gt;dictionaries}) {
 540         return $dictionary if $dictionary-&gt;type-&gt;name eq $name;
 541     }
 542 
 543     return $cachedExternalDictionaries-&gt;{$name} if exists($cachedExternalDictionaries-&gt;{$name});
 544 
 545     # Find the IDL file associated with the dictionary.
 546     my $filename = $object-&gt;IDLFileForInterface($name) or return;
 547 
 548     # Do a fast check to see if it seems to contain a dictionary.
 549     my $fileContents = slurp($filename);
 550 
 551     if ($fileContents =~ /\bdictionary\s+$name/gs) {
 552         # Parse the IDL.
 553         my $parser = IDLParser-&gt;new(1);
 554         my $document = $parser-&gt;Parse($filename, $defines, $preprocessor, $idlAttributes);
 555 


 556         foreach my $dictionary (@{$document-&gt;dictionaries}) {
 557             next unless $dictionary-&gt;type-&gt;name eq $name;
 558 
 559             $cachedExternalDictionaries-&gt;{$name} = $dictionary;
 560             my $implementedAs = $dictionary-&gt;extendedAttributes-&gt;{ImplementedAs};
 561             $dictionaryTypeImplementationNameOverrides{$dictionary-&gt;type-&gt;name} = $implementedAs if $implementedAs;
 562             return $dictionary;
 563         }
 564     }
 565     $cachedExternalDictionaries-&gt;{$name} = undef;
 566 }
 567 
 568 sub IsDictionaryType
 569 {
 570     my ($object, $type) = @_;
 571 
 572     assert(&quot;Not a type&quot;) if ref($type) ne &quot;IDLType&quot;;
 573 
 574     return $type-&gt;name =~ /^[A-Z]/ &amp;&amp; defined($object-&gt;GetDictionaryByType($type));
 575 }
</pre>
<hr />
<pre>
 695     my ($object, $type) = @_;
 696 
 697     assert(&quot;Not a type&quot;) if ref($type) ne &quot;IDLType&quot;;
 698 
 699     return $type-&gt;name eq &quot;Promise&quot;;
 700 }
 701 
 702 # These match WK_lcfirst and WK_ucfirst defined in builtins_generator.py.
 703 # Uppercase the first letter while respecting WebKit style guidelines.
 704 # E.g., xmlEncoding becomes XMLEncoding, but xmlllang becomes Xmllang.
 705 sub WK_ucfirst
 706 {
 707     my ($object, $param) = @_;
 708 
 709     my $ret = ucfirst($param);
 710     $ret =~ s/Xml/XML/ if $ret =~ /^Xml[^a-z]/;
 711     $ret =~ s/Svg/SVG/ if $ret =~ /^Svg/;
 712     $ret =~ s/Srgb/SRGB/ if $ret =~ /^Srgb/;
 713     $ret =~ s/Cenc/cenc/ if $ret =~ /^Cenc/;
 714     $ret =~ s/Cbcs/cbcs/ if $ret =~ /^Cbcs/;


 715 
 716     return $ret;
 717 }
 718 
 719 # Lowercase the first letter while respecting WebKit style guidelines.
 720 # URL becomes url, but SetURL becomes setURL.
 721 sub WK_lcfirst
 722 {
 723     my ($object, $param) = @_;
 724 
 725     my $ret = lcfirst($param);
 726     $ret =~ s/dOM/dom/ if $ret =~ /^dOM/;
 727     $ret =~ s/hTML/html/ if $ret =~ /^hTML/;
 728     $ret =~ s/uRL/url/ if $ret =~ /^uRL/;
 729     $ret =~ s/jS/js/ if $ret =~ /^jS/;
 730     $ret =~ s/xML/xml/ if $ret =~ /^xML/;
 731     $ret =~ s/xSLT/xslt/ if $ret =~ /^xSLT/;
 732     $ret =~ s/cSS/css/ if $ret =~ /^cSS/;
 733     $ret =~ s/rTC/rtc/ if $ret =~ /^rTC/;
 734 
</pre>
</td>
<td>
<hr />
<pre>
  26 
  27 package CodeGenerator;
  28 
  29 use strict;
  30 
  31 use File::Basename;
  32 use File::Find;
  33 use Carp qw&lt;longmess&gt;;
  34 use Data::Dumper;
  35 
  36 my $useDocument = &quot;&quot;;
  37 my $useGenerator = &quot;&quot;;
  38 my $useOutputDir = &quot;&quot;;
  39 my $useOutputHeadersDir = &quot;&quot;;
  40 my $useDirectories = &quot;&quot;;
  41 my $preprocessor;
  42 my $idlAttributes;
  43 my $writeDependencies = 0;
  44 my $defines = &quot;&quot;;
  45 my $targetIdlFilePath = &quot;&quot;;
<span class="line-added">  46 my $supplementalDependencies;</span>
  47 
  48 my $codeGenerator = 0;
  49 
  50 my $verbose = 0;
  51 
  52 my %integerTypeHash = (
  53     &quot;byte&quot; =&gt; 1,
  54     &quot;long long&quot; =&gt; 1,
  55     &quot;long&quot; =&gt; 1,
  56     &quot;octet&quot; =&gt; 1,
  57     &quot;short&quot; =&gt; 1,
  58     &quot;unsigned long long&quot; =&gt; 1,
  59     &quot;unsigned long&quot; =&gt; 1,
  60     &quot;unsigned short&quot; =&gt; 1,
  61 );
  62 
  63 my %floatingPointTypeHash = (
  64     &quot;float&quot; =&gt; 1,
  65     &quot;unrestricted float&quot; =&gt; 1,
  66     &quot;double&quot; =&gt; 1,
</pre>
<hr />
<pre>
 131     print Dumper($mess);
 132 
 133     die $message;
 134 }
 135 
 136 # Default constructor
 137 sub new
 138 {
 139     my $object = shift;
 140     my $reference = { };
 141 
 142     $useDirectories = shift;
 143     $useGenerator = shift;
 144     $useOutputDir = shift;
 145     $useOutputHeadersDir = shift;
 146     $preprocessor = shift;
 147     $writeDependencies = shift;
 148     $verbose = shift;
 149     $targetIdlFilePath = shift;
 150     $idlAttributes = shift;
<span class="line-added"> 151     $supplementalDependencies = shift;</span>
 152 
 153     bless($reference, $object);
 154     return $reference;
 155 }
 156 
 157 sub ProcessDocument
 158 {
 159     my $object = shift;
 160     $useDocument = shift;
 161     $defines = shift;
 162 
<span class="line-added"> 163     $object-&gt;ProcessSupplementalDependencies($useDocument);</span>
<span class="line-added"> 164 </span>
 165     my $ifaceName = &quot;CodeGenerator&quot; . $useGenerator;
 166     require $ifaceName . &quot;.pm&quot;;
 167 
 168     foreach my $dictionary (@{$useDocument-&gt;dictionaries}) {
 169         if ($dictionary-&gt;extendedAttributes-&gt;{&quot;ImplementedAs&quot;}) {
 170             $dictionaryTypeImplementationNameOverrides{$dictionary-&gt;type-&gt;name} = $dictionary-&gt;extendedAttributes-&gt;{&quot;ImplementedAs&quot;};
 171         }
 172     }
 173 
 174     foreach my $enumeration (@{$useDocument-&gt;enumerations}) {
 175         if ($enumeration-&gt;extendedAttributes-&gt;{&quot;ImplementedAs&quot;}) {
 176             $enumTypeImplementationNameOverrides{$enumeration-&gt;type-&gt;name} = $enumeration-&gt;extendedAttributes-&gt;{&quot;ImplementedAs&quot;};
 177         }
 178     }
 179 
 180     # Dynamically load external code generation perl module
 181     $codeGenerator = $ifaceName-&gt;new($object, $writeDependencies, $verbose, $targetIdlFilePath);
 182     unless (defined($codeGenerator)) {
 183         my $interfaces = $useDocument-&gt;interfaces;
 184         foreach my $interface (@$interfaces) {
</pre>
<hr />
<pre>
 230         print &quot;Generating $useGenerator bindings code for IDL dictionary \&quot;&quot; . $dictionary-&gt;type-&gt;name . &quot;\&quot;...\n&quot; if $verbose;
 231         $codeGenerator-&gt;GenerateDictionary($dictionary, $useDocument-&gt;enumerations, $otherDictionaries);
 232         $codeGenerator-&gt;WriteData($dictionary, $useOutputDir, $useOutputHeadersDir);
 233         return;
 234     }
 235     
 236     my $enumerations = $useDocument-&gt;enumerations;
 237     if (@$enumerations) {
 238         die &quot;Multiple standalone enumerations per document are not supported&quot; if @$enumerations &gt; 1;
 239 
 240         my $enumeration = @$enumerations[0];
 241         print &quot;Generating $useGenerator bindings code for IDL enumeration \&quot;&quot; . $enumeration-&gt;type-&gt;name . &quot;\&quot;...\n&quot; if $verbose;
 242         $codeGenerator-&gt;GenerateEnumeration($enumeration);
 243         $codeGenerator-&gt;WriteData($enumeration, $useOutputDir, $useOutputHeadersDir);
 244         return;
 245     }
 246 
 247     die &quot;Processing document &quot; . $useDocument-&gt;fileName . &quot; did not generate anything&quot;
 248 }
 249 
<span class="line-added"> 250 sub ProcessSupplementalDependencies</span>
<span class="line-added"> 251 {</span>
<span class="line-added"> 252     my ($object, $targetDocument) = @_;</span>
<span class="line-added"> 253     my $targetFileName = fileparse($targetDocument-&gt;fileName);</span>
<span class="line-added"> 254     my $targetInterfaceName = fileparse($targetFileName, &quot;.idl&quot;);</span>
<span class="line-added"> 255 </span>
<span class="line-added"> 256     if (!$supplementalDependencies) {</span>
<span class="line-added"> 257         return;</span>
<span class="line-added"> 258     }</span>
<span class="line-added"> 259 </span>
<span class="line-added"> 260     foreach my $idlFile (@{$supplementalDependencies-&gt;{$targetFileName}}) {</span>
<span class="line-added"> 261         next if fileparse($idlFile) eq $targetFileName;</span>
<span class="line-added"> 262 </span>
<span class="line-added"> 263         my $interfaceName = fileparse($idlFile, &quot;.idl&quot;);</span>
<span class="line-added"> 264         my $parser = IDLParser-&gt;new(!$verbose);</span>
<span class="line-added"> 265         my $document = $parser-&gt;Parse($idlFile, $defines, $preprocessor, $idlAttributes);</span>
<span class="line-added"> 266 </span>
<span class="line-added"> 267         foreach my $interface (@{$document-&gt;interfaces}) {</span>
<span class="line-added"> 268             next unless !$interface-&gt;isPartial || $interface-&gt;type-&gt;name eq $targetInterfaceName;</span>
<span class="line-added"> 269 </span>
<span class="line-added"> 270             my $targetDataNode;</span>
<span class="line-added"> 271             my @targetGlobalContexts;</span>
<span class="line-added"> 272             foreach my $interface (@{$targetDocument-&gt;interfaces}) {</span>
<span class="line-added"> 273                 if ($interface-&gt;type-&gt;name eq $targetInterfaceName) {</span>
<span class="line-added"> 274                     $targetDataNode = $interface;</span>
<span class="line-added"> 275                     my $exposedAttribute = $targetDataNode-&gt;extendedAttributes-&gt;{&quot;Exposed&quot;} || &quot;Window&quot;;</span>
<span class="line-added"> 276                     $exposedAttribute = substr($exposedAttribute, 1, -1) if substr($exposedAttribute, 0, 1) eq &quot;(&quot;;</span>
<span class="line-added"> 277                     @targetGlobalContexts = split(&quot;,&quot;, $exposedAttribute);</span>
<span class="line-added"> 278                     last;</span>
<span class="line-added"> 279                 }</span>
<span class="line-added"> 280             }</span>
<span class="line-added"> 281             die &quot;Not found an interface ${targetInterfaceName} in ${targetInterfaceName}.idl.&quot; unless defined $targetDataNode;</span>
<span class="line-added"> 282 </span>
<span class="line-added"> 283             # Support for attributes of partial interfaces.</span>
<span class="line-added"> 284             foreach my $attribute (@{$interface-&gt;attributes}) {</span>
<span class="line-added"> 285                 next unless shouldPropertyBeExposed($attribute, \@targetGlobalContexts);</span>
<span class="line-added"> 286 </span>
<span class="line-added"> 287                 # Record that this attribute is implemented by $interfaceName.</span>
<span class="line-added"> 288                 $attribute-&gt;extendedAttributes-&gt;{&quot;ImplementedBy&quot;} = $interfaceName if $interface-&gt;isPartial &amp;&amp; !$attribute-&gt;extendedAttributes-&gt;{Reflect};</span>
<span class="line-added"> 289 </span>
<span class="line-added"> 290                 # Add interface-wide extended attributes to each attribute.</span>
<span class="line-added"> 291                 foreach my $extendedAttributeName (keys %{$interface-&gt;extendedAttributes}) {</span>
<span class="line-added"> 292                     $attribute-&gt;extendedAttributes-&gt;{$extendedAttributeName} = $interface-&gt;extendedAttributes-&gt;{$extendedAttributeName};</span>
<span class="line-added"> 293                 }</span>
<span class="line-added"> 294                 push(@{$targetDataNode-&gt;attributes}, $attribute);</span>
<span class="line-added"> 295             }</span>
<span class="line-added"> 296 </span>
<span class="line-added"> 297             # Support for methods of partial interfaces.</span>
<span class="line-added"> 298             foreach my $operation (@{$interface-&gt;operations}) {</span>
<span class="line-added"> 299                 next unless shouldPropertyBeExposed($operation, \@targetGlobalContexts);</span>
<span class="line-added"> 300 </span>
<span class="line-added"> 301                 # Record that this method is implemented by $interfaceName.</span>
<span class="line-added"> 302                 $operation-&gt;extendedAttributes-&gt;{&quot;ImplementedBy&quot;} = $interfaceName if $interface-&gt;isPartial;</span>
<span class="line-added"> 303 </span>
<span class="line-added"> 304                 # Add interface-wide extended attributes to each method.</span>
<span class="line-added"> 305                 foreach my $extendedAttributeName (keys %{$interface-&gt;extendedAttributes}) {</span>
<span class="line-added"> 306                     $operation-&gt;extendedAttributes-&gt;{$extendedAttributeName} = $interface-&gt;extendedAttributes-&gt;{$extendedAttributeName};</span>
<span class="line-added"> 307                 }</span>
<span class="line-added"> 308                 push(@{$targetDataNode-&gt;operations}, $operation);</span>
<span class="line-added"> 309             }</span>
<span class="line-added"> 310 </span>
<span class="line-added"> 311             # Support for constants of partial interfaces.</span>
<span class="line-added"> 312             foreach my $constant (@{$interface-&gt;constants}) {</span>
<span class="line-added"> 313                 next unless shouldPropertyBeExposed($constant, \@targetGlobalContexts);</span>
<span class="line-added"> 314 </span>
<span class="line-added"> 315                 # Record that this constant is implemented by $interfaceName.</span>
<span class="line-added"> 316                 $constant-&gt;extendedAttributes-&gt;{&quot;ImplementedBy&quot;} = $interfaceName if $interface-&gt;isPartial;</span>
<span class="line-added"> 317 </span>
<span class="line-added"> 318                 # Add interface-wide extended attributes to each constant.</span>
<span class="line-added"> 319                 foreach my $extendedAttributeName (keys %{$interface-&gt;extendedAttributes}) {</span>
<span class="line-added"> 320                     $constant-&gt;extendedAttributes-&gt;{$extendedAttributeName} = $interface-&gt;extendedAttributes-&gt;{$extendedAttributeName};</span>
<span class="line-added"> 321                 }</span>
<span class="line-added"> 322                 push(@{$targetDataNode-&gt;constants}, $constant);</span>
<span class="line-added"> 323             }</span>
<span class="line-added"> 324         }</span>
<span class="line-added"> 325 </span>
<span class="line-added"> 326         foreach my $dictionary (@{$document-&gt;dictionaries}) {</span>
<span class="line-added"> 327             next unless $dictionary-&gt;isPartial &amp;&amp; $dictionary-&gt;type-&gt;name eq $targetInterfaceName;</span>
<span class="line-added"> 328 </span>
<span class="line-added"> 329             my $targetDataNode;</span>
<span class="line-added"> 330             my @targetGlobalContexts;</span>
<span class="line-added"> 331             foreach my $dictionary (@{$targetDocument-&gt;dictionaries}) {</span>
<span class="line-added"> 332                 if ($dictionary-&gt;type-&gt;name eq $targetInterfaceName) {</span>
<span class="line-added"> 333                     $targetDataNode = $dictionary;</span>
<span class="line-added"> 334                     my $exposedAttribute = $targetDataNode-&gt;extendedAttributes-&gt;{&quot;Exposed&quot;} || &quot;Window&quot;;</span>
<span class="line-added"> 335                     $exposedAttribute = substr($exposedAttribute, 1, -1) if substr($exposedAttribute, 0, 1) eq &quot;(&quot;;</span>
<span class="line-added"> 336                     @targetGlobalContexts = split(&quot;,&quot;, $exposedAttribute);</span>
<span class="line-added"> 337                     last;</span>
<span class="line-added"> 338                 }</span>
<span class="line-added"> 339             }</span>
<span class="line-added"> 340             die &quot;Could not find dictionary ${targetInterfaceName} in ${targetInterfaceName}.idl.&quot; unless defined $targetDataNode;</span>
<span class="line-added"> 341 </span>
<span class="line-added"> 342             # Support for members of partial dictionaries</span>
<span class="line-added"> 343             foreach my $member (@{$dictionary-&gt;members}) {</span>
<span class="line-added"> 344                 next unless shouldPropertyBeExposed($member, \@targetGlobalContexts);</span>
<span class="line-added"> 345 </span>
<span class="line-added"> 346                 # Record that this member is implemented by $interfaceName.</span>
<span class="line-added"> 347                 $member-&gt;extendedAttributes-&gt;{&quot;ImplementedBy&quot;} = $interfaceName;</span>
<span class="line-added"> 348 </span>
<span class="line-added"> 349                 # Add interface-wide extended attributes to each member.</span>
<span class="line-added"> 350                 foreach my $extendedAttributeName (keys %{$dictionary-&gt;extendedAttributes}) {</span>
<span class="line-added"> 351                     $member-&gt;extendedAttributes-&gt;{$extendedAttributeName} = $dictionary-&gt;extendedAttributes-&gt;{$extendedAttributeName};</span>
<span class="line-added"> 352                 }</span>
<span class="line-added"> 353                 push(@{$targetDataNode-&gt;members}, $member);</span>
<span class="line-added"> 354             }</span>
<span class="line-added"> 355         }</span>
<span class="line-added"> 356     }</span>
<span class="line-added"> 357 }</span>
<span class="line-added"> 358 </span>
<span class="line-added"> 359 # Attributes / Operations / Constants of supplemental interfaces can have an [Exposed=XX] attribute which restricts</span>
<span class="line-added"> 360 # on which global contexts they should be exposed.</span>
<span class="line-added"> 361 sub shouldPropertyBeExposed</span>
<span class="line-added"> 362 {</span>
<span class="line-added"> 363     my ($context, $targetGlobalContexts) = @_;</span>
<span class="line-added"> 364 </span>
<span class="line-added"> 365     my $exposed = $context-&gt;extendedAttributes-&gt;{Exposed};</span>
<span class="line-added"> 366 </span>
<span class="line-added"> 367     return 1 unless $exposed;</span>
<span class="line-added"> 368 </span>
<span class="line-added"> 369     $exposed = substr($exposed, 1, -1) if substr($exposed, 0, 1) eq &quot;(&quot;;</span>
<span class="line-added"> 370     my @sourceGlobalContexts = split(&quot;,&quot;, $exposed);</span>
<span class="line-added"> 371 </span>
<span class="line-added"> 372     for my $targetGlobalContext (@$targetGlobalContexts) {</span>
<span class="line-added"> 373         return 1 if grep(/^$targetGlobalContext$/, @sourceGlobalContexts);</span>
<span class="line-added"> 374     }</span>
<span class="line-added"> 375     return 0;</span>
<span class="line-added"> 376 }</span>
<span class="line-added"> 377 </span>
 378 sub FileNamePrefix
 379 {
 380     my $object = shift;
 381 
 382     my $ifaceName = &quot;CodeGenerator&quot; . $useGenerator;
 383     require $ifaceName . &quot;.pm&quot;;
 384 
 385     # Dynamically load external code generation perl module
 386     $codeGenerator = $ifaceName-&gt;new($object, $writeDependencies, $verbose);
 387     return $codeGenerator-&gt;FileNamePrefix();
 388 }
 389 
 390 sub UpdateFile
 391 {
 392     my $object = shift;
 393     my $fileName = shift;
 394     my $contents = shift;
 395 
 396     # FIXME: We should only write content if it is different from what is in the file.
 397     # But that would mean running more often the binding generator, see https://bugs.webkit.org/show_bug.cgi?id=131756
</pre>
<hr />
<pre>
 668 
 669     die &quot;GetDictionaryByType() was called with an undefined dictionary name&quot; unless defined($name);
 670 
 671     for my $dictionary (@{$useDocument-&gt;dictionaries}) {
 672         return $dictionary if $dictionary-&gt;type-&gt;name eq $name;
 673     }
 674 
 675     return $cachedExternalDictionaries-&gt;{$name} if exists($cachedExternalDictionaries-&gt;{$name});
 676 
 677     # Find the IDL file associated with the dictionary.
 678     my $filename = $object-&gt;IDLFileForInterface($name) or return;
 679 
 680     # Do a fast check to see if it seems to contain a dictionary.
 681     my $fileContents = slurp($filename);
 682 
 683     if ($fileContents =~ /\bdictionary\s+$name/gs) {
 684         # Parse the IDL.
 685         my $parser = IDLParser-&gt;new(1);
 686         my $document = $parser-&gt;Parse($filename, $defines, $preprocessor, $idlAttributes);
 687 
<span class="line-added"> 688         $object-&gt;ProcessSupplementalDependencies($document);</span>
<span class="line-added"> 689 </span>
 690         foreach my $dictionary (@{$document-&gt;dictionaries}) {
 691             next unless $dictionary-&gt;type-&gt;name eq $name;
 692 
 693             $cachedExternalDictionaries-&gt;{$name} = $dictionary;
 694             my $implementedAs = $dictionary-&gt;extendedAttributes-&gt;{ImplementedAs};
 695             $dictionaryTypeImplementationNameOverrides{$dictionary-&gt;type-&gt;name} = $implementedAs if $implementedAs;
 696             return $dictionary;
 697         }
 698     }
 699     $cachedExternalDictionaries-&gt;{$name} = undef;
 700 }
 701 
 702 sub IsDictionaryType
 703 {
 704     my ($object, $type) = @_;
 705 
 706     assert(&quot;Not a type&quot;) if ref($type) ne &quot;IDLType&quot;;
 707 
 708     return $type-&gt;name =~ /^[A-Z]/ &amp;&amp; defined($object-&gt;GetDictionaryByType($type));
 709 }
</pre>
<hr />
<pre>
 829     my ($object, $type) = @_;
 830 
 831     assert(&quot;Not a type&quot;) if ref($type) ne &quot;IDLType&quot;;
 832 
 833     return $type-&gt;name eq &quot;Promise&quot;;
 834 }
 835 
 836 # These match WK_lcfirst and WK_ucfirst defined in builtins_generator.py.
 837 # Uppercase the first letter while respecting WebKit style guidelines.
 838 # E.g., xmlEncoding becomes XMLEncoding, but xmlllang becomes Xmllang.
 839 sub WK_ucfirst
 840 {
 841     my ($object, $param) = @_;
 842 
 843     my $ret = ucfirst($param);
 844     $ret =~ s/Xml/XML/ if $ret =~ /^Xml[^a-z]/;
 845     $ret =~ s/Svg/SVG/ if $ret =~ /^Svg/;
 846     $ret =~ s/Srgb/SRGB/ if $ret =~ /^Srgb/;
 847     $ret =~ s/Cenc/cenc/ if $ret =~ /^Cenc/;
 848     $ret =~ s/Cbcs/cbcs/ if $ret =~ /^Cbcs/;
<span class="line-added"> 849     $ret =~ s/Pq/PQ/ if $ret =~ /^Pq$/;</span>
<span class="line-added"> 850     $ret =~ s/Hlg/HLG/ if $ret =~ /^Hlg/;</span>
 851 
 852     return $ret;
 853 }
 854 
 855 # Lowercase the first letter while respecting WebKit style guidelines.
 856 # URL becomes url, but SetURL becomes setURL.
 857 sub WK_lcfirst
 858 {
 859     my ($object, $param) = @_;
 860 
 861     my $ret = lcfirst($param);
 862     $ret =~ s/dOM/dom/ if $ret =~ /^dOM/;
 863     $ret =~ s/hTML/html/ if $ret =~ /^hTML/;
 864     $ret =~ s/uRL/url/ if $ret =~ /^uRL/;
 865     $ret =~ s/jS/js/ if $ret =~ /^jS/;
 866     $ret =~ s/xML/xml/ if $ret =~ /^xML/;
 867     $ret =~ s/xSLT/xslt/ if $ret =~ /^xSLT/;
 868     $ret =~ s/cSS/css/ if $ret =~ /^cSS/;
 869     $ret =~ s/rTC/rtc/ if $ret =~ /^rTC/;
 870 
</pre>
</td>
</tr>
</table>
<center><a href="../js/WorkerScriptController.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="CodeGeneratorJS.pm.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>