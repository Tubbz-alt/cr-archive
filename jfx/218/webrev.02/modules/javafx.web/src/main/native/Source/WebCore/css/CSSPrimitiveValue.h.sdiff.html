<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/css/CSSPrimitiveValue.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CSSPrimitiveValue.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CSSPrimitiveValueMappings.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/css/CSSPrimitiveValue.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  5  *
  6  * This library is free software; you can redistribute it and/or
  7  * modify it under the terms of the GNU Library General Public
  8  * License as published by the Free Software Foundation; either
  9  * version 2 of the License, or (at your option) any later version.
 10  *
 11  * This library is distributed in the hope that it will be useful,
 12  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 13  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 14  * Library General Public License for more details.
 15  *
 16  * You should have received a copy of the GNU Library General Public License
 17  * along with this library; see the file COPYING.LIB.  If not, write to
 18  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 19  * Boston, MA 02110-1301, USA.
 20  */
 21 
 22 #pragma once
 23 
 24 #include &quot;CSSPropertyNames.h&quot;

 25 #include &quot;CSSValue.h&quot;
 26 #include &quot;CSSValueKeywords.h&quot;
 27 #include &quot;Color.h&quot;
 28 #include &quot;ExceptionOr.h&quot;
 29 #include &quot;LayoutUnit.h&quot;
 30 #include &lt;utility&gt;
 31 #include &lt;wtf/Forward.h&gt;
 32 #include &lt;wtf/MathExtras.h&gt;
 33 
 34 namespace WebCore {
 35 
 36 class CSSBasicShape;
 37 class CSSCalcValue;
 38 class CSSToLengthConversionData;
 39 class Counter;
 40 class DeprecatedCSSOMPrimitiveValue;
 41 class Pair;
 42 class Quad;
 43 class RGBColor;
 44 class Rect;
</pre>
<hr />
<pre>
 57 // 44.99998. We need to round if we&#39;re really close to the next integer value.
 58 template&lt;typename T&gt; inline T roundForImpreciseConversion(double value)
 59 {
 60     value += (value &lt; 0) ? -0.01 : +0.01;
 61     return ((value &gt; std::numeric_limits&lt;T&gt;::max()) || (value &lt; std::numeric_limits&lt;T&gt;::min())) ? 0 : static_cast&lt;T&gt;(value);
 62 }
 63 
 64 template&lt;&gt; inline float roundForImpreciseConversion(double value)
 65 {
 66     double ceiledValue = ceil(value);
 67     double proximityToNextInt = ceiledValue - value;
 68     if (proximityToNextInt &lt;= 0.01 &amp;&amp; value &gt; 0)
 69         return static_cast&lt;float&gt;(ceiledValue);
 70     if (proximityToNextInt &gt;= 0.99 &amp;&amp; value &lt; 0)
 71         return static_cast&lt;float&gt;(floor(value));
 72     return static_cast&lt;float&gt;(value);
 73 }
 74 
 75 class CSSPrimitiveValue final : public CSSValue {
 76 public:
<span class="line-modified"> 77     enum UnitType {</span>
<span class="line-modified"> 78         CSS_UNKNOWN = 0,</span>
<span class="line-modified"> 79         CSS_NUMBER = 1,</span>
<span class="line-modified"> 80         CSS_PERCENTAGE = 2,</span>
<span class="line-modified"> 81         CSS_EMS = 3,</span>
<span class="line-modified"> 82         CSS_EXS = 4,</span>
<span class="line-modified"> 83         CSS_PX = 5,</span>
<span class="line-modified"> 84         CSS_CM = 6,</span>
<span class="line-modified"> 85         CSS_MM = 7,</span>
<span class="line-modified"> 86         CSS_IN = 8,</span>
<span class="line-modified"> 87         CSS_PT = 9,</span>
<span class="line-modified"> 88         CSS_PC = 10,</span>
<span class="line-modified"> 89         CSS_DEG = 11,</span>
<span class="line-modified"> 90         CSS_RAD = 12,</span>
<span class="line-modified"> 91         CSS_GRAD = 13,</span>
<span class="line-modified"> 92         CSS_MS = 14,</span>
<span class="line-modified"> 93         CSS_S = 15,</span>
<span class="line-modified"> 94         CSS_HZ = 16,</span>
<span class="line-modified"> 95         CSS_KHZ = 17,</span>
<span class="line-modified"> 96         CSS_DIMENSION = 18,</span>
<span class="line-modified"> 97         CSS_STRING = 19,</span>
<span class="line-modified"> 98         CSS_URI = 20,</span>
<span class="line-modified"> 99         CSS_IDENT = 21,</span>
<span class="line-modified">100         CSS_ATTR = 22,</span>
<span class="line-modified">101         CSS_COUNTER = 23,</span>
<span class="line-modified">102         CSS_RECT = 24,</span>
<span class="line-modified">103         CSS_RGBCOLOR = 25,</span>
<span class="line-modified">104         // From CSS Values and Units. Viewport-percentage Lengths (vw/vh/vmin/vmax).</span>
<span class="line-modified">105         CSS_VW = 26,</span>
<span class="line-modified">106         CSS_VH = 27,</span>
<span class="line-modified">107         CSS_VMIN = 28,</span>
<span class="line-modified">108         CSS_VMAX = 29,</span>
<span class="line-modified">109         CSS_DPPX = 30,</span>
<span class="line-modified">110         CSS_DPI = 31,</span>
<span class="line-modified">111         CSS_DPCM = 32,</span>
<span class="line-modified">112         CSS_FR = 33,</span>
<span class="line-modified">113         CSS_PAIR = 100, // We envision this being exposed as a means of getting computed style values for pairs (border-spacing/radius, background-position, etc.)</span>
<span class="line-modified">114         CSS_UNICODE_RANGE = 102,</span>
<span class="line-modified">115 </span>
<span class="line-modified">116         // These are from CSS3 Values and Units, but that isn&#39;t a finished standard yet</span>
<span class="line-modified">117         CSS_TURN = 107,</span>
<span class="line-removed">118         CSS_REMS = 108,</span>
<span class="line-removed">119         CSS_CHS = 109,</span>
<span class="line-removed">120 </span>
<span class="line-removed">121         // This is used internally for counter names (as opposed to counter values)</span>
<span class="line-removed">122         CSS_COUNTER_NAME = 110,</span>
<span class="line-removed">123 </span>
<span class="line-removed">124         // This is used by the CSS Shapes draft</span>
<span class="line-removed">125         CSS_SHAPE = 111,</span>
<span class="line-removed">126 </span>
<span class="line-removed">127         // Used by border images.</span>
<span class="line-removed">128         CSS_QUAD = 112,</span>
<span class="line-removed">129 </span>
<span class="line-removed">130         CSS_CALC = 113,</span>
<span class="line-removed">131         CSS_CALC_PERCENTAGE_WITH_NUMBER = 114,</span>
<span class="line-removed">132         CSS_CALC_PERCENTAGE_WITH_LENGTH = 115,</span>
<span class="line-removed">133 </span>
<span class="line-removed">134         CSS_FONT_FAMILY = 116,</span>
<span class="line-removed">135 </span>
<span class="line-removed">136         CSS_PROPERTY_ID = 117,</span>
<span class="line-removed">137         CSS_VALUE_ID = 118,</span>
<span class="line-removed">138 </span>
<span class="line-removed">139         // This value is used to handle quirky margins in reflow roots (body, td, and th) like WinIE.</span>
<span class="line-removed">140         // The basic idea is that a stylesheet can use the value __qem (for quirky em) instead of em.</span>
<span class="line-removed">141         // When the quirky value is used, if you&#39;re in quirks mode, the margin will collapse away</span>
<span class="line-removed">142         // inside a table cell. This quirk is specified in the HTML spec but our impl is different.</span>
<span class="line-removed">143         CSS_QUIRKY_EMS = 120</span>
<span class="line-removed">144     };</span>
<span class="line-removed">145 </span>
<span class="line-removed">146     // This enum follows the CSSParser::Units enum augmented with UNIT_FREQUENCY for frequencies.</span>
<span class="line-removed">147     enum UnitCategory {</span>
<span class="line-removed">148         UNumber,</span>
<span class="line-removed">149         UPercent,</span>
<span class="line-removed">150         ULength,</span>
<span class="line-removed">151         UAngle,</span>
<span class="line-removed">152         UTime,</span>
<span class="line-removed">153         UFrequency,</span>
<span class="line-removed">154 #if ENABLE(CSS_IMAGE_RESOLUTION) || ENABLE(RESOLUTION_MEDIA_QUERY)</span>
<span class="line-removed">155         UResolution,</span>
<span class="line-removed">156 #endif</span>
<span class="line-removed">157         UOther</span>
<span class="line-removed">158     };</span>
<span class="line-removed">159     static UnitCategory unitCategory(UnitType);</span>
<span class="line-removed">160 </span>
<span class="line-removed">161     bool isAngle() const;</span>
<span class="line-removed">162     bool isAttr() const { return m_primitiveUnitType == CSS_ATTR; }</span>
<span class="line-removed">163     bool isCounter() const { return m_primitiveUnitType == CSS_COUNTER; }</span>
<span class="line-removed">164     bool isFontIndependentLength() const { return m_primitiveUnitType &gt;= CSS_PX &amp;&amp; m_primitiveUnitType &lt;= CSS_PC; }</span>
<span class="line-removed">165     static bool isFontRelativeLength(UnitType);</span>
<span class="line-removed">166     bool isFontRelativeLength() const { return isFontRelativeLength(static_cast&lt;UnitType&gt;(m_primitiveUnitType)); }</span>
<span class="line-removed">167 </span>
<span class="line-removed">168     bool isQuirkyEms() const { return primitiveType() == UnitType::CSS_QUIRKY_EMS; }</span>
<span class="line-removed">169 </span>
<span class="line-removed">170     static bool isViewportPercentageLength(UnitType type) { return type &gt;= CSS_VW &amp;&amp; type &lt;= CSS_VMAX; }</span>
<span class="line-removed">171     bool isViewportPercentageLength() const { return isViewportPercentageLength(static_cast&lt;UnitType&gt;(m_primitiveUnitType)); }</span>
<span class="line-removed">172 </span>
<span class="line-removed">173     static bool isLength(UnitType);</span>
<span class="line-removed">174     bool isLength() const { return isLength(static_cast&lt;UnitType&gt;(primitiveType())); }</span>
<span class="line-removed">175     bool isNumber() const { return primitiveType() == CSS_NUMBER; }</span>
<span class="line-removed">176     bool isPercentage() const { return primitiveType() == CSS_PERCENTAGE; }</span>
<span class="line-removed">177     bool isPx() const { return primitiveType() == CSS_PX; }</span>
<span class="line-removed">178     bool isRect() const { return m_primitiveUnitType == CSS_RECT; }</span>
<span class="line-removed">179     bool isPair() const { return m_primitiveUnitType == CSS_PAIR; }</span>
<span class="line-removed">180     bool isPropertyID() const { return m_primitiveUnitType == CSS_PROPERTY_ID; }</span>
<span class="line-removed">181     bool isRGBColor() const { return m_primitiveUnitType == CSS_RGBCOLOR; }</span>
<span class="line-removed">182     bool isShape() const { return m_primitiveUnitType == CSS_SHAPE; }</span>
<span class="line-removed">183     bool isString() const { return m_primitiveUnitType == CSS_STRING; }</span>
<span class="line-removed">184     bool isFontFamily() const { return m_primitiveUnitType == CSS_FONT_FAMILY; }</span>
<span class="line-removed">185     bool isTime() const { return m_primitiveUnitType == CSS_S || m_primitiveUnitType == CSS_MS; }</span>
<span class="line-removed">186     bool isURI() const { return m_primitiveUnitType == CSS_URI; }</span>
<span class="line-removed">187     bool isCalculated() const { return m_primitiveUnitType == CSS_CALC; }</span>
<span class="line-removed">188     bool isCalculatedPercentageWithNumber() const { return primitiveType() == CSS_CALC_PERCENTAGE_WITH_NUMBER; }</span>
<span class="line-removed">189     bool isCalculatedPercentageWithLength() const { return primitiveType() == CSS_CALC_PERCENTAGE_WITH_LENGTH; }</span>
<span class="line-removed">190     bool isDotsPerInch() const { return primitiveType() == CSS_DPI; }</span>
<span class="line-removed">191     bool isDotsPerPixel() const { return primitiveType() == CSS_DPPX; }</span>
<span class="line-removed">192     bool isDotsPerCentimeter() const { return primitiveType() == CSS_DPCM; }</span>
<span class="line-removed">193 </span>
<span class="line-removed">194     static bool isResolution(UnitType);</span>
<span class="line-removed">195     bool isResolution() const { return isResolution(static_cast&lt;UnitType&gt;(primitiveType())); }</span>
<span class="line-removed">196     bool isViewportPercentageWidth() const { return m_primitiveUnitType == CSS_VW; }</span>
<span class="line-removed">197     bool isViewportPercentageHeight() const { return m_primitiveUnitType == CSS_VH; }</span>
<span class="line-removed">198     bool isViewportPercentageMax() const { return m_primitiveUnitType == CSS_VMAX; }</span>
<span class="line-removed">199     bool isViewportPercentageMin() const { return m_primitiveUnitType == CSS_VMIN; }</span>
<span class="line-removed">200     bool isValueID() const { return m_primitiveUnitType == CSS_VALUE_ID; }</span>
<span class="line-removed">201     bool isFlex() const { return primitiveType() == CSS_FR; }</span>
202 
203     static Ref&lt;CSSPrimitiveValue&gt; createIdentifier(CSSValueID valueID) { return adoptRef(*new CSSPrimitiveValue(valueID)); }
204     static Ref&lt;CSSPrimitiveValue&gt; createIdentifier(CSSPropertyID propertyID) { return adoptRef(*new CSSPrimitiveValue(propertyID)); }
205 
<span class="line-modified">206     static Ref&lt;CSSPrimitiveValue&gt; create(double value, UnitType type) { return adoptRef(*new CSSPrimitiveValue(value, type)); }</span>
<span class="line-modified">207     static Ref&lt;CSSPrimitiveValue&gt; create(const String&amp; value, UnitType type) { return adoptRef(*new CSSPrimitiveValue(value, type)); }</span>
208     static Ref&lt;CSSPrimitiveValue&gt; create(const Length&amp; value, const RenderStyle&amp; style) { return adoptRef(*new CSSPrimitiveValue(value, style)); }
209     static Ref&lt;CSSPrimitiveValue&gt; create(const LengthSize&amp; value, const RenderStyle&amp; style) { return adoptRef(*new CSSPrimitiveValue(value, style)); }
210 
211     template&lt;typename T&gt; static Ref&lt;CSSPrimitiveValue&gt; create(T&amp;&amp;);
212 
213     // This value is used to handle quirky margins in reflow roots (body, td, and th) like WinIE.
214     // The basic idea is that a stylesheet can use the value __qem (for quirky em) instead of em.
215     // When the quirky value is used, if you&#39;re in quirks mode, the margin will collapse away
216     // inside a table cell.
<span class="line-modified">217     static Ref&lt;CSSPrimitiveValue&gt; createAllowingMarginQuirk(double value, UnitType);</span>
218 
219     ~CSSPrimitiveValue();
220 
221     void cleanup();
222 
<span class="line-modified">223     WEBCORE_EXPORT unsigned short primitiveType() const;</span>
<span class="line-modified">224     WEBCORE_EXPORT ExceptionOr&lt;void&gt; setFloatValue(unsigned short unitType, double floatValue);</span>
<span class="line-modified">225     WEBCORE_EXPORT ExceptionOr&lt;float&gt; getFloatValue(unsigned short unitType) const;</span>
<span class="line-modified">226     WEBCORE_EXPORT ExceptionOr&lt;void&gt; setStringValue(unsigned short stringType, const String&amp; stringValue);</span>
227     WEBCORE_EXPORT ExceptionOr&lt;String&gt; getStringValue() const;
<span class="line-removed">228     WEBCORE_EXPORT ExceptionOr&lt;Counter&amp;&gt; getCounterValue() const;</span>
<span class="line-removed">229     WEBCORE_EXPORT ExceptionOr&lt;Rect&amp;&gt; getRectValue() const;</span>
<span class="line-removed">230     WEBCORE_EXPORT ExceptionOr&lt;Ref&lt;RGBColor&gt;&gt; getRGBColorValue() const;</span>
231 
232     double computeDegrees() const;
233 
234     enum TimeUnit { Seconds, Milliseconds };
235     template&lt;typename T, TimeUnit timeUnit&gt; T computeTime() const;
236 
237     template&lt;typename T&gt; T computeLength(const CSSToLengthConversionData&amp;) const;
238     template&lt;int&gt; Length convertToLength(const CSSToLengthConversionData&amp;) const;
239 
240     bool convertingToLengthRequiresNonNullStyle(int lengthConversion) const;
241 
<span class="line-modified">242     double doubleValue(UnitType) const;</span>

243     double doubleValue() const;
244 
<span class="line-modified">245     template&lt;typename T&gt; inline T value(UnitType type) const { return clampTo&lt;T&gt;(doubleValue(type)); }</span>





246     template&lt;typename T&gt; inline T value() const { return clampTo&lt;T&gt;(doubleValue()); }
247 
<span class="line-modified">248     float floatValue(UnitType type) const { return value&lt;float&gt;(type); }</span>
249     float floatValue() const { return value&lt;float&gt;(); }
250 
<span class="line-modified">251     int intValue(UnitType type) const { return value&lt;int&gt;(type); }</span>
252     int intValue() const { return value&lt;int&gt;(); }
253 
254     WEBCORE_EXPORT String stringValue() const;
255 
<span class="line-modified">256     const Color&amp; color() const { ASSERT(m_primitiveUnitType == CSS_RGBCOLOR); return *m_value.color; }</span>
<span class="line-modified">257     Counter* counterValue() const { return m_primitiveUnitType != CSS_COUNTER ? nullptr : m_value.counter; }</span>
<span class="line-modified">258     CSSCalcValue* cssCalcValue() const { return m_primitiveUnitType != CSS_CALC ? nullptr : m_value.calc; }</span>
<span class="line-modified">259     const CSSFontFamily&amp; fontFamily() const { ASSERT(m_primitiveUnitType == CSS_FONT_FAMILY); return *m_value.fontFamily; }</span>
<span class="line-modified">260     Pair* pairValue() const { return m_primitiveUnitType != CSS_PAIR ? nullptr : m_value.pair; }</span>
<span class="line-modified">261     CSSPropertyID propertyID() const { return m_primitiveUnitType == CSS_PROPERTY_ID ? m_value.propertyID : CSSPropertyInvalid; }</span>
<span class="line-modified">262     Quad* quadValue() const { return m_primitiveUnitType != CSS_QUAD ? nullptr : m_value.quad; }</span>
<span class="line-modified">263     Rect* rectValue() const { return m_primitiveUnitType != CSS_RECT ? nullptr : m_value.rect; }</span>
<span class="line-modified">264     CSSBasicShape* shapeValue() const { return m_primitiveUnitType != CSS_SHAPE ? nullptr : m_value.shape; }</span>
<span class="line-modified">265     CSSValueID valueID() const { return m_primitiveUnitType == CSS_VALUE_ID ? m_value.valueID : CSSValueInvalid; }</span>
266 
267     template&lt;typename T&gt; inline operator T() const; // Defined in CSSPrimitiveValueMappings.h
268 
269     String customCSSText() const;
270 
271     // FIXME-NEWPARSER: Can ditch the boolean and just use the unit type once old parser is gone.
<span class="line-modified">272     bool isQuirkValue() const { return m_isQuirkValue || primitiveType() == CSS_QUIRKY_EMS; }</span>
273 
274     bool equals(const CSSPrimitiveValue&amp;) const;
275 
<span class="line-modified">276     static UnitType canonicalUnitTypeForCategory(UnitCategory);</span>
<span class="line-modified">277     static double conversionToCanonicalUnitsScaleFactor(UnitType);</span>
278 
<span class="line-modified">279     static double computeNonCalcLengthDouble(const CSSToLengthConversionData&amp;, UnitType, double value);</span>


280 
281     Ref&lt;DeprecatedCSSOMPrimitiveValue&gt; createDeprecatedCSSOMPrimitiveWrapper(CSSStyleDeclaration&amp;) const;
282 
283     void collectDirectComputationalDependencies(HashSet&lt;CSSPropertyID&gt;&amp;) const;
284     void collectDirectRootComputationalDependencies(HashSet&lt;CSSPropertyID&gt;&amp;) const;
285 
286 private:
287     friend class CSSValuePool;
288     friend LazyNeverDestroyed&lt;CSSPrimitiveValue&gt;;
289 
290     CSSPrimitiveValue(CSSValueID);
291     CSSPrimitiveValue(CSSPropertyID);
292     CSSPrimitiveValue(const Color&amp;);
293     CSSPrimitiveValue(const Length&amp;);
294     CSSPrimitiveValue(const Length&amp;, const RenderStyle&amp;);
295     CSSPrimitiveValue(const LengthSize&amp;, const RenderStyle&amp;);
<span class="line-modified">296     CSSPrimitiveValue(const String&amp;, UnitType);</span>
<span class="line-modified">297     CSSPrimitiveValue(double, UnitType);</span>




298 
299     template&lt;typename T&gt; CSSPrimitiveValue(T); // Defined in CSSPrimitiveValueMappings.h
300     template&lt;typename T&gt; CSSPrimitiveValue(RefPtr&lt;T&gt;&amp;&amp;);
301     template&lt;typename T&gt; CSSPrimitiveValue(Ref&lt;T&gt;&amp;&amp;);
302 
303     static void create(int); // compile-time guard
304     static void create(unsigned); // compile-time guard
305     template&lt;typename T&gt; operator T*(); // compile-time guard
306 
307     void init(const Length&amp;);
308     void init(const LengthSize&amp;, const RenderStyle&amp;);
309     void init(Ref&lt;CSSBasicShape&gt;&amp;&amp;);
310     void init(RefPtr&lt;CSSCalcValue&gt;&amp;&amp;);
311     void init(Ref&lt;Counter&gt;&amp;&amp;);
312     void init(Ref&lt;Pair&gt;&amp;&amp;);
313     void init(Ref&lt;Quad&gt;&amp;&amp;);
314     void init(Ref&lt;Rect&gt;&amp;&amp;);
315 
<span class="line-modified">316     Optional&lt;double&gt; doubleValueInternal(UnitType targetUnitType) const;</span>



317 
318     double computeLengthDouble(const CSSToLengthConversionData&amp;) const;
319 
320     ALWAYS_INLINE String formatNumberForCustomCSSText() const;
321     NEVER_INLINE String formatNumberValue(StringView) const;
322 
323     union {
324         CSSPropertyID propertyID;
325         CSSValueID valueID;
326         double num;
327         StringImpl* string;
328         Counter* counter;
329         Rect* rect;
330         Quad* quad;
331         const Color* color;
332         Pair* pair;
333         CSSBasicShape* shape;
334         CSSCalcValue* calc;
335         const CSSFontFamily* fontFamily;
336     } m_value;
337 };
338 
<span class="line-modified">339 inline bool CSSPrimitiveValue::isAngle() const</span>
<span class="line-removed">340 {</span>
<span class="line-removed">341     auto primitiveType = this-&gt;primitiveType();</span>
<span class="line-removed">342     return primitiveType == CSS_DEG</span>
<span class="line-removed">343         || primitiveType == CSS_RAD</span>
<span class="line-removed">344         || primitiveType == CSS_GRAD</span>
<span class="line-removed">345         || primitiveType == CSS_TURN;</span>
<span class="line-removed">346 }</span>
<span class="line-removed">347 </span>
<span class="line-removed">348 inline bool CSSPrimitiveValue::isFontRelativeLength(UnitType type)</span>
349 {
<span class="line-modified">350     return type == CSS_EMS</span>
<span class="line-modified">351         || type == CSS_EXS</span>
<span class="line-modified">352         || type == CSS_REMS</span>
<span class="line-modified">353         || type == CSS_CHS</span>
<span class="line-modified">354         || type == CSS_QUIRKY_EMS;</span>
355 }
356 
<span class="line-modified">357 inline bool CSSPrimitiveValue::isLength(UnitType type)</span>
358 {
<span class="line-modified">359     return (type &gt;= CSS_EMS &amp;&amp; type &lt;= CSS_PC)</span>
<span class="line-modified">360         || type == CSS_REMS</span>
<span class="line-modified">361         || type == CSS_CHS</span>

362         || isViewportPercentageLength(type)
<span class="line-modified">363         || type == CSS_QUIRKY_EMS;</span>
364 }
365 
<span class="line-modified">366 inline bool CSSPrimitiveValue::isResolution(UnitType type)</span>
367 {
<span class="line-modified">368     return type &gt;= CSS_DPPX &amp;&amp; type &lt;= CSS_DPCM;</span>
369 }
370 
371 template&lt;typename T&gt; inline Ref&lt;CSSPrimitiveValue&gt; CSSPrimitiveValue::create(T&amp;&amp; value)
372 {
373     return adoptRef(*new CSSPrimitiveValue(std::forward&lt;T&gt;(value)));
374 }
375 
<span class="line-modified">376 inline Ref&lt;CSSPrimitiveValue&gt; CSSPrimitiveValue::createAllowingMarginQuirk(double value, UnitType type)</span>
377 {
378     auto result = adoptRef(*new CSSPrimitiveValue(value, type));
379     result-&gt;m_isQuirkValue = true;
380     return result;
381 }
382 
383 template&lt;typename T, CSSPrimitiveValue::TimeUnit timeUnit&gt; inline T CSSPrimitiveValue::computeTime() const
384 {
<span class="line-modified">385     if (timeUnit == Seconds &amp;&amp; primitiveType() == CSS_S)</span>
386         return value&lt;T&gt;();
<span class="line-modified">387     if (timeUnit == Seconds &amp;&amp; primitiveType() == CSS_MS)</span>
388         return value&lt;T&gt;() / 1000;
<span class="line-modified">389     if (timeUnit == Milliseconds &amp;&amp; primitiveType() == CSS_MS)</span>
390         return value&lt;T&gt;();
<span class="line-modified">391     if (timeUnit == Milliseconds &amp;&amp; primitiveType() == CSS_S)</span>
392         return value&lt;T&gt;() * 1000;
393     ASSERT_NOT_REACHED();
394     return 0;
395 }
396 
397 template&lt;typename T&gt; inline CSSPrimitiveValue::CSSPrimitiveValue(RefPtr&lt;T&gt;&amp;&amp; value)
398     : CSSValue(PrimitiveClass)
399 {
400     init(WTFMove(value));
401 }
402 
403 template&lt;typename T&gt; inline CSSPrimitiveValue::CSSPrimitiveValue(Ref&lt;T&gt;&amp;&amp; value)
404     : CSSValue(PrimitiveClass)
405 {
406     init(WTFMove(value));
407 }
408 
409 } // namespace WebCore
410 
411 SPECIALIZE_TYPE_TRAITS_CSS_VALUE(CSSPrimitiveValue, isPrimitiveValue())
</pre>
</td>
<td>
<hr />
<pre>
  5  *
  6  * This library is free software; you can redistribute it and/or
  7  * modify it under the terms of the GNU Library General Public
  8  * License as published by the Free Software Foundation; either
  9  * version 2 of the License, or (at your option) any later version.
 10  *
 11  * This library is distributed in the hope that it will be useful,
 12  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 13  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 14  * Library General Public License for more details.
 15  *
 16  * You should have received a copy of the GNU Library General Public License
 17  * along with this library; see the file COPYING.LIB.  If not, write to
 18  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 19  * Boston, MA 02110-1301, USA.
 20  */
 21 
 22 #pragma once
 23 
 24 #include &quot;CSSPropertyNames.h&quot;
<span class="line-added"> 25 #include &quot;CSSUnits.h&quot;</span>
 26 #include &quot;CSSValue.h&quot;
 27 #include &quot;CSSValueKeywords.h&quot;
 28 #include &quot;Color.h&quot;
 29 #include &quot;ExceptionOr.h&quot;
 30 #include &quot;LayoutUnit.h&quot;
 31 #include &lt;utility&gt;
 32 #include &lt;wtf/Forward.h&gt;
 33 #include &lt;wtf/MathExtras.h&gt;
 34 
 35 namespace WebCore {
 36 
 37 class CSSBasicShape;
 38 class CSSCalcValue;
 39 class CSSToLengthConversionData;
 40 class Counter;
 41 class DeprecatedCSSOMPrimitiveValue;
 42 class Pair;
 43 class Quad;
 44 class RGBColor;
 45 class Rect;
</pre>
<hr />
<pre>
 58 // 44.99998. We need to round if we&#39;re really close to the next integer value.
 59 template&lt;typename T&gt; inline T roundForImpreciseConversion(double value)
 60 {
 61     value += (value &lt; 0) ? -0.01 : +0.01;
 62     return ((value &gt; std::numeric_limits&lt;T&gt;::max()) || (value &lt; std::numeric_limits&lt;T&gt;::min())) ? 0 : static_cast&lt;T&gt;(value);
 63 }
 64 
 65 template&lt;&gt; inline float roundForImpreciseConversion(double value)
 66 {
 67     double ceiledValue = ceil(value);
 68     double proximityToNextInt = ceiledValue - value;
 69     if (proximityToNextInt &lt;= 0.01 &amp;&amp; value &gt; 0)
 70         return static_cast&lt;float&gt;(ceiledValue);
 71     if (proximityToNextInt &gt;= 0.99 &amp;&amp; value &lt; 0)
 72         return static_cast&lt;float&gt;(floor(value));
 73     return static_cast&lt;float&gt;(value);
 74 }
 75 
 76 class CSSPrimitiveValue final : public CSSValue {
 77 public:
<span class="line-modified"> 78 </span>
<span class="line-modified"> 79     static bool isFontRelativeLength(CSSUnitType);</span>
<span class="line-modified"> 80     static bool isLength(CSSUnitType);</span>
<span class="line-modified"> 81     static bool isResolution(CSSUnitType);</span>
<span class="line-modified"> 82     static bool isViewportPercentageLength(CSSUnitType type) { return type &gt;= CSSUnitType::CSS_VW &amp;&amp; type &lt;= CSSUnitType::CSS_VMAX; }</span>
<span class="line-modified"> 83 </span>
<span class="line-modified"> 84     // FIXME: Some of these use primitiveUnitType() and some use primitiveType(). Those that use primitiveUnitType() are broken with calc().</span>
<span class="line-modified"> 85     bool isAngle() const { return unitCategory(primitiveType()) == CSSUnitCategory::Angle; }</span>
<span class="line-modified"> 86     bool isAttr() const { return primitiveUnitType() == CSSUnitType::CSS_ATTR; }</span>
<span class="line-modified"> 87     bool isCounter() const { return primitiveUnitType() == CSSUnitType::CSS_COUNTER; }</span>
<span class="line-modified"> 88     bool isFontIndependentLength() const { return primitiveUnitType() &gt;= CSSUnitType::CSS_PX &amp;&amp; primitiveUnitType() &lt;= CSSUnitType::CSS_PC; }</span>
<span class="line-modified"> 89     bool isFontRelativeLength() const { return isFontRelativeLength(primitiveUnitType()); }</span>
<span class="line-modified"> 90     bool isQuirkyEms() const { return primitiveType() == CSSUnitType::CSS_QUIRKY_EMS; }</span>
<span class="line-modified"> 91     bool isLength() const { return isLength(static_cast&lt;CSSUnitType&gt;(primitiveType())); }</span>
<span class="line-modified"> 92     bool isNumber() const { return primitiveType() == CSSUnitType::CSS_NUMBER; }</span>
<span class="line-modified"> 93     bool isPercentage() const { return primitiveType() == CSSUnitType::CSS_PERCENTAGE; }</span>
<span class="line-modified"> 94     bool isPx() const { return primitiveType() == CSSUnitType::CSS_PX; }</span>
<span class="line-modified"> 95     bool isRect() const { return primitiveUnitType() == CSSUnitType::CSS_RECT; }</span>
<span class="line-modified"> 96     bool isPair() const { return primitiveUnitType() == CSSUnitType::CSS_PAIR; }</span>
<span class="line-modified"> 97     bool isPropertyID() const { return primitiveUnitType() == CSSUnitType::CSS_PROPERTY_ID; }</span>
<span class="line-modified"> 98     bool isRGBColor() const { return primitiveUnitType() == CSSUnitType::CSS_RGBCOLOR; }</span>
<span class="line-modified"> 99     bool isShape() const { return primitiveUnitType() == CSSUnitType::CSS_SHAPE; }</span>
<span class="line-modified">100     bool isString() const { return primitiveUnitType() == CSSUnitType::CSS_STRING; }</span>
<span class="line-modified">101     bool isFontFamily() const { return primitiveUnitType() == CSSUnitType::CSS_FONT_FAMILY; }</span>
<span class="line-modified">102     bool isTime() const { return unitCategory(primitiveUnitType()) == CSSUnitCategory::Time; }</span>
<span class="line-modified">103     bool isFrequency() const { return unitCategory(primitiveType()) == CSSUnitCategory::Frequency; }</span>
<span class="line-modified">104     bool isURI() const { return primitiveUnitType() == CSSUnitType::CSS_URI; }</span>
<span class="line-modified">105     bool isCalculated() const { return primitiveUnitType() == CSSUnitType::CSS_CALC; }</span>
<span class="line-modified">106     bool isCalculatedPercentageWithNumber() const { return primitiveType() == CSSUnitType::CSS_CALC_PERCENTAGE_WITH_NUMBER; }</span>
<span class="line-modified">107     bool isCalculatedPercentageWithLength() const { return primitiveType() == CSSUnitType::CSS_CALC_PERCENTAGE_WITH_LENGTH; }</span>
<span class="line-modified">108     bool isDotsPerInch() const { return primitiveType() == CSSUnitType::CSS_DPI; }</span>
<span class="line-modified">109     bool isDotsPerPixel() const { return primitiveType() == CSSUnitType::CSS_DPPX; }</span>
<span class="line-modified">110     bool isDotsPerCentimeter() const { return primitiveType() == CSSUnitType::CSS_DPCM; }</span>
<span class="line-modified">111     bool isResolution() const { return unitCategory(primitiveType()) == CSSUnitCategory::Resolution; }</span>
<span class="line-modified">112     bool isViewportPercentageLength() const { return isViewportPercentageLength(primitiveUnitType()); }</span>
<span class="line-modified">113     bool isViewportPercentageWidth() const { return primitiveUnitType() == CSSUnitType::CSS_VW; }</span>
<span class="line-modified">114     bool isViewportPercentageHeight() const { return primitiveUnitType() == CSSUnitType::CSS_VH; }</span>
<span class="line-modified">115     bool isViewportPercentageMax() const { return primitiveUnitType() == CSSUnitType::CSS_VMAX; }</span>
<span class="line-modified">116     bool isViewportPercentageMin() const { return primitiveUnitType() == CSSUnitType::CSS_VMIN; }</span>
<span class="line-modified">117     bool isValueID() const { return primitiveUnitType() == CSSUnitType::CSS_VALUE_ID; }</span>
<span class="line-modified">118     bool isFlex() const { return primitiveType() == CSSUnitType::CSS_FR; }</span>




















































































119 
120     static Ref&lt;CSSPrimitiveValue&gt; createIdentifier(CSSValueID valueID) { return adoptRef(*new CSSPrimitiveValue(valueID)); }
121     static Ref&lt;CSSPrimitiveValue&gt; createIdentifier(CSSPropertyID propertyID) { return adoptRef(*new CSSPrimitiveValue(propertyID)); }
122 
<span class="line-modified">123     static Ref&lt;CSSPrimitiveValue&gt; create(double value, CSSUnitType type) { return adoptRef(*new CSSPrimitiveValue(value, type)); }</span>
<span class="line-modified">124     static Ref&lt;CSSPrimitiveValue&gt; create(const String&amp; value, CSSUnitType type) { return adoptRef(*new CSSPrimitiveValue(value, type)); }</span>
125     static Ref&lt;CSSPrimitiveValue&gt; create(const Length&amp; value, const RenderStyle&amp; style) { return adoptRef(*new CSSPrimitiveValue(value, style)); }
126     static Ref&lt;CSSPrimitiveValue&gt; create(const LengthSize&amp; value, const RenderStyle&amp; style) { return adoptRef(*new CSSPrimitiveValue(value, style)); }
127 
128     template&lt;typename T&gt; static Ref&lt;CSSPrimitiveValue&gt; create(T&amp;&amp;);
129 
130     // This value is used to handle quirky margins in reflow roots (body, td, and th) like WinIE.
131     // The basic idea is that a stylesheet can use the value __qem (for quirky em) instead of em.
132     // When the quirky value is used, if you&#39;re in quirks mode, the margin will collapse away
133     // inside a table cell.
<span class="line-modified">134     static Ref&lt;CSSPrimitiveValue&gt; createAllowingMarginQuirk(double value, CSSUnitType);</span>
135 
136     ~CSSPrimitiveValue();
137 
138     void cleanup();
139 
<span class="line-modified">140     WEBCORE_EXPORT CSSUnitType primitiveType() const;</span>
<span class="line-modified">141     WEBCORE_EXPORT ExceptionOr&lt;void&gt; setFloatValue(CSSUnitType , double);</span>
<span class="line-modified">142     WEBCORE_EXPORT ExceptionOr&lt;float&gt; getFloatValue(CSSUnitType) const;</span>
<span class="line-modified">143     WEBCORE_EXPORT ExceptionOr&lt;void&gt; setStringValue(CSSUnitType, const String&amp;);</span>
144     WEBCORE_EXPORT ExceptionOr&lt;String&gt; getStringValue() const;



145 
146     double computeDegrees() const;
147 
148     enum TimeUnit { Seconds, Milliseconds };
149     template&lt;typename T, TimeUnit timeUnit&gt; T computeTime() const;
150 
151     template&lt;typename T&gt; T computeLength(const CSSToLengthConversionData&amp;) const;
152     template&lt;int&gt; Length convertToLength(const CSSToLengthConversionData&amp;) const;
153 
154     bool convertingToLengthRequiresNonNullStyle(int lengthConversion) const;
155 
<span class="line-modified">156     double doubleValue(CSSUnitType) const;</span>
<span class="line-added">157     // It&#39;s usually wrong to call this; it can trigger type conversion in calc without sufficient context to resolve relative length units.</span>
158     double doubleValue() const;
159 
<span class="line-modified">160     // These return nullopt for calc, for which range checking is not done at parse time: &lt;https://www.w3.org/TR/css3-values/#calc-range&gt;.</span>
<span class="line-added">161     Optional&lt;bool&gt; isZero() const;</span>
<span class="line-added">162     Optional&lt;bool&gt; isPositive() const;</span>
<span class="line-added">163     Optional&lt;bool&gt; isNegative() const;</span>
<span class="line-added">164 </span>
<span class="line-added">165     template&lt;typename T&gt; inline T value(CSSUnitType type) const { return clampTo&lt;T&gt;(doubleValue(type)); }</span>
166     template&lt;typename T&gt; inline T value() const { return clampTo&lt;T&gt;(doubleValue()); }
167 
<span class="line-modified">168     float floatValue(CSSUnitType type) const { return value&lt;float&gt;(type); }</span>
169     float floatValue() const { return value&lt;float&gt;(); }
170 
<span class="line-modified">171     int intValue(CSSUnitType type) const { return value&lt;int&gt;(type); }</span>
172     int intValue() const { return value&lt;int&gt;(); }
173 
174     WEBCORE_EXPORT String stringValue() const;
175 
<span class="line-modified">176     const Color&amp; color() const { ASSERT(primitiveUnitType() == CSSUnitType::CSS_RGBCOLOR); return *m_value.color; }</span>
<span class="line-modified">177     Counter* counterValue() const { return primitiveUnitType() != CSSUnitType::CSS_COUNTER ? nullptr : m_value.counter; }</span>
<span class="line-modified">178     CSSCalcValue* cssCalcValue() const { return primitiveUnitType() != CSSUnitType::CSS_CALC ? nullptr : m_value.calc; }</span>
<span class="line-modified">179     const CSSFontFamily&amp; fontFamily() const { ASSERT(primitiveUnitType() == CSSUnitType::CSS_FONT_FAMILY); return *m_value.fontFamily; }</span>
<span class="line-modified">180     Pair* pairValue() const { return primitiveUnitType() != CSSUnitType::CSS_PAIR ? nullptr : m_value.pair; }</span>
<span class="line-modified">181     CSSPropertyID propertyID() const { return primitiveUnitType() == CSSUnitType::CSS_PROPERTY_ID ? m_value.propertyID : CSSPropertyInvalid; }</span>
<span class="line-modified">182     Quad* quadValue() const { return primitiveUnitType() != CSSUnitType::CSS_QUAD ? nullptr : m_value.quad; }</span>
<span class="line-modified">183     Rect* rectValue() const { return primitiveUnitType() != CSSUnitType::CSS_RECT ? nullptr : m_value.rect; }</span>
<span class="line-modified">184     CSSBasicShape* shapeValue() const { return primitiveUnitType() != CSSUnitType::CSS_SHAPE ? nullptr : m_value.shape; }</span>
<span class="line-modified">185     CSSValueID valueID() const { return primitiveUnitType() == CSSUnitType::CSS_VALUE_ID ? m_value.valueID : CSSValueInvalid; }</span>
186 
187     template&lt;typename T&gt; inline operator T() const; // Defined in CSSPrimitiveValueMappings.h
188 
189     String customCSSText() const;
190 
191     // FIXME-NEWPARSER: Can ditch the boolean and just use the unit type once old parser is gone.
<span class="line-modified">192     bool isQuirkValue() const { return m_isQuirkValue || primitiveType() == CSSUnitType::CSS_QUIRKY_EMS; }</span>
193 
194     bool equals(const CSSPrimitiveValue&amp;) const;
195 
<span class="line-modified">196     static double conversionToCanonicalUnitsScaleFactor(CSSUnitType);</span>
<span class="line-modified">197     static String unitTypeString(CSSUnitType);</span>
198 
<span class="line-modified">199     static double computeNonCalcLengthDouble(const CSSToLengthConversionData&amp;, CSSUnitType, double value);</span>
<span class="line-added">200     // True if computeNonCalcLengthDouble would produce identical results when resolved against both these styles.</span>
<span class="line-added">201     static bool equalForLengthResolution(const RenderStyle&amp;, const RenderStyle&amp;);</span>
202 
203     Ref&lt;DeprecatedCSSOMPrimitiveValue&gt; createDeprecatedCSSOMPrimitiveWrapper(CSSStyleDeclaration&amp;) const;
204 
205     void collectDirectComputationalDependencies(HashSet&lt;CSSPropertyID&gt;&amp;) const;
206     void collectDirectRootComputationalDependencies(HashSet&lt;CSSPropertyID&gt;&amp;) const;
207 
208 private:
209     friend class CSSValuePool;
210     friend LazyNeverDestroyed&lt;CSSPrimitiveValue&gt;;
211 
212     CSSPrimitiveValue(CSSValueID);
213     CSSPrimitiveValue(CSSPropertyID);
214     CSSPrimitiveValue(const Color&amp;);
215     CSSPrimitiveValue(const Length&amp;);
216     CSSPrimitiveValue(const Length&amp;, const RenderStyle&amp;);
217     CSSPrimitiveValue(const LengthSize&amp;, const RenderStyle&amp;);
<span class="line-modified">218     CSSPrimitiveValue(const String&amp;, CSSUnitType);</span>
<span class="line-modified">219     CSSPrimitiveValue(double, CSSUnitType);</span>
<span class="line-added">220 </span>
<span class="line-added">221     CSSPrimitiveValue(StaticCSSValueTag, CSSValueID);</span>
<span class="line-added">222     CSSPrimitiveValue(StaticCSSValueTag, const Color&amp;);</span>
<span class="line-added">223     CSSPrimitiveValue(StaticCSSValueTag, double, CSSUnitType);</span>
224 
225     template&lt;typename T&gt; CSSPrimitiveValue(T); // Defined in CSSPrimitiveValueMappings.h
226     template&lt;typename T&gt; CSSPrimitiveValue(RefPtr&lt;T&gt;&amp;&amp;);
227     template&lt;typename T&gt; CSSPrimitiveValue(Ref&lt;T&gt;&amp;&amp;);
228 
229     static void create(int); // compile-time guard
230     static void create(unsigned); // compile-time guard
231     template&lt;typename T&gt; operator T*(); // compile-time guard
232 
233     void init(const Length&amp;);
234     void init(const LengthSize&amp;, const RenderStyle&amp;);
235     void init(Ref&lt;CSSBasicShape&gt;&amp;&amp;);
236     void init(RefPtr&lt;CSSCalcValue&gt;&amp;&amp;);
237     void init(Ref&lt;Counter&gt;&amp;&amp;);
238     void init(Ref&lt;Pair&gt;&amp;&amp;);
239     void init(Ref&lt;Quad&gt;&amp;&amp;);
240     void init(Ref&lt;Rect&gt;&amp;&amp;);
241 
<span class="line-modified">242     CSSUnitType primitiveUnitType() const { return static_cast&lt;CSSUnitType&gt;(m_primitiveUnitType); }</span>
<span class="line-added">243     void setPrimitiveUnitType(CSSUnitType type) { m_primitiveUnitType = static_cast&lt;unsigned&gt;(type); }</span>
<span class="line-added">244 </span>
<span class="line-added">245     Optional&lt;double&gt; doubleValueInternal(CSSUnitType targetUnitType) const;</span>
246 
247     double computeLengthDouble(const CSSToLengthConversionData&amp;) const;
248 
249     ALWAYS_INLINE String formatNumberForCustomCSSText() const;
250     NEVER_INLINE String formatNumberValue(StringView) const;
251 
252     union {
253         CSSPropertyID propertyID;
254         CSSValueID valueID;
255         double num;
256         StringImpl* string;
257         Counter* counter;
258         Rect* rect;
259         Quad* quad;
260         const Color* color;
261         Pair* pair;
262         CSSBasicShape* shape;
263         CSSCalcValue* calc;
264         const CSSFontFamily* fontFamily;
265     } m_value;
266 };
267 
<span class="line-modified">268 inline bool CSSPrimitiveValue::isFontRelativeLength(CSSUnitType type)</span>









269 {
<span class="line-modified">270     return type == CSSUnitType::CSS_EMS</span>
<span class="line-modified">271         || type == CSSUnitType::CSS_EXS</span>
<span class="line-modified">272         || type == CSSUnitType::CSS_REMS</span>
<span class="line-modified">273         || type == CSSUnitType::CSS_CHS</span>
<span class="line-modified">274         || type == CSSUnitType::CSS_QUIRKY_EMS;</span>
275 }
276 
<span class="line-modified">277 inline bool CSSPrimitiveValue::isLength(CSSUnitType type)</span>
278 {
<span class="line-modified">279     return (type &gt;= CSSUnitType::CSS_EMS &amp;&amp; type &lt;= CSSUnitType::CSS_PC)</span>
<span class="line-modified">280         || type == CSSUnitType::CSS_REMS</span>
<span class="line-modified">281         || type == CSSUnitType::CSS_CHS</span>
<span class="line-added">282         || type == CSSUnitType::CSS_Q</span>
283         || isViewportPercentageLength(type)
<span class="line-modified">284         || type == CSSUnitType::CSS_QUIRKY_EMS;</span>
285 }
286 
<span class="line-modified">287 inline bool CSSPrimitiveValue::isResolution(CSSUnitType type)</span>
288 {
<span class="line-modified">289     return type &gt;= CSSUnitType::CSS_DPPX &amp;&amp; type &lt;= CSSUnitType::CSS_DPCM;</span>
290 }
291 
292 template&lt;typename T&gt; inline Ref&lt;CSSPrimitiveValue&gt; CSSPrimitiveValue::create(T&amp;&amp; value)
293 {
294     return adoptRef(*new CSSPrimitiveValue(std::forward&lt;T&gt;(value)));
295 }
296 
<span class="line-modified">297 inline Ref&lt;CSSPrimitiveValue&gt; CSSPrimitiveValue::createAllowingMarginQuirk(double value, CSSUnitType type)</span>
298 {
299     auto result = adoptRef(*new CSSPrimitiveValue(value, type));
300     result-&gt;m_isQuirkValue = true;
301     return result;
302 }
303 
304 template&lt;typename T, CSSPrimitiveValue::TimeUnit timeUnit&gt; inline T CSSPrimitiveValue::computeTime() const
305 {
<span class="line-modified">306     if (timeUnit == Seconds &amp;&amp; primitiveType() == CSSUnitType::CSS_S)</span>
307         return value&lt;T&gt;();
<span class="line-modified">308     if (timeUnit == Seconds &amp;&amp; primitiveType() == CSSUnitType::CSS_MS)</span>
309         return value&lt;T&gt;() / 1000;
<span class="line-modified">310     if (timeUnit == Milliseconds &amp;&amp; primitiveType() == CSSUnitType::CSS_MS)</span>
311         return value&lt;T&gt;();
<span class="line-modified">312     if (timeUnit == Milliseconds &amp;&amp; primitiveType() == CSSUnitType::CSS_S)</span>
313         return value&lt;T&gt;() * 1000;
314     ASSERT_NOT_REACHED();
315     return 0;
316 }
317 
318 template&lt;typename T&gt; inline CSSPrimitiveValue::CSSPrimitiveValue(RefPtr&lt;T&gt;&amp;&amp; value)
319     : CSSValue(PrimitiveClass)
320 {
321     init(WTFMove(value));
322 }
323 
324 template&lt;typename T&gt; inline CSSPrimitiveValue::CSSPrimitiveValue(Ref&lt;T&gt;&amp;&amp; value)
325     : CSSValue(PrimitiveClass)
326 {
327     init(WTFMove(value));
328 }
329 
330 } // namespace WebCore
331 
332 SPECIALIZE_TYPE_TRAITS_CSS_VALUE(CSSPrimitiveValue, isPrimitiveValue())
</pre>
</td>
</tr>
</table>
<center><a href="CSSPrimitiveValue.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CSSPrimitiveValueMappings.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>