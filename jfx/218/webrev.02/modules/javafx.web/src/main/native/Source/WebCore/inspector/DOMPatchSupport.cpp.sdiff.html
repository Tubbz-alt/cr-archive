<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/inspector/DOMPatchSupport.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CommandLineAPIModule.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorAuditAccessibilityObject.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/inspector/DOMPatchSupport.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 59 
 60 struct DOMPatchSupport::Digest {
 61     WTF_MAKE_STRUCT_FAST_ALLOCATED;
 62 
 63     String sha1;
 64     String attrsSHA1;
 65     Node* node;
 66     Vector&lt;std::unique_ptr&lt;Digest&gt;&gt; children;
 67 };
 68 
 69 DOMPatchSupport::DOMPatchSupport(DOMEditor&amp; domEditor, Document&amp; document)
 70     : m_domEditor(domEditor)
 71     , m_document(document)
 72 {
 73 }
 74 
 75 void DOMPatchSupport::patchDocument(const String&amp; markup)
 76 {
 77     RefPtr&lt;Document&gt; newDocument;
 78     if (m_document.isHTMLDocument())
<span class="line-modified"> 79         newDocument = HTMLDocument::create(m_document.sessionID(), nullptr, URL());</span>
 80     else if (m_document.isXHTMLDocument())
<span class="line-modified"> 81         newDocument = XMLDocument::createXHTML(m_document.sessionID(), nullptr, URL());</span>
 82     else if (m_document.isSVGDocument())
<span class="line-modified"> 83         newDocument = XMLDocument::create(m_document.sessionID(), nullptr, URL());</span>
 84 
 85     ASSERT(newDocument);
 86     RefPtr&lt;DocumentParser&gt; parser;
 87     if (newDocument-&gt;isHTMLDocument())
 88         parser = HTMLDocumentParser::create(static_cast&lt;HTMLDocument&amp;&gt;(*newDocument));
 89     else
 90         parser = XMLDocumentParser::create(*newDocument, nullptr);
 91     parser-&gt;insert(markup); // Use insert() so that the parser will not yield.
 92     parser-&gt;finish();
 93     parser-&gt;detach();
 94 
 95     if (!m_document.documentElement())
 96         return;
 97     if (!newDocument-&gt;documentElement())
 98         return;
 99 
100     std::unique_ptr&lt;Digest&gt; oldInfo = createDigest(*m_document.documentElement(), nullptr);
101     std::unique_ptr&lt;Digest&gt; newInfo = createDigest(*newDocument-&gt;documentElement(), &amp;m_unusedNodesMap);
102 
103     if (innerPatchNode(*oldInfo, *newInfo).hasException()) {
</pre>
</td>
<td>
<hr />
<pre>
 59 
 60 struct DOMPatchSupport::Digest {
 61     WTF_MAKE_STRUCT_FAST_ALLOCATED;
 62 
 63     String sha1;
 64     String attrsSHA1;
 65     Node* node;
 66     Vector&lt;std::unique_ptr&lt;Digest&gt;&gt; children;
 67 };
 68 
 69 DOMPatchSupport::DOMPatchSupport(DOMEditor&amp; domEditor, Document&amp; document)
 70     : m_domEditor(domEditor)
 71     , m_document(document)
 72 {
 73 }
 74 
 75 void DOMPatchSupport::patchDocument(const String&amp; markup)
 76 {
 77     RefPtr&lt;Document&gt; newDocument;
 78     if (m_document.isHTMLDocument())
<span class="line-modified"> 79         newDocument = HTMLDocument::create(nullptr, URL());</span>
 80     else if (m_document.isXHTMLDocument())
<span class="line-modified"> 81         newDocument = XMLDocument::createXHTML(nullptr, URL());</span>
 82     else if (m_document.isSVGDocument())
<span class="line-modified"> 83         newDocument = XMLDocument::create(nullptr, URL());</span>
 84 
 85     ASSERT(newDocument);
 86     RefPtr&lt;DocumentParser&gt; parser;
 87     if (newDocument-&gt;isHTMLDocument())
 88         parser = HTMLDocumentParser::create(static_cast&lt;HTMLDocument&amp;&gt;(*newDocument));
 89     else
 90         parser = XMLDocumentParser::create(*newDocument, nullptr);
 91     parser-&gt;insert(markup); // Use insert() so that the parser will not yield.
 92     parser-&gt;finish();
 93     parser-&gt;detach();
 94 
 95     if (!m_document.documentElement())
 96         return;
 97     if (!newDocument-&gt;documentElement())
 98         return;
 99 
100     std::unique_ptr&lt;Digest&gt; oldInfo = createDigest(*m_document.documentElement(), nullptr);
101     std::unique_ptr&lt;Digest&gt; newInfo = createDigest(*newDocument-&gt;documentElement(), &amp;m_unusedNodesMap);
102 
103     if (innerPatchNode(*oldInfo, *newInfo).hasException()) {
</pre>
</td>
</tr>
</table>
<center><a href="CommandLineAPIModule.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorAuditAccessibilityObject.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>