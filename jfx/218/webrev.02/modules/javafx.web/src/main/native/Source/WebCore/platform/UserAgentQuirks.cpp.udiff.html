<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/UserAgentQuirks.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Timer.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="UserAgentQuirks.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/UserAgentQuirks.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -34,41 +34,73 @@</span>
  // When editing the quirks in this file, be sure to update
  // Tools/TestWebKitAPI/Tests/WebCore/UserAgentQuirks.cpp.
  
  static bool isGoogle(const URL&amp; url)
  {
<span class="udiff-line-modified-removed">-     String baseDomain = topPrivatelyControlledDomain(url.host().toString());</span>
<span class="udiff-line-modified-added">+     String domain = url.host().toString();</span>
<span class="udiff-line-added">+     String baseDomain = topPrivatelyControlledDomain(domain);</span>
  
      // Our Google UA is *very* complicated to get right. Read
<span class="udiff-line-modified-removed">-     // https://webkit.org/b/142074 carefully before changing. Test that Earth</span>
<span class="udiff-line-modified-removed">-     // view is available in Google Maps. Test Google Calendar. Test downloading</span>
<span class="udiff-line-modified-removed">-     // the Hangouts browser plugin. Test logging out and logging in to a Google</span>
<span class="udiff-line-modified-removed">-     // account. Change platformVersionForUAString() to return &quot;FreeBSD amd64&quot;</span>
<span class="udiff-line-removed">-     // and test everything again.</span>
<span class="udiff-line-modified-added">+     // https://webkit.org/b/142074 carefully before changing. Test that 3D</span>
<span class="udiff-line-modified-added">+     // view is available in Google Maps. Test Google Calendar. Test logging out</span>
<span class="udiff-line-modified-added">+     // and logging in to a Google account. Change platformVersionForUAString()</span>
<span class="udiff-line-modified-added">+     // to return &quot;FreeBSD amd64&quot; and test everything again.</span>
      if (baseDomain.startsWith(&quot;google.&quot;))
          return true;
      if (baseDomain == &quot;gstatic.com&quot;)
          return true;
<span class="udiff-line-removed">-     if (baseDomain == &quot;googleapis.com&quot;)</span>
<span class="udiff-line-removed">-         return true;</span>
      if (baseDomain == &quot;googleusercontent.com&quot;)
          return true;
<span class="udiff-line-added">+     // googleapis.com is in the public suffix list, which is confusing. E.g.</span>
<span class="udiff-line-added">+     // fonts.googleapis.com is actually a base domain.</span>
<span class="udiff-line-added">+     if (domain.endsWith(&quot;.googleapis.com&quot;))</span>
<span class="udiff-line-added">+         return true;</span>
  
      return false;
  }
  
  // Be careful with this quirk: it&#39;s an invitation for sites to use JavaScript
  // that works in Chrome that WebKit cannot handle. Prefer other quirks instead.
  static bool urlRequiresChromeBrowser(const URL&amp; url)
  {
<span class="udiff-line-modified-removed">-     String baseDomain = topPrivatelyControlledDomain(url.host().toString());</span>
<span class="udiff-line-modified-added">+     String domain = url.host().toString();</span>
<span class="udiff-line-added">+     String baseDomain = topPrivatelyControlledDomain(domain);</span>
  
      // Needed for fonts on many sites to work with WebKit.
      // https://bugs.webkit.org/show_bug.cgi?id=147296
      if (baseDomain == &quot;typekit.net&quot; || baseDomain == &quot;typekit.com&quot;)
          return true;
  
<span class="udiff-line-added">+     // This site completely blocks the login page with WebKitGTK&#39;s standard user</span>
<span class="udiff-line-added">+     // agent and ask users to use Google Chrome or Microsoft Internet Explorer.</span>
<span class="udiff-line-added">+     if (domain == &quot;auth.mayohr.com&quot;)</span>
<span class="udiff-line-added">+         return true;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return false;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ // Prefer using the macOS platform quirk rather than the Firefox quirk. This</span>
<span class="udiff-line-added">+ // quirk is good for websites that do macOS-specific things we don&#39;t want on</span>
<span class="udiff-line-added">+ // other platforms, and when the risk of the website doing Firefox-specific</span>
<span class="udiff-line-added">+ // things is relatively low.</span>
<span class="udiff-line-added">+ static bool urlRequiresFirefoxBrowser(const URL&amp; url)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     String domain = url.host().toString();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // This quirk actually has nothing to do with YouTube. It&#39;s needed to avoid</span>
<span class="udiff-line-added">+     // unsupported browser warnings on Google Docs. After removing this quirk,</span>
<span class="udiff-line-added">+     // to reproduce the warnings you will need to sign out of Google, then click</span>
<span class="udiff-line-added">+     // on a link to a non-public document that requires signing in. The</span>
<span class="udiff-line-added">+     // unsupported browser warning will be displayed after signing in.</span>
<span class="udiff-line-added">+     if (domain == &quot;accounts.youtube.com&quot; || domain == &quot;docs.google.com&quot;)</span>
<span class="udiff-line-added">+         return true;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // Google Drive shows an unsupported browser warning with WebKitGTK&#39;s</span>
<span class="udiff-line-added">+     // standard user agent.</span>
<span class="udiff-line-added">+     if (domain == &quot;drive.google.com&quot;)</span>
<span class="udiff-line-added">+         return true;</span>
<span class="udiff-line-added">+ </span>
      return false;
  }
  
  static bool urlRequiresMacintoshPlatform(const URL&amp; url)
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -102,40 +134,33 @@</span>
      if (domain == &quot;outlook.live.com&quot;
          || domain == &quot;mail.ntu.edu.tw&quot;
          || domain == &quot;exchange.tu-berlin.de&quot;)
          return true;
  
<span class="udiff-line-removed">-     // Google Docs and Google Drive both show a scary unsupported browser</span>
<span class="udiff-line-removed">-     // warning with WebKitGTK&#39;s standard user agent.</span>
<span class="udiff-line-removed">-     if (domain == &quot;docs.google.com&quot;</span>
<span class="udiff-line-removed">-         || domain == &quot;drive.google.com&quot;)</span>
<span class="udiff-line-removed">-         return true;</span>
<span class="udiff-line-removed">- </span>
      // Bank of America shows an unsupported browser warning with WebKitGTK&#39;s
      // standard user agent.
      if (baseDomain == &quot;bankofamerica.com&quot;)
          return true;
  
      return false;
  }
  
  static bool urlRequiresLinuxDesktopPlatform(const URL&amp; url)
  {
<span class="udiff-line-modified-removed">-     // docs.google.com and drive.google.com require the macOS platform quirk.</span>
<span class="udiff-line-removed">-     return isGoogle(url)</span>
<span class="udiff-line-removed">-         &amp;&amp; url.host() != &quot;docs.google.com&quot;</span>
<span class="udiff-line-removed">-         &amp;&amp; url.host() != &quot;drive.google.com&quot;;</span>
<span class="udiff-line-modified-added">+     return isGoogle(url);</span>
  }
  
  UserAgentQuirks UserAgentQuirks::quirksForURL(const URL&amp; url)
  {
      ASSERT(!url.isNull());
  
      UserAgentQuirks quirks;
  
      if (urlRequiresChromeBrowser(url))
          quirks.add(UserAgentQuirks::NeedsChromeBrowser);
<span class="udiff-line-added">+     else if (urlRequiresFirefoxBrowser(url))</span>
<span class="udiff-line-added">+         quirks.add(UserAgentQuirks::NeedsFirefoxBrowser);</span>
  
      if (urlRequiresMacintoshPlatform(url))
          quirks.add(UserAgentQuirks::NeedsMacintoshPlatform);
      else if (urlRequiresLinuxDesktopPlatform(url))
          quirks.add(UserAgentQuirks::NeedsLinuxDesktopPlatform);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -146,11 +171,13 @@</span>
  String UserAgentQuirks::stringForQuirk(UserAgentQuirk quirk)
  {
      switch (quirk) {
      case NeedsChromeBrowser:
          // Get versions from https://chromium.googlesource.com/chromium/src.git
<span class="udiff-line-modified-removed">-         return &quot;Chrome/75.0.3770.141&quot;_s;</span>
<span class="udiff-line-modified-added">+         return &quot;Chrome/83.0.4096.4&quot;_s;</span>
<span class="udiff-line-added">+     case NeedsFirefoxBrowser:</span>
<span class="udiff-line-added">+         return &quot;; rv:76.0) Gecko/20100101 Firefox/76.0&quot;_s;</span>
      case NeedsMacintoshPlatform:
          return &quot;Macintosh; Intel Mac OS X 10_15&quot;_s;
      case NeedsLinuxDesktopPlatform:
          return &quot;X11; Linux x86_64&quot;_s;
      case NumUserAgentQuirks:
</pre>
<center><a href="Timer.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="UserAgentQuirks.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>