<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/loader/FrameLoaderClient.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2006-2017 Apple Inc. All rights reserved.
  3  * Copyright (C) 2012 Google Inc. All rights reserved.
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  *
  9  * 1.  Redistributions of source code must retain the above copyright
 10  *     notice, this list of conditions and the following disclaimer.
 11  * 2.  Redistributions in binary form must reproduce the above copyright
 12  *     notice, this list of conditions and the following disclaimer in the
 13  *     documentation and/or other materials provided with the distribution.
 14  * 3.  Neither the name of Apple Inc. (&quot;Apple&quot;) nor the names of
 15  *     its contributors may be used to endorse or promote products derived
 16  *     from this software without specific prior written permission.
 17  *
 18  * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 19  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 20  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 21  * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 22  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 23  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 24  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 25  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 26  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 27  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 28  */
 29 
 30 #pragma once
 31 
 32 #include &quot;FrameIdentifier.h&quot;
 33 #include &quot;FrameLoaderTypes.h&quot;
 34 #include &quot;LayoutMilestone.h&quot;
 35 #include &quot;LinkIcon.h&quot;
 36 #include &quot;PageIdentifier.h&quot;
 37 #include &lt;functional&gt;
 38 #include &lt;wtf/Forward.h&gt;
 39 #include &lt;wtf/WallTime.h&gt;
 40 #include &lt;wtf/text/WTFString.h&gt;
 41 
 42 #if ENABLE(APPLICATION_MANIFEST)
 43 #include &quot;ApplicationManifest.h&quot;
 44 #endif
 45 
 46 #if ENABLE(CONTENT_FILTERING)
 47 #include &quot;ContentFilterUnblockHandler.h&quot;
 48 #endif
 49 
 50 #if PLATFORM(COCOA)
 51 #ifdef __OBJC__
 52 #import &lt;Foundation/Foundation.h&gt;
 53 typedef id RemoteAXObjectRef;
 54 #else
 55 typedef void* RemoteAXObjectRef;
 56 #endif
 57 #endif
 58 
 59 #if PLATFORM(COCOA)
 60 OBJC_CLASS NSArray;
 61 OBJC_CLASS NSCachedURLResponse;
 62 OBJC_CLASS NSDictionary;
 63 OBJC_CLASS NSView;
 64 #endif
 65 
<a name="1" id="anc1"></a>



 66 namespace WebCore {
 67 
 68 class AuthenticationChallenge;
 69 class CachedFrame;
 70 class CachedResourceRequest;
 71 class Color;
 72 class DOMWindow;
 73 class DOMWindowExtension;
 74 class DOMWrapperWorld;
 75 class DocumentLoader;
 76 class Element;
 77 class FormState;
 78 class Frame;
 79 class FrameLoader;
 80 class FrameNetworkingContext;
 81 class HTMLAppletElement;
 82 class HTMLFormElement;
 83 class HTMLFrameOwnerElement;
 84 class HTMLPlugInElement;
 85 class HistoryItem;
 86 class IntSize;
<a name="2" id="anc2"></a><span class="line-added"> 87 class LegacyPreviewLoaderClient;</span>
 88 class MessageEvent;
 89 class NavigationAction;
 90 class Page;
 91 class PluginViewBase;
<a name="3" id="anc3"></a>
 92 class ProtectionSpace;
 93 class RTCPeerConnectionHandler;
 94 class ResourceError;
 95 class ResourceHandle;
 96 class ResourceRequest;
 97 class ResourceResponse;
 98 class SecurityOrigin;
 99 class SharedBuffer;
100 class SubstituteData;
101 class Widget;
102 
103 enum class LockBackForwardList : bool;
104 enum class PolicyDecisionMode;
105 
106 struct StringWithDirection;
107 
108 typedef WTF::Function&lt;void (PolicyAction, PolicyCheckIdentifier)&gt; FramePolicyFunction;
109 
110 class WEBCORE_EXPORT FrameLoaderClient {
111     WTF_MAKE_FAST_ALLOCATED;
112 public:
113     // An inline function cannot be the first non-abstract virtual function declared
114     // in the class as it results in the vtable being generated as a weak symbol.
115     // This hurts performance (in Mac OS X at least, when loading frameworks), so we
116     // don&#39;t want to do it in WebKit.
117     virtual bool hasHTMLView() const;
118 
119     virtual ~FrameLoaderClient() = default;
120 
121     virtual void frameLoaderDestroyed() = 0;
122 
123     virtual bool hasWebView() const = 0; // mainly for assertions
124 
125     virtual void makeRepresentation(DocumentLoader*) = 0;
126 
127     virtual Optional&lt;PageIdentifier&gt; pageID() const = 0;
128     virtual Optional&lt;FrameIdentifier&gt; frameID() const = 0;
<a name="4" id="anc4"></a>
129 
130 #if PLATFORM(IOS_FAMILY)
131     // Returns true if the client forced the layout.
<a name="5" id="anc5"></a><span class="line-modified">132     virtual bool forceLayoutOnRestoreFromBackForwardCache() = 0;</span>
133 #endif
134     virtual void forceLayoutForNonHTML() = 0;
135 
136     virtual void setCopiesOnScroll() = 0;
137 
138     virtual void detachedFromParent2() = 0;
139     virtual void detachedFromParent3() = 0;
140 
141     virtual void assignIdentifierToInitialRequest(unsigned long identifier, DocumentLoader*, const ResourceRequest&amp;) = 0;
142 
143     virtual void dispatchWillSendRequest(DocumentLoader*, unsigned long identifier, ResourceRequest&amp;, const ResourceResponse&amp; redirectResponse) = 0;
144     virtual bool shouldUseCredentialStorage(DocumentLoader*, unsigned long identifier) = 0;
145     virtual void dispatchDidReceiveAuthenticationChallenge(DocumentLoader*, unsigned long identifier, const AuthenticationChallenge&amp;) = 0;
146 #if USE(PROTECTION_SPACE_AUTH_CALLBACK)
147     virtual bool canAuthenticateAgainstProtectionSpace(DocumentLoader*, unsigned long identifier, const ProtectionSpace&amp;) = 0;
148 #endif
149 
150 #if PLATFORM(IOS_FAMILY)
151     virtual RetainPtr&lt;CFDictionaryRef&gt; connectionProperties(DocumentLoader*, unsigned long identifier) = 0;
152 #endif
153 
154     virtual void dispatchDidReceiveResponse(DocumentLoader*, unsigned long identifier, const ResourceResponse&amp;) = 0;
155     virtual void dispatchDidReceiveContentLength(DocumentLoader*, unsigned long identifier, int dataLength) = 0;
156     virtual void dispatchDidFinishLoading(DocumentLoader*, unsigned long identifier) = 0;
157     virtual void dispatchDidFailLoading(DocumentLoader*, unsigned long identifier, const ResourceError&amp;) = 0;
158     virtual bool dispatchDidLoadResourceFromMemoryCache(DocumentLoader*, const ResourceRequest&amp;, const ResourceResponse&amp;, int length) = 0;
159 
160     virtual void dispatchDidDispatchOnloadEvents() = 0;
161     virtual void dispatchDidReceiveServerRedirectForProvisionalLoad() = 0;
162     virtual void dispatchDidChangeProvisionalURL() { }
163     virtual void dispatchDidCancelClientRedirect() = 0;
164     virtual void dispatchWillPerformClientRedirect(const URL&amp;, double interval, WallTime fireDate, LockBackForwardList) = 0;
165     virtual void dispatchDidChangeMainDocument() { }
166     virtual void dispatchWillChangeDocument(const URL&amp;, const URL&amp;) { }
167     virtual void dispatchDidNavigateWithinPage() { }
168     virtual void dispatchDidChangeLocationWithinPage() = 0;
169     virtual void dispatchDidPushStateWithinPage() = 0;
170     virtual void dispatchDidReplaceStateWithinPage() = 0;
171     virtual void dispatchDidPopStateWithinPage() = 0;
172     virtual void dispatchWillClose() = 0;
173     virtual void dispatchDidReceiveIcon() { }
174     virtual void dispatchDidStartProvisionalLoad() = 0;
175     virtual void dispatchDidReceiveTitle(const StringWithDirection&amp;) = 0;
176     virtual void dispatchDidCommitLoad(Optional&lt;HasInsecureContent&gt;) = 0;
177     virtual void dispatchDidFailProvisionalLoad(const ResourceError&amp;, WillContinueLoading) = 0;
178     virtual void dispatchDidFailLoad(const ResourceError&amp;) = 0;
179     virtual void dispatchDidFinishDocumentLoad() = 0;
180     virtual void dispatchDidFinishLoad() = 0;
<a name="6" id="anc6"></a><span class="line-modified">181     virtual void dispatchDidExplicitOpen(const URL&amp;, const String&amp; /* mimeType */) { }</span>
182 #if ENABLE(DATA_DETECTION)
183     virtual void dispatchDidFinishDataDetection(NSArray *detectionResults) = 0;
184 #endif
185 
186     virtual void dispatchDidLayout() { }
187     virtual void dispatchDidReachLayoutMilestone(OptionSet&lt;LayoutMilestone&gt;) { }
188 
189     virtual Frame* dispatchCreatePage(const NavigationAction&amp;) = 0;
190     virtual void dispatchShow() = 0;
191 
192     virtual void dispatchDecidePolicyForResponse(const ResourceResponse&amp;, const ResourceRequest&amp;, PolicyCheckIdentifier, const String&amp; downloadAttribute, FramePolicyFunction&amp;&amp;) = 0;
193     virtual void dispatchDecidePolicyForNewWindowAction(const NavigationAction&amp;, const ResourceRequest&amp;, FormState*, const String&amp; frameName, PolicyCheckIdentifier, FramePolicyFunction&amp;&amp;) = 0;
194     virtual void dispatchDecidePolicyForNavigationAction(const NavigationAction&amp;, const ResourceRequest&amp;, const ResourceResponse&amp; redirectResponse, FormState*, PolicyDecisionMode, PolicyCheckIdentifier, FramePolicyFunction&amp;&amp;) = 0;
195     virtual void cancelPolicyCheck() = 0;
196 
197     virtual void dispatchUnableToImplementPolicy(const ResourceError&amp;) = 0;
198 
199     virtual void dispatchWillSendSubmitEvent(Ref&lt;FormState&gt;&amp;&amp;) = 0;
200     virtual void dispatchWillSubmitForm(FormState&amp;, CompletionHandler&lt;void()&gt;&amp;&amp;) = 0;
201 
202     virtual void revertToProvisionalState(DocumentLoader*) = 0;
203     virtual void setMainDocumentError(DocumentLoader*, const ResourceError&amp;) = 0;
204 
205     virtual void setMainFrameDocumentReady(bool) = 0;
206 
207     virtual void startDownload(const ResourceRequest&amp;, const String&amp; suggestedName = String()) = 0;
208 
209     virtual void willChangeTitle(DocumentLoader*) = 0;
210     virtual void didChangeTitle(DocumentLoader*) = 0;
211 
212     virtual void willReplaceMultipartContent() = 0;
213     virtual void didReplaceMultipartContent() = 0;
214 
215     virtual void committedLoad(DocumentLoader*, const char*, int) = 0;
216     virtual void finishedLoading(DocumentLoader*) = 0;
217 
218     virtual void updateGlobalHistory() = 0;
219     virtual void updateGlobalHistoryRedirectLinks() = 0;
220 
221     virtual bool shouldGoToHistoryItem(HistoryItem&amp;) const = 0;
222 
223     // This frame has set its opener to null, disowning it for the lifetime of the frame.
224     // See http://html.spec.whatwg.org/#dom-opener.
225     // FIXME: JSC should allow disowning opener. - &lt;https://bugs.webkit.org/show_bug.cgi?id=103913&gt;.
226     virtual void didDisownOpener() { }
227 
228     // This frame has displayed inactive content (such as an image) from an
229     // insecure source.  Inactive content cannot spread to other frames.
230     virtual void didDisplayInsecureContent() = 0;
231 
232     // The indicated security origin has run active content (such as a
233     // script) from an insecure source.  Note that the insecure content can
234     // spread to other frames in the same origin.
235     virtual void didRunInsecureContent(SecurityOrigin&amp;, const URL&amp;) = 0;
236     virtual void didDetectXSS(const URL&amp;, bool didBlockEntirePage) = 0;
237 
238     virtual ResourceError cancelledError(const ResourceRequest&amp;) = 0;
239     virtual ResourceError blockedError(const ResourceRequest&amp;) = 0;
240     virtual ResourceError blockedByContentBlockerError(const ResourceRequest&amp;) = 0;
241     virtual ResourceError cannotShowURLError(const ResourceRequest&amp;) = 0;
242     virtual ResourceError interruptedForPolicyChangeError(const ResourceRequest&amp;) = 0;
243 #if ENABLE(CONTENT_FILTERING)
244     virtual ResourceError blockedByContentFilterError(const ResourceRequest&amp;) = 0;
245 #endif
246 
247     virtual ResourceError cannotShowMIMETypeError(const ResourceResponse&amp;) = 0;
248     virtual ResourceError fileDoesNotExistError(const ResourceResponse&amp;) = 0;
249     virtual ResourceError pluginWillHandleLoadError(const ResourceResponse&amp;) = 0;
250 
251     virtual bool shouldFallBack(const ResourceError&amp;) = 0;
252 
253     virtual bool canHandleRequest(const ResourceRequest&amp;) const = 0;
254     virtual bool canShowMIMEType(const String&amp; MIMEType) const = 0;
255     virtual bool canShowMIMETypeAsHTML(const String&amp; MIMEType) const = 0;
256     virtual bool representationExistsForURLScheme(const String&amp; URLScheme) const = 0;
257     virtual String generatedMIMETypeForURLScheme(const String&amp; URLScheme) const = 0;
258 
259     virtual void frameLoadCompleted() = 0;
260     virtual void saveViewStateToItem(HistoryItem&amp;) = 0;
261     virtual void restoreViewState() = 0;
262     virtual void provisionalLoadStarted() = 0;
263     virtual void didFinishLoad() = 0;
264     virtual void prepareForDataSourceReplacement() = 0;
265 
266     virtual Ref&lt;DocumentLoader&gt; createDocumentLoader(const ResourceRequest&amp;, const SubstituteData&amp;) = 0;
267     virtual void updateCachedDocumentLoader(DocumentLoader&amp;) = 0;
268     virtual void setTitle(const StringWithDirection&amp;, const URL&amp;) = 0;
269 
270     virtual String userAgent(const URL&amp;) = 0;
271 
272     virtual String overrideContentSecurityPolicy() const { return String(); }
273 
274     virtual void savePlatformDataToCachedFrame(CachedFrame*) = 0;
275     virtual void transitionToCommittedFromCachedFrame(CachedFrame*) = 0;
276 #if PLATFORM(IOS_FAMILY)
277     virtual void didRestoreFrameHierarchyForCachedFrame() = 0;
278 #endif
279     virtual void transitionToCommittedForNewPage() = 0;
280 
<a name="7" id="anc7"></a><span class="line-modified">281     virtual void didRestoreFromBackForwardCache() = 0;</span>

282 
283     virtual void dispatchDidBecomeFrameset(bool) = 0; // Can change due to navigation or DOM modification.
284 
285     virtual bool canCachePage() const = 0;
<a name="8" id="anc8"></a><span class="line-modified">286     virtual void convertMainResourceLoadToDownload(DocumentLoader*, const ResourceRequest&amp;, const ResourceResponse&amp;) = 0;</span>
287 
288     virtual RefPtr&lt;Frame&gt; createFrame(const URL&amp;, const String&amp; name, HTMLFrameOwnerElement&amp;, const String&amp; referrer) = 0;
289     virtual RefPtr&lt;Widget&gt; createPlugin(const IntSize&amp;, HTMLPlugInElement&amp;, const URL&amp;, const Vector&lt;String&gt;&amp;, const Vector&lt;String&gt;&amp;, const String&amp;, bool loadManually) = 0;
290     virtual void redirectDataToPlugin(Widget&amp;) = 0;
291 
292     virtual RefPtr&lt;Widget&gt; createJavaAppletWidget(const IntSize&amp;, HTMLAppletElement&amp;, const URL&amp; baseURL, const Vector&lt;String&gt;&amp; paramNames, const Vector&lt;String&gt;&amp; paramValues) = 0;
293 
294     virtual ObjectContentType objectContentType(const URL&amp;, const String&amp; mimeType) = 0;
295     virtual String overrideMediaType() const = 0;
296 
297     virtual void dispatchDidClearWindowObjectInWorld(DOMWrapperWorld&amp;) = 0;
298 
299     virtual void registerForIconNotification() { }
300 
301 #if PLATFORM(COCOA)
302     // Allow an accessibility object to retrieve a Frame parent if there&#39;s no PlatformWidget.
303     virtual RemoteAXObjectRef accessibilityRemoteObject() = 0;
304     virtual void willCacheResponse(DocumentLoader*, unsigned long identifier, NSCachedURLResponse*, CompletionHandler&lt;void(NSCachedURLResponse *)&gt;&amp;&amp;) const = 0;
305     virtual NSDictionary *dataDetectionContext() { return nullptr; }
306 #endif
307 
308 #if USE(CFURLCONNECTION)
309     // FIXME: Windows should use willCacheResponse - &lt;https://bugs.webkit.org/show_bug.cgi?id=57257&gt;.
310     virtual bool shouldCacheResponse(DocumentLoader*, unsigned long identifier, const ResourceResponse&amp;, const unsigned char* data, unsigned long long length) = 0;
311 #endif
312 
313     virtual bool shouldAlwaysUsePluginDocument(const String&amp; /*mimeType*/) const { return false; }
314     virtual bool shouldLoadMediaElementURL(const URL&amp;) const { return true; }
315 
316     virtual void didChangeScrollOffset() { }
317 
318     virtual bool allowScript(bool enabledPerSettings) { return enabledPerSettings; }
319 
320     // Clients that generally disallow universal access can make exceptions for particular URLs.
321     virtual bool shouldForceUniversalAccessFromLocalURL(const URL&amp;) { return false; }
322 
323     virtual Ref&lt;FrameNetworkingContext&gt; createNetworkingContext() = 0;
324 
325     virtual bool shouldPaintBrokenImage(const URL&amp;) const { return true; }
326 
327     virtual void dispatchGlobalObjectAvailable(DOMWrapperWorld&amp;) { }
328     virtual void dispatchWillDisconnectDOMWindowExtensionFromGlobalObject(DOMWindowExtension*) { }
329     virtual void dispatchDidReconnectDOMWindowExtensionToGlobalObject(DOMWindowExtension*) { }
330     virtual void dispatchWillDestroyGlobalObjectForDOMWindowExtension(DOMWindowExtension*) { }
331 
332     virtual void willInjectUserScript(DOMWrapperWorld&amp;) { }
333 
334 #if ENABLE(WEB_RTC)
335     virtual void dispatchWillStartUsingPeerConnectionHandler(RTCPeerConnectionHandler*) { }
336 #endif
337 
338 #if ENABLE(WEBGL)
339     virtual bool allowWebGL(bool enabledPerSettings) { return enabledPerSettings; }
340     // Informs the embedder that a WebGL canvas inside this frame received a lost context
<a name="9" id="anc9"></a><span class="line-modified">341     // notification with the given GL_ARB_robustness guilt/innocence code (see ExtensionsGL.h).</span>
342     virtual void didLoseWebGLContext(int) { }
343     virtual WebGLLoadPolicy webGLPolicyForURL(const URL&amp;) const { return WebGLAllowCreation; }
344     virtual WebGLLoadPolicy resolveWebGLPolicyForURL(const URL&amp;) const { return WebGLAllowCreation; }
345 #endif
346 
347     virtual void forcePageTransitionIfNeeded() { }
348 
349     // FIXME (bug 116233): We need to get rid of EmptyFrameLoaderClient completely, then this will no longer be needed.
<a name="10" id="anc10"></a><span class="line-modified">350     virtual bool isEmptyFrameLoaderClient() const { return false; }</span>
<span class="line-added">351     virtual bool isServiceWorkerFrameLoaderClient() const { return false; }</span>
352 
353 #if PLATFORM(JAVA)
354         virtual bool isJavaFrameLoaderClient() { return false; }
355 #endif
356 #if USE(QUICK_LOOK)
<a name="11" id="anc11"></a><span class="line-modified">357     virtual RefPtr&lt;LegacyPreviewLoaderClient&gt; createPreviewLoaderClient(const String&amp;, const String&amp;) = 0;</span>
358 #endif
359 
360 #if ENABLE(CONTENT_FILTERING)
361     virtual void contentFilterDidBlockLoad(ContentFilterUnblockHandler) { }
362 #endif
363 
364     virtual void prefetchDNS(const String&amp;) = 0;
365 
366     virtual void didRestoreScrollPosition() { }
367 
368     virtual void getLoadDecisionForIcons(const Vector&lt;std::pair&lt;WebCore::LinkIcon&amp;, uint64_t&gt;&gt;&amp;) { }
369     virtual void finishedLoadingIcon(uint64_t, SharedBuffer*) { }
370 
371     virtual void didCreateWindow(DOMWindow&amp;) { }
372 
373 #if ENABLE(APPLICATION_MANIFEST)
374     virtual void finishedLoadingApplicationManifest(uint64_t, const Optional&lt;ApplicationManifest&gt;&amp;) { }
375 #endif
376 
377 #if ENABLE(RESOURCE_LOAD_STATISTICS)
378     virtual bool hasFrameSpecificStorageAccess() { return false; }
<a name="12" id="anc12"></a>
379 #endif
380 };
381 
382 } // namespace WebCore
<a name="13" id="anc13"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="13" type="hidden" />
</body>
</html>