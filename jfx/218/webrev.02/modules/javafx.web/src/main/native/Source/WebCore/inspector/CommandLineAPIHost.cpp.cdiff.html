<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/inspector/CommandLineAPIHost.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../html/track/WebVTTParser.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CommandLineAPIHost.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/inspector/CommandLineAPIHost.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 40,10 ***</span>
<span class="line-new-header">--- 40,11 ---</span>
  #include &quot;JSDOMGlobalObject.h&quot;
  #include &quot;JSEventListener.h&quot;
  #include &quot;Pasteboard.h&quot;
  #include &quot;Storage.h&quot;
  #include &quot;WebConsoleAgent.h&quot;
<span class="line-added">+ #include &lt;JavaScriptCore/ConsoleMessage.h&gt;</span>
  #include &lt;JavaScriptCore/InspectorAgent.h&gt;
  #include &lt;JavaScriptCore/JSCInlines.h&gt;
  #include &lt;JavaScriptCore/JSLock.h&gt;
  #include &lt;JavaScriptCore/ScriptValue.h&gt;
  #include &lt;wtf/JSONValues.h&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 71,36 ***</span>
  {
  
      m_instrumentingAgents = nullptr;
  }
  
<span class="line-modified">! void CommandLineAPIHost::inspect(JSC::ExecState&amp; state, JSC::JSValue valueToInspect, JSC::JSValue hintsValue)</span>
  {
      if (!m_instrumentingAgents)
          return;
  
      auto* inspectorAgent = m_instrumentingAgents-&gt;inspectorAgent();
      if (!inspectorAgent)
          return;
  
      RefPtr&lt;JSON::Object&gt; hintsObject;
<span class="line-modified">!     if (!Inspector::toInspectorValue(state, hintsValue)-&gt;asObject(hintsObject))</span>
          return;
  
<span class="line-modified">!     auto remoteObject = BindingTraits&lt;Inspector::Protocol::Runtime::RemoteObject&gt;::runtimeCast(Inspector::toInspectorValue(state, valueToInspect));</span>
      inspectorAgent-&gt;inspect(WTFMove(remoteObject), WTFMove(hintsObject));
  }
  
<span class="line-modified">! CommandLineAPIHost::EventListenersRecord CommandLineAPIHost::getEventListeners(ExecState&amp; state, EventTarget&amp; target)</span>
  {
      auto* scriptExecutionContext = target.scriptExecutionContext();
      if (!scriptExecutionContext)
          return { };
  
      EventListenersRecord result;
  
<span class="line-modified">!     VM&amp; vm = state.vm();</span>
  
      for (auto&amp; eventType : target.eventTypes()) {
          Vector&lt;CommandLineAPIHost::ListenerEntry&gt; entries;
  
          for (auto&amp; eventListener : target.eventListeners(eventType)) {
<span class="line-new-header">--- 72,36 ---</span>
  {
  
      m_instrumentingAgents = nullptr;
  }
  
<span class="line-modified">! void CommandLineAPIHost::inspect(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::JSValue valueToInspect, JSC::JSValue hintsValue)</span>
  {
      if (!m_instrumentingAgents)
          return;
  
      auto* inspectorAgent = m_instrumentingAgents-&gt;inspectorAgent();
      if (!inspectorAgent)
          return;
  
      RefPtr&lt;JSON::Object&gt; hintsObject;
<span class="line-modified">!     if (!Inspector::toInspectorValue(&amp;lexicalGlobalObject, hintsValue)-&gt;asObject(hintsObject))</span>
          return;
  
<span class="line-modified">!     auto remoteObject = BindingTraits&lt;Inspector::Protocol::Runtime::RemoteObject&gt;::runtimeCast(Inspector::toInspectorValue(&amp;lexicalGlobalObject, valueToInspect));</span>
      inspectorAgent-&gt;inspect(WTFMove(remoteObject), WTFMove(hintsObject));
  }
  
<span class="line-modified">! CommandLineAPIHost::EventListenersRecord CommandLineAPIHost::getEventListeners(JSGlobalObject&amp; lexicalGlobalObject, EventTarget&amp; target)</span>
  {
      auto* scriptExecutionContext = target.scriptExecutionContext();
      if (!scriptExecutionContext)
          return { };
  
      EventListenersRecord result;
  
<span class="line-modified">!     VM&amp; vm = lexicalGlobalObject.vm();</span>
  
      for (auto&amp; eventType : target.eventTypes()) {
          Vector&lt;CommandLineAPIHost::ListenerEntry&gt; entries;
  
          for (auto&amp; eventListener : target.eventListeners(eventType)) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 108,11 ***</span>
                  continue;
  
              auto&amp; jsListener = downcast&lt;JSEventListener&gt;(eventListener-&gt;callback());
  
              // Hide listeners from other contexts.
<span class="line-modified">!             if (&amp;jsListener.isolatedWorld() != &amp;currentWorld(state))</span>
                  continue;
  
              auto* function = jsListener.jsFunction(*scriptExecutionContext);
              if (!function)
                  continue;
<span class="line-new-header">--- 109,11 ---</span>
                  continue;
  
              auto&amp; jsListener = downcast&lt;JSEventListener&gt;(eventListener-&gt;callback());
  
              // Hide listeners from other contexts.
<span class="line-modified">!             if (&amp;jsListener.isolatedWorld() != &amp;currentWorld(lexicalGlobalObject))</span>
                  continue;
  
              auto* function = jsListener.jsFunction(*scriptExecutionContext);
              if (!function)
                  continue;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 143,27 ***</span>
  void CommandLineAPIHost::copyText(const String&amp; text)
  {
      Pasteboard::createForCopyAndPaste()-&gt;writePlainText(text, Pasteboard::CannotSmartReplace);
  }
  
<span class="line-modified">! JSC::JSValue CommandLineAPIHost::InspectableObject::get(JSC::ExecState&amp;)</span>
  {
      return { };
  }
  
  void CommandLineAPIHost::addInspectedObject(std::unique_ptr&lt;CommandLineAPIHost::InspectableObject&gt; object)
  {
      m_inspectedObject = WTFMove(object);
  }
  
<span class="line-modified">! JSC::JSValue CommandLineAPIHost::inspectedObject(JSC::ExecState&amp; state)</span>
  {
      if (!m_inspectedObject)
          return jsUndefined();
  
<span class="line-modified">!     JSC::JSLockHolder lock(&amp;state);</span>
<span class="line-modified">!     auto scriptValue = m_inspectedObject-&gt;get(state);</span>
      return scriptValue ? scriptValue : jsUndefined();
  }
  
  String CommandLineAPIHost::databaseId(Database&amp; database)
  {
<span class="line-new-header">--- 144,27 ---</span>
  void CommandLineAPIHost::copyText(const String&amp; text)
  {
      Pasteboard::createForCopyAndPaste()-&gt;writePlainText(text, Pasteboard::CannotSmartReplace);
  }
  
<span class="line-modified">! JSC::JSValue CommandLineAPIHost::InspectableObject::get(JSC::JSGlobalObject&amp;)</span>
  {
      return { };
  }
  
  void CommandLineAPIHost::addInspectedObject(std::unique_ptr&lt;CommandLineAPIHost::InspectableObject&gt; object)
  {
      m_inspectedObject = WTFMove(object);
  }
  
<span class="line-modified">! JSC::JSValue CommandLineAPIHost::inspectedObject(JSC::JSGlobalObject&amp; lexicalGlobalObject)</span>
  {
      if (!m_inspectedObject)
          return jsUndefined();
  
<span class="line-modified">!     JSC::JSLockHolder lock(&amp;lexicalGlobalObject);</span>
<span class="line-modified">!     auto scriptValue = m_inspectedObject-&gt;get(lexicalGlobalObject);</span>
      return scriptValue ? scriptValue : jsUndefined();
  }
  
  String CommandLineAPIHost::databaseId(Database&amp; database)
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 177,11 ***</span>
  String CommandLineAPIHost::storageId(Storage&amp; storage)
  {
      return InspectorDOMStorageAgent::storageId(storage);
  }
  
<span class="line-modified">! JSValue CommandLineAPIHost::wrapper(ExecState* exec, JSDOMGlobalObject* globalObject)</span>
  {
      JSValue value = m_wrappers.getWrapper(globalObject);
      if (value)
          return value;
  
<span class="line-new-header">--- 178,11 ---</span>
  String CommandLineAPIHost::storageId(Storage&amp; storage)
  {
      return InspectorDOMStorageAgent::storageId(storage);
  }
  
<span class="line-modified">! JSValue CommandLineAPIHost::wrapper(JSGlobalObject* exec, JSDOMGlobalObject* globalObject)</span>
  {
      JSValue value = m_wrappers.getWrapper(globalObject);
      if (value)
          return value;
  
</pre>
<center><a href="../html/track/WebVTTParser.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CommandLineAPIHost.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>