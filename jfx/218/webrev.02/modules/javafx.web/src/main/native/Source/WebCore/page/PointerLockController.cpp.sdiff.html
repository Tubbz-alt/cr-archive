<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/page/PointerLockController.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PointerCaptureController.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PrintContext.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/page/PointerLockController.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 17  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 18  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 19  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 20  * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 21  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 22  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 23  */
 24 
 25 #include &quot;config.h&quot;
 26 #include &quot;PointerLockController.h&quot;
 27 
 28 #if ENABLE(POINTER_LOCK)
 29 
 30 #include &quot;Chrome.h&quot;
 31 #include &quot;ChromeClient.h&quot;
 32 #include &quot;Element.h&quot;
 33 #include &quot;Event.h&quot;
 34 #include &quot;EventNames.h&quot;
 35 #include &quot;Page.h&quot;
 36 #include &quot;PlatformMouseEvent.h&quot;
<span class="line-removed"> 37 #include &quot;RuntimeEnabledFeatures.h&quot;</span>
 38 #include &quot;UserGestureIndicator.h&quot;
 39 #include &quot;VoidCallback.h&quot;
 40 
 41 #if ENABLE(POINTER_EVENTS)
 42 #include &quot;PointerCaptureController.h&quot;
 43 #endif
 44 
 45 namespace WebCore {
 46 
 47 PointerLockController::PointerLockController(Page&amp; page)
 48     : m_page(page)
 49 {
 50 }
 51 
 52 void PointerLockController::requestPointerLock(Element* target)
 53 {
 54     if (!target || !target-&gt;isConnected() || m_documentOfRemovedElementWhileWaitingForUnlock) {
 55         enqueueEvent(eventNames().pointerlockerrorEvent, target);
 56         return;
 57     }
</pre>
<hr />
<pre>
199     if (!m_element || !m_element-&gt;document().frame())
200         return;
201 
202     m_element-&gt;dispatchWheelEvent(event);
203 }
204 
205 void PointerLockController::clearElement()
206 {
207     m_lockPending = false;
208     m_element = nullptr;
209 }
210 
211 void PointerLockController::enqueueEvent(const AtomString&amp; type, Element* element)
212 {
213     if (element)
214         enqueueEvent(type, &amp;element-&gt;document());
215 }
216 
217 void PointerLockController::enqueueEvent(const AtomString&amp; type, Document* document)
218 {
<span class="line-modified">219     if (document)</span>
<span class="line-modified">220         document-&gt;enqueueDocumentEvent(Event::create(type, Event::CanBubble::Yes, Event::IsCancelable::No));</span>

221 }
222 
223 } // namespace WebCore
224 
225 #endif // ENABLE(POINTER_LOCK)
</pre>
</td>
<td>
<hr />
<pre>
 17  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 18  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 19  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 20  * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 21  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 22  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 23  */
 24 
 25 #include &quot;config.h&quot;
 26 #include &quot;PointerLockController.h&quot;
 27 
 28 #if ENABLE(POINTER_LOCK)
 29 
 30 #include &quot;Chrome.h&quot;
 31 #include &quot;ChromeClient.h&quot;
 32 #include &quot;Element.h&quot;
 33 #include &quot;Event.h&quot;
 34 #include &quot;EventNames.h&quot;
 35 #include &quot;Page.h&quot;
 36 #include &quot;PlatformMouseEvent.h&quot;

 37 #include &quot;UserGestureIndicator.h&quot;
 38 #include &quot;VoidCallback.h&quot;
 39 
 40 #if ENABLE(POINTER_EVENTS)
 41 #include &quot;PointerCaptureController.h&quot;
 42 #endif
 43 
 44 namespace WebCore {
 45 
 46 PointerLockController::PointerLockController(Page&amp; page)
 47     : m_page(page)
 48 {
 49 }
 50 
 51 void PointerLockController::requestPointerLock(Element* target)
 52 {
 53     if (!target || !target-&gt;isConnected() || m_documentOfRemovedElementWhileWaitingForUnlock) {
 54         enqueueEvent(eventNames().pointerlockerrorEvent, target);
 55         return;
 56     }
</pre>
<hr />
<pre>
198     if (!m_element || !m_element-&gt;document().frame())
199         return;
200 
201     m_element-&gt;dispatchWheelEvent(event);
202 }
203 
204 void PointerLockController::clearElement()
205 {
206     m_lockPending = false;
207     m_element = nullptr;
208 }
209 
210 void PointerLockController::enqueueEvent(const AtomString&amp; type, Element* element)
211 {
212     if (element)
213         enqueueEvent(type, &amp;element-&gt;document());
214 }
215 
216 void PointerLockController::enqueueEvent(const AtomString&amp; type, Document* document)
217 {
<span class="line-modified">218     // FIXME: Spec doesn&#39;t specify which task source use.</span>
<span class="line-modified">219     if (auto protectedDocument = makeRefPtr(document))</span>
<span class="line-added">220         protectedDocument-&gt;queueTaskToDispatchEvent(TaskSource::UserInteraction, Event::create(type, Event::CanBubble::Yes, Event::IsCancelable::No));</span>
221 }
222 
223 } // namespace WebCore
224 
225 #endif // ENABLE(POINTER_LOCK)
</pre>
</td>
</tr>
</table>
<center><a href="PointerCaptureController.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PrintContext.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>