<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/VMTraps.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="VMTraps.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="VarOffset.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/VMTraps.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (C) 2017 Apple Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2017-2019 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -34,11 +34,12 @@</span>
  #include &lt;wtf/RefPtr.h&gt;
  #include &lt;wtf/StackBounds.h&gt;
  
  namespace JSC {
  
<span class="udiff-line-modified-removed">- class ExecState;</span>
<span class="udiff-line-modified-added">+ class CallFrame;</span>
<span class="udiff-line-added">+ class JSGlobalObject;</span>
  class VM;
  
  class VMTraps {
      typedef uint8_t BitField;
  public:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -49,47 +50,53 @@</span>
      };
  
      enum EventType {
          // Sorted in servicing priority order from highest to lowest.
          NeedDebuggerBreak,
<span class="udiff-line-added">+         NeedShellTimeoutCheck,</span>
          NeedTermination,
          NeedWatchdogCheck,
          NumberOfEventTypes, // This entry must be last in this list.
          Invalid
      };
  
      class Mask {
      public:
          enum AllEventTypes { AllEventTypesTag };
<span class="udiff-line-modified-removed">-         Mask(AllEventTypes)</span>
<span class="udiff-line-modified-added">+         constexpr Mask(AllEventTypes)</span>
              : m_mask(std::numeric_limits&lt;BitField&gt;::max())
          { }
<span class="udiff-line-modified-removed">-         static Mask allEventTypes() { return Mask(AllEventTypesTag); }</span>
<span class="udiff-line-modified-added">+         static constexpr Mask allEventTypes() { return Mask(AllEventTypesTag); }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         constexpr Mask(const Mask&amp;) = default;</span>
<span class="udiff-line-added">+         constexpr Mask(Mask&amp;&amp;) = default;</span>
  
          template&lt;typename... Arguments&gt;
<span class="udiff-line-modified-removed">-         Mask(Arguments... args)</span>
<span class="udiff-line-modified-added">+         constexpr Mask(Arguments... args)</span>
              : m_mask(0)
          {
              init(args...);
          }
  
          BitField bits() const { return m_mask; }
  
      private:
          template&lt;typename... Arguments&gt;
<span class="udiff-line-modified-removed">-         void init(EventType eventType, Arguments... args)</span>
<span class="udiff-line-modified-added">+         constexpr void init(EventType eventType, Arguments... args)</span>
          {
              ASSERT(eventType &lt; NumberOfEventTypes);
              m_mask |= (1 &lt;&lt; eventType);
              init(args...);
          }
  
<span class="udiff-line-modified-removed">-         void init() { }</span>
<span class="udiff-line-modified-added">+         constexpr void init() { }</span>
  
          BitField m_mask;
      };
  
<span class="udiff-line-added">+     static constexpr Mask interruptingTraps() { return Mask(NeedShellTimeoutCheck, NeedTermination, NeedWatchdogCheck); }</span>
<span class="udiff-line-added">+ </span>
      ~VMTraps();
      VMTraps();
  
      void willDestroyVM();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -103,11 +110,11 @@</span>
              invalidateCodeBlocksOnStack();
      }
  
      JS_EXPORT_PRIVATE void fireTrap(EventType);
  
<span class="udiff-line-modified-removed">-     void handleTraps(ExecState*, VMTraps::Mask);</span>
<span class="udiff-line-modified-added">+     void handleTraps(JSGlobalObject*, CallFrame*, VMTraps::Mask);</span>
  
      void tryInstallTrapBreakpoints(struct SignalContext&amp;, StackBounds);
  
  private:
      VM&amp; vm() const;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -133,18 +140,19 @@</span>
  #if ENABLE(SIGNAL_BASED_VM_TRAPS)
      class SignalSender;
      friend class SignalSender;
  
      void invalidateCodeBlocksOnStack();
<span class="udiff-line-modified-removed">-     void invalidateCodeBlocksOnStack(ExecState* topCallFrame);</span>
<span class="udiff-line-modified-removed">-     void invalidateCodeBlocksOnStack(Locker&lt;Lock&gt;&amp; codeBlockSetLocker, ExecState* topCallFrame);</span>
<span class="udiff-line-modified-added">+     void invalidateCodeBlocksOnStack(CallFrame* topCallFrame);</span>
<span class="udiff-line-modified-added">+     void invalidateCodeBlocksOnStack(Locker&lt;Lock&gt;&amp; codeBlockSetLocker, CallFrame* topCallFrame);</span>
  
      void addSignalSender(SignalSender*);
      void removeSignalSender(SignalSender*);
  #else
<span class="udiff-line-added">+     friend class SignalSender;</span>
      void invalidateCodeBlocksOnStack() { }
<span class="udiff-line-modified-removed">-     void invalidateCodeBlocksOnStack(ExecState*) { }</span>
<span class="udiff-line-modified-added">+     void invalidateCodeBlocksOnStack(CallFrame*) { }</span>
  #endif
  
      Box&lt;Lock&gt; m_lock;
      Ref&lt;AutomaticThreadCondition&gt; m_condition;
      union {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -157,9 +165,8 @@</span>
  #if ENABLE(SIGNAL_BASED_VM_TRAPS)
      RefPtr&lt;SignalSender&gt; m_signalSender;
  #endif
  
      friend class LLIntOffsetsExtractor;
<span class="udiff-line-removed">-     friend class SignalSender;</span>
  };
  
  } // namespace JSC
</pre>
<center><a href="VMTraps.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="VarOffset.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>