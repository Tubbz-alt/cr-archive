<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/mediastream/libwebrtc/LibWebRTCProvider.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="LibWebRTCDTMFSenderBackend.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="LibWebRTCProvider.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/mediastream/libwebrtc/LibWebRTCProvider.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 32,20 ***</span>
  #include &quot;RTCRtpCapabilities.h&quot;
  #include &lt;dlfcn.h&gt;
  
  ALLOW_UNUSED_PARAMETERS_BEGIN
  
<span class="line-modified">! #include &lt;webrtc/api/asyncresolverfactory.h&gt;</span>
  #include &lt;webrtc/api/audio_codecs/builtin_audio_decoder_factory.h&gt;
  #include &lt;webrtc/api/audio_codecs/builtin_audio_encoder_factory.h&gt;
  #include &lt;webrtc/api/create_peerconnection_factory.h&gt;
<span class="line-modified">! #include &lt;webrtc/api/peerconnectionfactoryproxy.h&gt;</span>
  #include &lt;webrtc/modules/audio_processing/include/audio_processing.h&gt;
<span class="line-modified">! #include &lt;webrtc/p2p/base/basicpacketsocketfactory.h&gt;</span>
<span class="line-modified">! #include &lt;webrtc/p2p/client/basicportallocator.h&gt;</span>
<span class="line-modified">! #include &lt;webrtc/pc/peerconnectionfactory.h&gt;</span>
<span class="line-modified">! #include &lt;webrtc/rtc_base/physicalsocketserver.h&gt;</span>
  
  ALLOW_UNUSED_PARAMETERS_END
  
  #include &lt;wtf/Function.h&gt;
  #include &lt;wtf/NeverDestroyed.h&gt;
<span class="line-new-header">--- 32,20 ---</span>
  #include &quot;RTCRtpCapabilities.h&quot;
  #include &lt;dlfcn.h&gt;
  
  ALLOW_UNUSED_PARAMETERS_BEGIN
  
<span class="line-modified">! #include &lt;webrtc/api/async_resolver_factory.h&gt;</span>
  #include &lt;webrtc/api/audio_codecs/builtin_audio_decoder_factory.h&gt;
  #include &lt;webrtc/api/audio_codecs/builtin_audio_encoder_factory.h&gt;
  #include &lt;webrtc/api/create_peerconnection_factory.h&gt;
<span class="line-modified">! #include &lt;webrtc/api/peer_connection_factory_proxy.h&gt;</span>
  #include &lt;webrtc/modules/audio_processing/include/audio_processing.h&gt;
<span class="line-modified">! #include &lt;webrtc/p2p/base/basic_packet_socket_factory.h&gt;</span>
<span class="line-modified">! #include &lt;webrtc/p2p/client/basic_port_allocator.h&gt;</span>
<span class="line-modified">! #include &lt;webrtc/pc/peer_connection_factory.h&gt;</span>
<span class="line-modified">! #include &lt;webrtc/rtc_base/physical_socket_server.h&gt;</span>
  
  ALLOW_UNUSED_PARAMETERS_END
  
  #include &lt;wtf/Function.h&gt;
  #include &lt;wtf/NeverDestroyed.h&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 96,11 ***</span>
      rtc::AsyncPacketSocket* CreateServerTcpSocket(const rtc::SocketAddress&amp; address, uint16_t minPort, uint16_t maxPort, int options) final
      {
          return m_socketFactory-&gt;CreateServerTcpSocket(prepareSocketAddress(address, m_disableNonLocalhostConnections), minPort, maxPort, options);
      }
  
<span class="line-modified">!     rtc::AsyncPacketSocket* CreateClientTcpSocket(const rtc::SocketAddress&amp; localAddress, const rtc::SocketAddress&amp; remoteAddress, const rtc::ProxyInfo&amp; info, const std::string&amp; name, int options)</span>
      {
          return m_socketFactory-&gt;CreateClientTcpSocket(prepareSocketAddress(localAddress, m_disableNonLocalhostConnections), remoteAddress, info, name, options);
      }
  
  private:
<span class="line-new-header">--- 96,11 ---</span>
      rtc::AsyncPacketSocket* CreateServerTcpSocket(const rtc::SocketAddress&amp; address, uint16_t minPort, uint16_t maxPort, int options) final
      {
          return m_socketFactory-&gt;CreateServerTcpSocket(prepareSocketAddress(address, m_disableNonLocalhostConnections), minPort, maxPort, options);
      }
  
<span class="line-modified">!     rtc::AsyncPacketSocket* CreateClientTcpSocket(const rtc::SocketAddress&amp; localAddress, const rtc::SocketAddress&amp; remoteAddress, const rtc::ProxyInfo&amp; info, const std::string&amp; name, const rtc::PacketSocketTcpOptions&amp; options)</span>
      {
          return m_socketFactory-&gt;CreateClientTcpSocket(prepareSocketAddress(localAddress, m_disableNonLocalhostConnections), remoteAddress, info, name, options);
      }
  
  private:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 215,10 ***</span>
<span class="line-new-header">--- 215,15 ---</span>
      auto* data = static_cast&lt;ThreadMessageData*&gt;(message-&gt;pdata);
      data-&gt;callback();
      delete data;
  }
  
<span class="line-added">+ bool LibWebRTCProvider::hasWebRTCThreads()</span>
<span class="line-added">+ {</span>
<span class="line-added">+     return !!staticFactoryAndThreads().networkThread;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  void LibWebRTCProvider::callOnWebRTCNetworkThread(Function&lt;void()&gt;&amp;&amp; callback)
  {
      PeerConnectionFactoryAndThreads&amp; threads = staticFactoryAndThreads();
      threads.networkThread-&gt;Post(RTC_FROM_HERE, &amp;threads, 1, new ThreadMessageData(WTFMove(callback)));
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 304,13 ***</span>
<span class="line-new-header">--- 309,36 ---</span>
      if (!factory)
          return;
  
      webrtc::PeerConnectionFactoryInterface::Options options;
      options.disable_encryption = !enableWebRTCEncryption;
<span class="line-added">+     options.ssl_max_version = m_useDTLS10 ? rtc::SSL_PROTOCOL_DTLS_10 : rtc::SSL_PROTOCOL_DTLS_12;</span>
<span class="line-added">+     m_factory-&gt;SetOptions(options);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ void LibWebRTCProvider::setUseDTLS10(bool useDTLS10)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     m_useDTLS10 = useDTLS10;</span>
<span class="line-added">+ </span>
<span class="line-added">+     auto* factory = this-&gt;factory();</span>
<span class="line-added">+     if (!factory)</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
<span class="line-added">+     webrtc::PeerConnectionFactoryInterface::Options options;</span>
<span class="line-added">+     options.ssl_max_version = useDTLS10 ? rtc::SSL_PROTOCOL_DTLS_10 : rtc::SSL_PROTOCOL_DTLS_12;</span>
      m_factory-&gt;SetOptions(options);
  }
  
<span class="line-added">+ void LibWebRTCProvider::setUseGPUProcess(bool value)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (m_useGPUProcess == value)</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
<span class="line-added">+     m_useGPUProcess = value;</span>
<span class="line-added">+     m_factory = nullptr;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  rtc::scoped_refptr&lt;webrtc::PeerConnectionInterface&gt; LibWebRTCProvider::createPeerConnection(webrtc::PeerConnectionObserver&amp; observer, rtc::NetworkManager&amp; networkManager, rtc::PacketSocketFactory&amp; packetSocketFactory, webrtc::PeerConnectionInterface::RTCConfiguration&amp;&amp; configuration, std::unique_ptr&lt;webrtc::AsyncResolverFactory&gt;&amp;&amp; asyncResolveFactory)
  {
      auto&amp; factoryAndThreads = getStaticFactoryAndThreads(m_useNetworkThreadWithSocketServer);
  
      std::unique_ptr&lt;cricket::BasicPortAllocator&gt; portAllocator;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 366,11 ***</span>
  {
      RTCRtpCapabilities capabilities;
  
      capabilities.codecs.reserveInitialCapacity(rtpCapabilities.codecs.size());
      for (auto&amp; codec : rtpCapabilities.codecs)
<span class="line-modified">!         capabilities.codecs.uncheckedAppend(RTCRtpCapabilities::CodecCapability { fromStdString(codec.mime_type()), static_cast&lt;uint32_t&gt;(codec.clock_rate ? *codec.clock_rate : 0), toChannels(codec.num_channels), { } });</span>
  
      capabilities.headerExtensions.reserveInitialCapacity(rtpCapabilities.header_extensions.size());
      for (auto&amp; header : rtpCapabilities.header_extensions)
          capabilities.headerExtensions.uncheckedAppend(RTCRtpCapabilities::HeaderExtensionCapability { fromStdString(header.uri) });
  
<span class="line-new-header">--- 394,11 ---</span>
  {
      RTCRtpCapabilities capabilities;
  
      capabilities.codecs.reserveInitialCapacity(rtpCapabilities.codecs.size());
      for (auto&amp; codec : rtpCapabilities.codecs)
<span class="line-modified">!         capabilities.codecs.uncheckedAppend(RTCRtpCodecCapability { fromStdString(codec.mime_type()), static_cast&lt;uint32_t&gt;(codec.clock_rate ? *codec.clock_rate : 0), toChannels(codec.num_channels), { } });</span>
  
      capabilities.headerExtensions.reserveInitialCapacity(rtpCapabilities.header_extensions.size());
      for (auto&amp; header : rtpCapabilities.header_extensions)
          capabilities.headerExtensions.uncheckedAppend(RTCRtpCapabilities::HeaderExtensionCapability { fromStdString(header.uri) });
  
</pre>
<center><a href="LibWebRTCDTMFSenderBackend.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="LibWebRTCProvider.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>