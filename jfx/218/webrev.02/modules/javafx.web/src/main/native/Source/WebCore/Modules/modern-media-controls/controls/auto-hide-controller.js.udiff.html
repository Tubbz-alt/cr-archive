<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/Modules/modern-media-controls/controls/auto-hide-controller.js</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../mediastream/libwebrtc/LibWebRTCUtils.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="slider.js.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/modern-media-controls/controls/auto-hide-controller.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -30,14 +30,15 @@</span>
  
      constructor(mediaControls)
      {
          this._mediaControls = mediaControls;
  
<span class="udiff-line-modified-removed">-         if (GestureRecognizer.SupportsTouches) {</span>
<span class="udiff-line-modified-removed">-             this._touchIdentifiersPreventingAutoHide = new Set;</span>
<span class="udiff-line-modified-added">+         this._pointerIdentifiersPreventingAutoHide = new Set;</span>
<span class="udiff-line-modified-added">+         this._pointerIdentifiersPreventingAutoHideForHover = new Set;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (GestureRecognizer.SupportsTouches)</span>
              this._tapGestureRecognizer = new TapGestureRecognizer(this._mediaControls.element, this);
<span class="udiff-line-removed">-         }</span>
  
          this.autoHideDelay = AutoHideDelayMS;
      }
  
      // Public
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -52,27 +53,22 @@</span>
          if (this._fadesWhileIdle == flag)
              return;
  
          this._fadesWhileIdle = flag;
  
<span class="udiff-line-modified-removed">-         if (GestureRecognizer.SupportsTouches) {</span>
<span class="udiff-line-modified-removed">-             if (flag) {</span>
<span class="udiff-line-modified-removed">-                 this._mediaControls.element.addEventListener(&quot;touchstart&quot;, this);</span>
<span class="udiff-line-modified-removed">-                 this._mediaControls.element.addEventListener(&quot;touchend&quot;, this);</span>
<span class="udiff-line-modified-removed">-             } else {</span>
<span class="udiff-line-modified-removed">-                 this._mediaControls.element.removeEventListener(&quot;touchstart&quot;, this);</span>
<span class="udiff-line-removed">-                 this._mediaControls.element.removeEventListener(&quot;touchend&quot;, this);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             this._tapGestureRecognizer.enabled = flag;</span>
<span class="udiff-line-modified-added">+         if (flag) {</span>
<span class="udiff-line-modified-added">+             this._mediaControls.element.addEventListener(&quot;pointermove&quot;, this);</span>
<span class="udiff-line-modified-added">+             this._mediaControls.element.addEventListener(&quot;pointerdown&quot;, this);</span>
<span class="udiff-line-modified-added">+             this._mediaControls.element.addEventListener(&quot;pointerup&quot;, this);</span>
<span class="udiff-line-modified-added">+             this._mediaControls.element.addEventListener(&quot;pointerleave&quot;, this);</span>
<span class="udiff-line-modified-added">+             this._mediaControls.element.addEventListener(&quot;pointerout&quot;, this);</span>
          } else {
<span class="udiff-line-modified-removed">-             if (flag) {</span>
<span class="udiff-line-modified-removed">-                 this._mediaControls.element.addEventListener(&quot;mousemove&quot;, this);</span>
<span class="udiff-line-modified-removed">-                 this._mediaControls.element.addEventListener(&quot;mouseleave&quot;, this);</span>
<span class="udiff-line-modified-removed">-             } else {</span>
<span class="udiff-line-modified-removed">-                 this._mediaControls.element.removeEventListener(&quot;mousemove&quot;, this);</span>
<span class="udiff-line-removed">-                 this._mediaControls.element.removeEventListener(&quot;mouseleave&quot;, this);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+             this._mediaControls.element.removeEventListener(&quot;pointermove&quot;, this);</span>
<span class="udiff-line-modified-added">+             this._mediaControls.element.removeEventListener(&quot;pointerdown&quot;, this);</span>
<span class="udiff-line-modified-added">+             this._mediaControls.element.removeEventListener(&quot;pointerup&quot;, this);</span>
<span class="udiff-line-modified-added">+             this._mediaControls.element.removeEventListener(&quot;pointerleave&quot;, this);</span>
<span class="udiff-line-modified-added">+             this._mediaControls.element.removeEventListener(&quot;pointerout&quot;, this);</span>
          }
  
          if (flag &amp;&amp; !this._mediaControls.faded)
              this._resetAutoHideTimer(false);
          else if (!flag)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -84,39 +80,42 @@</span>
      handleEvent(event)
      {
          if (event.currentTarget !== this._mediaControls.element)
              return;
  
<span class="udiff-line-modified-removed">-         if (event.type === &quot;mousemove&quot;) {</span>
<span class="udiff-line-modified-added">+         if (event.type === &quot;pointermove&quot;) {</span>
              this._mediaControls.faded = false;
              this._resetAutoHideTimer(true);
              if (this._mediaControls.isPointInControls(new DOMPoint(event.clientX, event.clientY))) {
<span class="udiff-line-modified-removed">-                 this._disableAutoHiding = true;</span>
<span class="udiff-line-modified-added">+                 this._pointerIdentifiersPreventingAutoHideForHover.add(event.pointerId);</span>
                  this._cancelNonEnforcedAutoHideTimer();
              } else {
<span class="udiff-line-modified-removed">-                 delete this._disableAutoHiding;</span>
<span class="udiff-line-modified-added">+                 this._pointerIdentifiersPreventingAutoHideForHover.delete(event.pointerId);</span>
                  this._resetAutoHideTimer(true);
              }
<span class="udiff-line-modified-removed">-         } else if (event.type === &quot;mouseleave&quot; &amp;&amp; this._fadesWhileIdle &amp;&amp; !this.hasSecondaryUIAttached &amp;&amp; !this._enforceAutoHideTimer)</span>
<span class="udiff-line-modified-removed">-             this._mediaControls.faded = !this._mediaControls.isPointInControls(new DOMPoint(event.clientX, event.clientY));</span>
<span class="udiff-line-modified-added">+         } else if (event.type === &quot;pointerleave&quot; &amp;&amp; this._fadesWhileIdle &amp;&amp; !this.hasSecondaryUIAttached &amp;&amp; !this._enforceAutoHideTimer) {</span>
<span class="udiff-line-modified-added">+             this._pointerIdentifiersPreventingAutoHide.delete(event.pointerId);</span>
<span class="udiff-line-added">+             this._pointerIdentifiersPreventingAutoHideForHover.delete(event.pointerId);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // If the pointer is a mouse (supports hover), see if we can</span>
<span class="udiff-line-added">+             // immediately hide without waiting for the auto-hide timer.</span>
<span class="udiff-line-added">+             if (event.pointerType == &quot;mouse&quot;)</span>
<span class="udiff-line-added">+                 this._autoHideTimerFired();</span>
  
<span class="udiff-line-modified-removed">-         if (event.type === &quot;touchstart&quot;) {</span>
<span class="udiff-line-modified-added">+             this._resetAutoHideTimer(true);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (event.type === &quot;pointerdown&quot;) {</span>
              // Remember the current faded state so that we can determine,
              // if we recognize a tap, if it should fade the controls out.
              this._nextTapCanFadeControls = !this._mediaControls.faded;
<span class="udiff-line-modified-removed">-             for (var touch in event.changedTouches)</span>
<span class="udiff-line-removed">-                 this._touchIdentifiersPreventingAutoHide.add(touch.identifier);</span>
<span class="udiff-line-modified-added">+             this._pointerIdentifiersPreventingAutoHide.add(event.pointerId);</span>
              this._mediaControls.faded = false;
<span class="udiff-line-removed">-             this._disableAutoHiding = true;</span>
              this._cancelNonEnforcedAutoHideTimer();
<span class="udiff-line-modified-removed">-         } else if (event.type === &quot;touchend&quot;) {</span>
<span class="udiff-line-modified-removed">-             for (var touch in event.changedTouches)</span>
<span class="udiff-line-modified-removed">-                 this._touchIdentifiersPreventingAutoHide.delete(touch.identifier);</span>
<span class="udiff-line-removed">-             if (!this._touchIdentifiersPreventingAutoHide.size) {</span>
<span class="udiff-line-removed">-                 delete this._disableAutoHiding;</span>
<span class="udiff-line-removed">-                 this._resetAutoHideTimer(true);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+         } else if (event.type === &quot;pointerup&quot;) {</span>
<span class="udiff-line-modified-added">+             this._pointerIdentifiersPreventingAutoHide.delete(event.pointerId);</span>
<span class="udiff-line-modified-added">+             this._resetAutoHideTimer(true);</span>
          }
      }
  
      gestureRecognizerStateDidChange(recognizer)
      {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -169,12 +168,14 @@</span>
          this._autoHideTimer = window.setTimeout(this._autoHideTimerFired.bind(this), this.autoHideDelay);
      }
  
      _autoHideTimerFired()
      {
<span class="udiff-line-added">+         const disableAutoHiding = this._pointerIdentifiersPreventingAutoHide.size || this._pointerIdentifiersPreventingAutoHideForHover.size;</span>
<span class="udiff-line-added">+ </span>
          delete this._enforceAutoHideTimer;
<span class="udiff-line-modified-removed">-         if (this._disableAutoHiding)</span>
<span class="udiff-line-modified-added">+         if (disableAutoHiding)</span>
              return;
  
          this._cancelAutoHideTimer();
          this._mediaControls.faded = this._fadesWhileIdle &amp;&amp; !this.hasSecondaryUIAttached;
      }
</pre>
<center><a href="../../mediastream/libwebrtc/LibWebRTCUtils.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="slider.js.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>