<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/IteratorOperations.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2015 Yusuke Suzuki &lt;utatane.tea@gmail.com&gt;.
  3  * Copyright (C) 2016 Apple Inc. All Rights Reserved.
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  * 1. Redistributions of source code must retain the above copyright
  9  *    notice, this list of conditions and the following disclaimer.
 10  * 2. Redistributions in binary form must reproduce the above copyright
 11  *    notice, this list of conditions and the following disclaimer in the
 12  *    documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 15  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 16  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 18  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 19  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 20  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 21  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 22  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 24  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 25  */
 26 
 27 #pragma once
 28 
 29 #include &quot;JSCJSValue.h&quot;
 30 #include &quot;JSObject.h&quot;
 31 #include &quot;ThrowScope.h&quot;
 32 
 33 namespace JSC {
 34 
 35 struct IterationRecord {
 36     JSValue iterator;
 37     JSValue nextMethod;
 38 };
 39 
<a name="1" id="anc1"></a><span class="line-modified"> 40 JSValue iteratorNext(ExecState*, IterationRecord, JSValue argument = JSValue());</span>
<span class="line-modified"> 41 JS_EXPORT_PRIVATE JSValue iteratorValue(ExecState*, JSValue iterResult);</span>
<span class="line-modified"> 42 bool iteratorComplete(ExecState*, JSValue iterResult);</span>
<span class="line-modified"> 43 JS_EXPORT_PRIVATE JSValue iteratorStep(ExecState*, IterationRecord);</span>
<span class="line-modified"> 44 JS_EXPORT_PRIVATE void iteratorClose(ExecState*, IterationRecord);</span>
<span class="line-modified"> 45 JS_EXPORT_PRIVATE JSObject* createIteratorResultObject(ExecState*, JSValue, bool done);</span>
 46 
 47 Structure* createIteratorResultObjectStructure(VM&amp;, JSGlobalObject&amp;);
 48 
<a name="2" id="anc2"></a><span class="line-modified"> 49 JS_EXPORT_PRIVATE JSValue iteratorMethod(ExecState&amp;, JSObject*);</span>
<span class="line-modified"> 50 JS_EXPORT_PRIVATE IterationRecord iteratorForIterable(ExecState&amp;, JSObject*, JSValue iteratorMethod);</span>
<span class="line-modified"> 51 JS_EXPORT_PRIVATE IterationRecord iteratorForIterable(ExecState*, JSValue iterable);</span>
 52 
<a name="3" id="anc3"></a><span class="line-modified"> 53 JS_EXPORT_PRIVATE JSValue iteratorMethod(ExecState&amp;, JSObject*);</span>
<span class="line-modified"> 54 JS_EXPORT_PRIVATE bool hasIteratorMethod(ExecState&amp;, JSValue);</span>
 55 
 56 template&lt;typename CallBackType&gt;
<a name="4" id="anc4"></a><span class="line-modified"> 57 void forEachInIterable(ExecState* exec, JSValue iterable, const CallBackType&amp; callback)</span>
 58 {
<a name="5" id="anc5"></a><span class="line-modified"> 59     auto&amp; vm = exec-&gt;vm();</span>
 60     auto scope = DECLARE_THROW_SCOPE(vm);
 61 
<a name="6" id="anc6"></a><span class="line-modified"> 62     IterationRecord iterationRecord = iteratorForIterable(exec, iterable);</span>
 63     RETURN_IF_EXCEPTION(scope, void());
 64     while (true) {
<a name="7" id="anc7"></a><span class="line-modified"> 65         JSValue next = iteratorStep(exec, iterationRecord);</span>
 66         if (UNLIKELY(scope.exception()) || next.isFalse())
 67             return;
 68 
<a name="8" id="anc8"></a><span class="line-modified"> 69         JSValue nextValue = iteratorValue(exec, next);</span>
 70         RETURN_IF_EXCEPTION(scope, void());
 71 
<a name="9" id="anc9"></a><span class="line-modified"> 72         callback(vm, exec, nextValue);</span>
 73         if (UNLIKELY(scope.exception())) {
 74             scope.release();
<a name="10" id="anc10"></a><span class="line-modified"> 75             iteratorClose(exec, iterationRecord);</span>
 76             return;
 77         }
 78     }
 79 }
 80 
 81 template&lt;typename CallBackType&gt;
<a name="11" id="anc11"></a><span class="line-modified"> 82 void forEachInIterable(ExecState&amp; state, JSObject* iterable, JSValue iteratorMethod, const CallBackType&amp; callback)</span>
 83 {
<a name="12" id="anc12"></a><span class="line-modified"> 84     auto&amp; vm = state.vm();</span>
 85     auto scope = DECLARE_THROW_SCOPE(vm);
 86 
<a name="13" id="anc13"></a><span class="line-modified"> 87     auto iterationRecord = iteratorForIterable(state, iterable, iteratorMethod);</span>
 88     RETURN_IF_EXCEPTION(scope, void());
 89     while (true) {
<a name="14" id="anc14"></a><span class="line-modified"> 90         JSValue next = iteratorStep(&amp;state, iterationRecord);</span>
 91         if (UNLIKELY(scope.exception()) || next.isFalse())
 92             return;
 93 
<a name="15" id="anc15"></a><span class="line-modified"> 94         JSValue nextValue = iteratorValue(&amp;state, next);</span>
 95         RETURN_IF_EXCEPTION(scope, void());
 96 
<a name="16" id="anc16"></a><span class="line-modified"> 97         callback(vm, state, nextValue);</span>
 98         if (UNLIKELY(scope.exception())) {
 99             scope.release();
<a name="17" id="anc17"></a><span class="line-modified">100             iteratorClose(&amp;state, iterationRecord);</span>
101             return;
102         }
103     }
104 }
105 
106 } // namespace JSC
<a name="18" id="anc18"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="18" type="hidden" />
</body>
</html>