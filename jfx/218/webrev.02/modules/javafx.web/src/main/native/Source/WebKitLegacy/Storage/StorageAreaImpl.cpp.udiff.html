<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebKitLegacy/Storage/StorageAreaImpl.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../PlatformJava.cmake.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StorageAreaImpl.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebKitLegacy/Storage/StorageAreaImpl.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -48,13 +48,10 @@</span>
  inline StorageAreaImpl::StorageAreaImpl(StorageType storageType, const SecurityOriginData&amp; origin, RefPtr&lt;StorageSyncManager&gt;&amp;&amp; syncManager, unsigned quota)
      : m_storageType(storageType)
      , m_securityOrigin(origin)
      , m_storageMap(StorageMap::create(quota))
      , m_storageSyncManager(WTFMove(syncManager))
<span class="udiff-line-removed">- #ifndef NDEBUG</span>
<span class="udiff-line-removed">-     , m_isShutdown(false)</span>
<span class="udiff-line-removed">- #endif</span>
      , m_accessCount(0)
      , m_closeDatabaseTimer(*this, &amp;StorageAreaImpl::closeDatabaseTimerFired)
  {
      ASSERT(isMainThread());
      ASSERT(m_storageMap);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -85,11 +82,11 @@</span>
  StorageAreaImpl::StorageAreaImpl(const StorageAreaImpl&amp; area)
      : m_storageType(area.m_storageType)
      , m_securityOrigin(area.m_securityOrigin)
      , m_storageMap(area.m_storageMap)
      , m_storageSyncManager(area.m_storageSyncManager)
<span class="udiff-line-modified-removed">- #ifndef NDEBUG</span>
<span class="udiff-line-modified-added">+ #if ASSERT_ENABLED</span>
      , m_isShutdown(area.m_isShutdown)
  #endif
      , m_accessCount(0)
      , m_closeDatabaseTimer(*this, &amp;StorageAreaImpl::closeDatabaseTimerFired)
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -195,20 +192,21 @@</span>
  }
  
  void StorageAreaImpl::importItems(HashMap&lt;String, String&gt;&amp;&amp; items)
  {
      ASSERT(!m_isShutdown);
<span class="udiff-line-added">+     ASSERT(!isMainThread());</span>
  
      m_storageMap-&gt;importItems(WTFMove(items));
  }
  
  void StorageAreaImpl::close()
  {
      if (m_storageAreaSync)
          m_storageAreaSync-&gt;scheduleFinalSync();
  
<span class="udiff-line-modified-removed">- #ifndef NDEBUG</span>
<span class="udiff-line-modified-added">+ #if ASSERT_ENABLED</span>
      m_isShutdown = true;
  #endif
  }
  
  void StorageAreaImpl::clearForOriginDeletion()
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -294,10 +292,13 @@</span>
  
  void StorageAreaImpl::sessionChanged(bool isNewSessionPersistent)
  {
      ASSERT(isMainThread());
  
<span class="udiff-line-added">+     // If import is not completed, background storage thread may be modifying m_storageMap.</span>
<span class="udiff-line-added">+     blockUntilImportComplete();</span>
<span class="udiff-line-added">+ </span>
      unsigned quota = m_storageMap-&gt;quota();
      m_storageMap = StorageMap::create(quota);
  
      if (isNewSessionPersistent &amp;&amp; !m_storageAreaSync &amp;&amp; m_storageSyncManager) {
          m_storageAreaSync = StorageAreaSync::create(m_storageSyncManager.get(), *this, m_securityOrigin.databaseIdentifier());
</pre>
<center><a href="../PlatformJava.cmake.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StorageAreaImpl.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>