<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/StringRecursionChecker.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="StringRecursionChecker.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Structure.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/StringRecursionChecker.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 18,39 ***</span>
   */
  
  #pragma once
  
  #include &quot;CallFrame.h&quot;
  #include &quot;VMInlines.h&quot;
  #include &lt;wtf/StackStats.h&gt;
  
  namespace JSC {
  
  class StringRecursionChecker {
      WTF_MAKE_NONCOPYABLE(StringRecursionChecker);
  
  public:
<span class="line-modified">!     StringRecursionChecker(ExecState*, JSObject* thisObject);</span>
      ~StringRecursionChecker();
  
      JSValue earlyReturnValue() const; // 0 if everything is OK, value to return for failure cases
  
  private:
      JSValue throwStackOverflowError();
      JSValue emptyString();
      JSValue performCheck();
  
<span class="line-modified">!     ExecState* m_exec;</span>
      JSObject* m_thisObject;
      JSValue m_earlyReturnValue;
  
      StackStats::CheckPoint stackCheckpoint;
  };
  
  inline JSValue StringRecursionChecker::performCheck()
  {
<span class="line-modified">!     VM&amp; vm = m_exec-&gt;vm();</span>
      if (UNLIKELY(!vm.isSafeToRecurseSoft()))
          return throwStackOverflowError();
  
      bool alreadyVisited = false;
      if (!vm.stringRecursionCheckFirstObject)
<span class="line-new-header">--- 18,40 ---</span>
   */
  
  #pragma once
  
  #include &quot;CallFrame.h&quot;
<span class="line-added">+ #include &quot;GetVM.h&quot;</span>
  #include &quot;VMInlines.h&quot;
  #include &lt;wtf/StackStats.h&gt;
  
  namespace JSC {
  
  class StringRecursionChecker {
      WTF_MAKE_NONCOPYABLE(StringRecursionChecker);
  
  public:
<span class="line-modified">!     StringRecursionChecker(JSGlobalObject*, JSObject* thisObject);</span>
      ~StringRecursionChecker();
  
      JSValue earlyReturnValue() const; // 0 if everything is OK, value to return for failure cases
  
  private:
      JSValue throwStackOverflowError();
      JSValue emptyString();
      JSValue performCheck();
  
<span class="line-modified">!     JSGlobalObject* m_globalObject;</span>
      JSObject* m_thisObject;
      JSValue m_earlyReturnValue;
  
      StackStats::CheckPoint stackCheckpoint;
  };
  
  inline JSValue StringRecursionChecker::performCheck()
  {
<span class="line-modified">!     VM&amp; vm = getVM(m_globalObject);</span>
      if (UNLIKELY(!vm.isSafeToRecurseSoft()))
          return throwStackOverflowError();
  
      bool alreadyVisited = false;
      if (!vm.stringRecursionCheckFirstObject)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 63,12 ***</span>
      if (alreadyVisited)
          return emptyString(); // Return empty string to avoid infinite recursion.
      return JSValue(); // Indicate success.
  }
  
<span class="line-modified">! inline StringRecursionChecker::StringRecursionChecker(ExecState* exec, JSObject* thisObject)</span>
<span class="line-modified">!     : m_exec(exec)</span>
      , m_thisObject(thisObject)
      , m_earlyReturnValue(performCheck())
  {
  }
  
<span class="line-new-header">--- 64,12 ---</span>
      if (alreadyVisited)
          return emptyString(); // Return empty string to avoid infinite recursion.
      return JSValue(); // Indicate success.
  }
  
<span class="line-modified">! inline StringRecursionChecker::StringRecursionChecker(JSGlobalObject* globalObject, JSObject* thisObject)</span>
<span class="line-modified">!     : m_globalObject(globalObject)</span>
      , m_thisObject(thisObject)
      , m_earlyReturnValue(performCheck())
  {
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 80,11 ***</span>
  inline StringRecursionChecker::~StringRecursionChecker()
  {
      if (m_earlyReturnValue)
          return;
  
<span class="line-modified">!     VM&amp; vm = m_exec-&gt;vm();</span>
      if (vm.stringRecursionCheckFirstObject == m_thisObject)
          vm.stringRecursionCheckFirstObject = nullptr;
      else {
          ASSERT(vm.stringRecursionCheckVisitedObjects.contains(m_thisObject));
          vm.stringRecursionCheckVisitedObjects.remove(m_thisObject);
<span class="line-new-header">--- 81,11 ---</span>
  inline StringRecursionChecker::~StringRecursionChecker()
  {
      if (m_earlyReturnValue)
          return;
  
<span class="line-modified">!     VM&amp; vm = getVM(m_globalObject);</span>
      if (vm.stringRecursionCheckFirstObject == m_thisObject)
          vm.stringRecursionCheckFirstObject = nullptr;
      else {
          ASSERT(vm.stringRecursionCheckVisitedObjects.contains(m_thisObject));
          vm.stringRecursionCheckVisitedObjects.remove(m_thisObject);
</pre>
<center><a href="StringRecursionChecker.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Structure.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>