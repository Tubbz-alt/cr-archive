<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSCJSValue.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSCInlines.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSCJSValue.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSCJSValue.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 37,42 ***</span>
  #include &lt;wtf/MathExtras.h&gt;
  
  namespace JSC {
  
  // ECMA 9.4
<span class="line-modified">! double JSValue::toInteger(ExecState* exec) const</span>
  {
      if (isInt32())
          return asInt32();
<span class="line-modified">!     double d = toNumber(exec);</span>
      return std::isnan(d) ? 0.0 : trunc(d);
  }
  
<span class="line-modified">! double JSValue::toIntegerPreserveNaN(ExecState* exec) const</span>
  {
      if (isInt32())
          return asInt32();
<span class="line-modified">!     return trunc(toNumber(exec));</span>
  }
  
<span class="line-modified">! double JSValue::toLength(ExecState* exec) const</span>
  {
      // ECMA 7.1.15
      // http://www.ecma-international.org/ecma-262/6.0/#sec-tolength
<span class="line-modified">!     double d = toInteger(exec);</span>
      if (d &lt;= 0)
          return 0.0;
      if (std::isinf(d))
          return maxSafeInteger();
      return std::min(d, maxSafeInteger());
  }
  
<span class="line-modified">! double JSValue::toNumberSlowCase(ExecState* exec) const</span>
  {
      ASSERT(!isInt32() &amp;&amp; !isDouble());
      if (isCell())
<span class="line-modified">!         return asCell()-&gt;toNumber(exec);</span>
      if (isTrue())
          return 1.0;
      return isUndefined() ? PNaN : 0; // null and false both convert to 0.
  }
  
<span class="line-new-header">--- 37,42 ---</span>
  #include &lt;wtf/MathExtras.h&gt;
  
  namespace JSC {
  
  // ECMA 9.4
<span class="line-modified">! double JSValue::toInteger(JSGlobalObject* globalObject) const</span>
  {
      if (isInt32())
          return asInt32();
<span class="line-modified">!     double d = toNumber(globalObject);</span>
      return std::isnan(d) ? 0.0 : trunc(d);
  }
  
<span class="line-modified">! double JSValue::toIntegerPreserveNaN(JSGlobalObject* globalObject) const</span>
  {
      if (isInt32())
          return asInt32();
<span class="line-modified">!     return trunc(toNumber(globalObject));</span>
  }
  
<span class="line-modified">! double JSValue::toLength(JSGlobalObject* globalObject) const</span>
  {
      // ECMA 7.1.15
      // http://www.ecma-international.org/ecma-262/6.0/#sec-tolength
<span class="line-modified">!     double d = toInteger(globalObject);</span>
      if (d &lt;= 0)
          return 0.0;
      if (std::isinf(d))
          return maxSafeInteger();
      return std::min(d, maxSafeInteger());
  }
  
<span class="line-modified">! double JSValue::toNumberSlowCase(JSGlobalObject* globalObject) const</span>
  {
      ASSERT(!isInt32() &amp;&amp; !isDouble());
      if (isCell())
<span class="line-modified">!         return asCell()-&gt;toNumber(globalObject);</span>
      if (isTrue())
          return 1.0;
      return isUndefined() ? PNaN : 0; // null and false both convert to 0.
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 89,148 ***</span>
      if (isNull())
          return 0;
      return WTF::nullopt;
  }
  
<span class="line-modified">! JSObject* JSValue::toObjectSlowCase(ExecState* exec, JSGlobalObject* globalObject) const</span>
  {
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      ASSERT(!isCell());
  
      if (isInt32() || isDouble())
<span class="line-modified">!         return constructNumber(exec, globalObject, asValue());</span>
      if (isTrue() || isFalse())
<span class="line-modified">!         return constructBooleanFromImmediateBoolean(exec, globalObject, asValue());</span>
  
      ASSERT(isUndefinedOrNull());
<span class="line-modified">!     throwException(exec, scope, createNotAnObjectError(exec, *this));</span>
      return nullptr;
  }
  
<span class="line-modified">! JSValue JSValue::toThisSlowCase(ExecState* exec, ECMAMode ecmaMode) const</span>
  {
      ASSERT(!isCell());
  
      if (ecmaMode == StrictMode)
          return *this;
  
      if (isInt32() || isDouble())
<span class="line-modified">!         return constructNumber(exec, exec-&gt;lexicalGlobalObject(), asValue());</span>
      if (isTrue() || isFalse())
<span class="line-modified">!         return constructBooleanFromImmediateBoolean(exec, exec-&gt;lexicalGlobalObject(), asValue());</span>
      ASSERT(isUndefinedOrNull());
<span class="line-modified">!     return exec-&gt;globalThisValue();</span>
  }
  
<span class="line-modified">! JSObject* JSValue::synthesizePrototype(ExecState* exec) const</span>
  {
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      if (isCell()) {
          if (isString())
<span class="line-modified">!             return exec-&gt;lexicalGlobalObject()-&gt;stringPrototype();</span>
          if (isBigInt())
<span class="line-modified">!             return exec-&gt;lexicalGlobalObject()-&gt;bigIntPrototype();</span>
          ASSERT(isSymbol());
<span class="line-modified">!         return exec-&gt;lexicalGlobalObject()-&gt;symbolPrototype();</span>
      }
  
      if (isNumber())
<span class="line-modified">!         return exec-&gt;lexicalGlobalObject()-&gt;numberPrototype();</span>
      if (isBoolean())
<span class="line-modified">!         return exec-&gt;lexicalGlobalObject()-&gt;booleanPrototype();</span>
  
      ASSERT(isUndefinedOrNull());
<span class="line-modified">!     throwException(exec, scope, createNotAnObjectError(exec, *this));</span>
      return nullptr;
  }
  
  // ECMA 8.7.2
<span class="line-modified">! bool JSValue::putToPrimitive(ExecState* exec, PropertyName propertyName, JSValue value, PutPropertySlot&amp; slot)</span>
  {
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      if (Optional&lt;uint32_t&gt; index = parseIndex(propertyName))
<span class="line-modified">!         RELEASE_AND_RETURN(scope, putToPrimitiveByIndex(exec, index.value(), value, slot.isStrictMode()));</span>
  
      // Check if there are any setters or getters in the prototype chain
<span class="line-modified">!     JSObject* obj = synthesizePrototype(exec);</span>
      EXCEPTION_ASSERT(!!scope.exception() == !obj);
      if (UNLIKELY(!obj))
          return false;
      JSValue prototype;
      if (propertyName != vm.propertyNames-&gt;underscoreProto) {
          while (true) {
              Structure* structure = obj-&gt;structure(vm);
              if (structure-&gt;hasReadOnlyOrGetterSetterPropertiesExcludingProto() || structure-&gt;typeInfo().hasPutPropertySecurityCheck())
                  break;
<span class="line-modified">!             prototype = obj-&gt;getPrototype(vm, exec);</span>
              RETURN_IF_EXCEPTION(scope, false);
  
              if (prototype.isNull())
<span class="line-modified">!                 return typeError(exec, scope, slot.isStrictMode(), ReadonlyPropertyWriteError);</span>
              obj = asObject(prototype);
          }
      }
  
      for (; ; obj = asObject(prototype)) {
          Structure* structure = obj-&gt;structure(vm);
          if (UNLIKELY(structure-&gt;typeInfo().hasPutPropertySecurityCheck())) {
<span class="line-modified">!             obj-&gt;methodTable(vm)-&gt;doPutPropertySecurityCheck(obj, exec, propertyName, slot);</span>
              RETURN_IF_EXCEPTION(scope, false);
          }
          unsigned attributes;
          PropertyOffset offset = structure-&gt;get(vm, propertyName, attributes);
          if (offset != invalidOffset) {
              if (attributes &amp; PropertyAttribute::ReadOnly)
<span class="line-modified">!                 return typeError(exec, scope, slot.isStrictMode(), ReadonlyPropertyWriteError);</span>
  
              JSValue gs = obj-&gt;getDirect(offset);
              if (gs.isGetterSetter())
<span class="line-modified">!                 RELEASE_AND_RETURN(scope, callSetter(exec, *this, gs, value, slot.isStrictMode() ? StrictMode : NotStrictMode));</span>
  
              if (gs.isCustomGetterSetter())
<span class="line-modified">!                 return callCustomSetter(exec, gs, attributes &amp; PropertyAttribute::CustomAccessor, obj, slot.thisValue(), value);</span>
  
              // If there&#39;s an existing property on the object or one of its
              // prototypes it should be replaced, so break here.
              break;
          }
  
<span class="line-modified">!         prototype = obj-&gt;getPrototype(vm, exec);</span>
          RETURN_IF_EXCEPTION(scope, false);
          if (prototype.isNull())
              break;
      }
  
<span class="line-modified">!     return typeError(exec, scope, slot.isStrictMode(), ReadonlyPropertyWriteError);</span>
  }
  
<span class="line-modified">! bool JSValue::putToPrimitiveByIndex(ExecState* exec, unsigned propertyName, JSValue value, bool shouldThrow)</span>
  {
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      if (propertyName &gt; MAX_ARRAY_INDEX) {
          PutPropertySlot slot(*this, shouldThrow);
<span class="line-modified">!         return putToPrimitive(exec, Identifier::from(vm, propertyName), value, slot);</span>
      }
  
<span class="line-modified">!     JSObject* prototype = synthesizePrototype(exec);</span>
      EXCEPTION_ASSERT(!!scope.exception() == !prototype);
      if (UNLIKELY(!prototype))
          return false;
      bool putResult = false;
<span class="line-modified">!     bool success = prototype-&gt;attemptToInterceptPutByIndexOnHoleForPrototype(exec, *this, propertyName, value, shouldThrow, putResult);</span>
      RETURN_IF_EXCEPTION(scope, false);
      if (success)
          return putResult;
  
<span class="line-modified">!     return typeError(exec, scope, shouldThrow, ReadonlyPropertyWriteError);</span>
  }
  
  void JSValue::dump(PrintStream&amp; out) const
  {
      dumpInContext(out, 0);
<span class="line-new-header">--- 89,148 ---</span>
      if (isNull())
          return 0;
      return WTF::nullopt;
  }
  
<span class="line-modified">! JSObject* JSValue::toObjectSlowCase(JSGlobalObject* globalObject) const</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      ASSERT(!isCell());
  
      if (isInt32() || isDouble())
<span class="line-modified">!         return constructNumber(globalObject, asValue());</span>
      if (isTrue() || isFalse())
<span class="line-modified">!         return constructBooleanFromImmediateBoolean(globalObject, asValue());</span>
  
      ASSERT(isUndefinedOrNull());
<span class="line-modified">!     throwException(globalObject, scope, createNotAnObjectError(globalObject, *this));</span>
      return nullptr;
  }
  
<span class="line-modified">! JSValue JSValue::toThisSlowCase(JSGlobalObject* globalObject, ECMAMode ecmaMode) const</span>
  {
      ASSERT(!isCell());
  
      if (ecmaMode == StrictMode)
          return *this;
  
      if (isInt32() || isDouble())
<span class="line-modified">!         return constructNumber(globalObject, asValue());</span>
      if (isTrue() || isFalse())
<span class="line-modified">!         return constructBooleanFromImmediateBoolean(globalObject, asValue());</span>
      ASSERT(isUndefinedOrNull());
<span class="line-modified">!     return globalObject-&gt;globalThis();</span>
  }
  
<span class="line-modified">! JSObject* JSValue::synthesizePrototype(JSGlobalObject* globalObject) const</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      if (isCell()) {
          if (isString())
<span class="line-modified">!             return globalObject-&gt;stringPrototype();</span>
          if (isBigInt())
<span class="line-modified">!             return globalObject-&gt;bigIntPrototype();</span>
          ASSERT(isSymbol());
<span class="line-modified">!         return globalObject-&gt;symbolPrototype();</span>
      }
  
      if (isNumber())
<span class="line-modified">!         return globalObject-&gt;numberPrototype();</span>
      if (isBoolean())
<span class="line-modified">!         return globalObject-&gt;booleanPrototype();</span>
  
      ASSERT(isUndefinedOrNull());
<span class="line-modified">!     throwException(globalObject, scope, createNotAnObjectError(globalObject, *this));</span>
      return nullptr;
  }
  
  // ECMA 8.7.2
<span class="line-modified">! bool JSValue::putToPrimitive(JSGlobalObject* globalObject, PropertyName propertyName, JSValue value, PutPropertySlot&amp; slot)</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      if (Optional&lt;uint32_t&gt; index = parseIndex(propertyName))
<span class="line-modified">!         RELEASE_AND_RETURN(scope, putToPrimitiveByIndex(globalObject, index.value(), value, slot.isStrictMode()));</span>
  
      // Check if there are any setters or getters in the prototype chain
<span class="line-modified">!     JSObject* obj = synthesizePrototype(globalObject);</span>
      EXCEPTION_ASSERT(!!scope.exception() == !obj);
      if (UNLIKELY(!obj))
          return false;
      JSValue prototype;
      if (propertyName != vm.propertyNames-&gt;underscoreProto) {
          while (true) {
              Structure* structure = obj-&gt;structure(vm);
              if (structure-&gt;hasReadOnlyOrGetterSetterPropertiesExcludingProto() || structure-&gt;typeInfo().hasPutPropertySecurityCheck())
                  break;
<span class="line-modified">!             prototype = obj-&gt;getPrototype(vm, globalObject);</span>
              RETURN_IF_EXCEPTION(scope, false);
  
              if (prototype.isNull())
<span class="line-modified">!                 return typeError(globalObject, scope, slot.isStrictMode(), ReadonlyPropertyWriteError);</span>
              obj = asObject(prototype);
          }
      }
  
      for (; ; obj = asObject(prototype)) {
          Structure* structure = obj-&gt;structure(vm);
          if (UNLIKELY(structure-&gt;typeInfo().hasPutPropertySecurityCheck())) {
<span class="line-modified">!             obj-&gt;methodTable(vm)-&gt;doPutPropertySecurityCheck(obj, globalObject, propertyName, slot);</span>
              RETURN_IF_EXCEPTION(scope, false);
          }
          unsigned attributes;
          PropertyOffset offset = structure-&gt;get(vm, propertyName, attributes);
          if (offset != invalidOffset) {
              if (attributes &amp; PropertyAttribute::ReadOnly)
<span class="line-modified">!                 return typeError(globalObject, scope, slot.isStrictMode(), ReadonlyPropertyWriteError);</span>
  
              JSValue gs = obj-&gt;getDirect(offset);
              if (gs.isGetterSetter())
<span class="line-modified">!                 RELEASE_AND_RETURN(scope, callSetter(globalObject, *this, gs, value, slot.isStrictMode() ? StrictMode : NotStrictMode));</span>
  
              if (gs.isCustomGetterSetter())
<span class="line-modified">!                 return callCustomSetter(globalObject, gs, attributes &amp; PropertyAttribute::CustomAccessor, obj, slot.thisValue(), value);</span>
  
              // If there&#39;s an existing property on the object or one of its
              // prototypes it should be replaced, so break here.
              break;
          }
  
<span class="line-modified">!         prototype = obj-&gt;getPrototype(vm, globalObject);</span>
          RETURN_IF_EXCEPTION(scope, false);
          if (prototype.isNull())
              break;
      }
  
<span class="line-modified">!     return typeError(globalObject, scope, slot.isStrictMode(), ReadonlyPropertyWriteError);</span>
  }
  
<span class="line-modified">! bool JSValue::putToPrimitiveByIndex(JSGlobalObject* globalObject, unsigned propertyName, JSValue value, bool shouldThrow)</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      if (propertyName &gt; MAX_ARRAY_INDEX) {
          PutPropertySlot slot(*this, shouldThrow);
<span class="line-modified">!         return putToPrimitive(globalObject, Identifier::from(vm, propertyName), value, slot);</span>
      }
  
<span class="line-modified">!     JSObject* prototype = synthesizePrototype(globalObject);</span>
      EXCEPTION_ASSERT(!!scope.exception() == !prototype);
      if (UNLIKELY(!prototype))
          return false;
      bool putResult = false;
<span class="line-modified">!     bool success = prototype-&gt;attemptToInterceptPutByIndexOnHoleForPrototype(globalObject, *this, propertyName, value, shouldThrow, putResult);</span>
      RETURN_IF_EXCEPTION(scope, false);
      if (success)
          return putResult;
  
<span class="line-modified">!     return typeError(globalObject, scope, shouldThrow, ReadonlyPropertyWriteError);</span>
  }
  
  void JSValue::dump(PrintStream&amp; out) const
  {
      dumpInContext(out, 0);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 268,16 ***</span>
                  out.print(&quot; (rope)&quot;);
              const StringImpl* impl = string-&gt;tryGetValueImpl();
              if (impl) {
                  if (impl-&gt;isAtom())
                      out.print(&quot; (atomic)&quot;);
<span class="line-removed">-                 if (impl-&gt;isAtom())</span>
<span class="line-removed">-                     out.print(&quot; (identifier)&quot;);</span>
                  if (impl-&gt;isSymbol())
                      out.print(&quot; (symbol)&quot;);
              } else
                  out.print(&quot; (unresolved)&quot;);
              out.print(&quot;: &quot;, impl);
          } else if (structure-&gt;classInfo()-&gt;isSubClassOf(RegExp::info()))
              out.print(&quot;RegExp: &quot;, *jsCast&lt;RegExp*&gt;(asCell()));
          else if (structure-&gt;classInfo()-&gt;isSubClassOf(Symbol::info()))
              out.print(&quot;Symbol: &quot;, RawPointer(asCell()));
<span class="line-new-header">--- 268,19 ---</span>
                  out.print(&quot; (rope)&quot;);
              const StringImpl* impl = string-&gt;tryGetValueImpl();
              if (impl) {
                  if (impl-&gt;isAtom())
                      out.print(&quot; (atomic)&quot;);
                  if (impl-&gt;isSymbol())
                      out.print(&quot; (symbol)&quot;);
              } else
                  out.print(&quot; (unresolved)&quot;);
<span class="line-added">+             if (string-&gt;is8Bit())</span>
<span class="line-added">+                 out.print(&quot;,8Bit:(1)&quot;);</span>
<span class="line-added">+             else</span>
<span class="line-added">+                 out.print(&quot;,8Bit:(0)&quot;);</span>
<span class="line-added">+             out.print(&quot;,length:(&quot;, string-&gt;length(), &quot;)&quot;);</span>
              out.print(&quot;: &quot;, impl);
          } else if (structure-&gt;classInfo()-&gt;isSubClassOf(RegExp::info()))
              out.print(&quot;RegExp: &quot;, *jsCast&lt;RegExp*&gt;(asCell()));
          else if (structure-&gt;classInfo()-&gt;isSubClassOf(Symbol::info()))
              out.print(&quot;Symbol: &quot;, RawPointer(asCell()));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 351,13 ***</span>
  bool JSValue::isValidCallee()
  {
      return asObject(asCell())-&gt;globalObject();
  }
  
<span class="line-modified">! JSString* JSValue::toStringSlowCase(ExecState* exec, bool returnEmptyStringOnError) const</span>
  {
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      auto errorValue = [&amp;] () -&gt; JSString* {
          if (returnEmptyStringOnError)
              return jsEmptyString(vm);
<span class="line-new-header">--- 354,13 ---</span>
  bool JSValue::isValidCallee()
  {
      return asObject(asCell())-&gt;globalObject();
  }
  
<span class="line-modified">! JSString* JSValue::toStringSlowCase(JSGlobalObject* globalObject, bool returnEmptyStringOnError) const</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      auto errorValue = [&amp;] () -&gt; JSString* {
          if (returnEmptyStringOnError)
              return jsEmptyString(vm);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 380,34 ***</span>
      if (isNull())
          return vm.smallStrings.nullString();
      if (isUndefined())
          return vm.smallStrings.undefinedString();
      if (isSymbol()) {
<span class="line-modified">!         throwTypeError(exec, scope, &quot;Cannot convert a symbol to a string&quot;_s);</span>
          return errorValue();
      }
      if (isBigInt()) {
          JSBigInt* bigInt = asBigInt(*this);
          if (auto digit = bigInt-&gt;singleDigitValueForString())
              return vm.smallStrings.singleCharacterString(*digit + &#39;0&#39;);
<span class="line-modified">!         JSString* returnString = jsNontrivialString(vm, bigInt-&gt;toString(exec, 10));</span>
          RETURN_IF_EXCEPTION(scope, errorValue());
          return returnString;
      }
  
      ASSERT(isCell());
<span class="line-modified">!     JSValue value = asCell()-&gt;toPrimitive(exec, PreferString);</span>
      RETURN_IF_EXCEPTION(scope, errorValue());
      ASSERT(!value.isObject());
<span class="line-modified">!     JSString* result = value.toString(exec);</span>
      RETURN_IF_EXCEPTION(scope, errorValue());
      return result;
  }
  
<span class="line-modified">! String JSValue::toWTFStringSlowCase(ExecState* exec) const</span>
  {
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      if (isInt32())
          return vm.numericStrings.add(asInt32());
      if (isDouble())
          return vm.numericStrings.add(asDouble());
      if (isTrue())
<span class="line-new-header">--- 383,35 ---</span>
      if (isNull())
          return vm.smallStrings.nullString();
      if (isUndefined())
          return vm.smallStrings.undefinedString();
      if (isSymbol()) {
<span class="line-modified">!         throwTypeError(globalObject, scope, &quot;Cannot convert a symbol to a string&quot;_s);</span>
          return errorValue();
      }
      if (isBigInt()) {
          JSBigInt* bigInt = asBigInt(*this);
          if (auto digit = bigInt-&gt;singleDigitValueForString())
              return vm.smallStrings.singleCharacterString(*digit + &#39;0&#39;);
<span class="line-modified">!         JSString* returnString = jsNontrivialString(vm, bigInt-&gt;toString(globalObject, 10));</span>
          RETURN_IF_EXCEPTION(scope, errorValue());
          return returnString;
      }
  
      ASSERT(isCell());
<span class="line-modified">!     JSValue value = asCell()-&gt;toPrimitive(globalObject, PreferString);</span>
      RETURN_IF_EXCEPTION(scope, errorValue());
      ASSERT(!value.isObject());
<span class="line-modified">!     JSString* result = value.toString(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, errorValue());
      return result;
  }
  
<span class="line-modified">! String JSValue::toWTFStringSlowCase(JSGlobalObject* globalObject) const</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-added">+     auto scope = DECLARE_THROW_SCOPE(vm);</span>
      if (isInt32())
          return vm.numericStrings.add(asInt32());
      if (isDouble())
          return vm.numericStrings.add(asDouble());
      if (isTrue())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 416,9 ***</span>
          return vm.propertyNames-&gt;falseKeyword.string();
      if (isNull())
          return vm.propertyNames-&gt;nullKeyword.string();
      if (isUndefined())
          return vm.propertyNames-&gt;undefinedKeyword.string();
<span class="line-modified">!     return toString(exec)-&gt;value(exec);</span>
  }
  
  } // namespace JSC
<span class="line-new-header">--- 420,11 ---</span>
          return vm.propertyNames-&gt;falseKeyword.string();
      if (isNull())
          return vm.propertyNames-&gt;nullKeyword.string();
      if (isUndefined())
          return vm.propertyNames-&gt;undefinedKeyword.string();
<span class="line-modified">!     JSString* string = toString(globalObject);</span>
<span class="line-added">+     RETURN_IF_EXCEPTION(scope, { });</span>
<span class="line-added">+     RELEASE_AND_RETURN(scope, string-&gt;value(globalObject));</span>
  }
  
  } // namespace JSC
</pre>
<center><a href="JSCInlines.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSCJSValue.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>