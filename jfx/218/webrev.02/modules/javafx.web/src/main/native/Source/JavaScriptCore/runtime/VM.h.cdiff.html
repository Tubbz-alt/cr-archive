<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/VM.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="VM.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="VMEntryScope.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/VM.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (C) 2008-2019 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   *
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (C) 2008-2020 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   *
</pre>
<hr />
<pre>
<span class="line-old-header">*** 38,10 ***</span>
<span class="line-new-header">--- 38,11 ---</span>
  #include &quot;ExceptionEventLocation.h&quot;
  #include &quot;ExecutableAllocator.h&quot;
  #include &quot;FunctionHasExecutedCache.h&quot;
  #include &quot;FuzzerAgent.h&quot;
  #include &quot;Heap.h&quot;
<span class="line-added">+ #include &quot;Integrity.h&quot;</span>
  #include &quot;Intrinsic.h&quot;
  #include &quot;IsoCellSet.h&quot;
  #include &quot;IsoSubspace.h&quot;
  #include &quot;JITThunks.h&quot;
  #include &quot;JSCJSValue.h&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 83,11 ***</span>
  #endif
  
  // Enable the Objective-C API for platforms with a modern runtime. This has to match exactly what we
  // have in JSBase.h.
  #if !defined(JSC_OBJC_API_ENABLED)
<span class="line-modified">! #if (defined(__clang__) &amp;&amp; defined(__APPLE__) &amp;&amp; ((defined(__MAC_OS_X_VERSION_MIN_REQUIRED) &amp;&amp; !defined(__i386__)) || (defined(TARGET_OS_IPHONE) &amp;&amp; TARGET_OS_IPHONE)))</span>
  #define JSC_OBJC_API_ENABLED 1
  #else
  #define JSC_OBJC_API_ENABLED 0
  #endif
  #endif
<span class="line-new-header">--- 84,11 ---</span>
  #endif
  
  // Enable the Objective-C API for platforms with a modern runtime. This has to match exactly what we
  // have in JSBase.h.
  #if !defined(JSC_OBJC_API_ENABLED)
<span class="line-modified">! #if (defined(__clang__) &amp;&amp; defined(__APPLE__) &amp;&amp; (defined(__MAC_OS_X_VERSION_MIN_REQUIRED) || (defined(TARGET_OS_IPHONE) &amp;&amp; TARGET_OS_IPHONE)))</span>
  #define JSC_OBJC_API_ENABLED 1
  #else
  #define JSC_OBJC_API_ENABLED 0
  #endif
  #endif
</pre>
<hr />
<pre>
<span class="line-old-header">*** 99,17 ***</span>
  
  namespace JSC {
  
  class BuiltinExecutables;
  class BytecodeIntrinsicRegistry;
  class CodeBlock;
  class CodeCache;
  class CommonIdentifiers;
  class CompactVariableMap;
  class CustomGetterSetter;
  class DOMAttributeGetterSetter;
<span class="line-modified">! class ExecState;</span>
  class Exception;
  class ExceptionScope;
  class FastMallocAlignedMemoryAllocator;
  class GigacageAlignedMemoryAllocator;
  class HandleStack;
<span class="line-new-header">--- 100,21 ---</span>
  
  namespace JSC {
  
  class BuiltinExecutables;
  class BytecodeIntrinsicRegistry;
<span class="line-added">+ class CallFrame;</span>
<span class="line-added">+ struct CheckpointOSRExitSideState;</span>
  class CodeBlock;
  class CodeCache;
  class CommonIdentifiers;
  class CompactVariableMap;
<span class="line-added">+ class ConservativeRoots;</span>
  class CustomGetterSetter;
  class DOMAttributeGetterSetter;
<span class="line-modified">! class DateInstance;</span>
<span class="line-added">+ class ErrorInstance;</span>
  class Exception;
  class ExceptionScope;
  class FastMallocAlignedMemoryAllocator;
  class GigacageAlignedMemoryAllocator;
  class HandleStack;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 117,23 ***</span>
  class TypeProfilerLog;
  class HasOwnPropertyCache;
  class HeapProfiler;
  class Identifier;
  class Interpreter;
  class JSCustomGetterSetterFunction;
  class JSDestructibleObjectHeapCellType;
  class JSGlobalObject;
  class JSObject;
  class JSPromise;
  class JSPropertyNameEnumerator;
  class JSRunLoopTimer;
<span class="line-modified">! class JSStringHeapCellType;</span>
<span class="line-modified">! class JSWebAssemblyCodeBlockHeapCellType;</span>
  class JSWebAssemblyInstance;
  class LLIntOffsetsExtractor;
  class NativeExecutable;
<span class="line-modified">! class PromiseDeferredTimer;</span>
  class RegExp;
  class RegExpCache;
  class Register;
  class RegisterAtOffsetList;
  #if ENABLE(SAMPLING_PROFILER)
<span class="line-new-header">--- 122,43 ---</span>
  class TypeProfilerLog;
  class HasOwnPropertyCache;
  class HeapProfiler;
  class Identifier;
  class Interpreter;
<span class="line-added">+ class IntlCollator;</span>
<span class="line-added">+ class IntlDateTimeFormat;</span>
<span class="line-added">+ class IntlNumberFormat;</span>
<span class="line-added">+ class IntlPluralRules;</span>
<span class="line-added">+ class JSAPIGlobalObject;</span>
<span class="line-added">+ class JSAPIWrapperGlobalObject;</span>
<span class="line-added">+ class JSAPIWrapperObject;</span>
<span class="line-added">+ class JSCCallbackFunction;</span>
<span class="line-added">+ class JSCallbackConstructor;</span>
  class JSCustomGetterSetterFunction;
  class JSDestructibleObjectHeapCellType;
  class JSGlobalObject;
<span class="line-added">+ class JSGlobalLexicalEnvironment;</span>
<span class="line-added">+ class JSModuleNamespaceObject;</span>
<span class="line-added">+ class JSModuleRecord;</span>
<span class="line-added">+ class JSNativeStdFunction;</span>
<span class="line-added">+ class JSNonFinalObject;</span>
  class JSObject;
  class JSPromise;
  class JSPropertyNameEnumerator;
  class JSRunLoopTimer;
<span class="line-modified">! class JSWeakMap;</span>
<span class="line-modified">! class JSWeakSet;</span>
<span class="line-added">+ class JSWebAssemblyCodeBlock;</span>
<span class="line-added">+ class JSWebAssemblyGlobal;</span>
  class JSWebAssemblyInstance;
<span class="line-added">+ class JSWebAssemblyMemory;</span>
<span class="line-added">+ class JSWebAssemblyModule;</span>
<span class="line-added">+ class JSWebAssemblyTable;</span>
  class LLIntOffsetsExtractor;
  class NativeExecutable;
<span class="line-modified">! class ObjCCallbackFunction;</span>
<span class="line-added">+ class PromiseTimer;</span>
  class RegExp;
  class RegExpCache;
  class Register;
  class RegisterAtOffsetList;
  #if ENABLE(SAMPLING_PROFILER)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 155,14 ***</span>
  class UnlinkedFunctionExecutable;
  class UnlinkedProgramCodeBlock;
  class UnlinkedModuleProgramCodeBlock;
  class VirtualRegister;
  class VMEntryScope;
  class Watchdog;
  class Watchpoint;
  class WatchpointSet;
<span class="line-modified">! class WebAssemblyFunctionHeapCellType;</span>
  
  #if ENABLE(FTL_JIT)
  namespace FTL {
  class Thunks;
  }
<span class="line-new-header">--- 180,20 ---</span>
  class UnlinkedFunctionExecutable;
  class UnlinkedProgramCodeBlock;
  class UnlinkedModuleProgramCodeBlock;
  class VirtualRegister;
  class VMEntryScope;
<span class="line-added">+ class TopLevelGlobalObjectScope;</span>
  class Watchdog;
  class Watchpoint;
  class WatchpointSet;
<span class="line-modified">! class WebAssemblyFunction;</span>
<span class="line-added">+ class WebAssemblyModuleRecord;</span>
<span class="line-added">+ </span>
<span class="line-added">+ class IsoHeapCellType;</span>
<span class="line-added">+ template&lt;typename CellType&gt; class IsoInlinedHeapCellType;</span>
<span class="line-added">+ template&lt;typename Parent&gt; class JSCallbackObject;</span>
  
  #if ENABLE(FTL_JIT)
  namespace FTL {
  class Thunks;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 177,12 ***</span>
  struct EntryFrame;
  struct HashTable;
  struct Instruction;
  struct ValueProfile;
  
<span class="line-removed">- typedef ExecState CallFrame;</span>
<span class="line-removed">- </span>
  struct LocalTimeOffsetCache {
      LocalTimeOffsetCache()
          : start(0.0)
          , end(-1.0)
          , increment(0.0)
<span class="line-new-header">--- 208,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 220,10 ***</span>
<span class="line-new-header">--- 249,12 ---</span>
      Ref&lt;Microtask&gt; m_microtask;
  };
  
  class ConservativeRoots;
  
<span class="line-added">+ DECLARE_ALLOCATOR_WITH_HEAP_IDENTIFIER(VM);</span>
<span class="line-added">+ </span>
  #if COMPILER(MSVC)
  #pragma warning(push)
  #pragma warning(disable: 4200) // Disable &quot;zero-sized array in struct/union&quot; warning
  #endif
  struct ScratchBuffer {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 232,12 ***</span>
          u.m_activeLength = 0;
      }
  
      static ScratchBuffer* create(size_t size)
      {
<span class="line-modified">!         ScratchBuffer* result = new (fastMalloc(ScratchBuffer::allocationSize(size))) ScratchBuffer;</span>
<span class="line-removed">- </span>
          return result;
      }
  
      static size_t allocationSize(Checked&lt;size_t&gt; bufferSize) { return (sizeof(ScratchBuffer) + bufferSize).unsafeGet(); }
      void setActiveLength(size_t activeLength) { u.m_activeLength = activeLength; }
<span class="line-new-header">--- 263,11 ---</span>
          u.m_activeLength = 0;
      }
  
      static ScratchBuffer* create(size_t size)
      {
<span class="line-modified">!         ScratchBuffer* result = new (VMMalloc::malloc(ScratchBuffer::allocationSize(size))) ScratchBuffer;</span>
          return result;
      }
  
      static size_t allocationSize(Checked&lt;size_t&gt; bufferSize) { return (sizeof(ScratchBuffer) + bufferSize).unsafeGet(); }
      void setActiveLength(size_t activeLength) { u.m_activeLength = activeLength; }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 296,21 ***</span>
  #endif
  
      FuzzerAgent* fuzzerAgent() const { return m_fuzzerAgent.get(); }
      void setFuzzerAgent(std::unique_ptr&lt;FuzzerAgent&gt;&amp;&amp; fuzzerAgent)
      {
          m_fuzzerAgent = WTFMove(fuzzerAgent);
      }
  
      static unsigned numberOfIDs() { return s_numberOfIDs.load(); }
      unsigned id() const { return m_id; }
      bool isEntered() const { return !!entryScope; }
  
      inline CallFrame* topJSCallFrame() const;
  
      // Global object in which execution began.
<span class="line-modified">!     JS_EXPORT_PRIVATE JSGlobalObject* vmEntryGlobalObject(const CallFrame*) const;</span>
  
  private:
      unsigned nextID();
  
      static Atomic&lt;unsigned&gt; s_numberOfIDs;
<span class="line-new-header">--- 326,25 ---</span>
  #endif
  
      FuzzerAgent* fuzzerAgent() const { return m_fuzzerAgent.get(); }
      void setFuzzerAgent(std::unique_ptr&lt;FuzzerAgent&gt;&amp;&amp; fuzzerAgent)
      {
<span class="line-added">+         RELEASE_ASSERT_WITH_MESSAGE(!m_fuzzerAgent, &quot;Only one FuzzerAgent can be specified at a time.&quot;);</span>
          m_fuzzerAgent = WTFMove(fuzzerAgent);
      }
  
      static unsigned numberOfIDs() { return s_numberOfIDs.load(); }
      unsigned id() const { return m_id; }
      bool isEntered() const { return !!entryScope; }
  
      inline CallFrame* topJSCallFrame() const;
  
      // Global object in which execution began.
<span class="line-modified">!     JS_EXPORT_PRIVATE JSGlobalObject* deprecatedVMEntryGlobalObject(JSGlobalObject*) const;</span>
<span class="line-added">+ </span>
<span class="line-added">+     WeakRandom&amp; random() { return m_random; }</span>
<span class="line-added">+     Integrity::Random&amp; integrityRandom() { return m_integrityRandom; }</span>
  
  private:
      unsigned nextID();
  
      static Atomic&lt;unsigned&gt; s_numberOfIDs;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 320,10 ***</span>
<span class="line-new-header">--- 354,13 ---</span>
  #if USE(CF)
      // These need to be initialized before heap below.
      RetainPtr&lt;CFRunLoopRef&gt; m_runLoop;
  #endif
  
<span class="line-added">+     WeakRandom m_random;</span>
<span class="line-added">+     Integrity::Random m_integrityRandom;</span>
<span class="line-added">+ </span>
  public:
      Heap heap;
  
      std::unique_ptr&lt;FastMallocAlignedMemoryAllocator&gt; fastMallocAllocator;
      std::unique_ptr&lt;GigacageAlignedMemoryAllocator&gt; primitiveGigacageAllocator;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 331,15 ***</span>
  
      std::unique_ptr&lt;HeapCellType&gt; auxiliaryHeapCellType;
      std::unique_ptr&lt;HeapCellType&gt; immutableButterflyHeapCellType;
      std::unique_ptr&lt;HeapCellType&gt; cellHeapCellType;
      std::unique_ptr&lt;HeapCellType&gt; destructibleCellHeapCellType;
<span class="line-modified">!     std::unique_ptr&lt;JSStringHeapCellType&gt; stringHeapCellType;</span>
      std::unique_ptr&lt;JSDestructibleObjectHeapCellType&gt; destructibleObjectHeapCellType;
  #if ENABLE(WEBASSEMBLY)
<span class="line-modified">!     std::unique_ptr&lt;JSWebAssemblyCodeBlockHeapCellType&gt; webAssemblyCodeBlockHeapCellType;</span>
<span class="line-modified">!     std::unique_ptr&lt;WebAssemblyFunctionHeapCellType&gt; webAssemblyFunctionHeapCellType;</span>
  #endif
  
      CompleteSubspace primitiveGigacageAuxiliarySpace; // Typed arrays, strings, bitvectors, etc go here.
      CompleteSubspace jsValueGigacageAuxiliarySpace; // Butterflies, arrays of JSValues, etc go here.
      CompleteSubspace immutableButterflyJSValueGigacageAuxiliarySpace; // JSImmutableButterfly goes here.
<span class="line-new-header">--- 368,49 ---</span>
  
      std::unique_ptr&lt;HeapCellType&gt; auxiliaryHeapCellType;
      std::unique_ptr&lt;HeapCellType&gt; immutableButterflyHeapCellType;
      std::unique_ptr&lt;HeapCellType&gt; cellHeapCellType;
      std::unique_ptr&lt;HeapCellType&gt; destructibleCellHeapCellType;
<span class="line-modified">!     std::unique_ptr&lt;IsoHeapCellType&gt; apiGlobalObjectHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; callbackConstructorHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; callbackGlobalObjectHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; callbackObjectHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; dateInstanceHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; errorInstanceHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; globalLexicalEnvironmentHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; globalObjectHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; jsModuleRecordHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; moduleNamespaceObjectHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; nativeStdFunctionHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoInlinedHeapCellType&lt;JSString&gt;&gt; stringHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; weakMapHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; weakSetHeapCellType;</span>
      std::unique_ptr&lt;JSDestructibleObjectHeapCellType&gt; destructibleObjectHeapCellType;
<span class="line-added">+ #if JSC_OBJC_API_ENABLED</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; apiWrapperObjectHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; objCCallbackFunctionHeapCellType;</span>
<span class="line-added">+ #endif</span>
<span class="line-added">+ #ifdef JSC_GLIB_API_ENABLED</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; apiWrapperObjectHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; callbackAPIWrapperGlobalObjectHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; jscCallbackFunctionHeapCellType;</span>
<span class="line-added">+ #endif</span>
<span class="line-added">+ #if ENABLE(INTL)</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; intlCollatorHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; intlDateTimeFormatHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; intlNumberFormatHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; intlPluralRulesHeapCellType;</span>
<span class="line-added">+ #endif</span>
  #if ENABLE(WEBASSEMBLY)
<span class="line-modified">!     std::unique_ptr&lt;IsoHeapCellType&gt; webAssemblyCodeBlockHeapCellType;</span>
<span class="line-modified">!     std::unique_ptr&lt;IsoHeapCellType&gt; webAssemblyFunctionHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; webAssemblyGlobalHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; webAssemblyInstanceHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; webAssemblyMemoryHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; webAssemblyModuleHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; webAssemblyModuleRecordHeapCellType;</span>
<span class="line-added">+     std::unique_ptr&lt;IsoHeapCellType&gt; webAssemblyTableHeapCellType;</span>
  #endif
  
      CompleteSubspace primitiveGigacageAuxiliarySpace; // Typed arrays, strings, bitvectors, etc go here.
      CompleteSubspace jsValueGigacageAuxiliarySpace; // Butterflies, arrays of JSValues, etc go here.
      CompleteSubspace immutableButterflyJSValueGigacageAuxiliarySpace; // JSImmutableButterfly goes here.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 351,34 ***</span>
      // FIXME: Maybe it would be better if everyone abstracted this?
      // https://bugs.webkit.org/show_bug.cgi?id=175248
      ALWAYS_INLINE CompleteSubspace&amp; gigacageAuxiliarySpace(Gigacage::Kind kind)
      {
          switch (kind) {
<span class="line-removed">-         case Gigacage::ReservedForFlagsAndNotABasePtr:</span>
<span class="line-removed">-             RELEASE_ASSERT_NOT_REACHED();</span>
          case Gigacage::Primitive:
              return primitiveGigacageAuxiliarySpace;
          case Gigacage::JSValue:
              return jsValueGigacageAuxiliarySpace;
          }
          RELEASE_ASSERT_NOT_REACHED();
          return primitiveGigacageAuxiliarySpace;
      }
  
      // Whenever possible, use subspaceFor&lt;CellType&gt;(vm) to get one of these subspaces.
      CompleteSubspace cellSpace;
<span class="line-modified">!     CompleteSubspace jsValueGigacageCellSpace; // FIXME: This space is problematic because we have things in here like DirectArguments and ScopedArguments; those should be split into JSValueOOB cells and JSValueStrict auxiliaries. https://bugs.webkit.org/show_bug.cgi?id=182858</span>
<span class="line-removed">-     CompleteSubspace destructibleCellSpace;</span>
<span class="line-removed">-     CompleteSubspace stringSpace;</span>
      CompleteSubspace destructibleObjectSpace;
<span class="line-removed">-     CompleteSubspace eagerlySweptDestructibleObjectSpace;</span>
  
      IsoSubspace executableToCodeBlockEdgeSpace;
      IsoSubspace functionSpace;
      IsoSubspace internalFunctionSpace;
      IsoSubspace nativeExecutableSpace;
      IsoSubspace propertyTableSpace;
      IsoSubspace structureRareDataSpace;
      IsoSubspace structureSpace;
      IsoSubspace symbolTableSpace;
  
  #define DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(name) \
<span class="line-new-header">--- 422,52 ---</span>
      // FIXME: Maybe it would be better if everyone abstracted this?
      // https://bugs.webkit.org/show_bug.cgi?id=175248
      ALWAYS_INLINE CompleteSubspace&amp; gigacageAuxiliarySpace(Gigacage::Kind kind)
      {
          switch (kind) {
          case Gigacage::Primitive:
              return primitiveGigacageAuxiliarySpace;
          case Gigacage::JSValue:
              return jsValueGigacageAuxiliarySpace;
<span class="line-added">+         case Gigacage::NumberOfKinds:</span>
<span class="line-added">+             break;</span>
          }
          RELEASE_ASSERT_NOT_REACHED();
          return primitiveGigacageAuxiliarySpace;
      }
  
      // Whenever possible, use subspaceFor&lt;CellType&gt;(vm) to get one of these subspaces.
      CompleteSubspace cellSpace;
<span class="line-modified">!     CompleteSubspace variableSizedCellSpace; // FIXME: This space is problematic because we have things in here like DirectArguments and ScopedArguments; those should be split into JSValueOOB cells and JSValueStrict auxiliaries. https://bugs.webkit.org/show_bug.cgi?id=182858</span>
      CompleteSubspace destructibleObjectSpace;
  
<span class="line-added">+     IsoSubspace bigIntSpace;</span>
<span class="line-added">+     IsoSubspace calleeSpace;</span>
<span class="line-added">+     IsoSubspace clonedArgumentsSpace;</span>
<span class="line-added">+     IsoSubspace customGetterSetterSpace;</span>
<span class="line-added">+     IsoSubspace dateInstanceSpace;</span>
<span class="line-added">+     IsoSubspace domAttributeGetterSetterSpace;</span>
<span class="line-added">+     IsoSubspace exceptionSpace;</span>
      IsoSubspace executableToCodeBlockEdgeSpace;
      IsoSubspace functionSpace;
<span class="line-added">+     IsoSubspace getterSetterSpace;</span>
<span class="line-added">+     IsoSubspace globalLexicalEnvironmentSpace;</span>
      IsoSubspace internalFunctionSpace;
<span class="line-added">+     IsoSubspace jsProxySpace;</span>
      IsoSubspace nativeExecutableSpace;
<span class="line-added">+     IsoSubspace numberObjectSpace;</span>
<span class="line-added">+     IsoSubspace promiseSpace;</span>
<span class="line-added">+     IsoSubspace propertyNameEnumeratorSpace;</span>
      IsoSubspace propertyTableSpace;
<span class="line-added">+     IsoSubspace regExpSpace;</span>
<span class="line-added">+     IsoSubspace regExpObjectSpace;</span>
<span class="line-added">+     IsoSubspace ropeStringSpace;</span>
<span class="line-added">+     IsoSubspace scopedArgumentsSpace;</span>
<span class="line-added">+     IsoSubspace sparseArrayValueMapSpace;</span>
<span class="line-added">+     IsoSubspace stringSpace;</span>
<span class="line-added">+     IsoSubspace stringObjectSpace;</span>
<span class="line-added">+     IsoSubspace structureChainSpace;</span>
      IsoSubspace structureRareDataSpace;
      IsoSubspace structureSpace;
      IsoSubspace symbolTableSpace;
  
  #define DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(name) \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 387,29 ***</span>
      { \
          if (m_##name || mode == SubspaceAccess::Concurrently) \
              return m_##name.get(); \
          return name##Slow(); \
      } \
<span class="line-modified">!     IsoSubspace* name##Slow(); \</span>
      std::unique_ptr&lt;IsoSubspace&gt; m_##name;
  
  
  #if JSC_OBJC_API_ENABLED
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(objCCallbackFunctionSpace)
  #endif
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(boundFunctionSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(callbackFunctionSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(customGetterSetterFunctionSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(errorInstanceSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(nativeStdFunctionSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(proxyRevokeSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(weakObjectRefSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(weakSetSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(weakMapSpace)
  #if ENABLE(WEBASSEMBLY)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyCodeBlockSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyFunctionSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyWrapperFunctionSpace)
  #endif
  
  #undef DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER
  
<span class="line-new-header">--- 476,95 ---</span>
      { \
          if (m_##name || mode == SubspaceAccess::Concurrently) \
              return m_##name.get(); \
          return name##Slow(); \
      } \
<span class="line-modified">!     JS_EXPORT_PRIVATE IsoSubspace* name##Slow(); \</span>
      std::unique_ptr&lt;IsoSubspace&gt; m_##name;
  
  
  #if JSC_OBJC_API_ENABLED
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(apiWrapperObjectSpace)</span>
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(objCCallbackFunctionSpace)
  #endif
<span class="line-added">+ #ifdef JSC_GLIB_API_ENABLED</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(apiWrapperObjectSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(jscCallbackFunctionSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(callbackAPIWrapperGlobalObjectSpace)</span>
<span class="line-added">+ #endif</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(apiGlobalObjectSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(apiValueWrapperSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(arrayBufferSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(arrayIteratorSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(asyncGeneratorSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(bigIntObjectSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(booleanObjectSpace)</span>
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(boundFunctionSpace)
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(callbackConstructorSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(callbackGlobalObjectSpace)</span>
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(callbackFunctionSpace)
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(callbackObjectSpace)</span>
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(customGetterSetterFunctionSpace)
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(dataViewSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(debuggerScopeSpace)</span>
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(errorInstanceSpace)
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(float32ArraySpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(float64ArraySpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(functionRareDataSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(generatorSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(globalObjectSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(int8ArraySpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(int16ArraySpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(int32ArraySpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(jsModuleRecordSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(mapBucketSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(mapIteratorSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(mapSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(moduleNamespaceObjectSpace)</span>
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(nativeStdFunctionSpace)
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(proxyObjectSpace)</span>
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(proxyRevokeSpace)
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(scopedArgumentsTableSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(scriptFetchParametersSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(scriptFetcherSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(setBucketSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(setIteratorSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(setSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(strictEvalActivationSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(stringIteratorSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(sourceCodeSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(symbolSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(symbolObjectSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(templateObjectDescriptorSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(uint8ArraySpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(uint8ClampedArraySpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(uint16ArraySpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(uint32ArraySpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(unlinkedEvalCodeBlockSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(unlinkedFunctionCodeBlockSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(unlinkedModuleProgramCodeBlockSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(unlinkedProgramCodeBlockSpace)</span>
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(weakObjectRefSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(weakSetSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(weakMapSpace)
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(withScopeSpace)</span>
<span class="line-added">+ #if ENABLE(INTL)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(intlCollatorSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(intlDateTimeFormatSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(intlNumberFormatSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(intlPluralRulesSpace)</span>
<span class="line-added">+ #endif</span>
  #if ENABLE(WEBASSEMBLY)
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(jsToWasmICCalleeSpace)</span>
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyCodeBlockSpace)
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyFunctionSpace)
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyGlobalSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyInstanceSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyMemorySpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyModuleSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyModuleRecordSpace)</span>
<span class="line-added">+     DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyTableSpace)</span>
      DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER(webAssemblyWrapperFunctionSpace)
  #endif
  
  #undef DYNAMIC_ISO_SUBSPACE_DEFINE_MEMBER
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 481,24 ***</span>
  
  #undef DYNAMIC_SPACE_AND_SET_DEFINE_MEMBER
  
      VMType vmType;
      ClientData* clientData;
<span class="line-modified">!     EntryFrame* topEntryFrame;</span>
      // NOTE: When throwing an exception while rolling back the call frame, this may be equal to
      // topEntryFrame.
      // FIXME: This should be a void*, because it might not point to a CallFrame.
      // https://bugs.webkit.org/show_bug.cgi?id=160441
<span class="line-modified">!     ExecState* topCallFrame { nullptr };</span>
  #if ENABLE(WEBASSEMBLY)
      Wasm::Context wasmContext;
  #endif
      Strong&lt;Structure&gt; structureStructure;
      Strong&lt;Structure&gt; structureRareDataStructure;
      Strong&lt;Structure&gt; terminatedExecutionErrorStructure;
      Strong&lt;Structure&gt; stringStructure;
      Strong&lt;Structure&gt; propertyNameEnumeratorStructure;
      Strong&lt;Structure&gt; customGetterSetterStructure;
      Strong&lt;Structure&gt; domAttributeGetterSetterStructure;
      Strong&lt;Structure&gt; scopedArgumentsTableStructure;
      Strong&lt;Structure&gt; apiWrapperStructure;
      Strong&lt;Structure&gt; nativeExecutableStructure;
<span class="line-new-header">--- 636,25 ---</span>
  
  #undef DYNAMIC_SPACE_AND_SET_DEFINE_MEMBER
  
      VMType vmType;
      ClientData* clientData;
<span class="line-modified">!     EntryFrame* topEntryFrame { nullptr };</span>
      // NOTE: When throwing an exception while rolling back the call frame, this may be equal to
      // topEntryFrame.
      // FIXME: This should be a void*, because it might not point to a CallFrame.
      // https://bugs.webkit.org/show_bug.cgi?id=160441
<span class="line-modified">!     CallFrame* topCallFrame { nullptr };</span>
  #if ENABLE(WEBASSEMBLY)
      Wasm::Context wasmContext;
  #endif
      Strong&lt;Structure&gt; structureStructure;
      Strong&lt;Structure&gt; structureRareDataStructure;
      Strong&lt;Structure&gt; terminatedExecutionErrorStructure;
      Strong&lt;Structure&gt; stringStructure;
      Strong&lt;Structure&gt; propertyNameEnumeratorStructure;
<span class="line-added">+     Strong&lt;Structure&gt; getterSetterStructure;</span>
      Strong&lt;Structure&gt; customGetterSetterStructure;
      Strong&lt;Structure&gt; domAttributeGetterSetterStructure;
      Strong&lt;Structure&gt; scopedArgumentsTableStructure;
      Strong&lt;Structure&gt; apiWrapperStructure;
      Strong&lt;Structure&gt; nativeExecutableStructure;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 510,30 ***</span>
  #endif
      Strong&lt;Structure&gt; moduleProgramExecutableStructure;
      Strong&lt;Structure&gt; regExpStructure;
      Strong&lt;Structure&gt; symbolStructure;
      Strong&lt;Structure&gt; symbolTableStructure;
<span class="line-removed">-     Strong&lt;Structure&gt; fixedArrayStructure;</span>
      Strong&lt;Structure&gt; immutableButterflyStructures[NumberOfCopyOnWriteIndexingModes];
      Strong&lt;Structure&gt; sourceCodeStructure;
      Strong&lt;Structure&gt; scriptFetcherStructure;
      Strong&lt;Structure&gt; scriptFetchParametersStructure;
      Strong&lt;Structure&gt; structureChainStructure;
      Strong&lt;Structure&gt; sparseArrayValueMapStructure;
      Strong&lt;Structure&gt; templateObjectDescriptorStructure;
<span class="line-removed">-     Strong&lt;Structure&gt; arrayBufferNeuteringWatchpointStructure;</span>
      Strong&lt;Structure&gt; unlinkedFunctionExecutableStructure;
      Strong&lt;Structure&gt; unlinkedProgramCodeBlockStructure;
      Strong&lt;Structure&gt; unlinkedEvalCodeBlockStructure;
      Strong&lt;Structure&gt; unlinkedFunctionCodeBlockStructure;
      Strong&lt;Structure&gt; unlinkedModuleProgramCodeBlockStructure;
      Strong&lt;Structure&gt; propertyTableStructure;
      Strong&lt;Structure&gt; functionRareDataStructure;
      Strong&lt;Structure&gt; exceptionStructure;
<span class="line-removed">-     Strong&lt;Structure&gt; promiseDeferredStructure;</span>
<span class="line-removed">-     Strong&lt;Structure&gt; internalPromiseDeferredStructure;</span>
<span class="line-removed">-     Strong&lt;Structure&gt; nativeStdFunctionCellStructure;</span>
      Strong&lt;Structure&gt; programCodeBlockStructure;
      Strong&lt;Structure&gt; moduleProgramCodeBlockStructure;
      Strong&lt;Structure&gt; evalCodeBlockStructure;
      Strong&lt;Structure&gt; functionCodeBlockStructure;
      Strong&lt;Structure&gt; hashMapBucketSetStructure;
<span class="line-new-header">--- 666,25 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 547,11 ***</span>
      Strong&lt;JSPropertyNameEnumerator&gt; m_emptyPropertyNameEnumerator;
  
      Strong&lt;JSCell&gt; m_sentinelSetBucket;
      Strong&lt;JSCell&gt; m_sentinelMapBucket;
  
<span class="line-modified">!     Ref&lt;PromiseDeferredTimer&gt; promiseDeferredTimer;</span>
  
      JSCell* currentlyDestructingCallbackObject;
      const ClassInfo* currentlyDestructingCallbackObjectClassInfo { nullptr };
  
      AtomStringTable* m_atomStringTable;
<span class="line-new-header">--- 698,16 ---</span>
      Strong&lt;JSPropertyNameEnumerator&gt; m_emptyPropertyNameEnumerator;
  
      Strong&lt;JSCell&gt; m_sentinelSetBucket;
      Strong&lt;JSCell&gt; m_sentinelMapBucket;
  
<span class="line-modified">!     Weak&lt;NativeExecutable&gt; m_fastBoundExecutable;</span>
<span class="line-added">+     Weak&lt;NativeExecutable&gt; m_fastCanConstructBoundExecutable;</span>
<span class="line-added">+     Weak&lt;NativeExecutable&gt; m_slowBoundExecutable;</span>
<span class="line-added">+     Weak&lt;NativeExecutable&gt; m_slowCanConstructBoundExecutable;</span>
<span class="line-added">+ </span>
<span class="line-added">+     Ref&lt;PromiseTimer&gt; promiseTimer;</span>
  
      JSCell* currentlyDestructingCallbackObject;
      const ClassInfo* currentlyDestructingCallbackObjectClassInfo { nullptr };
  
      AtomStringTable* m_atomStringTable;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 567,10 ***</span>
<span class="line-new-header">--- 723,12 ---</span>
      Strong&lt;JSString&gt; lastCachedString;
  
      AtomStringTable* atomStringTable() const { return m_atomStringTable; }
      WTF::SymbolRegistry&amp; symbolRegistry() { return m_symbolRegistry; }
  
<span class="line-added">+     Strong&lt;JSBigInt&gt; bigIntConstantOne;</span>
<span class="line-added">+ </span>
      Structure* setIteratorStructure()
      {
          if (LIKELY(m_setIteratorStructure))
              return m_setIteratorStructure.get();
          return setIteratorStructureSlow();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 651,13 ***</span>
  
      static void computeCanUseJIT();
      ALWAYS_INLINE static bool canUseJIT()
      {
  #if ENABLE(JIT)
<span class="line-modified">! #if !ASSERT_DISABLED</span>
<span class="line-removed">-         RELEASE_ASSERT(s_canUseJITIsSet);</span>
<span class="line-removed">- #endif</span>
          return s_canUseJIT;
  #else
          return false;
  #endif
      }
<span class="line-new-header">--- 809,11 ---</span>
  
      static void computeCanUseJIT();
      ALWAYS_INLINE static bool canUseJIT()
      {
  #if ENABLE(JIT)
<span class="line-modified">!         ASSERT(s_canUseJITIsSet);</span>
          return s_canUseJIT;
  #else
          return false;
  #endif
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 682,10 ***</span>
<span class="line-new-header">--- 838,12 ---</span>
      std::unique_ptr&lt;FTL::Thunks&gt; ftlThunks;
  #endif
      NativeExecutable* getHostFunction(NativeFunction, NativeFunction constructor, const String&amp; name);
      NativeExecutable* getHostFunction(NativeFunction, Intrinsic, NativeFunction constructor, const DOMJIT::Signature*, const String&amp; name);
  
<span class="line-added">+     NativeExecutable* getBoundFunction(bool isJSFunction, bool canConstruct);</span>
<span class="line-added">+ </span>
      MacroAssemblerCodePtr&lt;JSEntryPtrTag&gt; getCTIInternalFunctionTrampolineFor(CodeSpecializationKind);
  
      static ptrdiff_t exceptionOffset()
      {
          return OBJECT_OFFSETOF(VM, m_exception);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 713,11 ***</span>
  
      void restorePreviousException(Exception* exception) { setException(exception); }
  
      void clearLastException() { m_lastException = nullptr; }
  
<span class="line-modified">!     ExecState** addressOfCallFrameForCatch() { return &amp;callFrameForCatch; }</span>
  
      JSCell** addressOfException() { return reinterpret_cast&lt;JSCell**&gt;(&amp;m_exception); }
  
      Exception* lastException() const { return m_lastException; }
      JSCell** addressOfLastException() { return reinterpret_cast&lt;JSCell**&gt;(&amp;m_lastException); }
<span class="line-new-header">--- 871,11 ---</span>
  
      void restorePreviousException(Exception* exception) { setException(exception); }
  
      void clearLastException() { m_lastException = nullptr; }
  
<span class="line-modified">!     CallFrame** addressOfCallFrameForCatch() { return &amp;callFrameForCatch; }</span>
  
      JSCell** addressOfException() { return reinterpret_cast&lt;JSCell**&gt;(&amp;m_exception); }
  
      Exception* lastException() const { return m_lastException; }
      JSCell** addressOfLastException() { return reinterpret_cast&lt;JSCell**&gt;(&amp;m_lastException); }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 775,12 ***</span>
          }
      }
  
      JSValue hostCallReturnValue;
      unsigned varargsLength;
<span class="line-modified">!     ExecState* newCallFrameReturnValue;</span>
<span class="line-modified">!     ExecState* callFrameForCatch;</span>
      void* targetMachinePCForThrow;
      const Instruction* targetInterpreterPCForThrow;
      uint32_t osrExitIndex;
      void* osrExitJumpDestination;
      bool isExecutingInRegExpJIT { false };
<span class="line-new-header">--- 933,12 ---</span>
          }
      }
  
      JSValue hostCallReturnValue;
      unsigned varargsLength;
<span class="line-modified">!     CallFrame* newCallFrameReturnValue;</span>
<span class="line-modified">!     CallFrame* callFrameForCatch;</span>
      void* targetMachinePCForThrow;
      const Instruction* targetInterpreterPCForThrow;
      uint32_t osrExitIndex;
      void* osrExitJumpDestination;
      bool isExecutingInRegExpJIT { false };
</pre>
<hr />
<pre>
<span class="line-old-header">*** 794,16 ***</span>
  
      EncodedJSValue* exceptionFuzzingBuffer(size_t size)
      {
          ASSERT(Options::useExceptionFuzz());
          if (!m_exceptionFuzzBuffer)
<span class="line-modified">!             m_exceptionFuzzBuffer = MallocPtr&lt;EncodedJSValue&gt;::malloc(size);</span>
          return m_exceptionFuzzBuffer.get();
      }
  
      void gatherScratchBufferRoots(ConservativeRoots&amp;);
  
      VMEntryScope* entryScope;
  
      JSObject* stringRecursionCheckFirstObject { nullptr };
      HashSet&lt;JSObject*&gt; stringRecursionCheckVisitedObjects;
  
<span class="line-new-header">--- 952,21 ---</span>
  
      EncodedJSValue* exceptionFuzzingBuffer(size_t size)
      {
          ASSERT(Options::useExceptionFuzz());
          if (!m_exceptionFuzzBuffer)
<span class="line-modified">!             m_exceptionFuzzBuffer = MallocPtr&lt;EncodedJSValue, VMMalloc&gt;::malloc(size);</span>
          return m_exceptionFuzzBuffer.get();
      }
  
      void gatherScratchBufferRoots(ConservativeRoots&amp;);
  
<span class="line-added">+     void addCheckpointOSRSideState(CallFrame*, std::unique_ptr&lt;CheckpointOSRExitSideState&gt;&amp;&amp;);</span>
<span class="line-added">+     std::unique_ptr&lt;CheckpointOSRExitSideState&gt; findCheckpointOSRSideState(CallFrame*);</span>
<span class="line-added">+     bool hasCheckpointOSRSideState() const { return m_checkpointSideState.size(); }</span>
<span class="line-added">+     void scanSideState(ConservativeRoots&amp;) const;</span>
<span class="line-added">+ </span>
      VMEntryScope* entryScope;
  
      JSObject* stringRecursionCheckFirstObject { nullptr };
      HashSet&lt;JSObject*&gt; stringRecursionCheckVisitedObjects;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 865,15 ***</span>
      JS_EXPORT_PRIVATE void deleteAllCode(DeleteAllCodeEffort);
      JS_EXPORT_PRIVATE void deleteAllLinkedCode(DeleteAllCodeEffort);
  
      void shrinkFootprintWhenIdle();
  
<span class="line-modified">!     WatchpointSet* ensureWatchpointSetForImpureProperty(const Identifier&amp;);</span>
<span class="line-removed">-     void registerWatchpointForImpureProperty(const Identifier&amp;, Watchpoint*);</span>
  
      // FIXME: Use AtomString once it got merged with Identifier.
<span class="line-modified">!     JS_EXPORT_PRIVATE void addImpureProperty(const String&amp;);</span>
  
      InlineWatchpointSet&amp; primitiveGigacageEnabled() { return m_primitiveGigacageEnabled; }
  
      BuiltinExecutables* builtinExecutables() { return m_builtinExecutables.get(); }
  
<span class="line-new-header">--- 1028,14 ---</span>
      JS_EXPORT_PRIVATE void deleteAllCode(DeleteAllCodeEffort);
      JS_EXPORT_PRIVATE void deleteAllLinkedCode(DeleteAllCodeEffort);
  
      void shrinkFootprintWhenIdle();
  
<span class="line-modified">!     WatchpointSet* ensureWatchpointSetForImpureProperty(UniquedStringImpl*);</span>
  
      // FIXME: Use AtomString once it got merged with Identifier.
<span class="line-modified">!     JS_EXPORT_PRIVATE void addImpureProperty(UniquedStringImpl*);</span>
  
      InlineWatchpointSet&amp; primitiveGigacageEnabled() { return m_primitiveGigacageEnabled; }
  
      BuiltinExecutables* builtinExecutables() { return m_builtinExecutables.get(); }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 911,17 ***</span>
  
      Optional&lt;RefPtr&lt;Thread&gt;&gt; ownerThread() const { return m_apiLock-&gt;ownerThread(); }
  
      VMTraps&amp; traps() { return m_traps; }
  
<span class="line-modified">!     void handleTraps(ExecState* exec, VMTraps::Mask mask = VMTraps::Mask::allEventTypes()) { m_traps.handleTraps(exec, mask); }</span>
  
      bool needTrapHandling() { return m_traps.needTrapHandling(); }
      bool needTrapHandling(VMTraps::Mask mask) { return m_traps.needTrapHandling(mask); }
      void* needTrapHandlingAddress() { return m_traps.needTrapHandlingAddress(); }
  
      void notifyNeedDebuggerBreak() { m_traps.fireTrap(VMTraps::NeedDebuggerBreak); }
      void notifyNeedTermination() { m_traps.fireTrap(VMTraps::NeedTermination); }
      void notifyNeedWatchdogCheck() { m_traps.fireTrap(VMTraps::NeedWatchdogCheck); }
  
      void promiseRejected(JSPromise*);
  
<span class="line-new-header">--- 1073,18 ---</span>
  
      Optional&lt;RefPtr&lt;Thread&gt;&gt; ownerThread() const { return m_apiLock-&gt;ownerThread(); }
  
      VMTraps&amp; traps() { return m_traps; }
  
<span class="line-modified">!     void handleTraps(JSGlobalObject* globalObject, CallFrame* callFrame, VMTraps::Mask mask = VMTraps::Mask::allEventTypes()) { m_traps.handleTraps(globalObject, callFrame, mask); }</span>
  
      bool needTrapHandling() { return m_traps.needTrapHandling(); }
      bool needTrapHandling(VMTraps::Mask mask) { return m_traps.needTrapHandling(mask); }
      void* needTrapHandlingAddress() { return m_traps.needTrapHandlingAddress(); }
  
      void notifyNeedDebuggerBreak() { m_traps.fireTrap(VMTraps::NeedDebuggerBreak); }
<span class="line-added">+     void notifyNeedShellTimeoutCheck() { m_traps.fireTrap(VMTraps::NeedShellTimeoutCheck); }</span>
      void notifyNeedTermination() { m_traps.fireTrap(VMTraps::NeedTermination); }
      void notifyNeedWatchdogCheck() { m_traps.fireTrap(VMTraps::NeedWatchdogCheck); }
  
      void promiseRejected(JSPromise*);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 966,11 ***</span>
  
      void updateStackLimits();
  
      bool isSafeToRecurse(void* stackLimit) const
      {
<span class="line-removed">-         ASSERT(Thread::current().stack().isGrowingDownward());</span>
          void* curr = currentStackPointer();
          return curr &gt;= stackLimit;
      }
  
      void setException(Exception* exception)
<span class="line-new-header">--- 1129,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 998,13 ***</span>
  #if ENABLE(C_LOOP)
      bool ensureStackCapacityForCLoop(Register* newTopOfStack);
      bool isSafeToRecurseSoftCLoop() const;
  #endif // ENABLE(C_LOOP)
  
<span class="line-modified">!     JS_EXPORT_PRIVATE Exception* throwException(ExecState*, Exception*);</span>
<span class="line-modified">!     JS_EXPORT_PRIVATE Exception* throwException(ExecState*, JSValue);</span>
<span class="line-modified">!     JS_EXPORT_PRIVATE Exception* throwException(ExecState*, JSObject*);</span>
  
  #if ENABLE(EXCEPTION_SCOPE_VERIFICATION)
      void verifyExceptionCheckNeedIsSatisfied(unsigned depth, ExceptionEventLocation&amp;);
  #endif
  
<span class="line-new-header">--- 1160,13 ---</span>
  #if ENABLE(C_LOOP)
      bool ensureStackCapacityForCLoop(Register* newTopOfStack);
      bool isSafeToRecurseSoftCLoop() const;
  #endif // ENABLE(C_LOOP)
  
<span class="line-modified">!     JS_EXPORT_PRIVATE Exception* throwException(JSGlobalObject*, Exception*);</span>
<span class="line-modified">!     JS_EXPORT_PRIVATE Exception* throwException(JSGlobalObject*, JSValue);</span>
<span class="line-modified">!     JS_EXPORT_PRIVATE Exception* throwException(JSGlobalObject*, JSObject*);</span>
  
  #if ENABLE(EXCEPTION_SCOPE_VERIFICATION)
      void verifyExceptionCheckNeedIsSatisfied(unsigned depth, ExceptionEventLocation&amp;);
  #endif
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1043,24 ***</span>
      DeletePropertyMode m_deletePropertyMode { DeletePropertyMode::Default };
      bool m_globalConstRedeclarationShouldThrow { true };
      bool m_shouldBuildPCToCodeOriginMapping { false };
      std::unique_ptr&lt;CodeCache&gt; m_codeCache;
      std::unique_ptr&lt;BuiltinExecutables&gt; m_builtinExecutables;
<span class="line-modified">!     HashMap&lt;String, RefPtr&lt;WatchpointSet&gt;&gt; m_impurePropertyWatchpointSets;</span>
      std::unique_ptr&lt;TypeProfiler&gt; m_typeProfiler;
      std::unique_ptr&lt;TypeProfilerLog&gt; m_typeProfilerLog;
      unsigned m_typeProfilerEnabledCount;
      bool m_needToFirePrimitiveGigacageEnabled { false };
      Lock m_scratchBufferLock;
      Vector&lt;ScratchBuffer*&gt; m_scratchBuffers;
      size_t m_sizeOfLastScratchBuffer { 0 };
      InlineWatchpointSet m_primitiveGigacageEnabled;
      FunctionHasExecutedCache m_functionHasExecutedCache;
      std::unique_ptr&lt;ControlFlowProfiler&gt; m_controlFlowProfiler;
      unsigned m_controlFlowProfilerEnabledCount;
      Deque&lt;std::unique_ptr&lt;QueuedTask&gt;&gt; m_microtaskQueue;
<span class="line-modified">!     MallocPtr&lt;EncodedJSValue&gt; m_exceptionFuzzBuffer;</span>
      VMTraps m_traps;
      RefPtr&lt;Watchdog&gt; m_watchdog;
      std::unique_ptr&lt;HeapProfiler&gt; m_heapProfiler;
  #if ENABLE(SAMPLING_PROFILER)
      RefPtr&lt;SamplingProfiler&gt; m_samplingProfiler;
<span class="line-new-header">--- 1205,25 ---</span>
      DeletePropertyMode m_deletePropertyMode { DeletePropertyMode::Default };
      bool m_globalConstRedeclarationShouldThrow { true };
      bool m_shouldBuildPCToCodeOriginMapping { false };
      std::unique_ptr&lt;CodeCache&gt; m_codeCache;
      std::unique_ptr&lt;BuiltinExecutables&gt; m_builtinExecutables;
<span class="line-modified">!     HashMap&lt;RefPtr&lt;UniquedStringImpl&gt;, RefPtr&lt;WatchpointSet&gt;&gt; m_impurePropertyWatchpointSets;</span>
      std::unique_ptr&lt;TypeProfiler&gt; m_typeProfiler;
      std::unique_ptr&lt;TypeProfilerLog&gt; m_typeProfilerLog;
      unsigned m_typeProfilerEnabledCount;
      bool m_needToFirePrimitiveGigacageEnabled { false };
      Lock m_scratchBufferLock;
      Vector&lt;ScratchBuffer*&gt; m_scratchBuffers;
      size_t m_sizeOfLastScratchBuffer { 0 };
<span class="line-added">+     HashMap&lt;CallFrame*, std::unique_ptr&lt;CheckpointOSRExitSideState&gt;&gt; m_checkpointSideState;</span>
      InlineWatchpointSet m_primitiveGigacageEnabled;
      FunctionHasExecutedCache m_functionHasExecutedCache;
      std::unique_ptr&lt;ControlFlowProfiler&gt; m_controlFlowProfiler;
      unsigned m_controlFlowProfilerEnabledCount;
      Deque&lt;std::unique_ptr&lt;QueuedTask&gt;&gt; m_microtaskQueue;
<span class="line-modified">!     MallocPtr&lt;EncodedJSValue, VMMalloc&gt; m_exceptionFuzzBuffer;</span>
      VMTraps m_traps;
      RefPtr&lt;Watchdog&gt; m_watchdog;
      std::unique_ptr&lt;HeapProfiler&gt; m_heapProfiler;
  #if ENABLE(SAMPLING_PROFILER)
      RefPtr&lt;SamplingProfiler&gt; m_samplingProfiler;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1074,11 ***</span>
  
      WTF::Function&lt;void(VM&amp;)&gt; m_onEachMicrotaskTick;
      uintptr_t m_currentWeakRefVersion { 0 };
  
  #if ENABLE(JIT)
<span class="line-modified">! #if !ASSERT_DISABLED</span>
      JS_EXPORT_PRIVATE static bool s_canUseJITIsSet;
  #endif
      JS_EXPORT_PRIVATE static bool s_canUseJIT;
  #endif
  
<span class="line-new-header">--- 1237,11 ---</span>
  
      WTF::Function&lt;void(VM&amp;)&gt; m_onEachMicrotaskTick;
      uintptr_t m_currentWeakRefVersion { 0 };
  
  #if ENABLE(JIT)
<span class="line-modified">! #if ASSERT_ENABLED</span>
      JS_EXPORT_PRIVATE static bool s_canUseJITIsSet;
  #endif
      JS_EXPORT_PRIVATE static bool s_canUseJIT;
  #endif
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1087,10 ***</span>
<span class="line-new-header">--- 1250,11 ---</span>
  
      // Friends for exception checking purpose only.
      friend class Heap;
      friend class CatchScope;
      friend class ExceptionScope;
<span class="line-added">+     friend class JSDollarVMHelper;</span>
      friend class ThrowScope;
      friend class VMTraps;
      friend class WTF::DoublyLinkedListNode&lt;VM&gt;;
  };
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1106,11 ***</span>
  }
  #endif
  
  inline Heap* WeakSet::heap() const
  {
<span class="line-modified">!     return &amp;m_vm.heap;</span>
  }
  
  #if !ENABLE(C_LOOP)
  extern &quot;C&quot; void sanitizeStackForVMImpl(VM*);
  #endif
<span class="line-new-header">--- 1270,11 ---</span>
  }
  #endif
  
  inline Heap* WeakSet::heap() const
  {
<span class="line-modified">!     return &amp;m_vm-&gt;heap;</span>
  }
  
  #if !ENABLE(C_LOOP)
  extern &quot;C&quot; void sanitizeStackForVMImpl(VM*);
  #endif
</pre>
<center><a href="VM.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="VMEntryScope.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>