<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/loader/ResourceLoadStatistics.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ResourceLoadObserver.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ResourceLoadStatistics.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/loader/ResourceLoadStatistics.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 78 
 79 void ResourceLoadStatistics::encode(KeyedEncoder&amp; encoder) const
 80 {
 81     encoder.encodeString(&quot;PrevalentResourceDomain&quot;_s, registrableDomain.string());
 82 
 83     encoder.encodeDouble(&quot;lastSeen&quot;_s, lastSeen.secondsSinceEpoch().value());
 84 
 85     // User interaction
 86     encoder.encodeBool(&quot;hadUserInteraction&quot;_s, hadUserInteraction);
 87     encoder.encodeDouble(&quot;mostRecentUserInteraction&quot;_s, mostRecentUserInteractionTime.secondsSinceEpoch().value());
 88     encoder.encodeBool(&quot;grandfathered&quot;_s, grandfathered);
 89 
 90     // Storage access
 91     encodeHashSet(encoder, &quot;storageAccessUnderTopFrameDomains&quot;_s, &quot;domain&quot;_s, storageAccessUnderTopFrameDomains);
 92 
 93     // Top frame stats
 94     encodeHashSet(encoder, &quot;topFrameUniqueRedirectsTo&quot;_s, &quot;domain&quot;_s, topFrameUniqueRedirectsTo);
 95     encodeHashSet(encoder, &quot;topFrameUniqueRedirectsFrom&quot;_s, &quot;domain&quot;_s, topFrameUniqueRedirectsFrom);
 96     encodeHashSet(encoder, &quot;topFrameLinkDecorationsFrom&quot;_s, &quot;domain&quot;, topFrameLinkDecorationsFrom);
 97     encoder.encodeBool(&quot;gotLinkDecorationFromPrevalentResource&quot;_s, gotLinkDecorationFromPrevalentResource);

 98 
 99     // Subframe stats
100     encodeHashSet(encoder, &quot;subframeUnderTopFrameDomains&quot;_s, &quot;domain&quot;_s, subframeUnderTopFrameDomains);
101 
102     // Subresource stats
103     encodeHashSet(encoder, &quot;subresourceUnderTopFrameDomains&quot;_s, &quot;domain&quot;_s, subresourceUnderTopFrameDomains);
104     encodeHashSet(encoder, &quot;subresourceUniqueRedirectsTo&quot;_s, &quot;domain&quot;_s, subresourceUniqueRedirectsTo);
105     encodeHashSet(encoder, &quot;subresourceUniqueRedirectsFrom&quot;_s, &quot;domain&quot;_s, subresourceUniqueRedirectsFrom);
106 
107     // Prevalent Resource
108     encoder.encodeBool(&quot;isPrevalentResource&quot;_s, isPrevalentResource);
109     encoder.encodeBool(&quot;isVeryPrevalentResource&quot;_s, isVeryPrevalentResource);
110     encoder.encodeUInt32(&quot;dataRecordsRemoved&quot;_s, dataRecordsRemoved);
111 
112     encoder.encodeUInt32(&quot;timesAccessedAsFirstPartyDueToUserInteraction&quot;_s, timesAccessedAsFirstPartyDueToUserInteraction);
113     encoder.encodeUInt32(&quot;timesAccessedAsFirstPartyDueToStorageAccessAPI&quot;_s, timesAccessedAsFirstPartyDueToStorageAccessAPI);
114 
115 #if ENABLE(WEB_API_STATISTICS)
116     encodeFontHashSet(encoder, &quot;fontsFailedToLoad&quot;, fontsFailedToLoad);
117     encodeFontHashSet(encoder, &quot;fontsSuccessfullyLoaded&quot;, fontsSuccessfullyLoaded);
</pre>
<hr />
<pre>
208         decodeHashSet(decoder, &quot;topFrameUniqueRedirectsTo&quot;, &quot;domain&quot;, topFrameUniqueRedirectsTo);
209         decodeHashSet(decoder, &quot;topFrameUniqueRedirectsFrom&quot;, &quot;domain&quot;, topFrameUniqueRedirectsFrom);
210     } else if (modelVersion &gt;= 11) {
211         HashCountedSet&lt;RegistrableDomain&gt; topFrameUniqueRedirectsToCounted;
212         decodeHashCountedSet(decoder, &quot;topFrameUniqueRedirectsTo&quot;, topFrameUniqueRedirectsToCounted);
213         for (auto&amp; domain : topFrameUniqueRedirectsToCounted.values())
214             topFrameUniqueRedirectsTo.add(domain);
215 
216         HashCountedSet&lt;RegistrableDomain&gt; topFrameUniqueRedirectsFromCounted;
217         decodeHashCountedSet(decoder, &quot;topFrameUniqueRedirectsFrom&quot;, topFrameUniqueRedirectsFromCounted);
218         for (auto&amp; domain : topFrameUniqueRedirectsFromCounted.values())
219             topFrameUniqueRedirectsFrom.add(domain);
220     }
221 
222     if (modelVersion &gt;= 16) {
223         decodeHashSet(decoder, &quot;topFrameLinkDecorationsFrom&quot;, &quot;domain&quot;, topFrameLinkDecorationsFrom);
224         if (!decoder.decodeBool(&quot;gotLinkDecorationFromPrevalentResource&quot;, gotLinkDecorationFromPrevalentResource))
225             return false;
226     }
227 







228     // Subframe stats
229     if (modelVersion &gt;= 15)
230         decodeHashSet(decoder, &quot;subframeUnderTopFrameDomains&quot;, &quot;domain&quot;, subframeUnderTopFrameDomains);
231     else if (modelVersion &gt;= 14) {
232         HashCountedSet&lt;RegistrableDomain&gt; subframeUnderTopFrameDomainsCounted;
233         decodeHashCountedSet(decoder, &quot;subframeUnderTopFrameOrigins&quot;, subframeUnderTopFrameDomainsCounted);
234         for (auto&amp; domain : subframeUnderTopFrameDomainsCounted.values())
235             subframeUnderTopFrameDomains.add(domain);
236     }
237 
238     // Subresource stats
239     if (modelVersion &gt;= 15) {
240         decodeHashSet(decoder, &quot;subresourceUnderTopFrameDomains&quot;, &quot;domain&quot;, subresourceUnderTopFrameDomains);
241         decodeHashSet(decoder, &quot;subresourceUniqueRedirectsTo&quot;, &quot;domain&quot;, subresourceUniqueRedirectsTo);
242         decodeHashSet(decoder, &quot;subresourceUniqueRedirectsFrom&quot;, &quot;domain&quot;, subresourceUniqueRedirectsFrom);
243     } else {
244         HashCountedSet&lt;RegistrableDomain&gt; subresourceUnderTopFrameDomainsCounted;
245         decodeHashCountedSet(decoder, &quot;subresourceUnderTopFrameOrigins&quot;, subresourceUnderTopFrameDomainsCounted);
246         for (auto&amp; domain : subresourceUnderTopFrameDomainsCounted.values())
247             subresourceUnderTopFrameDomains.add(domain);
</pre>
<hr />
<pre>
388     for (auto navigatorAPI : optionSet) {
389         builder.appendLiteral(&quot;        &quot;);
390         builder.append(navigatorAPIEnumToString(navigatorAPI).characters());
391         builder.append(&#39;\n&#39;);
392     }
393 }
394 
395 static void appendScreenAPIOptionSet(StringBuilder&amp; builder, const OptionSet&lt;ResourceLoadStatistics::ScreenAPI&gt;&amp; optionSet)
396 {
397     if (optionSet.isEmpty())
398         return;
399     builder.appendLiteral(&quot;    screenFunctionsAccessed:\n&quot;);
400     for (auto screenAPI : optionSet) {
401         builder.appendLiteral(&quot;        &quot;);
402         builder.append(screenAPIEnumToString(screenAPI).characters());
403         builder.append(&#39;\n&#39;);
404     }
405 }
406 #endif
407 





408 String ResourceLoadStatistics::toString() const
409 {
410     StringBuilder builder;
411     builder.appendLiteral(&quot;Registrable domain: &quot;);
412     builder.append(registrableDomain.string());
413     builder.append(&#39;\n&#39;);
<span class="line-removed">414     builder.appendLiteral(&quot;    lastSeen: &quot;);</span>
<span class="line-removed">415     builder.appendFixedPrecisionNumber(lastSeen.secondsSinceEpoch().value());</span>
<span class="line-removed">416     builder.append(&#39;\n&#39;);</span>
417 
418     // User interaction
419     appendBoolean(builder, &quot;hadUserInteraction&quot;, hadUserInteraction);
420     builder.append(&#39;\n&#39;);
421     builder.appendLiteral(&quot;    mostRecentUserInteraction: &quot;);
<span class="line-modified">422     builder.appendFixedPrecisionNumber(mostRecentUserInteractionTime.secondsSinceEpoch().value());</span>



423     builder.append(&#39;\n&#39;);
424     appendBoolean(builder, &quot;grandfathered&quot;, grandfathered);
425     builder.append(&#39;\n&#39;);
426 
427     // Storage access
428     appendHashSet(builder, &quot;storageAccessUnderTopFrameDomains&quot;, storageAccessUnderTopFrameDomains);
429 
430     // Top frame stats
431     appendHashSet(builder, &quot;topFrameUniqueRedirectsTo&quot;, topFrameUniqueRedirectsTo);
432     appendHashSet(builder, &quot;topFrameUniqueRedirectsFrom&quot;, topFrameUniqueRedirectsFrom);
433     appendHashSet(builder, &quot;topFrameLinkDecorationsFrom&quot;, topFrameLinkDecorationsFrom);
434     appendBoolean(builder, &quot;gotLinkDecorationFromPrevalentResource&quot;, gotLinkDecorationFromPrevalentResource);


435 
436     // Subframe stats
437     appendHashSet(builder, &quot;subframeUnderTopFrameDomains&quot;, subframeUnderTopFrameDomains);
438 
439     // Subresource stats
440     appendHashSet(builder, &quot;subresourceUnderTopFrameDomains&quot;, subresourceUnderTopFrameDomains);
441     appendHashSet(builder, &quot;subresourceUniqueRedirectsTo&quot;, subresourceUniqueRedirectsTo);
442     appendHashSet(builder, &quot;subresourceUniqueRedirectsFrom&quot;, subresourceUniqueRedirectsFrom);
443 
444     // Prevalent Resource
445     appendBoolean(builder, &quot;isPrevalentResource&quot;, isPrevalentResource);
446     builder.append(&#39;\n&#39;);
447     appendBoolean(builder, &quot;isVeryPrevalentResource&quot;, isVeryPrevalentResource);
448     builder.append(&#39;\n&#39;);
449     builder.appendLiteral(&quot;    dataRecordsRemoved: &quot;);
450     builder.appendNumber(dataRecordsRemoved);
451     builder.append(&#39;\n&#39;);
452 
453 #if ENABLE(WEB_API_STATISTICS)
454     appendHashSet(builder, &quot;fontsFailedToLoad&quot;, fontsFailedToLoad);
</pre>
<hr />
<pre>
491         // Else, do nothing.
492         if (!other.mostRecentUserInteractionTime) {
493             hadUserInteraction = false;
494             mostRecentUserInteractionTime = { };
495         }
496     } else {
497         hadUserInteraction = true;
498         if (mostRecentUserInteractionTime &lt; other.mostRecentUserInteractionTime)
499             mostRecentUserInteractionTime = other.mostRecentUserInteractionTime;
500     }
501     grandfathered |= other.grandfathered;
502 
503     // Storage access
504     mergeHashSet(storageAccessUnderTopFrameDomains, other.storageAccessUnderTopFrameDomains);
505 
506     // Top frame stats
507     mergeHashSet(topFrameUniqueRedirectsTo, other.topFrameUniqueRedirectsTo);
508     mergeHashSet(topFrameUniqueRedirectsFrom, other.topFrameUniqueRedirectsFrom);
509     mergeHashSet(topFrameLinkDecorationsFrom, other.topFrameLinkDecorationsFrom);
510     gotLinkDecorationFromPrevalentResource |= other.gotLinkDecorationFromPrevalentResource;

511 
512     // Subframe stats
513     mergeHashSet(subframeUnderTopFrameDomains, other.subframeUnderTopFrameDomains);
514 
515     // Subresource stats
516     mergeHashSet(subresourceUnderTopFrameDomains, other.subresourceUnderTopFrameDomains);
517     mergeHashSet(subresourceUniqueRedirectsTo, other.subresourceUniqueRedirectsTo);
518     mergeHashSet(subresourceUniqueRedirectsFrom, other.subresourceUniqueRedirectsFrom);
519 
520     // Prevalent resource stats
521     isPrevalentResource |= other.isPrevalentResource;
522     isVeryPrevalentResource |= other.isVeryPrevalentResource;
523     dataRecordsRemoved = std::max(dataRecordsRemoved, other.dataRecordsRemoved);
524 
525 #if ENABLE(WEB_API_STATISTICS)
526     mergeHashSet(fontsFailedToLoad, other.fontsFailedToLoad);
527     mergeHashSet(fontsSuccessfullyLoaded, other.fontsSuccessfullyLoaded);
528     mergeHashSet(topFrameRegistrableDomainsWhichAccessedWebAPIs, other.topFrameRegistrableDomainsWhichAccessedWebAPIs);
529     canvasActivityRecord.mergeWith(other.canvasActivityRecord);
530     navigatorFunctionsAccessed.add(other.navigatorFunctionsAccessed);
</pre>
</td>
<td>
<hr />
<pre>
 78 
 79 void ResourceLoadStatistics::encode(KeyedEncoder&amp; encoder) const
 80 {
 81     encoder.encodeString(&quot;PrevalentResourceDomain&quot;_s, registrableDomain.string());
 82 
 83     encoder.encodeDouble(&quot;lastSeen&quot;_s, lastSeen.secondsSinceEpoch().value());
 84 
 85     // User interaction
 86     encoder.encodeBool(&quot;hadUserInteraction&quot;_s, hadUserInteraction);
 87     encoder.encodeDouble(&quot;mostRecentUserInteraction&quot;_s, mostRecentUserInteractionTime.secondsSinceEpoch().value());
 88     encoder.encodeBool(&quot;grandfathered&quot;_s, grandfathered);
 89 
 90     // Storage access
 91     encodeHashSet(encoder, &quot;storageAccessUnderTopFrameDomains&quot;_s, &quot;domain&quot;_s, storageAccessUnderTopFrameDomains);
 92 
 93     // Top frame stats
 94     encodeHashSet(encoder, &quot;topFrameUniqueRedirectsTo&quot;_s, &quot;domain&quot;_s, topFrameUniqueRedirectsTo);
 95     encodeHashSet(encoder, &quot;topFrameUniqueRedirectsFrom&quot;_s, &quot;domain&quot;_s, topFrameUniqueRedirectsFrom);
 96     encodeHashSet(encoder, &quot;topFrameLinkDecorationsFrom&quot;_s, &quot;domain&quot;, topFrameLinkDecorationsFrom);
 97     encoder.encodeBool(&quot;gotLinkDecorationFromPrevalentResource&quot;_s, gotLinkDecorationFromPrevalentResource);
<span class="line-added"> 98     encodeHashSet(encoder, &quot;topFrameLoadedThirdPartyScripts&quot;_s, &quot;domain&quot;, topFrameLoadedThirdPartyScripts);</span>
 99 
100     // Subframe stats
101     encodeHashSet(encoder, &quot;subframeUnderTopFrameDomains&quot;_s, &quot;domain&quot;_s, subframeUnderTopFrameDomains);
102 
103     // Subresource stats
104     encodeHashSet(encoder, &quot;subresourceUnderTopFrameDomains&quot;_s, &quot;domain&quot;_s, subresourceUnderTopFrameDomains);
105     encodeHashSet(encoder, &quot;subresourceUniqueRedirectsTo&quot;_s, &quot;domain&quot;_s, subresourceUniqueRedirectsTo);
106     encodeHashSet(encoder, &quot;subresourceUniqueRedirectsFrom&quot;_s, &quot;domain&quot;_s, subresourceUniqueRedirectsFrom);
107 
108     // Prevalent Resource
109     encoder.encodeBool(&quot;isPrevalentResource&quot;_s, isPrevalentResource);
110     encoder.encodeBool(&quot;isVeryPrevalentResource&quot;_s, isVeryPrevalentResource);
111     encoder.encodeUInt32(&quot;dataRecordsRemoved&quot;_s, dataRecordsRemoved);
112 
113     encoder.encodeUInt32(&quot;timesAccessedAsFirstPartyDueToUserInteraction&quot;_s, timesAccessedAsFirstPartyDueToUserInteraction);
114     encoder.encodeUInt32(&quot;timesAccessedAsFirstPartyDueToStorageAccessAPI&quot;_s, timesAccessedAsFirstPartyDueToStorageAccessAPI);
115 
116 #if ENABLE(WEB_API_STATISTICS)
117     encodeFontHashSet(encoder, &quot;fontsFailedToLoad&quot;, fontsFailedToLoad);
118     encodeFontHashSet(encoder, &quot;fontsSuccessfullyLoaded&quot;, fontsSuccessfullyLoaded);
</pre>
<hr />
<pre>
209         decodeHashSet(decoder, &quot;topFrameUniqueRedirectsTo&quot;, &quot;domain&quot;, topFrameUniqueRedirectsTo);
210         decodeHashSet(decoder, &quot;topFrameUniqueRedirectsFrom&quot;, &quot;domain&quot;, topFrameUniqueRedirectsFrom);
211     } else if (modelVersion &gt;= 11) {
212         HashCountedSet&lt;RegistrableDomain&gt; topFrameUniqueRedirectsToCounted;
213         decodeHashCountedSet(decoder, &quot;topFrameUniqueRedirectsTo&quot;, topFrameUniqueRedirectsToCounted);
214         for (auto&amp; domain : topFrameUniqueRedirectsToCounted.values())
215             topFrameUniqueRedirectsTo.add(domain);
216 
217         HashCountedSet&lt;RegistrableDomain&gt; topFrameUniqueRedirectsFromCounted;
218         decodeHashCountedSet(decoder, &quot;topFrameUniqueRedirectsFrom&quot;, topFrameUniqueRedirectsFromCounted);
219         for (auto&amp; domain : topFrameUniqueRedirectsFromCounted.values())
220             topFrameUniqueRedirectsFrom.add(domain);
221     }
222 
223     if (modelVersion &gt;= 16) {
224         decodeHashSet(decoder, &quot;topFrameLinkDecorationsFrom&quot;, &quot;domain&quot;, topFrameLinkDecorationsFrom);
225         if (!decoder.decodeBool(&quot;gotLinkDecorationFromPrevalentResource&quot;, gotLinkDecorationFromPrevalentResource))
226             return false;
227     }
228 
<span class="line-added">229     if (modelVersion &gt;= 17) {</span>
<span class="line-added">230         HashCountedSet&lt;RegistrableDomain&gt; topFrameLoadedThirdPartyScriptsCounted;</span>
<span class="line-added">231         decodeHashCountedSet(decoder, &quot;topFrameLoadedThirdPartyScripts&quot;, topFrameLoadedThirdPartyScriptsCounted);</span>
<span class="line-added">232         for (auto&amp; domain : topFrameLoadedThirdPartyScriptsCounted.values())</span>
<span class="line-added">233             topFrameLoadedThirdPartyScripts.add(domain);</span>
<span class="line-added">234     }</span>
<span class="line-added">235 </span>
236     // Subframe stats
237     if (modelVersion &gt;= 15)
238         decodeHashSet(decoder, &quot;subframeUnderTopFrameDomains&quot;, &quot;domain&quot;, subframeUnderTopFrameDomains);
239     else if (modelVersion &gt;= 14) {
240         HashCountedSet&lt;RegistrableDomain&gt; subframeUnderTopFrameDomainsCounted;
241         decodeHashCountedSet(decoder, &quot;subframeUnderTopFrameOrigins&quot;, subframeUnderTopFrameDomainsCounted);
242         for (auto&amp; domain : subframeUnderTopFrameDomainsCounted.values())
243             subframeUnderTopFrameDomains.add(domain);
244     }
245 
246     // Subresource stats
247     if (modelVersion &gt;= 15) {
248         decodeHashSet(decoder, &quot;subresourceUnderTopFrameDomains&quot;, &quot;domain&quot;, subresourceUnderTopFrameDomains);
249         decodeHashSet(decoder, &quot;subresourceUniqueRedirectsTo&quot;, &quot;domain&quot;, subresourceUniqueRedirectsTo);
250         decodeHashSet(decoder, &quot;subresourceUniqueRedirectsFrom&quot;, &quot;domain&quot;, subresourceUniqueRedirectsFrom);
251     } else {
252         HashCountedSet&lt;RegistrableDomain&gt; subresourceUnderTopFrameDomainsCounted;
253         decodeHashCountedSet(decoder, &quot;subresourceUnderTopFrameOrigins&quot;, subresourceUnderTopFrameDomainsCounted);
254         for (auto&amp; domain : subresourceUnderTopFrameDomainsCounted.values())
255             subresourceUnderTopFrameDomains.add(domain);
</pre>
<hr />
<pre>
396     for (auto navigatorAPI : optionSet) {
397         builder.appendLiteral(&quot;        &quot;);
398         builder.append(navigatorAPIEnumToString(navigatorAPI).characters());
399         builder.append(&#39;\n&#39;);
400     }
401 }
402 
403 static void appendScreenAPIOptionSet(StringBuilder&amp; builder, const OptionSet&lt;ResourceLoadStatistics::ScreenAPI&gt;&amp; optionSet)
404 {
405     if (optionSet.isEmpty())
406         return;
407     builder.appendLiteral(&quot;    screenFunctionsAccessed:\n&quot;);
408     for (auto screenAPI : optionSet) {
409         builder.appendLiteral(&quot;        &quot;);
410         builder.append(screenAPIEnumToString(screenAPI).characters());
411         builder.append(&#39;\n&#39;);
412     }
413 }
414 #endif
415 
<span class="line-added">416 static bool hasHadRecentUserInteraction(WTF::Seconds interactionTimeSeconds)</span>
<span class="line-added">417 {</span>
<span class="line-added">418     return interactionTimeSeconds &gt; Seconds(0) &amp;&amp; WallTime::now().secondsSinceEpoch() - interactionTimeSeconds &lt; 24_h;</span>
<span class="line-added">419 }</span>
<span class="line-added">420 </span>
421 String ResourceLoadStatistics::toString() const
422 {
423     StringBuilder builder;
424     builder.appendLiteral(&quot;Registrable domain: &quot;);
425     builder.append(registrableDomain.string());
426     builder.append(&#39;\n&#39;);



427 
428     // User interaction
429     appendBoolean(builder, &quot;hadUserInteraction&quot;, hadUserInteraction);
430     builder.append(&#39;\n&#39;);
431     builder.appendLiteral(&quot;    mostRecentUserInteraction: &quot;);
<span class="line-modified">432     if (hasHadRecentUserInteraction(mostRecentUserInteractionTime.secondsSinceEpoch()))</span>
<span class="line-added">433         builder.appendLiteral(&quot;within 24 hours&quot;);</span>
<span class="line-added">434     else</span>
<span class="line-added">435         builder.appendLiteral(&quot;-1&quot;);</span>
436     builder.append(&#39;\n&#39;);
437     appendBoolean(builder, &quot;grandfathered&quot;, grandfathered);
438     builder.append(&#39;\n&#39;);
439 
440     // Storage access
441     appendHashSet(builder, &quot;storageAccessUnderTopFrameDomains&quot;, storageAccessUnderTopFrameDomains);
442 
443     // Top frame stats
444     appendHashSet(builder, &quot;topFrameUniqueRedirectsTo&quot;, topFrameUniqueRedirectsTo);
445     appendHashSet(builder, &quot;topFrameUniqueRedirectsFrom&quot;, topFrameUniqueRedirectsFrom);
446     appendHashSet(builder, &quot;topFrameLinkDecorationsFrom&quot;, topFrameLinkDecorationsFrom);
447     appendBoolean(builder, &quot;gotLinkDecorationFromPrevalentResource&quot;, gotLinkDecorationFromPrevalentResource);
<span class="line-added">448     builder.append(&#39;\n&#39;);</span>
<span class="line-added">449     appendHashSet(builder, &quot;topFrameLoadedThirdPartyScripts&quot;, topFrameLoadedThirdPartyScripts);</span>
450 
451     // Subframe stats
452     appendHashSet(builder, &quot;subframeUnderTopFrameDomains&quot;, subframeUnderTopFrameDomains);
453 
454     // Subresource stats
455     appendHashSet(builder, &quot;subresourceUnderTopFrameDomains&quot;, subresourceUnderTopFrameDomains);
456     appendHashSet(builder, &quot;subresourceUniqueRedirectsTo&quot;, subresourceUniqueRedirectsTo);
457     appendHashSet(builder, &quot;subresourceUniqueRedirectsFrom&quot;, subresourceUniqueRedirectsFrom);
458 
459     // Prevalent Resource
460     appendBoolean(builder, &quot;isPrevalentResource&quot;, isPrevalentResource);
461     builder.append(&#39;\n&#39;);
462     appendBoolean(builder, &quot;isVeryPrevalentResource&quot;, isVeryPrevalentResource);
463     builder.append(&#39;\n&#39;);
464     builder.appendLiteral(&quot;    dataRecordsRemoved: &quot;);
465     builder.appendNumber(dataRecordsRemoved);
466     builder.append(&#39;\n&#39;);
467 
468 #if ENABLE(WEB_API_STATISTICS)
469     appendHashSet(builder, &quot;fontsFailedToLoad&quot;, fontsFailedToLoad);
</pre>
<hr />
<pre>
506         // Else, do nothing.
507         if (!other.mostRecentUserInteractionTime) {
508             hadUserInteraction = false;
509             mostRecentUserInteractionTime = { };
510         }
511     } else {
512         hadUserInteraction = true;
513         if (mostRecentUserInteractionTime &lt; other.mostRecentUserInteractionTime)
514             mostRecentUserInteractionTime = other.mostRecentUserInteractionTime;
515     }
516     grandfathered |= other.grandfathered;
517 
518     // Storage access
519     mergeHashSet(storageAccessUnderTopFrameDomains, other.storageAccessUnderTopFrameDomains);
520 
521     // Top frame stats
522     mergeHashSet(topFrameUniqueRedirectsTo, other.topFrameUniqueRedirectsTo);
523     mergeHashSet(topFrameUniqueRedirectsFrom, other.topFrameUniqueRedirectsFrom);
524     mergeHashSet(topFrameLinkDecorationsFrom, other.topFrameLinkDecorationsFrom);
525     gotLinkDecorationFromPrevalentResource |= other.gotLinkDecorationFromPrevalentResource;
<span class="line-added">526     mergeHashSet(topFrameLoadedThirdPartyScripts, other.topFrameLoadedThirdPartyScripts);</span>
527 
528     // Subframe stats
529     mergeHashSet(subframeUnderTopFrameDomains, other.subframeUnderTopFrameDomains);
530 
531     // Subresource stats
532     mergeHashSet(subresourceUnderTopFrameDomains, other.subresourceUnderTopFrameDomains);
533     mergeHashSet(subresourceUniqueRedirectsTo, other.subresourceUniqueRedirectsTo);
534     mergeHashSet(subresourceUniqueRedirectsFrom, other.subresourceUniqueRedirectsFrom);
535 
536     // Prevalent resource stats
537     isPrevalentResource |= other.isPrevalentResource;
538     isVeryPrevalentResource |= other.isVeryPrevalentResource;
539     dataRecordsRemoved = std::max(dataRecordsRemoved, other.dataRecordsRemoved);
540 
541 #if ENABLE(WEB_API_STATISTICS)
542     mergeHashSet(fontsFailedToLoad, other.fontsFailedToLoad);
543     mergeHashSet(fontsSuccessfullyLoaded, other.fontsSuccessfullyLoaded);
544     mergeHashSet(topFrameRegistrableDomainsWhichAccessedWebAPIs, other.topFrameRegistrableDomainsWhichAccessedWebAPIs);
545     canvasActivityRecord.mergeWith(other.canvasActivityRecord);
546     navigatorFunctionsAccessed.add(other.navigatorFunctionsAccessed);
</pre>
</td>
</tr>
</table>
<center><a href="ResourceLoadObserver.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ResourceLoadStatistics.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>