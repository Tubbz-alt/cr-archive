<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/css/CSSValue.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CSSValue.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CSSValueKeywords.in.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/css/CSSValue.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -36,11 +36,14 @@</span>
  class DeprecatedCSSOMValue;
  class StyleSheetContents;
  
  enum CSSPropertyID : uint16_t;
  
<span class="udiff-line-modified-removed">- class CSSValue : public RefCounted&lt;CSSValue&gt; {</span>
<span class="udiff-line-modified-added">+ DECLARE_ALLOCATOR_WITH_HEAP_IDENTIFIER(CSSValue);</span>
<span class="udiff-line-added">+ class CSSValue {</span>
<span class="udiff-line-added">+     WTF_MAKE_NONCOPYABLE(CSSValue);</span>
<span class="udiff-line-added">+     WTF_MAKE_FAST_ALLOCATED_WITH_HEAP_IDENTIFIER(CSSValue);</span>
  public:
      enum Type {
          CSS_INHERIT = 0,
          CSS_PRIMITIVE_VALUE = 1,
          CSS_VALUE_LIST = 2,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -48,16 +51,30 @@</span>
          CSS_INITIAL = 4,
          CSS_UNSET = 5,
          CSS_REVERT = 6
      };
  
<span class="udiff-line-modified-removed">-     // Override RefCounted&#39;s deref() to ensure operator delete is called on</span>
<span class="udiff-line-modified-removed">-     // the appropriate subclass type.</span>
<span class="udiff-line-modified-added">+     static constexpr unsigned refCountFlagIsStatic = 0x1;</span>
<span class="udiff-line-modified-added">+     static constexpr unsigned refCountIncrement = 0x2; // This allows us to ref / deref without disturbing the static CSSValue flag.</span>
<span class="udiff-line-added">+     void ref() const</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         m_refCount += refCountIncrement;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     bool hasOneRef() const { return m_refCount == refCountIncrement; }</span>
<span class="udiff-line-added">+     unsigned refCount() const { return m_refCount / refCountIncrement; }</span>
<span class="udiff-line-added">+     bool hasAtLeastOneRef() const { return m_refCount; }</span>
<span class="udiff-line-added">+ </span>
      void deref()
      {
<span class="udiff-line-modified-removed">-         if (derefBase())</span>
<span class="udiff-line-modified-added">+         // Customized deref() to ensure operator delete is called on</span>
<span class="udiff-line-added">+         // the appropriate subclass type.</span>
<span class="udiff-line-added">+         unsigned tempRefCount = m_refCount - refCountIncrement;</span>
<span class="udiff-line-added">+         if (!tempRefCount) {</span>
              destroy();
<span class="udiff-line-added">+             return;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         m_refCount = tempRefCount;</span>
      }
  
      Type cssValueType() const;
      String cssText() const;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -210,10 +227,11 @@</span>
      enum ValueListSeparator {
          SpaceSeparator,
          CommaSeparator,
          SlashSeparator
      };
<span class="udiff-line-added">+     enum StaticCSSValueTag { StaticCSSValue };</span>
  
  protected:
      ClassType classType() const { return static_cast&lt;ClassType&gt;(m_classType); }
  
      explicit CSSValue(ClassType classType)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -223,24 +241,29 @@</span>
          , m_valueListSeparator(SpaceSeparator)
          , m_classType(classType)
      {
      }
  
<span class="udiff-line-added">+     void makeStatic()</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         m_refCount |= refCountFlagIsStatic;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      // NOTE: This class is non-virtual for memory and performance reasons.
      // Don&#39;t go making it virtual again unless you know exactly what you&#39;re doing!
  
      ~CSSValue() = default;
  
  private:
      WEBCORE_EXPORT void destroy();
  
<span class="udiff-line-added">+     mutable unsigned m_refCount { refCountIncrement };</span>
  protected:
      // The bits in this section are only used by specific subclasses but kept here
      // to maximize struct packing.
<span class="udiff-line-removed">- </span>
      // CSSPrimitiveValue bits:
<span class="udiff-line-modified-removed">-     unsigned m_primitiveUnitType : 7; // CSSPrimitiveValue::UnitType</span>
<span class="udiff-line-modified-added">+     unsigned m_primitiveUnitType : 7; // CSSUnitType</span>
      mutable unsigned m_hasCachedCSSText : 1;
      unsigned m_isQuirkValue : 1;
  
      unsigned m_valueListSeparator : ValueListSeparatorBits;
  
</pre>
<center><a href="CSSValue.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CSSValueKeywords.in.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>