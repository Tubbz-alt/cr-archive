<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Tools/DumpRenderTree/TestRunner.cpp</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="TestOptions.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="TestRunner.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Tools/DumpRenderTree/TestRunner.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  22  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  23  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  24  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  25  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  26  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  27  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  28  */
  29 
  30 #include &quot;config.h&quot;
  31 #include &quot;TestRunner.h&quot;
  32 
  33 #include &quot;WebCoreTestSupport.h&quot;
  34 #include &quot;WorkQueue.h&quot;
  35 #include &quot;WorkQueueItem.h&quot;
  36 #include &lt;JavaScriptCore/APICast.h&gt;
  37 #include &lt;JavaScriptCore/ArrayBufferView.h&gt;
  38 #include &lt;JavaScriptCore/HeapInlines.h&gt;
  39 #include &lt;JavaScriptCore/JSArrayBufferView.h&gt;
  40 #include &lt;JavaScriptCore/JSCTestRunnerUtils.h&gt;
  41 #include &lt;JavaScriptCore/JSContextRef.h&gt;

  42 #include &lt;JavaScriptCore/JSObjectRef.h&gt;
  43 #include &lt;JavaScriptCore/JSRetainPtr.h&gt;
  44 #include &lt;JavaScriptCore/TypedArrayInlines.h&gt;
  45 #include &lt;JavaScriptCore/VMInlines.h&gt;
  46 #include &lt;WebCore/LogInitialization.h&gt;
  47 #include &lt;cstring&gt;
  48 #include &lt;locale.h&gt;
  49 #include &lt;stdio.h&gt;
  50 #include &lt;wtf/Assertions.h&gt;
  51 #include &lt;wtf/LoggingAccumulator.h&gt;
  52 #include &lt;wtf/MathExtras.h&gt;
  53 #include &lt;wtf/RefPtr.h&gt;
  54 #include &lt;wtf/RunLoop.h&gt;
  55 #include &lt;wtf/StdLibExtras.h&gt;
  56 #include &lt;wtf/UniqueArray.h&gt;
  57 #include &lt;wtf/WallTime.h&gt;
  58 #include &lt;wtf/text/WTFString.h&gt;
  59 
  60 #if PLATFORM(IOS_FAMILY)
  61 #include &lt;WebCore/WebCoreThreadRun.h&gt;
</pre>
<hr />
<pre>
 568         return JSValueMakeUndefined(context);
 569 
 570     auto name = adopt(JSValueToStringCopy(context, arguments[0], exception));
 571     ASSERT(!*exception);
 572 
 573     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
 574 
 575     return JSValueMakeBoolean(context, controller-&gt;isCommandEnabled(name.get()));
 576 }
 577 
 578 static JSValueRef overridePreferenceCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
 579 {
 580     if (argumentCount &lt; 2)
 581         return JSValueMakeUndefined(context);
 582 
 583     auto key = adopt(JSValueToStringCopy(context, arguments[0], exception));
 584     ASSERT(!*exception);
 585     auto value = adopt(JSValueToStringCopy(context, arguments[1], exception));
 586     ASSERT(!*exception);
 587 



 588     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
 589     controller-&gt;overridePreference(key.get(), value.get());
 590 
 591     return JSValueMakeUndefined(context);
 592 }
 593 
 594 static JSValueRef keepWebHistoryCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
 595 {
 596     // Has mac implementation
 597     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
 598     controller-&gt;keepWebHistory();
 599 
 600     return JSValueMakeUndefined(context);
 601 }
 602 
 603 static JSValueRef notifyDoneCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
 604 {
 605     // Has mac &amp; windows implementation
 606     // May be able to be made platform independant by using shared WorkQueue
 607     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
</pre>
<hr />
<pre>
1113     ASSERT(!*exception);
1114 
1115     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
1116     controller-&gt;setPersistentUserStyleSheetLocation(path.get());
1117 
1118     return JSValueMakeUndefined(context);
1119 }
1120 
1121 static JSValueRef setPrivateBrowsingEnabledCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
1122 {
1123     // Has mac &amp; windows implementation
1124     if (argumentCount &lt; 1)
1125         return JSValueMakeUndefined(context);
1126 
1127     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
1128     controller-&gt;setPrivateBrowsingEnabled(JSValueToBoolean(context, arguments[0]));
1129 
1130     return JSValueMakeUndefined(context);
1131 }
1132 
























1133 static JSValueRef setJavaScriptCanAccessClipboardCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
1134 {
1135     // Has mac &amp; windows implementation
1136     if (argumentCount &lt; 1)
1137         return JSValueMakeUndefined(context);
1138 
1139     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
1140     controller-&gt;setJavaScriptCanAccessClipboard(JSValueToBoolean(context, arguments[0]));
1141 
1142     return JSValueMakeUndefined(context);
1143 }
1144 
1145 static JSValueRef setXSSAuditorEnabledCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
1146 {
1147     // Has mac &amp; windows implementation
1148     if (argumentCount &lt; 1)
1149         return JSValueMakeUndefined(context);
1150 
1151     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
1152     controller-&gt;setXSSAuditorEnabled(JSValueToBoolean(context, arguments[0]));
</pre>
<hr />
<pre>
1991     return JSC::numberOfDFGCompiles(context, arguments[0]);
1992 }
1993 
1994 static JSValueRef neverInlineFunction(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
1995 {
1996     if (argumentCount &lt; 1)
1997         return JSValueMakeUndefined(context);
1998 
1999     return JSC::setNeverInline(context, arguments[0]);
2000 }
2001 
2002 static JSValueRef accummulateLogsForChannel(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
2003 {
2004     if (argumentCount &lt; 1)
2005         return JSValueMakeUndefined(context);
2006 
2007     auto channel = adopt(JSValueToStringCopy(context, arguments[0], exception));
2008     ASSERT(!*exception);
2009 
2010     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
<span class="line-removed">2011 #if OS(WINDOWS) &amp;&amp; PLATFORM(JAVA)</span>
<span class="line-removed">2012     // FIXME : error LNK2019: unresolved external symbol</span>
<span class="line-removed">2013     // controller-&gt;setAccummulateLogsForChannel(channel.get());</span>
<span class="line-removed">2014 #else</span>
2015     controller-&gt;setAccummulateLogsForChannel(channel.get());
<span class="line-modified">2016 #endif</span>
2017     return JSValueMakeUndefined(context);
2018 }
2019 
2020 static JSValueRef runUIScriptCallback(JSContextRef context, JSObjectRef, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
2021 {
2022     if (argumentCount &lt; 1)
2023         return JSValueMakeUndefined(context);
2024 
2025     auto script = argumentCount &gt; 0 ? adopt(JSValueToStringCopy(context, arguments[0], 0)) : JSRetainPtr&lt;JSStringRef&gt;();
2026     JSValueRef callback = argumentCount &gt; 1 ? arguments[1] : JSValueMakeUndefined(context);
2027 
2028     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
2029     controller-&gt;runUIScript(context, script.get(), callback);
2030 
2031     return JSValueMakeUndefined(context);
2032 }
2033 
2034 static void testRunnerObjectFinalize(JSObjectRef object)
2035 {
2036     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(object));
</pre>
<hr />
<pre>
2208         { &quot;setDatabaseQuota&quot;, setDatabaseQuotaCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2209         { &quot;setDefersLoading&quot;, setDefersLoadingCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2210         { &quot;setUseDeferredFrameLoading&quot;, setUseDeferredFrameLoadingCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2211         { &quot;setDomainRelaxationForbiddenForURLScheme&quot;, setDomainRelaxationForbiddenForURLSchemeCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2212         { &quot;setGeolocationPermission&quot;, setGeolocationPermissionCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2213         { &quot;setRejectsProtectionSpaceAndContinueForAuthenticationChallenges&quot;, setRejectsProtectionSpaceAndContinueForAuthenticationChallengesCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2214         { &quot;setHandlesAuthenticationChallenges&quot;, setHandlesAuthenticationChallengesCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2215         { &quot;setIconDatabaseEnabled&quot;, setIconDatabaseEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2216         { &quot;setAutomaticLinkDetectionEnabled&quot;, setAutomaticLinkDetectionEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2217         { &quot;setMainFrameIsFirstResponder&quot;, setMainFrameIsFirstResponderCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2218         { &quot;setMockDeviceOrientation&quot;, setMockDeviceOrientationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2219         { &quot;setMockGeolocationPositionUnavailableError&quot;, setMockGeolocationPositionUnavailableErrorCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2220         { &quot;setMockGeolocationPosition&quot;, setMockGeolocationPositionCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2221         { &quot;setNewWindowsCopyBackForwardList&quot;, setNewWindowsCopyBackForwardListCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2222         { &quot;setPageVisibility&quot;, setPageVisibilityCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2223         { &quot;setPOSIXLocale&quot;, setPOSIXLocaleCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2224         { &quot;setPersistentUserStyleSheetLocation&quot;, setPersistentUserStyleSheetLocationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2225         { &quot;setPopupBlockingEnabled&quot;, setPopupBlockingEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2226         { &quot;setPluginsEnabled&quot;, setPluginsEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2227         { &quot;setPrinting&quot;, setPrintingCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
<span class="line-modified">2228         { &quot;setPrivateBrowsingEnabled&quot;, setPrivateBrowsingEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },</span>


2229         { &quot;setSerializeHTTPLoads&quot;, setSerializeHTTPLoadsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2230         { &quot;setSpatialNavigationEnabled&quot;, setSpatialNavigationEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2231         { &quot;setStopProvisionalFrameLoads&quot;, setStopProvisionalFrameLoadsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2232         { &quot;setTabKeyCyclesThroughElements&quot;, setTabKeyCyclesThroughElementsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2233 #if PLATFORM(IOS_FAMILY)
2234         { &quot;setTelephoneNumberParsingEnabled&quot;, setTelephoneNumberParsingEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2235         { &quot;setPagePaused&quot;, setPagePausedCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2236 #endif
2237         { &quot;setUserStyleSheetEnabled&quot;, setUserStyleSheetEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2238         { &quot;setUserStyleSheetLocation&quot;, setUserStyleSheetLocationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2239         { &quot;setValueForUser&quot;, setValueForUserCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2240         { &quot;setWebViewEditable&quot;, setWebViewEditableCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2241         { &quot;setWillSendRequestClearHeader&quot;, setWillSendRequestClearHeaderCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2242         { &quot;setWillSendRequestReturnsNull&quot;, setWillSendRequestReturnsNullCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2243         { &quot;setWillSendRequestReturnsNullOnRedirect&quot;, setWillSendRequestReturnsNullOnRedirectCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2244         { &quot;setWindowIsKey&quot;, setWindowIsKeyCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2245         { &quot;setViewSize&quot;, setViewSizeCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2246         { &quot;setJavaScriptCanAccessClipboard&quot;, setJavaScriptCanAccessClipboardCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2247         { &quot;setXSSAuditorEnabled&quot;, setXSSAuditorEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2248         { &quot;showWebInspector&quot;, showWebInspectorCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
</pre>
<hr />
<pre>
2372 
2373     return iterator-&gt;second.data();
2374 }
2375 
2376 void TestRunner::setRenderTreeDumpOptions(unsigned options)
2377 {
2378     m_renderTreeDumpOptions = options;
2379 }
2380 
2381 void TestRunner::setShouldPaintBrokenImage(bool shouldPaintBrokenImage)
2382 {
2383     m_shouldPaintBrokenImage = shouldPaintBrokenImage;
2384 }
2385 
2386 void TestRunner::setAccummulateLogsForChannel(JSStringRef channel)
2387 {
2388     size_t maxLength = JSStringGetMaximumUTF8CStringSize(channel);
2389     auto buffer = makeUniqueArray&lt;char&gt;(maxLength + 1);
2390     JSStringGetUTF8CString(channel, buffer.get(), maxLength + 1);
2391 
<span class="line-removed">2392 #if OS(WINDOWS) &amp;&amp; PLATFORM(JAVA)</span>
<span class="line-removed">2393     // FIXME : error LNK2019: unresolved external symbol</span>
<span class="line-removed">2394     // WebCoreTestSupport::setLogChannelToAccumulate({ buffer.get() });</span>
<span class="line-removed">2395 #else</span>
2396     WebCoreTestSupport::setLogChannelToAccumulate({ buffer.get() });
<span class="line-removed">2397 #endif</span>
2398 }
2399 
2400 typedef WTF::HashMap&lt;unsigned, JSValueRef&gt; CallbackMap;
2401 static CallbackMap&amp; callbackMap()
2402 {
2403     static CallbackMap&amp; map = *new CallbackMap;
2404     return map;
2405 }
2406 
2407 void TestRunner::cacheTestRunnerCallback(unsigned index, JSValueRef callback)
2408 {
2409     if (!callback)
2410         return;
2411 
2412     if (callbackMap().contains(index)) {
2413         fprintf(stderr, &quot;FAIL: Tried to install a second TestRunner callback for the same event (id %d)\n&quot;, index);
2414         return;
2415     }
2416 
2417     JSContextRef context = mainFrameJSContext();
</pre>
<hr />
<pre>
2478     });
2479 #else
2480     WebThreadRun(
2481         makeBlockPtr([protectedThis = makeRef(*this), callbackID, protectedResult] {
2482             JSContextRef context = protectedThis-&gt;mainFrameJSContext();
2483             JSValueRef resultValue = JSValueMakeString(context, protectedResult.get());
2484             protectedThis-&gt;callTestRunnerCallback(callbackID, 1, &amp;resultValue);
2485         }).get()
2486     );
2487 #endif
2488 }
2489 
2490 void TestRunner::uiScriptDidComplete(const String&amp; result, unsigned callbackID)
2491 {
2492     auto stringRef = adopt(JSStringCreateWithUTF8CString(result.utf8().data()));
2493     callUIScriptCallback(callbackID, stringRef.get());
2494 }
2495 
2496 void TestRunner::setAllowsAnySSLCertificate(bool allowsAnySSLCertificate)
2497 {
<span class="line-removed">2498 #if OS(WINDOWS) &amp;&amp; PLATFORM(JAVA)</span>
<span class="line-removed">2499     // FIXME : error LNK2019: unresolved external symbol</span>
<span class="line-removed">2500     // WebCoreTestSupport::setAllowsAnySSLCertificate(allowsAnySSLCertificate);</span>
<span class="line-removed">2501 #else</span>
2502     WebCoreTestSupport::setAllowsAnySSLCertificate(allowsAnySSLCertificate);
<span class="line-removed">2503 #endif</span>
2504 }
2505 
2506 void TestRunner::setOpenPanelFiles(JSContextRef context, JSValueRef filesValue)
2507 {
2508     if (!JSValueIsArray(context, filesValue))
2509         return;
2510 
2511     JSObjectRef files = JSValueToObject(context, filesValue, nullptr);
2512     static auto lengthProperty = adopt(JSStringCreateWithUTF8CString(&quot;length&quot;));
2513     JSValueRef filesLengthValue = JSObjectGetProperty(context, files, lengthProperty.get(), nullptr);
2514     if (!JSValueIsNumber(context, filesLengthValue))
2515         return;
2516 
2517     m_openPanelFiles.clear();
2518     auto filesLength = static_cast&lt;size_t&gt;(JSValueToNumber(context, filesLengthValue, nullptr));
2519     for (size_t i = 0; i &lt; filesLength; ++i) {
2520         JSValueRef fileValue = JSObjectGetPropertyAtIndex(context, files, i, nullptr);
2521         if (!JSValueIsString(context, fileValue))
2522             continue;
2523 
</pre>
<hr />
<pre>
2534 void TestRunner::setOpenPanelFilesMediaIcon(JSContextRef context, JSValueRef mediaIcon)
2535 {
2536     // FIXME (123058): Use a JSC API to get buffer contents once such is exposed.
2537     JSC::VM&amp; vm = toJS(context)-&gt;vm();
2538     JSC::JSLockHolder lock(vm);
2539 
2540     JSC::JSArrayBufferView* jsBufferView = JSC::jsDynamicCast&lt;JSC::JSArrayBufferView*&gt;(vm, toJS(toJS(context), mediaIcon));
2541     ASSERT(jsBufferView);
2542     RefPtr&lt;JSC::ArrayBufferView&gt; bufferView = jsBufferView-&gt;unsharedImpl();
2543     const char* buffer = static_cast&lt;const char*&gt;(bufferView-&gt;baseAddress());
2544     std::vector&lt;char&gt; mediaIconData(buffer, buffer + bufferView-&gt;byteLength());
2545 
2546     m_openPanelFilesMediaIcon = mediaIconData;
2547 }
2548 #endif
2549 
2550 void TestRunner::cleanup()
2551 {
2552     clearTestRunnerCallbacks();
2553 }










</pre>
</td>
<td>
<hr />
<pre>
  22  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  23  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  24  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  25  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  26  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  27  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  28  */
  29 
  30 #include &quot;config.h&quot;
  31 #include &quot;TestRunner.h&quot;
  32 
  33 #include &quot;WebCoreTestSupport.h&quot;
  34 #include &quot;WorkQueue.h&quot;
  35 #include &quot;WorkQueueItem.h&quot;
  36 #include &lt;JavaScriptCore/APICast.h&gt;
  37 #include &lt;JavaScriptCore/ArrayBufferView.h&gt;
  38 #include &lt;JavaScriptCore/HeapInlines.h&gt;
  39 #include &lt;JavaScriptCore/JSArrayBufferView.h&gt;
  40 #include &lt;JavaScriptCore/JSCTestRunnerUtils.h&gt;
  41 #include &lt;JavaScriptCore/JSContextRef.h&gt;
<span class="line-added">  42 #include &lt;JavaScriptCore/JSGlobalObjectInlines.h&gt;</span>
  43 #include &lt;JavaScriptCore/JSObjectRef.h&gt;
  44 #include &lt;JavaScriptCore/JSRetainPtr.h&gt;
  45 #include &lt;JavaScriptCore/TypedArrayInlines.h&gt;
  46 #include &lt;JavaScriptCore/VMInlines.h&gt;
  47 #include &lt;WebCore/LogInitialization.h&gt;
  48 #include &lt;cstring&gt;
  49 #include &lt;locale.h&gt;
  50 #include &lt;stdio.h&gt;
  51 #include &lt;wtf/Assertions.h&gt;
  52 #include &lt;wtf/LoggingAccumulator.h&gt;
  53 #include &lt;wtf/MathExtras.h&gt;
  54 #include &lt;wtf/RefPtr.h&gt;
  55 #include &lt;wtf/RunLoop.h&gt;
  56 #include &lt;wtf/StdLibExtras.h&gt;
  57 #include &lt;wtf/UniqueArray.h&gt;
  58 #include &lt;wtf/WallTime.h&gt;
  59 #include &lt;wtf/text/WTFString.h&gt;
  60 
  61 #if PLATFORM(IOS_FAMILY)
  62 #include &lt;WebCore/WebCoreThreadRun.h&gt;
</pre>
<hr />
<pre>
 569         return JSValueMakeUndefined(context);
 570 
 571     auto name = adopt(JSValueToStringCopy(context, arguments[0], exception));
 572     ASSERT(!*exception);
 573 
 574     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
 575 
 576     return JSValueMakeBoolean(context, controller-&gt;isCommandEnabled(name.get()));
 577 }
 578 
 579 static JSValueRef overridePreferenceCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
 580 {
 581     if (argumentCount &lt; 2)
 582         return JSValueMakeUndefined(context);
 583 
 584     auto key = adopt(JSValueToStringCopy(context, arguments[0], exception));
 585     ASSERT(!*exception);
 586     auto value = adopt(JSValueToStringCopy(context, arguments[1], exception));
 587     ASSERT(!*exception);
 588 
<span class="line-added"> 589     // Should use `&lt;!-- webkit-test-runner [ enableBackForwardCache=true ] --&gt;` instead.</span>
<span class="line-added"> 590     RELEASE_ASSERT(!JSStringIsEqualToUTF8CString(key.get(), &quot;WebKitUsesBackForwardCachePreferenceKey&quot;));</span>
<span class="line-added"> 591 </span>
 592     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
 593     controller-&gt;overridePreference(key.get(), value.get());
 594 
 595     return JSValueMakeUndefined(context);
 596 }
 597 
 598 static JSValueRef keepWebHistoryCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
 599 {
 600     // Has mac implementation
 601     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
 602     controller-&gt;keepWebHistory();
 603 
 604     return JSValueMakeUndefined(context);
 605 }
 606 
 607 static JSValueRef notifyDoneCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
 608 {
 609     // Has mac &amp; windows implementation
 610     // May be able to be made platform independant by using shared WorkQueue
 611     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
</pre>
<hr />
<pre>
1117     ASSERT(!*exception);
1118 
1119     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
1120     controller-&gt;setPersistentUserStyleSheetLocation(path.get());
1121 
1122     return JSValueMakeUndefined(context);
1123 }
1124 
1125 static JSValueRef setPrivateBrowsingEnabledCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
1126 {
1127     // Has mac &amp; windows implementation
1128     if (argumentCount &lt; 1)
1129         return JSValueMakeUndefined(context);
1130 
1131     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
1132     controller-&gt;setPrivateBrowsingEnabled(JSValueToBoolean(context, arguments[0]));
1133 
1134     return JSValueMakeUndefined(context);
1135 }
1136 
<span class="line-added">1137 static JSValueRef setShouldSwapToEphemeralSessionOnNextNavigationCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)</span>
<span class="line-added">1138 {</span>
<span class="line-added">1139     // Has mac &amp; windows implementation</span>
<span class="line-added">1140     if (argumentCount &lt; 1)</span>
<span class="line-added">1141         return JSValueMakeUndefined(context);</span>
<span class="line-added">1142 </span>
<span class="line-added">1143     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));</span>
<span class="line-added">1144     controller-&gt;setShouldSwapToEphemeralSessionOnNextNavigation(JSValueToBoolean(context, arguments[0]));</span>
<span class="line-added">1145 </span>
<span class="line-added">1146     return JSValueMakeUndefined(context);</span>
<span class="line-added">1147 }</span>
<span class="line-added">1148 </span>
<span class="line-added">1149 static JSValueRef setShouldSwapToDefaultSessionOnNextNavigationCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)</span>
<span class="line-added">1150 {</span>
<span class="line-added">1151     // Has mac &amp; windows implementation</span>
<span class="line-added">1152     if (argumentCount &lt; 1)</span>
<span class="line-added">1153         return JSValueMakeUndefined(context);</span>
<span class="line-added">1154 </span>
<span class="line-added">1155     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));</span>
<span class="line-added">1156     controller-&gt;setShouldSwapToDefaultSessionOnNextNavigation(JSValueToBoolean(context, arguments[0]));</span>
<span class="line-added">1157 </span>
<span class="line-added">1158     return JSValueMakeUndefined(context);</span>
<span class="line-added">1159 }</span>
<span class="line-added">1160 </span>
1161 static JSValueRef setJavaScriptCanAccessClipboardCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
1162 {
1163     // Has mac &amp; windows implementation
1164     if (argumentCount &lt; 1)
1165         return JSValueMakeUndefined(context);
1166 
1167     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
1168     controller-&gt;setJavaScriptCanAccessClipboard(JSValueToBoolean(context, arguments[0]));
1169 
1170     return JSValueMakeUndefined(context);
1171 }
1172 
1173 static JSValueRef setXSSAuditorEnabledCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
1174 {
1175     // Has mac &amp; windows implementation
1176     if (argumentCount &lt; 1)
1177         return JSValueMakeUndefined(context);
1178 
1179     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
1180     controller-&gt;setXSSAuditorEnabled(JSValueToBoolean(context, arguments[0]));
</pre>
<hr />
<pre>
2019     return JSC::numberOfDFGCompiles(context, arguments[0]);
2020 }
2021 
2022 static JSValueRef neverInlineFunction(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
2023 {
2024     if (argumentCount &lt; 1)
2025         return JSValueMakeUndefined(context);
2026 
2027     return JSC::setNeverInline(context, arguments[0]);
2028 }
2029 
2030 static JSValueRef accummulateLogsForChannel(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
2031 {
2032     if (argumentCount &lt; 1)
2033         return JSValueMakeUndefined(context);
2034 
2035     auto channel = adopt(JSValueToStringCopy(context, arguments[0], exception));
2036     ASSERT(!*exception);
2037 
2038     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));




2039     controller-&gt;setAccummulateLogsForChannel(channel.get());
<span class="line-modified">2040 </span>
2041     return JSValueMakeUndefined(context);
2042 }
2043 
2044 static JSValueRef runUIScriptCallback(JSContextRef context, JSObjectRef, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
2045 {
2046     if (argumentCount &lt; 1)
2047         return JSValueMakeUndefined(context);
2048 
2049     auto script = argumentCount &gt; 0 ? adopt(JSValueToStringCopy(context, arguments[0], 0)) : JSRetainPtr&lt;JSStringRef&gt;();
2050     JSValueRef callback = argumentCount &gt; 1 ? arguments[1] : JSValueMakeUndefined(context);
2051 
2052     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
2053     controller-&gt;runUIScript(context, script.get(), callback);
2054 
2055     return JSValueMakeUndefined(context);
2056 }
2057 
2058 static void testRunnerObjectFinalize(JSObjectRef object)
2059 {
2060     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(object));
</pre>
<hr />
<pre>
2232         { &quot;setDatabaseQuota&quot;, setDatabaseQuotaCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2233         { &quot;setDefersLoading&quot;, setDefersLoadingCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2234         { &quot;setUseDeferredFrameLoading&quot;, setUseDeferredFrameLoadingCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2235         { &quot;setDomainRelaxationForbiddenForURLScheme&quot;, setDomainRelaxationForbiddenForURLSchemeCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2236         { &quot;setGeolocationPermission&quot;, setGeolocationPermissionCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2237         { &quot;setRejectsProtectionSpaceAndContinueForAuthenticationChallenges&quot;, setRejectsProtectionSpaceAndContinueForAuthenticationChallengesCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2238         { &quot;setHandlesAuthenticationChallenges&quot;, setHandlesAuthenticationChallengesCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2239         { &quot;setIconDatabaseEnabled&quot;, setIconDatabaseEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2240         { &quot;setAutomaticLinkDetectionEnabled&quot;, setAutomaticLinkDetectionEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2241         { &quot;setMainFrameIsFirstResponder&quot;, setMainFrameIsFirstResponderCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2242         { &quot;setMockDeviceOrientation&quot;, setMockDeviceOrientationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2243         { &quot;setMockGeolocationPositionUnavailableError&quot;, setMockGeolocationPositionUnavailableErrorCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2244         { &quot;setMockGeolocationPosition&quot;, setMockGeolocationPositionCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2245         { &quot;setNewWindowsCopyBackForwardList&quot;, setNewWindowsCopyBackForwardListCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2246         { &quot;setPageVisibility&quot;, setPageVisibilityCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2247         { &quot;setPOSIXLocale&quot;, setPOSIXLocaleCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2248         { &quot;setPersistentUserStyleSheetLocation&quot;, setPersistentUserStyleSheetLocationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2249         { &quot;setPopupBlockingEnabled&quot;, setPopupBlockingEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2250         { &quot;setPluginsEnabled&quot;, setPluginsEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2251         { &quot;setPrinting&quot;, setPrintingCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
<span class="line-modified">2252         { &quot;setPrivateBrowsingEnabled_DEPRECATED&quot;, setPrivateBrowsingEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },</span>
<span class="line-added">2253         { &quot;setShouldSwapToEphemeralSessionOnNextNavigation&quot;, setShouldSwapToEphemeralSessionOnNextNavigationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },</span>
<span class="line-added">2254         { &quot;setShouldSwapToDefaultSessionOnNextNavigation&quot;, setShouldSwapToDefaultSessionOnNextNavigationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },</span>
2255         { &quot;setSerializeHTTPLoads&quot;, setSerializeHTTPLoadsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2256         { &quot;setSpatialNavigationEnabled&quot;, setSpatialNavigationEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2257         { &quot;setStopProvisionalFrameLoads&quot;, setStopProvisionalFrameLoadsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2258         { &quot;setTabKeyCyclesThroughElements&quot;, setTabKeyCyclesThroughElementsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2259 #if PLATFORM(IOS_FAMILY)
2260         { &quot;setTelephoneNumberParsingEnabled&quot;, setTelephoneNumberParsingEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2261         { &quot;setPagePaused&quot;, setPagePausedCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2262 #endif
2263         { &quot;setUserStyleSheetEnabled&quot;, setUserStyleSheetEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2264         { &quot;setUserStyleSheetLocation&quot;, setUserStyleSheetLocationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2265         { &quot;setValueForUser&quot;, setValueForUserCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2266         { &quot;setWebViewEditable&quot;, setWebViewEditableCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2267         { &quot;setWillSendRequestClearHeader&quot;, setWillSendRequestClearHeaderCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2268         { &quot;setWillSendRequestReturnsNull&quot;, setWillSendRequestReturnsNullCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2269         { &quot;setWillSendRequestReturnsNullOnRedirect&quot;, setWillSendRequestReturnsNullOnRedirectCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2270         { &quot;setWindowIsKey&quot;, setWindowIsKeyCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2271         { &quot;setViewSize&quot;, setViewSizeCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2272         { &quot;setJavaScriptCanAccessClipboard&quot;, setJavaScriptCanAccessClipboardCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2273         { &quot;setXSSAuditorEnabled&quot;, setXSSAuditorEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
2274         { &quot;showWebInspector&quot;, showWebInspectorCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
</pre>
<hr />
<pre>
2398 
2399     return iterator-&gt;second.data();
2400 }
2401 
2402 void TestRunner::setRenderTreeDumpOptions(unsigned options)
2403 {
2404     m_renderTreeDumpOptions = options;
2405 }
2406 
2407 void TestRunner::setShouldPaintBrokenImage(bool shouldPaintBrokenImage)
2408 {
2409     m_shouldPaintBrokenImage = shouldPaintBrokenImage;
2410 }
2411 
2412 void TestRunner::setAccummulateLogsForChannel(JSStringRef channel)
2413 {
2414     size_t maxLength = JSStringGetMaximumUTF8CStringSize(channel);
2415     auto buffer = makeUniqueArray&lt;char&gt;(maxLength + 1);
2416     JSStringGetUTF8CString(channel, buffer.get(), maxLength + 1);
2417 




2418     WebCoreTestSupport::setLogChannelToAccumulate({ buffer.get() });

2419 }
2420 
2421 typedef WTF::HashMap&lt;unsigned, JSValueRef&gt; CallbackMap;
2422 static CallbackMap&amp; callbackMap()
2423 {
2424     static CallbackMap&amp; map = *new CallbackMap;
2425     return map;
2426 }
2427 
2428 void TestRunner::cacheTestRunnerCallback(unsigned index, JSValueRef callback)
2429 {
2430     if (!callback)
2431         return;
2432 
2433     if (callbackMap().contains(index)) {
2434         fprintf(stderr, &quot;FAIL: Tried to install a second TestRunner callback for the same event (id %d)\n&quot;, index);
2435         return;
2436     }
2437 
2438     JSContextRef context = mainFrameJSContext();
</pre>
<hr />
<pre>
2499     });
2500 #else
2501     WebThreadRun(
2502         makeBlockPtr([protectedThis = makeRef(*this), callbackID, protectedResult] {
2503             JSContextRef context = protectedThis-&gt;mainFrameJSContext();
2504             JSValueRef resultValue = JSValueMakeString(context, protectedResult.get());
2505             protectedThis-&gt;callTestRunnerCallback(callbackID, 1, &amp;resultValue);
2506         }).get()
2507     );
2508 #endif
2509 }
2510 
2511 void TestRunner::uiScriptDidComplete(const String&amp; result, unsigned callbackID)
2512 {
2513     auto stringRef = adopt(JSStringCreateWithUTF8CString(result.utf8().data()));
2514     callUIScriptCallback(callbackID, stringRef.get());
2515 }
2516 
2517 void TestRunner::setAllowsAnySSLCertificate(bool allowsAnySSLCertificate)
2518 {




2519     WebCoreTestSupport::setAllowsAnySSLCertificate(allowsAnySSLCertificate);

2520 }
2521 
2522 void TestRunner::setOpenPanelFiles(JSContextRef context, JSValueRef filesValue)
2523 {
2524     if (!JSValueIsArray(context, filesValue))
2525         return;
2526 
2527     JSObjectRef files = JSValueToObject(context, filesValue, nullptr);
2528     static auto lengthProperty = adopt(JSStringCreateWithUTF8CString(&quot;length&quot;));
2529     JSValueRef filesLengthValue = JSObjectGetProperty(context, files, lengthProperty.get(), nullptr);
2530     if (!JSValueIsNumber(context, filesLengthValue))
2531         return;
2532 
2533     m_openPanelFiles.clear();
2534     auto filesLength = static_cast&lt;size_t&gt;(JSValueToNumber(context, filesLengthValue, nullptr));
2535     for (size_t i = 0; i &lt; filesLength; ++i) {
2536         JSValueRef fileValue = JSObjectGetPropertyAtIndex(context, files, i, nullptr);
2537         if (!JSValueIsString(context, fileValue))
2538             continue;
2539 
</pre>
<hr />
<pre>
2550 void TestRunner::setOpenPanelFilesMediaIcon(JSContextRef context, JSValueRef mediaIcon)
2551 {
2552     // FIXME (123058): Use a JSC API to get buffer contents once such is exposed.
2553     JSC::VM&amp; vm = toJS(context)-&gt;vm();
2554     JSC::JSLockHolder lock(vm);
2555 
2556     JSC::JSArrayBufferView* jsBufferView = JSC::jsDynamicCast&lt;JSC::JSArrayBufferView*&gt;(vm, toJS(toJS(context), mediaIcon));
2557     ASSERT(jsBufferView);
2558     RefPtr&lt;JSC::ArrayBufferView&gt; bufferView = jsBufferView-&gt;unsharedImpl();
2559     const char* buffer = static_cast&lt;const char*&gt;(bufferView-&gt;baseAddress());
2560     std::vector&lt;char&gt; mediaIconData(buffer, buffer + bufferView-&gt;byteLength());
2561 
2562     m_openPanelFilesMediaIcon = mediaIconData;
2563 }
2564 #endif
2565 
2566 void TestRunner::cleanup()
2567 {
2568     clearTestRunnerCallbacks();
2569 }
<span class="line-added">2570 </span>
<span class="line-added">2571 void TestRunner::willNavigate()</span>
<span class="line-added">2572 {</span>
<span class="line-added">2573     if (m_shouldSwapToEphemeralSessionOnNextNavigation || m_shouldSwapToDefaultSessionOnNextNavigation) {</span>
<span class="line-added">2574         ASSERT(m_shouldSwapToEphemeralSessionOnNextNavigation != m_shouldSwapToDefaultSessionOnNextNavigation);</span>
<span class="line-added">2575         setPrivateBrowsingEnabled(m_shouldSwapToEphemeralSessionOnNextNavigation);</span>
<span class="line-added">2576         m_shouldSwapToEphemeralSessionOnNextNavigation = false;</span>
<span class="line-added">2577         m_shouldSwapToDefaultSessionOnNextNavigation = false;</span>
<span class="line-added">2578     }</span>
<span class="line-added">2579 }</span>
</pre>
</td>
</tr>
</table>
<center><a href="TestOptions.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="TestRunner.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>