<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/svg/SVGTransformDistance.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2007 Eric Seidel &lt;eric@webkit.org&gt;
  3  *
  4  * This library is free software; you can redistribute it and/or
  5  * modify it under the terms of the GNU Library General Public
  6  * License as published by the Free Software Foundation; either
  7  * version 2 of the License, or (at your option) any later version.
  8  *
  9  * This library is distributed in the hope that it will be useful,
 10  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 11  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 12  * Library General Public License for more details.
 13  *
 14  * You should have received a copy of the GNU Library General Public License
 15  * along with this library; see the file COPYING.LIB.  If not, write to
 16  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 17  * Boston, MA 02110-1301, USA.
 18  */
 19 
 20 #include &quot;config.h&quot;
 21 #include &quot;SVGTransformDistance.h&quot;
 22 
 23 #include &quot;FloatConversion.h&quot;
 24 #include &quot;FloatPoint.h&quot;
 25 #include &quot;FloatSize.h&quot;
 26 #include &quot;SVGTransformValue.h&quot;
 27 
 28 #include &lt;math.h&gt;
 29 
<a name="1" id="anc1"></a><span class="line-added"> 30 #if PLATFORM(JAVA)</span>
<span class="line-added"> 31 #include &lt;wtf/java/JavaMath.h&gt;</span>
<span class="line-added"> 32 #endif</span>
<span class="line-added"> 33 </span>
 34 namespace WebCore {
 35 
 36 SVGTransformDistance::SVGTransformDistance()
 37     : m_type(SVGTransformValue::SVG_TRANSFORM_UNKNOWN)
 38     , m_angle(0)
 39     , m_cx(0)
 40     , m_cy(0)
 41 {
 42 }
 43 
 44 SVGTransformDistance::SVGTransformDistance(SVGTransformValue::SVGTransformType type, float angle, float cx, float cy, const AffineTransform&amp; transform)
 45     : m_type(type)
 46     , m_angle(angle)
 47     , m_cx(cx)
 48     , m_cy(cy)
 49     , m_transform(transform)
 50 {
 51 }
 52 
 53 SVGTransformDistance::SVGTransformDistance(const SVGTransformValue&amp; fromSVGTransform, const SVGTransformValue&amp; toSVGTransform)
 54     : m_type(fromSVGTransform.type())
 55     , m_angle(0)
 56     , m_cx(0)
 57     , m_cy(0)
 58 {
 59     ASSERT(m_type == toSVGTransform.type());
 60 
 61     switch (m_type) {
 62     case SVGTransformValue::SVG_TRANSFORM_MATRIX:
 63         ASSERT_NOT_REACHED();
<a name="2" id="anc2"></a><span class="line-modified"> 64 #if !ASSERT_ENABLED</span>
 65         FALLTHROUGH;
 66 #endif
 67     case SVGTransformValue::SVG_TRANSFORM_UNKNOWN:
 68         break;
 69     case SVGTransformValue::SVG_TRANSFORM_ROTATE: {
 70         FloatSize centerDistance = toSVGTransform.rotationCenter() - fromSVGTransform.rotationCenter();
 71         m_angle = toSVGTransform.angle() - fromSVGTransform.angle();
 72         m_cx = centerDistance.width();
 73         m_cy = centerDistance.height();
 74         break;
 75     }
 76     case SVGTransformValue::SVG_TRANSFORM_TRANSLATE: {
 77         FloatSize translationDistance = toSVGTransform.translate() - fromSVGTransform.translate();
 78         m_transform.translate(translationDistance.width(), translationDistance.height());
 79         break;
 80     }
 81     case SVGTransformValue::SVG_TRANSFORM_SCALE: {
 82         float scaleX = toSVGTransform.scale().width() - fromSVGTransform.scale().width();
 83         float scaleY = toSVGTransform.scale().height() - fromSVGTransform.scale().height();
 84         m_transform.scaleNonUniform(scaleX, scaleY);
 85         break;
 86     }
 87     case SVGTransformValue::SVG_TRANSFORM_SKEWX:
 88     case SVGTransformValue::SVG_TRANSFORM_SKEWY:
 89         m_angle = toSVGTransform.angle() - fromSVGTransform.angle();
 90         break;
 91     }
 92 }
 93 
 94 SVGTransformDistance SVGTransformDistance::scaledDistance(float scaleFactor) const
 95 {
 96     switch (m_type) {
 97     case SVGTransformValue::SVG_TRANSFORM_MATRIX:
 98         ASSERT_NOT_REACHED();
<a name="3" id="anc3"></a><span class="line-modified"> 99 #if !ASSERT_ENABLED</span>
100         FALLTHROUGH;
101 #endif
102     case SVGTransformValue::SVG_TRANSFORM_UNKNOWN:
103         return SVGTransformDistance();
104     case SVGTransformValue::SVG_TRANSFORM_ROTATE:
105         return SVGTransformDistance(m_type, m_angle * scaleFactor, m_cx * scaleFactor, m_cy * scaleFactor, AffineTransform());
106     case SVGTransformValue::SVG_TRANSFORM_SCALE:
107         return SVGTransformDistance(m_type, m_angle * scaleFactor, m_cx * scaleFactor, m_cy * scaleFactor, AffineTransform(m_transform).scale(scaleFactor));
108     case SVGTransformValue::SVG_TRANSFORM_TRANSLATE: {
109         AffineTransform newTransform(m_transform);
110         newTransform.setE(m_transform.e() * scaleFactor);
111         newTransform.setF(m_transform.f() * scaleFactor);
112         return SVGTransformDistance(m_type, 0, 0, 0, newTransform);
113     }
114     case SVGTransformValue::SVG_TRANSFORM_SKEWX:
115     case SVGTransformValue::SVG_TRANSFORM_SKEWY:
116         return SVGTransformDistance(m_type, m_angle * scaleFactor, m_cx * scaleFactor, m_cy * scaleFactor, AffineTransform());
117     }
118 
119     ASSERT_NOT_REACHED();
120     return SVGTransformDistance();
121 }
122 
123 SVGTransformValue SVGTransformDistance::addSVGTransforms(const SVGTransformValue&amp; first, const SVGTransformValue&amp; second, unsigned repeatCount)
124 {
125     ASSERT(first.type() == second.type());
126 
127     SVGTransformValue transform;
128 
129     switch (first.type()) {
130     case SVGTransformValue::SVG_TRANSFORM_MATRIX:
131         ASSERT_NOT_REACHED();
<a name="4" id="anc4"></a><span class="line-modified">132 #if !ASSERT_ENABLED</span>
133         FALLTHROUGH;
134 #endif
135     case SVGTransformValue::SVG_TRANSFORM_UNKNOWN:
136         return { };
137     case SVGTransformValue::SVG_TRANSFORM_ROTATE: {
138         transform.setRotate(first.angle() + second.angle() * repeatCount, first.rotationCenter().x() + second.rotationCenter().x() * repeatCount, first.rotationCenter().y() + second.rotationCenter().y() * repeatCount);
139         return transform;
140     }
141     case SVGTransformValue::SVG_TRANSFORM_TRANSLATE: {
142         float dx = first.translate().x() + second.translate().x() * repeatCount;
143         float dy = first.translate().y() + second.translate().y() * repeatCount;
144         transform.setTranslate(dx, dy);
145         return transform;
146     }
147     case SVGTransformValue::SVG_TRANSFORM_SCALE: {
148         FloatSize scale = second.scale();
149         scale.scale(repeatCount);
150         scale += first.scale();
151         transform.setScale(scale.width(), scale.height());
152         return transform;
153     }
154     case SVGTransformValue::SVG_TRANSFORM_SKEWX:
155         transform.setSkewX(first.angle() + second.angle() * repeatCount);
156         return transform;
157     case SVGTransformValue::SVG_TRANSFORM_SKEWY:
158         transform.setSkewY(first.angle() + second.angle() * repeatCount);
159         return transform;
160     }
161     ASSERT_NOT_REACHED();
162     return { };
163 }
164 
165 SVGTransformValue SVGTransformDistance::addToSVGTransform(const SVGTransformValue&amp; transform) const
166 {
167     ASSERT(m_type == transform.type() || !transform.isValid());
168 
169     SVGTransformValue newTransform(transform);
170 
171     switch (m_type) {
172     case SVGTransformValue::SVG_TRANSFORM_MATRIX:
173         ASSERT_NOT_REACHED();
<a name="5" id="anc5"></a><span class="line-modified">174 #if !ASSERT_ENABLED</span>
175         FALLTHROUGH;
176 #endif
177     case SVGTransformValue::SVG_TRANSFORM_UNKNOWN:
178         return { };
179     case SVGTransformValue::SVG_TRANSFORM_TRANSLATE: {
180         FloatPoint translation = transform.translate();
181         translation += FloatSize::narrowPrecision(m_transform.e(), m_transform.f());
182         newTransform.setTranslate(translation.x(), translation.y());
183         return newTransform;
184     }
185     case SVGTransformValue::SVG_TRANSFORM_SCALE: {
186         FloatSize scale = transform.scale();
187         scale += FloatSize::narrowPrecision(m_transform.a(), m_transform.d());
188         newTransform.setScale(scale.width(), scale.height());
189         return newTransform;
190     }
191     case SVGTransformValue::SVG_TRANSFORM_ROTATE: {
192         FloatPoint center = transform.rotationCenter();
193         newTransform.setRotate(transform.angle() + m_angle, center.x() + m_cx, center.y() + m_cy);
194         return newTransform;
195     }
196     case SVGTransformValue::SVG_TRANSFORM_SKEWX:
197         newTransform.setSkewX(transform.angle() + m_angle);
198         return newTransform;
199     case SVGTransformValue::SVG_TRANSFORM_SKEWY:
200         newTransform.setSkewY(transform.angle() + m_angle);
201         return newTransform;
202     }
203 
204     ASSERT_NOT_REACHED();
205     return { };
206 }
207 
208 bool SVGTransformDistance::isZero() const
209 {
210     return m_transform.isIdentity() &amp;&amp; !m_angle;
211 }
212 
213 float SVGTransformDistance::distance() const
214 {
215     switch (m_type) {
216     case SVGTransformValue::SVG_TRANSFORM_MATRIX:
217         ASSERT_NOT_REACHED();
<a name="6" id="anc6"></a><span class="line-modified">218 #if !ASSERT_ENABLED</span>
219         FALLTHROUGH;
220 #endif
221     case SVGTransformValue::SVG_TRANSFORM_UNKNOWN:
222         return 0;
223     case SVGTransformValue::SVG_TRANSFORM_ROTATE:
<a name="7" id="anc7"></a><span class="line-modified">224 #if PLATFORM(JAVA)</span>
<span class="line-added">225         return javamath::hypot(m_angle, m_cx, m_cy);</span>
<span class="line-added">226 #else</span>
<span class="line-added">227         return std::hypot(m_angle, m_cx, m_cy);</span>
<span class="line-added">228 #endif</span>
229     case SVGTransformValue::SVG_TRANSFORM_SCALE:
<a name="8" id="anc8"></a><span class="line-modified">230         return static_cast&lt;float&gt;(std::hypot(m_transform.a(), m_transform.d()));</span>
231     case SVGTransformValue::SVG_TRANSFORM_TRANSLATE:
<a name="9" id="anc9"></a><span class="line-modified">232         return static_cast&lt;float&gt;(std::hypot(m_transform.e(), m_transform.f()));</span>
233     case SVGTransformValue::SVG_TRANSFORM_SKEWX:
234     case SVGTransformValue::SVG_TRANSFORM_SKEWY:
235         return m_angle;
236     }
237     ASSERT_NOT_REACHED();
238     return 0;
239 }
240 
241 }
<a name="10" id="anc10"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="10" type="hidden" />
</body>
</html>