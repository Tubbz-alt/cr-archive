<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/dom/GenericEventQueue.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="GCReachableRef.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="GenericEventQueue.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/dom/GenericEventQueue.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -34,35 +34,34 @@</span>
  #include &quot;Timer.h&quot;
  #include &lt;wtf/MainThread.h&gt;
  
  namespace WebCore {
  
<span class="udiff-line-modified-removed">- GenericEventQueue::GenericEventQueue(EventTarget&amp; owner)</span>
<span class="udiff-line-modified-removed">-     : m_owner(owner)</span>
<span class="udiff-line-modified-removed">-     , m_isClosed(false)</span>
<span class="udiff-line-modified-added">+ MainThreadGenericEventQueue::MainThreadGenericEventQueue(EventTarget&amp; owner)</span>
<span class="udiff-line-modified-added">+     : ActiveDOMObject(owner.scriptExecutionContext())</span>
<span class="udiff-line-modified-added">+     , m_owner(owner)</span>
<span class="udiff-line-added">+     , m_taskQueue(makeUniqueRef&lt;GenericTaskQueue&lt;Timer&gt;&gt;())</span>
  {
  }
  
<span class="udiff-line-modified-removed">- GenericEventQueue::~GenericEventQueue() = default;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- void GenericEventQueue::enqueueEvent(RefPtr&lt;Event&gt;&amp;&amp; event)</span>
<span class="udiff-line-modified-added">+ void MainThreadGenericEventQueue::enqueueEvent(RefPtr&lt;Event&gt;&amp;&amp; event)</span>
  {
      if (m_isClosed)
          return;
  
      if (event-&gt;target() == &amp;m_owner)
          event-&gt;setTarget(nullptr);
  
      m_pendingEvents.append(WTFMove(event));
  
<span class="udiff-line-modified-removed">-     if (m_isSuspended)</span>
<span class="udiff-line-modified-added">+     if (isSuspendedOrPausedByClient())</span>
          return;
  
<span class="udiff-line-modified-removed">-     m_taskQueue.enqueueTask(std::bind(&amp;GenericEventQueue::dispatchOneEvent, this));</span>
<span class="udiff-line-modified-added">+     m_taskQueue-&gt;enqueueTask(std::bind(&amp;MainThreadGenericEventQueue::dispatchOneEvent, this));</span>
  }
  
<span class="udiff-line-modified-removed">- void GenericEventQueue::dispatchOneEvent()</span>
<span class="udiff-line-modified-added">+ void MainThreadGenericEventQueue::dispatchOneEvent()</span>
  {
      ASSERT(!m_pendingEvents.isEmpty());
  
      Ref&lt;EventTarget&gt; protect(m_owner);
      RefPtr&lt;Event&gt; event = m_pendingEvents.takeFirst();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -71,53 +70,91 @@</span>
          &quot;An attempt to dispatch an event on a stopped target by EventTargetInterface=%d (nodeName=%s target=%p owner=%p)&quot;,
          m_owner.eventTargetInterface(), m_owner.isNode() ? static_cast&lt;Node&amp;&gt;(m_owner).nodeName().ascii().data() : &quot;&quot;, &amp;target, &amp;m_owner);
      target.dispatchEvent(*event);
  }
  
<span class="udiff-line-modified-removed">- void GenericEventQueue::close()</span>
<span class="udiff-line-modified-added">+ void MainThreadGenericEventQueue::close()</span>
  {
      m_isClosed = true;
  
<span class="udiff-line-modified-removed">-     m_taskQueue.close();</span>
<span class="udiff-line-modified-added">+     m_taskQueue-&gt;close();</span>
      m_pendingEvents.clear();
  }
  
<span class="udiff-line-modified-removed">- void GenericEventQueue::cancelAllEvents()</span>
<span class="udiff-line-modified-added">+ void MainThreadGenericEventQueue::cancelAllEvents()</span>
  {
<span class="udiff-line-modified-removed">-     m_taskQueue.cancelAllTasks();</span>
<span class="udiff-line-modified-added">+     m_taskQueue-&gt;cancelAllTasks();</span>
      m_pendingEvents.clear();
  }
  
<span class="udiff-line-modified-removed">- bool GenericEventQueue::hasPendingEvents() const</span>
<span class="udiff-line-modified-added">+ bool MainThreadGenericEventQueue::hasPendingEvents() const</span>
  {
      return !m_pendingEvents.isEmpty();
  }
  
<span class="udiff-line-modified-removed">- bool GenericEventQueue::hasPendingEventsOfType(const AtomString&amp; type) const</span>
<span class="udiff-line-modified-added">+ bool MainThreadGenericEventQueue::hasPendingEventsOfType(const AtomString&amp; type) const</span>
  {
      for (auto&amp; event : m_pendingEvents) {
          if (event-&gt;type() == type)
              return true;
      }
  
      return false;
  }
  
<span class="udiff-line-modified-removed">- void GenericEventQueue::suspend()</span>
<span class="udiff-line-modified-added">+ void MainThreadGenericEventQueue::setPaused(bool shouldPause)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (m_isPausedByClient == shouldPause)</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     m_isPausedByClient = shouldPause;</span>
<span class="udiff-line-added">+     if (shouldPause)</span>
<span class="udiff-line-added">+         m_taskQueue-&gt;cancelAllTasks();</span>
<span class="udiff-line-added">+     else</span>
<span class="udiff-line-added">+         rescheduleAllEventsIfNeeded();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void MainThreadGenericEventQueue::suspend(ReasonForSuspension)</span>
  {
<span class="udiff-line-modified-removed">-     ASSERT(!m_isSuspended);</span>
<span class="udiff-line-modified-added">+     if (m_isSuspended)</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+ </span>
      m_isSuspended = true;
<span class="udiff-line-modified-removed">-     m_taskQueue.cancelAllTasks();</span>
<span class="udiff-line-modified-added">+     m_taskQueue-&gt;cancelAllTasks();</span>
  }
  
<span class="udiff-line-modified-removed">- void GenericEventQueue::resume()</span>
<span class="udiff-line-modified-added">+ void MainThreadGenericEventQueue::resume()</span>
  {
      if (!m_isSuspended)
          return;
  
      m_isSuspended = false;
<span class="udiff-line-added">+     rescheduleAllEventsIfNeeded();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void MainThreadGenericEventQueue::rescheduleAllEventsIfNeeded()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (isSuspendedOrPausedByClient())</span>
<span class="udiff-line-added">+         return;</span>
  
      for (unsigned i = 0; i &lt; m_pendingEvents.size(); ++i)
<span class="udiff-line-modified-removed">-         m_taskQueue.enqueueTask(std::bind(&amp;GenericEventQueue::dispatchOneEvent, this));</span>
<span class="udiff-line-modified-added">+         m_taskQueue-&gt;enqueueTask(std::bind(&amp;MainThreadGenericEventQueue::dispatchOneEvent, this));</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void MainThreadGenericEventQueue::stop()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     close();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ const char* MainThreadGenericEventQueue::activeDOMObjectName() const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     return &quot;MainThreadGenericEventQueue&quot;;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ UniqueRef&lt;MainThreadGenericEventQueue&gt; MainThreadGenericEventQueue::create(EventTarget&amp; eventTarget)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     auto eventQueue = makeUniqueRef&lt;MainThreadGenericEventQueue&gt;(eventTarget);</span>
<span class="udiff-line-added">+     eventQueue-&gt;suspendIfNeeded();</span>
<span class="udiff-line-added">+     return eventQueue;</span>
  }
  
  }
</pre>
<center><a href="GCReachableRef.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="GenericEventQueue.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>