<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/inspector/agents/InspectorCanvasAgent.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InspectorCanvasAgent.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="InspectorDOMAgent.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/inspector/agents/InspectorCanvasAgent.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -31,80 +31,88 @@</span>
  #include &quot;InspectorWebAgentBase.h&quot;
  #include &quot;Timer.h&quot;
  #include &lt;JavaScriptCore/InspectorBackendDispatchers.h&gt;
  #include &lt;JavaScriptCore/InspectorFrontendDispatchers.h&gt;
  #include &lt;initializer_list&gt;
<span class="udiff-line-modified-removed">- #include &lt;wtf/HashMap.h&gt;</span>
<span class="udiff-line-modified-removed">- #include &lt;wtf/RefPtr.h&gt;</span>
<span class="udiff-line-removed">- #include &lt;wtf/Vector.h&gt;</span>
<span class="udiff-line-removed">- #include &lt;wtf/text/WTFString.h&gt;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #if ENABLE(WEBGL)</span>
<span class="udiff-line-removed">- #include &quot;InspectorShaderProgram.h&quot;</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-modified-added">+ #include &lt;wtf/Forward.h&gt;</span>
<span class="udiff-line-modified-added">+ #include &lt;wtf/WeakPtr.h&gt;</span>
  
  namespace Inspector {
  class InjectedScriptManager;
  }
  
  namespace WebCore {
  
  class CanvasRenderingContext;
<span class="udiff-line-added">+ class InspectorShaderProgram;</span>
  #if ENABLE(WEBGL)
  class WebGLProgram;
  class WebGLRenderingContextBase;
  #endif
<span class="udiff-line-added">+ #if ENABLE(WEBGPU)</span>
<span class="udiff-line-added">+ class GPUCanvasContext;</span>
<span class="udiff-line-added">+ class WebGPUDevice;</span>
<span class="udiff-line-added">+ class WebGPUPipeline;</span>
<span class="udiff-line-added">+ class WebGPUSwapChain;</span>
<span class="udiff-line-added">+ #endif</span>
  
  typedef String ErrorString;
  
<span class="udiff-line-modified-removed">- class InspectorCanvasAgent final : public InspectorAgentBase, public Inspector::CanvasBackendDispatcherHandler, public CanvasObserver {</span>
<span class="udiff-line-modified-added">+ class InspectorCanvasAgent final : public InspectorAgentBase, public Inspector::CanvasBackendDispatcherHandler, public CanvasObserver, public CanMakeWeakPtr&lt;InspectorCanvasAgent&gt; {</span>
      WTF_MAKE_NONCOPYABLE(InspectorCanvasAgent);
      WTF_MAKE_FAST_ALLOCATED;
  public:
      InspectorCanvasAgent(PageAgentContext&amp;);
<span class="udiff-line-modified-removed">-     virtual ~InspectorCanvasAgent();</span>
<span class="udiff-line-modified-added">+     ~InspectorCanvasAgent() override;</span>
  
      // InspectorAgentBase
<span class="udiff-line-modified-removed">-     void didCreateFrontendAndBackend(Inspector::FrontendRouter*, Inspector::BackendDispatcher*);</span>
<span class="udiff-line-modified-removed">-     void willDestroyFrontendAndBackend(Inspector::DisconnectReason);</span>
<span class="udiff-line-modified-removed">-     void discardAgent();</span>
<span class="udiff-line-modified-added">+     void didCreateFrontendAndBackend(Inspector::FrontendRouter*, Inspector::BackendDispatcher*) override;</span>
<span class="udiff-line-modified-added">+     void willDestroyFrontendAndBackend(Inspector::DisconnectReason) override;</span>
<span class="udiff-line-modified-added">+     void discardAgent() override;</span>
  
      // CanvasBackendDispatcherHandler
<span class="udiff-line-modified-removed">-     void enable(ErrorString&amp;);</span>
<span class="udiff-line-modified-removed">-     void disable(ErrorString&amp;);</span>
<span class="udiff-line-modified-removed">-     void requestNode(ErrorString&amp;, const String&amp; canvasId, int* nodeId);</span>
<span class="udiff-line-modified-removed">-     void requestContent(ErrorString&amp;, const String&amp; canvasId, String* content);</span>
<span class="udiff-line-modified-removed">-     void requestCSSCanvasClientNodes(ErrorString&amp;, const String&amp; canvasId, RefPtr&lt;JSON::ArrayOf&lt;int&gt;&gt;&amp;);</span>
<span class="udiff-line-modified-removed">-     void resolveCanvasContext(ErrorString&amp;, const String&amp; canvasId, const String* objectGroup, RefPtr&lt;Inspector::Protocol::Runtime::RemoteObject&gt;&amp;);</span>
<span class="udiff-line-modified-removed">-     void setRecordingAutoCaptureFrameCount(ErrorString&amp;, int count);</span>
<span class="udiff-line-modified-removed">-     void startRecording(ErrorString&amp;, const String&amp; canvasId, const int* frameCount, const int* memoryLimit);</span>
<span class="udiff-line-modified-removed">-     void stopRecording(ErrorString&amp;, const String&amp; canvasId);</span>
<span class="udiff-line-modified-removed">-     void requestShaderSource(ErrorString&amp;, const String&amp; programId, const String&amp; shaderType, String*);</span>
<span class="udiff-line-modified-removed">-     void updateShader(ErrorString&amp;, const String&amp; programId, const String&amp; shaderType, const String&amp; source);</span>
<span class="udiff-line-modified-removed">-     void setShaderProgramDisabled(ErrorString&amp;, const String&amp; programId, bool disabled);</span>
<span class="udiff-line-modified-removed">-     void setShaderProgramHighlighted(ErrorString&amp;, const String&amp; programId, bool highlighted);</span>
<span class="udiff-line-modified-added">+     void enable(ErrorString&amp;) override;</span>
<span class="udiff-line-modified-added">+     void disable(ErrorString&amp;) override;</span>
<span class="udiff-line-modified-added">+     void requestNode(ErrorString&amp;, const String&amp; canvasId, int* nodeId) override;</span>
<span class="udiff-line-modified-added">+     void requestContent(ErrorString&amp;, const String&amp; canvasId, String* content) override;</span>
<span class="udiff-line-modified-added">+     void requestClientNodes(ErrorString&amp;, const String&amp; canvasId, RefPtr&lt;JSON::ArrayOf&lt;int&gt;&gt;&amp;) override;</span>
<span class="udiff-line-modified-added">+     void resolveContext(ErrorString&amp;, const String&amp; canvasId, const String* objectGroup, RefPtr&lt;Inspector::Protocol::Runtime::RemoteObject&gt;&amp;) override;</span>
<span class="udiff-line-modified-added">+     void setRecordingAutoCaptureFrameCount(ErrorString&amp;, int count) override;</span>
<span class="udiff-line-modified-added">+     void startRecording(ErrorString&amp;, const String&amp; canvasId, const int* frameCount, const int* memoryLimit) override;</span>
<span class="udiff-line-modified-added">+     void stopRecording(ErrorString&amp;, const String&amp; canvasId) override;</span>
<span class="udiff-line-modified-added">+     void requestShaderSource(ErrorString&amp;, const String&amp; programId, const String&amp; shaderType, String* source) override;</span>
<span class="udiff-line-modified-added">+     void updateShader(ErrorString&amp;, const String&amp; programId, const String&amp; shaderType, const String&amp; source) override;</span>
<span class="udiff-line-modified-added">+     void setShaderProgramDisabled(ErrorString&amp;, const String&amp; programId, bool disabled) override;</span>
<span class="udiff-line-modified-added">+     void setShaderProgramHighlighted(ErrorString&amp;, const String&amp; programId, bool highlighted) override;</span>
  
      // CanvasObserver
<span class="udiff-line-modified-removed">-     void canvasChanged(CanvasBase&amp;, const FloatRect&amp;);</span>
<span class="udiff-line-modified-removed">-     void canvasResized(CanvasBase&amp;) { }</span>
<span class="udiff-line-modified-removed">-     void canvasDestroyed(CanvasBase&amp;);</span>
<span class="udiff-line-modified-added">+     void canvasChanged(CanvasBase&amp;, const FloatRect&amp;) override;</span>
<span class="udiff-line-modified-added">+     void canvasResized(CanvasBase&amp;) override { }</span>
<span class="udiff-line-modified-added">+     void canvasDestroyed(CanvasBase&amp;) override;</span>
  
      // InspectorInstrumentation
      void frameNavigated(Frame&amp;);
      void didChangeCSSCanvasClientNodes(CanvasBase&amp;);
      void didCreateCanvasRenderingContext(CanvasRenderingContext&amp;);
<span class="udiff-line-removed">-     void willDestroyCanvasRenderingContext(CanvasRenderingContext&amp;);</span>
      void didChangeCanvasMemory(CanvasRenderingContext&amp;);
      void recordCanvasAction(CanvasRenderingContext&amp;, const String&amp;, std::initializer_list&lt;RecordCanvasActionVariant&gt;&amp;&amp; = { });
      void didFinishRecordingCanvasFrame(CanvasRenderingContext&amp;, bool forceDispatch = false);
<span class="udiff-line-modified-removed">-     void consoleStartRecordingCanvas(CanvasRenderingContext&amp;, JSC::ExecState&amp;, JSC::JSObject* options);</span>
<span class="udiff-line-modified-added">+     void consoleStartRecordingCanvas(CanvasRenderingContext&amp;, JSC::JSGlobalObject&amp;, JSC::JSObject* options);</span>
<span class="udiff-line-added">+     void consoleStopRecordingCanvas(CanvasRenderingContext&amp;);</span>
  #if ENABLE(WEBGL)
      void didEnableExtension(WebGLRenderingContextBase&amp;, const String&amp;);
<span class="udiff-line-modified-removed">-     void didCreateProgram(WebGLRenderingContextBase&amp;, WebGLProgram&amp;);</span>
<span class="udiff-line-modified-removed">-     void willDeleteProgram(WebGLProgram&amp;);</span>
<span class="udiff-line-modified-removed">-     bool isShaderProgramDisabled(WebGLProgram&amp;);</span>
<span class="udiff-line-modified-removed">-     bool isShaderProgramHighlighted(WebGLProgram&amp;);</span>
<span class="udiff-line-modified-added">+     void didCreateWebGLProgram(WebGLRenderingContextBase&amp;, WebGLProgram&amp;);</span>
<span class="udiff-line-modified-added">+     void willDestroyWebGLProgram(WebGLProgram&amp;);</span>
<span class="udiff-line-modified-added">+     bool isWebGLProgramDisabled(WebGLProgram&amp;);</span>
<span class="udiff-line-modified-added">+     bool isWebGLProgramHighlighted(WebGLProgram&amp;);</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ #if ENABLE(WEBGPU)</span>
<span class="udiff-line-added">+     void didCreateWebGPUDevice(WebGPUDevice&amp;);</span>
<span class="udiff-line-added">+     void willDestroyWebGPUDevice(WebGPUDevice&amp;);</span>
<span class="udiff-line-added">+     void willConfigureSwapChain(GPUCanvasContext&amp;, WebGPUSwapChain&amp;);</span>
<span class="udiff-line-added">+     void didCreateWebGPUPipeline(WebGPUDevice&amp;, WebGPUPipeline&amp;);</span>
<span class="udiff-line-added">+     void willDestroyWebGPUPipeline(WebGPUPipeline&amp;);</span>
  #endif
  
  private:
      struct RecordingOptions {
          Optional&lt;long&gt; frameCount;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -112,34 +120,48 @@</span>
          Optional&lt;String&gt; name;
      };
      void startRecording(InspectorCanvas&amp;, Inspector::Protocol::Recording::Initiator, RecordingOptions&amp;&amp; = { });
  
      void canvasDestroyedTimerFired();
<span class="udiff-line-modified-removed">-     void clearCanvasData();</span>
<span class="udiff-line-modified-added">+     void programDestroyedTimerFired();</span>
<span class="udiff-line-added">+     void reset();</span>
<span class="udiff-line-added">+ </span>
      InspectorCanvas&amp; bindCanvas(CanvasRenderingContext&amp;, bool captureBacktrace);
<span class="udiff-line-modified-removed">-     String unbindCanvas(InspectorCanvas&amp;);</span>
<span class="udiff-line-modified-added">+ #if ENABLE(WEBGPU)</span>
<span class="udiff-line-added">+     InspectorCanvas&amp; bindCanvas(WebGPUDevice&amp;, bool captureBacktrace);</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+     void unbindCanvas(InspectorCanvas&amp;);</span>
      RefPtr&lt;InspectorCanvas&gt; assertInspectorCanvas(ErrorString&amp;, const String&amp; canvasId);
      RefPtr&lt;InspectorCanvas&gt; findInspectorCanvas(CanvasRenderingContext&amp;);
<span class="udiff-line-modified-removed">- #if ENABLE(WEBGL)</span>
<span class="udiff-line-modified-removed">-     String unbindProgram(InspectorShaderProgram&amp;);</span>
<span class="udiff-line-modified-added">+ #if ENABLE(WEBGPU)</span>
<span class="udiff-line-modified-added">+     RefPtr&lt;InspectorCanvas&gt; findInspectorCanvas(WebGPUDevice&amp;);</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     void unbindProgram(InspectorShaderProgram&amp;);</span>
      RefPtr&lt;InspectorShaderProgram&gt; assertInspectorProgram(ErrorString&amp;, const String&amp; programId);
<span class="udiff-line-added">+ #if ENABLE(WEBGL)</span>
      RefPtr&lt;InspectorShaderProgram&gt; findInspectorProgram(WebGLProgram&amp;);
  #endif
<span class="udiff-line-added">+ #if ENABLE(WEBGPU)</span>
<span class="udiff-line-added">+     RefPtr&lt;InspectorShaderProgram&gt; findInspectorProgram(WebGPUPipeline&amp;);</span>
<span class="udiff-line-added">+ #endif</span>
  
      std::unique_ptr&lt;Inspector::CanvasFrontendDispatcher&gt; m_frontendDispatcher;
      RefPtr&lt;Inspector::CanvasBackendDispatcher&gt; m_backendDispatcher;
  
      Inspector::InjectedScriptManager&amp; m_injectedScriptManager;
      Page&amp; m_inspectedPage;
  
      HashMap&lt;String, RefPtr&lt;InspectorCanvas&gt;&gt; m_identifierToInspectorCanvas;
<span class="udiff-line-removed">- #if ENABLE(WEBGL)</span>
<span class="udiff-line-removed">-     HashMap&lt;String, RefPtr&lt;InspectorShaderProgram&gt;&gt; m_identifierToInspectorProgram;</span>
<span class="udiff-line-removed">- #endif</span>
      Vector&lt;String&gt; m_removedCanvasIdentifiers;
<span class="udiff-line-added">+     Timer m_canvasDestroyedTimer;</span>
  
<span class="udiff-line-modified-removed">-     Optional&lt;size_t&gt; m_recordingAutoCaptureFrameCount;</span>
<span class="udiff-line-modified-added">+     HashMap&lt;String, RefPtr&lt;InspectorShaderProgram&gt;&gt; m_identifierToInspectorProgram;</span>
<span class="udiff-line-added">+     Vector&lt;String&gt; m_removedProgramIdentifiers;</span>
<span class="udiff-line-added">+     Timer m_programDestroyedTimer;</span>
  
<span class="udiff-line-modified-removed">-     Timer m_canvasDestroyedTimer;</span>
<span class="udiff-line-modified-added">+     HashSet&lt;String&gt; m_recordingCanvasIdentifiers;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     Optional&lt;size_t&gt; m_recordingAutoCaptureFrameCount;</span>
  };
  
  } // namespace WebCore
</pre>
<center><a href="InspectorCanvasAgent.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="InspectorDOMAgent.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>