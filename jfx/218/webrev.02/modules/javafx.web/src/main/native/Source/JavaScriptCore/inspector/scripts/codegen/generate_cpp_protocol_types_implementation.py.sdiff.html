<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/scripts/codegen/generate_cpp_protocol_types_implementation.py</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="generate_cpp_protocol_types_header.py.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="generate_js_backend_commands.py.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/scripts/codegen/generate_cpp_protocol_types_implementation.py</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
196                 sections.append(self._generate_assertion_for_object_declaration(type_declaration))
197                 if Generator.type_needs_runtime_casts(type_declaration.type):
198                     sections.append(self._generate_runtime_cast_for_object_declaration(type_declaration))
199 
200         return &#39;\n\n&#39;.join(sections)
201 
202     def _generate_runtime_cast_for_object_declaration(self, object_declaration):
203         args = {
204             &#39;objectType&#39;: CppGenerator.cpp_protocol_type_for_type(object_declaration.type)
205         }
206         return Template(CppTemplates.ProtocolObjectRuntimeCast).substitute(None, **args)
207 
208     def _generate_assertion_for_object_declaration(self, object_declaration):
209         required_members = [member for member in object_declaration.type_members if not member.is_optional]
210         optional_members = [member for member in object_declaration.type_members if member.is_optional]
211         should_count_properties = not Generator.type_has_open_fields(object_declaration.type)
212         lines = []
213 
214         lines.append(&#39;void BindingTraits&lt;%s&gt;::assertValueHasExpectedType(JSON::Value* value)&#39; % (CppGenerator.cpp_protocol_type_for_type(object_declaration.type)))
215         lines.append(&quot;&quot;&quot;{
<span class="line-modified">216 #if ASSERT_DISABLED</span>
<span class="line-removed">217     UNUSED_PARAM(value);</span>
<span class="line-removed">218 #else</span>
219     ASSERT_ARG(value, value);
220     RefPtr&lt;JSON::Object&gt; object;
221     bool castSucceeded = value-&gt;asObject(object);
222     ASSERT_UNUSED(castSucceeded, castSucceeded);&quot;&quot;&quot;)
223         for type_member in required_members:
224             args = {
225                 &#39;memberName&#39;: type_member.member_name,
226                 &#39;assertMethod&#39;: CppGenerator.cpp_assertion_method_for_type_member(type_member, object_declaration)
227             }
228 
229             lines.append(&quot;&quot;&quot;    {
230         auto %(memberName)sPos = object-&gt;find(&quot;%(memberName)s&quot;_s);
231         ASSERT(%(memberName)sPos != object-&gt;end());
232         %(assertMethod)s(%(memberName)sPos-&gt;value.get());
233     }&quot;&quot;&quot; % args)
234 
235         if should_count_properties:
236             lines.append(&#39;&#39;)
237             lines.append(&#39;    int foundPropertiesCount = %s;&#39; % len(required_members))
238 
239         for type_member in optional_members:
240             args = {
241                 &#39;memberName&#39;: type_member.member_name,
242                 &#39;assertMethod&#39;: CppGenerator.cpp_assertion_method_for_type_member(type_member, object_declaration)
243             }
244 
245             lines.append(&quot;&quot;&quot;    {
246         auto %(memberName)sPos = object-&gt;find(&quot;%(memberName)s&quot;_s);
247         if (%(memberName)sPos != object-&gt;end()) {
248             %(assertMethod)s(%(memberName)sPos-&gt;value.get());&quot;&quot;&quot; % args)
249 
250             if should_count_properties:
251                 lines.append(&#39;            ++foundPropertiesCount;&#39;)
252             lines.append(&#39;        }&#39;)
253             lines.append(&#39;    }&#39;)
254 
255         if should_count_properties:
256             lines.append(&#39;    if (foundPropertiesCount != object-&gt;size())&#39;)
257             lines.append(&#39;        FATAL(&quot;Unexpected properties in object: %s\\n&quot;, object-&gt;toJSONString().ascii().data());&#39;)
<span class="line-modified">258         lines.append(&#39;#endif // !ASSERT_DISABLED&#39;)</span>


259         lines.append(&#39;}&#39;)
260         return &#39;\n&#39;.join(lines)
261 
262     def _generate_assertion_for_enum(self, enum_member, object_declaration):
263         lines = []
264         lines.append(&#39;void %s(JSON::Value* value)&#39; % CppGenerator.cpp_assertion_method_for_type_member(enum_member, object_declaration))
265         lines.append(&#39;{&#39;)
<span class="line-modified">266         lines.append(&#39;#if ASSERT_DISABLED&#39;)</span>
<span class="line-removed">267         lines.append(&#39;    UNUSED_PARAM(value);&#39;)</span>
<span class="line-removed">268         lines.append(&#39;#else&#39;)</span>
269         lines.append(&#39;    ASSERT_ARG(value, value);&#39;)
270         lines.append(&#39;    String result;&#39;)
271         lines.append(&#39;    bool castSucceeded = value-&gt;asString(result);&#39;)
272         lines.append(&#39;    ASSERT(castSucceeded);&#39;)
273 
274         assert_condition = &#39; || &#39;.join([&#39;result == &quot;%s&quot;&#39; % enum_value for enum_value in enum_member.type.enum_values()])
275         lines.append(&#39;    ASSERT(%s);&#39; % assert_condition)
<span class="line-modified">276         lines.append(&#39;#endif // !ASSERT_DISABLED&#39;)</span>


277         lines.append(&#39;}&#39;)
278 
279         return &#39;\n&#39;.join(lines)
</pre>
</td>
<td>
<hr />
<pre>
196                 sections.append(self._generate_assertion_for_object_declaration(type_declaration))
197                 if Generator.type_needs_runtime_casts(type_declaration.type):
198                     sections.append(self._generate_runtime_cast_for_object_declaration(type_declaration))
199 
200         return &#39;\n\n&#39;.join(sections)
201 
202     def _generate_runtime_cast_for_object_declaration(self, object_declaration):
203         args = {
204             &#39;objectType&#39;: CppGenerator.cpp_protocol_type_for_type(object_declaration.type)
205         }
206         return Template(CppTemplates.ProtocolObjectRuntimeCast).substitute(None, **args)
207 
208     def _generate_assertion_for_object_declaration(self, object_declaration):
209         required_members = [member for member in object_declaration.type_members if not member.is_optional]
210         optional_members = [member for member in object_declaration.type_members if member.is_optional]
211         should_count_properties = not Generator.type_has_open_fields(object_declaration.type)
212         lines = []
213 
214         lines.append(&#39;void BindingTraits&lt;%s&gt;::assertValueHasExpectedType(JSON::Value* value)&#39; % (CppGenerator.cpp_protocol_type_for_type(object_declaration.type)))
215         lines.append(&quot;&quot;&quot;{
<span class="line-modified">216 #if ASSERT_ENABLED</span>


217     ASSERT_ARG(value, value);
218     RefPtr&lt;JSON::Object&gt; object;
219     bool castSucceeded = value-&gt;asObject(object);
220     ASSERT_UNUSED(castSucceeded, castSucceeded);&quot;&quot;&quot;)
221         for type_member in required_members:
222             args = {
223                 &#39;memberName&#39;: type_member.member_name,
224                 &#39;assertMethod&#39;: CppGenerator.cpp_assertion_method_for_type_member(type_member, object_declaration)
225             }
226 
227             lines.append(&quot;&quot;&quot;    {
228         auto %(memberName)sPos = object-&gt;find(&quot;%(memberName)s&quot;_s);
229         ASSERT(%(memberName)sPos != object-&gt;end());
230         %(assertMethod)s(%(memberName)sPos-&gt;value.get());
231     }&quot;&quot;&quot; % args)
232 
233         if should_count_properties:
234             lines.append(&#39;&#39;)
235             lines.append(&#39;    int foundPropertiesCount = %s;&#39; % len(required_members))
236 
237         for type_member in optional_members:
238             args = {
239                 &#39;memberName&#39;: type_member.member_name,
240                 &#39;assertMethod&#39;: CppGenerator.cpp_assertion_method_for_type_member(type_member, object_declaration)
241             }
242 
243             lines.append(&quot;&quot;&quot;    {
244         auto %(memberName)sPos = object-&gt;find(&quot;%(memberName)s&quot;_s);
245         if (%(memberName)sPos != object-&gt;end()) {
246             %(assertMethod)s(%(memberName)sPos-&gt;value.get());&quot;&quot;&quot; % args)
247 
248             if should_count_properties:
249                 lines.append(&#39;            ++foundPropertiesCount;&#39;)
250             lines.append(&#39;        }&#39;)
251             lines.append(&#39;    }&#39;)
252 
253         if should_count_properties:
254             lines.append(&#39;    if (foundPropertiesCount != object-&gt;size())&#39;)
255             lines.append(&#39;        FATAL(&quot;Unexpected properties in object: %s\\n&quot;, object-&gt;toJSONString().ascii().data());&#39;)
<span class="line-modified">256         lines.append(&#39;#else // ASSERT_ENABLED&#39;)</span>
<span class="line-added">257         lines.append(&#39;    UNUSED_PARAM(value);&#39;)</span>
<span class="line-added">258         lines.append(&#39;#endif // ASSERT_ENABLED&#39;)</span>
259         lines.append(&#39;}&#39;)
260         return &#39;\n&#39;.join(lines)
261 
262     def _generate_assertion_for_enum(self, enum_member, object_declaration):
263         lines = []
264         lines.append(&#39;void %s(JSON::Value* value)&#39; % CppGenerator.cpp_assertion_method_for_type_member(enum_member, object_declaration))
265         lines.append(&#39;{&#39;)
<span class="line-modified">266         lines.append(&#39;#if ASSERT_ENABLED&#39;)</span>


267         lines.append(&#39;    ASSERT_ARG(value, value);&#39;)
268         lines.append(&#39;    String result;&#39;)
269         lines.append(&#39;    bool castSucceeded = value-&gt;asString(result);&#39;)
270         lines.append(&#39;    ASSERT(castSucceeded);&#39;)
271 
272         assert_condition = &#39; || &#39;.join([&#39;result == &quot;%s&quot;&#39; % enum_value for enum_value in enum_member.type.enum_values()])
273         lines.append(&#39;    ASSERT(%s);&#39; % assert_condition)
<span class="line-modified">274         lines.append(&#39;#else // ASSERT_ENABLED&#39;)</span>
<span class="line-added">275         lines.append(&#39;    UNUSED_PARAM(value);&#39;)</span>
<span class="line-added">276         lines.append(&#39;#endif // ASSERT_ENABLED&#39;)</span>
277         lines.append(&#39;}&#39;)
278 
279         return &#39;\n&#39;.join(lines)
</pre>
</td>
</tr>
</table>
<center><a href="generate_cpp_protocol_types_header.py.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="generate_js_backend_commands.py.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>