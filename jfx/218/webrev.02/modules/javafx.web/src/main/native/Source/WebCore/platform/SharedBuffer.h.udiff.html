<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/SharedBuffer.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SharedBuffer.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SharedStringHash.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/SharedBuffer.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (C) 2006-2017 Apple Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2006-2019 Apple Inc. All rights reserved.</span>
   * Copyright (C) Research In Motion Limited 2009-2010. All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -55,10 +55,16 @@</span>
  #if USE(FOUNDATION)
  OBJC_CLASS NSArray;
  OBJC_CLASS NSData;
  #endif
  
<span class="udiff-line-added">+ namespace WTF {</span>
<span class="udiff-line-added">+ namespace Persistence {</span>
<span class="udiff-line-added">+ class Decoder;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  namespace WebCore {
  
  class SharedBufferDataView;
  
  class WEBCORE_EXPORT SharedBuffer : public RefCounted&lt;SharedBuffer&gt; {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -121,11 +127,16 @@</span>
      class DataSegment : public ThreadSafeRefCounted&lt;DataSegment&gt; {
      public:
          WEBCORE_EXPORT const char* data() const;
          WEBCORE_EXPORT size_t size() const;
  
<span class="udiff-line-modified-removed">-         static Ref&lt;DataSegment&gt; create(Vector&lt;char&gt;&amp;&amp; data) { return adoptRef(*new DataSegment(WTFMove(data))); }</span>
<span class="udiff-line-modified-added">+         static Ref&lt;DataSegment&gt; create(Vector&lt;char&gt;&amp;&amp; data)</span>
<span class="udiff-line-added">+         {</span>
<span class="udiff-line-added">+             data.shrinkToFit();</span>
<span class="udiff-line-added">+             return adoptRef(*new DataSegment(WTFMove(data)));</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
  #if USE(CF)
          static Ref&lt;DataSegment&gt; create(RetainPtr&lt;CFDataRef&gt;&amp;&amp; data) { return adoptRef(*new DataSegment(WTFMove(data))); }
  #endif
  #if USE(SOUP)
          static Ref&lt;DataSegment&gt; create(GUniquePtr&lt;SoupBuffer&gt;&amp;&amp; data) { return adoptRef(*new DataSegment(WTFMove(data))); }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -136,10 +147,14 @@</span>
  #if USE(GSTREAMER)
          static Ref&lt;DataSegment&gt; create(RefPtr&lt;GstMappedBuffer&gt;&amp;&amp; data) { return adoptRef(*new DataSegment(WTFMove(data))); }
  #endif
          static Ref&lt;DataSegment&gt; create(FileSystem::MappedFileData&amp;&amp; data) { return adoptRef(*new DataSegment(WTFMove(data))); }
  
<span class="udiff-line-added">+ #if USE(FOUNDATION)</span>
<span class="udiff-line-added">+         RetainPtr&lt;NSData&gt; createNSData() const;</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
      private:
          DataSegment(Vector&lt;char&gt;&amp;&amp; data)
              : m_immutableData(WTFMove(data)) { }
  #if USE(CF)
          DataSegment(RetainPtr&lt;CFDataRef&gt;&amp;&amp; data)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -186,12 +201,16 @@</span>
      DataSegmentVector::const_iterator end() const { return m_segments.end(); }
  
      // begin and end take O(1) time, this takes O(log(N)) time.
      SharedBufferDataView getSomeData(size_t position) const;
  
<span class="udiff-line-added">+     String toHexString() const;</span>
<span class="udiff-line-added">+ </span>
      void hintMemoryNotNeededSoon() const;
  
<span class="udiff-line-added">+     WTF::Persistence::Decoder decoder() const;</span>
<span class="udiff-line-added">+ </span>
      bool operator==(const SharedBuffer&amp;) const;
      bool operator!=(const SharedBuffer&amp; other) const { return !operator==(other); }
  
  private:
      explicit SharedBuffer() = default;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -217,11 +236,11 @@</span>
      static RefPtr&lt;SharedBuffer&gt; createFromReadingFile(const String&amp; filePath);
  
      size_t m_size { 0 };
      mutable DataSegmentVector m_segments;
  
<span class="udiff-line-modified-removed">- #if !ASSERT_DISABLED</span>
<span class="udiff-line-modified-added">+ #if ASSERT_ENABLED</span>
      mutable bool m_hasBeenCombinedIntoOneSegment { false };
      bool internallyConsistent() const;
  #endif
  };
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -238,10 +257,13 @@</span>
  class WEBCORE_EXPORT SharedBufferDataView {
  public:
      SharedBufferDataView(Ref&lt;SharedBuffer::DataSegment&gt;&amp;&amp;, size_t);
      size_t size() const;
      const char* data() const;
<span class="udiff-line-added">+ #if USE(FOUNDATION)</span>
<span class="udiff-line-added">+     RetainPtr&lt;NSData&gt; createNSData() const;</span>
<span class="udiff-line-added">+ #endif</span>
  private:
      size_t m_positionWithinSegment;
      Ref&lt;SharedBuffer::DataSegment&gt; m_segment;
  };
  
</pre>
<center><a href="SharedBuffer.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SharedStringHash.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>