<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/generator/GeneratedFile.rb</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DSL.rb.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Metadata.rb.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/generator/GeneratedFile.rb</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 39 
 40 THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 41 EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 42 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 43 DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 44 DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 45 (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 46 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 47 ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 48 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 49 THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 50 EOF
 51 
 52 module GeneratedFile
 53     class Template &lt; Struct.new(:multiline_comment, :line_comment, :prefix, :suffix, :body)
 54         def initialize
 55             super([&quot;/*&quot;, &quot; *&quot;, &quot;*/&quot;], &quot;// &quot;, nil, nil, nil)
 56         end
 57     end
 58 
<span class="line-modified"> 59     def self.create(filename, dependency)</span>
 60         template = Template.new
 61         yield template
 62 
 63         file = File.open(filename, &quot;w&quot;)
<span class="line-modified"> 64         self.sha1(file, template, dependency)</span>
<span class="line-modified"> 65         self.license(file, template, dependency)</span>
 66 
 67         unless template.prefix.nil?
 68             write(file, template.prefix.to_s, &quot;\n&quot;)
 69         end
 70         unless template.body.nil?
 71             write(file, template.body.to_s, &quot;\n&quot;)
 72         end
 73         unless template.suffix.nil?
 74             write(file, template.suffix.to_s, &quot;\n&quot;)
 75         end
 76     end
 77 
<span class="line-modified"> 78     def self.sha1(file, template, dependency)</span>
<span class="line-modified"> 79         write(file, template.line_comment, &quot; SHA1Hash: &quot;, Digest::SHA1.hexdigest(dependency.read), &quot;\n&quot;)</span>
 80     end
 81 
<span class="line-modified"> 82     def self.license(file, template, dependency)</span>
 83         unless template.multiline_comment.nil?
 84             write(file, template.multiline_comment[0], &quot;\n&quot;)
 85         end
 86 
 87         comment = if template.multiline_comment.nil? then template.line_comment else template.multiline_comment[1] end
 88         write(file, $LICENSE.strip.split(&quot;\n&quot;).map { |line| &quot;#{comment} #{line}&quot; }.join(&quot;\n&quot;), &quot;\n\n&quot;)
<span class="line-modified"> 89         write(file, comment, &quot; Autogenerated from &quot;, dependency.path, &quot;, do not modify.\n&quot;)</span>
 90 
 91         unless template.multiline_comment.nil?
 92             write(file, template.multiline_comment[2], &quot;\n&quot;)
 93         end
 94 
 95         write(file, &quot;\n&quot;)
 96     end
 97 
 98     def self.write(file, *strings)
 99         file.write(strings.map(&amp;:to_s).join)
100     end
101 end
102 
</pre>
</td>
<td>
<hr />
<pre>
 39 
 40 THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 41 EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 42 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 43 DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 44 DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 45 (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 46 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 47 ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 48 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 49 THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 50 EOF
 51 
 52 module GeneratedFile
 53     class Template &lt; Struct.new(:multiline_comment, :line_comment, :prefix, :suffix, :body)
 54         def initialize
 55             super([&quot;/*&quot;, &quot; *&quot;, &quot;*/&quot;], &quot;// &quot;, nil, nil, nil)
 56         end
 57     end
 58 
<span class="line-modified"> 59     def self.create(filename, *dependencies)</span>
 60         template = Template.new
 61         yield template
 62 
 63         file = File.open(filename, &quot;w&quot;)
<span class="line-modified"> 64         self.sha1(file, template, dependencies)</span>
<span class="line-modified"> 65         self.license(file, template, dependencies)</span>
 66 
 67         unless template.prefix.nil?
 68             write(file, template.prefix.to_s, &quot;\n&quot;)
 69         end
 70         unless template.body.nil?
 71             write(file, template.body.to_s, &quot;\n&quot;)
 72         end
 73         unless template.suffix.nil?
 74             write(file, template.suffix.to_s, &quot;\n&quot;)
 75         end
 76     end
 77 
<span class="line-modified"> 78     def self.sha1(file, template, dependencies)</span>
<span class="line-modified"> 79       write(file, template.line_comment, &quot; SHA1Hash: &quot;, Digest::SHA1.hexdigest(dependencies.join), &quot;\n&quot;)</span>
 80     end
 81 
<span class="line-modified"> 82     def self.license(file, template, dependencies)</span>
 83         unless template.multiline_comment.nil?
 84             write(file, template.multiline_comment[0], &quot;\n&quot;)
 85         end
 86 
 87         comment = if template.multiline_comment.nil? then template.line_comment else template.multiline_comment[1] end
 88         write(file, $LICENSE.strip.split(&quot;\n&quot;).map { |line| &quot;#{comment} #{line}&quot; }.join(&quot;\n&quot;), &quot;\n\n&quot;)
<span class="line-modified"> 89         write(file, comment, &quot; Autogenerated, do not modify.\n&quot;)</span>
 90 
 91         unless template.multiline_comment.nil?
 92             write(file, template.multiline_comment[2], &quot;\n&quot;)
 93         end
 94 
 95         write(file, &quot;\n&quot;)
 96     end
 97 
 98     def self.write(file, *strings)
 99         file.write(strings.map(&amp;:to_s).join)
100     end
101 end
102 
</pre>
</td>
</tr>
</table>
<center><a href="DSL.rb.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Metadata.rb.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>