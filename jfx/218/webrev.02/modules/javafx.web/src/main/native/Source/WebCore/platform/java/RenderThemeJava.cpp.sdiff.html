<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/java/RenderThemeJava.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PasteboardJava.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="RenderThemeJava.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/java/RenderThemeJava.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
191 
192         extParams.grow(sizeof(jfloat) + sizeof(jint));
193         jbyte *data = extParams.data();
194         memcpy(data, &amp;value, sizeof(value));
195         data += sizeof(jfloat);
196 
197         memcpy(data, &amp;region, sizeof(region));
198 #endif
199     }
200 
201     static jmethodID mid = env-&gt;GetMethodID(PG_GetRenderThemeClass(env), &quot;createWidget&quot;,
202             &quot;(JIIIIILjava/nio/ByteBuffer;)Lcom/sun/webkit/graphics/Ref;&quot;);
203     ASSERT(mid);
204 
205     RefPtr&lt;RQRef&gt; widgetRef = RQRef::create(
206         env-&gt;CallObjectMethod(jobject(*jRenderTheme), mid,
207             ptr_to_jlong(&amp;object),
208             (jint)widgetIndex,
209             (jint)state,
210             (jint)rect.width(), (jint)rect.height(),
<span class="line-modified">211             (jint)bgColor,</span>
212             (jobject)JLObject(extParams.isEmpty()
213                 ? nullptr
214                 : env-&gt;NewDirectByteBuffer(
215                     extParams.data(),
216                     extParams.size())))
217         );
218     if (!widgetRef.get()) {
219         //switch to WebKit default render
220         return true;
221     }
222     WTF::CheckAndClearException(env);
223 
224     // widgetRef will go into rq&#39;s inner refs vector.
225     paintInfo.context().platformContext()-&gt;rq().freeSpace(20)
226     &lt;&lt; (jint)com_sun_webkit_graphics_GraphicsDecoder_DRAWWIDGET
227     &lt;&lt; (jint)*jRenderTheme
228     &lt;&lt; widgetRef
229     &lt;&lt; (jint)rect.x() &lt;&lt; (jint)rect.y();
230 
231     return false;
</pre>
<hr />
<pre>
303 
304     if (style.width().isIntrinsicOrAuto()) {
305         style.setWidth(Length(radioRadius, Fixed));
306     }
307 
308     if (style.height().isAuto()) {
309         style.setHeight(Length(radioRadius, Fixed));
310     }
311 }
312 
313 bool RenderThemeJava::paintRadio(const RenderObject&amp;o, const PaintInfo&amp; i, const IntRect&amp; rect)
314 {
315     return paintWidget(JNI_EXPAND(RADIO_BUTTON), o, i, rect);
316 }
317 
318 bool RenderThemeJava::paintButton(const RenderObject&amp;o, const PaintInfo&amp; i, const IntRect&amp; rect)
319 {
320     return paintWidget(JNI_EXPAND(BUTTON), o, i, rect);
321 }
322 
<span class="line-modified">323 void RenderThemeJava::adjustTextFieldStyle(StyleResolver&amp;, RenderStyle&amp;, const Element*) const</span>
324 {
325     notImplemented();
326 }
327 
328 bool RenderThemeJava::paintTextField(const RenderObject&amp;o, const PaintInfo&amp; i, const FloatRect&amp; rect)
329 {
330     return paintWidget(JNI_EXPAND(TEXT_FIELD), o, i, rect);
331 }
332 
<span class="line-modified">333 void RenderThemeJava::adjustSearchFieldStyle(StyleResolver&amp;, RenderStyle&amp;, const Element*) const</span>
334 {
335     notImplemented();
336 }
337 
338 bool RenderThemeJava::paintSearchField(const RenderObject&amp;o, const PaintInfo&amp; i, const IntRect&amp; rect)
339 {
340     return paintWidget(JNI_EXPAND(TEXT_FIELD), o, i, rect);
341 }
342 
<span class="line-modified">343 void RenderThemeJava::adjustTextAreaStyle(StyleResolver&amp;, RenderStyle&amp; style, const Element*) const</span>
344 {
345     if (style.paddingTop().isIntrinsicOrAuto())
346         style.setPaddingTop(Length(1, Fixed));
347     if (style.paddingBottom().isIntrinsicOrAuto())
348         style.setPaddingBottom(Length(1, Fixed));
349 }
350 
351 bool RenderThemeJava::paintTextArea(const RenderObject&amp;o, const PaintInfo&amp; i, const FloatRect&amp; r)
352 {
353     return paintTextField(o, i, r);
354 }
355 
<span class="line-modified">356 void RenderThemeJava::adjustButtonStyle(StyleResolver&amp;, RenderStyle&amp; style, const Element*) const</span>
357 {
358     if (style.appearance() == PushButtonPart) {
359         // Ignore line-height.
360         style.setLineHeight(RenderStyle::initialLineHeight());
361     }
362 }
363 
364 enum JavaControlSize {
365     JavaRegularControlSize, // The control is sized as regular.
366     JavaSmallControlSize,   // The control has a smaller size.
367     JavaMiniControlSize     // The control has a smaller size than JavaSmallControlSize.
368 };
369 
370 static float systemFontSizeForControlSize(JavaControlSize controlSize)
371 {
372     static float sizes[] = { 16.0f, 13.0f, 10.0f };
373 
374     return sizes[controlSize];
375 }
376 
</pre>
<hr />
<pre>
419                 fontSize = systemFontSizeForControlSize(JavaRegularControlSize);
420             break;
421         default:
422             cachedDesc = &amp;systemFont;
423             if (!systemFont.isAbsoluteSize())
424                 fontSize = 13.0f;
425     }
426 
427     if (fontSize) {
428         cachedDesc-&gt;setIsAbsoluteSize(true);
429         // cachedDesc-&gt;setGenericFamily(FontCascadeDescription::NoFamily);
430         //cachedDesc-&gt;setOneFamily(&quot;Lucida Grande&quot;);
431         cachedDesc-&gt;setOneFamily(&quot;Tahoma&quot;);
432         cachedDesc-&gt;setSpecifiedSize(fontSize);
433         cachedDesc-&gt;setWeight(normalWeightValue());
434         cachedDesc-&gt;setItalic(normalItalicValue());
435     }
436     fontDescription = *cachedDesc;
437 }
438 
<span class="line-modified">439 void RenderThemeJava::adjustSliderTrackStyle(StyleResolver&amp; selector, RenderStyle&amp; style, const Element* element) const</span>
440 {
441     //utatodo: we need to measure the control in Java theme.
<span class="line-modified">442     RenderTheme::adjustSliderTrackStyle(selector, style, element);</span>
443 }
444 
445 bool RenderThemeJava::paintSliderTrack(const RenderObject&amp;object, const PaintInfo&amp; info, const IntRect&amp; rect)
446 {
447     return paintWidget(JNI_EXPAND(SLIDER), object, info, rect);
448 }
449 
450 void getSliderThumbSize(jint sliderType, int *width, int *height)
451 {
452     JNIEnv* env = WTF::GetJavaEnv();
453     JGClass cls = JLClass(env-&gt;FindClass(RENDER_MEDIA_CONTROLS_CLASS_NAME));
454     ASSERT(cls);
455 
456     jmethodID mid = env-&gt;GetStaticMethodID(cls, &quot;fwkGetSliderThumbSize&quot;, &quot;(I)I&quot;);
457     ASSERT(mid);
458 
459     jint size = env-&gt;CallStaticIntMethod(cls, mid, sliderType);
460     WTF::CheckAndClearException(env);
461     *width = (size &gt;&gt; 16) &amp; 0xFFFF;
462     *height = size &amp; 0xFFFF;
</pre>
<hr />
<pre>
486         style.setWidth(Length(timeWidth, Fixed));
487         style.setHeight(Length(timeHeight, Fixed));
488     } else if (part == MediaVolumeSliderThumbPart) {
489         static int volumeWidth = 0;
490         static int volumeHeight;
491         if (volumeWidth == 0) {
492             getSliderThumbSize(JNI_EXPAND_MEDIA(SLIDER_TYPE_VOLUME), &amp;volumeWidth, &amp;volumeHeight);
493         }
494         style.setWidth(Length(volumeWidth, Fixed));
495         style.setHeight(Length(volumeHeight, Fixed));
496     }
497 #endif
498 }
499 
500 bool RenderThemeJava::paintSliderThumb(const RenderObject&amp;, const PaintInfo&amp;, const IntRect&amp;)
501 {
502     // We&#39;ve already painted it in paintSliderTrack(), no need to do anything here.
503     return false;
504 }
505 
<span class="line-modified">506 void RenderThemeJava::adjustMenuListStyle(StyleResolver&amp;, RenderStyle&amp; style, const Element*) const</span>
507 {
508     // Add in the padding that we&#39;d like to use.
509     style.setPaddingRight(Length(20.0f + style.paddingRight().value(), Fixed));
510     style.setPaddingLeft(Length(2.0f + style.paddingLeft().value(), Fixed));
511 }
512 
513 bool RenderThemeJava::paintMenuList(const RenderObject&amp; o, const PaintInfo&amp; i, const FloatRect&amp; rect)
514 {
515     return paintWidget(JNI_EXPAND(MENU_LIST), o, i, rect);
516 }
517 
<span class="line-modified">518 void RenderThemeJava::adjustMenuListButtonStyle(StyleResolver&amp; selector, RenderStyle&amp; style, const Element* e) const</span>
519 {
520     style.resetBorderRadius();
<span class="line-modified">521     adjustMenuListStyle(selector, style, e);</span>
522 }
523 
524 bool RenderThemeJava::paintMenuListButtonDecorations(const RenderBox&amp; o, const PaintInfo&amp; i, const FloatRect&amp; r)
525 {
526     IntRect rect(r.x() + r.width(), r.y(), r.height(), r.height());
527 
528     return paintWidget(JNI_EXPAND(MENU_LIST_BUTTON), o, i, rect);
529 }
530 
531 bool RenderThemeJava::supportsFocusRing(const RenderStyle&amp; style) const
532 {
533     if (!style.hasAppearance())
534         return false;
535 
536     switch (style.appearance()) {
537     case TextFieldPart:
538     case TextAreaPart:
539     case ButtonPart:
540     case CheckboxPart:
541     case RadioPart:
</pre>
</td>
<td>
<hr />
<pre>
191 
192         extParams.grow(sizeof(jfloat) + sizeof(jint));
193         jbyte *data = extParams.data();
194         memcpy(data, &amp;value, sizeof(value));
195         data += sizeof(jfloat);
196 
197         memcpy(data, &amp;region, sizeof(region));
198 #endif
199     }
200 
201     static jmethodID mid = env-&gt;GetMethodID(PG_GetRenderThemeClass(env), &quot;createWidget&quot;,
202             &quot;(JIIIIILjava/nio/ByteBuffer;)Lcom/sun/webkit/graphics/Ref;&quot;);
203     ASSERT(mid);
204 
205     RefPtr&lt;RQRef&gt; widgetRef = RQRef::create(
206         env-&gt;CallObjectMethod(jobject(*jRenderTheme), mid,
207             ptr_to_jlong(&amp;object),
208             (jint)widgetIndex,
209             (jint)state,
210             (jint)rect.width(), (jint)rect.height(),
<span class="line-modified">211             (jint)bgColor.value(),</span>
212             (jobject)JLObject(extParams.isEmpty()
213                 ? nullptr
214                 : env-&gt;NewDirectByteBuffer(
215                     extParams.data(),
216                     extParams.size())))
217         );
218     if (!widgetRef.get()) {
219         //switch to WebKit default render
220         return true;
221     }
222     WTF::CheckAndClearException(env);
223 
224     // widgetRef will go into rq&#39;s inner refs vector.
225     paintInfo.context().platformContext()-&gt;rq().freeSpace(20)
226     &lt;&lt; (jint)com_sun_webkit_graphics_GraphicsDecoder_DRAWWIDGET
227     &lt;&lt; (jint)*jRenderTheme
228     &lt;&lt; widgetRef
229     &lt;&lt; (jint)rect.x() &lt;&lt; (jint)rect.y();
230 
231     return false;
</pre>
<hr />
<pre>
303 
304     if (style.width().isIntrinsicOrAuto()) {
305         style.setWidth(Length(radioRadius, Fixed));
306     }
307 
308     if (style.height().isAuto()) {
309         style.setHeight(Length(radioRadius, Fixed));
310     }
311 }
312 
313 bool RenderThemeJava::paintRadio(const RenderObject&amp;o, const PaintInfo&amp; i, const IntRect&amp; rect)
314 {
315     return paintWidget(JNI_EXPAND(RADIO_BUTTON), o, i, rect);
316 }
317 
318 bool RenderThemeJava::paintButton(const RenderObject&amp;o, const PaintInfo&amp; i, const IntRect&amp; rect)
319 {
320     return paintWidget(JNI_EXPAND(BUTTON), o, i, rect);
321 }
322 
<span class="line-modified">323 void RenderThemeJava::adjustTextFieldStyle(RenderStyle&amp;, const Element*) const</span>
324 {
325     notImplemented();
326 }
327 
328 bool RenderThemeJava::paintTextField(const RenderObject&amp;o, const PaintInfo&amp; i, const FloatRect&amp; rect)
329 {
330     return paintWidget(JNI_EXPAND(TEXT_FIELD), o, i, rect);
331 }
332 
<span class="line-modified">333 void RenderThemeJava::adjustSearchFieldStyle(RenderStyle&amp;, const Element*) const</span>
334 {
335     notImplemented();
336 }
337 
338 bool RenderThemeJava::paintSearchField(const RenderObject&amp;o, const PaintInfo&amp; i, const IntRect&amp; rect)
339 {
340     return paintWidget(JNI_EXPAND(TEXT_FIELD), o, i, rect);
341 }
342 
<span class="line-modified">343 void RenderThemeJava::adjustTextAreaStyle(RenderStyle&amp; style, const Element*) const</span>
344 {
345     if (style.paddingTop().isIntrinsicOrAuto())
346         style.setPaddingTop(Length(1, Fixed));
347     if (style.paddingBottom().isIntrinsicOrAuto())
348         style.setPaddingBottom(Length(1, Fixed));
349 }
350 
351 bool RenderThemeJava::paintTextArea(const RenderObject&amp;o, const PaintInfo&amp; i, const FloatRect&amp; r)
352 {
353     return paintTextField(o, i, r);
354 }
355 
<span class="line-modified">356 void RenderThemeJava::adjustButtonStyle(RenderStyle&amp; style, const Element*) const</span>
357 {
358     if (style.appearance() == PushButtonPart) {
359         // Ignore line-height.
360         style.setLineHeight(RenderStyle::initialLineHeight());
361     }
362 }
363 
364 enum JavaControlSize {
365     JavaRegularControlSize, // The control is sized as regular.
366     JavaSmallControlSize,   // The control has a smaller size.
367     JavaMiniControlSize     // The control has a smaller size than JavaSmallControlSize.
368 };
369 
370 static float systemFontSizeForControlSize(JavaControlSize controlSize)
371 {
372     static float sizes[] = { 16.0f, 13.0f, 10.0f };
373 
374     return sizes[controlSize];
375 }
376 
</pre>
<hr />
<pre>
419                 fontSize = systemFontSizeForControlSize(JavaRegularControlSize);
420             break;
421         default:
422             cachedDesc = &amp;systemFont;
423             if (!systemFont.isAbsoluteSize())
424                 fontSize = 13.0f;
425     }
426 
427     if (fontSize) {
428         cachedDesc-&gt;setIsAbsoluteSize(true);
429         // cachedDesc-&gt;setGenericFamily(FontCascadeDescription::NoFamily);
430         //cachedDesc-&gt;setOneFamily(&quot;Lucida Grande&quot;);
431         cachedDesc-&gt;setOneFamily(&quot;Tahoma&quot;);
432         cachedDesc-&gt;setSpecifiedSize(fontSize);
433         cachedDesc-&gt;setWeight(normalWeightValue());
434         cachedDesc-&gt;setItalic(normalItalicValue());
435     }
436     fontDescription = *cachedDesc;
437 }
438 
<span class="line-modified">439 void RenderThemeJava::adjustSliderTrackStyle(RenderStyle&amp; style, const Element* element) const</span>
440 {
441     //utatodo: we need to measure the control in Java theme.
<span class="line-modified">442     RenderTheme::adjustSliderTrackStyle(style, element);</span>
443 }
444 
445 bool RenderThemeJava::paintSliderTrack(const RenderObject&amp;object, const PaintInfo&amp; info, const IntRect&amp; rect)
446 {
447     return paintWidget(JNI_EXPAND(SLIDER), object, info, rect);
448 }
449 
450 void getSliderThumbSize(jint sliderType, int *width, int *height)
451 {
452     JNIEnv* env = WTF::GetJavaEnv();
453     JGClass cls = JLClass(env-&gt;FindClass(RENDER_MEDIA_CONTROLS_CLASS_NAME));
454     ASSERT(cls);
455 
456     jmethodID mid = env-&gt;GetStaticMethodID(cls, &quot;fwkGetSliderThumbSize&quot;, &quot;(I)I&quot;);
457     ASSERT(mid);
458 
459     jint size = env-&gt;CallStaticIntMethod(cls, mid, sliderType);
460     WTF::CheckAndClearException(env);
461     *width = (size &gt;&gt; 16) &amp; 0xFFFF;
462     *height = size &amp; 0xFFFF;
</pre>
<hr />
<pre>
486         style.setWidth(Length(timeWidth, Fixed));
487         style.setHeight(Length(timeHeight, Fixed));
488     } else if (part == MediaVolumeSliderThumbPart) {
489         static int volumeWidth = 0;
490         static int volumeHeight;
491         if (volumeWidth == 0) {
492             getSliderThumbSize(JNI_EXPAND_MEDIA(SLIDER_TYPE_VOLUME), &amp;volumeWidth, &amp;volumeHeight);
493         }
494         style.setWidth(Length(volumeWidth, Fixed));
495         style.setHeight(Length(volumeHeight, Fixed));
496     }
497 #endif
498 }
499 
500 bool RenderThemeJava::paintSliderThumb(const RenderObject&amp;, const PaintInfo&amp;, const IntRect&amp;)
501 {
502     // We&#39;ve already painted it in paintSliderTrack(), no need to do anything here.
503     return false;
504 }
505 
<span class="line-modified">506 void RenderThemeJava::adjustMenuListStyle(RenderStyle&amp; style, const Element*) const</span>
507 {
508     // Add in the padding that we&#39;d like to use.
509     style.setPaddingRight(Length(20.0f + style.paddingRight().value(), Fixed));
510     style.setPaddingLeft(Length(2.0f + style.paddingLeft().value(), Fixed));
511 }
512 
513 bool RenderThemeJava::paintMenuList(const RenderObject&amp; o, const PaintInfo&amp; i, const FloatRect&amp; rect)
514 {
515     return paintWidget(JNI_EXPAND(MENU_LIST), o, i, rect);
516 }
517 
<span class="line-modified">518 void RenderThemeJava::adjustMenuListButtonStyle(RenderStyle&amp; style, const Element* e) const</span>
519 {
520     style.resetBorderRadius();
<span class="line-modified">521     adjustMenuListStyle(style, e);</span>
522 }
523 
524 bool RenderThemeJava::paintMenuListButtonDecorations(const RenderBox&amp; o, const PaintInfo&amp; i, const FloatRect&amp; r)
525 {
526     IntRect rect(r.x() + r.width(), r.y(), r.height(), r.height());
527 
528     return paintWidget(JNI_EXPAND(MENU_LIST_BUTTON), o, i, rect);
529 }
530 
531 bool RenderThemeJava::supportsFocusRing(const RenderStyle&amp; style) const
532 {
533     if (!style.hasAppearance())
534         return false;
535 
536     switch (style.appearance()) {
537     case TextFieldPart:
538     case TextAreaPart:
539     case ButtonPart:
540     case CheckboxPart:
541     case RadioPart:
</pre>
</td>
</tr>
</table>
<center><a href="PasteboardJava.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="RenderThemeJava.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>