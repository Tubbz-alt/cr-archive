<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/FunctionPrototype.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FunctionExecutable.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FunctionPrototype.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/FunctionPrototype.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 20 
 21 #include &quot;config.h&quot;
 22 #include &quot;FunctionPrototype.h&quot;
 23 
 24 #include &quot;BuiltinExecutables.h&quot;
 25 #include &quot;BuiltinNames.h&quot;
 26 #include &quot;Error.h&quot;
 27 #include &quot;GetterSetter.h&quot;
 28 #include &quot;JSAsyncFunction.h&quot;
 29 #include &quot;JSCInlines.h&quot;
 30 #include &quot;JSFunction.h&quot;
 31 #include &quot;JSStringInlines.h&quot;
 32 #include &quot;Lexer.h&quot;
 33 
 34 namespace JSC {
 35 
 36 STATIC_ASSERT_IS_TRIVIALLY_DESTRUCTIBLE(FunctionPrototype);
 37 
 38 const ClassInfo FunctionPrototype::s_info = { &quot;Function&quot;, &amp;Base::s_info, nullptr, nullptr, CREATE_METHOD_TABLE(FunctionPrototype) };
 39 
<span class="line-modified"> 40 static EncodedJSValue JSC_HOST_CALL functionProtoFuncToString(ExecState*);</span>
 41 
 42 // ECMA 15.3.4
<span class="line-modified"> 43 static EncodedJSValue JSC_HOST_CALL callFunctionPrototype(ExecState*)</span>
 44 {
 45     return JSValue::encode(jsUndefined());
 46 }
 47 
 48 FunctionPrototype::FunctionPrototype(VM&amp; vm, Structure* structure)
 49     : InternalFunction(vm, structure, callFunctionPrototype, nullptr)
 50 {
 51 }
 52 
 53 void FunctionPrototype::finishCreation(VM&amp; vm, const String&amp; name)
 54 {
<span class="line-modified"> 55     Base::finishCreation(vm, name, NameVisibility::Visible, NameAdditionMode::WithoutStructureTransition);</span>
 56     putDirectWithoutTransition(vm, vm.propertyNames-&gt;length, jsNumber(0), PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly | PropertyAttribute::DontEnum);
 57 }
 58 
 59 void FunctionPrototype::addFunctionProperties(VM&amp; vm, JSGlobalObject* globalObject, JSFunction** callFunction, JSFunction** applyFunction, JSFunction** hasInstanceSymbolFunction)
 60 {
 61     JSFunction* toStringFunction = JSFunction::create(vm, globalObject, 0, vm.propertyNames-&gt;toString.string(), functionProtoFuncToString);
 62     putDirectWithoutTransition(vm, vm.propertyNames-&gt;toString, toStringFunction, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 63 
 64     *applyFunction = putDirectBuiltinFunctionWithoutTransition(vm, globalObject, vm.propertyNames-&gt;builtinNames().applyPublicName(), functionPrototypeApplyCodeGenerator(vm), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 65     *callFunction = putDirectBuiltinFunctionWithoutTransition(vm, globalObject, vm.propertyNames-&gt;builtinNames().callPublicName(), functionPrototypeCallCodeGenerator(vm), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 66     putDirectBuiltinFunctionWithoutTransition(vm, globalObject, vm.propertyNames-&gt;bind, functionPrototypeBindCodeGenerator(vm), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 67 
 68     *hasInstanceSymbolFunction = JSFunction::create(vm, functionPrototypeSymbolHasInstanceCodeGenerator(vm), globalObject);
 69     putDirectWithoutTransition(vm, vm.propertyNames-&gt;hasInstanceSymbol, *hasInstanceSymbolFunction, PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly | PropertyAttribute::DontEnum);
 70 }
 71 
 72 void FunctionPrototype::initRestrictedProperties(VM&amp; vm, JSGlobalObject* globalObject)
 73 {
 74     GetterSetter* errorGetterSetter = globalObject-&gt;throwTypeErrorArgumentsCalleeAndCallerGetterSetter();
 75     putDirectNonIndexAccessorWithoutTransition(vm, vm.propertyNames-&gt;caller, errorGetterSetter, PropertyAttribute::DontEnum | PropertyAttribute::Accessor);
 76     putDirectNonIndexAccessorWithoutTransition(vm, vm.propertyNames-&gt;arguments, errorGetterSetter, PropertyAttribute::DontEnum | PropertyAttribute::Accessor);
 77 }
 78 
<span class="line-modified"> 79 EncodedJSValue JSC_HOST_CALL functionProtoFuncToString(ExecState* exec)</span>
 80 {
<span class="line-modified"> 81     VM&amp; vm = exec-&gt;vm();</span>
 82     auto scope = DECLARE_THROW_SCOPE(vm);
 83 
<span class="line-modified"> 84     JSValue thisValue = exec-&gt;thisValue();</span>
 85     if (thisValue.inherits&lt;JSFunction&gt;(vm)) {
 86         JSFunction* function = jsCast&lt;JSFunction*&gt;(thisValue);
 87         if (function-&gt;isHostOrBuiltinFunction())
<span class="line-modified"> 88             RELEASE_AND_RETURN(scope, JSValue::encode(jsMakeNontrivialString(exec, &quot;function &quot;, function-&gt;name(vm), &quot;() {\n    [native code]\n}&quot;)));</span>
 89 
 90         FunctionExecutable* executable = function-&gt;jsExecutable();
 91         if (executable-&gt;isClass())
 92             return JSValue::encode(jsString(vm, executable-&gt;classSource().view().toString()));
 93 
 94         String functionHeader;
 95         switch (executable-&gt;parseMode()) {
 96         case SourceParseMode::GeneratorWrapperFunctionMode:
 97         case SourceParseMode::GeneratorWrapperMethodMode:
 98             functionHeader = &quot;function* &quot;;
 99             break;
100 
101         case SourceParseMode::NormalFunctionMode:
102         case SourceParseMode::GetterMode:
103         case SourceParseMode::SetterMode:
104         case SourceParseMode::MethodMode:
105         case SourceParseMode::ProgramMode:
106         case SourceParseMode::ModuleAnalyzeMode:
107         case SourceParseMode::ModuleEvaluateMode:
108         case SourceParseMode::GeneratorBodyMode:
109         case SourceParseMode::AsyncGeneratorBodyMode:
110         case SourceParseMode::AsyncFunctionBodyMode:
111         case SourceParseMode::AsyncArrowFunctionBodyMode:
112             functionHeader = &quot;function &quot;;
113             break;
114 
115         case SourceParseMode::ArrowFunctionMode:

116             functionHeader = &quot;&quot;;
117             break;
118 
119         case SourceParseMode::AsyncFunctionMode:
120         case SourceParseMode::AsyncMethodMode:
121             functionHeader = &quot;async function &quot;;
122             break;
123 
124         case SourceParseMode::AsyncArrowFunctionMode:
125             functionHeader = &quot;async &quot;;
126             break;
127 
128         case SourceParseMode::AsyncGeneratorWrapperFunctionMode:
129         case SourceParseMode::AsyncGeneratorWrapperMethodMode:
130             functionHeader = &quot;async function* &quot;;
131             break;
132         }
133 
134         StringView source = executable-&gt;source().provider()-&gt;getRange(
135             executable-&gt;parametersStartOffset(),
136             executable-&gt;parametersStartOffset() + executable-&gt;source().length());
<span class="line-modified">137         RELEASE_AND_RETURN(scope, JSValue::encode(jsMakeNontrivialString(exec, functionHeader, function-&gt;name(vm), source)));</span>
138     }
139 
140     if (thisValue.inherits&lt;InternalFunction&gt;(vm)) {
141         InternalFunction* function = jsCast&lt;InternalFunction*&gt;(thisValue);
<span class="line-modified">142         RELEASE_AND_RETURN(scope, JSValue::encode(jsMakeNontrivialString(exec, &quot;function &quot;, function-&gt;name(), &quot;() {\n    [native code]\n}&quot;)));</span>
143     }
144 
145     if (thisValue.isObject()) {
146         JSObject* object = asObject(thisValue);
147         if (object-&gt;isFunction(vm))
<span class="line-modified">148             RELEASE_AND_RETURN(scope, JSValue::encode(jsMakeNontrivialString(exec, &quot;function &quot;, object-&gt;classInfo(vm)-&gt;className, &quot;() {\n    [native code]\n}&quot;)));</span>
149     }
150 
<span class="line-modified">151     return throwVMTypeError(exec, scope);</span>
152 }
153 
154 } // namespace JSC
</pre>
</td>
<td>
<hr />
<pre>
 20 
 21 #include &quot;config.h&quot;
 22 #include &quot;FunctionPrototype.h&quot;
 23 
 24 #include &quot;BuiltinExecutables.h&quot;
 25 #include &quot;BuiltinNames.h&quot;
 26 #include &quot;Error.h&quot;
 27 #include &quot;GetterSetter.h&quot;
 28 #include &quot;JSAsyncFunction.h&quot;
 29 #include &quot;JSCInlines.h&quot;
 30 #include &quot;JSFunction.h&quot;
 31 #include &quot;JSStringInlines.h&quot;
 32 #include &quot;Lexer.h&quot;
 33 
 34 namespace JSC {
 35 
 36 STATIC_ASSERT_IS_TRIVIALLY_DESTRUCTIBLE(FunctionPrototype);
 37 
 38 const ClassInfo FunctionPrototype::s_info = { &quot;Function&quot;, &amp;Base::s_info, nullptr, nullptr, CREATE_METHOD_TABLE(FunctionPrototype) };
 39 
<span class="line-modified"> 40 static EncodedJSValue JSC_HOST_CALL functionProtoFuncToString(JSGlobalObject*, CallFrame*);</span>
 41 
 42 // ECMA 15.3.4
<span class="line-modified"> 43 static EncodedJSValue JSC_HOST_CALL callFunctionPrototype(JSGlobalObject*, CallFrame*)</span>
 44 {
 45     return JSValue::encode(jsUndefined());
 46 }
 47 
 48 FunctionPrototype::FunctionPrototype(VM&amp; vm, Structure* structure)
 49     : InternalFunction(vm, structure, callFunctionPrototype, nullptr)
 50 {
 51 }
 52 
 53 void FunctionPrototype::finishCreation(VM&amp; vm, const String&amp; name)
 54 {
<span class="line-modified"> 55     Base::finishCreation(vm, name, NameAdditionMode::WithoutStructureTransition);</span>
 56     putDirectWithoutTransition(vm, vm.propertyNames-&gt;length, jsNumber(0), PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly | PropertyAttribute::DontEnum);
 57 }
 58 
 59 void FunctionPrototype::addFunctionProperties(VM&amp; vm, JSGlobalObject* globalObject, JSFunction** callFunction, JSFunction** applyFunction, JSFunction** hasInstanceSymbolFunction)
 60 {
 61     JSFunction* toStringFunction = JSFunction::create(vm, globalObject, 0, vm.propertyNames-&gt;toString.string(), functionProtoFuncToString);
 62     putDirectWithoutTransition(vm, vm.propertyNames-&gt;toString, toStringFunction, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 63 
 64     *applyFunction = putDirectBuiltinFunctionWithoutTransition(vm, globalObject, vm.propertyNames-&gt;builtinNames().applyPublicName(), functionPrototypeApplyCodeGenerator(vm), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 65     *callFunction = putDirectBuiltinFunctionWithoutTransition(vm, globalObject, vm.propertyNames-&gt;builtinNames().callPublicName(), functionPrototypeCallCodeGenerator(vm), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 66     putDirectBuiltinFunctionWithoutTransition(vm, globalObject, vm.propertyNames-&gt;bind, functionPrototypeBindCodeGenerator(vm), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
 67 
 68     *hasInstanceSymbolFunction = JSFunction::create(vm, functionPrototypeSymbolHasInstanceCodeGenerator(vm), globalObject);
 69     putDirectWithoutTransition(vm, vm.propertyNames-&gt;hasInstanceSymbol, *hasInstanceSymbolFunction, PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly | PropertyAttribute::DontEnum);
 70 }
 71 
 72 void FunctionPrototype::initRestrictedProperties(VM&amp; vm, JSGlobalObject* globalObject)
 73 {
 74     GetterSetter* errorGetterSetter = globalObject-&gt;throwTypeErrorArgumentsCalleeAndCallerGetterSetter();
 75     putDirectNonIndexAccessorWithoutTransition(vm, vm.propertyNames-&gt;caller, errorGetterSetter, PropertyAttribute::DontEnum | PropertyAttribute::Accessor);
 76     putDirectNonIndexAccessorWithoutTransition(vm, vm.propertyNames-&gt;arguments, errorGetterSetter, PropertyAttribute::DontEnum | PropertyAttribute::Accessor);
 77 }
 78 
<span class="line-modified"> 79 EncodedJSValue JSC_HOST_CALL functionProtoFuncToString(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
 80 {
<span class="line-modified"> 81     VM&amp; vm = globalObject-&gt;vm();</span>
 82     auto scope = DECLARE_THROW_SCOPE(vm);
 83 
<span class="line-modified"> 84     JSValue thisValue = callFrame-&gt;thisValue();</span>
 85     if (thisValue.inherits&lt;JSFunction&gt;(vm)) {
 86         JSFunction* function = jsCast&lt;JSFunction*&gt;(thisValue);
 87         if (function-&gt;isHostOrBuiltinFunction())
<span class="line-modified"> 88             RELEASE_AND_RETURN(scope, JSValue::encode(jsMakeNontrivialString(globalObject, &quot;function &quot;, function-&gt;name(vm), &quot;() {\n    [native code]\n}&quot;)));</span>
 89 
 90         FunctionExecutable* executable = function-&gt;jsExecutable();
 91         if (executable-&gt;isClass())
 92             return JSValue::encode(jsString(vm, executable-&gt;classSource().view().toString()));
 93 
 94         String functionHeader;
 95         switch (executable-&gt;parseMode()) {
 96         case SourceParseMode::GeneratorWrapperFunctionMode:
 97         case SourceParseMode::GeneratorWrapperMethodMode:
 98             functionHeader = &quot;function* &quot;;
 99             break;
100 
101         case SourceParseMode::NormalFunctionMode:
102         case SourceParseMode::GetterMode:
103         case SourceParseMode::SetterMode:
104         case SourceParseMode::MethodMode:
105         case SourceParseMode::ProgramMode:
106         case SourceParseMode::ModuleAnalyzeMode:
107         case SourceParseMode::ModuleEvaluateMode:
108         case SourceParseMode::GeneratorBodyMode:
109         case SourceParseMode::AsyncGeneratorBodyMode:
110         case SourceParseMode::AsyncFunctionBodyMode:
111         case SourceParseMode::AsyncArrowFunctionBodyMode:
112             functionHeader = &quot;function &quot;;
113             break;
114 
115         case SourceParseMode::ArrowFunctionMode:
<span class="line-added">116         case SourceParseMode::InstanceFieldInitializerMode:</span>
117             functionHeader = &quot;&quot;;
118             break;
119 
120         case SourceParseMode::AsyncFunctionMode:
121         case SourceParseMode::AsyncMethodMode:
122             functionHeader = &quot;async function &quot;;
123             break;
124 
125         case SourceParseMode::AsyncArrowFunctionMode:
126             functionHeader = &quot;async &quot;;
127             break;
128 
129         case SourceParseMode::AsyncGeneratorWrapperFunctionMode:
130         case SourceParseMode::AsyncGeneratorWrapperMethodMode:
131             functionHeader = &quot;async function* &quot;;
132             break;
133         }
134 
135         StringView source = executable-&gt;source().provider()-&gt;getRange(
136             executable-&gt;parametersStartOffset(),
137             executable-&gt;parametersStartOffset() + executable-&gt;source().length());
<span class="line-modified">138         RELEASE_AND_RETURN(scope, JSValue::encode(jsMakeNontrivialString(globalObject, functionHeader, function-&gt;name(vm), source)));</span>
139     }
140 
141     if (thisValue.inherits&lt;InternalFunction&gt;(vm)) {
142         InternalFunction* function = jsCast&lt;InternalFunction*&gt;(thisValue);
<span class="line-modified">143         RELEASE_AND_RETURN(scope, JSValue::encode(jsMakeNontrivialString(globalObject, &quot;function &quot;, function-&gt;name(), &quot;() {\n    [native code]\n}&quot;)));</span>
144     }
145 
146     if (thisValue.isObject()) {
147         JSObject* object = asObject(thisValue);
148         if (object-&gt;isFunction(vm))
<span class="line-modified">149             RELEASE_AND_RETURN(scope, JSValue::encode(jsMakeNontrivialString(globalObject, &quot;function &quot;, object-&gt;classInfo(vm)-&gt;className, &quot;() {\n    [native code]\n}&quot;)));</span>
150     }
151 
<span class="line-modified">152     return throwVMTypeError(globalObject, scope);</span>
153 }
154 
155 } // namespace JSC
</pre>
</td>
</tr>
</table>
<center><a href="FunctionExecutable.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FunctionPrototype.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>