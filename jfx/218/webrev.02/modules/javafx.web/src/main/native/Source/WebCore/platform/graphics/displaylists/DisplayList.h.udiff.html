<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/displaylists/DisplayList.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../cv/VideoTextureCopierCV.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="DisplayListItems.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/displaylists/DisplayList.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -23,27 +23,135 @@</span>
   * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   */
  
  #pragma once
  
<span class="udiff-line-modified-removed">- #include &quot;DisplayListItems.h&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;FloatRect.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;GraphicsContext.h&quot;</span>
  #include &lt;wtf/FastMalloc.h&gt;
  #include &lt;wtf/Noncopyable.h&gt;
  #include &lt;wtf/text/WTFString.h&gt;
  
  namespace WTF {
  class TextStream;
  }
  
  namespace WebCore {
  
<span class="udiff-line-removed">- class FloatRect;</span>
<span class="udiff-line-removed">- class GraphicsContext;</span>
<span class="udiff-line-removed">- </span>
  namespace DisplayList {
  
<span class="udiff-line-modified-removed">- class Item;</span>
<span class="udiff-line-modified-added">+ enum class ItemType : uint8_t {</span>
<span class="udiff-line-added">+     Save,</span>
<span class="udiff-line-added">+     Restore,</span>
<span class="udiff-line-added">+     Translate,</span>
<span class="udiff-line-added">+     Rotate,</span>
<span class="udiff-line-added">+     Scale,</span>
<span class="udiff-line-added">+     ConcatenateCTM,</span>
<span class="udiff-line-added">+     SetCTM,</span>
<span class="udiff-line-added">+     SetState,</span>
<span class="udiff-line-added">+     SetLineCap,</span>
<span class="udiff-line-added">+     SetLineDash,</span>
<span class="udiff-line-added">+     SetLineJoin,</span>
<span class="udiff-line-added">+     SetMiterLimit,</span>
<span class="udiff-line-added">+     ClearShadow,</span>
<span class="udiff-line-added">+     Clip,</span>
<span class="udiff-line-added">+     ClipOut,</span>
<span class="udiff-line-added">+     ClipOutToPath,</span>
<span class="udiff-line-added">+     ClipPath,</span>
<span class="udiff-line-added">+     DrawGlyphs,</span>
<span class="udiff-line-added">+     DrawImage,</span>
<span class="udiff-line-added">+     DrawTiledImage,</span>
<span class="udiff-line-added">+     DrawTiledScaledImage,</span>
<span class="udiff-line-added">+ #if USE(CG) || USE(CAIRO) || USE(DIRECT2D)</span>
<span class="udiff-line-added">+     DrawNativeImage,</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+     DrawPattern,</span>
<span class="udiff-line-added">+     DrawRect,</span>
<span class="udiff-line-added">+     DrawLine,</span>
<span class="udiff-line-added">+     DrawLinesForText,</span>
<span class="udiff-line-added">+     DrawDotsForDocumentMarker,</span>
<span class="udiff-line-added">+     DrawEllipse,</span>
<span class="udiff-line-added">+     DrawPath,</span>
<span class="udiff-line-added">+     DrawFocusRingPath,</span>
<span class="udiff-line-added">+     DrawFocusRingRects,</span>
<span class="udiff-line-added">+     FillRect,</span>
<span class="udiff-line-added">+     FillRectWithColor,</span>
<span class="udiff-line-added">+     FillRectWithGradient,</span>
<span class="udiff-line-added">+     FillCompositedRect,</span>
<span class="udiff-line-added">+     FillRoundedRect,</span>
<span class="udiff-line-added">+     FillRectWithRoundedHole,</span>
<span class="udiff-line-added">+     FillPath,</span>
<span class="udiff-line-added">+     FillEllipse,</span>
<span class="udiff-line-added">+     StrokeRect,</span>
<span class="udiff-line-added">+     StrokePath,</span>
<span class="udiff-line-added">+     StrokeEllipse,</span>
<span class="udiff-line-added">+     ClearRect,</span>
<span class="udiff-line-added">+     BeginTransparencyLayer,</span>
<span class="udiff-line-added">+     EndTransparencyLayer,</span>
<span class="udiff-line-added">+ #if USE(CG)</span>
<span class="udiff-line-added">+     ApplyStrokePattern, // FIXME: should not be a recorded item.</span>
<span class="udiff-line-added">+     ApplyFillPattern, // FIXME: should not be a recorded item.</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+     ApplyDeviceScaleFactor,</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ class Item : public RefCounted&lt;Item&gt; {</span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+     Item() = delete;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     WEBCORE_EXPORT Item(ItemType);</span>
<span class="udiff-line-added">+     WEBCORE_EXPORT virtual ~Item();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ItemType type() const</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         return m_type;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     virtual void apply(GraphicsContext&amp;) const = 0;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     static constexpr bool isDisplayListItem = true;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     virtual bool isDrawingItem() const { return false; }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // A state item is one preserved by Save/Restore.</span>
<span class="udiff-line-added">+     bool isStateItem() const</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         return isStateItemType(m_type);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     static bool isStateItemType(ItemType itemType)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         switch (itemType) {</span>
<span class="udiff-line-added">+         case ItemType::Translate:</span>
<span class="udiff-line-added">+         case ItemType::Rotate:</span>
<span class="udiff-line-added">+         case ItemType::Scale:</span>
<span class="udiff-line-added">+         case ItemType::ConcatenateCTM:</span>
<span class="udiff-line-added">+         case ItemType::SetCTM:</span>
<span class="udiff-line-added">+         case ItemType::SetState:</span>
<span class="udiff-line-added">+         case ItemType::SetLineCap:</span>
<span class="udiff-line-added">+         case ItemType::SetLineDash:</span>
<span class="udiff-line-added">+         case ItemType::SetLineJoin:</span>
<span class="udiff-line-added">+         case ItemType::SetMiterLimit:</span>
<span class="udiff-line-added">+         case ItemType::ClearShadow:</span>
<span class="udiff-line-added">+             return true;</span>
<span class="udiff-line-added">+         default:</span>
<span class="udiff-line-added">+             return false;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         return false;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #if !defined(NDEBUG) || !LOG_DISABLED</span>
<span class="udiff-line-added">+     WTF::CString description() const;</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+     static size_t sizeInBytes(const Item&amp;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;</span>
<span class="udiff-line-added">+     template&lt;class Decoder&gt; static Optional&lt;Ref&lt;Item&gt;&gt; decode(Decoder&amp;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ private:</span>
<span class="udiff-line-added">+     ItemType m_type;</span>
<span class="udiff-line-added">+ };</span>
  
  enum AsTextFlag {
      None                            = 0,
      IncludesPlatformOperations      = 1 &lt;&lt; 0,
  };
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -77,13 +185,17 @@</span>
  
      String asText(AsTextFlags) const;
  
  #if !defined(NDEBUG) || !LOG_DISABLED
      WTF::CString description() const;
<span class="udiff-line-modified-removed">-     void dump() const;</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT void dump() const;</span>
  #endif
  
<span class="udiff-line-added">+     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;</span>
<span class="udiff-line-added">+     template&lt;class Decoder&gt; static Optional&lt;DisplayList&gt; decode(Decoder&amp;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
  private:
      Item&amp; append(Ref&lt;Item&gt;&amp;&amp; item)
      {
          m_list.append(WTFMove(item));
          return m_list.last().get();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -100,10 +212,42 @@</span>
      Vector&lt;Ref&lt;Item&gt;&gt;&amp; list() { return m_list; }
  
      Vector&lt;Ref&lt;Item&gt;&gt; m_list;
  };
  
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ template&lt;class Encoder&gt;</span>
<span class="udiff-line-added">+ void DisplayList::encode(Encoder&amp; encoder) const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     encoder &lt;&lt; static_cast&lt;uint64_t&gt;(m_list.size());</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     for (auto&amp; item : m_list)</span>
<span class="udiff-line-added">+         encoder &lt;&lt; item.get();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ template&lt;class Decoder&gt;</span>
<span class="udiff-line-added">+ Optional&lt;DisplayList&gt; DisplayList::decode(Decoder&amp; decoder)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     Optional&lt;uint64_t&gt; itemCount;</span>
<span class="udiff-line-added">+     decoder &gt;&gt; itemCount;</span>
<span class="udiff-line-added">+     if (!itemCount)</span>
<span class="udiff-line-added">+         return WTF::nullopt;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     DisplayList displayList;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     for (uint64_t i = 0; i &lt; *itemCount; i++) {</span>
<span class="udiff-line-added">+         auto item = Item::decode(decoder);</span>
<span class="udiff-line-added">+         // FIXME: Once we can decode all types, failing to decode an item should turn into a decode failure.</span>
<span class="udiff-line-added">+         // For now, we just have to ignore it.</span>
<span class="udiff-line-added">+         if (!item)</span>
<span class="udiff-line-added">+             continue;</span>
<span class="udiff-line-added">+         displayList.append(WTFMove(*item));</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return displayList;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  } // DisplayList
  
  WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, const DisplayList::DisplayList&amp;);
  
  } // WebCore
</pre>
<center><a href="../cv/VideoTextureCopierCV.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="DisplayListItems.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>