<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSMicrotask.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSMapIterator.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSMicrotask.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSMicrotask.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 38,61 ***</span>
  
  namespace JSC {
  
  class JSMicrotask final : public Microtask {
  public:
<span class="line-modified">!     JSMicrotask(VM&amp; vm, JSValue job, JSArray* arguments)</span>
      {
          m_job.set(vm, job);
<span class="line-modified">!         m_arguments.set(vm, arguments);</span>
      }
  
      JSMicrotask(VM&amp; vm, JSValue job)
      {
          m_job.set(vm, job);
      }
  
  private:
<span class="line-modified">!     void run(ExecState*) override;</span>
  
      Strong&lt;Unknown&gt; m_job;
<span class="line-modified">!     Strong&lt;JSArray&gt; m_arguments;</span>
  };
  
  Ref&lt;Microtask&gt; createJSMicrotask(VM&amp; vm, JSValue job)
  {
      return adoptRef(*new JSMicrotask(vm, job));
  }
  
<span class="line-modified">! Ref&lt;Microtask&gt; createJSMicrotask(VM&amp; vm, JSValue job, JSArray* arguments)</span>
  {
<span class="line-modified">!     return adoptRef(*new JSMicrotask(vm, job, arguments));</span>
  }
  
<span class="line-modified">! void JSMicrotask::run(ExecState* exec)</span>
  {
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
      CallData handlerCallData;
      CallType handlerCallType = getCallData(vm, m_job.get(), handlerCallData);
      ASSERT(handlerCallType != CallType::None);
  
      MarkedArgumentBuffer handlerArguments;
<span class="line-modified">!     if (m_arguments) {</span>
<span class="line-modified">!         for (unsigned index = 0, length = m_arguments-&gt;length(); index &lt; length; ++index) {</span>
<span class="line-modified">!             JSValue arg = m_arguments-&gt;JSArray::get(exec, index);</span>
<span class="line-modified">!             CLEAR_AND_RETURN_IF_EXCEPTION(scope, handlerArguments.overflowCheckNotNeeded());</span>
<span class="line-modified">!             handlerArguments.append(arg);</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         if (UNLIKELY(handlerArguments.hasOverflowed()))</span>
<span class="line-removed">-             return;</span>
      }
  
<span class="line-modified">!     if (UNLIKELY(exec-&gt;lexicalGlobalObject()-&gt;hasDebugger()))</span>
<span class="line-modified">!         exec-&gt;lexicalGlobalObject()-&gt;debugger()-&gt;willRunMicrotask();</span>
  
<span class="line-modified">!     profiledCall(exec, ProfilingReason::Microtask, m_job.get(), handlerCallType, handlerCallData, jsUndefined(), handlerArguments);</span>
      scope.clearException();
  }
  
  } // namespace JSC
<span class="line-new-header">--- 38,63 ---</span>
  
  namespace JSC {
  
  class JSMicrotask final : public Microtask {
  public:
<span class="line-modified">!     static constexpr unsigned maxArguments = 3;</span>
<span class="line-added">+     JSMicrotask(VM&amp; vm, JSValue job, JSValue argument0, JSValue argument1, JSValue argument2)</span>
      {
          m_job.set(vm, job);
<span class="line-modified">!         m_arguments[0].set(vm, argument0);</span>
<span class="line-added">+         m_arguments[1].set(vm, argument1);</span>
<span class="line-added">+         m_arguments[2].set(vm, argument2);</span>
      }
  
      JSMicrotask(VM&amp; vm, JSValue job)
      {
          m_job.set(vm, job);
      }
  
  private:
<span class="line-modified">!     void run(JSGlobalObject*) override;</span>
  
      Strong&lt;Unknown&gt; m_job;
<span class="line-modified">!     Strong&lt;Unknown&gt; m_arguments[maxArguments];</span>
  };
  
  Ref&lt;Microtask&gt; createJSMicrotask(VM&amp; vm, JSValue job)
  {
      return adoptRef(*new JSMicrotask(vm, job));
  }
  
<span class="line-modified">! Ref&lt;Microtask&gt; createJSMicrotask(VM&amp; vm, JSValue job, JSValue argument0, JSValue argument1, JSValue argument2)</span>
  {
<span class="line-modified">!     return adoptRef(*new JSMicrotask(vm, job, argument0, argument1, argument2));</span>
  }
  
<span class="line-modified">! void JSMicrotask::run(JSGlobalObject* globalObject)</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
      CallData handlerCallData;
      CallType handlerCallType = getCallData(vm, m_job.get(), handlerCallData);
      ASSERT(handlerCallType != CallType::None);
  
      MarkedArgumentBuffer handlerArguments;
<span class="line-modified">!     for (unsigned index = 0; index &lt; maxArguments; ++index) {</span>
<span class="line-modified">!         JSValue arg = m_arguments[index].get();</span>
<span class="line-modified">!         if (!arg)</span>
<span class="line-modified">!             break;</span>
<span class="line-modified">!         handlerArguments.append(arg);</span>
      }
<span class="line-added">+     if (UNLIKELY(handlerArguments.hasOverflowed()))</span>
<span class="line-added">+         return;</span>
  
<span class="line-modified">!     if (UNLIKELY(globalObject-&gt;hasDebugger()))</span>
<span class="line-modified">!         globalObject-&gt;debugger()-&gt;willRunMicrotask();</span>
  
<span class="line-modified">!     profiledCall(globalObject, ProfilingReason::Microtask, m_job.get(), handlerCallType, handlerCallData, jsUndefined(), handlerArguments);</span>
      scope.clearException();
  }
  
  } // namespace JSC
</pre>
<center><a href="JSMapIterator.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSMicrotask.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>