<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff build.gradle</title>
    <link rel="stylesheet" href="style.css" />
  </head>
<body>
<center>&lt; prev <a href="index.html" target="_top">index</a> <a href="build.properties.sdiff.html" target="_top">next &gt;</a></center>    <h2>build.gradle</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1232     def gradleMajorMin = Integer.parseInt(verMin[0]);
1233     def gradleMinorMin = Integer.parseInt(verMin[1].split(&quot;[^0-9]&quot;)[0]);
1234     def err = &quot;&quot;;
1235     if (gradleMajor &lt; gradleMajorMin || (gradleMajor == gradleMajorMin &amp;&amp; gradleMinor &lt; gradleMinorMin)) {
1236         err = &quot;Gradle version too old: ${gradle.gradleVersion}; must be at least ${jfxGradleVersionMin}&quot;
1237     }
1238 
1239     if (IS_GRADLE_VERSION_CHECK &amp;&amp; err != &quot;&quot;) {
1240         fail(err);
1241     }
1242 
1243     logger.warn(&quot;*****************************************************************&quot;);
1244     logger.warn(&quot;Unsupported gradle version $gradle.gradleVersion in use.&quot;);
1245     logger.warn(&quot;Only version $jfxGradleVersion is supported. Use this version at your own risk&quot;);
1246     if ( err != &quot;&quot;) logger.warn(err);
1247     logger.warn(&quot;*****************************************************************&quot;);
1248 }
1249 
1250 // Look for stub runtime in bundled sdk, standalone sdk, or boot JDK
1251 





1252 def String cachedBundledRuntime = cygpath(&quot;$projectDir&quot;) + &quot;/../caches/modular-sdk&quot;
1253 def String cachedStandaloneRuntime = cygpath(&quot;$projectDir&quot;) + &quot;/../caches/sdk&quot;
1254 def String jdkStubRuntime = cygpath(&quot;$JDK_HOME&quot;)

1255 
1256 def defaultStubRuntime = &quot;&quot;
1257 if (file(cachedBundledRuntime).exists()) {
1258     defaultStubRuntime = cachedBundledRuntime
1259 } else if (file(cachedStandaloneRuntime).exists()) {
1260     defaultStubRuntime = cachedStandaloneRuntime
1261 } else if (BUILD_CLOSED) {
1262     defaultStubRuntime = cachedBundledRuntime


1263 } else {
1264     defaultStubRuntime = jdkStubRuntime
1265 }
1266 
1267 defineProperty(&quot;STUB_RUNTIME&quot;, defaultStubRuntime)
1268 
1269 if (STUB_RUNTIME.endsWith(&quot;/modular-sdk&quot;)) {
1270     def stubModulesLib = &quot;$STUB_RUNTIME/modules_libs&quot;
1271     defineProperty(&quot;MEDIA_STUB&quot;, &quot;$stubModulesLib/javafx.media&quot;)
1272     defineProperty(&quot;WEB_STUB&quot;, &quot;$stubModulesLib/javafx.web&quot;)
1273 } else {
1274     def libraryStub = IS_WINDOWS ? &quot;$STUB_RUNTIME/bin&quot; : &quot;$STUB_RUNTIME/lib&quot;
1275 
1276     defineProperty(&quot;MEDIA_STUB&quot;, libraryStub)
1277     defineProperty(&quot;WEB_STUB&quot;, libraryStub)
1278 }
1279 
1280 ext.UPDATE_STUB_CACHE = (BUILD_CLOSED &amp;&amp; STUB_RUNTIME != &quot;&quot; &amp;&amp; !file(STUB_RUNTIME).isDirectory())
1281 
1282 
</pre>
<hr />
<pre>
2549     })
2550 
2551     addMavenPublication(project, [ &#39;graphics&#39; ])
2552 
2553     addValidateSourceSets(project, sourceSets)
2554 }
2555 
2556 project(&quot;:swing&quot;) {
2557 
2558     tasks.all {
2559         if (!COMPILE_SWING) it.enabled = false
2560     }
2561 
2562     project.ext.buildModule = COMPILE_SWING
2563     project.ext.includeSources = true
2564     project.ext.moduleRuntime = true
2565     project.ext.moduleName = &quot;javafx.swing&quot;
2566 
2567     sourceSets {
2568         main
<span class="line-modified">2569         //shims // no test shims needed</span>
<span class="line-modified">2570         test</span>










2571     }
2572 
2573     project.ext.moduleSourcePath = defaultModuleSourcePath
2574     project.ext.moduleSourcePathShim = defaultModuleSourcePathShim
2575 
2576     commonModuleSetup(project, [ &#39;base&#39;, &#39;graphics&#39;, &#39;swing&#39; ])
2577 
2578     dependencies {
2579         compile project(&quot;:base&quot;)
2580         compile project(&quot;:graphics&quot;)
2581     }
2582 
2583     test {
2584         enabled = IS_FULL_TEST &amp;&amp; IS_AWT_TEST
2585     }
2586 
2587     if (COMPILE_SWING) {
2588         addMavenPublication(project, [ &#39;graphics&#39; ])
2589     }
2590 
</pre>
<hr />
<pre>
2845 
2846                         if (t.name == &quot;win&quot;) {
2847                             environment(WINDOWS_NATIVE_COMPILE_ENVIRONMENT)
2848                             args(&quot;RESOURCE=${nativeOutputDir}/${buildType}/${WIN.media.gstreamerRcFile}&quot;)
2849                         }
2850                     }
2851                 }
2852             }
2853 
2854             def buildPlugins = task(&quot;build${t.capital}Plugins&quot;, dependsOn: buildGStreamer) {
2855                 enabled = IS_COMPILE_MEDIA
2856 
2857                 doLast {
2858                     exec {
2859                         commandLine (&quot;make&quot;, &quot;${makeJobsFlag}&quot;, &quot;-C&quot;, &quot;${nativeSrcDir}/gstreamer/projects/${projectDir}/fxplugins&quot;)
2860                         args(&quot;OUTPUT_DIR=${nativeOutputDir}&quot;, &quot;BUILD_TYPE=${buildType}&quot;, &quot;BASE_NAME=fxplugins&quot;,
2861                              IS_64 ? &quot;ARCH=x64&quot; : &quot;ARCH=x32&quot;,
2862                              &quot;CC=${mediaProperties.compiler}&quot;, &quot;AR=${mediaProperties.ar}&quot;, &quot;LINKER=${mediaProperties.linker}&quot;)
2863 
2864                         if (t.name == &quot;win&quot;) {
<span class="line-modified">2865                             Map winEnv = new HashMap(WINDOWS_NATIVE_COMPILE_ENVIRONMENT)</span>
<span class="line-removed">2866 </span>
<span class="line-removed">2867                             String sdkDir = System.getenv(&quot;BASECLASSES_SDK_DIR&quot;);</span>
<span class="line-removed">2868                             if (sdkDir == null) {</span>
<span class="line-removed">2869                                 sdkDir = &quot;C:/Program Files/Microsoft SDKs/Windows/v7.1&quot; // Default value</span>
<span class="line-removed">2870                                 winEnv[&quot;BASECLASSES_SDK_DIR&quot;] = sdkDir</span>
<span class="line-removed">2871                             }</span>
<span class="line-removed">2872                             environment(winEnv)</span>
<span class="line-removed">2873 </span>
2874                             args(&quot;RESOURCE=${nativeOutputDir}/${buildType}/${WIN.media.fxpluginsRcFile}&quot;)
2875                         }
2876                     }
2877                 }
2878             }
2879 
2880             buildNative.dependsOn buildPlugins
2881 
2882             if (t.name == &quot;linux&quot;) {
2883                 // Pre-defined command line arguments
2884                 def cfgCMDArgs = [&quot;sh&quot;, &quot;configure&quot;]
2885                 def commonCfgArgs = [&quot;--enable-shared&quot;, &quot;--disable-debug&quot;, &quot;--disable-static&quot;, &quot;--disable-yasm&quot;, &quot;--disable-doc&quot;, &quot;--disable-programs&quot;, &quot;--disable-everything&quot;]
2886                 def codecsCfgArgs = [&quot;--enable-decoder=aac,mp3,mp3float,h264&quot;, &quot;--enable-parser=aac,h264&quot;, &quot;--enable-demuxer=aac,h264,mpegts,mpegtsraw&quot;]
2887 
2888                 def copyLibAVStubs = {String fromDir, String toDir -&gt;
2889                     FileCollection config = files(&quot;config.h&quot;)
2890                     FileCollection libavcodec = files(&quot;avcodec.h&quot;, &quot;avfft.h&quot;, &quot;dxva2.h&quot;, &quot;vaapi.h&quot;, &quot;vda.h&quot;,
2891                                                       &quot;vdpau.h&quot;, &quot;version.h&quot;, &quot;xvmc.h&quot;, &quot;old_codec_ids.h&quot;)
2892                     FileCollection libavdevice = files(&quot;avdevice.h&quot;, &quot;version.h&quot;)
2893                     FileCollection libavfilter = files(&quot;avfiltergraph.h&quot;, &quot;avfilter.h&quot;, &quot;buffersink.h&quot;, &quot;buffersrc.h&quot;, &quot;version.h&quot;);
</pre>
<hr />
<pre>
3364     if (IS_COMPILE_WEBKIT) {
3365         compileJava {
3366             // generate the native headers during compile
3367             // only needed if we are doing the native compile
3368             options.compilerArgs.addAll([
3369                 &#39;-h&#39;, &quot;${project.buildDir}/gensrc/headers&quot;
3370                 ])
3371         }
3372     }
3373 
3374     // Copy these to a common location in the moduleSourcePath
3375     def copyWrappers = project.task(&quot;copyPreGeneratedWrappers&quot;, type: Copy) {
3376         from &quot;src/main/native/Source/WebCore/bindings/java/dom3/java&quot;
3377         into &quot;${gensrcDir}&quot;
3378     }
3379 
3380     compileJava.dependsOn(copyWrappers);
3381 
3382     test {
3383         doFirst {
<span class="line-modified">3384             if (!IS_COMPILE_WEBKIT) {</span>
<span class="line-modified">3385                 println &quot;*****************************************************&quot;</span>








3386                 println &quot;WARNING: running web tests without building webkit.&quot;
3387                 println &quot;The webkit native library will be copied from the JDK,&quot;
3388                 println &quot;which might lead to failures in some web tests.&quot;
<span class="line-modified">3389                 println &quot;To avoid these failures, you should either build&quot;</span>
<span class="line-modified">3390                 println &quot;webkit locally, copy the native webkit library from a&quot;</span>
<span class="line-removed">3391                 println &quot;recent build, or skip execution of web test cases with&quot;</span>
<span class="line-removed">3392                 println &quot;&#39;-x :web:test&#39;&quot;</span>
<span class="line-removed">3393                 println &quot;*****************************************************&quot;</span>
3394             }
3395         }
3396         // Run web tests in headless mode
3397         systemProperty &#39;glass.platform&#39;, &#39;Monocle&#39;
3398         systemProperty &#39;monocle.platform&#39;, &#39;Headless&#39;
3399         systemProperty &#39;prism.order&#39;, &#39;sw&#39;
3400         dependsOn webArchiveJar
3401         def testResourceDir = file(&quot;$buildDir/testing/resources&quot;)
3402         jvmArgs &quot;-DWEB_ARCHIVE_JAR_TEST_DIR=$testResourceDir&quot;
3403     }
3404 
3405     task compileJavaDOMBinding()
3406 
3407     compileTargets { t -&gt;
3408         def targetProperties = project.rootProject.ext[t.upper]
3409         def webkitProperties = targetProperties.webkit
3410         def classifier = (t.name != &quot;linux&quot; &amp;&amp; t.name != &quot;win&quot;) ? t.name :
3411                           IS_64 ? &quot;${t.name}-amd64&quot; : &quot;${t.name}-i586&quot;
3412 
3413         def webkitOutputDir = cygpath(&quot;$buildDir/${t.name}&quot;)
3414         def webkitConfig = IS_DEBUG_NATIVE ? &quot;Debug&quot; : &quot;Release&quot;
3415 
3416         File nativeBuildDir = new File(&quot;${webkitOutputDir}&quot;)
3417         nativeBuildDir.mkdirs()
3418 
3419         def compileNativeTask = task(&quot;compileNative${t.capital}&quot;, dependsOn: [compileJava]) {
3420             println &quot;Building Webkit configuration /$webkitConfig/ into $webkitOutputDir&quot;
3421             enabled =  (IS_COMPILE_WEBKIT)
3422 
3423             doLast {
3424                 exec {
3425                     workingDir(&quot;$webkitOutputDir&quot;)
3426                     commandLine(&quot;perl&quot;, &quot;$projectDir/src/main/native/Tools/Scripts/set-webkit-configuration&quot;, &quot;--$webkitConfig&quot;)
3427                     environment([&quot;WEBKIT_OUTPUTDIR&quot; : webkitOutputDir])
3428                 }
3429 
3430                 exec {
3431                     workingDir(&quot;$webkitOutputDir&quot;)
3432                     def cmakeArgs = &quot;-DENABLE_TOOLS=1&quot;



3433                     cmakeArgs = &quot; $cmakeArgs -DCMAKE_C_COMPILER=&#39;${webkitProperties.compiler}&#39;&quot;
3434                     if (t.name == &quot;win&quot;) {
3435                         // To enable ninja build on Windows
3436                         environment(WINDOWS_NATIVE_COMPILE_ENVIRONMENT)
3437                     } else if (t.name == &quot;mac&quot;) {
3438                         cmakeArgs = &quot; $cmakeArgs -DCMAKE_OSX_DEPLOYMENT_TARGET=$MACOSX_MIN_VERSION -DCMAKE_OSX_SYSROOT=$MACOSX_SDK_PATH&quot;
3439                     } else if (t.name == &quot;linux&quot;) {
3440                         cmakeArgs = &quot; $cmakeArgs -DCMAKE_SYSTEM_NAME=Linux&quot;
3441                         if (IS_64) {
3442                             cmakeArgs = &quot;$cmakeArgs -DCMAKE_SYSTEM_PROCESSOR=x86_64&quot;
3443                         } else {
3444                             cmakeArgs = &quot;$cmakeArgs -DCMAKE_SYSTEM_PROCESSOR=i586&quot;
3445                         }
3446                         // TODO: Use cflags and ldflags from all platforms
3447                         def cFlags = webkitProperties.ccFlags?.join(&#39; &#39;) ?: &#39;&#39;
3448                         def lFlags = webkitProperties.linkFlags?.join(&#39; &#39;) ?: &#39;&#39;



3449                         // -shared flag should be omitted while creating executable.
3450                         def exeFlags = webkitProperties.linkFlags?.join(&#39; &#39;)?.replace(&#39;-shared&#39;, &#39;&#39;) ?: &#39;&#39;
3451                         cmakeArgs = &quot;$cmakeArgs -DCMAKE_C_FLAGS=&#39;${cFlags}&#39; -DCMAKE_CXX_FLAGS=&#39;${cFlags}&#39;&quot;
3452                         cmakeArgs = &quot;$cmakeArgs -DCMAKE_SHARED_LINKER_FLAGS=&#39;${lFlags}&#39; -DCMAKE_EXE_LINKER_FLAGS=&#39;${exeFlags}&#39;&quot;
3453                     } else if (t.name.startsWith(&quot;arm&quot;)) {
3454                         fail(&quot;ARM target is not supported as of now.&quot;)
3455                     }
3456 
3457                     if (IS_COMPILE_PARFAIT) {
3458                         environment([
3459                             &quot;COMPILE_PARFAIT&quot; : &quot;true&quot;
3460                         ])
3461                         environment &quot;PATH&quot;, System.env.PARFAIT_PATH + File.pathSeparator + environment.PATH
3462                         cmakeArgs = &quot;-DCMAKE_C_COMPILER=parfait-gcc -DCMAKE_CXX_COMPILER=parfait-g++&quot;
3463                     }
3464 
3465                     if (project.hasProperty(&#39;toolsPath&#39;)) {
3466                         environment &quot;PATH&quot;, toolsPath + File.pathSeparator + environment.PATH
3467                     }
3468 
</pre>
<hr />
<pre>
3555 // This project is for system tests that need to run with a full SDK.
3556 // Most of them display a stage or do other things that preclude running
3557 // them in a shared JVM or as part of the &quot;smoke test&quot; run (which must
3558 // not pop up any windows or use audio). As such, they are only enabled
3559 // when FULL_TEST is specified, and each test runs in its own JVM
3560 project(&quot;:systemTests&quot;) {
3561 
3562     sourceSets {
3563         test
3564 
3565         // Source sets for standalone test apps (used for launcher tests)
3566         testapp1
3567 
3568         // Modular applications
3569         testapp2
3570         testapp3
3571         testapp4
3572         testapp5
3573         testapp6
3574         testscriptapp1

3575     }
3576 
3577     def nonModSrcSets = [
3578         sourceSets.test,
3579         sourceSets.testapp1
3580     ]
3581 
3582     def modSrcSets = [
3583         sourceSets.testapp2,
3584         sourceSets.testapp3,
3585         sourceSets.testapp4,
3586         sourceSets.testapp5,
3587         sourceSets.testapp6,
<span class="line-modified">3588         sourceSets.testscriptapp1</span>

3589     ]
3590 
3591     project.ext.buildModule = false
3592     project.ext.moduleRuntime = false
3593     project.ext.moduleName = &quot;systemTests&quot;
3594 
3595     dependencies {
3596         testCompile project(&quot;:graphics&quot;).sourceSets.test.output
3597         testCompile project(&quot;:base&quot;).sourceSets.test.output
3598         testCompile project(&quot;:controls&quot;).sourceSets.test.output
3599         testCompile project(&quot;:swing&quot;).sourceSets.test.output
3600     }
3601 
3602     def dependentProjects = [ &#39;base&#39;, &#39;graphics&#39;, &#39;controls&#39;, &#39;media&#39;, &#39;web&#39;, &#39;swing&#39;, &#39;fxml&#39; ]
3603     commonModuleSetup(project, dependentProjects)
3604 
3605     File testJavaPolicyFile = new File(rootProject.buildDir, TESTJAVAPOLICYFILE);
3606     File testRunArgsFile = new File(rootProject.buildDir,TESTRUNARGSFILE);
3607 
3608     File stRunArgsFile = new File(project.buildDir,&quot;st.run.args&quot;);
</pre>
<hr />
<pre>
3668         }
3669     }
3670 
3671     task createTestapp1Jar2(type: Jar) {
3672         dependsOn compileTestapp1Java
3673         enabled = IS_FULL_TEST
3674 
3675         destinationDir = file(&quot;$buildDir/testapp1&quot;)
3676         archiveName = &quot;jar2.jar&quot;;
3677         includeEmptyDirs = false
3678         from project.sourceSets.testapp1.java.outputDir
3679         include(&quot;pkg2/**&quot;)
3680     }
3681 
3682     task createTestApps() {
3683         dependsOn(createTestapp1Jar1)
3684         dependsOn(createTestapp1Jar2)
3685     }
3686     test.dependsOn(createTestApps);
3687 
<span class="line-modified">3688     def modtestapps = [ &quot;testapp2&quot;, &quot;testapp3&quot;, &quot;testapp4&quot;, &quot;testapp5&quot;, &quot;testapp6&quot;, &quot;testscriptapp1&quot; ]</span>
3689     modtestapps.each { testapp -&gt;
3690         def testappCapital = testapp.capitalize()
3691         def copyTestAppTask = task(&quot;copy${testappCapital}&quot;, type: Copy) {
3692             from project.sourceSets.&quot;${testapp}&quot;.java.outputDir
3693             from project.sourceSets.&quot;${testapp}&quot;.output.resourcesDir
3694             into &quot;${project.buildDir}/modules/${testapp}&quot;
3695         }
3696 
3697         def List&lt;String&gt; testAppSourceDirs = []
3698         project.sourceSets.&quot;${testapp}&quot;.java.srcDirs.each { dir -&gt;
3699             testAppSourceDirs += dir
3700         }
3701         def testappCompileTasks = project.getTasksByName(&quot;compile${testappCapital}Java&quot;, true);
3702         def testappResourceTasks = project.getTasksByName(&quot;process${testappCapital}Resources&quot;, true);
3703         testappCompileTasks.each { appCompileTask -&gt;
3704             appCompileTask.options.compilerArgs.addAll([
3705                 &#39;-implicit:none&#39;,
3706                 &#39;--module-source-path&#39;, testAppSourceDirs.join(File.pathSeparator),
3707                 ] )
3708             if (project.hasProperty(&#39;testModulePathArgs&#39;)) {
</pre>
<hr />
<pre>
4304             destinationDir = file(&quot;${bundlesDir}&quot;)
4305             archiveName = &quot;${docsBundleName}.zip&quot;
4306             includeEmptyDirs = false
4307             from docsArtifactsDir
4308             into &quot;${docsBundleName}&quot;
4309         }
4310         zipsTask.dependsOn(zipDocsTask)
4311 
4312         def zipJmodsTask = task(&quot;zipJmods$t.capital&quot;, type: Zip, dependsOn: zipDocsTask) {
4313             destinationDir = file(&quot;${bundlesDir}&quot;)
4314             archiveName = &quot;${jmodsBundleName}.zip&quot;
4315             includeEmptyDirs = false
4316             from jmodsArtifactsDir
4317             into &quot;${jmodsBundleName}&quot;
4318         }
4319         zipsTask.dependsOn(zipJmodsTask)
4320     }
4321 }
4322 
4323 






























4324 /******************************************************************************
4325  *                                                                            *
4326  *                               Modules                                      *
4327  *                                                                            *
4328  *****************************************************************************/
4329 
4330 ext.moduleDependencies = [file(&quot;dependencies&quot;)]
4331 
4332 task buildModules {
4333 }
4334 
4335 // Combine the classes, lib, and bin for each module
4336 compileTargets { t -&gt;
4337     def targetProperties = project.ext[t.upper]
4338 
4339     def platformPrefix = targetProperties.platformPrefix
4340     def bundledSdkDirName = &quot;${platformPrefix}modular-sdk&quot;
4341     def bundledSdkDir = &quot;${rootProject.buildDir}/${bundledSdkDirName}&quot;
4342     def modulesDir = &quot;${bundledSdkDir}/modules&quot;
4343     def modulesCmdsDir = &quot;${bundledSdkDir}/modules_cmds&quot;
</pre>
<hr />
<pre>
4898                 libs += [&#39;fontFreetype&#39;, &#39;fontPango&#39;];
4899             }
4900             libs.each { lib -&gt;
4901                 def variants = targetProperties[lib].containsKey(&#39;variants&#39;) &amp;&amp; !useLipo ? targetProperties[lib].variants : [null]
4902                 variants.each { variant -&gt;
4903                     def variantProperties = variant ? targetProperties[lib][variant] : targetProperties[lib]
4904                     from (&quot;${graphicsProject.buildDir}/libs/$lib/$t.name/${library(variantProperties.lib)}&quot;)
4905                 }
4906             }
4907             if (IS_WINDOWS) {
4908                 from (&quot;${graphicsProject.buildDir}/libs/prismD3D/${t.name}/${library(targetProperties.prismD3D.lib)}&quot;);
4909                 targetProperties.VS2017DLLs.each { vslib -&gt;
4910                     from (&quot;$vslib&quot;);
4911                 }
4912                 targetProperties.WinSDKDLLs.each { winsdklib -&gt;
4913                     from (&quot;$winsdklib&quot;);
4914                 }
4915             }
4916         }
4917 
<span class="line-modified">4918         def buildModuleMediaTask = task(&quot;buildModuleMedia$t.capital&quot;, type: Copy, dependsOn: mediaProject.assemble) {</span>
4919             group = &quot;Basic&quot;
4920             description = &quot;copies javafx.media native libraries&quot;
4921 
4922             into &quot;${mediaProject.buildDir}/${moduleNativeDirName}&quot;
4923 
4924             def mediaBuildType = project(&quot;:media&quot;).ext.buildType
4925             if (IS_COMPILE_MEDIA) {
4926                 [ &quot;fxplugins&quot;, &quot;gstreamer-lite&quot;, &quot;jfxmedia&quot; ].each { name -&gt;
4927                     from (&quot;${mediaProject.buildDir}/native/${t.name}/${mediaBuildType}/${library(name)}&quot;) }
4928 
4929                 if (t.name == &quot;mac&quot;) {
4930                     // OSX media natives
4931                     [ &quot;jfxmedia_qtkit&quot;, &quot;jfxmedia_avf&quot;, &quot;glib-lite&quot; ].each { name -&gt;
4932                         from (&quot;${mediaProject.buildDir}/native/${t.name}/${mediaBuildType}/${library(name)}&quot;) }
4933                 } else if (t.name == &quot;linux&quot;) {
4934                     from(&quot;${mediaProject.buildDir}/native/${t.name}/${mediaBuildType}&quot;) { include &quot;libavplugin*.so&quot; }
4935                 } else from (&quot;${mediaProject.buildDir}/native/${t.name}/${mediaBuildType}/${library(&quot;glib-lite&quot;)}&quot;)
4936             } else {
4937                 if (t.name != &quot;android&quot;  &amp;&amp; t.name != &quot;dalvik&quot; ) {
4938                     [ &quot;fxplugins&quot;, &quot;gstreamer-lite&quot;, &quot;jfxmedia&quot; ].each { name -&gt;
4939                         from (&quot;$MEDIA_STUB/${library(name)}&quot;) }
4940                 }
4941 
4942                 if (t.name == &quot;mac&quot;) {
4943                     // copy libjfxmedia_{avf,qtkit}.dylib if they exist
4944                     [ &quot;jfxmedia_qtkit&quot;, &quot;jfxmedia_avf&quot;, &quot;glib-lite&quot; ].each { name -&gt;
4945                         from (&quot;$MEDIA_STUB/${library(name)}&quot;) }
4946                 } else if (t.name == &quot;linux&quot;) {
4947                     from(MEDIA_STUB) { include &quot;libavplugin*.so&quot; }
4948                 }
4949                 else if (t.name != &quot;android&quot;  &amp;&amp; t.name != &quot;dalvik&quot; ) {
4950                     from (&quot;$MEDIA_STUB/${library(&quot;glib-lite&quot;)}&quot;)
4951                 }
4952             }
4953         }
4954 
<span class="line-modified">4955         def buildModuleWeb = task(&quot;buildModuleWeb$t.capital&quot;, type: Copy, dependsOn: webProject.assemble) {</span>
4956             group = &quot;Basic&quot;
4957             description = &quot;copies javafx.web native libraries&quot;
4958 
4959             into &quot;${webProject.buildDir}/${moduleNativeDirName}&quot;
4960 
4961             if (IS_COMPILE_WEBKIT) {
4962                 from (&quot;${webProject.buildDir}/libs/${t.name}/${library(&#39;jfxwebkit&#39;)}&quot;)
4963             } else {
4964                 if (t.name != &quot;android&quot; &amp;&amp; t.name != &quot;ios&quot; &amp;&amp; t.name != &quot;dalvik&quot;) {
4965                     from (&quot;$WEB_STUB/${library(&#39;jfxwebkit&#39;)}&quot;)
4966                 }
4967             }
4968         }
4969 
4970         def buildModuleSWT = task(&quot;buildModuleSWT$t.capital&quot;, type: Copy) {
4971             group = &quot;Basic&quot;
4972             description = &quot;copies SWT JAR&quot;
4973 
4974             // FIXME: the following is a hack to workaround the fact that there
4975             // is no way to deliver javafx-swt.jar other than in one of the
</pre>
</td>
<td>
<hr />
<pre>
1232     def gradleMajorMin = Integer.parseInt(verMin[0]);
1233     def gradleMinorMin = Integer.parseInt(verMin[1].split(&quot;[^0-9]&quot;)[0]);
1234     def err = &quot;&quot;;
1235     if (gradleMajor &lt; gradleMajorMin || (gradleMajor == gradleMajorMin &amp;&amp; gradleMinor &lt; gradleMinorMin)) {
1236         err = &quot;Gradle version too old: ${gradle.gradleVersion}; must be at least ${jfxGradleVersionMin}&quot;
1237     }
1238 
1239     if (IS_GRADLE_VERSION_CHECK &amp;&amp; err != &quot;&quot;) {
1240         fail(err);
1241     }
1242 
1243     logger.warn(&quot;*****************************************************************&quot;);
1244     logger.warn(&quot;Unsupported gradle version $gradle.gradleVersion in use.&quot;);
1245     logger.warn(&quot;Only version $jfxGradleVersion is supported. Use this version at your own risk&quot;);
1246     if ( err != &quot;&quot;) logger.warn(err);
1247     logger.warn(&quot;*****************************************************************&quot;);
1248 }
1249 
1250 // Look for stub runtime in bundled sdk, standalone sdk, or boot JDK
1251 
<span class="line-added">1252 // Allows automatic provisioning of webkit+media shared libraries</span>
<span class="line-added">1253 // from official OpenJFX releases, downloaded from MavenCentral</span>
<span class="line-added">1254 defineProperty(&quot;STUB_RUNTIME_OPENJFX&quot;, &quot;&quot;)</span>
<span class="line-added">1255 ext.IS_STUB_RUNTIME_OPENJFX = !STUB_RUNTIME_OPENJFX.isBlank()</span>
<span class="line-added">1256 </span>
1257 def String cachedBundledRuntime = cygpath(&quot;$projectDir&quot;) + &quot;/../caches/modular-sdk&quot;
1258 def String cachedStandaloneRuntime = cygpath(&quot;$projectDir&quot;) + &quot;/../caches/sdk&quot;
1259 def String jdkStubRuntime = cygpath(&quot;$JDK_HOME&quot;)
<span class="line-added">1260 def String openjfxStubRuntime = cygpath(&quot;$projectDir&quot;) + &quot;/buildSrc/build/openjfxStub&quot;</span>
1261 
1262 def defaultStubRuntime = &quot;&quot;
1263 if (file(cachedBundledRuntime).exists()) {
1264     defaultStubRuntime = cachedBundledRuntime
1265 } else if (file(cachedStandaloneRuntime).exists()) {
1266     defaultStubRuntime = cachedStandaloneRuntime
1267 } else if (BUILD_CLOSED) {
1268     defaultStubRuntime = cachedBundledRuntime
<span class="line-added">1269 } else if (IS_STUB_RUNTIME_OPENJFX) {</span>
<span class="line-added">1270     defaultStubRuntime = openjfxStubRuntime</span>
1271 } else {
1272     defaultStubRuntime = jdkStubRuntime
1273 }
1274 
1275 defineProperty(&quot;STUB_RUNTIME&quot;, defaultStubRuntime)
1276 
1277 if (STUB_RUNTIME.endsWith(&quot;/modular-sdk&quot;)) {
1278     def stubModulesLib = &quot;$STUB_RUNTIME/modules_libs&quot;
1279     defineProperty(&quot;MEDIA_STUB&quot;, &quot;$stubModulesLib/javafx.media&quot;)
1280     defineProperty(&quot;WEB_STUB&quot;, &quot;$stubModulesLib/javafx.web&quot;)
1281 } else {
1282     def libraryStub = IS_WINDOWS ? &quot;$STUB_RUNTIME/bin&quot; : &quot;$STUB_RUNTIME/lib&quot;
1283 
1284     defineProperty(&quot;MEDIA_STUB&quot;, libraryStub)
1285     defineProperty(&quot;WEB_STUB&quot;, libraryStub)
1286 }
1287 
1288 ext.UPDATE_STUB_CACHE = (BUILD_CLOSED &amp;&amp; STUB_RUNTIME != &quot;&quot; &amp;&amp; !file(STUB_RUNTIME).isDirectory())
1289 
1290 
</pre>
<hr />
<pre>
2557     })
2558 
2559     addMavenPublication(project, [ &#39;graphics&#39; ])
2560 
2561     addValidateSourceSets(project, sourceSets)
2562 }
2563 
2564 project(&quot;:swing&quot;) {
2565 
2566     tasks.all {
2567         if (!COMPILE_SWING) it.enabled = false
2568     }
2569 
2570     project.ext.buildModule = COMPILE_SWING
2571     project.ext.includeSources = true
2572     project.ext.moduleRuntime = true
2573     project.ext.moduleName = &quot;javafx.swing&quot;
2574 
2575     sourceSets {
2576         main
<span class="line-modified">2577         shims {</span>
<span class="line-modified">2578             java {</span>
<span class="line-added">2579                 compileClasspath += sourceSets.main.output</span>
<span class="line-added">2580                 runtimeClasspath += sourceSets.main.output</span>
<span class="line-added">2581             }</span>
<span class="line-added">2582         }</span>
<span class="line-added">2583         test {</span>
<span class="line-added">2584             java {</span>
<span class="line-added">2585                 compileClasspath += sourceSets.shims.output</span>
<span class="line-added">2586                 runtimeClasspath += sourceSets.shims.output</span>
<span class="line-added">2587             }</span>
<span class="line-added">2588         }</span>
2589     }
2590 
2591     project.ext.moduleSourcePath = defaultModuleSourcePath
2592     project.ext.moduleSourcePathShim = defaultModuleSourcePathShim
2593 
2594     commonModuleSetup(project, [ &#39;base&#39;, &#39;graphics&#39;, &#39;swing&#39; ])
2595 
2596     dependencies {
2597         compile project(&quot;:base&quot;)
2598         compile project(&quot;:graphics&quot;)
2599     }
2600 
2601     test {
2602         enabled = IS_FULL_TEST &amp;&amp; IS_AWT_TEST
2603     }
2604 
2605     if (COMPILE_SWING) {
2606         addMavenPublication(project, [ &#39;graphics&#39; ])
2607     }
2608 
</pre>
<hr />
<pre>
2863 
2864                         if (t.name == &quot;win&quot;) {
2865                             environment(WINDOWS_NATIVE_COMPILE_ENVIRONMENT)
2866                             args(&quot;RESOURCE=${nativeOutputDir}/${buildType}/${WIN.media.gstreamerRcFile}&quot;)
2867                         }
2868                     }
2869                 }
2870             }
2871 
2872             def buildPlugins = task(&quot;build${t.capital}Plugins&quot;, dependsOn: buildGStreamer) {
2873                 enabled = IS_COMPILE_MEDIA
2874 
2875                 doLast {
2876                     exec {
2877                         commandLine (&quot;make&quot;, &quot;${makeJobsFlag}&quot;, &quot;-C&quot;, &quot;${nativeSrcDir}/gstreamer/projects/${projectDir}/fxplugins&quot;)
2878                         args(&quot;OUTPUT_DIR=${nativeOutputDir}&quot;, &quot;BUILD_TYPE=${buildType}&quot;, &quot;BASE_NAME=fxplugins&quot;,
2879                              IS_64 ? &quot;ARCH=x64&quot; : &quot;ARCH=x32&quot;,
2880                              &quot;CC=${mediaProperties.compiler}&quot;, &quot;AR=${mediaProperties.ar}&quot;, &quot;LINKER=${mediaProperties.linker}&quot;)
2881 
2882                         if (t.name == &quot;win&quot;) {
<span class="line-modified">2883                             environment(WINDOWS_NATIVE_COMPILE_ENVIRONMENT)</span>








2884                             args(&quot;RESOURCE=${nativeOutputDir}/${buildType}/${WIN.media.fxpluginsRcFile}&quot;)
2885                         }
2886                     }
2887                 }
2888             }
2889 
2890             buildNative.dependsOn buildPlugins
2891 
2892             if (t.name == &quot;linux&quot;) {
2893                 // Pre-defined command line arguments
2894                 def cfgCMDArgs = [&quot;sh&quot;, &quot;configure&quot;]
2895                 def commonCfgArgs = [&quot;--enable-shared&quot;, &quot;--disable-debug&quot;, &quot;--disable-static&quot;, &quot;--disable-yasm&quot;, &quot;--disable-doc&quot;, &quot;--disable-programs&quot;, &quot;--disable-everything&quot;]
2896                 def codecsCfgArgs = [&quot;--enable-decoder=aac,mp3,mp3float,h264&quot;, &quot;--enable-parser=aac,h264&quot;, &quot;--enable-demuxer=aac,h264,mpegts,mpegtsraw&quot;]
2897 
2898                 def copyLibAVStubs = {String fromDir, String toDir -&gt;
2899                     FileCollection config = files(&quot;config.h&quot;)
2900                     FileCollection libavcodec = files(&quot;avcodec.h&quot;, &quot;avfft.h&quot;, &quot;dxva2.h&quot;, &quot;vaapi.h&quot;, &quot;vda.h&quot;,
2901                                                       &quot;vdpau.h&quot;, &quot;version.h&quot;, &quot;xvmc.h&quot;, &quot;old_codec_ids.h&quot;)
2902                     FileCollection libavdevice = files(&quot;avdevice.h&quot;, &quot;version.h&quot;)
2903                     FileCollection libavfilter = files(&quot;avfiltergraph.h&quot;, &quot;avfilter.h&quot;, &quot;buffersink.h&quot;, &quot;buffersrc.h&quot;, &quot;version.h&quot;);
</pre>
<hr />
<pre>
3374     if (IS_COMPILE_WEBKIT) {
3375         compileJava {
3376             // generate the native headers during compile
3377             // only needed if we are doing the native compile
3378             options.compilerArgs.addAll([
3379                 &#39;-h&#39;, &quot;${project.buildDir}/gensrc/headers&quot;
3380                 ])
3381         }
3382     }
3383 
3384     // Copy these to a common location in the moduleSourcePath
3385     def copyWrappers = project.task(&quot;copyPreGeneratedWrappers&quot;, type: Copy) {
3386         from &quot;src/main/native/Source/WebCore/bindings/java/dom3/java&quot;
3387         into &quot;${gensrcDir}&quot;
3388     }
3389 
3390     compileJava.dependsOn(copyWrappers);
3391 
3392     test {
3393         doFirst {
<span class="line-modified">3394             if (IS_STUB_RUNTIME_OPENJFX) {</span>
<span class="line-modified">3395                 println &quot;********************************************************&quot;</span>
<span class="line-added">3396                 println &quot;WARNING: running web tests with officially built webkit.&quot;</span>
<span class="line-added">3397                 println &quot;The webkit native library may not be compatible with the&quot;</span>
<span class="line-added">3398                 println &quot;source tree you are using.&quot;</span>
<span class="line-added">3399                 println &quot;If tests fail, try compiling webkit instead.&quot;</span>
<span class="line-added">3400                 println &quot;See WEBKIT-MEDIA-STUBS.md&quot;</span>
<span class="line-added">3401                 println &quot;********************************************************&quot;</span>
<span class="line-added">3402             } else if (!IS_COMPILE_WEBKIT) {</span>
<span class="line-added">3403                 println &quot;******************************************************&quot;</span>
3404                 println &quot;WARNING: running web tests without building webkit.&quot;
3405                 println &quot;The webkit native library will be copied from the JDK,&quot;
3406                 println &quot;which might lead to failures in some web tests.&quot;
<span class="line-modified">3407                 println &quot;See WEBKIT-MEDIA-STUBS.md&quot;</span>
<span class="line-modified">3408                 println &quot;******************************************************&quot;</span>



3409             }
3410         }
3411         // Run web tests in headless mode
3412         systemProperty &#39;glass.platform&#39;, &#39;Monocle&#39;
3413         systemProperty &#39;monocle.platform&#39;, &#39;Headless&#39;
3414         systemProperty &#39;prism.order&#39;, &#39;sw&#39;
3415         dependsOn webArchiveJar
3416         def testResourceDir = file(&quot;$buildDir/testing/resources&quot;)
3417         jvmArgs &quot;-DWEB_ARCHIVE_JAR_TEST_DIR=$testResourceDir&quot;
3418     }
3419 
3420     task compileJavaDOMBinding()
3421 
3422     compileTargets { t -&gt;
3423         def targetProperties = project.rootProject.ext[t.upper]
3424         def webkitProperties = targetProperties.webkit
3425         def classifier = (t.name != &quot;linux&quot; &amp;&amp; t.name != &quot;win&quot;) ? t.name :
3426                           IS_64 ? &quot;${t.name}-amd64&quot; : &quot;${t.name}-i586&quot;
3427 
3428         def webkitOutputDir = cygpath(&quot;$buildDir/${t.name}&quot;)
3429         def webkitConfig = IS_DEBUG_NATIVE ? &quot;Debug&quot; : &quot;Release&quot;
3430 
3431         File nativeBuildDir = new File(&quot;${webkitOutputDir}&quot;)
3432         nativeBuildDir.mkdirs()
3433 
3434         def compileNativeTask = task(&quot;compileNative${t.capital}&quot;, dependsOn: [compileJava]) {
3435             println &quot;Building Webkit configuration /$webkitConfig/ into $webkitOutputDir&quot;
3436             enabled =  (IS_COMPILE_WEBKIT)
3437 
3438             doLast {
3439                 exec {
3440                     workingDir(&quot;$webkitOutputDir&quot;)
3441                     commandLine(&quot;perl&quot;, &quot;$projectDir/src/main/native/Tools/Scripts/set-webkit-configuration&quot;, &quot;--$webkitConfig&quot;)
3442                     environment([&quot;WEBKIT_OUTPUTDIR&quot; : webkitOutputDir])
3443                 }
3444 
3445                 exec {
3446                     workingDir(&quot;$webkitOutputDir&quot;)
3447                     def cmakeArgs = &quot;-DENABLE_TOOLS=1&quot;
<span class="line-added">3448                     if (IS_STATIC_BUILD) {</span>
<span class="line-added">3449                         cmakeArgs = &quot; $cmakeArgs -DSTATIC_BUILD=1 -DUSE_THIN_ARCHIVES=OFF&quot;;</span>
<span class="line-added">3450                     }</span>
3451                     cmakeArgs = &quot; $cmakeArgs -DCMAKE_C_COMPILER=&#39;${webkitProperties.compiler}&#39;&quot;
3452                     if (t.name == &quot;win&quot;) {
3453                         // To enable ninja build on Windows
3454                         environment(WINDOWS_NATIVE_COMPILE_ENVIRONMENT)
3455                     } else if (t.name == &quot;mac&quot;) {
3456                         cmakeArgs = &quot; $cmakeArgs -DCMAKE_OSX_DEPLOYMENT_TARGET=$MACOSX_MIN_VERSION -DCMAKE_OSX_SYSROOT=$MACOSX_SDK_PATH&quot;
3457                     } else if (t.name == &quot;linux&quot;) {
3458                         cmakeArgs = &quot; $cmakeArgs -DCMAKE_SYSTEM_NAME=Linux&quot;
3459                         if (IS_64) {
3460                             cmakeArgs = &quot;$cmakeArgs -DCMAKE_SYSTEM_PROCESSOR=x86_64&quot;
3461                         } else {
3462                             cmakeArgs = &quot;$cmakeArgs -DCMAKE_SYSTEM_PROCESSOR=i586&quot;
3463                         }
3464                         // TODO: Use cflags and ldflags from all platforms
3465                         def cFlags = webkitProperties.ccFlags?.join(&#39; &#39;) ?: &#39;&#39;
3466                         def lFlags = webkitProperties.linkFlags?.join(&#39; &#39;) ?: &#39;&#39;
<span class="line-added">3467                         if (IS_STATIC_BUILD) {</span>
<span class="line-added">3468                             cFlags = &quot; $cFlags -DSTATIC_BUILD=1&quot;;</span>
<span class="line-added">3469                         }</span>
3470                         // -shared flag should be omitted while creating executable.
3471                         def exeFlags = webkitProperties.linkFlags?.join(&#39; &#39;)?.replace(&#39;-shared&#39;, &#39;&#39;) ?: &#39;&#39;
3472                         cmakeArgs = &quot;$cmakeArgs -DCMAKE_C_FLAGS=&#39;${cFlags}&#39; -DCMAKE_CXX_FLAGS=&#39;${cFlags}&#39;&quot;
3473                         cmakeArgs = &quot;$cmakeArgs -DCMAKE_SHARED_LINKER_FLAGS=&#39;${lFlags}&#39; -DCMAKE_EXE_LINKER_FLAGS=&#39;${exeFlags}&#39;&quot;
3474                     } else if (t.name.startsWith(&quot;arm&quot;)) {
3475                         fail(&quot;ARM target is not supported as of now.&quot;)
3476                     }
3477 
3478                     if (IS_COMPILE_PARFAIT) {
3479                         environment([
3480                             &quot;COMPILE_PARFAIT&quot; : &quot;true&quot;
3481                         ])
3482                         environment &quot;PATH&quot;, System.env.PARFAIT_PATH + File.pathSeparator + environment.PATH
3483                         cmakeArgs = &quot;-DCMAKE_C_COMPILER=parfait-gcc -DCMAKE_CXX_COMPILER=parfait-g++&quot;
3484                     }
3485 
3486                     if (project.hasProperty(&#39;toolsPath&#39;)) {
3487                         environment &quot;PATH&quot;, toolsPath + File.pathSeparator + environment.PATH
3488                     }
3489 
</pre>
<hr />
<pre>
3576 // This project is for system tests that need to run with a full SDK.
3577 // Most of them display a stage or do other things that preclude running
3578 // them in a shared JVM or as part of the &quot;smoke test&quot; run (which must
3579 // not pop up any windows or use audio). As such, they are only enabled
3580 // when FULL_TEST is specified, and each test runs in its own JVM
3581 project(&quot;:systemTests&quot;) {
3582 
3583     sourceSets {
3584         test
3585 
3586         // Source sets for standalone test apps (used for launcher tests)
3587         testapp1
3588 
3589         // Modular applications
3590         testapp2
3591         testapp3
3592         testapp4
3593         testapp5
3594         testapp6
3595         testscriptapp1
<span class="line-added">3596         testscriptapp2</span>
3597     }
3598 
3599     def nonModSrcSets = [
3600         sourceSets.test,
3601         sourceSets.testapp1
3602     ]
3603 
3604     def modSrcSets = [
3605         sourceSets.testapp2,
3606         sourceSets.testapp3,
3607         sourceSets.testapp4,
3608         sourceSets.testapp5,
3609         sourceSets.testapp6,
<span class="line-modified">3610         sourceSets.testscriptapp1,</span>
<span class="line-added">3611         sourceSets.testscriptapp2</span>
3612     ]
3613 
3614     project.ext.buildModule = false
3615     project.ext.moduleRuntime = false
3616     project.ext.moduleName = &quot;systemTests&quot;
3617 
3618     dependencies {
3619         testCompile project(&quot;:graphics&quot;).sourceSets.test.output
3620         testCompile project(&quot;:base&quot;).sourceSets.test.output
3621         testCompile project(&quot;:controls&quot;).sourceSets.test.output
3622         testCompile project(&quot;:swing&quot;).sourceSets.test.output
3623     }
3624 
3625     def dependentProjects = [ &#39;base&#39;, &#39;graphics&#39;, &#39;controls&#39;, &#39;media&#39;, &#39;web&#39;, &#39;swing&#39;, &#39;fxml&#39; ]
3626     commonModuleSetup(project, dependentProjects)
3627 
3628     File testJavaPolicyFile = new File(rootProject.buildDir, TESTJAVAPOLICYFILE);
3629     File testRunArgsFile = new File(rootProject.buildDir,TESTRUNARGSFILE);
3630 
3631     File stRunArgsFile = new File(project.buildDir,&quot;st.run.args&quot;);
</pre>
<hr />
<pre>
3691         }
3692     }
3693 
3694     task createTestapp1Jar2(type: Jar) {
3695         dependsOn compileTestapp1Java
3696         enabled = IS_FULL_TEST
3697 
3698         destinationDir = file(&quot;$buildDir/testapp1&quot;)
3699         archiveName = &quot;jar2.jar&quot;;
3700         includeEmptyDirs = false
3701         from project.sourceSets.testapp1.java.outputDir
3702         include(&quot;pkg2/**&quot;)
3703     }
3704 
3705     task createTestApps() {
3706         dependsOn(createTestapp1Jar1)
3707         dependsOn(createTestapp1Jar2)
3708     }
3709     test.dependsOn(createTestApps);
3710 
<span class="line-modified">3711     def modtestapps = [ &quot;testapp2&quot;, &quot;testapp3&quot;, &quot;testapp4&quot;, &quot;testapp5&quot;, &quot;testapp6&quot;, &quot;testscriptapp1&quot;, &quot;testscriptapp2&quot; ]</span>
3712     modtestapps.each { testapp -&gt;
3713         def testappCapital = testapp.capitalize()
3714         def copyTestAppTask = task(&quot;copy${testappCapital}&quot;, type: Copy) {
3715             from project.sourceSets.&quot;${testapp}&quot;.java.outputDir
3716             from project.sourceSets.&quot;${testapp}&quot;.output.resourcesDir
3717             into &quot;${project.buildDir}/modules/${testapp}&quot;
3718         }
3719 
3720         def List&lt;String&gt; testAppSourceDirs = []
3721         project.sourceSets.&quot;${testapp}&quot;.java.srcDirs.each { dir -&gt;
3722             testAppSourceDirs += dir
3723         }
3724         def testappCompileTasks = project.getTasksByName(&quot;compile${testappCapital}Java&quot;, true);
3725         def testappResourceTasks = project.getTasksByName(&quot;process${testappCapital}Resources&quot;, true);
3726         testappCompileTasks.each { appCompileTask -&gt;
3727             appCompileTask.options.compilerArgs.addAll([
3728                 &#39;-implicit:none&#39;,
3729                 &#39;--module-source-path&#39;, testAppSourceDirs.join(File.pathSeparator),
3730                 ] )
3731             if (project.hasProperty(&#39;testModulePathArgs&#39;)) {
</pre>
<hr />
<pre>
4327             destinationDir = file(&quot;${bundlesDir}&quot;)
4328             archiveName = &quot;${docsBundleName}.zip&quot;
4329             includeEmptyDirs = false
4330             from docsArtifactsDir
4331             into &quot;${docsBundleName}&quot;
4332         }
4333         zipsTask.dependsOn(zipDocsTask)
4334 
4335         def zipJmodsTask = task(&quot;zipJmods$t.capital&quot;, type: Zip, dependsOn: zipDocsTask) {
4336             destinationDir = file(&quot;${bundlesDir}&quot;)
4337             archiveName = &quot;${jmodsBundleName}.zip&quot;
4338             includeEmptyDirs = false
4339             from jmodsArtifactsDir
4340             into &quot;${jmodsBundleName}&quot;
4341         }
4342         zipsTask.dependsOn(zipJmodsTask)
4343     }
4344 }
4345 
4346 
<span class="line-added">4347 /******************************************************************************</span>
<span class="line-added">4348  *                                                                            *</span>
<span class="line-added">4349  *                             OpenJFX Stubs                                  *</span>
<span class="line-added">4350  *                                                                            *</span>
<span class="line-added">4351  *****************************************************************************/</span>
<span class="line-added">4352 </span>
<span class="line-added">4353 configurations {</span>
<span class="line-added">4354     openjfxStubs</span>
<span class="line-added">4355 }</span>
<span class="line-added">4356 </span>
<span class="line-added">4357 if (IS_STUB_RUNTIME_OPENJFX) {</span>
<span class="line-added">4358     def String platform = IS_MAC ? &quot;mac&quot; : IS_WINDOWS ? &quot;win&quot; : IS_LINUX ? &quot;linux&quot; : &quot;&quot;</span>
<span class="line-added">4359     dependencies {</span>
<span class="line-added">4360         openjfxStubs &quot;org.openjfx:javafx-media:$STUB_RUNTIME_OPENJFX:$platform@jar&quot;</span>
<span class="line-added">4361         openjfxStubs &quot;org.openjfx:javafx-web:$STUB_RUNTIME_OPENJFX:$platform@jar&quot;</span>
<span class="line-added">4362     }</span>
<span class="line-added">4363 }</span>
<span class="line-added">4364 </span>
<span class="line-added">4365 // Extract binary libraries from OpenJFX artifacts for use as stubs</span>
<span class="line-added">4366 task prepOpenJfxStubs(type: Copy) {</span>
<span class="line-added">4367     enabled = IS_STUB_RUNTIME_OPENJFX</span>
<span class="line-added">4368 </span>
<span class="line-added">4369     from configurations.openjfxStubs.files.collect { zipTree(it) }</span>
<span class="line-added">4370     include(&quot;*.dll&quot;)</span>
<span class="line-added">4371     include(&quot;*.dylib&quot;)</span>
<span class="line-added">4372     include(&quot;*.so&quot;)</span>
<span class="line-added">4373     into IS_WINDOWS ? file(&quot;$openjfxStubRuntime/bin&quot;) : file(&quot;$openjfxStubRuntime/lib&quot;)</span>
<span class="line-added">4374 }</span>
<span class="line-added">4375 </span>
<span class="line-added">4376 </span>
4377 /******************************************************************************
4378  *                                                                            *
4379  *                               Modules                                      *
4380  *                                                                            *
4381  *****************************************************************************/
4382 
4383 ext.moduleDependencies = [file(&quot;dependencies&quot;)]
4384 
4385 task buildModules {
4386 }
4387 
4388 // Combine the classes, lib, and bin for each module
4389 compileTargets { t -&gt;
4390     def targetProperties = project.ext[t.upper]
4391 
4392     def platformPrefix = targetProperties.platformPrefix
4393     def bundledSdkDirName = &quot;${platformPrefix}modular-sdk&quot;
4394     def bundledSdkDir = &quot;${rootProject.buildDir}/${bundledSdkDirName}&quot;
4395     def modulesDir = &quot;${bundledSdkDir}/modules&quot;
4396     def modulesCmdsDir = &quot;${bundledSdkDir}/modules_cmds&quot;
</pre>
<hr />
<pre>
4951                 libs += [&#39;fontFreetype&#39;, &#39;fontPango&#39;];
4952             }
4953             libs.each { lib -&gt;
4954                 def variants = targetProperties[lib].containsKey(&#39;variants&#39;) &amp;&amp; !useLipo ? targetProperties[lib].variants : [null]
4955                 variants.each { variant -&gt;
4956                     def variantProperties = variant ? targetProperties[lib][variant] : targetProperties[lib]
4957                     from (&quot;${graphicsProject.buildDir}/libs/$lib/$t.name/${library(variantProperties.lib)}&quot;)
4958                 }
4959             }
4960             if (IS_WINDOWS) {
4961                 from (&quot;${graphicsProject.buildDir}/libs/prismD3D/${t.name}/${library(targetProperties.prismD3D.lib)}&quot;);
4962                 targetProperties.VS2017DLLs.each { vslib -&gt;
4963                     from (&quot;$vslib&quot;);
4964                 }
4965                 targetProperties.WinSDKDLLs.each { winsdklib -&gt;
4966                     from (&quot;$winsdklib&quot;);
4967                 }
4968             }
4969         }
4970 
<span class="line-modified">4971         def buildModuleMediaTask = task(&quot;buildModuleMedia$t.capital&quot;, type: Copy, dependsOn: [mediaProject.assemble, prepOpenJfxStubs]) {</span>
4972             group = &quot;Basic&quot;
4973             description = &quot;copies javafx.media native libraries&quot;
4974 
4975             into &quot;${mediaProject.buildDir}/${moduleNativeDirName}&quot;
4976 
4977             def mediaBuildType = project(&quot;:media&quot;).ext.buildType
4978             if (IS_COMPILE_MEDIA) {
4979                 [ &quot;fxplugins&quot;, &quot;gstreamer-lite&quot;, &quot;jfxmedia&quot; ].each { name -&gt;
4980                     from (&quot;${mediaProject.buildDir}/native/${t.name}/${mediaBuildType}/${library(name)}&quot;) }
4981 
4982                 if (t.name == &quot;mac&quot;) {
4983                     // OSX media natives
4984                     [ &quot;jfxmedia_qtkit&quot;, &quot;jfxmedia_avf&quot;, &quot;glib-lite&quot; ].each { name -&gt;
4985                         from (&quot;${mediaProject.buildDir}/native/${t.name}/${mediaBuildType}/${library(name)}&quot;) }
4986                 } else if (t.name == &quot;linux&quot;) {
4987                     from(&quot;${mediaProject.buildDir}/native/${t.name}/${mediaBuildType}&quot;) { include &quot;libavplugin*.so&quot; }
4988                 } else from (&quot;${mediaProject.buildDir}/native/${t.name}/${mediaBuildType}/${library(&quot;glib-lite&quot;)}&quot;)
4989             } else {
4990                 if (t.name != &quot;android&quot;  &amp;&amp; t.name != &quot;dalvik&quot; ) {
4991                     [ &quot;fxplugins&quot;, &quot;gstreamer-lite&quot;, &quot;jfxmedia&quot; ].each { name -&gt;
4992                         from (&quot;$MEDIA_STUB/${library(name)}&quot;) }
4993                 }
4994 
4995                 if (t.name == &quot;mac&quot;) {
4996                     // copy libjfxmedia_{avf,qtkit}.dylib if they exist
4997                     [ &quot;jfxmedia_qtkit&quot;, &quot;jfxmedia_avf&quot;, &quot;glib-lite&quot; ].each { name -&gt;
4998                         from (&quot;$MEDIA_STUB/${library(name)}&quot;) }
4999                 } else if (t.name == &quot;linux&quot;) {
5000                     from(MEDIA_STUB) { include &quot;libavplugin*.so&quot; }
5001                 }
5002                 else if (t.name != &quot;android&quot;  &amp;&amp; t.name != &quot;dalvik&quot; ) {
5003                     from (&quot;$MEDIA_STUB/${library(&quot;glib-lite&quot;)}&quot;)
5004                 }
5005             }
5006         }
5007 
<span class="line-modified">5008         def buildModuleWeb = task(&quot;buildModuleWeb$t.capital&quot;, type: Copy, dependsOn: [webProject.assemble, prepOpenJfxStubs]) {</span>
5009             group = &quot;Basic&quot;
5010             description = &quot;copies javafx.web native libraries&quot;
5011 
5012             into &quot;${webProject.buildDir}/${moduleNativeDirName}&quot;
5013 
5014             if (IS_COMPILE_WEBKIT) {
5015                 from (&quot;${webProject.buildDir}/libs/${t.name}/${library(&#39;jfxwebkit&#39;)}&quot;)
5016             } else {
5017                 if (t.name != &quot;android&quot; &amp;&amp; t.name != &quot;ios&quot; &amp;&amp; t.name != &quot;dalvik&quot;) {
5018                     from (&quot;$WEB_STUB/${library(&#39;jfxwebkit&#39;)}&quot;)
5019                 }
5020             }
5021         }
5022 
5023         def buildModuleSWT = task(&quot;buildModuleSWT$t.capital&quot;, type: Copy) {
5024             group = &quot;Basic&quot;
5025             description = &quot;copies SWT JAR&quot;
5026 
5027             // FIXME: the following is a hack to workaround the fact that there
5028             // is no way to deliver javafx-swt.jar other than in one of the
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="index.html" target="_top">index</a> <a href="build.properties.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>