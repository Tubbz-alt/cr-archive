<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.graphics/src/main/java/com/sun/prism/impl/shape/NativePiscesRasterizer.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../QueuedPixelSource.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="OpenPiscesRasterizer.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/java/com/sun/prism/impl/shape/NativePiscesRasterizer.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2014, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package com.sun.prism.impl.shape;
 27 
 28 import com.sun.glass.utils.NativeLibLoader;
 29 import com.sun.javafx.geom.Path2D;
 30 import com.sun.javafx.geom.PathIterator;
 31 import com.sun.javafx.geom.RectBounds;
 32 import com.sun.javafx.geom.Shape;
 33 import com.sun.javafx.geom.transform.BaseTransform;

 34 import com.sun.prism.BasicStroke;
 35 import com.sun.prism.impl.PrismSettings;
 36 import java.nio.ByteBuffer;
 37 import java.security.AccessController;
 38 import java.security.PrivilegedAction;
 39 
 40 public class NativePiscesRasterizer implements ShapeRasterizer {
 41     private static MaskData emptyData = MaskData.create(new byte[1], 0, 0, 1, 1);
 42 
 43     private static final byte SEG_MOVETO  = PathIterator.SEG_MOVETO;
 44     private static final byte SEG_LINETO  = PathIterator.SEG_LINETO;
 45     private static final byte SEG_QUADTO  = PathIterator.SEG_QUADTO;
 46     private static final byte SEG_CUBICTO = PathIterator.SEG_CUBICTO;
 47     private static final byte SEG_CLOSE   = PathIterator.SEG_CLOSE;
 48 
 49     private byte cachedMask[];
 50     private ByteBuffer cachedBuffer;
 51     private MaskData cachedData;
 52     private int bounds[] = new int[4];
 53     private boolean lastAntialiasedShape;
</pre>
<hr />
<pre>
136             mxt = xform.getMxt();
137             myx = xform.getMyx();
138             myy = xform.getMyy();
139             myt = xform.getMyt();
140         }
141         int x = bounds[0];
142         int y = bounds[1];
143         int w = bounds[2] - x;
144         int h = bounds[3] - y;
145         if (w &lt;= 0 || h &lt;= 0) {
146             return emptyData;
147         }
148         if (cachedMask == null || w * h &gt; cachedMask.length) {
149             cachedMask = null;
150             cachedBuffer = null;
151             cachedData = new MaskData();
152             int csize = (w * h + 0xfff) &amp; (~0xfff);
153             cachedMask = new byte[csize];
154             cachedBuffer = ByteBuffer.wrap(cachedMask);
155         }
<span class="line-modified">156         if (stroke != null) {</span>
<span class="line-modified">157             produceStrokeAlphas(p2d.getFloatCoordsNoClone(),</span>
<span class="line-modified">158                                 p2d.getCommandsNoClone(),</span>
<span class="line-modified">159                                 p2d.getNumCommands(),</span>
<span class="line-modified">160                                 stroke.getLineWidth(), stroke.getEndCap(),</span>
<span class="line-modified">161                                 stroke.getLineJoin(), stroke.getMiterLimit(),</span>
<span class="line-modified">162                                 stroke.getDashArray(), stroke.getDashPhase(),</span>
<span class="line-modified">163                                 mxx, mxy, mxt, myx, myy, myt,</span>
<span class="line-modified">164                                 bounds, cachedMask);</span>
<span class="line-modified">165         } else {</span>
<span class="line-modified">166             produceFillAlphas(p2d.getFloatCoordsNoClone(),</span>
<span class="line-modified">167                               p2d.getCommandsNoClone(),</span>
<span class="line-modified">168                               p2d.getNumCommands(), p2d.getWindingRule() == Path2D.WIND_NON_ZERO,</span>
<span class="line-modified">169                               mxx, mxy, mxt, myx, myy, myt,</span>
<span class="line-modified">170                               bounds, cachedMask);</span>









171         }
172         x = bounds[0];
173         y = bounds[1];
174         w = bounds[2] - x;
175         h = bounds[3] - y;
176         if (w &lt;= 0 || h &lt;= 0) {
177             return emptyData;
178         }
179         cachedData.update(cachedBuffer, x, y, w, h);
180         return cachedData;
181     }
182 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package com.sun.prism.impl.shape;
 27 
 28 import com.sun.glass.utils.NativeLibLoader;
 29 import com.sun.javafx.geom.Path2D;
 30 import com.sun.javafx.geom.PathIterator;
 31 import com.sun.javafx.geom.RectBounds;
 32 import com.sun.javafx.geom.Shape;
 33 import com.sun.javafx.geom.transform.BaseTransform;
<span class="line-added"> 34 import com.sun.javafx.util.Logging;</span>
 35 import com.sun.prism.BasicStroke;
 36 import com.sun.prism.impl.PrismSettings;
 37 import java.nio.ByteBuffer;
 38 import java.security.AccessController;
 39 import java.security.PrivilegedAction;
 40 
 41 public class NativePiscesRasterizer implements ShapeRasterizer {
 42     private static MaskData emptyData = MaskData.create(new byte[1], 0, 0, 1, 1);
 43 
 44     private static final byte SEG_MOVETO  = PathIterator.SEG_MOVETO;
 45     private static final byte SEG_LINETO  = PathIterator.SEG_LINETO;
 46     private static final byte SEG_QUADTO  = PathIterator.SEG_QUADTO;
 47     private static final byte SEG_CUBICTO = PathIterator.SEG_CUBICTO;
 48     private static final byte SEG_CLOSE   = PathIterator.SEG_CLOSE;
 49 
 50     private byte cachedMask[];
 51     private ByteBuffer cachedBuffer;
 52     private MaskData cachedData;
 53     private int bounds[] = new int[4];
 54     private boolean lastAntialiasedShape;
</pre>
<hr />
<pre>
137             mxt = xform.getMxt();
138             myx = xform.getMyx();
139             myy = xform.getMyy();
140             myt = xform.getMyt();
141         }
142         int x = bounds[0];
143         int y = bounds[1];
144         int w = bounds[2] - x;
145         int h = bounds[3] - y;
146         if (w &lt;= 0 || h &lt;= 0) {
147             return emptyData;
148         }
149         if (cachedMask == null || w * h &gt; cachedMask.length) {
150             cachedMask = null;
151             cachedBuffer = null;
152             cachedData = new MaskData();
153             int csize = (w * h + 0xfff) &amp; (~0xfff);
154             cachedMask = new byte[csize];
155             cachedBuffer = ByteBuffer.wrap(cachedMask);
156         }
<span class="line-modified">157         try {</span>
<span class="line-modified">158             if (stroke != null) {</span>
<span class="line-modified">159                 produceStrokeAlphas(p2d.getFloatCoordsNoClone(),</span>
<span class="line-modified">160                                     p2d.getCommandsNoClone(),</span>
<span class="line-modified">161                                     p2d.getNumCommands(),</span>
<span class="line-modified">162                                     stroke.getLineWidth(), stroke.getEndCap(),</span>
<span class="line-modified">163                                     stroke.getLineJoin(), stroke.getMiterLimit(),</span>
<span class="line-modified">164                                     stroke.getDashArray(), stroke.getDashPhase(),</span>
<span class="line-modified">165                                     mxx, mxy, mxt, myx, myy, myt,</span>
<span class="line-modified">166                                     bounds, cachedMask);</span>
<span class="line-modified">167             } else {</span>
<span class="line-modified">168                 produceFillAlphas(p2d.getFloatCoordsNoClone(),</span>
<span class="line-modified">169                                   p2d.getCommandsNoClone(),</span>
<span class="line-modified">170                                   p2d.getNumCommands(), p2d.getWindingRule() == Path2D.WIND_NON_ZERO,</span>
<span class="line-modified">171                                   mxx, mxy, mxt, myx, myy, myt,</span>
<span class="line-added">172                                   bounds, cachedMask);</span>
<span class="line-added">173             }</span>
<span class="line-added">174         } catch (Throwable ex) {</span>
<span class="line-added">175             if (PrismSettings.verbose) {</span>
<span class="line-added">176                 ex.printStackTrace();</span>
<span class="line-added">177             }</span>
<span class="line-added">178             Logging.getJavaFXLogger().warning(&quot;Cannot rasterize Shape: &quot;</span>
<span class="line-added">179                     + ex.toString());</span>
<span class="line-added">180             return emptyData;</span>
181         }
182         x = bounds[0];
183         y = bounds[1];
184         w = bounds[2] - x;
185         h = bounds[3] - y;
186         if (w &lt;= 0 || h &lt;= 0) {
187             return emptyData;
188         }
189         cachedData.update(cachedBuffer, x, y, w, h);
190         return cachedData;
191     }
192 }
</pre>
</td>
</tr>
</table>
<center><a href="../QueuedPixelSource.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="OpenPiscesRasterizer.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>