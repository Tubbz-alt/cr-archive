<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.graphics/src/main/native-prism/Stroker.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="Renderer.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Transformer.c.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/native-prism/Stroker.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2012, 2013, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -49,65 +49,65 @@</span>
  static ClosePathFunc    Stroker_closePath;
  static PathDoneFunc     Stroker_pathDone;
  
  #define this (*((Stroker *) pStroker))
  
<span class="udiff-line-modified-removed">- static void drawJoin(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint drawJoin(PathConsumer *pStroker,</span>
                       jfloat pdx, jfloat pdy,
                       jfloat x0, jfloat y0,
                       jfloat dx, jfloat dy,
                       jfloat omx, jfloat omy,
                       jfloat mx, jfloat my);
  
<span class="udiff-line-modified-removed">- static void drawRoundJoin2(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint drawRoundJoin2(PathConsumer *pStroker,</span>
                             jfloat cx, jfloat cy,
                             jfloat omx, jfloat omy,
                             jfloat mx, jfloat my,
                             jboolean rev);
  
<span class="udiff-line-modified-removed">- static void drawBezApproxForArc(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint drawBezApproxForArc(PathConsumer *pStroker,</span>
                                  const jfloat cx, const jfloat cy,
                                  const jfloat omx, const jfloat omy,
                                  const jfloat mx, const jfloat my,
                                  jboolean rev);
  
<span class="udiff-line-modified-removed">- static void emitMoveTo(PathConsumer *pStroker, const jfloat x0, const jfloat y0);</span>
<span class="udiff-line-modified-added">+ static jint emitMoveTo(PathConsumer *pStroker, const jfloat x0, const jfloat y0);</span>
  
<span class="udiff-line-modified-removed">- static void emitLineTo(PathConsumer *pStroker, const jfloat x1, const jfloat y1,</span>
<span class="udiff-line-modified-added">+ static jint emitLineTo(PathConsumer *pStroker, const jfloat x1, const jfloat y1,</span>
                         const jboolean rev);
  
<span class="udiff-line-modified-removed">- static void emitCurveTo(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint emitCurveTo(PathConsumer *pStroker,</span>
                          const jfloat x0, const jfloat y0,
                          const jfloat x1, const jfloat y1,
                          const jfloat x2, const jfloat y2,
                          const jfloat x3, const jfloat y3, const jboolean rev);
  
<span class="udiff-line-modified-removed">- static void emitClose(PathConsumer *pStroker);</span>
<span class="udiff-line-modified-added">+ static jint emitClose(PathConsumer *pStroker);</span>
  
<span class="udiff-line-modified-removed">- static void emitReverse(PathConsumer *pStroker);</span>
<span class="udiff-line-modified-added">+ static jint emitReverse(PathConsumer *pStroker);</span>
  
<span class="udiff-line-modified-removed">- static void finish(PathConsumer *pStroker);</span>
<span class="udiff-line-modified-added">+ static jint finish(PathConsumer *pStroker);</span>
  
  extern void PolyStack_init(PolyStack *pStack);
  
  extern void PolyStack_destroy(PolyStack *pStack);
  
  extern jboolean PolyStack_isEmpty(PolyStack *pStack);
  
<span class="udiff-line-modified-removed">- extern void PolyStack_pushLine(PolyStack *pStack,</span>
<span class="udiff-line-modified-added">+ extern jint PolyStack_pushLine(PolyStack *pStack,</span>
                                 jfloat x, jfloat y);
  
<span class="udiff-line-modified-removed">- extern void PolyStack_pushCubic(PolyStack *pStack,</span>
<span class="udiff-line-modified-added">+ extern jint PolyStack_pushCubic(PolyStack *pStack,</span>
                                  jfloat x0, jfloat y0,
                                  jfloat x1, jfloat y1,
                                  jfloat x2, jfloat y2);
  
<span class="udiff-line-modified-removed">- extern void PolyStack_pushQuad(PolyStack *pStack,</span>
<span class="udiff-line-modified-added">+ extern jint PolyStack_pushQuad(PolyStack *pStack,</span>
                                 jfloat x0, jfloat y0,
                                 jfloat x1, jfloat y1);
  
<span class="udiff-line-modified-removed">- extern void PolyStack_pop(PolyStack *pStack, PathConsumer *io);</span>
<span class="udiff-line-modified-added">+ extern jint PolyStack_pop(PolyStack *pStack, PathConsumer *io);</span>
  
      /**
       * Constructs a &lt;code&gt;Stroker&lt;/code&gt;.
       *
       * @param pc2d an output &lt;code&gt;PathConsumer2D&lt;/code&gt;.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -211,44 +211,46 @@</span>
  // pisces used to use fixed point arithmetic with 16 decimal digits. I
  // didn&#39;t want to change the values of the constant below when I converted
  // it to floating point, so that&#39;s why the divisions by 2^16 are there.
  #define ROUND_JOIN_THRESHOLD   (1000/65536.0f)
  
<span class="udiff-line-modified-removed">- static void drawRoundJoin(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint drawRoundJoin(PathConsumer *pStroker,</span>
                            jfloat x, jfloat y,
                            jfloat omx, jfloat omy, jfloat mx, jfloat my,
                            jboolean rev,
                            jfloat threshold)
  {
      jfloat domx, domy, len;
  
      if ((omx == 0 &amp;&amp; omy == 0) || (mx == 0 &amp;&amp; my == 0)) {
<span class="udiff-line-modified-removed">-         return;</span>
<span class="udiff-line-modified-added">+         return ERROR_NONE;</span>
      }
  
      domx = omx - mx;
      domy = omy - my;
      len = domx*domx + domy*domy;
      if (len &lt; threshold) {
<span class="udiff-line-modified-removed">-         return;</span>
<span class="udiff-line-modified-added">+         return ERROR_NONE;</span>
      }
  
      if (rev) {
          omx = -omx;
          omy = -omy;
          mx = -mx;
          my = -my;
      }
<span class="udiff-line-modified-removed">-     drawRoundJoin2(pStroker, x, y, omx, omy, mx, my, rev);</span>
<span class="udiff-line-modified-added">+     return drawRoundJoin2(pStroker, x, y, omx, omy, mx, my, rev);</span>
  }
  
<span class="udiff-line-modified-removed">- static void drawRoundJoin2(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint drawRoundJoin2(PathConsumer *pStroker,</span>
                             jfloat cx, jfloat cy,
                             jfloat omx, jfloat omy,
                             jfloat mx, jfloat my,
                             jboolean rev)
  {
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
<span class="udiff-line-added">+ </span>
      // The sign of the dot product of mx,my and omx,omy is equal to the
      // the sign of the cosine of ext
      // (ext is the angle between omx,omy and mx,my).
      jdouble cosext = omx * mx + omy * my;
      // If it is &gt;=0, we know that abs(ext) is &lt;= 90 degrees, so we only
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -256,11 +258,11 @@</span>
      // and mx,my.
      const jint numCurves = cosext &gt;= 0 ? 1 : 2;
  
      switch (numCurves) {
      case 1:
<span class="udiff-line-modified-removed">-         drawBezApproxForArc(pStroker, cx, cy, omx, omy, mx, my, rev);</span>
<span class="udiff-line-modified-added">+         status = drawBezApproxForArc(pStroker, cx, cy, omx, omy, mx, my, rev);</span>
          break;
      case 2:
          {
              // we need to split the arc into 2 arcs spanning the same angle.
              // The point we want will be one of the 2 intersections of the
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -286,19 +288,23 @@</span>
              // The test above is equivalent to if (rev).
              if (rev) {
                  mmx = -mmx;
                  mmy = -mmy;
              }
<span class="udiff-line-modified-removed">-             drawBezApproxForArc(pStroker, cx, cy, omx, omy, mmx, mmy, rev);</span>
<span class="udiff-line-modified-removed">-             drawBezApproxForArc(pStroker, cx, cy, mmx, mmy, mx, my, rev);</span>
<span class="udiff-line-modified-added">+             status = drawBezApproxForArc(pStroker, cx, cy, omx, omy, mmx, mmy, rev);</span>
<span class="udiff-line-modified-added">+             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                 return status;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             status = drawBezApproxForArc(pStroker, cx, cy, mmx, mmy, mx, my, rev);</span>
              break;
          }
      }
<span class="udiff-line-added">+     return status;</span>
  }
  
  // the input arc defined by omx,omy and mx,my must span &lt;= 90 degrees.
<span class="udiff-line-modified-removed">- static void drawBezApproxForArc(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint drawBezApproxForArc(PathConsumer *pStroker,</span>
                                  const jfloat cx, const jfloat cy,
                                  const jfloat omx, const jfloat omy,
                                  const jfloat mx, const jfloat my,
                                  jboolean rev)
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -324,32 +330,37 @@</span>
      x4 = cx + mx;
      y4 = cy + my;
      x3 = x4 + cv * my;
      y3 = y4 - cv * mx;
  
<span class="udiff-line-modified-removed">-     emitCurveTo(pStroker, x1, y1, x2, y2, x3, y3, x4, y4, rev);</span>
<span class="udiff-line-modified-added">+     return emitCurveTo(pStroker, x1, y1, x2, y2, x3, y3, x4, y4, rev);</span>
  }
  
<span class="udiff-line-modified-removed">- static void drawRoundCap(PathConsumer *pStroker, jfloat cx, jfloat cy, jfloat mx, jfloat my) {</span>
<span class="udiff-line-modified-added">+ static jint drawRoundCap(PathConsumer *pStroker, jfloat cx, jfloat cy, jfloat mx, jfloat my) {</span>
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      const jfloat C = 0.5522847498307933f;
      // the first and second arguments of the following two calls
      // are really will be ignored by emitCurveTo (because of the false),
      // but we put them in anyway, as opposed to just giving it 4 zeroes,
      // because it&#39;s just 4 additions and it&#39;s not good to rely on this
      // sort of assumption (right now it&#39;s true, but that may change).
<span class="udiff-line-modified-removed">-     emitCurveTo(pStroker,</span>
<span class="udiff-line-modified-added">+     status = emitCurveTo(pStroker,</span>
                  cx+mx,      cy+my,
                  cx+mx-C*my, cy+my+C*mx,
                  cx-my+C*mx, cy+mx+C*my,
                  cx-my,      cy+mx,
                  JNI_FALSE);
<span class="udiff-line-modified-removed">-     emitCurveTo(pStroker,</span>
<span class="udiff-line-modified-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     status = emitCurveTo(pStroker,</span>
                  cx-my,      cy+mx,
                  cx-my-C*mx, cy+mx-C*my,
                  cx-mx-C*my, cy-my+C*mx,
                  cx-mx,      cy-my,
                  JNI_FALSE);
<span class="udiff-line-added">+     return status;</span>
  }
  
  // Return the intersection point of the lines (x0, y0) -&gt; (x1, y1)
  // and (x0p, y0p) -&gt; (x1p, y1p) in m[0] and m[1]
  static void computeMiter(const jfloat x0, const jfloat y0,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -413,11 +424,11 @@</span>
      t /= den;
      m[off++] = x0 + t*x10;
      m[off] = y0 + t*y10;
  }
  
<span class="udiff-line-modified-removed">- static void drawMiter(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint drawMiter(PathConsumer *pStroker,</span>
                        const jfloat pdx, const jfloat pdy,
                        const jfloat x0, const jfloat y0,
                        const jfloat dx, const jfloat dy,
                        jfloat omx, jfloat omy, jfloat mx, jfloat my,
                        jboolean rev)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -425,11 +436,11 @@</span>
      jfloat lenSq;
  
      if ((mx == omx &amp;&amp; my == omy) ||
          (pdx == 0 &amp;&amp; pdy == 0) ||
          (dx == 0 &amp;&amp; dy == 0)) {
<span class="udiff-line-modified-removed">-         return;</span>
<span class="udiff-line-modified-added">+         return ERROR_NONE;</span>
      }
  
      if (rev) {
          omx = -omx;
          omy = -omy;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -442,26 +453,33 @@</span>
                   this.miter, 0);
  
      lenSq = (this.miter[0]-x0)*(this.miter[0]-x0) + (this.miter[1]-y0)*(this.miter[1]-y0);
  
      if (lenSq &lt; this.miterLimitSq) {
<span class="udiff-line-modified-removed">-         emitLineTo(pStroker, this.miter[0], this.miter[1], rev);</span>
<span class="udiff-line-modified-added">+         return emitLineTo(pStroker, this.miter[0], this.miter[1], rev);</span>
      }
<span class="udiff-line-added">+     return ERROR_NONE;</span>
  }
  
<span class="udiff-line-modified-removed">- static void Stroker_moveTo(PathConsumer *pStroker, jfloat x0, jfloat y0) {</span>
<span class="udiff-line-modified-added">+ static jint Stroker_moveTo(PathConsumer *pStroker, jfloat x0, jfloat y0) {</span>
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      if (this.prev == DRAWING_OP_TO) {
<span class="udiff-line-modified-removed">-         finish(pStroker);</span>
<span class="udiff-line-modified-added">+         status = finish(pStroker);</span>
<span class="udiff-line-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
      }
      this.sx0 = this.cx0 = x0;
      this.sy0 = this.cy0 = y0;
      this.cdx = this.sdx = 1;
      this.cdy = this.sdy = 0;
      this.prev = MOVE_TO;
<span class="udiff-line-added">+     return status;</span>
  }
  
<span class="udiff-line-modified-removed">- static void Stroker_lineTo(PathConsumer *pStroker, jfloat x1, jfloat y1) {</span>
<span class="udiff-line-modified-added">+ static jint Stroker_lineTo(PathConsumer *pStroker, jfloat x1, jfloat y1) {</span>
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      jfloat dx = x1 - this.cx0;
      jfloat dy = y1 - this.cy0;
      jfloat mx, my;
  
      if (dx == 0.0f &amp;&amp; dy == 0.0f) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -469,168 +487,251 @@</span>
      }
      computeOffset(dx, dy, this.lineWidth2, this.offset[0]);
      mx = this.offset[0][0];
      my = this.offset[0][1];
  
<span class="udiff-line-modified-removed">-     drawJoin(pStroker,</span>
<span class="udiff-line-modified-added">+     status = drawJoin(pStroker,</span>
               this.cdx, this.cdy, this.cx0, this.cy0,
               dx, dy, this.cmx, this.cmy, mx, my);
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">-     emitLineTo(pStroker, this.cx0 + mx, this.cy0 + my, JNI_FALSE);</span>
<span class="udiff-line-modified-removed">-     emitLineTo(pStroker, x1 + mx, y1 + my, JNI_FALSE);</span>
<span class="udiff-line-modified-added">+     status = emitLineTo(pStroker, this.cx0 + mx, this.cy0 + my, JNI_FALSE);</span>
<span class="udiff-line-modified-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     status = emitLineTo(pStroker, x1 + mx, y1 + my, JNI_FALSE);</span>
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">-     emitLineTo(pStroker, this.cx0 - mx, this.cy0 - my, JNI_TRUE);</span>
<span class="udiff-line-modified-removed">-     emitLineTo(pStroker, x1 - mx, y1 - my, JNI_TRUE);</span>
<span class="udiff-line-modified-added">+     status = emitLineTo(pStroker, this.cx0 - mx, this.cy0 - my, JNI_TRUE);</span>
<span class="udiff-line-modified-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     status = emitLineTo(pStroker, x1 - mx, y1 - my, JNI_TRUE);</span>
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
  
      this.cmx = mx;
      this.cmy = my;
      this.cdx = dx;
      this.cdy = dy;
      this.cx0 = x1;
      this.cy0 = y1;
      this.prev = DRAWING_OP_TO;
<span class="udiff-line-added">+     return status;</span>
  }
  
<span class="udiff-line-modified-removed">- static void Stroker_closePath(PathConsumer *pStroker) {</span>
<span class="udiff-line-modified-added">+ static jint Stroker_closePath(PathConsumer *pStroker) {</span>
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      if (this.prev != DRAWING_OP_TO) {
          if (this.prev == CLOSE) {
<span class="udiff-line-modified-removed">-             return;</span>
<span class="udiff-line-modified-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         status = emitMoveTo(pStroker, this.cx0, this.cy0 - this.lineWidth2);</span>
<span class="udiff-line-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
          }
<span class="udiff-line-removed">-         emitMoveTo(pStroker, this.cx0, this.cy0 - this.lineWidth2);</span>
          this.cmx = this.smx = 0;
          this.cmy = this.smy = -this.lineWidth2;
          this.cdx = this.sdx = 1;
          this.cdy = this.sdy = 0;
<span class="udiff-line-modified-removed">-         finish(pStroker);</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-modified-added">+         return finish(pStroker);</span>
      }
  
      if (this.cx0 != this.sx0 || this.cy0 != this.sy0) {
<span class="udiff-line-modified-removed">-         Stroker_lineTo(pStroker, this.sx0, this.sy0);</span>
<span class="udiff-line-modified-added">+         status = Stroker_lineTo(pStroker, this.sx0, this.sy0);</span>
<span class="udiff-line-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
      }
  
<span class="udiff-line-modified-removed">-     drawJoin(pStroker,</span>
<span class="udiff-line-modified-added">+     status = drawJoin(pStroker,</span>
               this.cdx, this.cdy, this.cx0, this.cy0,
               this.sdx, this.sdy, this.cmx, this.cmy,
               this.smx, this.smy);
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">-     emitLineTo(pStroker, this.sx0 + this.smx, this.sy0 + this.smy, JNI_FALSE);</span>
<span class="udiff-line-modified-added">+     status = emitLineTo(pStroker, this.sx0 + this.smx, this.sy0 + this.smy, JNI_FALSE);</span>
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">-     emitMoveTo(pStroker, this.sx0 - this.smx, this.sy0 - this.smy);</span>
<span class="udiff-line-modified-removed">-     emitReverse(pStroker);</span>
<span class="udiff-line-modified-added">+     status = emitMoveTo(pStroker, this.sx0 - this.smx, this.sy0 - this.smy);</span>
<span class="udiff-line-modified-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     status = emitReverse(pStroker);</span>
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
  
      this.prev = CLOSE;
<span class="udiff-line-modified-removed">-     emitClose(pStroker);</span>
<span class="udiff-line-modified-added">+     return emitClose(pStroker);</span>
  }
  
<span class="udiff-line-modified-removed">- static void emitReverse(PathConsumer *pStroker) {</span>
<span class="udiff-line-modified-added">+ static jint emitReverse(PathConsumer *pStroker) {</span>
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      while (!PolyStack_isEmpty(&amp;this.reverse)) {
<span class="udiff-line-modified-removed">-         PolyStack_pop(&amp;this.reverse, this.out);</span>
<span class="udiff-line-modified-added">+         status = PolyStack_pop(&amp;this.reverse, this.out);</span>
<span class="udiff-line-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
      }
<span class="udiff-line-added">+     return status;</span>
  }
  
<span class="udiff-line-modified-removed">- static void Stroker_pathDone(PathConsumer *pStroker) {</span>
<span class="udiff-line-modified-added">+ static jint Stroker_pathDone(PathConsumer *pStroker) {</span>
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      if (this.prev == DRAWING_OP_TO) {
<span class="udiff-line-modified-removed">-         finish(pStroker);</span>
<span class="udiff-line-modified-added">+         status = finish(pStroker);</span>
<span class="udiff-line-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
      }
  
<span class="udiff-line-modified-removed">-     this.out-&gt;pathDone(this.out);</span>
<span class="udiff-line-modified-added">+     status = this.out-&gt;pathDone(this.out);</span>
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
      // this shouldn&#39;t matter since this object won&#39;t be used
      // after the call to this method.
      this.prev = CLOSE;
<span class="udiff-line-added">+     return status;</span>
  }
  
<span class="udiff-line-modified-removed">- static void finish(PathConsumer *pStroker) {</span>
<span class="udiff-line-modified-added">+ static jint finish(PathConsumer *pStroker) {</span>
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      if (this.capStyle == CAP_ROUND) {
<span class="udiff-line-modified-removed">-         drawRoundCap(pStroker, this.cx0, this.cy0, this.cmx, this.cmy);</span>
<span class="udiff-line-modified-added">+         status = drawRoundCap(pStroker, this.cx0, this.cy0, this.cmx, this.cmy);</span>
<span class="udiff-line-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
      } else if (this.capStyle == CAP_SQUARE) {
<span class="udiff-line-modified-removed">-         emitLineTo(pStroker, this.cx0 - this.cmy + this.cmx, this.cy0 + this.cmx + this.cmy, JNI_FALSE);</span>
<span class="udiff-line-modified-removed">-         emitLineTo(pStroker, this.cx0 - this.cmy - this.cmx, this.cy0 + this.cmx - this.cmy, JNI_FALSE);</span>
<span class="udiff-line-modified-added">+         status = emitLineTo(pStroker, this.cx0 - this.cmy + this.cmx, this.cy0 + this.cmx + this.cmy, JNI_FALSE);</span>
<span class="udiff-line-modified-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         status = emitLineTo(pStroker, this.cx0 - this.cmy - this.cmx, this.cy0 + this.cmx - this.cmy, JNI_FALSE);</span>
<span class="udiff-line-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
      }
  
<span class="udiff-line-modified-removed">-     emitReverse(pStroker);</span>
<span class="udiff-line-modified-added">+     status = emitReverse(pStroker);</span>
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
  
      if (this.capStyle == CAP_ROUND) {
<span class="udiff-line-modified-removed">-         drawRoundCap(pStroker, this.sx0, this.sy0, -this.smx, -this.smy);</span>
<span class="udiff-line-modified-added">+         status = drawRoundCap(pStroker, this.sx0, this.sy0, -this.smx, -this.smy);</span>
<span class="udiff-line-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
      } else if (this.capStyle == CAP_SQUARE) {
<span class="udiff-line-modified-removed">-         emitLineTo(pStroker, this.sx0 + this.smy - this.smx, this.sy0 - this.smx - this.smy, JNI_FALSE);</span>
<span class="udiff-line-modified-removed">-         emitLineTo(pStroker, this.sx0 + this.smy + this.smx, this.sy0 - this.smx + this.smy, JNI_FALSE);</span>
<span class="udiff-line-modified-added">+         status = emitLineTo(pStroker, this.sx0 + this.smy - this.smx, this.sy0 - this.smx - this.smy, JNI_FALSE);</span>
<span class="udiff-line-modified-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         status = emitLineTo(pStroker, this.sx0 + this.smy + this.smx, this.sy0 - this.smx + this.smy, JNI_FALSE);</span>
<span class="udiff-line-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
      }
  
<span class="udiff-line-modified-removed">-     emitClose(pStroker);</span>
<span class="udiff-line-modified-added">+     return emitClose(pStroker);</span>
  }
  
<span class="udiff-line-modified-removed">- static void emitMoveTo(PathConsumer *pStroker, const jfloat x0, const jfloat y0) {</span>
<span class="udiff-line-modified-removed">-     this.out-&gt;moveTo(this.out, x0, y0);</span>
<span class="udiff-line-modified-added">+ static jint emitMoveTo(PathConsumer *pStroker, const jfloat x0, const jfloat y0) {</span>
<span class="udiff-line-modified-added">+     return this.out-&gt;moveTo(this.out, x0, y0);</span>
  }
  
<span class="udiff-line-modified-removed">- static void emitLineTo(PathConsumer *pStroker, const jfloat x1, const jfloat y1,</span>
<span class="udiff-line-modified-added">+ static jint emitLineTo(PathConsumer *pStroker, const jfloat x1, const jfloat y1,</span>
                         const jboolean rev)
  {
      if (rev) {
<span class="udiff-line-modified-removed">-         PolyStack_pushLine(&amp;this.reverse, x1, y1);</span>
<span class="udiff-line-modified-added">+         return PolyStack_pushLine(&amp;this.reverse, x1, y1);</span>
      } else {
<span class="udiff-line-modified-removed">-         this.out-&gt;lineTo(this.out, x1, y1);</span>
<span class="udiff-line-modified-added">+         return this.out-&gt;lineTo(this.out, x1, y1);</span>
      }
  }
  
<span class="udiff-line-modified-removed">- static void emitQuadTo(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint emitQuadTo(PathConsumer *pStroker,</span>
                         const jfloat x0, const jfloat y0,
                         const jfloat x1, const jfloat y1,
                         const jfloat x2, const jfloat y2, const jboolean rev)
  {
      if (rev) {
<span class="udiff-line-modified-removed">-         PolyStack_pushQuad(&amp;this.reverse, x0, y0, x1, y1);</span>
<span class="udiff-line-modified-added">+         return PolyStack_pushQuad(&amp;this.reverse, x0, y0, x1, y1);</span>
      } else {
<span class="udiff-line-modified-removed">-         this.out-&gt;quadTo(this.out, x1, y1, x2, y2);</span>
<span class="udiff-line-modified-added">+         return this.out-&gt;quadTo(this.out, x1, y1, x2, y2);</span>
      }
  }
  
<span class="udiff-line-modified-removed">- static void emitCurveTo(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint emitCurveTo(PathConsumer *pStroker,</span>
                          const jfloat x0, const jfloat y0,
                          const jfloat x1, const jfloat y1,
                          const jfloat x2, const jfloat y2,
                          const jfloat x3, const jfloat y3, const jboolean rev)
  {
      if (rev) {
<span class="udiff-line-modified-removed">-         PolyStack_pushCubic(&amp;this.reverse, x0, y0, x1, y1, x2, y2);</span>
<span class="udiff-line-modified-added">+         return PolyStack_pushCubic(&amp;this.reverse, x0, y0, x1, y1, x2, y2);</span>
      } else {
<span class="udiff-line-modified-removed">-         this.out-&gt;curveTo(this.out, x1, y1, x2, y2, x3, y3);</span>
<span class="udiff-line-modified-added">+         return this.out-&gt;curveTo(this.out, x1, y1, x2, y2, x3, y3);</span>
      }
  }
  
<span class="udiff-line-modified-removed">- static void emitClose(PathConsumer *pStroker) {</span>
<span class="udiff-line-modified-removed">-     this.out-&gt;closePath(this.out);</span>
<span class="udiff-line-modified-added">+ static jint emitClose(PathConsumer *pStroker) {</span>
<span class="udiff-line-modified-added">+     return this.out-&gt;closePath(this.out);</span>
  }
  
<span class="udiff-line-modified-removed">- static void drawJoin(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint drawJoin(PathConsumer *pStroker,</span>
                       jfloat pdx, jfloat pdy,
                       jfloat x0, jfloat y0,
                       jfloat dx, jfloat dy,
                       jfloat omx, jfloat omy,
                       jfloat mx, jfloat my)
  {
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      if (this.prev != DRAWING_OP_TO) {
<span class="udiff-line-modified-removed">-         emitMoveTo(pStroker, x0 + mx, y0 + my);</span>
<span class="udiff-line-modified-added">+         status = emitMoveTo(pStroker, x0 + mx, y0 + my);</span>
<span class="udiff-line-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
<span class="udiff-line-added">+         }</span>
          this.sdx = dx;
          this.sdy = dy;
          this.smx = mx;
          this.smy = my;
      } else {
          jboolean cw = isCW(pdx, pdy, dx, dy);
          if (this.joinStyle == JOIN_MITER) {
<span class="udiff-line-modified-removed">-             drawMiter(pStroker, pdx, pdy, x0, y0, dx, dy, omx, omy, mx, my, cw);</span>
<span class="udiff-line-modified-added">+             status = drawMiter(pStroker, pdx, pdy, x0, y0, dx, dy, omx, omy, mx, my, cw);</span>
<span class="udiff-line-added">+             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                 return status;</span>
<span class="udiff-line-added">+             }</span>
          } else if (this.joinStyle == JOIN_ROUND) {
<span class="udiff-line-modified-removed">-             drawRoundJoin(pStroker,</span>
<span class="udiff-line-modified-added">+             status = drawRoundJoin(pStroker,</span>
                            x0, y0,
                            omx, omy,
                            mx, my, cw,
                            ROUND_JOIN_THRESHOLD);
<span class="udiff-line-added">+             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                 return status;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         status = emitLineTo(pStroker, x0, y0, !cw);</span>
<span class="udiff-line-added">+         if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+             return status;</span>
          }
<span class="udiff-line-removed">-         emitLineTo(pStroker, x0, y0, !cw);</span>
      }
      this.prev = DRAWING_OP_TO;
<span class="udiff-line-added">+     return status;</span>
  }
  
  static jboolean withinULP(const jfloat x1, const jfloat y1,
                            const jfloat x2, const jfloat y2,
                            const int maxUlps)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1064,15 +1165,16 @@</span>
      ret = Helpers_filterOutNotInAB(ts, 0, ret, 0.0001f, 0.9999f);
      Helpers_isort(ts, 0, ret);
      return ret;
  }
  
<span class="udiff-line-modified-removed">- static void Stroker_curveTo(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint Stroker_curveTo(PathConsumer *pStroker,</span>
                             jfloat x1, jfloat y1,
                             jfloat x2, jfloat y2,
                             jfloat x3, jfloat y3)
  {
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      jfloat xf, yf, dxs, dys, dxf, dyf;
      jfloat mx, my;
      jint nSplits;
      jfloat prevT;
      jint i, kind;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1111,12 +1213,11 @@</span>
              dyf = middle[7] - middle[1];
          }
      }
      if (dxs == 0.0f &amp;&amp; dys == 0.0f) {
          // this happens iff the &quot;curve&quot; is just a point
<span class="udiff-line-modified-removed">-         Stroker_lineTo(pStroker, middle[0], middle[1]);</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-modified-added">+         return Stroker_lineTo(pStroker, middle[0], middle[1]);</span>
      }
  
      // if these vectors are too small, normalize them, to avoid future
      // precision problems.
      if (fabs(dxs) &lt; 0.1f &amp;&amp; fabs(dys) &lt; 0.1f) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1131,14 +1232,17 @@</span>
      }
  
      computeOffset(dxs, dys, this.lineWidth2, this.offset[0]);
      mx = this.offset[0][0];
      my = this.offset[0][1];
<span class="udiff-line-modified-removed">-     drawJoin(pStroker,</span>
<span class="udiff-line-modified-added">+     status = drawJoin(pStroker,</span>
               this.cdx, this.cdy, this.cx0, this.cy0,
               dxs, dys, this.cmx, this.cmy,
               mx, my);
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
  
      nSplits = findSubdivPoints(pStroker, middle, subdivTs, 8, this.lineWidth2);
      prevT = 0.0f;
      for (i = 0; i &lt; nSplits; i++) {
          jfloat t = subdivTs[i];
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1151,38 +1255,58 @@</span>
  
      kind = 0;
      for (i = 0; i &lt;= nSplits; i++) {
          kind = computeOffsetCubic(pStroker, middle, i*6, lp, rp);
          if (kind != 0) {
<span class="udiff-line-modified-removed">-             emitLineTo(pStroker, lp[0], lp[1], JNI_FALSE);</span>
<span class="udiff-line-modified-added">+             status = emitLineTo(pStroker, lp[0], lp[1], JNI_FALSE);</span>
<span class="udiff-line-added">+             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                 return status;</span>
<span class="udiff-line-added">+             }</span>
              switch(kind) {
              case 8:
<span class="udiff-line-modified-removed">-                 emitCurveTo(pStroker, lp[0], lp[1], lp[2], lp[3], lp[4], lp[5], lp[6], lp[7], JNI_FALSE);</span>
<span class="udiff-line-modified-removed">-                 emitCurveTo(pStroker, rp[0], rp[1], rp[2], rp[3], rp[4], rp[5], rp[6], rp[7], JNI_TRUE);</span>
<span class="udiff-line-modified-added">+                 status = emitCurveTo(pStroker, lp[0], lp[1], lp[2], lp[3], lp[4], lp[5], lp[6], lp[7], JNI_FALSE);</span>
<span class="udiff-line-modified-added">+                 if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                     return status;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 status = emitCurveTo(pStroker, rp[0], rp[1], rp[2], rp[3], rp[4], rp[5], rp[6], rp[7], JNI_TRUE);</span>
<span class="udiff-line-added">+                 if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                     return status;</span>
<span class="udiff-line-added">+                 }</span>
                  break;
              case 4:
<span class="udiff-line-modified-removed">-                 emitLineTo(pStroker, lp[2], lp[3], JNI_FALSE);</span>
<span class="udiff-line-modified-removed">-                 emitLineTo(pStroker, rp[0], rp[1], JNI_TRUE);</span>
<span class="udiff-line-modified-added">+                 status = emitLineTo(pStroker, lp[2], lp[3], JNI_FALSE);</span>
<span class="udiff-line-modified-added">+                 if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                     return status;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 status = emitLineTo(pStroker, rp[0], rp[1], JNI_TRUE);</span>
<span class="udiff-line-added">+                 if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                     return status;</span>
<span class="udiff-line-added">+                 }</span>
                  break;
              }
<span class="udiff-line-modified-removed">-             emitLineTo(pStroker, rp[kind - 2], rp[kind - 1], JNI_TRUE);</span>
<span class="udiff-line-modified-added">+             status = emitLineTo(pStroker, rp[kind - 2], rp[kind - 1], JNI_TRUE);</span>
<span class="udiff-line-added">+             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                 return status;</span>
<span class="udiff-line-added">+             }</span>
          }
      }
  
      this.cmx = (lp[kind - 2] - rp[kind - 2]) / 2;
      this.cmy = (lp[kind - 1] - rp[kind - 1]) / 2;
      this.cdx = dxf;
      this.cdy = dyf;
      this.cx0 = xf;
      this.cy0 = yf;
      this.prev = DRAWING_OP_TO;
<span class="udiff-line-added">+     return status;</span>
  }
  
<span class="udiff-line-modified-removed">- static void Stroker_quadTo(PathConsumer *pStroker,</span>
<span class="udiff-line-modified-added">+ static jint Stroker_quadTo(PathConsumer *pStroker,</span>
                            jfloat x1, jfloat y1,
                            jfloat x2, jfloat y2)
  {
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      jfloat xf, yf, dxs, dys, dxf, dyf;
      jfloat mx, my;
      jint nSplits, i, kind;
      jfloat prevt;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1203,12 +1327,11 @@</span>
          dxs = dxf = middle[4] - middle[0];
          dys = dyf = middle[5] - middle[1];
      }
      if (dxs == 0.0f &amp;&amp; dys == 0.0f) {
          // this happens iff the &quot;curve&quot; is just a point
<span class="udiff-line-modified-removed">-         Stroker_lineTo(pStroker, middle[0], middle[1]);</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-modified-added">+         return Stroker_lineTo(pStroker, middle[0], middle[1]);</span>
      }
      // if these vectors are too small, normalize them, to avoid future
      // precision problems.
      if (fabs(dxs) &lt; 0.1f &amp;&amp; fabs(dys) &lt; 0.1f) {
          jfloat len = (jfloat) sqrt(dxs*dxs + dys*dys);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1222,14 +1345,17 @@</span>
      }
  
      computeOffset(dxs, dys, this.lineWidth2, this.offset[0]);
      mx = this.offset[0][0];
      my = this.offset[0][1];
<span class="udiff-line-modified-removed">-     drawJoin(pStroker,</span>
<span class="udiff-line-modified-added">+     status = drawJoin(pStroker,</span>
               this.cdx, this.cdy, this.cx0, this.cy0,
               dxs, dys, this.cmx, this.cmy,
               mx, my);
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
  
      nSplits = findSubdivPoints(pStroker, middle, subdivTs, 6, this.lineWidth2);
      prevt = 0.0f;
      for (i = 0; i &lt; nSplits; i++) {
          jfloat t = subdivTs[i];
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1242,32 +1368,51 @@</span>
  
      kind = 0;
      for (i = 0; i &lt;= nSplits; i++) {
          kind = computeOffsetQuad(pStroker, middle, i*4, lp, rp);
          if (kind != 0) {
<span class="udiff-line-modified-removed">-             emitLineTo(pStroker, lp[0], lp[1], JNI_FALSE);</span>
<span class="udiff-line-modified-added">+             status = emitLineTo(pStroker, lp[0], lp[1], JNI_FALSE);</span>
<span class="udiff-line-added">+             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                 return status;</span>
<span class="udiff-line-added">+             }</span>
              switch(kind) {
              case 6:
<span class="udiff-line-modified-removed">-                 emitQuadTo(pStroker, lp[0], lp[1], lp[2], lp[3], lp[4], lp[5], JNI_FALSE);</span>
<span class="udiff-line-modified-removed">-                 emitQuadTo(pStroker, rp[0], rp[1], rp[2], rp[3], rp[4], rp[5], JNI_TRUE);</span>
<span class="udiff-line-modified-added">+                 status = emitQuadTo(pStroker, lp[0], lp[1], lp[2], lp[3], lp[4], lp[5], JNI_FALSE);</span>
<span class="udiff-line-modified-added">+                 if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                     return status;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 status = emitQuadTo(pStroker, rp[0], rp[1], rp[2], rp[3], rp[4], rp[5], JNI_TRUE);</span>
<span class="udiff-line-added">+                 if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                     return status;</span>
<span class="udiff-line-added">+                 }</span>
                  break;
              case 4:
<span class="udiff-line-modified-removed">-                 emitLineTo(pStroker, lp[2], lp[3], JNI_FALSE);</span>
<span class="udiff-line-modified-removed">-                 emitLineTo(pStroker, rp[0], rp[1], JNI_TRUE);</span>
<span class="udiff-line-modified-added">+                 status = emitLineTo(pStroker, lp[2], lp[3], JNI_FALSE);</span>
<span class="udiff-line-modified-added">+                 if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                     return status;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 status = emitLineTo(pStroker, rp[0], rp[1], JNI_TRUE);</span>
<span class="udiff-line-added">+                 if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                     return status;</span>
<span class="udiff-line-added">+                 }</span>
                  break;
              }
<span class="udiff-line-modified-removed">-             emitLineTo(pStroker, rp[kind - 2], rp[kind - 1], JNI_TRUE);</span>
<span class="udiff-line-modified-added">+             status = emitLineTo(pStroker, rp[kind - 2], rp[kind - 1], JNI_TRUE);</span>
<span class="udiff-line-added">+             if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+                 return status;</span>
<span class="udiff-line-added">+             }</span>
          }
      }
  
      this.cmx = (lp[kind - 2] - rp[kind - 2]) / 2;
      this.cmy = (lp[kind - 1] - rp[kind - 1]) / 2;
      this.cdx = dxf;
      this.cdy = dyf;
      this.cx0 = xf;
      this.cy0 = yf;
      this.prev = DRAWING_OP_TO;
<span class="udiff-line-added">+     return status;</span>
  }
  
  // a stack of polynomial curves where each curve shares endpoints with
  // adjacent ones.
  /*
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1303,62 +1448,81 @@</span>
  
  jboolean PolyStack_isEmpty(PolyStack *pStack) {
      return this.numCurves == 0;
  }
  
<span class="udiff-line-modified-removed">- static void ensureSpace(PolyStack *pStack, jint n) {</span>
<span class="udiff-line-modified-added">+ static jint ensureSpace(PolyStack *pStack, jint n) {</span>
      if (this.end + n &gt;= this.curvesSIZE) {
          jint newSize = (this.end + n) * 2;
          jfloat *newCurves = new_float(newSize);
<span class="udiff-line-added">+         if (!newCurves) {</span>
<span class="udiff-line-added">+             return ERROR_OOM;</span>
<span class="udiff-line-added">+         }</span>
          System_arraycopy(this.curves, 0, newCurves, 0, this.end);
          free(this.curves);
          this.curves = newCurves;
          this.curvesSIZE = newSize;
      }
      if (this.numCurves &gt;= this.curveTypesSIZE) {
          jint newSize = this.numCurves * 2;
          jint *newTypes = new_int(newSize);
<span class="udiff-line-added">+         if (!newTypes) {</span>
<span class="udiff-line-added">+             return ERROR_OOM;</span>
<span class="udiff-line-added">+         }</span>
          System_arraycopy(this.curveTypes, 0, newTypes, 0, this.numCurves);
          free(this.curveTypes);
          this.curveTypes = newTypes;
          this.curveTypesSIZE = newSize;
      }
<span class="udiff-line-added">+     return ERROR_NONE;</span>
  }
  
<span class="udiff-line-modified-removed">- void PolyStack_pushCubic(PolyStack *pStack,</span>
<span class="udiff-line-modified-added">+ jint PolyStack_pushCubic(PolyStack *pStack,</span>
                           jfloat x0, jfloat y0,
                           jfloat x1, jfloat y1,
                           jfloat x2, jfloat y2)
  {
<span class="udiff-line-modified-removed">-     ensureSpace(pStack, 6);</span>
<span class="udiff-line-modified-added">+     jint status = ensureSpace(pStack, 6);</span>
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
      this.curveTypes[this.numCurves++] = 8;
      // assert(x0 == lastX &amp;&amp; y0 == lastY)
  
      // we reverse the coordinate order to make popping easier
      this.curves[this.end++] = x2;    this.curves[this.end++] = y2;
      this.curves[this.end++] = x1;    this.curves[this.end++] = y1;
      this.curves[this.end++] = x0;    this.curves[this.end++] = y0;
<span class="udiff-line-added">+     return status;</span>
  }
  
<span class="udiff-line-modified-removed">- void PolyStack_pushQuad(PolyStack *pStack,</span>
<span class="udiff-line-modified-added">+ jint PolyStack_pushQuad(PolyStack *pStack,</span>
                          jfloat x0, jfloat y0,
                          jfloat x1, jfloat y1)
  {
<span class="udiff-line-modified-removed">-     ensureSpace(pStack, 4);</span>
<span class="udiff-line-modified-added">+     jint status = ensureSpace(pStack, 4);</span>
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
      this.curveTypes[this.numCurves++] = 6;
      // assert(x0 == lastX &amp;&amp; y0 == lastY)
      this.curves[this.end++] = x1;    this.curves[this.end++] = y1;
      this.curves[this.end++] = x0;    this.curves[this.end++] = y0;
<span class="udiff-line-added">+     return status;</span>
  }
  
<span class="udiff-line-modified-removed">- void PolyStack_pushLine(PolyStack *pStack,</span>
<span class="udiff-line-modified-added">+ jint PolyStack_pushLine(PolyStack *pStack,</span>
                          jfloat x, jfloat y)
  {
<span class="udiff-line-modified-removed">-     ensureSpace(pStack, 2);</span>
<span class="udiff-line-modified-added">+     jint status = ensureSpace(pStack, 2);</span>
<span class="udiff-line-added">+     if (status != ERROR_NONE) {</span>
<span class="udiff-line-added">+         return status;</span>
<span class="udiff-line-added">+     }</span>
      this.curveTypes[this.numCurves++] = 4;
      // assert(x0 == lastX &amp;&amp; y0 == lastY)
      this.curves[this.end++] = x;    this.curves[this.end++] = y;
<span class="udiff-line-added">+     return status;</span>
  }
  
  //@SuppressWarnings(&quot;unused&quot;)
  /*
  jint PolyStack_pop(PolyStack *pStack, jfloat pts[]) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1368,31 +1532,33 @@</span>
      System_arraycopy(curves, end, pts, 0, ret - 2);
      return ret;
  }
  */
  
<span class="udiff-line-modified-removed">- void PolyStack_pop(PolyStack *pStack, PathConsumer *io) {</span>
<span class="udiff-line-modified-added">+ jint PolyStack_pop(PolyStack *pStack, PathConsumer *io) {</span>
<span class="udiff-line-added">+     jint status = ERROR_NONE;</span>
      jint type;
  
      this.numCurves--;
      type = this.curveTypes[this.numCurves];
      this.end -= (type - 2);
      switch(type) {
      case 8:
<span class="udiff-line-modified-removed">-         io-&gt;curveTo(io,</span>
<span class="udiff-line-modified-added">+         status = io-&gt;curveTo(io,</span>
                      this.curves[this.end+0], this.curves[this.end+1],
                      this.curves[this.end+2], this.curves[this.end+3],
                      this.curves[this.end+4], this.curves[this.end+5]);
          break;
      case 6:
<span class="udiff-line-modified-removed">-         io-&gt;quadTo(io,</span>
<span class="udiff-line-modified-added">+         status = io-&gt;quadTo(io,</span>
                     this.curves[this.end+0], this.curves[this.end+1],
                     this.curves[this.end+2], this.curves[this.end+3]);
<span class="udiff-line-modified-removed">-             break;</span>
<span class="udiff-line-modified-added">+         break;</span>
      case 4:
<span class="udiff-line-modified-removed">-         io-&gt;lineTo(io, this.curves[this.end], this.curves[this.end+1]);</span>
<span class="udiff-line-modified-added">+         status = io-&gt;lineTo(io, this.curves[this.end], this.curves[this.end+1]);</span>
      }
<span class="udiff-line-added">+     return status;</span>
  }
  
  //@Override
  /*
  public String toString() {
</pre>
<center><a href="Renderer.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Transformer.c.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>