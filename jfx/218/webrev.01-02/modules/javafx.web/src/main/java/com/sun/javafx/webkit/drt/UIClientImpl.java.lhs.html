<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/java/com/sun/javafx/webkit/drt/UIClientImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package com.sun.javafx.webkit.drt;
 27 
 28 import com.sun.webkit.LoadListenerClient;
 29 import com.sun.webkit.UIClient;
 30 import com.sun.webkit.WebPage;
 31 import com.sun.webkit.graphics.WCImage;
 32 import com.sun.webkit.graphics.WCRectangle;
 33 
 34 import java.io.File;
 35 import java.util.ArrayList;
 36 import java.util.Iterator;
 37 import java.util.List;
 38 
 39 /**
 40  * {@link UIClient} implementation for DRT tests.
 41  */
 42 final class UIClientImpl implements UIClient {
 43 
 44     private WebPage webPage;
 45     private final List&lt;UIClient&gt; clients = new ArrayList&lt;UIClient&gt;();
 46 
 47     private WCRectangle bounds = new WCRectangle(0, 0, 800, 600);
 48 
 49     UIClientImpl() {
 50     }
 51 
 52     void setWebPage(WebPage webPage) {
 53         this.webPage = webPage;
 54     }
 55 
 56     /**
 57      * {@inheritDoc}
 58      */
 59     @Override
 60     public WebPage createPage(boolean menu, boolean status, boolean toolbar,
 61             boolean resizable)
 62     {
 63         UIClientImpl client = new UIClientImpl();
 64         final WebPage page = new WebPage(null, client, null, null, new DumpRenderTree.ThemeClientImplStub(), false);
 65         client.setWebPage(page);
 66 
 67         page.setBounds(0, 0, 800, 600);
 68 //        webPage.setUsePageCache(true);
 69 
 70         page.addLoadListenerClient(new LoadListenerClient() {
 71             @Override
 72             public void dispatchLoadEvent(long frame, int state, String url, String contentType, double progress, int errorCode) {
 73                 if (state == DOCUMENT_AVAILABLE) {
 74                     DumpRenderTree.drt.dumpUnloadListeners(page, frame);
 75                 }
 76             }
 77             @Override
 78             public void dispatchResourceLoadEvent(long frame, int state, String url, String contentType, double progress, int errorCode) {
 79             }
 80         });
 81 
<a name="1" id="anc1"></a>

 82         // This call is needed to add the main frame to WebPage.frames list.
 83         // TODO: investigate why it&#39;s not added automatically (via WebPage.fwkFrameCreated) and fix.
 84         page.getMainFrame();
 85 
 86         clients.add(client);
 87         return client.webPage;
 88     }
 89 
 90     /**
 91      * {@inheritDoc}
 92      */
 93     @Override
 94     public void closePage() {
 95         Iterator&lt;UIClient&gt; it = clients.iterator();
 96         while (it.hasNext()) {
 97             it.next().closePage();
 98             it.remove();
 99         }
100         if (webPage.getMainFrame() != 0) {
101             webPage.dispose();
102         }
103     }
104 
105     /**
106      * {@inheritDoc}
107      */
108     @Override
109     public void showView() {
110         // look, I&#39;m showing!
111     }
112 
113     /**
114      * {@inheritDoc}
115      */
116     @Override
117     public WCRectangle getViewBounds() {
118         return bounds;
119     }
120 
121     /**
122      * {@inheritDoc}
123      */
124     @Override
125     public void setViewBounds(WCRectangle bounds) {
126         this.bounds = bounds;
127     }
128 
129     /**
130      * {@inheritDoc}
131      */
132     @Override
133     public void setStatusbarText(String text) {
134     }
135 
136     /**
137      * {@inheritDoc}
138      */
139     @Override
140     public void alert(String text) {
141         if (!DumpRenderTree.drt.complete()) {
142             DumpRenderTree.out.printf(&quot;ALERT: %s\n&quot;, text);
143         }
144     }
145 
146     /**
147      * {@inheritDoc}
148      */
149     @Override
150     public boolean confirm(String text) {
151         if (!DumpRenderTree.drt.complete()) {
152             DumpRenderTree.out.printf(&quot;CONFIRM: %s\n&quot;, text);
153         }
154         return false;
155     }
156 
157     /**
158      * {@inheritDoc}
159      */
160     @Override
161     public String prompt(String text, String defaultValue) {
162         if (!DumpRenderTree.drt.complete()) {
163             DumpRenderTree.out.printf(&quot;PROMPT: %s, default text: %s\n&quot;, text, defaultValue);
164         }
165         return defaultValue;
166     }
167 
168     @Override
169     public boolean canRunBeforeUnloadConfirmPanel() {
170         return true;
171     }
172 
173     @Override
174     public boolean runBeforeUnloadConfirmPanel(String message) {
175         if (!DumpRenderTree.drt.complete()) {
176             DumpRenderTree.out.printf(&quot;CONFIRM NAVIGATION: %s\n&quot;, message);
177         }
178         return !DumpRenderTree.drt.shouldStayOnPageAfterHandlingBeforeUnload();
179     }
180 
181     /**
182      * {@inheritDoc}
183      */
184     @Override
185     public String[] chooseFile(String initialFileName, boolean multiple, String mimeFilters) {
186         if (DumpRenderTree.drt.complete()) {
187             return null;
188         }
189         DumpRenderTree.out.printf(&quot;OPEN FILE PANEL\n&quot;);
190         String[] openPanelFiles = DumpRenderTree.drt.openPanelFiles();
191         if (openPanelFiles == null || openPanelFiles.length == 0) {
192             return null;
193         }
194 
195         final File testURLFile = new File(DumpRenderTree.drt.getTestURL());
196         String testURLFileParent = testURLFile.getParent();
197         if (multiple) {
198             String[] result = new String[openPanelFiles.length];
199             for (int i = 0; i &lt; openPanelFiles.length; i++) {
200                 result[i] = new File(testURLFileParent, openPanelFiles[i]).getAbsolutePath();
201             }
202             return result;
203         } else {
204             return new String[] { new File(testURLFileParent, openPanelFiles[0]).getAbsolutePath() };
205         }
206     }
207 
208     /**
209      * {@inheritDoc}
210      */
211     @Override
212     public void print() {
213         throw new UnsupportedOperationException(&quot;Not supported yet&quot;);
214     }
215 
216     /**
217      * {@inheritDoc}
218      */
219     @Override
220     public void startDrag(WCImage frame, int imageOffsetX, int imageOffsetY,
221             int eventPosX, int eventPosY, String[] mimeTypes, Object[] values, boolean isImageSource)
222     {
223         throw new UnsupportedOperationException(&quot;Not supported yet&quot;);
224     }
225 
226     /**
227      * {@inheritDoc}
228      */
229     @Override
230     public void confirmStartDrag() {
231         throw new UnsupportedOperationException(&quot;Not supported yet.&quot;);
232     }
233 
234     /**
235      * {@inheritDoc}
236      */
237     @Override
238     public boolean isDragConfirmed() {
239         return false;
240     }
241 }
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>