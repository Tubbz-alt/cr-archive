<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/assembler/MacroAssemblerMIPS.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MacroAssemblerMIPS.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MacroAssemblerX86.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/assembler/MacroAssemblerMIPS.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (C) 2008-2018 Apple Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2008-2019 Apple Inc. All rights reserved.</span>
   * Copyright (C) 2010 MIPS Technologies, Inc. All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -36,12 +36,12 @@</span>
  using Assembler = TARGET_ASSEMBLER;
  
  class MacroAssemblerMIPS : public AbstractMacroAssembler&lt;Assembler&gt; {
  public:
      typedef MIPSRegisters::FPRegisterID FPRegisterID;
<span class="udiff-line-modified-removed">-     static const unsigned numGPRs = 32;</span>
<span class="udiff-line-modified-removed">-     static const unsigned numFPRs = 32;</span>
<span class="udiff-line-modified-added">+     static constexpr unsigned numGPRs = 32;</span>
<span class="udiff-line-modified-added">+     static constexpr unsigned numFPRs = 32;</span>
  
      MacroAssemblerMIPS()
          : m_fixedWidth(false)
      {
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -59,25 +59,25 @@</span>
      inline int bitPosition(int32_t v)
      {
          return getLSBSet(v);
      }
  
<span class="udiff-line-modified-removed">-     static const Scale ScalePtr = TimesFour;</span>
<span class="udiff-line-modified-added">+     static constexpr Scale ScalePtr = TimesFour;</span>
  
      // For storing immediate number
<span class="udiff-line-modified-removed">-     static const RegisterID immTempRegister = MIPSRegisters::t0;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID immTempRegister = MIPSRegisters::t0;</span>
      // For storing data loaded from the memory
<span class="udiff-line-modified-removed">-     static const RegisterID dataTempRegister = MIPSRegisters::t1;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID dataTempRegister = MIPSRegisters::t1;</span>
      // For storing address base
<span class="udiff-line-modified-removed">-     static const RegisterID addrTempRegister = MIPSRegisters::t7;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID addrTempRegister = MIPSRegisters::t7;</span>
      // For storing compare result
<span class="udiff-line-modified-removed">-     static const RegisterID cmpTempRegister = MIPSRegisters::t8;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID cmpTempRegister = MIPSRegisters::t8;</span>
  
      // FP temp register
<span class="udiff-line-modified-removed">-     static const FPRegisterID fpTempRegister = MIPSRegisters::f16;</span>
<span class="udiff-line-modified-added">+     static constexpr FPRegisterID fpTempRegister = MIPSRegisters::f16;</span>
  
<span class="udiff-line-modified-removed">-     static const int MaximumCompactPtrAlignedAddressOffset = 0x7FFFFFFF;</span>
<span class="udiff-line-modified-added">+     static constexpr int MaximumCompactPtrAlignedAddressOffset = 0x7FFFFFFF;</span>
  
      enum RelationalCondition {
          Equal,
          NotEqual,
          Above,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -116,13 +116,13 @@</span>
      enum class LoadAddressMode {
          ScaleAndAddOffsetIfOffsetIsOutOfBounds,
          Scale
      };
  
<span class="udiff-line-modified-removed">-     static const RegisterID stackPointerRegister = MIPSRegisters::sp;</span>
<span class="udiff-line-modified-removed">-     static const RegisterID framePointerRegister = MIPSRegisters::fp;</span>
<span class="udiff-line-modified-removed">-     static const RegisterID returnAddressRegister = MIPSRegisters::ra;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID stackPointerRegister = MIPSRegisters::sp;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID framePointerRegister = MIPSRegisters::fp;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID returnAddressRegister = MIPSRegisters::ra;</span>
  
      // Integer arithmetic operations:
      //
      // Operations are typically two operand - operation(source, srcDst)
      // For many operations the source may be an TrustedImm32, the srcDst operand
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -473,10 +473,29 @@</span>
      void neg32(RegisterID src, RegisterID dest)
      {
          m_assembler.subu(dest, MIPSRegisters::zero, src);
      }
  
<span class="udiff-line-added">+     void or16(TrustedImm32 imm, AbsoluteAddress dest)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         if (!imm.m_value &amp;&amp; !m_fixedWidth)</span>
<span class="udiff-line-added">+             return;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (m_fixedWidth) {</span>
<span class="udiff-line-added">+             // TODO: Swap dataTempRegister and immTempRegister usage</span>
<span class="udiff-line-added">+             load16(dest.m_ptr, immTempRegister);</span>
<span class="udiff-line-added">+             or32(imm, immTempRegister);</span>
<span class="udiff-line-added">+             store16(immTempRegister, dest.m_ptr);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             uintptr_t adr = reinterpret_cast&lt;uintptr_t&gt;(dest.m_ptr);</span>
<span class="udiff-line-added">+             m_assembler.lui(addrTempRegister, (adr + 0x8000) &gt;&gt; 16);</span>
<span class="udiff-line-added">+             m_assembler.lhu(immTempRegister, addrTempRegister, adr &amp; 0xffff);</span>
<span class="udiff-line-added">+             or32(imm, immTempRegister);</span>
<span class="udiff-line-added">+             m_assembler.sh(immTempRegister, addrTempRegister, adr &amp; 0xffff);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      void or32(RegisterID src, RegisterID dest)
      {
          m_assembler.orInsn(dest, dest, src);
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1170,10 +1189,26 @@</span>
          DataLabelCompact dataLabel(this);
          load32WithAddressOffsetPatch(address, dest);
          return dataLabel;
      }
  
<span class="udiff-line-added">+     void load16(const void* address, RegisterID dest)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         if (m_fixedWidth) {</span>
<span class="udiff-line-added">+             /*</span>
<span class="udiff-line-added">+                 li  addrTemp, address</span>
<span class="udiff-line-added">+                 lhu  dest, 0(addrTemp)</span>
<span class="udiff-line-added">+             */</span>
<span class="udiff-line-added">+             move(TrustedImmPtr(address), addrTempRegister);</span>
<span class="udiff-line-added">+             m_assembler.lhu(dest, addrTempRegister, 0);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             uintptr_t adr = reinterpret_cast&lt;uintptr_t&gt;(address);</span>
<span class="udiff-line-added">+             m_assembler.lui(addrTempRegister, (adr + 0x8000) &gt;&gt; 16);</span>
<span class="udiff-line-added">+             m_assembler.lhu(dest, addrTempRegister, adr &amp; 0xffff);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /* Need to use zero-extened load half-word for load16.  */
      void load16(ImplicitAddress address, RegisterID dest)
      {
          if (address.offset &gt;= -32768 &amp;&amp; address.offset &lt;= 32767
              &amp;&amp; !m_fixedWidth)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1338,10 +1373,26 @@</span>
                  m_assembler.sb(immTempRegister, addrTempRegister, address.offset);
              }
          }
      }
  
<span class="udiff-line-added">+     void store16(RegisterID src, const void* address)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         if (m_fixedWidth) {</span>
<span class="udiff-line-added">+             /*</span>
<span class="udiff-line-added">+                 li  addrTemp, address</span>
<span class="udiff-line-added">+                 sh  src, 0(addrTemp)</span>
<span class="udiff-line-added">+             */</span>
<span class="udiff-line-added">+             move(TrustedImmPtr(address), addrTempRegister);</span>
<span class="udiff-line-added">+             m_assembler.sh(src, addrTempRegister, 0);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             uintptr_t adr = reinterpret_cast&lt;uintptr_t&gt;(address);</span>
<span class="udiff-line-added">+             m_assembler.lui(addrTempRegister, (adr + 0x8000) &gt;&gt; 16);</span>
<span class="udiff-line-added">+             m_assembler.sh(src, addrTempRegister, adr &amp; 0xffff);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      void store16(RegisterID src, ImplicitAddress address)
      {
          if (address.offset &gt;= -32768 &amp;&amp; address.offset &lt;= 32767
              &amp;&amp; !m_fixedWidth) {
              m_assembler.sh(src, address.base, address.offset);
</pre>
<center><a href="MacroAssemblerMIPS.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MacroAssemblerX86.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>