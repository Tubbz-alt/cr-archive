<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/wasm/WasmMemoryInformation.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="WasmMemory.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="WasmModule.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/wasm/WasmMemoryInformation.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 33,45 ***</span>
  #include &quot;WasmMemory.h&quot;
  #include &lt;wtf/NeverDestroyed.h&gt;
  
  namespace JSC { namespace Wasm {
  
<span class="line-removed">- static Vector&lt;GPRReg&gt; getPinnedRegisters(unsigned remainingPinnedRegisters)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     Vector&lt;GPRReg&gt; registers;</span>
<span class="line-removed">-     jscCallingConvention().m_calleeSaveRegisters.forEach([&amp;] (Reg reg) {</span>
<span class="line-removed">-         if (!reg.isGPR())</span>
<span class="line-removed">-             return;</span>
<span class="line-removed">-         GPRReg gpr = reg.gpr();</span>
<span class="line-removed">-         if (!remainingPinnedRegisters || RegisterSet::stackRegisters().get(reg))</span>
<span class="line-removed">-             return;</span>
<span class="line-removed">-         if (RegisterSet::runtimeTagRegisters().get(reg)) {</span>
<span class="line-removed">-             // Since we don&#39;t need to, we currently don&#39;t pick from the tag registers to allow</span>
<span class="line-removed">-             // JS-&gt;Wasm stubs to freely use these registers.</span>
<span class="line-removed">-             return;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         --remainingPinnedRegisters;</span>
<span class="line-removed">-         registers.append(gpr);</span>
<span class="line-removed">-     });</span>
<span class="line-removed">-     return registers;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  const PinnedRegisterInfo&amp; PinnedRegisterInfo::get()
  {
      static LazyNeverDestroyed&lt;PinnedRegisterInfo&gt; staticPinnedRegisterInfo;
      static std::once_flag staticPinnedRegisterInfoFlag;
      std::call_once(staticPinnedRegisterInfoFlag, [] () {
          unsigned numberOfPinnedRegisters = 2;
          if (!Context::useFastTLS())
              ++numberOfPinnedRegisters;
<span class="line-modified">!         Vector&lt;GPRReg&gt; pinnedRegs = getPinnedRegisters(numberOfPinnedRegisters);</span>
<span class="line-modified">! </span>
<span class="line-removed">-         GPRReg baseMemoryPointer = pinnedRegs.takeLast();</span>
<span class="line-removed">-         GPRReg sizeRegister = pinnedRegs.takeLast();</span>
          GPRReg wasmContextInstancePointer = InvalidGPRReg;
          if (!Context::useFastTLS())
<span class="line-modified">!             wasmContextInstancePointer = pinnedRegs.takeLast();</span>
  
          staticPinnedRegisterInfo.construct(sizeRegister, baseMemoryPointer, wasmContextInstancePointer);
      });
  
      return staticPinnedRegisterInfo.get();
<span class="line-new-header">--- 33,23 ---</span>
  #include &quot;WasmMemory.h&quot;
  #include &lt;wtf/NeverDestroyed.h&gt;
  
  namespace JSC { namespace Wasm {
  
  const PinnedRegisterInfo&amp; PinnedRegisterInfo::get()
  {
      static LazyNeverDestroyed&lt;PinnedRegisterInfo&gt; staticPinnedRegisterInfo;
      static std::once_flag staticPinnedRegisterInfoFlag;
      std::call_once(staticPinnedRegisterInfoFlag, [] () {
          unsigned numberOfPinnedRegisters = 2;
          if (!Context::useFastTLS())
              ++numberOfPinnedRegisters;
<span class="line-modified">!         GPRReg baseMemoryPointer = GPRInfo::regCS3;</span>
<span class="line-modified">!         GPRReg sizeRegister = GPRInfo::regCS4;</span>
          GPRReg wasmContextInstancePointer = InvalidGPRReg;
          if (!Context::useFastTLS())
<span class="line-modified">!             wasmContextInstancePointer = GPRInfo::regCS0;</span>
  
          staticPinnedRegisterInfo.construct(sizeRegister, baseMemoryPointer, wasmContextInstancePointer);
      });
  
      return staticPinnedRegisterInfo.get();
</pre>
<center><a href="WasmMemory.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="WasmModule.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>