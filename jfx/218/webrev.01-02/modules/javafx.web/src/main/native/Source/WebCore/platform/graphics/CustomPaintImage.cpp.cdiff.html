<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/CustomPaintImage.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CrossfadeGeneratedImage.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="DecodingOptions.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/CustomPaintImage.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 35,10 ***</span>
<span class="line-new-header">--- 35,11 ---</span>
  #include &quot;CustomPaintCanvas.h&quot;
  #include &quot;GraphicsContext.h&quot;
  #include &quot;ImageBitmap.h&quot;
  #include &quot;ImageBuffer.h&quot;
  #include &quot;JSCSSPaintCallback.h&quot;
<span class="line-added">+ #include &quot;JSDOMExceptionHandling.h&quot;</span>
  #include &quot;PaintRenderingContext2D.h&quot;
  #include &quot;RenderElement.h&quot;
  #include &quot;StylePropertyMap.h&quot;
  #include &quot;TypedOMCSSImageValue.h&quot;
  #include &quot;TypedOMCSSUnitValue.h&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 150,16 ***</span>
      auto&amp; vm = paintConstructor.getObject()-&gt;vm();
      JSC::JSLockHolder lock(vm);
      auto scope = DECLARE_THROW_SCOPE(vm);
      auto&amp; globalObject = *paintConstructor.getObject()-&gt;globalObject();
  
<span class="line-modified">!     auto&amp; state = *globalObject.globalExec();</span>
      JSC::ArgList noArgs;
<span class="line-modified">!     JSC::JSValue thisObject = { JSC::construct(&amp;state, paintConstructor, noArgs, &quot;Failed to construct paint class&quot;) };</span>
  
      if (UNLIKELY(scope.exception())) {
<span class="line-modified">!         reportException(&amp;state, scope.exception());</span>
          return ImageDrawResult::DidNothing;
      }
  
      auto result = callback.handleEvent(WTFMove(thisObject), *context, size, propertyMap, m_arguments);
      if (result.type() != CallbackResultType::Success)
<span class="line-new-header">--- 151,16 ---</span>
      auto&amp; vm = paintConstructor.getObject()-&gt;vm();
      JSC::JSLockHolder lock(vm);
      auto scope = DECLARE_THROW_SCOPE(vm);
      auto&amp; globalObject = *paintConstructor.getObject()-&gt;globalObject();
  
<span class="line-modified">!     auto&amp; lexicalGlobalObject = globalObject;</span>
      JSC::ArgList noArgs;
<span class="line-modified">!     JSC::JSValue thisObject = { JSC::construct(&amp;lexicalGlobalObject, paintConstructor, noArgs, &quot;Failed to construct paint class&quot;) };</span>
  
      if (UNLIKELY(scope.exception())) {
<span class="line-modified">!         reportException(&amp;lexicalGlobalObject, scope.exception());</span>
          return ImageDrawResult::DidNothing;
      }
  
      auto result = callback.handleEvent(WTFMove(thisObject), *context, size, propertyMap, m_arguments);
      if (result.type() != CallbackResultType::Success)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 195,11 ***</span>
      double yScale = fabs(destContextCTM.yScale());
      AffineTransform adjustedPatternCTM = patternTransform;
      adjustedPatternCTM.scale(1.0 / xScale, 1.0 / yScale);
      adjustedSrcRect.scale(xScale, yScale);
  
<span class="line-modified">!     auto buffer = ImageBuffer::createCompatibleBuffer(adjustedSize, ColorSpaceSRGB, destContext);</span>
      if (!buffer)
          return;
      doCustomPaint(buffer-&gt;context(), adjustedSize);
  
      if (destContext.drawLuminanceMask())
<span class="line-new-header">--- 196,11 ---</span>
      double yScale = fabs(destContextCTM.yScale());
      AffineTransform adjustedPatternCTM = patternTransform;
      adjustedPatternCTM.scale(1.0 / xScale, 1.0 / yScale);
      adjustedSrcRect.scale(xScale, yScale);
  
<span class="line-modified">!     auto buffer = ImageBuffer::createCompatibleBuffer(adjustedSize, ColorSpace::SRGB, destContext);</span>
      if (!buffer)
          return;
      doCustomPaint(buffer-&gt;context(), adjustedSize);
  
      if (destContext.drawLuminanceMask())
</pre>
<center><a href="CrossfadeGeneratedImage.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="DecodingOptions.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>