<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/html/track/TextTrack.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InbandTextTrack.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="TextTrackCue.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/html/track/TextTrack.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
220         setKind(Kind::Subtitles);
221     else {
222         // The invalid value default is the metadata state.
223         setKind(Kind::Metadata);
224     }
225 }
226 
227 void TextTrack::setMode(Mode mode)
228 {
229     // On setting, if the new value isn&#39;t equal to what the attribute would currently
230     // return, the new value must be processed as follows ...
231     if (m_mode == mode)
232         return;
233 
234     // If mode changes to disabled, remove this track&#39;s cues from the client
235     // because they will no longer be accessible from the cues() function.
236     if (mode == Mode::Disabled &amp;&amp; m_client &amp;&amp; m_cues)
237         m_client-&gt;textTrackRemoveCues(*this, *m_cues);
238 
239     if (mode != Mode::Showing &amp;&amp; m_cues) {
<span class="line-modified">240         for (size_t i = 0; i &lt; m_cues-&gt;length(); ++i) {</span>
<span class="line-modified">241             RefPtr&lt;TextTrackCue&gt; cue = m_cues-&gt;item(i);</span>
<span class="line-removed">242             if (cue-&gt;isRenderable())</span>
<span class="line-removed">243                 toVTTCue(cue.get())-&gt;removeDisplayTree();</span>
<span class="line-removed">244         }</span>
245     }
246 
247     m_mode = mode;
248 
249     if (m_client)
250         m_client-&gt;textTrackModeChanged(*this);
251 }
252 
253 TextTrackCueList* TextTrack::cues()
254 {
255     // 4.8.10.12.5 If the text track mode ... is not the text track disabled mode,
256     // then the cues attribute must return a live TextTrackCueList object ...
257     // Otherwise, it must return null. When an object is returned, the
258     // same object must be returned each time.
259     // http://www.whatwg.org/specs/web-apps/current-work/#dom-texttrack-cues
260     if (m_mode == Mode::Disabled)
261         return nullptr;
262     return &amp;ensureTextTrackCueList();
263 }
264 
</pre>
<hr />
<pre>
424 
425     // The cue may need to be repositioned in the media element&#39;s interval tree, may need to
426     // be re-rendered, etc, so remove it before the modification...
427     m_client-&gt;textTrackRemoveCue(*this, *cue);
428 }
429 
430 void TextTrack::cueDidChange(TextTrackCue* cue)
431 {
432     if (!m_client)
433         return;
434 
435     // Make sure the TextTrackCueList order is up-to-date.
436     ensureTextTrackCueList().updateCueIndex(*cue);
437 
438     // ... and add it back again.
439     m_client-&gt;textTrackAddCue(*this, *cue);
440 }
441 
442 int TextTrack::trackIndex()
443 {
<span class="line-modified">444     ASSERT(m_mediaElement);</span>
<span class="line-modified">445     if (!m_trackIndex)</span>

446         m_trackIndex = m_mediaElement-&gt;ensureTextTracks().getTrackIndex(*this);

447     return m_trackIndex.value();
448 }
449 
450 void TextTrack::invalidateTrackIndex()
451 {
452     m_trackIndex = WTF::nullopt;
453     m_renderedTrackIndex = WTF::nullopt;
454 }
455 
456 bool TextTrack::isRendered()
457 {
458     return (m_kind == Kind::Captions || m_kind == Kind::Subtitles || m_kind == Kind::Forced)
459         &amp;&amp; m_mode == Mode::Showing;
460 }
461 
462 TextTrackCueList&amp; TextTrack::ensureTextTrackCueList()
463 {
464     if (!m_cues)
465         m_cues = TextTrackCueList::create();
466     return *m_cues;
467 }
468 
469 int TextTrack::trackIndexRelativeToRenderedTracks()
470 {
<span class="line-modified">471     ASSERT(m_mediaElement);</span>
<span class="line-modified">472     if (!m_renderedTrackIndex)</span>

473         m_renderedTrackIndex = m_mediaElement-&gt;ensureTextTracks().getTrackIndexRelativeToRenderedTracks(*this);

474     return m_renderedTrackIndex.value();
475 }
476 
477 bool TextTrack::hasCue(TextTrackCue* cue, TextTrackCue::CueMatchRules match)
478 {
479     if (cue-&gt;startMediaTime() &lt; MediaTime::zeroTime() || cue-&gt;endMediaTime() &lt; MediaTime::zeroTime())
480         return false;
481 
482     if (!m_cues || !m_cues-&gt;length())
483         return false;
484 
485     size_t searchStart = 0;
486     size_t searchEnd = m_cues-&gt;length();
487 
488     while (1) {
489         ASSERT(searchStart &lt;= m_cues-&gt;length());
490         ASSERT(searchEnd &lt;= m_cues-&gt;length());
491 
492         RefPtr&lt;TextTrackCue&gt; existingCue;
493 
</pre>
</td>
<td>
<hr />
<pre>
220         setKind(Kind::Subtitles);
221     else {
222         // The invalid value default is the metadata state.
223         setKind(Kind::Metadata);
224     }
225 }
226 
227 void TextTrack::setMode(Mode mode)
228 {
229     // On setting, if the new value isn&#39;t equal to what the attribute would currently
230     // return, the new value must be processed as follows ...
231     if (m_mode == mode)
232         return;
233 
234     // If mode changes to disabled, remove this track&#39;s cues from the client
235     // because they will no longer be accessible from the cues() function.
236     if (mode == Mode::Disabled &amp;&amp; m_client &amp;&amp; m_cues)
237         m_client-&gt;textTrackRemoveCues(*this, *m_cues);
238 
239     if (mode != Mode::Showing &amp;&amp; m_cues) {
<span class="line-modified">240         for (size_t i = 0; i &lt; m_cues-&gt;length(); ++i)</span>
<span class="line-modified">241             m_cues-&gt;item(i)-&gt;removeDisplayTree();</span>



242     }
243 
244     m_mode = mode;
245 
246     if (m_client)
247         m_client-&gt;textTrackModeChanged(*this);
248 }
249 
250 TextTrackCueList* TextTrack::cues()
251 {
252     // 4.8.10.12.5 If the text track mode ... is not the text track disabled mode,
253     // then the cues attribute must return a live TextTrackCueList object ...
254     // Otherwise, it must return null. When an object is returned, the
255     // same object must be returned each time.
256     // http://www.whatwg.org/specs/web-apps/current-work/#dom-texttrack-cues
257     if (m_mode == Mode::Disabled)
258         return nullptr;
259     return &amp;ensureTextTrackCueList();
260 }
261 
</pre>
<hr />
<pre>
421 
422     // The cue may need to be repositioned in the media element&#39;s interval tree, may need to
423     // be re-rendered, etc, so remove it before the modification...
424     m_client-&gt;textTrackRemoveCue(*this, *cue);
425 }
426 
427 void TextTrack::cueDidChange(TextTrackCue* cue)
428 {
429     if (!m_client)
430         return;
431 
432     // Make sure the TextTrackCueList order is up-to-date.
433     ensureTextTrackCueList().updateCueIndex(*cue);
434 
435     // ... and add it back again.
436     m_client-&gt;textTrackAddCue(*this, *cue);
437 }
438 
439 int TextTrack::trackIndex()
440 {
<span class="line-modified">441     if (!m_trackIndex) {</span>
<span class="line-modified">442         if (!m_mediaElement)</span>
<span class="line-added">443             return 0;</span>
444         m_trackIndex = m_mediaElement-&gt;ensureTextTracks().getTrackIndex(*this);
<span class="line-added">445     }</span>
446     return m_trackIndex.value();
447 }
448 
449 void TextTrack::invalidateTrackIndex()
450 {
451     m_trackIndex = WTF::nullopt;
452     m_renderedTrackIndex = WTF::nullopt;
453 }
454 
455 bool TextTrack::isRendered()
456 {
457     return (m_kind == Kind::Captions || m_kind == Kind::Subtitles || m_kind == Kind::Forced)
458         &amp;&amp; m_mode == Mode::Showing;
459 }
460 
461 TextTrackCueList&amp; TextTrack::ensureTextTrackCueList()
462 {
463     if (!m_cues)
464         m_cues = TextTrackCueList::create();
465     return *m_cues;
466 }
467 
468 int TextTrack::trackIndexRelativeToRenderedTracks()
469 {
<span class="line-modified">470     if (!m_renderedTrackIndex) {</span>
<span class="line-modified">471         if (!m_mediaElement)</span>
<span class="line-added">472             return 0;</span>
473         m_renderedTrackIndex = m_mediaElement-&gt;ensureTextTracks().getTrackIndexRelativeToRenderedTracks(*this);
<span class="line-added">474     }</span>
475     return m_renderedTrackIndex.value();
476 }
477 
478 bool TextTrack::hasCue(TextTrackCue* cue, TextTrackCue::CueMatchRules match)
479 {
480     if (cue-&gt;startMediaTime() &lt; MediaTime::zeroTime() || cue-&gt;endMediaTime() &lt; MediaTime::zeroTime())
481         return false;
482 
483     if (!m_cues || !m_cues-&gt;length())
484         return false;
485 
486     size_t searchStart = 0;
487     size_t searchEnd = m_cues-&gt;length();
488 
489     while (1) {
490         ASSERT(searchStart &lt;= m_cues-&gt;length());
491         ASSERT(searchEnd &lt;= m_cues-&gt;length());
492 
493         RefPtr&lt;TextTrackCue&gt; existingCue;
494 
</pre>
</td>
</tr>
</table>
<center><a href="InbandTextTrack.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="TextTrackCue.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>