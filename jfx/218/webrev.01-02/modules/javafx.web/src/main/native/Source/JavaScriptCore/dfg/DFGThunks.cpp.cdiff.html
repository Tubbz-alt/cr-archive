<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGThunks.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DFGStructureAbstractValue.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGThunks.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGThunks.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 38,21 ***</span>
  #include &quot;JSCInlines.h&quot;
  #include &quot;DFGOSRExitCompilerCommon.h&quot;
  
  namespace JSC { namespace DFG {
  
<span class="line-removed">- MacroAssemblerCodeRef&lt;JITThunkPtrTag&gt; osrExitThunkGenerator(VM&amp; vm)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     MacroAssembler jit;</span>
<span class="line-removed">-     jit.probe(OSRExit::executeOSRExit, &amp;vm);</span>
<span class="line-removed">-     LinkBuffer patchBuffer(jit, GLOBAL_THUNK_ID);</span>
<span class="line-removed">-     return FINALIZE_CODE(patchBuffer, JITThunkPtrTag, &quot;DFG OSR exit thunk&quot;);</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  MacroAssemblerCodeRef&lt;JITThunkPtrTag&gt; osrExitGenerationThunkGenerator(VM&amp; vm)
  {
<span class="line-modified">!     MacroAssembler jit;</span>
  
      // This needs to happen before we use the scratch buffer because this function also uses the scratch buffer.
      adjustFrameAndStackInOSRExitCompilerThunk&lt;DFG::JITCode&gt;(jit, vm, JITType::DFGJIT);
  
      size_t scratchSize = sizeof(EncodedJSValue) * (GPRInfo::numberOfRegisters + FPRInfo::numberOfRegisters);
<span class="line-new-header">--- 38,13 ---</span>
  #include &quot;JSCInlines.h&quot;
  #include &quot;DFGOSRExitCompilerCommon.h&quot;
  
  namespace JSC { namespace DFG {
  
  MacroAssemblerCodeRef&lt;JITThunkPtrTag&gt; osrExitGenerationThunkGenerator(VM&amp; vm)
  {
<span class="line-modified">!     CCallHelpers jit(nullptr);</span>
  
      // This needs to happen before we use the scratch buffer because this function also uses the scratch buffer.
      adjustFrameAndStackInOSRExitCompilerThunk&lt;DFG::JITCode&gt;(jit, vm, JITType::DFGJIT);
  
      size_t scratchSize = sizeof(EncodedJSValue) * (GPRInfo::numberOfRegisters + FPRInfo::numberOfRegisters);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 74,15 ***</span>
      // Tell GC mark phase how much of the scratch buffer is active during call.
      jit.move(MacroAssembler::TrustedImmPtr(scratchBuffer-&gt;addressOfActiveLength()), GPRInfo::regT0);
      jit.storePtr(MacroAssembler::TrustedImmPtr(scratchSize), MacroAssembler::Address(GPRInfo::regT0));
  
      // Set up one argument.
<span class="line-removed">- #if CPU(X86)</span>
<span class="line-removed">-     jit.poke(GPRInfo::callFrameRegister, 0);</span>
<span class="line-removed">- #else</span>
      jit.move(GPRInfo::callFrameRegister, GPRInfo::argumentGPR0);
<span class="line-modified">! #endif</span>
  
      MacroAssembler::Call functionCall = jit.call(OperationPtrTag);
  
      jit.move(MacroAssembler::TrustedImmPtr(scratchBuffer-&gt;addressOfActiveLength()), GPRInfo::regT0);
      jit.storePtr(MacroAssembler::TrustedImmPtr(nullptr), MacroAssembler::Address(GPRInfo::regT0));
<span class="line-new-header">--- 66,12 ---</span>
      // Tell GC mark phase how much of the scratch buffer is active during call.
      jit.move(MacroAssembler::TrustedImmPtr(scratchBuffer-&gt;addressOfActiveLength()), GPRInfo::regT0);
      jit.storePtr(MacroAssembler::TrustedImmPtr(scratchSize), MacroAssembler::Address(GPRInfo::regT0));
  
      // Set up one argument.
      jit.move(GPRInfo::callFrameRegister, GPRInfo::argumentGPR0);
<span class="line-modified">!     jit.prepareCallOperation(vm);</span>
  
      MacroAssembler::Call functionCall = jit.call(OperationPtrTag);
  
      jit.move(MacroAssembler::TrustedImmPtr(scratchBuffer-&gt;addressOfActiveLength()), GPRInfo::regT0);
      jit.storePtr(MacroAssembler::TrustedImmPtr(nullptr), MacroAssembler::Address(GPRInfo::regT0));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 101,11 ***</span>
  
      jit.farJump(MacroAssembler::AbsoluteAddress(&amp;vm.osrExitJumpDestination), OSRExitPtrTag);
  
      LinkBuffer patchBuffer(jit, GLOBAL_THUNK_ID);
  
<span class="line-modified">!     patchBuffer.link(functionCall, FunctionPtr&lt;OperationPtrTag&gt;(OSRExit::compileOSRExit));</span>
  
      return FINALIZE_CODE(patchBuffer, JITThunkPtrTag, &quot;DFG OSR exit generation thunk&quot;);
  }
  
  MacroAssemblerCodeRef&lt;JITThunkPtrTag&gt; osrEntryThunkGenerator(VM&amp; vm)
<span class="line-new-header">--- 90,11 ---</span>
  
      jit.farJump(MacroAssembler::AbsoluteAddress(&amp;vm.osrExitJumpDestination), OSRExitPtrTag);
  
      LinkBuffer patchBuffer(jit, GLOBAL_THUNK_ID);
  
<span class="line-modified">!     patchBuffer.link(functionCall, FunctionPtr&lt;OperationPtrTag&gt;(operationCompileOSRExit));</span>
  
      return FINALIZE_CODE(patchBuffer, JITThunkPtrTag, &quot;DFG OSR exit generation thunk&quot;);
  }
  
  MacroAssemblerCodeRef&lt;JITThunkPtrTag&gt; osrEntryThunkGenerator(VM&amp; vm)
</pre>
<center><a href="DFGStructureAbstractValue.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGThunks.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>