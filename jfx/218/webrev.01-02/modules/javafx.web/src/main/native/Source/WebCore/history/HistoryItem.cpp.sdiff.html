<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/history/HistoryItem.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CachedPage.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HistoryItem.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/history/HistoryItem.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;HistoryItem.h&quot;
 28 

 29 #include &quot;CachedPage.h&quot;
 30 #include &quot;Document.h&quot;
 31 #include &quot;KeyedCoding.h&quot;
<span class="line-removed"> 32 #include &quot;PageCache.h&quot;</span>
 33 #include &quot;ResourceRequest.h&quot;
 34 #include &quot;SerializedScriptValue.h&quot;
 35 #include &quot;SharedBuffer.h&quot;
 36 #include &lt;stdio.h&gt;
 37 #include &lt;wtf/DateMath.h&gt;
 38 #include &lt;wtf/DebugUtilities.h&gt;
 39 #include &lt;wtf/WallTime.h&gt;
 40 #include &lt;wtf/text/CString.h&gt;
 41 
 42 namespace WebCore {
 43 
 44 int64_t HistoryItem::generateSequenceNumber()
 45 {
 46     // Initialize to the current time to reduce the likelihood of generating
 47     // identifiers that overlap with those from past/future browser sessions.
 48     static long long next = static_cast&lt;long long&gt;(WallTime::now().secondsSinceEpoch().microseconds());
 49     return ++next;
 50 }
 51 
 52 static void defaultNotifyHistoryItemChanged(HistoryItem&amp;)
</pre>
<hr />
<pre>
169 const String&amp; HistoryItem::originalURLString() const
170 {
171     return m_originalURLString;
172 }
173 
174 const String&amp; HistoryItem::title() const
175 {
176     return m_title;
177 }
178 
179 const String&amp; HistoryItem::alternateTitle() const
180 {
181     return m_displayTitle;
182 }
183 
184 bool HistoryItem::hasCachedPageExpired() const
185 {
186     return m_cachedPage ? m_cachedPage-&gt;hasExpired() : false;
187 }
188 
















189 URL HistoryItem::url() const
190 {
191     return URL({ }, m_urlString);
192 }
193 
194 URL HistoryItem::originalURL() const
195 {
196     return URL({ }, m_originalURLString);
197 }
198 
199 const String&amp; HistoryItem::referrer() const
200 {
201     return m_referrer;
202 }
203 
204 const String&amp; HistoryItem::target() const
205 {
206     return m_target;
207 }
208 
209 void HistoryItem::setAlternateTitle(const String&amp; alternateTitle)
210 {
211     m_displayTitle = alternateTitle;
212     notifyChanged();
213 }
214 
215 void HistoryItem::setURLString(const String&amp; urlString)
216 {
217     m_urlString = urlString;
218     notifyChanged();
219 }
220 
221 void HistoryItem::setURL(const URL&amp; url)
222 {
<span class="line-modified">223     PageCache::singleton().remove(*this);</span>
224     setURLString(url.string());
225     clearDocumentState();
226 }
227 
228 void HistoryItem::setOriginalURLString(const String&amp; urlString)
229 {
230     m_originalURLString = urlString;
231     notifyChanged();
232 }
233 
234 void HistoryItem::setReferrer(const String&amp; referrer)
235 {
236     m_referrer = referrer;
237     notifyChanged();
238 }
239 
240 void HistoryItem::setTitle(const String&amp; title)
241 {
242     m_title = title;
243     notifyChanged();
</pre>
</td>
<td>
<hr />
<pre>
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;HistoryItem.h&quot;
 28 
<span class="line-added"> 29 #include &quot;BackForwardCache.h&quot;</span>
 30 #include &quot;CachedPage.h&quot;
 31 #include &quot;Document.h&quot;
 32 #include &quot;KeyedCoding.h&quot;

 33 #include &quot;ResourceRequest.h&quot;
 34 #include &quot;SerializedScriptValue.h&quot;
 35 #include &quot;SharedBuffer.h&quot;
 36 #include &lt;stdio.h&gt;
 37 #include &lt;wtf/DateMath.h&gt;
 38 #include &lt;wtf/DebugUtilities.h&gt;
 39 #include &lt;wtf/WallTime.h&gt;
 40 #include &lt;wtf/text/CString.h&gt;
 41 
 42 namespace WebCore {
 43 
 44 int64_t HistoryItem::generateSequenceNumber()
 45 {
 46     // Initialize to the current time to reduce the likelihood of generating
 47     // identifiers that overlap with those from past/future browser sessions.
 48     static long long next = static_cast&lt;long long&gt;(WallTime::now().secondsSinceEpoch().microseconds());
 49     return ++next;
 50 }
 51 
 52 static void defaultNotifyHistoryItemChanged(HistoryItem&amp;)
</pre>
<hr />
<pre>
169 const String&amp; HistoryItem::originalURLString() const
170 {
171     return m_originalURLString;
172 }
173 
174 const String&amp; HistoryItem::title() const
175 {
176     return m_title;
177 }
178 
179 const String&amp; HistoryItem::alternateTitle() const
180 {
181     return m_displayTitle;
182 }
183 
184 bool HistoryItem::hasCachedPageExpired() const
185 {
186     return m_cachedPage ? m_cachedPage-&gt;hasExpired() : false;
187 }
188 
<span class="line-added">189 void HistoryItem::setCachedPage(std::unique_ptr&lt;CachedPage&gt;&amp;&amp; cachedPage)</span>
<span class="line-added">190 {</span>
<span class="line-added">191     bool wasInBackForwardCache = isInBackForwardCache();</span>
<span class="line-added">192     m_cachedPage = WTFMove(cachedPage);</span>
<span class="line-added">193     if (wasInBackForwardCache != isInBackForwardCache())</span>
<span class="line-added">194         notifyChanged();</span>
<span class="line-added">195 }</span>
<span class="line-added">196 </span>
<span class="line-added">197 std::unique_ptr&lt;CachedPage&gt; HistoryItem::takeCachedPage()</span>
<span class="line-added">198 {</span>
<span class="line-added">199     ASSERT(m_cachedPage);</span>
<span class="line-added">200     auto cachedPage = std::exchange(m_cachedPage, nullptr);</span>
<span class="line-added">201     notifyChanged();</span>
<span class="line-added">202     return cachedPage;</span>
<span class="line-added">203 }</span>
<span class="line-added">204 </span>
205 URL HistoryItem::url() const
206 {
207     return URL({ }, m_urlString);
208 }
209 
210 URL HistoryItem::originalURL() const
211 {
212     return URL({ }, m_originalURLString);
213 }
214 
215 const String&amp; HistoryItem::referrer() const
216 {
217     return m_referrer;
218 }
219 
220 const String&amp; HistoryItem::target() const
221 {
222     return m_target;
223 }
224 
225 void HistoryItem::setAlternateTitle(const String&amp; alternateTitle)
226 {
227     m_displayTitle = alternateTitle;
228     notifyChanged();
229 }
230 
231 void HistoryItem::setURLString(const String&amp; urlString)
232 {
233     m_urlString = urlString;
234     notifyChanged();
235 }
236 
237 void HistoryItem::setURL(const URL&amp; url)
238 {
<span class="line-modified">239     BackForwardCache::singleton().remove(*this);</span>
240     setURLString(url.string());
241     clearDocumentState();
242 }
243 
244 void HistoryItem::setOriginalURLString(const String&amp; urlString)
245 {
246     m_originalURLString = urlString;
247     notifyChanged();
248 }
249 
250 void HistoryItem::setReferrer(const String&amp; referrer)
251 {
252     m_referrer = referrer;
253     notifyChanged();
254 }
255 
256 void HistoryItem::setTitle(const String&amp; title)
257 {
258     m_title = title;
259     notifyChanged();
</pre>
</td>
</tr>
</table>
<center><a href="CachedPage.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HistoryItem.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>