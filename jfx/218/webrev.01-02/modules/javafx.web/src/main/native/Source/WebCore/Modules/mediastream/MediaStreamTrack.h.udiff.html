<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/Modules/mediastream/MediaStreamTrack.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MediaStreamTrack.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaStreamTrackEvent.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/mediastream/MediaStreamTrack.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -30,31 +30,32 @@</span>
  #if ENABLE(MEDIA_STREAM)
  
  #include &quot;ActiveDOMObject.h&quot;
  #include &quot;DoubleRange.h&quot;
  #include &quot;EventTarget.h&quot;
<span class="udiff-line-removed">- #include &quot;GenericTaskQueue.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;JSDOMPromiseDeferred.h&quot;</span>
  #include &quot;LongRange.h&quot;
  #include &quot;MediaProducer.h&quot;
  #include &quot;MediaStreamTrackPrivate.h&quot;
  #include &quot;MediaTrackConstraints.h&quot;
<span class="udiff-line-added">+ #include &quot;PlatformMediaSession.h&quot;</span>
  #include &lt;wtf/LoggerHelper.h&gt;
  
  namespace WebCore {
  
  class AudioSourceProvider;
  class Document;
  
  struct MediaTrackConstraints;
  
<span class="udiff-line-added">+ template&lt;typename IDLType&gt; class DOMPromiseDeferred;</span>
<span class="udiff-line-added">+ </span>
  class MediaStreamTrack
      : public RefCounted&lt;MediaStreamTrack&gt;
      , public ActiveDOMObject
      , public EventTargetWithInlineData
<span class="udiff-line-removed">-     , public MediaProducer</span>
      , private MediaStreamTrackPrivate::Observer
<span class="udiff-line-added">+     , private PlatformMediaSessionClient</span>
  #if !RELEASE_LOG_DISABLED
      , private LoggerHelper
  #endif
  {
      WTF_MAKE_ISO_ALLOCATED(MediaStreamTrack);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -68,14 +69,12 @@</span>
      static Ref&lt;MediaStreamTrack&gt; create(ScriptExecutionContext&amp;, Ref&lt;MediaStreamTrackPrivate&gt;&amp;&amp;);
      virtual ~MediaStreamTrack();
  
      static void endCapture(Document&amp;);
  
<span class="udiff-line-modified-removed">- #if PLATFORM(IOS_FAMILY)</span>
<span class="udiff-line-modified-removed">-     static MediaProducer::MediaStateFlags captureState();</span>
<span class="udiff-line-removed">-     static void muteCapture();</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-modified-added">+     static MediaProducer::MediaStateFlags captureState(Document&amp;);</span>
<span class="udiff-line-modified-added">+     static void updateCaptureAccordingToMutedState(Document&amp;);</span>
  
      virtual bool isCanvas() const { return false; }
  
      const AtomString&amp; kind() const;
      WEBCORE_EXPORT const String&amp; id() const;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -140,13 +139,11 @@</span>
      RealtimeMediaSource&amp; source() const { return m_private-&gt;source(); }
      MediaStreamTrackPrivate&amp; privateTrack() { return m_private.get(); }
  
      AudioSourceProvider* audioSourceProvider();
  
<span class="udiff-line-modified-removed">-     // MediaProducer</span>
<span class="udiff-line-removed">-     void pageMutedStateDidChange() final;</span>
<span class="udiff-line-removed">-     MediaProducer::MediaStateFlags mediaState() const final;</span>
<span class="udiff-line-modified-added">+     MediaProducer::MediaStateFlags mediaState() const;</span>
  
      void addObserver(Observer&amp;);
      void removeObserver(Observer&amp;);
  
      using RefCounted::ref;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -175,13 +172,13 @@</span>
      void configureTrackRendering();
  
      Document* document() const;
  
      // ActiveDOMObject API.
<span class="udiff-line-modified-removed">-     void stop() final;</span>
<span class="udiff-line-modified-removed">-     const char* activeDOMObjectName() const final;</span>
<span class="udiff-line-modified-removed">-     bool canSuspendForDocumentSuspension() const final;</span>
<span class="udiff-line-modified-added">+     void stop() final { stopTrack(); }</span>
<span class="udiff-line-modified-added">+     const char* activeDOMObjectName() const override;</span>
<span class="udiff-line-modified-added">+     void suspend(ReasonForSuspension) final;</span>
  
      // EventTarget
      void refEventTarget() final { ref(); }
      void derefEventTarget() final { deref(); }
      EventTargetInterface eventTargetInterface() const final { return MediaStreamTrackEventTargetInterfaceType; }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -191,24 +188,39 @@</span>
      void trackEnded(MediaStreamTrackPrivate&amp;) final;
      void trackMutedChanged(MediaStreamTrackPrivate&amp;) final;
      void trackSettingsChanged(MediaStreamTrackPrivate&amp;) final;
      void trackEnabledChanged(MediaStreamTrackPrivate&amp;) final;
  
<span class="udiff-line-added">+     // PlatformMediaSessionClient</span>
<span class="udiff-line-added">+     PlatformMediaSession::MediaType mediaType() const final;</span>
<span class="udiff-line-added">+     PlatformMediaSession::MediaType presentationType() const final;</span>
<span class="udiff-line-added">+     PlatformMediaSession::CharacteristicsFlags characteristics() const final;</span>
<span class="udiff-line-added">+     void mayResumePlayback(bool shouldResume) final;</span>
<span class="udiff-line-added">+     void suspendPlayback() final;</span>
<span class="udiff-line-added">+     bool canReceiveRemoteControlCommands() const final { return false; }</span>
<span class="udiff-line-added">+     void didReceiveRemoteControlCommand(PlatformMediaSession::RemoteControlCommandType, const PlatformMediaSession::RemoteCommandArgument*) final { }</span>
<span class="udiff-line-added">+     bool supportsSeeking() const final { return false; }</span>
<span class="udiff-line-added">+     bool shouldOverrideBackgroundPlaybackRestriction(PlatformMediaSession::InterruptionType) const final { return false; }</span>
<span class="udiff-line-added">+     String sourceApplicationIdentifier() const final;</span>
<span class="udiff-line-added">+     bool canProduceAudio() const final;</span>
<span class="udiff-line-added">+     Document* hostingDocument() const final { return document(); }</span>
<span class="udiff-line-added">+     bool processingUserGestureForMedia() const final;</span>
<span class="udiff-line-added">+     bool shouldOverridePauseDuringRouteChange() const final { return true; }</span>
<span class="udiff-line-added">+ </span>
  #if !RELEASE_LOG_DISABLED
      const char* logClassName() const final { return &quot;MediaStreamTrack&quot;; }
      WTFLogChannel&amp; logChannel() const final;
  #endif
  
      Vector&lt;Observer*&gt; m_observers;
  
      MediaTrackConstraints m_constraints;
<span class="udiff-line-modified-removed">-     Optional&lt;DOMPromiseDeferred&lt;void&gt;&gt; m_promise;</span>
<span class="udiff-line-removed">-     GenericTaskQueue&lt;ScriptExecutionContext&gt; m_taskQueue;</span>
<span class="udiff-line-removed">-     GenericTaskQueue&lt;Timer&gt; m_eventTaskQueue;</span>
<span class="udiff-line-modified-added">+     std::unique_ptr&lt;DOMPromiseDeferred&lt;void&gt;&gt; m_promise;</span>
  
      bool m_ended { false };
      const bool m_isCaptureTrack { false };
<span class="udiff-line-added">+     std::unique_ptr&lt;PlatformMediaSession&gt; m_mediaSession;</span>
  };
  
  typedef Vector&lt;RefPtr&lt;MediaStreamTrack&gt;&gt; MediaStreamTrackVector;
  
  } // namespace WebCore
</pre>
<center><a href="MediaStreamTrack.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaStreamTrackEvent.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>