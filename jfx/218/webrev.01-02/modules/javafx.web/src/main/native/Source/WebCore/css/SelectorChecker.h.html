<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/css/SelectorChecker.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 1999 Lars Knoll (knoll@kde.org)
  3  *           (C) 2004-2005 Allan Sandfeld Jensen (kde@carewolf.com)
  4  * Copyright (C) 2006, 2007 Nicholas Shanks (webkit@nickshanks.com)
  5  * Copyright (C) 2005-2016 Apple Inc. All rights reserved.
  6  * Copyright (C) 2007 Alexey Proskuryakov &lt;ap@webkit.org&gt;
  7  * Copyright (C) 2007, 2008 Eric Seidel &lt;eric@webkit.org&gt;
  8  * Copyright (C) 2008, 2009 Torch Mobile Inc. All rights reserved. (http://www.torchmobile.com/)
  9  * Copyright (c) 2011, Code Aurora Forum. All rights reserved.
 10  * Copyright (C) Research In Motion Limited 2011. All rights reserved.
 11  *
 12  * This library is free software; you can redistribute it and/or
 13  * modify it under the terms of the GNU Library General Public
 14  * License as published by the Free Software Foundation; either
 15  * version 2 of the License, or (at your option) any later version.
 16  *
 17  * This library is distributed in the hope that it will be useful,
 18  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 19  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 20  * Library General Public License for more details.
 21  *
 22  * You should have received a copy of the GNU Library General Public License
 23  * along with this library; see the file COPYING.LIB.  If not, write to
 24  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 25  * Boston, MA 02110-1301, USA.
 26  */
 27 
 28 #pragma once
 29 
 30 #include &quot;CSSSelector.h&quot;
 31 #include &quot;Element.h&quot;
 32 #include &quot;StyleRelations.h&quot;
 33 
 34 namespace WebCore {
 35 
 36 class CSSSelector;
 37 class Element;
 38 class RenderScrollbar;
 39 class RenderStyle;
 40 
 41 struct StyleScrollbarState {
 42     ScrollbarPart scrollbarPart { NoPart };
 43     ScrollbarPart hoveredPart { NoPart };
 44     ScrollbarPart pressedPart { NoPart };
 45     ScrollbarOrientation orientation { VerticalScrollbar };
 46     ScrollbarButtonsPlacement buttonsPlacement { ScrollbarButtonsNone };
 47     bool enabled { false };
 48     bool scrollCornerIsVisible { false };
 49 };
 50 
 51 class SelectorChecker {
 52     WTF_MAKE_NONCOPYABLE(SelectorChecker);
 53     enum class Match { SelectorMatches, SelectorFailsLocally, SelectorFailsAllSiblings, SelectorFailsCompletely };
 54 
 55     enum class MatchType { VirtualPseudoElementOnly, Element };
 56 
 57     struct MatchResult {
 58         Match match;
 59         MatchType matchType;
 60 
 61         static MatchResult matches(MatchType matchType)
 62         {
 63             return { Match::SelectorMatches, matchType };
 64         }
 65 
 66         static MatchResult updateWithMatchType(MatchResult result, MatchType matchType)
 67         {
 68             if (matchType == MatchType::VirtualPseudoElementOnly)
 69                 result.matchType = MatchType::VirtualPseudoElementOnly;
 70             return result;
 71         }
 72 
 73         static MatchResult fails(Match match)
 74         {
 75             return { match, MatchType::Element };
 76         }
 77     };
 78 
 79 public:
 80     enum class Mode : unsigned char {
 81         ResolvingStyle = 0, CollectingRules, CollectingRulesIgnoringVirtualPseudoElements, QueryingRules
 82     };
 83 
 84     SelectorChecker(Document&amp;);
 85 
 86     struct CheckingContext {
 87         CheckingContext(SelectorChecker::Mode resolvingMode)
 88             : resolvingMode(resolvingMode)
 89         { }
 90 
 91         const SelectorChecker::Mode resolvingMode;
 92         PseudoId pseudoId { PseudoId::None };
 93         Optional&lt;StyleScrollbarState&gt; scrollbarState;
 94         AtomString nameForHightlightPseudoElement;
 95         const ContainerNode* scope { nullptr };
 96         bool isMatchingHostPseudoClass { false };
 97         const Element* shadowHostInPartRuleScope { nullptr };
 98 
 99         // FIXME: It would be nicer to have a separate object for return values. This requires some more work in the selector compiler.
100         Style::Relations styleRelations;
101         PseudoIdSet pseudoIDSet;
102     };
103 
104     bool match(const CSSSelector&amp;, const Element&amp;, CheckingContext&amp;, unsigned&amp; specificity) const;
105 
106     bool matchHostPseudoClass(const CSSSelector&amp;, const Element&amp;, CheckingContext&amp;, unsigned&amp; specificity) const;
107 
108     static bool isCommonPseudoClassSelector(const CSSSelector*);
109     static bool matchesFocusPseudoClass(const Element&amp;);
110     static bool matchesDirectFocusPseudoClass(const Element&amp;);
111     static bool attributeSelectorMatches(const Element&amp;, const QualifiedName&amp;, const AtomString&amp; attributeValue, const CSSSelector&amp;);
112 
113     enum LinkMatchMask { MatchDefault = 0, MatchLink = 1, MatchVisited = 2, MatchAll = MatchLink | MatchVisited };
114     static unsigned determineLinkMatchType(const CSSSelector*);
115 
116     struct LocalContext;
117 
118 private:
119     MatchResult matchRecursively(CheckingContext&amp;, const LocalContext&amp;, PseudoIdSet&amp;, unsigned&amp; specificity) const;
120     bool checkOne(CheckingContext&amp;, const LocalContext&amp;, MatchType&amp;, unsigned&amp; specificity) const;
121     bool matchSelectorList(CheckingContext&amp;, const LocalContext&amp;, const Element&amp;, const CSSSelectorList&amp;, unsigned&amp; specificity) const;
122 
123     bool checkScrollbarPseudoClass(const CheckingContext&amp;, const Element&amp;, const CSSSelector&amp;) const;
124 
125     bool m_strictParsing;
126     bool m_documentIsHTML;
127 };
128 
129 inline bool SelectorChecker::isCommonPseudoClassSelector(const CSSSelector* selector)
130 {
131     if (selector-&gt;match() != CSSSelector::PseudoClass)
132         return false;
133     CSSSelector::PseudoClassType pseudoType = selector-&gt;pseudoClassType();
134     return pseudoType == CSSSelector::PseudoClassLink
135         || pseudoType == CSSSelector::PseudoClassAnyLink
136         || pseudoType == CSSSelector::PseudoClassAnyLinkDeprecated
137         || pseudoType == CSSSelector::PseudoClassVisited
138         || pseudoType == CSSSelector::PseudoClassFocus;
139 }
140 
141 } // namespace WebCore
    </pre>
  </body>
</html>