<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/FontPlatformData.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2006-2018 Apple Inc. All rights reserved.
  3  * Copyright (C) 2006 Michael Emmel mike.emmel@gmail.com
  4  * Copyright (C) 2007 Holger Hans Peter Freyther
  5  * Copyright (C) 2007 Pioneer Research Center USA, Inc.
  6  * Copyright (C) 2010, 2011 Brent Fulgham &lt;bfulgham@webkit.org&gt;
  7  *
  8  * This library is free software; you can redistribute it and/or
  9  * modify it under the terms of the GNU Library General Public
 10  * License as published by the Free Software Foundation; either
 11  * version 2 of the License, or (at your option) any later version.
 12  *
 13  * This library is distributed in the hope that it will be useful,
 14  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 15  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 16  * Library General Public License for more details.
 17  *
 18  * You should have received a copy of the GNU Library General Public License
 19  * along with this library; see the file COPYING.LIB.  If not, write to
 20  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 21  * Boston, MA 02110-1301, USA.
 22  *
 23  */
 24 
 25 #pragma once
 26 
 27 #include &quot;TextFlags.h&quot;
 28 #include &lt;wtf/Forward.h&gt;
 29 #include &lt;wtf/RetainPtr.h&gt;
 30 
 31 
 32 #if PLATFORM(WIN)
 33 #include &quot;COMPtr.h&quot;
 34 #include &quot;SharedGDIObject.h&quot;
 35 #endif
 36 
 37 #if USE(CAIRO)
 38 #include &quot;RefPtrCairo.h&quot;
 39 #endif
 40 
 41 #if USE(FREETYPE)
 42 #include &quot;FcUniquePtr.h&quot;
 43 #include &quot;HbUniquePtr.h&quot;
 44 #include &quot;RefPtrFontconfig.h&quot;
 45 #include &lt;memory&gt;
 46 #endif
 47 
 48 #if PLATFORM(JAVA)
 49 #include &quot;PlatformJavaClasses.h&quot;
 50 #include &quot;RQRef.h&quot;
 51 #endif
 52 
 53 #if USE(APPKIT)
 54 OBJC_CLASS NSFont;
 55 #endif
 56 
 57 #if PLATFORM(COCOA)
 58 typedef const struct __CTFont* CTFontRef;
 59 #endif
 60 
 61 #if USE(CG)
 62 #include &lt;CoreGraphics/CoreGraphics.h&gt;
 63 #endif
 64 
 65 #if PLATFORM(WIN)
 66 #include &lt;wtf/win/GDIObject.h&gt;
 67 typedef struct HFONT__* HFONT;
 68 interface IDWriteFont;
 69 interface IDWriteFontFace;
 70 #endif
 71 
 72 #if USE(DIRECT2D)
 73 #include &lt;dwrite_3.h&gt;
 74 #endif
 75 
 76 namespace WebCore {
 77 
 78 class FontDescription;
 79 class SharedBuffer;
 80 
 81 // This class is conceptually immutable. Once created, no instances should ever change (in an observable way).
 82 class FontPlatformData {
 83     WTF_MAKE_FAST_ALLOCATED;
 84 public:
 85     FontPlatformData(WTF::HashTableDeletedValueType);
 86     FontPlatformData();
 87 
 88     FontPlatformData(float size, bool syntheticBold, bool syntheticOblique, FontOrientation = FontOrientation::Horizontal, FontWidthVariant = FontWidthVariant::RegularWidth, TextRenderingMode = TextRenderingMode::AutoTextRendering);
 89 
 90 #if PLATFORM(COCOA)
 91     WEBCORE_EXPORT FontPlatformData(CTFontRef, float size, bool syntheticBold = false, bool syntheticOblique = false, FontOrientation = FontOrientation::Horizontal, FontWidthVariant = FontWidthVariant::RegularWidth, TextRenderingMode = TextRenderingMode::AutoTextRendering);
 92 #endif
 93 
 94     static FontPlatformData cloneWithOrientation(const FontPlatformData&amp;, FontOrientation);
 95     static FontPlatformData cloneWithSyntheticOblique(const FontPlatformData&amp;, bool);
 96     static FontPlatformData cloneWithSize(const FontPlatformData&amp;, float);
 97 
 98 #if USE(CG) &amp;&amp; PLATFORM(WIN)
 99     FontPlatformData(CGFontRef, float size, bool syntheticBold, bool syntheticOblique, FontOrientation, FontWidthVariant, TextRenderingMode);
100 #endif
101 
102 #if PLATFORM(WIN)
103     FontPlatformData(GDIObject&lt;HFONT&gt;, float size, bool syntheticBold, bool syntheticOblique, bool useGDI);
104 #endif
105 
106 #if PLATFORM(WIN) &amp;&amp; USE(CG)
107     FontPlatformData(GDIObject&lt;HFONT&gt;, CGFontRef, float size, bool syntheticBold, bool syntheticOblique, bool useGDI);
108 #endif
109 
110 #if PLATFORM(WIN) &amp;&amp; USE(DIRECT2D)
<a name="1" id="anc1"></a><span class="line-modified">111     FontPlatformData(GDIObject&lt;HFONT&gt;&amp;&amp;, COMPtr&lt;IDWriteFont&gt;&amp;&amp;, float size, bool syntheticBold, bool syntheticOblique, bool useGDI);</span>
112 #endif
113 
114 #if PLATFORM(WIN) &amp;&amp; USE(CAIRO)
115     FontPlatformData(GDIObject&lt;HFONT&gt;, cairo_font_face_t*, float size, bool bold, bool italic);
116 #endif
117 
118 #if USE(FREETYPE)
<a name="2" id="anc2"></a><span class="line-modified">119     FontPlatformData(cairo_font_face_t*, RefPtr&lt;FcPattern&gt;&amp;&amp;, float size, bool fixedWidth, bool syntheticBold, bool syntheticOblique, FontOrientation);</span>
120 #endif
121 
122 #if PLATFORM(JAVA)
123     FontPlatformData(RefPtr&lt;RQRef&gt; font, float size);
124     static std::unique_ptr&lt;FontPlatformData&gt; create(const FontDescription&amp; fontDescription, const AtomString&amp; family);
125     std::unique_ptr&lt;FontPlatformData&gt; derive(float scaleFactor) const;
126 #endif
127 
128 #if PLATFORM(WIN)
129     HFONT hfont() const { return m_font ? m_font-&gt;get() : 0; }
130     bool useGDI() const { return m_useGDI; }
131 #endif
132 
133 #if PLATFORM(COCOA)
134     CTFontRef font() const { return m_font.get(); }
135     WEBCORE_EXPORT CTFontRef registeredFont() const; // Returns nullptr iff the font is not registered, such as web fonts (otherwise returns font()).
136 
137     CTFontRef ctFont() const;
138     static RetainPtr&lt;CFTypeRef&gt; objectForEqualityCheck(CTFontRef);
139     RetainPtr&lt;CFTypeRef&gt; objectForEqualityCheck() const;
140 
141     bool hasCustomTracking() const { return isSystemFont(); }
142 #endif
143 
144 #if PLATFORM(WIN) || PLATFORM(COCOA)
145     bool isSystemFont() const { return m_isSystemFont; }
146 #endif
147 
148     bool hasVariations() const { return m_hasVariations; }
149 
150 #if USE(CG) &amp;&amp; PLATFORM(WIN)
151     CGFontRef cgFont() const { return m_cgFont.get(); }
152 #endif
153 
154 #if USE(DIRECT2D)
155     IDWriteFont* dwFont() const { return m_dwFont.get(); }
156     IDWriteFontFace* dwFontFace() const { return m_dwFontFace.get(); }
<a name="3" id="anc3"></a>


157 #endif
158 
159     bool isFixedPitch() const;
160     float size() const { return m_size; }
161     bool syntheticBold() const { return m_syntheticBold; }
162     bool syntheticOblique() const { return m_syntheticOblique; }
163     bool isColorBitmapFont() const { return m_isColorBitmapFont; }
164     FontOrientation orientation() const { return m_orientation; }
165     FontWidthVariant widthVariant() const { return m_widthVariant; }
166     TextRenderingMode textRenderingMode() const { return m_textRenderingMode; }
167     bool isForTextCombine() const { return widthVariant() != FontWidthVariant::RegularWidth; } // Keep in sync with callers of FontDescription::setWidthVariant().
168 
169 #if USE(CAIRO)
170     cairo_scaled_font_t* scaledFont() const { return m_scaledFont.get(); }
171 #endif
172 
173 #if USE(FREETYPE)
174 #if USE(HARFBUZZ) &amp;&amp; !ENABLE(OPENTYPE_MATH)
175     HbUniquePtr&lt;hb_font_t&gt; createOpenTypeMathHarfBuzzFont() const;
176 #endif
177     bool hasCompatibleCharmap() const;
178     FcPattern* fcPattern() const;
179     bool isFixedWidth() const { return m_fixedWidth; }
180 #endif
181 
182 #if PLATFORM(JAVA)
183     RefPtr&lt;RQRef&gt; nativeFontData() const { return m_jFont; }
184 #endif
185 
186     unsigned hash() const;
187 
188     bool operator==(const FontPlatformData&amp; other) const
189     {
190         return platformIsEqual(other)
191             &amp;&amp; m_isHashTableDeletedValue == other.m_isHashTableDeletedValue
192             &amp;&amp; m_size == other.m_size
193             &amp;&amp; m_syntheticBold == other.m_syntheticBold
194             &amp;&amp; m_syntheticOblique == other.m_syntheticOblique
195             &amp;&amp; m_isColorBitmapFont == other.m_isColorBitmapFont
196             &amp;&amp; m_orientation == other.m_orientation
197             &amp;&amp; m_widthVariant == other.m_widthVariant
198             &amp;&amp; m_textRenderingMode == other.m_textRenderingMode;
199     }
200 
201     bool isHashTableDeletedValue() const
202     {
203         return m_isHashTableDeletedValue;
204     }
205 
206     bool isEmoji() const
207     {
208 #if PLATFORM(IOS_FAMILY)
209         return m_isEmoji;
210 #else
211         return false;
212 #endif
213     }
214 
215 #if PLATFORM(COCOA) || PLATFORM(WIN) || USE(FREETYPE)
216     RefPtr&lt;SharedBuffer&gt; openTypeTable(uint32_t table) const;
217 #endif
218 
219 #if !LOG_DISABLED
220     String description() const;
221 #endif
222 
223 private:
224     bool platformIsEqual(const FontPlatformData&amp;) const;
225 
226 #if PLATFORM(COCOA)
227     CGFloat ctFontSize() const;
228 #endif
229 
230 #if PLATFORM(WIN)
231     void platformDataInit(HFONT, float size, HDC, WCHAR* faceName);
232 #endif
233 
234 #if USE(FREETYPE)
235     void buildScaledFont(cairo_font_face_t*);
236 #endif
237 
238 #if PLATFORM(COCOA)
239     // FIXME: Get rid of one of these. These two fonts are subtly different, and it is not obvious which one to use where.
240     RetainPtr&lt;CTFontRef&gt; m_font;
241     mutable RetainPtr&lt;CTFontRef&gt; m_ctFont;
242 #elif PLATFORM(WIN)
243     RefPtr&lt;SharedGDIObject&lt;HFONT&gt;&gt; m_font;
244 #endif
245 
246 #if USE(CG) &amp;&amp; PLATFORM(WIN)
247     RetainPtr&lt;CGFontRef&gt; m_cgFont;
248 #endif
249 
250 #if USE(DIRECT2D)
251     COMPtr&lt;IDWriteFont&gt; m_dwFont;
252     COMPtr&lt;IDWriteFontFace&gt; m_dwFontFace;
253 #endif
254 
255 #if USE(CAIRO)
256     RefPtr&lt;cairo_scaled_font_t&gt; m_scaledFont;
257 #endif
258 
259 #if USE(FREETYPE)
260     RefPtr&lt;FcPattern&gt; m_pattern;
261 #endif
262 
263 #if PLATFORM(JAVA)
264     RefPtr&lt;RQRef&gt; m_jFont;
265 #endif
266 
267     // The values below are common to all ports
268     // FIXME: If they&#39;re common to all ports, they should move to Font
269     float m_size { 0 };
270 
271     FontOrientation m_orientation { FontOrientation::Horizontal };
272     FontWidthVariant m_widthVariant { FontWidthVariant::RegularWidth };
273     TextRenderingMode m_textRenderingMode { TextRenderingMode::AutoTextRendering };
274 
275     bool m_syntheticBold { false };
276     bool m_syntheticOblique { false };
277     bool m_isColorBitmapFont { false };
278     bool m_isHashTableDeletedValue { false };
279     bool m_isSystemFont { false };
280     bool m_hasVariations { false };
281     // The values above are common to all ports
282 
283 #if PLATFORM(IOS_FAMILY)
284     bool m_isEmoji { false };
285 #endif
286 
287 #if PLATFORM(WIN)
288     bool m_useGDI { false };
289 #endif
290 
291 #if USE(FREETYPE)
292     bool m_fixedWidth { false };
293 #endif
294 };
295 
296 #if USE(APPKIT) &amp;&amp; defined(__OBJC__)
297 
298 // NSFonts and CTFontRefs are toll-free-bridged.
299 inline CTFontRef toCTFont(NSFont *font)
300 {
301     return (__bridge CTFontRef)font;
302 }
303 
304 inline NSFont *toNSFont(CTFontRef font)
305 {
306     return (__bridge NSFont *)font;
307 }
308 
309 #endif
310 
311 #if USE(CG)
312 
313 class ScopedTextMatrix {
314 public:
315     ScopedTextMatrix(CGAffineTransform newMatrix, CGContextRef context)
316         : m_context(context)
317         , m_textMatrix(CGContextGetTextMatrix(context))
318     {
319         CGContextSetTextMatrix(m_context, newMatrix);
320     }
321 
322     ~ScopedTextMatrix()
323     {
324         CGContextSetTextMatrix(m_context, m_textMatrix);
325     }
326 
327     CGAffineTransform savedMatrix() const
328     {
329         return m_textMatrix;
330     }
331 
332 private:
333     CGContextRef m_context;
334     CGAffineTransform m_textMatrix;
335 };
336 
337 #endif
338 
339 } // namespace WebCore
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>