<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMBindingSecurity.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSDOMBindingInternals.js.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSDOMBindingSecurity.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMBindingSecurity.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 40,29 ***</span>
      if (!frame)
          return;
      frame-&gt;document()-&gt;domWindow()-&gt;printErrorMessage(message);
  }
  
<span class="line-modified">! static inline bool canAccessDocument(JSC::ExecState* state, Document* targetDocument, SecurityReportingOption reportingOption)</span>
  {
<span class="line-modified">!     VM&amp; vm = state-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      if (!targetDocument)
          return false;
  
      if (auto* templateHost = targetDocument-&gt;templateDocumentHost())
          targetDocument = templateHost;
  
<span class="line-modified">!     DOMWindow&amp; active = activeDOMWindow(*state);</span>
  
      if (active.document()-&gt;securityOrigin().canAccess(targetDocument-&gt;securityOrigin()))
          return true;
  
      switch (reportingOption) {
      case ThrowSecurityError:
<span class="line-modified">!         throwSecurityError(*state, scope, targetDocument-&gt;domWindow()-&gt;crossDomainAccessErrorMessage(active, IncludeTargetOrigin::No));</span>
          break;
      case LogSecurityError:
          printErrorMessageForFrame(targetDocument-&gt;frame(), targetDocument-&gt;domWindow()-&gt;crossDomainAccessErrorMessage(active, IncludeTargetOrigin::Yes));
          break;
      case DoNotReportSecurityError:
<span class="line-new-header">--- 40,29 ---</span>
      if (!frame)
          return;
      frame-&gt;document()-&gt;domWindow()-&gt;printErrorMessage(message);
  }
  
<span class="line-modified">! static inline bool canAccessDocument(JSC::JSGlobalObject* lexicalGlobalObject, Document* targetDocument, SecurityReportingOption reportingOption)</span>
  {
<span class="line-modified">!     VM&amp; vm = lexicalGlobalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      if (!targetDocument)
          return false;
  
      if (auto* templateHost = targetDocument-&gt;templateDocumentHost())
          targetDocument = templateHost;
  
<span class="line-modified">!     DOMWindow&amp; active = activeDOMWindow(*lexicalGlobalObject);</span>
  
      if (active.document()-&gt;securityOrigin().canAccess(targetDocument-&gt;securityOrigin()))
          return true;
  
      switch (reportingOption) {
      case ThrowSecurityError:
<span class="line-modified">!         throwSecurityError(*lexicalGlobalObject, scope, targetDocument-&gt;domWindow()-&gt;crossDomainAccessErrorMessage(active, IncludeTargetOrigin::No));</span>
          break;
      case LogSecurityError:
          printErrorMessageForFrame(targetDocument-&gt;frame(), targetDocument-&gt;domWindow()-&gt;crossDomainAccessErrorMessage(active, IncludeTargetOrigin::Yes));
          break;
      case DoNotReportSecurityError:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 70,47 ***</span>
      }
  
      return false;
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToFrame(ExecState&amp; state, Frame&amp; frame, String&amp; message)</span>
  {
<span class="line-modified">!     if (BindingSecurity::shouldAllowAccessToFrame(&amp;state, &amp;frame, DoNotReportSecurityError))</span>
          return true;
<span class="line-modified">!     message = frame.document()-&gt;domWindow()-&gt;crossDomainAccessErrorMessage(activeDOMWindow(state), IncludeTargetOrigin::No);</span>
      return false;
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToDOMWindow(ExecState&amp; state, DOMWindow* globalObject, String&amp; message)</span>
  {
<span class="line-modified">!     return globalObject &amp;&amp; shouldAllowAccessToDOMWindow(state, *globalObject, message);</span>
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToDOMWindow(ExecState&amp; state, DOMWindow&amp; globalObject, String&amp; message)</span>
  {
<span class="line-modified">!     if (BindingSecurity::shouldAllowAccessToDOMWindow(&amp;state, globalObject, DoNotReportSecurityError))</span>
          return true;
<span class="line-modified">!     message = globalObject.crossDomainAccessErrorMessage(activeDOMWindow(state), IncludeTargetOrigin::No);</span>
      return false;
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToDOMWindow(JSC::ExecState* state, DOMWindow&amp; target, SecurityReportingOption reportingOption)</span>
  {
<span class="line-modified">!     return canAccessDocument(state, target.document(), reportingOption);</span>
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToDOMWindow(JSC::ExecState* state, DOMWindow* target, SecurityReportingOption reportingOption)</span>
  {
<span class="line-modified">!     return target &amp;&amp; shouldAllowAccessToDOMWindow(state, *target, reportingOption);</span>
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToFrame(JSC::ExecState* state, Frame* target, SecurityReportingOption reportingOption)</span>
  {
<span class="line-modified">!     return target &amp;&amp; canAccessDocument(state, target-&gt;document(), reportingOption);</span>
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToNode(JSC::ExecState&amp; state, Node* target)</span>
  {
<span class="line-modified">!     return !target || canAccessDocument(&amp;state, &amp;target-&gt;document(), LogSecurityError);</span>
  }
  
  } // namespace WebCore
<span class="line-new-header">--- 70,47 ---</span>
      }
  
      return false;
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToFrame(JSGlobalObject&amp; lexicalGlobalObject, Frame&amp; frame, String&amp; message)</span>
  {
<span class="line-modified">!     if (BindingSecurity::shouldAllowAccessToFrame(&amp;lexicalGlobalObject, &amp;frame, DoNotReportSecurityError))</span>
          return true;
<span class="line-modified">!     message = frame.document()-&gt;domWindow()-&gt;crossDomainAccessErrorMessage(activeDOMWindow(lexicalGlobalObject), IncludeTargetOrigin::No);</span>
      return false;
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToDOMWindow(JSGlobalObject&amp; lexicalGlobalObject, DOMWindow* globalObject, String&amp; message)</span>
  {
<span class="line-modified">!     return globalObject &amp;&amp; shouldAllowAccessToDOMWindow(lexicalGlobalObject, *globalObject, message);</span>
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToDOMWindow(JSGlobalObject&amp; lexicalGlobalObject, DOMWindow&amp; globalObject, String&amp; message)</span>
  {
<span class="line-modified">!     if (BindingSecurity::shouldAllowAccessToDOMWindow(&amp;lexicalGlobalObject, globalObject, DoNotReportSecurityError))</span>
          return true;
<span class="line-modified">!     message = globalObject.crossDomainAccessErrorMessage(activeDOMWindow(lexicalGlobalObject), IncludeTargetOrigin::No);</span>
      return false;
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToDOMWindow(JSC::JSGlobalObject* lexicalGlobalObject, DOMWindow&amp; target, SecurityReportingOption reportingOption)</span>
  {
<span class="line-modified">!     return canAccessDocument(lexicalGlobalObject, target.document(), reportingOption);</span>
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToDOMWindow(JSC::JSGlobalObject* lexicalGlobalObject, DOMWindow* target, SecurityReportingOption reportingOption)</span>
  {
<span class="line-modified">!     return target &amp;&amp; shouldAllowAccessToDOMWindow(lexicalGlobalObject, *target, reportingOption);</span>
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToFrame(JSC::JSGlobalObject* lexicalGlobalObject, Frame* target, SecurityReportingOption reportingOption)</span>
  {
<span class="line-modified">!     return target &amp;&amp; canAccessDocument(lexicalGlobalObject, target-&gt;document(), reportingOption);</span>
  }
  
<span class="line-modified">! bool BindingSecurity::shouldAllowAccessToNode(JSC::JSGlobalObject&amp; lexicalGlobalObject, Node* target)</span>
  {
<span class="line-modified">!     return !target || canAccessDocument(&amp;lexicalGlobalObject, &amp;target-&gt;document(), LogSecurityError);</span>
  }
  
  } // namespace WebCore
</pre>
<center><a href="JSDOMBindingInternals.js.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSDOMBindingSecurity.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>