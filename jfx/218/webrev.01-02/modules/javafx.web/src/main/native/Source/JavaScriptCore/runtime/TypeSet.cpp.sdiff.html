<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/TypeSet.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TypeProfilerLog.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="TypedArrayAdaptors.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/TypeSet.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
480     json.appendLiteral(&quot;\&quot;proto\&quot;:&quot;);
481     if (m_proto)
482         json.append(m_proto-&gt;toJSONString());
483     else
484         json.appendLiteral(&quot;null&quot;);
485 
486     json.append(&#39;}&#39;);
487 
488     return json.toString();
489 }
490 
491 Ref&lt;Inspector::Protocol::Runtime::StructureDescription&gt; StructureShape::inspectorRepresentation()
492 {
493     auto base = Inspector::Protocol::Runtime::StructureDescription::create().release();
494     Ref&lt;Inspector::Protocol::Runtime::StructureDescription&gt; currentObject = base.copyRef();
495     RefPtr&lt;StructureShape&gt; currentShape(this);
496 
497     while (currentShape) {
498         auto fields = JSON::ArrayOf&lt;String&gt;::create();
499         auto optionalFields = JSON::ArrayOf&lt;String&gt;::create();
<span class="line-modified">500         for (auto field : currentShape-&gt;m_fields)</span>
501             fields-&gt;addItem(field.get());
<span class="line-modified">502         for (auto field : currentShape-&gt;m_optionalFields)</span>
503             optionalFields-&gt;addItem(field.get());
504 
505         currentObject-&gt;setFields(&amp;fields.get());
506         currentObject-&gt;setOptionalFields(&amp;optionalFields.get());
507         currentObject-&gt;setConstructorName(currentShape-&gt;m_constructorName);
508         currentObject-&gt;setIsImprecise(currentShape-&gt;m_isInDictionaryMode);
509 
510         if (currentShape-&gt;m_proto) {
511             auto nextObject = Inspector::Protocol::Runtime::StructureDescription::create().release();
512             currentObject-&gt;setPrototypeStructure(&amp;nextObject.get());
513             currentObject = WTFMove(nextObject);
514         }
515 
516         currentShape = currentShape-&gt;m_proto;
517     }
518 
519     return base;
520 }
521 
522 bool StructureShape::hasSamePrototypeChain(const StructureShape&amp; otherRef)
523 {
524     const StructureShape* self = this;
525     const StructureShape* other = &amp;otherRef;
526     while (self &amp;&amp; other) {
527         if (self-&gt;m_constructorName != other-&gt;m_constructorName)
528             return false;
529         self = self-&gt;m_proto.get();
530         other = other-&gt;m_proto.get();
531     }
532 
533     return !self &amp;&amp; !other;
534 }
535 
536 Ref&lt;StructureShape&gt; StructureShape::merge(Ref&lt;StructureShape&gt;&amp;&amp; a, Ref&lt;StructureShape&gt;&amp;&amp; b)
537 {
538     ASSERT(a-&gt;hasSamePrototypeChain(b.get()));
539 
540     auto merged = StructureShape::create();
<span class="line-modified">541     for (auto field : a-&gt;m_fields) {</span>
542         if (b-&gt;m_fields.contains(field))
543             merged-&gt;m_fields.add(field);
544         else
545             merged-&gt;m_optionalFields.add(field);
546     }
547 
<span class="line-modified">548     for (auto field : b-&gt;m_fields) {</span>
549         if (!merged-&gt;m_fields.contains(field)) {
550             auto addResult = merged-&gt;m_optionalFields.add(field);
551             ASSERT_UNUSED(addResult, addResult.isNewEntry);
552         }
553     }
554 
<span class="line-modified">555     for (auto field : a-&gt;m_optionalFields)</span>
556         merged-&gt;m_optionalFields.add(field);
<span class="line-modified">557     for (auto field : b-&gt;m_optionalFields)</span>
558         merged-&gt;m_optionalFields.add(field);
559 
560     ASSERT(a-&gt;m_constructorName == b-&gt;m_constructorName);
561     merged-&gt;setConstructorName(a-&gt;m_constructorName);
562 
563     if (a-&gt;m_proto) {
564         RELEASE_ASSERT(b-&gt;m_proto);
565         merged-&gt;setProto(StructureShape::merge(*a-&gt;m_proto, *b-&gt;m_proto));
566     }
567 
568     merged-&gt;markAsFinal();
569 
570     return merged;
571 }
572 
573 void StructureShape::enterDictionaryMode()
574 {
575     m_isInDictionaryMode = true;
576 }
577 
</pre>
</td>
<td>
<hr />
<pre>
480     json.appendLiteral(&quot;\&quot;proto\&quot;:&quot;);
481     if (m_proto)
482         json.append(m_proto-&gt;toJSONString());
483     else
484         json.appendLiteral(&quot;null&quot;);
485 
486     json.append(&#39;}&#39;);
487 
488     return json.toString();
489 }
490 
491 Ref&lt;Inspector::Protocol::Runtime::StructureDescription&gt; StructureShape::inspectorRepresentation()
492 {
493     auto base = Inspector::Protocol::Runtime::StructureDescription::create().release();
494     Ref&lt;Inspector::Protocol::Runtime::StructureDescription&gt; currentObject = base.copyRef();
495     RefPtr&lt;StructureShape&gt; currentShape(this);
496 
497     while (currentShape) {
498         auto fields = JSON::ArrayOf&lt;String&gt;::create();
499         auto optionalFields = JSON::ArrayOf&lt;String&gt;::create();
<span class="line-modified">500         for (const auto&amp; field : currentShape-&gt;m_fields)</span>
501             fields-&gt;addItem(field.get());
<span class="line-modified">502         for (const auto&amp; field : currentShape-&gt;m_optionalFields)</span>
503             optionalFields-&gt;addItem(field.get());
504 
505         currentObject-&gt;setFields(&amp;fields.get());
506         currentObject-&gt;setOptionalFields(&amp;optionalFields.get());
507         currentObject-&gt;setConstructorName(currentShape-&gt;m_constructorName);
508         currentObject-&gt;setIsImprecise(currentShape-&gt;m_isInDictionaryMode);
509 
510         if (currentShape-&gt;m_proto) {
511             auto nextObject = Inspector::Protocol::Runtime::StructureDescription::create().release();
512             currentObject-&gt;setPrototypeStructure(&amp;nextObject.get());
513             currentObject = WTFMove(nextObject);
514         }
515 
516         currentShape = currentShape-&gt;m_proto;
517     }
518 
519     return base;
520 }
521 
522 bool StructureShape::hasSamePrototypeChain(const StructureShape&amp; otherRef)
523 {
524     const StructureShape* self = this;
525     const StructureShape* other = &amp;otherRef;
526     while (self &amp;&amp; other) {
527         if (self-&gt;m_constructorName != other-&gt;m_constructorName)
528             return false;
529         self = self-&gt;m_proto.get();
530         other = other-&gt;m_proto.get();
531     }
532 
533     return !self &amp;&amp; !other;
534 }
535 
536 Ref&lt;StructureShape&gt; StructureShape::merge(Ref&lt;StructureShape&gt;&amp;&amp; a, Ref&lt;StructureShape&gt;&amp;&amp; b)
537 {
538     ASSERT(a-&gt;hasSamePrototypeChain(b.get()));
539 
540     auto merged = StructureShape::create();
<span class="line-modified">541     for (const auto&amp; field : a-&gt;m_fields) {</span>
542         if (b-&gt;m_fields.contains(field))
543             merged-&gt;m_fields.add(field);
544         else
545             merged-&gt;m_optionalFields.add(field);
546     }
547 
<span class="line-modified">548     for (const auto&amp; field : b-&gt;m_fields) {</span>
549         if (!merged-&gt;m_fields.contains(field)) {
550             auto addResult = merged-&gt;m_optionalFields.add(field);
551             ASSERT_UNUSED(addResult, addResult.isNewEntry);
552         }
553     }
554 
<span class="line-modified">555     for (const auto&amp; field : a-&gt;m_optionalFields)</span>
556         merged-&gt;m_optionalFields.add(field);
<span class="line-modified">557     for (const auto&amp; field : b-&gt;m_optionalFields)</span>
558         merged-&gt;m_optionalFields.add(field);
559 
560     ASSERT(a-&gt;m_constructorName == b-&gt;m_constructorName);
561     merged-&gt;setConstructorName(a-&gt;m_constructorName);
562 
563     if (a-&gt;m_proto) {
564         RELEASE_ASSERT(b-&gt;m_proto);
565         merged-&gt;setProto(StructureShape::merge(*a-&gt;m_proto, *b-&gt;m_proto));
566     }
567 
568     merged-&gt;markAsFinal();
569 
570     return merged;
571 }
572 
573 void StructureShape::enterDictionaryMode()
574 {
575     m_isInDictionaryMode = true;
576 }
577 
</pre>
</td>
</tr>
</table>
<center><a href="TypeProfilerLog.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="TypedArrayAdaptors.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>