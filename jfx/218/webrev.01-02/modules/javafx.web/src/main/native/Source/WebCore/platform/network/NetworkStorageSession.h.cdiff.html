<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/network/NetworkStorageSession.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="NetworkStorageSession.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ParsedContentType.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/network/NetworkStorageSession.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 28,10 ***</span>
<span class="line-new-header">--- 28,11 ---</span>
  #include &quot;CredentialStorage.h&quot;
  #include &quot;FrameIdentifier.h&quot;
  #include &quot;PageIdentifier.h&quot;
  #include &quot;RegistrableDomain.h&quot;
  #include &lt;pal/SessionID.h&gt;
<span class="line-added">+ #include &lt;wtf/CompletionHandler.h&gt;</span>
  #include &lt;wtf/Function.h&gt;
  #include &lt;wtf/HashMap.h&gt;
  #include &lt;wtf/HashSet.h&gt;
  #include &lt;wtf/WallTime.h&gt;
  #include &lt;wtf/text/WTFString.h&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 69,12 ***</span>
<span class="line-new-header">--- 70,16 ---</span>
  
  struct Cookie;
  struct CookieRequestHeaderFieldProxy;
  struct SameSiteInfo;
  
<span class="line-added">+ enum class HTTPCookieAcceptPolicy : uint8_t;</span>
  enum class IncludeSecureCookies : bool;
  enum class IncludeHttpOnlyCookies : bool;
<span class="line-added">+ enum class ThirdPartyCookieBlockingMode : uint8_t { All, AllOnSitesWithoutUserInteraction, OnlyAccordingToPerDomainPolicy };</span>
<span class="line-added">+ enum class FirstPartyWebsiteDataRemovalMode : uint8_t { AllButCookies, None, AllButCookiesLiveOnTestingTimeout, AllButCookiesReproTestingTimeout };</span>
<span class="line-added">+ enum class ShouldAskITP : bool { No, Yes };</span>
  
  class NetworkStorageSession {
      WTF_MAKE_NONCOPYABLE(NetworkStorageSession); WTF_MAKE_FAST_ALLOCATED;
  public:
      WEBCORE_EXPORT static void permitProcessToUseCookieAPI(bool);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 122,36 ***</span>
      ~NetworkStorageSession();
  
      NetworkingContext* context() const;
  #endif
  
<span class="line-modified">!     WEBCORE_EXPORT bool cookiesEnabled() const;</span>
      WEBCORE_EXPORT void setCookie(const Cookie&amp;);
      WEBCORE_EXPORT void setCookies(const Vector&lt;Cookie&gt;&amp;, const URL&amp;, const URL&amp; mainDocumentURL);
<span class="line-modified">!     WEBCORE_EXPORT void setCookiesFromDOM(const URL&amp; firstParty, const SameSiteInfo&amp;, const URL&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, const String&amp;) const;</span>
      WEBCORE_EXPORT void deleteCookie(const Cookie&amp;);
      WEBCORE_EXPORT void deleteCookie(const URL&amp;, const String&amp;) const;
      WEBCORE_EXPORT void deleteAllCookies();
      WEBCORE_EXPORT void deleteAllCookiesModifiedSince(WallTime);
      WEBCORE_EXPORT void deleteCookiesForHostnames(const Vector&lt;String&gt;&amp; cookieHostNames);
      WEBCORE_EXPORT void deleteCookiesForHostnames(const Vector&lt;String&gt;&amp; cookieHostNames, IncludeHttpOnlyCookies);
      WEBCORE_EXPORT Vector&lt;Cookie&gt; getAllCookies();
      WEBCORE_EXPORT Vector&lt;Cookie&gt; getCookies(const URL&amp;);
<span class="line-modified">!     WEBCORE_EXPORT bool getRawCookies(const URL&amp; firstParty, const SameSiteInfo&amp;, const URL&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, Vector&lt;Cookie&gt;&amp;) const;</span>
      WEBCORE_EXPORT void flushCookieStore();
      WEBCORE_EXPORT void getHostnamesWithCookies(HashSet&lt;String&gt;&amp; hostnames);
<span class="line-modified">!     WEBCORE_EXPORT std::pair&lt;String, bool&gt; cookiesForDOM(const URL&amp; firstParty, const SameSiteInfo&amp;, const URL&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, IncludeSecureCookies) const;</span>
<span class="line-modified">!     WEBCORE_EXPORT std::pair&lt;String, bool&gt; cookieRequestHeaderFieldValue(const URL&amp; firstParty, const SameSiteInfo&amp;, const URL&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, IncludeSecureCookies) const;</span>
      WEBCORE_EXPORT std::pair&lt;String, bool&gt; cookieRequestHeaderFieldValue(const CookieRequestHeaderFieldProxy&amp;) const;
  
  #if ENABLE(RESOURCE_LOAD_STATISTICS)
      WEBCORE_EXPORT bool shouldBlockCookies(const ResourceRequest&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;) const;
      WEBCORE_EXPORT bool shouldBlockCookies(const URL&amp; firstPartyForCookies, const URL&amp; resource, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;) const;
      WEBCORE_EXPORT bool shouldBlockThirdPartyCookies(const RegistrableDomain&amp;) const;
      WEBCORE_EXPORT bool shouldBlockThirdPartyCookiesButKeepFirstPartyCookiesFor(const RegistrableDomain&amp;) const;
      WEBCORE_EXPORT void setPrevalentDomainsToBlockAndDeleteCookiesFor(const Vector&lt;RegistrableDomain&gt;&amp;);
      WEBCORE_EXPORT void setPrevalentDomainsToBlockButKeepCookiesFor(const Vector&lt;RegistrableDomain&gt;&amp;);
      WEBCORE_EXPORT void setAgeCapForClientSideCookies(Optional&lt;Seconds&gt;);
      WEBCORE_EXPORT void removePrevalentDomains(const Vector&lt;RegistrableDomain&gt;&amp; domains);
      WEBCORE_EXPORT bool hasStorageAccess(const RegistrableDomain&amp; resourceDomain, const RegistrableDomain&amp; firstPartyDomain, Optional&lt;FrameIdentifier&gt;, PageIdentifier) const;
      WEBCORE_EXPORT Vector&lt;String&gt; getAllStorageAccessEntries() const;
      WEBCORE_EXPORT void grantStorageAccess(const RegistrableDomain&amp; resourceDomain, const RegistrableDomain&amp; firstPartyDomain, Optional&lt;FrameIdentifier&gt;, PageIdentifier);
<span class="line-new-header">--- 127,40 ---</span>
      ~NetworkStorageSession();
  
      NetworkingContext* context() const;
  #endif
  
<span class="line-modified">!     WEBCORE_EXPORT HTTPCookieAcceptPolicy cookieAcceptPolicy() const;</span>
      WEBCORE_EXPORT void setCookie(const Cookie&amp;);
      WEBCORE_EXPORT void setCookies(const Vector&lt;Cookie&gt;&amp;, const URL&amp;, const URL&amp; mainDocumentURL);
<span class="line-modified">!     WEBCORE_EXPORT void setCookiesFromDOM(const URL&amp; firstParty, const SameSiteInfo&amp;, const URL&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, ShouldAskITP, const String&amp;) const;</span>
      WEBCORE_EXPORT void deleteCookie(const Cookie&amp;);
      WEBCORE_EXPORT void deleteCookie(const URL&amp;, const String&amp;) const;
      WEBCORE_EXPORT void deleteAllCookies();
      WEBCORE_EXPORT void deleteAllCookiesModifiedSince(WallTime);
      WEBCORE_EXPORT void deleteCookiesForHostnames(const Vector&lt;String&gt;&amp; cookieHostNames);
      WEBCORE_EXPORT void deleteCookiesForHostnames(const Vector&lt;String&gt;&amp; cookieHostNames, IncludeHttpOnlyCookies);
      WEBCORE_EXPORT Vector&lt;Cookie&gt; getAllCookies();
      WEBCORE_EXPORT Vector&lt;Cookie&gt; getCookies(const URL&amp;);
<span class="line-modified">!     WEBCORE_EXPORT void hasCookies(const RegistrableDomain&amp;, CompletionHandler&lt;void(bool)&gt;&amp;&amp;) const;</span>
<span class="line-added">+     WEBCORE_EXPORT bool getRawCookies(const URL&amp; firstParty, const SameSiteInfo&amp;, const URL&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, ShouldAskITP, Vector&lt;Cookie&gt;&amp;) const;</span>
      WEBCORE_EXPORT void flushCookieStore();
      WEBCORE_EXPORT void getHostnamesWithCookies(HashSet&lt;String&gt;&amp; hostnames);
<span class="line-modified">!     WEBCORE_EXPORT std::pair&lt;String, bool&gt; cookiesForDOM(const URL&amp; firstParty, const SameSiteInfo&amp;, const URL&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, IncludeSecureCookies, ShouldAskITP) const;</span>
<span class="line-modified">!     WEBCORE_EXPORT std::pair&lt;String, bool&gt; cookieRequestHeaderFieldValue(const URL&amp; firstParty, const SameSiteInfo&amp;, const URL&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;, IncludeSecureCookies, ShouldAskITP) const;</span>
      WEBCORE_EXPORT std::pair&lt;String, bool&gt; cookieRequestHeaderFieldValue(const CookieRequestHeaderFieldProxy&amp;) const;
  
  #if ENABLE(RESOURCE_LOAD_STATISTICS)
<span class="line-added">+     void setResourceLoadStatisticsEnabled(bool enabled) { m_isResourceLoadStatisticsEnabled = enabled; }</span>
      WEBCORE_EXPORT bool shouldBlockCookies(const ResourceRequest&amp;, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;) const;
      WEBCORE_EXPORT bool shouldBlockCookies(const URL&amp; firstPartyForCookies, const URL&amp; resource, Optional&lt;FrameIdentifier&gt;, Optional&lt;PageIdentifier&gt;) const;
      WEBCORE_EXPORT bool shouldBlockThirdPartyCookies(const RegistrableDomain&amp;) const;
      WEBCORE_EXPORT bool shouldBlockThirdPartyCookiesButKeepFirstPartyCookiesFor(const RegistrableDomain&amp;) const;
<span class="line-added">+     WEBCORE_EXPORT bool hasHadUserInteractionAsFirstParty(const RegistrableDomain&amp;) const;</span>
      WEBCORE_EXPORT void setPrevalentDomainsToBlockAndDeleteCookiesFor(const Vector&lt;RegistrableDomain&gt;&amp;);
      WEBCORE_EXPORT void setPrevalentDomainsToBlockButKeepCookiesFor(const Vector&lt;RegistrableDomain&gt;&amp;);
<span class="line-added">+     WEBCORE_EXPORT void setDomainsWithUserInteractionAsFirstParty(const Vector&lt;RegistrableDomain&gt;&amp;);</span>
      WEBCORE_EXPORT void setAgeCapForClientSideCookies(Optional&lt;Seconds&gt;);
      WEBCORE_EXPORT void removePrevalentDomains(const Vector&lt;RegistrableDomain&gt;&amp; domains);
      WEBCORE_EXPORT bool hasStorageAccess(const RegistrableDomain&amp; resourceDomain, const RegistrableDomain&amp; firstPartyDomain, Optional&lt;FrameIdentifier&gt;, PageIdentifier) const;
      WEBCORE_EXPORT Vector&lt;String&gt; getAllStorageAccessEntries() const;
      WEBCORE_EXPORT void grantStorageAccess(const RegistrableDomain&amp; resourceDomain, const RegistrableDomain&amp; firstPartyDomain, Optional&lt;FrameIdentifier&gt;, PageIdentifier);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 161,10 ***</span>
<span class="line-new-header">--- 170,11 ---</span>
      WEBCORE_EXPORT void setCacheMaxAgeCapForPrevalentResources(Seconds);
      WEBCORE_EXPORT void resetCacheMaxAgeCapForPrevalentResources();
      WEBCORE_EXPORT Optional&lt;Seconds&gt; maxAgeCacheCap(const ResourceRequest&amp;);
      WEBCORE_EXPORT void didCommitCrossSiteLoadWithDataTransferFromPrevalentResource(const RegistrableDomain&amp; toDomain, PageIdentifier);
      WEBCORE_EXPORT void resetCrossSiteLoadsWithLinkDecorationForTesting();
<span class="line-added">+     WEBCORE_EXPORT void setThirdPartyCookieBlockingMode(ThirdPartyCookieBlockingMode);</span>
  #endif
  
  private:
      PAL::SessionID m_sessionID;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 184,20 ***</span>
<span class="line-new-header">--- 194,23 ---</span>
  #endif
  
      CredentialStorage m_credentialStorage;
  
  #if ENABLE(RESOURCE_LOAD_STATISTICS)
<span class="line-added">+     bool m_isResourceLoadStatisticsEnabled = false;</span>
      Optional&lt;Seconds&gt; clientSideCookieCap(const RegistrableDomain&amp; firstParty, Optional&lt;PageIdentifier&gt;) const;
      HashSet&lt;RegistrableDomain&gt; m_registrableDomainsToBlockAndDeleteCookiesFor;
      HashSet&lt;RegistrableDomain&gt; m_registrableDomainsToBlockButKeepCookiesFor;
<span class="line-added">+     HashSet&lt;RegistrableDomain&gt; m_registrableDomainsWithUserInteractionAsFirstParty;</span>
      HashMap&lt;PageIdentifier, HashMap&lt;FrameIdentifier, RegistrableDomain&gt;&gt; m_framesGrantedStorageAccess;
      HashMap&lt;PageIdentifier, HashMap&lt;RegistrableDomain, RegistrableDomain&gt;&gt; m_pagesGrantedStorageAccess;
      Optional&lt;Seconds&gt; m_cacheMaxAgeCapForPrevalentResources { };
      Optional&lt;Seconds&gt; m_ageCapForClientSideCookies { };
      Optional&lt;Seconds&gt; m_ageCapForClientSideCookiesShort { };
      HashMap&lt;WebCore::PageIdentifier, RegistrableDomain&gt; m_navigatedToWithLinkDecorationByPrevalentResource;
      bool m_navigationWithLinkDecorationTestMode = false;
<span class="line-added">+     ThirdPartyCookieBlockingMode m_thirdPartyCookieBlockingMode { ThirdPartyCookieBlockingMode::All };</span>
  #endif
  
  #if PLATFORM(COCOA)
  public:
      CookieStorageObserver&amp; cookieStorageObserver() const;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 211,5 ***</span>
<span class="line-new-header">--- 224,28 ---</span>
  #if PLATFORM(COCOA) || USE(CFURLCONNECTION)
  WEBCORE_EXPORT CFURLStorageSessionRef createPrivateStorageSession(CFStringRef identifier);
  #endif
  
  }
<span class="line-added">+ </span>
<span class="line-added">+ namespace WTF {</span>
<span class="line-added">+ </span>
<span class="line-added">+ template&lt;&gt; struct EnumTraits&lt;WebCore::ThirdPartyCookieBlockingMode&gt; {</span>
<span class="line-added">+     using values = EnumValues&lt;</span>
<span class="line-added">+         WebCore::ThirdPartyCookieBlockingMode,</span>
<span class="line-added">+         WebCore::ThirdPartyCookieBlockingMode::All,</span>
<span class="line-added">+         WebCore::ThirdPartyCookieBlockingMode::AllOnSitesWithoutUserInteraction,</span>
<span class="line-added">+         WebCore::ThirdPartyCookieBlockingMode::OnlyAccordingToPerDomainPolicy</span>
<span class="line-added">+     &gt;;</span>
<span class="line-added">+ };</span>
<span class="line-added">+ </span>
<span class="line-added">+ template&lt;&gt; struct EnumTraits&lt;WebCore::FirstPartyWebsiteDataRemovalMode&gt; {</span>
<span class="line-added">+     using values = EnumValues&lt;</span>
<span class="line-added">+         WebCore::FirstPartyWebsiteDataRemovalMode,</span>
<span class="line-added">+         WebCore::FirstPartyWebsiteDataRemovalMode::AllButCookies,</span>
<span class="line-added">+         WebCore::FirstPartyWebsiteDataRemovalMode::None,</span>
<span class="line-added">+         WebCore::FirstPartyWebsiteDataRemovalMode::AllButCookiesLiveOnTestingTimeout,</span>
<span class="line-added">+         WebCore::FirstPartyWebsiteDataRemovalMode::AllButCookiesReproTestingTimeout</span>
<span class="line-added">+     &gt;;</span>
<span class="line-added">+ };</span>
<span class="line-added">+ </span>
<span class="line-added">+ }</span>
</pre>
<center><a href="NetworkStorageSession.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ParsedContentType.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>