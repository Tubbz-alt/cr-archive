<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/dom/make_event_factory.pl</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 #!/usr/bin/env perl
  2 
  3 # Copyright (C) 2005, 2006, 2007, 2009 Apple Inc. All rights reserved.
  4 # Copyright (C) 2009, Julien Chaffraix &lt;jchaffraix@webkit.org&gt;
  5 # Copyright (C) 2009 Torch Mobile Inc. All rights reserved. (http://www.torchmobile.com/)
  6 # Copyright (C) 2011 Ericsson AB. All rights reserved.
  7 # Copyright (C) 2011 Google, Inc. All rights reserved.
  8 #
  9 # Redistribution and use in source and binary forms, with or without
 10 # modification, are permitted provided that the following conditions
 11 # are met:
 12 #
 13 # 1.  Redistributions of source code must retain the above copyright
 14 #     notice, this list of conditions and the following disclaimer. 
 15 # 2.  Redistributions in binary form must reproduce the above copyright
 16 #     notice, this list of conditions and the following disclaimer in the
 17 #     documentation and/or other materials provided with the distribution. 
 18 # 3.  Neither the name of Apple Inc. (&quot;Apple&quot;) nor the names of
 19 #     its contributors may be used to endorse or promote products derived
 20 #     from this software without specific prior written permission. 
 21 #
 22 # THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 23 # EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 24 # WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 25 # DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 26 # DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 27 # (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 28 # LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 29 # ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 30 # (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 31 # THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 32 
 33 use strict;
 34 use warnings;
 35 use FindBin;
 36 use lib &quot;$FindBin::Bin/../bindings/scripts&quot;;
 37 
 38 use InFilesCompiler;
 39 
 40 my %defaultParameters = (
 41     &#39;namespace&#39; =&gt; 0,
 42     &#39;factoryFunction&#39; =&gt; 0,
 43     &#39;useNamespaceAsSuffix&#39; =&gt; 0,
 44 );
 45 
 46 sub defaultItemFactory
 47 {
 48     return (
 49         &#39;interfaceName&#39; =&gt; 0,
 50         &#39;conditional&#39; =&gt; 0,
 51         &#39;runtimeEnabled&#39; =&gt; 0
 52     );
 53 }
 54 
 55 my $InCompiler = InFilesCompiler-&gt;new(\%defaultParameters, \&amp;defaultItemFactory);
 56 
 57 my $outputDir = $InCompiler-&gt;initializeFromCommandLine();
 58 $InCompiler-&gt;compile(\&amp;generateCode);
 59 
 60 sub generateCode()
 61 {
 62     my $parsedParametersRef = shift;
 63     my $parsedItemsRef = shift;
 64 
 65     generateImplementation($parsedParametersRef, $parsedItemsRef);
 66     $InCompiler-&gt;generateInterfacesHeader();
 67     $InCompiler-&gt;generateHeadersHeader();
 68 }
 69 
 70 sub generateImplementation()
 71 {
 72     my $parsedParametersRef = shift;
 73     my $parsedItemsRef = shift;
 74 
 75     my %parsedEvents = %{ $parsedItemsRef };
 76     my %parsedParameters = %{ $parsedParametersRef };
 77 
 78     my $namespace = $parsedParameters{&quot;namespace&quot;};
 79     my $factoryFunction = $parsedParameters{&quot;factoryFunction&quot;};
 80     ($factoryFunction eq &quot;toJS&quot; or $factoryFunction eq &quot;toNewlyCreated&quot;) or die &quot;factoryFunction should be either toJS or toNewlyCreated&quot;;
 81     my $useNamespaceAsSuffix = $parsedParameters{&quot;useNamespaceAsSuffix&quot;};
 82 
 83     my $F;
 84     open F, &quot;&gt;&quot;, &quot;$outputDir/${namespace}Factory.cpp&quot; or die &quot;Failed to open file: $!&quot;;
 85 
 86     print F $InCompiler-&gt;license();
 87 
 88     my $interfaceMethodName = lcfirst $namespace . &quot;Interface&quot;;
 89 
 90     print F &quot;#include \&quot;config.h\&quot;\n&quot;;
 91     print F &quot;#include \&quot;${namespace}Headers.h\&quot;\n&quot;;
 92     print F &quot;\n&quot;;
 93     print F &quot;#include \&quot;JSDOMGlobalObject.h\&quot;\n&quot;;
 94     print F &quot;#include &lt;JavaScriptCore/StructureInlines.h&gt;\n&quot;;
 95     print F &quot;\n&quot;;
 96     print F &quot;namespace WebCore {\n&quot;;
 97     print F &quot;\n&quot;;
 98     # FIXME: Why does Event need toNewlyCreated but EventTarget need toJS?
 99     if ($factoryFunction eq &quot;toNewlyCreated&quot;) {
<a name="1" id="anc1"></a><span class="line-modified">100         print F &quot;JSC::JSValue toJSNewlyCreated(JSC::JSGlobalObject*, JSDOMGlobalObject* globalObject, Ref&lt;${namespace}&gt;&amp;&amp; impl)\n&quot;;</span>
101         print F &quot;{\n&quot;;
102         print F &quot;    switch (impl-&gt;${interfaceMethodName}()) {\n&quot;;
103     } else {
<a name="2" id="anc2"></a><span class="line-modified">104         print F &quot;JSC::JSValue toJS(JSC::JSGlobalObject* state, JSDOMGlobalObject* globalObject, ${namespace}&amp; impl)\n&quot;;</span>
105         print F &quot;{\n&quot;;
106         print F &quot;    switch (impl.${interfaceMethodName}()) {\n&quot;;
107     }
108 
109     my %generatedInterfaceNames = ();
110 
111     for my $eventName (sort keys %parsedEvents) {
112         my $conditional = $parsedEvents{$eventName}{&quot;conditional&quot;};
113         my $runtimeEnabled = $parsedEvents{$eventName}{&quot;runtimeEnabled&quot;};
114         my $interfaceName = $InCompiler-&gt;interfaceForItem($eventName);
115 
116         next if $generatedInterfaceNames{$interfaceName};
117         $generatedInterfaceNames{$interfaceName} = 1;
118 
119         my $suffix = &quot;&quot;;
120         if ($useNamespaceAsSuffix eq &quot;true&quot;) {
121             $suffix = $namespace . $suffix;
122         }
123 
124         # FIXME: This should pay attention to $runtimeConditional so it can support RuntimeEnabledFeatures.
125         if ($conditional) {
126             my $conditionals = &quot;#if ENABLE(&quot; . join(&quot;) || ENABLE(&quot;, split(&quot;\\|&quot;, $conditional)) . &quot;)&quot;;
127             print F &quot;$conditionals\n&quot;;
128         }
129         print F &quot;    case ${interfaceName}${suffix}InterfaceType:\n&quot;;
130         if ($factoryFunction eq &quot;toNewlyCreated&quot;) {
131             print F &quot;        return createWrapper&lt;$interfaceName$suffix&gt;(globalObject, WTFMove(impl));\n&quot;;
132         } else {
133             print F &quot;        return toJS(state, globalObject, static_cast&lt;$interfaceName&amp;&gt;(impl));\n&quot;;
134         }
135         print F &quot;#endif\n&quot; if $conditional;
136     }
137 
138     print F &quot;    }\n&quot;;
139     if ($factoryFunction eq &quot;toNewlyCreated&quot;) {
140         print F &quot;    return createWrapper&lt;$namespace&gt;(globalObject, WTFMove(impl));\n&quot;;
141     } else {
142         print F &quot;    ASSERT_NOT_REACHED();\n&quot;;
143         print F &quot;    return JSC::jsNull();\n&quot;;
144     }
145     print F &quot;}\n&quot;;
146     print F &quot;\n&quot;;
147     print F &quot;} // namespace WebCore\n&quot;;
148 
149     close F;
150 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>