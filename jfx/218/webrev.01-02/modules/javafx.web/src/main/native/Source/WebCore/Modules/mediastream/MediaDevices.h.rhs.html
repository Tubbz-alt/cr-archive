<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/Modules/mediastream/MediaDevices.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2015 Ericsson AB. All rights reserved.
  3  * Copyright (C) 2016-2018 Apple Inc. All rights reserved.
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  *
  9  * 1. Redistributions of source code must retain the above copyright
 10  *    notice, this list of conditions and the following disclaimer.
 11  * 2. Redistributions in binary form must reproduce the above copyright
 12  *    notice, this list of conditions and the following disclaimer
 13  *    in the documentation and/or other materials provided with the
 14  *    distribution.
 15  * 3. Neither the name of Ericsson nor the names of its contributors
 16  *    may be used to endorse or promote products derived from this
 17  *    software without specific prior written permission.
 18  *
 19  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 20  * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 21  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 22  * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 23  * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 24  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 25  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 26  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 27  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 28  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 29  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 30  */
 31 
 32 #pragma once
 33 
 34 #if ENABLE(MEDIA_STREAM)
 35 
 36 #include &quot;ActiveDOMObject.h&quot;
 37 #include &quot;EventNames.h&quot;
 38 #include &quot;EventTarget.h&quot;
 39 #include &quot;ExceptionOr.h&quot;
<a name="1" id="anc1"></a><span class="line-modified"> 40 #include &quot;IDLTypes.h&quot;</span>
 41 #include &quot;MediaTrackConstraints.h&quot;
 42 #include &quot;RealtimeMediaSourceCenter.h&quot;
 43 #include &quot;Timer.h&quot;
 44 #include &quot;UserMediaClient.h&quot;
 45 #include &lt;wtf/WeakPtr.h&gt;
 46 
 47 namespace WebCore {
 48 
 49 class Document;
 50 class MediaDeviceInfo;
 51 class MediaStream;
<a name="2" id="anc2"></a><span class="line-added"> 52 class UserGestureToken;</span>
 53 
 54 struct MediaTrackSupportedConstraints;
 55 
<a name="3" id="anc3"></a><span class="line-added"> 56 template&lt;typename IDLType&gt; class DOMPromiseDeferred;</span>
<span class="line-added"> 57 </span>
 58 class MediaDevices final : public RefCounted&lt;MediaDevices&gt;, public ActiveDOMObject, public EventTargetWithInlineData, public CanMakeWeakPtr&lt;MediaDevices&gt; {
 59     WTF_MAKE_ISO_ALLOCATED(MediaDevices);
 60 public:
 61     static Ref&lt;MediaDevices&gt; create(Document&amp;);
 62 
 63     ~MediaDevices();
 64 
 65     Document* document() const;
 66 
 67     using Promise = DOMPromiseDeferred&lt;IDLInterface&lt;MediaStream&gt;&gt;;
 68     using EnumerateDevicesPromise = DOMPromiseDeferred&lt;IDLSequence&lt;IDLInterface&lt;MediaDeviceInfo&gt;&gt;&gt;;
 69 
 70     enum class DisplayCaptureSurfaceType {
 71         Monitor,
 72         Window,
 73         Application,
 74         Browser,
 75     };
 76 
 77     struct StreamConstraints {
 78         Variant&lt;bool, MediaTrackConstraints&gt; video;
 79         Variant&lt;bool, MediaTrackConstraints&gt; audio;
 80     };
<a name="4" id="anc4"></a><span class="line-modified"> 81     void getUserMedia(const StreamConstraints&amp;, Promise&amp;&amp;);</span>
<span class="line-modified"> 82 </span>
<span class="line-added"> 83     struct DisplayMediaStreamConstraints {</span>
<span class="line-added"> 84         Variant&lt;bool, MediaTrackConstraints&gt; video;</span>
<span class="line-added"> 85         Variant&lt;bool, MediaTrackConstraints&gt; audio;</span>
<span class="line-added"> 86     };</span>
<span class="line-added"> 87     void getDisplayMedia(const DisplayMediaStreamConstraints&amp;, Promise&amp;&amp;);</span>
<span class="line-added"> 88 </span>
 89     void enumerateDevices(EnumerateDevicesPromise&amp;&amp;);
 90     MediaTrackSupportedConstraints getSupportedConstraints();
 91 
 92     using RefCounted&lt;MediaDevices&gt;::ref;
 93     using RefCounted&lt;MediaDevices&gt;::deref;
 94 
<a name="5" id="anc5"></a>

 95 private:
 96     explicit MediaDevices(Document&amp;);
 97 
 98     void scheduledEventTimerFired();
 99     bool addEventListener(const AtomString&amp; eventType, Ref&lt;EventListener&gt;&amp;&amp;, const AddEventListenerOptions&amp;) override;
100 
101     void refreshDevices(const Vector&lt;CaptureDevice&gt;&amp;);
102     void listenForDeviceChanges();
103 
104     friend class JSMediaDevicesOwner;
105 
106     // ActiveDOMObject
107     const char* activeDOMObjectName() const final;
<a name="6" id="anc6"></a>
108     void stop() final;
109     bool hasPendingActivity() const final;
110 
111     // EventTargetWithInlineData.
112     EventTargetInterface eventTargetInterface() const final { return MediaDevicesEventTargetInterfaceType; }
113     ScriptExecutionContext* scriptExecutionContext() const final { return ActiveDOMObject::scriptExecutionContext(); }
114     void refEventTarget() final { ref(); }
115     void derefEventTarget() final { deref(); }
116 
<a name="7" id="anc7"></a><span class="line-added">117     enum class GestureAllowedRequest {</span>
<span class="line-added">118         Microphone = 1 &lt;&lt; 0,</span>
<span class="line-added">119         Camera = 1 &lt;&lt; 1,</span>
<span class="line-added">120         Display = 1 &lt;&lt; 2,</span>
<span class="line-added">121     };</span>
<span class="line-added">122     bool computeUserGesturePriviledge(GestureAllowedRequest);</span>
<span class="line-added">123 </span>
124     Timer m_scheduledEventTimer;
125     UserMediaClient::DeviceChangeObserverToken m_deviceChangeToken;
126     const EventNames&amp; m_eventNames; // Need to cache this so we can use it from GC threads.
127     bool m_listeningForDeviceChanges { false };
<a name="8" id="anc8"></a>
128 
129     Vector&lt;Ref&lt;MediaDeviceInfo&gt;&gt; m_devices;
<a name="9" id="anc9"></a><span class="line-modified">130 </span>
<span class="line-modified">131     OptionSet&lt;GestureAllowedRequest&gt; m_requestTypesForCurrentGesture;</span>
<span class="line-added">132     WeakPtr&lt;UserGestureToken&gt; m_currentGestureToken;</span>
133 };
134 
135 } // namespace WebCore
136 
137 #endif // ENABLE(MEDIA_STREAM)
<a name="10" id="anc10"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="10" type="hidden" />
</body>
</html>