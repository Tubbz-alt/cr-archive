<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Tools/Scripts/build-webkit</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../DumpRenderTree/java/TestRunnerJava.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="set-webkit-configuration.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Tools/Scripts/build-webkit</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 27 # (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 28 # LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 29 # ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 30 # (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 31 # THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 32 
 33 # Build script wrapper for the WebKit Open Source Project.
 34 
 35 use strict;
 36 use warnings;
 37 use File::Basename;
 38 use File::Find;
 39 use File::Spec;
 40 use FindBin;
 41 use Getopt::Long qw(:config pass_through no_auto_abbrev);
 42 use lib $FindBin::Bin;
 43 use webkitdirs;
 44 use List::Util qw(first);
 45 use webkitperl::FeatureList qw(getFeatureOptionList);
 46 use POSIX;

 47 
 48 sub writeCongrats();
 49 
 50 checkRequiredSystemConfig();
 51 setConfiguration();
 52 
 53 if (shouldUseFlatpak()) {
 54     print &quot;Building flatpak based environment\n&quot;;
 55 
 56     runInFlatpak(&quot;/app/webkit/Tools/Scripts/build-webkit&quot;);
 57 }
 58 
 59 my $originalWorkingDirectory = getcwd();
 60 chdirWebKit();
 61 
 62 my $showHelp = 0;
 63 my $verbose = 0;
 64 my $clean = 0;
 65 my $minimal = 0;
 66 my $installHeaders;
 67 my $installLibs;
 68 my $prefixPath;
 69 my $makeArgs = &quot;&quot;;
 70 my @cmakeArgs;
 71 my $onlyWebKitProject = 0;
 72 my $coverageSupport = 0;
 73 my $shouldRunStaticAnalyzer = 0;
 74 my $noExperimentalFeatures = 0;
 75 my $ltoMode = &quot;default&quot;;
 76 my $xcbuild = undef;
 77 my $startTime = time();
 78 my $archs32bit = 0;
 79 my $skipLibraryUpdate = 0;
 80 my $useCCache = -1;
 81 
 82 my @features = getFeatureOptionList();
 83 
 84 # Additional environment parameters
<span class="line-modified"> 85 push @ARGV, split(/ /, $ENV{&#39;BUILD_WEBKIT_ARGS&#39;}) if ($ENV{&#39;BUILD_WEBKIT_ARGS&#39;});</span>
 86 
 87 # Initialize values from defaults
 88 foreach (@ARGV) {
 89     if ($_ eq &#39;--minimal&#39;) {
 90         $minimal = 1;
 91     } elsif ($_ eq &#39;ARCHS=i386&#39; or $_ eq &#39;ARCHS=armv7&#39; or $_ eq &#39;ARCHS=armv7s&#39;) {
 92         $archs32bit = 1;
 93     }
 94 }
 95 
 96 # Feature flags default to undefined, where they will inherit the default value
 97 # specified by the build system, or to &#39;off&#39; if --minimal is specified.
 98 foreach (@features) {
 99     ${$_-&gt;{value}} = ($minimal ? 0 : undef);
100 }
101 
102 my $programName = basename($0);
103 my $usage = &lt;&lt;EOF;
104 Usage: $programName [options] [options to pass to build system]
105   --help                            Show this help message
106   --verbose                         Show verbose build output
107   --clean                           Cleanup the build directory
108   --generate-project-only           Only generate project files
109   --debug                           Compile with Debug configuration
110   --release                         Compile with Release configuration
111   --sdk=&lt;sdk&gt;                       Use a specific Xcode SDK (iOS and Mac only)
112   --ios-device                      Use &quot;iphoneos.internal&quot; SDK if installed, else &quot;iphoneos&quot; SDK (iOS only)
113   --device                          DEPRECATED alias of --ios-device
114   --ios-simulator                   Use &quot;iphonesimulator.internal&quot; SDK if installed, else &quot;iphonesimulator&quot; SDK (iOS only)
115   --simulator                       DEPRECATED alias of --ios-simulator
116   --coverage                        Enable code coverage support (Mac only)
117   --analyze                         Enable static anaylsis (iOS and Mac only)
118   --lto-mode=&lt;mode&gt;                 Set Link Time Optimization mode (full, thin, or none) (LLVM only)
119   --[no-]xcbuild                    Force the use of XCBuild or not
120 
121   --java                            Build the Open JavaFX port

122   --gtk                             Build the GTK+ port
123   --wpe                             Build the WPE port
124   --wincairo                        Build using Cairo (rather than CoreGraphics) on Windows
125   --playstation                     Build the PlayStation port
126 
127   --inspector-frontend              Copy Web Inspector user interface resources to the build directory
128 
129   --prefix=&lt;path&gt;                   Set installation prefix to the given path (CMake only, except Windows)
130   --makeargs=&lt;arguments&gt;            Optional Makefile flags
131   --cmakeargs=&lt;arguments&gt;           One or more optional CMake flags (e.g. --cmakeargs=&quot;-DFOO=bar -DCMAKE_PREFIX_PATH=/usr/local&quot;)
132 
133   --minimal                         No optional features, unless explicitly enabled
134   --no-experimental-features        No experimental features, unless explicitly enabled (CMake only)
135 
136   --only-webkit                     Build only the WebKit project
137 
138   --skip-library-update             Skip the check to see if windows libraries are up to date
139 
140   --[no-]use-ccache                 Enable (or disable) CCache, if available
141 
</pre>
<hr />
<pre>
173 if ($showHelp) {
174    print STDERR $usage;
175    exit 1;
176 }
177 
178 $ENV{&#39;VERBOSE&#39;} = 1 if $verbose;
179 
180 if ($useCCache == 1) {
181     $ENV{&#39;WK_USE_CCACHE&#39;} = &quot;YES&quot;;
182 } elsif ($useCCache == 0) {
183     $ENV{&#39;WK_USE_CCACHE&#39;} = &quot;NO&quot;;
184 }
185 
186 
187 my $productDir = productDir();
188 
189 # Check that all the project directories are there.
190 my @projects = (&quot;Source/JavaScriptCore&quot;, &quot;Source/WebCore&quot;, &quot;Source/WebKitLegacy&quot;);
191 
192 # Build WTF as a separate static library on ports which support it.
<span class="line-modified">193 splice @projects, 0, 0, &quot;Source/WTF&quot; if isAppleWebKit() or isWinCairo();</span>
194 
195 splice @projects, 0, 0, &quot;Source/bmalloc&quot; if isAppleCocoaWebKit();
196 
197 # Ports using CMake will check if directories exist in the CMake configuration.
198 if (!isCMakeBuild()) {
199     for my $dir (@projects) {
200         if (! -d $dir) {
201             die &quot;Error: No $dir directory found. Please do a fresh checkout.\n&quot;;
202         }
203     }
204 }
205 
<span class="line-modified">206 if ((isAppleWebKit() || isWinCairo() || isPlayStation()) &amp;&amp; !-d &quot;WebKitLibraries&quot;) {</span>
207     die &quot;Error: No WebKitLibraries directory found. Please do a fresh checkout.\n&quot;;
208 }
209 
210 my @options = ();
211 
212 if (isAppleCocoaWebKit()) {
213     push @options, XcodeOptions();
214 
215     if (not defined $xcbuild) {
216         $xcbuild = canUseXCBuild();
217     }
218 
219     if ($xcbuild) {
220         push @options, &quot;-UseNewBuildSystem=YES&quot;;
221         push @options, &quot;USE_NEW_BUILD_SYSTEM=YES&quot;;
222     } else {
223         push @options, &quot;-UseNewBuildSystem=NO&quot;;
224     }
225 
226     sub option($$)
</pre>
<hr />
<pre>
245     push @projects, (&quot;Source/WebKit&quot;);
246 
247     if (!isIOSWebKit()) {
248         push @projects, (&quot;Tools/MiniBrowser&quot;);
249 
250         # WebInspectorUI must come after JavaScriptCore and WebCore but before WebKit and WebKit2
251         my $webKitIndex = first { $projects[$_] eq &quot;Source/WebKitLegacy&quot; } 0..$#projects;
252         splice(@projects, $webKitIndex, 0, &quot;Source/WebInspectorUI&quot;);
253 
254         # Copy library and header from WebKitLibraries to a findable place in the product directory.
255         my @copyLibrariesArgs = (&quot;perl&quot;, &quot;Tools/Scripts/copy-webkitlibraries-to-product-directory&quot;, &quot;--wksi&quot;,  productDir());
256         print(join(&quot; &quot;, @copyLibrariesArgs) . &quot;\n&quot;);
257         (system(@copyLibrariesArgs) == 0) or die;
258     } else {
259         my @copyLibrariesArgs = (&quot;perl&quot;, &quot;Tools/Scripts/copy-webkitlibraries-to-product-directory&quot;, &quot;--sdk&quot;, xcodeSDK(), &quot;--wksi&quot;);
260         push @copyLibrariesArgs, productDir();
261         print(join(&quot; &quot;, @copyLibrariesArgs) . &quot;\n&quot;);
262         (system(@copyLibrariesArgs) == 0) or die;
263     }
264 




265     # Build Tools needed for Apple ports
266     push @projects, (&quot;Tools/DumpRenderTree&quot;, &quot;Tools/WebKitTestRunner&quot;, &quot;Source/ThirdParty/gtest&quot;, &quot;Tools/TestWebKitAPI&quot;);
267 
268 } elsif (isWinCairo() &amp;&amp; !$skipLibraryUpdate) {
269     (system(&quot;python Tools/Scripts/update-webkit-wincairo-libs.py&quot;) == 0) or die;
270 } elsif (isAppleWinWebKit() &amp;&amp; !$skipLibraryUpdate) {
271     # Copy WebKitSupportLibrary to the correct location in WebKitLibraries so it can be found.
272     # Will fail if WebKitSupportLibrary.zip is not in source root.
273     (system(&quot;perl Tools/Scripts/update-webkit-support-libs&quot;) == 0) or die;
274     (system(&quot;perl Tools/Scripts/update-webkit-auxiliary-libs&quot;) == 0) or die;
275     setupAppleWinEnv()
276 }
277 
278 # If asked to build just the WebKit project, overwrite the projects
279 # list after all of the port specific tweaks have been made to
280 # build options, etc.
281 @projects = (&quot;Source/WebKitLegacy&quot;) if $onlyWebKitProject;
282 
283 my $result = 0;
284 
</pre>
<hr />
<pre>
290 if (isCMakeBuild()) {
291     if ((!canUseNinja() || defined($ENV{NUMBER_OF_PROCESSORS})) &amp;&amp; !(isJava() &amp;&amp; isAnyWindows())) {
292         # If the user environment is not setting a specific number of process,
293         # then don&#39;t pass the number of jobs to Ninja. Because Ninja will
294         # automatically determine the number of jobs to run in parallel.
295         $makeArgs .= ($makeArgs ? &quot; &quot; : &quot;&quot;) . &quot;-j&quot; . numberOfCPUs() if $makeArgs !~ /-j\s*\d+/;
296     }
297 
298     my $maxCPULoad = maxCPULoad() if $makeArgs !~ /-l\s*\d+\.?\d*/;
299     $makeArgs .= &quot; -l&quot; . maxCPULoad() if defined $maxCPULoad;
300 
301     # We remove CMakeCache to avoid the bots reusing cached flags when
302     # we enable new features. This forces a reconfiguration.
303     my @featureArgs = cmakeArgsFromFeatures(@features, !$noExperimentalFeatures);
304     removeCMakeCache(@featureArgs);
305 
306     buildCMakeProjectOrExit($clean, $prefixPath, $makeArgs, @featureArgs, @cmakeArgs);
307 }
308 
309 my $baseProductDir = baseProductDir();
<span class="line-modified">310 if (isAppleWinWebKit() || isWinCairo() || isPlayStation()) {</span>
311     my @featureArgs = cmakeArgsFromFeatures(@features, !$noExperimentalFeatures);
312     removeCMakeCache(@featureArgs);
313 
314     chdirWebKit();
315     if (exitStatus(generateBuildSystemFromCMakeProject($prefixPath, @featureArgs, @cmakeArgs))) {
316         die &quot;Run Visual Studio 2017 installation vcvars.bat before build-webkit when using ninja&quot;;
317     }
318 
319     exit 0 if isGenerateProjectOnly();
320 
321     chdirWebKit();
322     if (canUseNinja()) {
323         chdir File::Spec-&gt;catdir($baseProductDir, configuration());
324         $result = system(&quot;ninja&quot;);
325     } else {
326         $result = buildVisualStudioProject(File::Spec-&gt;catfile($baseProductDir, configuration(), &quot;WebKit.sln&quot;), $clean);
327     }
328     if (exitStatus($result)) {
329         my $scriptDir = relativeScriptsDir();
<span class="line-modified">330         if (isAppleWinWebKit() || isWinCairo()) {</span>
331             print &quot;\n\n===== BUILD FAILED ======\n\n&quot;;
332             print &quot;Please ensure you have run $scriptDir/update-webkit to install dependencies.\n\n&quot;;
333             print &quot;You can view build errors by checking the BuildLog.htm files located at:\n$baseProductDir/obj/&lt;project&gt;/&lt;config&gt;.\n&quot;;
334         }
335         exit exitStatus($result);
336     }
337 } elsif (isAppleCocoaWebKit() &amp;&amp; !isCMakeBuild()) {
338     exit 0 if isGenerateProjectOnly();
339 
340     # Build, and abort if the build fails.
341     for my $dir (@projects) {
342         chdir $dir or die;
343         $result = 0;
344 
345         my $project = basename($dir);
346         
347         my @local_options = @options;
348         push @local_options, XcodeCoverageSupportOptions() if $coverageSupport;
349         push @local_options, XcodeStaticAnalyzerOption() if $shouldRunStaticAnalyzer;
350         push @local_options, &quot;WK_LTO_MODE=$ltoMode&quot; if ($ltoMode ne &quot;default&quot;);
</pre>
</td>
<td>
<hr />
<pre>
 27 # (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 28 # LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 29 # ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 30 # (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 31 # THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 32 
 33 # Build script wrapper for the WebKit Open Source Project.
 34 
 35 use strict;
 36 use warnings;
 37 use File::Basename;
 38 use File::Find;
 39 use File::Spec;
 40 use FindBin;
 41 use Getopt::Long qw(:config pass_through no_auto_abbrev);
 42 use lib $FindBin::Bin;
 43 use webkitdirs;
 44 use List::Util qw(first);
 45 use webkitperl::FeatureList qw(getFeatureOptionList);
 46 use POSIX;
<span class="line-added"> 47 use Text::ParseWords;</span>
 48 
 49 sub writeCongrats();
 50 
 51 checkRequiredSystemConfig();
 52 setConfiguration();
 53 
 54 if (shouldUseFlatpak()) {
 55     print &quot;Building flatpak based environment\n&quot;;
 56 
 57     runInFlatpak(&quot;/app/webkit/Tools/Scripts/build-webkit&quot;);
 58 }
 59 
 60 my $originalWorkingDirectory = getcwd();
 61 chdirWebKit();
 62 
 63 my $showHelp = 0;
 64 my $verbose = 0;
 65 my $clean = 0;
 66 my $minimal = 0;
 67 my $installHeaders;
 68 my $installLibs;
 69 my $prefixPath;
 70 my $makeArgs = &quot;&quot;;
 71 my @cmakeArgs;
 72 my $onlyWebKitProject = 0;
 73 my $coverageSupport = 0;
 74 my $shouldRunStaticAnalyzer = 0;
 75 my $noExperimentalFeatures = 0;
 76 my $ltoMode = &quot;default&quot;;
 77 my $xcbuild = undef;
 78 my $startTime = time();
 79 my $archs32bit = 0;
 80 my $skipLibraryUpdate = 0;
 81 my $useCCache = -1;
 82 
 83 my @features = getFeatureOptionList();
 84 
 85 # Additional environment parameters
<span class="line-modified"> 86 push @ARGV, parse_line(&#39;\s+&#39;, 0, $ENV{&#39;BUILD_WEBKIT_ARGS&#39;}) if ($ENV{&#39;BUILD_WEBKIT_ARGS&#39;});</span>
 87 
 88 # Initialize values from defaults
 89 foreach (@ARGV) {
 90     if ($_ eq &#39;--minimal&#39;) {
 91         $minimal = 1;
 92     } elsif ($_ eq &#39;ARCHS=i386&#39; or $_ eq &#39;ARCHS=armv7&#39; or $_ eq &#39;ARCHS=armv7s&#39;) {
 93         $archs32bit = 1;
 94     }
 95 }
 96 
 97 # Feature flags default to undefined, where they will inherit the default value
 98 # specified by the build system, or to &#39;off&#39; if --minimal is specified.
 99 foreach (@features) {
100     ${$_-&gt;{value}} = ($minimal ? 0 : undef);
101 }
102 
103 my $programName = basename($0);
104 my $usage = &lt;&lt;EOF;
105 Usage: $programName [options] [options to pass to build system]
106   --help                            Show this help message
107   --verbose                         Show verbose build output
108   --clean                           Cleanup the build directory
109   --generate-project-only           Only generate project files
110   --debug                           Compile with Debug configuration
111   --release                         Compile with Release configuration
112   --sdk=&lt;sdk&gt;                       Use a specific Xcode SDK (iOS and Mac only)
113   --ios-device                      Use &quot;iphoneos.internal&quot; SDK if installed, else &quot;iphoneos&quot; SDK (iOS only)
114   --device                          DEPRECATED alias of --ios-device
115   --ios-simulator                   Use &quot;iphonesimulator.internal&quot; SDK if installed, else &quot;iphonesimulator&quot; SDK (iOS only)
116   --simulator                       DEPRECATED alias of --ios-simulator
117   --coverage                        Enable code coverage support (Mac only)
118   --analyze                         Enable static anaylsis (iOS and Mac only)
119   --lto-mode=&lt;mode&gt;                 Set Link Time Optimization mode (full, thin, or none) (LLVM only)
120   --[no-]xcbuild                    Force the use of XCBuild or not
121 
122   --java                            Build the Open JavaFX port
<span class="line-added">123   --ftw                             Build the FTW Windows port</span>
124   --gtk                             Build the GTK+ port
125   --wpe                             Build the WPE port
126   --wincairo                        Build using Cairo (rather than CoreGraphics) on Windows
127   --playstation                     Build the PlayStation port
128 
129   --inspector-frontend              Copy Web Inspector user interface resources to the build directory
130 
131   --prefix=&lt;path&gt;                   Set installation prefix to the given path (CMake only, except Windows)
132   --makeargs=&lt;arguments&gt;            Optional Makefile flags
133   --cmakeargs=&lt;arguments&gt;           One or more optional CMake flags (e.g. --cmakeargs=&quot;-DFOO=bar -DCMAKE_PREFIX_PATH=/usr/local&quot;)
134 
135   --minimal                         No optional features, unless explicitly enabled
136   --no-experimental-features        No experimental features, unless explicitly enabled (CMake only)
137 
138   --only-webkit                     Build only the WebKit project
139 
140   --skip-library-update             Skip the check to see if windows libraries are up to date
141 
142   --[no-]use-ccache                 Enable (or disable) CCache, if available
143 
</pre>
<hr />
<pre>
175 if ($showHelp) {
176    print STDERR $usage;
177    exit 1;
178 }
179 
180 $ENV{&#39;VERBOSE&#39;} = 1 if $verbose;
181 
182 if ($useCCache == 1) {
183     $ENV{&#39;WK_USE_CCACHE&#39;} = &quot;YES&quot;;
184 } elsif ($useCCache == 0) {
185     $ENV{&#39;WK_USE_CCACHE&#39;} = &quot;NO&quot;;
186 }
187 
188 
189 my $productDir = productDir();
190 
191 # Check that all the project directories are there.
192 my @projects = (&quot;Source/JavaScriptCore&quot;, &quot;Source/WebCore&quot;, &quot;Source/WebKitLegacy&quot;);
193 
194 # Build WTF as a separate static library on ports which support it.
<span class="line-modified">195 splice @projects, 0, 0, &quot;Source/WTF&quot; if isAppleWebKit() or isWinCairo() or isFTW();</span>
196 
197 splice @projects, 0, 0, &quot;Source/bmalloc&quot; if isAppleCocoaWebKit();
198 
199 # Ports using CMake will check if directories exist in the CMake configuration.
200 if (!isCMakeBuild()) {
201     for my $dir (@projects) {
202         if (! -d $dir) {
203             die &quot;Error: No $dir directory found. Please do a fresh checkout.\n&quot;;
204         }
205     }
206 }
207 
<span class="line-modified">208 if ((isAppleWebKit() || isWinCairo() || isPlayStation() || isFTW()) &amp;&amp; !-d &quot;WebKitLibraries&quot;) {</span>
209     die &quot;Error: No WebKitLibraries directory found. Please do a fresh checkout.\n&quot;;
210 }
211 
212 my @options = ();
213 
214 if (isAppleCocoaWebKit()) {
215     push @options, XcodeOptions();
216 
217     if (not defined $xcbuild) {
218         $xcbuild = canUseXCBuild();
219     }
220 
221     if ($xcbuild) {
222         push @options, &quot;-UseNewBuildSystem=YES&quot;;
223         push @options, &quot;USE_NEW_BUILD_SYSTEM=YES&quot;;
224     } else {
225         push @options, &quot;-UseNewBuildSystem=NO&quot;;
226     }
227 
228     sub option($$)
</pre>
<hr />
<pre>
247     push @projects, (&quot;Source/WebKit&quot;);
248 
249     if (!isIOSWebKit()) {
250         push @projects, (&quot;Tools/MiniBrowser&quot;);
251 
252         # WebInspectorUI must come after JavaScriptCore and WebCore but before WebKit and WebKit2
253         my $webKitIndex = first { $projects[$_] eq &quot;Source/WebKitLegacy&quot; } 0..$#projects;
254         splice(@projects, $webKitIndex, 0, &quot;Source/WebInspectorUI&quot;);
255 
256         # Copy library and header from WebKitLibraries to a findable place in the product directory.
257         my @copyLibrariesArgs = (&quot;perl&quot;, &quot;Tools/Scripts/copy-webkitlibraries-to-product-directory&quot;, &quot;--wksi&quot;,  productDir());
258         print(join(&quot; &quot;, @copyLibrariesArgs) . &quot;\n&quot;);
259         (system(@copyLibrariesArgs) == 0) or die;
260     } else {
261         my @copyLibrariesArgs = (&quot;perl&quot;, &quot;Tools/Scripts/copy-webkitlibraries-to-product-directory&quot;, &quot;--sdk&quot;, xcodeSDK(), &quot;--wksi&quot;);
262         push @copyLibrariesArgs, productDir();
263         print(join(&quot; &quot;, @copyLibrariesArgs) . &quot;\n&quot;);
264         (system(@copyLibrariesArgs) == 0) or die;
265     }
266 
<span class="line-added">267     if (isAppleMacWebKit()) {</span>
<span class="line-added">268         push @projects, (&quot;Tools/lldb/lldbWebKitTester&quot;);</span>
<span class="line-added">269     }</span>
<span class="line-added">270 </span>
271     # Build Tools needed for Apple ports
272     push @projects, (&quot;Tools/DumpRenderTree&quot;, &quot;Tools/WebKitTestRunner&quot;, &quot;Source/ThirdParty/gtest&quot;, &quot;Tools/TestWebKitAPI&quot;);
273 
274 } elsif (isWinCairo() &amp;&amp; !$skipLibraryUpdate) {
275     (system(&quot;python Tools/Scripts/update-webkit-wincairo-libs.py&quot;) == 0) or die;
276 } elsif (isAppleWinWebKit() &amp;&amp; !$skipLibraryUpdate) {
277     # Copy WebKitSupportLibrary to the correct location in WebKitLibraries so it can be found.
278     # Will fail if WebKitSupportLibrary.zip is not in source root.
279     (system(&quot;perl Tools/Scripts/update-webkit-support-libs&quot;) == 0) or die;
280     (system(&quot;perl Tools/Scripts/update-webkit-auxiliary-libs&quot;) == 0) or die;
281     setupAppleWinEnv()
282 }
283 
284 # If asked to build just the WebKit project, overwrite the projects
285 # list after all of the port specific tweaks have been made to
286 # build options, etc.
287 @projects = (&quot;Source/WebKitLegacy&quot;) if $onlyWebKitProject;
288 
289 my $result = 0;
290 
</pre>
<hr />
<pre>
296 if (isCMakeBuild()) {
297     if ((!canUseNinja() || defined($ENV{NUMBER_OF_PROCESSORS})) &amp;&amp; !(isJava() &amp;&amp; isAnyWindows())) {
298         # If the user environment is not setting a specific number of process,
299         # then don&#39;t pass the number of jobs to Ninja. Because Ninja will
300         # automatically determine the number of jobs to run in parallel.
301         $makeArgs .= ($makeArgs ? &quot; &quot; : &quot;&quot;) . &quot;-j&quot; . numberOfCPUs() if $makeArgs !~ /-j\s*\d+/;
302     }
303 
304     my $maxCPULoad = maxCPULoad() if $makeArgs !~ /-l\s*\d+\.?\d*/;
305     $makeArgs .= &quot; -l&quot; . maxCPULoad() if defined $maxCPULoad;
306 
307     # We remove CMakeCache to avoid the bots reusing cached flags when
308     # we enable new features. This forces a reconfiguration.
309     my @featureArgs = cmakeArgsFromFeatures(@features, !$noExperimentalFeatures);
310     removeCMakeCache(@featureArgs);
311 
312     buildCMakeProjectOrExit($clean, $prefixPath, $makeArgs, @featureArgs, @cmakeArgs);
313 }
314 
315 my $baseProductDir = baseProductDir();
<span class="line-modified">316 if (isAppleWinWebKit() || isWinCairo() || isPlayStation() || isFTW()) {</span>
317     my @featureArgs = cmakeArgsFromFeatures(@features, !$noExperimentalFeatures);
318     removeCMakeCache(@featureArgs);
319 
320     chdirWebKit();
321     if (exitStatus(generateBuildSystemFromCMakeProject($prefixPath, @featureArgs, @cmakeArgs))) {
322         die &quot;Run Visual Studio 2017 installation vcvars.bat before build-webkit when using ninja&quot;;
323     }
324 
325     exit 0 if isGenerateProjectOnly();
326 
327     chdirWebKit();
328     if (canUseNinja()) {
329         chdir File::Spec-&gt;catdir($baseProductDir, configuration());
330         $result = system(&quot;ninja&quot;);
331     } else {
332         $result = buildVisualStudioProject(File::Spec-&gt;catfile($baseProductDir, configuration(), &quot;WebKit.sln&quot;), $clean);
333     }
334     if (exitStatus($result)) {
335         my $scriptDir = relativeScriptsDir();
<span class="line-modified">336         if (isAppleWinWebKit() || isWinCairo() || isFTW()) {</span>
337             print &quot;\n\n===== BUILD FAILED ======\n\n&quot;;
338             print &quot;Please ensure you have run $scriptDir/update-webkit to install dependencies.\n\n&quot;;
339             print &quot;You can view build errors by checking the BuildLog.htm files located at:\n$baseProductDir/obj/&lt;project&gt;/&lt;config&gt;.\n&quot;;
340         }
341         exit exitStatus($result);
342     }
343 } elsif (isAppleCocoaWebKit() &amp;&amp; !isCMakeBuild()) {
344     exit 0 if isGenerateProjectOnly();
345 
346     # Build, and abort if the build fails.
347     for my $dir (@projects) {
348         chdir $dir or die;
349         $result = 0;
350 
351         my $project = basename($dir);
352         
353         my @local_options = @options;
354         push @local_options, XcodeCoverageSupportOptions() if $coverageSupport;
355         push @local_options, XcodeStaticAnalyzerOption() if $shouldRunStaticAnalyzer;
356         push @local_options, &quot;WK_LTO_MODE=$ltoMode&quot; if ($ltoMode ne &quot;default&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../DumpRenderTree/java/TestRunnerJava.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="set-webkit-configuration.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>