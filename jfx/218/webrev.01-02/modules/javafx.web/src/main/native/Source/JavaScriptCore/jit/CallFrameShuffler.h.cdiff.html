<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/CallFrameShuffler.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CallFrameShuffler.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CallFrameShuffler64.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/CallFrameShuffler.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (C) 2015 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (C) 2015-2019 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
</pre>
<hr />
<pre>
<span class="line-old-header">*** 103,11 ***</span>
          data.numLocals = numLocals();
          data.numPassedArgs = m_numPassedArgs;
          data.callee = getNew(VirtualRegister { CallFrameSlot::callee })-&gt;recovery();
          data.args.resize(argCount());
          for (size_t i = 0; i &lt; argCount(); ++i)
<span class="line-modified">!             data.args[i] = getNew(virtualRegisterForArgument(i))-&gt;recovery();</span>
          for (Reg reg = Reg::first(); reg &lt;= Reg::last(); reg = reg.next()) {
              CachedRecovery* cachedRecovery { m_newRegisters[reg] };
              if (!cachedRecovery)
                  continue;
  
<span class="line-new-header">--- 103,11 ---</span>
          data.numLocals = numLocals();
          data.numPassedArgs = m_numPassedArgs;
          data.callee = getNew(VirtualRegister { CallFrameSlot::callee })-&gt;recovery();
          data.args.resize(argCount());
          for (size_t i = 0; i &lt; argCount(); ++i)
<span class="line-modified">!             data.args[i] = getNew(virtualRegisterForArgumentIncludingThis(i))-&gt;recovery();</span>
          for (Reg reg = Reg::first(); reg &lt;= Reg::last(); reg = reg.next()) {
              CachedRecovery* cachedRecovery { m_newRegisters[reg] };
              if (!cachedRecovery)
                  continue;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 126,11 ***</span>
      // this would crash 32bits platforms.
      void setCalleeJSValueRegs(JSValueRegs jsValueRegs)
      {
          ASSERT(isUndecided());
          ASSERT(!getNew(jsValueRegs));
<span class="line-modified">!         CachedRecovery* cachedRecovery { getNew(VirtualRegister(CallFrameSlot::callee)) };</span>
          ASSERT(cachedRecovery);
          addNew(jsValueRegs, cachedRecovery-&gt;recovery());
      }
  
      // Ask the suhffler to assume the callee has already be checked to
<span class="line-new-header">--- 126,11 ---</span>
      // this would crash 32bits platforms.
      void setCalleeJSValueRegs(JSValueRegs jsValueRegs)
      {
          ASSERT(isUndecided());
          ASSERT(!getNew(jsValueRegs));
<span class="line-modified">!         CachedRecovery* cachedRecovery { getNew(CallFrameSlot::callee) };</span>
          ASSERT(cachedRecovery);
          addNew(jsValueRegs, cachedRecovery-&gt;recovery());
      }
  
      // Ask the suhffler to assume the callee has already be checked to
</pre>
<hr />
<pre>
<span class="line-old-header">*** 139,11 ***</span>
      // You obviously must have ensured that this is the case before
      // running any of the prepare methods.
      void assumeCalleeIsCell()
      {
  #if USE(JSVALUE32_64)
<span class="line-modified">!         CachedRecovery&amp; calleeCachedRecovery = *getNew(VirtualRegister(CallFrameSlot::callee));</span>
          switch (calleeCachedRecovery.recovery().technique()) {
          case InPair:
              updateRecovery(
                  calleeCachedRecovery,
                  ValueRecovery::inGPR(
<span class="line-new-header">--- 139,11 ---</span>
      // You obviously must have ensured that this is the case before
      // running any of the prepare methods.
      void assumeCalleeIsCell()
      {
  #if USE(JSVALUE32_64)
<span class="line-modified">!         CachedRecovery&amp; calleeCachedRecovery = *getNew(CallFrameSlot::callee);</span>
          switch (calleeCachedRecovery.recovery().technique()) {
          case InPair:
              updateRecovery(
                  calleeCachedRecovery,
                  ValueRecovery::inGPR(
</pre>
<hr />
<pre>
<span class="line-old-header">*** 183,11 ***</span>
      // to throw an exception in, or destroyed using
      // CCallHelpers::prepareForTailCallSlow() followed by a tail call.
      void prepareForSlowPath();
  
  private:
<span class="line-modified">!     static const bool verbose = false;</span>
  
      CCallHelpers&amp; m_jit;
  
      void prepareAny();
  
<span class="line-new-header">--- 183,11 ---</span>
      // to throw an exception in, or destroyed using
      // CCallHelpers::prepareForTailCallSlow() followed by a tail call.
      void prepareForSlowPath();
  
  private:
<span class="line-modified">!     static constexpr bool verbose = false;</span>
  
      CCallHelpers&amp; m_jit;
  
      void prepareAny();
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 410,13 ***</span>
      // CachedRecovery means we can trash the current value as we don&#39;t
      // care about it.
      RegisterMap&lt;CachedRecovery*&gt; m_registers;
  
  #if USE(JSVALUE64)
<span class="line-modified">!     mutable GPRReg m_tagTypeNumber;</span>
  
<span class="line-modified">!     bool tryAcquireTagTypeNumber();</span>
  #endif
  
      // This stores, for each register, information about the recovery
      // for the value that should eventually go into that register. The
      // only registers that have a target recovery will be callee-save
<span class="line-new-header">--- 410,13 ---</span>
      // CachedRecovery means we can trash the current value as we don&#39;t
      // care about it.
      RegisterMap&lt;CachedRecovery*&gt; m_registers;
  
  #if USE(JSVALUE64)
<span class="line-modified">!     mutable GPRReg m_numberTagRegister;</span>
  
<span class="line-modified">!     bool tryAcquireNumberTagRegister();</span>
  #endif
  
      // This stores, for each register, information about the recovery
      // for the value that should eventually go into that register. The
      // only registers that have a target recovery will be callee-save
</pre>
<hr />
<pre>
<span class="line-old-header">*** 446,15 ***</span>
                      nonTemp = reg;
              }
          }
  
  #if USE(JSVALUE64)
<span class="line-modified">!         if (!nonTemp &amp;&amp; m_tagTypeNumber != InvalidGPRReg &amp;&amp; check(Reg { m_tagTypeNumber })) {</span>
<span class="line-modified">!             ASSERT(m_lockedRegisters.get(m_tagTypeNumber));</span>
<span class="line-modified">!             m_lockedRegisters.clear(m_tagTypeNumber);</span>
<span class="line-modified">!             nonTemp = Reg { m_tagTypeNumber };</span>
<span class="line-modified">!             m_tagTypeNumber = InvalidGPRReg;</span>
          }
  #endif
          return nonTemp;
      }
  
<span class="line-new-header">--- 446,15 ---</span>
                      nonTemp = reg;
              }
          }
  
  #if USE(JSVALUE64)
<span class="line-modified">!         if (!nonTemp &amp;&amp; m_numberTagRegister != InvalidGPRReg &amp;&amp; check(Reg { m_numberTagRegister })) {</span>
<span class="line-modified">!             ASSERT(m_lockedRegisters.get(m_numberTagRegister));</span>
<span class="line-modified">!             m_lockedRegisters.clear(m_numberTagRegister);</span>
<span class="line-modified">!             nonTemp = Reg { m_numberTagRegister };</span>
<span class="line-modified">!             m_numberTagRegister = InvalidGPRReg;</span>
          }
  #endif
          return nonTemp;
      }
  
</pre>
<center><a href="CallFrameShuffler.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CallFrameShuffler64.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>