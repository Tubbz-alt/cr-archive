<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/heap/HeapSnapshotBuilder.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HeapSnapshot.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HeapUtil.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/heap/HeapSnapshotBuilder.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 148,10 ***</span>
<span class="line-new-header">--- 148,12 ---</span>
  void HeapSnapshotBuilder::setOpaqueRootReachabilityReasonForCell(JSCell* cell, const char* reason)
  {
      if (!reason || !*reason || m_snapshotType != SnapshotType::GCDebuggingSnapshot)
          return;
  
<span class="line-added">+     std::lock_guard&lt;Lock&gt; lock(m_buildingEdgeMutex);</span>
<span class="line-added">+ </span>
      m_rootData.ensure(cell, [] () -&gt; RootData {
          return { };
      }).iterator-&gt;value.reachabilityFromOpaqueRootReasons = reason;
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 398,13 ***</span>
              // Skip calculating a class name if this object has a `constructor` own property.
              // These cases are typically F.prototype objects and we want to treat these as
              // &quot;Object&quot; in snapshots and not get the name of the prototype&#39;s parent.
              JSObject* object = asObject(node.cell);
              if (JSGlobalObject* globalObject = object-&gt;globalObject(vm)) {
<span class="line-removed">-                 ExecState* exec = globalObject-&gt;globalExec();</span>
                  PropertySlot slot(object, PropertySlot::InternalMethodType::VMInquiry);
<span class="line-modified">!                 if (!object-&gt;getOwnPropertySlot(object, exec, vm.propertyNames-&gt;constructor, slot))</span>
                      className = JSObject::calculatedClassName(object);
              }
          }
  
          auto result = classNameIndexes.add(className, nextClassNameIndex);
<span class="line-new-header">--- 400,12 ---</span>
              // Skip calculating a class name if this object has a `constructor` own property.
              // These cases are typically F.prototype objects and we want to treat these as
              // &quot;Object&quot; in snapshots and not get the name of the prototype&#39;s parent.
              JSObject* object = asObject(node.cell);
              if (JSGlobalObject* globalObject = object-&gt;globalObject(vm)) {
                  PropertySlot slot(object, PropertySlot::InternalMethodType::VMInquiry);
<span class="line-modified">!                 if (!object-&gt;getOwnPropertySlot(object, globalObject, vm.propertyNames-&gt;constructor, slot))</span>
                      className = JSObject::calculatedClassName(object);
              }
          }
  
          auto result = classNameIndexes.add(className, nextClassNameIndex);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 461,13 ***</span>
          json.appendNumber(flags);
          if (m_snapshotType == SnapshotType::GCDebuggingSnapshot) {
              json.append(&#39;,&#39;);
              json.appendNumber(labelIndex);
              json.appendLiteral(&quot;,\&quot;0x&quot;);
<span class="line-modified">!             appendUnsignedAsHex(reinterpret_cast&lt;uintptr_t&gt;(node.cell), json, Lowercase);</span>
              json.appendLiteral(&quot;\&quot;,\&quot;0x&quot;);
<span class="line-modified">!             appendUnsignedAsHex(reinterpret_cast&lt;uintptr_t&gt;(wrappedAddress), json, Lowercase);</span>
              json.append(&#39;&quot;&#39;);
          }
      };
  
      bool firstEdge = true;
<span class="line-new-header">--- 462,13 ---</span>
          json.appendNumber(flags);
          if (m_snapshotType == SnapshotType::GCDebuggingSnapshot) {
              json.append(&#39;,&#39;);
              json.appendNumber(labelIndex);
              json.appendLiteral(&quot;,\&quot;0x&quot;);
<span class="line-modified">!             json.append(hex(reinterpret_cast&lt;uintptr_t&gt;(node.cell), Lowercase));</span>
              json.appendLiteral(&quot;\&quot;,\&quot;0x&quot;);
<span class="line-modified">!             json.append(hex(reinterpret_cast&lt;uintptr_t&gt;(wrappedAddress), Lowercase));</span>
              json.append(&#39;&quot;&#39;);
          }
      };
  
      bool firstEdge = true;
</pre>
<center><a href="HeapSnapshot.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HeapUtil.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>