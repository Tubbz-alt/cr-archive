<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSTypedArrayViewPrototype.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2015-2019 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;JSTypedArrayViewPrototype.h&quot;
 28 
 29 #include &quot;BuiltinNames.h&quot;
 30 #include &quot;CallFrame.h&quot;
 31 #include &quot;GetterSetter.h&quot;
<a name="1" id="anc1"></a><span class="line-added"> 32 #include &quot;JSArrayIterator.h&quot;</span>
 33 #include &quot;JSCInlines.h&quot;
 34 #include &quot;JSFunction.h&quot;
 35 #include &quot;JSGenericTypedArrayViewPrototypeFunctions.h&quot;
 36 #include &quot;JSObjectInlines.h&quot;
 37 #include &quot;TypedArrayAdaptors.h&quot;
 38 
 39 namespace JSC {
 40 
 41 #define CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(functionName) do {                           \
<a name="2" id="anc2"></a><span class="line-modified"> 42     switch (thisValue.getObject()-&gt;classInfo(vm)-&gt;typedArrayStorageType) {                      \</span>
 43     case TypeUint8Clamped:                                                                      \
<a name="3" id="anc3"></a><span class="line-modified"> 44         return functionName&lt;JSUint8ClampedArray&gt;(vm, globalObject, callFrame);                  \</span>
 45     case TypeInt32:                                                                             \
<a name="4" id="anc4"></a><span class="line-modified"> 46         return functionName&lt;JSInt32Array&gt;(vm, globalObject, callFrame);                         \</span>
 47     case TypeUint32:                                                                            \
<a name="5" id="anc5"></a><span class="line-modified"> 48         return functionName&lt;JSUint32Array&gt;(vm, globalObject, callFrame);                        \</span>
 49     case TypeFloat64:                                                                           \
<a name="6" id="anc6"></a><span class="line-modified"> 50         return functionName&lt;JSFloat64Array&gt;(vm, globalObject, callFrame);                       \</span>
 51     case TypeFloat32:                                                                           \
<a name="7" id="anc7"></a><span class="line-modified"> 52         return functionName&lt;JSFloat32Array&gt;(vm, globalObject, callFrame);                       \</span>
 53     case TypeInt8:                                                                              \
<a name="8" id="anc8"></a><span class="line-modified"> 54         return functionName&lt;JSInt8Array&gt;(vm, globalObject, callFrame);                          \</span>
 55     case TypeUint8:                                                                             \
<a name="9" id="anc9"></a><span class="line-modified"> 56         return functionName&lt;JSUint8Array&gt;(vm, globalObject, callFrame);                         \</span>
 57     case TypeInt16:                                                                             \
<a name="10" id="anc10"></a><span class="line-modified"> 58         return functionName&lt;JSInt16Array&gt;(vm, globalObject, callFrame);                         \</span>
 59     case TypeUint16:                                                                            \
<a name="11" id="anc11"></a><span class="line-modified"> 60         return functionName&lt;JSUint16Array&gt;(vm, globalObject, callFrame);                        \</span>
 61     case NotTypedArray:                                                                         \
 62     case TypeDataView:                                                                          \
<a name="12" id="anc12"></a><span class="line-modified"> 63         return throwVMTypeError(globalObject, scope,                                            \</span>
<span class="line-modified"> 64             &quot;Receiver should be a typed array view&quot;_s);                                         \</span>
 65     }                                                                                           \
 66     RELEASE_ASSERT_NOT_REACHED();                                                               \
 67 } while (false)
 68 
<a name="13" id="anc13"></a><span class="line-modified"> 69 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncIsTypedArrayView(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
 70 {
<a name="14" id="anc14"></a><span class="line-modified"> 71     JSValue value = callFrame-&gt;uncheckedArgument(0);</span>
<span class="line-modified"> 72     return JSValue::encode(jsBoolean(value.isCell() &amp;&amp; isTypedView(value.asCell()-&gt;classInfo(globalObject-&gt;vm())-&gt;typedArrayStorageType)));</span>
 73 }
 74 
<a name="15" id="anc15"></a><span class="line-modified"> 75 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncLength(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
 76 {
<a name="16" id="anc16"></a><span class="line-modified"> 77     VM&amp; vm = globalObject-&gt;vm();</span>
 78     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="17" id="anc17"></a><span class="line-modified"> 79     JSValue argument = callFrame-&gt;argument(0);</span>
 80     if (!argument.isCell() || !isTypedView(argument.asCell()-&gt;classInfo(vm)-&gt;typedArrayStorageType))
<a name="18" id="anc18"></a><span class="line-modified"> 81         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view&quot;_s);</span>
 82 
 83     JSArrayBufferView* thisObject = jsCast&lt;JSArrayBufferView*&gt;(argument);
 84 
 85     if (thisObject-&gt;isNeutered())
<a name="19" id="anc19"></a><span class="line-modified"> 86         return throwVMTypeError(globalObject, scope, &quot;Underlying ArrayBuffer has been detached from the view&quot;_s);</span>
 87 
 88     return JSValue::encode(jsNumber(thisObject-&gt;length()));
 89 }
 90 
<a name="20" id="anc20"></a><span class="line-modified"> 91 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncGetOriginalConstructor(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
 92 {
<a name="21" id="anc21"></a><span class="line-modified"> 93     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified"> 94     TypedArrayType type = callFrame-&gt;uncheckedArgument(0).getObject()-&gt;classInfo(vm)-&gt;typedArrayStorageType;</span>

 95     ASSERT(isTypedView(type));
 96     return JSValue::encode(globalObject-&gt;typedArrayConstructor(type));
 97 }
 98 
<a name="22" id="anc22"></a><span class="line-modified"> 99 inline EncodedJSValue createTypedArrayIteratorObject(JSGlobalObject* globalObject, CallFrame* callFrame, IterationKind kind)</span>
100 {
<a name="23" id="anc23"></a><span class="line-modified">101     VM&amp; vm = globalObject-&gt;vm();</span>
102     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="24" id="anc24"></a><span class="line-modified">103 </span>
<span class="line-added">104     if (!callFrame-&gt;thisValue().isCell() || !isTypedArrayType(callFrame-&gt;thisValue().asCell()-&gt;type()))</span>
<span class="line-added">105         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view&quot;_s);</span>
<span class="line-added">106 </span>
<span class="line-added">107     JSArrayBufferView* thisObject = jsCast&lt;JSArrayBufferView*&gt;(callFrame-&gt;thisValue());</span>
<span class="line-added">108 </span>
<span class="line-added">109     if (thisObject-&gt;isNeutered())</span>
<span class="line-added">110         return throwVMTypeError(globalObject, scope, &quot;Underlying ArrayBuffer has been detached from the view&quot;_s);</span>
<span class="line-added">111 </span>
<span class="line-added">112     return JSValue::encode(JSArrayIterator::create(vm, globalObject-&gt;arrayIteratorStructure(), thisObject, jsNumber(static_cast&lt;unsigned&gt;(kind))));</span>
<span class="line-added">113 }</span>
<span class="line-added">114 </span>
<span class="line-added">115 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncValues(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
<span class="line-added">116 {</span>
<span class="line-added">117     return createTypedArrayIteratorObject(globalObject, callFrame, IterationKind::Values);</span>
<span class="line-added">118 }</span>
<span class="line-added">119 </span>
<span class="line-added">120 static EncodedJSValue JSC_HOST_CALL typedArrayProtoViewFuncEntries(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
<span class="line-added">121 {</span>
<span class="line-added">122     return createTypedArrayIteratorObject(globalObject, callFrame, IterationKind::Entries);</span>
<span class="line-added">123 }</span>
<span class="line-added">124 </span>
<span class="line-added">125 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncKeys(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
<span class="line-added">126 {</span>
<span class="line-added">127     return createTypedArrayIteratorObject(globalObject, callFrame, IterationKind::Keys);</span>
<span class="line-added">128 }</span>
<span class="line-added">129 </span>
<span class="line-added">130 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncSort(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
<span class="line-added">131 {</span>
<span class="line-added">132     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-added">133     auto scope = DECLARE_THROW_SCOPE(vm);</span>
<span class="line-added">134     JSValue thisValue = callFrame-&gt;argument(0);</span>
135     scope.release();
136     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewPrivateFuncSort);
137 }
138 
<a name="25" id="anc25"></a><span class="line-modified">139 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncSet(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
140 {
<a name="26" id="anc26"></a><span class="line-modified">141     VM&amp; vm = globalObject-&gt;vm();</span>
142     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="27" id="anc27"></a><span class="line-modified">143     JSValue thisValue = callFrame-&gt;thisValue();</span>
144     if (UNLIKELY(!thisValue.isObject()))
<a name="28" id="anc28"></a><span class="line-modified">145         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
146     scope.release();
147     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncSet);
148 }
149 
<a name="29" id="anc29"></a><span class="line-modified">150 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncCopyWithin(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
151 {
<a name="30" id="anc30"></a><span class="line-modified">152     VM&amp; vm = globalObject-&gt;vm();</span>
153     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="31" id="anc31"></a><span class="line-modified">154     JSValue thisValue = callFrame-&gt;thisValue();</span>
155     if (!thisValue.isObject())
<a name="32" id="anc32"></a><span class="line-modified">156         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
157     scope.release();
158     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncCopyWithin);
159 }
160 
<a name="33" id="anc33"></a><span class="line-modified">161 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncIncludes(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
162 {
<a name="34" id="anc34"></a><span class="line-modified">163     VM&amp; vm = globalObject-&gt;vm();</span>
164     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="35" id="anc35"></a><span class="line-modified">165     JSValue thisValue = callFrame-&gt;thisValue();</span>
166     if (!thisValue.isObject())
<a name="36" id="anc36"></a><span class="line-modified">167         return throwVMError(globalObject, scope, createTypeError(globalObject, &quot;Receiver should be a typed array view but was not an object&quot;));</span>
168     scope.release();
169     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncIncludes);
170 }
171 
<a name="37" id="anc37"></a><span class="line-modified">172 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncLastIndexOf(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
173 {
<a name="38" id="anc38"></a><span class="line-modified">174     VM&amp; vm = globalObject-&gt;vm();</span>
175     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="39" id="anc39"></a><span class="line-modified">176     JSValue thisValue = callFrame-&gt;thisValue();</span>
177     if (!thisValue.isObject())
<a name="40" id="anc40"></a><span class="line-modified">178         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
179     scope.release();
180     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncLastIndexOf);
181 }
182 
<a name="41" id="anc41"></a><span class="line-modified">183 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncIndexOf(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
184 {
<a name="42" id="anc42"></a><span class="line-modified">185     VM&amp; vm = globalObject-&gt;vm();</span>
186     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="43" id="anc43"></a><span class="line-modified">187     JSValue thisValue = callFrame-&gt;thisValue();</span>
188     if (!thisValue.isObject())
<a name="44" id="anc44"></a><span class="line-modified">189         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
190     scope.release();
191     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncIndexOf);
192 }
193 
<a name="45" id="anc45"></a><span class="line-modified">194 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncJoin(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
195 {
<a name="46" id="anc46"></a><span class="line-modified">196     VM&amp; vm = globalObject-&gt;vm();</span>
197     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="47" id="anc47"></a><span class="line-modified">198     JSValue thisValue = callFrame-&gt;thisValue();</span>
199     if (!thisValue.isObject())
<a name="48" id="anc48"></a><span class="line-modified">200         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
201     scope.release();
202     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncJoin);
203 }
204 
<a name="49" id="anc49"></a><span class="line-modified">205 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncBuffer(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
206 {
<a name="50" id="anc50"></a><span class="line-modified">207     VM&amp; vm = globalObject-&gt;vm();</span>
208     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="51" id="anc51"></a><span class="line-modified">209     JSValue thisValue = callFrame-&gt;thisValue();</span>
210     if (!thisValue.isObject())
<a name="52" id="anc52"></a><span class="line-modified">211         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
212     scope.release();
213     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncBuffer);
214 }
215 
<a name="53" id="anc53"></a><span class="line-modified">216 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncLength(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
217 {
<a name="54" id="anc54"></a><span class="line-modified">218     VM&amp; vm = globalObject-&gt;vm();</span>
219     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="55" id="anc55"></a><span class="line-modified">220     JSValue thisValue = callFrame-&gt;thisValue();</span>
221     if (!thisValue.isObject())
<a name="56" id="anc56"></a><span class="line-modified">222         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
223     scope.release();
224     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncLength);
225 }
226 
<a name="57" id="anc57"></a><span class="line-modified">227 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncByteLength(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
228 {
<a name="58" id="anc58"></a><span class="line-modified">229     VM&amp; vm = globalObject-&gt;vm();</span>
230     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="59" id="anc59"></a><span class="line-modified">231     JSValue thisValue = callFrame-&gt;thisValue();</span>
232     if (!thisValue.isObject())
<a name="60" id="anc60"></a><span class="line-modified">233         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
234     scope.release();
235     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncByteLength);
236 }
237 
<a name="61" id="anc61"></a><span class="line-modified">238 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncByteOffset(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
239 {
<a name="62" id="anc62"></a><span class="line-modified">240     VM&amp; vm = globalObject-&gt;vm();</span>
241     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="63" id="anc63"></a><span class="line-modified">242     JSValue thisValue = callFrame-&gt;thisValue();</span>
243     if (!thisValue.isObject())
<a name="64" id="anc64"></a><span class="line-modified">244         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
245     scope.release();
246     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncByteOffset);
247 }
248 
<a name="65" id="anc65"></a><span class="line-modified">249 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncReverse(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
250 {
<a name="66" id="anc66"></a><span class="line-modified">251     VM&amp; vm = globalObject-&gt;vm();</span>
252     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="67" id="anc67"></a><span class="line-modified">253     JSValue thisValue = callFrame-&gt;thisValue();</span>
254     if (!thisValue.isObject())
<a name="68" id="anc68"></a><span class="line-modified">255         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
256     scope.release();
257     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncReverse);
258 }
259 
<a name="69" id="anc69"></a><span class="line-modified">260 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncSubarrayCreate(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
261 {
<a name="70" id="anc70"></a><span class="line-modified">262     VM&amp; vm = globalObject-&gt;vm();</span>
263     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="71" id="anc71"></a><span class="line-modified">264     JSValue thisValue = callFrame-&gt;thisValue();</span>
265     if (!thisValue.isObject())
<a name="72" id="anc72"></a><span class="line-modified">266         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
267     scope.release();
268     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewPrivateFuncSubarrayCreate);
269 }
270 
<a name="73" id="anc73"></a><span class="line-modified">271 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncSlice(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
272 {
<a name="74" id="anc74"></a><span class="line-modified">273     VM&amp; vm = globalObject-&gt;vm();</span>
274     auto scope = DECLARE_THROW_SCOPE(vm);
<a name="75" id="anc75"></a><span class="line-modified">275     JSValue thisValue = callFrame-&gt;thisValue();</span>
276     if (!thisValue.isObject())
<a name="76" id="anc76"></a><span class="line-modified">277         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
278     scope.release();
279     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncSlice);
280 }
281 
<a name="77" id="anc77"></a><span class="line-modified">282 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncToStringTag(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
283 {
<a name="78" id="anc78"></a><span class="line-modified">284     JSValue thisValue = callFrame-&gt;thisValue();</span>
285     if (!thisValue.isObject())
286         return JSValue::encode(jsUndefined());
287 
<a name="79" id="anc79"></a><span class="line-modified">288     VM&amp; vm = globalObject-&gt;vm();</span>
289     switch (thisValue.getObject()-&gt;classInfo(vm)-&gt;typedArrayStorageType) {
290     case TypeUint8Clamped:
<a name="80" id="anc80"></a><span class="line-modified">291         return JSValue::encode(jsNontrivialString(vm, &quot;Uint8ClampedArray&quot;_s));</span>
292     case TypeInt32:
<a name="81" id="anc81"></a><span class="line-modified">293         return JSValue::encode(jsNontrivialString(vm, &quot;Int32Array&quot;_s));</span>
294     case TypeUint32:
<a name="82" id="anc82"></a><span class="line-modified">295         return JSValue::encode(jsNontrivialString(vm, &quot;Uint32Array&quot;_s));</span>
296     case TypeFloat64:
<a name="83" id="anc83"></a><span class="line-modified">297         return JSValue::encode(jsNontrivialString(vm, &quot;Float64Array&quot;_s));</span>
298     case TypeFloat32:
<a name="84" id="anc84"></a><span class="line-modified">299         return JSValue::encode(jsNontrivialString(vm, &quot;Float32Array&quot;_s));</span>
300     case TypeInt8:
<a name="85" id="anc85"></a><span class="line-modified">301         return JSValue::encode(jsNontrivialString(vm, &quot;Int8Array&quot;_s));</span>
302     case TypeUint8:
<a name="86" id="anc86"></a><span class="line-modified">303         return JSValue::encode(jsNontrivialString(vm, &quot;Uint8Array&quot;_s));</span>
304     case TypeInt16:
<a name="87" id="anc87"></a><span class="line-modified">305         return JSValue::encode(jsNontrivialString(vm, &quot;Int16Array&quot;_s));</span>
306     case TypeUint16:
<a name="88" id="anc88"></a><span class="line-modified">307         return JSValue::encode(jsNontrivialString(vm, &quot;Uint16Array&quot;_s));</span>
308     case NotTypedArray:
309     case TypeDataView:
310         return JSValue::encode(jsUndefined());
311     }
312     RELEASE_ASSERT_NOT_REACHED();
313 }
314 
315 
316 #undef CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION
317 
318 JSTypedArrayViewPrototype::JSTypedArrayViewPrototype(VM&amp; vm, Structure* structure)
319     : Base(vm, structure)
320 {
321 }
322 
323 void JSTypedArrayViewPrototype::finishCreation(VM&amp; vm, JSGlobalObject* globalObject)
324 {
325     Base::finishCreation(vm);
326 
327     ASSERT(inherits(vm, info()));
328 
329     putDirectWithoutTransition(vm, vm.propertyNames-&gt;toString, globalObject-&gt;arrayProtoToStringFunction(), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
330 
331     JSC_NATIVE_GETTER_WITHOUT_TRANSITION(&quot;buffer&quot;, typedArrayViewProtoGetterFuncBuffer, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
332     JSC_NATIVE_INTRINSIC_GETTER_WITHOUT_TRANSITION(vm.propertyNames-&gt;byteLength, typedArrayViewProtoGetterFuncByteLength, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly, TypedArrayByteLengthIntrinsic);
333     JSC_NATIVE_INTRINSIC_GETTER_WITHOUT_TRANSITION(vm.propertyNames-&gt;byteOffset, typedArrayViewProtoGetterFuncByteOffset, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly, TypedArrayByteOffsetIntrinsic);
334     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;copyWithin&quot;, typedArrayViewProtoFuncCopyWithin, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 2);
335     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;every&quot;, typedArrayPrototypeEveryCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
336     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;filter&quot;, typedArrayPrototypeFilterCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
337     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;sort&quot;, typedArrayPrototypeSortCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
<a name="89" id="anc89"></a><span class="line-modified">338     JSC_NATIVE_INTRINSIC_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;entries, typedArrayProtoViewFuncEntries, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 0, TypedArrayEntriesIntrinsic);</span>
339     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;includes&quot;, typedArrayViewProtoFuncIncludes, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
340     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;fill&quot;, typedArrayPrototypeFillCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
341     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;find&quot;, typedArrayPrototypeFindCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
342     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;findIndex&quot;, typedArrayPrototypeFindIndexCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
343     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;forEach, typedArrayPrototypeForEachCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
344     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;indexOf&quot;, typedArrayViewProtoFuncIndexOf, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
345     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;join, typedArrayViewProtoFuncJoin, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
<a name="90" id="anc90"></a><span class="line-modified">346     JSC_NATIVE_INTRINSIC_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;keys, typedArrayViewProtoFuncKeys, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 0, TypedArrayKeysIntrinsic);</span>
347     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;lastIndexOf&quot;, typedArrayViewProtoFuncLastIndexOf, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
348     JSC_NATIVE_INTRINSIC_GETTER_WITHOUT_TRANSITION(vm.propertyNames-&gt;length, typedArrayViewProtoGetterFuncLength, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum) | PropertyAttribute::ReadOnly, TypedArrayLengthIntrinsic);
349     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;map&quot;, typedArrayPrototypeMapCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
350     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;reduce&quot;, typedArrayPrototypeReduceCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
351     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;reduceRight&quot;, typedArrayPrototypeReduceRightCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
352     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;reverse&quot;, typedArrayViewProtoFuncReverse, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 0);
353     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;set, typedArrayViewProtoFuncSet, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
354     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;slice, typedArrayViewProtoFuncSlice, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 2);
355     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;some&quot;, typedArrayPrototypeSomeCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
356     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;subarray, typedArrayPrototypeSubarrayCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
357     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;toLocaleString, typedArrayPrototypeToLocaleStringCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
358 
359     JSFunction* toStringTagFunction = JSFunction::create(vm, globalObject, 0, &quot;get [Symbol.toStringTag]&quot;_s, typedArrayViewProtoGetterFuncToStringTag, NoIntrinsic);
360     GetterSetter* toStringTagAccessor = GetterSetter::create(vm, globalObject, toStringTagFunction, nullptr);
361     putDirectNonIndexAccessorWithoutTransition(vm, vm.propertyNames-&gt;toStringTagSymbol, toStringTagAccessor, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly | PropertyAttribute::Accessor);
362 
<a name="91" id="anc91"></a><span class="line-modified">363     JSFunction* valuesFunction = JSFunction::create(vm, globalObject, 0, vm.propertyNames-&gt;values.string(), typedArrayViewProtoFuncValues, TypedArrayValuesIntrinsic);</span>
364 
365     putDirectWithoutTransition(vm, vm.propertyNames-&gt;builtinNames().valuesPublicName(), valuesFunction, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
366     putDirectWithoutTransition(vm, vm.propertyNames-&gt;iteratorSymbol, valuesFunction, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
367 
368 }
369 
370 JSTypedArrayViewPrototype* JSTypedArrayViewPrototype::create(
371     VM&amp; vm, JSGlobalObject* globalObject, Structure* structure)
372 {
373     JSTypedArrayViewPrototype* prototype =
374         new (NotNull, allocateCell&lt;JSTypedArrayViewPrototype&gt;(vm.heap))
375         JSTypedArrayViewPrototype(vm, structure);
376     prototype-&gt;finishCreation(vm, globalObject);
377     return prototype;
378 }
379 
380 Structure* JSTypedArrayViewPrototype::createStructure(
381     VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
382 {
383     return Structure::create(vm, globalObject, prototype, TypeInfo(ObjectType, StructureFlags), info());
384 }
385 
386 } // namespace JSC
<a name="92" id="anc92"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="92" type="hidden" />
</body>
</html>