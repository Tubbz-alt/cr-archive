<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/loader/ResourceLoaderOptions.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ResourceLoader.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ResourceTimingInformation.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/loader/ResourceLoaderOptions.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 29,10 ***</span>
<span class="line-new-header">--- 29,11 ---</span>
   */
  
  #pragma once
  
  #include &quot;ContentSecurityPolicyResponseHeaders.h&quot;
<span class="line-added">+ #include &quot;CrossOriginAccessControl.h&quot;</span>
  #include &quot;FetchOptions.h&quot;
  #include &quot;HTTPHeaderNames.h&quot;
  #include &quot;ServiceWorkerTypes.h&quot;
  #include &quot;StoredCredentialsPolicy.h&quot;
  #include &lt;wtf/HashSet.h&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 43,135 ***</span>
  
  enum class SendCallbackPolicy : uint8_t {
      SendCallbacks,
      DoNotSendCallbacks
  };
  
  // FIXME: These options are named poorly. We only implement force disabling content sniffing, not enabling it,
  // and even that only on some platforms.
  enum class ContentSniffingPolicy : uint8_t {
      SniffContent,
      DoNotSniffContent
  };
  
  enum class DataBufferingPolicy : uint8_t {
      BufferData,
      DoNotBufferData
  };
  
  enum class SecurityCheckPolicy : uint8_t {
      SkipSecurityCheck,
      DoSecurityCheck
  };
  
  enum class CertificateInfoPolicy : uint8_t {
      IncludeCertificateInfo,
      DoNotIncludeCertificateInfo
  };
  
  enum class ContentSecurityPolicyImposition : uint8_t {
      SkipPolicyCheck,
      DoPolicyCheck
  };
  
  enum class DefersLoadingPolicy : uint8_t {
      AllowDefersLoading,
      DisallowDefersLoading
  };
  
  enum class CachingPolicy : uint8_t {
      AllowCaching,
      DisallowCaching
  };
  
  enum class ClientCredentialPolicy : uint8_t {
      CannotAskClientForCredentials,
      MayAskClientForCredentials
  };
  
  enum class SameOriginDataURLFlag : uint8_t {
      Set,
      Unset
  };
  
  enum class InitiatorContext : uint8_t {
      Document,
      Worker,
  };
  
  enum class ServiceWorkersMode : uint8_t {
      All,
      None,
      Only // An error will happen if service worker is not handling the fetch. Used to bypass preflight safely.
  };
  
  enum class ApplicationCacheMode : uint8_t {
      Use,
      Bypass
  };
  
  // FIXME: These options are named poorly. We only implement force disabling content encoding sniffing, not enabling it,
  // and even that only on some platforms.
  enum class ContentEncodingSniffingPolicy : uint8_t {
      Sniff,
      DoNotSniff,
  };
  
  enum class PreflightPolicy : uint8_t {
      Consider,
      Force,
      Prevent
  };
  
  enum class LoadedFromOpaqueSource : uint8_t {
      Yes,
      No
  };
  
  struct ResourceLoaderOptions : public FetchOptions {
<span class="line-modified">!     ResourceLoaderOptions() { }</span>
  
<span class="line-modified">!     ResourceLoaderOptions(FetchOptions options) : FetchOptions { WTFMove(options) } { }</span>
  
      ResourceLoaderOptions(SendCallbackPolicy sendLoadCallbacks, ContentSniffingPolicy sniffContent, DataBufferingPolicy dataBufferingPolicy, StoredCredentialsPolicy storedCredentialsPolicy, ClientCredentialPolicy credentialPolicy, FetchOptions::Credentials credentials, SecurityCheckPolicy securityCheck, FetchOptions::Mode mode, CertificateInfoPolicy certificateInfoPolicy, ContentSecurityPolicyImposition contentSecurityPolicyImposition, DefersLoadingPolicy defersLoadingPolicy, CachingPolicy cachingPolicy)
          : sendLoadCallbacks(sendLoadCallbacks)
          , sniffContent(sniffContent)
          , dataBufferingPolicy(dataBufferingPolicy)
          , storedCredentialsPolicy(storedCredentialsPolicy)
          , securityCheck(securityCheck)
          , certificateInfoPolicy(certificateInfoPolicy)
          , contentSecurityPolicyImposition(contentSecurityPolicyImposition)
          , defersLoadingPolicy(defersLoadingPolicy)
          , cachingPolicy(cachingPolicy)
          , clientCredentialPolicy(credentialPolicy)
      {
          this-&gt;credentials = credentials;
          this-&gt;mode = mode;
      }
  
  #if ENABLE(SERVICE_WORKER)
<span class="line-modified">!     Optional&lt;ServiceWorkerRegistrationIdentifier&gt; serviceWorkerRegistrationIdentifier;</span>
  #endif
<span class="line-modified">!     HashSet&lt;HTTPHeaderName, WTF::IntHash&lt;HTTPHeaderName&gt;, WTF::StrongEnumHashTraits&lt;HTTPHeaderName&gt;&gt; httpHeadersToKeep;</span>
<span class="line-modified">!     Optional&lt;ContentSecurityPolicyResponseHeaders&gt; cspResponseHeaders;</span>
<span class="line-modified">!     unsigned maxRedirectCount { 20 };</span>
<span class="line-modified">! </span>
<span class="line-modified">!     SendCallbackPolicy sendLoadCallbacks { SendCallbackPolicy::DoNotSendCallbacks };</span>
<span class="line-modified">!     ContentSniffingPolicy sniffContent { ContentSniffingPolicy::DoNotSniffContent };</span>
<span class="line-modified">!     ContentEncodingSniffingPolicy sniffContentEncoding { ContentEncodingSniffingPolicy::Sniff };</span>
<span class="line-modified">!     DataBufferingPolicy dataBufferingPolicy { DataBufferingPolicy::BufferData };</span>
<span class="line-modified">!     StoredCredentialsPolicy storedCredentialsPolicy { StoredCredentialsPolicy::DoNotUse };</span>
<span class="line-modified">!     SecurityCheckPolicy securityCheck { SecurityCheckPolicy::DoSecurityCheck };</span>
<span class="line-modified">!     CertificateInfoPolicy certificateInfoPolicy { CertificateInfoPolicy::DoNotIncludeCertificateInfo };</span>
<span class="line-modified">!     ContentSecurityPolicyImposition contentSecurityPolicyImposition { ContentSecurityPolicyImposition::DoPolicyCheck };</span>
<span class="line-modified">!     DefersLoadingPolicy defersLoadingPolicy { DefersLoadingPolicy::AllowDefersLoading };</span>
<span class="line-modified">!     CachingPolicy cachingPolicy { CachingPolicy::AllowCaching };</span>
<span class="line-modified">!     SameOriginDataURLFlag sameOriginDataURLFlag { SameOriginDataURLFlag::Unset };</span>
<span class="line-modified">!     InitiatorContext initiatorContext { InitiatorContext::Document };</span>
<span class="line-modified">!     ServiceWorkersMode serviceWorkersMode { ServiceWorkersMode::All };</span>
<span class="line-modified">!     ApplicationCacheMode applicationCacheMode { ApplicationCacheMode::Use };</span>
<span class="line-modified">!     ClientCredentialPolicy clientCredentialPolicy { ClientCredentialPolicy::CannotAskClientForCredentials };</span>
<span class="line-modified">!     PreflightPolicy preflightPolicy { PreflightPolicy::Consider };</span>
<span class="line-modified">!     LoadedFromOpaqueSource loadedFromOpaqueSource { LoadedFromOpaqueSource::No };</span>
  };
  
  } // namespace WebCore
<span class="line-new-header">--- 44,194 ---</span>
  
  enum class SendCallbackPolicy : uint8_t {
      SendCallbacks,
      DoNotSendCallbacks
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfSendCallbackPolicy = 1;</span>
  
  // FIXME: These options are named poorly. We only implement force disabling content sniffing, not enabling it,
  // and even that only on some platforms.
  enum class ContentSniffingPolicy : uint8_t {
      SniffContent,
      DoNotSniffContent
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfContentSniffingPolicy = 1;</span>
  
  enum class DataBufferingPolicy : uint8_t {
      BufferData,
      DoNotBufferData
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfDataBufferingPolicy = 1;</span>
  
  enum class SecurityCheckPolicy : uint8_t {
      SkipSecurityCheck,
      DoSecurityCheck
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfSecurityCheckPolicy = 1;</span>
  
  enum class CertificateInfoPolicy : uint8_t {
      IncludeCertificateInfo,
      DoNotIncludeCertificateInfo
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfCertificateInfoPolicy = 1;</span>
  
  enum class ContentSecurityPolicyImposition : uint8_t {
      SkipPolicyCheck,
      DoPolicyCheck
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfContentSecurityPolicyImposition = 1;</span>
  
  enum class DefersLoadingPolicy : uint8_t {
      AllowDefersLoading,
      DisallowDefersLoading
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfDefersLoadingPolicy = 1;</span>
  
  enum class CachingPolicy : uint8_t {
      AllowCaching,
      DisallowCaching
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfCachingPolicy = 1;</span>
  
  enum class ClientCredentialPolicy : uint8_t {
      CannotAskClientForCredentials,
      MayAskClientForCredentials
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfClientCredentialPolicy = 1;</span>
  
  enum class SameOriginDataURLFlag : uint8_t {
      Set,
      Unset
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfSameOriginDataURLFlag = 1;</span>
  
  enum class InitiatorContext : uint8_t {
      Document,
      Worker,
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfInitiatorContext = 1;</span>
  
  enum class ServiceWorkersMode : uint8_t {
      All,
      None,
      Only // An error will happen if service worker is not handling the fetch. Used to bypass preflight safely.
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfServiceWorkersMode = 2;</span>
  
  enum class ApplicationCacheMode : uint8_t {
      Use,
      Bypass
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfApplicationCacheMode = 1;</span>
  
  // FIXME: These options are named poorly. We only implement force disabling content encoding sniffing, not enabling it,
  // and even that only on some platforms.
  enum class ContentEncodingSniffingPolicy : uint8_t {
      Sniff,
      DoNotSniff,
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfContentEncodingSniffingPolicy = 1;</span>
  
  enum class PreflightPolicy : uint8_t {
      Consider,
      Force,
      Prevent
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfPreflightPolicy = 2;</span>
  
  enum class LoadedFromOpaqueSource : uint8_t {
      Yes,
      No
  };
<span class="line-added">+ static constexpr unsigned bitWidthOfLoadedFromOpaqueSource = 1;</span>
  
  struct ResourceLoaderOptions : public FetchOptions {
<span class="line-modified">!     ResourceLoaderOptions()</span>
<span class="line-added">+         : ResourceLoaderOptions(FetchOptions())</span>
<span class="line-added">+     {</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     ResourceLoaderOptions(FetchOptions options)</span>
<span class="line-added">+         : FetchOptions { WTFMove(options) }</span>
<span class="line-added">+         , sendLoadCallbacks(SendCallbackPolicy::DoNotSendCallbacks)</span>
<span class="line-added">+         , sniffContent(ContentSniffingPolicy::DoNotSniffContent)</span>
<span class="line-added">+         , sniffContentEncoding(ContentEncodingSniffingPolicy::Sniff)</span>
<span class="line-added">+         , dataBufferingPolicy(DataBufferingPolicy::BufferData)</span>
<span class="line-added">+         , storedCredentialsPolicy(StoredCredentialsPolicy::DoNotUse)</span>
<span class="line-added">+         , securityCheck(SecurityCheckPolicy::DoSecurityCheck)</span>
<span class="line-added">+         , certificateInfoPolicy(CertificateInfoPolicy::DoNotIncludeCertificateInfo)</span>
<span class="line-added">+         , contentSecurityPolicyImposition(ContentSecurityPolicyImposition::DoPolicyCheck)</span>
<span class="line-added">+         , defersLoadingPolicy(DefersLoadingPolicy::AllowDefersLoading)</span>
<span class="line-added">+         , cachingPolicy(CachingPolicy::AllowCaching)</span>
<span class="line-added">+         , sameOriginDataURLFlag(SameOriginDataURLFlag::Unset)</span>
<span class="line-added">+         , initiatorContext(InitiatorContext::Document)</span>
<span class="line-added">+         , serviceWorkersMode(ServiceWorkersMode::All)</span>
<span class="line-added">+         , applicationCacheMode(ApplicationCacheMode::Use)</span>
<span class="line-added">+         , clientCredentialPolicy(ClientCredentialPolicy::CannotAskClientForCredentials)</span>
<span class="line-added">+         , preflightPolicy(PreflightPolicy::Consider)</span>
<span class="line-added">+         , loadedFromOpaqueSource(LoadedFromOpaqueSource::No)</span>
<span class="line-added">+     { }</span>
  
      ResourceLoaderOptions(SendCallbackPolicy sendLoadCallbacks, ContentSniffingPolicy sniffContent, DataBufferingPolicy dataBufferingPolicy, StoredCredentialsPolicy storedCredentialsPolicy, ClientCredentialPolicy credentialPolicy, FetchOptions::Credentials credentials, SecurityCheckPolicy securityCheck, FetchOptions::Mode mode, CertificateInfoPolicy certificateInfoPolicy, ContentSecurityPolicyImposition contentSecurityPolicyImposition, DefersLoadingPolicy defersLoadingPolicy, CachingPolicy cachingPolicy)
          : sendLoadCallbacks(sendLoadCallbacks)
          , sniffContent(sniffContent)
<span class="line-added">+         , sniffContentEncoding(ContentEncodingSniffingPolicy::Sniff)</span>
          , dataBufferingPolicy(dataBufferingPolicy)
          , storedCredentialsPolicy(storedCredentialsPolicy)
          , securityCheck(securityCheck)
          , certificateInfoPolicy(certificateInfoPolicy)
          , contentSecurityPolicyImposition(contentSecurityPolicyImposition)
          , defersLoadingPolicy(defersLoadingPolicy)
          , cachingPolicy(cachingPolicy)
<span class="line-added">+         , sameOriginDataURLFlag(SameOriginDataURLFlag::Unset)</span>
<span class="line-added">+         , initiatorContext(InitiatorContext::Document)</span>
<span class="line-added">+         , serviceWorkersMode(ServiceWorkersMode::All)</span>
<span class="line-added">+         , applicationCacheMode(ApplicationCacheMode::Use)</span>
          , clientCredentialPolicy(credentialPolicy)
<span class="line-added">+         , preflightPolicy(PreflightPolicy::Consider)</span>
<span class="line-added">+         , loadedFromOpaqueSource(LoadedFromOpaqueSource::No)</span>
<span class="line-added">+ </span>
      {
          this-&gt;credentials = credentials;
          this-&gt;mode = mode;
      }
  
  #if ENABLE(SERVICE_WORKER)
<span class="line-modified">!     Markable&lt;ServiceWorkerRegistrationIdentifier, ServiceWorkerRegistrationIdentifier::MarkableTraits&gt; serviceWorkerRegistrationIdentifier;</span>
  #endif
<span class="line-modified">!     Markable&lt;ContentSecurityPolicyResponseHeaders, ContentSecurityPolicyResponseHeaders::MarkableTraits&gt; cspResponseHeaders;</span>
<span class="line-modified">!     OptionSet&lt;HTTPHeadersToKeepFromCleaning&gt; httpHeadersToKeep;</span>
<span class="line-modified">!     uint8_t maxRedirectCount { 20 };</span>
<span class="line-modified">! </span>
<span class="line-modified">!     SendCallbackPolicy sendLoadCallbacks : bitWidthOfSendCallbackPolicy;</span>
<span class="line-modified">!     ContentSniffingPolicy sniffContent : bitWidthOfContentSniffingPolicy;</span>
<span class="line-modified">!     ContentEncodingSniffingPolicy sniffContentEncoding : bitWidthOfContentEncodingSniffingPolicy;</span>
<span class="line-modified">!     DataBufferingPolicy dataBufferingPolicy : bitWidthOfDataBufferingPolicy;</span>
<span class="line-modified">!     StoredCredentialsPolicy storedCredentialsPolicy : bitWidthOfStoredCredentialsPolicy;</span>
<span class="line-modified">!     SecurityCheckPolicy securityCheck : bitWidthOfSecurityCheckPolicy;</span>
<span class="line-modified">!     CertificateInfoPolicy certificateInfoPolicy : bitWidthOfCertificateInfoPolicy;</span>
<span class="line-modified">!     ContentSecurityPolicyImposition contentSecurityPolicyImposition : bitWidthOfContentSecurityPolicyImposition;</span>
<span class="line-modified">!     DefersLoadingPolicy defersLoadingPolicy : bitWidthOfDefersLoadingPolicy;</span>
<span class="line-modified">!     CachingPolicy cachingPolicy : bitWidthOfCachingPolicy;</span>
<span class="line-modified">!     SameOriginDataURLFlag sameOriginDataURLFlag : bitWidthOfSameOriginDataURLFlag;</span>
<span class="line-modified">!     InitiatorContext initiatorContext : bitWidthOfInitiatorContext;</span>
<span class="line-modified">!     ServiceWorkersMode serviceWorkersMode : bitWidthOfServiceWorkersMode;</span>
<span class="line-modified">!     ApplicationCacheMode applicationCacheMode : bitWidthOfApplicationCacheMode;</span>
<span class="line-modified">!     ClientCredentialPolicy clientCredentialPolicy : bitWidthOfClientCredentialPolicy;</span>
<span class="line-modified">!     PreflightPolicy preflightPolicy : bitWidthOfPreflightPolicy;</span>
<span class="line-modified">!     LoadedFromOpaqueSource loadedFromOpaqueSource : bitWidthOfLoadedFromOpaqueSource;</span>
  };
  
  } // namespace WebCore
<span class="line-added">+ </span>
<span class="line-added">+ namespace WTF {</span>
<span class="line-added">+ </span>
<span class="line-added">+ template&lt;&gt; struct EnumTraits&lt;WebCore::ServiceWorkersMode&gt; {</span>
<span class="line-added">+     using values = EnumValues&lt;</span>
<span class="line-added">+         WebCore::ServiceWorkersMode,</span>
<span class="line-added">+         WebCore::ServiceWorkersMode::All,</span>
<span class="line-added">+         WebCore::ServiceWorkersMode::None,</span>
<span class="line-added">+         WebCore::ServiceWorkersMode::Only</span>
<span class="line-added">+     &gt;;</span>
<span class="line-added">+ };</span>
<span class="line-added">+ </span>
<span class="line-added">+ } // namespace WTF</span>
</pre>
<center><a href="ResourceLoader.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ResourceTimingInformation.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>