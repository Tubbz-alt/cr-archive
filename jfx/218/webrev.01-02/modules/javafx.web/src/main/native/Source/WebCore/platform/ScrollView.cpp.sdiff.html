<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/ScrollView.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ScrollTypes.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ScrollView.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/ScrollView.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 189 }
 190 
 191 void ScrollView::setDelegatesScrolling(bool delegatesScrolling)
 192 {
 193     if (m_delegatesScrolling == delegatesScrolling)
 194         return;
 195 
 196     m_delegatesScrolling = delegatesScrolling;
 197     delegatesScrollingDidChange();
 198 }
 199 
 200 IntPoint ScrollView::contentsScrollPosition() const
 201 {
 202 #if PLATFORM(IOS_FAMILY)
 203     if (platformWidget())
 204         return actualScrollPosition();
 205 #endif
 206     return scrollPosition();
 207 }
 208 
<span class="line-modified"> 209 void ScrollView::setContentsScrollPosition(const IntPoint&amp; position)</span>
 210 {
 211 #if PLATFORM(IOS_FAMILY)
 212     if (platformWidget())
 213         setActualScrollPosition(position);
 214 #endif
<span class="line-modified"> 215     setScrollPosition(position);</span>
















































 216 }
 217 
<span class="line-removed"> 218 #if !PLATFORM(IOS_FAMILY)</span>
 219 IntRect ScrollView::unobscuredContentRect(VisibleContentRectIncludesScrollbars scrollbarInclusion) const
 220 {






 221     return unobscuredContentRectInternal(scrollbarInclusion);
 222 }
<span class="line-removed"> 223 #endif</span>
 224 
 225 IntRect ScrollView::unobscuredContentRectInternal(VisibleContentRectIncludesScrollbars scrollbarInclusion) const
 226 {
 227     FloatSize visibleContentSize = sizeForUnobscuredContent(scrollbarInclusion);
 228     visibleContentSize.scale(1 / visibleContentScaleFactor());
 229     return IntRect(m_scrollPosition, expandedIntSize(visibleContentSize));
 230 }
 231 
 232 IntSize ScrollView::sizeForVisibleContent(VisibleContentRectIncludesScrollbars scrollbarInclusion) const
 233 {
 234     if (platformWidget())
 235         return platformVisibleContentSizeIncludingObscuredArea(scrollbarInclusion == IncludeScrollbars);
 236 
 237 #if USE(COORDINATED_GRAPHICS)
 238     if (m_useFixedLayout &amp;&amp; !m_fixedVisibleContentRect.isEmpty())
 239         return m_fixedVisibleContentRect.size();
 240 #endif
 241 
 242     IntSize scrollbarSpace;
 243     if (scrollbarInclusion == ExcludeScrollbars)
</pre>
<hr />
<pre>
 444     }
 445 #endif
 446     // We should not attempt to actually modify layer contents if the layout phase
 447     // is not complete. Instead, defer the scroll event until the layout finishes.
 448     if (shouldDeferScrollUpdateAfterContentSizeChange()) {
 449         ASSERT(!m_deferredScrollDelta);
 450         m_deferredScrollDelta = scrollDelta;
 451         return;
 452     }
 453 
 454     completeUpdatesAfterScrollTo(scrollDelta);
 455 }
 456 
 457 void ScrollView::completeUpdatesAfterScrollTo(const IntSize&amp; scrollDelta)
 458 {
 459     updateLayerPositionsAfterScrolling();
 460     scrollContents(scrollDelta);
 461     updateCompositingLayersAfterScrolling();
 462 }
 463 
<span class="line-modified"> 464 void ScrollView::setScrollPosition(const ScrollPosition&amp; scrollPosition)</span>
 465 {
 466     LOG_WITH_STREAM(Scrolling, stream &lt;&lt; &quot;ScrollView::setScrollPosition &quot; &lt;&lt; scrollPosition);
 467 
 468     if (prohibitsScrolling())
 469         return;
 470 
 471     if (platformWidget()) {
 472         platformSetScrollPosition(scrollPosition);
 473         return;
 474     }
 475 
<span class="line-modified"> 476     ScrollPosition newScrollPosition = !delegatesScrolling() ? adjustScrollPositionWithinRange(scrollPosition) : scrollPosition;</span>
 477 
 478     if ((!delegatesScrolling() || currentScrollType() == ScrollType::User) &amp;&amp; newScrollPosition == this-&gt;scrollPosition())
 479         return;
 480 
<span class="line-modified"> 481     if (requestScrollPositionUpdate(newScrollPosition))</span>
 482         return;
 483 
 484     updateScrollbars(newScrollPosition);
 485 }
 486 
 487 bool ScrollView::scroll(ScrollDirection direction, ScrollGranularity granularity)
 488 {
 489     if (platformWidget())
 490         return platformScroll(direction, granularity);
 491 
 492     return ScrollableArea::scroll(direction, granularity);
 493 }
 494 
 495 bool ScrollView::logicalScroll(ScrollLogicalDirection direction, ScrollGranularity granularity)
 496 {
 497     return scroll(logicalToPhysical(direction, isVerticalDocument(), isFlippedDocument()), granularity);
 498 }
 499 
 500 IntSize ScrollView::overhangAmount() const
 501 {
</pre>
<hr />
<pre>
1511 {
1512 }
1513 
1514 void ScrollView::platformScrollbarModes(ScrollbarMode&amp; horizontal, ScrollbarMode&amp; vertical) const
1515 {
1516     horizontal = ScrollbarAuto;
1517     vertical = ScrollbarAuto;
1518 }
1519 
1520 void ScrollView::platformSetCanBlitOnScroll(bool)
1521 {
1522 }
1523 
1524 bool ScrollView::platformCanBlitOnScroll() const
1525 {
1526     return false;
1527 }
1528 
1529 IntRect ScrollView::platformVisibleContentRect(bool) const
1530 {
<span class="line-modified">1531     return IntRect();</span>
1532 }
1533 
1534 float ScrollView::platformTopContentInset() const
1535 {
1536     return 0;
1537 }
1538 
1539 void ScrollView::platformSetTopContentInset(float)
1540 {
1541 }
1542 
1543 IntSize ScrollView::platformVisibleContentSize(bool) const
1544 {
<span class="line-modified">1545     return IntSize();</span>
1546 }
1547 
1548 IntRect ScrollView::platformVisibleContentRectIncludingObscuredArea(bool) const
1549 {
<span class="line-modified">1550     return IntRect();</span>
1551 }
1552 
1553 IntSize ScrollView::platformVisibleContentSizeIncludingObscuredArea(bool) const
1554 {
<span class="line-modified">1555     return IntSize();</span>










1556 }
1557 
1558 void ScrollView::platformSetContentsSize()
1559 {
1560 }
1561 
1562 IntRect ScrollView::platformContentsToScreen(const IntRect&amp; rect) const
1563 {
1564     return rect;
1565 }
1566 
1567 IntPoint ScrollView::platformScreenToContents(const IntPoint&amp; point) const
1568 {
1569     return point;
1570 }
1571 
1572 void ScrollView::platformSetScrollPosition(const IntPoint&amp;)
1573 {
1574 }
1575 
</pre>
</td>
<td>
<hr />
<pre>
 189 }
 190 
 191 void ScrollView::setDelegatesScrolling(bool delegatesScrolling)
 192 {
 193     if (m_delegatesScrolling == delegatesScrolling)
 194         return;
 195 
 196     m_delegatesScrolling = delegatesScrolling;
 197     delegatesScrollingDidChange();
 198 }
 199 
 200 IntPoint ScrollView::contentsScrollPosition() const
 201 {
 202 #if PLATFORM(IOS_FAMILY)
 203     if (platformWidget())
 204         return actualScrollPosition();
 205 #endif
 206     return scrollPosition();
 207 }
 208 
<span class="line-modified"> 209 void ScrollView::setContentsScrollPosition(const IntPoint&amp; position, ScrollClamping clamping)</span>
 210 {
 211 #if PLATFORM(IOS_FAMILY)
 212     if (platformWidget())
 213         setActualScrollPosition(position);
 214 #endif
<span class="line-modified"> 215     setScrollPosition(position, clamping);</span>
<span class="line-added"> 216 }</span>
<span class="line-added"> 217 </span>
<span class="line-added"> 218 FloatRect ScrollView::exposedContentRect() const</span>
<span class="line-added"> 219 {</span>
<span class="line-added"> 220 #if PLATFORM(IOS_FAMILY)</span>
<span class="line-added"> 221     if (platformWidget())</span>
<span class="line-added"> 222         return platformExposedContentRect();</span>
<span class="line-added"> 223 #endif</span>
<span class="line-added"> 224 </span>
<span class="line-added"> 225     const ScrollView* parent = this-&gt;parent();</span>
<span class="line-added"> 226     if (!parent)</span>
<span class="line-added"> 227         return m_delegatedScrollingGeometry ? m_delegatedScrollingGeometry-&gt;exposedContentRect : FloatRect();</span>
<span class="line-added"> 228 </span>
<span class="line-added"> 229     IntRect parentViewExtentContentRect = enclosingIntRect(parent-&gt;exposedContentRect());</span>
<span class="line-added"> 230     IntRect selfExtentContentRect = rootViewToContents(parentViewExtentContentRect);</span>
<span class="line-added"> 231     selfExtentContentRect.intersect(boundsRect());</span>
<span class="line-added"> 232     return selfExtentContentRect;</span>
<span class="line-added"> 233 }</span>
<span class="line-added"> 234 </span>
<span class="line-added"> 235 void ScrollView::setExposedContentRect(const FloatRect&amp; rect)</span>
<span class="line-added"> 236 {</span>
<span class="line-added"> 237     ASSERT(!platformWidget());</span>
<span class="line-added"> 238 </span>
<span class="line-added"> 239     if (!m_delegatedScrollingGeometry)</span>
<span class="line-added"> 240         m_delegatedScrollingGeometry = DelegatedScrollingGeometry();</span>
<span class="line-added"> 241 </span>
<span class="line-added"> 242     m_delegatedScrollingGeometry-&gt;exposedContentRect = rect;</span>
<span class="line-added"> 243 }</span>
<span class="line-added"> 244 </span>
<span class="line-added"> 245 FloatSize ScrollView::unobscuredContentSize() const</span>
<span class="line-added"> 246 {</span>
<span class="line-added"> 247     ASSERT(m_delegatedScrollingGeometry);</span>
<span class="line-added"> 248     if (m_delegatedScrollingGeometry)</span>
<span class="line-added"> 249         return m_delegatedScrollingGeometry-&gt;unobscuredContentSize;</span>
<span class="line-added"> 250     return { };</span>
<span class="line-added"> 251 }</span>
<span class="line-added"> 252 </span>
<span class="line-added"> 253 void ScrollView::setUnobscuredContentSize(const FloatSize&amp; size)</span>
<span class="line-added"> 254 {</span>
<span class="line-added"> 255     ASSERT(!platformWidget());</span>
<span class="line-added"> 256     if (m_delegatedScrollingGeometry &amp;&amp; size == m_delegatedScrollingGeometry-&gt;unobscuredContentSize)</span>
<span class="line-added"> 257         return;</span>
<span class="line-added"> 258 </span>
<span class="line-added"> 259     if (!m_delegatedScrollingGeometry)</span>
<span class="line-added"> 260         m_delegatedScrollingGeometry = DelegatedScrollingGeometry();</span>
<span class="line-added"> 261 </span>
<span class="line-added"> 262     m_delegatedScrollingGeometry-&gt;unobscuredContentSize = size;</span>
<span class="line-added"> 263     unobscuredContentSizeChanged();</span>
 264 }
 265 

 266 IntRect ScrollView::unobscuredContentRect(VisibleContentRectIncludesScrollbars scrollbarInclusion) const
 267 {
<span class="line-added"> 268     if (platformWidget())</span>
<span class="line-added"> 269         return platformUnobscuredContentRect(scrollbarInclusion);</span>
<span class="line-added"> 270 </span>
<span class="line-added"> 271     if (m_delegatedScrollingGeometry)</span>
<span class="line-added"> 272         return IntRect(m_scrollPosition, roundedIntSize(m_delegatedScrollingGeometry-&gt;unobscuredContentSize));</span>
<span class="line-added"> 273 </span>
 274     return unobscuredContentRectInternal(scrollbarInclusion);
 275 }

 276 
 277 IntRect ScrollView::unobscuredContentRectInternal(VisibleContentRectIncludesScrollbars scrollbarInclusion) const
 278 {
 279     FloatSize visibleContentSize = sizeForUnobscuredContent(scrollbarInclusion);
 280     visibleContentSize.scale(1 / visibleContentScaleFactor());
 281     return IntRect(m_scrollPosition, expandedIntSize(visibleContentSize));
 282 }
 283 
 284 IntSize ScrollView::sizeForVisibleContent(VisibleContentRectIncludesScrollbars scrollbarInclusion) const
 285 {
 286     if (platformWidget())
 287         return platformVisibleContentSizeIncludingObscuredArea(scrollbarInclusion == IncludeScrollbars);
 288 
 289 #if USE(COORDINATED_GRAPHICS)
 290     if (m_useFixedLayout &amp;&amp; !m_fixedVisibleContentRect.isEmpty())
 291         return m_fixedVisibleContentRect.size();
 292 #endif
 293 
 294     IntSize scrollbarSpace;
 295     if (scrollbarInclusion == ExcludeScrollbars)
</pre>
<hr />
<pre>
 496     }
 497 #endif
 498     // We should not attempt to actually modify layer contents if the layout phase
 499     // is not complete. Instead, defer the scroll event until the layout finishes.
 500     if (shouldDeferScrollUpdateAfterContentSizeChange()) {
 501         ASSERT(!m_deferredScrollDelta);
 502         m_deferredScrollDelta = scrollDelta;
 503         return;
 504     }
 505 
 506     completeUpdatesAfterScrollTo(scrollDelta);
 507 }
 508 
 509 void ScrollView::completeUpdatesAfterScrollTo(const IntSize&amp; scrollDelta)
 510 {
 511     updateLayerPositionsAfterScrolling();
 512     scrollContents(scrollDelta);
 513     updateCompositingLayersAfterScrolling();
 514 }
 515 
<span class="line-modified"> 516 void ScrollView::setScrollPosition(const ScrollPosition&amp; scrollPosition, ScrollClamping clamping)</span>
 517 {
 518     LOG_WITH_STREAM(Scrolling, stream &lt;&lt; &quot;ScrollView::setScrollPosition &quot; &lt;&lt; scrollPosition);
 519 
 520     if (prohibitsScrolling())
 521         return;
 522 
 523     if (platformWidget()) {
 524         platformSetScrollPosition(scrollPosition);
 525         return;
 526     }
 527 
<span class="line-modified"> 528     ScrollPosition newScrollPosition = (!delegatesScrolling() &amp;&amp; clamping == ScrollClamping::Clamped) ? adjustScrollPositionWithinRange(scrollPosition) : scrollPosition;</span>
 529 
 530     if ((!delegatesScrolling() || currentScrollType() == ScrollType::User) &amp;&amp; newScrollPosition == this-&gt;scrollPosition())
 531         return;
 532 
<span class="line-modified"> 533     if (requestScrollPositionUpdate(newScrollPosition, currentScrollType(), clamping))</span>
 534         return;
 535 
 536     updateScrollbars(newScrollPosition);
 537 }
 538 
 539 bool ScrollView::scroll(ScrollDirection direction, ScrollGranularity granularity)
 540 {
 541     if (platformWidget())
 542         return platformScroll(direction, granularity);
 543 
 544     return ScrollableArea::scroll(direction, granularity);
 545 }
 546 
 547 bool ScrollView::logicalScroll(ScrollLogicalDirection direction, ScrollGranularity granularity)
 548 {
 549     return scroll(logicalToPhysical(direction, isVerticalDocument(), isFlippedDocument()), granularity);
 550 }
 551 
 552 IntSize ScrollView::overhangAmount() const
 553 {
</pre>
<hr />
<pre>
1563 {
1564 }
1565 
1566 void ScrollView::platformScrollbarModes(ScrollbarMode&amp; horizontal, ScrollbarMode&amp; vertical) const
1567 {
1568     horizontal = ScrollbarAuto;
1569     vertical = ScrollbarAuto;
1570 }
1571 
1572 void ScrollView::platformSetCanBlitOnScroll(bool)
1573 {
1574 }
1575 
1576 bool ScrollView::platformCanBlitOnScroll() const
1577 {
1578     return false;
1579 }
1580 
1581 IntRect ScrollView::platformVisibleContentRect(bool) const
1582 {
<span class="line-modified">1583     return { };</span>
1584 }
1585 
1586 float ScrollView::platformTopContentInset() const
1587 {
1588     return 0;
1589 }
1590 
1591 void ScrollView::platformSetTopContentInset(float)
1592 {
1593 }
1594 
1595 IntSize ScrollView::platformVisibleContentSize(bool) const
1596 {
<span class="line-modified">1597     return { };</span>
1598 }
1599 
1600 IntRect ScrollView::platformVisibleContentRectIncludingObscuredArea(bool) const
1601 {
<span class="line-modified">1602     return { };</span>
1603 }
1604 
1605 IntSize ScrollView::platformVisibleContentSizeIncludingObscuredArea(bool) const
1606 {
<span class="line-modified">1607     return { };</span>
<span class="line-added">1608 }</span>
<span class="line-added">1609 </span>
<span class="line-added">1610 IntRect ScrollView::platformUnobscuredContentRect(VisibleContentRectIncludesScrollbars) const</span>
<span class="line-added">1611 {</span>
<span class="line-added">1612     return { };</span>
<span class="line-added">1613 }</span>
<span class="line-added">1614 </span>
<span class="line-added">1615 FloatRect ScrollView::platformExposedContentRect() const</span>
<span class="line-added">1616 {</span>
<span class="line-added">1617     return { };</span>
1618 }
1619 
1620 void ScrollView::platformSetContentsSize()
1621 {
1622 }
1623 
1624 IntRect ScrollView::platformContentsToScreen(const IntRect&amp; rect) const
1625 {
1626     return rect;
1627 }
1628 
1629 IntPoint ScrollView::platformScreenToContents(const IntPoint&amp; point) const
1630 {
1631     return point;
1632 }
1633 
1634 void ScrollView::platformSetScrollPosition(const IntPoint&amp;)
1635 {
1636 }
1637 
</pre>
</td>
</tr>
</table>
<center><a href="ScrollTypes.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ScrollView.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>