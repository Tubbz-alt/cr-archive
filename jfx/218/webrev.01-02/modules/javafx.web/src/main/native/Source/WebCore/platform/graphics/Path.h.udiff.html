<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/Path.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Path.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="PathTraversalState.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/Path.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -48,10 +48,14 @@</span>
  interface ID2D1PathGeometry;
  interface ID2D1GeometrySink;
  
  typedef ID2D1GeometryGroup PlatformPath;
  
<span class="udiff-line-added">+ namespace WebCore {</span>
<span class="udiff-line-added">+ class PlatformContextDirect2D;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  #elif USE(CAIRO)
  
  namespace WebCore {
  class CairoPath;
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -85,151 +89,252 @@</span>
  class TextStream;
  }
  
  namespace WebCore {
  
<span class="udiff-line-modified-removed">-     class AffineTransform;</span>
<span class="udiff-line-modified-removed">-     class FloatPoint;</span>
<span class="udiff-line-modified-removed">-     class FloatRoundedRect;</span>
<span class="udiff-line-modified-removed">-     class FloatSize;</span>
<span class="udiff-line-modified-removed">-     class GraphicsContext;</span>
<span class="udiff-line-modified-removed">-     class PathTraversalState;</span>
<span class="udiff-line-modified-removed">-     class RoundedRect;</span>
<span class="udiff-line-modified-removed">-     class StrokeStyleApplier;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-     enum PathElementType {</span>
<span class="udiff-line-modified-removed">-         PathElementMoveToPoint, // The points member will contain 1 value.</span>
<span class="udiff-line-modified-removed">-         PathElementAddLineToPoint, // The points member will contain 1 value.</span>
<span class="udiff-line-modified-removed">-         PathElementAddQuadCurveToPoint, // The points member will contain 2 values.</span>
<span class="udiff-line-modified-removed">-         PathElementAddCurveToPoint, // The points member will contain 3 values.</span>
<span class="udiff-line-modified-removed">-         PathElementCloseSubpath // The points member will contain no values.</span>
<span class="udiff-line-modified-added">+ class AffineTransform;</span>
<span class="udiff-line-modified-added">+ class FloatPoint;</span>
<span class="udiff-line-modified-added">+ class FloatRoundedRect;</span>
<span class="udiff-line-modified-added">+ class FloatSize;</span>
<span class="udiff-line-modified-added">+ class GraphicsContext;</span>
<span class="udiff-line-modified-added">+ class PathTraversalState;</span>
<span class="udiff-line-modified-added">+ class RoundedRect;</span>
<span class="udiff-line-modified-added">+ class StrokeStyleApplier;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ // The points in the structure are the same as those that would be used with the</span>
<span class="udiff-line-modified-added">+ // add... method. For example, a line returns the endpoint, while a cubic returns</span>
<span class="udiff-line-modified-added">+ // two tangent points and the endpoint.</span>
<span class="udiff-line-modified-added">+ struct PathElement {</span>
<span class="udiff-line-modified-added">+     enum class Type : uint8_t {</span>
<span class="udiff-line-modified-added">+         MoveToPoint, // The points member will contain 1 value.</span>
<span class="udiff-line-added">+         AddLineToPoint, // The points member will contain 1 value.</span>
<span class="udiff-line-added">+         AddQuadCurveToPoint, // The points member will contain 2 values.</span>
<span class="udiff-line-added">+         AddCurveToPoint, // The points member will contain 3 values.</span>
<span class="udiff-line-added">+         CloseSubpath // The points member will contain no values.</span>
      };
  
<span class="udiff-line-modified-removed">-     // The points in the structure are the same as those that would be used with the</span>
<span class="udiff-line-modified-removed">-     // add... method. For example, a line returns the endpoint, while a cubic returns</span>
<span class="udiff-line-modified-removed">-     // two tangent points and the endpoint.</span>
<span class="udiff-line-removed">-     struct PathElement {</span>
<span class="udiff-line-removed">-         PathElementType type;</span>
<span class="udiff-line-removed">-         FloatPoint* points;</span>
<span class="udiff-line-removed">-     };</span>
<span class="udiff-line-modified-added">+     FloatPoint points[3];</span>
<span class="udiff-line-modified-added">+     Type type;</span>
<span class="udiff-line-modified-added">+ };</span>
  
<span class="udiff-line-modified-removed">-     using PathApplierFunction = WTF::Function&lt;void (const PathElement&amp;)&gt;;</span>
<span class="udiff-line-modified-added">+ using PathApplierFunction = WTF::Function&lt;void(const PathElement&amp;)&gt;;</span>
  
<span class="udiff-line-modified-removed">-     class Path {</span>
<span class="udiff-line-modified-removed">-         WTF_MAKE_FAST_ALLOCATED;</span>
<span class="udiff-line-modified-removed">-     public:</span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT Path();</span>
<span class="udiff-line-modified-added">+ class Path {</span>
<span class="udiff-line-modified-added">+     WTF_MAKE_FAST_ALLOCATED;</span>
<span class="udiff-line-modified-added">+ public:</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT Path();</span>
  #if USE(CG)
<span class="udiff-line-modified-removed">-         Path(RetainPtr&lt;CGMutablePathRef&gt;);</span>
<span class="udiff-line-modified-added">+     Path(RetainPtr&lt;CGMutablePathRef&gt;);</span>
  #endif
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT ~Path();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT Path(const Path&amp;);</span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT Path(Path&amp;&amp;);</span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT Path&amp; operator=(const Path&amp;);</span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT Path&amp; operator=(Path&amp;&amp;);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         static Path polygonPathFromPoints(const Vector&lt;FloatPoint&gt;&amp;);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         bool contains(const FloatPoint&amp;, WindRule = WindRule::NonZero) const;</span>
<span class="udiff-line-modified-removed">-         bool strokeContains(StrokeStyleApplier*, const FloatPoint&amp;) const;</span>
<span class="udiff-line-modified-removed">-         // fastBoundingRect() should equal or contain boundingRect(); boundingRect()</span>
<span class="udiff-line-modified-removed">-         // should perfectly bound the points within the path.</span>
<span class="udiff-line-modified-removed">-         FloatRect boundingRect() const;</span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT FloatRect fastBoundingRect() const;</span>
<span class="udiff-line-modified-removed">-         FloatRect strokeBoundingRect(StrokeStyleApplier* = 0) const;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         float length() const;</span>
<span class="udiff-line-modified-removed">-         PathTraversalState traversalStateAtLength(float length, bool&amp; success) const;</span>
<span class="udiff-line-modified-removed">-         FloatPoint pointAtLength(float length, bool&amp; success) const;</span>
<span class="udiff-line-modified-removed">-         float normalAngleAtLength(float length, bool&amp; success) const;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT void clear();</span>
<span class="udiff-line-modified-removed">-         bool isNull() const { return !m_path; }</span>
<span class="udiff-line-modified-removed">-         bool isEmpty() const;</span>
<span class="udiff-line-modified-removed">-         // Gets the current point of the current path, which is conceptually the final point reached by the path so far.</span>
<span class="udiff-line-modified-removed">-         // Note the Path can be empty (isEmpty() == true) and still have a current point.</span>
<span class="udiff-line-modified-removed">-         bool hasCurrentPoint() const;</span>
<span class="udiff-line-modified-removed">-         FloatPoint currentPoint() const;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT void moveTo(const FloatPoint&amp;);</span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT void addLineTo(const FloatPoint&amp;);</span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT void addQuadCurveTo(const FloatPoint&amp; controlPoint, const FloatPoint&amp; endPoint);</span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT void addBezierCurveTo(const FloatPoint&amp; controlPoint1, const FloatPoint&amp; controlPoint2, const FloatPoint&amp; endPoint);</span>
<span class="udiff-line-modified-removed">-         void addArcTo(const FloatPoint&amp;, const FloatPoint&amp;, float radius);</span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT void closeSubpath();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         void addArc(const FloatPoint&amp;, float radius, float startAngle, float endAngle, bool anticlockwise);</span>
<span class="udiff-line-modified-removed">-         void addRect(const FloatRect&amp;);</span>
<span class="udiff-line-modified-removed">-         void addEllipse(FloatPoint, float radiusX, float radiusY, float rotation, float startAngle, float endAngle, bool anticlockwise);</span>
<span class="udiff-line-modified-removed">-         void addEllipse(const FloatRect&amp;);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         enum RoundedRectStrategy {</span>
<span class="udiff-line-modified-removed">-             PreferNativeRoundedRect,</span>
<span class="udiff-line-modified-removed">-             PreferBezierRoundedRect</span>
<span class="udiff-line-modified-removed">-         };</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT void addRoundedRect(const FloatRect&amp;, const FloatSize&amp; roundingRadii, RoundedRectStrategy = PreferNativeRoundedRect);</span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT void addRoundedRect(const FloatRoundedRect&amp;, RoundedRectStrategy = PreferNativeRoundedRect);</span>
<span class="udiff-line-modified-removed">-         void addRoundedRect(const RoundedRect&amp;);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         void addPath(const Path&amp;, const AffineTransform&amp;);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         void translate(const FloatSize&amp;);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         // To keep Path() cheap, it does not allocate a PlatformPath immediately</span>
<span class="udiff-line-removed">-         // meaning Path::platformPath() can return null.</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT ~Path();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT Path(const Path&amp;);</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT Path(Path&amp;&amp;);</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT Path&amp; operator=(const Path&amp;);</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT Path&amp; operator=(Path&amp;&amp;);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     static Path polygonPathFromPoints(const Vector&lt;FloatPoint&gt;&amp;);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     bool contains(const FloatPoint&amp;, WindRule = WindRule::NonZero) const;</span>
<span class="udiff-line-modified-added">+     bool strokeContains(StrokeStyleApplier&amp;, const FloatPoint&amp;) const;</span>
<span class="udiff-line-modified-added">+     // fastBoundingRect() should equal or contain boundingRect(); boundingRect()</span>
<span class="udiff-line-modified-added">+     // should perfectly bound the points within the path.</span>
<span class="udiff-line-modified-added">+     FloatRect boundingRect() const;</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT FloatRect fastBoundingRect() const;</span>
<span class="udiff-line-modified-added">+     FloatRect strokeBoundingRect(StrokeStyleApplier* = 0) const;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     float length() const;</span>
<span class="udiff-line-modified-added">+     PathTraversalState traversalStateAtLength(float length) const;</span>
<span class="udiff-line-modified-added">+     FloatPoint pointAtLength(float length) const;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT void clear();</span>
<span class="udiff-line-modified-added">+     bool isNull() const { return !m_path; }</span>
<span class="udiff-line-modified-added">+     bool isEmpty() const;</span>
<span class="udiff-line-modified-added">+     // Gets the current point of the current path, which is conceptually the final point reached by the path so far.</span>
<span class="udiff-line-modified-added">+     // Note the Path can be empty (isEmpty() == true) and still have a current point.</span>
<span class="udiff-line-modified-added">+     bool hasCurrentPoint() const;</span>
<span class="udiff-line-modified-added">+     FloatPoint currentPoint() const;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT void moveTo(const FloatPoint&amp;);</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT void addLineTo(const FloatPoint&amp;);</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT void addQuadCurveTo(const FloatPoint&amp; controlPoint, const FloatPoint&amp; endPoint);</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT void addBezierCurveTo(const FloatPoint&amp; controlPoint1, const FloatPoint&amp; controlPoint2, const FloatPoint&amp; endPoint);</span>
<span class="udiff-line-modified-added">+     void addArcTo(const FloatPoint&amp;, const FloatPoint&amp;, float radius);</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT void closeSubpath();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     void addArc(const FloatPoint&amp;, float radius, float startAngle, float endAngle, bool anticlockwise);</span>
<span class="udiff-line-modified-added">+     void addRect(const FloatRect&amp;);</span>
<span class="udiff-line-modified-added">+     void addEllipse(FloatPoint, float radiusX, float radiusY, float rotation, float startAngle, float endAngle, bool anticlockwise);</span>
<span class="udiff-line-modified-added">+     void addEllipse(const FloatRect&amp;);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     enum class RoundedRectStrategy : uint8_t {</span>
<span class="udiff-line-modified-added">+         PreferNative,</span>
<span class="udiff-line-modified-added">+         PreferBezier</span>
<span class="udiff-line-modified-added">+     };</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT void addRoundedRect(const FloatRect&amp;, const FloatSize&amp; roundingRadii, RoundedRectStrategy = RoundedRectStrategy::PreferNative);</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT void addRoundedRect(const FloatRoundedRect&amp;, RoundedRectStrategy = RoundedRectStrategy::PreferNative);</span>
<span class="udiff-line-modified-added">+     void addRoundedRect(const RoundedRect&amp;);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     void addPath(const Path&amp;, const AffineTransform&amp;);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     void translate(const FloatSize&amp;);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // To keep Path() cheap, it does not allocate a PlatformPath immediately</span>
<span class="udiff-line-modified-added">+     // meaning Path::platformPath() can return null.</span>
  #if USE(DIRECT2D)
<span class="udiff-line-modified-removed">-         PlatformPathPtr platformPath() const { return m_path.get(); }</span>
<span class="udiff-line-modified-added">+     FloatRect fastBoundingRectForStroke(const PlatformContextDirect2D&amp;) const;</span>
<span class="udiff-line-added">+     PlatformPathPtr platformPath() const { return m_path.get(); }</span>
  #else
<span class="udiff-line-modified-removed">-         PlatformPathPtr platformPath() const { return m_path; }</span>
<span class="udiff-line-modified-added">+     PlatformPathPtr platformPath() const { return m_path; }</span>
  #endif
<span class="udiff-line-modified-removed">-         // ensurePlatformPath() will allocate a PlatformPath if it has not yet been and will never return null.</span>
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT PlatformPathPtr ensurePlatformPath();</span>
<span class="udiff-line-modified-added">+     // ensurePlatformPath() will allocate a PlatformPath if it has not yet been and will never return null.</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT PlatformPathPtr ensurePlatformPath();</span>
  
<span class="udiff-line-modified-removed">-         WEBCORE_EXPORT void apply(const PathApplierFunction&amp;) const;</span>
<span class="udiff-line-modified-removed">-         void transform(const AffineTransform&amp;);</span>
<span class="udiff-line-modified-added">+     WEBCORE_EXPORT void apply(const PathApplierFunction&amp;) const;</span>
<span class="udiff-line-modified-added">+     void transform(const AffineTransform&amp;);</span>
  
<span class="udiff-line-modified-removed">-         static float circleControlPoint()</span>
<span class="udiff-line-modified-removed">-         {</span>
<span class="udiff-line-modified-removed">-             // Approximation of control point positions on a bezier to simulate a quarter of a circle.</span>
<span class="udiff-line-modified-removed">-             // This is 1-kappa, where kappa = 4 * (sqrt(2) - 1) / 3</span>
<span class="udiff-line-modified-removed">-             return 0.447715;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-added">+     static float circleControlPoint()</span>
<span class="udiff-line-modified-added">+     {</span>
<span class="udiff-line-modified-added">+         // Approximation of control point positions on a bezier to simulate a quarter of a circle.</span>
<span class="udiff-line-modified-added">+         // This is 1-kappa, where kappa = 4 * (sqrt(2) - 1) / 3</span>
<span class="udiff-line-modified-added">+         return 0.447715;</span>
<span class="udiff-line-modified-added">+     }</span>
  
<span class="udiff-line-modified-removed">-         void addBeziersForRoundedRect(const FloatRect&amp;, const FloatSize&amp; topLeftRadius, const FloatSize&amp; topRightRadius, const FloatSize&amp; bottomLeftRadius, const FloatSize&amp; bottomRightRadius);</span>
<span class="udiff-line-modified-added">+     void addBeziersForRoundedRect(const FloatRect&amp;, const FloatSize&amp; topLeftRadius, const FloatSize&amp; topRightRadius, const FloatSize&amp; bottomLeftRadius, const FloatSize&amp; bottomRightRadius);</span>
  
  #if USE(CG) || USE(DIRECT2D)
<span class="udiff-line-modified-removed">-         void platformAddPathForRoundedRect(const FloatRect&amp;, const FloatSize&amp; topLeftRadius, const FloatSize&amp; topRightRadius, const FloatSize&amp; bottomLeftRadius, const FloatSize&amp; bottomRightRadius);</span>
<span class="udiff-line-modified-added">+     void platformAddPathForRoundedRect(const FloatRect&amp;, const FloatSize&amp; topLeftRadius, const FloatSize&amp; topRightRadius, const FloatSize&amp; bottomLeftRadius, const FloatSize&amp; bottomRightRadius);</span>
  #endif
  
  #if USE(DIRECT2D)
<span class="udiff-line-modified-removed">-         ID2D1GeometrySink* activePath() const { return m_activePath.get(); }</span>
<span class="udiff-line-modified-removed">-         void appendGeometry(ID2D1Geometry*);</span>
<span class="udiff-line-modified-removed">-         void createGeometryWithFillMode(WindRule, COMPtr&lt;ID2D1GeometryGroup&gt;&amp;) const;</span>
<span class="udiff-line-modified-removed">-         void drawDidComplete();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         HRESULT initializePathState();</span>
<span class="udiff-line-removed">-         void openFigureAtCurrentPointIfNecessary();</span>
<span class="udiff-line-removed">-         void closeAnyOpenGeometries();</span>
<span class="udiff-line-modified-added">+     void appendGeometry(ID2D1Geometry*);</span>
<span class="udiff-line-modified-added">+     void createGeometryWithFillMode(WindRule, COMPtr&lt;ID2D1GeometryGroup&gt;&amp;) const;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     void openFigureAtCurrentPointIfNecessary();</span>
<span class="udiff-line-modified-added">+     void closeAnyOpenGeometries(unsigned figureEndStyle) const;</span>
<span class="udiff-line-modified-added">+     void clearGeometries();</span>
  #endif
  
  #ifndef NDEBUG
<span class="udiff-line-modified-removed">-         void dump() const;</span>
<span class="udiff-line-modified-added">+     void dump() const;</span>
  #endif
  
<span class="udiff-line-modified-removed">-     private:</span>
<span class="udiff-line-modified-added">+     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;</span>
<span class="udiff-line-added">+     template&lt;class Decoder&gt; static Optional&lt;Path&gt; decode(Decoder&amp;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ private:</span>
  #if USE(DIRECT2D)
<span class="udiff-line-modified-removed">-         COMPtr&lt;ID2D1GeometryGroup&gt; m_path;</span>
<span class="udiff-line-modified-removed">-         COMPtr&lt;ID2D1PathGeometry&gt; m_activePathGeometry;</span>
<span class="udiff-line-modified-removed">-         COMPtr&lt;ID2D1GeometrySink&gt; m_activePath;</span>
<span class="udiff-line-modified-removed">-         size_t m_openFigureCount { 0 };</span>
<span class="udiff-line-modified-added">+     Vector&lt;ID2D1Geometry*&gt; m_geometries;</span>
<span class="udiff-line-modified-added">+     COMPtr&lt;ID2D1GeometryGroup&gt; m_path;</span>
<span class="udiff-line-modified-added">+     mutable COMPtr&lt;ID2D1GeometrySink&gt; m_activePath;</span>
<span class="udiff-line-modified-added">+     mutable bool m_figureIsOpened { false };</span>
  #else
<span class="udiff-line-modified-removed">-         PlatformPathPtr m_path { nullptr };</span>
<span class="udiff-line-modified-added">+     PlatformPathPtr m_path { nullptr };</span>
  #endif
<span class="udiff-line-modified-removed">-     };</span>
<span class="udiff-line-modified-added">+ };</span>
  
  WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, const Path&amp;);
  
<span class="udiff-line-added">+ template&lt;class Encoder&gt; void Path::encode(Encoder&amp; encoder) const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     uint64_t numPoints = 0;</span>
<span class="udiff-line-added">+     apply([&amp;numPoints](const PathElement&amp;) {</span>
<span class="udiff-line-added">+         ++numPoints;</span>
<span class="udiff-line-added">+     });</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     encoder &lt;&lt; numPoints;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     apply([&amp;](auto&amp; element) {</span>
<span class="udiff-line-added">+         encoder.encodeEnum(element.type);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         switch (element.type) {</span>
<span class="udiff-line-added">+         case PathElement::Type::MoveToPoint:</span>
<span class="udiff-line-added">+             encoder &lt;&lt; element.points[0];</span>
<span class="udiff-line-added">+             break;</span>
<span class="udiff-line-added">+         case PathElement::Type::AddLineToPoint:</span>
<span class="udiff-line-added">+             encoder &lt;&lt; element.points[0];</span>
<span class="udiff-line-added">+             break;</span>
<span class="udiff-line-added">+         case PathElement::Type::AddQuadCurveToPoint:</span>
<span class="udiff-line-added">+             encoder &lt;&lt; element.points[0];</span>
<span class="udiff-line-added">+             encoder &lt;&lt; element.points[1];</span>
<span class="udiff-line-added">+             break;</span>
<span class="udiff-line-added">+         case PathElement::Type::AddCurveToPoint:</span>
<span class="udiff-line-added">+             encoder &lt;&lt; element.points[0];</span>
<span class="udiff-line-added">+             encoder &lt;&lt; element.points[1];</span>
<span class="udiff-line-added">+             encoder &lt;&lt; element.points[2];</span>
<span class="udiff-line-added">+             break;</span>
<span class="udiff-line-added">+         case PathElement::Type::CloseSubpath:</span>
<span class="udiff-line-added">+             break;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     });</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ template&lt;class Decoder&gt; Optional&lt;Path&gt; Path::decode(Decoder&amp; decoder)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     Path path;</span>
<span class="udiff-line-added">+     uint64_t numPoints;</span>
<span class="udiff-line-added">+     if (!decoder.decode(numPoints))</span>
<span class="udiff-line-added">+         return WTF::nullopt;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     path.clear();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     for (uint64_t i = 0; i &lt; numPoints; ++i) {</span>
<span class="udiff-line-added">+         PathElement::Type elementType;</span>
<span class="udiff-line-added">+         if (!decoder.decodeEnum(elementType))</span>
<span class="udiff-line-added">+             return WTF::nullopt;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         switch (elementType) {</span>
<span class="udiff-line-added">+         case PathElement::Type::MoveToPoint: {</span>
<span class="udiff-line-added">+             FloatPoint point;</span>
<span class="udiff-line-added">+             if (!decoder.decode(point))</span>
<span class="udiff-line-added">+                 return WTF::nullopt;</span>
<span class="udiff-line-added">+             path.moveTo(point);</span>
<span class="udiff-line-added">+             break;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         case PathElement::Type::AddLineToPoint: {</span>
<span class="udiff-line-added">+             FloatPoint point;</span>
<span class="udiff-line-added">+             if (!decoder.decode(point))</span>
<span class="udiff-line-added">+                 return WTF::nullopt;</span>
<span class="udiff-line-added">+             path.addLineTo(point);</span>
<span class="udiff-line-added">+             break;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         case PathElement::Type::AddQuadCurveToPoint: {</span>
<span class="udiff-line-added">+             FloatPoint controlPoint;</span>
<span class="udiff-line-added">+             if (!decoder.decode(controlPoint))</span>
<span class="udiff-line-added">+                 return WTF::nullopt;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             FloatPoint endPoint;</span>
<span class="udiff-line-added">+             if (!decoder.decode(endPoint))</span>
<span class="udiff-line-added">+                 return WTF::nullopt;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             path.addQuadCurveTo(controlPoint, endPoint);</span>
<span class="udiff-line-added">+             break;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         case PathElement::Type::AddCurveToPoint: {</span>
<span class="udiff-line-added">+             FloatPoint controlPoint1;</span>
<span class="udiff-line-added">+             if (!decoder.decode(controlPoint1))</span>
<span class="udiff-line-added">+                 return WTF::nullopt;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             FloatPoint controlPoint2;</span>
<span class="udiff-line-added">+             if (!decoder.decode(controlPoint2))</span>
<span class="udiff-line-added">+                 return WTF::nullopt;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             FloatPoint endPoint;</span>
<span class="udiff-line-added">+             if (!decoder.decode(endPoint))</span>
<span class="udiff-line-added">+                 return WTF::nullopt;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             path.addBezierCurveTo(controlPoint1, controlPoint2, endPoint);</span>
<span class="udiff-line-added">+             break;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         case PathElement::Type::CloseSubpath:</span>
<span class="udiff-line-added">+             path.closeSubpath();</span>
<span class="udiff-line-added">+             break;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return path;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  }
  
  #endif
</pre>
<center><a href="Path.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="PathTraversalState.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>