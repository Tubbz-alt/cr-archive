<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/Modules/indexeddb/IDBActiveDOMObject.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../geolocation/GeolocationController.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="IDBCursor.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/indexeddb/IDBActiveDOMObject.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
23  * THE POSSIBILITY OF SUCH DAMAGE.
24  */
25 
26 #pragma once
27 
28 #include &quot;ActiveDOMObject.h&quot;
29 #include &quot;ScriptExecutionContext.h&quot;
30 #include &lt;wtf/Threading.h&gt;
31 
32 #if ENABLE(INDEXED_DATABASE)
33 
34 namespace WebCore {
35 
36 class IDBActiveDOMObject : public ActiveDOMObject {
37 public:
38     Thread&amp; originThread() const { return m_originThread.get(); }
39 
40     void contextDestroyed() final {
<span class="line-modified">41         ASSERT(m_originThread.ptr() == &amp;Thread::current());</span>
42 
43         Locker&lt;Lock&gt; lock(m_scriptExecutionContextLock);
44         ActiveDOMObject::contextDestroyed();
45     }
46 
47     template&lt;typename T, typename... Parameters, typename... Arguments&gt;
48     void performCallbackOnOriginThread(T&amp; object, void (T::*method)(Parameters...), Arguments&amp;&amp;... arguments)
49     {
50         ASSERT(&amp;originThread() == &amp;object.originThread());
51 
<span class="line-modified">52         if (&amp;object.originThread() == &amp;Thread::current()) {</span>
53             (object.*method)(arguments...);
54             return;
55         }
56 
57         Locker&lt;Lock&gt; lock(m_scriptExecutionContextLock);
58 
59         ScriptExecutionContext* context = scriptExecutionContext();
60         if (!context)
61             return;
62 
63         context-&gt;postCrossThreadTask(object, method, arguments...);
64     }
65 
66     void callFunctionOnOriginThread(WTF::Function&lt;void ()&gt;&amp;&amp; function)
67     {
<span class="line-modified">68         if (&amp;originThread() == &amp;Thread::current()) {</span>
69             function();
70             return;
71         }
72 
73         Locker&lt;Lock&gt; lock(m_scriptExecutionContextLock);
74 
75         ScriptExecutionContext* context = scriptExecutionContext();
76         if (!context)
77             return;
78 
79         context-&gt;postTask(WTFMove(function));
80     }
81 
82 protected:
83     IDBActiveDOMObject(ScriptExecutionContext* context)
84         : ActiveDOMObject(context)
85     {
86         ASSERT(context);
87     }
88 
</pre>
</td>
<td>
<hr />
<pre>
21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
23  * THE POSSIBILITY OF SUCH DAMAGE.
24  */
25 
26 #pragma once
27 
28 #include &quot;ActiveDOMObject.h&quot;
29 #include &quot;ScriptExecutionContext.h&quot;
30 #include &lt;wtf/Threading.h&gt;
31 
32 #if ENABLE(INDEXED_DATABASE)
33 
34 namespace WebCore {
35 
36 class IDBActiveDOMObject : public ActiveDOMObject {
37 public:
38     Thread&amp; originThread() const { return m_originThread.get(); }
39 
40     void contextDestroyed() final {
<span class="line-modified">41         ASSERT(canCurrentThreadAccessThreadLocalData(originThread()));</span>
42 
43         Locker&lt;Lock&gt; lock(m_scriptExecutionContextLock);
44         ActiveDOMObject::contextDestroyed();
45     }
46 
47     template&lt;typename T, typename... Parameters, typename... Arguments&gt;
48     void performCallbackOnOriginThread(T&amp; object, void (T::*method)(Parameters...), Arguments&amp;&amp;... arguments)
49     {
50         ASSERT(&amp;originThread() == &amp;object.originThread());
51 
<span class="line-modified">52         if (canCurrentThreadAccessThreadLocalData(object.originThread())) {</span>
53             (object.*method)(arguments...);
54             return;
55         }
56 
57         Locker&lt;Lock&gt; lock(m_scriptExecutionContextLock);
58 
59         ScriptExecutionContext* context = scriptExecutionContext();
60         if (!context)
61             return;
62 
63         context-&gt;postCrossThreadTask(object, method, arguments...);
64     }
65 
66     void callFunctionOnOriginThread(WTF::Function&lt;void ()&gt;&amp;&amp; function)
67     {
<span class="line-modified">68         if (canCurrentThreadAccessThreadLocalData(originThread())) {</span>
69             function();
70             return;
71         }
72 
73         Locker&lt;Lock&gt; lock(m_scriptExecutionContextLock);
74 
75         ScriptExecutionContext* context = scriptExecutionContext();
76         if (!context)
77             return;
78 
79         context-&gt;postTask(WTFMove(function));
80     }
81 
82 protected:
83     IDBActiveDOMObject(ScriptExecutionContext* context)
84         : ActiveDOMObject(context)
85     {
86         ASSERT(context);
87     }
88 
</pre>
</td>
</tr>
</table>
<center><a href="../geolocation/GeolocationController.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="IDBCursor.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>