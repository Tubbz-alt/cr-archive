<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/Operations.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ObjectPrototype.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Operations.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/Operations.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 29,64 ***</span>
  #include &quot;JSString.h&quot;
  #include &lt;wtf/MathExtras.h&gt;
  
  namespace JSC {
  
<span class="line-modified">! bool JSValue::equalSlowCase(ExecState* exec, JSValue v1, JSValue v2)</span>
  {
<span class="line-modified">!     return equalSlowCaseInline(exec, v1, v2);</span>
  }
  
<span class="line-modified">! bool JSValue::strictEqualSlowCase(ExecState* exec, JSValue v1, JSValue v2)</span>
  {
<span class="line-modified">!     return strictEqualSlowCaseInline(exec, v1, v2);</span>
  }
  
<span class="line-modified">! NEVER_INLINE JSValue jsAddSlowCase(CallFrame* callFrame, JSValue v1, JSValue v2)</span>
  {
      // exception for the Date exception in defaultValue()
<span class="line-modified">!     VM&amp; vm = callFrame-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">!     JSValue p1 = v1.toPrimitive(callFrame);</span>
      RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!     JSValue p2 = v2.toPrimitive(callFrame);</span>
      RETURN_IF_EXCEPTION(scope, { });
  
      if (p1.isString()) {
          if (p2.isCell()) {
<span class="line-modified">!             JSString* p2String = p2.toString(callFrame);</span>
              RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!             RELEASE_AND_RETURN(scope, jsString(callFrame, asString(p1), p2String));</span>
          }
<span class="line-modified">!         String p2String = p2.toWTFString(callFrame);</span>
          RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!         RELEASE_AND_RETURN(scope, jsString(callFrame, asString(p1), p2String));</span>
      }
  
      if (p2.isString()) {
          if (p1.isCell()) {
<span class="line-modified">!             JSString* p1String = p1.toString(callFrame);</span>
              RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!             RELEASE_AND_RETURN(scope, jsString(callFrame, p1String, asString(p2)));</span>
          }
<span class="line-modified">!         String p1String = p1.toWTFString(callFrame);</span>
          RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!         RELEASE_AND_RETURN(scope, jsString(callFrame, p1String, asString(p2)));</span>
      }
  
<span class="line-modified">!     auto leftNumeric = p1.toNumeric(callFrame);</span>
      RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!     auto rightNumeric = p2.toNumeric(callFrame);</span>
      RETURN_IF_EXCEPTION(scope, { });
  
      if (WTF::holds_alternative&lt;JSBigInt*&gt;(leftNumeric) || WTF::holds_alternative&lt;JSBigInt*&gt;(rightNumeric)) {
          if (WTF::holds_alternative&lt;JSBigInt*&gt;(leftNumeric) &amp;&amp; WTF::holds_alternative&lt;JSBigInt*&gt;(rightNumeric)) {
              scope.release();
<span class="line-modified">!             return JSBigInt::add(callFrame, WTF::get&lt;JSBigInt*&gt;(leftNumeric), WTF::get&lt;JSBigInt*&gt;(rightNumeric));</span>
          }
  
<span class="line-modified">!         return throwTypeError(callFrame, scope, &quot;Invalid mix of BigInt and other type in addition.&quot;_s);</span>
      }
  
      return jsNumber(WTF::get&lt;double&gt;(leftNumeric) + WTF::get&lt;double&gt;(rightNumeric));
  }
  
<span class="line-new-header">--- 29,64 ---</span>
  #include &quot;JSString.h&quot;
  #include &lt;wtf/MathExtras.h&gt;
  
  namespace JSC {
  
<span class="line-modified">! bool JSValue::equalSlowCase(JSGlobalObject* globalObject, JSValue v1, JSValue v2)</span>
  {
<span class="line-modified">!     return equalSlowCaseInline(globalObject, v1, v2);</span>
  }
  
<span class="line-modified">! bool JSValue::strictEqualSlowCase(JSGlobalObject* globalObject, JSValue v1, JSValue v2)</span>
  {
<span class="line-modified">!     return strictEqualSlowCaseInline(globalObject, v1, v2);</span>
  }
  
<span class="line-modified">! NEVER_INLINE JSValue jsAddSlowCase(JSGlobalObject* globalObject, JSValue v1, JSValue v2)</span>
  {
      // exception for the Date exception in defaultValue()
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">!     JSValue p1 = v1.toPrimitive(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!     JSValue p2 = v2.toPrimitive(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, { });
  
      if (p1.isString()) {
          if (p2.isCell()) {
<span class="line-modified">!             JSString* p2String = p2.toString(globalObject);</span>
              RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!             RELEASE_AND_RETURN(scope, jsString(globalObject, asString(p1), p2String));</span>
          }
<span class="line-modified">!         String p2String = p2.toWTFString(globalObject);</span>
          RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!         RELEASE_AND_RETURN(scope, jsString(globalObject, asString(p1), p2String));</span>
      }
  
      if (p2.isString()) {
          if (p1.isCell()) {
<span class="line-modified">!             JSString* p1String = p1.toString(globalObject);</span>
              RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!             RELEASE_AND_RETURN(scope, jsString(globalObject, p1String, asString(p2)));</span>
          }
<span class="line-modified">!         String p1String = p1.toWTFString(globalObject);</span>
          RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!         RELEASE_AND_RETURN(scope, jsString(globalObject, p1String, asString(p2)));</span>
      }
  
<span class="line-modified">!     auto leftNumeric = p1.toNumeric(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">!     auto rightNumeric = p2.toNumeric(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, { });
  
      if (WTF::holds_alternative&lt;JSBigInt*&gt;(leftNumeric) || WTF::holds_alternative&lt;JSBigInt*&gt;(rightNumeric)) {
          if (WTF::holds_alternative&lt;JSBigInt*&gt;(leftNumeric) &amp;&amp; WTF::holds_alternative&lt;JSBigInt*&gt;(rightNumeric)) {
              scope.release();
<span class="line-modified">!             return JSBigInt::add(globalObject, WTF::get&lt;JSBigInt*&gt;(leftNumeric), WTF::get&lt;JSBigInt*&gt;(rightNumeric));</span>
          }
  
<span class="line-modified">!         return throwTypeError(globalObject, scope, &quot;Invalid mix of BigInt and other type in addition.&quot;_s);</span>
      }
  
      return jsNumber(WTF::get&lt;double&gt;(leftNumeric) + WTF::get&lt;double&gt;(rightNumeric));
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 114,41 ***</span>
              return vm.smallStrings.functionString();
      }
      return vm.smallStrings.objectString();
  }
  
<span class="line-modified">! JSValue jsTypeStringForValue(CallFrame* callFrame, JSValue v)</span>
  {
<span class="line-modified">!     return jsTypeStringForValue(callFrame-&gt;vm(), callFrame-&gt;lexicalGlobalObject(), v);</span>
  }
  
<span class="line-modified">! bool jsIsObjectTypeOrNull(CallFrame* callFrame, JSValue v)</span>
  {
<span class="line-modified">!     VM&amp; vm = callFrame-&gt;vm();</span>
      if (!v.isCell())
          return v.isNull();
  
      JSType type = v.asCell()-&gt;type();
      if (type == StringType || type == SymbolType || type == BigIntType)
          return false;
      if (type &gt;= ObjectType) {
<span class="line-modified">!         if (asObject(v)-&gt;structure(vm)-&gt;masqueradesAsUndefined(callFrame-&gt;lexicalGlobalObject()))</span>
              return false;
          JSObject* object = asObject(v);
          if (object-&gt;isFunction(vm))
              return false;
      }
      return true;
  }
  
<span class="line-modified">! size_t normalizePrototypeChain(CallFrame* callFrame, JSCell* base, bool&amp; sawPolyProto)</span>
  {
<span class="line-modified">!     VM&amp; vm = callFrame-&gt;vm();</span>
      size_t count = 0;
      sawPolyProto = false;
      JSCell* current = base;
<span class="line-removed">-     JSGlobalObject* globalObject = callFrame-&gt;lexicalGlobalObject();</span>
      while (1) {
          Structure* structure = current-&gt;structure(vm);
          if (structure-&gt;isProxy())
              return InvalidPrototypeChain;
  
<span class="line-new-header">--- 114,40 ---</span>
              return vm.smallStrings.functionString();
      }
      return vm.smallStrings.objectString();
  }
  
<span class="line-modified">! JSValue jsTypeStringForValue(JSGlobalObject* globalObject, JSValue v)</span>
  {
<span class="line-modified">!     return jsTypeStringForValue(globalObject-&gt;vm(), globalObject, v);</span>
  }
  
<span class="line-modified">! bool jsIsObjectTypeOrNull(JSGlobalObject* globalObject, JSValue v)</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      if (!v.isCell())
          return v.isNull();
  
      JSType type = v.asCell()-&gt;type();
      if (type == StringType || type == SymbolType || type == BigIntType)
          return false;
      if (type &gt;= ObjectType) {
<span class="line-modified">!         if (asObject(v)-&gt;structure(vm)-&gt;masqueradesAsUndefined(globalObject))</span>
              return false;
          JSObject* object = asObject(v);
          if (object-&gt;isFunction(vm))
              return false;
      }
      return true;
  }
  
<span class="line-modified">! size_t normalizePrototypeChain(JSGlobalObject* globalObject, JSCell* base, bool&amp; sawPolyProto)</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      size_t count = 0;
      sawPolyProto = false;
      JSCell* current = base;
      while (1) {
          Structure* structure = current-&gt;structure(vm);
          if (structure-&gt;isProxy())
              return InvalidPrototypeChain;
  
</pre>
<center><a href="ObjectPrototype.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Operations.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>