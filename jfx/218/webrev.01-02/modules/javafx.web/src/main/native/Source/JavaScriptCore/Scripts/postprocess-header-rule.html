<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/JavaScriptCore/Scripts/postprocess-header-rule</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 #!/bin/bash
 2 #
 3 # Copyright (C) 2014-2019 Apple Inc. All rights reserved.
 4 #
 5 # Redistribution and use in source and binary forms, with or without
 6 # modification, are permitted provided that the following conditions
 7 # are met:
 8 # 1. Redistributions of source code must retain the above copyright
 9 #    notice, this list of conditions and the following disclaimer.
10 # 2. Redistributions in binary form must reproduce the above copyright
11 #    notice, this list of conditions and the following disclaimer in the
12 #    documentation and/or other materials provided with the distribution.
13 #
14 # THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
15 # AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
16 # THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
17 # PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
18 # BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
19 # CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
20 # SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
21 # INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
22 # CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
23 # ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
24 # THE POSSIBILITY OF SUCH DAMAGE.
25 #
26 
27 if [[ -z &quot;${SCRIPT_HEADER_VISIBILITY}&quot; ]]; then
28     exit 0
29 fi
30 
31 if [[ &quot;${JSC_FRAMEWORK_HEADER_POSTPROCESSING_DISABLED}&quot; == &quot;YES&quot; ]]; then
32     ditto &quot;${SCRIPT_INPUT_FILE}&quot; &quot;${SCRIPT_OUTPUT_FILE_0}&quot;
33     exit 0
34 fi
35 
36 function process_definitions () {
37     local DEFINITIONS_FILE=$1
38 
39     if [[ ! -f &quot;${DEFINITIONS_FILE}&quot; ]]; then
40         return 1
41     fi
42 
43     source &quot;${DEFINITIONS_FILE}&quot;
44 }
45 
46 function rewrite_headers () {
47     if [[ &quot;${PLATFORM_NAME}&quot; == &quot;macosx&quot; ]]; then
48         [[ -n ${OSX_VERSION} ]] || OSX_VERSION=${MACOSX_DEPLOYMENT_TARGET}
49         [[ -n ${IOS_VERSION} ]] || IOS_VERSION=&quot;NA&quot;
50         [[ -n ${OSX_VERSION_NUMBER} ]] || OSX_VERSION_NUMBER=${TARGET_MAC_OS_X_VERSION_MAJOR}
51         [[ -n ${IOS_VERSION_NUMBER} ]] || IOS_VERSION_NUMBER=&quot;0&quot;
52     elif [[ &quot;${PLATFORM_NAME}&quot; =~ &quot;iphone&quot; ]]; then
53         [[ -n ${IOS_VERSION} ]] || IOS_VERSION=${IPHONEOS_DEPLOYMENT_TARGET}
54         [[ -n ${OSX_VERSION} ]] || OSX_VERSION=&quot;NA&quot;
55         [[ -n ${OSX_VERSION_NUMBER} ]] || OSX_VERSION_NUMBER=&quot;0&quot;
56         [[ -n ${IOS_VERSION_NUMBER} ]] || IOS_VERSION_NUMBER=${SDK_VERSION_MAJOR}
57     fi
58 
59     SED_OPTIONS=(
60     )
61 
62     if [[ -n &quot;$OSX_VERSION&quot; &amp;&amp; -n &quot;$IOS_VERSION&quot; ]]; then
63         SED_OPTIONS+=(
64             -e s/JSC_MAC_TBA/${OSX_VERSION}/g
65             -e s/JSC_IOS_TBA/${IOS_VERSION}/g
66             -e s/JSC_MAC_VERSION_TBA/${OSX_VERSION_NUMBER}/g
67             -e s/JSC_IOS_VERSION_TBA/${IOS_VERSION_NUMBER}/g
68             -e s/JSC_API_AVAILABLE/API_AVAILABLE/
69             -e s/JSC_API_DEPRECATED/API_DEPRECATED/
70             -e &quot;s/^JSC_CLASS_AVAILABLE/JS_EXPORT API_AVAILABLE/&quot;
71             -e &quot;s/^JSC_CLASS_DEPRECATED/JS_EXPORT API_DEPRECATED/&quot;
72         )
73     else
74         SED_OPTIONS+=(
75             -e &#39;s/JSC_(API_|CLASS_)AVAILABLE\(.*\)\s*\)//g&#39;
76             -e &#39;s/JSC_(API_|CLASS_)DEPRECATED(_WITH_REPLACEMENT)?\(.*\)\s*\)//g&#39;
77             -e &#39;s/JSC_(MAC|IOS)_VERSION_TBA/0/g&#39;
78         )
79     fi
80 
81     SED_OPTIONS+=(${OTHER_SED_OPTIONS[*]})
82 
83     ditto &quot;${1}&quot; &quot;${2}&quot;
84     sed -i .tmp -E &quot;${SED_OPTIONS[@]}&quot; &quot;${2}&quot; || exit $?
85 }
86 
87 DEFINITIONS_PATH=usr/local/include/WebKitAdditions/Scripts/postprocess-framework-headers-definitions
88 
89 process_definitions &quot;${BUILT_PRODUCTS_DIR}/${DEFINITIONS_PATH}&quot; || process_definitions &quot;${SDKROOT}/${DEFINITIONS_PATH}&quot;
90 
91 rewrite_headers &quot;${SCRIPT_INPUT_FILE}&quot; &quot;${SCRIPT_OUTPUT_FILE_0}&quot;
    </pre>
  </body>
</html>