<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/html/track/TextTrackCueGeneric.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TextTrackCue.idl.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="TextTrackCueGeneric.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/html/track/TextTrackCueGeneric.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 45,11 ***</span>
  namespace WebCore {
  
  WTF_MAKE_ISO_ALLOCATED_IMPL(TextTrackCueGeneric);
  
  // This default value must be the same as the one specified in mediaControlsApple.css for -webkit-media-controls-closed-captions-container
<span class="line-modified">! const static int DEFAULTCAPTIONFONTSIZE = 10;</span>
  
  class TextTrackCueGenericBoxElement final : public VTTCueBox {
      WTF_MAKE_ISO_ALLOCATED_INLINE(TextTrackCueGenericBoxElement);
  public:
      static Ref&lt;TextTrackCueGenericBoxElement&gt; create(Document&amp; document, TextTrackCueGeneric&amp; cue)
<span class="line-new-header">--- 45,11 ---</span>
  namespace WebCore {
  
  WTF_MAKE_ISO_ALLOCATED_IMPL(TextTrackCueGeneric);
  
  // This default value must be the same as the one specified in mediaControlsApple.css for -webkit-media-controls-closed-captions-container
<span class="line-modified">! static constexpr int DEFAULTCAPTIONFONTSIZE = 10;</span>
  
  class TextTrackCueGenericBoxElement final : public VTTCueBox {
      WTF_MAKE_ISO_ALLOCATED_INLINE(TextTrackCueGenericBoxElement);
  public:
      static Ref&lt;TextTrackCueGenericBoxElement&gt; create(Document&amp; document, TextTrackCueGeneric&amp; cue)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 82,15 ***</span>
      double textPosition = cue-&gt;calculateComputedTextPosition();
  
      CSSValueID alignment = cue-&gt;getCSSAlignment();
      float size = static_cast&lt;float&gt;(cue-&gt;getCSSSize());
      if (cue-&gt;useDefaultPosition()) {
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyBottom, 0, CSSPrimitiveValue::CSS_PX);</span>
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyMarginBottom, 1.0, CSSPrimitiveValue::CSS_PERCENTAGE);</span>
      } else {
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyLeft, static_cast&lt;float&gt;(textPosition), CSSPrimitiveValue::CSS_PERCENTAGE);</span>
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyTop, static_cast&lt;float&gt;(cue-&gt;line()), CSSPrimitiveValue::CSS_PERCENTAGE);</span>
  
          double authorFontSize = videoSize.height() * cue-&gt;baseFontSizeRelativeToVideoHeight() / 100.0;
          if (!authorFontSize)
              authorFontSize = DEFAULTCAPTIONFONTSIZE;
  
<span class="line-new-header">--- 82,15 ---</span>
      double textPosition = cue-&gt;calculateComputedTextPosition();
  
      CSSValueID alignment = cue-&gt;getCSSAlignment();
      float size = static_cast&lt;float&gt;(cue-&gt;getCSSSize());
      if (cue-&gt;useDefaultPosition()) {
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyBottom, 0, CSSUnitType::CSS_PX);</span>
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyMarginBottom, 1.0, CSSUnitType::CSS_PERCENTAGE);</span>
      } else {
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyLeft, static_cast&lt;float&gt;(textPosition), CSSUnitType::CSS_PERCENTAGE);</span>
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyTop, static_cast&lt;float&gt;(cue-&gt;line()), CSSUnitType::CSS_PERCENTAGE);</span>
  
          double authorFontSize = videoSize.height() * cue-&gt;baseFontSizeRelativeToVideoHeight() / 100.0;
          if (!authorFontSize)
              authorFontSize = DEFAULTCAPTIONFONTSIZE;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 98,17 ***</span>
              authorFontSize *= cue-&gt;fontSizeMultiplier() / 100;
  
          double multiplier = fontSizeFromCaptionUserPrefs() / authorFontSize;
          double newCueSize = std::min(size * multiplier, 100.0);
          if (cue-&gt;getWritingDirection() == VTTCue::Horizontal) {
<span class="line-modified">!             setInlineStyleProperty(CSSPropertyWidth, newCueSize, CSSPrimitiveValue::CSS_PERCENTAGE);</span>
              if ((alignment == CSSValueMiddle || alignment == CSSValueCenter) &amp;&amp; multiplier != 1.0)
<span class="line-modified">!                 setInlineStyleProperty(CSSPropertyLeft, static_cast&lt;double&gt;(textPosition - (newCueSize - cue-&gt;getCSSSize()) / 2), CSSPrimitiveValue::CSS_PERCENTAGE);</span>
          } else {
<span class="line-modified">!             setInlineStyleProperty(CSSPropertyHeight, newCueSize,  CSSPrimitiveValue::CSS_PERCENTAGE);</span>
              if ((alignment == CSSValueMiddle || alignment == CSSValueCenter) &amp;&amp; multiplier != 1.0)
<span class="line-modified">!                 setInlineStyleProperty(CSSPropertyTop, static_cast&lt;double&gt;(cue-&gt;line() - (newCueSize - cue-&gt;getCSSSize()) / 2), CSSPrimitiveValue::CSS_PERCENTAGE);</span>
          }
      }
  
      double maxSize = 100.0;
  
<span class="line-new-header">--- 98,17 ---</span>
              authorFontSize *= cue-&gt;fontSizeMultiplier() / 100;
  
          double multiplier = fontSizeFromCaptionUserPrefs() / authorFontSize;
          double newCueSize = std::min(size * multiplier, 100.0);
          if (cue-&gt;getWritingDirection() == VTTCue::Horizontal) {
<span class="line-modified">!             setInlineStyleProperty(CSSPropertyWidth, newCueSize, CSSUnitType::CSS_PERCENTAGE);</span>
              if ((alignment == CSSValueMiddle || alignment == CSSValueCenter) &amp;&amp; multiplier != 1.0)
<span class="line-modified">!                 setInlineStyleProperty(CSSPropertyLeft, static_cast&lt;double&gt;(textPosition - (newCueSize - cue-&gt;getCSSSize()) / 2), CSSUnitType::CSS_PERCENTAGE);</span>
          } else {
<span class="line-modified">!             setInlineStyleProperty(CSSPropertyHeight, newCueSize,  CSSUnitType::CSS_PERCENTAGE);</span>
              if ((alignment == CSSValueMiddle || alignment == CSSValueCenter) &amp;&amp; multiplier != 1.0)
<span class="line-modified">!                 setInlineStyleProperty(CSSPropertyTop, static_cast&lt;double&gt;(cue-&gt;line() - (newCueSize - cue-&gt;getCSSSize()) / 2), CSSUnitType::CSS_PERCENTAGE);</span>
          }
      }
  
      double maxSize = 100.0;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 117,14 ***</span>
      else if (alignment == CSSValueStart || alignment == CSSValueLeft)
          maxSize = 100.0 - textPosition;
  
      if (cue-&gt;getWritingDirection() == VTTCue::Horizontal) {
          setInlineStyleProperty(CSSPropertyMinWidth, &quot;min-content&quot;);
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyMaxWidth, maxSize, CSSPrimitiveValue::CSS_PERCENTAGE);</span>
      } else {
          setInlineStyleProperty(CSSPropertyMinHeight, &quot;min-content&quot;);
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyMaxHeight, maxSize, CSSPrimitiveValue::CSS_PERCENTAGE);</span>
      }
  
      if (cue-&gt;foregroundColor().isValid())
          cueElement-&gt;setInlineStyleProperty(CSSPropertyColor, cue-&gt;foregroundColor().serialized());
      if (cue-&gt;highlightColor().isValid())
<span class="line-new-header">--- 117,14 ---</span>
      else if (alignment == CSSValueStart || alignment == CSSValueLeft)
          maxSize = 100.0 - textPosition;
  
      if (cue-&gt;getWritingDirection() == VTTCue::Horizontal) {
          setInlineStyleProperty(CSSPropertyMinWidth, &quot;min-content&quot;);
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyMaxWidth, maxSize, CSSUnitType::CSS_PERCENTAGE);</span>
      } else {
          setInlineStyleProperty(CSSPropertyMinHeight, &quot;min-content&quot;);
<span class="line-modified">!         setInlineStyleProperty(CSSPropertyMaxHeight, maxSize, CSSUnitType::CSS_PERCENTAGE);</span>
      }
  
      if (cue-&gt;foregroundColor().isValid())
          cueElement-&gt;setInlineStyleProperty(CSSPropertyColor, cue-&gt;foregroundColor().serialized());
      if (cue-&gt;highlightColor().isValid())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 194,11 ***</span>
      }
  
      double size = videoSize.height() * baseFontSizeRelativeToVideoHeight() / 100;
      if (fontSizeMultiplier())
          size *= fontSizeMultiplier() / 100;
<span class="line-modified">!     displayTreeInternal().setInlineStyleProperty(CSSPropertyFontSize, lround(size), CSSPrimitiveValue::CSS_PX);</span>
  }
  
  bool TextTrackCueGeneric::cueContentsMatch(const TextTrackCue&amp; cue) const
  {
      // Do call the parent class cueContentsMatch here, because we want to confirm
<span class="line-new-header">--- 194,11 ---</span>
      }
  
      double size = videoSize.height() * baseFontSizeRelativeToVideoHeight() / 100;
      if (fontSizeMultiplier())
          size *= fontSizeMultiplier() / 100;
<span class="line-modified">!     displayTreeInternal().setInlineStyleProperty(CSSPropertyFontSize, lround(size), CSSUnitType::CSS_PX);</span>
  }
  
  bool TextTrackCueGeneric::cueContentsMatch(const TextTrackCue&amp; cue) const
  {
      // Do call the parent class cueContentsMatch here, because we want to confirm
</pre>
<hr />
<pre>
<span class="line-old-header">*** 227,11 ***</span>
      // Do not call the parent class isEqual here, because we are not cueType() == VTTCue,
      // and will fail that equality test.
      if (!TextTrackCue::isEqual(cue, match))
          return false;
  
<span class="line-modified">!     if (cue.cueType() != TextTrackCue::Generic)</span>
          return false;
  
      return cueContentsMatch(cue);
  }
  
<span class="line-new-header">--- 227,11 ---</span>
      // Do not call the parent class isEqual here, because we are not cueType() == VTTCue,
      // and will fail that equality test.
      if (!TextTrackCue::isEqual(cue, match))
          return false;
  
<span class="line-modified">!     if (cue.cueType() != TextTrackCue::ConvertedToWebVTT)</span>
          return false;
  
      return cueContentsMatch(cue);
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 247,11 ***</span>
  bool TextTrackCueGeneric::isOrderedBefore(const TextTrackCue* that) const
  {
      if (VTTCue::isOrderedBefore(that))
          return true;
  
<span class="line-modified">!     if (that-&gt;cueType() == Generic &amp;&amp; startTime() == that-&gt;startTime() &amp;&amp; endTime() == that-&gt;endTime()) {</span>
          // Further order generic cues by their calculated line value.
          std::pair&lt;double, double&gt; thisPosition = getPositionCoordinates();
          std::pair&lt;double, double&gt; thatPosition = toVTTCue(that)-&gt;getPositionCoordinates();
          return thisPosition.second &gt; thatPosition.second || (thisPosition.second == thatPosition.second &amp;&amp; thisPosition.first &lt; thatPosition.first);
      }
<span class="line-new-header">--- 247,11 ---</span>
  bool TextTrackCueGeneric::isOrderedBefore(const TextTrackCue* that) const
  {
      if (VTTCue::isOrderedBefore(that))
          return true;
  
<span class="line-modified">!     if (that-&gt;cueType() == ConvertedToWebVTT &amp;&amp; startTime() == that-&gt;startTime() &amp;&amp; endTime() == that-&gt;endTime()) {</span>
          // Further order generic cues by their calculated line value.
          std::pair&lt;double, double&gt; thisPosition = getPositionCoordinates();
          std::pair&lt;double, double&gt; thatPosition = toVTTCue(that)-&gt;getPositionCoordinates();
          return thisPosition.second &gt; thatPosition.second || (thisPosition.second == thatPosition.second &amp;&amp; thisPosition.first &lt; thatPosition.first);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 259,18 ***</span>
      return false;
  }
  
  bool TextTrackCueGeneric::isPositionedAbove(const TextTrackCue* that) const
  {
<span class="line-modified">!     if (that-&gt;cueType() == Generic &amp;&amp; startTime() == that-&gt;startTime() &amp;&amp; endTime() == that-&gt;endTime()) {</span>
          // Further order generic cues by their calculated line value.
          std::pair&lt;double, double&gt; thisPosition = getPositionCoordinates();
          std::pair&lt;double, double&gt; thatPosition = toVTTCue(that)-&gt;getPositionCoordinates();
          return thisPosition.second &gt; thatPosition.second || (thisPosition.second == thatPosition.second &amp;&amp; thisPosition.first &lt; thatPosition.first);
      }
  
<span class="line-modified">!     if (that-&gt;cueType() == Generic)</span>
          return startTime() &gt; that-&gt;startTime();
  
      return VTTCue::isOrderedBefore(that);
  }
  
<span class="line-new-header">--- 259,18 ---</span>
      return false;
  }
  
  bool TextTrackCueGeneric::isPositionedAbove(const TextTrackCue* that) const
  {
<span class="line-modified">!     if (that-&gt;cueType() == ConvertedToWebVTT &amp;&amp; startTime() == that-&gt;startTime() &amp;&amp; endTime() == that-&gt;endTime()) {</span>
          // Further order generic cues by their calculated line value.
          std::pair&lt;double, double&gt; thisPosition = getPositionCoordinates();
          std::pair&lt;double, double&gt; thatPosition = toVTTCue(that)-&gt;getPositionCoordinates();
          return thisPosition.second &gt; thatPosition.second || (thisPosition.second == thatPosition.second &amp;&amp; thisPosition.first &lt; thatPosition.first);
      }
  
<span class="line-modified">!     if (that-&gt;cueType() == ConvertedToWebVTT)</span>
          return startTime() &gt; that-&gt;startTime();
  
      return VTTCue::isOrderedBefore(that);
  }
  
</pre>
<center><a href="TextTrackCue.idl.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="TextTrackCueGeneric.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>