<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/texmap/coordinated/CoordinatedGraphicsLayer.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../TextureMapperShaderProgram.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="CoordinatedGraphicsLayer.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/texmap/coordinated/CoordinatedGraphicsLayer.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 104,13 ***</span>
          downcast&lt;CoordinatedGraphicsLayer&gt;(child.get()).setShouldUpdateVisibleRect();
      if (replicaLayer())
          downcast&lt;CoordinatedGraphicsLayer&gt;(*replicaLayer()).setShouldUpdateVisibleRect();
  }
  
<span class="line-modified">! void CoordinatedGraphicsLayer::didChangeGeometry()</span>
  {
<span class="line-modified">!     notifyFlushRequired();</span>
      setShouldUpdateVisibleRect();
  }
  
  CoordinatedGraphicsLayer::CoordinatedGraphicsLayer(Type layerType, GraphicsLayerClient&amp; client)
      : GraphicsLayer(layerType, client)
<span class="line-new-header">--- 104,14 ---</span>
          downcast&lt;CoordinatedGraphicsLayer&gt;(child.get()).setShouldUpdateVisibleRect();
      if (replicaLayer())
          downcast&lt;CoordinatedGraphicsLayer&gt;(*replicaLayer()).setShouldUpdateVisibleRect();
  }
  
<span class="line-modified">! void CoordinatedGraphicsLayer::didChangeGeometry(FlushNotification flushNotification)</span>
  {
<span class="line-modified">!     if (flushNotification == FlushNotification::Required)</span>
<span class="line-added">+         notifyFlushRequired();</span>
      setShouldUpdateVisibleRect();
  }
  
  CoordinatedGraphicsLayer::CoordinatedGraphicsLayer(Type layerType, GraphicsLayerClient&amp; client)
      : GraphicsLayer(layerType, client)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 236,10 ***</span>
<span class="line-new-header">--- 237,19 ---</span>
      GraphicsLayer::setPosition(p);
      m_nicosia.delta.positionChanged = true;
      didChangeGeometry();
  }
  
<span class="line-added">+ void CoordinatedGraphicsLayer::syncPosition(const FloatPoint&amp; p)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (position() == p)</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
<span class="line-added">+     GraphicsLayer::syncPosition(p);</span>
<span class="line-added">+     didChangeGeometry(FlushNotification::NotRequired);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  void CoordinatedGraphicsLayer::setAnchorPoint(const FloatPoint3D&amp; p)
  {
      if (anchorPoint() == p)
          return;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 259,10 ***</span>
<span class="line-new-header">--- 269,29 ---</span>
      if (maskLayer())
          maskLayer()-&gt;setSize(size);
      didChangeGeometry();
  }
  
<span class="line-added">+ void CoordinatedGraphicsLayer::setBoundsOrigin(const FloatPoint&amp; boundsOrigin)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (this-&gt;boundsOrigin() == boundsOrigin)</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
<span class="line-added">+     GraphicsLayer::setBoundsOrigin(boundsOrigin);</span>
<span class="line-added">+     m_nicosia.delta.boundsOriginChanged = true;</span>
<span class="line-added">+     didChangeGeometry();</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ void CoordinatedGraphicsLayer::syncBoundsOrigin(const FloatPoint&amp; boundsOrigin)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (this-&gt;boundsOrigin() == boundsOrigin)</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
<span class="line-added">+     GraphicsLayer::syncBoundsOrigin(boundsOrigin);</span>
<span class="line-added">+     didChangeGeometry(FlushNotification::NotRequired);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  void CoordinatedGraphicsLayer::setTransform(const TransformationMatrix&amp; t)
  {
      if (transform() == t)
          return;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 792,11 ***</span>
                  !image.currentFrameKnownToBeOpaque() ? Nicosia::Buffer::SupportsAlpha : Nicosia::Buffer::NoFlags);
              Nicosia::PaintingContext::paint(buffer,
                  [&amp;image](GraphicsContext&amp; context)
                  {
                      IntRect rect { { }, IntSize { image.size() } };
<span class="line-modified">!                     context.drawImage(image, rect, rect, ImagePaintingOptions(CompositeCopy));</span>
                  });
              layerState.nativeImageID = nativeImageID;
              layerState.update.buffer = WTFMove(buffer);
              m_nicosia.delta.imageBackingChanged = true;
          }
<span class="line-new-header">--- 821,11 ---</span>
                  !image.currentFrameKnownToBeOpaque() ? Nicosia::Buffer::SupportsAlpha : Nicosia::Buffer::NoFlags);
              Nicosia::PaintingContext::paint(buffer,
                  [&amp;image](GraphicsContext&amp; context)
                  {
                      IntRect rect { { }, IntSize { image.size() } };
<span class="line-modified">!                     context.drawImage(image, rect, rect, ImagePaintingOptions(CompositeOperator::Copy));</span>
                  });
              layerState.nativeImageID = nativeImageID;
              layerState.update.buffer = WTFMove(buffer);
              m_nicosia.delta.imageBackingChanged = true;
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 841,11 ***</span>
                      state.solidColor = m_solidColor;
  
                  if (localDelta.filtersChanged)
                      state.filters = filters();
                  if (localDelta.animationsChanged)
<span class="line-modified">!                     state.animations = m_animations.getActiveAnimations();</span>
  
                  if (localDelta.childrenChanged) {
                      state.children = WTF::map(children(),
                          [](auto&amp; child)
                          {
<span class="line-new-header">--- 870,11 ---</span>
                      state.solidColor = m_solidColor;
  
                  if (localDelta.filtersChanged)
                      state.filters = filters();
                  if (localDelta.animationsChanged)
<span class="line-modified">!                     state.animations = m_animations;</span>
  
                  if (localDelta.childrenChanged) {
                      state.children = WTF::map(children(),
                          [](auto&amp; child)
                          {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1130,11 ***</span>
  
  FloatPoint CoordinatedGraphicsLayer::computePositionRelativeToBase()
  {
      FloatPoint offset;
      for (const GraphicsLayer* currLayer = this; currLayer; currLayer = currLayer-&gt;parent())
<span class="line-modified">!         offset += currLayer-&gt;position();</span>
  
      return offset;
  }
  
  void CoordinatedGraphicsLayer::computePixelAlignment(FloatPoint&amp; position, FloatSize&amp; size, FloatPoint3D&amp; anchorPoint, FloatSize&amp; alignmentOffset)
<span class="line-new-header">--- 1159,11 ---</span>
  
  FloatPoint CoordinatedGraphicsLayer::computePositionRelativeToBase()
  {
      FloatPoint offset;
      for (const GraphicsLayer* currLayer = this; currLayer; currLayer = currLayer-&gt;parent())
<span class="line-modified">!         offset += (currLayer-&gt;position() - currLayer-&gt;boundsOrigin());</span>
  
      return offset;
  }
  
  void CoordinatedGraphicsLayer::computePixelAlignment(FloatPoint&amp; position, FloatSize&amp; size, FloatPoint3D&amp; anchorPoint, FloatSize&amp; alignmentOffset)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1206,11 ***</span>
      setNeedsVisibleRectAdjustment();
  }
  
  bool CoordinatedGraphicsLayer::shouldHaveBackingStore() const
  {
<span class="line-modified">!     return drawsContent() &amp;&amp; contentsAreVisible() &amp;&amp; !m_size.isEmpty();</span>
  }
  
  bool CoordinatedGraphicsLayer::selfOrAncestorHasActiveTransformAnimation() const
  {
      if (m_animations.hasActiveAnimationsOfType(AnimatedPropertyTransform))
<span class="line-new-header">--- 1235,12 ---</span>
      setNeedsVisibleRectAdjustment();
  }
  
  bool CoordinatedGraphicsLayer::shouldHaveBackingStore() const
  {
<span class="line-modified">!     return drawsContent() &amp;&amp; contentsAreVisible() &amp;&amp; !m_size.isEmpty()</span>
<span class="line-added">+         &amp;&amp; (!!opacity() || m_animations.hasActiveAnimationsOfType(AnimatedPropertyOpacity));</span>
  }
  
  bool CoordinatedGraphicsLayer::selfOrAncestorHasActiveTransformAnimation() const
  {
      if (m_animations.hasActiveAnimationsOfType(AnimatedPropertyTransform))
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1300,10 ***</span>
<span class="line-new-header">--- 1330,17 ---</span>
  bool CoordinatedGraphicsLayer::usesContentsLayer() const
  {
      return m_nicosia.contentLayer || m_compositedImage;
  }
  
<span class="line-added">+ #if USE(NICOSIA)</span>
<span class="line-added">+ PlatformLayer* CoordinatedGraphicsLayer::platformLayer() const</span>
<span class="line-added">+ {</span>
<span class="line-added">+     return m_nicosia.layer.get();</span>
<span class="line-added">+ }</span>
<span class="line-added">+ #endif</span>
<span class="line-added">+ </span>
  } // namespace WebCore
  
  SPECIALIZE_TYPE_TRAITS_ANIMATEDBACKINGSTORECLIENT(WebCore::CoordinatedAnimatedBackingStoreClient, type() == Nicosia::AnimatedBackingStoreClient::Type::Coordinated)
  
  #endif // USE(COORDINATED_GRAPHICS)
</pre>
<center><a href="../TextureMapperShaderProgram.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="CoordinatedGraphicsLayer.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>