<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/html/CanvasBase.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CanvasBase.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CustomPaintCanvas.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/html/CanvasBase.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -23,23 +23,24 @@</span>
   * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   */
  
  #pragma once
  
<span class="udiff-line-added">+ #include &quot;IntSize.h&quot;</span>
  #include &lt;wtf/HashSet.h&gt;
  #include &lt;wtf/TypeCasts.h&gt;
  
  namespace WebCore {
  
  class AffineTransform;
  class CanvasBase;
  class CanvasRenderingContext;
  class Element;
  class GraphicsContext;
<span class="udiff-line-added">+ class GraphicsContextStateSaver;</span>
  class Image;
  class ImageBuffer;
<span class="udiff-line-removed">- class IntSize;</span>
  class FloatRect;
  class ScriptExecutionContext;
  class SecurityOrigin;
  
  class CanvasObserver {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -62,53 +63,72 @@</span>
  
      virtual bool isHTMLCanvasElement() const { return false; }
      virtual bool isOffscreenCanvas() const { return false; }
      virtual bool isCustomPaintCanvas() const { return false; }
  
<span class="udiff-line-modified-removed">-     virtual unsigned width() const = 0;</span>
<span class="udiff-line-modified-removed">-     virtual unsigned height() const = 0;</span>
<span class="udiff-line-modified-removed">-     virtual const IntSize&amp; size() const  = 0;</span>
<span class="udiff-line-modified-removed">-     virtual void setSize(const IntSize&amp;) = 0;</span>
<span class="udiff-line-modified-added">+     virtual unsigned width() const { return m_size.width(); }</span>
<span class="udiff-line-modified-added">+     virtual unsigned height() const { return m_size.height(); }</span>
<span class="udiff-line-modified-added">+     const IntSize&amp; size() const { return m_size; }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     ImageBuffer* buffer() const;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     virtual AffineTransform baseTransform() const;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     void makeRenderingResultsAvailable();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     size_t memoryCost() const;</span>
<span class="udiff-line-added">+     size_t externalMemoryCost() const;</span>
  
      void setOriginClean() { m_originClean = true; }
      void setOriginTainted() { m_originClean = false; }
      bool originClean() const { return m_originClean; }
  
      virtual SecurityOrigin* securityOrigin() const { return nullptr; }
      ScriptExecutionContext* scriptExecutionContext() const { return canvasBaseScriptExecutionContext();  }
  
<span class="udiff-line-modified-removed">-     CanvasRenderingContext* renderingContext() const;</span>
<span class="udiff-line-modified-added">+     virtual CanvasRenderingContext* renderingContext() const = 0;</span>
  
      void addObserver(CanvasObserver&amp;);
      void removeObserver(CanvasObserver&amp;);
      void notifyObserversCanvasChanged(const FloatRect&amp;);
      void notifyObserversCanvasResized();
      void notifyObserversCanvasDestroyed(); // Must be called in destruction before clearing m_context.
  
      HashSet&lt;Element*&gt; cssCanvasClients() const;
  
<span class="udiff-line-modified-removed">-     virtual GraphicsContext* drawingContext() const = 0;</span>
<span class="udiff-line-modified-removed">-     virtual GraphicsContext* existingDrawingContext() const = 0;</span>
<span class="udiff-line-modified-added">+     virtual GraphicsContext* drawingContext() const;</span>
<span class="udiff-line-modified-added">+     virtual GraphicsContext* existingDrawingContext() const;</span>
  
<span class="udiff-line-removed">-     virtual void makeRenderingResultsAvailable() = 0;</span>
      virtual void didDraw(const FloatRect&amp;) = 0;
  
<span class="udiff-line-removed">-     virtual AffineTransform baseTransform() const = 0;</span>
      virtual Image* copiedImage() const = 0;
<span class="udiff-line-removed">- </span>
      bool callTracingActive() const;
  
  protected:
<span class="udiff-line-modified-removed">-     CanvasBase();</span>
<span class="udiff-line-modified-added">+     explicit CanvasBase(IntSize);</span>
  
      virtual ScriptExecutionContext* canvasBaseScriptExecutionContext() const = 0;
  
<span class="udiff-line-modified-removed">-     std::unique_ptr&lt;CanvasRenderingContext&gt; m_context;</span>
<span class="udiff-line-modified-added">+     virtual void setSize(const IntSize&amp; size) { m_size = size; }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     std::unique_ptr&lt;ImageBuffer&gt; setImageBuffer(std::unique_ptr&lt;ImageBuffer&gt;&amp;&amp;) const;</span>
<span class="udiff-line-added">+     virtual bool hasCreatedImageBuffer() const { return false; }</span>
<span class="udiff-line-added">+     static size_t activePixelMemory();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     void resetGraphicsContextState() const;</span>
  
  private:
<span class="udiff-line-added">+     virtual void createImageBuffer() const { }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     mutable IntSize m_size;</span>
<span class="udiff-line-added">+     mutable Lock m_imageBufferAssignmentLock;</span>
<span class="udiff-line-added">+     mutable std::unique_ptr&lt;ImageBuffer&gt; m_imageBuffer;</span>
<span class="udiff-line-added">+     mutable size_t m_imageBufferCost { 0 };</span>
<span class="udiff-line-added">+     mutable std::unique_ptr&lt;GraphicsContextStateSaver&gt; m_contextStateSaver;</span>
<span class="udiff-line-added">+ </span>
      bool m_originClean { true };
<span class="udiff-line-modified-removed">- #ifndef NDEBUG</span>
<span class="udiff-line-modified-added">+ #if ASSERT_ENABLED</span>
      bool m_didNotifyObserversCanvasDestroyed { false };
  #endif
      HashSet&lt;CanvasObserver*&gt; m_observers;
  };
  
</pre>
<center><a href="CanvasBase.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CustomPaintCanvas.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>