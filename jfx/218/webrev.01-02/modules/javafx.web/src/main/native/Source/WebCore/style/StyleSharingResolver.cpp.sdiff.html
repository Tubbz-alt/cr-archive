<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/style/StyleSharingResolver.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="StyleScope.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StyleSharingResolver.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/style/StyleSharingResolver.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;StyleSharingResolver.h&quot;
 28 
<span class="line-removed"> 29 #include &quot;DocumentRuleSets.h&quot;</span>
 30 #include &quot;ElementRuleCollector.h&quot;
 31 #include &quot;FullscreenManager.h&quot;
 32 #include &quot;HTMLInputElement.h&quot;
 33 #include &quot;HTMLNames.h&quot;
 34 #include &quot;NodeRenderStyle.h&quot;
 35 #include &quot;RenderStyle.h&quot;
 36 #include &quot;SVGElement.h&quot;
 37 #include &quot;ShadowRoot.h&quot;

 38 #include &quot;StyleScope.h&quot;

 39 #include &quot;StyleUpdate.h&quot;
 40 #include &quot;StyledElement.h&quot;
 41 #include &quot;VisitedLinkState.h&quot;
 42 #include &quot;WebVTTElement.h&quot;
 43 #include &quot;XMLNames.h&quot;
 44 
 45 namespace WebCore {
 46 namespace Style {
 47 
 48 static const unsigned cStyleSearchThreshold = 10;
 49 
 50 struct SharingResolver::Context {
 51     const Update&amp; update;
 52     const StyledElement&amp; element;
 53     bool elementAffectedByClassRules;
 54     InsideLink elementLinkState;
 55 };
 56 
<span class="line-modified"> 57 SharingResolver::SharingResolver(const Document&amp; document, const DocumentRuleSets&amp; ruleSets, const SelectorFilter&amp; selectorFilter)</span>
 58     : m_document(document)
 59     , m_ruleSets(ruleSets)
 60     , m_selectorFilter(selectorFilter)
 61 {
 62 }
 63 
 64 static inline bool parentElementPreventsSharing(const Element&amp; parentElement)
 65 {
 66     return parentElement.hasFlagsSetDuringStylingOfChildren();
 67 }
 68 
 69 static inline bool elementHasDirectionAuto(const Element&amp; element)
 70 {
<span class="line-removed"> 71     // FIXME: This line is surprisingly hot, we may wish to inline hasDirectionAuto into StyleResolver.</span>
 72     return is&lt;HTMLElement&gt;(element) &amp;&amp; downcast&lt;HTMLElement&gt;(element).hasDirectionAuto();
 73 }
 74 
 75 std::unique_ptr&lt;RenderStyle&gt; SharingResolver::resolve(const Element&amp; searchElement, const Update&amp; update)
 76 {
 77     if (!is&lt;StyledElement&gt;(searchElement))
 78         return nullptr;
 79     auto&amp; element = downcast&lt;StyledElement&gt;(searchElement);
 80     if (!element.parentElement())
 81         return nullptr;
 82     auto&amp; parentElement = *element.parentElement();
 83     if (parentElement.shadowRoot())
 84         return nullptr;
 85     if (!update.elementStyle(parentElement))
 86         return nullptr;
 87     // If the element has inline style it is probably unique.
 88     if (element.inlineStyle())
 89         return nullptr;
 90     if (element.isSVGElement() &amp;&amp; downcast&lt;SVGElement&gt;(element).animatedSMILStyleProperties())
 91         return nullptr;
</pre>
</td>
<td>
<hr />
<pre>
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;StyleSharingResolver.h&quot;
 28 

 29 #include &quot;ElementRuleCollector.h&quot;
 30 #include &quot;FullscreenManager.h&quot;
 31 #include &quot;HTMLInputElement.h&quot;
 32 #include &quot;HTMLNames.h&quot;
 33 #include &quot;NodeRenderStyle.h&quot;
 34 #include &quot;RenderStyle.h&quot;
 35 #include &quot;SVGElement.h&quot;
 36 #include &quot;ShadowRoot.h&quot;
<span class="line-added"> 37 #include &quot;StyleResolver.h&quot;</span>
 38 #include &quot;StyleScope.h&quot;
<span class="line-added"> 39 #include &quot;StyleScopeRuleSets.h&quot;</span>
 40 #include &quot;StyleUpdate.h&quot;
 41 #include &quot;StyledElement.h&quot;
 42 #include &quot;VisitedLinkState.h&quot;
 43 #include &quot;WebVTTElement.h&quot;
 44 #include &quot;XMLNames.h&quot;
 45 
 46 namespace WebCore {
 47 namespace Style {
 48 
 49 static const unsigned cStyleSearchThreshold = 10;
 50 
 51 struct SharingResolver::Context {
 52     const Update&amp; update;
 53     const StyledElement&amp; element;
 54     bool elementAffectedByClassRules;
 55     InsideLink elementLinkState;
 56 };
 57 
<span class="line-modified"> 58 SharingResolver::SharingResolver(const Document&amp; document, const ScopeRuleSets&amp; ruleSets, const SelectorFilter&amp; selectorFilter)</span>
 59     : m_document(document)
 60     , m_ruleSets(ruleSets)
 61     , m_selectorFilter(selectorFilter)
 62 {
 63 }
 64 
 65 static inline bool parentElementPreventsSharing(const Element&amp; parentElement)
 66 {
 67     return parentElement.hasFlagsSetDuringStylingOfChildren();
 68 }
 69 
 70 static inline bool elementHasDirectionAuto(const Element&amp; element)
 71 {

 72     return is&lt;HTMLElement&gt;(element) &amp;&amp; downcast&lt;HTMLElement&gt;(element).hasDirectionAuto();
 73 }
 74 
 75 std::unique_ptr&lt;RenderStyle&gt; SharingResolver::resolve(const Element&amp; searchElement, const Update&amp; update)
 76 {
 77     if (!is&lt;StyledElement&gt;(searchElement))
 78         return nullptr;
 79     auto&amp; element = downcast&lt;StyledElement&gt;(searchElement);
 80     if (!element.parentElement())
 81         return nullptr;
 82     auto&amp; parentElement = *element.parentElement();
 83     if (parentElement.shadowRoot())
 84         return nullptr;
 85     if (!update.elementStyle(parentElement))
 86         return nullptr;
 87     // If the element has inline style it is probably unique.
 88     if (element.inlineStyle())
 89         return nullptr;
 90     if (element.isSVGElement() &amp;&amp; downcast&lt;SVGElement&gt;(element).animatedSMILStyleProperties())
 91         return nullptr;
</pre>
</td>
</tr>
</table>
<center><a href="StyleScope.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StyleSharingResolver.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>