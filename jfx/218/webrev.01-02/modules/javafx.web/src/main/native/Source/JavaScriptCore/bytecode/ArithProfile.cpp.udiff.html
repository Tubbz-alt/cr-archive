<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/ArithProfile.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AdaptiveInferredPropertyValueWatchpointBase.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ArithProfile.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/ArithProfile.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -30,11 +30,12 @@</span>
  #include &quot;JSCInlines.h&quot;
  
  namespace JSC {
  
  #if ENABLE(JIT)
<span class="udiff-line-modified-removed">- void ArithProfile::emitObserveResult(CCallHelpers&amp; jit, JSValueRegs regs, TagRegistersMode mode)</span>
<span class="udiff-line-modified-added">+ template&lt;typename BitfieldType&gt;</span>
<span class="udiff-line-added">+ void ArithProfile&lt;BitfieldType&gt;::emitObserveResult(CCallHelpers&amp; jit, JSValueRegs regs, TagRegistersMode mode)</span>
  {
      if (!shouldEmitSetDouble() &amp;&amp; !shouldEmitSetNonNumeric() &amp;&amp; !shouldEmitSetBigInt())
          return;
  
      CCallHelpers::JumpList done;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -56,54 +57,72 @@</span>
      emitSetNonNumeric(jit);
  
      done.link(&amp;jit);
  }
  
<span class="udiff-line-modified-removed">- bool ArithProfile::shouldEmitSetDouble() const</span>
<span class="udiff-line-modified-added">+ template&lt;typename BitfieldType&gt;</span>
<span class="udiff-line-added">+ bool ArithProfile&lt;BitfieldType&gt;::shouldEmitSetDouble() const</span>
  {
<span class="udiff-line-modified-removed">-     uint32_t mask = ArithProfile::Int32Overflow | ArithProfile::Int52Overflow | ArithProfile::NegZeroDouble | ArithProfile::NonNegZeroDouble;</span>
<span class="udiff-line-modified-added">+     BitfieldType mask = ObservedResults::Int32Overflow | ObservedResults::Int52Overflow | ObservedResults::NegZeroDouble | ObservedResults::NonNegZeroDouble;</span>
      return (m_bits &amp; mask) != mask;
  }
  
<span class="udiff-line-modified-removed">- void ArithProfile::emitSetDouble(CCallHelpers&amp; jit) const</span>
<span class="udiff-line-modified-added">+ template&lt;typename BitfieldType&gt;</span>
<span class="udiff-line-added">+ void ArithProfile&lt;BitfieldType&gt;::emitSetDouble(CCallHelpers&amp; jit) const</span>
  {
      if (shouldEmitSetDouble())
<span class="udiff-line-modified-removed">-         jit.or32(CCallHelpers::TrustedImm32(ArithProfile::Int32Overflow | ArithProfile::Int52Overflow | ArithProfile::NegZeroDouble | ArithProfile::NonNegZeroDouble), CCallHelpers::AbsoluteAddress(addressOfBits()));</span>
<span class="udiff-line-modified-added">+         emitUnconditionalSet(jit, ObservedResults::Int32Overflow | ObservedResults::Int52Overflow | ObservedResults::NegZeroDouble | ObservedResults::NonNegZeroDouble);</span>
  }
  
<span class="udiff-line-modified-removed">- bool ArithProfile::shouldEmitSetNonNumeric() const</span>
<span class="udiff-line-modified-added">+ template&lt;typename BitfieldType&gt;</span>
<span class="udiff-line-added">+ bool ArithProfile&lt;BitfieldType&gt;::shouldEmitSetNonNumeric() const</span>
  {
<span class="udiff-line-modified-removed">-     uint32_t mask = ArithProfile::NonNumeric;</span>
<span class="udiff-line-modified-added">+     BitfieldType mask = ObservedResults::NonNumeric;</span>
      return (m_bits &amp; mask) != mask;
  }
  
<span class="udiff-line-modified-removed">- bool ArithProfile::shouldEmitSetBigInt() const</span>
<span class="udiff-line-modified-added">+ template&lt;typename BitfieldType&gt;</span>
<span class="udiff-line-added">+ void ArithProfile&lt;BitfieldType&gt;::emitSetNonNumeric(CCallHelpers&amp; jit) const</span>
  {
<span class="udiff-line-modified-removed">-     uint32_t mask = ArithProfile::BigInt;</span>
<span class="udiff-line-modified-removed">-     return (m_bits &amp; mask) != mask;</span>
<span class="udiff-line-modified-added">+     if (shouldEmitSetNonNumeric())</span>
<span class="udiff-line-modified-added">+         emitUnconditionalSet(jit, ObservedResults::NonNumeric);</span>
  }
  
<span class="udiff-line-modified-removed">- void ArithProfile::emitSetNonNumeric(CCallHelpers&amp; jit) const</span>
<span class="udiff-line-modified-added">+ template&lt;typename BitfieldType&gt;</span>
<span class="udiff-line-added">+ bool ArithProfile&lt;BitfieldType&gt;::shouldEmitSetBigInt() const</span>
  {
<span class="udiff-line-modified-removed">-     if (shouldEmitSetNonNumeric())</span>
<span class="udiff-line-modified-removed">-         jit.or32(CCallHelpers::TrustedImm32(ArithProfile::NonNumeric), CCallHelpers::AbsoluteAddress(addressOfBits()));</span>
<span class="udiff-line-modified-added">+     BitfieldType mask = ObservedResults::BigInt;</span>
<span class="udiff-line-modified-added">+     return (m_bits &amp; mask) != mask;</span>
  }
  
<span class="udiff-line-modified-removed">- void ArithProfile::emitSetBigInt(CCallHelpers&amp; jit) const</span>
<span class="udiff-line-modified-added">+ template&lt;typename BitfieldType&gt;</span>
<span class="udiff-line-added">+ void ArithProfile&lt;BitfieldType&gt;::emitSetBigInt(CCallHelpers&amp; jit) const</span>
  {
      if (shouldEmitSetBigInt())
<span class="udiff-line-modified-removed">-         jit.or32(CCallHelpers::TrustedImm32(ArithProfile::BigInt), CCallHelpers::AbsoluteAddress(addressOfBits()));</span>
<span class="udiff-line-modified-added">+         emitUnconditionalSet(jit, ObservedResults::BigInt);</span>
  }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ template&lt;typename BitfieldType&gt;</span>
<span class="udiff-line-added">+ void ArithProfile&lt;BitfieldType&gt;::emitUnconditionalSet(CCallHelpers&amp; jit, BitfieldType mask) const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     static_assert(std::is_same&lt;BitfieldType, uint16_t&gt;::value);</span>
<span class="udiff-line-added">+     jit.or16(CCallHelpers::TrustedImm32(mask), CCallHelpers::AbsoluteAddress(addressOfBits()));</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ // Generate the implementations of the functions above for UnaryArithProfile/BinaryArithProfile</span>
<span class="udiff-line-added">+ // If changing the size of either, add the corresponding lines here.</span>
<span class="udiff-line-added">+ template class ArithProfile&lt;uint16_t&gt;;</span>
  #endif // ENABLE(JIT)
  
  } // namespace JSC
  
  namespace WTF {
  
  using namespace JSC;
  
<span class="udiff-line-modified-removed">- void printInternal(PrintStream&amp; out, const ArithProfile&amp; profile)</span>
<span class="udiff-line-modified-added">+ template &lt;typename T&gt;</span>
<span class="udiff-line-added">+ void printInternal(PrintStream&amp; out, const ArithProfile&lt;T&gt;&amp; profile)</span>
  {
      const char* separator = &quot;&quot;;
  
      out.print(&quot;Result:&lt;&quot;);
      if (!profile.didObserveNonInt32()) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -133,23 +152,34 @@</span>
          if (profile.didObserveBigInt()) {
              out.print(separator, &quot;BigInt&quot;);
              separator = &quot;|&quot;;
          }
      }
<span class="udiff-line-removed">-     if (profile.tookSpecialFastPath())</span>
<span class="udiff-line-removed">-         out.print(separator, &quot;Took special fast path.&quot;);</span>
      out.print(&quot;&gt;&quot;);
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void printInternal(PrintStream&amp; out, const UnaryArithProfile&amp; profile)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     printInternal(out, static_cast&lt;ArithProfile&lt;UnaryArithProfileBase&gt;&gt;(profile));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     out.print(&quot; Arg ObservedType:&lt;&quot;);</span>
<span class="udiff-line-added">+     out.print(profile.argObservedType());</span>
<span class="udiff-line-added">+     out.print(&quot;&gt;&quot;);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void printInternal(PrintStream&amp; out, const BinaryArithProfile&amp; profile)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     printInternal(out, static_cast&lt;ArithProfile&lt;UnaryArithProfileBase&gt;&gt;(profile));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (profile.tookSpecialFastPath())</span>
<span class="udiff-line-added">+         out.print(&quot; Took special fast path.&quot;);</span>
  
      out.print(&quot; LHS ObservedType:&lt;&quot;);
      out.print(profile.lhsObservedType());
      out.print(&quot;&gt; RHS ObservedType:&lt;&quot;);
      out.print(profile.rhsObservedType());
      out.print(&quot;&gt;&quot;);
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     out.print(&quot; LHS ResultType:&lt;&quot;, RawPointer(bitwise_cast&lt;void*&gt;(static_cast&lt;uintptr_t&gt;(profile.lhsResultType().bits()))));</span>
<span class="udiff-line-removed">-     out.print(&quot;&gt; RHS ResultType:&lt;&quot;, RawPointer(bitwise_cast&lt;void*&gt;(static_cast&lt;uintptr_t&gt;(profile.rhsResultType().bits()))));</span>
<span class="udiff-line-removed">-     out.print(&quot;&gt;&quot;);</span>
  }
  
  void printInternal(PrintStream&amp; out, const JSC::ObservedType&amp; observedType)
  {
      const char* separator = &quot;&quot;;
</pre>
<center><a href="AdaptiveInferredPropertyValueWatchpointBase.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ArithProfile.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>