<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMMapLike.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2017 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY CANON INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL CANON INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;JSDOMBinding.h&quot;
 29 #include &quot;JSDOMConvert.h&quot;
<a name="1" id="anc1"></a><span class="line-removed"> 30 #include &quot;JSDOMGuardedObject.h&quot;</span>
 31 #include &lt;JavaScriptCore/BuiltinNames.h&gt;
 32 #include &lt;JavaScriptCore/CommonIdentifiers.h&gt;
<a name="2" id="anc2"></a><span class="line-removed"> 33 #include &lt;JavaScriptCore/JSMap.h&gt;</span>
 34 
 35 namespace WebCore {
 36 
<a name="3" id="anc3"></a><span class="line-modified"> 37 JSC::JSMap&amp; createBackingMap(JSC::ExecState&amp;, JSC::JSGlobalObject&amp;, JSC::JSObject&amp;);</span>
<span class="line-modified"> 38 void initializeBackingMap(JSC::VM&amp;, JSC::JSObject&amp;, JSC::JSMap&amp;);</span>
<span class="line-modified"> 39 JSC::JSValue forwardAttributeGetterToBackingMap(JSC::ExecState&amp;, JSC::JSObject&amp;, const JSC::Identifier&amp;);</span>
<span class="line-modified"> 40 JSC::JSValue forwardFunctionCallToBackingMap(JSC::ExecState&amp;, JSC::JSObject&amp;, const JSC::Identifier&amp;);</span>
<span class="line-modified"> 41 JSC::JSValue forwardForEachCallToBackingMap(JSC::ExecState&amp;, JSDOMGlobalObject&amp;, JSC::JSObject&amp;);</span>
<span class="line-modified"> 42 </span>
<span class="line-modified"> 43 template&lt;typename WrapperClass&gt; void synchronizeBackingMap(JSC::ExecState&amp;, JSDOMGlobalObject&amp;, WrapperClass&amp;);</span>
<span class="line-modified"> 44 template&lt;typename WrapperClass&gt; JSC::JSValue forwardSizeToMapLike(JSC::ExecState&amp;, WrapperClass&amp;);</span>
<span class="line-modified"> 45 template&lt;typename WrapperClass&gt; JSC::JSValue forwardEntriesToMapLike(JSC::ExecState&amp;, WrapperClass&amp;);</span>
<span class="line-modified"> 46 template&lt;typename WrapperClass&gt; JSC::JSValue forwardKeysToMapLike(JSC::ExecState&amp;, WrapperClass&amp;);</span>
<span class="line-modified"> 47 template&lt;typename WrapperClass&gt; JSC::JSValue forwardValuesToMapLike(JSC::ExecState&amp;, WrapperClass&amp;);</span>
<span class="line-modified"> 48 template&lt;typename WrapperClass&gt; JSC::JSValue forwardClearToMapLike(JSC::ExecState&amp;, WrapperClass&amp;);</span>
<span class="line-modified"> 49 template&lt;typename WrapperClass, typename Callback&gt; JSC::JSValue forwardForEachToMapLike(JSC::ExecState&amp;, WrapperClass&amp;, Callback&amp;&amp;);</span>
<span class="line-modified"> 50 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardGetToMapLike(JSC::ExecState&amp;, WrapperClass&amp;, ItemType&amp;&amp;);</span>
<span class="line-modified"> 51 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardHasToMapLike(JSC::ExecState&amp;, WrapperClass&amp;, ItemType&amp;&amp;);</span>
<span class="line-modified"> 52 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardAddToMapLike(JSC::ExecState&amp;, WrapperClass&amp;, ItemType&amp;&amp;);</span>
<span class="line-modified"> 53 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardDeleteToMapLike(JSC::ExecState&amp;, WrapperClass&amp;, ItemType&amp;&amp;);</span>
<span class="line-modified"> 54 </span>
<span class="line-modified"> 55 class DOMMapLike final : public DOMGuarded&lt;JSC::JSMap&gt; {</span>
 56 public:
<a name="4" id="anc4"></a><span class="line-modified"> 57     static Ref&lt;DOMMapLike&gt; create(JSDOMGlobalObject&amp; globalObject, JSC::JSMap&amp; map) { return adoptRef(*new DOMMapLike(globalObject, map)); }</span>


 58 
<a name="5" id="anc5"></a><span class="line-modified"> 59     template&lt;typename Key, typename Value&gt; void set(typename Key::ParameterType&amp;&amp;, typename Value::ParameterType&amp;&amp;);</span>
<span class="line-modified"> 60 </span>
<span class="line-modified"> 61     JSC::JSMap* backingMap() { return guarded(); }</span>
<span class="line-removed"> 62 </span>
<span class="line-removed"> 63 protected:</span>
<span class="line-removed"> 64     DOMMapLike(JSDOMGlobalObject&amp; globalObject, JSC::JSMap&amp; map) : DOMGuarded&lt;JSC::JSMap&gt;(globalObject, map) { }</span>
 65 };
 66 
<a name="6" id="anc6"></a><span class="line-modified"> 67 template&lt;typename Key, typename Value&gt; inline void DOMMapLike::set(typename Key::ParameterType&amp;&amp; key, typename Value::ParameterType&amp;&amp; value)</span>


 68 {
<a name="7" id="anc7"></a><span class="line-removed"> 69     if (isEmpty())</span>
<span class="line-removed"> 70         return;</span>
<span class="line-removed"> 71     auto* state = globalObject()-&gt;globalExec();</span>
<span class="line-removed"> 72     JSC::JSLockHolder locker(state);</span>
<span class="line-removed"> 73     backingMap()-&gt;set(state,</span>
<span class="line-removed"> 74         toJS&lt;Key&gt;(*state, *globalObject(), std::forward&lt;typename Key::ParameterType&gt;(key)),</span>
<span class="line-removed"> 75         toJS&lt;Value&gt;(*state, *globalObject(), std::forward&lt;typename Value::ParameterType&gt;(value)));</span>
 76 }
 77 
<a name="8" id="anc8"></a><span class="line-modified"> 78 template&lt;typename WrapperClass&gt; inline void synchronizeBackingMap(JSC::ExecState&amp; state, JSDOMGlobalObject&amp; globalObject, WrapperClass&amp; mapLike)</span>

 79 {
<a name="9" id="anc9"></a><span class="line-modified"> 80     auto backingMap = mapLike.wrapped().backingMap();</span>
<span class="line-modified"> 81     if (backingMap) {</span>
<span class="line-modified"> 82         ASSERT(backingMap-&gt;backingMap());</span>
<span class="line-modified"> 83         initializeBackingMap(state.vm(), mapLike, *backingMap-&gt;backingMap());</span>
<span class="line-modified"> 84         return;</span>







 85     }
<a name="10" id="anc10"></a><span class="line-modified"> 86     auto&amp; map = createBackingMap(state, globalObject, mapLike);</span>
<span class="line-removed"> 87     mapLike.wrapped().synchronizeBackingMap(DOMMapLike::create(globalObject, map));</span>
 88 }
 89 
<a name="11" id="anc11"></a><span class="line-modified"> 90 template&lt;typename WrapperClass&gt; inline JSC::JSValue forwardSizeToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike)</span>
 91 {
<a name="12" id="anc12"></a><span class="line-modified"> 92     JSC::VM&amp; vm = state.vm();</span>
<span class="line-modified"> 93     return forwardAttributeGetterToBackingMap(state, mapLike, vm.propertyNames-&gt;size);</span>
 94 }
 95 
<a name="13" id="anc13"></a><span class="line-modified"> 96 template&lt;typename WrapperClass&gt; inline JSC::JSValue forwardEntriesToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike)</span>
 97 {
<a name="14" id="anc14"></a><span class="line-modified"> 98     JSC::VM&amp; vm = state.vm();</span>
<span class="line-modified"> 99     return forwardFunctionCallToBackingMap(state, mapLike, vm.propertyNames-&gt;builtinNames().entriesPublicName());</span>
100 }
101 
<a name="15" id="anc15"></a><span class="line-modified">102 template&lt;typename WrapperClass&gt; inline JSC::JSValue forwardKeysToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike)</span>
103 {
<a name="16" id="anc16"></a><span class="line-modified">104     JSC::VM&amp; vm = state.vm();</span>
<span class="line-modified">105     return forwardFunctionCallToBackingMap(state, mapLike, vm.propertyNames-&gt;builtinNames().keysPublicName());</span>
106 }
107 
<a name="17" id="anc17"></a><span class="line-modified">108 template&lt;typename WrapperClass&gt; inline JSC::JSValue forwardValuesToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike)</span>
109 {
<a name="18" id="anc18"></a><span class="line-modified">110     JSC::VM&amp; vm = state.vm();</span>
<span class="line-modified">111     return forwardFunctionCallToBackingMap(state, mapLike, vm.propertyNames-&gt;builtinNames().valuesPublicName());</span>
112 }
113 
<a name="19" id="anc19"></a><span class="line-modified">114 template&lt;typename WrapperClass&gt; inline JSC::JSValue forwardClearToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike)</span>
115 {
116     mapLike.wrapped().clear();
<a name="20" id="anc20"></a><span class="line-modified">117     return forwardFunctionCallToBackingMap(state, mapLike, state.vm().propertyNames-&gt;clear);</span>

118 }
119 
<a name="21" id="anc21"></a><span class="line-modified">120 template&lt;typename WrapperClass, typename Callback&gt; inline JSC::JSValue forwardForEachToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike, Callback&amp;&amp;)</span>
121 {
<a name="22" id="anc22"></a><span class="line-modified">122     return forwardForEachCallToBackingMap(state, *mapLike.globalObject(), mapLike);</span>

123 }
124 
<a name="23" id="anc23"></a><span class="line-modified">125 template&lt;typename WrapperClass, typename ItemType&gt; inline JSC::JSValue forwardGetToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike, ItemType&amp;&amp;)</span>
126 {
<a name="24" id="anc24"></a><span class="line-modified">127     JSC::VM&amp; vm = state.vm();</span>
<span class="line-modified">128     return forwardFunctionCallToBackingMap(state, mapLike, vm.propertyNames-&gt;builtinNames().getPublicName());</span>
129 }
130 
<a name="25" id="anc25"></a><span class="line-modified">131 template&lt;typename WrapperClass, typename ItemType&gt; inline JSC::JSValue forwardHasToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike, ItemType&amp;&amp;)</span>
132 {
<a name="26" id="anc26"></a><span class="line-modified">133     JSC::VM&amp; vm = state.vm();</span>
<span class="line-modified">134     return forwardFunctionCallToBackingMap(state, mapLike, vm.propertyNames-&gt;builtinNames().hasPublicName());</span>
135 }
136 
<a name="27" id="anc27"></a><span class="line-modified">137 template&lt;typename WrapperClass, typename ItemType&gt; inline JSC::JSValue forwardAddToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike, ItemType&amp;&amp; item)</span>
138 {
<a name="28" id="anc28"></a><span class="line-modified">139     if (mapLike.wrapped().addFromMapLike(std::forward&lt;ItemType&gt;(item)))</span>
<span class="line-modified">140         forwardFunctionCallToBackingMap(state, mapLike, state.vm().propertyNames-&gt;add);</span>

141     return &amp;mapLike;
142 }
143 
<a name="29" id="anc29"></a><span class="line-modified">144 template&lt;typename WrapperClass, typename ItemType&gt; inline JSC::JSValue forwardDeleteToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike, ItemType&amp;&amp; item)</span>
145 {
146     auto isDeleted = mapLike.wrapped().remove(std::forward&lt;ItemType&gt;(item));
147     UNUSED_PARAM(isDeleted);
<a name="30" id="anc30"></a><span class="line-modified">148     auto result = forwardFunctionCallToBackingMap(state, mapLike, state.vm().propertyNames-&gt;deleteKeyword);</span>



149     ASSERT_UNUSED(result, result.asBoolean() == isDeleted);
150     return result;
151 }
152 
153 }
<a name="31" id="anc31"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="31" type="hidden" />
</body>
</html>