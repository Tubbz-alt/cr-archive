<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/bridge/runtime_object.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="runtime_method.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="runtime_object.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bridge/runtime_object.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -25,10 +25,11 @@</span>
  
  #include &quot;config.h&quot;
  #include &quot;runtime_object.h&quot;
  
  #include &quot;JSDOMBinding.h&quot;
<span class="udiff-line-added">+ #include &quot;WebCoreJSClientData.h&quot;</span>
  #include &quot;runtime_method.h&quot;
  #include &lt;JavaScriptCore/Error.h&gt;
  
  using namespace WebCore;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -36,11 +37,11 @@</span>
  namespace Bindings {
  
  WEBCORE_EXPORT const ClassInfo RuntimeObject::s_info = { &quot;RuntimeObject&quot;, &amp;Base::s_info, nullptr, nullptr, CREATE_METHOD_TABLE(RuntimeObject) };
  
  RuntimeObject::RuntimeObject(VM&amp; vm, Structure* structure, RefPtr&lt;Instance&gt;&amp;&amp; instance)
<span class="udiff-line-modified-removed">-     : JSDestructibleObject(vm, structure)</span>
<span class="udiff-line-modified-added">+     : Base(vm, structure)</span>
      , m_instance(WTFMove(instance))
  {
  }
  
  void RuntimeObject::finishCreation(VM&amp; vm)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -60,81 +61,81 @@</span>
      if (m_instance)
          m_instance-&gt;willInvalidateRuntimeObject();
      m_instance = nullptr;
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue RuntimeObject::fallbackObjectGetter(ExecState* exec, EncodedJSValue thisValue, PropertyName propertyName)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue RuntimeObject::fallbackObjectGetter(JSGlobalObject* lexicalGlobalObject, EncodedJSValue thisValue, PropertyName propertyName)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = lexicalGlobalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      RuntimeObject* thisObj = jsCast&lt;RuntimeObject*&gt;(JSValue::decode(thisValue));
      RefPtr&lt;Instance&gt; instance = thisObj-&gt;m_instance;
  
      if (!instance)
<span class="udiff-line-modified-removed">-         return JSValue::encode(throwInvalidAccessError(exec, scope));</span>
<span class="udiff-line-modified-added">+         return JSValue::encode(throwInvalidAccessError(lexicalGlobalObject, scope));</span>
  
      instance-&gt;begin();
  
      Class *aClass = instance-&gt;getClass();
<span class="udiff-line-modified-removed">-     JSValue result = aClass-&gt;fallbackObject(exec, instance.get(), propertyName);</span>
<span class="udiff-line-modified-added">+     JSValue result = aClass-&gt;fallbackObject(lexicalGlobalObject, instance.get(), propertyName);</span>
  
      instance-&gt;end();
  
      return JSValue::encode(result);
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue RuntimeObject::fieldGetter(ExecState* exec, EncodedJSValue thisValue, PropertyName propertyName)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue RuntimeObject::fieldGetter(JSGlobalObject* lexicalGlobalObject, EncodedJSValue thisValue, PropertyName propertyName)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = lexicalGlobalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      RuntimeObject* thisObj = jsCast&lt;RuntimeObject*&gt;(JSValue::decode(thisValue));
      RefPtr&lt;Instance&gt; instance = thisObj-&gt;m_instance;
  
      if (!instance)
<span class="udiff-line-modified-removed">-         return JSValue::encode(throwInvalidAccessError(exec, scope));</span>
<span class="udiff-line-modified-added">+         return JSValue::encode(throwInvalidAccessError(lexicalGlobalObject, scope));</span>
  
      instance-&gt;begin();
  
      Class *aClass = instance-&gt;getClass();
      Field* aField = aClass-&gt;fieldNamed(propertyName, instance.get());
<span class="udiff-line-modified-removed">-     JSValue result = aField-&gt;valueFromInstance(exec, instance.get());</span>
<span class="udiff-line-modified-added">+     JSValue result = aField-&gt;valueFromInstance(lexicalGlobalObject, instance.get());</span>
  
      instance-&gt;end();
  
      return JSValue::encode(result);
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue RuntimeObject::methodGetter(ExecState* exec, EncodedJSValue thisValue, PropertyName propertyName)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue RuntimeObject::methodGetter(JSGlobalObject* lexicalGlobalObject, EncodedJSValue thisValue, PropertyName propertyName)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = lexicalGlobalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      RuntimeObject* thisObj = jsCast&lt;RuntimeObject*&gt;(JSValue::decode(thisValue));
      RefPtr&lt;Instance&gt; instance = thisObj-&gt;m_instance;
  
      if (!instance)
<span class="udiff-line-modified-removed">-         return JSValue::encode(throwInvalidAccessError(exec, scope));</span>
<span class="udiff-line-modified-added">+         return JSValue::encode(throwInvalidAccessError(lexicalGlobalObject, scope));</span>
  
      instance-&gt;begin();
  
<span class="udiff-line-modified-removed">-     JSValue method = instance-&gt;getMethod(exec, propertyName);</span>
<span class="udiff-line-modified-added">+     JSValue method = instance-&gt;getMethod(lexicalGlobalObject, propertyName);</span>
  
      instance-&gt;end();
  
      return JSValue::encode(method);
  }
  
<span class="udiff-line-modified-removed">- bool RuntimeObject::getOwnPropertySlot(JSObject* object, ExecState *exec, PropertyName propertyName, PropertySlot&amp; slot)</span>
<span class="udiff-line-modified-added">+ bool RuntimeObject::getOwnPropertySlot(JSObject* object, JSGlobalObject* lexicalGlobalObject, PropertyName propertyName, PropertySlot&amp; slot)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = lexicalGlobalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      RuntimeObject* thisObject = jsCast&lt;RuntimeObject*&gt;(object);
      if (!thisObject-&gt;m_instance) {
<span class="udiff-line-modified-removed">-         throwInvalidAccessError(exec, scope);</span>
<span class="udiff-line-modified-added">+         throwInvalidAccessError(lexicalGlobalObject, scope);</span>
          return false;
      }
  
      RefPtr&lt;Instance&gt; instance = thisObject-&gt;m_instance;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -159,77 +160,77 @@</span>
                  return true;
              }
          }
  
          // Try a fallback object.
<span class="udiff-line-modified-removed">-         if (!aClass-&gt;fallbackObject(exec, instance.get(), propertyName).isUndefined()) {</span>
<span class="udiff-line-modified-added">+         if (!aClass-&gt;fallbackObject(lexicalGlobalObject, instance.get(), propertyName).isUndefined()) {</span>
              slot.setCustom(thisObject, PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly | PropertyAttribute::DontEnum, thisObject-&gt;fallbackObjectGetter);
              instance-&gt;end();
              return true;
          }
      }
  
      instance-&gt;end();
  
<span class="udiff-line-modified-removed">-     return instance-&gt;getOwnPropertySlot(thisObject, exec, propertyName, slot);</span>
<span class="udiff-line-modified-added">+     return instance-&gt;getOwnPropertySlot(thisObject, lexicalGlobalObject, propertyName, slot);</span>
  }
  
<span class="udiff-line-modified-removed">- bool RuntimeObject::put(JSCell* cell, ExecState* exec, PropertyName propertyName, JSValue value, PutPropertySlot&amp; slot)</span>
<span class="udiff-line-modified-added">+ bool RuntimeObject::put(JSCell* cell, JSGlobalObject* lexicalGlobalObject, PropertyName propertyName, JSValue value, PutPropertySlot&amp; slot)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = lexicalGlobalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      RuntimeObject* thisObject = jsCast&lt;RuntimeObject*&gt;(cell);
      if (!thisObject-&gt;m_instance) {
<span class="udiff-line-modified-removed">-         throwInvalidAccessError(exec, scope);</span>
<span class="udiff-line-modified-added">+         throwInvalidAccessError(lexicalGlobalObject, scope);</span>
          return false;
      }
  
      RefPtr&lt;Instance&gt; instance = thisObject-&gt;m_instance;
      instance-&gt;begin();
  
      // Set the value of the property.
      bool result = false;
      Field *aField = instance-&gt;getClass()-&gt;fieldNamed(propertyName, instance.get());
      if (aField)
<span class="udiff-line-modified-removed">-         result = aField-&gt;setValueToInstance(exec, instance.get(), value);</span>
<span class="udiff-line-modified-removed">-     else if (!instance-&gt;setValueOfUndefinedField(exec, propertyName, value))</span>
<span class="udiff-line-modified-removed">-         result = instance-&gt;put(thisObject, exec, propertyName, value, slot);</span>
<span class="udiff-line-modified-added">+         result = aField-&gt;setValueToInstance(lexicalGlobalObject, instance.get(), value);</span>
<span class="udiff-line-modified-added">+     else if (!instance-&gt;setValueOfUndefinedField(lexicalGlobalObject, propertyName, value))</span>
<span class="udiff-line-modified-added">+         result = instance-&gt;put(thisObject, lexicalGlobalObject, propertyName, value, slot);</span>
  
      instance-&gt;end();
      return result;
  }
  
<span class="udiff-line-modified-removed">- bool RuntimeObject::deleteProperty(JSCell*, ExecState*, PropertyName)</span>
<span class="udiff-line-modified-added">+ bool RuntimeObject::deleteProperty(JSCell*, JSGlobalObject*, PropertyName)</span>
  {
      // Can never remove a property of a RuntimeObject.
      return false;
  }
  
<span class="udiff-line-modified-removed">- JSValue RuntimeObject::defaultValue(const JSObject* object, ExecState* exec, PreferredPrimitiveType hint)</span>
<span class="udiff-line-modified-added">+ JSValue RuntimeObject::defaultValue(const JSObject* object, JSGlobalObject* lexicalGlobalObject, PreferredPrimitiveType hint)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = lexicalGlobalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      const RuntimeObject* thisObject = jsCast&lt;const RuntimeObject*&gt;(object);
      if (!thisObject-&gt;m_instance)
<span class="udiff-line-modified-removed">-         return throwInvalidAccessError(exec, scope);</span>
<span class="udiff-line-modified-added">+         return throwInvalidAccessError(lexicalGlobalObject, scope);</span>
  
      RefPtr&lt;Instance&gt; instance = thisObject-&gt;m_instance;
  
      instance-&gt;begin();
<span class="udiff-line-modified-removed">-     JSValue result = instance-&gt;defaultValue(exec, hint);</span>
<span class="udiff-line-modified-added">+     JSValue result = instance-&gt;defaultValue(lexicalGlobalObject, hint);</span>
      instance-&gt;end();
      return result;
  }
  
<span class="udiff-line-modified-removed">- static EncodedJSValue JSC_HOST_CALL callRuntimeObject(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ static EncodedJSValue JSC_HOST_CALL callRuntimeObject(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
  {
<span class="udiff-line-modified-removed">-     ASSERT(exec-&gt;jsCallee()-&gt;inherits&lt;RuntimeObject&gt;(exec-&gt;vm()));</span>
<span class="udiff-line-modified-removed">-     RefPtr&lt;Instance&gt; instance(static_cast&lt;RuntimeObject*&gt;(exec-&gt;jsCallee())-&gt;getInternalInstance());</span>
<span class="udiff-line-modified-added">+     ASSERT_UNUSED(globalObject, callFrame-&gt;jsCallee()-&gt;inherits&lt;RuntimeObject&gt;(globalObject-&gt;vm()));</span>
<span class="udiff-line-modified-added">+     RefPtr&lt;Instance&gt; instance(static_cast&lt;RuntimeObject*&gt;(callFrame-&gt;jsCallee())-&gt;getInternalInstance());</span>
      instance-&gt;begin();
<span class="udiff-line-modified-removed">-     JSValue result = instance-&gt;invokeDefaultMethod(exec);</span>
<span class="udiff-line-modified-added">+     JSValue result = instance-&gt;invokeDefaultMethod(globalObject, callFrame);</span>
      instance-&gt;end();
      return JSValue::encode(result);
  }
  
  CallType RuntimeObject::getCallData(JSCell* cell, CallData&amp; callData)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -244,18 +245,18 @@</span>
  
      callData.native.function = callRuntimeObject;
      return CallType::Host;
  }
  
<span class="udiff-line-modified-removed">- static EncodedJSValue JSC_HOST_CALL callRuntimeConstructor(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ static EncodedJSValue JSC_HOST_CALL callRuntimeConstructor(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
  {
<span class="udiff-line-modified-removed">-     JSObject* constructor = exec-&gt;jsCallee();</span>
<span class="udiff-line-modified-removed">-     ASSERT(constructor-&gt;inherits&lt;RuntimeObject&gt;(exec-&gt;vm()));</span>
<span class="udiff-line-modified-removed">-     RefPtr&lt;Instance&gt; instance(static_cast&lt;RuntimeObject*&gt;(exec-&gt;jsCallee())-&gt;getInternalInstance());</span>
<span class="udiff-line-modified-added">+     JSObject* constructor = callFrame-&gt;jsCallee();</span>
<span class="udiff-line-modified-added">+     ASSERT_UNUSED(globalObject, constructor-&gt;inherits&lt;RuntimeObject&gt;(globalObject-&gt;vm()));</span>
<span class="udiff-line-modified-added">+     RefPtr&lt;Instance&gt; instance(static_cast&lt;RuntimeObject*&gt;(callFrame-&gt;jsCallee())-&gt;getInternalInstance());</span>
      instance-&gt;begin();
<span class="udiff-line-modified-removed">-     ArgList args(exec);</span>
<span class="udiff-line-modified-removed">-     JSValue result = instance-&gt;invokeConstruct(exec, args);</span>
<span class="udiff-line-modified-added">+     ArgList args(callFrame);</span>
<span class="udiff-line-modified-added">+     JSValue result = instance-&gt;invokeConstruct(globalObject, callFrame, args);</span>
      instance-&gt;end();
  
      ASSERT(result);
      return JSValue::encode(result.isObject() ? jsCast&lt;JSObject*&gt;(result.asCell()) : constructor);
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -272,30 +273,35 @@</span>
  
      constructData.native.function = callRuntimeConstructor;
      return ConstructType::Host;
  }
  
<span class="udiff-line-modified-removed">- void RuntimeObject::getOwnPropertyNames(JSObject* object, ExecState* exec, PropertyNameArray&amp; propertyNames, EnumerationMode)</span>
<span class="udiff-line-modified-added">+ void RuntimeObject::getOwnPropertyNames(JSObject* object, JSGlobalObject* lexicalGlobalObject, PropertyNameArray&amp; propertyNames, EnumerationMode)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = lexicalGlobalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      RuntimeObject* thisObject = jsCast&lt;RuntimeObject*&gt;(object);
      if (!thisObject-&gt;m_instance) {
<span class="udiff-line-modified-removed">-         throwInvalidAccessError(exec, scope);</span>
<span class="udiff-line-modified-added">+         throwInvalidAccessError(lexicalGlobalObject, scope);</span>
          return;
      }
  
      RefPtr&lt;Instance&gt; instance = thisObject-&gt;m_instance;
  
      instance-&gt;begin();
<span class="udiff-line-modified-removed">-     instance-&gt;getPropertyNames(exec, propertyNames);</span>
<span class="udiff-line-modified-added">+     instance-&gt;getPropertyNames(lexicalGlobalObject, propertyNames);</span>
      instance-&gt;end();
  }
  
<span class="udiff-line-modified-removed">- Exception* RuntimeObject::throwInvalidAccessError(ExecState* exec, ThrowScope&amp; scope)</span>
<span class="udiff-line-modified-added">+ Exception* RuntimeObject::throwInvalidAccessError(JSGlobalObject* lexicalGlobalObject, ThrowScope&amp; scope)</span>
  {
<span class="udiff-line-modified-removed">-     return throwException(exec, scope, createReferenceError(exec, &quot;Trying to access object from destroyed plug-in.&quot;));</span>
<span class="udiff-line-modified-added">+     return throwException(lexicalGlobalObject, scope, createReferenceError(lexicalGlobalObject, &quot;Trying to access object from destroyed plug-in.&quot;));</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JSC::IsoSubspace* RuntimeObject::subspaceForImpl(JSC::VM&amp; vm)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     return &amp;static_cast&lt;JSVMClientData*&gt;(vm.clientData)-&gt;runtimeObjectSpace();</span>
  }
  
  }
  }
</pre>
<center><a href="runtime_method.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="runtime_object.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>