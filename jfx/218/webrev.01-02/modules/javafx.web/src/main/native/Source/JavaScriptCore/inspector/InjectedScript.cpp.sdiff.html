<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/InjectedScript.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ContentSearchUtilities.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InjectedScript.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/InjectedScript.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
147     }
148 
149     result = BindingTraits&lt;Protocol::Debugger::FunctionDetails&gt;::runtimeCast(WTFMove(resultValue));
150 }
151 
152 void InjectedScript::getPreview(ErrorString&amp; errorString, const String&amp; objectId, RefPtr&lt;Protocol::Runtime::ObjectPreview&gt;&amp; result)
153 {
154     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getPreview&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
155     function.appendArgument(objectId);
156 
157     RefPtr&lt;JSON::Value&gt; resultValue = makeCall(function);
158     if (!resultValue || resultValue-&gt;type() != JSON::Value::Type::Object) {
159         if (!resultValue-&gt;asString(errorString))
160             errorString = &quot;Internal error&quot;_s;
161         return;
162     }
163 
164     result = BindingTraits&lt;Protocol::Runtime::ObjectPreview&gt;::runtimeCast(WTFMove(resultValue));
165 }
166 
<span class="line-modified">167 void InjectedScript::getProperties(ErrorString&amp; errorString, const String&amp; objectId, bool ownProperties, bool generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; properties)</span>
168 {



169     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getProperties&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
170     function.appendArgument(objectId);
171     function.appendArgument(ownProperties);


172     function.appendArgument(generatePreview);
173 
174     RefPtr&lt;JSON::Value&gt; result = makeCall(function);
175     if (!result || result-&gt;type() != JSON::Value::Type::Array) {
176         errorString = &quot;Internal error&quot;_s;
177         return;
178     }
179 
180     properties = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;::runtimeCast(WTFMove(result));
181 }
182 
<span class="line-modified">183 void InjectedScript::getDisplayableProperties(ErrorString&amp; errorString, const String&amp; objectId, bool generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; properties)</span>
184 {



185     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getDisplayableProperties&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
186     function.appendArgument(objectId);


187     function.appendArgument(generatePreview);
188 
189     RefPtr&lt;JSON::Value&gt; result = makeCall(function);
190     if (!result || result-&gt;type() != JSON::Value::Type::Array) {
191         errorString = &quot;Internal error&quot;_s;
192         return;
193     }
194 
195     properties = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;::runtimeCast(WTFMove(result));
196 }
197 
198 void InjectedScript::getInternalProperties(ErrorString&amp; errorString, const String&amp; objectId, bool generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::InternalPropertyDescriptor&gt;&gt;&amp; properties)
199 {
200     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getInternalProperties&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
201     function.appendArgument(objectId);
202     function.appendArgument(generatePreview);
203 
204     RefPtr&lt;JSON::Value&gt; result = makeCall(function);
205     if (!result || result-&gt;type() != JSON::Value::Type::Array) {
206         errorString = &quot;Internal error&quot;_s;
207         return;
208     }
209 
210     auto array = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::InternalPropertyDescriptor&gt;&gt;::runtimeCast(WTFMove(result));
211     properties = array-&gt;length() &gt; 0 ? array : nullptr;
212 }
213 
<span class="line-modified">214 void InjectedScript::getCollectionEntries(ErrorString&amp; errorString, const String&amp; objectId, const String&amp; objectGroup, int startIndex, int numberToFetch, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::CollectionEntry&gt;&gt;&amp; entries)</span>
215 {



216     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getCollectionEntries&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
217     function.appendArgument(objectId);
218     function.appendArgument(objectGroup);
<span class="line-modified">219     function.appendArgument(startIndex);</span>
<span class="line-modified">220     function.appendArgument(numberToFetch);</span>
221 
222     RefPtr&lt;JSON::Value&gt; result = makeCall(function);
223     if (!result || result-&gt;type() != JSON::Value::Type::Array) {
224         errorString = &quot;Internal error&quot;_s;
225         return;
226     }
227 
228     entries = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::CollectionEntry&gt;&gt;::runtimeCast(WTFMove(result));
229 }
230 
231 void InjectedScript::saveResult(ErrorString&amp; errorString, const String&amp; callArgumentJSON, Optional&lt;int&gt;&amp; savedResultIndex)
232 {
233     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;saveResult&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
234     function.appendArgument(callArgumentJSON);
235 
236     RefPtr&lt;JSON::Value&gt; result = makeCall(function);
237     if (!result || result-&gt;type() != JSON::Value::Type::Integer) {
238         errorString = &quot;Internal error&quot;_s;
239         return;
240     }
241 
242     int resultIndex = 0;
243     if (result-&gt;asInteger(resultIndex) &amp;&amp; resultIndex &gt; 0)
244         savedResultIndex = resultIndex;
245 }
246 
247 Ref&lt;JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;&gt; InjectedScript::wrapCallFrames(JSC::JSValue callFrames) const
248 {
249     ASSERT(!hasNoValue());
250     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;wrapCallFrames&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
251     function.appendArgument(callFrames);
252 
<span class="line-modified">253     bool hadException = false;</span>
<span class="line-modified">254     auto callFramesValue = callFunctionWithEvalEnabled(function, hadException);</span>
<span class="line-modified">255     if (!callFramesValue)</span>
256         return JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;::create();
<span class="line-modified">257     ASSERT(!hadException);</span>
<span class="line-modified">258     RefPtr&lt;JSON::Value&gt; result = toInspectorValue(*scriptState(), callFramesValue);</span>
259     if (result-&gt;type() == JSON::Value::Type::Array)
260         return BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;&gt;::runtimeCast(WTFMove(result)).releaseNonNull();
261 
262     return JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;::create();
263 }
264 
265 RefPtr&lt;Protocol::Runtime::RemoteObject&gt; InjectedScript::wrapObject(JSC::JSValue value, const String&amp; groupName, bool generatePreview) const
266 {
267     ASSERT(!hasNoValue());
268     Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;wrapObject&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
269     wrapFunction.appendArgument(value);
270     wrapFunction.appendArgument(groupName);
271     wrapFunction.appendArgument(hasAccessToInspectedScriptState());
272     wrapFunction.appendArgument(generatePreview);
273 
<span class="line-modified">274     bool hadException = false;</span>
<span class="line-modified">275     auto r = callFunctionWithEvalEnabled(wrapFunction, hadException);</span>
<span class="line-removed">276     if (hadException)</span>
277         return nullptr;
278 
279     RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">280     bool castSucceeded = toInspectorValue(*scriptState(), r)-&gt;asObject(resultObject);</span>
281     ASSERT_UNUSED(castSucceeded, castSucceeded);
282 
283     return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
284 }
285 
286 RefPtr&lt;Protocol::Runtime::RemoteObject&gt; InjectedScript::wrapJSONString(const String&amp; json, const String&amp; groupName, bool generatePreview) const
287 {
288     ASSERT(!hasNoValue());
289     Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;wrapJSONString&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
290     wrapFunction.appendArgument(json);
291     wrapFunction.appendArgument(groupName);
292     wrapFunction.appendArgument(generatePreview);
293 
<span class="line-modified">294     bool hadException = false;</span>
<span class="line-modified">295     auto evalResult = callFunctionWithEvalEnabled(wrapFunction, hadException);</span>
<span class="line-removed">296     if (hadException)</span>
297         return nullptr;
298 
<span class="line-modified">299     if (evalResult.isNull())</span>
300         return nullptr;
301 
302     RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">303     bool castSucceeded = toInspectorValue(*scriptState(), evalResult)-&gt;asObject(resultObject);</span>
304     ASSERT_UNUSED(castSucceeded, castSucceeded);
305 
306     return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
307 }
308 
309 RefPtr&lt;Protocol::Runtime::RemoteObject&gt; InjectedScript::wrapTable(JSC::JSValue table, JSC::JSValue columns) const
310 {
311     ASSERT(!hasNoValue());
312     Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;wrapTable&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
313     wrapFunction.appendArgument(hasAccessToInspectedScriptState());
314     wrapFunction.appendArgument(table);
315     if (!columns)
316         wrapFunction.appendArgument(false);
317     else
318         wrapFunction.appendArgument(columns);
319 
<span class="line-modified">320     bool hadException = false;</span>
<span class="line-modified">321     auto r = callFunctionWithEvalEnabled(wrapFunction, hadException);</span>
<span class="line-removed">322     if (hadException)</span>
323         return nullptr;
324 
325     RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">326     bool castSucceeded = toInspectorValue(*scriptState(), r)-&gt;asObject(resultObject);</span>
327     ASSERT_UNUSED(castSucceeded, castSucceeded);
328 
329     return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
330 }
331 
332 RefPtr&lt;Protocol::Runtime::ObjectPreview&gt; InjectedScript::previewValue(JSC::JSValue value) const
333 {
334     ASSERT(!hasNoValue());
335     Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;previewValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
336     wrapFunction.appendArgument(value);
337 
<span class="line-modified">338     bool hadException = false;</span>
<span class="line-modified">339     auto r = callFunctionWithEvalEnabled(wrapFunction, hadException);</span>
<span class="line-removed">340     if (hadException)</span>
341         return nullptr;
342 
343     RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">344     bool castSucceeded = toInspectorValue(*scriptState(), r)-&gt;asObject(resultObject);</span>
345     ASSERT_UNUSED(castSucceeded, castSucceeded);
346 
347     return BindingTraits&lt;Protocol::Runtime::ObjectPreview&gt;::runtimeCast(resultObject);
348 }
349 
350 void InjectedScript::setEventValue(JSC::JSValue value)
351 {
352     ASSERT(!hasNoValue());
353     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;setEventValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
354     function.appendArgument(value);
355     makeCall(function);
356 }
357 
358 void InjectedScript::clearEventValue()
359 {
360     ASSERT(!hasNoValue());
361     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;clearEventValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
362     makeCall(function);
363 }
364 
</pre>
<hr />
<pre>
366 {
367     ASSERT(!hasNoValue());
368     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;setExceptionValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
369     function.appendArgument(value);
370     makeCall(function);
371 }
372 
373 void InjectedScript::clearExceptionValue()
374 {
375     ASSERT(!hasNoValue());
376     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;clearExceptionValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
377     makeCall(function);
378 }
379 
380 JSC::JSValue InjectedScript::findObjectById(const String&amp; objectId) const
381 {
382     ASSERT(!hasNoValue());
383     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;findObjectById&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
384     function.appendArgument(objectId);
385 
<span class="line-modified">386     bool hadException = false;</span>
<span class="line-modified">387     auto resultValue = callFunctionWithEvalEnabled(function, hadException);</span>
<span class="line-modified">388     ASSERT(!hadException);</span>
<span class="line-modified">389 </span>
<span class="line-modified">390     return resultValue;</span>
391 }
392 
393 void InjectedScript::inspectObject(JSC::JSValue value)
394 {
395     ASSERT(!hasNoValue());
396     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;inspectObject&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
397     function.appendArgument(value);
398     makeCall(function);
399 }
400 
401 void InjectedScript::releaseObject(const String&amp; objectId)
402 {
403     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;releaseObject&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
404     function.appendArgument(objectId);
405     makeCall(function);
406 }
407 
408 void InjectedScript::releaseObjectGroup(const String&amp; objectGroup)
409 {
410     ASSERT(!hasNoValue());




411     Deprecated::ScriptFunctionCall releaseFunction(injectedScriptObject(), &quot;releaseObjectGroup&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
412     releaseFunction.appendArgument(objectGroup);
413 
<span class="line-modified">414     bool hadException = false;</span>
<span class="line-modified">415     callFunctionWithEvalEnabled(releaseFunction, hadException);</span>
<span class="line-removed">416     ASSERT(!hadException);</span>
417 }
418 
419 JSC::JSValue InjectedScript::arrayFromVector(Vector&lt;JSC::JSValue&gt;&amp;&amp; vector)
420 {
<span class="line-modified">421     JSC::ExecState* execState = scriptState();</span>
<span class="line-modified">422     if (!execState)</span>
423         return JSC::jsUndefined();
424 
<span class="line-modified">425     JSC::JSLockHolder lock(execState);</span>
426 
<span class="line-modified">427     JSC::JSArray* array = JSC::constructEmptyArray(execState, nullptr);</span>
428     if (!array)
429         return JSC::jsUndefined();
430 
431     for (auto&amp; item : vector)
<span class="line-modified">432         array-&gt;putDirectIndex(execState, array-&gt;length(), item);</span>
433 
434     return array;
435 }
436 
437 } // namespace Inspector
438 
</pre>
</td>
<td>
<hr />
<pre>
147     }
148 
149     result = BindingTraits&lt;Protocol::Debugger::FunctionDetails&gt;::runtimeCast(WTFMove(resultValue));
150 }
151 
152 void InjectedScript::getPreview(ErrorString&amp; errorString, const String&amp; objectId, RefPtr&lt;Protocol::Runtime::ObjectPreview&gt;&amp; result)
153 {
154     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getPreview&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
155     function.appendArgument(objectId);
156 
157     RefPtr&lt;JSON::Value&gt; resultValue = makeCall(function);
158     if (!resultValue || resultValue-&gt;type() != JSON::Value::Type::Object) {
159         if (!resultValue-&gt;asString(errorString))
160             errorString = &quot;Internal error&quot;_s;
161         return;
162     }
163 
164     result = BindingTraits&lt;Protocol::Runtime::ObjectPreview&gt;::runtimeCast(WTFMove(resultValue));
165 }
166 
<span class="line-modified">167 void InjectedScript::getProperties(ErrorString&amp; errorString, const String&amp; objectId, bool ownProperties, int fetchStart, int fetchCount, bool generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; properties)</span>
168 {
<span class="line-added">169     ASSERT(fetchStart &gt;= 0);</span>
<span class="line-added">170     ASSERT(fetchCount &gt;= 0);</span>
<span class="line-added">171 </span>
172     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getProperties&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
173     function.appendArgument(objectId);
174     function.appendArgument(ownProperties);
<span class="line-added">175     function.appendArgument(fetchStart);</span>
<span class="line-added">176     function.appendArgument(fetchCount);</span>
177     function.appendArgument(generatePreview);
178 
179     RefPtr&lt;JSON::Value&gt; result = makeCall(function);
180     if (!result || result-&gt;type() != JSON::Value::Type::Array) {
181         errorString = &quot;Internal error&quot;_s;
182         return;
183     }
184 
185     properties = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;::runtimeCast(WTFMove(result));
186 }
187 
<span class="line-modified">188 void InjectedScript::getDisplayableProperties(ErrorString&amp; errorString, const String&amp; objectId, int fetchStart, int fetchCount, bool generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; properties)</span>
189 {
<span class="line-added">190     ASSERT(fetchStart &gt;= 0);</span>
<span class="line-added">191     ASSERT(fetchCount &gt;= 0);</span>
<span class="line-added">192 </span>
193     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getDisplayableProperties&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
194     function.appendArgument(objectId);
<span class="line-added">195     function.appendArgument(fetchStart);</span>
<span class="line-added">196     function.appendArgument(fetchCount);</span>
197     function.appendArgument(generatePreview);
198 
199     RefPtr&lt;JSON::Value&gt; result = makeCall(function);
200     if (!result || result-&gt;type() != JSON::Value::Type::Array) {
201         errorString = &quot;Internal error&quot;_s;
202         return;
203     }
204 
205     properties = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;::runtimeCast(WTFMove(result));
206 }
207 
208 void InjectedScript::getInternalProperties(ErrorString&amp; errorString, const String&amp; objectId, bool generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::InternalPropertyDescriptor&gt;&gt;&amp; properties)
209 {
210     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getInternalProperties&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
211     function.appendArgument(objectId);
212     function.appendArgument(generatePreview);
213 
214     RefPtr&lt;JSON::Value&gt; result = makeCall(function);
215     if (!result || result-&gt;type() != JSON::Value::Type::Array) {
216         errorString = &quot;Internal error&quot;_s;
217         return;
218     }
219 
220     auto array = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::InternalPropertyDescriptor&gt;&gt;::runtimeCast(WTFMove(result));
221     properties = array-&gt;length() &gt; 0 ? array : nullptr;
222 }
223 
<span class="line-modified">224 void InjectedScript::getCollectionEntries(ErrorString&amp; errorString, const String&amp; objectId, const String&amp; objectGroup, int fetchStart, int fetchCount, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::CollectionEntry&gt;&gt;&amp; entries)</span>
225 {
<span class="line-added">226     ASSERT(fetchStart &gt;= 0);</span>
<span class="line-added">227     ASSERT(fetchCount &gt;= 0);</span>
<span class="line-added">228 </span>
229     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getCollectionEntries&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
230     function.appendArgument(objectId);
231     function.appendArgument(objectGroup);
<span class="line-modified">232     function.appendArgument(fetchStart);</span>
<span class="line-modified">233     function.appendArgument(fetchCount);</span>
234 
235     RefPtr&lt;JSON::Value&gt; result = makeCall(function);
236     if (!result || result-&gt;type() != JSON::Value::Type::Array) {
237         errorString = &quot;Internal error&quot;_s;
238         return;
239     }
240 
241     entries = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::CollectionEntry&gt;&gt;::runtimeCast(WTFMove(result));
242 }
243 
244 void InjectedScript::saveResult(ErrorString&amp; errorString, const String&amp; callArgumentJSON, Optional&lt;int&gt;&amp; savedResultIndex)
245 {
246     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;saveResult&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
247     function.appendArgument(callArgumentJSON);
248 
249     RefPtr&lt;JSON::Value&gt; result = makeCall(function);
250     if (!result || result-&gt;type() != JSON::Value::Type::Integer) {
251         errorString = &quot;Internal error&quot;_s;
252         return;
253     }
254 
255     int resultIndex = 0;
256     if (result-&gt;asInteger(resultIndex) &amp;&amp; resultIndex &gt; 0)
257         savedResultIndex = resultIndex;
258 }
259 
260 Ref&lt;JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;&gt; InjectedScript::wrapCallFrames(JSC::JSValue callFrames) const
261 {
262     ASSERT(!hasNoValue());
263     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;wrapCallFrames&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
264     function.appendArgument(callFrames);
265 
<span class="line-modified">266     auto callResult = callFunctionWithEvalEnabled(function);</span>
<span class="line-modified">267     ASSERT(callResult);</span>
<span class="line-modified">268     if (!callResult || !callResult.value())</span>
269         return JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;::create();
<span class="line-modified">270 </span>
<span class="line-modified">271     RefPtr&lt;JSON::Value&gt; result = toInspectorValue(globalObject(), callResult.value());</span>
272     if (result-&gt;type() == JSON::Value::Type::Array)
273         return BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;&gt;::runtimeCast(WTFMove(result)).releaseNonNull();
274 
275     return JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;::create();
276 }
277 
278 RefPtr&lt;Protocol::Runtime::RemoteObject&gt; InjectedScript::wrapObject(JSC::JSValue value, const String&amp; groupName, bool generatePreview) const
279 {
280     ASSERT(!hasNoValue());
281     Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;wrapObject&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
282     wrapFunction.appendArgument(value);
283     wrapFunction.appendArgument(groupName);
284     wrapFunction.appendArgument(hasAccessToInspectedScriptState());
285     wrapFunction.appendArgument(generatePreview);
286 
<span class="line-modified">287     auto callResult = callFunctionWithEvalEnabled(wrapFunction);</span>
<span class="line-modified">288     if (!callResult)</span>

289         return nullptr;
290 
291     RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">292     bool castSucceeded = toInspectorValue(globalObject(), callResult.value())-&gt;asObject(resultObject);</span>
293     ASSERT_UNUSED(castSucceeded, castSucceeded);
294 
295     return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
296 }
297 
298 RefPtr&lt;Protocol::Runtime::RemoteObject&gt; InjectedScript::wrapJSONString(const String&amp; json, const String&amp; groupName, bool generatePreview) const
299 {
300     ASSERT(!hasNoValue());
301     Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;wrapJSONString&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
302     wrapFunction.appendArgument(json);
303     wrapFunction.appendArgument(groupName);
304     wrapFunction.appendArgument(generatePreview);
305 
<span class="line-modified">306     auto callResult = callFunctionWithEvalEnabled(wrapFunction);</span>
<span class="line-modified">307     if (!callResult)</span>

308         return nullptr;
309 
<span class="line-modified">310     if (callResult.value().isNull())</span>
311         return nullptr;
312 
313     RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">314     bool castSucceeded = toInspectorValue(globalObject(), callResult.value())-&gt;asObject(resultObject);</span>
315     ASSERT_UNUSED(castSucceeded, castSucceeded);
316 
317     return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
318 }
319 
320 RefPtr&lt;Protocol::Runtime::RemoteObject&gt; InjectedScript::wrapTable(JSC::JSValue table, JSC::JSValue columns) const
321 {
322     ASSERT(!hasNoValue());
323     Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;wrapTable&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
324     wrapFunction.appendArgument(hasAccessToInspectedScriptState());
325     wrapFunction.appendArgument(table);
326     if (!columns)
327         wrapFunction.appendArgument(false);
328     else
329         wrapFunction.appendArgument(columns);
330 
<span class="line-modified">331     auto callResult = callFunctionWithEvalEnabled(wrapFunction);</span>
<span class="line-modified">332     if (!callResult)</span>

333         return nullptr;
334 
335     RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">336     bool castSucceeded = toInspectorValue(globalObject(), callResult.value())-&gt;asObject(resultObject);</span>
337     ASSERT_UNUSED(castSucceeded, castSucceeded);
338 
339     return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
340 }
341 
342 RefPtr&lt;Protocol::Runtime::ObjectPreview&gt; InjectedScript::previewValue(JSC::JSValue value) const
343 {
344     ASSERT(!hasNoValue());
345     Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;previewValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
346     wrapFunction.appendArgument(value);
347 
<span class="line-modified">348     auto callResult = callFunctionWithEvalEnabled(wrapFunction);</span>
<span class="line-modified">349     if (!callResult)</span>

350         return nullptr;
351 
352     RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">353     bool castSucceeded = toInspectorValue(globalObject(), callResult.value())-&gt;asObject(resultObject);</span>
354     ASSERT_UNUSED(castSucceeded, castSucceeded);
355 
356     return BindingTraits&lt;Protocol::Runtime::ObjectPreview&gt;::runtimeCast(resultObject);
357 }
358 
359 void InjectedScript::setEventValue(JSC::JSValue value)
360 {
361     ASSERT(!hasNoValue());
362     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;setEventValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
363     function.appendArgument(value);
364     makeCall(function);
365 }
366 
367 void InjectedScript::clearEventValue()
368 {
369     ASSERT(!hasNoValue());
370     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;clearEventValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
371     makeCall(function);
372 }
373 
</pre>
<hr />
<pre>
375 {
376     ASSERT(!hasNoValue());
377     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;setExceptionValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
378     function.appendArgument(value);
379     makeCall(function);
380 }
381 
382 void InjectedScript::clearExceptionValue()
383 {
384     ASSERT(!hasNoValue());
385     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;clearExceptionValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
386     makeCall(function);
387 }
388 
389 JSC::JSValue InjectedScript::findObjectById(const String&amp; objectId) const
390 {
391     ASSERT(!hasNoValue());
392     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;findObjectById&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
393     function.appendArgument(objectId);
394 
<span class="line-modified">395     auto callResult = callFunctionWithEvalEnabled(function);</span>
<span class="line-modified">396     ASSERT(callResult);</span>
<span class="line-modified">397     if (!callResult)</span>
<span class="line-modified">398         return { };</span>
<span class="line-modified">399     return callResult.value();</span>
400 }
401 
402 void InjectedScript::inspectObject(JSC::JSValue value)
403 {
404     ASSERT(!hasNoValue());
405     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;inspectObject&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
406     function.appendArgument(value);
407     makeCall(function);
408 }
409 
410 void InjectedScript::releaseObject(const String&amp; objectId)
411 {
412     Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;releaseObject&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
413     function.appendArgument(objectId);
414     makeCall(function);
415 }
416 
417 void InjectedScript::releaseObjectGroup(const String&amp; objectGroup)
418 {
419     ASSERT(!hasNoValue());
<span class="line-added">420     // JDK-8164076</span>
<span class="line-added">421     if (hasNoValue())</span>
<span class="line-added">422         return;</span>
<span class="line-added">423 </span>
424     Deprecated::ScriptFunctionCall releaseFunction(injectedScriptObject(), &quot;releaseObjectGroup&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
425     releaseFunction.appendArgument(objectGroup);
426 
<span class="line-modified">427     auto callResult = callFunctionWithEvalEnabled(releaseFunction);</span>
<span class="line-modified">428     ASSERT_UNUSED(callResult, callResult);</span>

429 }
430 
431 JSC::JSValue InjectedScript::arrayFromVector(Vector&lt;JSC::JSValue&gt;&amp;&amp; vector)
432 {
<span class="line-modified">433     JSC::JSGlobalObject* globalObject = this-&gt;globalObject();</span>
<span class="line-modified">434     if (!globalObject)</span>
435         return JSC::jsUndefined();
436 
<span class="line-modified">437     JSC::JSLockHolder lock(globalObject);</span>
438 
<span class="line-modified">439     JSC::JSArray* array = JSC::constructEmptyArray(globalObject, nullptr);</span>
440     if (!array)
441         return JSC::jsUndefined();
442 
443     for (auto&amp; item : vector)
<span class="line-modified">444         array-&gt;putDirectIndex(globalObject, array-&gt;length(), item);</span>
445 
446     return array;
447 }
448 
449 } // namespace Inspector
450 
</pre>
</td>
</tr>
</table>
<center><a href="ContentSearchUtilities.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InjectedScript.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>