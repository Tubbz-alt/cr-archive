<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSTypedArrayViewPrototype.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSTypedArrayViewConstructor.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSTypedArrayViewPrototype.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSTypedArrayViewPrototype.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;JSTypedArrayViewPrototype.h&quot;
 28 
 29 #include &quot;BuiltinNames.h&quot;
 30 #include &quot;CallFrame.h&quot;
 31 #include &quot;GetterSetter.h&quot;

 32 #include &quot;JSCInlines.h&quot;
 33 #include &quot;JSFunction.h&quot;
 34 #include &quot;JSGenericTypedArrayViewPrototypeFunctions.h&quot;
 35 #include &quot;JSObjectInlines.h&quot;
 36 #include &quot;TypedArrayAdaptors.h&quot;
 37 
 38 namespace JSC {
 39 
 40 #define CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(functionName) do {                           \
<span class="line-modified"> 41     switch (thisValue.getObject()-&gt;classInfo(vm)-&gt;typedArrayStorageType) {                        \</span>
 42     case TypeUint8Clamped:                                                                      \
<span class="line-modified"> 43         return functionName&lt;JSUint8ClampedArray&gt;(vm, exec);                                     \</span>
 44     case TypeInt32:                                                                             \
<span class="line-modified"> 45         return functionName&lt;JSInt32Array&gt;(vm, exec);                                            \</span>
 46     case TypeUint32:                                                                            \
<span class="line-modified"> 47         return functionName&lt;JSUint32Array&gt;(vm, exec);                                           \</span>
 48     case TypeFloat64:                                                                           \
<span class="line-modified"> 49         return functionName&lt;JSFloat64Array&gt;(vm, exec);                                          \</span>
 50     case TypeFloat32:                                                                           \
<span class="line-modified"> 51         return functionName&lt;JSFloat32Array&gt;(vm, exec);                                          \</span>
 52     case TypeInt8:                                                                              \
<span class="line-modified"> 53         return functionName&lt;JSInt8Array&gt;(vm, exec);                                             \</span>
 54     case TypeUint8:                                                                             \
<span class="line-modified"> 55         return functionName&lt;JSUint8Array&gt;(vm, exec);                                            \</span>
 56     case TypeInt16:                                                                             \
<span class="line-modified"> 57         return functionName&lt;JSInt16Array&gt;(vm, exec);                                            \</span>
 58     case TypeUint16:                                                                            \
<span class="line-modified"> 59         return functionName&lt;JSUint16Array&gt;(vm, exec);                                           \</span>
 60     case NotTypedArray:                                                                         \
 61     case TypeDataView:                                                                          \
<span class="line-modified"> 62         return throwVMTypeError(exec, scope,                                                    \</span>
<span class="line-modified"> 63             &quot;Receiver should be a typed array view&quot;_s);                             \</span>
 64     }                                                                                           \
 65     RELEASE_ASSERT_NOT_REACHED();                                                               \
 66 } while (false)
 67 
<span class="line-modified"> 68 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncIsTypedArrayView(ExecState* exec)</span>
 69 {
<span class="line-modified"> 70     JSValue value = exec-&gt;uncheckedArgument(0);</span>
<span class="line-modified"> 71     return JSValue::encode(jsBoolean(value.isCell() &amp;&amp; isTypedView(value.asCell()-&gt;classInfo(exec-&gt;vm())-&gt;typedArrayStorageType)));</span>
 72 }
 73 
<span class="line-modified"> 74 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncLength(ExecState* exec)</span>
 75 {
<span class="line-modified"> 76     VM&amp; vm = exec-&gt;vm();</span>
 77     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified"> 78     JSValue argument = exec-&gt;argument(0);</span>
 79     if (!argument.isCell() || !isTypedView(argument.asCell()-&gt;classInfo(vm)-&gt;typedArrayStorageType))
<span class="line-modified"> 80         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view&quot;_s);</span>
 81 
 82     JSArrayBufferView* thisObject = jsCast&lt;JSArrayBufferView*&gt;(argument);
 83 
 84     if (thisObject-&gt;isNeutered())
<span class="line-modified"> 85         return throwVMTypeError(exec, scope, &quot;Underlying ArrayBuffer has been detached from the view&quot;_s);</span>
 86 
 87     return JSValue::encode(jsNumber(thisObject-&gt;length()));
 88 }
 89 
<span class="line-modified"> 90 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncGetOriginalConstructor(ExecState* exec)</span>
 91 {
<span class="line-modified"> 92     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-modified"> 93     JSGlobalObject* globalObject = exec-&gt;lexicalGlobalObject();</span>
<span class="line-removed"> 94     TypedArrayType type = exec-&gt;uncheckedArgument(0).getObject()-&gt;classInfo(vm)-&gt;typedArrayStorageType;</span>
 95     ASSERT(isTypedView(type));
 96     return JSValue::encode(globalObject-&gt;typedArrayConstructor(type));
 97 }
 98 
<span class="line-modified"> 99 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncSort(ExecState* exec)</span>
100 {
<span class="line-modified">101     VM&amp; vm = exec-&gt;vm();</span>
102     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">103     JSValue thisValue = exec-&gt;argument(0);</span>































104     scope.release();
105     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewPrivateFuncSort);
106 }
107 
<span class="line-modified">108 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncSet(ExecState* exec)</span>
109 {
<span class="line-modified">110     VM&amp; vm = exec-&gt;vm();</span>
111     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">112     JSValue thisValue = exec-&gt;thisValue();</span>
113     if (UNLIKELY(!thisValue.isObject()))
<span class="line-modified">114         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
115     scope.release();
116     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncSet);
117 }
118 
<span class="line-modified">119 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncCopyWithin(ExecState* exec)</span>
120 {
<span class="line-modified">121     VM&amp; vm = exec-&gt;vm();</span>
122     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">123     JSValue thisValue = exec-&gt;thisValue();</span>
124     if (!thisValue.isObject())
<span class="line-modified">125         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
126     scope.release();
127     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncCopyWithin);
128 }
129 
<span class="line-modified">130 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncIncludes(ExecState* exec)</span>
131 {
<span class="line-modified">132     VM&amp; vm = exec-&gt;vm();</span>
133     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">134     JSValue thisValue = exec-&gt;thisValue();</span>
135     if (!thisValue.isObject())
<span class="line-modified">136         return throwVMError(exec, scope, createTypeError(exec, &quot;Receiver should be a typed array view but was not an object&quot;));</span>
137     scope.release();
138     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncIncludes);
139 }
140 
<span class="line-modified">141 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncLastIndexOf(ExecState* exec)</span>
142 {
<span class="line-modified">143     VM&amp; vm = exec-&gt;vm();</span>
144     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">145     JSValue thisValue = exec-&gt;thisValue();</span>
146     if (!thisValue.isObject())
<span class="line-modified">147         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
148     scope.release();
149     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncLastIndexOf);
150 }
151 
<span class="line-modified">152 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncIndexOf(ExecState* exec)</span>
153 {
<span class="line-modified">154     VM&amp; vm = exec-&gt;vm();</span>
155     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">156     JSValue thisValue = exec-&gt;thisValue();</span>
157     if (!thisValue.isObject())
<span class="line-modified">158         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
159     scope.release();
160     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncIndexOf);
161 }
162 
<span class="line-modified">163 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncJoin(ExecState* exec)</span>
164 {
<span class="line-modified">165     VM&amp; vm = exec-&gt;vm();</span>
166     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">167     JSValue thisValue = exec-&gt;thisValue();</span>
168     if (!thisValue.isObject())
<span class="line-modified">169         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
170     scope.release();
171     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncJoin);
172 }
173 
<span class="line-modified">174 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncBuffer(ExecState* exec)</span>
175 {
<span class="line-modified">176     VM&amp; vm = exec-&gt;vm();</span>
177     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">178     JSValue thisValue = exec-&gt;thisValue();</span>
179     if (!thisValue.isObject())
<span class="line-modified">180         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
181     scope.release();
182     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncBuffer);
183 }
184 
<span class="line-modified">185 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncLength(ExecState* exec)</span>
186 {
<span class="line-modified">187     VM&amp; vm = exec-&gt;vm();</span>
188     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">189     JSValue thisValue = exec-&gt;thisValue();</span>
190     if (!thisValue.isObject())
<span class="line-modified">191         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
192     scope.release();
193     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncLength);
194 }
195 
<span class="line-modified">196 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncByteLength(ExecState* exec)</span>
197 {
<span class="line-modified">198     VM&amp; vm = exec-&gt;vm();</span>
199     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">200     JSValue thisValue = exec-&gt;thisValue();</span>
201     if (!thisValue.isObject())
<span class="line-modified">202         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
203     scope.release();
204     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncByteLength);
205 }
206 
<span class="line-modified">207 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncByteOffset(ExecState* exec)</span>
208 {
<span class="line-modified">209     VM&amp; vm = exec-&gt;vm();</span>
210     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">211     JSValue thisValue = exec-&gt;thisValue();</span>
212     if (!thisValue.isObject())
<span class="line-modified">213         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
214     scope.release();
215     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncByteOffset);
216 }
217 
<span class="line-modified">218 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncReverse(ExecState* exec)</span>
219 {
<span class="line-modified">220     VM&amp; vm = exec-&gt;vm();</span>
221     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">222     JSValue thisValue = exec-&gt;thisValue();</span>
223     if (!thisValue.isObject())
<span class="line-modified">224         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
225     scope.release();
226     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncReverse);
227 }
228 
<span class="line-modified">229 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncSubarrayCreate(ExecState* exec)</span>
230 {
<span class="line-modified">231     VM&amp; vm = exec-&gt;vm();</span>
232     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">233     JSValue thisValue = exec-&gt;thisValue();</span>
234     if (!thisValue.isObject())
<span class="line-modified">235         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
236     scope.release();
237     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewPrivateFuncSubarrayCreate);
238 }
239 
<span class="line-modified">240 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncSlice(ExecState* exec)</span>
241 {
<span class="line-modified">242     VM&amp; vm = exec-&gt;vm();</span>
243     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">244     JSValue thisValue = exec-&gt;thisValue();</span>
245     if (!thisValue.isObject())
<span class="line-modified">246         return throwVMTypeError(exec, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
247     scope.release();
248     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncSlice);
249 }
250 
<span class="line-modified">251 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncToStringTag(ExecState* exec)</span>
252 {
<span class="line-modified">253     JSValue thisValue = exec-&gt;thisValue();</span>
254     if (!thisValue.isObject())
255         return JSValue::encode(jsUndefined());
256 
<span class="line-modified">257     VM&amp; vm = exec-&gt;vm();</span>
258     switch (thisValue.getObject()-&gt;classInfo(vm)-&gt;typedArrayStorageType) {
259     case TypeUint8Clamped:
<span class="line-modified">260         return JSValue::encode(jsString(vm, &quot;Uint8ClampedArray&quot;));</span>
261     case TypeInt32:
<span class="line-modified">262         return JSValue::encode(jsString(vm, &quot;Int32Array&quot;));</span>
263     case TypeUint32:
<span class="line-modified">264         return JSValue::encode(jsString(vm, &quot;Uint32Array&quot;));</span>
265     case TypeFloat64:
<span class="line-modified">266         return JSValue::encode(jsString(vm, &quot;Float64Array&quot;));</span>
267     case TypeFloat32:
<span class="line-modified">268         return JSValue::encode(jsString(vm, &quot;Float32Array&quot;));</span>
269     case TypeInt8:
<span class="line-modified">270         return JSValue::encode(jsString(vm, &quot;Int8Array&quot;));</span>
271     case TypeUint8:
<span class="line-modified">272         return JSValue::encode(jsString(vm, &quot;Uint8Array&quot;));</span>
273     case TypeInt16:
<span class="line-modified">274         return JSValue::encode(jsString(vm, &quot;Int16Array&quot;));</span>
275     case TypeUint16:
<span class="line-modified">276         return JSValue::encode(jsString(vm, &quot;Uint16Array&quot;));</span>
277     case NotTypedArray:
278     case TypeDataView:
279         return JSValue::encode(jsUndefined());
280     }
281     RELEASE_ASSERT_NOT_REACHED();
282 }
283 
284 
285 #undef CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION
286 
287 JSTypedArrayViewPrototype::JSTypedArrayViewPrototype(VM&amp; vm, Structure* structure)
288     : Base(vm, structure)
289 {
290 }
291 
292 void JSTypedArrayViewPrototype::finishCreation(VM&amp; vm, JSGlobalObject* globalObject)
293 {
294     Base::finishCreation(vm);
295 
296     ASSERT(inherits(vm, info()));
297 
298     putDirectWithoutTransition(vm, vm.propertyNames-&gt;toString, globalObject-&gt;arrayProtoToStringFunction(), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
299 
300     JSC_NATIVE_GETTER_WITHOUT_TRANSITION(&quot;buffer&quot;, typedArrayViewProtoGetterFuncBuffer, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
301     JSC_NATIVE_INTRINSIC_GETTER_WITHOUT_TRANSITION(vm.propertyNames-&gt;byteLength, typedArrayViewProtoGetterFuncByteLength, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly, TypedArrayByteLengthIntrinsic);
302     JSC_NATIVE_INTRINSIC_GETTER_WITHOUT_TRANSITION(vm.propertyNames-&gt;byteOffset, typedArrayViewProtoGetterFuncByteOffset, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly, TypedArrayByteOffsetIntrinsic);
303     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;copyWithin&quot;, typedArrayViewProtoFuncCopyWithin, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 2);
304     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;every&quot;, typedArrayPrototypeEveryCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
305     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;filter&quot;, typedArrayPrototypeFilterCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
306     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;sort&quot;, typedArrayPrototypeSortCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
<span class="line-modified">307     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;builtinNames().entriesPublicName(), typedArrayPrototypeEntriesCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
308     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;includes&quot;, typedArrayViewProtoFuncIncludes, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
309     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;fill&quot;, typedArrayPrototypeFillCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
310     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;find&quot;, typedArrayPrototypeFindCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
311     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;findIndex&quot;, typedArrayPrototypeFindIndexCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
312     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;forEach, typedArrayPrototypeForEachCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
313     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;indexOf&quot;, typedArrayViewProtoFuncIndexOf, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
314     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;join, typedArrayViewProtoFuncJoin, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
<span class="line-modified">315     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;builtinNames().keysPublicName(), typedArrayPrototypeKeysCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
316     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;lastIndexOf&quot;, typedArrayViewProtoFuncLastIndexOf, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
317     JSC_NATIVE_INTRINSIC_GETTER_WITHOUT_TRANSITION(vm.propertyNames-&gt;length, typedArrayViewProtoGetterFuncLength, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum) | PropertyAttribute::ReadOnly, TypedArrayLengthIntrinsic);
318     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;map&quot;, typedArrayPrototypeMapCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
319     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;reduce&quot;, typedArrayPrototypeReduceCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
320     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;reduceRight&quot;, typedArrayPrototypeReduceRightCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
321     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;reverse&quot;, typedArrayViewProtoFuncReverse, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 0);
322     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;set, typedArrayViewProtoFuncSet, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
323     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;slice, typedArrayViewProtoFuncSlice, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 2);
324     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;some&quot;, typedArrayPrototypeSomeCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
325     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;subarray, typedArrayPrototypeSubarrayCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
326     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;toLocaleString, typedArrayPrototypeToLocaleStringCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
327 
328     JSFunction* toStringTagFunction = JSFunction::create(vm, globalObject, 0, &quot;get [Symbol.toStringTag]&quot;_s, typedArrayViewProtoGetterFuncToStringTag, NoIntrinsic);
329     GetterSetter* toStringTagAccessor = GetterSetter::create(vm, globalObject, toStringTagFunction, nullptr);
330     putDirectNonIndexAccessorWithoutTransition(vm, vm.propertyNames-&gt;toStringTagSymbol, toStringTagAccessor, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly | PropertyAttribute::Accessor);
331 
<span class="line-modified">332     JSFunction* valuesFunction = JSFunction::create(vm, typedArrayPrototypeValuesCodeGenerator(vm), globalObject);</span>
333 
334     putDirectWithoutTransition(vm, vm.propertyNames-&gt;builtinNames().valuesPublicName(), valuesFunction, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
335     putDirectWithoutTransition(vm, vm.propertyNames-&gt;iteratorSymbol, valuesFunction, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
336 
337 }
338 
339 JSTypedArrayViewPrototype* JSTypedArrayViewPrototype::create(
340     VM&amp; vm, JSGlobalObject* globalObject, Structure* structure)
341 {
342     JSTypedArrayViewPrototype* prototype =
343         new (NotNull, allocateCell&lt;JSTypedArrayViewPrototype&gt;(vm.heap))
344         JSTypedArrayViewPrototype(vm, structure);
345     prototype-&gt;finishCreation(vm, globalObject);
346     return prototype;
347 }
348 
349 Structure* JSTypedArrayViewPrototype::createStructure(
350     VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
351 {
352     return Structure::create(vm, globalObject, prototype, TypeInfo(ObjectType, StructureFlags), info());
</pre>
</td>
<td>
<hr />
<pre>
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;JSTypedArrayViewPrototype.h&quot;
 28 
 29 #include &quot;BuiltinNames.h&quot;
 30 #include &quot;CallFrame.h&quot;
 31 #include &quot;GetterSetter.h&quot;
<span class="line-added"> 32 #include &quot;JSArrayIterator.h&quot;</span>
 33 #include &quot;JSCInlines.h&quot;
 34 #include &quot;JSFunction.h&quot;
 35 #include &quot;JSGenericTypedArrayViewPrototypeFunctions.h&quot;
 36 #include &quot;JSObjectInlines.h&quot;
 37 #include &quot;TypedArrayAdaptors.h&quot;
 38 
 39 namespace JSC {
 40 
 41 #define CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(functionName) do {                           \
<span class="line-modified"> 42     switch (thisValue.getObject()-&gt;classInfo(vm)-&gt;typedArrayStorageType) {                      \</span>
 43     case TypeUint8Clamped:                                                                      \
<span class="line-modified"> 44         return functionName&lt;JSUint8ClampedArray&gt;(vm, globalObject, callFrame);                  \</span>
 45     case TypeInt32:                                                                             \
<span class="line-modified"> 46         return functionName&lt;JSInt32Array&gt;(vm, globalObject, callFrame);                         \</span>
 47     case TypeUint32:                                                                            \
<span class="line-modified"> 48         return functionName&lt;JSUint32Array&gt;(vm, globalObject, callFrame);                        \</span>
 49     case TypeFloat64:                                                                           \
<span class="line-modified"> 50         return functionName&lt;JSFloat64Array&gt;(vm, globalObject, callFrame);                       \</span>
 51     case TypeFloat32:                                                                           \
<span class="line-modified"> 52         return functionName&lt;JSFloat32Array&gt;(vm, globalObject, callFrame);                       \</span>
 53     case TypeInt8:                                                                              \
<span class="line-modified"> 54         return functionName&lt;JSInt8Array&gt;(vm, globalObject, callFrame);                          \</span>
 55     case TypeUint8:                                                                             \
<span class="line-modified"> 56         return functionName&lt;JSUint8Array&gt;(vm, globalObject, callFrame);                         \</span>
 57     case TypeInt16:                                                                             \
<span class="line-modified"> 58         return functionName&lt;JSInt16Array&gt;(vm, globalObject, callFrame);                         \</span>
 59     case TypeUint16:                                                                            \
<span class="line-modified"> 60         return functionName&lt;JSUint16Array&gt;(vm, globalObject, callFrame);                        \</span>
 61     case NotTypedArray:                                                                         \
 62     case TypeDataView:                                                                          \
<span class="line-modified"> 63         return throwVMTypeError(globalObject, scope,                                            \</span>
<span class="line-modified"> 64             &quot;Receiver should be a typed array view&quot;_s);                                         \</span>
 65     }                                                                                           \
 66     RELEASE_ASSERT_NOT_REACHED();                                                               \
 67 } while (false)
 68 
<span class="line-modified"> 69 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncIsTypedArrayView(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
 70 {
<span class="line-modified"> 71     JSValue value = callFrame-&gt;uncheckedArgument(0);</span>
<span class="line-modified"> 72     return JSValue::encode(jsBoolean(value.isCell() &amp;&amp; isTypedView(value.asCell()-&gt;classInfo(globalObject-&gt;vm())-&gt;typedArrayStorageType)));</span>
 73 }
 74 
<span class="line-modified"> 75 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncLength(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
 76 {
<span class="line-modified"> 77     VM&amp; vm = globalObject-&gt;vm();</span>
 78     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified"> 79     JSValue argument = callFrame-&gt;argument(0);</span>
 80     if (!argument.isCell() || !isTypedView(argument.asCell()-&gt;classInfo(vm)-&gt;typedArrayStorageType))
<span class="line-modified"> 81         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view&quot;_s);</span>
 82 
 83     JSArrayBufferView* thisObject = jsCast&lt;JSArrayBufferView*&gt;(argument);
 84 
 85     if (thisObject-&gt;isNeutered())
<span class="line-modified"> 86         return throwVMTypeError(globalObject, scope, &quot;Underlying ArrayBuffer has been detached from the view&quot;_s);</span>
 87 
 88     return JSValue::encode(jsNumber(thisObject-&gt;length()));
 89 }
 90 
<span class="line-modified"> 91 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncGetOriginalConstructor(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
 92 {
<span class="line-modified"> 93     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified"> 94     TypedArrayType type = callFrame-&gt;uncheckedArgument(0).getObject()-&gt;classInfo(vm)-&gt;typedArrayStorageType;</span>

 95     ASSERT(isTypedView(type));
 96     return JSValue::encode(globalObject-&gt;typedArrayConstructor(type));
 97 }
 98 
<span class="line-modified"> 99 inline EncodedJSValue createTypedArrayIteratorObject(JSGlobalObject* globalObject, CallFrame* callFrame, IterationKind kind)</span>
100 {
<span class="line-modified">101     VM&amp; vm = globalObject-&gt;vm();</span>
102     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">103 </span>
<span class="line-added">104     if (!callFrame-&gt;thisValue().isCell() || !isTypedArrayType(callFrame-&gt;thisValue().asCell()-&gt;type()))</span>
<span class="line-added">105         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view&quot;_s);</span>
<span class="line-added">106 </span>
<span class="line-added">107     JSArrayBufferView* thisObject = jsCast&lt;JSArrayBufferView*&gt;(callFrame-&gt;thisValue());</span>
<span class="line-added">108 </span>
<span class="line-added">109     if (thisObject-&gt;isNeutered())</span>
<span class="line-added">110         return throwVMTypeError(globalObject, scope, &quot;Underlying ArrayBuffer has been detached from the view&quot;_s);</span>
<span class="line-added">111 </span>
<span class="line-added">112     return JSValue::encode(JSArrayIterator::create(vm, globalObject-&gt;arrayIteratorStructure(), thisObject, jsNumber(static_cast&lt;unsigned&gt;(kind))));</span>
<span class="line-added">113 }</span>
<span class="line-added">114 </span>
<span class="line-added">115 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncValues(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
<span class="line-added">116 {</span>
<span class="line-added">117     return createTypedArrayIteratorObject(globalObject, callFrame, IterationKind::Values);</span>
<span class="line-added">118 }</span>
<span class="line-added">119 </span>
<span class="line-added">120 static EncodedJSValue JSC_HOST_CALL typedArrayProtoViewFuncEntries(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
<span class="line-added">121 {</span>
<span class="line-added">122     return createTypedArrayIteratorObject(globalObject, callFrame, IterationKind::Entries);</span>
<span class="line-added">123 }</span>
<span class="line-added">124 </span>
<span class="line-added">125 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncKeys(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
<span class="line-added">126 {</span>
<span class="line-added">127     return createTypedArrayIteratorObject(globalObject, callFrame, IterationKind::Keys);</span>
<span class="line-added">128 }</span>
<span class="line-added">129 </span>
<span class="line-added">130 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncSort(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
<span class="line-added">131 {</span>
<span class="line-added">132     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-added">133     auto scope = DECLARE_THROW_SCOPE(vm);</span>
<span class="line-added">134     JSValue thisValue = callFrame-&gt;argument(0);</span>
135     scope.release();
136     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewPrivateFuncSort);
137 }
138 
<span class="line-modified">139 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncSet(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
140 {
<span class="line-modified">141     VM&amp; vm = globalObject-&gt;vm();</span>
142     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">143     JSValue thisValue = callFrame-&gt;thisValue();</span>
144     if (UNLIKELY(!thisValue.isObject()))
<span class="line-modified">145         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
146     scope.release();
147     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncSet);
148 }
149 
<span class="line-modified">150 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncCopyWithin(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
151 {
<span class="line-modified">152     VM&amp; vm = globalObject-&gt;vm();</span>
153     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">154     JSValue thisValue = callFrame-&gt;thisValue();</span>
155     if (!thisValue.isObject())
<span class="line-modified">156         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
157     scope.release();
158     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncCopyWithin);
159 }
160 
<span class="line-modified">161 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncIncludes(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
162 {
<span class="line-modified">163     VM&amp; vm = globalObject-&gt;vm();</span>
164     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">165     JSValue thisValue = callFrame-&gt;thisValue();</span>
166     if (!thisValue.isObject())
<span class="line-modified">167         return throwVMError(globalObject, scope, createTypeError(globalObject, &quot;Receiver should be a typed array view but was not an object&quot;));</span>
168     scope.release();
169     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncIncludes);
170 }
171 
<span class="line-modified">172 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncLastIndexOf(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
173 {
<span class="line-modified">174     VM&amp; vm = globalObject-&gt;vm();</span>
175     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">176     JSValue thisValue = callFrame-&gt;thisValue();</span>
177     if (!thisValue.isObject())
<span class="line-modified">178         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
179     scope.release();
180     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncLastIndexOf);
181 }
182 
<span class="line-modified">183 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncIndexOf(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
184 {
<span class="line-modified">185     VM&amp; vm = globalObject-&gt;vm();</span>
186     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">187     JSValue thisValue = callFrame-&gt;thisValue();</span>
188     if (!thisValue.isObject())
<span class="line-modified">189         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
190     scope.release();
191     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncIndexOf);
192 }
193 
<span class="line-modified">194 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncJoin(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
195 {
<span class="line-modified">196     VM&amp; vm = globalObject-&gt;vm();</span>
197     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">198     JSValue thisValue = callFrame-&gt;thisValue();</span>
199     if (!thisValue.isObject())
<span class="line-modified">200         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
201     scope.release();
202     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncJoin);
203 }
204 
<span class="line-modified">205 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncBuffer(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
206 {
<span class="line-modified">207     VM&amp; vm = globalObject-&gt;vm();</span>
208     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">209     JSValue thisValue = callFrame-&gt;thisValue();</span>
210     if (!thisValue.isObject())
<span class="line-modified">211         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
212     scope.release();
213     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncBuffer);
214 }
215 
<span class="line-modified">216 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncLength(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
217 {
<span class="line-modified">218     VM&amp; vm = globalObject-&gt;vm();</span>
219     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">220     JSValue thisValue = callFrame-&gt;thisValue();</span>
221     if (!thisValue.isObject())
<span class="line-modified">222         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
223     scope.release();
224     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncLength);
225 }
226 
<span class="line-modified">227 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncByteLength(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
228 {
<span class="line-modified">229     VM&amp; vm = globalObject-&gt;vm();</span>
230     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">231     JSValue thisValue = callFrame-&gt;thisValue();</span>
232     if (!thisValue.isObject())
<span class="line-modified">233         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
234     scope.release();
235     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncByteLength);
236 }
237 
<span class="line-modified">238 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncByteOffset(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
239 {
<span class="line-modified">240     VM&amp; vm = globalObject-&gt;vm();</span>
241     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">242     JSValue thisValue = callFrame-&gt;thisValue();</span>
243     if (!thisValue.isObject())
<span class="line-modified">244         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
245     scope.release();
246     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoGetterFuncByteOffset);
247 }
248 
<span class="line-modified">249 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncReverse(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
250 {
<span class="line-modified">251     VM&amp; vm = globalObject-&gt;vm();</span>
252     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">253     JSValue thisValue = callFrame-&gt;thisValue();</span>
254     if (!thisValue.isObject())
<span class="line-modified">255         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
256     scope.release();
257     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncReverse);
258 }
259 
<span class="line-modified">260 EncodedJSValue JSC_HOST_CALL typedArrayViewPrivateFuncSubarrayCreate(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
261 {
<span class="line-modified">262     VM&amp; vm = globalObject-&gt;vm();</span>
263     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">264     JSValue thisValue = callFrame-&gt;thisValue();</span>
265     if (!thisValue.isObject())
<span class="line-modified">266         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
267     scope.release();
268     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewPrivateFuncSubarrayCreate);
269 }
270 
<span class="line-modified">271 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoFuncSlice(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
272 {
<span class="line-modified">273     VM&amp; vm = globalObject-&gt;vm();</span>
274     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">275     JSValue thisValue = callFrame-&gt;thisValue();</span>
276     if (!thisValue.isObject())
<span class="line-modified">277         return throwVMTypeError(globalObject, scope, &quot;Receiver should be a typed array view but was not an object&quot;_s);</span>
278     scope.release();
279     CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION(genericTypedArrayViewProtoFuncSlice);
280 }
281 
<span class="line-modified">282 static EncodedJSValue JSC_HOST_CALL typedArrayViewProtoGetterFuncToStringTag(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
283 {
<span class="line-modified">284     JSValue thisValue = callFrame-&gt;thisValue();</span>
285     if (!thisValue.isObject())
286         return JSValue::encode(jsUndefined());
287 
<span class="line-modified">288     VM&amp; vm = globalObject-&gt;vm();</span>
289     switch (thisValue.getObject()-&gt;classInfo(vm)-&gt;typedArrayStorageType) {
290     case TypeUint8Clamped:
<span class="line-modified">291         return JSValue::encode(jsNontrivialString(vm, &quot;Uint8ClampedArray&quot;_s));</span>
292     case TypeInt32:
<span class="line-modified">293         return JSValue::encode(jsNontrivialString(vm, &quot;Int32Array&quot;_s));</span>
294     case TypeUint32:
<span class="line-modified">295         return JSValue::encode(jsNontrivialString(vm, &quot;Uint32Array&quot;_s));</span>
296     case TypeFloat64:
<span class="line-modified">297         return JSValue::encode(jsNontrivialString(vm, &quot;Float64Array&quot;_s));</span>
298     case TypeFloat32:
<span class="line-modified">299         return JSValue::encode(jsNontrivialString(vm, &quot;Float32Array&quot;_s));</span>
300     case TypeInt8:
<span class="line-modified">301         return JSValue::encode(jsNontrivialString(vm, &quot;Int8Array&quot;_s));</span>
302     case TypeUint8:
<span class="line-modified">303         return JSValue::encode(jsNontrivialString(vm, &quot;Uint8Array&quot;_s));</span>
304     case TypeInt16:
<span class="line-modified">305         return JSValue::encode(jsNontrivialString(vm, &quot;Int16Array&quot;_s));</span>
306     case TypeUint16:
<span class="line-modified">307         return JSValue::encode(jsNontrivialString(vm, &quot;Uint16Array&quot;_s));</span>
308     case NotTypedArray:
309     case TypeDataView:
310         return JSValue::encode(jsUndefined());
311     }
312     RELEASE_ASSERT_NOT_REACHED();
313 }
314 
315 
316 #undef CALL_GENERIC_TYPEDARRAY_PROTOTYPE_FUNCTION
317 
318 JSTypedArrayViewPrototype::JSTypedArrayViewPrototype(VM&amp; vm, Structure* structure)
319     : Base(vm, structure)
320 {
321 }
322 
323 void JSTypedArrayViewPrototype::finishCreation(VM&amp; vm, JSGlobalObject* globalObject)
324 {
325     Base::finishCreation(vm);
326 
327     ASSERT(inherits(vm, info()));
328 
329     putDirectWithoutTransition(vm, vm.propertyNames-&gt;toString, globalObject-&gt;arrayProtoToStringFunction(), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
330 
331     JSC_NATIVE_GETTER_WITHOUT_TRANSITION(&quot;buffer&quot;, typedArrayViewProtoGetterFuncBuffer, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);
332     JSC_NATIVE_INTRINSIC_GETTER_WITHOUT_TRANSITION(vm.propertyNames-&gt;byteLength, typedArrayViewProtoGetterFuncByteLength, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly, TypedArrayByteLengthIntrinsic);
333     JSC_NATIVE_INTRINSIC_GETTER_WITHOUT_TRANSITION(vm.propertyNames-&gt;byteOffset, typedArrayViewProtoGetterFuncByteOffset, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly, TypedArrayByteOffsetIntrinsic);
334     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;copyWithin&quot;, typedArrayViewProtoFuncCopyWithin, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 2);
335     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;every&quot;, typedArrayPrototypeEveryCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
336     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;filter&quot;, typedArrayPrototypeFilterCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
337     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;sort&quot;, typedArrayPrototypeSortCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
<span class="line-modified">338     JSC_NATIVE_INTRINSIC_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;entries, typedArrayProtoViewFuncEntries, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 0, TypedArrayEntriesIntrinsic);</span>
339     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;includes&quot;, typedArrayViewProtoFuncIncludes, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
340     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;fill&quot;, typedArrayPrototypeFillCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
341     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;find&quot;, typedArrayPrototypeFindCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
342     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;findIndex&quot;, typedArrayPrototypeFindIndexCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
343     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;forEach, typedArrayPrototypeForEachCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
344     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;indexOf&quot;, typedArrayViewProtoFuncIndexOf, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
345     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;join, typedArrayViewProtoFuncJoin, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
<span class="line-modified">346     JSC_NATIVE_INTRINSIC_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;keys, typedArrayViewProtoFuncKeys, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 0, TypedArrayKeysIntrinsic);</span>
347     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;lastIndexOf&quot;, typedArrayViewProtoFuncLastIndexOf, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
348     JSC_NATIVE_INTRINSIC_GETTER_WITHOUT_TRANSITION(vm.propertyNames-&gt;length, typedArrayViewProtoGetterFuncLength, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum) | PropertyAttribute::ReadOnly, TypedArrayLengthIntrinsic);
349     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;map&quot;, typedArrayPrototypeMapCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
350     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;reduce&quot;, typedArrayPrototypeReduceCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
351     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;reduceRight&quot;, typedArrayPrototypeReduceRightCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
352     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(&quot;reverse&quot;, typedArrayViewProtoFuncReverse, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 0);
353     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;set, typedArrayViewProtoFuncSet, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 1);
354     JSC_NATIVE_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;slice, typedArrayViewProtoFuncSlice, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), 2);
355     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(&quot;some&quot;, typedArrayPrototypeSomeCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
356     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;subarray, typedArrayPrototypeSubarrayCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
357     JSC_BUILTIN_FUNCTION_WITHOUT_TRANSITION(vm.propertyNames-&gt;toLocaleString, typedArrayPrototypeToLocaleStringCodeGenerator, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
358 
359     JSFunction* toStringTagFunction = JSFunction::create(vm, globalObject, 0, &quot;get [Symbol.toStringTag]&quot;_s, typedArrayViewProtoGetterFuncToStringTag, NoIntrinsic);
360     GetterSetter* toStringTagAccessor = GetterSetter::create(vm, globalObject, toStringTagFunction, nullptr);
361     putDirectNonIndexAccessorWithoutTransition(vm, vm.propertyNames-&gt;toStringTagSymbol, toStringTagAccessor, PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly | PropertyAttribute::Accessor);
362 
<span class="line-modified">363     JSFunction* valuesFunction = JSFunction::create(vm, globalObject, 0, vm.propertyNames-&gt;values.string(), typedArrayViewProtoFuncValues, TypedArrayValuesIntrinsic);</span>
364 
365     putDirectWithoutTransition(vm, vm.propertyNames-&gt;builtinNames().valuesPublicName(), valuesFunction, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
366     putDirectWithoutTransition(vm, vm.propertyNames-&gt;iteratorSymbol, valuesFunction, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
367 
368 }
369 
370 JSTypedArrayViewPrototype* JSTypedArrayViewPrototype::create(
371     VM&amp; vm, JSGlobalObject* globalObject, Structure* structure)
372 {
373     JSTypedArrayViewPrototype* prototype =
374         new (NotNull, allocateCell&lt;JSTypedArrayViewPrototype&gt;(vm.heap))
375         JSTypedArrayViewPrototype(vm, structure);
376     prototype-&gt;finishCreation(vm, globalObject);
377     return prototype;
378 }
379 
380 Structure* JSTypedArrayViewPrototype::createStructure(
381     VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
382 {
383     return Structure::create(vm, globalObject, prototype, TypeInfo(ObjectType, StructureFlags), info());
</pre>
</td>
</tr>
</table>
<center><a href="JSTypedArrayViewConstructor.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSTypedArrayViewPrototype.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>