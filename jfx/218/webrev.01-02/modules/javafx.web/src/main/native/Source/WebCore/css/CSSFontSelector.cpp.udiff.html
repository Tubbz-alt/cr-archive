<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/css/CSSFontSelector.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CSSFontFaceSource.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CSSFontSelector.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/css/CSSFontSelector.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -44,11 +44,10 @@</span>
  #include &quot;FontFaceSet.h&quot;
  #include &quot;FontSelectorClient.h&quot;
  #include &quot;Frame.h&quot;
  #include &quot;FrameLoader.h&quot;
  #include &quot;Logging.h&quot;
<span class="udiff-line-removed">- #include &quot;Quirks.h&quot;</span>
  #include &quot;ResourceLoadObserver.h&quot;
  #include &quot;RuntimeEnabledFeatures.h&quot;
  #include &quot;Settings.h&quot;
  #include &quot;StyleProperties.h&quot;
  #include &quot;StyleResolver.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -82,11 +81,11 @@</span>
      clearDocument();
      m_cssFontFaceSet-&gt;removeClient(*this);
      FontCache::singleton().removeClient(*this);
  }
  
<span class="udiff-line-modified-removed">- FontFaceSet* CSSFontSelector::optionalFontFaceSet()</span>
<span class="udiff-line-modified-added">+ FontFaceSet* CSSFontSelector::fontFaceSetIfExists()</span>
  {
      return m_fontFaceSet.get();
  }
  
  FontFaceSet&amp; CSSFontSelector::fontFaceSet()
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -161,16 +160,10 @@</span>
      RefPtr&lt;CSSValue&gt; fontWeight = style.getPropertyCSSValue(CSSPropertyFontWeight);
      RefPtr&lt;CSSValue&gt; fontStretch = style.getPropertyCSSValue(CSSPropertyFontStretch);
      RefPtr&lt;CSSValue&gt; src = style.getPropertyCSSValue(CSSPropertySrc);
      RefPtr&lt;CSSValue&gt; unicodeRange = style.getPropertyCSSValue(CSSPropertyUnicodeRange);
      RefPtr&lt;CSSValue&gt; featureSettings = style.getPropertyCSSValue(CSSPropertyFontFeatureSettings);
<span class="udiff-line-removed">-     RefPtr&lt;CSSValue&gt; variantLigatures = style.getPropertyCSSValue(CSSPropertyFontVariantLigatures);</span>
<span class="udiff-line-removed">-     RefPtr&lt;CSSValue&gt; variantPosition = style.getPropertyCSSValue(CSSPropertyFontVariantPosition);</span>
<span class="udiff-line-removed">-     RefPtr&lt;CSSValue&gt; variantCaps = style.getPropertyCSSValue(CSSPropertyFontVariantCaps);</span>
<span class="udiff-line-removed">-     RefPtr&lt;CSSValue&gt; variantNumeric = style.getPropertyCSSValue(CSSPropertyFontVariantNumeric);</span>
<span class="udiff-line-removed">-     RefPtr&lt;CSSValue&gt; variantAlternates = style.getPropertyCSSValue(CSSPropertyFontVariantAlternates);</span>
<span class="udiff-line-removed">-     RefPtr&lt;CSSValue&gt; variantEastAsian = style.getPropertyCSSValue(CSSPropertyFontVariantEastAsian);</span>
      RefPtr&lt;CSSValue&gt; loadingBehavior = style.getPropertyCSSValue(CSSPropertyFontDisplay);
      if (!is&lt;CSSValueList&gt;(fontFamily) || !is&lt;CSSValueList&gt;(src) || (unicodeRange &amp;&amp; !is&lt;CSSValueList&gt;(*unicodeRange)))
          return;
  
      CSSValueList&amp; familyList = downcast&lt;CSSValueList&gt;(*fontFamily);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -194,22 +187,10 @@</span>
          fontFace-&gt;setWeight(*fontWeight);
      if (fontStretch)
          fontFace-&gt;setStretch(*fontStretch);
      if (rangeList &amp;&amp; !fontFace-&gt;setUnicodeRange(*rangeList))
          return;
<span class="udiff-line-removed">-     if (variantLigatures &amp;&amp; !fontFace-&gt;setVariantLigatures(*variantLigatures))</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-removed">-     if (variantPosition &amp;&amp; !fontFace-&gt;setVariantPosition(*variantPosition))</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-removed">-     if (variantCaps &amp;&amp; !fontFace-&gt;setVariantCaps(*variantCaps))</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-removed">-     if (variantNumeric &amp;&amp; !fontFace-&gt;setVariantNumeric(*variantNumeric))</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-removed">-     if (variantAlternates &amp;&amp; !fontFace-&gt;setVariantAlternates(*variantAlternates))</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-removed">-     if (variantEastAsian &amp;&amp; !fontFace-&gt;setVariantEastAsian(*variantEastAsian))</span>
<span class="udiff-line-removed">-         return;</span>
      if (featureSettings)
          fontFace-&gt;setFeatureSettings(*featureSettings);
      if (loadingBehavior)
          fontFace-&gt;setLoadingBehavior(*loadingBehavior);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -320,18 +301,12 @@</span>
  
      AtomString familyForLookup = familyName;
      Optional&lt;FontDescription&gt; overrideFontDescription;
      const FontDescription* fontDescriptionForLookup = &amp;fontDescription;
      auto resolveGenericFamily = [&amp;]() {
<span class="udiff-line-modified-removed">-         if (auto genericFamilyOptional = WebCore::resolveGenericFamily(m_document.get(), fontDescription, familyName)) {</span>
<span class="udiff-line-removed">-             if (m_document &amp;&amp; m_document-&gt;quirks().shouldLightenJapaneseBoldSansSerif() &amp;&amp; familyForLookup == sansSerifFamily &amp;&amp; fontDescription.weight() == boldWeightValue() &amp;&amp; fontDescription.script() == USCRIPT_KATAKANA_OR_HIRAGANA) {</span>
<span class="udiff-line-removed">-                 overrideFontDescription = fontDescription;</span>
<span class="udiff-line-removed">-                 overrideFontDescription-&gt;setWeight(FontSelectionValue(600));</span>
<span class="udiff-line-removed">-                 fontDescriptionForLookup = &amp;*overrideFontDescription;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+         if (auto genericFamilyOptional = WebCore::resolveGenericFamily(m_document.get(), fontDescription, familyName))</span>
              familyForLookup = *genericFamilyOptional;
<span class="udiff-line-removed">-         }</span>
      };
  
      if (resolveGenericFamilyFirst)
          resolveGenericFamily();
      auto* face = m_cssFontFaceSet-&gt;fontFace(fontDescriptionForLookup-&gt;fontSelectionRequest(), familyForLookup);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -402,16 +377,18 @@</span>
      for (auto&amp; fontHandle : fontsToBeginLoading) {
          fontHandle-&gt;beginLoadIfNeeded(cachedResourceLoader);
          // Balances incrementRequestCount() in beginLoadingFontSoon().
          cachedResourceLoader.decrementRequestCount(*fontHandle);
      }
<span class="udiff-line-added">+     // FIXME: Use SubresourceLoader instead.</span>
<span class="udiff-line-added">+     // Call FrameLoader::loadDone before FrameLoader::subresourceLoadDone to match the order in SubresourceLoader::notifyDone.</span>
<span class="udiff-line-added">+     cachedResourceLoader.loadDone(LoadCompletionType::Finish);</span>
      // Ensure that if the request count reaches zero, the frame loader will know about it.
      // New font loads may be triggered by layout after the document load is complete but before we have dispatched
      // didFinishLoading for the frame. Make sure the delegate is always dispatched by checking explicitly.
      if (m_document &amp;&amp; m_document-&gt;frame())
          m_document-&gt;frame()-&gt;loader().checkLoadComplete();
<span class="udiff-line-removed">-     cachedResourceLoader.loadDone(LoadCompletionType::Finish);</span>
  }
  
  
  size_t CSSFontSelector::fallbackFontCount()
  {
</pre>
<center><a href="CSSFontFaceSource.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CSSFontSelector.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>