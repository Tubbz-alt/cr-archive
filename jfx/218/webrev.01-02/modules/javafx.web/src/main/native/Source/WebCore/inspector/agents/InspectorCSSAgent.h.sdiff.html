<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/inspector/agents/InspectorCSSAgent.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InspectorCSSAgent.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="InspectorCanvasAgent.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/inspector/agents/InspectorCSSAgent.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 33 #include &lt;JavaScriptCore/InspectorBackendDispatchers.h&gt;
 34 #include &lt;wtf/HashMap.h&gt;
 35 #include &lt;wtf/HashSet.h&gt;
 36 #include &lt;wtf/JSONValues.h&gt;
 37 #include &lt;wtf/RefPtr.h&gt;
 38 #include &lt;wtf/text/WTFString.h&gt;
 39 
 40 namespace Inspector {
 41 class CSSFrontendDispatcher;
 42 }
 43 
 44 namespace WebCore {
 45 
 46 class CSSRule;
 47 class CSSStyleRule;
 48 class CSSStyleSheet;
 49 class Document;
 50 class Element;
 51 class Node;
 52 class NodeList;
<span class="line-removed"> 53 class StyleResolver;</span>
 54 class StyleRule;
 55 




 56 class InspectorCSSAgent final : public InspectorAgentBase , public Inspector::CSSBackendDispatcherHandler , public InspectorStyleSheet::Listener {
 57     WTF_MAKE_NONCOPYABLE(InspectorCSSAgent);
 58     WTF_MAKE_FAST_ALLOCATED;
 59 public:
 60     InspectorCSSAgent(WebAgentContext&amp;);
<span class="line-modified"> 61     virtual ~InspectorCSSAgent();</span>
 62 
 63     class InlineStyleOverrideScope {
 64     public:
 65         InlineStyleOverrideScope(SecurityContext&amp; context)
 66             : m_contentSecurityPolicy(context.contentSecurityPolicy())
 67         {
 68             m_contentSecurityPolicy-&gt;setOverrideAllowInlineStyle(true);
 69         }
 70 
 71         ~InlineStyleOverrideScope()
 72         {
 73             m_contentSecurityPolicy-&gt;setOverrideAllowInlineStyle(false);
 74         }
 75 
 76     private:
 77         ContentSecurityPolicy* m_contentSecurityPolicy;
 78     };
 79 
 80     static CSSStyleRule* asCSSStyleRule(CSSRule&amp;);
 81 
 82     // InspectorAgentBase
<span class="line-modified"> 83     void didCreateFrontendAndBackend(Inspector::FrontendRouter*, Inspector::BackendDispatcher*);</span>
<span class="line-modified"> 84     void willDestroyFrontendAndBackend(Inspector::DisconnectReason);</span>
 85 
 86     // CSSBackendDispatcherHandler
<span class="line-modified"> 87     void enable(ErrorString&amp;);</span>
<span class="line-modified"> 88     void disable(ErrorString&amp;);</span>
<span class="line-modified"> 89     void getComputedStyleForNode(ErrorString&amp;, int nodeId, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::CSSComputedStyleProperty&gt;&gt;&amp;);</span>
<span class="line-modified"> 90     void getInlineStylesForNode(ErrorString&amp;, int nodeId, RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt;&amp; inlineStyle, RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt;&amp; attributes);</span>
<span class="line-modified"> 91     void getMatchedStylesForNode(ErrorString&amp;, int nodeId, const bool* includePseudo, const bool* includeInherited, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::RuleMatch&gt;&gt;&amp; matchedCSSRules, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::PseudoIdMatches&gt;&gt;&amp;, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::InheritedStyleEntry&gt;&gt;&amp; inheritedEntries);</span>
<span class="line-modified"> 92     void getAllStyleSheets(ErrorString&amp;, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::CSSStyleSheetHeader&gt;&gt;&amp; styleSheetInfos);</span>
<span class="line-modified"> 93     void getStyleSheet(ErrorString&amp;, const String&amp; styleSheetId, RefPtr&lt;Inspector::Protocol::CSS::CSSStyleSheetBody&gt;&amp; result);</span>
<span class="line-modified"> 94     void getStyleSheetText(ErrorString&amp;, const String&amp; styleSheetId, String* result);</span>
<span class="line-modified"> 95     void setStyleSheetText(ErrorString&amp;, const String&amp; styleSheetId, const String&amp; text);</span>
<span class="line-modified"> 96     void setStyleText(ErrorString&amp;, const JSON::Object&amp; styleId, const String&amp; text, RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt;&amp; result);</span>
<span class="line-modified"> 97     void setRuleSelector(ErrorString&amp;, const JSON::Object&amp; ruleId, const String&amp; selector, RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt;&amp; result);</span>
<span class="line-modified"> 98     void createStyleSheet(ErrorString&amp;, const String&amp; frameId, String* styleSheetId);</span>
<span class="line-modified"> 99     void addRule(ErrorString&amp;, const String&amp; styleSheetId, const String&amp; selector, RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt;&amp; result);</span>
<span class="line-modified">100     void getSupportedCSSProperties(ErrorString&amp;, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::CSSPropertyInfo&gt;&gt;&amp; result);</span>
<span class="line-modified">101     void getSupportedSystemFontFamilyNames(ErrorString&amp;, RefPtr&lt;JSON::ArrayOf&lt;String&gt;&gt;&amp; result);</span>
<span class="line-modified">102     void forcePseudoState(ErrorString&amp;, int nodeId, const JSON::Array&amp; forcedPseudoClasses);</span>
103 
104     // InspectorStyleSheet::Listener
<span class="line-modified">105     void styleSheetChanged(InspectorStyleSheet*);</span>
106 
107     // InspectorInstrumentation
108     void documentDetached(Document&amp;);
109     void mediaQueryResultChanged();
110     void activeStyleSheetsUpdated(Document&amp;);
111     bool forcePseudoState(const Element&amp;, CSSSelector::PseudoClassType);
112 
113     // InspectorDOMAgent hooks
114     void didRemoveDOMNode(Node&amp;, int nodeId);
115     void didModifyDOMAttr(Element&amp;);
116 
117     void reset();
118 
119 private:
120     class StyleSheetAction;
121     class SetStyleSheetTextAction;
122     class SetStyleTextAction;
123     class SetRuleSelectorAction;
124     class AddRuleAction;
125 
126     typedef HashMap&lt;String, RefPtr&lt;InspectorStyleSheet&gt;&gt; IdToInspectorStyleSheet;
127     typedef HashMap&lt;CSSStyleSheet*, RefPtr&lt;InspectorStyleSheet&gt;&gt; CSSStyleSheetToInspectorStyleSheet;
128     typedef HashMap&lt;RefPtr&lt;Document&gt;, Vector&lt;RefPtr&lt;InspectorStyleSheet&gt;&gt;&gt; DocumentToViaInspectorStyleSheet; // &quot;via inspector&quot; stylesheets
129     typedef HashMap&lt;int, unsigned&gt; NodeIdToForcedPseudoState;
130 
131     InspectorStyleSheetForInlineStyle&amp; asInspectorStyleSheet(StyledElement&amp;);
132     Element* elementForId(ErrorString&amp;, int nodeId);
133 
134     void collectAllStyleSheets(Vector&lt;InspectorStyleSheet*&gt;&amp;);
135     void collectAllDocumentStyleSheets(Document&amp;, Vector&lt;CSSStyleSheet*&gt;&amp;);
136     void collectStyleSheets(CSSStyleSheet*, Vector&lt;CSSStyleSheet*&gt;&amp;);
137     void setActiveStyleSheetsForDocument(Document&amp;, Vector&lt;CSSStyleSheet*&gt;&amp; activeStyleSheets);
138 
139     String unbindStyleSheet(InspectorStyleSheet*);
140     InspectorStyleSheet* bindStyleSheet(CSSStyleSheet*);
141     InspectorStyleSheet* assertStyleSheetForId(ErrorString&amp;, const String&amp;);
142     InspectorStyleSheet* createInspectorStyleSheetForDocument(Document&amp;);
143     Inspector::Protocol::CSS::StyleSheetOrigin detectOrigin(CSSStyleSheet* pageStyleSheet, Document* ownerDocument);
144 
<span class="line-modified">145     RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt; buildObjectForRule(StyleRule*, StyleResolver&amp;, Element&amp;);</span>
146     RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt; buildObjectForRule(CSSStyleRule*);
<span class="line-modified">147     RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::RuleMatch&gt;&gt; buildArrayForMatchedRuleList(const Vector&lt;RefPtr&lt;StyleRule&gt;&gt;&amp;, StyleResolver&amp;, Element&amp;, PseudoId);</span>
148     RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt; buildObjectForAttributesStyle(StyledElement&amp;);
149 
150 
151     void resetPseudoStates();
152 
153     std::unique_ptr&lt;Inspector::CSSFrontendDispatcher&gt; m_frontendDispatcher;
154     RefPtr&lt;Inspector::CSSBackendDispatcher&gt; m_backendDispatcher;
155 
156     IdToInspectorStyleSheet m_idToInspectorStyleSheet;
157     CSSStyleSheetToInspectorStyleSheet m_cssStyleSheetToInspectorStyleSheet;
158     HashMap&lt;Node*, Ref&lt;InspectorStyleSheetForInlineStyle&gt;&gt; m_nodeToInspectorStyleSheet; // bogus &quot;stylesheets&quot; with elements&#39; inline styles
159     DocumentToViaInspectorStyleSheet m_documentToInspectorStyleSheet;
160     HashMap&lt;Document*, HashSet&lt;CSSStyleSheet*&gt;&gt; m_documentToKnownCSSStyleSheets;
161     NodeIdToForcedPseudoState m_nodeIdToForcedPseudoState;
162     HashSet&lt;Document*&gt; m_documentsWithForcedPseudoStates;
163 
164     int m_lastStyleSheetId { 1 };
165     bool m_creatingViaInspectorStyleSheet { false };
166 };
167 
</pre>
</td>
<td>
<hr />
<pre>
 33 #include &lt;JavaScriptCore/InspectorBackendDispatchers.h&gt;
 34 #include &lt;wtf/HashMap.h&gt;
 35 #include &lt;wtf/HashSet.h&gt;
 36 #include &lt;wtf/JSONValues.h&gt;
 37 #include &lt;wtf/RefPtr.h&gt;
 38 #include &lt;wtf/text/WTFString.h&gt;
 39 
 40 namespace Inspector {
 41 class CSSFrontendDispatcher;
 42 }
 43 
 44 namespace WebCore {
 45 
 46 class CSSRule;
 47 class CSSStyleRule;
 48 class CSSStyleSheet;
 49 class Document;
 50 class Element;
 51 class Node;
 52 class NodeList;

 53 class StyleRule;
 54 
<span class="line-added"> 55 namespace Style {</span>
<span class="line-added"> 56 class Resolver;</span>
<span class="line-added"> 57 }</span>
<span class="line-added"> 58 </span>
 59 class InspectorCSSAgent final : public InspectorAgentBase , public Inspector::CSSBackendDispatcherHandler , public InspectorStyleSheet::Listener {
 60     WTF_MAKE_NONCOPYABLE(InspectorCSSAgent);
 61     WTF_MAKE_FAST_ALLOCATED;
 62 public:
 63     InspectorCSSAgent(WebAgentContext&amp;);
<span class="line-modified"> 64     ~InspectorCSSAgent() override;</span>
 65 
 66     class InlineStyleOverrideScope {
 67     public:
 68         InlineStyleOverrideScope(SecurityContext&amp; context)
 69             : m_contentSecurityPolicy(context.contentSecurityPolicy())
 70         {
 71             m_contentSecurityPolicy-&gt;setOverrideAllowInlineStyle(true);
 72         }
 73 
 74         ~InlineStyleOverrideScope()
 75         {
 76             m_contentSecurityPolicy-&gt;setOverrideAllowInlineStyle(false);
 77         }
 78 
 79     private:
 80         ContentSecurityPolicy* m_contentSecurityPolicy;
 81     };
 82 
 83     static CSSStyleRule* asCSSStyleRule(CSSRule&amp;);
 84 
 85     // InspectorAgentBase
<span class="line-modified"> 86     void didCreateFrontendAndBackend(Inspector::FrontendRouter*, Inspector::BackendDispatcher*) override;</span>
<span class="line-modified"> 87     void willDestroyFrontendAndBackend(Inspector::DisconnectReason) override;</span>
 88 
 89     // CSSBackendDispatcherHandler
<span class="line-modified"> 90     void enable(ErrorString&amp;) override;</span>
<span class="line-modified"> 91     void disable(ErrorString&amp;) override;</span>
<span class="line-modified"> 92     void getComputedStyleForNode(ErrorString&amp;, int nodeId, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::CSSComputedStyleProperty&gt;&gt;&amp;) override;</span>
<span class="line-modified"> 93     void getInlineStylesForNode(ErrorString&amp;, int nodeId, RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt;&amp; inlineStyle, RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt;&amp; attributes) override;</span>
<span class="line-modified"> 94     void getMatchedStylesForNode(ErrorString&amp;, int nodeId, const bool* includePseudo, const bool* includeInherited, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::RuleMatch&gt;&gt;&amp; matchedCSSRules, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::PseudoIdMatches&gt;&gt;&amp;, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::InheritedStyleEntry&gt;&gt;&amp; inheritedEntries) override;</span>
<span class="line-modified"> 95     void getAllStyleSheets(ErrorString&amp;, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::CSSStyleSheetHeader&gt;&gt;&amp; styleSheetInfos) override;</span>
<span class="line-modified"> 96     void getStyleSheet(ErrorString&amp;, const String&amp; styleSheetId, RefPtr&lt;Inspector::Protocol::CSS::CSSStyleSheetBody&gt;&amp; result) override;</span>
<span class="line-modified"> 97     void getStyleSheetText(ErrorString&amp;, const String&amp; styleSheetId, String* result) override;</span>
<span class="line-modified"> 98     void setStyleSheetText(ErrorString&amp;, const String&amp; styleSheetId, const String&amp; text) override;</span>
<span class="line-modified"> 99     void setStyleText(ErrorString&amp;, const JSON::Object&amp; styleId, const String&amp; text, RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt;&amp; result) override;</span>
<span class="line-modified">100     void setRuleSelector(ErrorString&amp;, const JSON::Object&amp; ruleId, const String&amp; selector, RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt;&amp; result) override;</span>
<span class="line-modified">101     void createStyleSheet(ErrorString&amp;, const String&amp; frameId, String* styleSheetId) override;</span>
<span class="line-modified">102     void addRule(ErrorString&amp;, const String&amp; styleSheetId, const String&amp; selector, RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt;&amp; result) override;</span>
<span class="line-modified">103     void getSupportedCSSProperties(ErrorString&amp;, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::CSSPropertyInfo&gt;&gt;&amp; result) override;</span>
<span class="line-modified">104     void getSupportedSystemFontFamilyNames(ErrorString&amp;, RefPtr&lt;JSON::ArrayOf&lt;String&gt;&gt;&amp; result) override;</span>
<span class="line-modified">105     void forcePseudoState(ErrorString&amp;, int nodeId, const JSON::Array&amp; forcedPseudoClasses) override;</span>
106 
107     // InspectorStyleSheet::Listener
<span class="line-modified">108     void styleSheetChanged(InspectorStyleSheet*) override;</span>
109 
110     // InspectorInstrumentation
111     void documentDetached(Document&amp;);
112     void mediaQueryResultChanged();
113     void activeStyleSheetsUpdated(Document&amp;);
114     bool forcePseudoState(const Element&amp;, CSSSelector::PseudoClassType);
115 
116     // InspectorDOMAgent hooks
117     void didRemoveDOMNode(Node&amp;, int nodeId);
118     void didModifyDOMAttr(Element&amp;);
119 
120     void reset();
121 
122 private:
123     class StyleSheetAction;
124     class SetStyleSheetTextAction;
125     class SetStyleTextAction;
126     class SetRuleSelectorAction;
127     class AddRuleAction;
128 
129     typedef HashMap&lt;String, RefPtr&lt;InspectorStyleSheet&gt;&gt; IdToInspectorStyleSheet;
130     typedef HashMap&lt;CSSStyleSheet*, RefPtr&lt;InspectorStyleSheet&gt;&gt; CSSStyleSheetToInspectorStyleSheet;
131     typedef HashMap&lt;RefPtr&lt;Document&gt;, Vector&lt;RefPtr&lt;InspectorStyleSheet&gt;&gt;&gt; DocumentToViaInspectorStyleSheet; // &quot;via inspector&quot; stylesheets
132     typedef HashMap&lt;int, unsigned&gt; NodeIdToForcedPseudoState;
133 
134     InspectorStyleSheetForInlineStyle&amp; asInspectorStyleSheet(StyledElement&amp;);
135     Element* elementForId(ErrorString&amp;, int nodeId);
136 
137     void collectAllStyleSheets(Vector&lt;InspectorStyleSheet*&gt;&amp;);
138     void collectAllDocumentStyleSheets(Document&amp;, Vector&lt;CSSStyleSheet*&gt;&amp;);
139     void collectStyleSheets(CSSStyleSheet*, Vector&lt;CSSStyleSheet*&gt;&amp;);
140     void setActiveStyleSheetsForDocument(Document&amp;, Vector&lt;CSSStyleSheet*&gt;&amp; activeStyleSheets);
141 
142     String unbindStyleSheet(InspectorStyleSheet*);
143     InspectorStyleSheet* bindStyleSheet(CSSStyleSheet*);
144     InspectorStyleSheet* assertStyleSheetForId(ErrorString&amp;, const String&amp;);
145     InspectorStyleSheet* createInspectorStyleSheetForDocument(Document&amp;);
146     Inspector::Protocol::CSS::StyleSheetOrigin detectOrigin(CSSStyleSheet* pageStyleSheet, Document* ownerDocument);
147 
<span class="line-modified">148     RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt; buildObjectForRule(const StyleRule*, Style::Resolver&amp;, Element&amp;);</span>
149     RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt; buildObjectForRule(CSSStyleRule*);
<span class="line-modified">150     RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::RuleMatch&gt;&gt; buildArrayForMatchedRuleList(const Vector&lt;RefPtr&lt;const StyleRule&gt;&gt;&amp;, Style::Resolver&amp;, Element&amp;, PseudoId);</span>
151     RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt; buildObjectForAttributesStyle(StyledElement&amp;);
152 
153 
154     void resetPseudoStates();
155 
156     std::unique_ptr&lt;Inspector::CSSFrontendDispatcher&gt; m_frontendDispatcher;
157     RefPtr&lt;Inspector::CSSBackendDispatcher&gt; m_backendDispatcher;
158 
159     IdToInspectorStyleSheet m_idToInspectorStyleSheet;
160     CSSStyleSheetToInspectorStyleSheet m_cssStyleSheetToInspectorStyleSheet;
161     HashMap&lt;Node*, Ref&lt;InspectorStyleSheetForInlineStyle&gt;&gt; m_nodeToInspectorStyleSheet; // bogus &quot;stylesheets&quot; with elements&#39; inline styles
162     DocumentToViaInspectorStyleSheet m_documentToInspectorStyleSheet;
163     HashMap&lt;Document*, HashSet&lt;CSSStyleSheet*&gt;&gt; m_documentToKnownCSSStyleSheets;
164     NodeIdToForcedPseudoState m_nodeIdToForcedPseudoState;
165     HashSet&lt;Document*&gt; m_documentsWithForcedPseudoStates;
166 
167     int m_lastStyleSheetId { 1 };
168     bool m_creatingViaInspectorStyleSheet { false };
169 };
170 
</pre>
</td>
</tr>
</table>
<center><a href="InspectorCSSAgent.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="InspectorCanvasAgent.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>