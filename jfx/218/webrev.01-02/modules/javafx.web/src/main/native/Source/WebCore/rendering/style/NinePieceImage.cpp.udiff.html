<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/rendering/style/NinePieceImage.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="GridArea.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="NinePieceImage.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/rendering/style/NinePieceImage.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -38,16 +38,26 @@</span>
  {
      static NeverDestroyed&lt;DataRef&lt;Data&gt;&gt; data { Data::create() };
      return data.get();
  }
  
<span class="udiff-line-modified-removed">- NinePieceImage::NinePieceImage()</span>
<span class="udiff-line-removed">-     : m_data(defaultData())</span>
<span class="udiff-line-modified-added">+ inline DataRef&lt;NinePieceImage::Data&gt;&amp; NinePieceImage::defaultMaskData()</span>
  {
<span class="udiff-line-added">+     static NeverDestroyed&lt;DataRef&lt;Data&gt;&gt; maskData { Data::create() };</span>
<span class="udiff-line-added">+     auto&amp; data = maskData.get().access();</span>
<span class="udiff-line-added">+     data.imageSlices = LengthBox(0);</span>
<span class="udiff-line-added">+     data.fill = true;</span>
<span class="udiff-line-added">+     data.borderSlices = LengthBox();</span>
<span class="udiff-line-added">+     return maskData.get();</span>
  }
  
<span class="udiff-line-modified-removed">- NinePieceImage::NinePieceImage(RefPtr&lt;StyleImage&gt;&amp;&amp; image, LengthBox imageSlices, bool fill, LengthBox borderSlices, LengthBox outset, ENinePieceImageRule horizontalRule, ENinePieceImageRule verticalRule)</span>
<span class="udiff-line-modified-added">+ NinePieceImage::NinePieceImage(Type imageType)</span>
<span class="udiff-line-added">+     : m_data(imageType == Type::Normal ? defaultData() : defaultMaskData())</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ NinePieceImage::NinePieceImage(RefPtr&lt;StyleImage&gt;&amp;&amp; image, LengthBox imageSlices, bool fill, LengthBox borderSlices, LengthBox outset, NinePieceImageRule horizontalRule, NinePieceImageRule verticalRule)</span>
      : m_data(Data::create(WTFMove(image), imageSlices, fill, borderSlices, outset, horizontalRule, verticalRule))
  {
  }
  
  LayoutUnit NinePieceImage::computeSlice(Length length, LayoutUnit width, LayoutUnit slice, LayoutUnit extent)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -148,36 +158,36 @@</span>
          scale = destinationRects[piece].width() / sourceRects[piece].width();
  
      return FloatSize(scale, scale);
  }
  
<span class="udiff-line-modified-removed">- FloatSize NinePieceImage::computeMiddleTileScale(const Vector&lt;FloatSize&gt;&amp; scales, const Vector&lt;FloatRect&gt;&amp; destinationRects, const Vector&lt;FloatRect&gt;&amp; sourceRects, ENinePieceImageRule hRule, ENinePieceImageRule vRule)</span>
<span class="udiff-line-modified-added">+ FloatSize NinePieceImage::computeMiddleTileScale(const Vector&lt;FloatSize&gt;&amp; scales, const Vector&lt;FloatRect&gt;&amp; destinationRects, const Vector&lt;FloatRect&gt;&amp; sourceRects, NinePieceImageRule hRule, NinePieceImageRule vRule)</span>
  {
      FloatSize scale(1, 1);
      if (isEmptyPieceRect(MiddlePiece, destinationRects, sourceRects))
          return scale;
  
      // Unlike the side pieces, the middle piece can have &quot;stretch&quot; specified in one axis but not the other.
      // In fact the side pieces don&#39;t even use the scale factor unless they have a rule other than &quot;stretch&quot;.
<span class="udiff-line-modified-removed">-     if (hRule == StretchImageRule)</span>
<span class="udiff-line-modified-added">+     if (hRule == NinePieceImageRule::Stretch)</span>
          scale.setWidth(destinationRects[MiddlePiece].width() / sourceRects[MiddlePiece].width());
      else if (!isEmptyPieceRect(TopPiece, destinationRects, sourceRects))
          scale.setWidth(scales[TopPiece].width());
      else if (!isEmptyPieceRect(BottomPiece, destinationRects, sourceRects))
          scale.setWidth(scales[BottomPiece].width());
  
<span class="udiff-line-modified-removed">-     if (vRule == StretchImageRule)</span>
<span class="udiff-line-modified-added">+     if (vRule == NinePieceImageRule::Stretch)</span>
          scale.setHeight(destinationRects[MiddlePiece].height() / sourceRects[MiddlePiece].height());
      else if (!isEmptyPieceRect(LeftPiece, destinationRects, sourceRects))
          scale.setHeight(scales[LeftPiece].height());
      else if (!isEmptyPieceRect(RightPiece, destinationRects, sourceRects))
          scale.setHeight(scales[RightPiece].height());
  
      return scale;
  }
  
<span class="udiff-line-modified-removed">- Vector&lt;FloatSize&gt; NinePieceImage::computeTileScales(const Vector&lt;FloatRect&gt;&amp; destinationRects, const Vector&lt;FloatRect&gt;&amp; sourceRects, ENinePieceImageRule hRule, ENinePieceImageRule vRule)</span>
<span class="udiff-line-modified-added">+ Vector&lt;FloatSize&gt; NinePieceImage::computeTileScales(const Vector&lt;FloatRect&gt;&amp; destinationRects, const Vector&lt;FloatRect&gt;&amp; sourceRects, NinePieceImageRule hRule, NinePieceImageRule vRule)</span>
  {
      Vector&lt;FloatSize&gt; scales(MaxPiece, FloatSize(1, 1));
  
      scales[TopPiece]    = computeSideTileScale(TopPiece,    destinationRects, sourceRects);
      scales[RightPiece]  = computeSideTileScale(RightPiece,  destinationRects, sourceRects);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -211,28 +221,23 @@</span>
      for (ImagePiece piece = MinPiece; piece &lt; MaxPiece; ++piece) {
          if ((piece == MiddlePiece &amp;&amp; !fill()) || isEmptyPieceRect(piece, destinationRects, sourceRects))
              continue;
  
          if (isCornerPiece(piece)) {
<span class="udiff-line-modified-removed">-             graphicsContext.drawImage(*image, destinationRects[piece], sourceRects[piece], op);</span>
<span class="udiff-line-modified-added">+             graphicsContext.drawImage(*image, destinationRects[piece], sourceRects[piece], { op, ImageOrientation::FromImage });</span>
              continue;
          }
  
          Image::TileRule hRule = isHorizontalPiece(piece) ? static_cast&lt;Image::TileRule&gt;(horizontalRule()) : Image::StretchTile;
          Image::TileRule vRule = isVerticalPiece(piece) ? static_cast&lt;Image::TileRule&gt;(verticalRule()) : Image::StretchTile;
<span class="udiff-line-modified-removed">-         graphicsContext.drawTiledImage(*image, destinationRects[piece], sourceRects[piece], tileScales[piece], hRule, vRule, op);</span>
<span class="udiff-line-modified-added">+         graphicsContext.drawTiledImage(*image, destinationRects[piece], sourceRects[piece], tileScales[piece], hRule, vRule, { op, ImageOrientation::FromImage });</span>
      }
  }
  
<span class="udiff-line-modified-removed">- inline NinePieceImage::Data::Data()</span>
<span class="udiff-line-removed">-     : fill(false)</span>
<span class="udiff-line-removed">-     , horizontalRule(StretchImageRule)</span>
<span class="udiff-line-removed">-     , verticalRule(StretchImageRule)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-modified-added">+ inline NinePieceImage::Data::Data() = default;</span>
  
<span class="udiff-line-modified-removed">- inline NinePieceImage::Data::Data(RefPtr&lt;StyleImage&gt;&amp;&amp; image, LengthBox imageSlices, bool fill, LengthBox borderSlices, LengthBox outset, ENinePieceImageRule horizontalRule, ENinePieceImageRule verticalRule)</span>
<span class="udiff-line-modified-added">+ inline NinePieceImage::Data::Data(RefPtr&lt;StyleImage&gt;&amp;&amp; image, LengthBox imageSlices, bool fill, LengthBox borderSlices, LengthBox outset, NinePieceImageRule horizontalRule, NinePieceImageRule verticalRule)</span>
      : fill(fill)
      , horizontalRule(horizontalRule)
      , verticalRule(verticalRule)
      , image(WTFMove(image))
      , imageSlices(imageSlices)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -256,11 +261,11 @@</span>
  inline Ref&lt;NinePieceImage::Data&gt; NinePieceImage::Data::create()
  {
      return adoptRef(*new Data);
  }
  
<span class="udiff-line-modified-removed">- inline Ref&lt;NinePieceImage::Data&gt; NinePieceImage::Data::create(RefPtr&lt;StyleImage&gt;&amp;&amp; image, LengthBox imageSlices, bool fill, LengthBox borderSlices, LengthBox outset, ENinePieceImageRule horizontalRule, ENinePieceImageRule verticalRule)</span>
<span class="udiff-line-modified-added">+ inline Ref&lt;NinePieceImage::Data&gt; NinePieceImage::Data::create(RefPtr&lt;StyleImage&gt;&amp;&amp; image, LengthBox imageSlices, bool fill, LengthBox borderSlices, LengthBox outset, NinePieceImageRule horizontalRule, NinePieceImageRule verticalRule)</span>
  {
      return adoptRef(*new Data(WTFMove(image), imageSlices, fill, borderSlices, outset, horizontalRule, verticalRule));
  }
  
  Ref&lt;NinePieceImage::Data&gt; NinePieceImage::Data::copy() const
</pre>
<center><a href="GridArea.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="NinePieceImage.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>