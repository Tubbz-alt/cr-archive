<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/inspector/agents/InspectorCSSAgent.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2010 Google Inc. All rights reserved.
  3  * Copyright (C) 2015-2016 Apple Inc. All rights reserved.
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  * 1.  Redistributions of source code must retain the above copyright
  9  *     notice, this list of conditions and the following disclaimer.
 10  * 2.  Redistributions in binary form must reproduce the above copyright
 11  *     notice, this list of conditions and the following disclaimer in the
 12  *     documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39; AND ANY
 15  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 16  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 17  * DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 18  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 19  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 20  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 21  * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 23  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;CSSSelector.h&quot;
 29 #include &quot;ContentSecurityPolicy.h&quot;
 30 #include &quot;InspectorStyleSheet.h&quot;
 31 #include &quot;InspectorWebAgentBase.h&quot;
 32 #include &quot;SecurityContext.h&quot;
 33 #include &lt;JavaScriptCore/InspectorBackendDispatchers.h&gt;
 34 #include &lt;wtf/HashMap.h&gt;
 35 #include &lt;wtf/HashSet.h&gt;
 36 #include &lt;wtf/JSONValues.h&gt;
 37 #include &lt;wtf/RefPtr.h&gt;
 38 #include &lt;wtf/text/WTFString.h&gt;
 39 
 40 namespace Inspector {
 41 class CSSFrontendDispatcher;
 42 }
 43 
 44 namespace WebCore {
 45 
 46 class CSSRule;
 47 class CSSStyleRule;
 48 class CSSStyleSheet;
 49 class Document;
 50 class Element;
 51 class Node;
 52 class NodeList;
<a name="1" id="anc1"></a>
 53 class StyleRule;
 54 
<a name="2" id="anc2"></a><span class="line-added"> 55 namespace Style {</span>
<span class="line-added"> 56 class Resolver;</span>
<span class="line-added"> 57 }</span>
<span class="line-added"> 58 </span>
 59 class InspectorCSSAgent final : public InspectorAgentBase , public Inspector::CSSBackendDispatcherHandler , public InspectorStyleSheet::Listener {
 60     WTF_MAKE_NONCOPYABLE(InspectorCSSAgent);
 61     WTF_MAKE_FAST_ALLOCATED;
 62 public:
 63     InspectorCSSAgent(WebAgentContext&amp;);
<a name="3" id="anc3"></a><span class="line-modified"> 64     ~InspectorCSSAgent() override;</span>
 65 
 66     class InlineStyleOverrideScope {
 67     public:
 68         InlineStyleOverrideScope(SecurityContext&amp; context)
 69             : m_contentSecurityPolicy(context.contentSecurityPolicy())
 70         {
 71             m_contentSecurityPolicy-&gt;setOverrideAllowInlineStyle(true);
 72         }
 73 
 74         ~InlineStyleOverrideScope()
 75         {
 76             m_contentSecurityPolicy-&gt;setOverrideAllowInlineStyle(false);
 77         }
 78 
 79     private:
 80         ContentSecurityPolicy* m_contentSecurityPolicy;
 81     };
 82 
 83     static CSSStyleRule* asCSSStyleRule(CSSRule&amp;);
 84 
 85     // InspectorAgentBase
<a name="4" id="anc4"></a><span class="line-modified"> 86     void didCreateFrontendAndBackend(Inspector::FrontendRouter*, Inspector::BackendDispatcher*) override;</span>
<span class="line-modified"> 87     void willDestroyFrontendAndBackend(Inspector::DisconnectReason) override;</span>
 88 
 89     // CSSBackendDispatcherHandler
<a name="5" id="anc5"></a><span class="line-modified"> 90     void enable(ErrorString&amp;) override;</span>
<span class="line-modified"> 91     void disable(ErrorString&amp;) override;</span>
<span class="line-modified"> 92     void getComputedStyleForNode(ErrorString&amp;, int nodeId, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::CSSComputedStyleProperty&gt;&gt;&amp;) override;</span>
<span class="line-modified"> 93     void getInlineStylesForNode(ErrorString&amp;, int nodeId, RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt;&amp; inlineStyle, RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt;&amp; attributes) override;</span>
<span class="line-modified"> 94     void getMatchedStylesForNode(ErrorString&amp;, int nodeId, const bool* includePseudo, const bool* includeInherited, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::RuleMatch&gt;&gt;&amp; matchedCSSRules, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::PseudoIdMatches&gt;&gt;&amp;, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::InheritedStyleEntry&gt;&gt;&amp; inheritedEntries) override;</span>
<span class="line-modified"> 95     void getAllStyleSheets(ErrorString&amp;, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::CSSStyleSheetHeader&gt;&gt;&amp; styleSheetInfos) override;</span>
<span class="line-modified"> 96     void getStyleSheet(ErrorString&amp;, const String&amp; styleSheetId, RefPtr&lt;Inspector::Protocol::CSS::CSSStyleSheetBody&gt;&amp; result) override;</span>
<span class="line-modified"> 97     void getStyleSheetText(ErrorString&amp;, const String&amp; styleSheetId, String* result) override;</span>
<span class="line-modified"> 98     void setStyleSheetText(ErrorString&amp;, const String&amp; styleSheetId, const String&amp; text) override;</span>
<span class="line-modified"> 99     void setStyleText(ErrorString&amp;, const JSON::Object&amp; styleId, const String&amp; text, RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt;&amp; result) override;</span>
<span class="line-modified">100     void setRuleSelector(ErrorString&amp;, const JSON::Object&amp; ruleId, const String&amp; selector, RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt;&amp; result) override;</span>
<span class="line-modified">101     void createStyleSheet(ErrorString&amp;, const String&amp; frameId, String* styleSheetId) override;</span>
<span class="line-modified">102     void addRule(ErrorString&amp;, const String&amp; styleSheetId, const String&amp; selector, RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt;&amp; result) override;</span>
<span class="line-modified">103     void getSupportedCSSProperties(ErrorString&amp;, RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::CSSPropertyInfo&gt;&gt;&amp; result) override;</span>
<span class="line-modified">104     void getSupportedSystemFontFamilyNames(ErrorString&amp;, RefPtr&lt;JSON::ArrayOf&lt;String&gt;&gt;&amp; result) override;</span>
<span class="line-modified">105     void forcePseudoState(ErrorString&amp;, int nodeId, const JSON::Array&amp; forcedPseudoClasses) override;</span>
106 
107     // InspectorStyleSheet::Listener
<a name="6" id="anc6"></a><span class="line-modified">108     void styleSheetChanged(InspectorStyleSheet*) override;</span>
109 
110     // InspectorInstrumentation
111     void documentDetached(Document&amp;);
112     void mediaQueryResultChanged();
113     void activeStyleSheetsUpdated(Document&amp;);
114     bool forcePseudoState(const Element&amp;, CSSSelector::PseudoClassType);
115 
116     // InspectorDOMAgent hooks
117     void didRemoveDOMNode(Node&amp;, int nodeId);
118     void didModifyDOMAttr(Element&amp;);
119 
120     void reset();
121 
122 private:
123     class StyleSheetAction;
124     class SetStyleSheetTextAction;
125     class SetStyleTextAction;
126     class SetRuleSelectorAction;
127     class AddRuleAction;
128 
129     typedef HashMap&lt;String, RefPtr&lt;InspectorStyleSheet&gt;&gt; IdToInspectorStyleSheet;
130     typedef HashMap&lt;CSSStyleSheet*, RefPtr&lt;InspectorStyleSheet&gt;&gt; CSSStyleSheetToInspectorStyleSheet;
131     typedef HashMap&lt;RefPtr&lt;Document&gt;, Vector&lt;RefPtr&lt;InspectorStyleSheet&gt;&gt;&gt; DocumentToViaInspectorStyleSheet; // &quot;via inspector&quot; stylesheets
132     typedef HashMap&lt;int, unsigned&gt; NodeIdToForcedPseudoState;
133 
134     InspectorStyleSheetForInlineStyle&amp; asInspectorStyleSheet(StyledElement&amp;);
135     Element* elementForId(ErrorString&amp;, int nodeId);
136 
137     void collectAllStyleSheets(Vector&lt;InspectorStyleSheet*&gt;&amp;);
138     void collectAllDocumentStyleSheets(Document&amp;, Vector&lt;CSSStyleSheet*&gt;&amp;);
139     void collectStyleSheets(CSSStyleSheet*, Vector&lt;CSSStyleSheet*&gt;&amp;);
140     void setActiveStyleSheetsForDocument(Document&amp;, Vector&lt;CSSStyleSheet*&gt;&amp; activeStyleSheets);
141 
142     String unbindStyleSheet(InspectorStyleSheet*);
143     InspectorStyleSheet* bindStyleSheet(CSSStyleSheet*);
144     InspectorStyleSheet* assertStyleSheetForId(ErrorString&amp;, const String&amp;);
145     InspectorStyleSheet* createInspectorStyleSheetForDocument(Document&amp;);
146     Inspector::Protocol::CSS::StyleSheetOrigin detectOrigin(CSSStyleSheet* pageStyleSheet, Document* ownerDocument);
147 
<a name="7" id="anc7"></a><span class="line-modified">148     RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt; buildObjectForRule(const StyleRule*, Style::Resolver&amp;, Element&amp;);</span>
149     RefPtr&lt;Inspector::Protocol::CSS::CSSRule&gt; buildObjectForRule(CSSStyleRule*);
<a name="8" id="anc8"></a><span class="line-modified">150     RefPtr&lt;JSON::ArrayOf&lt;Inspector::Protocol::CSS::RuleMatch&gt;&gt; buildArrayForMatchedRuleList(const Vector&lt;RefPtr&lt;const StyleRule&gt;&gt;&amp;, Style::Resolver&amp;, Element&amp;, PseudoId);</span>
151     RefPtr&lt;Inspector::Protocol::CSS::CSSStyle&gt; buildObjectForAttributesStyle(StyledElement&amp;);
152 
153 
154     void resetPseudoStates();
155 
156     std::unique_ptr&lt;Inspector::CSSFrontendDispatcher&gt; m_frontendDispatcher;
157     RefPtr&lt;Inspector::CSSBackendDispatcher&gt; m_backendDispatcher;
158 
159     IdToInspectorStyleSheet m_idToInspectorStyleSheet;
160     CSSStyleSheetToInspectorStyleSheet m_cssStyleSheetToInspectorStyleSheet;
161     HashMap&lt;Node*, Ref&lt;InspectorStyleSheetForInlineStyle&gt;&gt; m_nodeToInspectorStyleSheet; // bogus &quot;stylesheets&quot; with elements&#39; inline styles
162     DocumentToViaInspectorStyleSheet m_documentToInspectorStyleSheet;
163     HashMap&lt;Document*, HashSet&lt;CSSStyleSheet*&gt;&gt; m_documentToKnownCSSStyleSheets;
164     NodeIdToForcedPseudoState m_nodeIdToForcedPseudoState;
165     HashSet&lt;Document*&gt; m_documentsWithForcedPseudoStates;
166 
167     int m_lastStyleSheetId { 1 };
168     bool m_creatingViaInspectorStyleSheet { false };
169 };
170 
171 } // namespace WebCore
<a name="9" id="anc9"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="9" type="hidden" />
</body>
</html>