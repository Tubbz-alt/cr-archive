<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/offlineasm/mips.rb</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="instructions.rb.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="parser.rb.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/offlineasm/mips.rb</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -41,10 +41,12 @@</span>
  # $t6 =&gt;         t6
  # $t7 =&gt;            (scratch)
  # $t8 =&gt;            (scratch)
  # $t9 =&gt;            (stores the callee of a call opcode)
  # $gp =&gt;            (globals)
<span class="udiff-line-added">+ # $s0 =&gt; csr0       (callee-save, metadataTable)</span>
<span class="udiff-line-added">+ # $s1 =&gt; csr1       (callee-save, PB)</span>
  # $s4 =&gt;            (callee-save used to preserve $gp across calls)
  # $ra =&gt; lr
  # $sp =&gt; sp
  # $fp =&gt; cfr
  #
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -97,10 +99,11 @@</span>
  MIPS_TEMP_GPRS = [SpecialRegister.new(&quot;$t0&quot;), SpecialRegister.new(&quot;$t1&quot;), SpecialRegister.new(&quot;$t7&quot;), SpecialRegister.new(&quot;$t8&quot;)]
  MIPS_ZERO_REG = SpecialRegister.new(&quot;$zero&quot;)
  MIPS_GP_REG = SpecialRegister.new(&quot;$gp&quot;)
  MIPS_GPSAVE_REG = SpecialRegister.new(&quot;$s4&quot;)
  MIPS_CALL_REG = SpecialRegister.new(&quot;$t9&quot;)
<span class="udiff-line-added">+ MIPS_RETURN_ADDRESS_REG = SpecialRegister.new(&quot;$ra&quot;)</span>
  MIPS_TEMP_FPRS = [SpecialRegister.new(&quot;$f16&quot;)]
  MIPS_SCRATCH_FPR = SpecialRegister.new(&quot;$f18&quot;)
  
  def mipsMoveImmediate(value, register)
      if value == 0
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -135,10 +138,12 @@</span>
              &quot;$t5&quot;
          when &quot;cfr&quot;
              &quot;$fp&quot;
          when &quot;csr0&quot;
              &quot;$s0&quot;
<span class="udiff-line-added">+         when &quot;csr1&quot;</span>
<span class="udiff-line-added">+             &quot;$s1&quot;</span>
          when &quot;lr&quot;
              &quot;$ra&quot;
          when &quot;sp&quot;
              &quot;$sp&quot;
          else
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -525,11 +530,11 @@</span>
                  else
                      newList &lt;&lt; node
                  end
              when /^(addi|subi)/
                  newList &lt;&lt; node.riscLowerMalformedImmediatesRecurse(newList, -0x7fff..0x7fff)
<span class="udiff-line-modified-removed">-             when &quot;andi&quot;, &quot;andp&quot;, &quot;ori&quot;, &quot;orp&quot;, &quot;xori&quot;, &quot;xorp&quot;</span>
<span class="udiff-line-modified-added">+             when &quot;andi&quot;, &quot;andp&quot;, &quot;ori&quot;, &quot;orp&quot;, &quot;orh&quot;, &quot;xori&quot;, &quot;xorp&quot;</span>
                  newList &lt;&lt; node.riscLowerMalformedImmediatesRecurse(newList, 0..0xffff)
              else
                  newList &lt;&lt; node
              end
          else
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -678,11 +683,21 @@</span>
      myList = []
      list.each {
          | node |
          myList &lt;&lt; node
          if node.is_a? Label
<span class="udiff-line-modified-removed">-             myList &lt;&lt; Instruction.new(node.codeOrigin, &quot;pichdr&quot;, [])</span>
<span class="udiff-line-modified-added">+             # FIXME: [JSC] checkpoint_osr_exit_from_inlined_call_trampoline is a return location</span>
<span class="udiff-line-added">+             # and we should name it properly.</span>
<span class="udiff-line-added">+             # https://bugs.webkit.org/show_bug.cgi?id=208236</span>
<span class="udiff-line-added">+             if node.name =~ /^.*_return_location(?:_(?:wide16|wide32))?$/ or node.name.start_with?(&quot;_checkpoint_osr_exit_from_inlined_call_trampoline&quot;)</span>
<span class="udiff-line-added">+                 # We need to have a special case for return location labels because they are always</span>
<span class="udiff-line-added">+                 # reached from a `ret` instruction. In this case, we need to proper reconfigure `$gp`</span>
<span class="udiff-line-added">+                 # using `$ra` instead of using `$t9`.</span>
<span class="udiff-line-added">+                 myList &lt;&lt; Instruction.new(node.codeOrigin, &quot;pichdr&quot;, [MIPS_RETURN_ADDRESS_REG])</span>
<span class="udiff-line-added">+             else</span>
<span class="udiff-line-added">+                 myList &lt;&lt; Instruction.new(node.codeOrigin, &quot;pichdr&quot;, [MIPS_CALL_REG])</span>
<span class="udiff-line-added">+             end</span>
          end
      }
      myList
  end
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -721,11 +736,11 @@</span>
              end
          }
          result = riscLowerMalformedAddressesDouble(result)
          result = riscLowerMisplacedImmediates(result, [&quot;storeb&quot;, &quot;storei&quot;, &quot;storep&quot;])
          result = mipsLowerMisplacedImmediates(result)
<span class="udiff-line-modified-removed">-         result = riscLowerMalformedImmediates(result, -0x7fff..0x7fff)</span>
<span class="udiff-line-modified-added">+         result = riscLowerMalformedImmediates(result, -0x7fff..0x7fff, -0x7fff..0x7fff)</span>
          result = mipsLowerMisplacedAddresses(result)
          result = riscLowerMisplacedAddresses(result)
          result = riscLowerRegisterReuse(result)
          result = mipsLowerCompares(result)
          result = assignRegistersToTemporaries(result, :gpr, MIPS_TEMP_GPRS)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -852,11 +867,11 @@</span>
                      $asm.puts &quot;addu #{operands[1].mipsOperand}, #{operands[1].mipsOperand}, #{operands[0].mipsOperand}&quot;
                  end
              end
          when &quot;andi&quot;, &quot;andp&quot;
              emitMIPSCompact(&quot;and&quot;, &quot;and&quot;, operands)
<span class="udiff-line-modified-removed">-         when &quot;ori&quot;, &quot;orp&quot;</span>
<span class="udiff-line-modified-added">+         when &quot;ori&quot;, &quot;orp&quot;, &quot;orh&quot;</span>
              emitMIPSCompact(&quot;or&quot;, &quot;orr&quot;, operands)
          when &quot;oris&quot;
              emitMIPSCompact(&quot;or&quot;, &quot;orrs&quot;, operands)
          when &quot;xori&quot;, &quot;xorp&quot;
              emitMIPSCompact(&quot;xor&quot;, &quot;eor&quot;, operands)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -904,11 +919,11 @@</span>
              emitMIPS(&quot;sub.d&quot;, operands)
          when &quot;muld&quot;
              emitMIPS(&quot;mul.d&quot;, operands)
          when &quot;sqrtd&quot;
              $asm.puts &quot;sqrt.d #{mipsFlippedOperands(operands)}&quot;
<span class="udiff-line-modified-removed">-         when &quot;ci2d&quot;</span>
<span class="udiff-line-modified-added">+         when &quot;ci2ds&quot;</span>
              raise &quot;invalid ops of #{self.inspect} at #{codeOriginString}&quot; unless operands[1].is_a? FPRegisterID and operands[0].register?
              $asm.puts &quot;mtc1 #{operands[0].mipsOperand}, #{operands[1].mipsOperand}&quot;
              $asm.puts &quot;cvt.d.w #{operands[1].mipsOperand}, #{operands[1].mipsOperand}&quot;
          when &quot;bdeq&quot;
              emitMIPSDoubleBranch(&quot;eq&quot;, false, operands)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1059,11 +1074,11 @@</span>
          when &quot;slt&quot;, &quot;sltb&quot;
              $asm.puts &quot;slt #{operands[0].mipsOperand}, #{operands[1].mipsOperand}, #{operands[2].mipsOperand}&quot;
          when &quot;sltu&quot;, &quot;sltub&quot;
              $asm.puts &quot;sltu #{operands[0].mipsOperand}, #{operands[1].mipsOperand}, #{operands[2].mipsOperand}&quot;
          when &quot;pichdr&quot;
<span class="udiff-line-modified-removed">-             $asm.putStr(&quot;OFFLINE_ASM_CPLOAD(#{MIPS_CALL_REG.mipsOperand})&quot;)</span>
<span class="udiff-line-modified-added">+             $asm.putStr(&quot;OFFLINE_ASM_CPLOAD(#{operands[0].mipsOperand})&quot;)</span>
          when &quot;memfence&quot;
              $asm.puts &quot;sync&quot;
          else
              lowerDefault
          end
</pre>
<center><a href="instructions.rb.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="parser.rb.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>