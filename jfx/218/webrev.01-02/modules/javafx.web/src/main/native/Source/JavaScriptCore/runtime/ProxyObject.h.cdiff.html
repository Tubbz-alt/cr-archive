<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ProxyObject.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ProxyObject.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ProxyRevoke.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ProxyObject.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 32,18 ***</span>
  
  class ProxyObject final : public JSNonFinalObject {
  public:
      typedef JSNonFinalObject Base;
  
<span class="line-modified">!     const static unsigned StructureFlags = Base::StructureFlags | OverridesGetOwnPropertySlot | OverridesGetCallData | InterceptsGetOwnPropertySlotByIndexEvenWhenLengthIsNotZero | OverridesGetPropertyNames | ProhibitsPropertyCaching;</span>
  
<span class="line-modified">!     static ProxyObject* create(ExecState* exec, JSGlobalObject* globalObject, JSValue target, JSValue handler)</span>
      {
<span class="line-modified">!         VM&amp; vm = exec-&gt;vm();</span>
          Structure* structure = ProxyObject::structureForTarget(globalObject, target);
          ProxyObject* proxy = new (NotNull, allocateCell&lt;ProxyObject&gt;(vm.heap)) ProxyObject(vm, structure);
<span class="line-modified">!         proxy-&gt;finishCreation(vm, exec, target, handler);</span>
          return proxy;
      }
  
      static Structure* createStructure(VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype, bool isCallable)
      {
<span class="line-new-header">--- 32,24 ---</span>
  
  class ProxyObject final : public JSNonFinalObject {
  public:
      typedef JSNonFinalObject Base;
  
<span class="line-modified">!     static constexpr unsigned StructureFlags = Base::StructureFlags | OverridesGetOwnPropertySlot | OverridesGetCallData | InterceptsGetOwnPropertySlotByIndexEvenWhenLengthIsNotZero | OverridesGetPropertyNames | ProhibitsPropertyCaching;</span>
  
<span class="line-modified">!     template&lt;typename CellType, SubspaceAccess mode&gt;</span>
<span class="line-added">+     static IsoSubspace* subspaceFor(VM&amp; vm)</span>
      {
<span class="line-modified">!         return vm.proxyObjectSpace&lt;mode&gt;();</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     static ProxyObject* create(JSGlobalObject* globalObject, JSValue target, JSValue handler)</span>
<span class="line-added">+     {</span>
<span class="line-added">+         VM&amp; vm = getVM(globalObject);</span>
          Structure* structure = ProxyObject::structureForTarget(globalObject, target);
          ProxyObject* proxy = new (NotNull, allocateCell&lt;ProxyObject&gt;(vm.heap)) ProxyObject(vm, structure);
<span class="line-modified">!         proxy-&gt;finishCreation(vm, globalObject, target, handler);</span>
          return proxy;
      }
  
      static Structure* createStructure(VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype, bool isCallable)
      {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 51,63 ***</span>
          if (isCallable)
              flags |= (ImplementsHasInstance | ImplementsDefaultHasInstance);
          Structure* result = Structure::create(vm, globalObject, prototype, TypeInfo(ProxyObjectType, flags), info(), NonArray | MayHaveIndexedAccessors);
          result-&gt;setIsQuickPropertyAccessAllowedForEnumeration(false);
          RELEASE_ASSERT(!result-&gt;canAccessPropertiesQuicklyForEnumeration());
<span class="line-modified">!         RELEASE_ASSERT(!result-&gt;canCachePropertyNameEnumerator());</span>
          return result;
      }
  
      DECLARE_EXPORT_INFO;
  
      JSObject* target() const { return m_target.get(); }
      JSValue handler() const { return m_handler.get(); }
  
<span class="line-modified">!     static bool put(JSCell*, ExecState*, PropertyName, JSValue, PutPropertySlot&amp;);</span>
<span class="line-modified">!     static bool putByIndex(JSCell*, ExecState*, unsigned propertyName, JSValue, bool shouldThrow);</span>
<span class="line-modified">!     bool putByIndexCommon(ExecState*, JSValue thisValue, unsigned propertyName, JSValue putValue, bool shouldThrow);</span>
<span class="line-modified">!     JSValue performGetPrototype(ExecState*);</span>
      void revoke(VM&amp;);
      bool isRevoked() const;
  
  private:
      JS_EXPORT_PRIVATE ProxyObject(VM&amp;, Structure*);
<span class="line-modified">!     JS_EXPORT_PRIVATE void finishCreation(VM&amp;, ExecState*, JSValue target, JSValue handler);</span>
      JS_EXPORT_PRIVATE static Structure* structureForTarget(JSGlobalObject*, JSValue target);
  
<span class="line-modified">!     static String toStringName(const JSObject*, ExecState*);</span>
<span class="line-modified">!     static bool getOwnPropertySlot(JSObject*, ExecState*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">!     static bool getOwnPropertySlotByIndex(JSObject*, ExecState*, unsigned propertyName, PropertySlot&amp;);</span>
      static CallType getCallData(JSCell*, CallData&amp;);
      static ConstructType getConstructData(JSCell*, ConstructData&amp;);
<span class="line-modified">!     static bool deleteProperty(JSCell*, ExecState*, PropertyName);</span>
<span class="line-modified">!     static bool deletePropertyByIndex(JSCell*, ExecState*, unsigned propertyName);</span>
<span class="line-modified">!     static bool preventExtensions(JSObject*, ExecState*);</span>
<span class="line-modified">!     static bool isExtensible(JSObject*, ExecState*);</span>
<span class="line-modified">!     static bool defineOwnProperty(JSObject*, ExecState*, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow);</span>
<span class="line-modified">!     static void getOwnPropertyNames(JSObject*, ExecState*, PropertyNameArray&amp;, EnumerationMode);</span>
<span class="line-modified">!     static void getPropertyNames(JSObject*, ExecState*, PropertyNameArray&amp;, EnumerationMode);</span>
<span class="line-modified">!     static NO_RETURN_DUE_TO_CRASH void getOwnNonIndexPropertyNames(JSObject*, ExecState*, PropertyNameArray&amp;, EnumerationMode);</span>
<span class="line-modified">!     static NO_RETURN_DUE_TO_CRASH void getStructurePropertyNames(JSObject*, ExecState*, PropertyNameArray&amp;, EnumerationMode);</span>
<span class="line-modified">!     static NO_RETURN_DUE_TO_CRASH void getGenericPropertyNames(JSObject*, ExecState*, PropertyNameArray&amp;, EnumerationMode);</span>
<span class="line-modified">!     static bool setPrototype(JSObject*, ExecState*, JSValue prototype, bool shouldThrowIfCantSet);</span>
<span class="line-modified">!     static JSValue getPrototype(JSObject*, ExecState*);</span>
      static void visitChildren(JSCell*, SlotVisitor&amp;);
  
<span class="line-modified">!     bool getOwnPropertySlotCommon(ExecState*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">!     bool performInternalMethodGetOwnProperty(ExecState*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">!     bool performGet(ExecState*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">!     bool performHasProperty(ExecState*, PropertyName, PropertySlot&amp;);</span>
      template &lt;typename DefaultDeleteFunction&gt;
<span class="line-modified">!     bool performDelete(ExecState*, PropertyName, DefaultDeleteFunction);</span>
      template &lt;typename PerformDefaultPutFunction&gt;
<span class="line-modified">!     bool performPut(ExecState*, JSValue putValue, JSValue thisValue, PropertyName, PerformDefaultPutFunction, bool shouldThrow);</span>
<span class="line-modified">!     bool performPreventExtensions(ExecState*);</span>
<span class="line-modified">!     bool performIsExtensible(ExecState*);</span>
<span class="line-modified">!     bool performDefineOwnProperty(ExecState*, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow);</span>
<span class="line-modified">!     void performGetOwnPropertyNames(ExecState*, PropertyNameArray&amp;, EnumerationMode);</span>
<span class="line-modified">!     bool performSetPrototype(ExecState*, JSValue prototype, bool shouldThrowIfCantSet);</span>
  
      WriteBarrier&lt;JSObject&gt; m_target;
      WriteBarrier&lt;Unknown&gt; m_handler;
      bool m_isCallable : 1;
      bool m_isConstructible : 1;
<span class="line-new-header">--- 57,64 ---</span>
          if (isCallable)
              flags |= (ImplementsHasInstance | ImplementsDefaultHasInstance);
          Structure* result = Structure::create(vm, globalObject, prototype, TypeInfo(ProxyObjectType, flags), info(), NonArray | MayHaveIndexedAccessors);
          result-&gt;setIsQuickPropertyAccessAllowedForEnumeration(false);
          RELEASE_ASSERT(!result-&gt;canAccessPropertiesQuicklyForEnumeration());
<span class="line-modified">!         RELEASE_ASSERT(!result-&gt;canCachePropertyNameEnumerator(vm));</span>
          return result;
      }
  
      DECLARE_EXPORT_INFO;
  
      JSObject* target() const { return m_target.get(); }
      JSValue handler() const { return m_handler.get(); }
  
<span class="line-modified">!     static bool put(JSCell*, JSGlobalObject*, PropertyName, JSValue, PutPropertySlot&amp;);</span>
<span class="line-modified">!     static bool putByIndex(JSCell*, JSGlobalObject*, unsigned propertyName, JSValue, bool shouldThrow);</span>
<span class="line-modified">!     bool putByIndexCommon(JSGlobalObject*, JSValue thisValue, unsigned propertyName, JSValue putValue, bool shouldThrow);</span>
<span class="line-modified">!     JSValue performGetPrototype(JSGlobalObject*);</span>
      void revoke(VM&amp;);
      bool isRevoked() const;
  
  private:
      JS_EXPORT_PRIVATE ProxyObject(VM&amp;, Structure*);
<span class="line-modified">!     JS_EXPORT_PRIVATE void finishCreation(VM&amp;, JSGlobalObject*, JSValue target, JSValue handler);</span>
      JS_EXPORT_PRIVATE static Structure* structureForTarget(JSGlobalObject*, JSValue target);
  
<span class="line-modified">!     static String toStringName(const JSObject*, JSGlobalObject*);</span>
<span class="line-modified">!     static bool getOwnPropertySlot(JSObject*, JSGlobalObject*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">!     static bool getOwnPropertySlotByIndex(JSObject*, JSGlobalObject*, unsigned propertyName, PropertySlot&amp;);</span>
      static CallType getCallData(JSCell*, CallData&amp;);
      static ConstructType getConstructData(JSCell*, ConstructData&amp;);
<span class="line-modified">!     static bool deleteProperty(JSCell*, JSGlobalObject*, PropertyName);</span>
<span class="line-modified">!     static bool deletePropertyByIndex(JSCell*, JSGlobalObject*, unsigned propertyName);</span>
<span class="line-modified">!     static bool preventExtensions(JSObject*, JSGlobalObject*);</span>
<span class="line-modified">!     static bool isExtensible(JSObject*, JSGlobalObject*);</span>
<span class="line-modified">!     static bool defineOwnProperty(JSObject*, JSGlobalObject*, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow);</span>
<span class="line-modified">!     static void getOwnPropertyNames(JSObject*, JSGlobalObject*, PropertyNameArray&amp;, EnumerationMode);</span>
<span class="line-modified">!     static void getPropertyNames(JSObject*, JSGlobalObject*, PropertyNameArray&amp;, EnumerationMode);</span>
<span class="line-modified">!     static NO_RETURN_DUE_TO_CRASH void getOwnNonIndexPropertyNames(JSObject*, JSGlobalObject*, PropertyNameArray&amp;, EnumerationMode);</span>
<span class="line-modified">!     static NO_RETURN_DUE_TO_CRASH void getStructurePropertyNames(JSObject*, JSGlobalObject*, PropertyNameArray&amp;, EnumerationMode);</span>
<span class="line-modified">!     static NO_RETURN_DUE_TO_CRASH void getGenericPropertyNames(JSObject*, JSGlobalObject*, PropertyNameArray&amp;, EnumerationMode);</span>
<span class="line-modified">!     static bool setPrototype(JSObject*, JSGlobalObject*, JSValue prototype, bool shouldThrowIfCantSet);</span>
<span class="line-modified">!     static JSValue getPrototype(JSObject*, JSGlobalObject*);</span>
      static void visitChildren(JSCell*, SlotVisitor&amp;);
  
<span class="line-modified">!     bool getOwnPropertySlotCommon(JSGlobalObject*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">!     bool performInternalMethodGetOwnProperty(JSGlobalObject*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">!     bool performGet(JSGlobalObject*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">!     bool performHasProperty(JSGlobalObject*, PropertyName, PropertySlot&amp;);</span>
      template &lt;typename DefaultDeleteFunction&gt;
<span class="line-modified">!     bool performDelete(JSGlobalObject*, PropertyName, DefaultDeleteFunction);</span>
      template &lt;typename PerformDefaultPutFunction&gt;
<span class="line-modified">!     bool performPut(JSGlobalObject*, JSValue putValue, JSValue thisValue, PropertyName, PerformDefaultPutFunction, bool shouldThrow);</span>
<span class="line-modified">!     bool performPreventExtensions(JSGlobalObject*);</span>
<span class="line-modified">!     bool performIsExtensible(JSGlobalObject*);</span>
<span class="line-modified">!     bool performDefineOwnProperty(JSGlobalObject*, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow);</span>
<span class="line-modified">!     void performGetOwnPropertyNames(JSGlobalObject*, PropertyNameArray&amp;);</span>
<span class="line-modified">!     void performGetOwnEnumerablePropertyNames(JSGlobalObject*, PropertyNameArray&amp;);</span>
<span class="line-added">+     bool performSetPrototype(JSGlobalObject*, JSValue prototype, bool shouldThrowIfCantSet);</span>
  
      WriteBarrier&lt;JSObject&gt; m_target;
      WriteBarrier&lt;Unknown&gt; m_handler;
      bool m_isCallable : 1;
      bool m_isConstructible : 1;
</pre>
<center><a href="ProxyObject.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ProxyRevoke.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>