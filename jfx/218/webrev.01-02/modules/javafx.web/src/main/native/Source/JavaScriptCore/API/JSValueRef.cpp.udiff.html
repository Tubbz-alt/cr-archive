<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/API/JSValueRef.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSTypedArray.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSVirtualMachineInternal.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/API/JSValueRef.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -59,14 +59,14 @@</span>
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return kJSTypeUndefined;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     JSValue jsValue = toJS(exec, value);</span>
<span class="udiff-line-modified-added">+     JSValue jsValue = toJS(globalObject, value);</span>
  
      if (jsValue.isUndefined())
          return kJSTypeUndefined;
      if (jsValue.isNull())
          return kJSTypeNull;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -86,134 +86,134 @@</span>
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toJS(exec, value).isUndefined();</span>
<span class="udiff-line-modified-added">+     return toJS(globalObject, value).isUndefined();</span>
  }
  
  bool JSValueIsNull(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toJS(exec, value).isNull();</span>
<span class="udiff-line-modified-added">+     return toJS(globalObject, value).isNull();</span>
  }
  
  bool JSValueIsBoolean(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toJS(exec, value).isBoolean();</span>
<span class="udiff-line-modified-added">+     return toJS(globalObject, value).isBoolean();</span>
  }
  
  bool JSValueIsNumber(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toJS(exec, value).isNumber();</span>
<span class="udiff-line-modified-added">+     return toJS(globalObject, value).isNumber();</span>
  }
  
  bool JSValueIsString(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toJS(exec, value).isString();</span>
<span class="udiff-line-modified-added">+     return toJS(globalObject, value).isString();</span>
  }
  
  bool JSValueIsObject(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toJS(exec, value).isObject();</span>
<span class="udiff-line-modified-added">+     return toJS(globalObject, value).isObject();</span>
  }
  
  bool JSValueIsSymbol(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toJS(exec, value).isSymbol();</span>
<span class="udiff-line-modified-added">+     return toJS(globalObject, value).isSymbol();</span>
  }
  
  bool JSValueIsArray(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toJS(exec, value).inherits&lt;JSArray&gt;(vm);</span>
<span class="udiff-line-modified-added">+     return toJS(globalObject, value).inherits&lt;JSArray&gt;(vm);</span>
  }
  
  bool JSValueIsDate(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toJS(exec, value).inherits&lt;DateInstance&gt;(vm);</span>
<span class="udiff-line-modified-added">+     return toJS(globalObject, value).inherits&lt;DateInstance&gt;(vm);</span>
  }
  
  bool JSValueIsObjectOfClass(JSContextRef ctx, JSValueRef value, JSClassRef jsClass)
  {
      if (!ctx || !jsClass) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     JSValue jsValue = toJS(exec, value);</span>
<span class="udiff-line-modified-added">+     JSValue jsValue = toJS(globalObject, value);</span>
  
      if (JSObject* o = jsValue.getObject()) {
          if (o-&gt;inherits&lt;JSProxy&gt;(vm))
              o = jsCast&lt;JSProxy*&gt;(o)-&gt;target();
  
          if (o-&gt;inherits&lt;JSCallbackObject&lt;JSGlobalObject&gt;&gt;(vm))
              return jsCast&lt;JSCallbackObject&lt;JSGlobalObject&gt;*&gt;(o)-&gt;inherits(jsClass);
<span class="udiff-line-modified-removed">-         if (o-&gt;inherits&lt;JSCallbackObject&lt;JSDestructibleObject&gt;&gt;(vm))</span>
<span class="udiff-line-modified-removed">-             return jsCast&lt;JSCallbackObject&lt;JSDestructibleObject&gt;*&gt;(o)-&gt;inherits(jsClass);</span>
<span class="udiff-line-modified-added">+         if (o-&gt;inherits&lt;JSCallbackObject&lt;JSNonFinalObject&gt;&gt;(vm))</span>
<span class="udiff-line-modified-added">+             return jsCast&lt;JSCallbackObject&lt;JSNonFinalObject&gt;*&gt;(o)-&gt;inherits(jsClass);</span>
  #if JSC_OBJC_API_ENABLED
          if (o-&gt;inherits&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;&gt;(vm))
              return jsCast&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;*&gt;(o)-&gt;inherits(jsClass);
  #endif
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -224,260 +224,260 @@</span>
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     JSValue jsA = toJS(exec, a);</span>
<span class="udiff-line-modified-removed">-     JSValue jsB = toJS(exec, b);</span>
<span class="udiff-line-modified-added">+     JSValue jsA = toJS(globalObject, a);</span>
<span class="udiff-line-modified-added">+     JSValue jsB = toJS(globalObject, b);</span>
  
<span class="udiff-line-modified-removed">-     bool result = JSValue::equal(exec, jsA, jsB); // false if an exception is thrown</span>
<span class="udiff-line-modified-removed">-     handleExceptionIfNeeded(scope, exec, exception);</span>
<span class="udiff-line-modified-added">+     bool result = JSValue::equal(globalObject, jsA, jsB); // false if an exception is thrown</span>
<span class="udiff-line-modified-added">+     handleExceptionIfNeeded(scope, ctx, exception);</span>
  
      return result;
  }
  
  bool JSValueIsStrictEqual(JSContextRef ctx, JSValueRef a, JSValueRef b)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     JSValue jsA = toJS(exec, a);</span>
<span class="udiff-line-modified-removed">-     JSValue jsB = toJS(exec, b);</span>
<span class="udiff-line-modified-added">+     JSValue jsA = toJS(globalObject, a);</span>
<span class="udiff-line-modified-added">+     JSValue jsB = toJS(globalObject, b);</span>
  
<span class="udiff-line-modified-removed">-     return JSValue::strictEqual(exec, jsA, jsB);</span>
<span class="udiff-line-modified-added">+     return JSValue::strictEqual(globalObject, jsA, jsB);</span>
  }
  
  bool JSValueIsInstanceOfConstructor(JSContextRef ctx, JSValueRef value, JSObjectRef constructor, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     JSValue jsValue = toJS(exec, value);</span>
<span class="udiff-line-modified-added">+     JSValue jsValue = toJS(globalObject, value);</span>
  
      JSObject* jsConstructor = toJS(constructor);
      if (!jsConstructor-&gt;structure(vm)-&gt;typeInfo().implementsHasInstance())
          return false;
<span class="udiff-line-modified-removed">-     bool result = jsConstructor-&gt;hasInstance(exec, jsValue); // false if an exception is thrown</span>
<span class="udiff-line-modified-removed">-     handleExceptionIfNeeded(scope, exec, exception);</span>
<span class="udiff-line-modified-added">+     bool result = jsConstructor-&gt;hasInstance(globalObject, jsValue); // false if an exception is thrown</span>
<span class="udiff-line-modified-added">+     handleExceptionIfNeeded(scope, ctx, exception);</span>
      return result;
  }
  
  JSValueRef JSValueMakeUndefined(JSContextRef ctx)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toRef(exec, jsUndefined());</span>
<span class="udiff-line-modified-added">+     return toRef(globalObject, jsUndefined());</span>
  }
  
  JSValueRef JSValueMakeNull(JSContextRef ctx)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toRef(exec, jsNull());</span>
<span class="udiff-line-modified-added">+     return toRef(globalObject, jsNull());</span>
  }
  
  JSValueRef JSValueMakeBoolean(JSContextRef ctx, bool value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toRef(exec, jsBoolean(value));</span>
<span class="udiff-line-modified-added">+     return toRef(globalObject, jsBoolean(value));</span>
  }
  
  JSValueRef JSValueMakeNumber(JSContextRef ctx, double value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return toRef(exec, jsNumber(purifyNaN(value)));</span>
<span class="udiff-line-modified-added">+     return toRef(globalObject, jsNumber(purifyNaN(value)));</span>
  }
  
  JSValueRef JSValueMakeSymbol(JSContextRef ctx, JSStringRef description)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return nullptr;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
      if (!description)
<span class="udiff-line-modified-removed">-         return toRef(exec, Symbol::create(vm));</span>
<span class="udiff-line-modified-removed">-     return toRef(exec, Symbol::createWithDescription(vm, description-&gt;string()));</span>
<span class="udiff-line-modified-added">+         return toRef(globalObject, Symbol::create(vm));</span>
<span class="udiff-line-modified-added">+     return toRef(globalObject, Symbol::createWithDescription(vm, description-&gt;string()));</span>
  }
  
  JSValueRef JSValueMakeString(JSContextRef ctx, JSStringRef string)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
  
<span class="udiff-line-modified-removed">-     return toRef(exec, jsString(vm, string ? string-&gt;string() : String()));</span>
<span class="udiff-line-modified-added">+     return toRef(globalObject, jsString(vm, string ? string-&gt;string() : String()));</span>
  }
  
  JSValueRef JSValueMakeFromJSONString(JSContextRef ctx, JSStringRef string)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
      String str = string-&gt;string();
      unsigned length = str.length();
      if (!length || str.is8Bit()) {
<span class="udiff-line-modified-removed">-         LiteralParser&lt;LChar&gt; parser(exec, str.characters8(), length, StrictJSON);</span>
<span class="udiff-line-modified-removed">-         return toRef(exec, parser.tryLiteralParse());</span>
<span class="udiff-line-modified-added">+         LiteralParser&lt;LChar&gt; parser(globalObject, str.characters8(), length, StrictJSON);</span>
<span class="udiff-line-modified-added">+         return toRef(globalObject, parser.tryLiteralParse());</span>
      }
<span class="udiff-line-modified-removed">-     LiteralParser&lt;UChar&gt; parser(exec, str.characters16(), length, StrictJSON);</span>
<span class="udiff-line-modified-removed">-     return toRef(exec, parser.tryLiteralParse());</span>
<span class="udiff-line-modified-added">+     LiteralParser&lt;UChar&gt; parser(globalObject, str.characters16(), length, StrictJSON);</span>
<span class="udiff-line-modified-added">+     return toRef(globalObject, parser.tryLiteralParse());</span>
  }
  
  JSStringRef JSValueCreateJSONString(JSContextRef ctx, JSValueRef apiValue, unsigned indent, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     JSValue value = toJS(exec, apiValue);</span>
<span class="udiff-line-modified-removed">-     String result = JSONStringify(exec, value, indent);</span>
<span class="udiff-line-modified-added">+     JSValue value = toJS(globalObject, apiValue);</span>
<span class="udiff-line-modified-added">+     String result = JSONStringify(globalObject, value, indent);</span>
      if (exception)
          *exception = 0;
<span class="udiff-line-modified-removed">-     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
<span class="udiff-line-modified-added">+     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
          return 0;
      return OpaqueJSString::tryCreate(result).leakRef();
  }
  
  bool JSValueToBoolean(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     JSValue jsValue = toJS(exec, value);</span>
<span class="udiff-line-modified-removed">-     return jsValue.toBoolean(exec);</span>
<span class="udiff-line-modified-added">+     JSValue jsValue = toJS(globalObject, value);</span>
<span class="udiff-line-modified-added">+     return jsValue.toBoolean(globalObject);</span>
  }
  
  double JSValueToNumber(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return PNaN;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     JSValue jsValue = toJS(exec, value);</span>
<span class="udiff-line-modified-added">+     JSValue jsValue = toJS(globalObject, value);</span>
  
<span class="udiff-line-modified-removed">-     double number = jsValue.toNumber(exec);</span>
<span class="udiff-line-modified-removed">-     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
<span class="udiff-line-modified-added">+     double number = jsValue.toNumber(globalObject);</span>
<span class="udiff-line-modified-added">+     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
          number = PNaN;
      return number;
  }
  
  JSStringRef JSValueToStringCopy(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     JSValue jsValue = toJS(exec, value);</span>
<span class="udiff-line-modified-added">+     JSValue jsValue = toJS(globalObject, value);</span>
  
<span class="udiff-line-modified-removed">-     auto stringRef(OpaqueJSString::tryCreate(jsValue.toWTFString(exec)));</span>
<span class="udiff-line-modified-removed">-     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
<span class="udiff-line-modified-added">+     auto stringRef(OpaqueJSString::tryCreate(jsValue.toWTFString(globalObject)));</span>
<span class="udiff-line-modified-added">+     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
          stringRef = nullptr;
      return stringRef.leakRef();
  }
  
  JSObjectRef JSValueToObject(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="udiff-line-modified-removed">-     JSValue jsValue = toJS(exec, value);</span>
<span class="udiff-line-modified-added">+     JSValue jsValue = toJS(globalObject, value);</span>
  
<span class="udiff-line-modified-removed">-     JSObjectRef objectRef = toRef(jsValue.toObject(exec));</span>
<span class="udiff-line-modified-removed">-     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
<span class="udiff-line-modified-added">+     JSObjectRef objectRef = toRef(jsValue.toObject(globalObject));</span>
<span class="udiff-line-modified-added">+     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
          objectRef = 0;
      return objectRef;
  }
  
  void JSValueProtect(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return;
      }
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     JSValue jsValue = toJSForGC(exec, value);</span>
<span class="udiff-line-modified-added">+     JSValue jsValue = toJSForGC(globalObject, value);</span>
      gcProtect(jsValue);
  }
  
  void JSValueUnprotect(JSContextRef ctx, JSValueRef value)
  {
<span class="udiff-line-modified-removed">-     ExecState* exec = toJS(ctx);</span>
<span class="udiff-line-modified-removed">-     JSLockHolder locker(exec);</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="udiff-line-modified-added">+     JSLockHolder locker(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     JSValue jsValue = toJSForGC(exec, value);</span>
<span class="udiff-line-modified-added">+     JSValue jsValue = toJSForGC(globalObject, value);</span>
      gcUnprotect(jsValue);
  }
</pre>
<center><a href="JSTypedArray.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSVirtualMachineInternal.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>