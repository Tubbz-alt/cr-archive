<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/Modules/webauthn/fido/DeviceRequestConverter.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../cbor/CBORReader.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="DeviceRequestConverter.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/webauthn/fido/DeviceRequestConverter.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -85,11 +85,11 @@</span>
      cborDescriptorMap[CBORValue(kCredentialTypeKey)] = CBORValue(publicKeyCredentialTypeToString(descriptor.type));
      cborDescriptorMap[CBORValue(kCredentialIdKey)] = CBORValue(descriptor.idVector);
      return CBORValue(WTFMove(cborDescriptorMap));
  }
  
<span class="udiff-line-modified-removed">- Vector&lt;uint8_t&gt; encodeMakeCredenitalRequestAsCBOR(const Vector&lt;uint8_t&gt;&amp; hash, const PublicKeyCredentialCreationOptions&amp; options, UVAvailability uvCapability)</span>
<span class="udiff-line-modified-added">+ Vector&lt;uint8_t&gt; encodeMakeCredenitalRequestAsCBOR(const Vector&lt;uint8_t&gt;&amp; hash, const PublicKeyCredentialCreationOptions&amp; options, UVAvailability uvCapability, Optional&lt;PinParameters&gt; pin)</span>
  {
      CBORValue::MapValue cborMap;
      cborMap[CBORValue(1)] = CBORValue(hash);
      cborMap[CBORValue(2)] = convertRpEntityToCBOR(options.rp);
      cborMap[CBORValue(3)] = convertUserEntityToCBOR(options.user);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -117,24 +117,31 @@</span>
              requireUserVerification = uvCapability == UVAvailability::kNotSupported ? false : true;
              break;
          case UserVerificationRequirement::Discouraged:
              requireUserVerification = false;
          }
<span class="udiff-line-modified-removed">-         optionMap[CBORValue(kUserVerificationMapKey)] = CBORValue(requireUserVerification);</span>
<span class="udiff-line-modified-added">+         if (requireUserVerification)</span>
<span class="udiff-line-added">+             optionMap[CBORValue(kUserVerificationMapKey)] = CBORValue(requireUserVerification);</span>
      }
      if (!optionMap.empty())
          cborMap[CBORValue(7)] = CBORValue(WTFMove(optionMap));
  
<span class="udiff-line-added">+     if (pin) {</span>
<span class="udiff-line-added">+         ASSERT(pin-&gt;protocol &gt;= 0);</span>
<span class="udiff-line-added">+         cborMap[CBORValue(8)] = CBORValue(WTFMove(pin-&gt;auth));</span>
<span class="udiff-line-added">+         cborMap[CBORValue(9)] = CBORValue(pin-&gt;protocol);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      auto serializedParam = CBORWriter::write(CBORValue(WTFMove(cborMap)));
      ASSERT(serializedParam);
  
      Vector&lt;uint8_t&gt; cborRequest({ static_cast&lt;uint8_t&gt;(CtapRequestCommand::kAuthenticatorMakeCredential) });
      cborRequest.appendVector(*serializedParam);
      return cborRequest;
  }
  
<span class="udiff-line-modified-removed">- Vector&lt;uint8_t&gt; encodeGetAssertionRequestAsCBOR(const Vector&lt;uint8_t&gt;&amp; hash, const PublicKeyCredentialRequestOptions&amp; options, UVAvailability uvCapability)</span>
<span class="udiff-line-modified-added">+ Vector&lt;uint8_t&gt; encodeGetAssertionRequestAsCBOR(const Vector&lt;uint8_t&gt;&amp; hash, const PublicKeyCredentialRequestOptions&amp; options, UVAvailability uvCapability, Optional&lt;PinParameters&gt; pin)</span>
  {
      CBORValue::MapValue cborMap;
      cborMap[CBORValue(1)] = CBORValue(options.rpId);
      cborMap[CBORValue(2)] = CBORValue(hash);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -156,16 +163,23 @@</span>
          requireUserVerification = uvCapability == UVAvailability::kNotSupported ? false : true;
          break;
      case UserVerificationRequirement::Discouraged:
          requireUserVerification = false;
      }
<span class="udiff-line-modified-removed">-     optionMap[CBORValue(kUserVerificationMapKey)] = CBORValue(requireUserVerification);</span>
<span class="udiff-line-modified-added">+     if (requireUserVerification)</span>
<span class="udiff-line-added">+         optionMap[CBORValue(kUserVerificationMapKey)] = CBORValue(requireUserVerification);</span>
      optionMap[CBORValue(kUserPresenceMapKey)] = CBORValue(true);
  
      if (!optionMap.empty())
          cborMap[CBORValue(5)] = CBORValue(WTFMove(optionMap));
  
<span class="udiff-line-added">+     if (pin) {</span>
<span class="udiff-line-added">+         ASSERT(pin-&gt;protocol &gt;= 0);</span>
<span class="udiff-line-added">+         cborMap[CBORValue(6)] = CBORValue(WTFMove(pin-&gt;auth));</span>
<span class="udiff-line-added">+         cborMap[CBORValue(7)] = CBORValue(pin-&gt;protocol);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      auto serializedParam = CBORWriter::write(CBORValue(WTFMove(cborMap)));
      ASSERT(serializedParam);
  
      Vector&lt;uint8_t&gt; cborRequest({ static_cast&lt;uint8_t&gt;(CtapRequestCommand::kAuthenticatorGetAssertion) });
      cborRequest.appendVector(*serializedParam);
</pre>
<center><a href="../cbor/CBORReader.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="DeviceRequestConverter.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>