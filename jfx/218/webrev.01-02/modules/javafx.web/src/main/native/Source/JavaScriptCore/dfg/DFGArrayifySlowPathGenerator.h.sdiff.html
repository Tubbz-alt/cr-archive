<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGArrayifySlowPathGenerator.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DFGArrayMode.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGAtTailAbstractState.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGArrayifySlowPathGenerator.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 74         linkFrom(jit);
 75 
 76         ASSERT(m_op == Arrayify || m_op == ArrayifyToStructure);
 77 
 78         if (m_propertyGPR != InvalidGPRReg) {
 79             switch (m_arrayMode.type()) {
 80             case Array::Int32:
 81             case Array::Double:
 82             case Array::Contiguous:
 83                 m_badPropertyJump.fill(jit, jit-&gt;m_jit.branch32(
 84                     MacroAssembler::AboveOrEqual, m_propertyGPR,
 85                     MacroAssembler::TrustedImm32(MIN_SPARSE_ARRAY_INDEX)));
 86                 break;
 87             default:
 88                 break;
 89             }
 90         }
 91 
 92         for (unsigned i = 0; i &lt; m_plans.size(); ++i)
 93             jit-&gt;silentSpill(m_plans[i]);

 94         switch (m_arrayMode.type()) {
 95         case Array::Int32:
<span class="line-modified"> 96             jit-&gt;callOperation(operationEnsureInt32, m_tempGPR, m_baseGPR);</span>
 97             break;
 98         case Array::Double:
<span class="line-modified"> 99             jit-&gt;callOperation(operationEnsureDouble, m_tempGPR, m_baseGPR);</span>
100             break;
101         case Array::Contiguous:
<span class="line-modified">102             jit-&gt;callOperation(operationEnsureContiguous, m_tempGPR, m_baseGPR);</span>
103             break;
104         case Array::ArrayStorage:
105         case Array::SlowPutArrayStorage:
<span class="line-modified">106             jit-&gt;callOperation(operationEnsureArrayStorage, m_tempGPR, m_baseGPR);</span>
107             break;
108         default:
109             CRASH();
110             break;
111         }
112         for (unsigned i = m_plans.size(); i--;)
113             jit-&gt;silentFill(m_plans[i]);
114         jit-&gt;m_jit.exceptionCheck();
115 
116         if (m_op == ArrayifyToStructure) {
117             ASSERT(m_structure.get());
118             m_badIndexingTypeJump.fill(
119                 jit, jit-&gt;m_jit.branchWeakStructure(MacroAssembler::NotEqual, MacroAssembler::Address(m_baseGPR, JSCell::structureIDOffset()), m_structure));
120         } else {
121             // Finally, check that we have the kind of array storage that we wanted to get.
122             // Note that this is a backwards speculation check, which will result in the
123             // bytecode operation corresponding to this arrayification being reexecuted.
124             // That&#39;s fine, since arrayification is not user-visible.
125             jit-&gt;m_jit.load8(
126                 MacroAssembler::Address(m_baseGPR, JSCell::indexingTypeAndMiscOffset()),
</pre>
</td>
<td>
<hr />
<pre>
 74         linkFrom(jit);
 75 
 76         ASSERT(m_op == Arrayify || m_op == ArrayifyToStructure);
 77 
 78         if (m_propertyGPR != InvalidGPRReg) {
 79             switch (m_arrayMode.type()) {
 80             case Array::Int32:
 81             case Array::Double:
 82             case Array::Contiguous:
 83                 m_badPropertyJump.fill(jit, jit-&gt;m_jit.branch32(
 84                     MacroAssembler::AboveOrEqual, m_propertyGPR,
 85                     MacroAssembler::TrustedImm32(MIN_SPARSE_ARRAY_INDEX)));
 86                 break;
 87             default:
 88                 break;
 89             }
 90         }
 91 
 92         for (unsigned i = 0; i &lt; m_plans.size(); ++i)
 93             jit-&gt;silentSpill(m_plans[i]);
<span class="line-added"> 94         VM&amp; vm = jit-&gt;vm();</span>
 95         switch (m_arrayMode.type()) {
 96         case Array::Int32:
<span class="line-modified"> 97             jit-&gt;callOperation(operationEnsureInt32, m_tempGPR, &amp;vm, m_baseGPR);</span>
 98             break;
 99         case Array::Double:
<span class="line-modified">100             jit-&gt;callOperation(operationEnsureDouble, m_tempGPR, &amp;vm, m_baseGPR);</span>
101             break;
102         case Array::Contiguous:
<span class="line-modified">103             jit-&gt;callOperation(operationEnsureContiguous, m_tempGPR, &amp;vm, m_baseGPR);</span>
104             break;
105         case Array::ArrayStorage:
106         case Array::SlowPutArrayStorage:
<span class="line-modified">107             jit-&gt;callOperation(operationEnsureArrayStorage, m_tempGPR, &amp;vm, m_baseGPR);</span>
108             break;
109         default:
110             CRASH();
111             break;
112         }
113         for (unsigned i = m_plans.size(); i--;)
114             jit-&gt;silentFill(m_plans[i]);
115         jit-&gt;m_jit.exceptionCheck();
116 
117         if (m_op == ArrayifyToStructure) {
118             ASSERT(m_structure.get());
119             m_badIndexingTypeJump.fill(
120                 jit, jit-&gt;m_jit.branchWeakStructure(MacroAssembler::NotEqual, MacroAssembler::Address(m_baseGPR, JSCell::structureIDOffset()), m_structure));
121         } else {
122             // Finally, check that we have the kind of array storage that we wanted to get.
123             // Note that this is a backwards speculation check, which will result in the
124             // bytecode operation corresponding to this arrayification being reexecuted.
125             // That&#39;s fine, since arrayification is not user-visible.
126             jit-&gt;m_jit.load8(
127                 MacroAssembler::Address(m_baseGPR, JSCell::indexingTypeAndMiscOffset()),
</pre>
</td>
</tr>
</table>
<center><a href="DFGArrayMode.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGAtTailAbstractState.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>