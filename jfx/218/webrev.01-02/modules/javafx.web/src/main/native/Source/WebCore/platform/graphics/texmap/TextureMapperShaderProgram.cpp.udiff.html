<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/texmap/TextureMapperShaderProgram.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TextureMapperPlatformLayerProxy.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="TextureMapperShaderProgram.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/texmap/TextureMapperShaderProgram.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -158,21 +158,28 @@</span>
  #define BLUR_CONSTANTS \
      GLSL_DIRECTIVE(define GAUSSIAN_KERNEL_HALF_WIDTH 11) \
      GLSL_DIRECTIVE(define GAUSSIAN_KERNEL_STEP 0.2)
  
  
<span class="udiff-line-added">+ #define OES_EGL_IMAGE_EXTERNAL_DIRECTIVE \</span>
<span class="udiff-line-added">+     GLSL_DIRECTIVE(ifdef ENABLE_TextureExternalOES) \</span>
<span class="udiff-line-added">+         GLSL_DIRECTIVE(extension GL_OES_EGL_image_external : require) \</span>
<span class="udiff-line-added">+         GLSL_DIRECTIVE(define SamplerExternalOESType samplerExternalOES) \</span>
<span class="udiff-line-added">+     GLSL_DIRECTIVE(else) \</span>
<span class="udiff-line-added">+         GLSL_DIRECTIVE(define SamplerExternalOESType sampler2D) \</span>
<span class="udiff-line-added">+     GLSL_DIRECTIVE(endif)</span>
<span class="udiff-line-added">+ </span>
  // Common header for all versions. We define the matrices variables here to keep the precision
  // directives scope: the first one applies to the matrices variables and the next one to the
  // rest of them. The precision is only used in GLES.
  static const char* fragmentTemplateHeaderCommon =
      RECT_TEXTURE_DIRECTIVE
      ANTIALIASING_TEX_COORD_DIRECTIVE
      BLUR_CONSTANTS
<span class="udiff-line-added">+     OES_EGL_IMAGE_EXTERNAL_DIRECTIVE</span>
  #if USE(OPENGL_ES)
      TEXTURE_SPACE_MATRIX_PRECISION_DIRECTIVE
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- #if USE(OPENGL_ES)</span>
      STRINGIFY(
          precision TextureSpaceMatrixPrecision float;
      )
  #endif
      STRINGIFY(
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -205,13 +212,18 @@</span>
  #endif
  
  static const char* fragmentTemplateCommon =
      STRINGIFY(
          uniform SamplerType s_sampler;
<span class="udiff-line-added">+         uniform SamplerType s_samplerY;</span>
<span class="udiff-line-added">+         uniform SamplerType s_samplerU;</span>
<span class="udiff-line-added">+         uniform SamplerType s_samplerV;</span>
          uniform sampler2D s_contentTexture;
<span class="udiff-line-added">+         uniform SamplerExternalOESType s_externalOESTexture;</span>
          uniform float u_opacity;
          uniform float u_filterAmount;
<span class="udiff-line-added">+         uniform mat3 u_yuvToRgb;</span>
          uniform vec2 u_blurRadius;
          uniform vec2 u_shadowOffset;
          uniform vec4 u_color;
          uniform float u_gaussianKernel[GAUSSIAN_KERNEL_HALF_WIDTH];
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -229,11 +241,45 @@</span>
  
          vec2 vertexTransformTexCoord() { return v_transformedTexCoord; }
  
          void applyManualRepeat(inout vec2 pos) { pos = fract(pos); }
  
<span class="udiff-line-modified-removed">-         void applyTexture(inout vec4 color, vec2 texCoord) { color = u_textureColorSpaceMatrix * SamplerFunction(s_sampler, texCoord); }</span>
<span class="udiff-line-modified-added">+         void applyTextureRGB(inout vec4 color, vec2 texCoord) { color = u_textureColorSpaceMatrix * SamplerFunction(s_sampler, texCoord); }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         vec3 yuvToRgb(float y, float u, float v)</span>
<span class="udiff-line-added">+         {</span>
<span class="udiff-line-added">+             // yuv is either bt601 or bt709 so the offset is the same</span>
<span class="udiff-line-added">+             vec3 yuv = vec3(y - 0.0625, u - 0.5, v - 0.5);</span>
<span class="udiff-line-added">+             return yuv * u_yuvToRgb;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         void applyTextureYUV(inout vec4 color, vec2 texCoord)</span>
<span class="udiff-line-added">+         {</span>
<span class="udiff-line-added">+             float y = SamplerFunction(s_samplerY, texCoord).r;</span>
<span class="udiff-line-added">+             float u = SamplerFunction(s_samplerU, texCoord).r;</span>
<span class="udiff-line-added">+             float v = SamplerFunction(s_samplerV, texCoord).r;</span>
<span class="udiff-line-added">+             vec4 data = vec4(yuvToRgb(y, u, v), 1.0);</span>
<span class="udiff-line-added">+             color = u_textureColorSpaceMatrix * data;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         void applyTextureNV12(inout vec4 color, vec2 texCoord)</span>
<span class="udiff-line-added">+         {</span>
<span class="udiff-line-added">+             float y = SamplerFunction(s_samplerY, texCoord).r;</span>
<span class="udiff-line-added">+             vec2 uv = SamplerFunction(s_samplerU, texCoord).rg;</span>
<span class="udiff-line-added">+             vec4 data = vec4(yuvToRgb(y, uv.x, uv.y), 1.0);</span>
<span class="udiff-line-added">+             color = u_textureColorSpaceMatrix * data;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         void applyTextureNV21(inout vec4 color, vec2 texCoord)</span>
<span class="udiff-line-added">+         {</span>
<span class="udiff-line-added">+             float y = SamplerFunction(s_samplerY, texCoord).r;</span>
<span class="udiff-line-added">+             vec2 uv = SamplerFunction(s_samplerU, texCoord).gr;</span>
<span class="udiff-line-added">+             vec4 data = vec4(yuvToRgb(y, uv.x, uv.y), 1.0);</span>
<span class="udiff-line-added">+             color = u_textureColorSpaceMatrix * data;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         void applyTexturePackedYUV(inout vec4 color, vec2 texCoord)</span>
<span class="udiff-line-added">+         {</span>
<span class="udiff-line-added">+             vec4 data = SamplerFunction(s_sampler, texCoord);</span>
<span class="udiff-line-added">+             color = u_textureColorSpaceMatrix * vec4(yuvToRgb(data.b, data.g, data.r), data.a);</span>
<span class="udiff-line-added">+         }</span>
          void applyOpacity(inout vec4 color) { color *= u_opacity; }
          void applyAntialiasing(inout vec4 color) { color *= antialias(); }
  
          void applyGrayscaleFilter(inout vec4 color)
          {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -334,18 +380,28 @@</span>
          {
              vec4 contentColor = texture2D(s_contentTexture, texCoord);
              color = sourceOver(contentColor, color);
          }
  
<span class="udiff-line-added">+         void applyTextureExternalOES(inout vec4 color, vec2 texCoord)</span>
<span class="udiff-line-added">+         {</span>
<span class="udiff-line-added">+             vec4 contentColor = texture2D(s_externalOESTexture, texCoord);</span>
<span class="udiff-line-added">+             color = sourceOver(contentColor, color);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
          void applySolidColor(inout vec4 color) { color *= u_color; }
  
          void main(void)
          {
              vec4 color = vec4(1., 1., 1., 1.);
              vec2 texCoord = transformTexCoord();
              applyManualRepeatIfNeeded(texCoord);
<span class="udiff-line-modified-removed">-             applyTextureIfNeeded(color, texCoord);</span>
<span class="udiff-line-modified-added">+             applyTextureRGBIfNeeded(color, texCoord);</span>
<span class="udiff-line-added">+             applyTextureYUVIfNeeded(color, texCoord);</span>
<span class="udiff-line-added">+             applyTextureNV12IfNeeded(color, texCoord);</span>
<span class="udiff-line-added">+             applyTextureNV21IfNeeded(color, texCoord);</span>
<span class="udiff-line-added">+             applyTexturePackedYUVIfNeeded(color, texCoord);</span>
              applySolidColorIfNeeded(color);
              applyAntialiasingIfNeeded(color);
              applyOpacityIfNeeded(color);
              applyGrayscaleFilterIfNeeded(color);
              applySepiaFilterIfNeeded(color);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -356,10 +412,11 @@</span>
              applyContrastFilterIfNeeded(color);
              applyOpacityFilterIfNeeded(color);
              applyBlurFilterIfNeeded(color, texCoord);
              applyAlphaBlurIfNeeded(color, texCoord);
              applyContentTextureIfNeeded(color, texCoord);
<span class="udiff-line-added">+             applyTextureExternalOESIfNeeded(color, texCoord);</span>
              gl_FragColor = color;
          }
      );
  
  Ref&lt;TextureMapperShaderProgram&gt; TextureMapperShaderProgram::create(TextureMapperShaderProgram::Options options)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -367,11 +424,15 @@</span>
  #define SET_APPLIER_FROM_OPTIONS(Applier) \
      optionsApplierBuilder.append(\
          (options &amp; TextureMapperShaderProgram::Applier) ? ENABLE_APPLIER(Applier) : DISABLE_APPLIER(Applier))
  
      StringBuilder optionsApplierBuilder;
<span class="udiff-line-modified-removed">-     SET_APPLIER_FROM_OPTIONS(Texture);</span>
<span class="udiff-line-modified-added">+     SET_APPLIER_FROM_OPTIONS(TextureRGB);</span>
<span class="udiff-line-added">+     SET_APPLIER_FROM_OPTIONS(TextureYUV);</span>
<span class="udiff-line-added">+     SET_APPLIER_FROM_OPTIONS(TextureNV12);</span>
<span class="udiff-line-added">+     SET_APPLIER_FROM_OPTIONS(TextureNV21);</span>
<span class="udiff-line-added">+     SET_APPLIER_FROM_OPTIONS(TexturePackedYUV);</span>
      SET_APPLIER_FROM_OPTIONS(Rect);
      SET_APPLIER_FROM_OPTIONS(SolidColor);
      SET_APPLIER_FROM_OPTIONS(Opacity);
      SET_APPLIER_FROM_OPTIONS(Antialiasing);
      SET_APPLIER_FROM_OPTIONS(GrayscaleFilter);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -384,10 +445,11 @@</span>
      SET_APPLIER_FROM_OPTIONS(OpacityFilter);
      SET_APPLIER_FROM_OPTIONS(BlurFilter);
      SET_APPLIER_FROM_OPTIONS(AlphaBlur);
      SET_APPLIER_FROM_OPTIONS(ContentTexture);
      SET_APPLIER_FROM_OPTIONS(ManualRepeat);
<span class="udiff-line-added">+     SET_APPLIER_FROM_OPTIONS(TextureExternalOES);</span>
  
      StringBuilder vertexShaderBuilder;
  
      // OpenGL &gt;= 3.2 requires a #version directive at the beginning of the code.
  #if !USE(OPENGL_ES)
</pre>
<center><a href="TextureMapperPlatformLayerProxy.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="TextureMapperShaderProgram.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>