<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSArrayBufferViewInlines.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSArrayBufferView.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSArrayInlines.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSArrayBufferViewInlines.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -41,12 +41,16 @@</span>
      default:
          return false;
      }
  }
  
<span class="udiff-line-modified-removed">- inline ArrayBuffer* JSArrayBufferView::possiblySharedBuffer()</span>
<span class="udiff-line-modified-added">+ template&lt;JSArrayBufferView::Requester requester&gt;</span>
<span class="udiff-line-added">+ inline ArrayBuffer* JSArrayBufferView::possiblySharedBufferImpl()</span>
  {
<span class="udiff-line-added">+     if (requester == ConcurrentThread)</span>
<span class="udiff-line-added">+         ASSERT(m_mode != FastTypedArray &amp;&amp; m_mode != OversizeTypedArray);</span>
<span class="udiff-line-added">+ </span>
      switch (m_mode) {
      case WastefulTypedArray:
          return existingBufferInButterfly();
      case DataViewMode:
          return jsCast&lt;JSDataView*&gt;(this)-&gt;possiblySharedBuffer();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -56,10 +60,15 @@</span>
      }
      ASSERT_NOT_REACHED();
      return nullptr;
  }
  
<span class="udiff-line-added">+ inline ArrayBuffer* JSArrayBufferView::possiblySharedBuffer()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     return possiblySharedBufferImpl&lt;Mutator&gt;();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  inline ArrayBuffer* JSArrayBufferView::existingBufferInButterfly()
  {
      ASSERT(m_mode == WastefulTypedArray);
      return butterfly()-&gt;indexingHeader()-&gt;arrayBuffer();
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -69,26 +78,49 @@</span>
      RefPtr&lt;ArrayBufferView&gt; result = possiblySharedImpl();
      RELEASE_ASSERT(!result-&gt;isShared());
      return result;
  }
  
<span class="udiff-line-modified-removed">- inline unsigned JSArrayBufferView::byteOffset()</span>
<span class="udiff-line-modified-added">+ template&lt;JSArrayBufferView::Requester requester, typename ResultType&gt;</span>
<span class="udiff-line-added">+ inline ResultType JSArrayBufferView::byteOffsetImpl()</span>
  {
      if (!hasArrayBuffer())
          return 0;
  
<span class="udiff-line-modified-removed">-     ArrayBuffer* buffer = possiblySharedBuffer();</span>
<span class="udiff-line-modified-removed">-     ASSERT(!vector() == !buffer-&gt;data());</span>
<span class="udiff-line-modified-added">+     if (requester == ConcurrentThread)</span>
<span class="udiff-line-modified-added">+         WTF::loadLoadFence();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ArrayBuffer* buffer = possiblySharedBufferImpl&lt;requester&gt;();</span>
<span class="udiff-line-added">+     if (requester == Mutator) {</span>
<span class="udiff-line-added">+         ASSERT(!isCompilationThread());</span>
<span class="udiff-line-added">+         ASSERT(!vector() == !buffer-&gt;data());</span>
<span class="udiff-line-added">+     }</span>
  
      ptrdiff_t delta =
          bitwise_cast&lt;uint8_t*&gt;(vector()) - static_cast&lt;uint8_t*&gt;(buffer-&gt;data());
  
      unsigned result = static_cast&lt;unsigned&gt;(delta);
<span class="udiff-line-modified-removed">-     ASSERT(static_cast&lt;ptrdiff_t&gt;(result) == delta);</span>
<span class="udiff-line-modified-added">+     if (requester == Mutator)</span>
<span class="udiff-line-added">+         ASSERT(static_cast&lt;ptrdiff_t&gt;(result) == delta);</span>
<span class="udiff-line-added">+     else {</span>
<span class="udiff-line-added">+         if (static_cast&lt;ptrdiff_t&gt;(result) != delta)</span>
<span class="udiff-line-added">+             return { };</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      return result;
  }
  
<span class="udiff-line-added">+ inline unsigned JSArrayBufferView::byteOffset()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     return byteOffsetImpl&lt;Mutator, unsigned&gt;();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ inline Optional&lt;unsigned&gt; JSArrayBufferView::byteOffsetConcurrently()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     return byteOffsetImpl&lt;ConcurrentThread, Optional&lt;unsigned&gt;&gt;();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  inline RefPtr&lt;ArrayBufferView&gt; JSArrayBufferView::toWrapped(VM&amp; vm, JSValue value)
  {
      if (JSArrayBufferView* view = jsDynamicCast&lt;JSArrayBufferView*&gt;(vm, value)) {
          if (!view-&gt;isShared())
              return view-&gt;unsharedImpl();
</pre>
<center><a href="JSArrayBufferView.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSArrayInlines.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>