<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/GCAwareJITStubRoutine.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FPRInfo.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="GCAwareJITStubRoutine.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/GCAwareJITStubRoutine.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -79,13 +79,14 @@</span>
  {
  }
  
  MarkingGCAwareJITStubRoutine::MarkingGCAwareJITStubRoutine(
      const MacroAssemblerCodeRef&lt;JITStubRoutinePtrTag&gt;&amp; code, VM&amp; vm, const JSCell* owner,
<span class="udiff-line-modified-removed">-     const Vector&lt;JSCell*&gt;&amp; cells)</span>
<span class="udiff-line-modified-added">+     const Vector&lt;JSCell*&gt;&amp; cells, Bag&lt;CallLinkInfo&gt;&amp;&amp; callLinkInfos)</span>
      : GCAwareJITStubRoutine(code, vm)
      , m_cells(cells.size())
<span class="udiff-line-added">+     , m_callLinkInfos(WTFMove(callLinkInfos))</span>
  {
      for (unsigned i = cells.size(); i--;)
          m_cells[i].set(vm, owner, cells[i]);
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -99,13 +100,13 @@</span>
          visitor.append(entry);
  }
  
  
  GCAwareJITStubRoutineWithExceptionHandler::GCAwareJITStubRoutineWithExceptionHandler(
<span class="udiff-line-modified-removed">-     const MacroAssemblerCodeRef&lt;JITStubRoutinePtrTag&gt;&amp; code, VM&amp; vm,  const JSCell* owner, const Vector&lt;JSCell*&gt;&amp; cells,</span>
<span class="udiff-line-modified-added">+     const MacroAssemblerCodeRef&lt;JITStubRoutinePtrTag&gt;&amp; code, VM&amp; vm,  const JSCell* owner, const Vector&lt;JSCell*&gt;&amp; cells, Bag&lt;CallLinkInfo&gt;&amp;&amp; callLinkInfos,</span>
      CodeBlock* codeBlockForExceptionHandlers, DisposableCallSiteIndex exceptionHandlerCallSiteIndex)
<span class="udiff-line-modified-removed">-     : MarkingGCAwareJITStubRoutine(code, vm, owner, cells)</span>
<span class="udiff-line-modified-added">+     : MarkingGCAwareJITStubRoutine(code, vm, owner, cells, WTFMove(callLinkInfos))</span>
      , m_codeBlockWithExceptionHandler(codeBlockForExceptionHandlers)
      , m_exceptionHandlerCallSiteIndex(exceptionHandlerCallSiteIndex)
  {
      RELEASE_ASSERT(m_codeBlockWithExceptionHandler);
      ASSERT(!!m_codeBlockWithExceptionHandler-&gt;handlerForIndex(exceptionHandlerCallSiteIndex.bits()));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -134,25 +135,29 @@</span>
      const MacroAssemblerCodeRef&lt;JITStubRoutinePtrTag&gt;&amp; code,
      VM&amp; vm,
      const JSCell* owner,
      bool makesCalls,
      const Vector&lt;JSCell*&gt;&amp; cells,
<span class="udiff-line-added">+     Bag&lt;CallLinkInfo&gt;&amp;&amp; callLinkInfos,</span>
      CodeBlock* codeBlockForExceptionHandlers,
      DisposableCallSiteIndex exceptionHandlerCallSiteIndex)
  {
<span class="udiff-line-modified-removed">-     if (!makesCalls)</span>
<span class="udiff-line-modified-added">+     if (!makesCalls) {</span>
<span class="udiff-line-added">+         // Allocating CallLinkInfos means we should have calls.</span>
<span class="udiff-line-added">+         ASSERT(callLinkInfos.isEmpty());</span>
          return adoptRef(*new JITStubRoutine(code));
<span class="udiff-line-added">+     }</span>
  
      if (codeBlockForExceptionHandlers) {
          RELEASE_ASSERT(JITCode::isOptimizingJIT(codeBlockForExceptionHandlers-&gt;jitType()));
<span class="udiff-line-modified-removed">-         return adoptRef(*new GCAwareJITStubRoutineWithExceptionHandler(code, vm, owner, cells, codeBlockForExceptionHandlers, exceptionHandlerCallSiteIndex));</span>
<span class="udiff-line-modified-added">+         return adoptRef(*new GCAwareJITStubRoutineWithExceptionHandler(code, vm, owner, cells, WTFMove(callLinkInfos), codeBlockForExceptionHandlers, exceptionHandlerCallSiteIndex));</span>
      }
  
<span class="udiff-line-modified-removed">-     if (cells.isEmpty())</span>
<span class="udiff-line-modified-removed">-         return adoptRef(*new GCAwareJITStubRoutine(code, vm));</span>
<span class="udiff-line-modified-added">+     if (cells.isEmpty() &amp;&amp; callLinkInfos.isEmpty())</span>
<span class="udiff-line-modified-added">+         return GCAwareJITStubRoutine::create(code, vm);</span>
  
<span class="udiff-line-modified-removed">-     return adoptRef(*new MarkingGCAwareJITStubRoutine(code, vm, owner, cells));</span>
<span class="udiff-line-modified-added">+     return adoptRef(*new MarkingGCAwareJITStubRoutine(code, vm, owner, cells, WTFMove(callLinkInfos)));</span>
  }
  
  } // namespace JSC
  
  #endif // ENABLE(JIT)
</pre>
<center><a href="FPRInfo.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="GCAwareJITStubRoutine.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>