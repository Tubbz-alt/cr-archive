<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/ModuleLoader.js</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MapPrototype.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ObjectConstructor.js.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/ModuleLoader.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
105 function ensureRegistered(key)
106 {
107     // https://whatwg.github.io/loader/#ensure-registered
108 
109     &quot;use strict&quot;;
110 
111     var entry = this.registry.@get(key);
112     if (entry)
113         return entry;
114 
115     entry = @newRegistryEntry(key);
116     this.registry.@set(key, entry);
117 
118     return entry;
119 }
120 
121 function forceFulfillPromise(promise, value)
122 {
123     &quot;use strict&quot;;
124 
<span class="line-modified">125     if (@getByIdDirectPrivate(promise, &quot;promiseState&quot;) === @promiseStatePending)</span>


126         @fulfillPromise(promise, value);
127 }
128 
129 function fulfillFetch(entry, source)
130 {
131     // https://whatwg.github.io/loader/#fulfill-fetch
132 
133     &quot;use strict&quot;;
134 
135     if (!entry.fetch)
136         entry.fetch = @newPromiseCapability(@InternalPromise).@promise;
137     this.forceFulfillPromise(entry.fetch, source);
138     @setStateToMax(entry, @ModuleInstantiate);
139 }
140 
141 // Loader.
142 
143 function requestFetch(entry, parameters, fetcher)
144 {
145     // https://whatwg.github.io/loader/#request-fetch
</pre>
<hr />
<pre>
319 
320 function provideFetch(key, value)
321 {
322     &quot;use strict&quot;;
323 
324     var entry = this.ensureRegistered(key);
325 
326     if (entry.state &gt; @ModuleFetch)
327         @throwTypeError(&quot;Requested module is already fetched.&quot;);
328     this.fulfillFetch(entry, value);
329 }
330 
331 async function loadModule(moduleName, parameters, fetcher)
332 {
333     &quot;use strict&quot;;
334 
335     // Loader.resolve hook point.
336     // resolve: moduleName =&gt; Promise(moduleKey)
337     // Take the name and resolve it to the unique identifier for the resource location.
338     // For example, take the &quot;jquery&quot; and return the URL for the resource.
<span class="line-modified">339     let key = await this.resolve(moduleName, @undefined, fetcher);</span>
<span class="line-modified">340     let entry = await this.requestSatisfy(this.ensureRegistered(key), parameters, fetcher, new @Set);</span>
341     return entry.key;
342 }
343 
344 function linkAndEvaluateModule(key, fetcher)
345 {
346     &quot;use strict&quot;;
347 
348     var entry = this.ensureRegistered(key);
349     if (entry.state &lt; @ModuleLink)
350         @throwTypeError(&quot;Requested module is not instantiated yet.&quot;);
351 
352     this.link(entry, fetcher);
353     return this.moduleEvaluation(entry, fetcher);
354 }
355 
356 async function loadAndEvaluateModule(moduleName, parameters, fetcher)
357 {
358     &quot;use strict&quot;;
359 
<span class="line-modified">360     let key = await this.loadModule(moduleName, parameters, fetcher);</span>
361     return await this.linkAndEvaluateModule(key, fetcher);
362 }
363 
364 async function requestImportModule(key, parameters, fetcher)
365 {
366     &quot;use strict&quot;;
367 
<span class="line-modified">368     let entry = await this.requestSatisfy(this.ensureRegistered(key), parameters, fetcher, new @Set);</span>
369     this.linkAndEvaluateModule(entry.key, fetcher);
370     return this.getModuleNamespaceObject(entry.module);
371 }
372 
373 function dependencyKeysIfEvaluated(key)
374 {
375     &quot;use strict&quot;;
376 
<span class="line-modified">377     let entry = this.registry.@get(key);</span>
378     if (!entry || !entry.evaluated)
379         return null;
380 
<span class="line-modified">381     let dependencies = entry.dependencies;</span>
<span class="line-modified">382     let length = dependencies.length;</span>
<span class="line-modified">383     let result = new @Array(length);</span>
<span class="line-modified">384     for (let i = 0; i &lt; length; ++i)</span>
385         result[i] = dependencies[i].key;
386 
387     return result;
388 }
</pre>
</td>
<td>
<hr />
<pre>
105 function ensureRegistered(key)
106 {
107     // https://whatwg.github.io/loader/#ensure-registered
108 
109     &quot;use strict&quot;;
110 
111     var entry = this.registry.@get(key);
112     if (entry)
113         return entry;
114 
115     entry = @newRegistryEntry(key);
116     this.registry.@set(key, entry);
117 
118     return entry;
119 }
120 
121 function forceFulfillPromise(promise, value)
122 {
123     &quot;use strict&quot;;
124 
<span class="line-modified">125     @assert(@isPromise(promise));</span>
<span class="line-added">126 </span>
<span class="line-added">127     if ((@getPromiseInternalField(promise, @promiseFieldFlags) &amp; @promiseStateMask) === @promiseStatePending)</span>
128         @fulfillPromise(promise, value);
129 }
130 
131 function fulfillFetch(entry, source)
132 {
133     // https://whatwg.github.io/loader/#fulfill-fetch
134 
135     &quot;use strict&quot;;
136 
137     if (!entry.fetch)
138         entry.fetch = @newPromiseCapability(@InternalPromise).@promise;
139     this.forceFulfillPromise(entry.fetch, source);
140     @setStateToMax(entry, @ModuleInstantiate);
141 }
142 
143 // Loader.
144 
145 function requestFetch(entry, parameters, fetcher)
146 {
147     // https://whatwg.github.io/loader/#request-fetch
</pre>
<hr />
<pre>
321 
322 function provideFetch(key, value)
323 {
324     &quot;use strict&quot;;
325 
326     var entry = this.ensureRegistered(key);
327 
328     if (entry.state &gt; @ModuleFetch)
329         @throwTypeError(&quot;Requested module is already fetched.&quot;);
330     this.fulfillFetch(entry, value);
331 }
332 
333 async function loadModule(moduleName, parameters, fetcher)
334 {
335     &quot;use strict&quot;;
336 
337     // Loader.resolve hook point.
338     // resolve: moduleName =&gt; Promise(moduleKey)
339     // Take the name and resolve it to the unique identifier for the resource location.
340     // For example, take the &quot;jquery&quot; and return the URL for the resource.
<span class="line-modified">341     var key = await this.resolve(moduleName, @undefined, fetcher);</span>
<span class="line-modified">342     var entry = await this.requestSatisfy(this.ensureRegistered(key), parameters, fetcher, new @Set);</span>
343     return entry.key;
344 }
345 
346 function linkAndEvaluateModule(key, fetcher)
347 {
348     &quot;use strict&quot;;
349 
350     var entry = this.ensureRegistered(key);
351     if (entry.state &lt; @ModuleLink)
352         @throwTypeError(&quot;Requested module is not instantiated yet.&quot;);
353 
354     this.link(entry, fetcher);
355     return this.moduleEvaluation(entry, fetcher);
356 }
357 
358 async function loadAndEvaluateModule(moduleName, parameters, fetcher)
359 {
360     &quot;use strict&quot;;
361 
<span class="line-modified">362     var key = await this.loadModule(moduleName, parameters, fetcher);</span>
363     return await this.linkAndEvaluateModule(key, fetcher);
364 }
365 
366 async function requestImportModule(key, parameters, fetcher)
367 {
368     &quot;use strict&quot;;
369 
<span class="line-modified">370     var entry = await this.requestSatisfy(this.ensureRegistered(key), parameters, fetcher, new @Set);</span>
371     this.linkAndEvaluateModule(entry.key, fetcher);
372     return this.getModuleNamespaceObject(entry.module);
373 }
374 
375 function dependencyKeysIfEvaluated(key)
376 {
377     &quot;use strict&quot;;
378 
<span class="line-modified">379     var entry = this.registry.@get(key);</span>
380     if (!entry || !entry.evaluated)
381         return null;
382 
<span class="line-modified">383     var dependencies = entry.dependencies;</span>
<span class="line-modified">384     var length = dependencies.length;</span>
<span class="line-modified">385     var result = new @Array(length);</span>
<span class="line-modified">386     for (var i = 0; i &lt; length; ++i)</span>
387         result[i] = dependencies[i].key;
388 
389     return result;
390 }
</pre>
</td>
</tr>
</table>
<center><a href="MapPrototype.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ObjectConstructor.js.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>