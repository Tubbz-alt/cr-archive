<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/html/HTMLFrameElementBase.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HTMLFrameElement.idl.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HTMLFrameElementBase.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/html/HTMLFrameElementBase.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 76         RefPtr&lt;Document&gt; contentDocument = this-&gt;contentDocument();
 77         if (contentDocument &amp;&amp; !ScriptController::canAccessFromCurrentOrigin(contentDocument-&gt;frame(), document()))
 78             return false;
 79     }
 80 
 81     return !isProhibitedSelfReference(completeURL);
 82 }
 83 
 84 void HTMLFrameElementBase::openURL(LockHistory lockHistory, LockBackForwardList lockBackForwardList)
 85 {
 86     if (!canLoad())
 87         return;
 88 
 89     if (m_URL.isEmpty())
 90         m_URL = WTF::blankURL().string();
 91 
 92     RefPtr&lt;Frame&gt; parentFrame = document().frame();
 93     if (!parentFrame)
 94         return;
 95 


 96     String frameName = getNameAttribute();
 97     if (frameName.isNull() &amp;&amp; UNLIKELY(document().settings().needsFrameNameFallbackToIdQuirk()))
 98         frameName = getIdAttribute();
 99 
100     parentFrame-&gt;loader().subframeLoader().requestFrame(*this, m_URL, frameName, lockHistory, lockBackForwardList);
101 }
102 
103 void HTMLFrameElementBase::parseAttribute(const QualifiedName&amp; name, const AtomString&amp; value)
104 {
<span class="line-modified">105     if (name == srcdocAttr)</span>
<span class="line-modified">106         setLocation(&quot;about:srcdoc&quot;);</span>
<span class="line-modified">107     else if (name == srcAttr &amp;&amp; !hasAttributeWithoutSynchronization(srcdocAttr))</span>





108         setLocation(stripLeadingAndTrailingHTMLSpaces(value));
109     else
110         HTMLFrameOwnerElement::parseAttribute(name, value);
111 }
112 
113 Node::InsertedIntoAncestorResult HTMLFrameElementBase::insertedIntoAncestor(InsertionType insertionType, ContainerNode&amp; parentOfInsertedTree)
114 {
115     HTMLFrameOwnerElement::insertedIntoAncestor(insertionType, parentOfInsertedTree);
116     if (insertionType.connectedToDocument)
117         return InsertedIntoAncestorResult::NeedsPostInsertionCallback;
118     return InsertedIntoAncestorResult::Done;
119 }
120 
121 void HTMLFrameElementBase::didFinishInsertingNode()
122 {
123     if (!isConnected())
124         return;
125 
126     // DocumentFragments don&#39;t kick off any loads.
127     if (!document().frame())
</pre>
<hr />
<pre>
144 }
145 
146 URL HTMLFrameElementBase::location() const
147 {
148     if (hasAttributeWithoutSynchronization(srcdocAttr))
149         return URL({ }, &quot;about:srcdoc&quot;);
150     return document().completeURL(attributeWithoutSynchronization(srcAttr));
151 }
152 
153 void HTMLFrameElementBase::setLocation(const String&amp; str)
154 {
155     if (document().settings().needsAcrobatFrameReloadingQuirk() &amp;&amp; m_URL == str)
156         return;
157 
158     m_URL = AtomString(str);
159 
160     if (isConnected())
161         openURL(LockHistory::No, LockBackForwardList::No);
162 }
163 
<span class="line-modified">164 void HTMLFrameElementBase::setLocation(JSC::ExecState&amp; state, const String&amp; newLocation)</span>
165 {
166     if (WTF::protocolIsJavaScript(stripLeadingAndTrailingHTMLSpaces(newLocation))) {
167         if (!BindingSecurity::shouldAllowAccessToNode(state, contentDocument()))
168             return;
169     }
170 
171     setLocation(newLocation);
172 }
173 
174 bool HTMLFrameElementBase::supportsFocus() const
175 {
176     return true;
177 }
178 
179 void HTMLFrameElementBase::setFocus(bool received)
180 {
181     HTMLFrameOwnerElement::setFocus(received);
182     if (Page* page = document().page()) {
183         if (received)
184             page-&gt;focusController().setFocusedFrame(contentFrame());
</pre>
</td>
<td>
<hr />
<pre>
 76         RefPtr&lt;Document&gt; contentDocument = this-&gt;contentDocument();
 77         if (contentDocument &amp;&amp; !ScriptController::canAccessFromCurrentOrigin(contentDocument-&gt;frame(), document()))
 78             return false;
 79     }
 80 
 81     return !isProhibitedSelfReference(completeURL);
 82 }
 83 
 84 void HTMLFrameElementBase::openURL(LockHistory lockHistory, LockBackForwardList lockBackForwardList)
 85 {
 86     if (!canLoad())
 87         return;
 88 
 89     if (m_URL.isEmpty())
 90         m_URL = WTF::blankURL().string();
 91 
 92     RefPtr&lt;Frame&gt; parentFrame = document().frame();
 93     if (!parentFrame)
 94         return;
 95 
<span class="line-added"> 96     document().willLoadFrameElement(parentFrame-&gt;document()-&gt;completeURL(m_URL));</span>
<span class="line-added"> 97 </span>
 98     String frameName = getNameAttribute();
 99     if (frameName.isNull() &amp;&amp; UNLIKELY(document().settings().needsFrameNameFallbackToIdQuirk()))
100         frameName = getIdAttribute();
101 
102     parentFrame-&gt;loader().subframeLoader().requestFrame(*this, m_URL, frameName, lockHistory, lockBackForwardList);
103 }
104 
105 void HTMLFrameElementBase::parseAttribute(const QualifiedName&amp; name, const AtomString&amp; value)
106 {
<span class="line-modified">107     if (name == srcdocAttr) {</span>
<span class="line-modified">108         if (value.isNull()) {</span>
<span class="line-modified">109             const AtomString&amp; srcValue = attributeWithoutSynchronization(srcAttr);</span>
<span class="line-added">110             if (!srcValue.isNull())</span>
<span class="line-added">111                 setLocation(stripLeadingAndTrailingHTMLSpaces(srcValue));</span>
<span class="line-added">112         } else</span>
<span class="line-added">113             setLocation(&quot;about:srcdoc&quot;);</span>
<span class="line-added">114     } else if (name == srcAttr &amp;&amp; !hasAttributeWithoutSynchronization(srcdocAttr))</span>
115         setLocation(stripLeadingAndTrailingHTMLSpaces(value));
116     else
117         HTMLFrameOwnerElement::parseAttribute(name, value);
118 }
119 
120 Node::InsertedIntoAncestorResult HTMLFrameElementBase::insertedIntoAncestor(InsertionType insertionType, ContainerNode&amp; parentOfInsertedTree)
121 {
122     HTMLFrameOwnerElement::insertedIntoAncestor(insertionType, parentOfInsertedTree);
123     if (insertionType.connectedToDocument)
124         return InsertedIntoAncestorResult::NeedsPostInsertionCallback;
125     return InsertedIntoAncestorResult::Done;
126 }
127 
128 void HTMLFrameElementBase::didFinishInsertingNode()
129 {
130     if (!isConnected())
131         return;
132 
133     // DocumentFragments don&#39;t kick off any loads.
134     if (!document().frame())
</pre>
<hr />
<pre>
151 }
152 
153 URL HTMLFrameElementBase::location() const
154 {
155     if (hasAttributeWithoutSynchronization(srcdocAttr))
156         return URL({ }, &quot;about:srcdoc&quot;);
157     return document().completeURL(attributeWithoutSynchronization(srcAttr));
158 }
159 
160 void HTMLFrameElementBase::setLocation(const String&amp; str)
161 {
162     if (document().settings().needsAcrobatFrameReloadingQuirk() &amp;&amp; m_URL == str)
163         return;
164 
165     m_URL = AtomString(str);
166 
167     if (isConnected())
168         openURL(LockHistory::No, LockBackForwardList::No);
169 }
170 
<span class="line-modified">171 void HTMLFrameElementBase::setLocation(JSC::JSGlobalObject&amp; state, const String&amp; newLocation)</span>
172 {
173     if (WTF::protocolIsJavaScript(stripLeadingAndTrailingHTMLSpaces(newLocation))) {
174         if (!BindingSecurity::shouldAllowAccessToNode(state, contentDocument()))
175             return;
176     }
177 
178     setLocation(newLocation);
179 }
180 
181 bool HTMLFrameElementBase::supportsFocus() const
182 {
183     return true;
184 }
185 
186 void HTMLFrameElementBase::setFocus(bool received)
187 {
188     HTMLFrameOwnerElement::setFocus(received);
189     if (Page* page = document().page()) {
190         if (received)
191             page-&gt;focusController().setFocusedFrame(contentFrame());
</pre>
</td>
</tr>
</table>
<center><a href="HTMLFrameElement.idl.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HTMLFrameElementBase.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>