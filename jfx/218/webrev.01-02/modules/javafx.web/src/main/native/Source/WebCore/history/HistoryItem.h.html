<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/history/HistoryItem.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2006, 2008, 2011, 2014 Apple Inc. All rights reserved.
  3  * Copyright (C) 2012 Research In Motion Limited. All rights reserved.
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  * 1. Redistributions of source code must retain the above copyright
  9  *    notice, this list of conditions and the following disclaimer.
 10  * 2. Redistributions in binary form must reproduce the above copyright
 11  *    notice, this list of conditions and the following disclaimer in the
 12  *    documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 15  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 16  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 18  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 19  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 20  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 21  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 22  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 24  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 25  */
 26 
 27 #pragma once
 28 
 29 #include &quot;BackForwardItemIdentifier.h&quot;
 30 #include &quot;FloatRect.h&quot;
 31 #include &quot;FrameLoaderTypes.h&quot;
 32 #include &quot;IntPoint.h&quot;
 33 #include &quot;IntRect.h&quot;
 34 #include &quot;LengthBox.h&quot;
 35 #include &quot;SerializedScriptValue.h&quot;
 36 #include &lt;memory&gt;
 37 #include &lt;wtf/RefCounted.h&gt;
 38 #include &lt;wtf/text/WTFString.h&gt;
 39 
 40 #if PLATFORM(JAVA)
 41 #include &lt;wtf/java/JavaRef.h&gt;
 42 #endif
 43 
 44 #if PLATFORM(IOS_FAMILY)
 45 #include &quot;ViewportArguments.h&quot;
 46 #endif
 47 
 48 #if PLATFORM(COCOA)
 49 #import &lt;wtf/RetainPtr.h&gt;
 50 typedef struct objc_object* id;
 51 #endif
 52 
 53 namespace WebCore {
 54 
 55 class CachedPage;
 56 class Document;
 57 class FormData;
 58 class HistoryItem;
 59 class Image;
 60 class ResourceRequest;
 61 enum class PruningReason;
 62 
 63 WEBCORE_EXPORT extern void (*notifyHistoryItemChanged)(HistoryItem&amp;);
 64 
 65 class HistoryItem : public RefCounted&lt;HistoryItem&gt; {
 66     friend class BackForwardCache;
 67 
 68 public:
 69     static Ref&lt;HistoryItem&gt; create()
 70     {
 71         return adoptRef(*new HistoryItem);
 72     }
 73 
 74     static Ref&lt;HistoryItem&gt; create(const String&amp; urlString, const String&amp; title)
 75     {
 76         return adoptRef(*new HistoryItem(urlString, title));
 77     }
 78 
 79     static Ref&lt;HistoryItem&gt; create(const String&amp; urlString, const String&amp; title, const String&amp; alternateTitle)
 80     {
 81         return adoptRef(*new HistoryItem(urlString, title, alternateTitle));
 82     }
 83 
 84     static Ref&lt;HistoryItem&gt; create(const String&amp; urlString, const String&amp; title, const String&amp; alternateTitle, BackForwardItemIdentifier identifier)
 85     {
 86         return adoptRef(*new HistoryItem(urlString, title, alternateTitle, identifier));
 87     }
 88 
 89     WEBCORE_EXPORT ~HistoryItem();
 90 
 91     WEBCORE_EXPORT Ref&lt;HistoryItem&gt; copy() const;
 92 
 93     const BackForwardItemIdentifier&amp; identifier() const { return m_identifier; }
 94 
 95     // Resets the HistoryItem to its initial state, as returned by create().
 96     void reset();
 97 
 98     WEBCORE_EXPORT const String&amp; originalURLString() const;
 99     WEBCORE_EXPORT const String&amp; urlString() const;
100     WEBCORE_EXPORT const String&amp; title() const;
101 
102     bool isInBackForwardCache() const { return m_cachedPage.get(); }
103     WEBCORE_EXPORT bool hasCachedPageExpired() const;
104 
105     WEBCORE_EXPORT void setAlternateTitle(const String&amp;);
106     WEBCORE_EXPORT const String&amp; alternateTitle() const;
107 
108     WEBCORE_EXPORT URL url() const;
109     WEBCORE_EXPORT URL originalURL() const;
110     WEBCORE_EXPORT const String&amp; referrer() const;
111     WEBCORE_EXPORT const String&amp; target() const;
112     WEBCORE_EXPORT bool isTargetItem() const;
113 
114     WEBCORE_EXPORT FormData* formData();
115     WEBCORE_EXPORT String formContentType() const;
116 
117     bool lastVisitWasFailure() const { return m_lastVisitWasFailure; }
118 
119     WEBCORE_EXPORT const IntPoint&amp; scrollPosition() const;
120     WEBCORE_EXPORT void setScrollPosition(const IntPoint&amp;);
121     void clearScrollPosition();
122 
123     WEBCORE_EXPORT bool shouldRestoreScrollPosition() const;
124     WEBCORE_EXPORT void setShouldRestoreScrollPosition(bool);
125 
126     WEBCORE_EXPORT float pageScaleFactor() const;
127     WEBCORE_EXPORT void setPageScaleFactor(float);
128 
129     WEBCORE_EXPORT const Vector&lt;String&gt;&amp; documentState() const;
130     WEBCORE_EXPORT void setDocumentState(const Vector&lt;String&gt;&amp;);
131     void clearDocumentState();
132 
133     WEBCORE_EXPORT void setShouldOpenExternalURLsPolicy(ShouldOpenExternalURLsPolicy);
134     WEBCORE_EXPORT ShouldOpenExternalURLsPolicy shouldOpenExternalURLsPolicy() const;
135 
136     void setURL(const URL&amp;);
137     WEBCORE_EXPORT void setURLString(const String&amp;);
138     WEBCORE_EXPORT void setOriginalURLString(const String&amp;);
139     WEBCORE_EXPORT void setReferrer(const String&amp;);
140     WEBCORE_EXPORT void setTarget(const String&amp;);
141     WEBCORE_EXPORT void setTitle(const String&amp;);
142     WEBCORE_EXPORT void setIsTargetItem(bool);
143 
144     WEBCORE_EXPORT void setStateObject(RefPtr&lt;SerializedScriptValue&gt;&amp;&amp;);
145     SerializedScriptValue* stateObject() const { return m_stateObject.get(); }
146 
147     void setItemSequenceNumber(long long number) { m_itemSequenceNumber = number; }
148     long long itemSequenceNumber() const { return m_itemSequenceNumber; }
149 
150     void setDocumentSequenceNumber(long long number) { m_documentSequenceNumber = number; }
151     long long documentSequenceNumber() const { return m_documentSequenceNumber; }
152 
153     void setFormInfoFromRequest(const ResourceRequest&amp;);
154     WEBCORE_EXPORT void setFormData(RefPtr&lt;FormData&gt;&amp;&amp;);
155     WEBCORE_EXPORT void setFormContentType(const String&amp;);
156 
157     void setLastVisitWasFailure(bool wasFailure) { m_lastVisitWasFailure = wasFailure; }
158 
159     WEBCORE_EXPORT void addChildItem(Ref&lt;HistoryItem&gt;&amp;&amp;);
160     void setChildItem(Ref&lt;HistoryItem&gt;&amp;&amp;);
161     WEBCORE_EXPORT HistoryItem* childItemWithTarget(const String&amp;);
162     HistoryItem* childItemWithDocumentSequenceNumber(long long number);
163     WEBCORE_EXPORT const Vector&lt;Ref&lt;HistoryItem&gt;&gt;&amp; children() const;
164     WEBCORE_EXPORT bool hasChildren() const;
165     void clearChildren();
166 
167     bool shouldDoSameDocumentNavigationTo(HistoryItem&amp; otherItem) const;
168     bool hasSameFrames(HistoryItem&amp; otherItem) const;
169 
170     bool isCurrentDocument(Document&amp;) const;
171 
172 #if PLATFORM(COCOA)
173     WEBCORE_EXPORT id viewState() const;
174     WEBCORE_EXPORT void setViewState(id);
175 #endif
176 #if PLATFORM(JAVA)
177     JLObject hostObject();
178     void setHostObject(const JLObject&amp;);
179 #endif
180 
181 #ifndef NDEBUG
182     int showTree() const;
183     int showTreeWithIndent(unsigned indentLevel) const;
184 #endif
185 
186 #if PLATFORM(IOS_FAMILY)
187     FloatRect exposedContentRect() const { return m_exposedContentRect; }
188     void setExposedContentRect(FloatRect exposedContentRect) { m_exposedContentRect = exposedContentRect; }
189 
190     IntRect unobscuredContentRect() const { return m_unobscuredContentRect; }
191     void setUnobscuredContentRect(IntRect unobscuredContentRect) { m_unobscuredContentRect = unobscuredContentRect; }
192 
193     const FloatBoxExtent&amp; obscuredInsets() const { return m_obscuredInsets; }
194     void setObscuredInsets(const FloatBoxExtent&amp; insets) { m_obscuredInsets = insets; }
195 
196     FloatSize minimumLayoutSizeInScrollViewCoordinates() const { return m_minimumLayoutSizeInScrollViewCoordinates; }
197     void setMinimumLayoutSizeInScrollViewCoordinates(FloatSize minimumLayoutSizeInScrollViewCoordinates) { m_minimumLayoutSizeInScrollViewCoordinates = minimumLayoutSizeInScrollViewCoordinates; }
198 
199     IntSize contentSize() const { return m_contentSize; }
200     void setContentSize(IntSize contentSize) { m_contentSize = contentSize; }
201 
202     float scale() const { return m_scale; }
203     bool scaleIsInitial() const { return m_scaleIsInitial; }
204     void setScaleIsInitial(bool scaleIsInitial) { m_scaleIsInitial = scaleIsInitial; }
205     void setScale(float newScale, bool isInitial)
206     {
207         m_scale = newScale;
208         m_scaleIsInitial = isInitial;
209     }
210 
211     const ViewportArguments&amp; viewportArguments() const { return m_viewportArguments; }
212     void setViewportArguments(const ViewportArguments&amp; viewportArguments) { m_viewportArguments = viewportArguments; }
213 #endif
214 
215     void notifyChanged();
216 
217     void setWasRestoredFromSession(bool wasRestoredFromSession) { m_wasRestoredFromSession = wasRestoredFromSession; }
218     bool wasRestoredFromSession() const { return m_wasRestoredFromSession; }
219 
220 #if !LOG_DISABLED
221     const char* logString() const;
222 #endif
223 
224 private:
225     WEBCORE_EXPORT HistoryItem();
226     WEBCORE_EXPORT HistoryItem(const String&amp; urlString, const String&amp; title);
227     WEBCORE_EXPORT HistoryItem(const String&amp; urlString, const String&amp; title, const String&amp; alternateTitle);
228     WEBCORE_EXPORT HistoryItem(const String&amp; urlString, const String&amp; title, const String&amp; alternateTitle, BackForwardItemIdentifier);
229 
230     void setCachedPage(std::unique_ptr&lt;CachedPage&gt;&amp;&amp;);
231     std::unique_ptr&lt;CachedPage&gt; takeCachedPage();
232 
233     HistoryItem(const HistoryItem&amp;);
234 
235     static int64_t generateSequenceNumber();
236 
237     bool hasSameDocumentTree(HistoryItem&amp; otherItem) const;
238 
239     String m_urlString;
240     String m_originalURLString;
241     String m_referrer;
242     String m_target;
243     String m_title;
244     String m_displayTitle;
245 
246     IntPoint m_scrollPosition;
247     float m_pageScaleFactor { 0 }; // 0 indicates &quot;unset&quot;.
248     Vector&lt;String&gt; m_documentState;
249 
250     ShouldOpenExternalURLsPolicy m_shouldOpenExternalURLsPolicy { ShouldOpenExternalURLsPolicy::ShouldNotAllow };
251 
252     Vector&lt;Ref&lt;HistoryItem&gt;&gt; m_children;
253 
254     bool m_lastVisitWasFailure { false };
255     bool m_isTargetItem { false };
256     bool m_wasRestoredFromSession { false };
257     bool m_shouldRestoreScrollPosition { true };
258 
259     // If two HistoryItems have the same item sequence number, then they are
260     // clones of one another.  Traversing history from one such HistoryItem to
261     // another is a no-op.  HistoryItem clones are created for parent and
262     // sibling frames when only a subframe navigates.
263     int64_t m_itemSequenceNumber { generateSequenceNumber() };
264 
265     // If two HistoryItems have the same document sequence number, then they
266     // refer to the same instance of a document.  Traversing history from one
267     // such HistoryItem to another preserves the document.
268     int64_t m_documentSequenceNumber { generateSequenceNumber() };
269 
270     // Support for HTML5 History
271     RefPtr&lt;SerializedScriptValue&gt; m_stateObject;
272 
273     // info used to repost form data
274     RefPtr&lt;FormData&gt; m_formData;
275     String m_formContentType;
276 
277     // BackForwardCache controls these fields.
278     std::unique_ptr&lt;CachedPage&gt; m_cachedPage;
279     PruningReason m_pruningReason;
280 
281 #if PLATFORM(IOS_FAMILY)
282     FloatRect m_exposedContentRect;
283     IntRect m_unobscuredContentRect;
284     FloatSize m_minimumLayoutSizeInScrollViewCoordinates;
285     IntSize m_contentSize;
286     FloatBoxExtent m_obscuredInsets;
287     float m_scale { 0 }; // Note that UIWebView looks for a non-zero value, so this has to start as 0.
288     bool m_scaleIsInitial { false };
289     ViewportArguments m_viewportArguments;
290 #endif
291 
292 #if PLATFORM(JAVA)
293     JGObject m_hostObject { nullptr };
294 #endif
295 
296 #if PLATFORM(COCOA)
297     RetainPtr&lt;id&gt; m_viewState;
298 #endif
299 
300     BackForwardItemIdentifier m_identifier;
301 };
302 
303 } // namespace WebCore
304 
305 #if ENABLE(TREE_DEBUGGING)
306 // Outside the WebCore namespace for ease of invocation from the debugger.
307 extern &quot;C&quot; int showTree(const WebCore::HistoryItem*);
308 #endif
    </pre>
  </body>
</html>