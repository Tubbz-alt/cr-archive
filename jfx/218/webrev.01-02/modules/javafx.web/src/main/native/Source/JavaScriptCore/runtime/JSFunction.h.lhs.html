<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSFunction.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  *  Copyright (C) 1999-2000 Harri Porten (porten@kde.org)
  3  *  Copyright (C) 2003-2019 Apple Inc. All rights reserved.
  4  *  Copyright (C) 2007 Cameron Zwarich (cwzwarich@uwaterloo.ca)
  5  *  Copyright (C) 2007 Maks Orlovich
  6  *
  7  *  This library is free software; you can redistribute it and/or
  8  *  modify it under the terms of the GNU Library General Public
  9  *  License as published by the Free Software Foundation; either
 10  *  version 2 of the License, or (at your option) any later version.
 11  *
 12  *  This library is distributed in the hope that it will be useful,
 13  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 14  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 15  *  Library General Public License for more details.
 16  *
 17  *  You should have received a copy of the GNU Library General Public License
 18  *  along with this library; see the file COPYING.LIB.  If not, write to
 19  *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 20  *  Boston, MA 02110-1301, USA.
 21  *
 22  */
 23 
 24 #pragma once
 25 
 26 #include &quot;FunctionRareData.h&quot;
 27 #include &quot;InternalFunction.h&quot;
 28 #include &quot;JSCallee.h&quot;
 29 #include &quot;JSScope.h&quot;
 30 
 31 namespace JSC {
 32 
 33 class ExecutableBase;
 34 class FunctionExecutable;
 35 class FunctionPrototype;
 36 class JSLexicalEnvironment;
 37 class JSGlobalObject;
 38 class LLIntOffsetsExtractor;
 39 class NativeExecutable;
 40 class SourceCode;
 41 class InternalFunction;
 42 namespace DFG {
 43 class SpeculativeJIT;
 44 class JITCompiler;
 45 }
 46 
 47 namespace DOMJIT {
 48 class Signature;
 49 }
 50 
 51 
<a name="1" id="anc1"></a><span class="line-modified"> 52 JS_EXPORT_PRIVATE EncodedJSValue JSC_HOST_CALL callHostFunctionAsConstructor(ExecState*);</span>
 53 
 54 JS_EXPORT_PRIVATE String getCalculatedDisplayName(VM&amp;, JSObject*);
 55 
 56 class JSFunction : public JSCallee {
 57     friend class JIT;
 58     friend class DFG::SpeculativeJIT;
 59     friend class DFG::JITCompiler;
 60     friend class VM;
 61     friend class InternalFunction;
 62 
 63 public:
<a name="2" id="anc2"></a>
 64 
 65     template&lt;typename CellType, SubspaceAccess&gt;
 66     static IsoSubspace* subspaceFor(VM&amp; vm)
 67     {
 68         return &amp;vm.functionSpace;
 69     }
 70 
 71     typedef JSCallee Base;
<a name="3" id="anc3"></a><span class="line-modified"> 72     const static unsigned StructureFlags = Base::StructureFlags | OverridesGetOwnPropertySlot | OverridesGetPropertyNames | OverridesGetCallData;</span>
 73 
 74     static size_t allocationSize(Checked&lt;size_t&gt; inlineCapacity)
 75     {
 76         ASSERT_UNUSED(inlineCapacity, !inlineCapacity);
 77         return sizeof(JSFunction);
 78     }
 79 
 80     static Structure* selectStructureForNewFuncExp(JSGlobalObject*, FunctionExecutable*);
 81 
 82     JS_EXPORT_PRIVATE static JSFunction* create(VM&amp;, JSGlobalObject*, int length, const String&amp; name, NativeFunction, Intrinsic = NoIntrinsic, NativeFunction nativeConstructor = callHostFunctionAsConstructor, const DOMJIT::Signature* = nullptr);
 83     JS_EXPORT_PRIVATE static JSFunction* createFunctionThatMasqueradesAsUndefined(VM&amp;, JSGlobalObject*, int length, const String&amp; name, NativeFunction, Intrinsic = NoIntrinsic, NativeFunction nativeConstructor = callHostFunctionAsConstructor, const DOMJIT::Signature* = nullptr);
 84 
 85     static JSFunction* createWithInvalidatedReallocationWatchpoint(VM&amp;, FunctionExecutable*, JSScope*);
 86 
 87     JS_EXPORT_PRIVATE static JSFunction* create(VM&amp;, FunctionExecutable*, JSScope*);
 88     static JSFunction* create(VM&amp;, FunctionExecutable*, JSScope*, Structure*);
 89 
 90     JS_EXPORT_PRIVATE String name(VM&amp;);
 91     JS_EXPORT_PRIVATE String displayName(VM&amp;);
 92     JS_EXPORT_PRIVATE const String calculatedDisplayName(VM&amp;);
 93 
<a name="4" id="anc4"></a><span class="line-modified"> 94     ExecutableBase* executable() const { return m_executable.get(); }</span>






 95 
 96     // To call any of these methods include JSFunctionInlines.h
 97     bool isHostFunction() const;
 98     FunctionExecutable* jsExecutable() const;
 99     Intrinsic intrinsic() const;
100 
101     JS_EXPORT_PRIVATE const SourceCode* sourceCode() const;
102 
103     DECLARE_EXPORT_INFO;
104 
105     static Structure* createStructure(VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
106     {
107         ASSERT(globalObject);
108         return Structure::create(vm, globalObject, prototype, TypeInfo(JSFunctionType, StructureFlags), info());
109     }
110 
111     TaggedNativeFunction nativeFunction();
112     TaggedNativeFunction nativeConstructor();
113 
<a name="5" id="anc5"></a><span class="line-modified">114     static ConstructType getConstructData(JSCell*, ConstructData&amp;);</span>
<span class="line-modified">115     static CallType getCallData(JSCell*, CallData&amp;);</span>
<span class="line-removed">116 </span>
<span class="line-removed">117     static inline ptrdiff_t offsetOfExecutable()</span>
<span class="line-removed">118     {</span>
<span class="line-removed">119         return OBJECT_OFFSETOF(JSFunction, m_executable);</span>
<span class="line-removed">120     }</span>
121 
<a name="6" id="anc6"></a><span class="line-modified">122     static inline ptrdiff_t offsetOfRareData()</span>
123     {
<a name="7" id="anc7"></a><span class="line-modified">124         return OBJECT_OFFSETOF(JSFunction, m_rareData);</span>
125     }
126 
<a name="8" id="anc8"></a><span class="line-modified">127     FunctionRareData* rareData(VM&amp; vm)</span>
128     {
<a name="9" id="anc9"></a><span class="line-modified">129         if (UNLIKELY(!m_rareData))</span>

130             return allocateRareData(vm);
<a name="10" id="anc10"></a><span class="line-modified">131         return m_rareData.get();</span>
132     }
133 
<a name="11" id="anc11"></a><span class="line-modified">134     FunctionRareData* ensureRareDataAndAllocationProfile(ExecState*, unsigned inlineCapacity);</span>
135 
<a name="12" id="anc12"></a><span class="line-modified">136     FunctionRareData* rareData()</span>
137     {
<a name="13" id="anc13"></a><span class="line-modified">138         FunctionRareData* rareData = m_rareData.get();</span>
<span class="line-modified">139 </span>
<span class="line-modified">140         // The JS thread may be concurrently creating the rare data</span>
<span class="line-modified">141         // If we see it, we want to ensure it has been properly created</span>
<span class="line-removed">142         WTF::loadLoadFence();</span>
<span class="line-removed">143 </span>
<span class="line-removed">144         return rareData;</span>
145     }
146 
147     bool isHostOrBuiltinFunction() const;
148     bool isBuiltinFunction() const;
<a name="14" id="anc14"></a><span class="line-removed">149     bool isAnonymousBuiltinFunction() const;</span>
150     JS_EXPORT_PRIVATE bool isHostFunctionNonInline() const;
151     bool isClassConstructorFunction() const;
152 
<a name="15" id="anc15"></a><span class="line-modified">153     void setFunctionName(ExecState*, JSValue name);</span>
154 
155     // Returns the __proto__ for the |this| value if this JSFunction were to be constructed.
<a name="16" id="anc16"></a><span class="line-modified">156     JSObject* prototypeForConstruction(VM&amp;, ExecState*);</span>
157 
158     bool canUseAllocationProfile();
159     bool canUseAllocationProfileNonInline();
160 
161     enum class PropertyStatus {
162         Eager,
163         Lazy,
164         Reified,
165     };
<a name="17" id="anc17"></a><span class="line-modified">166     PropertyStatus reifyLazyPropertyIfNeeded(VM&amp;, ExecState*, PropertyName);</span>


167 
168 protected:
<a name="18" id="anc18"></a><span class="line-modified">169     JS_EXPORT_PRIVATE JSFunction(VM&amp;, JSGlobalObject*, Structure*);</span>
170     JSFunction(VM&amp;, FunctionExecutable*, JSScope*, Structure*);
171 
172     void finishCreation(VM&amp;, NativeExecutable*, int length, const String&amp; name);
173     void finishCreation(VM&amp;);
174 
<a name="19" id="anc19"></a><span class="line-modified">175     static bool getOwnPropertySlot(JSObject*, ExecState*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">176     static void getOwnNonIndexPropertyNames(JSObject*, ExecState*, PropertyNameArray&amp;, EnumerationMode = EnumerationMode());</span>
<span class="line-modified">177     static bool defineOwnProperty(JSObject*, ExecState*, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow);</span>
178 
<a name="20" id="anc20"></a><span class="line-modified">179     static bool put(JSCell*, ExecState*, PropertyName, JSValue, PutPropertySlot&amp;);</span>
180 
<a name="21" id="anc21"></a><span class="line-modified">181     static bool deleteProperty(JSCell*, ExecState*, PropertyName);</span>
182 
183     static void visitChildren(JSCell*, SlotVisitor&amp;);
184 
185 private:
186     static JSFunction* createImpl(VM&amp; vm, FunctionExecutable* executable, JSScope* scope, Structure* structure)
187     {
188         JSFunction* function = new (NotNull, allocateCell&lt;JSFunction&gt;(vm.heap)) JSFunction(vm, executable, scope, structure);
189         ASSERT(function-&gt;structure(vm)-&gt;globalObject());
190         function-&gt;finishCreation(vm);
191         return function;
192     }
193 
194     FunctionRareData* allocateRareData(VM&amp;);
<a name="22" id="anc22"></a><span class="line-modified">195     FunctionRareData* allocateAndInitializeRareData(ExecState*, size_t inlineCapacity);</span>
<span class="line-modified">196     FunctionRareData* initializeRareData(ExecState*, size_t inlineCapacity);</span>
197 
198     bool hasReifiedLength() const;
199     bool hasReifiedName() const;
200     void reifyLength(VM&amp;);
<a name="23" id="anc23"></a><span class="line-modified">201     void reifyName(VM&amp;, ExecState*);</span>
<span class="line-modified">202     void reifyName(VM&amp;, ExecState*, String name);</span>
203 
204     static bool isLazy(PropertyStatus property) { return property == PropertyStatus::Lazy || property == PropertyStatus::Reified; }
205     static bool isReified(PropertyStatus property) { return property == PropertyStatus::Reified; }
206 
<a name="24" id="anc24"></a><span class="line-modified">207     PropertyStatus reifyLazyPropertyForHostOrBuiltinIfNeeded(VM&amp;, ExecState*, PropertyName);</span>
<span class="line-modified">208     PropertyStatus reifyLazyLengthIfNeeded(VM&amp;, ExecState*, PropertyName);</span>
<span class="line-modified">209     PropertyStatus reifyLazyNameIfNeeded(VM&amp;, ExecState*, PropertyName);</span>
<span class="line-modified">210     PropertyStatus reifyLazyBoundNameIfNeeded(VM&amp;, ExecState*, PropertyName);</span>
211 
<a name="25" id="anc25"></a><span class="line-modified">212 #if ASSERT_DISABLED</span>
<span class="line-removed">213     void assertTypeInfoFlagInvariants() { }</span>
<span class="line-removed">214 #else</span>
215     void assertTypeInfoFlagInvariants();
<a name="26" id="anc26"></a>

216 #endif
217 
218     friend class LLIntOffsetsExtractor;
219 
<a name="27" id="anc27"></a><span class="line-modified">220     static EncodedJSValue argumentsGetter(ExecState*, EncodedJSValue, PropertyName);</span>
<span class="line-modified">221     static EncodedJSValue callerGetter(ExecState*, EncodedJSValue, PropertyName);</span>
<span class="line-removed">222     static EncodedJSValue lengthGetter(ExecState*, EncodedJSValue, PropertyName);</span>
<span class="line-removed">223     static EncodedJSValue nameGetter(ExecState*, EncodedJSValue, PropertyName);</span>
224 
<a name="28" id="anc28"></a><span class="line-modified">225     WriteBarrier&lt;ExecutableBase&gt; m_executable;</span>
<span class="line-removed">226     WriteBarrier&lt;FunctionRareData&gt; m_rareData;</span>
227 };
228 
229 class JSStrictFunction final : public JSFunction {
230 public:
231     using Base = JSFunction;
232 
233     DECLARE_EXPORT_INFO;
234 
235     static constexpr unsigned StructureFlags = Base::StructureFlags;
236 
237     static Structure* createStructure(VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
238     {
239         ASSERT(globalObject);
240         return Structure::create(vm, globalObject, prototype, TypeInfo(JSFunctionType, StructureFlags), info());
241     }
242 };
243 static_assert(sizeof(JSStrictFunction) == sizeof(JSFunction), &quot;Allocated in JSFunction IsoSubspace&quot;);
244 
245 class JSSloppyFunction final : public JSFunction {
246 public:
247     using Base = JSFunction;
248 
249     DECLARE_EXPORT_INFO;
250 
251     static constexpr unsigned StructureFlags = Base::StructureFlags;
252 
253     static Structure* createStructure(VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
254     {
255         ASSERT(globalObject);
256         return Structure::create(vm, globalObject, prototype, TypeInfo(JSFunctionType, StructureFlags), info());
257     }
258 };
259 static_assert(sizeof(JSSloppyFunction) == sizeof(JSFunction), &quot;Allocated in JSFunction IsoSubspace&quot;);
260 
261 class JSArrowFunction final : public JSFunction {
262 public:
263     using Base = JSFunction;
264 
265     DECLARE_EXPORT_INFO;
266 
267     static constexpr unsigned StructureFlags = Base::StructureFlags;
268 
269     static Structure* createStructure(VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
270     {
271         ASSERT(globalObject);
272         return Structure::create(vm, globalObject, prototype, TypeInfo(JSFunctionType, StructureFlags), info());
273     }
274 };
275 static_assert(sizeof(JSArrowFunction) == sizeof(JSFunction), &quot;Allocated in JSFunction IsoSubspace&quot;);
276 
277 } // namespace JSC
<a name="29" id="anc29"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="29" type="hidden" />
</body>
</html>