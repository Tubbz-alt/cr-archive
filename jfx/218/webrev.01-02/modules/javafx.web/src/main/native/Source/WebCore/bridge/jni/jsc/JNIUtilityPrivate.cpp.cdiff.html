<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/bridge/jni/jsc/JNIUtilityPrivate.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="BridgeUtils.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="JNIUtilityPrivate.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bridge/jni/jsc/JNIUtilityPrivate.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 48,19 ***</span>
  
  namespace JSC {
  
  namespace Bindings {
  
<span class="line-modified">! static jchar toJCharValue(const JSValue&amp; value, ExecState* exec)</span>
  {
      // If JS type is string and target Java type is char, then
      // return the first unicode character.
      if (value.isString()) {
<span class="line-modified">!         String stringValue = value.toString(exec)-&gt;value(exec);</span>
          return (jchar)stringValue[0];
      }
<span class="line-modified">!     return (jchar)value.toNumber(exec);</span>
  }
  
  jobject convertUndefinedToJObject()
  {
      static JGObject jgoUndefined;
<span class="line-new-header">--- 48,19 ---</span>
  
  namespace JSC {
  
  namespace Bindings {
  
<span class="line-modified">! static jchar toJCharValue(const JSValue&amp; value, JSGlobalObject* globalObject)</span>
  {
      // If JS type is string and target Java type is char, then
      // return the first unicode character.
      if (value.isString()) {
<span class="line-modified">!         String stringValue = value.toString(globalObject)-&gt;value(globalObject);</span>
          return (jchar)stringValue[0];
      }
<span class="line-modified">!     return (jchar)value.toNumber(globalObject);</span>
  }
  
  jobject convertUndefinedToJObject()
  {
      static JGObject jgoUndefined;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 72,15 ***</span>
              env-&gt;GetStaticFieldID(clazz, &quot;UNDEFINED&quot;, &quot;Ljava/lang/String;&quot;)));
      }
      return jgoUndefined;
  }
  
<span class="line-modified">! jvalue convertValueToJValue(ExecState* exec, RootObject* rootObject, JSValue value, JavaType javaType, const char* javaClassName)</span>
  {
<span class="line-modified">!     JSLockHolder lock(exec);</span>
  
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
  
      jvalue result;
      memset(&amp;result, 0, sizeof(jvalue));
  
      switch (javaType) {
<span class="line-new-header">--- 72,15 ---</span>
              env-&gt;GetStaticFieldID(clazz, &quot;UNDEFINED&quot;, &quot;Ljava/lang/String;&quot;)));
      }
      return jgoUndefined;
  }
  
<span class="line-modified">! jvalue convertValueToJValue(JSGlobalObject* globalObject, RootObject* rootObject, JSValue value, JavaType javaType, const char* javaClassName)</span>
  {
<span class="line-modified">!     JSLockHolder lock(globalObject);</span>
  
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
  
      jvalue result;
      memset(&amp;result, 0, sizeof(jvalue));
  
      switch (javaType) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 147,19 ***</span>
              }
  
              // Create an appropriate Java object if target type is java.lang.Object or other wrapper Objects {Integer, Double, Boolean}.
              if (!result.l) {
                  if (value.isString() &amp;&amp; !strcmp(javaClassName, &quot;java.lang.Object&quot;)) {
<span class="line-modified">!                     String stringValue = asString(value)-&gt;value(exec);</span>
                      JNIEnv* env = getJNIEnv();
                      jobject javaString = stringValue.toJavaString(env).releaseLocal();
                      result.l = javaString;
                  } else if (value.isString() &amp;&amp; !strcmp(javaClassName, &quot;java.lang.Character&quot;)) {
                      JNIEnv* env = getJNIEnv();
                      static JGClass clazz(env-&gt;FindClass(&quot;java/lang/Character&quot;));
                      jmethodID meth = env-&gt;GetStaticMethodID(clazz, &quot;valueOf&quot;, &quot;(C)Ljava/lang/Character;&quot;);
<span class="line-modified">!                     jchar charValue = toJCharValue(value, exec);</span>
                      jobject javaChar = env-&gt;CallStaticObjectMethod(clazz, meth, charValue);
                      result.l = javaChar;
                  } else if (value.isNumber()) {
                      JNIEnv* env = getJNIEnv();
                      if (value.isInt32() &amp;&amp; (!strcmp(javaClassName, &quot;java.lang.Number&quot;) || !strcmp(javaClassName, &quot;java.lang.Integer&quot;) || !strcmp(javaClassName, &quot;java.lang.Object&quot;))) {
<span class="line-new-header">--- 147,19 ---</span>
              }
  
              // Create an appropriate Java object if target type is java.lang.Object or other wrapper Objects {Integer, Double, Boolean}.
              if (!result.l) {
                  if (value.isString() &amp;&amp; !strcmp(javaClassName, &quot;java.lang.Object&quot;)) {
<span class="line-modified">!                     String stringValue = asString(value)-&gt;value(globalObject);</span>
                      JNIEnv* env = getJNIEnv();
                      jobject javaString = stringValue.toJavaString(env).releaseLocal();
                      result.l = javaString;
                  } else if (value.isString() &amp;&amp; !strcmp(javaClassName, &quot;java.lang.Character&quot;)) {
                      JNIEnv* env = getJNIEnv();
                      static JGClass clazz(env-&gt;FindClass(&quot;java/lang/Character&quot;));
                      jmethodID meth = env-&gt;GetStaticMethodID(clazz, &quot;valueOf&quot;, &quot;(C)Ljava/lang/Character;&quot;);
<span class="line-modified">!                     jchar charValue = toJCharValue(value, globalObject);</span>
                      jobject javaChar = env-&gt;CallStaticObjectMethod(clazz, meth, charValue);
                      result.l = javaChar;
                  } else if (value.isNumber()) {
                      JNIEnv* env = getJNIEnv();
                      if (value.isInt32() &amp;&amp; (!strcmp(javaClassName, &quot;java.lang.Number&quot;) || !strcmp(javaClassName, &quot;java.lang.Integer&quot;) || !strcmp(javaClassName, &quot;java.lang.Object&quot;))) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 187,64 ***</span>
  
              // Convert value to a string if the target type is a java.lang.String, and we&#39;re not
              // converting from a null.
              if (!result.l &amp;&amp; !strcmp(javaClassName, &quot;java.lang.String&quot;)) {
                  if (!value.isNull()) {
<span class="line-modified">!                     String stringValue = value.toString(exec)-&gt;value(exec);</span>
                      JNIEnv* env = getJNIEnv();
                      jobject javaString = stringValue.toJavaString(env).releaseLocal();
                      result.l = javaString;
                  }
              }
          }
          break;
  
      case JavaTypeBoolean:
          {
<span class="line-modified">!             result.z = (jboolean)value.toNumber(exec);</span>
          }
          break;
  
      case JavaTypeByte:
          {
<span class="line-modified">!             result.b = (jbyte)value.toNumber(exec);</span>
          }
          break;
  
      case JavaTypeChar:
          {
<span class="line-modified">!             result.c = toJCharValue(value, exec);</span>
          }
          break;
  
      case JavaTypeShort:
          {
<span class="line-modified">!             result.s = (jshort)value.toNumber(exec);</span>
          }
          break;
  
      case JavaTypeInt:
          {
<span class="line-modified">!             result.i = (jint)value.toNumber(exec);</span>
          }
          break;
  
      case JavaTypeLong:
          {
<span class="line-modified">!             result.j = (jlong)value.toNumber(exec);</span>
          }
          break;
  
      case JavaTypeFloat:
          {
<span class="line-modified">!             result.f = (jfloat)value.toNumber(exec);</span>
          }
          break;
  
      case JavaTypeDouble:
          {
<span class="line-modified">!             result.d = (jdouble)value.toNumber(exec);</span>
          }
          break;
  
      case JavaTypeInvalid:
      case JavaTypeVoid:
<span class="line-new-header">--- 187,64 ---</span>
  
              // Convert value to a string if the target type is a java.lang.String, and we&#39;re not
              // converting from a null.
              if (!result.l &amp;&amp; !strcmp(javaClassName, &quot;java.lang.String&quot;)) {
                  if (!value.isNull()) {
<span class="line-modified">!                     String stringValue = value.toString(globalObject)-&gt;value(globalObject);</span>
                      JNIEnv* env = getJNIEnv();
                      jobject javaString = stringValue.toJavaString(env).releaseLocal();
                      result.l = javaString;
                  }
              }
          }
          break;
  
      case JavaTypeBoolean:
          {
<span class="line-modified">!             result.z = (jboolean)value.toNumber(globalObject);</span>
          }
          break;
  
      case JavaTypeByte:
          {
<span class="line-modified">!             result.b = (jbyte)value.toNumber(globalObject);</span>
          }
          break;
  
      case JavaTypeChar:
          {
<span class="line-modified">!             result.c = toJCharValue(value, globalObject);</span>
          }
          break;
  
      case JavaTypeShort:
          {
<span class="line-modified">!             result.s = (jshort)value.toNumber(globalObject);</span>
          }
          break;
  
      case JavaTypeInt:
          {
<span class="line-modified">!             result.i = (jint)value.toNumber(globalObject);</span>
          }
          break;
  
      case JavaTypeLong:
          {
<span class="line-modified">!             result.j = (jlong)value.toNumber(globalObject);</span>
          }
          break;
  
      case JavaTypeFloat:
          {
<span class="line-modified">!             result.f = (jfloat)value.toNumber(globalObject);</span>
          }
          break;
  
      case JavaTypeDouble:
          {
<span class="line-modified">!             result.d = (jdouble)value.toNumber(globalObject);</span>
          }
          break;
  
      case JavaTypeInvalid:
      case JavaTypeVoid:
</pre>
<center><a href="BridgeUtils.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="JNIUtilityPrivate.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>