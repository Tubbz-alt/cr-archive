<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/Scripts/wkbuiltins/builtins_generate_separate_header.py</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 #!/usr/bin/env python
  2 #
  3 # Copyright (c) 2014, 2015 Apple Inc. All rights reserved.
  4 # Copyright (c) 2014 University of Washington. All rights reserved.
  5 #
  6 # Redistribution and use in source and binary forms, with or without
  7 # modification, are permitted provided that the following conditions
  8 # are met:
  9 # 1. Redistributions of source code must retain the above copyright
 10 #    notice, this list of conditions and the following disclaimer.
 11 # 2. Redistributions in binary form must reproduce the above copyright
 12 #    notice, this list of conditions and the following disclaimer in the
 13 #    documentation and/or other materials provided with the distribution.
 14 #
 15 # THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 16 # AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 17 # THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 18 # PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 19 # BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 20 # CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 21 # SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 22 # INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 23 # CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 24 # ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 25 # THE POSSIBILITY OF SUCH DAMAGE.
 26 
 27 
 28 import logging
 29 import re
 30 import string
 31 from string import Template
 32 
 33 from builtins_generator import BuiltinsGenerator
 34 from builtins_model import Frameworks
 35 from builtins_templates import BuiltinsGeneratorTemplates as Templates
 36 
 37 log = logging.getLogger(&#39;global&#39;)
 38 
 39 
 40 class BuiltinsSeparateHeaderGenerator(BuiltinsGenerator):
 41     def __init__(self, model, object):
 42         BuiltinsGenerator.__init__(self, model)
 43         self.object = object
 44 
 45     def output_filename(self):
 46         return &quot;%sBuiltins.h&quot; % BuiltinsGenerator.mangledNameForObject(self.object)
 47 
 48     def macro_prefix(self):
 49         return self.model().framework.setting(&#39;macro_prefix&#39;)
 50 
 51     def generate_output(self):
 52         args = {
 53             &#39;namespace&#39;: self.model().framework.setting(&#39;namespace&#39;),
 54             &#39;macroPrefix&#39;: self.macro_prefix(),
 55             &#39;objectName&#39;: self.object.object_name,
 56             &#39;objectMacro&#39;: self.object.object_name.upper(),
 57         }
 58 
 59         conditional_guard = self.object.annotations.get(&#39;conditional&#39;)
 60 
 61         sections = []
 62         sections.append(self.generate_license())
 63         sections.append(Template(Templates.DoNotEditWarning).substitute(args))
 64         sections.append(Template(Templates.HeaderIncludeGuard).substitute(args))
 65         if conditional_guard is not None:
 66             sections.append(&quot;#if %s&quot; % conditional_guard)
 67         sections.append(self.generate_secondary_header_includes())
 68         sections.append(self.generate_forward_declarations())
 69         sections.append(Template(Templates.NamespaceTop).substitute(args))
 70         sections.append(self.generate_section_for_object(self.object))
 71         sections.append(self.generate_section_for_code_table_macro())
 72         sections.append(self.generate_section_for_code_name_macro())
 73         sections.append(Template(Templates.SeparateHeaderStaticMacros).substitute(args))
 74         if self.model().framework is Frameworks.WebCore:
 75             sections.append(Template(Templates.SeparateHeaderWrapperBoilerplate).substitute(args))
 76             if self.object.annotations.get(&#39;internal&#39;):
 77                 sections.append(Template(Templates.SeparateHeaderInternalFunctionsBoilerplate).substitute(args))
 78         sections.append(Template(Templates.NamespaceBottom).substitute(args))
 79         if conditional_guard is not None:
 80             sections.append(&quot;#endif // %s&quot; % conditional_guard)
 81 
 82         return &quot;\n\n&quot;.join(sections)
 83 
 84     def generate_forward_declarations(self):
 85         return &quot;&quot;&quot;namespace JSC {
 86 class FunctionExecutable;
 87 }&quot;&quot;&quot;
 88 
 89     def generate_secondary_header_includes(self):
 90         header_includes = [
 91             ([&quot;WebCore&quot;],
 92                 (&quot;JavaScriptCore&quot;, &quot;bytecode/UnlinkedFunctionExecutable.h&quot;),
 93             ),
 94 
 95             ([&quot;WebCore&quot;],
 96                 (&quot;JavaScriptCore&quot;, &quot;builtins/BuiltinUtils.h&quot;),
 97             ),
 98 
 99             ([&quot;WebCore&quot;],
100                 (&quot;JavaScriptCore&quot;, &quot;runtime/Identifier.h&quot;),
101             ),
102 
103             ([&quot;WebCore&quot;],
104                 (&quot;JavaScriptCore&quot;, &quot;runtime/JSFunction.h&quot;),
105             ),
106         ]
107 
108         return &#39;\n&#39;.join(self.generate_includes_from_entries(header_includes))
109 
110     def generate_section_for_object(self, object):
111         lines = []
112         lines.append(&#39;/* %s */&#39; % object.object_name)
113         lines.extend(self.generate_externs_for_object(object))
114         lines.append(&quot;&quot;)
115         lines.extend(self.generate_macros_for_object(object))
116         lines.append(&quot;&quot;)
117         lines.extend(self.generate_defines_for_object(object))
118         return &#39;\n&#39;.join(lines)
119 
120     def generate_externs_for_object(self, object):
121         lines = []
122 
123         for function in object.functions:
124             function_args = {
125                 &#39;codeName&#39;: BuiltinsGenerator.mangledNameForFunction(function) + &#39;Code&#39;,
126             }
127 
128             lines.append(&quot;&quot;&quot;extern const char* const s_%(codeName)s;
129 extern const int s_%(codeName)sLength;
<a name="1" id="anc1"></a><span class="line-modified">130 extern const JSC::ConstructAbility s_%(codeName)sConstructAbility;&quot;&quot;&quot; % function_args)</span>

131 
132         return lines
133 
134     def generate_macros_for_object(self, object):
135         args = {
136             &#39;macroPrefix&#39;: self.macro_prefix(),
137             &#39;objectMacro&#39;: object.object_name.replace(&#39;.&#39;, &#39;_&#39;).upper(),
138         }
139 
140         lines = []
141         lines.append(&quot;#define %(macroPrefix)s_FOREACH_%(objectMacro)s_BUILTIN_DATA(macro) \\&quot; % args)
142         for function in object.functions:
143             function_args = {
144                 &#39;funcName&#39;: function.function_name,
145                 &#39;mangledName&#39;: BuiltinsGenerator.mangledNameForFunction(function),
146                 &#39;paramCount&#39;: len(function.parameters),
147             }
148 
149             lines.append(&quot;    macro(%(funcName)s, %(mangledName)s, %(paramCount)d) \\&quot; % function_args)
150         return lines
151 
152     def generate_defines_for_object(self, object):
153         lines = []
154         for function in object.functions:
155             args = {
156                 &#39;macroPrefix&#39;: self.macro_prefix(),
157                 &#39;objectMacro&#39;: object.object_name.replace(&#39;.&#39;, &#39;_&#39;).upper(),
158                 &#39;functionMacro&#39;: function.function_name.upper(),
159             }
160             lines.append(&quot;#define %(macroPrefix)s_BUILTIN_%(objectMacro)s_%(functionMacro)s 1&quot; % args)
161 
162         return lines
163 
164     def generate_section_for_code_table_macro(self):
165         args = {
166             &#39;macroPrefix&#39;: self.model().framework.setting(&#39;macro_prefix&#39;),
167             &#39;objectMacro&#39;: self.object.object_name.upper(),
168         }
169 
170         lines = []
171         lines.append(&quot;#define %(macroPrefix)s_FOREACH_%(objectMacro)s_BUILTIN_CODE(macro) \\&quot; % args)
172         for function in self.object.functions:
173             function_args = {
174                 &#39;funcName&#39;: function.function_name,
175                 &#39;overriddenName&#39;: function.overridden_name,
176                 &#39;codeName&#39;: BuiltinsGenerator.mangledNameForFunction(function) + &#39;Code&#39;,
177             }
178 
179             lines.append(&quot;    macro(%(codeName)s, %(funcName)s, %(overriddenName)s, s_%(codeName)sLength) \\&quot; % function_args)
180         return &#39;\n&#39;.join(lines)
181 
182     def generate_section_for_code_name_macro(self):
183         args = {
184             &#39;macroPrefix&#39;: self.macro_prefix(),
185             &#39;objectMacro&#39;: self.object.object_name.upper(),
186         }
187 
188         lines = []
189         lines.append(&quot;#define %(macroPrefix)s_FOREACH_%(objectMacro)s_BUILTIN_FUNCTION_NAME(macro) \\&quot; % args)
190         unique_names = list(set([function.function_name for function in self.object.functions]))
191         unique_names.sort()
192         for function_name in unique_names:
193             function_args = {
194                 &#39;funcName&#39;: function_name,
195             }
196 
197             lines.append(&quot;    macro(%(funcName)s) \\&quot; % function_args)
198         return &#39;\n&#39;.join(lines)
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>