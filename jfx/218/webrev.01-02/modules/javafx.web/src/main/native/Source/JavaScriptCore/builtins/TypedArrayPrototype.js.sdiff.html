<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/TypedArrayPrototype.js</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TypedArrayConstructor.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../bytecode/AccessCase.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/TypedArrayPrototype.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 // Note that the intrisic @typedArrayLength checks that the argument passed is a typed array
 27 // and throws if it is not.
 28 
 29 
 30 // Typed Arrays have their own species constructor function since they need
 31 // to look up their default constructor, which is expensive. If we used the
 32 // normal speciesConstructor helper we would need to look up the default
 33 // constructor every time.
 34 @globalPrivate
 35 function typedArraySpeciesConstructor(value)
 36 {
 37     &quot;use strict&quot;;
<span class="line-modified"> 38     let constructor = value.constructor;</span>
 39     if (constructor === @undefined)
 40         return @typedArrayGetOriginalConstructor(value);
 41 
 42     if (!@isObject(constructor))
 43         @throwTypeError(&quot;|this|.constructor is not an Object or undefined&quot;);
 44 
 45     constructor = constructor.@speciesSymbol;
 46     if (@isUndefinedOrNull(constructor))
 47         return @typedArrayGetOriginalConstructor(value);
 48     // The lack of an @isConstructor(constructor) check here is not observable because
 49     // the first thing we will do with the value is attempt to construct the result with it.
 50     // If any user of this function does not immediately construct the result they need to
 51     // verify that the result is a constructor.
 52     return constructor;
 53 }
 54 
 55 @globalPrivate
 56 function typedArrayClampArgumentToStartOrEnd(value, length, undefinedValue)
 57 {
 58     &quot;use strict&quot;;
 59 
 60     if (value === @undefined)
 61         return undefinedValue;
 62 
<span class="line-modified"> 63     let int = @toInteger(value);</span>
 64     if (int &lt; 0) {
 65         int += length;
 66         return int &lt; 0 ? 0 : int;
 67     }
 68     return int &gt; length ? length : int;
 69 }
 70 
<span class="line-removed"> 71 function values()</span>
<span class="line-removed"> 72 {</span>
<span class="line-removed"> 73     &quot;use strict&quot;;</span>
<span class="line-removed"> 74     @typedArrayLength(this);</span>
<span class="line-removed"> 75     return new @ArrayIterator(this, &quot;value&quot;, @arrayIteratorValueNext);</span>
<span class="line-removed"> 76 }</span>
<span class="line-removed"> 77 </span>
<span class="line-removed"> 78 function keys()</span>
<span class="line-removed"> 79 {</span>
<span class="line-removed"> 80     &quot;use strict&quot;;</span>
<span class="line-removed"> 81     @typedArrayLength(this);</span>
<span class="line-removed"> 82     return new @ArrayIterator(this, &quot;key&quot;, @arrayIteratorKeyNext);</span>
<span class="line-removed"> 83 }</span>
<span class="line-removed"> 84 </span>
<span class="line-removed"> 85 function entries()</span>
<span class="line-removed"> 86 {</span>
<span class="line-removed"> 87     &quot;use strict&quot;;</span>
<span class="line-removed"> 88     @typedArrayLength(this);</span>
<span class="line-removed"> 89     return new @ArrayIterator(this, &quot;key+value&quot;, @arrayIteratorKeyValueNext);</span>
<span class="line-removed"> 90 }</span>
<span class="line-removed"> 91 </span>
 92 function every(callback /*, thisArg */)
 93 {
 94     &quot;use strict&quot;;
 95     var length = @typedArrayLength(this);
 96     var thisArg = @argument(1);
 97 
 98     if (typeof callback !== &quot;function&quot;)
 99         @throwTypeError(&quot;TypedArray.prototype.every callback must be a function&quot;);
100 
101     for (var i = 0; i &lt; length; i++) {
102         if (!callback.@call(thisArg, this[i], i, this))
103             return false;
104     }
105 
106     return true;
107 }
108 
109 function fill(value /* [, start [, end]] */)
110 {
111     &quot;use strict&quot;;
112 
<span class="line-modified">113     let length = @typedArrayLength(this);</span>
114 
<span class="line-modified">115     let start = @argument(1);</span>
<span class="line-modified">116     let end = @argument(2);</span>
117 
118     start = @typedArrayClampArgumentToStartOrEnd(start, length, 0);
119     end = @typedArrayClampArgumentToStartOrEnd(end, length, length);
120 
<span class="line-modified">121     for (let i = start; i &lt; end; i++)</span>
122         this[i] = value;
123     return this;
124 }
125 
126 function find(callback /* [, thisArg] */)
127 {
128     &quot;use strict&quot;;
129     var length = @typedArrayLength(this);
130     var thisArg = @argument(1);
131 
132     if (typeof callback !== &quot;function&quot;)
133         @throwTypeError(&quot;TypedArray.prototype.find callback must be a function&quot;);
134 
135     for (var i = 0; i &lt; length; i++) {
<span class="line-modified">136         let elem = this[i];</span>
137         if (callback.@call(thisArg, elem, i, this))
138             return elem;
139     }
140     return @undefined;
141 }
142 
143 function findIndex(callback /* [, thisArg] */)
144 {
145     &quot;use strict&quot;;
146     var length = @typedArrayLength(this);
147     var thisArg = @argument(1);
148 
149     if (typeof callback !== &quot;function&quot;)
150         @throwTypeError(&quot;TypedArray.prototype.findIndex callback must be a function&quot;);
151 
152     for (var i = 0; i &lt; length; i++) {
153         if (callback.@call(thisArg, this[i], i, this))
154             return i;
155     }
156     return -1;
</pre>
<hr />
<pre>
242     var length = @typedArrayLength(this);
243 
244     if (length &lt; 2)
245         return;
246 
247     if (typeof comparator == &quot;function&quot;)
248         mergeSort(this, length, comparator);
249     else
250         @typedArraySort(this);
251     
252     return this;
253 }
254 
255 function subarray(begin, end)
256 {
257     &quot;use strict&quot;;
258 
259     if (!@isTypedArrayView(this))
260         @throwTypeError(&quot;|this| should be a typed array view&quot;);
261 
<span class="line-modified">262     let start = @toInteger(begin);</span>
<span class="line-modified">263     let finish;</span>
264     if (end !== @undefined)
265         finish = @toInteger(end);
266 
<span class="line-modified">267     let constructor = @typedArraySpeciesConstructor(this);</span>
268 
269     return @typedArraySubarrayCreate.@call(this, start, finish, constructor);
270 }
271 
272 function reduce(callback /* [, initialValue] */)
273 {
274     // 22.2.3.19
275     &quot;use strict&quot;;
276 
277     var length = @typedArrayLength(this);
278 
279     if (typeof callback !== &quot;function&quot;)
280         @throwTypeError(&quot;TypedArray.prototype.reduce callback must be a function&quot;);
281 
282     var argumentCount = @argumentCount();
283     if (length === 0 &amp;&amp; argumentCount &lt; 2)
284         @throwTypeError(&quot;TypedArray.prototype.reduce of empty array with no initial value&quot;);
285 
286     var accumulator, k = 0;
287     if (argumentCount &gt; 1)
</pre>
</td>
<td>
<hr />
<pre>
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 // Note that the intrisic @typedArrayLength checks that the argument passed is a typed array
 27 // and throws if it is not.
 28 
 29 
 30 // Typed Arrays have their own species constructor function since they need
 31 // to look up their default constructor, which is expensive. If we used the
 32 // normal speciesConstructor helper we would need to look up the default
 33 // constructor every time.
 34 @globalPrivate
 35 function typedArraySpeciesConstructor(value)
 36 {
 37     &quot;use strict&quot;;
<span class="line-modified"> 38     var constructor = value.constructor;</span>
 39     if (constructor === @undefined)
 40         return @typedArrayGetOriginalConstructor(value);
 41 
 42     if (!@isObject(constructor))
 43         @throwTypeError(&quot;|this|.constructor is not an Object or undefined&quot;);
 44 
 45     constructor = constructor.@speciesSymbol;
 46     if (@isUndefinedOrNull(constructor))
 47         return @typedArrayGetOriginalConstructor(value);
 48     // The lack of an @isConstructor(constructor) check here is not observable because
 49     // the first thing we will do with the value is attempt to construct the result with it.
 50     // If any user of this function does not immediately construct the result they need to
 51     // verify that the result is a constructor.
 52     return constructor;
 53 }
 54 
 55 @globalPrivate
 56 function typedArrayClampArgumentToStartOrEnd(value, length, undefinedValue)
 57 {
 58     &quot;use strict&quot;;
 59 
 60     if (value === @undefined)
 61         return undefinedValue;
 62 
<span class="line-modified"> 63     var int = @toInteger(value);</span>
 64     if (int &lt; 0) {
 65         int += length;
 66         return int &lt; 0 ? 0 : int;
 67     }
 68     return int &gt; length ? length : int;
 69 }
 70 





















 71 function every(callback /*, thisArg */)
 72 {
 73     &quot;use strict&quot;;
 74     var length = @typedArrayLength(this);
 75     var thisArg = @argument(1);
 76 
 77     if (typeof callback !== &quot;function&quot;)
 78         @throwTypeError(&quot;TypedArray.prototype.every callback must be a function&quot;);
 79 
 80     for (var i = 0; i &lt; length; i++) {
 81         if (!callback.@call(thisArg, this[i], i, this))
 82             return false;
 83     }
 84 
 85     return true;
 86 }
 87 
 88 function fill(value /* [, start [, end]] */)
 89 {
 90     &quot;use strict&quot;;
 91 
<span class="line-modified"> 92     var length = @typedArrayLength(this);</span>
 93 
<span class="line-modified"> 94     var start = @argument(1);</span>
<span class="line-modified"> 95     var end = @argument(2);</span>
 96 
 97     start = @typedArrayClampArgumentToStartOrEnd(start, length, 0);
 98     end = @typedArrayClampArgumentToStartOrEnd(end, length, length);
 99 
<span class="line-modified">100     for (var i = start; i &lt; end; i++)</span>
101         this[i] = value;
102     return this;
103 }
104 
105 function find(callback /* [, thisArg] */)
106 {
107     &quot;use strict&quot;;
108     var length = @typedArrayLength(this);
109     var thisArg = @argument(1);
110 
111     if (typeof callback !== &quot;function&quot;)
112         @throwTypeError(&quot;TypedArray.prototype.find callback must be a function&quot;);
113 
114     for (var i = 0; i &lt; length; i++) {
<span class="line-modified">115         var elem = this[i];</span>
116         if (callback.@call(thisArg, elem, i, this))
117             return elem;
118     }
119     return @undefined;
120 }
121 
122 function findIndex(callback /* [, thisArg] */)
123 {
124     &quot;use strict&quot;;
125     var length = @typedArrayLength(this);
126     var thisArg = @argument(1);
127 
128     if (typeof callback !== &quot;function&quot;)
129         @throwTypeError(&quot;TypedArray.prototype.findIndex callback must be a function&quot;);
130 
131     for (var i = 0; i &lt; length; i++) {
132         if (callback.@call(thisArg, this[i], i, this))
133             return i;
134     }
135     return -1;
</pre>
<hr />
<pre>
221     var length = @typedArrayLength(this);
222 
223     if (length &lt; 2)
224         return;
225 
226     if (typeof comparator == &quot;function&quot;)
227         mergeSort(this, length, comparator);
228     else
229         @typedArraySort(this);
230     
231     return this;
232 }
233 
234 function subarray(begin, end)
235 {
236     &quot;use strict&quot;;
237 
238     if (!@isTypedArrayView(this))
239         @throwTypeError(&quot;|this| should be a typed array view&quot;);
240 
<span class="line-modified">241     var start = @toInteger(begin);</span>
<span class="line-modified">242     var finish;</span>
243     if (end !== @undefined)
244         finish = @toInteger(end);
245 
<span class="line-modified">246     var constructor = @typedArraySpeciesConstructor(this);</span>
247 
248     return @typedArraySubarrayCreate.@call(this, start, finish, constructor);
249 }
250 
251 function reduce(callback /* [, initialValue] */)
252 {
253     // 22.2.3.19
254     &quot;use strict&quot;;
255 
256     var length = @typedArrayLength(this);
257 
258     if (typeof callback !== &quot;function&quot;)
259         @throwTypeError(&quot;TypedArray.prototype.reduce callback must be a function&quot;);
260 
261     var argumentCount = @argumentCount();
262     if (length === 0 &amp;&amp; argumentCount &lt; 2)
263         @throwTypeError(&quot;TypedArray.prototype.reduce of empty array with no initial value&quot;);
264 
265     var accumulator, k = 0;
266     if (argumentCount &gt; 1)
</pre>
</td>
</tr>
</table>
<center><a href="TypedArrayConstructor.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../bytecode/AccessCase.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>