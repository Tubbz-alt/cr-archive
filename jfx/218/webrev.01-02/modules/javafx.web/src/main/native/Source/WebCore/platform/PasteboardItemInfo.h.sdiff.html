<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/PasteboardItemInfo.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Pasteboard.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PasteboardStrategy.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/PasteboardItemInfo.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 44     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
 45     template&lt;class Decoder&gt; static Optional&lt;PresentationSize&gt; decode(Decoder&amp;);
 46 };
 47 
 48 template&lt;class Encoder&gt;
 49 void PresentationSize::encode(Encoder&amp; encoder) const
 50 {
 51     encoder &lt;&lt; width &lt;&lt; height;
 52 }
 53 
 54 template&lt;class Decoder&gt;
 55 Optional&lt;PresentationSize&gt; PresentationSize::decode(Decoder&amp; decoder)
 56 {
 57     PresentationSize result;
 58     if (!decoder.decode(result.width))
 59         return WTF::nullopt;
 60 
 61     if (!decoder.decode(result.height))
 62         return WTF::nullopt;
 63 
<span class="line-modified"> 64     return WTFMove(result);</span>
 65 }
 66 
 67 struct PasteboardItemInfo {
 68     Vector&lt;String&gt; pathsForFileUpload;
<span class="line-modified"> 69     Vector&lt;String&gt; contentTypesForFileUpload;</span>
<span class="line-modified"> 70     Vector&lt;String&gt; contentTypesByFidelity;</span>
 71     String suggestedFileName;
 72     PresentationSize preferredPresentationSize;
 73     bool isNonTextType { false };
 74     bool containsFileURLAndFileUploadContent { false };

 75     PasteboardItemPresentationStyle preferredPresentationStyle { PasteboardItemPresentationStyle::Unspecified };
 76 
 77     String pathForContentType(const String&amp; type) const
 78     {
<span class="line-modified"> 79         ASSERT(pathsForFileUpload.size() == contentTypesForFileUpload.size());</span>
<span class="line-modified"> 80         auto index = contentTypesForFileUpload.find(type);</span>
 81         if (index == notFound)
 82             return { };
 83 
 84         return pathsForFileUpload[index];
 85     }
 86 
 87     // The preferredPresentationStyle flag is platform API used by drag or copy sources to explicitly indicate
 88     // that the data being written to the item provider should be treated as an attachment; unfortunately, not
 89     // all clients attempt to set this flag, so we additionally take having a suggested filename as a strong
 90     // indicator that the item should be treated as an attachment or file.
 91     bool canBeTreatedAsAttachmentOrFile() const
 92     {
 93         switch (preferredPresentationStyle) {
 94         case PasteboardItemPresentationStyle::Inline:
 95             return false;
 96         case PasteboardItemPresentationStyle::Attachment:
 97             return true;
 98         case PasteboardItemPresentationStyle::Unspecified:
 99             return !suggestedFileName.isEmpty();
100         }
101         ASSERT_NOT_REACHED();
102         return false;
103     }
104 
105     String contentTypeForHighestFidelityItem() const
106     {
<span class="line-modified">107         if (contentTypesForFileUpload.isEmpty())</span>
108             return { };
109 
<span class="line-modified">110         return contentTypesForFileUpload.first();</span>
111     }
112 
113     String pathForHighestFidelityItem() const
114     {
115         if (pathsForFileUpload.isEmpty())
116             return { };
117 
118         return pathsForFileUpload.first();
119     }
120 
121     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
122     template&lt;class Decoder&gt; static Optional&lt;PasteboardItemInfo&gt; decode(Decoder&amp;);
123 };
124 
125 template&lt;class Encoder&gt;
126 void PasteboardItemInfo::encode(Encoder&amp; encoder) const
127 {
<span class="line-modified">128     encoder &lt;&lt; pathsForFileUpload &lt;&lt; contentTypesForFileUpload &lt;&lt; contentTypesByFidelity &lt;&lt; suggestedFileName &lt;&lt; preferredPresentationSize &lt;&lt; isNonTextType &lt;&lt; containsFileURLAndFileUploadContent;</span>
129     encoder.encodeEnum(preferredPresentationStyle);
130 }
131 
132 template&lt;class Decoder&gt;
133 Optional&lt;PasteboardItemInfo&gt; PasteboardItemInfo::decode(Decoder&amp; decoder)
134 {
135     PasteboardItemInfo result;
136     if (!decoder.decode(result.pathsForFileUpload))
137         return WTF::nullopt;
138 
<span class="line-modified">139     if (!decoder.decode(result.contentTypesForFileUpload))</span>
140         return WTF::nullopt;
141 
<span class="line-modified">142     if (!decoder.decode(result.contentTypesByFidelity))</span>
143         return WTF::nullopt;
144 
145     if (!decoder.decode(result.suggestedFileName))
146         return WTF::nullopt;
147 
148     if (!decoder.decode(result.preferredPresentationSize))
149         return WTF::nullopt;
150 
151     if (!decoder.decode(result.isNonTextType))
152         return WTF::nullopt;
153 
154     if (!decoder.decode(result.containsFileURLAndFileUploadContent))
155         return WTF::nullopt;
156 



157     if (!decoder.decodeEnum(result.preferredPresentationStyle))
158         return WTF::nullopt;
159 
<span class="line-modified">160     return WTFMove(result);</span>
161 }
162 
163 }
164 
165 namespace WTF {
166 
167 template&lt;&gt; struct EnumTraits&lt;WebCore::PasteboardItemPresentationStyle&gt; {
168     using values = EnumValues&lt;
169         WebCore::PasteboardItemPresentationStyle,
170         WebCore::PasteboardItemPresentationStyle::Unspecified,
171         WebCore::PasteboardItemPresentationStyle::Inline,
172         WebCore::PasteboardItemPresentationStyle::Attachment
173     &gt;;
174 };
175 
176 } // namespace WTF
</pre>
</td>
<td>
<hr />
<pre>
 44     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
 45     template&lt;class Decoder&gt; static Optional&lt;PresentationSize&gt; decode(Decoder&amp;);
 46 };
 47 
 48 template&lt;class Encoder&gt;
 49 void PresentationSize::encode(Encoder&amp; encoder) const
 50 {
 51     encoder &lt;&lt; width &lt;&lt; height;
 52 }
 53 
 54 template&lt;class Decoder&gt;
 55 Optional&lt;PresentationSize&gt; PresentationSize::decode(Decoder&amp; decoder)
 56 {
 57     PresentationSize result;
 58     if (!decoder.decode(result.width))
 59         return WTF::nullopt;
 60 
 61     if (!decoder.decode(result.height))
 62         return WTF::nullopt;
 63 
<span class="line-modified"> 64     return result;</span>
 65 }
 66 
 67 struct PasteboardItemInfo {
 68     Vector&lt;String&gt; pathsForFileUpload;
<span class="line-modified"> 69     Vector&lt;String&gt; platformTypesForFileUpload;</span>
<span class="line-modified"> 70     Vector&lt;String&gt; platformTypesByFidelity;</span>
 71     String suggestedFileName;
 72     PresentationSize preferredPresentationSize;
 73     bool isNonTextType { false };
 74     bool containsFileURLAndFileUploadContent { false };
<span class="line-added"> 75     Vector&lt;String&gt; webSafeTypesByFidelity;</span>
 76     PasteboardItemPresentationStyle preferredPresentationStyle { PasteboardItemPresentationStyle::Unspecified };
 77 
 78     String pathForContentType(const String&amp; type) const
 79     {
<span class="line-modified"> 80         ASSERT(pathsForFileUpload.size() == platformTypesForFileUpload.size());</span>
<span class="line-modified"> 81         auto index = platformTypesForFileUpload.find(type);</span>
 82         if (index == notFound)
 83             return { };
 84 
 85         return pathsForFileUpload[index];
 86     }
 87 
 88     // The preferredPresentationStyle flag is platform API used by drag or copy sources to explicitly indicate
 89     // that the data being written to the item provider should be treated as an attachment; unfortunately, not
 90     // all clients attempt to set this flag, so we additionally take having a suggested filename as a strong
 91     // indicator that the item should be treated as an attachment or file.
 92     bool canBeTreatedAsAttachmentOrFile() const
 93     {
 94         switch (preferredPresentationStyle) {
 95         case PasteboardItemPresentationStyle::Inline:
 96             return false;
 97         case PasteboardItemPresentationStyle::Attachment:
 98             return true;
 99         case PasteboardItemPresentationStyle::Unspecified:
100             return !suggestedFileName.isEmpty();
101         }
102         ASSERT_NOT_REACHED();
103         return false;
104     }
105 
106     String contentTypeForHighestFidelityItem() const
107     {
<span class="line-modified">108         if (platformTypesForFileUpload.isEmpty())</span>
109             return { };
110 
<span class="line-modified">111         return platformTypesForFileUpload.first();</span>
112     }
113 
114     String pathForHighestFidelityItem() const
115     {
116         if (pathsForFileUpload.isEmpty())
117             return { };
118 
119         return pathsForFileUpload.first();
120     }
121 
122     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
123     template&lt;class Decoder&gt; static Optional&lt;PasteboardItemInfo&gt; decode(Decoder&amp;);
124 };
125 
126 template&lt;class Encoder&gt;
127 void PasteboardItemInfo::encode(Encoder&amp; encoder) const
128 {
<span class="line-modified">129     encoder &lt;&lt; pathsForFileUpload &lt;&lt; platformTypesForFileUpload &lt;&lt; platformTypesByFidelity &lt;&lt; suggestedFileName &lt;&lt; preferredPresentationSize &lt;&lt; isNonTextType &lt;&lt; containsFileURLAndFileUploadContent &lt;&lt; webSafeTypesByFidelity;</span>
130     encoder.encodeEnum(preferredPresentationStyle);
131 }
132 
133 template&lt;class Decoder&gt;
134 Optional&lt;PasteboardItemInfo&gt; PasteboardItemInfo::decode(Decoder&amp; decoder)
135 {
136     PasteboardItemInfo result;
137     if (!decoder.decode(result.pathsForFileUpload))
138         return WTF::nullopt;
139 
<span class="line-modified">140     if (!decoder.decode(result.platformTypesForFileUpload))</span>
141         return WTF::nullopt;
142 
<span class="line-modified">143     if (!decoder.decode(result.platformTypesByFidelity))</span>
144         return WTF::nullopt;
145 
146     if (!decoder.decode(result.suggestedFileName))
147         return WTF::nullopt;
148 
149     if (!decoder.decode(result.preferredPresentationSize))
150         return WTF::nullopt;
151 
152     if (!decoder.decode(result.isNonTextType))
153         return WTF::nullopt;
154 
155     if (!decoder.decode(result.containsFileURLAndFileUploadContent))
156         return WTF::nullopt;
157 
<span class="line-added">158     if (!decoder.decode(result.webSafeTypesByFidelity))</span>
<span class="line-added">159         return WTF::nullopt;</span>
<span class="line-added">160 </span>
161     if (!decoder.decodeEnum(result.preferredPresentationStyle))
162         return WTF::nullopt;
163 
<span class="line-modified">164     return result;</span>
165 }
166 
167 }
168 
169 namespace WTF {
170 
171 template&lt;&gt; struct EnumTraits&lt;WebCore::PasteboardItemPresentationStyle&gt; {
172     using values = EnumValues&lt;
173         WebCore::PasteboardItemPresentationStyle,
174         WebCore::PasteboardItemPresentationStyle::Unspecified,
175         WebCore::PasteboardItemPresentationStyle::Inline,
176         WebCore::PasteboardItemPresentationStyle::Attachment
177     &gt;;
178 };
179 
180 } // namespace WTF
</pre>
</td>
</tr>
</table>
<center><a href="Pasteboard.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PasteboardStrategy.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>