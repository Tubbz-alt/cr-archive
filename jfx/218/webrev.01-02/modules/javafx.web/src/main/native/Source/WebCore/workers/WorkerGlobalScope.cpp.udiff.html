<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/workers/WorkerGlobalScope.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="WorkerDebuggerProxy.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="WorkerGlobalScope.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/workers/WorkerGlobalScope.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -26,29 +26,33 @@</span>
   */
  
  #include &quot;config.h&quot;
  #include &quot;WorkerGlobalScope.h&quot;
  
<span class="udiff-line-added">+ #include &quot;CSSValueList.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;CSSValuePool.h&quot;</span>
  #include &quot;ContentSecurityPolicy.h&quot;
  #include &quot;Crypto.h&quot;
  #include &quot;IDBConnectionProxy.h&quot;
  #include &quot;ImageBitmapOptions.h&quot;
  #include &quot;InspectorInstrumentation.h&quot;
<span class="udiff-line-removed">- #include &quot;Microtasks.h&quot;</span>
  #include &quot;Performance.h&quot;
  #include &quot;RuntimeEnabledFeatures.h&quot;
  #include &quot;ScheduledAction.h&quot;
  #include &quot;ScriptSourceCode.h&quot;
  #include &quot;SecurityOrigin.h&quot;
  #include &quot;SecurityOriginPolicy.h&quot;
  #include &quot;ServiceWorkerGlobalScope.h&quot;
  #include &quot;SocketProvider.h&quot;
<span class="udiff-line-added">+ #include &quot;WorkerEventLoop.h&quot;</span>
  #include &quot;WorkerInspectorController.h&quot;
  #include &quot;WorkerLoaderProxy.h&quot;
  #include &quot;WorkerLocation.h&quot;
<span class="udiff-line-added">+ #include &quot;WorkerMessagingProxy.h&quot;</span>
  #include &quot;WorkerNavigator.h&quot;
  #include &quot;WorkerReportingProxy.h&quot;
<span class="udiff-line-added">+ #include &quot;WorkerSWClientConnection.h&quot;</span>
  #include &quot;WorkerScriptLoader.h&quot;
  #include &quot;WorkerThread.h&quot;
  #include &lt;JavaScriptCore/ScriptArguments.h&gt;
  #include &lt;JavaScriptCore/ScriptCallStack.h&gt;
  #include &lt;wtf/IsoMallocInlines.h&gt;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -56,28 +60,26 @@</span>
  namespace WebCore {
  using namespace Inspector;
  
  WTF_MAKE_ISO_ALLOCATED_IMPL(WorkerGlobalScope);
  
<span class="udiff-line-modified-removed">- WorkerGlobalScope::WorkerGlobalScope(const URL&amp; url, Ref&lt;SecurityOrigin&gt;&amp;&amp; origin, const String&amp; identifier, const String&amp; userAgent, bool isOnline, WorkerThread&amp; thread, bool shouldBypassMainWorldContentSecurityPolicy, Ref&lt;SecurityOrigin&gt;&amp;&amp; topOrigin, MonotonicTime timeOrigin, IDBClient::IDBConnectionProxy* connectionProxy, SocketProvider* socketProvider, PAL::SessionID sessionID)</span>
<span class="udiff-line-modified-removed">-     : m_url(url)</span>
<span class="udiff-line-modified-removed">-     , m_identifier(identifier)</span>
<span class="udiff-line-modified-removed">-     , m_userAgent(userAgent)</span>
<span class="udiff-line-modified-added">+ WorkerGlobalScope::WorkerGlobalScope(const WorkerParameters&amp; params, Ref&lt;SecurityOrigin&gt;&amp;&amp; origin, WorkerThread&amp; thread, Ref&lt;SecurityOrigin&gt;&amp;&amp; topOrigin, IDBClient::IDBConnectionProxy* connectionProxy, SocketProvider* socketProvider)</span>
<span class="udiff-line-modified-added">+     : m_url(params.scriptURL)</span>
<span class="udiff-line-modified-added">+     , m_identifier(params.identifier)</span>
<span class="udiff-line-modified-added">+     , m_userAgent(params.userAgent)</span>
      , m_thread(thread)
      , m_script(makeUnique&lt;WorkerScriptController&gt;(this))
      , m_inspectorController(makeUnique&lt;WorkerInspectorController&gt;(*this))
<span class="udiff-line-modified-removed">-     , m_microtaskQueue(makeUnique&lt;MicrotaskQueue&gt;(m_script-&gt;vm()))</span>
<span class="udiff-line-modified-removed">-     , m_isOnline(isOnline)</span>
<span class="udiff-line-removed">-     , m_shouldBypassMainWorldContentSecurityPolicy(shouldBypassMainWorldContentSecurityPolicy)</span>
<span class="udiff-line-removed">-     , m_eventQueue(*this)</span>
<span class="udiff-line-modified-added">+     , m_isOnline(params.isOnline)</span>
<span class="udiff-line-modified-added">+     , m_shouldBypassMainWorldContentSecurityPolicy(params.shouldBypassMainWorldContentSecurityPolicy)</span>
      , m_topOrigin(WTFMove(topOrigin))
  #if ENABLE(INDEXED_DATABASE)
      , m_connectionProxy(connectionProxy)
  #endif
      , m_socketProvider(socketProvider)
<span class="udiff-line-modified-removed">-     , m_performance(Performance::create(this, timeOrigin))</span>
<span class="udiff-line-modified-removed">-     , m_sessionID(sessionID)</span>
<span class="udiff-line-modified-added">+     , m_performance(Performance::create(this, params.timeOrigin))</span>
<span class="udiff-line-modified-added">+     , m_referrerPolicy(params.referrerPolicy)</span>
  {
  #if !ENABLE(INDEXED_DATABASE)
      UNUSED_PARAM(connectionProxy);
  #endif
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -101,10 +103,22 @@</span>
  
      // Notify proxy that we are going away. This can free the WorkerThread object, so do not access it after this.
      thread().workerReportingProxy().workerGlobalScopeDestroyed();
  }
  
<span class="udiff-line-added">+ EventLoopTaskGroup&amp; WorkerGlobalScope::eventLoop()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     ASSERT(isContextThread());</span>
<span class="udiff-line-added">+     if (UNLIKELY(!m_defaultTaskGroup)) {</span>
<span class="udiff-line-added">+         m_eventLoop = WorkerEventLoop::create(*this);</span>
<span class="udiff-line-added">+         m_defaultTaskGroup = makeUnique&lt;EventLoopTaskGroup&gt;(*m_eventLoop);</span>
<span class="udiff-line-added">+         if (activeDOMObjectsAreStopped())</span>
<span class="udiff-line-added">+             m_defaultTaskGroup-&gt;stopAndDiscardAllTasks();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     return *m_defaultTaskGroup;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  String WorkerGlobalScope::origin() const
  {
      auto* securityOrigin = this-&gt;securityOrigin();
      return securityOrigin ? securityOrigin-&gt;toString() : emptyString();
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -113,10 +127,12 @@</span>
  {
  #if ENABLE(INDEXED_DATABASE)
      stopIndexedDatabase();
  #endif
  
<span class="udiff-line-added">+     if (m_defaultTaskGroup)</span>
<span class="udiff-line-added">+         m_defaultTaskGroup-&gt;stopAndDiscardAllTasks();</span>
      stopActiveDOMObjects();
  
      if (m_cacheStorageConnection)
          m_cacheStorageConnection-&gt;clearPendingRequests();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -125,11 +141,12 @@</span>
      // Event listeners would keep DOMWrapperWorld objects alive for too long. Also, they have references to JS objects,
      // which become dangling once Heap is destroyed.
      removeAllEventListeners();
  
      // MicrotaskQueue and RejectedPromiseTracker reference Heap.
<span class="udiff-line-modified-removed">-     m_microtaskQueue = nullptr;</span>
<span class="udiff-line-modified-added">+     if (m_eventLoop)</span>
<span class="udiff-line-added">+         m_eventLoop-&gt;clearMicrotaskQueue();</span>
      removeRejectedPromiseTracker();
  }
  
  void WorkerGlobalScope::removeAllEventListeners()
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -149,11 +166,11 @@</span>
  void WorkerGlobalScope::applyContentSecurityPolicyResponseHeaders(const ContentSecurityPolicyResponseHeaders&amp; contentSecurityPolicyResponseHeaders)
  {
      contentSecurityPolicy()-&gt;didReceiveHeaders(contentSecurityPolicyResponseHeaders, String { });
  }
  
<span class="udiff-line-modified-removed">- URL WorkerGlobalScope::completeURL(const String&amp; url) const</span>
<span class="udiff-line-modified-added">+ URL WorkerGlobalScope::completeURL(const String&amp; url, ForceUTF8) const</span>
  {
      // Always return a null URL when passed a null string.
      // FIXME: Should we change the URL constructor to have this behavior?
      if (url.isNull())
          return URL();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -198,10 +215,26 @@</span>
      if (m_connectionProxy)
          m_connectionProxy-&gt;forgetActivityForCurrentThread();
  #endif
  }
  
<span class="udiff-line-added">+ void WorkerGlobalScope::suspend()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+ #if ENABLE(INDEXED_DATABASE_IN_WORKERS)</span>
<span class="udiff-line-added">+     if (m_connectionProxy)</span>
<span class="udiff-line-added">+         m_connectionProxy-&gt;setContextSuspended(*scriptExecutionContext(), true);</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void WorkerGlobalScope::resume()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+ #if ENABLE(INDEXED_DATABASE_IN_WORKERS)</span>
<span class="udiff-line-added">+     if (m_connectionProxy)</span>
<span class="udiff-line-added">+         m_connectionProxy-&gt;setContextSuspended(*scriptExecutionContext(), false);</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  #endif // ENABLE(INDEXED_DATABASE)
  
  WorkerLocation&amp; WorkerGlobalScope::location() const
  {
      if (!m_location)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -243,11 +276,11 @@</span>
  void WorkerGlobalScope::postTask(Task&amp;&amp; task)
  {
      thread().runLoop().postTask(WTFMove(task));
  }
  
<span class="udiff-line-modified-removed">- ExceptionOr&lt;int&gt; WorkerGlobalScope::setTimeout(JSC::ExecState&amp; state, std::unique_ptr&lt;ScheduledAction&gt; action, int timeout, Vector&lt;JSC::Strong&lt;JSC::Unknown&gt;&gt;&amp;&amp; arguments)</span>
<span class="udiff-line-modified-added">+ ExceptionOr&lt;int&gt; WorkerGlobalScope::setTimeout(JSC::JSGlobalObject&amp; state, std::unique_ptr&lt;ScheduledAction&gt; action, int timeout, Vector&lt;JSC::Strong&lt;JSC::Unknown&gt;&gt;&amp;&amp; arguments)</span>
  {
      // FIXME: Should this check really happen here? Or should it happen when code is about to eval?
      if (action-&gt;type() == ScheduledAction::Type::Code) {
          if (!contentSecurityPolicy()-&gt;allowEval(&amp;state))
              return 0;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -261,11 +294,11 @@</span>
  void WorkerGlobalScope::clearTimeout(int timeoutId)
  {
      DOMTimer::removeById(*this, timeoutId);
  }
  
<span class="udiff-line-modified-removed">- ExceptionOr&lt;int&gt; WorkerGlobalScope::setInterval(JSC::ExecState&amp; state, std::unique_ptr&lt;ScheduledAction&gt; action, int timeout, Vector&lt;JSC::Strong&lt;JSC::Unknown&gt;&gt;&amp;&amp; arguments)</span>
<span class="udiff-line-modified-added">+ ExceptionOr&lt;int&gt; WorkerGlobalScope::setInterval(JSC::JSGlobalObject&amp; state, std::unique_ptr&lt;ScheduledAction&gt; action, int timeout, Vector&lt;JSC::Strong&lt;JSC::Unknown&gt;&gt;&amp;&amp; arguments)</span>
  {
      // FIXME: Should this check really happen here? Or should it happen when code is about to eval?
      if (action-&gt;type() == ScheduledAction::Type::Code) {
          if (!contentSecurityPolicy()-&gt;allowEval(&amp;state))
              return 0;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -355,11 +388,11 @@</span>
  void WorkerGlobalScope::addConsoleMessage(MessageSource source, MessageLevel level, const String&amp; message, unsigned long requestIdentifier)
  {
      addMessage(source, level, message, { }, 0, 0, nullptr, nullptr, requestIdentifier);
  }
  
<span class="udiff-line-modified-removed">- void WorkerGlobalScope::addMessage(MessageSource source, MessageLevel level, const String&amp; messageText, const String&amp; sourceURL, unsigned lineNumber, unsigned columnNumber, RefPtr&lt;ScriptCallStack&gt;&amp;&amp; callStack, JSC::ExecState* state, unsigned long requestIdentifier)</span>
<span class="udiff-line-modified-added">+ void WorkerGlobalScope::addMessage(MessageSource source, MessageLevel level, const String&amp; messageText, const String&amp; sourceURL, unsigned lineNumber, unsigned columnNumber, RefPtr&lt;ScriptCallStack&gt;&amp;&amp; callStack, JSC::JSGlobalObject* state, unsigned long requestIdentifier)</span>
  {
      if (!isContextThread()) {
          postTask(AddConsoleMessageTask(source, level, messageText));
          return;
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -380,15 +413,10 @@</span>
  bool WorkerGlobalScope::isJSExecutionForbidden() const
  {
      return m_script-&gt;isExecutionForbidden();
  }
  
<span class="udiff-line-removed">- WorkerEventQueue&amp; WorkerGlobalScope::eventQueue() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return m_eventQueue;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  #if ENABLE(WEB_CRYPTO)
  
  class CryptoBufferContainer : public ThreadSafeRefCounted&lt;CryptoBufferContainer&gt; {
  public:
      static Ref&lt;CryptoBufferContainer&gt; create() { return adoptRef(*new CryptoBufferContainer); }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -396,52 +424,64 @@</span>
  
  private:
      Vector&lt;uint8_t&gt; m_buffer;
  };
  
<span class="udiff-line-added">+ class CryptoBooleanContainer : public ThreadSafeRefCounted&lt;CryptoBooleanContainer&gt; {</span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+     static Ref&lt;CryptoBooleanContainer&gt; create() { return adoptRef(*new CryptoBooleanContainer); }</span>
<span class="udiff-line-added">+     bool boolean() const { return m_boolean; }</span>
<span class="udiff-line-added">+     void setBoolean(bool boolean) { m_boolean = boolean; }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ private:</span>
<span class="udiff-line-added">+     std::atomic&lt;bool&gt; m_boolean { false };</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
  bool WorkerGlobalScope::wrapCryptoKey(const Vector&lt;uint8_t&gt;&amp; key, Vector&lt;uint8_t&gt;&amp; wrappedKey)
  {
<span class="udiff-line-modified-removed">-     bool result = false;</span>
<span class="udiff-line-modified-removed">-     std::atomic&lt;bool&gt; done = false;</span>
<span class="udiff-line-modified-removed">-     auto container = CryptoBufferContainer::create();</span>
<span class="udiff-line-modified-removed">-     m_thread.workerLoaderProxy().postTaskToLoader([&amp;result, key, containerRef = container.copyRef(), &amp;done, workerGlobalScope = this](ScriptExecutionContext&amp; context) {</span>
<span class="udiff-line-modified-removed">-         result = context.wrapCryptoKey(key, containerRef-&gt;buffer());</span>
<span class="udiff-line-modified-removed">-         done = true;</span>
<span class="udiff-line-modified-removed">-         workerGlobalScope-&gt;postTask([](ScriptExecutionContext&amp; context) {</span>
<span class="udiff-line-modified-added">+     Ref&lt;WorkerGlobalScope&gt; protectedThis(*this);</span>
<span class="udiff-line-modified-added">+     auto resultContainer = CryptoBooleanContainer::create();</span>
<span class="udiff-line-modified-added">+     auto doneContainer = CryptoBooleanContainer::create();</span>
<span class="udiff-line-modified-added">+     auto wrappedKeyContainer = CryptoBufferContainer::create();</span>
<span class="udiff-line-modified-added">+     m_thread.workerLoaderProxy().postTaskToLoader([resultContainer = resultContainer.copyRef(), key, wrappedKeyContainer = wrappedKeyContainer.copyRef(), doneContainer = doneContainer.copyRef(), workerMessagingProxy = makeRef(downcast&lt;WorkerMessagingProxy&gt;(m_thread.workerLoaderProxy()))](ScriptExecutionContext&amp; context) {</span>
<span class="udiff-line-modified-added">+         resultContainer-&gt;setBoolean(context.wrapCryptoKey(key, wrappedKeyContainer-&gt;buffer()));</span>
<span class="udiff-line-modified-added">+         doneContainer-&gt;setBoolean(true);</span>
<span class="udiff-line-added">+         workerMessagingProxy-&gt;postTaskForModeToWorkerGlobalScope([](ScriptExecutionContext&amp; context) {</span>
              ASSERT_UNUSED(context, context.isWorkerGlobalScope());
<span class="udiff-line-modified-removed">-         });</span>
<span class="udiff-line-modified-added">+         }, WorkerRunLoop::defaultMode());</span>
      });
  
      auto waitResult = MessageQueueMessageReceived;
<span class="udiff-line-modified-removed">-     while (!done &amp;&amp; waitResult != MessageQueueTerminated)</span>
<span class="udiff-line-modified-added">+     while (!doneContainer-&gt;boolean() &amp;&amp; waitResult != MessageQueueTerminated)</span>
          waitResult = m_thread.runLoop().runInMode(this, WorkerRunLoop::defaultMode());
  
<span class="udiff-line-modified-removed">-     if (done)</span>
<span class="udiff-line-modified-removed">-         wrappedKey.swap(container-&gt;buffer());</span>
<span class="udiff-line-modified-removed">-     return result;</span>
<span class="udiff-line-modified-added">+     if (doneContainer-&gt;boolean())</span>
<span class="udiff-line-modified-added">+         wrappedKey.swap(wrappedKeyContainer-&gt;buffer());</span>
<span class="udiff-line-modified-added">+     return resultContainer-&gt;boolean();</span>
  }
  
  bool WorkerGlobalScope::unwrapCryptoKey(const Vector&lt;uint8_t&gt;&amp; wrappedKey, Vector&lt;uint8_t&gt;&amp; key)
  {
<span class="udiff-line-modified-removed">-     bool result = false;</span>
<span class="udiff-line-modified-removed">-     std::atomic&lt;bool&gt; done = false;</span>
<span class="udiff-line-modified-removed">-     auto container = CryptoBufferContainer::create();</span>
<span class="udiff-line-modified-removed">-     m_thread.workerLoaderProxy().postTaskToLoader([&amp;result, wrappedKey, containerRef = container.copyRef(), &amp;done, workerGlobalScope = this](ScriptExecutionContext&amp; context) {</span>
<span class="udiff-line-modified-removed">-         result = context.unwrapCryptoKey(wrappedKey, containerRef-&gt;buffer());</span>
<span class="udiff-line-modified-removed">-         done = true;</span>
<span class="udiff-line-modified-removed">-         workerGlobalScope-&gt;postTask([](ScriptExecutionContext&amp; context) {</span>
<span class="udiff-line-modified-added">+     Ref&lt;WorkerGlobalScope&gt; protectedThis(*this);</span>
<span class="udiff-line-modified-added">+     auto resultContainer = CryptoBooleanContainer::create();</span>
<span class="udiff-line-modified-added">+     auto doneContainer = CryptoBooleanContainer::create();</span>
<span class="udiff-line-modified-added">+     auto keyContainer = CryptoBufferContainer::create();</span>
<span class="udiff-line-modified-added">+     m_thread.workerLoaderProxy().postTaskToLoader([resultContainer = resultContainer.copyRef(), wrappedKey, keyContainer = keyContainer.copyRef(), doneContainer = doneContainer.copyRef(), workerMessagingProxy = makeRef(downcast&lt;WorkerMessagingProxy&gt;(m_thread.workerLoaderProxy()))](ScriptExecutionContext&amp; context) {</span>
<span class="udiff-line-modified-added">+         resultContainer-&gt;setBoolean(context.unwrapCryptoKey(wrappedKey, keyContainer-&gt;buffer()));</span>
<span class="udiff-line-modified-added">+         doneContainer-&gt;setBoolean(true);</span>
<span class="udiff-line-added">+         workerMessagingProxy-&gt;postTaskForModeToWorkerGlobalScope([](ScriptExecutionContext&amp; context) {</span>
              ASSERT_UNUSED(context, context.isWorkerGlobalScope());
<span class="udiff-line-modified-removed">-         });</span>
<span class="udiff-line-modified-added">+         }, WorkerRunLoop::defaultMode());</span>
      });
  
      auto waitResult = MessageQueueMessageReceived;
<span class="udiff-line-modified-removed">-     while (!done &amp;&amp; waitResult != MessageQueueTerminated)</span>
<span class="udiff-line-modified-added">+     while (!doneContainer-&gt;boolean() &amp;&amp; waitResult != MessageQueueTerminated)</span>
          waitResult = m_thread.runLoop().runInMode(this, WorkerRunLoop::defaultMode());
  
<span class="udiff-line-modified-removed">-     if (done)</span>
<span class="udiff-line-modified-removed">-         key.swap(container-&gt;buffer());</span>
<span class="udiff-line-modified-removed">-     return result;</span>
<span class="udiff-line-modified-added">+     if (doneContainer-&gt;boolean())</span>
<span class="udiff-line-modified-added">+         key.swap(keyContainer-&gt;buffer());</span>
<span class="udiff-line-modified-added">+     return resultContainer-&gt;boolean();</span>
  }
  
  #endif // ENABLE(WEB_CRYPTO)
  
  Crypto&amp; WorkerGlobalScope::crypto()
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -461,16 +501,44 @@</span>
      if (!m_cacheStorageConnection)
          m_cacheStorageConnection = WorkerCacheStorageConnection::create(*this);
      return *m_cacheStorageConnection;
  }
  
<span class="udiff-line-added">+ MessagePortChannelProvider&amp; WorkerGlobalScope::messagePortChannelProvider()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (!m_messagePortChannelProvider)</span>
<span class="udiff-line-added">+         m_messagePortChannelProvider = makeUnique&lt;WorkerMessagePortChannelProvider&gt;(*this);</span>
<span class="udiff-line-added">+     return *m_messagePortChannelProvider;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #if ENABLE(SERVICE_WORKER)</span>
<span class="udiff-line-added">+ WorkerSWClientConnection&amp; WorkerGlobalScope::swClientConnection()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (!m_swClientConnection)</span>
<span class="udiff-line-added">+         m_swClientConnection = WorkerSWClientConnection::create(*this);</span>
<span class="udiff-line-added">+     return *m_swClientConnection;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
  void WorkerGlobalScope::createImageBitmap(ImageBitmap::Source&amp;&amp; source, ImageBitmapOptions&amp;&amp; options, ImageBitmap::Promise&amp;&amp; promise)
  {
      ImageBitmap::createPromise(*this, WTFMove(source), WTFMove(options), WTFMove(promise));
  }
  
  void WorkerGlobalScope::createImageBitmap(ImageBitmap::Source&amp;&amp; source, int sx, int sy, int sw, int sh, ImageBitmapOptions&amp;&amp; options, ImageBitmap::Promise&amp;&amp; promise)
  {
      ImageBitmap::createPromise(*this, WTFMove(source), WTFMove(options), sx, sy, sw, sh, WTFMove(promise));
  }
  
<span class="udiff-line-added">+ CSSValuePool&amp; WorkerGlobalScope::cssValuePool()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (!m_cssValuePool)</span>
<span class="udiff-line-added">+         m_cssValuePool = makeUnique&lt;CSSValuePool&gt;();</span>
<span class="udiff-line-added">+     return *m_cssValuePool;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ReferrerPolicy WorkerGlobalScope::referrerPolicy() const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     return m_referrerPolicy;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  } // namespace WebCore
</pre>
<center><a href="WorkerDebuggerProxy.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="WorkerGlobalScope.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>