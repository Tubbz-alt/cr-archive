<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderBlock.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PointerEventsHitRules.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderBlock.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderBlock.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 50,11 ***</span>
  #include &quot;RenderButton.h&quot;
  #include &quot;RenderChildIterator.h&quot;
  #include &quot;RenderCombineText.h&quot;
  #include &quot;RenderDeprecatedFlexibleBox.h&quot;
  #include &quot;RenderFlexibleBox.h&quot;
<span class="line-modified">! #include &quot;RenderFragmentContainer.h&quot;</span>
  #include &quot;RenderInline.h&quot;
  #include &quot;RenderIterator.h&quot;
  #include &quot;RenderLayer.h&quot;
  #include &quot;RenderLayoutState.h&quot;
  #include &quot;RenderListMarker.h&quot;
<span class="line-new-header">--- 50,11 ---</span>
  #include &quot;RenderButton.h&quot;
  #include &quot;RenderChildIterator.h&quot;
  #include &quot;RenderCombineText.h&quot;
  #include &quot;RenderDeprecatedFlexibleBox.h&quot;
  #include &quot;RenderFlexibleBox.h&quot;
<span class="line-modified">! #include &quot;RenderFragmentedFlow.h&quot;</span>
  #include &quot;RenderInline.h&quot;
  #include &quot;RenderIterator.h&quot;
  #include &quot;RenderLayer.h&quot;
  #include &quot;RenderLayoutState.h&quot;
  #include &quot;RenderListMarker.h&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 819,10 ***</span>
<span class="line-new-header">--- 819,21 ---</span>
      if (!descendants)
          return;
  
      for (auto it = descendants-&gt;begin(), end = descendants-&gt;end(); it != end; ++it) {
          auto* box = *it;
<span class="line-added">+         // Let&#39;s not dirty the height perecentage descendant when it has an absolutely positioned containing block ancestor. We should be able to dirty such boxes through the regular invalidation logic.</span>
<span class="line-added">+         bool descendantNeedsLayout = true;</span>
<span class="line-added">+         for (auto* ancestor = box-&gt;containingBlock(); ancestor &amp;&amp; ancestor != this; ancestor = ancestor-&gt;containingBlock()) {</span>
<span class="line-added">+             if (ancestor-&gt;isOutOfFlowPositioned()) {</span>
<span class="line-added">+                 descendantNeedsLayout = false;</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (!descendantNeedsLayout)</span>
<span class="line-added">+             continue;</span>
<span class="line-added">+ </span>
          while (box != this) {
              if (box-&gt;normalChildNeedsLayout())
                  break;
              box-&gt;setChildNeedsLayout(MarkOnlyThis);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1855,11 ***</span>
  
  LayoutUnit RenderBlock::textIndentOffset() const
  {
      LayoutUnit cw;
      if (style().textIndent().isPercentOrCalculated())
<span class="line-modified">!         cw = containingBlock()-&gt;availableLogicalWidth();</span>
      return minimumValueForLength(style().textIndent(), cw);
  }
  
  LayoutUnit RenderBlock::logicalLeftOffsetForContent(RenderFragmentContainer* fragment) const
  {
<span class="line-new-header">--- 1866,11 ---</span>
  
  LayoutUnit RenderBlock::textIndentOffset() const
  {
      LayoutUnit cw;
      if (style().textIndent().isPercentOrCalculated())
<span class="line-modified">!         cw = availableLogicalWidth();</span>
      return minimumValueForLength(style().textIndent(), cw);
  }
  
  LayoutUnit RenderBlock::logicalLeftOffsetForContent(RenderFragmentContainer* fragment) const
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2011,23 ***</span>
              LayoutRect referenceBoxRect;
              switch (clipPath.referenceBox()) {
              case CSSBoxType::MarginBox:
                  referenceBoxRect = marginBoxRect();
                  break;
<span class="line-removed">-             case CSSBoxType::BorderBox:</span>
<span class="line-removed">-                 referenceBoxRect = borderBoxRect();</span>
<span class="line-removed">-                 break;</span>
              case CSSBoxType::PaddingBox:
                  referenceBoxRect = paddingBoxRect();
                  break;
              case CSSBoxType::ContentBox:
                  referenceBoxRect = contentBoxRect();
                  break;
<span class="line-removed">-             case CSSBoxType::BoxMissing:</span>
<span class="line-removed">-             case CSSBoxType::FillBox:</span>
              case CSSBoxType::StrokeBox:
              case CSSBoxType::ViewBox:
                  referenceBoxRect = borderBoxRect();
              }
              if (!clipPath.pathForReferenceRect(referenceBoxRect).contains(locationInContainer.point() - localOffset, clipPath.windRule()))
                  return false;
              break;
<span class="line-new-header">--- 2022,21 ---</span>
              LayoutRect referenceBoxRect;
              switch (clipPath.referenceBox()) {
              case CSSBoxType::MarginBox:
                  referenceBoxRect = marginBoxRect();
                  break;
              case CSSBoxType::PaddingBox:
                  referenceBoxRect = paddingBoxRect();
                  break;
<span class="line-added">+             case CSSBoxType::FillBox:</span>
              case CSSBoxType::ContentBox:
                  referenceBoxRect = contentBoxRect();
                  break;
              case CSSBoxType::StrokeBox:
              case CSSBoxType::ViewBox:
<span class="line-added">+             case CSSBoxType::BorderBox:</span>
<span class="line-added">+             case CSSBoxType::BoxMissing:</span>
                  referenceBoxRect = borderBoxRect();
              }
              if (!clipPath.pathForReferenceRect(referenceBoxRect).contains(locationInContainer.point() - localOffset, clipPath.windRule()))
                  return false;
              break;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2512,11 ***</span>
  {
      if (!document().inNoQuirksMode() &amp;&amp; replacedHeight)
          return replacedHeight;
  
      const RenderStyle&amp; style = isFirstLine ? firstLineStyle() : this-&gt;style();
<span class="line-modified">!     if (!(style.lineBoxContain() &amp; LineBoxContainBlock))</span>
          return 0;
  
      return std::max&lt;LayoutUnit&gt;(replacedHeight, lineHeight(isFirstLine, isHorizontalWritingMode() ? HorizontalLine : VerticalLine, PositionOfInteriorLineBoxes));
  }
  
<span class="line-new-header">--- 2521,11 ---</span>
  {
      if (!document().inNoQuirksMode() &amp;&amp; replacedHeight)
          return replacedHeight;
  
      const RenderStyle&amp; style = isFirstLine ? firstLineStyle() : this-&gt;style();
<span class="line-modified">!     if (!(style.lineBoxContain().contains(LineBoxContain::Block)))</span>
          return 0;
  
      return std::max&lt;LayoutUnit&gt;(replacedHeight, lineHeight(isFirstLine, isHorizontalWritingMode() ? HorizontalLine : VerticalLine, PositionOfInteriorLineBoxes));
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2770,25 ***</span>
          rects.append(snappedIntRect(accumulatedOffset, size()));
  }
  
  void RenderBlock::absoluteQuads(Vector&lt;FloatQuad&gt;&amp; quads, bool* wasFixed) const
  {
      // For blocks inside inlines, we include margins so that we run right up to the inline boxes
      // above and below us (thus getting merged with them to form a single irregular shape).
<span class="line-modified">!     auto* continuation = this-&gt;continuation();</span>
<span class="line-modified">!     FloatRect localRect = continuation</span>
<span class="line-modified">!         ? FloatRect(0, -collapsedMarginBefore(), width(), height() + collapsedMarginBefore() + collapsedMarginAfter())</span>
<span class="line-modified">!         : FloatRect(0, 0, width(), height());</span>
  
      // FIXME: This is wrong for block-flows that are horizontal.
      // https://bugs.webkit.org/show_bug.cgi?id=46781
<span class="line-modified">!     RenderFragmentedFlow* fragmentedFlow = enclosingFragmentedFlow();</span>
<span class="line-modified">!     if (!fragmentedFlow || !fragmentedFlow-&gt;absoluteQuadsForBox(quads, wasFixed, this, localRect.y(), localRect.maxY()))</span>
<span class="line-modified">!         quads.append(localToAbsoluteQuad(localRect, UseTransforms, wasFixed));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (continuation)</span>
<span class="line-removed">-         continuation-&gt;absoluteQuads(quads, wasFixed);</span>
  }
  
  LayoutRect RenderBlock::rectWithOutlineForRepaint(const RenderLayerModelObject* repaintContainer, LayoutUnit outlineWidth) const
  {
      LayoutRect r(RenderBox::rectWithOutlineForRepaint(repaintContainer, outlineWidth));
<span class="line-new-header">--- 2779,28 ---</span>
          rects.append(snappedIntRect(accumulatedOffset, size()));
  }
  
  void RenderBlock::absoluteQuads(Vector&lt;FloatQuad&gt;&amp; quads, bool* wasFixed) const
  {
<span class="line-added">+     if (!continuation()) {</span>
<span class="line-added">+         absoluteQuadsIgnoringContinuation({ { }, size() }, quads, wasFixed);</span>
<span class="line-added">+         return;</span>
<span class="line-added">+     }</span>
      // For blocks inside inlines, we include margins so that we run right up to the inline boxes
      // above and below us (thus getting merged with them to form a single irregular shape).
<span class="line-modified">!     auto logicalRect = FloatRect { 0, -collapsedMarginBefore(), width(), height() + collapsedMarginBefore() + collapsedMarginAfter() };</span>
<span class="line-modified">!     absoluteQuadsIgnoringContinuation(logicalRect, quads, wasFixed);</span>
<span class="line-modified">!     collectAbsoluteQuadsForContinuation(quads, wasFixed);</span>
<span class="line-modified">! }</span>
  
<span class="line-added">+ void RenderBlock::absoluteQuadsIgnoringContinuation(const FloatRect&amp; logicalRect, Vector&lt;FloatQuad&gt;&amp; quads, bool* wasFixed) const</span>
<span class="line-added">+ {</span>
      // FIXME: This is wrong for block-flows that are horizontal.
      // https://bugs.webkit.org/show_bug.cgi?id=46781
<span class="line-modified">!     auto* fragmentedFlow = enclosingFragmentedFlow();</span>
<span class="line-modified">!     if (!fragmentedFlow || !fragmentedFlow-&gt;absoluteQuadsForBox(quads, wasFixed, this, logicalRect.y(), logicalRect.maxY()))</span>
<span class="line-modified">!         quads.append(localToAbsoluteQuad(logicalRect, UseTransforms, wasFixed));</span>
  }
  
  LayoutRect RenderBlock::rectWithOutlineForRepaint(const RenderLayerModelObject* repaintContainer, LayoutUnit outlineWidth) const
  {
      LayoutRect r(RenderBox::rectWithOutlineForRepaint(repaintContainer, outlineWidth));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3154,22 ***</span>
  TextRun RenderBlock::constructTextRun(const UChar* characters, unsigned length, const RenderStyle&amp; style, ExpansionBehavior expansion)
  {
      return constructTextRun(StringView(characters, length), style, expansion);
  }
  
<span class="line-modified">! #ifndef NDEBUG</span>
  void RenderBlock::checkPositionedObjectsNeedLayout()
  {
      auto* positionedDescendants = positionedObjects();
      if (!positionedDescendants)
          return;
  
      for (auto* renderer : *positionedDescendants)
          ASSERT(!renderer-&gt;needsLayout());
  }
<span class="line-modified">! </span>
<span class="line-removed">- #endif</span>
  
  bool RenderBlock::hasDefiniteLogicalHeight() const
  {
      return (bool)availableLogicalHeightForPercentageComputation();
  }
<span class="line-new-header">--- 3166,21 ---</span>
  TextRun RenderBlock::constructTextRun(const UChar* characters, unsigned length, const RenderStyle&amp; style, ExpansionBehavior expansion)
  {
      return constructTextRun(StringView(characters, length), style, expansion);
  }
  
<span class="line-modified">! #if ASSERT_ENABLED</span>
  void RenderBlock::checkPositionedObjectsNeedLayout()
  {
      auto* positionedDescendants = positionedObjects();
      if (!positionedDescendants)
          return;
  
      for (auto* renderer : *positionedDescendants)
          ASSERT(!renderer-&gt;needsLayout());
  }
<span class="line-modified">! #endif // ASSERT_ENABLED</span>
  
  bool RenderBlock::hasDefiniteLogicalHeight() const
  {
      return (bool)availableLogicalHeightForPercentageComputation();
  }
</pre>
<center><a href="PointerEventsHitRules.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderBlock.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>