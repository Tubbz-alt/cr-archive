<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/accessibility/AccessibilityLabel.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2016 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  *
  8  * 1.  Redistributions of source code must retain the above copyright
  9  *     notice, this list of conditions and the following disclaimer.
 10  * 2.  Redistributions in binary form must reproduce the above copyright
 11  *     notice, this list of conditions and the following disclaimer in the
 12  *     documentation and/or other materials provided with the distribution.
 13  * 3.  Neither the name of Apple Inc. (&quot;Apple&quot;) nor the names of
 14  *     its contributors may be used to endorse or promote products derived
 15  *     from this software without specific prior written permission.
 16  *
 17  * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 18  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 19  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 20  * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 21  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 22  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 23  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 24  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 25  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 26  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 27  */
 28 
 29 #include &quot;config.h&quot;
 30 #include &quot;AccessibilityLabel.h&quot;
 31 
 32 #include &quot;AXObjectCache.h&quot;
 33 #include &quot;HTMLNames.h&quot;
 34 
 35 namespace WebCore {
 36 
 37 using namespace HTMLNames;
 38 
 39 AccessibilityLabel::AccessibilityLabel(RenderObject* renderer)
 40     : AccessibilityRenderObject(renderer)
 41 {
 42 }
 43 
 44 AccessibilityLabel::~AccessibilityLabel() = default;
 45 
 46 Ref&lt;AccessibilityLabel&gt; AccessibilityLabel::create(RenderObject* renderer)
 47 {
 48     return adoptRef(*new AccessibilityLabel(renderer));
 49 }
 50 
 51 bool AccessibilityLabel::computeAccessibilityIsIgnored() const
 52 {
 53     return accessibilityIsIgnoredByDefault();
 54 }
 55 
 56 String AccessibilityLabel::stringValue() const
 57 {
 58     if (containsOnlyStaticText())
 59         return textUnderElement();
 60     return AccessibilityNodeObject::stringValue();
 61 }
 62 
 63 static bool childrenContainOnlyStaticText(const AccessibilityObject::AccessibilityChildrenVector&amp; children)
 64 {
 65     if (!children.size())
 66         return false;
 67     for (const auto&amp; child : children) {
 68         if (child-&gt;roleValue() == AccessibilityRole::StaticText)
 69             continue;
 70         if (child-&gt;roleValue() == AccessibilityRole::Group) {
 71             if (!childrenContainOnlyStaticText(child-&gt;children()))
 72                 return false;
 73         } else
 74             return false;
 75     }
 76     return true;
 77 }
 78 
 79 bool AccessibilityLabel::containsOnlyStaticText() const
 80 {
 81     if (m_containsOnlyStaticTextDirty)
 82         return childrenContainOnlyStaticText(m_children);
 83     return m_containsOnlyStaticText;
 84 }
 85 
 86 static bool childrenContainUnrelatedControls(const AccessibilityObject::AccessibilityChildrenVector&amp; children, AccessibilityObject* controlForLabel)
 87 {
 88     if (!children.size())
 89         return false;
 90 
 91     for (const auto&amp; child : children) {
 92         if (child-&gt;isControl()) {
 93             if (child == controlForLabel)
 94                 continue;
 95             return true;
 96         }
 97 
 98         if (childrenContainUnrelatedControls(child-&gt;children(), controlForLabel))
 99             return true;
100     }
101 
102     return false;
103 }
104 
105 bool AccessibilityLabel::containsUnrelatedControls() const
106 {
107     if (containsOnlyStaticText())
108         return false;
109 
110     return childrenContainUnrelatedControls(m_children, correspondingControlForLabelElement());
111 }
112 
113 void AccessibilityLabel::updateChildrenIfNecessary()
114 {
115     AccessibilityRenderObject::updateChildrenIfNecessary();
116     if (m_containsOnlyStaticTextDirty)
117         m_containsOnlyStaticText = childrenContainOnlyStaticText(m_children);
118     m_containsOnlyStaticTextDirty = false;
119 }
120 
121 void AccessibilityLabel::clearChildren()
122 {
123     AccessibilityRenderObject::clearChildren();
124     m_containsOnlyStaticText = false;
125     m_containsOnlyStaticTextDirty = false;
126 }
127 
128 void AccessibilityLabel::insertChild(AXCoreObject* object, unsigned index)
129 {
130     AccessibilityRenderObject::insertChild(object, index);
131     m_containsOnlyStaticTextDirty = true;
132 }
133 
134 } // namespace WebCore
    </pre>
  </body>
</html>