<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/RegExpMatchesArray.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="RegExpKey.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RegExpMatchesArray.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/RegExpMatchesArray.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 37     // https://bugs.webkit.org/show_bug.cgi?id=155144
 38 
 39     GCDeferralContext deferralContext(vm.heap);
 40     ObjectInitializationScope scope(vm);
 41 
 42     if (UNLIKELY(globalObject-&gt;isHavingABadTime())) {
 43         array = JSArray::tryCreateUninitializedRestricted(scope, &amp;deferralContext, globalObject-&gt;regExpMatchesArrayStructure(), regExp-&gt;numSubpatterns() + 1);
 44         // FIXME: we should probably throw an out of memory error here, but
 45         // when making this change we should check that all clients of this
 46         // function will correctly handle an exception being thrown from here.
 47         // https://bugs.webkit.org/show_bug.cgi?id=169786
 48         RELEASE_ASSERT(array);
 49 
 50         array-&gt;initializeIndexWithoutBarrier(scope, 0, jsEmptyString(vm));
 51 
 52         if (unsigned numSubpatterns = regExp-&gt;numSubpatterns()) {
 53             for (unsigned i = 1; i &lt;= numSubpatterns; ++i)
 54                 array-&gt;initializeIndexWithoutBarrier(scope, i, jsUndefined());
 55         }
 56     } else {
<span class="line-removed"> 57         ObjectInitializationScope scope(vm);</span>
 58         array = tryCreateUninitializedRegExpMatchesArray(scope, &amp;deferralContext, globalObject-&gt;regExpMatchesArrayStructure(), regExp-&gt;numSubpatterns() + 1);
 59         RELEASE_ASSERT(array);
 60 
 61         array-&gt;initializeIndexWithoutBarrier(scope, 0, jsEmptyString(vm), ArrayWithContiguous);
 62 
 63         if (unsigned numSubpatterns = regExp-&gt;numSubpatterns()) {
 64             for (unsigned i = 1; i &lt;= numSubpatterns; ++i)
 65                 array-&gt;initializeIndexWithoutBarrier(scope, i, jsUndefined(), ArrayWithContiguous);
 66         }
 67     }
 68 
 69     array-&gt;putDirectWithoutBarrier(RegExpMatchesArrayIndexPropertyOffset, jsNumber(-1));
 70     array-&gt;putDirectWithoutBarrier(RegExpMatchesArrayInputPropertyOffset, input);

 71     return array;
 72 }
 73 
<span class="line-modified"> 74 enum class ShouldCreateGroups { No, Yes };</span>
<span class="line-removed"> 75 </span>
<span class="line-removed"> 76 static Structure* createStructureImpl(VM&amp; vm, JSGlobalObject* globalObject, IndexingType indexingType, ShouldCreateGroups shouldCreateGroups = ShouldCreateGroups::No)</span>
 77 {
 78     Structure* structure = globalObject-&gt;arrayStructureForIndexingTypeDuringAllocation(indexingType);
 79     PropertyOffset offset;
 80     structure = Structure::addPropertyTransition(vm, structure, vm.propertyNames-&gt;index, 0, offset);
 81     ASSERT(offset == RegExpMatchesArrayIndexPropertyOffset);
 82     structure = Structure::addPropertyTransition(vm, structure, vm.propertyNames-&gt;input, 0, offset);
 83     ASSERT(offset == RegExpMatchesArrayInputPropertyOffset);
<span class="line-modified"> 84     switch (shouldCreateGroups) {</span>
<span class="line-modified"> 85     case ShouldCreateGroups::Yes:</span>
<span class="line-removed"> 86         structure = Structure::addPropertyTransition(vm, structure, vm.propertyNames-&gt;groups, 0, offset);</span>
<span class="line-removed"> 87         ASSERT(offset == RegExpMatchesArrayGroupsPropertyOffset);</span>
<span class="line-removed"> 88         break;</span>
<span class="line-removed"> 89     case ShouldCreateGroups::No:</span>
<span class="line-removed"> 90         break;</span>
<span class="line-removed"> 91     }</span>
 92     return structure;
 93 }
 94 
 95 Structure* createRegExpMatchesArrayStructure(VM&amp; vm, JSGlobalObject* globalObject)
 96 {
 97     return createStructureImpl(vm, globalObject, ArrayWithContiguous);
 98 }
 99 
100 Structure* createRegExpMatchesArraySlowPutStructure(VM&amp; vm, JSGlobalObject* globalObject)
101 {
102     return createStructureImpl(vm, globalObject, ArrayWithSlowPutArrayStorage);
103 }
104 
<span class="line-removed">105 Structure* createRegExpMatchesArrayWithGroupsStructure(VM&amp; vm, JSGlobalObject* globalObject)</span>
<span class="line-removed">106 {</span>
<span class="line-removed">107     return createStructureImpl(vm, globalObject, ArrayWithContiguous, ShouldCreateGroups::Yes);</span>
<span class="line-removed">108 }</span>
<span class="line-removed">109 </span>
<span class="line-removed">110 Structure* createRegExpMatchesArrayWithGroupsSlowPutStructure(VM&amp; vm, JSGlobalObject* globalObject)</span>
<span class="line-removed">111 {</span>
<span class="line-removed">112     return createStructureImpl(vm, globalObject, ArrayWithSlowPutArrayStorage, ShouldCreateGroups::Yes);</span>
<span class="line-removed">113 }</span>
<span class="line-removed">114 </span>
115 } // namespace JSC
</pre>
</td>
<td>
<hr />
<pre>
 37     // https://bugs.webkit.org/show_bug.cgi?id=155144
 38 
 39     GCDeferralContext deferralContext(vm.heap);
 40     ObjectInitializationScope scope(vm);
 41 
 42     if (UNLIKELY(globalObject-&gt;isHavingABadTime())) {
 43         array = JSArray::tryCreateUninitializedRestricted(scope, &amp;deferralContext, globalObject-&gt;regExpMatchesArrayStructure(), regExp-&gt;numSubpatterns() + 1);
 44         // FIXME: we should probably throw an out of memory error here, but
 45         // when making this change we should check that all clients of this
 46         // function will correctly handle an exception being thrown from here.
 47         // https://bugs.webkit.org/show_bug.cgi?id=169786
 48         RELEASE_ASSERT(array);
 49 
 50         array-&gt;initializeIndexWithoutBarrier(scope, 0, jsEmptyString(vm));
 51 
 52         if (unsigned numSubpatterns = regExp-&gt;numSubpatterns()) {
 53             for (unsigned i = 1; i &lt;= numSubpatterns; ++i)
 54                 array-&gt;initializeIndexWithoutBarrier(scope, i, jsUndefined());
 55         }
 56     } else {

 57         array = tryCreateUninitializedRegExpMatchesArray(scope, &amp;deferralContext, globalObject-&gt;regExpMatchesArrayStructure(), regExp-&gt;numSubpatterns() + 1);
 58         RELEASE_ASSERT(array);
 59 
 60         array-&gt;initializeIndexWithoutBarrier(scope, 0, jsEmptyString(vm), ArrayWithContiguous);
 61 
 62         if (unsigned numSubpatterns = regExp-&gt;numSubpatterns()) {
 63             for (unsigned i = 1; i &lt;= numSubpatterns; ++i)
 64                 array-&gt;initializeIndexWithoutBarrier(scope, i, jsUndefined(), ArrayWithContiguous);
 65         }
 66     }
 67 
 68     array-&gt;putDirectWithoutBarrier(RegExpMatchesArrayIndexPropertyOffset, jsNumber(-1));
 69     array-&gt;putDirectWithoutBarrier(RegExpMatchesArrayInputPropertyOffset, input);
<span class="line-added"> 70     array-&gt;putDirectWithoutBarrier(RegExpMatchesArrayGroupsPropertyOffset, jsUndefined());</span>
 71     return array;
 72 }
 73 
<span class="line-modified"> 74 static Structure* createStructureImpl(VM&amp; vm, JSGlobalObject* globalObject, IndexingType indexingType)</span>


 75 {
 76     Structure* structure = globalObject-&gt;arrayStructureForIndexingTypeDuringAllocation(indexingType);
 77     PropertyOffset offset;
 78     structure = Structure::addPropertyTransition(vm, structure, vm.propertyNames-&gt;index, 0, offset);
 79     ASSERT(offset == RegExpMatchesArrayIndexPropertyOffset);
 80     structure = Structure::addPropertyTransition(vm, structure, vm.propertyNames-&gt;input, 0, offset);
 81     ASSERT(offset == RegExpMatchesArrayInputPropertyOffset);
<span class="line-modified"> 82     structure = Structure::addPropertyTransition(vm, structure, vm.propertyNames-&gt;groups, 0, offset);</span>
<span class="line-modified"> 83     ASSERT(offset == RegExpMatchesArrayGroupsPropertyOffset);</span>






 84     return structure;
 85 }
 86 
 87 Structure* createRegExpMatchesArrayStructure(VM&amp; vm, JSGlobalObject* globalObject)
 88 {
 89     return createStructureImpl(vm, globalObject, ArrayWithContiguous);
 90 }
 91 
 92 Structure* createRegExpMatchesArraySlowPutStructure(VM&amp; vm, JSGlobalObject* globalObject)
 93 {
 94     return createStructureImpl(vm, globalObject, ArrayWithSlowPutArrayStorage);
 95 }
 96 










 97 } // namespace JSC
</pre>
</td>
</tr>
</table>
<center><a href="RegExpKey.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RegExpMatchesArray.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>