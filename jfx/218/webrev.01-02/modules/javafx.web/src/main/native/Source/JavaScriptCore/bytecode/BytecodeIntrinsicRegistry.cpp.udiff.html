<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/BytecodeIntrinsicRegistry.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="BytecodeGraph.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="BytecodeIntrinsicRegistry.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/BytecodeIntrinsicRegistry.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -29,35 +29,39 @@</span>
  
  #include &quot;ArrayIteratorPrototype.h&quot;
  #include &quot;BuiltinNames.h&quot;
  #include &quot;BytecodeGenerator.h&quot;
  #include &quot;IterationKind.h&quot;
<span class="udiff-line-modified-removed">- #include &quot;JSAsyncGeneratorFunction.h&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;JSArrayIterator.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;JSAsyncGenerator.h&quot;</span>
  #include &quot;JSCInlines.h&quot;
<span class="udiff-line-modified-removed">- #include &quot;JSGeneratorFunction.h&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;JSGenerator.h&quot;</span>
  #include &quot;JSGlobalObject.h&quot;
  #include &quot;JSModuleLoader.h&quot;
  #include &quot;JSPromise.h&quot;
<span class="udiff-line-added">+ #include &quot;JSStringIterator.h&quot;</span>
  #include &quot;Nodes.h&quot;
  #include &quot;StrongInlines.h&quot;
  
  namespace JSC {
  
<span class="udiff-line-modified-removed">- #define INITIALIZE_BYTECODE_INTRINSIC_NAMES_TO_SET(name) m_bytecodeIntrinsicMap.add(vm.propertyNames-&gt;builtinNames().name##PrivateName().impl(), &amp;BytecodeIntrinsicNode::emit_intrinsic_##name);</span>
<span class="udiff-line-modified-added">+ #define INITIALIZE_BYTECODE_INTRINSIC_NAMES_TO_SET(name) m_bytecodeIntrinsicMap.add(vm.propertyNames-&gt;builtinNames().name##PrivateName().impl(), Entry(&amp;BytecodeIntrinsicNode::emit_intrinsic_##name));</span>
<span class="udiff-line-added">+ #define INITIALIZE_BYTECODE_INTRINSIC_NAMES_TO_SET_FOR_LINK_TIME_CONSTANT(name, code) m_bytecodeIntrinsicMap.add(vm.propertyNames-&gt;builtinNames().name##PrivateName().impl(), JSC::LinkTimeConstant::name);</span>
  
  BytecodeIntrinsicRegistry::BytecodeIntrinsicRegistry(VM&amp; vm)
      : m_vm(vm)
      , m_bytecodeIntrinsicMap()
  {
      JSC_COMMON_BYTECODE_INTRINSIC_FUNCTIONS_EACH_NAME(INITIALIZE_BYTECODE_INTRINSIC_NAMES_TO_SET)
      JSC_COMMON_BYTECODE_INTRINSIC_CONSTANTS_EACH_NAME(INITIALIZE_BYTECODE_INTRINSIC_NAMES_TO_SET)
<span class="udiff-line-added">+     JSC_FOREACH_LINK_TIME_CONSTANTS(INITIALIZE_BYTECODE_INTRINSIC_NAMES_TO_SET_FOR_LINK_TIME_CONSTANT)</span>
  
      m_undefined.set(m_vm, jsUndefined());
      m_Infinity.set(m_vm, jsDoubleNumber(std::numeric_limits&lt;double&gt;::infinity()));
<span class="udiff-line-modified-removed">-     m_iterationKindKey.set(m_vm, jsNumber(IterateKey));</span>
<span class="udiff-line-modified-removed">-     m_iterationKindValue.set(m_vm, jsNumber(IterateValue));</span>
<span class="udiff-line-modified-removed">-     m_iterationKindKeyValue.set(m_vm, jsNumber(IterateKeyValue));</span>
<span class="udiff-line-modified-added">+     m_iterationKindKey.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(IterationKind::Keys)));</span>
<span class="udiff-line-modified-added">+     m_iterationKindValue.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(IterationKind::Values)));</span>
<span class="udiff-line-modified-added">+     m_iterationKindEntries.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(IterationKind::Entries)));</span>
      m_MAX_ARRAY_INDEX.set(m_vm, jsNumber(MAX_ARRAY_INDEX));
      m_MAX_STRING_LENGTH.set(m_vm, jsNumber(JSString::MaxLength));
      m_MAX_SAFE_INTEGER.set(m_vm, jsDoubleNumber(maxSafeInteger()));
      m_ModuleFetch.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSModuleLoader::Status::Fetch)));
      m_ModuleInstantiate.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSModuleLoader::Status::Instantiate)));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -67,32 +71,51 @@</span>
      m_promiseRejectionReject.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSPromiseRejectionOperation::Reject)));
      m_promiseRejectionHandle.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSPromiseRejectionOperation::Handle)));
      m_promiseStatePending.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSPromise::Status::Pending)));
      m_promiseStateFulfilled.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSPromise::Status::Fulfilled)));
      m_promiseStateRejected.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSPromise::Status::Rejected)));
<span class="udiff-line-modified-removed">-     m_GeneratorResumeModeNormal.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSGeneratorFunction::GeneratorResumeMode::NormalMode)));</span>
<span class="udiff-line-modified-removed">-     m_GeneratorResumeModeThrow.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSGeneratorFunction::GeneratorResumeMode::ThrowMode)));</span>
<span class="udiff-line-modified-removed">-     m_GeneratorResumeModeReturn.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSGeneratorFunction::GeneratorResumeMode::ReturnMode)));</span>
<span class="udiff-line-modified-removed">-     m_GeneratorStateCompleted.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSGeneratorFunction::GeneratorState::Completed)));</span>
<span class="udiff-line-modified-removed">-     m_GeneratorStateExecuting.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSGeneratorFunction::GeneratorState::Executing)));</span>
<span class="udiff-line-modified-removed">-     m_AsyncGeneratorStateCompleted.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGeneratorFunction::AsyncGeneratorState::Completed)));</span>
<span class="udiff-line-modified-removed">-     m_AsyncGeneratorStateExecuting.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGeneratorFunction::AsyncGeneratorState::Executing)));</span>
<span class="udiff-line-modified-removed">-     m_AsyncGeneratorStateSuspendedStart.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGeneratorFunction::AsyncGeneratorState::SuspendedStart)));</span>
<span class="udiff-line-modified-removed">-     m_AsyncGeneratorStateSuspendedYield.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGeneratorFunction::AsyncGeneratorState::SuspendedYield)));</span>
<span class="udiff-line-modified-removed">-     m_AsyncGeneratorStateAwaitingReturn.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGeneratorFunction::AsyncGeneratorState::AwaitingReturn)));</span>
<span class="udiff-line-modified-removed">-     m_AsyncGeneratorSuspendReasonYield.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGeneratorFunction::AsyncGeneratorSuspendReason::Yield)));</span>
<span class="udiff-line-modified-removed">-     m_AsyncGeneratorSuspendReasonAwait.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGeneratorFunction::AsyncGeneratorSuspendReason::Await)));</span>
<span class="udiff-line-modified-removed">-     m_AsyncGeneratorSuspendReasonNone.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGeneratorFunction::AsyncGeneratorSuspendReason::None)));</span>
<span class="udiff-line-modified-added">+     m_promiseStateMask.set(m_vm, jsNumber(JSPromise::stateMask));</span>
<span class="udiff-line-modified-added">+     m_promiseFlagsIsHandled.set(m_vm, jsNumber(JSPromise::isHandledFlag));</span>
<span class="udiff-line-modified-added">+     m_promiseFlagsIsFirstResolvingFunctionCalled.set(m_vm, jsNumber(JSPromise::isFirstResolvingFunctionCalledFlag));</span>
<span class="udiff-line-modified-added">+     // FIXME: Clean up JSInternalObjectImpl field registry.</span>
<span class="udiff-line-modified-added">+     // https://bugs.webkit.org/show_bug.cgi?id=201894</span>
<span class="udiff-line-modified-added">+     m_promiseFieldFlags.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSPromise::Field::Flags)));</span>
<span class="udiff-line-modified-added">+     m_promiseFieldReactionsOrResult.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSPromise::Field::ReactionsOrResult)));</span>
<span class="udiff-line-modified-added">+     m_generatorFieldState.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSGenerator::Field::State)));</span>
<span class="udiff-line-modified-added">+     m_generatorFieldNext.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSGenerator::Field::Next)));</span>
<span class="udiff-line-modified-added">+     m_generatorFieldThis.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSGenerator::Field::This)));</span>
<span class="udiff-line-modified-added">+     m_generatorFieldFrame.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSGenerator::Field::Frame)));</span>
<span class="udiff-line-modified-added">+     m_GeneratorResumeModeNormal.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSGenerator::GeneratorResumeMode::NormalMode)));</span>
<span class="udiff-line-modified-added">+     m_GeneratorResumeModeThrow.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSGenerator::GeneratorResumeMode::ThrowMode)));</span>
<span class="udiff-line-added">+     m_GeneratorResumeModeReturn.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSGenerator::GeneratorResumeMode::ReturnMode)));</span>
<span class="udiff-line-added">+     m_GeneratorStateCompleted.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSGenerator::GeneratorState::Completed)));</span>
<span class="udiff-line-added">+     m_GeneratorStateExecuting.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSGenerator::GeneratorState::Executing)));</span>
<span class="udiff-line-added">+     m_arrayIteratorFieldIteratedObject.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSArrayIterator::Field::IteratedObject)));</span>
<span class="udiff-line-added">+     m_arrayIteratorFieldIndex.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSArrayIterator::Field::Index)));</span>
<span class="udiff-line-added">+     m_arrayIteratorFieldKind.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSArrayIterator::Field::Kind)));</span>
<span class="udiff-line-added">+     m_stringIteratorFieldIndex.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSStringIterator::Field::Index)));</span>
<span class="udiff-line-added">+     m_stringIteratorFieldIteratedString.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSStringIterator::Field::IteratedString)));</span>
<span class="udiff-line-added">+     m_asyncGeneratorFieldSuspendReason.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSAsyncGenerator::Field::SuspendReason)));</span>
<span class="udiff-line-added">+     m_asyncGeneratorFieldQueueFirst.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSAsyncGenerator::Field::QueueFirst)));</span>
<span class="udiff-line-added">+     m_asyncGeneratorFieldQueueLast.set(m_vm, jsNumber(static_cast&lt;unsigned&gt;(JSAsyncGenerator::Field::QueueLast)));</span>
<span class="udiff-line-added">+     m_AsyncGeneratorStateCompleted.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGenerator::AsyncGeneratorState::Completed)));</span>
<span class="udiff-line-added">+     m_AsyncGeneratorStateExecuting.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGenerator::AsyncGeneratorState::Executing)));</span>
<span class="udiff-line-added">+     m_AsyncGeneratorStateSuspendedStart.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGenerator::AsyncGeneratorState::SuspendedStart)));</span>
<span class="udiff-line-added">+     m_AsyncGeneratorStateSuspendedYield.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGenerator::AsyncGeneratorState::SuspendedYield)));</span>
<span class="udiff-line-added">+     m_AsyncGeneratorStateAwaitingReturn.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGenerator::AsyncGeneratorState::AwaitingReturn)));</span>
<span class="udiff-line-added">+     m_AsyncGeneratorSuspendReasonYield.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGenerator::AsyncGeneratorSuspendReason::Yield)));</span>
<span class="udiff-line-added">+     m_AsyncGeneratorSuspendReasonAwait.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGenerator::AsyncGeneratorSuspendReason::Await)));</span>
<span class="udiff-line-added">+     m_AsyncGeneratorSuspendReasonNone.set(m_vm, jsNumber(static_cast&lt;int32_t&gt;(JSAsyncGenerator::AsyncGeneratorSuspendReason::None)));</span>
  }
  
<span class="udiff-line-modified-removed">- BytecodeIntrinsicNode::EmitterType BytecodeIntrinsicRegistry::lookup(const Identifier&amp; ident) const</span>
<span class="udiff-line-modified-added">+ Optional&lt;BytecodeIntrinsicRegistry::Entry&gt; BytecodeIntrinsicRegistry::lookup(const Identifier&amp; ident) const</span>
  {
      if (!ident.isPrivateName())
<span class="udiff-line-modified-removed">-         return nullptr;</span>
<span class="udiff-line-modified-added">+         return WTF::nullopt;</span>
      auto iterator = m_bytecodeIntrinsicMap.find(ident.impl());
      if (iterator == m_bytecodeIntrinsicMap.end())
<span class="udiff-line-modified-removed">-         return nullptr;</span>
<span class="udiff-line-modified-added">+         return WTF::nullopt;</span>
      return iterator-&gt;value;
  }
  
  #define JSC_DECLARE_BYTECODE_INTRINSIC_CONSTANT_GENERATORS(name) \
      JSValue BytecodeIntrinsicRegistry::name##Value(BytecodeGenerator&amp;) \
</pre>
<center><a href="BytecodeGraph.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="BytecodeIntrinsicRegistry.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>