<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/css/CSSVariableReferenceValue.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 // Copyright 2015 The Chromium Authors. All rights reserved.
  2 // Copyright (C) 2016 Apple Inc. All rights reserved.
  3 //
  4 // Redistribution and use in source and binary forms, with or without
  5 // modification, are permitted provided that the following conditions are
  6 // met:
  7 //
  8 //    * Redistributions of source code must retain the above copyright
  9 // notice, this list of conditions and the following disclaimer.
 10 //    * Redistributions in binary form must reproduce the above
 11 // copyright notice, this list of conditions and the following disclaimer
 12 // in the documentation and/or other materials provided with the
 13 // distribution.
 14 //    * Neither the name of Google Inc. nor the names of its
 15 // contributors may be used to endorse or promote products derived from
 16 // this software without specific prior written permission.
 17 //
 18 // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 19 // &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 20 // LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 21 // A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 22 // OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 23 // SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 24 // LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 25 // DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 26 // THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 27 // (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 28 // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 29 
 30 #include &quot;config.h&quot;
 31 #include &quot;CSSVariableReferenceValue.h&quot;
 32 
 33 #include &quot;RenderStyle.h&quot;
<a name="1" id="anc1"></a>
 34 #include &quot;StyleResolver.h&quot;
 35 
 36 namespace WebCore {
 37 
 38 String CSSVariableReferenceValue::customCSSText() const
 39 {
 40     if (!m_serialized) {
 41         m_serialized = true;
 42         m_stringValue = m_data-&gt;tokenRange().serialize();
 43     }
 44     return m_stringValue;
 45 }
 46 
<a name="2" id="anc2"></a><span class="line-modified"> 47 static bool resolveTokenRange(CSSParserTokenRange, Vector&lt;CSSParserToken&gt;&amp;, ApplyCascadedPropertyState&amp;);</span>
 48 
<a name="3" id="anc3"></a><span class="line-modified"> 49 static bool resolveVariableFallback(CSSParserTokenRange range, Vector&lt;CSSParserToken&gt;&amp; result, ApplyCascadedPropertyState&amp; state)</span>
 50 {
 51     if (range.atEnd())
 52         return false;
 53     ASSERT(range.peek().type() == CommaToken);
 54     range.consume();
<a name="4" id="anc4"></a><span class="line-modified"> 55     return resolveTokenRange(range, result, state);</span>
 56 }
 57 
<a name="5" id="anc5"></a><span class="line-modified"> 58 static bool resolveVariableReference(CSSParserTokenRange range, Vector&lt;CSSParserToken&gt;&amp; result, ApplyCascadedPropertyState&amp; state)</span>
 59 {
<a name="6" id="anc6"></a><span class="line-modified"> 60     auto&amp; registeredProperties = state.styleResolver-&gt;document().getCSSRegisteredCustomPropertySet();</span>
<span class="line-modified"> 61     auto&amp; style = *state.styleResolver-&gt;style();</span>
 62 
 63     range.consumeWhitespace();
 64     ASSERT(range.peek().type() == IdentToken);
 65     String variableName = range.consumeIncludingWhitespace().value().toString();
 66     ASSERT(range.atEnd() || (range.peek().type() == CommaToken));
 67 
 68     // Apply this variable first, in case it is still unresolved
<a name="7" id="anc7"></a><span class="line-modified"> 69     state.styleResolver-&gt;applyCascadedCustomProperty(variableName, state);</span>
 70 
 71     // Apply fallback to detect cycles
 72     Vector&lt;CSSParserToken&gt; fallbackResult;
<a name="8" id="anc8"></a><span class="line-modified"> 73     bool fallbackReturn = resolveVariableFallback(CSSParserTokenRange(range), fallbackResult, state);</span>
 74 
 75     auto* property = style.getCustomProperty(variableName);
 76 
 77     if (!property || property-&gt;isUnset()) {
 78         auto* registered = registeredProperties.get(variableName);
 79         if (registered &amp;&amp; registered-&gt;initialValue())
 80             property = registered-&gt;initialValue();
 81     }
 82 
 83     if (!property || property-&gt;isInvalid()) {
 84         if (fallbackReturn)
 85             result.appendVector(fallbackResult);
 86         return fallbackReturn;
 87     }
 88 
 89     ASSERT(property-&gt;isResolved());
 90     result.appendVector(property-&gt;tokens());
 91 
 92     return true;
 93 }
 94 
<a name="9" id="anc9"></a><span class="line-modified"> 95 static bool resolveTokenRange(CSSParserTokenRange range, Vector&lt;CSSParserToken&gt;&amp; result, ApplyCascadedPropertyState&amp; state)</span>
 96 {
 97     bool success = true;
 98     while (!range.atEnd()) {
 99         if (range.peek().functionId() == CSSValueVar || range.peek().functionId() == CSSValueEnv)
<a name="10" id="anc10"></a><span class="line-modified">100             success &amp;= resolveVariableReference(range.consumeBlock(), result, state);</span>
101         else
102             result.append(range.consume());
103     }
104     return success;
105 }
106 
<a name="11" id="anc11"></a><span class="line-modified">107 RefPtr&lt;CSSVariableData&gt; CSSVariableReferenceValue::resolveVariableReferences(ApplyCascadedPropertyState&amp; state) const</span>
108 {
109     Vector&lt;CSSParserToken&gt; resolvedTokens;
110     CSSParserTokenRange range = m_data-&gt;tokenRange();
111 
<a name="12" id="anc12"></a><span class="line-modified">112     if (!resolveTokenRange(range, resolvedTokens, state))</span>
113         return nullptr;
114 
115     return CSSVariableData::create(resolvedTokens);
116 }
117 
118 } // namespace WebCore
<a name="13" id="anc13"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="13" type="hidden" />
</body>
</html>