<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/css/StyleRuleImport.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="StyleRule.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StyleRuleImport.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/css/StyleRuleImport.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 25 #include &quot;CSSStyleSheet.h&quot;
 26 #include &quot;CachedCSSStyleSheet.h&quot;
 27 #include &quot;CachedResourceLoader.h&quot;
 28 #include &quot;CachedResourceRequest.h&quot;
 29 #include &quot;CachedResourceRequestInitiators.h&quot;
 30 #include &quot;Document.h&quot;
 31 #include &quot;MediaList.h&quot;
 32 #include &quot;MediaQueryParser.h&quot;
 33 #include &quot;SecurityOrigin.h&quot;
 34 #include &quot;StyleSheetContents.h&quot;
 35 #include &lt;wtf/StdLibExtras.h&gt;
 36 
 37 namespace WebCore {
 38 
 39 Ref&lt;StyleRuleImport&gt; StyleRuleImport::create(const String&amp; href, Ref&lt;MediaQuerySet&gt;&amp;&amp; media)
 40 {
 41     return adoptRef(*new StyleRuleImport(href, WTFMove(media)));
 42 }
 43 
 44 StyleRuleImport::StyleRuleImport(const String&amp; href, Ref&lt;MediaQuerySet&gt;&amp;&amp; media)
<span class="line-modified"> 45     : StyleRuleBase(Import)</span>
<span class="line-removed"> 46     , m_parentStyleSheet(0)</span>
 47     , m_styleSheetClient(this)
 48     , m_strHref(href)
 49     , m_mediaQueries(WTFMove(media))
<span class="line-removed"> 50     , m_cachedSheet(0)</span>
<span class="line-removed"> 51     , m_loading(false)</span>
 52 {
 53     if (!m_mediaQueries)
 54         m_mediaQueries = MediaQuerySet::create(String(), MediaQueryParserContext());
 55 }
 56 
 57 StyleRuleImport::~StyleRuleImport()
 58 {
 59     if (m_styleSheet)
 60         m_styleSheet-&gt;clearOwnerRule();
 61     if (m_cachedSheet)
 62         m_cachedSheet-&gt;removeClient(m_styleSheetClient);
 63 }
 64 
 65 void StyleRuleImport::setCSSStyleSheet(const String&amp; href, const URL&amp; baseURL, const String&amp; charset, const CachedCSSStyleSheet* cachedStyleSheet)
 66 {
 67     if (m_styleSheet)
 68         m_styleSheet-&gt;clearOwnerRule();
 69 
 70     CSSParserContext context = m_parentStyleSheet ? m_parentStyleSheet-&gt;parserContext() : HTMLStandardMode;
 71     context.charset = charset;
</pre>
<hr />
<pre>
142         };
143         options.loadedFromOpaqueSource = m_parentStyleSheet-&gt;isContentOpaque() ? LoadedFromOpaqueSource::Yes : LoadedFromOpaqueSource::No;
144 
145         request.setOptions(WTFMove(options));
146 
147         m_cachedSheet = document-&gt;cachedResourceLoader().requestUserCSSStyleSheet(*page, WTFMove(request));
148     } else {
149         auto options = request.options();
150         options.loadedFromOpaqueSource = m_parentStyleSheet-&gt;isContentOpaque() ? LoadedFromOpaqueSource::Yes : LoadedFromOpaqueSource::No;
151         request.setOptions(WTFMove(options));
152         m_cachedSheet = document-&gt;cachedResourceLoader().requestCSSStyleSheet(WTFMove(request)).value_or(nullptr);
153     }
154     if (m_cachedSheet) {
155         // if the import rule is issued dynamically, the sheet may be
156         // removed from the pending sheet count, so let the doc know
157         // the sheet being imported is pending.
158         if (m_parentStyleSheet &amp;&amp; m_parentStyleSheet-&gt;loadCompleted() &amp;&amp; rootSheet == m_parentStyleSheet)
159             m_parentStyleSheet-&gt;startLoadingDynamicSheet();
160         m_loading = true;
161         m_cachedSheet-&gt;addClient(m_styleSheetClient);



162     }
163 }
164 
165 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
 25 #include &quot;CSSStyleSheet.h&quot;
 26 #include &quot;CachedCSSStyleSheet.h&quot;
 27 #include &quot;CachedResourceLoader.h&quot;
 28 #include &quot;CachedResourceRequest.h&quot;
 29 #include &quot;CachedResourceRequestInitiators.h&quot;
 30 #include &quot;Document.h&quot;
 31 #include &quot;MediaList.h&quot;
 32 #include &quot;MediaQueryParser.h&quot;
 33 #include &quot;SecurityOrigin.h&quot;
 34 #include &quot;StyleSheetContents.h&quot;
 35 #include &lt;wtf/StdLibExtras.h&gt;
 36 
 37 namespace WebCore {
 38 
 39 Ref&lt;StyleRuleImport&gt; StyleRuleImport::create(const String&amp; href, Ref&lt;MediaQuerySet&gt;&amp;&amp; media)
 40 {
 41     return adoptRef(*new StyleRuleImport(href, WTFMove(media)));
 42 }
 43 
 44 StyleRuleImport::StyleRuleImport(const String&amp; href, Ref&lt;MediaQuerySet&gt;&amp;&amp; media)
<span class="line-modified"> 45     : StyleRuleBase(StyleRuleType::Import)</span>

 46     , m_styleSheetClient(this)
 47     , m_strHref(href)
 48     , m_mediaQueries(WTFMove(media))


 49 {
 50     if (!m_mediaQueries)
 51         m_mediaQueries = MediaQuerySet::create(String(), MediaQueryParserContext());
 52 }
 53 
 54 StyleRuleImport::~StyleRuleImport()
 55 {
 56     if (m_styleSheet)
 57         m_styleSheet-&gt;clearOwnerRule();
 58     if (m_cachedSheet)
 59         m_cachedSheet-&gt;removeClient(m_styleSheetClient);
 60 }
 61 
 62 void StyleRuleImport::setCSSStyleSheet(const String&amp; href, const URL&amp; baseURL, const String&amp; charset, const CachedCSSStyleSheet* cachedStyleSheet)
 63 {
 64     if (m_styleSheet)
 65         m_styleSheet-&gt;clearOwnerRule();
 66 
 67     CSSParserContext context = m_parentStyleSheet ? m_parentStyleSheet-&gt;parserContext() : HTMLStandardMode;
 68     context.charset = charset;
</pre>
<hr />
<pre>
139         };
140         options.loadedFromOpaqueSource = m_parentStyleSheet-&gt;isContentOpaque() ? LoadedFromOpaqueSource::Yes : LoadedFromOpaqueSource::No;
141 
142         request.setOptions(WTFMove(options));
143 
144         m_cachedSheet = document-&gt;cachedResourceLoader().requestUserCSSStyleSheet(*page, WTFMove(request));
145     } else {
146         auto options = request.options();
147         options.loadedFromOpaqueSource = m_parentStyleSheet-&gt;isContentOpaque() ? LoadedFromOpaqueSource::Yes : LoadedFromOpaqueSource::No;
148         request.setOptions(WTFMove(options));
149         m_cachedSheet = document-&gt;cachedResourceLoader().requestCSSStyleSheet(WTFMove(request)).value_or(nullptr);
150     }
151     if (m_cachedSheet) {
152         // if the import rule is issued dynamically, the sheet may be
153         // removed from the pending sheet count, so let the doc know
154         // the sheet being imported is pending.
155         if (m_parentStyleSheet &amp;&amp; m_parentStyleSheet-&gt;loadCompleted() &amp;&amp; rootSheet == m_parentStyleSheet)
156             m_parentStyleSheet-&gt;startLoadingDynamicSheet();
157         m_loading = true;
158         m_cachedSheet-&gt;addClient(m_styleSheetClient);
<span class="line-added">159     } else if (m_parentStyleSheet) {</span>
<span class="line-added">160         m_parentStyleSheet-&gt;setLoadErrorOccured();</span>
<span class="line-added">161         m_parentStyleSheet-&gt;checkLoaded();</span>
162     }
163 }
164 
165 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="StyleRule.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StyleRuleImport.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>