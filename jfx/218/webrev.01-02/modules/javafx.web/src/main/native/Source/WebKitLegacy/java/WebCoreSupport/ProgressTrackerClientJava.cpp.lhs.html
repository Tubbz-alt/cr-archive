<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebKitLegacy/java/WebCoreSupport/ProgressTrackerClientJava.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 
 27 #include &quot;ProgressTrackerClientJava.h&quot;
 28 #include &quot;WebPage.h&quot;
 29 
 30 #include &lt;WebCore/DocumentLoader.h&gt;
 31 #include &lt;WebCore/FrameLoader.h&gt;
 32 #include &lt;WebCore/Page.h&gt;
 33 #include &lt;WebCore/ProgressTracker.h&gt;
 34 
 35 #include &quot;com_sun_webkit_LoadListenerClient.h&quot;
 36 
 37 namespace ProgressTrackerClientJavaInternal {
 38 static JGClass webPageClass;
 39 static jmethodID fireLoadEventMID;
 40 
 41 static void initRefs(JNIEnv* env)
 42 {
 43     if (!webPageClass) {
 44         webPageClass = JLClass(env-&gt;FindClass(
 45             &quot;com/sun/webkit/WebPage&quot;));
 46         ASSERT(webPageClass);
 47 
 48         fireLoadEventMID = env-&gt;GetMethodID(webPageClass,
 49                                     &quot;fwkFireLoadEvent&quot;,
 50                                     &quot;(JILjava/lang/String;Ljava/lang/String;DI)V&quot;);
 51         ASSERT(fireLoadEventMID);
 52     }
 53 }
 54 }
 55 
 56 namespace WebCore {
 57 
 58 ProgressTrackerClientJava::ProgressTrackerClientJava(const JLObject&amp; webPage)
 59     : m_webPage(webPage)
 60 {
 61 }
 62 
 63 void ProgressTrackerClientJava::progressStarted(Frame&amp;)
 64 {
 65 }
 66 
 67 void ProgressTrackerClientJava::progressEstimateChanged(Frame&amp; originatingProgressFrame)
 68 {
 69     using namespace ProgressTrackerClientJavaInternal;
 70     JNIEnv* env = WTF::GetJavaEnv();
 71     initRefs(env);
 72 
 73     double progress = originatingProgressFrame.page()-&gt;progress().estimatedProgress();
 74     // We have a redundant notification from webkit (with progress == 1)
 75     // after PAGE_FINISHED has already been posted.
 76     DocumentLoader* documentLoader = originatingProgressFrame.loader().activeDocumentLoader();
 77     if (documentLoader &amp;&amp; progress &lt; 1) {
 78         JLString urlJavaString(documentLoader-&gt;url().string().toJavaString(env));
 79         JLString contentTypeJavaString(documentLoader-&gt;responseMIMEType().toJavaString(env));
 80 
 81         if (documentLoader-&gt;mainResourceData()) {
 82             documentLoader-&gt;mainResourceData()-&gt;size(); // TODO-java: recheck
 83         }
 84         // Second, send a load event
 85         env-&gt;CallVoidMethod(m_webPage, fireLoadEventMID,
 86                             ptr_to_jlong(&amp;originatingProgressFrame),
 87                             com_sun_webkit_LoadListenerClient_PROGRESS_CHANGED,
 88                             (jstring)urlJavaString,
 89                             (jstring)contentTypeJavaString,
 90                             progress,
 91                             0);
 92         WTF::CheckAndClearException(env);
 93     }
 94 }
 95 
 96 void ProgressTrackerClientJava::progressFinished(Frame&amp;)
 97 {
 98     // shouldn&#39;t post PROGRESS_CHANGED after PAGE_FINISHED
 99 }
100 
<a name="1" id="anc1"></a><span class="line-removed">101 void ProgressTrackerClientJava::progressTrackerDestroyed()</span>
<span class="line-removed">102 {</span>
<span class="line-removed">103     delete this;</span>
<span class="line-removed">104 }</span>
<span class="line-removed">105 </span>
106 } // namespace WebCore
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>