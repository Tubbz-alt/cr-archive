<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/Pasteboard.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Pasteboard.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PasteboardItemInfo.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/Pasteboard.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;DragImage.h&quot;

 29 #include &quot;PasteboardItemInfo.h&quot;
 30 #include &lt;wtf/HashMap.h&gt;
 31 #include &lt;wtf/ListHashSet.h&gt;
 32 #include &lt;wtf/Noncopyable.h&gt;
 33 #include &lt;wtf/URL.h&gt;
 34 #include &lt;wtf/Vector.h&gt;
 35 #include &lt;wtf/text/WTFString.h&gt;
 36 
 37 #if PLATFORM(IOS_FAMILY)
 38 OBJC_CLASS NSString;
 39 #endif
 40 
 41 #if PLATFORM(COCOA)
 42 OBJC_CLASS NSArray;
 43 #endif
 44 
 45 #if PLATFORM(WIN)
 46 #include &quot;COMPtr.h&quot;
 47 #include &quot;WCDataObject.h&quot;
 48 #include &lt;objidl.h&gt;
</pre>
<hr />
<pre>
 51 #endif
 52 
 53 #if PLATFORM(JAVA)
 54 #include &quot;DataObjectJava.h&quot;
 55 #endif
 56 
 57 // FIXME: This class uses the DOM and makes calls to Editor.
 58 // It should be divested of its knowledge of the frame and editor.
 59 
 60 namespace WebCore {
 61 
 62 class DocumentFragment;
 63 class DragData;
 64 class Element;
 65 class Frame;
 66 class PasteboardStrategy;
 67 class Range;
 68 class SelectionData;
 69 class SharedBuffer;
 70 
<span class="line-modified"> 71 enum class WebContentReadingPolicy { AnyType, OnlyRichTextTypes };</span>

 72 enum ShouldSerializeSelectedTextForDataTransfer { DefaultSelectedTextType, IncludeImageAltTextForDataTransfer };
 73 
 74 // For writing to the pasteboard. Generally sorted with the richest formats on top.
 75 
 76 struct PasteboardWebContent {
 77 #if PLATFORM(COCOA)
 78     WEBCORE_EXPORT PasteboardWebContent();
 79     WEBCORE_EXPORT ~PasteboardWebContent();
 80     String contentOrigin;
 81     bool canSmartCopyOrDelete;
 82     RefPtr&lt;SharedBuffer&gt; dataInWebArchiveFormat;
 83     RefPtr&lt;SharedBuffer&gt; dataInRTFDFormat;
 84     RefPtr&lt;SharedBuffer&gt; dataInRTFFormat;
 85     RefPtr&lt;SharedBuffer&gt; dataInAttributedStringFormat;
 86     String dataInHTMLFormat;
 87     String dataInStringFormat;
 88     Vector&lt;String&gt; clientTypes;
 89     Vector&lt;RefPtr&lt;SharedBuffer&gt;&gt; clientData;
 90 #endif
 91 #if PLATFORM(GTK)
</pre>
<hr />
<pre>
131 };
132 
133 // For reading from the pasteboard.
134 
135 class PasteboardWebContentReader {
136 public:
137     String contentOrigin;
138 
139     virtual ~PasteboardWebContentReader() = default;
140 
141 #if PLATFORM(COCOA)
142     virtual bool readWebArchive(SharedBuffer&amp;) = 0;
143     virtual bool readFilePath(const String&amp;, PresentationSize preferredPresentationSize = { }, const String&amp; contentType = { }) = 0;
144     virtual bool readFilePaths(const Vector&lt;String&gt;&amp;) = 0;
145     virtual bool readHTML(const String&amp;) = 0;
146     virtual bool readRTFD(SharedBuffer&amp;) = 0;
147     virtual bool readRTF(SharedBuffer&amp;) = 0;
148     virtual bool readImage(Ref&lt;SharedBuffer&gt;&amp;&amp;, const String&amp; type, PresentationSize preferredPresentationSize = { }) = 0;
149     virtual bool readURL(const URL&amp;, const String&amp; title) = 0;
150     virtual bool readDataBuffer(SharedBuffer&amp;, const String&amp; type, const String&amp; name, PresentationSize preferredPresentationSize = { }) = 0;
<span class="line-removed">151 #endif</span>
152     virtual bool readPlainText(const String&amp;) = 0;

153 };
154 
155 struct PasteboardPlainText {
156     String text;
157 #if PLATFORM(COCOA)
158     bool isURL;
159 #endif
160 };
161 
162 struct PasteboardFileReader {
163     virtual ~PasteboardFileReader() = default;
164     virtual void readFilename(const String&amp;) = 0;
165     virtual void readBuffer(const String&amp; filename, const String&amp; type, Ref&lt;SharedBuffer&gt;&amp;&amp;) = 0;
166 };
167 
<span class="line-removed">168 // FIXME: We need to ensure that the contents of sameOriginCustomData are not accessible across different origins.</span>
<span class="line-removed">169 struct PasteboardCustomData {</span>
<span class="line-removed">170     String origin;</span>
<span class="line-removed">171     Vector&lt;String&gt; orderedTypes;</span>
<span class="line-removed">172     HashMap&lt;String, String&gt; platformData;</span>
<span class="line-removed">173     HashMap&lt;String, String&gt; sameOriginCustomData;</span>
<span class="line-removed">174 </span>
<span class="line-removed">175     WEBCORE_EXPORT Ref&lt;SharedBuffer&gt; createSharedBuffer() const;</span>
<span class="line-removed">176     WEBCORE_EXPORT static PasteboardCustomData fromSharedBuffer(const SharedBuffer&amp;);</span>
<span class="line-removed">177 </span>
<span class="line-removed">178 #if PLATFORM(COCOA)</span>
<span class="line-removed">179     WEBCORE_EXPORT static const char* cocoaType();</span>
<span class="line-removed">180 #endif</span>
<span class="line-removed">181 };</span>
<span class="line-removed">182 </span>
183 class Pasteboard {
184     WTF_MAKE_NONCOPYABLE(Pasteboard); WTF_MAKE_FAST_ALLOCATED;
185 public:
186     Pasteboard();
187     virtual ~Pasteboard();
188 
189 #if PLATFORM(GTK)
190     explicit Pasteboard(const String&amp; name);
191     explicit Pasteboard(SelectionData&amp;);
192 #endif
193 
194 #if PLATFORM(WIN)
195     explicit Pasteboard(IDataObject*);
196     explicit Pasteboard(WCDataObject*);
197     explicit Pasteboard(const DragDataMap&amp;);
198 #endif
199 
200     WEBCORE_EXPORT static std::unique_ptr&lt;Pasteboard&gt; createForCopyAndPaste();
201 
202     static bool isSafeTypeForDOMToReadAndWrite(const String&amp;);
203     static bool canExposeURLToDOMWhenPasteboardContainsFiles(const String&amp;);
204 
205     virtual bool isStatic() const { return false; }
206 
207     virtual WEBCORE_EXPORT bool hasData();
208     virtual WEBCORE_EXPORT Vector&lt;String&gt; typesSafeForBindings(const String&amp; origin);
209     virtual WEBCORE_EXPORT Vector&lt;String&gt; typesForLegacyUnsafeBindings();
210     virtual WEBCORE_EXPORT String readOrigin();
211     virtual WEBCORE_EXPORT String readString(const String&amp; type);
212     virtual WEBCORE_EXPORT String readStringInCustomData(const String&amp; type);
213     virtual WEBCORE_EXPORT Vector&lt;String&gt; readAllStrings(const String&amp; type);
214 
215     virtual WEBCORE_EXPORT void writeString(const String&amp; type, const String&amp; data);
216     virtual WEBCORE_EXPORT void clear();
217     virtual WEBCORE_EXPORT void clear(const String&amp; type);
218 
<span class="line-modified">219     virtual WEBCORE_EXPORT void read(PasteboardPlainText&amp;);</span>
<span class="line-modified">220     virtual WEBCORE_EXPORT void read(PasteboardWebContentReader&amp;, WebContentReadingPolicy = WebContentReadingPolicy::AnyType);</span>
221     virtual WEBCORE_EXPORT void read(PasteboardFileReader&amp;);
222 
223     virtual WEBCORE_EXPORT void write(const Color&amp;);
224     virtual WEBCORE_EXPORT void write(const PasteboardURL&amp;);
225     virtual WEBCORE_EXPORT void writeTrustworthyWebURLsPboardType(const PasteboardURL&amp;);
226     virtual WEBCORE_EXPORT void write(const PasteboardImage&amp;);
227     virtual WEBCORE_EXPORT void write(const PasteboardWebContent&amp;);
228 
<span class="line-modified">229     virtual WEBCORE_EXPORT void writeCustomData(const PasteboardCustomData&amp;);</span>
230 
231     enum class FileContentState { NoFileOrImageData, InMemoryImage, MayContainFilePaths };
232     virtual WEBCORE_EXPORT FileContentState fileContentState();
233     virtual WEBCORE_EXPORT bool canSmartReplace();
234 
235     virtual WEBCORE_EXPORT void writeMarkup(const String&amp; markup);
236     enum SmartReplaceOption { CanSmartReplace, CannotSmartReplace };
237     virtual WEBCORE_EXPORT void writePlainText(const String&amp;, SmartReplaceOption); // FIXME: Two separate functions would be clearer than one function with an argument.
238 
239 #if PLATFORM(JAVA)
240     RefPtr&lt;DataObjectJava&gt; dataObject() const { return m_dataObject; }
241 #endif
242 
243 #if ENABLE(DRAG_SUPPORT)
244     WEBCORE_EXPORT static std::unique_ptr&lt;Pasteboard&gt; createForDragAndDrop();
245     WEBCORE_EXPORT static std::unique_ptr&lt;Pasteboard&gt; createForDragAndDrop(const DragData&amp;);
246 
247     virtual void setDragImage(DragImage, const IntPoint&amp; hotSpot);
248 #endif
249 
250 #if PLATFORM(WIN) || PLATFORM(JAVA)
251     RefPtr&lt;DocumentFragment&gt; documentFragment(Frame&amp;, Range&amp;, bool allowPlainText, bool&amp; chosePlainText); // FIXME: Layering violation.
252     void writeImage(Element&amp;, const URL&amp;, const String&amp; title); // FIXME: Layering violation.
253     void writeSelection(Range&amp;, bool canSmartCopyOrDelete, Frame&amp;, ShouldSerializeSelectedTextForDataTransfer = DefaultSelectedTextType); // FIXME: Layering violation.
254 #endif
255 
256 #if PLATFORM(GTK)
257     const SelectionData&amp; selectionData() const;
258     static std::unique_ptr&lt;Pasteboard&gt; createForGlobalSelection();
259 #endif
260 
261 #if PLATFORM(IOS_FAMILY)
<span class="line-modified">262     explicit Pasteboard(long changeCount);</span>
263     explicit Pasteboard(const String&amp; pasteboardName);
264 
265     static NSArray *supportedWebContentPasteboardTypes();
266     static String resourceMIMEType(NSString *mimeType);
267 #endif
268 
269 #if PLATFORM(MAC)
270     explicit Pasteboard(const String&amp; pasteboardName, const Vector&lt;String&gt;&amp; promisedFilePaths = { });
271 #endif
272 
273 #if PLATFORM(COCOA)
274     static bool shouldTreatCocoaTypeAsFile(const String&amp;);
275     WEBCORE_EXPORT static NSArray *supportedFileUploadPasteboardTypes();
<span class="line-modified">276     const String&amp; name() const { return m_pasteboardName; }</span>
<span class="line-removed">277     long changeCount() const;</span>
278     const PasteboardCustomData&amp; readCustomData();








279 #endif
280 
281 #if PLATFORM(WIN)
282     COMPtr&lt;IDataObject&gt; dataObject() const { return m_dataObject; }
283     void setExternalDataObject(IDataObject*);
284     const DragDataMap&amp; dragDataMap() const { return m_dragDataMap; }
285     void writeURLToWritableDataObject(const URL&amp;, const String&amp;);
286     COMPtr&lt;WCDataObject&gt; writableDataObject() const { return m_writableDataObject; }
287     void writeImageToDataObject(Element&amp;, const URL&amp;); // FIXME: Layering violation.
288 #endif
289 







290 private:
291 #if PLATFORM(IOS_FAMILY)
292     bool respectsUTIFidelities() const;
<span class="line-modified">293     void readRespectingUTIFidelities(PasteboardWebContentReader&amp;, WebContentReadingPolicy);</span>
294 
295     enum class ReaderResult {
296         ReadType,
297         DidNotReadType,
298         PasteboardWasChangedExternally
299     };
300     ReaderResult readPasteboardWebContentDataForType(PasteboardWebContentReader&amp;, PasteboardStrategy&amp;, NSString *type, const PasteboardItemInfo&amp;, int itemIndex);
301 #endif
302 
303 #if PLATFORM(WIN)
304     void finishCreatingPasteboard();
305     void writeRangeToDataObject(Range&amp;, Frame&amp;); // FIXME: Layering violation.
306     void writeURLToDataObject(const URL&amp;, const String&amp;);
307     void writePlainTextToDataObject(const String&amp;, SmartReplaceOption);
308 #endif
309 
310 #if PLATFORM(JAVA)
311     Pasteboard(RefPtr&lt;DataObjectJava&gt;, bool copyPasteMode);
312     static std::unique_ptr&lt;Pasteboard&gt; create(RefPtr&lt;DataObjectJava&gt;);
313 #endif
314 
315 #if PLATFORM(COCOA)
316     Vector&lt;String&gt; readFilePaths();
<span class="line-modified">317     Vector&lt;String&gt; readPlatformValuesAsStrings(const String&amp; domType, long changeCount, const String&amp; pasteboardName);</span>
318     static void addHTMLClipboardTypesForCocoaType(ListHashSet&lt;String&gt;&amp; resultTypes, const String&amp; cocoaType);
319     String readStringForPlatformType(const String&amp;);
320     Vector&lt;String&gt; readTypesWithSecurityCheck();
321     RefPtr&lt;SharedBuffer&gt; readBufferForTypeWithSecurityCheck(const String&amp;);
322 #endif
323 
324 #if PLATFORM(GTK)
325     void writeToClipboard();
326     void readFromClipboard();
327     Ref&lt;SelectionData&gt; m_selectionData;
328     String m_name;
329 #endif
330 
331 #if PLATFORM(COCOA)
332     String m_pasteboardName;
<span class="line-modified">333     long m_changeCount;</span>
334     Optional&lt;PasteboardCustomData&gt; m_customDataCache;
335 #endif
336 
337 #if PLATFORM(MAC)
338     Vector&lt;String&gt; m_promisedFilePaths;
339 #endif
340 
341 #if PLATFORM(WIN)
342     HWND m_owner;
343     COMPtr&lt;IDataObject&gt; m_dataObject;
344     COMPtr&lt;WCDataObject&gt; m_writableDataObject;
345     DragDataMap m_dragDataMap;
346 #endif
347 
348 #if PLATFORM(JAVA)
349     RefPtr&lt;DataObjectJava&gt; m_dataObject;
350     bool m_copyPasteMode;
351 #endif
352 };
353 
</pre>
</td>
<td>
<hr />
<pre>
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;DragImage.h&quot;
<span class="line-added"> 29 #include &quot;PasteboardCustomData.h&quot;</span>
 30 #include &quot;PasteboardItemInfo.h&quot;
 31 #include &lt;wtf/HashMap.h&gt;
 32 #include &lt;wtf/ListHashSet.h&gt;
 33 #include &lt;wtf/Noncopyable.h&gt;
 34 #include &lt;wtf/URL.h&gt;
 35 #include &lt;wtf/Vector.h&gt;
 36 #include &lt;wtf/text/WTFString.h&gt;
 37 
 38 #if PLATFORM(IOS_FAMILY)
 39 OBJC_CLASS NSString;
 40 #endif
 41 
 42 #if PLATFORM(COCOA)
 43 OBJC_CLASS NSArray;
 44 #endif
 45 
 46 #if PLATFORM(WIN)
 47 #include &quot;COMPtr.h&quot;
 48 #include &quot;WCDataObject.h&quot;
 49 #include &lt;objidl.h&gt;
</pre>
<hr />
<pre>
 52 #endif
 53 
 54 #if PLATFORM(JAVA)
 55 #include &quot;DataObjectJava.h&quot;
 56 #endif
 57 
 58 // FIXME: This class uses the DOM and makes calls to Editor.
 59 // It should be divested of its knowledge of the frame and editor.
 60 
 61 namespace WebCore {
 62 
 63 class DocumentFragment;
 64 class DragData;
 65 class Element;
 66 class Frame;
 67 class PasteboardStrategy;
 68 class Range;
 69 class SelectionData;
 70 class SharedBuffer;
 71 
<span class="line-modified"> 72 enum class PlainTextURLReadingPolicy : bool { IgnoreURL, AllowURL };</span>
<span class="line-added"> 73 enum class WebContentReadingPolicy : bool { AnyType, OnlyRichTextTypes };</span>
 74 enum ShouldSerializeSelectedTextForDataTransfer { DefaultSelectedTextType, IncludeImageAltTextForDataTransfer };
 75 
 76 // For writing to the pasteboard. Generally sorted with the richest formats on top.
 77 
 78 struct PasteboardWebContent {
 79 #if PLATFORM(COCOA)
 80     WEBCORE_EXPORT PasteboardWebContent();
 81     WEBCORE_EXPORT ~PasteboardWebContent();
 82     String contentOrigin;
 83     bool canSmartCopyOrDelete;
 84     RefPtr&lt;SharedBuffer&gt; dataInWebArchiveFormat;
 85     RefPtr&lt;SharedBuffer&gt; dataInRTFDFormat;
 86     RefPtr&lt;SharedBuffer&gt; dataInRTFFormat;
 87     RefPtr&lt;SharedBuffer&gt; dataInAttributedStringFormat;
 88     String dataInHTMLFormat;
 89     String dataInStringFormat;
 90     Vector&lt;String&gt; clientTypes;
 91     Vector&lt;RefPtr&lt;SharedBuffer&gt;&gt; clientData;
 92 #endif
 93 #if PLATFORM(GTK)
</pre>
<hr />
<pre>
133 };
134 
135 // For reading from the pasteboard.
136 
137 class PasteboardWebContentReader {
138 public:
139     String contentOrigin;
140 
141     virtual ~PasteboardWebContentReader() = default;
142 
143 #if PLATFORM(COCOA)
144     virtual bool readWebArchive(SharedBuffer&amp;) = 0;
145     virtual bool readFilePath(const String&amp;, PresentationSize preferredPresentationSize = { }, const String&amp; contentType = { }) = 0;
146     virtual bool readFilePaths(const Vector&lt;String&gt;&amp;) = 0;
147     virtual bool readHTML(const String&amp;) = 0;
148     virtual bool readRTFD(SharedBuffer&amp;) = 0;
149     virtual bool readRTF(SharedBuffer&amp;) = 0;
150     virtual bool readImage(Ref&lt;SharedBuffer&gt;&amp;&amp;, const String&amp; type, PresentationSize preferredPresentationSize = { }) = 0;
151     virtual bool readURL(const URL&amp;, const String&amp; title) = 0;
152     virtual bool readDataBuffer(SharedBuffer&amp;, const String&amp; type, const String&amp; name, PresentationSize preferredPresentationSize = { }) = 0;

153     virtual bool readPlainText(const String&amp;) = 0;
<span class="line-added">154 #endif</span>
155 };
156 
157 struct PasteboardPlainText {
158     String text;
159 #if PLATFORM(COCOA)
160     bool isURL;
161 #endif
162 };
163 
164 struct PasteboardFileReader {
165     virtual ~PasteboardFileReader() = default;
166     virtual void readFilename(const String&amp;) = 0;
167     virtual void readBuffer(const String&amp; filename, const String&amp; type, Ref&lt;SharedBuffer&gt;&amp;&amp;) = 0;
168 };
169 















170 class Pasteboard {
171     WTF_MAKE_NONCOPYABLE(Pasteboard); WTF_MAKE_FAST_ALLOCATED;
172 public:
173     Pasteboard();
174     virtual ~Pasteboard();
175 
176 #if PLATFORM(GTK)
177     explicit Pasteboard(const String&amp; name);
178     explicit Pasteboard(SelectionData&amp;);
179 #endif
180 
181 #if PLATFORM(WIN)
182     explicit Pasteboard(IDataObject*);
183     explicit Pasteboard(WCDataObject*);
184     explicit Pasteboard(const DragDataMap&amp;);
185 #endif
186 
187     WEBCORE_EXPORT static std::unique_ptr&lt;Pasteboard&gt; createForCopyAndPaste();
188 
189     static bool isSafeTypeForDOMToReadAndWrite(const String&amp;);
190     static bool canExposeURLToDOMWhenPasteboardContainsFiles(const String&amp;);
191 
192     virtual bool isStatic() const { return false; }
193 
194     virtual WEBCORE_EXPORT bool hasData();
195     virtual WEBCORE_EXPORT Vector&lt;String&gt; typesSafeForBindings(const String&amp; origin);
196     virtual WEBCORE_EXPORT Vector&lt;String&gt; typesForLegacyUnsafeBindings();
197     virtual WEBCORE_EXPORT String readOrigin();
198     virtual WEBCORE_EXPORT String readString(const String&amp; type);
199     virtual WEBCORE_EXPORT String readStringInCustomData(const String&amp; type);
200     virtual WEBCORE_EXPORT Vector&lt;String&gt; readAllStrings(const String&amp; type);
201 
202     virtual WEBCORE_EXPORT void writeString(const String&amp; type, const String&amp; data);
203     virtual WEBCORE_EXPORT void clear();
204     virtual WEBCORE_EXPORT void clear(const String&amp; type);
205 
<span class="line-modified">206     virtual WEBCORE_EXPORT void read(PasteboardPlainText&amp;, PlainTextURLReadingPolicy = PlainTextURLReadingPolicy::AllowURL, Optional&lt;size_t&gt; itemIndex = WTF::nullopt);</span>
<span class="line-modified">207     virtual WEBCORE_EXPORT void read(PasteboardWebContentReader&amp;, WebContentReadingPolicy = WebContentReadingPolicy::AnyType, Optional&lt;size_t&gt; itemIndex = WTF::nullopt);</span>
208     virtual WEBCORE_EXPORT void read(PasteboardFileReader&amp;);
209 
210     virtual WEBCORE_EXPORT void write(const Color&amp;);
211     virtual WEBCORE_EXPORT void write(const PasteboardURL&amp;);
212     virtual WEBCORE_EXPORT void writeTrustworthyWebURLsPboardType(const PasteboardURL&amp;);
213     virtual WEBCORE_EXPORT void write(const PasteboardImage&amp;);
214     virtual WEBCORE_EXPORT void write(const PasteboardWebContent&amp;);
215 
<span class="line-modified">216     virtual WEBCORE_EXPORT void writeCustomData(const Vector&lt;PasteboardCustomData&gt;&amp;);</span>
217 
218     enum class FileContentState { NoFileOrImageData, InMemoryImage, MayContainFilePaths };
219     virtual WEBCORE_EXPORT FileContentState fileContentState();
220     virtual WEBCORE_EXPORT bool canSmartReplace();
221 
222     virtual WEBCORE_EXPORT void writeMarkup(const String&amp; markup);
223     enum SmartReplaceOption { CanSmartReplace, CannotSmartReplace };
224     virtual WEBCORE_EXPORT void writePlainText(const String&amp;, SmartReplaceOption); // FIXME: Two separate functions would be clearer than one function with an argument.
225 
226 #if PLATFORM(JAVA)
227     RefPtr&lt;DataObjectJava&gt; dataObject() const { return m_dataObject; }
228 #endif
229 
230 #if ENABLE(DRAG_SUPPORT)
231     WEBCORE_EXPORT static std::unique_ptr&lt;Pasteboard&gt; createForDragAndDrop();
232     WEBCORE_EXPORT static std::unique_ptr&lt;Pasteboard&gt; createForDragAndDrop(const DragData&amp;);
233 
234     virtual void setDragImage(DragImage, const IntPoint&amp; hotSpot);
235 #endif
236 
237 #if PLATFORM(WIN) || PLATFORM(JAVA)
238     RefPtr&lt;DocumentFragment&gt; documentFragment(Frame&amp;, Range&amp;, bool allowPlainText, bool&amp; chosePlainText); // FIXME: Layering violation.
239     void writeImage(Element&amp;, const URL&amp;, const String&amp; title); // FIXME: Layering violation.
240     void writeSelection(Range&amp;, bool canSmartCopyOrDelete, Frame&amp;, ShouldSerializeSelectedTextForDataTransfer = DefaultSelectedTextType); // FIXME: Layering violation.
241 #endif
242 
243 #if PLATFORM(GTK)
244     const SelectionData&amp; selectionData() const;
245     static std::unique_ptr&lt;Pasteboard&gt; createForGlobalSelection();
246 #endif
247 
248 #if PLATFORM(IOS_FAMILY)
<span class="line-modified">249     explicit Pasteboard(int64_t changeCount);</span>
250     explicit Pasteboard(const String&amp; pasteboardName);
251 
252     static NSArray *supportedWebContentPasteboardTypes();
253     static String resourceMIMEType(NSString *mimeType);
254 #endif
255 
256 #if PLATFORM(MAC)
257     explicit Pasteboard(const String&amp; pasteboardName, const Vector&lt;String&gt;&amp; promisedFilePaths = { });
258 #endif
259 
260 #if PLATFORM(COCOA)
261     static bool shouldTreatCocoaTypeAsFile(const String&amp;);
262     WEBCORE_EXPORT static NSArray *supportedFileUploadPasteboardTypes();
<span class="line-modified">263     int64_t changeCount() const;</span>

264     const PasteboardCustomData&amp; readCustomData();
<span class="line-added">265 #else</span>
<span class="line-added">266     int64_t changeCount() const { return 0; }</span>
<span class="line-added">267 #endif</span>
<span class="line-added">268 </span>
<span class="line-added">269 #if PLATFORM(COCOA)</span>
<span class="line-added">270     const String&amp; name() const { return m_pasteboardName; }</span>
<span class="line-added">271 #else</span>
<span class="line-added">272     const String&amp; name() const { return emptyString(); }</span>
273 #endif
274 
275 #if PLATFORM(WIN)
276     COMPtr&lt;IDataObject&gt; dataObject() const { return m_dataObject; }
277     void setExternalDataObject(IDataObject*);
278     const DragDataMap&amp; dragDataMap() const { return m_dragDataMap; }
279     void writeURLToWritableDataObject(const URL&amp;, const String&amp;);
280     COMPtr&lt;WCDataObject&gt; writableDataObject() const { return m_writableDataObject; }
281     void writeImageToDataObject(Element&amp;, const URL&amp;); // FIXME: Layering violation.
282 #endif
283 
<span class="line-added">284     Optional&lt;Vector&lt;PasteboardItemInfo&gt;&gt; allPasteboardItemInfo() const;</span>
<span class="line-added">285     Optional&lt;PasteboardItemInfo&gt; pasteboardItemInfo(size_t index) const;</span>
<span class="line-added">286 </span>
<span class="line-added">287     String readString(size_t index, const String&amp; type);</span>
<span class="line-added">288     RefPtr&lt;WebCore::SharedBuffer&gt; readBuffer(size_t index, const String&amp; type);</span>
<span class="line-added">289     URL readURL(size_t index, String&amp; title);</span>
<span class="line-added">290 </span>
291 private:
292 #if PLATFORM(IOS_FAMILY)
293     bool respectsUTIFidelities() const;
<span class="line-modified">294     void readRespectingUTIFidelities(PasteboardWebContentReader&amp;, WebContentReadingPolicy, Optional&lt;size_t&gt;);</span>
295 
296     enum class ReaderResult {
297         ReadType,
298         DidNotReadType,
299         PasteboardWasChangedExternally
300     };
301     ReaderResult readPasteboardWebContentDataForType(PasteboardWebContentReader&amp;, PasteboardStrategy&amp;, NSString *type, const PasteboardItemInfo&amp;, int itemIndex);
302 #endif
303 
304 #if PLATFORM(WIN)
305     void finishCreatingPasteboard();
306     void writeRangeToDataObject(Range&amp;, Frame&amp;); // FIXME: Layering violation.
307     void writeURLToDataObject(const URL&amp;, const String&amp;);
308     void writePlainTextToDataObject(const String&amp;, SmartReplaceOption);
309 #endif
310 
311 #if PLATFORM(JAVA)
312     Pasteboard(RefPtr&lt;DataObjectJava&gt;, bool copyPasteMode);
313     static std::unique_ptr&lt;Pasteboard&gt; create(RefPtr&lt;DataObjectJava&gt;);
314 #endif
315 
316 #if PLATFORM(COCOA)
317     Vector&lt;String&gt; readFilePaths();
<span class="line-modified">318     Vector&lt;String&gt; readPlatformValuesAsStrings(const String&amp; domType, int64_t changeCount, const String&amp; pasteboardName);</span>
319     static void addHTMLClipboardTypesForCocoaType(ListHashSet&lt;String&gt;&amp; resultTypes, const String&amp; cocoaType);
320     String readStringForPlatformType(const String&amp;);
321     Vector&lt;String&gt; readTypesWithSecurityCheck();
322     RefPtr&lt;SharedBuffer&gt; readBufferForTypeWithSecurityCheck(const String&amp;);
323 #endif
324 
325 #if PLATFORM(GTK)
326     void writeToClipboard();
327     void readFromClipboard();
328     Ref&lt;SelectionData&gt; m_selectionData;
329     String m_name;
330 #endif
331 
332 #if PLATFORM(COCOA)
333     String m_pasteboardName;
<span class="line-modified">334     int64_t m_changeCount;</span>
335     Optional&lt;PasteboardCustomData&gt; m_customDataCache;
336 #endif
337 
338 #if PLATFORM(MAC)
339     Vector&lt;String&gt; m_promisedFilePaths;
340 #endif
341 
342 #if PLATFORM(WIN)
343     HWND m_owner;
344     COMPtr&lt;IDataObject&gt; m_dataObject;
345     COMPtr&lt;WCDataObject&gt; m_writableDataObject;
346     DragDataMap m_dragDataMap;
347 #endif
348 
349 #if PLATFORM(JAVA)
350     RefPtr&lt;DataObjectJava&gt; m_dataObject;
351     bool m_copyPasteMode;
352 #endif
353 };
354 
</pre>
</td>
</tr>
</table>
<center><a href="Pasteboard.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PasteboardItemInfo.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>