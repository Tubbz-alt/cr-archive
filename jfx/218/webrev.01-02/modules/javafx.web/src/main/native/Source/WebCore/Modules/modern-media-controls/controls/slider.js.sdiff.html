<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/Modules/modern-media-controls/controls/slider.js</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="auto-hide-controller.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../gesture-recognizers/gesture-recognizer.js.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/modern-media-controls/controls/slider.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 class Slider extends LayoutNode
 27 {
 28 
 29     constructor(cssClassName = &quot;&quot;)
 30     {
 31         super(`&lt;div class=&quot;slider ${cssClassName}&quot;&gt;&lt;/div&gt;`);
 32 
 33         this._container = new LayoutNode(`&lt;div class=&quot;custom-slider&quot;&gt;&lt;/div&gt;`);
 34         this._track = new LayoutNode(`&lt;div class=&quot;track fill&quot;&gt;&lt;/div&gt;`);
 35         this._primaryFill = new LayoutNode(`&lt;div class=&quot;primary fill&quot;&gt;&lt;/div&gt;`);
 36         this._secondaryFill = new LayoutNode(`&lt;div class=&quot;secondary fill&quot;&gt;&lt;/div&gt;`);
 37         this._knob = new LayoutNode(`&lt;div class=&quot;knob&quot;&gt;&lt;/div&gt;`);
 38         this._container.children = [this._track, this._primaryFill, this._secondaryFill, this._knob];
 39 
 40         this._input = new LayoutNode(`&lt;input type=&quot;range&quot; min=&quot;0&quot; max=&quot;1&quot; step=&quot;0.001&quot; /&gt;`);
<span class="line-modified"> 41         this._input.element.addEventListener(GestureRecognizer.SupportsTouches ? &quot;touchstart&quot; : &quot;mousedown&quot;, this);</span>
 42         this._input.element.addEventListener(&quot;input&quot;, this);
 43         this._input.element.addEventListener(&quot;change&quot;, this);
 44 
 45         this.value = 0;
 46         this.height = 16;
 47         this.enabled = true;
 48         this.isActive = false;
 49         this._secondaryValue = 0;
 50         this._disabled = false;
 51 
 52         this.children = [this._container, this._input];
 53     }
 54 
 55     // Public
 56 
 57     set inputAccessibleLabel(timeValue)
 58     {
 59         this._input.element.setAttribute(&quot;aria-valuetext&quot;, formattedStringForDuration(timeValue));
 60     }
 61 
</pre>
<hr />
<pre>
 92 
 93     get secondaryValue()
 94     {
 95         return this._secondaryValue;
 96     }
 97 
 98     set secondaryValue(secondaryValue)
 99     {
100         if (this._secondaryValue === secondaryValue)
101             return;
102 
103         this._secondaryValue = secondaryValue;
104         this.needsLayout = true;
105     }
106 
107     // Protected
108 
109     handleEvent(event)
110     {
111         switch (event.type) {
<span class="line-modified">112         case &quot;mousedown&quot;:</span>
<span class="line-modified">113             this._handleMousedownEvent();</span>
114             break;
<span class="line-modified">115         case &quot;touchstart&quot;:</span>
<span class="line-modified">116             this._handleTouchstartEvent(event);</span>
<span class="line-removed">117             break;</span>
<span class="line-removed">118         case &quot;mouseup&quot;:</span>
<span class="line-removed">119             this._handleMouseupEvent();</span>
<span class="line-removed">120             break;</span>
<span class="line-removed">121         case &quot;touchend&quot;:</span>
<span class="line-removed">122             this._handleTouchendEvent(event);</span>
123             break;
124         case &quot;change&quot;:
125         case &quot;input&quot;:
126             this._valueDidChange();
127             break;
128         }
129     }
130 
131     commitProperty(propertyName)
132     {
133         switch (propertyName) {
134         case &quot;value&quot;:
135             this._input.element.value = this._value;
136             delete this._value;
137             break;
138         case &quot;disabled&quot;:
139             this.element.classList.toggle(&quot;disabled&quot;, this._disabled);
140             break;
141         default :
142             super.commitProperty(propertyName);
143             break;
144         }
145     }
146 
147     commit()
148     {
149         super.commit();
150 
151         const scrubberRadius = 4.5;
152         const scrubberCenterX = scrubberRadius + Math.round((this.width - (scrubberRadius * 2)) * this.value);
153         this._primaryFill.element.style.width = `${scrubberCenterX}px`;
154         this._secondaryFill.element.style.left = `${scrubberCenterX}px`;
155         this._secondaryFill.element.style.right = `${(1 - this._secondaryValue) * 100}%`;
156         this._knob.element.style.left = `${scrubberCenterX}px`;
157     }
158 
159     // Private
160 
<span class="line-modified">161     _handleMousedownEvent()</span>
162     {
<span class="line-modified">163         this._mouseupTarget = this._interactionEndTarget();</span>
<span class="line-modified">164         this._mouseupTarget.addEventListener(&quot;mouseup&quot;, this, true);</span>
165 
166         this._valueWillStartChanging();
167     }
168 
169     _interactionEndTarget()
170     {
171         const mediaControls = this.parentOfType(MediaControls);
172         return (!mediaControls || mediaControls instanceof MacOSInlineMediaControls) ? window : mediaControls.element;
173     }
174 
<span class="line-removed">175     _handleTouchstartEvent(event)</span>
<span class="line-removed">176     {</span>
<span class="line-removed">177         // We&#39;re only interested in the very first touch on the &lt;input&gt;.</span>
<span class="line-removed">178         if (event.touches.length !== 1)</span>
<span class="line-removed">179             return;</span>
<span class="line-removed">180 </span>
<span class="line-removed">181         this._initialTouchIdentifier = event.touches[0].identifier;</span>
<span class="line-removed">182 </span>
<span class="line-removed">183         this._touchendTarget = this._interactionEndTarget();</span>
<span class="line-removed">184         this._touchendTarget.addEventListener(&quot;touchend&quot;, this, true);</span>
<span class="line-removed">185 </span>
<span class="line-removed">186         this._valueWillStartChanging();</span>
<span class="line-removed">187     }</span>
<span class="line-removed">188 </span>
189     _valueWillStartChanging()
190     {
191         // We should no longer cache the value since we&#39;ll be interacting with the &lt;input&gt;
192         // so the value should be read back from it dynamically.
193         delete this._value;
194 
195         if (this.uiDelegate &amp;&amp; typeof this.uiDelegate.controlValueWillStartChanging === &quot;function&quot;)
196             this.uiDelegate.controlValueWillStartChanging(this);
197         this.isActive = true;
198         this.needsLayout = true;
199     }
200 
201     _valueDidChange()
202     {
203         if (this.uiDelegate &amp;&amp; typeof this.uiDelegate.controlValueDidChange === &quot;function&quot;)
204             this.uiDelegate.controlValueDidChange(this);
205 
206         this.needsLayout = true;
207     }
208 
209     _valueDidStopChanging()
210     {
211         this.isActive = false;
212         if (this.uiDelegate &amp;&amp; typeof this.uiDelegate.controlValueDidStopChanging === &quot;function&quot;)
213             this.uiDelegate.controlValueDidStopChanging(this);
214 
215         this.needsLayout = true;
216     }
217 
<span class="line-modified">218     _handleMouseupEvent()</span>
219     {
<span class="line-modified">220         this._mouseupTarget.removeEventListener(&quot;mouseup&quot;, this, true);</span>
<span class="line-modified">221         delete this._mouseupTarget;</span>
222 
223         this._valueDidStopChanging();
224     }
<span class="line-removed">225 </span>
<span class="line-removed">226     _handleTouchendEvent(event)</span>
<span class="line-removed">227     {</span>
<span class="line-removed">228         if (!Array.from(event.changedTouches).find(touch =&gt; touch.identifier === this._initialTouchIdentifier))</span>
<span class="line-removed">229             return;</span>
<span class="line-removed">230 </span>
<span class="line-removed">231         this._touchendTarget.removeEventListener(&quot;touchend&quot;, this, true);</span>
<span class="line-removed">232         delete this._touchendTarget;</span>
<span class="line-removed">233         delete this._initialTouchIdentifier;</span>
<span class="line-removed">234 </span>
<span class="line-removed">235         this._valueDidStopChanging();</span>
<span class="line-removed">236     }</span>
<span class="line-removed">237 </span>
238 }
</pre>
</td>
<td>
<hr />
<pre>
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 class Slider extends LayoutNode
 27 {
 28 
 29     constructor(cssClassName = &quot;&quot;)
 30     {
 31         super(`&lt;div class=&quot;slider ${cssClassName}&quot;&gt;&lt;/div&gt;`);
 32 
 33         this._container = new LayoutNode(`&lt;div class=&quot;custom-slider&quot;&gt;&lt;/div&gt;`);
 34         this._track = new LayoutNode(`&lt;div class=&quot;track fill&quot;&gt;&lt;/div&gt;`);
 35         this._primaryFill = new LayoutNode(`&lt;div class=&quot;primary fill&quot;&gt;&lt;/div&gt;`);
 36         this._secondaryFill = new LayoutNode(`&lt;div class=&quot;secondary fill&quot;&gt;&lt;/div&gt;`);
 37         this._knob = new LayoutNode(`&lt;div class=&quot;knob&quot;&gt;&lt;/div&gt;`);
 38         this._container.children = [this._track, this._primaryFill, this._secondaryFill, this._knob];
 39 
 40         this._input = new LayoutNode(`&lt;input type=&quot;range&quot; min=&quot;0&quot; max=&quot;1&quot; step=&quot;0.001&quot; /&gt;`);
<span class="line-modified"> 41         this._input.element.addEventListener(&quot;pointerdown&quot;, this);</span>
 42         this._input.element.addEventListener(&quot;input&quot;, this);
 43         this._input.element.addEventListener(&quot;change&quot;, this);
 44 
 45         this.value = 0;
 46         this.height = 16;
 47         this.enabled = true;
 48         this.isActive = false;
 49         this._secondaryValue = 0;
 50         this._disabled = false;
 51 
 52         this.children = [this._container, this._input];
 53     }
 54 
 55     // Public
 56 
 57     set inputAccessibleLabel(timeValue)
 58     {
 59         this._input.element.setAttribute(&quot;aria-valuetext&quot;, formattedStringForDuration(timeValue));
 60     }
 61 
</pre>
<hr />
<pre>
 92 
 93     get secondaryValue()
 94     {
 95         return this._secondaryValue;
 96     }
 97 
 98     set secondaryValue(secondaryValue)
 99     {
100         if (this._secondaryValue === secondaryValue)
101             return;
102 
103         this._secondaryValue = secondaryValue;
104         this.needsLayout = true;
105     }
106 
107     // Protected
108 
109     handleEvent(event)
110     {
111         switch (event.type) {
<span class="line-modified">112         case &quot;pointerdown&quot;:</span>
<span class="line-modified">113             this._handlePointerdownEvent();</span>
114             break;
<span class="line-modified">115         case &quot;pointerup&quot;:</span>
<span class="line-modified">116             this._handlePointerupEvent();</span>






117             break;
118         case &quot;change&quot;:
119         case &quot;input&quot;:
120             this._valueDidChange();
121             break;
122         }
123     }
124 
125     commitProperty(propertyName)
126     {
127         switch (propertyName) {
128         case &quot;value&quot;:
129             this._input.element.value = this._value;
130             delete this._value;
131             break;
132         case &quot;disabled&quot;:
133             this.element.classList.toggle(&quot;disabled&quot;, this._disabled);
134             break;
135         default :
136             super.commitProperty(propertyName);
137             break;
138         }
139     }
140 
141     commit()
142     {
143         super.commit();
144 
145         const scrubberRadius = 4.5;
146         const scrubberCenterX = scrubberRadius + Math.round((this.width - (scrubberRadius * 2)) * this.value);
147         this._primaryFill.element.style.width = `${scrubberCenterX}px`;
148         this._secondaryFill.element.style.left = `${scrubberCenterX}px`;
149         this._secondaryFill.element.style.right = `${(1 - this._secondaryValue) * 100}%`;
150         this._knob.element.style.left = `${scrubberCenterX}px`;
151     }
152 
153     // Private
154 
<span class="line-modified">155     _handlePointerdownEvent()</span>
156     {
<span class="line-modified">157         this._pointerupTarget = this._interactionEndTarget();</span>
<span class="line-modified">158         this._pointerupTarget.addEventListener(&quot;pointerup&quot;, this, true);</span>
159 
160         this._valueWillStartChanging();
161     }
162 
163     _interactionEndTarget()
164     {
165         const mediaControls = this.parentOfType(MediaControls);
166         return (!mediaControls || mediaControls instanceof MacOSInlineMediaControls) ? window : mediaControls.element;
167     }
168 














169     _valueWillStartChanging()
170     {
171         // We should no longer cache the value since we&#39;ll be interacting with the &lt;input&gt;
172         // so the value should be read back from it dynamically.
173         delete this._value;
174 
175         if (this.uiDelegate &amp;&amp; typeof this.uiDelegate.controlValueWillStartChanging === &quot;function&quot;)
176             this.uiDelegate.controlValueWillStartChanging(this);
177         this.isActive = true;
178         this.needsLayout = true;
179     }
180 
181     _valueDidChange()
182     {
183         if (this.uiDelegate &amp;&amp; typeof this.uiDelegate.controlValueDidChange === &quot;function&quot;)
184             this.uiDelegate.controlValueDidChange(this);
185 
186         this.needsLayout = true;
187     }
188 
189     _valueDidStopChanging()
190     {
191         this.isActive = false;
192         if (this.uiDelegate &amp;&amp; typeof this.uiDelegate.controlValueDidStopChanging === &quot;function&quot;)
193             this.uiDelegate.controlValueDidStopChanging(this);
194 
195         this.needsLayout = true;
196     }
197 
<span class="line-modified">198     _handlePointerupEvent()</span>
199     {
<span class="line-modified">200         this._pointerupTarget.removeEventListener(&quot;pointerup&quot;, this, true);</span>
<span class="line-modified">201         delete this._pointerupTarget;</span>
202 
203         this._valueDidStopChanging();
204     }













205 }
</pre>
</td>
</tr>
</table>
<center><a href="auto-hide-controller.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../gesture-recognizers/gesture-recognizer.js.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>