<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/GraphicsTypes.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="GraphicsLayerClient.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="GraphicsTypes.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/GraphicsTypes.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 11  * 2. Redistributions in binary form must reproduce the above copyright
 12  *    notice, this list of conditions and the following disclaimer in the
 13  *    documentation and/or other materials provided with the distribution.
 14  *
 15  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 16  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 17  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 18  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 19  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 20  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 21  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 22  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 23  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 24  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 25  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 26  */
 27 
 28 #include &quot;config.h&quot;
 29 #include &quot;GraphicsTypes.h&quot;
 30 

 31 #include &lt;wtf/Assertions.h&gt;
 32 #include &lt;wtf/text/TextStream.h&gt;
 33 #include &lt;wtf/text/WTFString.h&gt;
 34 
 35 namespace WebCore {
 36 
 37 static const char* const compositeOperatorNames[] = {
 38     &quot;clear&quot;,
 39     &quot;copy&quot;,
 40     &quot;source-over&quot;,
 41     &quot;source-in&quot;,
 42     &quot;source-out&quot;,
 43     &quot;source-atop&quot;,
 44     &quot;destination-over&quot;,
 45     &quot;destination-in&quot;,
 46     &quot;destination-out&quot;,
 47     &quot;destination-atop&quot;,
 48     &quot;xor&quot;,
 49     &quot;darker&quot;,
 50     &quot;lighter&quot;,
</pre>
<hr />
<pre>
 54 static const char* const blendOperatorNames[] = {
 55     &quot;normal&quot;,
 56     &quot;multiply&quot;,
 57     &quot;screen&quot;,
 58     &quot;darken&quot;,
 59     &quot;lighten&quot;,
 60     &quot;overlay&quot;,
 61     &quot;color-dodge&quot;,
 62     &quot;color-burn&quot;,
 63     &quot;hard-light&quot;,
 64     &quot;soft-light&quot;,
 65     &quot;difference&quot;,
 66     &quot;exclusion&quot;,
 67     &quot;hue&quot;,
 68     &quot;saturation&quot;,
 69     &quot;color&quot;,
 70     &quot;luminosity&quot;,
 71     &quot;plus-darker&quot;,
 72     &quot;plus-lighter&quot;
 73 };
<span class="line-modified"> 74 const int numCompositeOperatorNames = WTF_ARRAY_LENGTH(compositeOperatorNames);</span>
<span class="line-modified"> 75 const unsigned numBlendOperatorNames = WTF_ARRAY_LENGTH(blendOperatorNames);</span>
 76 
 77 bool parseBlendMode(const String&amp; s, BlendMode&amp; blendMode)
 78 {
 79     for (unsigned i = 0; i &lt; numBlendOperatorNames; i++) {
 80         if (s == blendOperatorNames[i]) {
 81             blendMode = static_cast&lt;BlendMode&gt;(i + static_cast&lt;unsigned&gt;(BlendMode::Normal));
 82             return true;
 83         }
 84     }
 85 
 86     return false;
 87 }
 88 
 89 bool parseCompositeAndBlendOperator(const String&amp; s, CompositeOperator&amp; op, BlendMode&amp; blendOp)
 90 {
 91     for (int i = 0; i &lt; numCompositeOperatorNames; i++) {
 92         if (s == compositeOperatorNames[i]) {
 93             op = static_cast&lt;CompositeOperator&gt;(i);
 94             blendOp = BlendMode::Normal;
 95             return true;
 96         }
 97     }
 98 
 99     if (parseBlendMode(s, blendOp)) {
100         // For now, blending will always assume source-over. This will be fixed in the future
<span class="line-modified">101         op = CompositeSourceOver;</span>
102         return true;
103     }
104 
105     return false;
106 }
107 
108 // FIXME: when we support blend modes in combination with compositing other than source-over
109 // this routine needs to be updated.
110 String compositeOperatorName(CompositeOperator op, BlendMode blendOp)
111 {
<span class="line-modified">112     ASSERT(op &gt;= 0);</span>
<span class="line-modified">113     ASSERT(op &lt; numCompositeOperatorNames);</span>
114     ASSERT(blendOp &gt;= BlendMode::Normal);
<span class="line-modified">115     ASSERT(static_cast&lt;unsigned&gt;(blendOp) &lt;= numBlendOperatorNames);</span>
116     if (blendOp &gt; BlendMode::Normal)
117         return blendOperatorNames[static_cast&lt;unsigned&gt;(blendOp) - static_cast&lt;unsigned&gt;(BlendMode::Normal)];
<span class="line-modified">118     return compositeOperatorNames[op];</span>
119 }
120 
121 String blendModeName(BlendMode blendOp)
122 {
123     ASSERT(blendOp &gt;= BlendMode::Normal);
124     ASSERT(blendOp &lt;= BlendMode::PlusLighter);
125     return blendOperatorNames[static_cast&lt;unsigned&gt;(blendOp) - static_cast&lt;unsigned&gt;(BlendMode::Normal)];
126 }
127 
128 TextStream&amp; operator&lt;&lt;(TextStream&amp; ts, CompositeOperator op)
129 {
130     return ts &lt;&lt; compositeOperatorName(op, BlendMode::Normal);
131 }
132 
133 TextStream&amp; operator&lt;&lt;(TextStream&amp; ts, BlendMode blendMode)
134 {
135     return ts &lt;&lt; blendModeName(blendMode);
136 }
137 
138 TextStream&amp; operator&lt;&lt;(TextStream&amp; ts, WindRule rule)
</pre>
</td>
<td>
<hr />
<pre>
 11  * 2. Redistributions in binary form must reproduce the above copyright
 12  *    notice, this list of conditions and the following disclaimer in the
 13  *    documentation and/or other materials provided with the distribution.
 14  *
 15  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 16  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 17  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 18  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 19  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 20  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 21  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 22  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 23  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 24  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 25  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 26  */
 27 
 28 #include &quot;config.h&quot;
 29 #include &quot;GraphicsTypes.h&quot;
 30 
<span class="line-added"> 31 #include &quot;AlphaPremultiplication.h&quot;</span>
 32 #include &lt;wtf/Assertions.h&gt;
 33 #include &lt;wtf/text/TextStream.h&gt;
 34 #include &lt;wtf/text/WTFString.h&gt;
 35 
 36 namespace WebCore {
 37 
 38 static const char* const compositeOperatorNames[] = {
 39     &quot;clear&quot;,
 40     &quot;copy&quot;,
 41     &quot;source-over&quot;,
 42     &quot;source-in&quot;,
 43     &quot;source-out&quot;,
 44     &quot;source-atop&quot;,
 45     &quot;destination-over&quot;,
 46     &quot;destination-in&quot;,
 47     &quot;destination-out&quot;,
 48     &quot;destination-atop&quot;,
 49     &quot;xor&quot;,
 50     &quot;darker&quot;,
 51     &quot;lighter&quot;,
</pre>
<hr />
<pre>
 55 static const char* const blendOperatorNames[] = {
 56     &quot;normal&quot;,
 57     &quot;multiply&quot;,
 58     &quot;screen&quot;,
 59     &quot;darken&quot;,
 60     &quot;lighten&quot;,
 61     &quot;overlay&quot;,
 62     &quot;color-dodge&quot;,
 63     &quot;color-burn&quot;,
 64     &quot;hard-light&quot;,
 65     &quot;soft-light&quot;,
 66     &quot;difference&quot;,
 67     &quot;exclusion&quot;,
 68     &quot;hue&quot;,
 69     &quot;saturation&quot;,
 70     &quot;color&quot;,
 71     &quot;luminosity&quot;,
 72     &quot;plus-darker&quot;,
 73     &quot;plus-lighter&quot;
 74 };
<span class="line-modified"> 75 const uint8_t numCompositeOperatorNames = WTF_ARRAY_LENGTH(compositeOperatorNames);</span>
<span class="line-modified"> 76 const uint8_t numBlendOperatorNames = WTF_ARRAY_LENGTH(blendOperatorNames);</span>
 77 
 78 bool parseBlendMode(const String&amp; s, BlendMode&amp; blendMode)
 79 {
 80     for (unsigned i = 0; i &lt; numBlendOperatorNames; i++) {
 81         if (s == blendOperatorNames[i]) {
 82             blendMode = static_cast&lt;BlendMode&gt;(i + static_cast&lt;unsigned&gt;(BlendMode::Normal));
 83             return true;
 84         }
 85     }
 86 
 87     return false;
 88 }
 89 
 90 bool parseCompositeAndBlendOperator(const String&amp; s, CompositeOperator&amp; op, BlendMode&amp; blendOp)
 91 {
 92     for (int i = 0; i &lt; numCompositeOperatorNames; i++) {
 93         if (s == compositeOperatorNames[i]) {
 94             op = static_cast&lt;CompositeOperator&gt;(i);
 95             blendOp = BlendMode::Normal;
 96             return true;
 97         }
 98     }
 99 
100     if (parseBlendMode(s, blendOp)) {
101         // For now, blending will always assume source-over. This will be fixed in the future
<span class="line-modified">102         op = CompositeOperator::SourceOver;</span>
103         return true;
104     }
105 
106     return false;
107 }
108 
109 // FIXME: when we support blend modes in combination with compositing other than source-over
110 // this routine needs to be updated.
111 String compositeOperatorName(CompositeOperator op, BlendMode blendOp)
112 {
<span class="line-modified">113     ASSERT(op &gt;= CompositeOperator::Clear);</span>
<span class="line-modified">114     ASSERT(static_cast&lt;uint8_t&gt;(op) &lt; numCompositeOperatorNames);</span>
115     ASSERT(blendOp &gt;= BlendMode::Normal);
<span class="line-modified">116     ASSERT(static_cast&lt;uint8_t&gt;(blendOp) &lt;= numBlendOperatorNames);</span>
117     if (blendOp &gt; BlendMode::Normal)
118         return blendOperatorNames[static_cast&lt;unsigned&gt;(blendOp) - static_cast&lt;unsigned&gt;(BlendMode::Normal)];
<span class="line-modified">119     return compositeOperatorNames[static_cast&lt;unsigned&gt;(op)];</span>
120 }
121 
122 String blendModeName(BlendMode blendOp)
123 {
124     ASSERT(blendOp &gt;= BlendMode::Normal);
125     ASSERT(blendOp &lt;= BlendMode::PlusLighter);
126     return blendOperatorNames[static_cast&lt;unsigned&gt;(blendOp) - static_cast&lt;unsigned&gt;(BlendMode::Normal)];
127 }
128 
129 TextStream&amp; operator&lt;&lt;(TextStream&amp; ts, CompositeOperator op)
130 {
131     return ts &lt;&lt; compositeOperatorName(op, BlendMode::Normal);
132 }
133 
134 TextStream&amp; operator&lt;&lt;(TextStream&amp; ts, BlendMode blendMode)
135 {
136     return ts &lt;&lt; blendModeName(blendMode);
137 }
138 
139 TextStream&amp; operator&lt;&lt;(TextStream&amp; ts, WindRule rule)
</pre>
</td>
</tr>
</table>
<center><a href="GraphicsLayerClient.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="GraphicsTypes.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>