<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/dom/DataTransfer.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DOMImplementation.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DataTransfer.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/dom/DataTransfer.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -66,13 +66,12 @@</span>
      DataTransfer* m_dataTransfer;
  };
  
  #endif
  
<span class="udiff-line-modified-removed">- DataTransfer::DataTransfer(const Document&amp; document, StoreMode mode, std::unique_ptr&lt;Pasteboard&gt; pasteboard, Type type)</span>
<span class="udiff-line-modified-removed">-     : m_sessionID(document.sessionID())</span>
<span class="udiff-line-removed">-     , m_storeMode(mode)</span>
<span class="udiff-line-modified-added">+ DataTransfer::DataTransfer(StoreMode mode, std::unique_ptr&lt;Pasteboard&gt; pasteboard, Type type)</span>
<span class="udiff-line-modified-added">+     : m_storeMode(mode)</span>
      , m_pasteboard(WTFMove(pasteboard))
  #if ENABLE(DRAG_SUPPORT)
      , m_type(type)
      , m_dropEffect(&quot;uninitialized&quot;_s)
      , m_effectAllowed(&quot;uninitialized&quot;_s)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -84,11 +83,11 @@</span>
  #endif
  }
  
  Ref&lt;DataTransfer&gt; DataTransfer::createForCopyAndPaste(const Document&amp; document, StoreMode storeMode, std::unique_ptr&lt;Pasteboard&gt;&amp;&amp; pasteboard)
  {
<span class="udiff-line-modified-removed">-     auto dataTransfer = adoptRef(*new DataTransfer(document, storeMode, WTFMove(pasteboard)));</span>
<span class="udiff-line-modified-added">+     auto dataTransfer = adoptRef(*new DataTransfer(storeMode, WTFMove(pasteboard)));</span>
      dataTransfer-&gt;m_originIdentifier = document.originIdentifierForPasteboard();
      return dataTransfer;
  }
  
  DataTransfer::~DataTransfer()
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -347,11 +346,11 @@</span>
  Vector&lt;Ref&lt;File&gt;&gt; DataTransfer::filesFromPasteboardAndItemList() const
  {
      bool addedFilesFromPasteboard = false;
      Vector&lt;Ref&lt;File&gt;&gt; files;
      if ((!forDrag() || forFileDrag()) &amp;&amp; m_pasteboard-&gt;fileContentState() != Pasteboard::FileContentState::NoFileOrImageData) {
<span class="udiff-line-modified-removed">-         WebCorePasteboardFileReader reader { m_sessionID };</span>
<span class="udiff-line-modified-added">+         WebCorePasteboardFileReader reader;</span>
          m_pasteboard-&gt;read(reader);
          files = WTFMove(reader.files);
          addedFilesFromPasteboard = !files.isEmpty();
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -412,32 +411,38 @@</span>
      ASSERT_WITH_SECURITY_IMPLICATION(canReadTypes());
  
      return !type.isNull() &amp;&amp; types().contains(type);
  }
  
<span class="udiff-line-modified-removed">- Ref&lt;DataTransfer&gt; DataTransfer::createForInputEvent(const Document&amp; document, const String&amp; plainText, const String&amp; htmlText)</span>
<span class="udiff-line-modified-added">+ Ref&lt;DataTransfer&gt; DataTransfer::createForInputEvent(const String&amp; plainText, const String&amp; htmlText)</span>
  {
      auto pasteboard = makeUnique&lt;StaticPasteboard&gt;();
      pasteboard-&gt;writeString(&quot;text/plain&quot;_s, plainText);
      pasteboard-&gt;writeString(&quot;text/html&quot;_s, htmlText);
<span class="udiff-line-modified-removed">-     return adoptRef(*new DataTransfer(document, StoreMode::Readonly, WTFMove(pasteboard), Type::InputEvent));</span>
<span class="udiff-line-modified-added">+     return adoptRef(*new DataTransfer(StoreMode::Readonly, WTFMove(pasteboard), Type::InputEvent));</span>
  }
  
  void DataTransfer::commitToPasteboard(Pasteboard&amp; nativePasteboard)
  {
      ASSERT(is&lt;StaticPasteboard&gt;(*m_pasteboard) &amp;&amp; !is&lt;StaticPasteboard&gt;(nativePasteboard));
      PasteboardCustomData customData = downcast&lt;StaticPasteboard&gt;(*m_pasteboard).takeCustomData();
<span class="udiff-line-added">+     if (!customData.hasData())</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+ </span>
      if (RuntimeEnabledFeatures::sharedFeatures().customPasteboardDataEnabled()) {
<span class="udiff-line-modified-removed">-         customData.origin = m_originIdentifier;</span>
<span class="udiff-line-modified-removed">-         nativePasteboard.writeCustomData(customData);</span>
<span class="udiff-line-modified-added">+         customData.setOrigin(m_originIdentifier);</span>
<span class="udiff-line-modified-added">+         nativePasteboard.writeCustomData({ customData });</span>
          return;
      }
  
<span class="udiff-line-modified-removed">-     for (auto&amp; entry : customData.platformData)</span>
<span class="udiff-line-modified-removed">-         nativePasteboard.writeString(entry.key, entry.value);</span>
<span class="udiff-line-modified-removed">-     for (auto&amp; entry : customData.sameOriginCustomData)</span>
<span class="udiff-line-modified-removed">-         nativePasteboard.writeString(entry.key, entry.value);</span>
<span class="udiff-line-modified-added">+     customData.forEachPlatformString([&amp;] (auto&amp; type, auto&amp; string) {</span>
<span class="udiff-line-modified-added">+         nativePasteboard.writeString(type, string);</span>
<span class="udiff-line-modified-added">+     });</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     customData.forEachCustomString([&amp;] (auto&amp; type, auto&amp; string) {</span>
<span class="udiff-line-added">+         nativePasteboard.writeString(type, string);</span>
<span class="udiff-line-added">+     });</span>
  }
  
  #if !ENABLE(DRAG_SUPPORT)
  
  String DataTransfer::dropEffect() const
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -462,33 +467,33 @@</span>
  {
  }
  
  #else
  
<span class="udiff-line-modified-removed">- Ref&lt;DataTransfer&gt; DataTransfer::createForDrag(const Document&amp; document)</span>
<span class="udiff-line-modified-added">+ Ref&lt;DataTransfer&gt; DataTransfer::createForDrag()</span>
  {
<span class="udiff-line-modified-removed">-     return adoptRef(*new DataTransfer(document, StoreMode::ReadWrite, Pasteboard::createForDragAndDrop(), Type::DragAndDropData));</span>
<span class="udiff-line-modified-added">+     return adoptRef(*new DataTransfer(StoreMode::ReadWrite, Pasteboard::createForDragAndDrop(), Type::DragAndDropData));</span>
  }
  
  Ref&lt;DataTransfer&gt; DataTransfer::createForDragStartEvent(const Document&amp; document)
  {
<span class="udiff-line-modified-removed">-     auto dataTransfer = adoptRef(*new DataTransfer(document, StoreMode::ReadWrite, makeUnique&lt;StaticPasteboard&gt;(), Type::DragAndDropData));</span>
<span class="udiff-line-modified-added">+     auto dataTransfer = adoptRef(*new DataTransfer(StoreMode::ReadWrite, makeUnique&lt;StaticPasteboard&gt;(), Type::DragAndDropData));</span>
      dataTransfer-&gt;m_originIdentifier = document.originIdentifierForPasteboard();
      return dataTransfer;
  }
  
  Ref&lt;DataTransfer&gt; DataTransfer::createForDrop(const Document&amp; document, std::unique_ptr&lt;Pasteboard&gt;&amp;&amp; pasteboard, DragOperation sourceOperation, bool draggingFiles)
  {
<span class="udiff-line-modified-removed">-     auto dataTransfer = adoptRef(*new DataTransfer(document, DataTransfer::StoreMode::Readonly, WTFMove(pasteboard), draggingFiles ? Type::DragAndDropFiles : Type::DragAndDropData));</span>
<span class="udiff-line-modified-added">+     auto dataTransfer = adoptRef(*new DataTransfer(DataTransfer::StoreMode::Readonly, WTFMove(pasteboard), draggingFiles ? Type::DragAndDropFiles : Type::DragAndDropData));</span>
      dataTransfer-&gt;setSourceOperation(sourceOperation);
      dataTransfer-&gt;m_originIdentifier = document.originIdentifierForPasteboard();
      return dataTransfer;
  }
  
  Ref&lt;DataTransfer&gt; DataTransfer::createForUpdatingDropTarget(const Document&amp; document, std::unique_ptr&lt;Pasteboard&gt;&amp;&amp; pasteboard, DragOperation sourceOperation, bool draggingFiles)
  {
<span class="udiff-line-modified-removed">-     auto dataTransfer = adoptRef(*new DataTransfer(document, DataTransfer::StoreMode::Protected, WTFMove(pasteboard), draggingFiles ? Type::DragAndDropFiles : Type::DragAndDropData));</span>
<span class="udiff-line-modified-added">+     auto dataTransfer = adoptRef(*new DataTransfer(DataTransfer::StoreMode::Protected, WTFMove(pasteboard), draggingFiles ? Type::DragAndDropFiles : Type::DragAndDropData));</span>
      dataTransfer-&gt;setSourceOperation(sourceOperation);
      dataTransfer-&gt;m_originIdentifier = document.originIdentifierForPasteboard();
      return dataTransfer;
  }
  
</pre>
<center><a href="DOMImplementation.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DataTransfer.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>