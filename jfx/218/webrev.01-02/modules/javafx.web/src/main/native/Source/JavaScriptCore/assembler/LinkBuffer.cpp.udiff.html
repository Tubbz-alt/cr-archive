<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/assembler/LinkBuffer.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AssemblerCommon.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="LinkBuffer.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/assembler/LinkBuffer.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -31,10 +31,11 @@</span>
  #include &quot;CodeBlock.h&quot;
  #include &quot;Disassembler.h&quot;
  #include &quot;JITCode.h&quot;
  #include &quot;JSCInlines.h&quot;
  #include &quot;Options.h&quot;
<span class="udiff-line-added">+ #include &quot;WasmCompilationMode.h&quot;</span>
  #include &lt;wtf/CompilationThread.h&gt;
  
  #if OS(LINUX)
  #include &quot;PerfLog.h&quot;
  #endif
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -46,10 +47,26 @@</span>
      if (codeBlock &amp;&amp; JITCode::isOptimizingJIT(codeBlock-&gt;jitType()) &amp;&amp; Options::dumpDFGDisassembly())
          return true;
      return Options::dumpDisassembly();
  }
  
<span class="udiff-line-added">+ bool shouldDumpDisassemblyFor(Wasm::CompilationMode mode)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (Options::asyncDisassembly() || Options::dumpDisassembly() || Options::dumpWasmDisassembly())</span>
<span class="udiff-line-added">+         return true;</span>
<span class="udiff-line-added">+     switch (mode) {</span>
<span class="udiff-line-added">+     case Wasm::CompilationMode::BBQMode:</span>
<span class="udiff-line-added">+         return Options::dumpBBQDisassembly();</span>
<span class="udiff-line-added">+     case Wasm::CompilationMode::OMGMode:</span>
<span class="udiff-line-added">+     case Wasm::CompilationMode::OMGForOSREntryMode:</span>
<span class="udiff-line-added">+         return Options::dumpOMGDisassembly();</span>
<span class="udiff-line-added">+     default:</span>
<span class="udiff-line-added">+         break;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     return false;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  LinkBuffer::CodeRef&lt;LinkBufferPtrTag&gt; LinkBuffer::finalizeCodeWithoutDisassemblyImpl()
  {
      performFinalization();
  
      ASSERT(m_didAllocate);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -191,11 +208,11 @@</span>
                  }
              }
              jumpsToLink[i].setFrom(writePtr);
          }
      } else {
<span class="udiff-line-modified-removed">-         if (!ASSERT_DISABLED) {</span>
<span class="udiff-line-modified-added">+         if (ASSERT_ENABLED) {</span>
              for (unsigned i = 0; i &lt; jumpCount; ++i)
                  ASSERT(!MacroAssembler::canCompact(jumpsToLink[i].type()));
          }
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -226,25 +243,28 @@</span>
      }
  #endif
  
      recordLinkOffsets(m_assemblerStorage, readPtr, initialSize, readPtr - writePtr);
  
<span class="udiff-line-removed">- #if CPU(ARM64E) &amp;&amp; ENABLE(FAST_JIT_PERMISSIONS)</span>
<span class="udiff-line-removed">-     auto memcpyFunction = tagCFunctionPtr&lt;CopyFunctionPtrTag&gt;(memcpy);</span>
<span class="udiff-line-removed">- #else</span>
<span class="udiff-line-removed">-     auto memcpyFunction = tagCFunctionPtr&lt;CopyFunctionPtrTag&gt;(performJITMemcpy);</span>
<span class="udiff-line-removed">- #endif</span>
      for (unsigned i = 0; i &lt; jumpCount; ++i) {
          uint8_t* location = codeOutData + jumpsToLink[i].from();
          uint8_t* target = codeOutData + jumpsToLink[i].to() - executableOffsetFor(jumpsToLink[i].to());
<span class="udiff-line-modified-removed">-         MacroAssembler::link(jumpsToLink[i], outData + jumpsToLink[i].from(), location, target, memcpyFunction);</span>
<span class="udiff-line-modified-added">+ #if CPU(ARM64E) &amp;&amp; ENABLE(FAST_JIT_PERMISSIONS)</span>
<span class="udiff-line-added">+         MacroAssembler::link&lt;memcpy&gt;(jumpsToLink[i], outData + jumpsToLink[i].from(), location, target);</span>
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+         MacroAssembler::link&lt;performJITMemcpy&gt;(jumpsToLink[i], outData + jumpsToLink[i].from(), location, target);</span>
<span class="udiff-line-added">+ #endif</span>
      }
  
      size_t compactSize = writePtr + initialSize - readPtr;
      if (!m_executableMemory) {
          size_t nopSizeInBytes = initialSize - compactSize;
<span class="udiff-line-modified-removed">-         MacroAssembler::AssemblerType_T::fillNops(outData + compactSize, nopSizeInBytes, memcpy);</span>
<span class="udiff-line-modified-added">+ #if CPU(ARM64E) &amp;&amp; ENABLE(FAST_JIT_PERMISSIONS)</span>
<span class="udiff-line-added">+         Assembler::fillNops&lt;memcpy&gt;(outData + compactSize, nopSizeInBytes);</span>
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+         Assembler::fillNops&lt;performJITMemcpy&gt;(outData + compactSize, nopSizeInBytes);</span>
<span class="udiff-line-added">+ #endif</span>
      }
  
  #if CPU(ARM64E) &amp;&amp; ENABLE(FAST_JIT_PERMISSIONS)
      os_thread_self_restrict_rwx_to_rx();
  #endif
</pre>
<center><a href="AssemblerCommon.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="LinkBuffer.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>