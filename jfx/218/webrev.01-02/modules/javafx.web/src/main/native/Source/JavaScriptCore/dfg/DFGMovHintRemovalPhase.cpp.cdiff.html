<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGMovHintRemovalPhase.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DFGMinifiedID.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGNode.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGMovHintRemovalPhase.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (C) 2015 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (C) 2015-2019 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
</pre>
<hr />
<pre>
<span class="line-old-header">*** 41,11 ***</span>
  namespace JSC { namespace DFG {
  
  namespace {
  
  namespace DFGMovHintRemovalPhaseInternal {
<span class="line-modified">! static const bool verbose = false;</span>
  }
  
  class MovHintRemovalPhase : public Phase {
  public:
      MovHintRemovalPhase(Graph&amp; graph)
<span class="line-new-header">--- 41,11 ---</span>
  namespace JSC { namespace DFG {
  
  namespace {
  
  namespace DFGMovHintRemovalPhaseInternal {
<span class="line-modified">! static constexpr bool verbose = false;</span>
  }
  
  class MovHintRemovalPhase : public Phase {
  public:
      MovHintRemovalPhase(Graph&amp; graph)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 83,11 ***</span>
          Epoch currentEpoch = Epoch::first();
  
          m_state.fill(Epoch());
          m_graph.forAllLiveInBytecode(
              block-&gt;terminal()-&gt;origin.forExit,
<span class="line-modified">!             [&amp;] (VirtualRegister reg) {</span>
                  m_state.operand(reg) = currentEpoch;
              });
  
          if (DFGMovHintRemovalPhaseInternal::verbose)
              dataLog(&quot;    Locals: &quot;, m_state, &quot;\n&quot;);
<span class="line-new-header">--- 83,11 ---</span>
          Epoch currentEpoch = Epoch::first();
  
          m_state.fill(Epoch());
          m_graph.forAllLiveInBytecode(
              block-&gt;terminal()-&gt;origin.forExit,
<span class="line-modified">!             [&amp;] (Operand reg) {</span>
                  m_state.operand(reg) = currentEpoch;
              });
  
          if (DFGMovHintRemovalPhaseInternal::verbose)
              dataLog(&quot;    Locals: &quot;, m_state, &quot;\n&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 97,36 ***</span>
  
          for (unsigned nodeIndex = block-&gt;size(); nodeIndex--;) {
              Node* node = block-&gt;at(nodeIndex);
  
              if (node-&gt;op() == MovHint) {
<span class="line-modified">!                 Epoch localEpoch = m_state.operand(node-&gt;unlinkedLocal());</span>
                  if (DFGMovHintRemovalPhaseInternal::verbose)
                      dataLog(&quot;    At &quot;, node, &quot;: current = &quot;, currentEpoch, &quot;, local = &quot;, localEpoch, &quot;\n&quot;);
                  if (!localEpoch || localEpoch == currentEpoch) {
                      node-&gt;setOpAndDefaultFlags(ZombieHint);
                      node-&gt;child1() = Edge();
                      m_changed = true;
                  }
<span class="line-modified">!                 m_state.operand(node-&gt;unlinkedLocal()) = Epoch();</span>
              }
  
              if (mayExit(m_graph, node) != DoesNotExit)
                  currentEpoch.bump();
  
              if (nodeIndex) {
                  forAllKilledOperands(
                      m_graph, block-&gt;at(nodeIndex - 1), node,
<span class="line-modified">!                     [&amp;] (VirtualRegister reg) {</span>
                          // This function is a bit sloppy - it might claim to kill a local even if
                          // it&#39;s still live after. We need to protect against that.
<span class="line-modified">!                         if (!!m_state.operand(reg))</span>
                              return;
  
                          if (DFGMovHintRemovalPhaseInternal::verbose)
<span class="line-modified">!                             dataLog(&quot;    Killed operand at &quot;, node, &quot;: &quot;, reg, &quot;\n&quot;);</span>
<span class="line-modified">!                         m_state.operand(reg) = currentEpoch;</span>
                      });
              }
          }
      }
  
<span class="line-new-header">--- 97,36 ---</span>
  
          for (unsigned nodeIndex = block-&gt;size(); nodeIndex--;) {
              Node* node = block-&gt;at(nodeIndex);
  
              if (node-&gt;op() == MovHint) {
<span class="line-modified">!                 Epoch localEpoch = m_state.operand(node-&gt;unlinkedOperand());</span>
                  if (DFGMovHintRemovalPhaseInternal::verbose)
                      dataLog(&quot;    At &quot;, node, &quot;: current = &quot;, currentEpoch, &quot;, local = &quot;, localEpoch, &quot;\n&quot;);
                  if (!localEpoch || localEpoch == currentEpoch) {
                      node-&gt;setOpAndDefaultFlags(ZombieHint);
                      node-&gt;child1() = Edge();
                      m_changed = true;
                  }
<span class="line-modified">!                 m_state.operand(node-&gt;unlinkedOperand()) = Epoch();</span>
              }
  
              if (mayExit(m_graph, node) != DoesNotExit)
                  currentEpoch.bump();
  
              if (nodeIndex) {
                  forAllKilledOperands(
                      m_graph, block-&gt;at(nodeIndex - 1), node,
<span class="line-modified">!                     [&amp;] (Operand operand) {</span>
                          // This function is a bit sloppy - it might claim to kill a local even if
                          // it&#39;s still live after. We need to protect against that.
<span class="line-modified">!                         if (!!m_state.operand(operand))</span>
                              return;
  
                          if (DFGMovHintRemovalPhaseInternal::verbose)
<span class="line-modified">!                             dataLog(&quot;    Killed operand at &quot;, node, &quot;: &quot;, operand, &quot;\n&quot;);</span>
<span class="line-modified">!                         m_state.operand(operand) = currentEpoch;</span>
                      });
              }
          }
      }
  
</pre>
<center><a href="DFGMinifiedID.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGNode.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>