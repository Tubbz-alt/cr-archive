<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/StringPrototype.js</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="StringIteratorPrototype.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="TypedArrayConstructor.js.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/StringPrototype.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 21  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 22  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 23  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 24  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 25  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 26  */
 27 
 28 function match(regexp)
 29 {
 30     &quot;use strict&quot;;
 31 
 32     if (@isUndefinedOrNull(this))
 33         @throwTypeError(&quot;String.prototype.match requires that |this| not be null or undefined&quot;);
 34 
 35     if (regexp != null) {
 36         var matcher = regexp.@matchSymbol;
 37         if (matcher != @undefined)
 38             return matcher.@call(regexp, this);
 39     }
 40 
<span class="line-modified"> 41     let thisString = @toString(this);</span>
<span class="line-modified"> 42     let createdRegExp = @regExpCreate(regexp, @undefined);</span>
 43     return createdRegExp.@matchSymbol(thisString);
 44 }
 45 
 46 function matchAll(arg)
 47 {
 48     &quot;use strict&quot;;
 49 
 50     if (@isUndefinedOrNull(this))
 51         @throwTypeError(&quot;String.prototype.matchAll requires |this| not to be null nor undefined&quot;);
 52 
 53     if (!@isUndefinedOrNull(arg)) {
<span class="line-modified"> 54         let matcher = arg.@matchAllSymbol;</span>



 55         if (!@isUndefinedOrNull(matcher))
 56             return matcher.@call(arg, this);
 57     }
 58 
<span class="line-modified"> 59     let string = @toString(this);</span>
<span class="line-modified"> 60     let regExp = @regExpCreate(arg, &quot;g&quot;);</span>
 61     return regExp.@matchAllSymbol(string);
 62 }
 63 
 64 @globalPrivate
 65 function repeatSlowPath(string, count)
 66 {
 67     &quot;use strict&quot;;
 68 
 69     // Return an empty string.
 70     if (count === 0 || string.length === 0)
 71         return &quot;&quot;;
 72 
 73     // Return the original string.
 74     if (count === 1)
 75         return string;
 76 
 77     if (string.length * count &gt; @MAX_STRING_LENGTH)
 78         @throwOutOfMemoryError();
 79 
 80     // Bit operation onto |count| is safe because |count| should be within Int32 range,
</pre>
<hr />
<pre>
202     var truncatedStringFiller;
203 
204     if (filler.length === 1)
205         truncatedStringFiller = @repeatCharacter(filler, fillLength);
206     else
207         truncatedStringFiller = @repeatCharactersSlowPath(filler, fillLength);
208     return string + truncatedStringFiller;
209 }
210 
211 @globalPrivate
212 function hasObservableSideEffectsForStringReplace(regexp, replacer)
213 {
214     &quot;use strict&quot;;
215 
216     if (!@isRegExpObject(regexp))
217         return true;
218 
219     if (replacer !== @regExpPrototypeSymbolReplace)
220         return true;
221     
<span class="line-modified">222     let regexpExec = @tryGetById(regexp, &quot;exec&quot;);</span>
223     if (regexpExec !== @regExpBuiltinExec)
224         return true;
225 
<span class="line-modified">226     let regexpGlobal = @tryGetById(regexp, &quot;global&quot;);</span>
227     if (regexpGlobal !== @regExpProtoGlobalGetter)
228         return true;
229 
<span class="line-modified">230     let regexpUnicode = @tryGetById(regexp, &quot;unicode&quot;);</span>
231     if (regexpUnicode !== @regExpProtoUnicodeGetter)
232         return true;
233 
234     return typeof regexp.lastIndex !== &quot;number&quot;;
235 }
236 
237 @intrinsic=StringPrototypeReplaceIntrinsic
238 function replace(search, replace)
239 {
240     &quot;use strict&quot;;
241 
242     if (@isUndefinedOrNull(this))
243         @throwTypeError(&quot;String.prototype.replace requires that |this| not be null or undefined&quot;);
244 
245     if (search != null) {
<span class="line-modified">246         let replacer = search.@replaceSymbol;</span>
247         if (replacer !== @undefined) {
248             if (!@hasObservableSideEffectsForStringReplace(search, replacer))
249                 return @toString(this).@replaceUsingRegExp(search, replace);
250             return replacer.@call(search, this, replace);
251         }
252     }
253 
<span class="line-modified">254     let thisString = @toString(this);</span>
<span class="line-modified">255     let searchString = @toString(search);</span>
256     return thisString.@replaceUsingStringSearch(searchString, replace);
257 }
258 
























259 function search(regexp)
260 {
261     &quot;use strict&quot;;
262 
263     if (@isUndefinedOrNull(this))
264         @throwTypeError(&quot;String.prototype.search requires that |this| not be null or undefined&quot;);
265 
266     if (regexp != null) {
267         var searcher = regexp.@searchSymbol;
268         if (searcher != @undefined)
269             return searcher.@call(regexp, this);
270     }
271 
272     var thisString = @toString(this);
273     var createdRegExp = @regExpCreate(regexp, @undefined);
274     return createdRegExp.@searchSymbol(thisString);
275 }
276 
277 function split(separator, limit)
278 {
</pre>
<hr />
<pre>
302 }
303 
304 function concat(arg /* ... */)
305 {
306     &quot;use strict&quot;;
307 
308     if (@isUndefinedOrNull(this))
309         @throwTypeError(&quot;String.prototype.concat requires that |this| not be null or undefined&quot;);
310 
311     if (@argumentCount() === 1)
312         return @toString(this) + @toString(arg);
313     return @tailCallForwardArguments(@stringConcatSlowPath, this);
314 }
315 
316 @globalPrivate
317 function createHTML(func, string, tag, attribute, value)
318 {
319     &quot;use strict&quot;;
320     if (@isUndefinedOrNull(string))
321         @throwTypeError(`${func} requires that |this| not be null or undefined`);
<span class="line-modified">322     let S = @toString(string);</span>
<span class="line-modified">323     let p1 = &quot;&lt;&quot; + tag;</span>
324     if (attribute) {
<span class="line-modified">325         let V = @toString(value);</span>
<span class="line-modified">326         let escapedV = V.@replaceUsingRegExp(/&quot;/g, &#39;&amp;quot;&#39;);</span>
327         p1 = p1 + &quot; &quot; + @toString(attribute) + &#39;=&quot;&#39; + escapedV + &#39;&quot;&#39;
328     }
<span class="line-modified">329     let p2 = p1 + &quot;&gt;&quot;</span>
<span class="line-modified">330     let p3 = p2 + S;</span>
<span class="line-modified">331     let p4 = p3 + &quot;&lt;/&quot; + tag + &quot;&gt;&quot;;</span>
332     return p4;
333 }
334 
335 function anchor(url)
336 {
337     &quot;use strict&quot;;
338     return @createHTML(&quot;String.prototype.link&quot;, this, &quot;a&quot;, &quot;name&quot;, url)
339 }
340 
341 function big()
342 {
343     &quot;use strict&quot;;
344     return @createHTML(&quot;String.prototype.big&quot;, this, &quot;big&quot;, &quot;&quot;, &quot;&quot;);
345 }
346 
347 function blink()
348 {
349     &quot;use strict&quot;;
350     return @createHTML(&quot;String.prototype.blink&quot;, this, &quot;blink&quot;, &quot;&quot;, &quot;&quot;);
351 }
</pre>
</td>
<td>
<hr />
<pre>
 21  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 22  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 23  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 24  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 25  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 26  */
 27 
 28 function match(regexp)
 29 {
 30     &quot;use strict&quot;;
 31 
 32     if (@isUndefinedOrNull(this))
 33         @throwTypeError(&quot;String.prototype.match requires that |this| not be null or undefined&quot;);
 34 
 35     if (regexp != null) {
 36         var matcher = regexp.@matchSymbol;
 37         if (matcher != @undefined)
 38             return matcher.@call(regexp, this);
 39     }
 40 
<span class="line-modified"> 41     var thisString = @toString(this);</span>
<span class="line-modified"> 42     var createdRegExp = @regExpCreate(regexp, @undefined);</span>
 43     return createdRegExp.@matchSymbol(thisString);
 44 }
 45 
 46 function matchAll(arg)
 47 {
 48     &quot;use strict&quot;;
 49 
 50     if (@isUndefinedOrNull(this))
 51         @throwTypeError(&quot;String.prototype.matchAll requires |this| not to be null nor undefined&quot;);
 52 
 53     if (!@isUndefinedOrNull(arg)) {
<span class="line-modified"> 54         if (@isRegExp(arg) &amp;&amp; !@stringIncludesInternal.@call(@toString(arg.flags), &quot;g&quot;))</span>
<span class="line-added"> 55             @throwTypeError(&quot;String.prototype.matchAll argument must not be a non-global regular expression&quot;);</span>
<span class="line-added"> 56 </span>
<span class="line-added"> 57         var matcher = arg.@matchAllSymbol;</span>
 58         if (!@isUndefinedOrNull(matcher))
 59             return matcher.@call(arg, this);
 60     }
 61 
<span class="line-modified"> 62     var string = @toString(this);</span>
<span class="line-modified"> 63     var regExp = @regExpCreate(arg, &quot;g&quot;);</span>
 64     return regExp.@matchAllSymbol(string);
 65 }
 66 
 67 @globalPrivate
 68 function repeatSlowPath(string, count)
 69 {
 70     &quot;use strict&quot;;
 71 
 72     // Return an empty string.
 73     if (count === 0 || string.length === 0)
 74         return &quot;&quot;;
 75 
 76     // Return the original string.
 77     if (count === 1)
 78         return string;
 79 
 80     if (string.length * count &gt; @MAX_STRING_LENGTH)
 81         @throwOutOfMemoryError();
 82 
 83     // Bit operation onto |count| is safe because |count| should be within Int32 range,
</pre>
<hr />
<pre>
205     var truncatedStringFiller;
206 
207     if (filler.length === 1)
208         truncatedStringFiller = @repeatCharacter(filler, fillLength);
209     else
210         truncatedStringFiller = @repeatCharactersSlowPath(filler, fillLength);
211     return string + truncatedStringFiller;
212 }
213 
214 @globalPrivate
215 function hasObservableSideEffectsForStringReplace(regexp, replacer)
216 {
217     &quot;use strict&quot;;
218 
219     if (!@isRegExpObject(regexp))
220         return true;
221 
222     if (replacer !== @regExpPrototypeSymbolReplace)
223         return true;
224     
<span class="line-modified">225     var regexpExec = @tryGetById(regexp, &quot;exec&quot;);</span>
226     if (regexpExec !== @regExpBuiltinExec)
227         return true;
228 
<span class="line-modified">229     var regexpGlobal = @tryGetById(regexp, &quot;global&quot;);</span>
230     if (regexpGlobal !== @regExpProtoGlobalGetter)
231         return true;
232 
<span class="line-modified">233     var regexpUnicode = @tryGetById(regexp, &quot;unicode&quot;);</span>
234     if (regexpUnicode !== @regExpProtoUnicodeGetter)
235         return true;
236 
237     return typeof regexp.lastIndex !== &quot;number&quot;;
238 }
239 
240 @intrinsic=StringPrototypeReplaceIntrinsic
241 function replace(search, replace)
242 {
243     &quot;use strict&quot;;
244 
245     if (@isUndefinedOrNull(this))
246         @throwTypeError(&quot;String.prototype.replace requires that |this| not be null or undefined&quot;);
247 
248     if (search != null) {
<span class="line-modified">249         var replacer = search.@replaceSymbol;</span>
250         if (replacer !== @undefined) {
251             if (!@hasObservableSideEffectsForStringReplace(search, replacer))
252                 return @toString(this).@replaceUsingRegExp(search, replace);
253             return replacer.@call(search, this, replace);
254         }
255     }
256 
<span class="line-modified">257     var thisString = @toString(this);</span>
<span class="line-modified">258     var searchString = @toString(search);</span>
259     return thisString.@replaceUsingStringSearch(searchString, replace);
260 }
261 
<span class="line-added">262 function replaceAll(search, replace)</span>
<span class="line-added">263 {</span>
<span class="line-added">264     &quot;use strict&quot;;</span>
<span class="line-added">265 </span>
<span class="line-added">266     if (@isUndefinedOrNull(this))</span>
<span class="line-added">267         @throwTypeError(&quot;String.prototype.replaceAll requires |this| not to be null nor undefined&quot;);</span>
<span class="line-added">268 </span>
<span class="line-added">269     if (search != null) {</span>
<span class="line-added">270         if (@isRegExp(search) &amp;&amp; !@stringIncludesInternal.@call(@toString(search.flags), &quot;g&quot;))</span>
<span class="line-added">271             @throwTypeError(&quot;String.prototype.replaceAll argument must not be a non-global regular expression&quot;);</span>
<span class="line-added">272 </span>
<span class="line-added">273         var replacer = search.@replaceSymbol;</span>
<span class="line-added">274         if (replacer !== @undefined) {</span>
<span class="line-added">275             if (!@hasObservableSideEffectsForStringReplace(search, replacer))</span>
<span class="line-added">276                 return @toString(this).@replaceUsingRegExp(search, replace);</span>
<span class="line-added">277             return replacer.@call(search, this, replace);</span>
<span class="line-added">278         }</span>
<span class="line-added">279     }</span>
<span class="line-added">280 </span>
<span class="line-added">281     var thisString = @toString(this);</span>
<span class="line-added">282     var searchString = @toString(search);</span>
<span class="line-added">283     return thisString.@replaceAllUsingStringSearch(searchString, replace);</span>
<span class="line-added">284 }</span>
<span class="line-added">285 </span>
286 function search(regexp)
287 {
288     &quot;use strict&quot;;
289 
290     if (@isUndefinedOrNull(this))
291         @throwTypeError(&quot;String.prototype.search requires that |this| not be null or undefined&quot;);
292 
293     if (regexp != null) {
294         var searcher = regexp.@searchSymbol;
295         if (searcher != @undefined)
296             return searcher.@call(regexp, this);
297     }
298 
299     var thisString = @toString(this);
300     var createdRegExp = @regExpCreate(regexp, @undefined);
301     return createdRegExp.@searchSymbol(thisString);
302 }
303 
304 function split(separator, limit)
305 {
</pre>
<hr />
<pre>
329 }
330 
331 function concat(arg /* ... */)
332 {
333     &quot;use strict&quot;;
334 
335     if (@isUndefinedOrNull(this))
336         @throwTypeError(&quot;String.prototype.concat requires that |this| not be null or undefined&quot;);
337 
338     if (@argumentCount() === 1)
339         return @toString(this) + @toString(arg);
340     return @tailCallForwardArguments(@stringConcatSlowPath, this);
341 }
342 
343 @globalPrivate
344 function createHTML(func, string, tag, attribute, value)
345 {
346     &quot;use strict&quot;;
347     if (@isUndefinedOrNull(string))
348         @throwTypeError(`${func} requires that |this| not be null or undefined`);
<span class="line-modified">349     var S = @toString(string);</span>
<span class="line-modified">350     var p1 = &quot;&lt;&quot; + tag;</span>
351     if (attribute) {
<span class="line-modified">352         var V = @toString(value);</span>
<span class="line-modified">353         var escapedV = V.@replaceUsingRegExp(/&quot;/g, &#39;&amp;quot;&#39;);</span>
354         p1 = p1 + &quot; &quot; + @toString(attribute) + &#39;=&quot;&#39; + escapedV + &#39;&quot;&#39;
355     }
<span class="line-modified">356     var p2 = p1 + &quot;&gt;&quot;</span>
<span class="line-modified">357     var p3 = p2 + S;</span>
<span class="line-modified">358     var p4 = p3 + &quot;&lt;/&quot; + tag + &quot;&gt;&quot;;</span>
359     return p4;
360 }
361 
362 function anchor(url)
363 {
364     &quot;use strict&quot;;
365     return @createHTML(&quot;String.prototype.link&quot;, this, &quot;a&quot;, &quot;name&quot;, url)
366 }
367 
368 function big()
369 {
370     &quot;use strict&quot;;
371     return @createHTML(&quot;String.prototype.big&quot;, this, &quot;big&quot;, &quot;&quot;, &quot;&quot;);
372 }
373 
374 function blink()
375 {
376     &quot;use strict&quot;;
377     return @createHTML(&quot;String.prototype.blink&quot;, this, &quot;blink&quot;, &quot;&quot;, &quot;&quot;);
378 }
</pre>
</td>
</tr>
</table>
<center><a href="StringIteratorPrototype.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="TypedArrayConstructor.js.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>