<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/JavaScriptCore/parser/ParserModes.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2012-2013, 2015-2016 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 14  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 15  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;ConstructAbility.h&quot;
 29 #include &quot;ConstructorKind.h&quot;
 30 #include &quot;Identifier.h&quot;
 31 
 32 namespace JSC {
 33 
 34 enum class JSParserStrictMode { NotStrict, Strict };
 35 enum class JSParserBuiltinMode { NotBuiltin, Builtin };
 36 enum class JSParserScriptMode { Classic, Module };
 37 
 38 enum class SuperBinding { Needed, NotNeeded };
 39 
 40 enum class CodeGenerationMode : uint8_t {
 41     Debugger = 1 &lt;&lt; 0,
 42     TypeProfiler = 1 &lt;&lt; 1,
 43     ControlFlowProfiler = 1 &lt;&lt; 2,
 44 };
 45 
 46 enum class FunctionMode { FunctionExpression, FunctionDeclaration, MethodDefinition };
 47 
 48 // Keep it less than 32, it means this should be within 5 bits.
 49 enum class SourceParseMode : uint8_t {
 50     NormalFunctionMode                = 0,
 51     GeneratorBodyMode                 = 1,
 52     GeneratorWrapperFunctionMode      = 2,
 53     GetterMode                        = 3,
 54     SetterMode                        = 4,
 55     MethodMode                        = 5,
 56     ArrowFunctionMode                 = 6,
 57     AsyncFunctionBodyMode             = 7,
 58     AsyncArrowFunctionBodyMode        = 8,
 59     AsyncFunctionMode                 = 9,
 60     AsyncMethodMode                   = 10,
 61     AsyncArrowFunctionMode            = 11,
 62     ProgramMode                       = 12,
 63     ModuleAnalyzeMode                 = 13,
 64     ModuleEvaluateMode                = 14,
 65     AsyncGeneratorBodyMode            = 15,
 66     AsyncGeneratorWrapperFunctionMode = 16,
 67     AsyncGeneratorWrapperMethodMode   = 17,
 68     GeneratorWrapperMethodMode        = 18,
 69     InstanceFieldInitializerMode      = 19,
 70 };
 71 
 72 class SourceParseModeSet {
 73 public:
 74     template&lt;typename... Modes&gt;
 75     constexpr SourceParseModeSet(Modes... args)
 76         : m_mask(mergeSourceParseModes(args...))
 77     {
 78     }
 79 
 80     ALWAYS_INLINE constexpr bool contains(SourceParseMode mode)
 81     {
 82         return (1U &lt;&lt; static_cast&lt;unsigned&gt;(mode)) &amp; m_mask;
 83     }
 84 
 85 private:
 86     ALWAYS_INLINE static constexpr unsigned mergeSourceParseModes(SourceParseMode mode)
 87     {
 88         return (1U &lt;&lt; static_cast&lt;unsigned&gt;(mode));
 89     }
 90 
 91     template&lt;typename... Rest&gt;
 92     ALWAYS_INLINE static constexpr unsigned mergeSourceParseModes(SourceParseMode mode, Rest... rest)
 93     {
 94         return (1U &lt;&lt; static_cast&lt;unsigned&gt;(mode)) | mergeSourceParseModes(rest...);
 95     }
 96 
 97     const unsigned m_mask;
 98 };
 99 
100 ALWAYS_INLINE bool isFunctionParseMode(SourceParseMode parseMode)
101 {
102     return SourceParseModeSet(
103         SourceParseMode::NormalFunctionMode,
104         SourceParseMode::GeneratorBodyMode,
105         SourceParseMode::GeneratorWrapperFunctionMode,
106         SourceParseMode::GeneratorWrapperMethodMode,
107         SourceParseMode::GetterMode,
108         SourceParseMode::SetterMode,
109         SourceParseMode::MethodMode,
110         SourceParseMode::ArrowFunctionMode,
111         SourceParseMode::AsyncFunctionBodyMode,
112         SourceParseMode::AsyncFunctionMode,
113         SourceParseMode::AsyncMethodMode,
114         SourceParseMode::AsyncArrowFunctionMode,
115         SourceParseMode::AsyncArrowFunctionBodyMode,
116         SourceParseMode::AsyncGeneratorBodyMode,
117         SourceParseMode::AsyncGeneratorWrapperFunctionMode,
118         SourceParseMode::AsyncGeneratorWrapperMethodMode,
119         SourceParseMode::InstanceFieldInitializerMode).contains(parseMode);
120 }
121 
122 ALWAYS_INLINE bool isAsyncFunctionParseMode(SourceParseMode parseMode)
123 {
124     return SourceParseModeSet(
125         SourceParseMode::AsyncGeneratorWrapperFunctionMode,
126         SourceParseMode::AsyncGeneratorBodyMode,
127         SourceParseMode::AsyncGeneratorWrapperMethodMode,
128         SourceParseMode::AsyncFunctionBodyMode,
129         SourceParseMode::AsyncFunctionMode,
130         SourceParseMode::AsyncMethodMode,
131         SourceParseMode::AsyncArrowFunctionMode,
132         SourceParseMode::AsyncArrowFunctionBodyMode).contains(parseMode);
133 }
134 
135 ALWAYS_INLINE bool isAsyncArrowFunctionParseMode(SourceParseMode parseMode)
136 {
137     return SourceParseModeSet(
138         SourceParseMode::AsyncArrowFunctionMode,
139         SourceParseMode::AsyncArrowFunctionBodyMode).contains(parseMode);
140 }
141 
142 ALWAYS_INLINE bool isAsyncGeneratorParseMode(SourceParseMode parseMode)
143 {
144     return SourceParseModeSet(
145         SourceParseMode::AsyncGeneratorWrapperFunctionMode,
146         SourceParseMode::AsyncGeneratorWrapperMethodMode,
147         SourceParseMode::AsyncGeneratorBodyMode).contains(parseMode);
148 }
149 
150 ALWAYS_INLINE bool isAsyncGeneratorWrapperParseMode(SourceParseMode parseMode)
151 {
152     return SourceParseModeSet(
153         SourceParseMode::AsyncGeneratorWrapperFunctionMode,
154         SourceParseMode::AsyncGeneratorWrapperMethodMode).contains(parseMode);
155 }
156 
157 ALWAYS_INLINE bool isAsyncFunctionOrAsyncGeneratorWrapperParseMode(SourceParseMode parseMode)
158 {
159     return SourceParseModeSet(
160         SourceParseMode::AsyncArrowFunctionMode,
161         SourceParseMode::AsyncFunctionMode,
162         SourceParseMode::AsyncGeneratorWrapperFunctionMode,
163         SourceParseMode::AsyncGeneratorWrapperMethodMode,
164         SourceParseMode::AsyncMethodMode).contains(parseMode);
165     }
166 
167 ALWAYS_INLINE bool isAsyncFunctionWrapperParseMode(SourceParseMode parseMode)
168 {
169     return SourceParseModeSet(
170         SourceParseMode::AsyncArrowFunctionMode,
171         SourceParseMode::AsyncFunctionMode,
172         SourceParseMode::AsyncMethodMode).contains(parseMode);
173 }
174 
175 ALWAYS_INLINE bool isAsyncFunctionBodyParseMode(SourceParseMode parseMode)
176 {
177     return SourceParseModeSet(
178         SourceParseMode::AsyncFunctionBodyMode,
179         SourceParseMode::AsyncGeneratorBodyMode,
180         SourceParseMode::AsyncArrowFunctionBodyMode).contains(parseMode);
181 }
182 
183 ALWAYS_INLINE bool isGeneratorMethodParseMode(SourceParseMode parseMode)
184 {
185     return SourceParseModeSet(
186         SourceParseMode::GeneratorWrapperMethodMode).contains(parseMode);
187 }
188 
189 ALWAYS_INLINE bool isAsyncMethodParseMode(SourceParseMode parseMode)
190 {
191     return SourceParseModeSet(SourceParseMode::AsyncMethodMode).contains(parseMode);
192 }
193 
194 ALWAYS_INLINE bool isAsyncGeneratorMethodParseMode(SourceParseMode parseMode)
195 {
196     return SourceParseModeSet(SourceParseMode::AsyncGeneratorWrapperMethodMode).contains(parseMode);
197 }
198 
199 ALWAYS_INLINE bool isMethodParseMode(SourceParseMode parseMode)
200 {
201     return SourceParseModeSet(
202         SourceParseMode::GeneratorWrapperMethodMode,
203         SourceParseMode::GetterMode,
204         SourceParseMode::SetterMode,
205         SourceParseMode::MethodMode,
206         SourceParseMode::AsyncMethodMode,
207         SourceParseMode::AsyncGeneratorWrapperMethodMode).contains(parseMode);
208 }
209 
210 ALWAYS_INLINE bool isGeneratorOrAsyncFunctionBodyParseMode(SourceParseMode parseMode)
211 {
212     return SourceParseModeSet(
213         SourceParseMode::GeneratorBodyMode,
214         SourceParseMode::AsyncFunctionBodyMode,
215         SourceParseMode::AsyncGeneratorBodyMode,
216         SourceParseMode::AsyncArrowFunctionBodyMode).contains(parseMode);
217 }
218 
219 ALWAYS_INLINE bool isGeneratorOrAsyncFunctionWrapperParseMode(SourceParseMode parseMode)
220 {
221     return SourceParseModeSet(
222         SourceParseMode::GeneratorWrapperFunctionMode,
223         SourceParseMode::GeneratorWrapperMethodMode,
224         SourceParseMode::AsyncFunctionMode,
225         SourceParseMode::AsyncArrowFunctionMode,
226         SourceParseMode::AsyncGeneratorWrapperFunctionMode,
227         SourceParseMode::AsyncMethodMode,
228         SourceParseMode::AsyncGeneratorWrapperMethodMode).contains(parseMode);
229 }
230 
231 ALWAYS_INLINE bool isGeneratorParseMode(SourceParseMode parseMode)
232 {
233     return SourceParseModeSet(
234         SourceParseMode::GeneratorBodyMode,
235         SourceParseMode::GeneratorWrapperFunctionMode,
236         SourceParseMode::GeneratorWrapperMethodMode).contains(parseMode);
237 }
238 
239 ALWAYS_INLINE bool isGeneratorWrapperParseMode(SourceParseMode parseMode)
240 {
241     return SourceParseModeSet(
242         SourceParseMode::GeneratorWrapperFunctionMode,
243         SourceParseMode::GeneratorWrapperMethodMode).contains(parseMode);
244 }
245 
246 ALWAYS_INLINE bool isArrowFunctionParseMode(SourceParseMode parseMode)
247 {
248     return SourceParseModeSet(
249         SourceParseMode::ArrowFunctionMode,
250         SourceParseMode::AsyncArrowFunctionMode,
251         SourceParseMode::AsyncArrowFunctionBodyMode).contains(parseMode);
252 }
253 
254 ALWAYS_INLINE bool isModuleParseMode(SourceParseMode parseMode)
255 {
256     return SourceParseModeSet(
257         SourceParseMode::ModuleAnalyzeMode,
258         SourceParseMode::ModuleEvaluateMode).contains(parseMode);
259 }
260 
261 ALWAYS_INLINE bool isProgramParseMode(SourceParseMode parseMode)
262 {
263     return SourceParseModeSet(SourceParseMode::ProgramMode).contains(parseMode);
264 }
265 
266 ALWAYS_INLINE bool isProgramOrModuleParseMode(SourceParseMode parseMode)
267 {
268     return SourceParseModeSet(
269         SourceParseMode::ProgramMode,
270         SourceParseMode::ModuleAnalyzeMode,
271         SourceParseMode::ModuleEvaluateMode).contains(parseMode);
272 }
273 
274 ALWAYS_INLINE ConstructAbility constructAbilityForParseMode(SourceParseMode parseMode)
275 {
276     if (parseMode == SourceParseMode::NormalFunctionMode)
277         return ConstructAbility::CanConstruct;
278 
279     return ConstructAbility::CannotConstruct;
280 }
281 
282 inline bool functionNameIsInScope(const Identifier&amp; name, FunctionMode functionMode)
283 {
284     if (name.isNull())
285         return false;
286 
287     if (functionMode != FunctionMode::FunctionExpression)
288         return false;
289 
290     return true;
291 }
292 
293 inline bool functionNameScopeIsDynamic(bool usesEval, bool isStrictMode)
294 {
295     // If non-strict eval is in play, a function gets a separate object in the scope chain for its name.
296     // This enables eval to declare and then delete a name that shadows the function&#39;s name.
297 
298     if (!usesEval)
299         return false;
300 
301     if (isStrictMode)
302         return false;
303 
304     return true;
305 }
306 
307 typedef uint16_t CodeFeatures;
308 
309 const CodeFeatures NoFeatures =                       0;
310 const CodeFeatures EvalFeature =                 1 &lt;&lt; 0;
311 const CodeFeatures ArgumentsFeature =            1 &lt;&lt; 1;
312 const CodeFeatures WithFeature =                 1 &lt;&lt; 2;
313 const CodeFeatures ThisFeature =                 1 &lt;&lt; 3;
314 const CodeFeatures StrictModeFeature =           1 &lt;&lt; 4;
315 const CodeFeatures ShadowsArgumentsFeature =     1 &lt;&lt; 5;
316 const CodeFeatures ArrowFunctionFeature =        1 &lt;&lt; 6;
317 const CodeFeatures ArrowFunctionContextFeature = 1 &lt;&lt; 7;
318 const CodeFeatures SuperCallFeature =            1 &lt;&lt; 8;
319 const CodeFeatures SuperPropertyFeature =        1 &lt;&lt; 9;
320 const CodeFeatures NewTargetFeature =            1 &lt;&lt; 10;
321 const CodeFeatures NoEvalCacheFeature =          1 &lt;&lt; 11;
322 
323 const CodeFeatures AllFeatures = EvalFeature | ArgumentsFeature | WithFeature | ThisFeature | StrictModeFeature | ShadowsArgumentsFeature | ArrowFunctionFeature | ArrowFunctionContextFeature |
324     SuperCallFeature | SuperPropertyFeature | NewTargetFeature | NoEvalCacheFeature;
325 
326 typedef uint8_t InnerArrowFunctionCodeFeatures;
327 
328 const InnerArrowFunctionCodeFeatures NoInnerArrowFunctionFeatures =                0;
329 const InnerArrowFunctionCodeFeatures EvalInnerArrowFunctionFeature =          1 &lt;&lt; 0;
330 const InnerArrowFunctionCodeFeatures ArgumentsInnerArrowFunctionFeature =     1 &lt;&lt; 1;
331 const InnerArrowFunctionCodeFeatures ThisInnerArrowFunctionFeature =          1 &lt;&lt; 2;
332 const InnerArrowFunctionCodeFeatures SuperCallInnerArrowFunctionFeature =     1 &lt;&lt; 3;
333 const InnerArrowFunctionCodeFeatures SuperPropertyInnerArrowFunctionFeature = 1 &lt;&lt; 4;
334 const InnerArrowFunctionCodeFeatures NewTargetInnerArrowFunctionFeature =     1 &lt;&lt; 5;
335 
336 const InnerArrowFunctionCodeFeatures AllInnerArrowFunctionCodeFeatures = EvalInnerArrowFunctionFeature | ArgumentsInnerArrowFunctionFeature | ThisInnerArrowFunctionFeature | SuperCallInnerArrowFunctionFeature | SuperPropertyInnerArrowFunctionFeature | NewTargetInnerArrowFunctionFeature;
337 static_assert(AllInnerArrowFunctionCodeFeatures &lt;= 0b111111, &quot;InnerArrowFunctionCodeFeatures must be 6bits&quot;);
338 } // namespace JSC
    </pre>
  </body>
</html>