<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/xml/parser/XMLDocumentParserLibxml2.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="XMLDocumentParser.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../WebKitLegacy/CMakeLists.txt.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/xml/parser/XMLDocumentParserLibxml2.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -42,10 +42,11 @@</span>
  #include &quot;InlineClassicScript.h&quot;
  #include &quot;PendingScript.h&quot;
  #include &quot;ProcessingInstruction.h&quot;
  #include &quot;ResourceError.h&quot;
  #include &quot;ResourceResponse.h&quot;
<span class="udiff-line-added">+ #include &quot;SVGElement.h&quot;</span>
  #include &quot;ScriptElement.h&quot;
  #include &quot;ScriptSourceCode.h&quot;
  #include &quot;Settings.h&quot;
  #include &quot;SharedBuffer.h&quot;
  #include &quot;StyleScope.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -569,48 +570,20 @@</span>
      , m_currentNode(&amp;document)
      , m_scriptStartPosition(TextPosition::belowRangePosition())
  {
  }
  
<span class="udiff-line-modified-removed">- XMLDocumentParser::XMLDocumentParser(DocumentFragment&amp; fragment, Element* parentElement, ParserContentPolicy parserContentPolicy)</span>
<span class="udiff-line-modified-added">+ XMLDocumentParser::XMLDocumentParser(DocumentFragment&amp; fragment, HashMap&lt;AtomString, AtomString&gt;&amp;&amp; prefixToNamespaceMap, const AtomString&amp; defaultNamespaceURI, ParserContentPolicy parserContentPolicy)</span>
      : ScriptableDocumentParser(fragment.document(), parserContentPolicy)
      , m_pendingCallbacks(makeUnique&lt;PendingCallbacks&gt;())
      , m_currentNode(&amp;fragment)
      , m_scriptStartPosition(TextPosition::belowRangePosition())
      , m_parsingFragment(true)
<span class="udiff-line-added">+     , m_prefixToNamespaceMap(WTFMove(prefixToNamespaceMap))</span>
<span class="udiff-line-added">+     , m_defaultNamespaceURI(defaultNamespaceURI)</span>
  {
      fragment.ref();
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     // Add namespaces based on the parent node</span>
<span class="udiff-line-removed">-     Vector&lt;Element*&gt; elemStack;</span>
<span class="udiff-line-removed">-     while (parentElement) {</span>
<span class="udiff-line-removed">-         elemStack.append(parentElement);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         ContainerNode* node = parentElement-&gt;parentNode();</span>
<span class="udiff-line-removed">-         if (!is&lt;Element&gt;(node))</span>
<span class="udiff-line-removed">-             break;</span>
<span class="udiff-line-removed">-         parentElement = downcast&lt;Element&gt;(node);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if (elemStack.isEmpty())</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     // FIXME: Share code with isDefaultNamespace() per http://www.whatwg.org/specs/web-apps/current-work/multipage/the-xhtml-syntax.html#parsing-xhtml-fragments</span>
<span class="udiff-line-removed">-     for (; !elemStack.isEmpty(); elemStack.removeLast()) {</span>
<span class="udiff-line-removed">-         Element* element = elemStack.last();</span>
<span class="udiff-line-removed">-         if (element-&gt;hasAttributes()) {</span>
<span class="udiff-line-removed">-             for (const Attribute&amp; attribute : element-&gt;attributesIterator()) {</span>
<span class="udiff-line-removed">-                 if (attribute.localName() == xmlnsAtom())</span>
<span class="udiff-line-removed">-                     m_defaultNamespaceURI = attribute.value();</span>
<span class="udiff-line-removed">-                 else if (attribute.prefix() == xmlnsAtom())</span>
<span class="udiff-line-removed">-                     m_prefixToNamespaceMap.set(attribute.localName(), attribute.value());</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if (m_defaultNamespaceURI.isNull())</span>
<span class="udiff-line-removed">-         m_defaultNamespaceURI = parentElement-&gt;namespaceURI();</span>
  }
  
  XMLParserContext::~XMLParserContext()
  {
      if (m_context-&gt;myDoc)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -767,10 +740,12 @@</span>
      AtomString prefix = toAtomString(xmlPrefix);
  
      if (m_parsingFragment &amp;&amp; uri.isNull()) {
          if (!prefix.isNull())
              uri = m_prefixToNamespaceMap.get(prefix);
<span class="udiff-line-added">+         else if (is&lt;SVGElement&gt;(m_currentNode) || localName == SVGNames::svgTag-&gt;localName())</span>
<span class="udiff-line-added">+             uri = SVGNames::svgNamespaceURI;</span>
          else
              uri = m_defaultNamespaceURI;
      }
  
      // If libxml entity parsing is broken, transfer the currentNodes&#39; namespaceURI to the new node,
</pre>
<center><a href="XMLDocumentParser.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../WebKitLegacy/CMakeLists.txt.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>