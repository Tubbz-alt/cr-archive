<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/dom/RejectedPromiseTracker.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Range.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RejectedPromiseTracker.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/dom/RejectedPromiseTracker.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 83,36 ***</span>
  {
  }
  
  RejectedPromiseTracker::~RejectedPromiseTracker() = default;
  
<span class="line-modified">! static RefPtr&lt;ScriptCallStack&gt; createScriptCallStackFromReason(ExecState&amp; state, JSValue reason)</span>
  {
<span class="line-modified">!     VM&amp; vm = state.vm();</span>
  
      // Always capture a stack from the exception if this rejection was an exception.
      if (auto* exception = vm.lastException()) {
          if (exception-&gt;value() == reason)
<span class="line-modified">!             return createScriptCallStackFromException(&amp;state, exception);</span>
      }
  
      // Otherwise, only capture a stack if a debugger is open.
<span class="line-modified">!     if (state.lexicalGlobalObject()-&gt;debugger())</span>
<span class="line-modified">!         return createScriptCallStack(&amp;state);</span>
  
      return nullptr;
  }
  
<span class="line-modified">! void RejectedPromiseTracker::promiseRejected(ExecState&amp; state, JSDOMGlobalObject&amp; globalObject, JSPromise&amp; promise)</span>
  {
      // https://html.spec.whatwg.org/multipage/webappapis.html#the-hostpromiserejectiontracker-implementation
  
<span class="line-modified">!     JSValue reason = promise.result(state.vm());</span>
<span class="line-modified">!     m_aboutToBeNotifiedRejectedPromises.append(UnhandledPromise { globalObject, promise, createScriptCallStackFromReason(state, reason) });</span>
  }
  
<span class="line-modified">! void RejectedPromiseTracker::promiseHandled(ExecState&amp;, JSDOMGlobalObject&amp; globalObject, JSPromise&amp; promise)</span>
  {
      // https://html.spec.whatwg.org/multipage/webappapis.html#the-hostpromiserejectiontracker-implementation
  
      bool removed = m_aboutToBeNotifiedRejectedPromises.removeFirstMatching([&amp;] (UnhandledPromise&amp; unhandledPromise) {
          auto&amp; domPromise = unhandledPromise.promise();
<span class="line-new-header">--- 83,36 ---</span>
  {
  }
  
  RejectedPromiseTracker::~RejectedPromiseTracker() = default;
  
<span class="line-modified">! static RefPtr&lt;ScriptCallStack&gt; createScriptCallStackFromReason(JSGlobalObject&amp; lexicalGlobalObject, JSValue reason)</span>
  {
<span class="line-modified">!     VM&amp; vm = lexicalGlobalObject.vm();</span>
  
      // Always capture a stack from the exception if this rejection was an exception.
      if (auto* exception = vm.lastException()) {
          if (exception-&gt;value() == reason)
<span class="line-modified">!             return createScriptCallStackFromException(&amp;lexicalGlobalObject, exception);</span>
      }
  
      // Otherwise, only capture a stack if a debugger is open.
<span class="line-modified">!     if (lexicalGlobalObject.debugger())</span>
<span class="line-modified">!         return createScriptCallStack(&amp;lexicalGlobalObject);</span>
  
      return nullptr;
  }
  
<span class="line-modified">! void RejectedPromiseTracker::promiseRejected(JSDOMGlobalObject&amp; globalObject, JSPromise&amp; promise)</span>
  {
      // https://html.spec.whatwg.org/multipage/webappapis.html#the-hostpromiserejectiontracker-implementation
  
<span class="line-modified">!     JSValue reason = promise.result(globalObject.vm());</span>
<span class="line-modified">!     m_aboutToBeNotifiedRejectedPromises.append(UnhandledPromise { globalObject, promise, createScriptCallStackFromReason(globalObject, reason) });</span>
  }
  
<span class="line-modified">! void RejectedPromiseTracker::promiseHandled(JSDOMGlobalObject&amp; globalObject, JSPromise&amp; promise)</span>
  {
      // https://html.spec.whatwg.org/multipage/webappapis.html#the-hostpromiserejectiontracker-implementation
  
      bool removed = m_aboutToBeNotifiedRejectedPromises.removeFirstMatching([&amp;] (UnhandledPromise&amp; unhandledPromise) {
          auto&amp; domPromise = unhandledPromise.promise();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 153,11 ***</span>
  
      for (auto&amp; unhandledPromise : unhandledPromises) {
          auto&amp; domPromise = unhandledPromise.promise();
          if (domPromise.isSuspended())
              continue;
<span class="line-modified">!         auto&amp; state = *domPromise.globalObject()-&gt;globalExec();</span>
          auto&amp; promise = *domPromise.promise();
  
          if (promise.isHandled(vm))
              continue;
  
<span class="line-new-header">--- 153,11 ---</span>
  
      for (auto&amp; unhandledPromise : unhandledPromises) {
          auto&amp; domPromise = unhandledPromise.promise();
          if (domPromise.isSuspended())
              continue;
<span class="line-modified">!         auto&amp; lexicalGlobalObject = *domPromise.globalObject();</span>
          auto&amp; promise = *domPromise.promise();
  
          if (promise.isHandled(vm))
              continue;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 169,11 ***</span>
          auto event = PromiseRejectionEvent::create(eventNames().unhandledrejectionEvent, initializer);
          auto target = m_context.errorEventTarget();
          target-&gt;dispatchEvent(event);
  
          if (!event-&gt;defaultPrevented())
<span class="line-modified">!             m_context.reportUnhandledPromiseRejection(state, promise, unhandledPromise.callStack());</span>
  
          if (!promise.isHandled(vm))
              m_outstandingRejectedPromises.set(&amp;promise, &amp;promise);
      }
  }
<span class="line-new-header">--- 169,11 ---</span>
          auto event = PromiseRejectionEvent::create(eventNames().unhandledrejectionEvent, initializer);
          auto target = m_context.errorEventTarget();
          target-&gt;dispatchEvent(event);
  
          if (!event-&gt;defaultPrevented())
<span class="line-modified">!             m_context.reportUnhandledPromiseRejection(lexicalGlobalObject, promise, unhandledPromise.callStack());</span>
  
          if (!promise.isHandled(vm))
              m_outstandingRejectedPromises.set(&amp;promise, &amp;promise);
      }
  }
</pre>
<center><a href="Range.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RejectedPromiseTracker.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>