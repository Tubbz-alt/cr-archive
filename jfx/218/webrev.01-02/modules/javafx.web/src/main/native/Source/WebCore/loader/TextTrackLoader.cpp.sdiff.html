<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/loader/TextTrackLoader.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TextResourceDecoder.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="appcache/ApplicationCache.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/loader/TextTrackLoader.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
135             m_state = m_resource-&gt;errorOccurred() ? Failed : Finished;
136     }
137 
138     if (m_state == Finished &amp;&amp; m_cueParser)
139         m_cueParser-&gt;flush();
140 
141     if (!m_cueLoadTimer.isActive())
142         m_cueLoadTimer.startOneShot(0_s);
143 
144     cancelLoad();
145 }
146 
147 bool TextTrackLoader::load(const URL&amp; url, HTMLTrackElement&amp; element)
148 {
149     cancelLoad();
150 
151     ASSERT(is&lt;Document&gt;(m_scriptExecutionContext));
152     Document&amp; document = downcast&lt;Document&gt;(*m_scriptExecutionContext);
153 
154     ResourceLoaderOptions options = CachedResourceLoader::defaultCachedResourceOptions();

155     options.contentSecurityPolicyImposition = element.isInUserAgentShadowTree() ? ContentSecurityPolicyImposition::SkipPolicyCheck : ContentSecurityPolicyImposition::DoPolicyCheck;
156 
157     ResourceRequest resourceRequest(document.completeURL(url));
158 
159     if (auto mediaElement = element.mediaElement())
160         resourceRequest.setInspectorInitiatorNodeIdentifier(InspectorInstrumentation::identifierForNode(*mediaElement));
161 
<span class="line-modified">162     auto cueRequest = createPotentialAccessControlRequest(WTFMove(resourceRequest), document, element.mediaElementCrossOriginAttribute(), WTFMove(options));</span>
163     m_resource = document.cachedResourceLoader().requestTextTrack(WTFMove(cueRequest)).value_or(nullptr);
164     if (!m_resource)
165         return false;
166     m_resource-&gt;addClient(*this);
167     return true;
168 }
169 
170 void TextTrackLoader::newCuesParsed()
171 {
172     if (m_cueLoadTimer.isActive())
173         return;
174 
175     m_newCuesAvailable = true;
176     m_cueLoadTimer.startOneShot(0_s);
177 }
178 
179 void TextTrackLoader::newRegionsParsed()
180 {
181     m_client.newRegionsAvailable(*this);
182 }
</pre>
</td>
<td>
<hr />
<pre>
135             m_state = m_resource-&gt;errorOccurred() ? Failed : Finished;
136     }
137 
138     if (m_state == Finished &amp;&amp; m_cueParser)
139         m_cueParser-&gt;flush();
140 
141     if (!m_cueLoadTimer.isActive())
142         m_cueLoadTimer.startOneShot(0_s);
143 
144     cancelLoad();
145 }
146 
147 bool TextTrackLoader::load(const URL&amp; url, HTMLTrackElement&amp; element)
148 {
149     cancelLoad();
150 
151     ASSERT(is&lt;Document&gt;(m_scriptExecutionContext));
152     Document&amp; document = downcast&lt;Document&gt;(*m_scriptExecutionContext);
153 
154     ResourceLoaderOptions options = CachedResourceLoader::defaultCachedResourceOptions();
<span class="line-added">155     options.sameOriginDataURLFlag = SameOriginDataURLFlag::Set;</span>
156     options.contentSecurityPolicyImposition = element.isInUserAgentShadowTree() ? ContentSecurityPolicyImposition::SkipPolicyCheck : ContentSecurityPolicyImposition::DoPolicyCheck;
157 
158     ResourceRequest resourceRequest(document.completeURL(url));
159 
160     if (auto mediaElement = element.mediaElement())
161         resourceRequest.setInspectorInitiatorNodeIdentifier(InspectorInstrumentation::identifierForNode(*mediaElement));
162 
<span class="line-modified">163     auto cueRequest = createPotentialAccessControlRequest(WTFMove(resourceRequest), WTFMove(options), document, element.mediaElementCrossOriginAttribute(), SameOriginFlag::Yes);</span>
164     m_resource = document.cachedResourceLoader().requestTextTrack(WTFMove(cueRequest)).value_or(nullptr);
165     if (!m_resource)
166         return false;
167     m_resource-&gt;addClient(*this);
168     return true;
169 }
170 
171 void TextTrackLoader::newCuesParsed()
172 {
173     if (m_cueLoadTimer.isActive())
174         return;
175 
176     m_newCuesAvailable = true;
177     m_cueLoadTimer.startOneShot(0_s);
178 }
179 
180 void TextTrackLoader::newRegionsParsed()
181 {
182     m_client.newRegionsAvailable(*this);
183 }
</pre>
</td>
</tr>
</table>
<center><a href="TextResourceDecoder.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="appcache/ApplicationCache.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>