<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/Pasteboard.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Pasteboard.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PasteboardItemInfo.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/Pasteboard.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 24,10 ***</span>
<span class="line-new-header">--- 24,11 ---</span>
   */
  
  #pragma once
  
  #include &quot;DragImage.h&quot;
<span class="line-added">+ #include &quot;PasteboardCustomData.h&quot;</span>
  #include &quot;PasteboardItemInfo.h&quot;
  #include &lt;wtf/HashMap.h&gt;
  #include &lt;wtf/ListHashSet.h&gt;
  #include &lt;wtf/Noncopyable.h&gt;
  #include &lt;wtf/URL.h&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 66,11 ***</span>
  class PasteboardStrategy;
  class Range;
  class SelectionData;
  class SharedBuffer;
  
<span class="line-modified">! enum class WebContentReadingPolicy { AnyType, OnlyRichTextTypes };</span>
  enum ShouldSerializeSelectedTextForDataTransfer { DefaultSelectedTextType, IncludeImageAltTextForDataTransfer };
  
  // For writing to the pasteboard. Generally sorted with the richest formats on top.
  
  struct PasteboardWebContent {
<span class="line-new-header">--- 67,12 ---</span>
  class PasteboardStrategy;
  class Range;
  class SelectionData;
  class SharedBuffer;
  
<span class="line-modified">! enum class PlainTextURLReadingPolicy : bool { IgnoreURL, AllowURL };</span>
<span class="line-added">+ enum class WebContentReadingPolicy : bool { AnyType, OnlyRichTextTypes };</span>
  enum ShouldSerializeSelectedTextForDataTransfer { DefaultSelectedTextType, IncludeImageAltTextForDataTransfer };
  
  // For writing to the pasteboard. Generally sorted with the richest formats on top.
  
  struct PasteboardWebContent {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 146,12 ***</span>
      virtual bool readRTFD(SharedBuffer&amp;) = 0;
      virtual bool readRTF(SharedBuffer&amp;) = 0;
      virtual bool readImage(Ref&lt;SharedBuffer&gt;&amp;&amp;, const String&amp; type, PresentationSize preferredPresentationSize = { }) = 0;
      virtual bool readURL(const URL&amp;, const String&amp; title) = 0;
      virtual bool readDataBuffer(SharedBuffer&amp;, const String&amp; type, const String&amp; name, PresentationSize preferredPresentationSize = { }) = 0;
<span class="line-removed">- #endif</span>
      virtual bool readPlainText(const String&amp;) = 0;
  };
  
  struct PasteboardPlainText {
      String text;
  #if PLATFORM(COCOA)
<span class="line-new-header">--- 148,12 ---</span>
      virtual bool readRTFD(SharedBuffer&amp;) = 0;
      virtual bool readRTF(SharedBuffer&amp;) = 0;
      virtual bool readImage(Ref&lt;SharedBuffer&gt;&amp;&amp;, const String&amp; type, PresentationSize preferredPresentationSize = { }) = 0;
      virtual bool readURL(const URL&amp;, const String&amp; title) = 0;
      virtual bool readDataBuffer(SharedBuffer&amp;, const String&amp; type, const String&amp; name, PresentationSize preferredPresentationSize = { }) = 0;
      virtual bool readPlainText(const String&amp;) = 0;
<span class="line-added">+ #endif</span>
  };
  
  struct PasteboardPlainText {
      String text;
  #if PLATFORM(COCOA)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 163,25 ***</span>
      virtual ~PasteboardFileReader() = default;
      virtual void readFilename(const String&amp;) = 0;
      virtual void readBuffer(const String&amp; filename, const String&amp; type, Ref&lt;SharedBuffer&gt;&amp;&amp;) = 0;
  };
  
<span class="line-removed">- // FIXME: We need to ensure that the contents of sameOriginCustomData are not accessible across different origins.</span>
<span class="line-removed">- struct PasteboardCustomData {</span>
<span class="line-removed">-     String origin;</span>
<span class="line-removed">-     Vector&lt;String&gt; orderedTypes;</span>
<span class="line-removed">-     HashMap&lt;String, String&gt; platformData;</span>
<span class="line-removed">-     HashMap&lt;String, String&gt; sameOriginCustomData;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     WEBCORE_EXPORT Ref&lt;SharedBuffer&gt; createSharedBuffer() const;</span>
<span class="line-removed">-     WEBCORE_EXPORT static PasteboardCustomData fromSharedBuffer(const SharedBuffer&amp;);</span>
<span class="line-removed">- </span>
<span class="line-removed">- #if PLATFORM(COCOA)</span>
<span class="line-removed">-     WEBCORE_EXPORT static const char* cocoaType();</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">- };</span>
<span class="line-removed">- </span>
  class Pasteboard {
      WTF_MAKE_NONCOPYABLE(Pasteboard); WTF_MAKE_FAST_ALLOCATED;
  public:
      Pasteboard();
      virtual ~Pasteboard();
<span class="line-new-header">--- 165,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 214,21 ***</span>
  
      virtual WEBCORE_EXPORT void writeString(const String&amp; type, const String&amp; data);
      virtual WEBCORE_EXPORT void clear();
      virtual WEBCORE_EXPORT void clear(const String&amp; type);
  
<span class="line-modified">!     virtual WEBCORE_EXPORT void read(PasteboardPlainText&amp;);</span>
<span class="line-modified">!     virtual WEBCORE_EXPORT void read(PasteboardWebContentReader&amp;, WebContentReadingPolicy = WebContentReadingPolicy::AnyType);</span>
      virtual WEBCORE_EXPORT void read(PasteboardFileReader&amp;);
  
      virtual WEBCORE_EXPORT void write(const Color&amp;);
      virtual WEBCORE_EXPORT void write(const PasteboardURL&amp;);
      virtual WEBCORE_EXPORT void writeTrustworthyWebURLsPboardType(const PasteboardURL&amp;);
      virtual WEBCORE_EXPORT void write(const PasteboardImage&amp;);
      virtual WEBCORE_EXPORT void write(const PasteboardWebContent&amp;);
  
<span class="line-modified">!     virtual WEBCORE_EXPORT void writeCustomData(const PasteboardCustomData&amp;);</span>
  
      enum class FileContentState { NoFileOrImageData, InMemoryImage, MayContainFilePaths };
      virtual WEBCORE_EXPORT FileContentState fileContentState();
      virtual WEBCORE_EXPORT bool canSmartReplace();
  
<span class="line-new-header">--- 201,21 ---</span>
  
      virtual WEBCORE_EXPORT void writeString(const String&amp; type, const String&amp; data);
      virtual WEBCORE_EXPORT void clear();
      virtual WEBCORE_EXPORT void clear(const String&amp; type);
  
<span class="line-modified">!     virtual WEBCORE_EXPORT void read(PasteboardPlainText&amp;, PlainTextURLReadingPolicy = PlainTextURLReadingPolicy::AllowURL, Optional&lt;size_t&gt; itemIndex = WTF::nullopt);</span>
<span class="line-modified">!     virtual WEBCORE_EXPORT void read(PasteboardWebContentReader&amp;, WebContentReadingPolicy = WebContentReadingPolicy::AnyType, Optional&lt;size_t&gt; itemIndex = WTF::nullopt);</span>
      virtual WEBCORE_EXPORT void read(PasteboardFileReader&amp;);
  
      virtual WEBCORE_EXPORT void write(const Color&amp;);
      virtual WEBCORE_EXPORT void write(const PasteboardURL&amp;);
      virtual WEBCORE_EXPORT void writeTrustworthyWebURLsPboardType(const PasteboardURL&amp;);
      virtual WEBCORE_EXPORT void write(const PasteboardImage&amp;);
      virtual WEBCORE_EXPORT void write(const PasteboardWebContent&amp;);
  
<span class="line-modified">!     virtual WEBCORE_EXPORT void writeCustomData(const Vector&lt;PasteboardCustomData&gt;&amp;);</span>
  
      enum class FileContentState { NoFileOrImageData, InMemoryImage, MayContainFilePaths };
      virtual WEBCORE_EXPORT FileContentState fileContentState();
      virtual WEBCORE_EXPORT bool canSmartReplace();
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 257,11 ***</span>
      const SelectionData&amp; selectionData() const;
      static std::unique_ptr&lt;Pasteboard&gt; createForGlobalSelection();
  #endif
  
  #if PLATFORM(IOS_FAMILY)
<span class="line-modified">!     explicit Pasteboard(long changeCount);</span>
      explicit Pasteboard(const String&amp; pasteboardName);
  
      static NSArray *supportedWebContentPasteboardTypes();
      static String resourceMIMEType(NSString *mimeType);
  #endif
<span class="line-new-header">--- 244,11 ---</span>
      const SelectionData&amp; selectionData() const;
      static std::unique_ptr&lt;Pasteboard&gt; createForGlobalSelection();
  #endif
  
  #if PLATFORM(IOS_FAMILY)
<span class="line-modified">!     explicit Pasteboard(int64_t changeCount);</span>
      explicit Pasteboard(const String&amp; pasteboardName);
  
      static NSArray *supportedWebContentPasteboardTypes();
      static String resourceMIMEType(NSString *mimeType);
  #endif
</pre>
<hr />
<pre>
<span class="line-old-header">*** 271,13 ***</span>
  #endif
  
  #if PLATFORM(COCOA)
      static bool shouldTreatCocoaTypeAsFile(const String&amp;);
      WEBCORE_EXPORT static NSArray *supportedFileUploadPasteboardTypes();
<span class="line-modified">!     const String&amp; name() const { return m_pasteboardName; }</span>
<span class="line-removed">-     long changeCount() const;</span>
      const PasteboardCustomData&amp; readCustomData();
  #endif
  
  #if PLATFORM(WIN)
      COMPtr&lt;IDataObject&gt; dataObject() const { return m_dataObject; }
      void setExternalDataObject(IDataObject*);
<span class="line-new-header">--- 258,20 ---</span>
  #endif
  
  #if PLATFORM(COCOA)
      static bool shouldTreatCocoaTypeAsFile(const String&amp;);
      WEBCORE_EXPORT static NSArray *supportedFileUploadPasteboardTypes();
<span class="line-modified">!     int64_t changeCount() const;</span>
      const PasteboardCustomData&amp; readCustomData();
<span class="line-added">+ #else</span>
<span class="line-added">+     int64_t changeCount() const { return 0; }</span>
<span class="line-added">+ #endif</span>
<span class="line-added">+ </span>
<span class="line-added">+ #if PLATFORM(COCOA)</span>
<span class="line-added">+     const String&amp; name() const { return m_pasteboardName; }</span>
<span class="line-added">+ #else</span>
<span class="line-added">+     const String&amp; name() const { return emptyString(); }</span>
  #endif
  
  #if PLATFORM(WIN)
      COMPtr&lt;IDataObject&gt; dataObject() const { return m_dataObject; }
      void setExternalDataObject(IDataObject*);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 285,14 ***</span>
      void writeURLToWritableDataObject(const URL&amp;, const String&amp;);
      COMPtr&lt;WCDataObject&gt; writableDataObject() const { return m_writableDataObject; }
      void writeImageToDataObject(Element&amp;, const URL&amp;); // FIXME: Layering violation.
  #endif
  
  private:
  #if PLATFORM(IOS_FAMILY)
      bool respectsUTIFidelities() const;
<span class="line-modified">!     void readRespectingUTIFidelities(PasteboardWebContentReader&amp;, WebContentReadingPolicy);</span>
  
      enum class ReaderResult {
          ReadType,
          DidNotReadType,
          PasteboardWasChangedExternally
<span class="line-new-header">--- 279,21 ---</span>
      void writeURLToWritableDataObject(const URL&amp;, const String&amp;);
      COMPtr&lt;WCDataObject&gt; writableDataObject() const { return m_writableDataObject; }
      void writeImageToDataObject(Element&amp;, const URL&amp;); // FIXME: Layering violation.
  #endif
  
<span class="line-added">+     Optional&lt;Vector&lt;PasteboardItemInfo&gt;&gt; allPasteboardItemInfo() const;</span>
<span class="line-added">+     Optional&lt;PasteboardItemInfo&gt; pasteboardItemInfo(size_t index) const;</span>
<span class="line-added">+ </span>
<span class="line-added">+     String readString(size_t index, const String&amp; type);</span>
<span class="line-added">+     RefPtr&lt;WebCore::SharedBuffer&gt; readBuffer(size_t index, const String&amp; type);</span>
<span class="line-added">+     URL readURL(size_t index, String&amp; title);</span>
<span class="line-added">+ </span>
  private:
  #if PLATFORM(IOS_FAMILY)
      bool respectsUTIFidelities() const;
<span class="line-modified">!     void readRespectingUTIFidelities(PasteboardWebContentReader&amp;, WebContentReadingPolicy, Optional&lt;size_t&gt;);</span>
  
      enum class ReaderResult {
          ReadType,
          DidNotReadType,
          PasteboardWasChangedExternally
</pre>
<hr />
<pre>
<span class="line-old-header">*** 312,11 ***</span>
      static std::unique_ptr&lt;Pasteboard&gt; create(RefPtr&lt;DataObjectJava&gt;);
  #endif
  
  #if PLATFORM(COCOA)
      Vector&lt;String&gt; readFilePaths();
<span class="line-modified">!     Vector&lt;String&gt; readPlatformValuesAsStrings(const String&amp; domType, long changeCount, const String&amp; pasteboardName);</span>
      static void addHTMLClipboardTypesForCocoaType(ListHashSet&lt;String&gt;&amp; resultTypes, const String&amp; cocoaType);
      String readStringForPlatformType(const String&amp;);
      Vector&lt;String&gt; readTypesWithSecurityCheck();
      RefPtr&lt;SharedBuffer&gt; readBufferForTypeWithSecurityCheck(const String&amp;);
  #endif
<span class="line-new-header">--- 313,11 ---</span>
      static std::unique_ptr&lt;Pasteboard&gt; create(RefPtr&lt;DataObjectJava&gt;);
  #endif
  
  #if PLATFORM(COCOA)
      Vector&lt;String&gt; readFilePaths();
<span class="line-modified">!     Vector&lt;String&gt; readPlatformValuesAsStrings(const String&amp; domType, int64_t changeCount, const String&amp; pasteboardName);</span>
      static void addHTMLClipboardTypesForCocoaType(ListHashSet&lt;String&gt;&amp; resultTypes, const String&amp; cocoaType);
      String readStringForPlatformType(const String&amp;);
      Vector&lt;String&gt; readTypesWithSecurityCheck();
      RefPtr&lt;SharedBuffer&gt; readBufferForTypeWithSecurityCheck(const String&amp;);
  #endif
</pre>
<hr />
<pre>
<span class="line-old-header">*** 328,11 ***</span>
      String m_name;
  #endif
  
  #if PLATFORM(COCOA)
      String m_pasteboardName;
<span class="line-modified">!     long m_changeCount;</span>
      Optional&lt;PasteboardCustomData&gt; m_customDataCache;
  #endif
  
  #if PLATFORM(MAC)
      Vector&lt;String&gt; m_promisedFilePaths;
<span class="line-new-header">--- 329,11 ---</span>
      String m_name;
  #endif
  
  #if PLATFORM(COCOA)
      String m_pasteboardName;
<span class="line-modified">!     int64_t m_changeCount;</span>
      Optional&lt;PasteboardCustomData&gt; m_customDataCache;
  #endif
  
  #if PLATFORM(MAC)
      Vector&lt;String&gt; m_promisedFilePaths;
</pre>
<center><a href="Pasteboard.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PasteboardItemInfo.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>