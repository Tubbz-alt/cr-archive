<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/bmalloc/bmalloc/Chunk.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Cache.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CryptoRandom.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/bmalloc/bmalloc/Chunk.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 36,10 ***</span>
<span class="line-new-header">--- 36,11 ---</span>
  namespace bmalloc {
  
  class Chunk : public ListNode&lt;Chunk&gt; {
  public:
      static Chunk* get(void*);
<span class="line-added">+     static size_t metadataSize(size_t pageSize);</span>
  
      Chunk(size_t pageSize);
  
      void ref() { ++m_refCount; }
      void deref() { BASSERT(m_refCount); --m_refCount; }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 71,17 ***</span>
          return static_cast&lt;unsigned&gt;(
              reinterpret_cast&lt;uintptr_t&gt;(key) / chunkSize);
      }
  };
  
<span class="line-modified">! template&lt;typename Function&gt; void forEachPage(Chunk* chunk, size_t pageSize, Function function)</span>
  {
      // We align to at least the page size so we can service aligned allocations
      // at equal and smaller powers of two, and also so we can vmDeallocatePhysicalPages().
<span class="line-modified">!     size_t metadataSize = roundUpToMultipleOfNonPowerOfTwo(pageSize, sizeof(Chunk));</span>
  
<span class="line-modified">!     Object begin(chunk, metadataSize);</span>
      Object end(chunk, chunkSize);
  
      for (auto it = begin; it + pageSize &lt;= end; it = it + pageSize)
          function(it.page());
  }
<span class="line-new-header">--- 72,20 ---</span>
          return static_cast&lt;unsigned&gt;(
              reinterpret_cast&lt;uintptr_t&gt;(key) / chunkSize);
      }
  };
  
<span class="line-modified">! inline size_t Chunk::metadataSize(size_t pageSize)</span>
  {
      // We align to at least the page size so we can service aligned allocations
      // at equal and smaller powers of two, and also so we can vmDeallocatePhysicalPages().
<span class="line-modified">!     return roundUpToMultipleOfNonPowerOfTwo(pageSize, sizeof(Chunk));</span>
<span class="line-added">+ }</span>
  
<span class="line-modified">! template&lt;typename Function&gt; void forEachPage(Chunk* chunk, size_t pageSize, Function function)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     Object begin(chunk, Chunk::metadataSize(pageSize));</span>
      Object end(chunk, chunkSize);
  
      for (auto it = begin; it + pageSize &lt;= end; it = it + pageSize)
          function(it.page());
  }
</pre>
<center><a href="Cache.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CryptoRandom.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>