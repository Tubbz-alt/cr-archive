<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/Modules/mediastream/libwebrtc/LibWebRTCRtpTransceiverBackend.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="LibWebRTCRtpSenderBackend.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="LibWebRTCRtpTransceiverBackend.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/mediastream/libwebrtc/LibWebRTCRtpTransceiverBackend.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -25,13 +25,15 @@</span>
  #include &quot;config.h&quot;
  #include &quot;LibWebRTCRtpTransceiverBackend.h&quot;
  
  #if ENABLE(WEB_RTC) &amp;&amp; USE(LIBWEBRTC)
  
<span class="udiff-line-added">+ #include &quot;JSDOMPromiseDeferred.h&quot;</span>
  #include &quot;LibWebRTCRtpReceiverBackend.h&quot;
  #include &quot;LibWebRTCRtpSenderBackend.h&quot;
  #include &quot;LibWebRTCUtils.h&quot;
<span class="udiff-line-added">+ #include &quot;RTCRtpCodecCapability.h&quot;</span>
  
  namespace WebCore {
  
  std::unique_ptr&lt;LibWebRTCRtpReceiverBackend&gt; LibWebRTCRtpTransceiverBackend::createReceiverBackend()
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -76,8 +78,48 @@</span>
  bool LibWebRTCRtpTransceiverBackend::stopped() const
  {
      return m_rtcTransceiver-&gt;stopped();
  }
  
<span class="udiff-line-added">+ static inline ExceptionOr&lt;webrtc::RtpCodecCapability&gt; toRtpCodecCapability(const RTCRtpCodecCapability&amp; codec)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     webrtc::RtpCodecCapability rtcCodec;</span>
<span class="udiff-line-added">+     if (codec.mimeType.startsWith(&quot;video/&quot;))</span>
<span class="udiff-line-added">+         rtcCodec.kind = cricket::MEDIA_TYPE_VIDEO;</span>
<span class="udiff-line-added">+     else if (codec.mimeType.startsWith(&quot;audio/&quot;))</span>
<span class="udiff-line-added">+         rtcCodec.kind = cricket::MEDIA_TYPE_AUDIO;</span>
<span class="udiff-line-added">+     else</span>
<span class="udiff-line-added">+         return Exception { InvalidModificationError, &quot;RTCRtpCodecCapability bad mimeType&quot; };</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     rtcCodec.name = codec.mimeType.substring(6).utf8().data();</span>
<span class="udiff-line-added">+     rtcCodec.clock_rate = codec.clockRate;</span>
<span class="udiff-line-added">+     if (codec.channels)</span>
<span class="udiff-line-added">+         rtcCodec.num_channels = *codec.channels;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     for (auto parameter : StringView(codec.sdpFmtpLine).split(&#39;;&#39;)) {</span>
<span class="udiff-line-added">+         auto position = parameter.find(&#39;=&#39;);</span>
<span class="udiff-line-added">+         if (position == notFound)</span>
<span class="udiff-line-added">+             return Exception { InvalidModificationError, &quot;RTCRtpCodecCapability sdpFmtLine badly formated&quot; };</span>
<span class="udiff-line-added">+         rtcCodec.parameters.emplace(parameter.substring(0, position).utf8().data(), parameter.substring(position + 1).utf8().data());</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return rtcCodec;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ExceptionOr&lt;void&gt; LibWebRTCRtpTransceiverBackend::setCodecPreferences(const Vector&lt;RTCRtpCodecCapability&gt;&amp; codecs)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     std::vector&lt;webrtc::RtpCodecCapability&gt; rtcCodecs;</span>
<span class="udiff-line-added">+     for (auto&amp; codec : codecs) {</span>
<span class="udiff-line-added">+         auto result = toRtpCodecCapability(codec);</span>
<span class="udiff-line-added">+         if (result.hasException())</span>
<span class="udiff-line-added">+             return result.releaseException();</span>
<span class="udiff-line-added">+         rtcCodecs.push_back(result.releaseReturnValue());</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     auto result = m_rtcTransceiver-&gt;SetCodecPreferences(rtcCodecs);</span>
<span class="udiff-line-added">+     if (!result.ok())</span>
<span class="udiff-line-added">+         return toException(result);</span>
<span class="udiff-line-added">+     return { };</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  } // namespace WebCore
  
  #endif // ENABLE(WEB_RTC) &amp;&amp; USE(LIBWEBRTC)
</pre>
<center><a href="LibWebRTCRtpSenderBackend.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="LibWebRTCRtpTransceiverBackend.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>