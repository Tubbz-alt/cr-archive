<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/Modules/mediastream/libwebrtc/LibWebRTCPeerConnectionBackend.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2017-2018 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1.  Redistributions of source code must retain the above copyright
  8  *     notice, this list of conditions and the following disclaimer.
  9  * 2.  Redistributions in binary form must reproduce the above copyright
 10  *     notice, this list of conditions and the following disclaimer in the
 11  *     documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 15  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 16  * DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 17  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 18  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 19  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 20  * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 21  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 22  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 23  */
 24 
 25 #pragma once
 26 
 27 #if USE(LIBWEBRTC)
 28 
 29 #include &quot;PeerConnectionBackend.h&quot;
 30 #include &lt;wtf/HashMap.h&gt;
 31 
 32 namespace webrtc {
 33 class IceCandidateInterface;
 34 }
 35 
 36 namespace WebCore {
 37 
 38 class LibWebRTCMediaEndpoint;
 39 class LibWebRTCProvider;
 40 class LibWebRTCRtpSenderBackend;
 41 class LibWebRTCRtpTransceiverBackend;
 42 class RTCRtpReceiver;
 43 class RTCRtpReceiverBackend;
 44 class RTCSessionDescription;
 45 class RTCStatsReport;
 46 class RealtimeIncomingAudioSource;
 47 class RealtimeIncomingVideoSource;
 48 class RealtimeMediaSource;
 49 class RealtimeOutgoingAudioSource;
 50 class RealtimeOutgoingVideoSource;
 51 
 52 class LibWebRTCPeerConnectionBackend final : public PeerConnectionBackend {
 53     WTF_MAKE_FAST_ALLOCATED;
 54 public:
 55     LibWebRTCPeerConnectionBackend(RTCPeerConnection&amp;, LibWebRTCProvider&amp;);
 56     ~LibWebRTCPeerConnectionBackend();
 57 
 58     void replaceTrack(RTCRtpSender&amp;, RefPtr&lt;MediaStreamTrack&gt;&amp;&amp;, DOMPromiseDeferred&lt;void&gt;&amp;&amp;);
 59 
<a name="1" id="anc1"></a>

 60 private:
<a name="2" id="anc2"></a><span class="line-added"> 61     void close() final;</span>
 62     void doCreateOffer(RTCOfferOptions&amp;&amp;) final;
 63     void doCreateAnswer(RTCAnswerOptions&amp;&amp;) final;
 64     void doSetLocalDescription(RTCSessionDescription&amp;) final;
 65     void doSetRemoteDescription(RTCSessionDescription&amp;) final;
 66     void doAddIceCandidate(RTCIceCandidate&amp;) final;
 67     void doStop() final;
 68     std::unique_ptr&lt;RTCDataChannelHandler&gt; createDataChannelHandler(const String&amp;, const RTCDataChannelInit&amp;) final;
 69     bool setConfiguration(MediaEndpointConfiguration&amp;&amp;) final;
 70     void getStats(Ref&lt;DeferredPromise&gt;&amp;&amp;) final;
 71     void getStats(RTCRtpSender&amp;, Ref&lt;DeferredPromise&gt;&amp;&amp;) final;
 72     void getStats(RTCRtpReceiver&amp;, Ref&lt;DeferredPromise&gt;&amp;&amp;) final;
 73 
 74     RefPtr&lt;RTCSessionDescription&gt; localDescription() const final;
 75     RefPtr&lt;RTCSessionDescription&gt; currentLocalDescription() const final;
 76     RefPtr&lt;RTCSessionDescription&gt; pendingLocalDescription() const final;
 77 
 78     RefPtr&lt;RTCSessionDescription&gt; remoteDescription() const final;
 79     RefPtr&lt;RTCSessionDescription&gt; currentRemoteDescription() const final;
 80     RefPtr&lt;RTCSessionDescription&gt; pendingRemoteDescription() const final;
 81 
 82     void emulatePlatformEvent(const String&amp;) final { }
 83     void applyRotationForOutgoingVideoSources() final;
 84 
 85     friend class LibWebRTCMediaEndpoint;
 86     friend class LibWebRTCRtpSenderBackend;
 87     RTCPeerConnection&amp; connection() { return m_peerConnection; }
 88 
 89     void getStatsSucceeded(const DeferredPromise&amp;, Ref&lt;RTCStatsReport&gt;&amp;&amp;);
 90 
 91     ExceptionOr&lt;Ref&lt;RTCRtpSender&gt;&gt; addTrack(MediaStreamTrack&amp;, Vector&lt;String&gt;&amp;&amp;) final;
 92     void removeTrack(RTCRtpSender&amp;) final;
 93 
 94     ExceptionOr&lt;Ref&lt;RTCRtpTransceiver&gt;&gt; addTransceiver(const String&amp;, const RTCRtpTransceiverInit&amp;) final;
 95     ExceptionOr&lt;Ref&lt;RTCRtpTransceiver&gt;&gt; addTransceiver(Ref&lt;MediaStreamTrack&gt;&amp;&amp;, const RTCRtpTransceiverInit&amp;) final;
 96     void setSenderSourceFromTrack(LibWebRTCRtpSenderBackend&amp;, MediaStreamTrack&amp;);
 97 
 98     RTCRtpTransceiver* existingTransceiver(WTF::Function&lt;bool(LibWebRTCRtpTransceiverBackend&amp;)&gt;&amp;&amp;);
 99     RTCRtpTransceiver&amp; newRemoteTransceiver(std::unique_ptr&lt;LibWebRTCRtpTransceiverBackend&gt;&amp;&amp;, Ref&lt;RealtimeMediaSource&gt;&amp;&amp;);
100 
101     void collectTransceivers() final;
102 
103     struct VideoReceiver {
104         Ref&lt;RTCRtpReceiver&gt; receiver;
105         Ref&lt;RealtimeIncomingVideoSource&gt; source;
106     };
107     struct AudioReceiver {
108         Ref&lt;RTCRtpReceiver&gt; receiver;
109         Ref&lt;RealtimeIncomingAudioSource&gt; source;
110     };
111     VideoReceiver videoReceiver(String&amp;&amp; trackId);
112     AudioReceiver audioReceiver(String&amp;&amp; trackId);
113 
114 private:
115     bool isLocalDescriptionSet() const final { return m_isLocalDescriptionSet; }
116 
117     Ref&lt;RTCRtpTransceiver&gt; completeAddTransceiver(Ref&lt;RTCRtpSender&gt;&amp;&amp;, const RTCRtpTransceiverInit&amp;, const String&amp; trackId, const String&amp; trackKind);
118 
119     Ref&lt;RTCRtpReceiver&gt; createReceiver(const String&amp; trackKind, const String&amp; trackId);
120 
121     template&lt;typename T&gt;
<a name="3" id="anc3"></a><span class="line-modified">122     ExceptionOr&lt;Ref&lt;RTCRtpTransceiver&gt;&gt; addTransceiverFromTrackOrKind(T&amp;&amp; trackOrKind, const RTCRtpTransceiverInit&amp;);</span>
123 
124     Ref&lt;RTCRtpReceiver&gt; createReceiverForSource(Ref&lt;RealtimeMediaSource&gt;&amp;&amp;, std::unique_ptr&lt;RTCRtpReceiverBackend&gt;&amp;&amp;);
125 
<a name="4" id="anc4"></a><span class="line-added">126     void suspend() final;</span>
<span class="line-added">127     void resume() final;</span>
<span class="line-added">128 </span>
129     Ref&lt;LibWebRTCMediaEndpoint&gt; m_endpoint;
130     bool m_isLocalDescriptionSet { false };
131     bool m_isRemoteDescriptionSet { false };
132 
133     Vector&lt;std::unique_ptr&lt;webrtc::IceCandidateInterface&gt;&gt; m_pendingCandidates;
134     Vector&lt;Ref&lt;RTCRtpReceiver&gt;&gt; m_pendingReceivers;
135 };
136 
137 } // namespace WebCore
138 
139 #endif // USE(LIBWEBRTC)
<a name="5" id="anc5"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="5" type="hidden" />
</body>
</html>