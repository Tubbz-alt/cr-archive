<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/bindings/js/DOMWrapperWorld.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  *  Copyright (C) 1999-2001 Harri Porten (porten@kde.org)
 3  *  Copyright (C) 2004, 2005, 2006, 2007, 2008, 2009 Apple Inc. All rights reserved.
 4  *  Copyright (C) 2007 Samuel Weinig &lt;sam@webkit.org&gt;
 5  *
 6  *  This library is free software; you can redistribute it and/or
 7  *  modify it under the terms of the GNU Lesser General Public
 8  *  License as published by the Free Software Foundation; either
 9  *  version 2 of the License, or (at your option) any later version.
10  *
11  *  This library is distributed in the hope that it will be useful,
12  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
13  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
14  *  Lesser General Public License for more details.
15  *
16  *  You should have received a copy of the GNU Lesser General Public
17  *  License along with this library; if not, write to the Free Software
18  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
19  */
20 
21 #include &quot;config.h&quot;
22 #include &quot;DOMWrapperWorld.h&quot;
23 
24 #include &quot;CommonVM.h&quot;
25 #include &quot;JSDOMWindow.h&quot;
26 #include &quot;WebCoreJSClientData.h&quot;
27 #include &quot;WindowProxy.h&quot;
28 #include &lt;wtf/MainThread.h&gt;
29 
30 
31 namespace WebCore {
32 using namespace JSC;
33 
34 DOMWrapperWorld::DOMWrapperWorld(JSC::VM&amp; vm, Type type, const String&amp; name)
35     : m_vm(vm)
36     , m_name(name)
37     , m_type(type)
38 {
39     ASSERT(!name.isEmpty() || m_type == Type::Normal);
40 
41     VM::ClientData* clientData = m_vm.clientData;
42     ASSERT(clientData);
43     static_cast&lt;JSVMClientData*&gt;(clientData)-&gt;rememberWorld(*this);
44 }
45 
46 DOMWrapperWorld::~DOMWrapperWorld()
47 {
48     VM::ClientData* clientData = m_vm.clientData;
49     ASSERT(clientData);
50     static_cast&lt;JSVMClientData*&gt;(clientData)-&gt;forgetWorld(*this);
51 
52     // These items are created lazily.
53     while (!m_jsWindowProxies.isEmpty())
54         (*m_jsWindowProxies.begin())-&gt;destroyJSWindowProxy(*this);
55 }
56 
57 void DOMWrapperWorld::clearWrappers()
58 {
59     m_wrappers.clear();
60 
61     // These items are created lazily.
62     while (!m_jsWindowProxies.isEmpty())
63         (*m_jsWindowProxies.begin())-&gt;destroyJSWindowProxy(*this);
64 }
65 
66 DOMWrapperWorld&amp; normalWorld(JSC::VM&amp; vm)
67 {
68     VM::ClientData* clientData = vm.clientData;
69     ASSERT(clientData);
70     return static_cast&lt;JSVMClientData*&gt;(clientData)-&gt;normalWorld();
71 }
72 
73 DOMWrapperWorld&amp; mainThreadNormalWorld()
74 {
75     ASSERT(isMainThread());
76     static DOMWrapperWorld&amp; cachedNormalWorld = normalWorld(commonVM());
77     return cachedNormalWorld;
78 }
79 
80 } // namespace WebCore
    </pre>
  </body>
</html>