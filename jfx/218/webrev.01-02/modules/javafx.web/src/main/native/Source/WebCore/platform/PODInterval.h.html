<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/platform/PODInterval.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2010 Google Inc. All rights reserved.
  3  * Copyright (C) 2020 Apple Inc. All rights reserved.
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  *
  9  * 1.  Redistributions of source code must retain the above copyright
 10  *     notice, this list of conditions and the following disclaimer.
 11  * 2.  Redistributions in binary form must reproduce the above copyright
 12  *     notice, this list of conditions and the following disclaimer in the
 13  *     documentation and/or other materials provided with the distribution.
 14  *
 15  * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 16  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 17  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 18  * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 19  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 20  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 21  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 22  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 24  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 25  */
 26 
 27 #pragma once
 28 
 29 #ifndef NDEBUG
 30 #include &lt;wtf/text/TextStream.h&gt;
 31 #endif
 32 
 33 namespace WebCore {
 34 
 35 // Class template representing a closed interval which can hold arbitrary
 36 // endpoints and a piece of user data. Ordering and equality are defined
 37 // including the UserData, except in the special case of WeakPtr.
 38 //
 39 // Both the T and UserData types must support a copy constructor, operator&lt;,
 40 // operator==, and operator=, except that this does not depend on operator&lt;
 41 // or operator== for WeakPtr.
 42 //
 43 // In debug mode, printing of intervals and the data they contain is
 44 // enabled. This uses WTF::TextStream.
 45 //
 46 // Note that this class supplies a copy constructor and assignment
 47 // operator in order so it can be stored in the red-black tree.
 48 
 49 // FIXME: The prefix &quot;POD&quot; here isn&#39;t correct; this works with non-POD types.
 50 
 51 template&lt;class T, class UserData&gt; class PODIntervalBase {
 52 public:
 53     const T&amp; low() const { return m_low; }
 54     const T&amp; high() const { return m_high; }
 55     const UserData&amp; data() const { return m_data; }
 56 
 57     bool overlaps(const T&amp; low, const T&amp; high) const
 58     {
 59         return !(m_high &lt; low || high &lt; m_low);
 60     }
 61 
 62     bool overlaps(const PODIntervalBase&amp; other) const
 63     {
 64         return overlaps(other.m_low, other.m_high);
 65     }
 66 
 67     const T&amp; maxHigh() const { return m_maxHigh; }
 68     void setMaxHigh(const T&amp; maxHigh) { m_maxHigh = maxHigh; }
 69 
 70 protected:
 71     PODIntervalBase(const T&amp; low, const T&amp; high, UserData&amp;&amp; data)
 72         : m_low(low)
 73         , m_high(high)
 74         , m_data(WTFMove(data))
 75         , m_maxHigh(high)
 76     {
 77     }
 78 
 79 #if COMPILER(MSVC)
 80     // Work around an MSVC bug.
 81     PODIntervalBase(const T&amp; low, const T&amp; high, const UserData&amp; data)
 82         : m_low(low)
 83         , m_high(high)
 84         , m_data(data)
 85         , m_maxHigh(high)
 86     {
 87     }
 88 #endif
 89 
 90 private:
 91     T m_low;
 92     T m_high;
 93     UserData m_data { };
 94     T m_maxHigh;
 95 };
 96 
 97 template&lt;class T, class UserData&gt; class PODInterval : public PODIntervalBase&lt;T, UserData&gt; {
 98 public:
 99     PODInterval(const T&amp; low, const T&amp; high, UserData&amp;&amp; data = { })
100         : PODIntervalBase&lt;T, UserData&gt;(low, high, WTFMove(data))
101     {
102     }
103 
104     PODInterval(const T&amp; low, const T&amp; high, const UserData&amp; data)
105         : PODIntervalBase&lt;T, UserData&gt;(low, high, UserData { data })
106     {
107     }
108 
109     bool operator&lt;(const PODInterval&amp; other) const
110     {
111         if (Base::low() &lt; other.Base::low())
112             return true;
113         if (other.Base::low() &lt; Base::low())
114             return false;
115         if (Base::high() &lt; other.Base::high())
116             return true;
117         if (other.Base::high() &lt; Base::high())
118             return false;
119         return Base::data() &lt; other.Base::data();
120     }
121 
122     bool operator==(const PODInterval&amp; other) const
123     {
124         return Base::low() == other.Base::low()
125             &amp;&amp; Base::high() == other.Base::high()
126             &amp;&amp; Base::data() == other.Base::data();
127     }
128 
129 private:
130     using Base = PODIntervalBase&lt;T, UserData&gt;;
131 };
132 
133 template&lt;class T, class U&gt; class PODInterval&lt;T, WTF::WeakPtr&lt;U&gt;&gt; : public PODIntervalBase&lt;T, WTF::WeakPtr&lt;U&gt;&gt; {
134 public:
135     PODInterval(const T&amp; low, const T&amp; high, WTF::WeakPtr&lt;U&gt;&amp;&amp; data)
136         : PODIntervalBase&lt;T, WTF::WeakPtr&lt;U&gt;&gt;(low, high, WTFMove(data))
137     {
138     }
139 
140     bool operator&lt;(const PODInterval&amp; other) const
141     {
142         if (Base::low() &lt; other.Base::low())
143             return true;
144         if (other.Base::low() &lt; Base::low())
145             return false;
146         return Base::high() &lt; other.Base::high();
147     }
148 
149 private:
150     using Base = PODIntervalBase&lt;T, WTF::WeakPtr&lt;U&gt;&gt;;
151 };
152 
153 #ifndef NDEBUG
154 
155 template&lt;class T, class UserData&gt;
156 TextStream&amp; operator&lt;&lt;(TextStream&amp; stream, const PODInterval&lt;T, UserData&gt;&amp; interval)
157 {
158     return stream &lt;&lt; &quot;[PODInterval (&quot; &lt;&lt; interval.low() &lt;&lt; &quot;, &quot; &lt;&lt; interval.high() &lt;&lt; &quot;), data=&quot; &lt;&lt; *interval.data() &lt;&lt; &quot;, maxHigh=&quot; &lt;&lt; interval.maxHigh() &lt;&lt; &#39;]&#39;;
159 }
160 
161 #endif
162 
163 } // namespace WebCore
    </pre>
  </body>
</html>