<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/bindings/js/WindowProxy.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="WindowProxy.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="WorkerScriptController.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bindings/js/WindowProxy.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  3  *  Copyright (C) 2001 Peter Kelly (pmk@post.com)
  4  *  Copyright (C) 2006-2018 Apple Inc. All rights reserved.
  5  *
  6  *  This library is free software; you can redistribute it and/or
  7  *  modify it under the terms of the GNU Lesser General Public
  8  *  License as published by the Free Software Foundation; either
  9  *  version 2 of the License, or (at your option) any later version.
 10  *
 11  *  This library is distributed in the hope that it will be useful,
 12  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 13  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 14  *  Lesser General Public License for more details.
 15  *
 16  *  You should have received a copy of the GNU Lesser General Public
 17  *  License along with this library; if not, write to the Free Software
 18  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 19  */
 20 
 21 #pragma once
 22 
<span class="line-removed"> 23 #include &quot;DOMWrapperWorld.h&quot;</span>
 24 #include &lt;JavaScriptCore/Strong.h&gt;
 25 #include &lt;wtf/HashMap.h&gt;
 26 #include &lt;wtf/RefCounted.h&gt;

 27 
 28 namespace JSC {
 29 class Debugger;
 30 }
 31 
 32 namespace WebCore {
 33 
 34 class AbstractDOMWindow;
 35 class AbstractFrame;

 36 class JSDOMGlobalObject;
 37 class JSWindowProxy;
 38 
 39 class WindowProxy : public RefCounted&lt;WindowProxy&gt; {
 40     WTF_MAKE_FAST_ALLOCATED;
 41 public:
 42     using ProxyMap = HashMap&lt;RefPtr&lt;DOMWrapperWorld&gt;, JSC::Strong&lt;JSWindowProxy&gt;&gt;;
 43 
 44     static Ref&lt;WindowProxy&gt; create(AbstractFrame&amp; frame)
 45     {
 46         return adoptRef(*new WindowProxy(frame));
 47     }
 48 
 49     WEBCORE_EXPORT ~WindowProxy();
 50 
 51     AbstractFrame* frame() const { return m_frame; }
 52     void detachFromFrame();
 53 
 54     void destroyJSWindowProxy(DOMWrapperWorld&amp;);
 55 
<span class="line-modified"> 56     ProxyMap::ValuesConstIteratorRange jsWindowProxies() const { return m_jsWindowProxies.values(); }</span>
 57     Vector&lt;JSC::Strong&lt;JSWindowProxy&gt;&gt; jsWindowProxiesAsVector() const;
 58 
<span class="line-modified"> 59     ProxyMap releaseJSWindowProxies() { return std::exchange(m_jsWindowProxies, ProxyMap()); }</span>
<span class="line-modified"> 60     void setJSWindowProxies(ProxyMap&amp;&amp; windowProxies) { m_jsWindowProxies = WTFMove(windowProxies); }</span>
 61 
 62     JSWindowProxy* jsWindowProxy(DOMWrapperWorld&amp; world)
 63     {
 64         if (!m_frame)
 65             return nullptr;
 66 
 67         if (auto* existingProxy = existingJSWindowProxy(world))
 68             return existingProxy;
 69 
 70         return &amp;createJSWindowProxyWithInitializedScript(world);
 71     }
 72 
 73     JSWindowProxy* existingJSWindowProxy(DOMWrapperWorld&amp; world) const
 74     {
<span class="line-modified"> 75         auto it = m_jsWindowProxies.find(&amp;world);</span>
<span class="line-modified"> 76         return (it != m_jsWindowProxies.end()) ? it-&gt;value.get() : nullptr;</span>
 77     }
 78 
 79     WEBCORE_EXPORT JSDOMGlobalObject* globalObject(DOMWrapperWorld&amp;);
 80 
<span class="line-modified"> 81     void clearJSWindowProxiesNotMatchingDOMWindow(AbstractDOMWindow*, bool goingIntoPageCache);</span>
 82 
 83     WEBCORE_EXPORT void setDOMWindow(AbstractDOMWindow*);
 84 
 85     // Debugger can be nullptr to detach any existing Debugger.
 86     void attachDebugger(JSC::Debugger*); // Attaches/detaches in all worlds/window proxies.
 87 
 88     WEBCORE_EXPORT AbstractDOMWindow* window() const;
 89 
 90 private:
 91     explicit WindowProxy(AbstractFrame&amp;);
 92 
 93     JSWindowProxy&amp; createJSWindowProxy(DOMWrapperWorld&amp;);
 94     WEBCORE_EXPORT JSWindowProxy&amp; createJSWindowProxyWithInitializedScript(DOMWrapperWorld&amp;);
 95 
 96     AbstractFrame* m_frame;
<span class="line-modified"> 97     ProxyMap m_jsWindowProxies;</span>
 98 };
 99 
100 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
  3  *  Copyright (C) 2001 Peter Kelly (pmk@post.com)
  4  *  Copyright (C) 2006-2018 Apple Inc. All rights reserved.
  5  *
  6  *  This library is free software; you can redistribute it and/or
  7  *  modify it under the terms of the GNU Lesser General Public
  8  *  License as published by the Free Software Foundation; either
  9  *  version 2 of the License, or (at your option) any later version.
 10  *
 11  *  This library is distributed in the hope that it will be useful,
 12  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 13  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 14  *  Lesser General Public License for more details.
 15  *
 16  *  You should have received a copy of the GNU Lesser General Public
 17  *  License along with this library; if not, write to the Free Software
 18  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 19  */
 20 
 21 #pragma once
 22 

 23 #include &lt;JavaScriptCore/Strong.h&gt;
 24 #include &lt;wtf/HashMap.h&gt;
 25 #include &lt;wtf/RefCounted.h&gt;
<span class="line-added"> 26 #include &lt;wtf/UniqueRef.h&gt;</span>
 27 
 28 namespace JSC {
 29 class Debugger;
 30 }
 31 
 32 namespace WebCore {
 33 
 34 class AbstractDOMWindow;
 35 class AbstractFrame;
<span class="line-added"> 36 class DOMWrapperWorld;</span>
 37 class JSDOMGlobalObject;
 38 class JSWindowProxy;
 39 
 40 class WindowProxy : public RefCounted&lt;WindowProxy&gt; {
 41     WTF_MAKE_FAST_ALLOCATED;
 42 public:
 43     using ProxyMap = HashMap&lt;RefPtr&lt;DOMWrapperWorld&gt;, JSC::Strong&lt;JSWindowProxy&gt;&gt;;
 44 
 45     static Ref&lt;WindowProxy&gt; create(AbstractFrame&amp; frame)
 46     {
 47         return adoptRef(*new WindowProxy(frame));
 48     }
 49 
 50     WEBCORE_EXPORT ~WindowProxy();
 51 
 52     AbstractFrame* frame() const { return m_frame; }
 53     void detachFromFrame();
 54 
 55     void destroyJSWindowProxy(DOMWrapperWorld&amp;);
 56 
<span class="line-modified"> 57     ProxyMap::ValuesConstIteratorRange jsWindowProxies() const;</span>
 58     Vector&lt;JSC::Strong&lt;JSWindowProxy&gt;&gt; jsWindowProxiesAsVector() const;
 59 
<span class="line-modified"> 60     WEBCORE_EXPORT ProxyMap releaseJSWindowProxies();</span>
<span class="line-modified"> 61     WEBCORE_EXPORT void setJSWindowProxies(ProxyMap&amp;&amp;);</span>
 62 
 63     JSWindowProxy* jsWindowProxy(DOMWrapperWorld&amp; world)
 64     {
 65         if (!m_frame)
 66             return nullptr;
 67 
 68         if (auto* existingProxy = existingJSWindowProxy(world))
 69             return existingProxy;
 70 
 71         return &amp;createJSWindowProxyWithInitializedScript(world);
 72     }
 73 
 74     JSWindowProxy* existingJSWindowProxy(DOMWrapperWorld&amp; world) const
 75     {
<span class="line-modified"> 76         auto it = m_jsWindowProxies-&gt;find(&amp;world);</span>
<span class="line-modified"> 77         return (it != m_jsWindowProxies-&gt;end()) ? it-&gt;value.get() : nullptr;</span>
 78     }
 79 
 80     WEBCORE_EXPORT JSDOMGlobalObject* globalObject(DOMWrapperWorld&amp;);
 81 
<span class="line-modified"> 82     void clearJSWindowProxiesNotMatchingDOMWindow(AbstractDOMWindow*, bool goingIntoBackForwardCache);</span>
 83 
 84     WEBCORE_EXPORT void setDOMWindow(AbstractDOMWindow*);
 85 
 86     // Debugger can be nullptr to detach any existing Debugger.
 87     void attachDebugger(JSC::Debugger*); // Attaches/detaches in all worlds/window proxies.
 88 
 89     WEBCORE_EXPORT AbstractDOMWindow* window() const;
 90 
 91 private:
 92     explicit WindowProxy(AbstractFrame&amp;);
 93 
 94     JSWindowProxy&amp; createJSWindowProxy(DOMWrapperWorld&amp;);
 95     WEBCORE_EXPORT JSWindowProxy&amp; createJSWindowProxyWithInitializedScript(DOMWrapperWorld&amp;);
 96 
 97     AbstractFrame* m_frame;
<span class="line-modified"> 98     UniqueRef&lt;ProxyMap&gt; m_jsWindowProxies;</span>
 99 };
100 
101 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="WindowProxy.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="WorkerScriptController.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>