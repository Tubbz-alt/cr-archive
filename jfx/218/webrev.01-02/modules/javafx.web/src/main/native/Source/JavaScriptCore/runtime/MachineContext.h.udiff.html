<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/MachineContext.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Lookup.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MapConstructor.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/MachineContext.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -56,13 +56,17 @@</span>
  #endif // !ENABLE(C_LOOP)
  
  #if HAVE(MACHINE_CONTEXT)
  
  #if !USE(PLATFORM_REGISTERS_WITH_PROFILE)
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #if !USE(DARWIN_REGISTER_MACROS)</span>
  static inline void*&amp; stackPointerImpl(mcontext_t&amp;);
<span class="udiff-line-removed">- static inline void*&amp; framePointerImpl(mcontext_t&amp;);</span>
  static inline void*&amp; instructionPointerImpl(mcontext_t&amp;);
<span class="udiff-line-added">+ #endif // !USE(DARWIN_REGISTER_MACROS)</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ static inline void*&amp; framePointerImpl(mcontext_t&amp;);</span>
  #endif // !USE(PLATFORM_REGISTERS_WITH_PROFILE)
  
  template&lt;typename T = void*&gt; T stackPointer(const mcontext_t&amp;);
  template&lt;typename T = void*&gt; void setStackPointer(mcontext_t&amp;, T);
  template&lt;typename T = void*&gt; T framePointer(const mcontext_t&amp;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -79,11 +83,11 @@</span>
  #endif // HAVE(MACHINE_CONTEXT)
  #endif // OS(WINDOWS) || HAVE(MACHINE_CONTEXT)
  
  #if OS(WINDOWS) || HAVE(MACHINE_CONTEXT)
  
<span class="udiff-line-modified-removed">- #if !USE(PLATFORM_REGISTERS_WITH_PROFILE)</span>
<span class="udiff-line-modified-added">+ #if !USE(PLATFORM_REGISTERS_WITH_PROFILE) &amp;&amp; !USE(DARWIN_REGISTER_MACROS)</span>
  static inline void*&amp; stackPointerImpl(PlatformRegisters&amp; regs)
  {
  #if OS(DARWIN)
  #if __DARWIN_UNIX03
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -91,11 +95,11 @@</span>
      return reinterpret_cast&lt;void*&amp;&gt;(regs.__esp);
  #elif CPU(X86_64)
      return reinterpret_cast&lt;void*&amp;&gt;(regs.__rsp);
  #elif CPU(PPC) || CPU(PPC64)
      return reinterpret_cast&lt;void*&amp;&gt;(regs.__r1);
<span class="udiff-line-modified-removed">- #elif CPU(ARM_THUMB2) || CPU(ARM) || CPU(ARM64)</span>
<span class="udiff-line-modified-added">+ #elif CPU(ARM_THUMB2) || CPU(ARM)</span>
      return reinterpret_cast&lt;void*&amp;&gt;(regs.__sp);
  #else
  #error Unknown Architecture
  #endif
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -138,10 +142,12 @@</span>
  {
  #if USE(PLATFORM_REGISTERS_WITH_PROFILE)
      void* value = WTF_READ_PLATFORM_REGISTERS_SP_WITH_PROFILE(regs);
      assertIsNotTagged(value);
      return bitwise_cast&lt;T&gt;(value);
<span class="udiff-line-added">+ #elif USE(DARWIN_REGISTER_MACROS)</span>
<span class="udiff-line-added">+     return bitwise_cast&lt;T&gt;(reinterpret_cast&lt;void*&gt;(__darwin_arm_thread_state64_get_sp(regs)));</span>
  #else
      return bitwise_cast&lt;T&gt;(stackPointerImpl(const_cast&lt;PlatformRegisters&amp;&gt;(regs)));
  #endif
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -149,10 +155,12 @@</span>
  inline void setStackPointer(PlatformRegisters&amp; regs, T value)
  {
  #if USE(PLATFORM_REGISTERS_WITH_PROFILE)
      assertIsNotTagged(bitwise_cast&lt;void*&gt;(value));
      WTF_WRITE_PLATFORM_REGISTERS_SP_WITH_PROFILE(regs, bitwise_cast&lt;void*&gt;(value));
<span class="udiff-line-added">+ #elif USE(DARWIN_REGISTER_MACROS)</span>
<span class="udiff-line-added">+     __darwin_arm_thread_state64_set_sp(regs, value);</span>
  #else
      stackPointerImpl(regs) = bitwise_cast&lt;void*&gt;(value);
  #endif
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -165,11 +173,11 @@</span>
  }
  #endif // OS(WINDOWS) || HAVE(MACHINE_CONTEXT)
  
  #if HAVE(MACHINE_CONTEXT)
  
<span class="udiff-line-modified-removed">- #if !USE(PLATFORM_REGISTERS_WITH_PROFILE)</span>
<span class="udiff-line-modified-added">+ #if !USE(PLATFORM_REGISTERS_WITH_PROFILE) &amp;&amp; !USE(DARWIN_REGISTER_MACROS)</span>
  static inline void*&amp; stackPointerImpl(mcontext_t&amp; machineContext)
  {
  #if OS(DARWIN)
      return stackPointerImpl(machineContext-&gt;__ss);
  #elif OS(FREEBSD)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -212,10 +220,12 @@</span>
  {
  #if USE(PLATFORM_REGISTERS_WITH_PROFILE)
      void* value = WTF_READ_MACHINE_CONTEXT_SP_WITH_PROFILE(machineContext);
      assertIsNotTagged(value);
      return bitwise_cast&lt;T&gt;(value);
<span class="udiff-line-added">+ #elif USE(DARWIN_REGISTER_MACROS)</span>
<span class="udiff-line-added">+     return stackPointer(machineContext-&gt;__ss);</span>
  #else
      return bitwise_cast&lt;T&gt;(stackPointerImpl(const_cast&lt;mcontext_t&amp;&gt;(machineContext)));
  #endif
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -223,10 +233,12 @@</span>
  inline void setStackPointer(mcontext_t&amp; machineContext, T value)
  {
  #if USE(PLATFORM_REGISTERS_WITH_PROFILE)
      assertIsNotTagged(bitwise_cast&lt;void*&gt;(value));
      WTF_WRITE_MACHINE_CONTEXT_SP_WITH_PROFILE(machineContext, bitwise_cast&lt;void*&gt;(value));
<span class="udiff-line-added">+ #elif USE(DARWIN_REGISTER_MACROS)</span>
<span class="udiff-line-added">+     return setStackPointer(machineContext-&gt;__ss, value);</span>
  #else
      stackPointerImpl(machineContext) = bitwise_cast&lt;void*&gt;(value);
  #endif
  }
  #endif // HAVE(MACHINE_CONTEXT)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -383,21 +395,21 @@</span>
  #endif // HAVE(MACHINE_CONTEXT)
  
  
  #if OS(WINDOWS) || HAVE(MACHINE_CONTEXT)
  
<span class="udiff-line-modified-removed">- #if !USE(PLATFORM_REGISTERS_WITH_PROFILE)</span>
<span class="udiff-line-modified-added">+ #if !USE(PLATFORM_REGISTERS_WITH_PROFILE) &amp;&amp; !USE(DARWIN_REGISTER_MACROS)</span>
  static inline void*&amp; instructionPointerImpl(PlatformRegisters&amp; regs)
  {
  #if OS(DARWIN)
  #if __DARWIN_UNIX03
  
  #if CPU(X86)
      return reinterpret_cast&lt;void*&amp;&gt;(regs.__eip);
  #elif CPU(X86_64)
      return reinterpret_cast&lt;void*&amp;&gt;(regs.__rip);
<span class="udiff-line-modified-removed">- #elif CPU(ARM_THUMB2) || CPU(ARM) || CPU(ARM64)</span>
<span class="udiff-line-modified-added">+ #elif CPU(ARM_THUMB2) || CPU(ARM)</span>
      return reinterpret_cast&lt;void*&amp;&gt;(regs.__pc);
  #else
  #error Unknown Architecture
  #endif
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -434,10 +446,12 @@</span>
  
  inline Optional&lt;MacroAssemblerCodePtr&lt;PlatformRegistersPCPtrTag&gt;&gt; instructionPointer(const PlatformRegisters&amp; regs)
  {
  #if USE(PLATFORM_REGISTERS_WITH_PROFILE)
      void* value = WTF_READ_PLATFORM_REGISTERS_PC_WITH_PROFILE(regs);
<span class="udiff-line-added">+ #elif USE(DARWIN_REGISTER_MACROS)</span>
<span class="udiff-line-added">+     void* value = __darwin_arm_thread_state64_get_pc_fptr(regs);</span>
  #else
      void* value = instructionPointerImpl(const_cast&lt;PlatformRegisters&amp;&gt;(regs));
  #endif
      if (!value)
          return MacroAssemblerCodePtr&lt;PlatformRegistersPCPtrTag&gt;(nullptr);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -450,20 +464,22 @@</span>
  
  inline void setInstructionPointer(PlatformRegisters&amp; regs, MacroAssemblerCodePtr&lt;CFunctionPtrTag&gt; value)
  {
  #if USE(PLATFORM_REGISTERS_WITH_PROFILE)
      WTF_WRITE_PLATFORM_REGISTERS_PC_WITH_PROFILE(regs, value.executableAddress());
<span class="udiff-line-added">+ #elif USE(DARWIN_REGISTER_MACROS)</span>
<span class="udiff-line-added">+     __darwin_arm_thread_state64_set_pc_fptr(regs, value.executableAddress());</span>
  #else
      instructionPointerImpl(regs) = value.executableAddress();
  #endif
  }
  #endif // OS(WINDOWS) || HAVE(MACHINE_CONTEXT)
  
  
  #if HAVE(MACHINE_CONTEXT)
  
<span class="udiff-line-modified-removed">- #if !USE(PLATFORM_REGISTERS_WITH_PROFILE)</span>
<span class="udiff-line-modified-added">+ #if !USE(PLATFORM_REGISTERS_WITH_PROFILE) &amp;&amp; !USE(DARWIN_REGISTER_MACROS)</span>
  static inline void*&amp; instructionPointerImpl(mcontext_t&amp; machineContext)
  {
  #if OS(DARWIN)
      return instructionPointerImpl(machineContext-&gt;__ss);
  #elif OS(FREEBSD)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -505,56 +521,57 @@</span>
  }
  #endif // !USE(PLATFORM_REGISTERS_WITH_PROFILE)
  
  inline MacroAssemblerCodePtr&lt;PlatformRegistersPCPtrTag&gt; instructionPointer(const mcontext_t&amp; machineContext)
  {
<span class="udiff-line-added">+ #if USE(DARWIN_REGISTER_MACROS)</span>
<span class="udiff-line-added">+     return *instructionPointer(machineContext-&gt;__ss);</span>
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+ </span>
  #if USE(PLATFORM_REGISTERS_WITH_PROFILE)
      void* value = WTF_READ_MACHINE_CONTEXT_PC_WITH_PROFILE(machineContext);
  #else
      void* value = instructionPointerImpl(const_cast&lt;mcontext_t&amp;&gt;(machineContext));
  #endif
<span class="udiff-line-added">+ </span>
      return MacroAssemblerCodePtr&lt;PlatformRegistersPCPtrTag&gt;(value);
<span class="udiff-line-added">+ #endif</span>
  }
  
  inline void setInstructionPointer(mcontext_t&amp; machineContext, MacroAssemblerCodePtr&lt;CFunctionPtrTag&gt; value)
  {
  #if USE(PLATFORM_REGISTERS_WITH_PROFILE)
      WTF_WRITE_MACHINE_CONTEXT_PC_WITH_PROFILE(machineContext, value.executableAddress());
<span class="udiff-line-added">+ #elif USE(DARWIN_REGISTER_MACROS)</span>
<span class="udiff-line-added">+     setInstructionPointer(machineContext-&gt;__ss, value);</span>
  #else
      instructionPointerImpl(machineContext) = value.executableAddress();
  #endif
  }
  #endif // HAVE(MACHINE_CONTEXT)
  
  
  #if OS(WINDOWS) || HAVE(MACHINE_CONTEXT)
  
  #if OS(DARWIN) &amp;&amp; __DARWIN_UNIX03 &amp;&amp; CPU(ARM64)
<span class="udiff-line-removed">- #if !USE(PLATFORM_REGISTERS_WITH_PROFILE)</span>
<span class="udiff-line-removed">- inline void*&amp; linkRegisterImpl(PlatformRegisters&amp; regs)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return reinterpret_cast&lt;void*&amp;&gt;(regs.__lr);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- #endif // USE(PLATFORM_REGISTERS_WITH_PROFILE)</span>
<span class="udiff-line-removed">- </span>
  
  inline MacroAssemblerCodePtr&lt;PlatformRegistersLRPtrTag&gt; linkRegister(const PlatformRegisters&amp; regs)
  {
  #if USE(PLATFORM_REGISTERS_WITH_PROFILE)
      void* value = WTF_READ_PLATFORM_REGISTERS_LR_WITH_PROFILE(regs);
  #else
<span class="udiff-line-modified-removed">-     void* value = linkRegisterImpl(const_cast&lt;PlatformRegisters&amp;&gt;(regs));</span>
<span class="udiff-line-modified-added">+     void* value = __darwin_arm_thread_state64_get_lr_fptr(regs);</span>
  #endif
      return MacroAssemblerCodePtr&lt;PlatformRegistersLRPtrTag&gt;(value);
  }
  
  inline void setLinkRegister(PlatformRegisters&amp; regs, MacroAssemblerCodePtr&lt;CFunctionPtrTag&gt; value)
  {
  #if USE(PLATFORM_REGISTERS_WITH_PROFILE)
      WTF_WRITE_PLATFORM_REGISTERS_PC_WITH_PROFILE(regs, value.executableAddress());
  #else
<span class="udiff-line-modified-removed">-     linkRegisterImpl(regs) = value.executableAddress();</span>
<span class="udiff-line-modified-added">+     __darwin_arm_thread_state64_set_lr_fptr(regs, value.executableAddress());</span>
  #endif
  }
  #endif // OS(DARWIN) &amp;&amp; __DARWIN_UNIX03 &amp;&amp; CPU(ARM64)
  
  #if HAVE(MACHINE_CONTEXT)
</pre>
<center><a href="Lookup.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MapConstructor.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>