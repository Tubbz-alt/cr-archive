<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/page/DragController.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2007, 2009 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;DragActions.h&quot;
 29 #include &quot;DragImage.h&quot;
 30 #include &quot;IntPoint.h&quot;
 31 #include &quot;IntRect.h&quot;
 32 #include &lt;wtf/URL.h&gt;
 33 
 34 namespace WebCore {
 35 
 36 class DataTransfer;
 37 class Document;
 38 class DragClient;
 39 class DragData;
 40 class Element;
 41 class Frame;
 42 class FrameSelection;
 43 class HTMLImageElement;
 44 class HTMLInputElement;
 45 class IntRect;
 46 class Page;
 47 class PlatformMouseEvent;
 48 
 49 struct DragItem;
 50 struct DragState;
 51 struct PromisedAttachmentInfo;
 52 
 53     class DragController {
 54         WTF_MAKE_NONCOPYABLE(DragController); WTF_MAKE_FAST_ALLOCATED;
 55     public:
 56         DragController(Page&amp;, std::unique_ptr&lt;DragClient&gt;&amp;&amp;);
 57         ~DragController();
 58 
 59         static DragOperation platformGenericDragOperation();
 60 
 61         WEBCORE_EXPORT DragOperation dragEntered(const DragData&amp;);
 62         WEBCORE_EXPORT void dragExited(const DragData&amp;);
 63         WEBCORE_EXPORT DragOperation dragUpdated(const DragData&amp;);
 64         WEBCORE_EXPORT bool performDragOperation(const DragData&amp;);
 65         WEBCORE_EXPORT void dragCancelled();
 66 
 67         bool mouseIsOverFileInput() const { return m_fileInputElementUnderMouse; }
 68         unsigned numberOfItemsToBeAccepted() const { return m_numberOfItemsToBeAccepted; }
 69 
 70         // FIXME: It should be possible to remove a number of these accessors once all
 71         // drag logic is in WebCore.
 72         void setDidInitiateDrag(bool initiated) { m_didInitiateDrag = initiated; }
 73         bool didInitiateDrag() const { return m_didInitiateDrag; }
 74         DragOperation sourceDragOperation() const { return m_sourceDragOperation; }
 75         const URL&amp; draggingImageURL() const { return m_draggingImageURL; }
 76         void setDragOffset(const IntPoint&amp; offset) { m_dragOffset = offset; }
 77         const IntPoint&amp; dragOffset() const { return m_dragOffset; }
 78         DragSourceAction dragSourceAction() const { return m_dragSourceAction; }
 79         DragHandlingMethod dragHandlingMethod() const { return m_dragHandlingMethod; }
 80 
 81         Document* documentUnderMouse() const { return m_documentUnderMouse.get(); }
 82         DragDestinationAction dragDestinationAction() const { return m_dragDestinationAction; }
 83         DragSourceAction delegateDragSourceAction(const IntPoint&amp; rootViewPoint);
 84 
 85         Element* draggableElement(const Frame*, Element* start, const IntPoint&amp;, DragState&amp;) const;
 86         WEBCORE_EXPORT void dragEnded();
 87 
 88         WEBCORE_EXPORT void placeDragCaret(const IntPoint&amp;);
 89 
 90         const Vector&lt;Ref&lt;HTMLImageElement&gt;&gt;&amp; droppedImagePlaceholders() const { return m_droppedImagePlaceholders; }
 91         const RefPtr&lt;Range&gt;&amp; droppedImagePlaceholderRange() const { return m_droppedImagePlaceholderRange; }
 92 
 93         WEBCORE_EXPORT void finalizeDroppedImagePlaceholder(HTMLImageElement&amp;);
 94         WEBCORE_EXPORT void insertDroppedImagePlaceholdersAtCaret(const Vector&lt;IntSize&gt;&amp; imageSizes);
 95 
 96         bool startDrag(Frame&amp; src, const DragState&amp;, DragOperation srcOp, const PlatformMouseEvent&amp; dragEvent, const IntPoint&amp; dragOrigin, HasNonDefaultPasteboardData);
 97         static const IntSize&amp; maxDragImageSize();
 98 
 99         static const int MaxOriginalImageArea;
100         static const int DragIconRightInset;
101         static const int DragIconBottomInset;
102         static const float DragImageAlpha;
103 
104     private:
105         void updateSupportedTypeIdentifiersForDragHandlingMethod(DragHandlingMethod, const DragData&amp;) const;
106         bool dispatchTextInputEventFor(Frame*, const DragData&amp;);
107         bool canProcessDrag(const DragData&amp;);
108         bool concludeEditDrag(const DragData&amp;);
109         DragOperation dragEnteredOrUpdated(const DragData&amp;);
110         DragOperation operationForLoad(const DragData&amp;);
111         DragHandlingMethod tryDocumentDrag(const DragData&amp;, DragDestinationAction, DragOperation&amp;);
112         bool tryDHTMLDrag(const DragData&amp;, DragOperation&amp;);
113         DragOperation dragOperation(const DragData&amp;);
114         void clearDragCaret();
115         bool dragIsMove(FrameSelection&amp;, const DragData&amp;);
116         bool isCopyKeyDown(const DragData&amp;);
117 
118         void mouseMovedIntoDocument(Document*);
119         bool shouldUseCachedImageForDragImage(const Image&amp;) const;
120 
121         void doImageDrag(Element&amp;, const IntPoint&amp;, const IntRect&amp;, Frame&amp;, IntPoint&amp;, const DragState&amp;, PromisedAttachmentInfo&amp;&amp;);
122         void doSystemDrag(DragImage, const IntPoint&amp;, const IntPoint&amp;, Frame&amp;, const DragState&amp;, PromisedAttachmentInfo&amp;&amp;);
123 
124         void beginDrag(DragItem, Frame&amp;, const IntPoint&amp; mouseDownPoint, const IntPoint&amp; mouseDraggedPoint, DataTransfer&amp;, DragSourceAction);
125 
126         bool canLoadDataFromDraggingPasteboard() const
127         {
128 #if ENABLE(DATA_INTERACTION)
129             return m_isPerformingDrop;
130 #else
131             return true;
132 #endif
133         }
134 
135         DragClient&amp; client() const { return *m_client; }
136 
137         bool tryToUpdateDroppedImagePlaceholders(const DragData&amp;);
138         void removeAllDroppedImagePlaceholders();
139 
140         String platformContentTypeForBlobType(const String&amp; type) const;
141 
142         void cleanupAfterSystemDrag();
143         void declareAndWriteDragImage(DataTransfer&amp;, Element&amp;, const URL&amp;, const String&amp; label);
144 
145 #if ENABLE(ATTACHMENT_ELEMENT)
146         PromisedAttachmentInfo promisedAttachmentInfo(Frame&amp;, Element&amp;);
147 #endif
148         Page&amp; m_page;
149         std::unique_ptr&lt;DragClient&gt; m_client;
150 
151         RefPtr&lt;Document&gt; m_documentUnderMouse; // The document the mouse was last dragged over.
152         RefPtr&lt;Document&gt; m_dragInitiator; // The Document (if any) that initiated the drag.
153         RefPtr&lt;HTMLInputElement&gt; m_fileInputElementUnderMouse;
154         unsigned m_numberOfItemsToBeAccepted { 0 };
155         DragHandlingMethod m_dragHandlingMethod { DragHandlingMethod::None };
156 
157         DragDestinationAction m_dragDestinationAction { DragDestinationActionNone };
158         DragSourceAction m_dragSourceAction { DragSourceActionNone };
159         bool m_didInitiateDrag { false };
160         DragOperation m_sourceDragOperation { DragOperationNone }; // Set in startDrag when a drag starts from a mouse down within WebKit
161         IntPoint m_dragOffset;
162         URL m_draggingImageURL;
163         bool m_isPerformingDrop { false };
164         Vector&lt;Ref&lt;HTMLImageElement&gt;&gt; m_droppedImagePlaceholders;
165         RefPtr&lt;Range&gt; m_droppedImagePlaceholderRange;
166     };
167 
168     WEBCORE_EXPORT bool isDraggableLink(const Element&amp;);
169 
170 } // namespace WebCore
    </pre>
  </body>
</html>