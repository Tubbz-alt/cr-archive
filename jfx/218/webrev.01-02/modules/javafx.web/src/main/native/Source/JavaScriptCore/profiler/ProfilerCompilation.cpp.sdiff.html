<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/profiler/ProfilerCompilation.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ProfilerBytecodes.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ProfilerCompilation.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/profiler/ProfilerCompilation.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 95     return &amp;m_osrExits.last();
 96 }
 97 
 98 void Compilation::setJettisonReason(JettisonReason jettisonReason, const FireDetail* detail)
 99 {
100     if (m_jettisonReason != NotJettisoned)
101         return; // We only care about the original jettison reason.
102 
103     m_jettisonReason = jettisonReason;
104     if (detail)
105         m_additionalJettisonReason = toCString(*detail);
106     else
107         m_additionalJettisonReason = CString();
108 }
109 
110 void Compilation::dump(PrintStream&amp; out) const
111 {
112     out.print(&quot;Comp&quot;, m_uid);
113 }
114 
<span class="line-modified">115 JSValue Compilation::toJS(ExecState* exec) const</span>
116 {
<span class="line-modified">117     VM&amp; vm = exec-&gt;vm();</span>
118     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">119     JSObject* result = constructEmptyObject(exec);</span>
120     RETURN_IF_EXCEPTION(scope, { });
121     result-&gt;putDirect(vm, vm.propertyNames-&gt;bytecodesID, jsNumber(m_bytecodes-&gt;id()));
122     result-&gt;putDirect(vm, vm.propertyNames-&gt;compilationKind, jsString(vm, String::fromUTF8(toCString(m_kind))));
123 
<span class="line-modified">124     JSArray* profiledBytecodes = constructEmptyArray(exec, 0);</span>
125     RETURN_IF_EXCEPTION(scope, { });
126     for (unsigned i = 0; i &lt; m_profiledBytecodes.size(); ++i) {
<span class="line-modified">127         auto value = m_profiledBytecodes[i].toJS(exec);</span>
128         RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">129         profiledBytecodes-&gt;putDirectIndex(exec, i, value);</span>
130         RETURN_IF_EXCEPTION(scope, { });
131     }
132     result-&gt;putDirect(vm, vm.propertyNames-&gt;profiledBytecodes, profiledBytecodes);
133 
<span class="line-modified">134     JSArray* descriptions = constructEmptyArray(exec, 0);</span>
135     RETURN_IF_EXCEPTION(scope, { });
136     for (unsigned i = 0; i &lt; m_descriptions.size(); ++i) {
<span class="line-modified">137         auto value = m_descriptions[i].toJS(exec);</span>
138         RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">139         descriptions-&gt;putDirectIndex(exec, i, value);</span>
140         RETURN_IF_EXCEPTION(scope, { });
141     }
142     result-&gt;putDirect(vm, vm.propertyNames-&gt;descriptions, descriptions);
143 
<span class="line-modified">144     JSArray* counters = constructEmptyArray(exec, 0);</span>
145     RETURN_IF_EXCEPTION(scope, { });
146     for (auto it = m_counters.begin(), end = m_counters.end(); it != end; ++it) {
<span class="line-modified">147         JSObject* counterEntry = constructEmptyObject(exec);</span>
148         RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">149         auto value = it-&gt;key.toJS(exec);</span>
150         RETURN_IF_EXCEPTION(scope, { });
151         counterEntry-&gt;putDirect(vm, vm.propertyNames-&gt;origin, value);
152         counterEntry-&gt;putDirect(vm, vm.propertyNames-&gt;executionCount, jsNumber(it-&gt;value-&gt;count()));
<span class="line-modified">153         counters-&gt;push(exec, counterEntry);</span>
154         RETURN_IF_EXCEPTION(scope, { });
155     }
156     result-&gt;putDirect(vm, vm.propertyNames-&gt;counters, counters);
157 
<span class="line-modified">158     JSArray* exitSites = constructEmptyArray(exec, 0);</span>
159     RETURN_IF_EXCEPTION(scope, { });
160     for (unsigned i = 0; i &lt; m_osrExitSites.size(); ++i) {
<span class="line-modified">161         auto value = m_osrExitSites[i].toJS(exec);</span>
162         RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">163         exitSites-&gt;putDirectIndex(exec, i, value);</span>
164         RETURN_IF_EXCEPTION(scope, { });
165     }
166     result-&gt;putDirect(vm, vm.propertyNames-&gt;osrExitSites, exitSites);
167 
<span class="line-modified">168     JSArray* exits = constructEmptyArray(exec, 0);</span>
169     RETURN_IF_EXCEPTION(scope, { });
170     for (unsigned i = 0; i &lt; m_osrExits.size(); ++i) {
<span class="line-modified">171         exits-&gt;putDirectIndex(exec, i, m_osrExits[i].toJS(exec));</span>
172         RETURN_IF_EXCEPTION(scope, { });
173     }
174     result-&gt;putDirect(vm, vm.propertyNames-&gt;osrExits, exits);
175 
176     result-&gt;putDirect(vm, vm.propertyNames-&gt;numInlinedGetByIds, jsNumber(m_numInlinedGetByIds));
177     result-&gt;putDirect(vm, vm.propertyNames-&gt;numInlinedPutByIds, jsNumber(m_numInlinedPutByIds));
178     result-&gt;putDirect(vm, vm.propertyNames-&gt;numInlinedCalls, jsNumber(m_numInlinedCalls));
179     result-&gt;putDirect(vm, vm.propertyNames-&gt;jettisonReason, jsString(vm, String::fromUTF8(toCString(m_jettisonReason))));
180     if (!m_additionalJettisonReason.isNull())
181         result-&gt;putDirect(vm, vm.propertyNames-&gt;additionalJettisonReason, jsString(vm, String::fromUTF8(m_additionalJettisonReason)));
182 
<span class="line-modified">183     result-&gt;putDirect(vm, vm.propertyNames-&gt;uid, m_uid.toJS(exec));</span>
184 
185     return result;
186 }
187 
188 } } // namespace JSC::Profiler
189 
</pre>
</td>
<td>
<hr />
<pre>
 95     return &amp;m_osrExits.last();
 96 }
 97 
 98 void Compilation::setJettisonReason(JettisonReason jettisonReason, const FireDetail* detail)
 99 {
100     if (m_jettisonReason != NotJettisoned)
101         return; // We only care about the original jettison reason.
102 
103     m_jettisonReason = jettisonReason;
104     if (detail)
105         m_additionalJettisonReason = toCString(*detail);
106     else
107         m_additionalJettisonReason = CString();
108 }
109 
110 void Compilation::dump(PrintStream&amp; out) const
111 {
112     out.print(&quot;Comp&quot;, m_uid);
113 }
114 
<span class="line-modified">115 JSValue Compilation::toJS(JSGlobalObject* globalObject) const</span>
116 {
<span class="line-modified">117     VM&amp; vm = globalObject-&gt;vm();</span>
118     auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">119     JSObject* result = constructEmptyObject(globalObject);</span>
120     RETURN_IF_EXCEPTION(scope, { });
121     result-&gt;putDirect(vm, vm.propertyNames-&gt;bytecodesID, jsNumber(m_bytecodes-&gt;id()));
122     result-&gt;putDirect(vm, vm.propertyNames-&gt;compilationKind, jsString(vm, String::fromUTF8(toCString(m_kind))));
123 
<span class="line-modified">124     JSArray* profiledBytecodes = constructEmptyArray(globalObject, 0);</span>
125     RETURN_IF_EXCEPTION(scope, { });
126     for (unsigned i = 0; i &lt; m_profiledBytecodes.size(); ++i) {
<span class="line-modified">127         auto value = m_profiledBytecodes[i].toJS(globalObject);</span>
128         RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">129         profiledBytecodes-&gt;putDirectIndex(globalObject, i, value);</span>
130         RETURN_IF_EXCEPTION(scope, { });
131     }
132     result-&gt;putDirect(vm, vm.propertyNames-&gt;profiledBytecodes, profiledBytecodes);
133 
<span class="line-modified">134     JSArray* descriptions = constructEmptyArray(globalObject, 0);</span>
135     RETURN_IF_EXCEPTION(scope, { });
136     for (unsigned i = 0; i &lt; m_descriptions.size(); ++i) {
<span class="line-modified">137         auto value = m_descriptions[i].toJS(globalObject);</span>
138         RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">139         descriptions-&gt;putDirectIndex(globalObject, i, value);</span>
140         RETURN_IF_EXCEPTION(scope, { });
141     }
142     result-&gt;putDirect(vm, vm.propertyNames-&gt;descriptions, descriptions);
143 
<span class="line-modified">144     JSArray* counters = constructEmptyArray(globalObject, 0);</span>
145     RETURN_IF_EXCEPTION(scope, { });
146     for (auto it = m_counters.begin(), end = m_counters.end(); it != end; ++it) {
<span class="line-modified">147         JSObject* counterEntry = constructEmptyObject(globalObject);</span>
148         RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">149         auto value = it-&gt;key.toJS(globalObject);</span>
150         RETURN_IF_EXCEPTION(scope, { });
151         counterEntry-&gt;putDirect(vm, vm.propertyNames-&gt;origin, value);
152         counterEntry-&gt;putDirect(vm, vm.propertyNames-&gt;executionCount, jsNumber(it-&gt;value-&gt;count()));
<span class="line-modified">153         counters-&gt;push(globalObject, counterEntry);</span>
154         RETURN_IF_EXCEPTION(scope, { });
155     }
156     result-&gt;putDirect(vm, vm.propertyNames-&gt;counters, counters);
157 
<span class="line-modified">158     JSArray* exitSites = constructEmptyArray(globalObject, 0);</span>
159     RETURN_IF_EXCEPTION(scope, { });
160     for (unsigned i = 0; i &lt; m_osrExitSites.size(); ++i) {
<span class="line-modified">161         auto value = m_osrExitSites[i].toJS(globalObject);</span>
162         RETURN_IF_EXCEPTION(scope, { });
<span class="line-modified">163         exitSites-&gt;putDirectIndex(globalObject, i, value);</span>
164         RETURN_IF_EXCEPTION(scope, { });
165     }
166     result-&gt;putDirect(vm, vm.propertyNames-&gt;osrExitSites, exitSites);
167 
<span class="line-modified">168     JSArray* exits = constructEmptyArray(globalObject, 0);</span>
169     RETURN_IF_EXCEPTION(scope, { });
170     for (unsigned i = 0; i &lt; m_osrExits.size(); ++i) {
<span class="line-modified">171         exits-&gt;putDirectIndex(globalObject, i, m_osrExits[i].toJS(globalObject));</span>
172         RETURN_IF_EXCEPTION(scope, { });
173     }
174     result-&gt;putDirect(vm, vm.propertyNames-&gt;osrExits, exits);
175 
176     result-&gt;putDirect(vm, vm.propertyNames-&gt;numInlinedGetByIds, jsNumber(m_numInlinedGetByIds));
177     result-&gt;putDirect(vm, vm.propertyNames-&gt;numInlinedPutByIds, jsNumber(m_numInlinedPutByIds));
178     result-&gt;putDirect(vm, vm.propertyNames-&gt;numInlinedCalls, jsNumber(m_numInlinedCalls));
179     result-&gt;putDirect(vm, vm.propertyNames-&gt;jettisonReason, jsString(vm, String::fromUTF8(toCString(m_jettisonReason))));
180     if (!m_additionalJettisonReason.isNull())
181         result-&gt;putDirect(vm, vm.propertyNames-&gt;additionalJettisonReason, jsString(vm, String::fromUTF8(m_additionalJettisonReason)));
182 
<span class="line-modified">183     result-&gt;putDirect(vm, vm.propertyNames-&gt;uid, m_uid.toJS(globalObject));</span>
184 
185     return result;
186 }
187 
188 } } // namespace JSC::Profiler
189 
</pre>
</td>
</tr>
</table>
<center><a href="ProfilerBytecodes.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ProfilerCompilation.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>