<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/Modules/webgpu/WHLSL/Metal/WHLSLNativeTypeWriter.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2019 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 14  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 15  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;WHLSLNativeTypeWriter.h&quot;
 28 
 29 #if ENABLE(WEBGPU)
 30 
 31 #include &quot;WHLSLNamedType.h&quot;
 32 #include &quot;WHLSLNativeTypeDeclaration.h&quot;
 33 #include &quot;WHLSLTypeReference.h&quot;
 34 
 35 namespace WebCore {
 36 
 37 namespace WHLSL {
 38 
 39 namespace Metal {
 40 
 41 String writeNativeType(AST::NativeTypeDeclaration&amp; nativeTypeDeclaration)
 42 {
 43     if (nativeTypeDeclaration.name() == &quot;void&quot;)
 44         return &quot;void&quot;_str;
 45     if (nativeTypeDeclaration.name() == &quot;bool&quot;)
 46         return &quot;bool&quot;_str;
 47     if (nativeTypeDeclaration.name() == &quot;uint&quot;)
 48         return &quot;uint32_t&quot;_str;
 49     if (nativeTypeDeclaration.name() == &quot;int&quot;)
 50         return &quot;int32_t&quot;_str;
 51     if (nativeTypeDeclaration.name() == &quot;float&quot;)
 52         return &quot;float&quot;_str;
 53     if (nativeTypeDeclaration.name() == &quot;atomic_int&quot;)
 54         return &quot;atomic_int&quot;_str;
 55     if (nativeTypeDeclaration.name() == &quot;atomic_uint&quot;)
 56         return &quot;atomic_uint&quot;_str;
 57     if (nativeTypeDeclaration.name() == &quot;sampler&quot;)
 58         return &quot;sampler&quot;_str;
 59     if (nativeTypeDeclaration.name() == &quot;vector&quot;) {
 60         ASSERT(nativeTypeDeclaration.typeArguments().size() == 2);
 61         ASSERT(WTF::holds_alternative&lt;Ref&lt;AST::TypeReference&gt;&gt;(nativeTypeDeclaration.typeArguments()[0]));
 62         auto&amp; typeReference = WTF::get&lt;Ref&lt;AST::TypeReference&gt;&gt;(nativeTypeDeclaration.typeArguments()[0]);
 63         auto&amp; unifyNode = typeReference-&gt;unifyNode();
 64         auto&amp; namedType = downcast&lt;AST::NamedType&gt;(unifyNode);
 65         auto&amp; parameterType = downcast&lt;AST::NativeTypeDeclaration&gt;(namedType);
 66         auto prefix = ([&amp;]() -&gt; String {
 67             if (parameterType.name() == &quot;bool&quot;)
 68                 return &quot;bool&quot;;
 69             if (parameterType.name() == &quot;uint&quot;)
 70                 return &quot;uint&quot;;
 71             if (parameterType.name() == &quot;int&quot;)
 72                 return &quot;int&quot;;
 73             ASSERT(parameterType.name() == &quot;float&quot;);
 74             return &quot;float&quot;;
 75         })();
 76         ASSERT(WTF::holds_alternative&lt;AST::ConstantExpression&gt;(nativeTypeDeclaration.typeArguments()[1]));
 77         auto&amp; constantExpression = WTF::get&lt;AST::ConstantExpression&gt;(nativeTypeDeclaration.typeArguments()[1]);
 78         auto&amp; integerLiteral = constantExpression.integerLiteral();
 79         auto suffix = ([&amp;]() -&gt; String {
 80             switch (integerLiteral.value()) {
 81             case 2:
 82                 return &quot;2&quot;_str;
 83             case 3:
 84                 return &quot;3&quot;_str;
 85             default:
 86                 ASSERT(integerLiteral.value() == 4);
 87                 return &quot;4&quot;_str;
 88             }
 89         })();
 90         return makeString(prefix, suffix);
 91     }
 92     if (nativeTypeDeclaration.name() == &quot;matrix&quot;) {
 93         ASSERT(nativeTypeDeclaration.typeArguments().size() == 3);
 94         ASSERT(WTF::holds_alternative&lt;Ref&lt;AST::TypeReference&gt;&gt;(nativeTypeDeclaration.typeArguments()[0]));
 95         auto&amp; typeReference = WTF::get&lt;Ref&lt;AST::TypeReference&gt;&gt;(nativeTypeDeclaration.typeArguments()[0]);
 96         auto&amp; unifyNode = typeReference-&gt;unifyNode();
 97         auto&amp; namedType = downcast&lt;AST::NamedType&gt;(unifyNode);
 98         auto&amp; parameterType = downcast&lt;AST::NativeTypeDeclaration&gt;(namedType);
<a name="1" id="anc1"></a><span class="line-modified"> 99         auto prefix = ([&amp;] {</span>
100             if (parameterType.name() == &quot;bool&quot;)
101                 return &quot;bool&quot;;
102             ASSERT(parameterType.name() == &quot;float&quot;);
103             return &quot;float&quot;;
104         })();
105 
<a name="2" id="anc2"></a><span class="line-modified">106         return makeString(&quot;WSLMatrix&lt;&quot;, prefix, &quot;, &quot;, nativeTypeDeclaration.numberOfMatrixColumns(), &quot;, &quot;, nativeTypeDeclaration.numberOfMatrixRows(), &quot;&gt;&quot;);</span>











107     }
108     ASSERT(nativeTypeDeclaration.typeArguments().size() == 1);
109     ASSERT(WTF::holds_alternative&lt;Ref&lt;AST::TypeReference&gt;&gt;(nativeTypeDeclaration.typeArguments()[0]));
110     auto&amp; typeReference = WTF::get&lt;Ref&lt;AST::TypeReference&gt;&gt;(nativeTypeDeclaration.typeArguments()[0]);
111     auto prefix = ([&amp;]() -&gt; String {
112         if (nativeTypeDeclaration.name() == &quot;Texture1D&quot;)
113             return &quot;texture1d&quot;_str;
114         if (nativeTypeDeclaration.name() == &quot;RWTexture1D&quot;)
115             return &quot;texture1d&quot;_str;
116         if (nativeTypeDeclaration.name() == &quot;Texture1DArray&quot;)
117             return &quot;texture1d_array&quot;_str;
118         if (nativeTypeDeclaration.name() == &quot;RWTexture1DArray&quot;)
119             return &quot;texture1d_array&quot;_str;
120         if (nativeTypeDeclaration.name() == &quot;Texture2D&quot;)
121             return &quot;texture2d&quot;_str;
122         if (nativeTypeDeclaration.name() == &quot;RWTexture2D&quot;)
123             return &quot;texture2d&quot;_str;
124         if (nativeTypeDeclaration.name() == &quot;Texture2DArray&quot;)
125             return &quot;texture2d_array&quot;_str;
126         if (nativeTypeDeclaration.name() == &quot;RWTexture2DArray&quot;)
127             return &quot;texture2d_array&quot;_str;
128         if (nativeTypeDeclaration.name() == &quot;Texture3D&quot;)
129             return &quot;texture3d&quot;_str;
130         if (nativeTypeDeclaration.name() == &quot;RWTexture3D&quot;)
131             return &quot;texture3d&quot;_str;
132         if (nativeTypeDeclaration.name() == &quot;TextureCube&quot;)
133             return &quot;texturecube&quot;_str;
134         if (nativeTypeDeclaration.name() == &quot;TextureDepth2D&quot;)
135             return &quot;depth2d&quot;_str;
136         if (nativeTypeDeclaration.name() == &quot;TextureDepth2DArray&quot;)
137             return &quot;depth2d_array&quot;_str;
138         ASSERT(nativeTypeDeclaration.name() == &quot;TextureDepthCube&quot;);
139         return &quot;depthcube&quot;_str;
140     })();
141     auto innerType = ([&amp;]() -&gt; String {
142         if (typeReference-&gt;name() == &quot;uint&quot;)
143             return &quot;uint&quot;_str;
144         if (typeReference-&gt;name() == &quot;uint2&quot;)
145             return &quot;uint&quot;_str;
146         if (typeReference-&gt;name() == &quot;uint3&quot;)
147             return &quot;uint&quot;_str;
148         if (typeReference-&gt;name() == &quot;uint4&quot;)
149             return &quot;uint&quot;_str;
150         if (typeReference-&gt;name() == &quot;int&quot;)
151             return &quot;int&quot;_str;
152         if (typeReference-&gt;name() == &quot;int2&quot;)
153             return &quot;int&quot;_str;
154         if (typeReference-&gt;name() == &quot;int3&quot;)
155             return &quot;int&quot;_str;
156         if (typeReference-&gt;name() == &quot;int4&quot;)
157             return &quot;int&quot;_str;
158         if (typeReference-&gt;name() == &quot;float&quot;)
159             return &quot;float&quot;_str;
160         if (typeReference-&gt;name() == &quot;float2&quot;)
161             return &quot;float&quot;_str;
162         if (typeReference-&gt;name() == &quot;float3&quot;)
163             return &quot;float&quot;_str;
164         ASSERT(typeReference-&gt;name() == &quot;float4&quot;);
165         return &quot;float&quot;_str;
166     })();
167     auto isReadWrite = nativeTypeDeclaration.name() == &quot;RWTexture1D&quot;
168         || nativeTypeDeclaration.name() == &quot;RWTexture1DArray&quot;
169         || nativeTypeDeclaration.name() == &quot;RWTexture2D&quot;
170         || nativeTypeDeclaration.name() == &quot;RWTexture2DArray&quot;
171         || nativeTypeDeclaration.name() == &quot;RWTexture3D&quot;;
172     return makeString(prefix, &#39;&lt;&#39;, innerType, &quot;, &quot;, isReadWrite ? &quot;access::read_write&quot; : &quot;access::sample&quot;, &#39;&gt;&#39;);
173 }
174 
175 } // namespace Metal
176 
177 } // namespace WHLSL
178 
179 } // namespace WebCore
180 
181 #endif
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>