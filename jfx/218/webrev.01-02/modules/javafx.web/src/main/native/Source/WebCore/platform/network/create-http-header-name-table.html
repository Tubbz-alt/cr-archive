<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/platform/network/create-http-header-name-table</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 #!/usr/bin/env python
  2 # Copyright (c) 2014 Apple Inc. All rights reserved.
  3 #
  4 # Redistribution and use in source and binary forms, with or without
  5 # modification, are permitted provided that the following conditions are
  6 # met:
  7 # 
  8 #     * Redistributions of source code must retain the above copyright
  9 # notice, this list of conditions and the following disclaimer.
 10 #     * Redistributions in binary form must reproduce the above
 11 # copyright notice, this list of conditions and the following disclaimer
 12 # in the documentation and/or other materials provided with the
 13 # distribution.
 14 #     * Neither the name of Google Inc. nor the names of its
 15 # contributors may be used to endorse or promote products derived from
 16 # this software without specific prior written permission.
 17 # 
 18 # THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 19 # &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 20 # LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 21 # A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 22 # OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 23 # SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 24 # LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 25 # DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 26 # THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 27 # (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 28 # OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 29 
 30 import os
 31 import sys
 32 import subprocess
 33 
 34 program_name = os.path.basename(__file__)
 35 if len(sys.argv) &lt; 2:
 36     sys.stderr.write(&quot;Usage: %s INPUT_FILE GPERF_EXECUTABLE\n&quot; % program_name)
 37     exit(1)
 38 
 39 input_path = sys.argv[1]
 40 input_file = open(input_path)
 41 
 42 http_header_name_to_id = { }
 43 http_header_names = []
 44 
 45 for line in input_file:
 46     http_header_name = line.strip()
 47     if not http_header_name or http_header_name[:2] == &#39;//&#39;:
 48         continue
 49     
 50     http_header_name_to_id[http_header_name] = http_header_name.replace(&#39;-&#39;, &#39;&#39;).replace(&#39;.&#39;, &#39;&#39;)
 51     
 52     http_header_names.append(http_header_name)
 53 
 54 input_file.close()
 55 
 56 http_header_names.sort()
 57 
 58 gperf_file = open(&#39;HTTPHeaderNames.gperf&#39;, &#39;w&#39;)
 59 gperf_file.write(&#39;&#39;&#39;
 60 %{
 61 /*
 62  * Copyright (C) 2014 Apple Inc. All rights reserved.
 63  *
 64  * Redistribution and use in source and binary forms, with or without
 65  * modification, are permitted provided that the following conditions
 66  * are met:
 67  * 1. Redistributions of source code must retain the above copyright
 68  *    notice, this list of conditions and the following disclaimer.
 69  * 2. Redistributions in binary form must reproduce the above copyright
 70  *    notice, this list of conditions and the following disclaimer in the
 71  *    documentation and/or other materials provided with the distribution.
 72  *
 73  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 74  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 75  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 76  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 77  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 78  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 79  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 80  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 81  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 82  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 83  * THE POSSIBILITY OF SUCH DAMAGE.
 84  */
 85 
 86 /// This file is generated by create-http-header-name-table, do not edit.
 87 
 88 #include &quot;config.h&quot;
 89 #include &quot;HTTPHeaderNames.h&quot;
 90 
 91 #include &lt;wtf/text/StringView.h&gt;
 92 
 93 IGNORE_WARNINGS_BEGIN(&quot;implicit-fallthrough&quot;)
 94 
 95 // Older versions of gperf like to use the `register` keyword.
 96 #define register
 97 
 98 namespace WebCore {
 99 
100 static const struct HeaderNameString {
101     const char* const name;
102     unsigned length;
103 } headerNameStrings[] = {
104 &#39;&#39;&#39;)
105 
106 for http_header_name in http_header_names:
107     gperf_file.write(&#39;    { &quot;%s&quot;, %u },\n&#39; % (http_header_name, len(http_header_name)))
108 
109 gperf_file.write(&#39;};\n\n&#39;)
110 
111 gperf_file.write(&#39;&#39;&#39;
112 %}
113 
114 %language=C++
115 %readonly-tables
116 %global-table
117 %compare-strncmp
118 %ignore-case
119 %struct-type
120 struct HeaderNameHashEntry {
121     const char* name;
122     HTTPHeaderName headerName;
123 };
124 %define class-name HTTPHeaderNamesHash
125 %define lookup-function-name findHeaderNameImpl
126 %define hash-function-name header_name_hash_function
127 %define word-array-name header_name_wordlist
128 %enum
129 %%
130 &#39;&#39;&#39;)
131 
132 for http_header_name in http_header_names:
133     gperf_file.write(&#39;%s, HTTPHeaderName::%s\n&#39; % (http_header_name, http_header_name_to_id[http_header_name]))
134 
135 gperf_file.write(&#39;&#39;&#39;%%
136 bool findHTTPHeaderName(StringView stringView, HTTPHeaderName&amp; headerName)
137 {
138     unsigned length = stringView.length();
139     if (length &gt; maxHTTPHeaderNameLength || length &lt; minHTTPHeaderNameLength)
140         return false;
141 
142     if (stringView.is8Bit()) {
143         if (auto nameAndString = HTTPHeaderNamesHash::findHeaderNameImpl(reinterpret_cast&lt;const char*&gt;(stringView.characters8()), length)) {
144             headerName = nameAndString-&gt;headerName;
145             return true;
146         }
147     } else {
148         LChar characters[maxHTTPHeaderNameLength];
149         for (unsigned i = 0; i &lt; length; ++i) {
150             UChar character = stringView.characters16()[i];
151             if (!isASCII(character))
152                 return false;
153                 
154             characters[i] = static_cast&lt;LChar&gt;(character);
155         }
156         
157         if (auto nameAndString = HTTPHeaderNamesHash::findHeaderNameImpl(reinterpret_cast&lt;const char*&gt;(characters), length)) {
158             headerName = nameAndString-&gt;headerName;
159             return true;
160         }
161     }
162 
163     return false;
164 }
165 
166 StringView httpHeaderNameString(HTTPHeaderName headerName)
167 {
168     ASSERT(static_cast&lt;unsigned&gt;(headerName) &lt; numHTTPHeaderNames);
169     
170     const auto&amp; name = headerNameStrings[static_cast&lt;unsigned&gt;(headerName)];
171     
172     return StringView { reinterpret_cast&lt;const LChar*&gt;(name.name), static_cast&lt;unsigned&gt;(name.length) };
173 }
174 
175 } // namespace WebCore
176 
177 #if defined(__clang__)
178 IGNORE_WARNINGS_END
179 #endif
180 &#39;&#39;&#39;)
181 
182 gperf_file.close()
183 
184 header_file = open(&#39;HTTPHeaderNames.h&#39;, &#39;w&#39;)
185 header_file.write(&#39;&#39;&#39;
186 /*
187  * Copyright (C) 2014 Apple Inc. All rights reserved.
188  *
189  * Redistribution and use in source and binary forms, with or without
190  * modification, are permitted provided that the following conditions
191  * are met:
192  * 1. Redistributions of source code must retain the above copyright
193  *    notice, this list of conditions and the following disclaimer.
194  * 2. Redistributions in binary form must reproduce the above copyright
195  *    notice, this list of conditions and the following disclaimer in the
196  *    documentation and/or other materials provided with the distribution.
197  *
198  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
199  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
200  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
201  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
202  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
203  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
204  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
205  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
206  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
207  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
208  * THE POSSIBILITY OF SUCH DAMAGE.
209  */
210 
211 /// This file is generated by create-http-header-name-table, do not edit.
212 
213 #ifndef HTTPHeaderNames_h
214 #define HTTPHeaderNames_h
215 
216 #include &lt;wtf/Forward.h&gt;
217 
218 namespace WebCore {
219 
220 enum class HTTPHeaderName {
221 &#39;&#39;&#39;)
222 
223 for http_header_name in http_header_names:
224     header_file.write(&#39;    %s,\n&#39; % http_header_name_to_id[http_header_name])
225 
226 header_file.write(&#39;};\n\n&#39;)
227 header_file.write(&#39;const unsigned numHTTPHeaderNames = %u;\n&#39; % len(http_header_names));
228 header_file.write(&#39;const size_t minHTTPHeaderNameLength = %u;\n&#39; % len(min(http_header_names, key=len)));
229 header_file.write(&#39;const size_t maxHTTPHeaderNameLength = %u;\n&#39; % len(max(http_header_names, key=len)));
230 header_file.write(&#39;&#39;&#39;
231 bool findHTTPHeaderName(StringView, HTTPHeaderName&amp;);
232 WEBCORE_EXPORT StringView httpHeaderNameString(HTTPHeaderName);
233 
234 } // namespace WebCore
235 
236 namespace WTF {
237 
238 template&lt;&gt; struct EnumTraits&lt;WebCore::HTTPHeaderName&gt; {
239     using values = EnumValues&lt;
240         WebCore::HTTPHeaderName,
241 &#39;&#39;&#39;)
242 
243 is_first = True
244 for http_header_name in http_header_names:
245     if is_first:
246         is_first = False
247     else:
248         header_file.write(&#39;,\n&#39;)
249 
250     header_file.write(&#39;        WebCore::HTTPHeaderName::%s&#39; % http_header_name_to_id[http_header_name])
251 
252 header_file.write(&#39;&#39;&#39;
253     &gt;;
254 };
255 
256 } // namespace WTF
257 
258 #endif // HTTPHeaderNames_h
259 &#39;&#39;&#39;)
260 header_file.close()
261 
262 gperf = os.getenv(&#39;GPERF&#39;) or sys.argv[2]
263 
264 if subprocess.call([gperf, &#39;--key-positions=*&#39;, &#39;-D&#39;, &#39;-n&#39;, &#39;-s&#39;, &#39;2&#39;, &#39;HTTPHeaderNames.gperf&#39;, &#39;--output-file=HTTPHeaderNames.cpp&#39;]) != 0:
265     sys.stderr.write(&#39;Failed to run gperf.&#39;)
266     exit(1)
    </pre>
  </body>
</html>