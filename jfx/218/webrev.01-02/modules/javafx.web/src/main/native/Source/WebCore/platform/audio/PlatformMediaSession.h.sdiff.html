<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/audio/PlatformMediaSession.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PlatformMediaSession.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="PlatformMediaSessionManager.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/audio/PlatformMediaSession.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 24  */
 25 
 26 #ifndef PlatformMediaSession_h
 27 #define PlatformMediaSession_h
 28 
 29 #include &quot;Timer.h&quot;
 30 #include &lt;wtf/LoggerHelper.h&gt;
 31 #include &lt;wtf/Noncopyable.h&gt;
 32 #include &lt;wtf/WeakPtr.h&gt;
 33 #include &lt;wtf/text/WTFString.h&gt;
 34 
 35 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
 36 #include &quot;MediaPlaybackTargetClient.h&quot;
 37 #endif
 38 
 39 namespace WebCore {
 40 
 41 class Document;
 42 class MediaPlaybackTarget;
 43 class PlatformMediaSessionClient;

 44 
 45 class PlatformMediaSession
 46     : public CanMakeWeakPtr&lt;PlatformMediaSession&gt;
 47 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
 48     , public MediaPlaybackTargetClient
 49 #endif
 50 #if !RELEASE_LOG_DISABLED
 51     , private LoggerHelper
 52 #endif
 53 {
 54     WTF_MAKE_FAST_ALLOCATED;
 55 public:
 56     static std::unique_ptr&lt;PlatformMediaSession&gt; create(PlatformMediaSessionClient&amp;);
 57 
 58     PlatformMediaSession(PlatformMediaSessionClient&amp;);
 59     virtual ~PlatformMediaSession();
 60 
 61     enum MediaType {
 62         None = 0,
 63         Video,
</pre>
<hr />
<pre>
 96         MayResumePlaying = 1 &lt;&lt; 0,
 97     };
 98 
 99     enum Characteristics {
100         HasNothing = 0,
101         HasAudio = 1 &lt;&lt; 0,
102         HasVideo = 1 &lt;&lt; 1,
103     };
104     typedef unsigned CharacteristicsFlags;
105 
106     CharacteristicsFlags characteristics() const;
107     void clientCharacteristicsChanged();
108 
109     void beginInterruption(InterruptionType);
110     void endInterruption(EndInterruptionFlags);
111 
112     virtual void clientWillBeginAutoplaying();
113     virtual bool clientWillBeginPlayback();
114     virtual bool clientWillPausePlayback();
115 


116     void pauseSession();
117     void stopSession();
118 
119     virtual void suspendBuffering() { }
120     virtual void resumeBuffering() { }
121 
122 #if ENABLE(VIDEO)
123     uint64_t uniqueIdentifier() const;
124     String title() const;
125     double duration() const;
126     double currentTime() const;
127 #endif
128 
129     typedef union {
130         double asDouble;
131     } RemoteCommandArgument;
132 
133     enum RemoteControlCommandType {
134         NoCommand,
135         PlayCommand,
</pre>
<hr />
<pre>
149     enum DisplayType {
150         Normal,
151         Fullscreen,
152         Optimized,
153     };
154     DisplayType displayType() const;
155 
156     bool isHidden() const;
157     bool isSuspended() const;
158 
159     bool shouldOverrideBackgroundLoadingRestriction() const;
160 
161     virtual bool isPlayingToWirelessPlaybackTarget() const { return m_isPlayingToWirelessPlaybackTarget; }
162     void isPlayingToWirelessPlaybackTargetChanged(bool);
163 
164 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
165     // MediaPlaybackTargetClient
166     void setPlaybackTarget(Ref&lt;MediaPlaybackTarget&gt;&amp;&amp;) override { }
167     void externalOutputDeviceAvailableDidChange(bool) override { }
168     void setShouldPlayToPlaybackTarget(bool) override { }

169 #endif
170 
171 #if PLATFORM(IOS_FAMILY)
172     virtual bool requiresPlaybackTargetRouteMonitoring() const { return false; }
173 #endif
174 
175     bool activeAudioSessionRequired() const;
176     bool canProduceAudio() const;
177     void canProduceAudioChanged();
178 
179     virtual void resetPlaybackSessionState() { }
180     String sourceApplicationIdentifier() const;
181 
182     virtual bool allowsNowPlayingControlsVisibility() const { return false; }
183 
184     bool hasPlayedSinceLastInterruption() const { return m_hasPlayedSinceLastInterruption; }
185     void clearHasPlayedSinceLastInterruption() { m_hasPlayedSinceLastInterruption = false; }
186 
187 #if !RELEASE_LOG_DISABLED
188     const Logger&amp; logger() const final { return m_logger.get(); }
189     const void* logIdentifier() const override { return m_logIdentifier; }
190     const char* logClassName() const override { return &quot;PlatformMediaSession&quot;; }
191     WTFLogChannel&amp; logChannel() const final;
192 #endif
193 
194     bool canPlayConcurrently(const PlatformMediaSession&amp;) const;
195     bool shouldOverridePauseDuringRouteChange() const;
196 
197 protected:
198     PlatformMediaSessionClient&amp; client() const { return m_client; }
199 
200 private:


201     PlatformMediaSessionClient&amp; m_client;
202     State m_state;
203     State m_stateToRestore;
204     InterruptionType m_interruptionType { NoInterruption };
205     int m_interruptionCount { 0 };
206     bool m_notifyingClient;
207     bool m_isPlayingToWirelessPlaybackTarget { false };
208     bool m_hasPlayedSinceLastInterruption { false };
209 
210 #if !RELEASE_LOG_DISABLED
211     Ref&lt;const Logger&gt; m_logger;
212     const void* m_logIdentifier;
213 #endif
214 
215     friend class PlatformMediaSessionManager;
216 };
217 
218 class PlatformMediaSessionClient {
219     WTF_MAKE_NONCOPYABLE(PlatformMediaSessionClient);
220 public:
</pre>
<hr />
<pre>
233     virtual uint64_t mediaSessionUniqueIdentifier() const;
234     virtual String mediaSessionTitle() const;
235     virtual double mediaSessionDuration() const;
236     virtual double mediaSessionCurrentTime() const;
237 #endif
238 
239     virtual bool canReceiveRemoteControlCommands() const = 0;
240     virtual void didReceiveRemoteControlCommand(PlatformMediaSession::RemoteControlCommandType, const PlatformMediaSession::RemoteCommandArgument*) = 0;
241     virtual bool supportsSeeking() const = 0;
242 
243     virtual bool canProduceAudio() const { return false; }
244     virtual bool isSuspended() const { return false; };
245 
246     virtual bool shouldOverrideBackgroundPlaybackRestriction(PlatformMediaSession::InterruptionType) const = 0;
247     virtual bool shouldOverrideBackgroundLoadingRestriction() const { return false; }
248 
249     virtual void wirelessRoutesAvailableDidChange() { }
250     virtual void setWirelessPlaybackTarget(Ref&lt;MediaPlaybackTarget&gt;&amp;&amp;) { }
251     virtual bool isPlayingToWirelessPlaybackTarget() const { return false; }
252     virtual void setShouldPlayToPlaybackTarget(bool) { }

253 
254     virtual bool isPlayingOnSecondScreen() const { return false; }
255 
256     virtual Document* hostingDocument() const = 0;
257     virtual String sourceApplicationIdentifier() const = 0;
258 
259     virtual bool processingUserGestureForMedia() const = 0;
260 
261     virtual bool hasMediaStreamSource() const { return false; }
262 
263     virtual void processIsSuspendedChanged() { }
264 
265     virtual bool shouldOverridePauseDuringRouteChange() const { return false; }
266 
267 protected:
268     virtual ~PlatformMediaSessionClient() = default;
269 };
270 
271 String convertEnumerationToString(PlatformMediaSession::State);
272 String convertEnumerationToString(PlatformMediaSession::InterruptionType);
</pre>
</td>
<td>
<hr />
<pre>
 24  */
 25 
 26 #ifndef PlatformMediaSession_h
 27 #define PlatformMediaSession_h
 28 
 29 #include &quot;Timer.h&quot;
 30 #include &lt;wtf/LoggerHelper.h&gt;
 31 #include &lt;wtf/Noncopyable.h&gt;
 32 #include &lt;wtf/WeakPtr.h&gt;
 33 #include &lt;wtf/text/WTFString.h&gt;
 34 
 35 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
 36 #include &quot;MediaPlaybackTargetClient.h&quot;
 37 #endif
 38 
 39 namespace WebCore {
 40 
 41 class Document;
 42 class MediaPlaybackTarget;
 43 class PlatformMediaSessionClient;
<span class="line-added"> 44 enum class DelayCallingUpdateNowPlaying { No, Yes };</span>
 45 
 46 class PlatformMediaSession
 47     : public CanMakeWeakPtr&lt;PlatformMediaSession&gt;
 48 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
 49     , public MediaPlaybackTargetClient
 50 #endif
 51 #if !RELEASE_LOG_DISABLED
 52     , private LoggerHelper
 53 #endif
 54 {
 55     WTF_MAKE_FAST_ALLOCATED;
 56 public:
 57     static std::unique_ptr&lt;PlatformMediaSession&gt; create(PlatformMediaSessionClient&amp;);
 58 
 59     PlatformMediaSession(PlatformMediaSessionClient&amp;);
 60     virtual ~PlatformMediaSession();
 61 
 62     enum MediaType {
 63         None = 0,
 64         Video,
</pre>
<hr />
<pre>
 97         MayResumePlaying = 1 &lt;&lt; 0,
 98     };
 99 
100     enum Characteristics {
101         HasNothing = 0,
102         HasAudio = 1 &lt;&lt; 0,
103         HasVideo = 1 &lt;&lt; 1,
104     };
105     typedef unsigned CharacteristicsFlags;
106 
107     CharacteristicsFlags characteristics() const;
108     void clientCharacteristicsChanged();
109 
110     void beginInterruption(InterruptionType);
111     void endInterruption(EndInterruptionFlags);
112 
113     virtual void clientWillBeginAutoplaying();
114     virtual bool clientWillBeginPlayback();
115     virtual bool clientWillPausePlayback();
116 
<span class="line-added">117     void clientWillBeDOMSuspended();</span>
<span class="line-added">118 </span>
119     void pauseSession();
120     void stopSession();
121 
122     virtual void suspendBuffering() { }
123     virtual void resumeBuffering() { }
124 
125 #if ENABLE(VIDEO)
126     uint64_t uniqueIdentifier() const;
127     String title() const;
128     double duration() const;
129     double currentTime() const;
130 #endif
131 
132     typedef union {
133         double asDouble;
134     } RemoteCommandArgument;
135 
136     enum RemoteControlCommandType {
137         NoCommand,
138         PlayCommand,
</pre>
<hr />
<pre>
152     enum DisplayType {
153         Normal,
154         Fullscreen,
155         Optimized,
156     };
157     DisplayType displayType() const;
158 
159     bool isHidden() const;
160     bool isSuspended() const;
161 
162     bool shouldOverrideBackgroundLoadingRestriction() const;
163 
164     virtual bool isPlayingToWirelessPlaybackTarget() const { return m_isPlayingToWirelessPlaybackTarget; }
165     void isPlayingToWirelessPlaybackTargetChanged(bool);
166 
167 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
168     // MediaPlaybackTargetClient
169     void setPlaybackTarget(Ref&lt;MediaPlaybackTarget&gt;&amp;&amp;) override { }
170     void externalOutputDeviceAvailableDidChange(bool) override { }
171     void setShouldPlayToPlaybackTarget(bool) override { }
<span class="line-added">172     void playbackTargetPickerWasDismissed() override { }</span>
173 #endif
174 
175 #if PLATFORM(IOS_FAMILY)
176     virtual bool requiresPlaybackTargetRouteMonitoring() const { return false; }
177 #endif
178 
179     bool activeAudioSessionRequired() const;
180     bool canProduceAudio() const;
181     void canProduceAudioChanged();
182 
183     virtual void resetPlaybackSessionState() { }
184     String sourceApplicationIdentifier() const;
185 
186     virtual bool allowsNowPlayingControlsVisibility() const { return false; }
187 
188     bool hasPlayedSinceLastInterruption() const { return m_hasPlayedSinceLastInterruption; }
189     void clearHasPlayedSinceLastInterruption() { m_hasPlayedSinceLastInterruption = false; }
190 
191 #if !RELEASE_LOG_DISABLED
192     const Logger&amp; logger() const final { return m_logger.get(); }
193     const void* logIdentifier() const override { return m_logIdentifier; }
194     const char* logClassName() const override { return &quot;PlatformMediaSession&quot;; }
195     WTFLogChannel&amp; logChannel() const final;
196 #endif
197 
198     bool canPlayConcurrently(const PlatformMediaSession&amp;) const;
199     bool shouldOverridePauseDuringRouteChange() const;
200 
201 protected:
202     PlatformMediaSessionClient&amp; client() const { return m_client; }
203 
204 private:
<span class="line-added">205     bool processClientWillPausePlayback(DelayCallingUpdateNowPlaying);</span>
<span class="line-added">206 </span>
207     PlatformMediaSessionClient&amp; m_client;
208     State m_state;
209     State m_stateToRestore;
210     InterruptionType m_interruptionType { NoInterruption };
211     int m_interruptionCount { 0 };
212     bool m_notifyingClient;
213     bool m_isPlayingToWirelessPlaybackTarget { false };
214     bool m_hasPlayedSinceLastInterruption { false };
215 
216 #if !RELEASE_LOG_DISABLED
217     Ref&lt;const Logger&gt; m_logger;
218     const void* m_logIdentifier;
219 #endif
220 
221     friend class PlatformMediaSessionManager;
222 };
223 
224 class PlatformMediaSessionClient {
225     WTF_MAKE_NONCOPYABLE(PlatformMediaSessionClient);
226 public:
</pre>
<hr />
<pre>
239     virtual uint64_t mediaSessionUniqueIdentifier() const;
240     virtual String mediaSessionTitle() const;
241     virtual double mediaSessionDuration() const;
242     virtual double mediaSessionCurrentTime() const;
243 #endif
244 
245     virtual bool canReceiveRemoteControlCommands() const = 0;
246     virtual void didReceiveRemoteControlCommand(PlatformMediaSession::RemoteControlCommandType, const PlatformMediaSession::RemoteCommandArgument*) = 0;
247     virtual bool supportsSeeking() const = 0;
248 
249     virtual bool canProduceAudio() const { return false; }
250     virtual bool isSuspended() const { return false; };
251 
252     virtual bool shouldOverrideBackgroundPlaybackRestriction(PlatformMediaSession::InterruptionType) const = 0;
253     virtual bool shouldOverrideBackgroundLoadingRestriction() const { return false; }
254 
255     virtual void wirelessRoutesAvailableDidChange() { }
256     virtual void setWirelessPlaybackTarget(Ref&lt;MediaPlaybackTarget&gt;&amp;&amp;) { }
257     virtual bool isPlayingToWirelessPlaybackTarget() const { return false; }
258     virtual void setShouldPlayToPlaybackTarget(bool) { }
<span class="line-added">259     virtual void playbackTargetPickerWasDismissed() { }</span>
260 
261     virtual bool isPlayingOnSecondScreen() const { return false; }
262 
263     virtual Document* hostingDocument() const = 0;
264     virtual String sourceApplicationIdentifier() const = 0;
265 
266     virtual bool processingUserGestureForMedia() const = 0;
267 
268     virtual bool hasMediaStreamSource() const { return false; }
269 
270     virtual void processIsSuspendedChanged() { }
271 
272     virtual bool shouldOverridePauseDuringRouteChange() const { return false; }
273 
274 protected:
275     virtual ~PlatformMediaSessionClient() = default;
276 };
277 
278 String convertEnumerationToString(PlatformMediaSession::State);
279 String convertEnumerationToString(PlatformMediaSession::InterruptionType);
</pre>
</td>
</tr>
</table>
<center><a href="PlatformMediaSession.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="PlatformMediaSessionManager.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>