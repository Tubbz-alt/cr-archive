<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/scripts/codegen/generate_objc_backend_dispatcher_implementation.py</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="generate_js_backend_commands.py.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="generate_objc_header.py.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/scripts/codegen/generate_objc_backend_dispatcher_implementation.py</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 81 
 82         if not commands:
 83             return &#39;&#39;
 84 
 85         command_declarations = []
 86         for command in commands:
 87             command_declarations.append(self._generate_handler_implementation_for_command(domain, command))
 88 
 89         return &#39;\n&#39;.join(command_declarations)
 90 
 91     def _generate_handler_implementation_for_command(self, domain, command):
 92         lines = []
 93         parameters = [&#39;long requestId&#39;]
 94         for parameter in command.call_parameters:
 95             parameters.append(&#39;%s in_%s&#39; % (CppGenerator.cpp_type_for_unchecked_formal_in_parameter(parameter), parameter.parameter_name))
 96 
 97         command_args = {
 98             &#39;domainName&#39;: domain.domain_name,
 99             &#39;commandName&#39;: command.command_name,
100             &#39;parameters&#39;: &#39;, &#39;.join(parameters),

101             &#39;successCallback&#39;: self._generate_success_block_for_command(domain, command),
102             &#39;conversions&#39;: self._generate_conversions_for_command(domain, command),
103             &#39;invocation&#39;: self._generate_invocation_for_command(domain, command),
104         }
105 
106         return self.wrap_with_guard_for_domain(domain, Template(ObjCTemplates.BackendDispatcherHeaderDomainHandlerImplementation).substitute(None, **command_args))
107 



108     def _generate_success_block_for_command(self, domain, command):
109         lines = []
110 
111         if command.return_parameters:
112             success_block_parameters = []
113             for parameter in command.return_parameters:
114                 objc_type = self.objc_type_for_param(domain, command.command_name, parameter)
115                 var_name = ObjCGenerator.identifier_to_objc_identifier(parameter.parameter_name)
116                 success_block_parameters.append(join_type_and_name(objc_type, var_name))
117             lines.append(&#39;    id successCallback = ^(%s) {&#39; % &#39;, &#39;.join(success_block_parameters))
118         else:
119             lines.append(&#39;    id successCallback = ^{&#39;)
120 
121         if command.return_parameters:
122             lines.append(&#39;        Ref&lt;JSON::Object&gt; resultObject = JSON::Object::create();&#39;)
123 
124             required_pointer_parameters = [parameter for parameter in command.return_parameters if not parameter.is_optional and ObjCGenerator.is_type_objc_pointer_type(parameter.type)]
125             for parameter in required_pointer_parameters:
126                 var_name = ObjCGenerator.identifier_to_objc_identifier(parameter.parameter_name)
127                 lines.append(&#39;        THROW_EXCEPTION_FOR_REQUIRED_PARAMETER(%s, @&quot;%s&quot;);&#39; % (var_name, var_name))
</pre>
<hr />
<pre>
188                     lines.append(&#39;        return;&#39;)
189                     lines.append(&#39;    }&#39;)
190 
191             else:
192                 lines.append(&#39;    %s;&#39; % join_type_and_name(objc_type, objc_in_param_name))
193                 lines.append(&#39;    if (%s)&#39; % in_param_name)
194                 lines.append(&#39;        %s = %s;&#39; % (objc_in_param_name, import_expression))
195 
196         if lines:
197             lines.append(&#39;&#39;)
198         return &#39;\n&#39;.join(lines)
199 
200     def _generate_invocation_for_command(self, domain, command):
201         pairs = []
202         pairs.append(&#39;WithErrorCallback:errorCallback&#39;)
203         pairs.append(&#39;successCallback:successCallback&#39;)
204         for parameter in command.call_parameters:
205             in_param_name = &#39;in_%s&#39; % parameter.parameter_name
206             objc_in_param_expression = &#39;o_%s&#39; % in_param_name
207             if not parameter.is_optional:
<span class="line-removed">208                 # FIXME: we don&#39;t handle optional enum values in commands here because it isn&#39;t used anywhere yet.</span>
<span class="line-removed">209                 # We&#39;d need to change the delegate&#39;s signature to take Optional for optional enum values.</span>
210                 if isinstance(parameter.type, EnumType):
211                     objc_in_param_expression = &#39;%s.value()&#39; % objc_in_param_expression
212 
213                 pairs.append(&#39;%s:%s&#39; % (parameter.parameter_name, objc_in_param_expression))
214             else:



215                 optional_expression = &#39;(%s ? &amp;%s : nil)&#39; % (in_param_name, objc_in_param_expression)
216                 pairs.append(&#39;%s:%s&#39; % (parameter.parameter_name, optional_expression))
217         return &#39;    [m_delegate %s%s];&#39; % (command.command_name, &#39; &#39;.join(pairs))
</pre>
</td>
<td>
<hr />
<pre>
 81 
 82         if not commands:
 83             return &#39;&#39;
 84 
 85         command_declarations = []
 86         for command in commands:
 87             command_declarations.append(self._generate_handler_implementation_for_command(domain, command))
 88 
 89         return &#39;\n&#39;.join(command_declarations)
 90 
 91     def _generate_handler_implementation_for_command(self, domain, command):
 92         lines = []
 93         parameters = [&#39;long requestId&#39;]
 94         for parameter in command.call_parameters:
 95             parameters.append(&#39;%s in_%s&#39; % (CppGenerator.cpp_type_for_unchecked_formal_in_parameter(parameter), parameter.parameter_name))
 96 
 97         command_args = {
 98             &#39;domainName&#39;: domain.domain_name,
 99             &#39;commandName&#39;: command.command_name,
100             &#39;parameters&#39;: &#39;, &#39;.join(parameters),
<span class="line-added">101             &#39;respondsToSelector&#39;: self._generate_responds_to_selector_for_command(domain, command),</span>
102             &#39;successCallback&#39;: self._generate_success_block_for_command(domain, command),
103             &#39;conversions&#39;: self._generate_conversions_for_command(domain, command),
104             &#39;invocation&#39;: self._generate_invocation_for_command(domain, command),
105         }
106 
107         return self.wrap_with_guard_for_domain(domain, Template(ObjCTemplates.BackendDispatcherHeaderDomainHandlerImplementation).substitute(None, **command_args))
108 
<span class="line-added">109     def _generate_responds_to_selector_for_command(self, domain, command):</span>
<span class="line-added">110         return &#39;[m_delegate respondsToSelector:@selector(%sWithErrorCallback:successCallback:%s)]&#39; % (command.command_name, &#39;&#39;.join(map(lambda parameter: &#39;%s:&#39; % parameter.parameter_name, command.call_parameters)))</span>
<span class="line-added">111 </span>
112     def _generate_success_block_for_command(self, domain, command):
113         lines = []
114 
115         if command.return_parameters:
116             success_block_parameters = []
117             for parameter in command.return_parameters:
118                 objc_type = self.objc_type_for_param(domain, command.command_name, parameter)
119                 var_name = ObjCGenerator.identifier_to_objc_identifier(parameter.parameter_name)
120                 success_block_parameters.append(join_type_and_name(objc_type, var_name))
121             lines.append(&#39;    id successCallback = ^(%s) {&#39; % &#39;, &#39;.join(success_block_parameters))
122         else:
123             lines.append(&#39;    id successCallback = ^{&#39;)
124 
125         if command.return_parameters:
126             lines.append(&#39;        Ref&lt;JSON::Object&gt; resultObject = JSON::Object::create();&#39;)
127 
128             required_pointer_parameters = [parameter for parameter in command.return_parameters if not parameter.is_optional and ObjCGenerator.is_type_objc_pointer_type(parameter.type)]
129             for parameter in required_pointer_parameters:
130                 var_name = ObjCGenerator.identifier_to_objc_identifier(parameter.parameter_name)
131                 lines.append(&#39;        THROW_EXCEPTION_FOR_REQUIRED_PARAMETER(%s, @&quot;%s&quot;);&#39; % (var_name, var_name))
</pre>
<hr />
<pre>
192                     lines.append(&#39;        return;&#39;)
193                     lines.append(&#39;    }&#39;)
194 
195             else:
196                 lines.append(&#39;    %s;&#39; % join_type_and_name(objc_type, objc_in_param_name))
197                 lines.append(&#39;    if (%s)&#39; % in_param_name)
198                 lines.append(&#39;        %s = %s;&#39; % (objc_in_param_name, import_expression))
199 
200         if lines:
201             lines.append(&#39;&#39;)
202         return &#39;\n&#39;.join(lines)
203 
204     def _generate_invocation_for_command(self, domain, command):
205         pairs = []
206         pairs.append(&#39;WithErrorCallback:errorCallback&#39;)
207         pairs.append(&#39;successCallback:successCallback&#39;)
208         for parameter in command.call_parameters:
209             in_param_name = &#39;in_%s&#39; % parameter.parameter_name
210             objc_in_param_expression = &#39;o_%s&#39; % in_param_name
211             if not parameter.is_optional:


212                 if isinstance(parameter.type, EnumType):
213                     objc_in_param_expression = &#39;%s.value()&#39; % objc_in_param_expression
214 
215                 pairs.append(&#39;%s:%s&#39; % (parameter.parameter_name, objc_in_param_expression))
216             else:
<span class="line-added">217                 if isinstance(parameter.type, EnumType):</span>
<span class="line-added">218                     objc_in_param_expression = &#39;%s.value()&#39; % objc_in_param_expression</span>
<span class="line-added">219 </span>
220                 optional_expression = &#39;(%s ? &amp;%s : nil)&#39; % (in_param_name, objc_in_param_expression)
221                 pairs.append(&#39;%s:%s&#39; % (parameter.parameter_name, optional_expression))
222         return &#39;    [m_delegate %s%s];&#39; % (command.command_name, &#39; &#39;.join(pairs))
</pre>
</td>
</tr>
</table>
<center><a href="generate_js_backend_commands.py.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="generate_objc_header.py.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>