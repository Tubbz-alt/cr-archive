<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/ScriptDebugServer.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ScriptDebugListener.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ScriptDebugServer.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/ScriptDebugServer.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 39,14 ***</span>
  #include &quot;JavaScriptCallFrame.h&quot;
  #include &quot;SourceProvider.h&quot;
  #include &lt;wtf/NeverDestroyed.h&gt;
  #include &lt;wtf/SetForScope.h&gt;
  
<span class="line-removed">- using namespace JSC;</span>
<span class="line-removed">- </span>
  namespace Inspector {
  
  ScriptDebugServer::ScriptDebugServer(VM&amp; vm)
      : Debugger(vm)
  {
  }
  
<span class="line-new-header">--- 39,14 ---</span>
  #include &quot;JavaScriptCallFrame.h&quot;
  #include &quot;SourceProvider.h&quot;
  #include &lt;wtf/NeverDestroyed.h&gt;
  #include &lt;wtf/SetForScope.h&gt;
  
  namespace Inspector {
  
<span class="line-added">+ using namespace JSC;</span>
<span class="line-added">+ </span>
  ScriptDebugServer::ScriptDebugServer(VM&amp; vm)
      : Debugger(vm)
  {
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 91,20 ***</span>
      DebuggerCallFrame&amp; debuggerCallFrame = currentDebuggerCallFrame();
  
      switch (breakpointAction.type) {
      case ScriptBreakpointActionTypeLog:
          dispatchFunctionToListeners([&amp;] (ScriptDebugListener&amp; listener) {
<span class="line-modified">!             listener.breakpointActionLog(*debuggerCallFrame.globalExec(), breakpointAction.data);</span>
          });
          break;
  
      case ScriptBreakpointActionTypeEvaluate: {
          NakedPtr&lt;Exception&gt; exception;
          JSObject* scopeExtensionObject = nullptr;
          debuggerCallFrame.evaluateWithScopeExtension(breakpointAction.data, scopeExtensionObject, exception);
          if (exception)
<span class="line-modified">!             reportException(debuggerCallFrame.globalExec(), exception);</span>
          break;
      }
  
      case ScriptBreakpointActionTypeSound:
          dispatchFunctionToListeners([&amp;] (ScriptDebugListener&amp; listener) {
<span class="line-new-header">--- 91,20 ---</span>
      DebuggerCallFrame&amp; debuggerCallFrame = currentDebuggerCallFrame();
  
      switch (breakpointAction.type) {
      case ScriptBreakpointActionTypeLog:
          dispatchFunctionToListeners([&amp;] (ScriptDebugListener&amp; listener) {
<span class="line-modified">!             listener.breakpointActionLog(debuggerCallFrame.globalObject(), breakpointAction.data);</span>
          });
          break;
  
      case ScriptBreakpointActionTypeEvaluate: {
          NakedPtr&lt;Exception&gt; exception;
          JSObject* scopeExtensionObject = nullptr;
          debuggerCallFrame.evaluateWithScopeExtension(breakpointAction.data, scopeExtensionObject, exception);
          if (exception)
<span class="line-modified">!             reportException(debuggerCallFrame.globalObject(), exception);</span>
          break;
      }
  
      case ScriptBreakpointActionTypeSound:
          dispatchFunctionToListeners([&amp;] (ScriptDebugListener&amp; listener) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 114,16 ***</span>
  
      case ScriptBreakpointActionTypeProbe: {
          NakedPtr&lt;Exception&gt; exception;
          JSObject* scopeExtensionObject = nullptr;
          JSValue result = debuggerCallFrame.evaluateWithScopeExtension(breakpointAction.data, scopeExtensionObject, exception);
<span class="line-modified">!         JSC::ExecState* exec = debuggerCallFrame.globalExec();</span>
          if (exception)
<span class="line-modified">!             reportException(exec, exception);</span>
  
          dispatchFunctionToListeners([&amp;] (ScriptDebugListener&amp; listener) {
<span class="line-modified">!             listener.breakpointActionProbe(*exec, breakpointAction, m_currentProbeBatchId, m_nextProbeSampleId++, exception ? exception-&gt;value() : result);</span>
          });
          break;
      }
  
      default:
<span class="line-new-header">--- 114,16 ---</span>
  
      case ScriptBreakpointActionTypeProbe: {
          NakedPtr&lt;Exception&gt; exception;
          JSObject* scopeExtensionObject = nullptr;
          JSValue result = debuggerCallFrame.evaluateWithScopeExtension(breakpointAction.data, scopeExtensionObject, exception);
<span class="line-modified">!         JSC::JSGlobalObject* globalObject = debuggerCallFrame.globalObject();</span>
          if (exception)
<span class="line-modified">!             reportException(globalObject, exception);</span>
  
          dispatchFunctionToListeners([&amp;] (ScriptDebugListener&amp; listener) {
<span class="line-modified">!             listener.breakpointActionProbe(globalObject, breakpointAction, m_currentProbeBatchId, m_nextProbeSampleId++, exception ? exception-&gt;value() : result);</span>
          });
          break;
      }
  
      default:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 131,11 ***</span>
      }
  
      return true;
  }
  
<span class="line-modified">! void ScriptDebugServer::sourceParsed(ExecState* exec, SourceProvider* sourceProvider, int errorLine, const String&amp; errorMessage)</span>
  {
      // Preemptively check whether we can dispatch so that we don&#39;t do any unnecessary allocations.
      if (!canDispatchFunctionToListeners())
          return;
  
<span class="line-new-header">--- 131,11 ---</span>
      }
  
      return true;
  }
  
<span class="line-modified">! void ScriptDebugServer::sourceParsed(JSGlobalObject* globalObject, SourceProvider* sourceProvider, int errorLine, const String&amp; errorMessage)</span>
  {
      // Preemptively check whether we can dispatch so that we don&#39;t do any unnecessary allocations.
      if (!canDispatchFunctionToListeners())
          return;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 156,11 ***</span>
      script.sourceProvider = sourceProvider;
      script.url = sourceProvider-&gt;url();
      script.source = sourceProvider-&gt;source().toString();
      script.startLine = sourceProvider-&gt;startPosition().m_line.zeroBasedInt();
      script.startColumn = sourceProvider-&gt;startPosition().m_column.zeroBasedInt();
<span class="line-modified">!     script.isContentScript = isContentScript(exec);</span>
      script.sourceURL = sourceProvider-&gt;sourceURLDirective();
      script.sourceMappingURL = sourceProvider-&gt;sourceMappingURLDirective();
  
      int sourceLength = script.source.length();
      int lineCount = 1;
<span class="line-new-header">--- 156,11 ---</span>
      script.sourceProvider = sourceProvider;
      script.url = sourceProvider-&gt;url();
      script.source = sourceProvider-&gt;source().toString();
      script.startLine = sourceProvider-&gt;startPosition().m_line.zeroBasedInt();
      script.startColumn = sourceProvider-&gt;startPosition().m_column.zeroBasedInt();
<span class="line-modified">!     script.isContentScript = isContentScript(globalObject);</span>
      script.sourceURL = sourceProvider-&gt;sourceURLDirective();
      script.sourceMappingURL = sourceProvider-&gt;sourceMappingURLDirective();
  
      int sourceLength = script.source.length();
      int lineCount = 1;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 238,32 ***</span>
                  return;
          }
      }
  }
  
<span class="line-modified">! void ScriptDebugServer::handleExceptionInBreakpointCondition(JSC::ExecState* exec, JSC::Exception* exception) const</span>
  {
<span class="line-modified">!     reportException(exec, exception);</span>
  }
  
<span class="line-modified">! void ScriptDebugServer::handlePause(JSGlobalObject* vmEntryGlobalObject, Debugger::ReasonForPause)</span>
  {
      dispatchFunctionToListeners([&amp;] (ScriptDebugListener&amp; listener) {
          ASSERT(isPaused());
          auto&amp; debuggerCallFrame = currentDebuggerCallFrame();
          auto* globalObject = debuggerCallFrame.scope()-&gt;globalObject();
<span class="line-modified">!         auto&amp; state = *globalObject-&gt;globalExec();</span>
<span class="line-modified">!         auto jsCallFrame = toJS(&amp;state, globalObject, JavaScriptCallFrame::create(debuggerCallFrame).ptr());</span>
<span class="line-removed">-         listener.didPause(state, jsCallFrame, exceptionOrCaughtValue(&amp;state));</span>
      });
  
<span class="line-modified">!     didPause(vmEntryGlobalObject);</span>
  
      m_doneProcessingDebuggerEvents = false;
      runEventLoopWhilePaused();
  
<span class="line-modified">!     didContinue(vmEntryGlobalObject);</span>
  
      dispatchFunctionToListeners([&amp;] (ScriptDebugListener&amp; listener) {
          listener.didContinue();
      });
  }
<span class="line-new-header">--- 238,31 ---</span>
                  return;
          }
      }
  }
  
<span class="line-modified">! void ScriptDebugServer::handleExceptionInBreakpointCondition(JSC::JSGlobalObject* globalObject, JSC::Exception* exception) const</span>
  {
<span class="line-modified">!     reportException(globalObject, exception);</span>
  }
  
<span class="line-modified">! void ScriptDebugServer::handlePause(JSGlobalObject* globalObject, Debugger::ReasonForPause)</span>
  {
      dispatchFunctionToListeners([&amp;] (ScriptDebugListener&amp; listener) {
          ASSERT(isPaused());
          auto&amp; debuggerCallFrame = currentDebuggerCallFrame();
          auto* globalObject = debuggerCallFrame.scope()-&gt;globalObject();
<span class="line-modified">!         auto jsCallFrame = toJS(globalObject, globalObject, JavaScriptCallFrame::create(debuggerCallFrame).ptr());</span>
<span class="line-modified">!         listener.didPause(globalObject, jsCallFrame, exceptionOrCaughtValue(globalObject));</span>
      });
  
<span class="line-modified">!     didPause(globalObject);</span>
  
      m_doneProcessingDebuggerEvents = false;
      runEventLoopWhilePaused();
  
<span class="line-modified">!     didContinue(globalObject);</span>
  
      dispatchFunctionToListeners([&amp;] (ScriptDebugListener&amp; listener) {
          listener.didContinue();
      });
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 289,19 ***</span>
      // Last listener. Detach the debugger.
      if (m_listeners.isEmpty())
          detachDebugger(isBeingDestroyed);
  }
  
<span class="line-modified">! JSC::JSValue ScriptDebugServer::exceptionOrCaughtValue(JSC::ExecState* state)</span>
  {
      if (reasonForPause() == PausedForException)
          return currentException();
  
      for (RefPtr&lt;DebuggerCallFrame&gt; frame = &amp;currentDebuggerCallFrame(); frame; frame = frame-&gt;callerFrame()) {
          DebuggerScope&amp; scope = *frame-&gt;scope();
          if (scope.isCatchScope())
<span class="line-modified">!             return scope.caughtValue(state);</span>
      }
  
      return { };
  }
  
<span class="line-new-header">--- 288,19 ---</span>
      // Last listener. Detach the debugger.
      if (m_listeners.isEmpty())
          detachDebugger(isBeingDestroyed);
  }
  
<span class="line-modified">! JSC::JSValue ScriptDebugServer::exceptionOrCaughtValue(JSC::JSGlobalObject* globalObject)</span>
  {
      if (reasonForPause() == PausedForException)
          return currentException();
  
      for (RefPtr&lt;DebuggerCallFrame&gt; frame = &amp;currentDebuggerCallFrame(); frame; frame = frame-&gt;callerFrame()) {
          DebuggerScope&amp; scope = *frame-&gt;scope();
          if (scope.isCatchScope())
<span class="line-modified">!             return scope.caughtValue(globalObject);</span>
      }
  
      return { };
  }
  
</pre>
<center><a href="ScriptDebugListener.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ScriptDebugServer.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>