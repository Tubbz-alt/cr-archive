<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/API/JSValueRef.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSTypedArray.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSVirtualMachineInternal.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/API/JSValueRef.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 44 #include &lt;wtf/Assertions.h&gt;
 45 #include &lt;wtf/text/StringHash.h&gt;
 46 #include &lt;wtf/text/WTFString.h&gt;
 47 
 48 #if PLATFORM(MAC)
 49 #include &lt;mach-o/dyld.h&gt;
 50 #endif
 51 
 52 #if ENABLE(REMOTE_INSPECTOR)
 53 #include &quot;JSGlobalObjectInspectorController.h&quot;
 54 #endif
 55 
 56 using namespace JSC;
 57 
 58 ::JSType JSValueGetType(JSContextRef ctx, JSValueRef value)
 59 {
 60     if (!ctx) {
 61         ASSERT_NOT_REACHED();
 62         return kJSTypeUndefined;
 63     }
<span class="line-modified"> 64     ExecState* exec = toJS(ctx);</span>
<span class="line-modified"> 65     JSLockHolder locker(exec);</span>
 66 
<span class="line-modified"> 67     JSValue jsValue = toJS(exec, value);</span>
 68 
 69     if (jsValue.isUndefined())
 70         return kJSTypeUndefined;
 71     if (jsValue.isNull())
 72         return kJSTypeNull;
 73     if (jsValue.isBoolean())
 74         return kJSTypeBoolean;
 75     if (jsValue.isNumber())
 76         return kJSTypeNumber;
 77     if (jsValue.isString())
 78         return kJSTypeString;
 79     if (jsValue.isSymbol())
 80         return kJSTypeSymbol;
 81     ASSERT(jsValue.isObject());
 82     return kJSTypeObject;
 83 }
 84 
 85 bool JSValueIsUndefined(JSContextRef ctx, JSValueRef value)
 86 {
 87     if (!ctx) {
 88         ASSERT_NOT_REACHED();
 89         return false;
 90     }
<span class="line-modified"> 91     ExecState* exec = toJS(ctx);</span>
<span class="line-modified"> 92     JSLockHolder locker(exec);</span>
 93 
<span class="line-modified"> 94     return toJS(exec, value).isUndefined();</span>
 95 }
 96 
 97 bool JSValueIsNull(JSContextRef ctx, JSValueRef value)
 98 {
 99     if (!ctx) {
100         ASSERT_NOT_REACHED();
101         return false;
102     }
<span class="line-modified">103     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">104     JSLockHolder locker(exec);</span>
105 
<span class="line-modified">106     return toJS(exec, value).isNull();</span>
107 }
108 
109 bool JSValueIsBoolean(JSContextRef ctx, JSValueRef value)
110 {
111     if (!ctx) {
112         ASSERT_NOT_REACHED();
113         return false;
114     }
<span class="line-modified">115     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">116     JSLockHolder locker(exec);</span>
117 
<span class="line-modified">118     return toJS(exec, value).isBoolean();</span>
119 }
120 
121 bool JSValueIsNumber(JSContextRef ctx, JSValueRef value)
122 {
123     if (!ctx) {
124         ASSERT_NOT_REACHED();
125         return false;
126     }
<span class="line-modified">127     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">128     JSLockHolder locker(exec);</span>
129 
<span class="line-modified">130     return toJS(exec, value).isNumber();</span>
131 }
132 
133 bool JSValueIsString(JSContextRef ctx, JSValueRef value)
134 {
135     if (!ctx) {
136         ASSERT_NOT_REACHED();
137         return false;
138     }
<span class="line-modified">139     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">140     JSLockHolder locker(exec);</span>
141 
<span class="line-modified">142     return toJS(exec, value).isString();</span>
143 }
144 
145 bool JSValueIsObject(JSContextRef ctx, JSValueRef value)
146 {
147     if (!ctx) {
148         ASSERT_NOT_REACHED();
149         return false;
150     }
<span class="line-modified">151     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">152     JSLockHolder locker(exec);</span>
153 
<span class="line-modified">154     return toJS(exec, value).isObject();</span>
155 }
156 
157 bool JSValueIsSymbol(JSContextRef ctx, JSValueRef value)
158 {
159     if (!ctx) {
160         ASSERT_NOT_REACHED();
161         return false;
162     }
<span class="line-modified">163     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">164     JSLockHolder locker(exec);</span>
165 
<span class="line-modified">166     return toJS(exec, value).isSymbol();</span>
167 }
168 
169 bool JSValueIsArray(JSContextRef ctx, JSValueRef value)
170 {
171     if (!ctx) {
172         ASSERT_NOT_REACHED();
173         return false;
174     }
<span class="line-modified">175     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">176     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-modified">177     JSLockHolder locker(exec);</span>
178 
<span class="line-modified">179     return toJS(exec, value).inherits&lt;JSArray&gt;(vm);</span>
180 }
181 
182 bool JSValueIsDate(JSContextRef ctx, JSValueRef value)
183 {
184     if (!ctx) {
185         ASSERT_NOT_REACHED();
186         return false;
187     }
<span class="line-modified">188     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">189     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-modified">190     JSLockHolder locker(exec);</span>
191 
<span class="line-modified">192     return toJS(exec, value).inherits&lt;DateInstance&gt;(vm);</span>
193 }
194 
195 bool JSValueIsObjectOfClass(JSContextRef ctx, JSValueRef value, JSClassRef jsClass)
196 {
197     if (!ctx || !jsClass) {
198         ASSERT_NOT_REACHED();
199         return false;
200     }
<span class="line-modified">201     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">202     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-modified">203     JSLockHolder locker(exec);</span>
204 
<span class="line-modified">205     JSValue jsValue = toJS(exec, value);</span>
206 
207     if (JSObject* o = jsValue.getObject()) {
208         if (o-&gt;inherits&lt;JSProxy&gt;(vm))
209             o = jsCast&lt;JSProxy*&gt;(o)-&gt;target();
210 
211         if (o-&gt;inherits&lt;JSCallbackObject&lt;JSGlobalObject&gt;&gt;(vm))
212             return jsCast&lt;JSCallbackObject&lt;JSGlobalObject&gt;*&gt;(o)-&gt;inherits(jsClass);
<span class="line-modified">213         if (o-&gt;inherits&lt;JSCallbackObject&lt;JSDestructibleObject&gt;&gt;(vm))</span>
<span class="line-modified">214             return jsCast&lt;JSCallbackObject&lt;JSDestructibleObject&gt;*&gt;(o)-&gt;inherits(jsClass);</span>
215 #if JSC_OBJC_API_ENABLED
216         if (o-&gt;inherits&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;&gt;(vm))
217             return jsCast&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;*&gt;(o)-&gt;inherits(jsClass);
218 #endif
219     }
220     return false;
221 }
222 
223 bool JSValueIsEqual(JSContextRef ctx, JSValueRef a, JSValueRef b, JSValueRef* exception)
224 {
225     if (!ctx) {
226         ASSERT_NOT_REACHED();
227         return false;
228     }
<span class="line-modified">229     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">230     VM&amp; vm = exec-&gt;vm();</span>
231     JSLockHolder locker(vm);
232     auto scope = DECLARE_CATCH_SCOPE(vm);
233 
<span class="line-modified">234     JSValue jsA = toJS(exec, a);</span>
<span class="line-modified">235     JSValue jsB = toJS(exec, b);</span>
236 
<span class="line-modified">237     bool result = JSValue::equal(exec, jsA, jsB); // false if an exception is thrown</span>
<span class="line-modified">238     handleExceptionIfNeeded(scope, exec, exception);</span>
239 
240     return result;
241 }
242 
243 bool JSValueIsStrictEqual(JSContextRef ctx, JSValueRef a, JSValueRef b)
244 {
245     if (!ctx) {
246         ASSERT_NOT_REACHED();
247         return false;
248     }
<span class="line-modified">249     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">250     JSLockHolder locker(exec);</span>
251 
<span class="line-modified">252     JSValue jsA = toJS(exec, a);</span>
<span class="line-modified">253     JSValue jsB = toJS(exec, b);</span>
254 
<span class="line-modified">255     return JSValue::strictEqual(exec, jsA, jsB);</span>
256 }
257 
258 bool JSValueIsInstanceOfConstructor(JSContextRef ctx, JSValueRef value, JSObjectRef constructor, JSValueRef* exception)
259 {
260     if (!ctx) {
261         ASSERT_NOT_REACHED();
262         return false;
263     }
<span class="line-modified">264     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">265     VM&amp; vm = exec-&gt;vm();</span>
266     JSLockHolder locker(vm);
267     auto scope = DECLARE_CATCH_SCOPE(vm);
268 
<span class="line-modified">269     JSValue jsValue = toJS(exec, value);</span>
270 
271     JSObject* jsConstructor = toJS(constructor);
272     if (!jsConstructor-&gt;structure(vm)-&gt;typeInfo().implementsHasInstance())
273         return false;
<span class="line-modified">274     bool result = jsConstructor-&gt;hasInstance(exec, jsValue); // false if an exception is thrown</span>
<span class="line-modified">275     handleExceptionIfNeeded(scope, exec, exception);</span>
276     return result;
277 }
278 
279 JSValueRef JSValueMakeUndefined(JSContextRef ctx)
280 {
281     if (!ctx) {
282         ASSERT_NOT_REACHED();
283         return 0;
284     }
<span class="line-modified">285     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">286     JSLockHolder locker(exec);</span>
287 
<span class="line-modified">288     return toRef(exec, jsUndefined());</span>
289 }
290 
291 JSValueRef JSValueMakeNull(JSContextRef ctx)
292 {
293     if (!ctx) {
294         ASSERT_NOT_REACHED();
295         return 0;
296     }
<span class="line-modified">297     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">298     JSLockHolder locker(exec);</span>
299 
<span class="line-modified">300     return toRef(exec, jsNull());</span>
301 }
302 
303 JSValueRef JSValueMakeBoolean(JSContextRef ctx, bool value)
304 {
305     if (!ctx) {
306         ASSERT_NOT_REACHED();
307         return 0;
308     }
<span class="line-modified">309     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">310     JSLockHolder locker(exec);</span>
311 
<span class="line-modified">312     return toRef(exec, jsBoolean(value));</span>
313 }
314 
315 JSValueRef JSValueMakeNumber(JSContextRef ctx, double value)
316 {
317     if (!ctx) {
318         ASSERT_NOT_REACHED();
319         return 0;
320     }
<span class="line-modified">321     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">322     JSLockHolder locker(exec);</span>
323 
<span class="line-modified">324     return toRef(exec, jsNumber(purifyNaN(value)));</span>
325 }
326 
327 JSValueRef JSValueMakeSymbol(JSContextRef ctx, JSStringRef description)
328 {
329     if (!ctx) {
330         ASSERT_NOT_REACHED();
331         return nullptr;
332     }
<span class="line-modified">333     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">334     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-modified">335     JSLockHolder locker(exec);</span>
336 
337     if (!description)
<span class="line-modified">338         return toRef(exec, Symbol::create(vm));</span>
<span class="line-modified">339     return toRef(exec, Symbol::createWithDescription(vm, description-&gt;string()));</span>
340 }
341 
342 JSValueRef JSValueMakeString(JSContextRef ctx, JSStringRef string)
343 {
344     if (!ctx) {
345         ASSERT_NOT_REACHED();
346         return 0;
347     }
<span class="line-modified">348     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">349     VM&amp; vm = exec-&gt;vm();</span>
350     JSLockHolder locker(vm);
351 
<span class="line-modified">352     return toRef(exec, jsString(vm, string ? string-&gt;string() : String()));</span>
353 }
354 
355 JSValueRef JSValueMakeFromJSONString(JSContextRef ctx, JSStringRef string)
356 {
357     if (!ctx) {
358         ASSERT_NOT_REACHED();
359         return 0;
360     }
<span class="line-modified">361     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">362     JSLockHolder locker(exec);</span>
363     String str = string-&gt;string();
364     unsigned length = str.length();
365     if (!length || str.is8Bit()) {
<span class="line-modified">366         LiteralParser&lt;LChar&gt; parser(exec, str.characters8(), length, StrictJSON);</span>
<span class="line-modified">367         return toRef(exec, parser.tryLiteralParse());</span>
368     }
<span class="line-modified">369     LiteralParser&lt;UChar&gt; parser(exec, str.characters16(), length, StrictJSON);</span>
<span class="line-modified">370     return toRef(exec, parser.tryLiteralParse());</span>
371 }
372 
373 JSStringRef JSValueCreateJSONString(JSContextRef ctx, JSValueRef apiValue, unsigned indent, JSValueRef* exception)
374 {
375     if (!ctx) {
376         ASSERT_NOT_REACHED();
377         return 0;
378     }
<span class="line-modified">379     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">380     VM&amp; vm = exec-&gt;vm();</span>
381     JSLockHolder locker(vm);
382     auto scope = DECLARE_CATCH_SCOPE(vm);
383 
<span class="line-modified">384     JSValue value = toJS(exec, apiValue);</span>
<span class="line-modified">385     String result = JSONStringify(exec, value, indent);</span>
386     if (exception)
387         *exception = 0;
<span class="line-modified">388     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
389         return 0;
390     return OpaqueJSString::tryCreate(result).leakRef();
391 }
392 
393 bool JSValueToBoolean(JSContextRef ctx, JSValueRef value)
394 {
395     if (!ctx) {
396         ASSERT_NOT_REACHED();
397         return false;
398     }
<span class="line-modified">399     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">400     JSLockHolder locker(exec);</span>
401 
<span class="line-modified">402     JSValue jsValue = toJS(exec, value);</span>
<span class="line-modified">403     return jsValue.toBoolean(exec);</span>
404 }
405 
406 double JSValueToNumber(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
407 {
408     if (!ctx) {
409         ASSERT_NOT_REACHED();
410         return PNaN;
411     }
<span class="line-modified">412     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">413     VM&amp; vm = exec-&gt;vm();</span>
414     JSLockHolder locker(vm);
415     auto scope = DECLARE_CATCH_SCOPE(vm);
416 
<span class="line-modified">417     JSValue jsValue = toJS(exec, value);</span>
418 
<span class="line-modified">419     double number = jsValue.toNumber(exec);</span>
<span class="line-modified">420     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
421         number = PNaN;
422     return number;
423 }
424 
425 JSStringRef JSValueToStringCopy(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
426 {
427     if (!ctx) {
428         ASSERT_NOT_REACHED();
429         return 0;
430     }
<span class="line-modified">431     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">432     VM&amp; vm = exec-&gt;vm();</span>
433     JSLockHolder locker(vm);
434     auto scope = DECLARE_CATCH_SCOPE(vm);
435 
<span class="line-modified">436     JSValue jsValue = toJS(exec, value);</span>
437 
<span class="line-modified">438     auto stringRef(OpaqueJSString::tryCreate(jsValue.toWTFString(exec)));</span>
<span class="line-modified">439     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
440         stringRef = nullptr;
441     return stringRef.leakRef();
442 }
443 
444 JSObjectRef JSValueToObject(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
445 {
446     if (!ctx) {
447         ASSERT_NOT_REACHED();
448         return 0;
449     }
<span class="line-modified">450     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">451     VM&amp; vm = exec-&gt;vm();</span>
452     JSLockHolder locker(vm);
453     auto scope = DECLARE_CATCH_SCOPE(vm);
454 
<span class="line-modified">455     JSValue jsValue = toJS(exec, value);</span>
456 
<span class="line-modified">457     JSObjectRef objectRef = toRef(jsValue.toObject(exec));</span>
<span class="line-modified">458     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
459         objectRef = 0;
460     return objectRef;
461 }
462 
463 void JSValueProtect(JSContextRef ctx, JSValueRef value)
464 {
465     if (!ctx) {
466         ASSERT_NOT_REACHED();
467         return;
468     }
<span class="line-modified">469     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">470     JSLockHolder locker(exec);</span>
471 
<span class="line-modified">472     JSValue jsValue = toJSForGC(exec, value);</span>
473     gcProtect(jsValue);
474 }
475 
476 void JSValueUnprotect(JSContextRef ctx, JSValueRef value)
477 {
<span class="line-modified">478     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">479     JSLockHolder locker(exec);</span>
480 
<span class="line-modified">481     JSValue jsValue = toJSForGC(exec, value);</span>
482     gcUnprotect(jsValue);
483 }
</pre>
</td>
<td>
<hr />
<pre>
 44 #include &lt;wtf/Assertions.h&gt;
 45 #include &lt;wtf/text/StringHash.h&gt;
 46 #include &lt;wtf/text/WTFString.h&gt;
 47 
 48 #if PLATFORM(MAC)
 49 #include &lt;mach-o/dyld.h&gt;
 50 #endif
 51 
 52 #if ENABLE(REMOTE_INSPECTOR)
 53 #include &quot;JSGlobalObjectInspectorController.h&quot;
 54 #endif
 55 
 56 using namespace JSC;
 57 
 58 ::JSType JSValueGetType(JSContextRef ctx, JSValueRef value)
 59 {
 60     if (!ctx) {
 61         ASSERT_NOT_REACHED();
 62         return kJSTypeUndefined;
 63     }
<span class="line-modified"> 64     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified"> 65     JSLockHolder locker(globalObject);</span>
 66 
<span class="line-modified"> 67     JSValue jsValue = toJS(globalObject, value);</span>
 68 
 69     if (jsValue.isUndefined())
 70         return kJSTypeUndefined;
 71     if (jsValue.isNull())
 72         return kJSTypeNull;
 73     if (jsValue.isBoolean())
 74         return kJSTypeBoolean;
 75     if (jsValue.isNumber())
 76         return kJSTypeNumber;
 77     if (jsValue.isString())
 78         return kJSTypeString;
 79     if (jsValue.isSymbol())
 80         return kJSTypeSymbol;
 81     ASSERT(jsValue.isObject());
 82     return kJSTypeObject;
 83 }
 84 
 85 bool JSValueIsUndefined(JSContextRef ctx, JSValueRef value)
 86 {
 87     if (!ctx) {
 88         ASSERT_NOT_REACHED();
 89         return false;
 90     }
<span class="line-modified"> 91     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified"> 92     JSLockHolder locker(globalObject);</span>
 93 
<span class="line-modified"> 94     return toJS(globalObject, value).isUndefined();</span>
 95 }
 96 
 97 bool JSValueIsNull(JSContextRef ctx, JSValueRef value)
 98 {
 99     if (!ctx) {
100         ASSERT_NOT_REACHED();
101         return false;
102     }
<span class="line-modified">103     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">104     JSLockHolder locker(globalObject);</span>
105 
<span class="line-modified">106     return toJS(globalObject, value).isNull();</span>
107 }
108 
109 bool JSValueIsBoolean(JSContextRef ctx, JSValueRef value)
110 {
111     if (!ctx) {
112         ASSERT_NOT_REACHED();
113         return false;
114     }
<span class="line-modified">115     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">116     JSLockHolder locker(globalObject);</span>
117 
<span class="line-modified">118     return toJS(globalObject, value).isBoolean();</span>
119 }
120 
121 bool JSValueIsNumber(JSContextRef ctx, JSValueRef value)
122 {
123     if (!ctx) {
124         ASSERT_NOT_REACHED();
125         return false;
126     }
<span class="line-modified">127     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">128     JSLockHolder locker(globalObject);</span>
129 
<span class="line-modified">130     return toJS(globalObject, value).isNumber();</span>
131 }
132 
133 bool JSValueIsString(JSContextRef ctx, JSValueRef value)
134 {
135     if (!ctx) {
136         ASSERT_NOT_REACHED();
137         return false;
138     }
<span class="line-modified">139     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">140     JSLockHolder locker(globalObject);</span>
141 
<span class="line-modified">142     return toJS(globalObject, value).isString();</span>
143 }
144 
145 bool JSValueIsObject(JSContextRef ctx, JSValueRef value)
146 {
147     if (!ctx) {
148         ASSERT_NOT_REACHED();
149         return false;
150     }
<span class="line-modified">151     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">152     JSLockHolder locker(globalObject);</span>
153 
<span class="line-modified">154     return toJS(globalObject, value).isObject();</span>
155 }
156 
157 bool JSValueIsSymbol(JSContextRef ctx, JSValueRef value)
158 {
159     if (!ctx) {
160         ASSERT_NOT_REACHED();
161         return false;
162     }
<span class="line-modified">163     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">164     JSLockHolder locker(globalObject);</span>
165 
<span class="line-modified">166     return toJS(globalObject, value).isSymbol();</span>
167 }
168 
169 bool JSValueIsArray(JSContextRef ctx, JSValueRef value)
170 {
171     if (!ctx) {
172         ASSERT_NOT_REACHED();
173         return false;
174     }
<span class="line-modified">175     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">176     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified">177     JSLockHolder locker(globalObject);</span>
178 
<span class="line-modified">179     return toJS(globalObject, value).inherits&lt;JSArray&gt;(vm);</span>
180 }
181 
182 bool JSValueIsDate(JSContextRef ctx, JSValueRef value)
183 {
184     if (!ctx) {
185         ASSERT_NOT_REACHED();
186         return false;
187     }
<span class="line-modified">188     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">189     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified">190     JSLockHolder locker(globalObject);</span>
191 
<span class="line-modified">192     return toJS(globalObject, value).inherits&lt;DateInstance&gt;(vm);</span>
193 }
194 
195 bool JSValueIsObjectOfClass(JSContextRef ctx, JSValueRef value, JSClassRef jsClass)
196 {
197     if (!ctx || !jsClass) {
198         ASSERT_NOT_REACHED();
199         return false;
200     }
<span class="line-modified">201     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">202     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified">203     JSLockHolder locker(globalObject);</span>
204 
<span class="line-modified">205     JSValue jsValue = toJS(globalObject, value);</span>
206 
207     if (JSObject* o = jsValue.getObject()) {
208         if (o-&gt;inherits&lt;JSProxy&gt;(vm))
209             o = jsCast&lt;JSProxy*&gt;(o)-&gt;target();
210 
211         if (o-&gt;inherits&lt;JSCallbackObject&lt;JSGlobalObject&gt;&gt;(vm))
212             return jsCast&lt;JSCallbackObject&lt;JSGlobalObject&gt;*&gt;(o)-&gt;inherits(jsClass);
<span class="line-modified">213         if (o-&gt;inherits&lt;JSCallbackObject&lt;JSNonFinalObject&gt;&gt;(vm))</span>
<span class="line-modified">214             return jsCast&lt;JSCallbackObject&lt;JSNonFinalObject&gt;*&gt;(o)-&gt;inherits(jsClass);</span>
215 #if JSC_OBJC_API_ENABLED
216         if (o-&gt;inherits&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;&gt;(vm))
217             return jsCast&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;*&gt;(o)-&gt;inherits(jsClass);
218 #endif
219     }
220     return false;
221 }
222 
223 bool JSValueIsEqual(JSContextRef ctx, JSValueRef a, JSValueRef b, JSValueRef* exception)
224 {
225     if (!ctx) {
226         ASSERT_NOT_REACHED();
227         return false;
228     }
<span class="line-modified">229     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">230     VM&amp; vm = globalObject-&gt;vm();</span>
231     JSLockHolder locker(vm);
232     auto scope = DECLARE_CATCH_SCOPE(vm);
233 
<span class="line-modified">234     JSValue jsA = toJS(globalObject, a);</span>
<span class="line-modified">235     JSValue jsB = toJS(globalObject, b);</span>
236 
<span class="line-modified">237     bool result = JSValue::equal(globalObject, jsA, jsB); // false if an exception is thrown</span>
<span class="line-modified">238     handleExceptionIfNeeded(scope, ctx, exception);</span>
239 
240     return result;
241 }
242 
243 bool JSValueIsStrictEqual(JSContextRef ctx, JSValueRef a, JSValueRef b)
244 {
245     if (!ctx) {
246         ASSERT_NOT_REACHED();
247         return false;
248     }
<span class="line-modified">249     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">250     JSLockHolder locker(globalObject);</span>
251 
<span class="line-modified">252     JSValue jsA = toJS(globalObject, a);</span>
<span class="line-modified">253     JSValue jsB = toJS(globalObject, b);</span>
254 
<span class="line-modified">255     return JSValue::strictEqual(globalObject, jsA, jsB);</span>
256 }
257 
258 bool JSValueIsInstanceOfConstructor(JSContextRef ctx, JSValueRef value, JSObjectRef constructor, JSValueRef* exception)
259 {
260     if (!ctx) {
261         ASSERT_NOT_REACHED();
262         return false;
263     }
<span class="line-modified">264     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">265     VM&amp; vm = globalObject-&gt;vm();</span>
266     JSLockHolder locker(vm);
267     auto scope = DECLARE_CATCH_SCOPE(vm);
268 
<span class="line-modified">269     JSValue jsValue = toJS(globalObject, value);</span>
270 
271     JSObject* jsConstructor = toJS(constructor);
272     if (!jsConstructor-&gt;structure(vm)-&gt;typeInfo().implementsHasInstance())
273         return false;
<span class="line-modified">274     bool result = jsConstructor-&gt;hasInstance(globalObject, jsValue); // false if an exception is thrown</span>
<span class="line-modified">275     handleExceptionIfNeeded(scope, ctx, exception);</span>
276     return result;
277 }
278 
279 JSValueRef JSValueMakeUndefined(JSContextRef ctx)
280 {
281     if (!ctx) {
282         ASSERT_NOT_REACHED();
283         return 0;
284     }
<span class="line-modified">285     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">286     JSLockHolder locker(globalObject);</span>
287 
<span class="line-modified">288     return toRef(globalObject, jsUndefined());</span>
289 }
290 
291 JSValueRef JSValueMakeNull(JSContextRef ctx)
292 {
293     if (!ctx) {
294         ASSERT_NOT_REACHED();
295         return 0;
296     }
<span class="line-modified">297     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">298     JSLockHolder locker(globalObject);</span>
299 
<span class="line-modified">300     return toRef(globalObject, jsNull());</span>
301 }
302 
303 JSValueRef JSValueMakeBoolean(JSContextRef ctx, bool value)
304 {
305     if (!ctx) {
306         ASSERT_NOT_REACHED();
307         return 0;
308     }
<span class="line-modified">309     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">310     JSLockHolder locker(globalObject);</span>
311 
<span class="line-modified">312     return toRef(globalObject, jsBoolean(value));</span>
313 }
314 
315 JSValueRef JSValueMakeNumber(JSContextRef ctx, double value)
316 {
317     if (!ctx) {
318         ASSERT_NOT_REACHED();
319         return 0;
320     }
<span class="line-modified">321     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">322     JSLockHolder locker(globalObject);</span>
323 
<span class="line-modified">324     return toRef(globalObject, jsNumber(purifyNaN(value)));</span>
325 }
326 
327 JSValueRef JSValueMakeSymbol(JSContextRef ctx, JSStringRef description)
328 {
329     if (!ctx) {
330         ASSERT_NOT_REACHED();
331         return nullptr;
332     }
<span class="line-modified">333     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">334     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified">335     JSLockHolder locker(globalObject);</span>
336 
337     if (!description)
<span class="line-modified">338         return toRef(globalObject, Symbol::create(vm));</span>
<span class="line-modified">339     return toRef(globalObject, Symbol::createWithDescription(vm, description-&gt;string()));</span>
340 }
341 
342 JSValueRef JSValueMakeString(JSContextRef ctx, JSStringRef string)
343 {
344     if (!ctx) {
345         ASSERT_NOT_REACHED();
346         return 0;
347     }
<span class="line-modified">348     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">349     VM&amp; vm = globalObject-&gt;vm();</span>
350     JSLockHolder locker(vm);
351 
<span class="line-modified">352     return toRef(globalObject, jsString(vm, string ? string-&gt;string() : String()));</span>
353 }
354 
355 JSValueRef JSValueMakeFromJSONString(JSContextRef ctx, JSStringRef string)
356 {
357     if (!ctx) {
358         ASSERT_NOT_REACHED();
359         return 0;
360     }
<span class="line-modified">361     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">362     JSLockHolder locker(globalObject);</span>
363     String str = string-&gt;string();
364     unsigned length = str.length();
365     if (!length || str.is8Bit()) {
<span class="line-modified">366         LiteralParser&lt;LChar&gt; parser(globalObject, str.characters8(), length, StrictJSON);</span>
<span class="line-modified">367         return toRef(globalObject, parser.tryLiteralParse());</span>
368     }
<span class="line-modified">369     LiteralParser&lt;UChar&gt; parser(globalObject, str.characters16(), length, StrictJSON);</span>
<span class="line-modified">370     return toRef(globalObject, parser.tryLiteralParse());</span>
371 }
372 
373 JSStringRef JSValueCreateJSONString(JSContextRef ctx, JSValueRef apiValue, unsigned indent, JSValueRef* exception)
374 {
375     if (!ctx) {
376         ASSERT_NOT_REACHED();
377         return 0;
378     }
<span class="line-modified">379     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">380     VM&amp; vm = globalObject-&gt;vm();</span>
381     JSLockHolder locker(vm);
382     auto scope = DECLARE_CATCH_SCOPE(vm);
383 
<span class="line-modified">384     JSValue value = toJS(globalObject, apiValue);</span>
<span class="line-modified">385     String result = JSONStringify(globalObject, value, indent);</span>
386     if (exception)
387         *exception = 0;
<span class="line-modified">388     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
389         return 0;
390     return OpaqueJSString::tryCreate(result).leakRef();
391 }
392 
393 bool JSValueToBoolean(JSContextRef ctx, JSValueRef value)
394 {
395     if (!ctx) {
396         ASSERT_NOT_REACHED();
397         return false;
398     }
<span class="line-modified">399     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">400     JSLockHolder locker(globalObject);</span>
401 
<span class="line-modified">402     JSValue jsValue = toJS(globalObject, value);</span>
<span class="line-modified">403     return jsValue.toBoolean(globalObject);</span>
404 }
405 
406 double JSValueToNumber(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
407 {
408     if (!ctx) {
409         ASSERT_NOT_REACHED();
410         return PNaN;
411     }
<span class="line-modified">412     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">413     VM&amp; vm = globalObject-&gt;vm();</span>
414     JSLockHolder locker(vm);
415     auto scope = DECLARE_CATCH_SCOPE(vm);
416 
<span class="line-modified">417     JSValue jsValue = toJS(globalObject, value);</span>
418 
<span class="line-modified">419     double number = jsValue.toNumber(globalObject);</span>
<span class="line-modified">420     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
421         number = PNaN;
422     return number;
423 }
424 
425 JSStringRef JSValueToStringCopy(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
426 {
427     if (!ctx) {
428         ASSERT_NOT_REACHED();
429         return 0;
430     }
<span class="line-modified">431     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">432     VM&amp; vm = globalObject-&gt;vm();</span>
433     JSLockHolder locker(vm);
434     auto scope = DECLARE_CATCH_SCOPE(vm);
435 
<span class="line-modified">436     JSValue jsValue = toJS(globalObject, value);</span>
437 
<span class="line-modified">438     auto stringRef(OpaqueJSString::tryCreate(jsValue.toWTFString(globalObject)));</span>
<span class="line-modified">439     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
440         stringRef = nullptr;
441     return stringRef.leakRef();
442 }
443 
444 JSObjectRef JSValueToObject(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
445 {
446     if (!ctx) {
447         ASSERT_NOT_REACHED();
448         return 0;
449     }
<span class="line-modified">450     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">451     VM&amp; vm = globalObject-&gt;vm();</span>
452     JSLockHolder locker(vm);
453     auto scope = DECLARE_CATCH_SCOPE(vm);
454 
<span class="line-modified">455     JSValue jsValue = toJS(globalObject, value);</span>
456 
<span class="line-modified">457     JSObjectRef objectRef = toRef(jsValue.toObject(globalObject));</span>
<span class="line-modified">458     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
459         objectRef = 0;
460     return objectRef;
461 }
462 
463 void JSValueProtect(JSContextRef ctx, JSValueRef value)
464 {
465     if (!ctx) {
466         ASSERT_NOT_REACHED();
467         return;
468     }
<span class="line-modified">469     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">470     JSLockHolder locker(globalObject);</span>
471 
<span class="line-modified">472     JSValue jsValue = toJSForGC(globalObject, value);</span>
473     gcProtect(jsValue);
474 }
475 
476 void JSValueUnprotect(JSContextRef ctx, JSValueRef value)
477 {
<span class="line-modified">478     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">479     JSLockHolder locker(globalObject);</span>
480 
<span class="line-modified">481     JSValue jsValue = toJSForGC(globalObject, value);</span>
482     gcUnprotect(jsValue);
483 }
</pre>
</td>
</tr>
</table>
<center><a href="JSTypedArray.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSVirtualMachineInternal.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>