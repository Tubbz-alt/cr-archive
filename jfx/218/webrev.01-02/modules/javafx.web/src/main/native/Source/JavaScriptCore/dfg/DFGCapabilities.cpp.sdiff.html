<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGCapabilities.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DFGCallCreateDirectArgumentsSlowPathGenerator.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGClobberize.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGCapabilities.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 99 inline void debugFail(CodeBlock* codeBlock, OpcodeID opcodeID, CapabilityLevel result)
100 {
101     if (verboseCapabilities() &amp;&amp; !canCompile(result))
102         dataLog(&quot;DFG rejecting opcode in &quot;, *codeBlock, &quot; because of opcode &quot;, opcodeNames[opcodeID], &quot;\n&quot;);
103 }
104 
105 CapabilityLevel capabilityLevel(OpcodeID opcodeID, CodeBlock* codeBlock, const Instruction* pc)
106 {
107     UNUSED_PARAM(codeBlock); // This function does some bytecode parsing. Ordinarily bytecode parsing requires the owning CodeBlock. It&#39;s sort of strange that we don&#39;t use it here right now.
108     UNUSED_PARAM(pc);
109 
110     switch (opcodeID) {
111     case op_wide16:
112     case op_wide32:
113         RELEASE_ASSERT_NOT_REACHED();
114     case op_enter:
115     case op_to_this:
116     case op_argument_count:
117     case op_check_tdz:
118     case op_create_this:



119     case op_bitnot:
120     case op_bitand:
121     case op_bitor:
122     case op_bitxor:
123     case op_rshift:
124     case op_lshift:
125     case op_urshift:
126     case op_unsigned:
127     case op_inc:
128     case op_dec:
129     case op_add:
130     case op_sub:
131     case op_negate:
132     case op_mul:
133     case op_mod:
134     case op_pow:
135     case op_div:
136     case op_debug:
137     case op_profile_type:
138     case op_profile_control_flow:
</pre>
<hr />
<pre>
188     case op_jfalse:
189     case op_jeq_null:
190     case op_jneq_null:
191     case op_jundefined_or_null:
192     case op_jnundefined_or_null:
193     case op_jless:
194     case op_jlesseq:
195     case op_jgreater:
196     case op_jgreatereq:
197     case op_jnless:
198     case op_jnlesseq:
199     case op_jngreater:
200     case op_jngreatereq:
201     case op_jeq:
202     case op_jneq:
203     case op_jstricteq:
204     case op_jnstricteq:
205     case op_jbelow:
206     case op_jbeloweq:
207     case op_loop_hint:

208     case op_nop:
209     case op_ret:
210     case op_end:
211     case op_new_object:


212     case op_new_array:
213     case op_new_array_with_size:
214     case op_new_array_buffer:
215     case op_new_array_with_spread:
216     case op_spread:
217     case op_strcat:
218     case op_to_primitive:
219     case op_throw:
220     case op_throw_static_error:
221     case op_call:
222     case op_tail_call:
223     case op_construct:
224     case op_call_varargs:
225     case op_tail_call_varargs:
226     case op_tail_call_forward_arguments:
227     case op_construct_varargs:
228     case op_create_direct_arguments:
229     case op_create_scoped_arguments:
230     case op_create_cloned_arguments:

231     case op_get_from_arguments:
232     case op_put_to_arguments:
233     case op_get_argument:
234     case op_jneq_ptr:
235     case op_typeof:
236     case op_to_number:

237     case op_to_string:
238     case op_to_object:
239     case op_switch_imm:
240     case op_switch_char:
241     case op_in_by_val:
242     case op_in_by_id:
243     case op_get_scope:
244     case op_get_from_scope:
245     case op_get_enumerable_length:
246     case op_has_generic_property:
247     case op_has_structure_property:
248     case op_has_indexed_property:
249     case op_get_direct_pname:
250     case op_get_property_enumerator:
251     case op_enumerator_structure_pname:
252     case op_enumerator_generic_pname:
253     case op_to_index_string:
254     case op_new_func:
255     case op_new_func_exp:
256     case op_new_generator_func:
257     case op_new_generator_func_exp:
258     case op_new_async_generator_func:
259     case op_new_async_generator_func_exp:
260     case op_new_async_func:
261     case op_new_async_func_exp:
262     case op_set_function_name:
263     case op_create_lexical_environment:
264     case op_push_with_scope:
265     case op_get_parent_scope:
266     case op_catch:
267     case op_create_rest:
268     case op_get_rest_length:
269     case op_log_shadow_chicken_prologue:
270     case op_log_shadow_chicken_tail:
271     case op_put_to_scope:
272     case op_resolve_scope:
273     case op_resolve_scope_for_hoisting_func_decl_in_eval:
274     case op_new_regexp:



275     case op_unreachable:
276     case op_super_sampler_begin:
277     case op_super_sampler_end:
278         return CanCompileAndInline;
279 
280     case op_switch_string: // Don&#39;t inline because we don&#39;t want to copy string tables in the concurrent JIT.
281     case op_call_eval:
282         return CanCompile;
283 
284     case op_yield:
285     case op_create_generator_frame_environment:
286     case llint_program_prologue:
287     case llint_eval_prologue:
288     case llint_module_program_prologue:
289     case llint_function_for_call_prologue:
290     case llint_function_for_construct_prologue:
291     case llint_function_for_call_arity_check:
292     case llint_function_for_construct_arity_check:
293     case llint_generic_return_point:
294     case llint_throw_from_slow_path_trampoline:
295     case llint_throw_during_call_trampoline:
296     case llint_native_call_trampoline:
297     case llint_native_construct_trampoline:
298     case llint_internal_function_call_trampoline:
299     case llint_internal_function_construct_trampoline:


300     case handleUncaughtException:










301         return CannotCompile;
302     }
303     return CannotCompile;
304 }
305 
306 CapabilityLevel capabilityLevel(CodeBlock* codeBlock)
307 {
308     CapabilityLevel result = CanCompileAndInline;
309 
310     for (const auto&amp; instruction : codeBlock-&gt;instructions()) {
311         switch (instruction-&gt;opcodeID()) {
312 #define DEFINE_OP(opcode, length) \
313         case opcode: { \
314             CapabilityLevel newResult = leastUpperBound(result, capabilityLevel(opcode, codeBlock, instruction.ptr())); \
315             if (newResult != result) { \
316                 debugFail(codeBlock, opcode, newResult); \
317                 result = newResult; \
318             } \
319             break; \
320         }
</pre>
</td>
<td>
<hr />
<pre>
 99 inline void debugFail(CodeBlock* codeBlock, OpcodeID opcodeID, CapabilityLevel result)
100 {
101     if (verboseCapabilities() &amp;&amp; !canCompile(result))
102         dataLog(&quot;DFG rejecting opcode in &quot;, *codeBlock, &quot; because of opcode &quot;, opcodeNames[opcodeID], &quot;\n&quot;);
103 }
104 
105 CapabilityLevel capabilityLevel(OpcodeID opcodeID, CodeBlock* codeBlock, const Instruction* pc)
106 {
107     UNUSED_PARAM(codeBlock); // This function does some bytecode parsing. Ordinarily bytecode parsing requires the owning CodeBlock. It&#39;s sort of strange that we don&#39;t use it here right now.
108     UNUSED_PARAM(pc);
109 
110     switch (opcodeID) {
111     case op_wide16:
112     case op_wide32:
113         RELEASE_ASSERT_NOT_REACHED();
114     case op_enter:
115     case op_to_this:
116     case op_argument_count:
117     case op_check_tdz:
118     case op_create_this:
<span class="line-added">119     case op_create_promise:</span>
<span class="line-added">120     case op_create_generator:</span>
<span class="line-added">121     case op_create_async_generator:</span>
122     case op_bitnot:
123     case op_bitand:
124     case op_bitor:
125     case op_bitxor:
126     case op_rshift:
127     case op_lshift:
128     case op_urshift:
129     case op_unsigned:
130     case op_inc:
131     case op_dec:
132     case op_add:
133     case op_sub:
134     case op_negate:
135     case op_mul:
136     case op_mod:
137     case op_pow:
138     case op_div:
139     case op_debug:
140     case op_profile_type:
141     case op_profile_control_flow:
</pre>
<hr />
<pre>
191     case op_jfalse:
192     case op_jeq_null:
193     case op_jneq_null:
194     case op_jundefined_or_null:
195     case op_jnundefined_or_null:
196     case op_jless:
197     case op_jlesseq:
198     case op_jgreater:
199     case op_jgreatereq:
200     case op_jnless:
201     case op_jnlesseq:
202     case op_jngreater:
203     case op_jngreatereq:
204     case op_jeq:
205     case op_jneq:
206     case op_jstricteq:
207     case op_jnstricteq:
208     case op_jbelow:
209     case op_jbeloweq:
210     case op_loop_hint:
<span class="line-added">211     case op_check_traps:</span>
212     case op_nop:
213     case op_ret:
214     case op_end:
215     case op_new_object:
<span class="line-added">216     case op_new_promise:</span>
<span class="line-added">217     case op_new_generator:</span>
218     case op_new_array:
219     case op_new_array_with_size:
220     case op_new_array_buffer:
221     case op_new_array_with_spread:
222     case op_spread:
223     case op_strcat:
224     case op_to_primitive:
225     case op_throw:
226     case op_throw_static_error:
227     case op_call:
228     case op_tail_call:
229     case op_construct:
230     case op_call_varargs:
231     case op_tail_call_varargs:
232     case op_tail_call_forward_arguments:
233     case op_construct_varargs:
234     case op_create_direct_arguments:
235     case op_create_scoped_arguments:
236     case op_create_cloned_arguments:
<span class="line-added">237     case op_create_arguments_butterfly:</span>
238     case op_get_from_arguments:
239     case op_put_to_arguments:
240     case op_get_argument:
241     case op_jneq_ptr:
242     case op_typeof:
243     case op_to_number:
<span class="line-added">244     case op_to_numeric:</span>
245     case op_to_string:
246     case op_to_object:
247     case op_switch_imm:
248     case op_switch_char:
249     case op_in_by_val:
250     case op_in_by_id:
251     case op_get_scope:
252     case op_get_from_scope:
253     case op_get_enumerable_length:
254     case op_has_generic_property:
255     case op_has_structure_property:
256     case op_has_indexed_property:
257     case op_get_direct_pname:
258     case op_get_property_enumerator:
259     case op_enumerator_structure_pname:
260     case op_enumerator_generic_pname:
261     case op_to_index_string:
262     case op_new_func:
263     case op_new_func_exp:
264     case op_new_generator_func:
265     case op_new_generator_func_exp:
266     case op_new_async_generator_func:
267     case op_new_async_generator_func_exp:
268     case op_new_async_func:
269     case op_new_async_func_exp:
270     case op_set_function_name:
271     case op_create_lexical_environment:
272     case op_push_with_scope:
273     case op_get_parent_scope:
274     case op_catch:
275     case op_create_rest:
276     case op_get_rest_length:
277     case op_log_shadow_chicken_prologue:
278     case op_log_shadow_chicken_tail:
279     case op_put_to_scope:
280     case op_resolve_scope:
281     case op_resolve_scope_for_hoisting_func_decl_in_eval:
282     case op_new_regexp:
<span class="line-added">283     case op_get_internal_field:</span>
<span class="line-added">284     case op_put_internal_field:</span>
<span class="line-added">285     case op_to_property_key:</span>
286     case op_unreachable:
287     case op_super_sampler_begin:
288     case op_super_sampler_end:
289         return CanCompileAndInline;
290 
291     case op_switch_string: // Don&#39;t inline because we don&#39;t want to copy string tables in the concurrent JIT.
292     case op_call_eval:
293         return CanCompile;
294 
295     case op_yield:
296     case op_create_generator_frame_environment:
297     case llint_program_prologue:
298     case llint_eval_prologue:
299     case llint_module_program_prologue:
300     case llint_function_for_call_prologue:
301     case llint_function_for_construct_prologue:
302     case llint_function_for_call_arity_check:
303     case llint_function_for_construct_arity_check:
304     case llint_generic_return_point:
305     case llint_throw_from_slow_path_trampoline:
306     case llint_throw_during_call_trampoline:
307     case llint_native_call_trampoline:
308     case llint_native_construct_trampoline:
309     case llint_internal_function_call_trampoline:
310     case llint_internal_function_construct_trampoline:
<span class="line-added">311     case checkpoint_osr_exit_from_inlined_call_trampoline:</span>
<span class="line-added">312     case checkpoint_osr_exit_trampoline:</span>
313     case handleUncaughtException:
<span class="line-added">314     case op_call_return_location:</span>
<span class="line-added">315     case op_construct_return_location:</span>
<span class="line-added">316     case op_call_varargs_slow_return_location:</span>
<span class="line-added">317     case op_construct_varargs_slow_return_location:</span>
<span class="line-added">318     case op_get_by_id_return_location:</span>
<span class="line-added">319     case op_get_by_val_return_location:</span>
<span class="line-added">320     case op_put_by_id_return_location:</span>
<span class="line-added">321     case op_put_by_val_return_location:</span>
<span class="line-added">322     case wasm_function_prologue:</span>
<span class="line-added">323     case wasm_function_prologue_no_tls:</span>
324         return CannotCompile;
325     }
326     return CannotCompile;
327 }
328 
329 CapabilityLevel capabilityLevel(CodeBlock* codeBlock)
330 {
331     CapabilityLevel result = CanCompileAndInline;
332 
333     for (const auto&amp; instruction : codeBlock-&gt;instructions()) {
334         switch (instruction-&gt;opcodeID()) {
335 #define DEFINE_OP(opcode, length) \
336         case opcode: { \
337             CapabilityLevel newResult = leastUpperBound(result, capabilityLevel(opcode, codeBlock, instruction.ptr())); \
338             if (newResult != result) { \
339                 debugFail(codeBlock, opcode, newResult); \
340                 result = newResult; \
341             } \
342             break; \
343         }
</pre>
</td>
</tr>
</table>
<center><a href="DFGCallCreateDirectArgumentsSlowPathGenerator.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DFGClobberize.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>