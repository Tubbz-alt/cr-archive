<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMMapLike.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2017 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY CANON INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL CANON INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;JSDOMBinding.h&quot;
 29 #include &quot;JSDOMConvert.h&quot;
<a name="1" id="anc1"></a>
 30 #include &lt;JavaScriptCore/BuiltinNames.h&gt;
 31 #include &lt;JavaScriptCore/CommonIdentifiers.h&gt;
<a name="2" id="anc2"></a>
 32 
 33 namespace WebCore {
 34 
<a name="3" id="anc3"></a><span class="line-modified"> 35 WEBCORE_EXPORT std::pair&lt;bool, std::reference_wrapper&lt;JSC::JSObject&gt;&gt; getBackingMap(JSC::JSGlobalObject&amp;, JSC::JSObject&amp; mapLike);</span>
<span class="line-modified"> 36 WEBCORE_EXPORT JSC::JSValue forwardAttributeGetterToBackingMap(JSC::JSGlobalObject&amp;, JSC::JSObject&amp;, const JSC::Identifier&amp;);</span>
<span class="line-modified"> 37 WEBCORE_EXPORT JSC::JSValue forwardFunctionCallToBackingMap(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, JSC::JSObject&amp;, const JSC::Identifier&amp;);</span>
<span class="line-modified"> 38 WEBCORE_EXPORT JSC::JSValue forwardForEachCallToBackingMap(JSDOMGlobalObject&amp;, JSC::CallFrame&amp;, JSC::JSObject&amp;);</span>
<span class="line-modified"> 39 WEBCORE_EXPORT void clearBackingMap(JSC::JSGlobalObject&amp;, JSC::JSObject&amp;);</span>
<span class="line-modified"> 40 WEBCORE_EXPORT void setToBackingMap(JSC::JSGlobalObject&amp;, JSC::JSObject&amp;, JSC::JSValue, JSC::JSValue);</span>
<span class="line-modified"> 41 </span>
<span class="line-modified"> 42 template&lt;typename WrapperClass&gt; JSC::JSValue forwardSizeToMapLike(JSC::JSGlobalObject&amp;, WrapperClass&amp;);</span>
<span class="line-modified"> 43 template&lt;typename WrapperClass&gt; JSC::JSValue forwardEntriesToMapLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;);</span>
<span class="line-modified"> 44 template&lt;typename WrapperClass&gt; JSC::JSValue forwardKeysToMapLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;);</span>
<span class="line-modified"> 45 template&lt;typename WrapperClass&gt; JSC::JSValue forwardValuesToMapLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;);</span>
<span class="line-modified"> 46 template&lt;typename WrapperClass&gt; JSC::JSValue forwardClearToMapLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;);</span>
<span class="line-modified"> 47 template&lt;typename WrapperClass, typename Callback&gt; JSC::JSValue forwardForEachToMapLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;, Callback&amp;&amp;);</span>
<span class="line-modified"> 48 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardGetToMapLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;, ItemType&amp;&amp;);</span>
<span class="line-modified"> 49 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardHasToMapLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;, ItemType&amp;&amp;);</span>
<span class="line-modified"> 50 template&lt;typename WrapperClass, typename ItemType, typename ValueType&gt; JSC::JSValue forwardSetToMapLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;, ItemType&amp;&amp;, ValueType&amp;&amp;);</span>
<span class="line-modified"> 51 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardDeleteToMapLike(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, WrapperClass&amp;, ItemType&amp;&amp;);</span>
<span class="line-modified"> 52 </span>
<span class="line-modified"> 53 class DOMMapAdapter {</span>
 54 public:
<a name="4" id="anc4"></a><span class="line-modified"> 55     DOMMapAdapter(JSC::JSGlobalObject&amp;, JSC::JSObject&amp;);</span>
<span class="line-added"> 56     template&lt;typename IDLKeyType, typename IDLValueType&gt; void set(typename IDLKeyType::ParameterType, typename IDLValueType::ParameterType);</span>
<span class="line-added"> 57     void clear();</span>
 58 
<a name="5" id="anc5"></a><span class="line-modified"> 59 private:</span>
<span class="line-modified"> 60     JSC::JSGlobalObject&amp; m_lexicalGlobalObject;</span>
<span class="line-modified"> 61     JSC::JSObject&amp; m_backingMap;</span>



 62 };
 63 
<a name="6" id="anc6"></a><span class="line-modified"> 64 inline DOMMapAdapter::DOMMapAdapter(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::JSObject&amp; backingMap)</span>
<span class="line-added"> 65     : m_lexicalGlobalObject(lexicalGlobalObject)</span>
<span class="line-added"> 66     , m_backingMap(backingMap)</span>
 67 {
<a name="7" id="anc7"></a>






 68 }
 69 
<a name="8" id="anc8"></a><span class="line-modified"> 70 template&lt;typename IDLKeyType, typename IDLValueType&gt;</span>
<span class="line-added"> 71 void DOMMapAdapter::set(typename IDLKeyType::ParameterType key, typename IDLValueType::ParameterType value)</span>
 72 {
<a name="9" id="anc9"></a><span class="line-modified"> 73     JSC::JSLockHolder locker(&amp;m_lexicalGlobalObject);</span>
<span class="line-modified"> 74     auto jsKey = toJS&lt;IDLKeyType&gt;(m_lexicalGlobalObject, *JSC::jsCast&lt;JSDOMGlobalObject*&gt;(&amp;m_lexicalGlobalObject), std::forward&lt;typename IDLKeyType::ParameterType&gt;(key));</span>
<span class="line-modified"> 75     auto jsValue = toJS&lt;IDLValueType&gt;(m_lexicalGlobalObject, *JSC::jsCast&lt;JSDOMGlobalObject*&gt;(&amp;m_lexicalGlobalObject), std::forward&lt;typename IDLValueType::ParameterType&gt;(value));</span>
<span class="line-modified"> 76     setToBackingMap(m_lexicalGlobalObject, m_backingMap, jsKey, jsValue);</span>
<span class="line-modified"> 77 }</span>
<span class="line-added"> 78 </span>
<span class="line-added"> 79 template&lt;typename WrapperClass&gt; JSC::JSObject&amp; getAndInitializeBackingMap(JSC::JSGlobalObject&amp; lexicalGlobalObject, WrapperClass&amp; mapLike)</span>
<span class="line-added"> 80 {</span>
<span class="line-added"> 81     auto pair = getBackingMap(lexicalGlobalObject, mapLike);</span>
<span class="line-added"> 82     if (pair.first) {</span>
<span class="line-added"> 83         DOMMapAdapter adapter { lexicalGlobalObject, pair.second.get() };</span>
<span class="line-added"> 84         mapLike.wrapped().initializeMapLike(adapter);</span>
 85     }
<a name="10" id="anc10"></a><span class="line-modified"> 86     return pair.second.get();</span>

 87 }
 88 
<a name="11" id="anc11"></a><span class="line-modified"> 89 template&lt;typename WrapperClass&gt; JSC::JSValue forwardSizeToMapLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, WrapperClass&amp; mapLike)</span>
 90 {
<a name="12" id="anc12"></a><span class="line-modified"> 91     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);</span>
<span class="line-modified"> 92     return forwardAttributeGetterToBackingMap(lexicalGlobalObject, getAndInitializeBackingMap(lexicalGlobalObject, mapLike), vm.propertyNames-&gt;size);</span>
 93 }
 94 
<a name="13" id="anc13"></a><span class="line-modified"> 95 template&lt;typename WrapperClass&gt; JSC::JSValue forwardEntriesToMapLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; mapLike)</span>
 96 {
<a name="14" id="anc14"></a><span class="line-modified"> 97     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);</span>
<span class="line-modified"> 98     return forwardFunctionCallToBackingMap(lexicalGlobalObject, callFrame, getAndInitializeBackingMap(lexicalGlobalObject, mapLike), vm.propertyNames-&gt;builtinNames().entriesPublicName());</span>
 99 }
100 
<a name="15" id="anc15"></a><span class="line-modified">101 template&lt;typename WrapperClass&gt; JSC::JSValue forwardKeysToMapLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; mapLike)</span>
102 {
<a name="16" id="anc16"></a><span class="line-modified">103     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);</span>
<span class="line-modified">104     return forwardFunctionCallToBackingMap(lexicalGlobalObject, callFrame, getAndInitializeBackingMap(lexicalGlobalObject, mapLike), vm.propertyNames-&gt;builtinNames().keysPublicName());</span>
105 }
106 
<a name="17" id="anc17"></a><span class="line-modified">107 template&lt;typename WrapperClass&gt; JSC::JSValue forwardValuesToMapLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; mapLike)</span>
108 {
<a name="18" id="anc18"></a><span class="line-modified">109     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);</span>
<span class="line-modified">110     return forwardFunctionCallToBackingMap(lexicalGlobalObject, callFrame, getAndInitializeBackingMap(lexicalGlobalObject, mapLike), vm.propertyNames-&gt;builtinNames().valuesPublicName());</span>
111 }
112 
<a name="19" id="anc19"></a><span class="line-modified">113 template&lt;typename WrapperClass&gt; JSC::JSValue forwardClearToMapLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; mapLike)</span>
114 {
115     mapLike.wrapped().clear();
<a name="20" id="anc20"></a><span class="line-modified">116     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);</span>
<span class="line-added">117     return forwardFunctionCallToBackingMap(lexicalGlobalObject, callFrame, getAndInitializeBackingMap(lexicalGlobalObject, mapLike), vm.propertyNames-&gt;clear);</span>
118 }
119 
<a name="21" id="anc21"></a><span class="line-modified">120 template&lt;typename WrapperClass, typename Callback&gt; JSC::JSValue forwardForEachToMapLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; mapLike, Callback&amp;&amp;)</span>
121 {
<a name="22" id="anc22"></a><span class="line-modified">122     getAndInitializeBackingMap(lexicalGlobalObject, mapLike);</span>
<span class="line-added">123     return forwardForEachCallToBackingMap(*JSC::jsCast&lt;JSDOMGlobalObject*&gt;(&amp;lexicalGlobalObject), callFrame, mapLike);</span>
124 }
125 
<a name="23" id="anc23"></a><span class="line-modified">126 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardGetToMapLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; mapLike, ItemType&amp;&amp;)</span>
127 {
<a name="24" id="anc24"></a><span class="line-modified">128     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);</span>
<span class="line-modified">129     return forwardFunctionCallToBackingMap(lexicalGlobalObject, callFrame, getAndInitializeBackingMap(lexicalGlobalObject, mapLike), vm.propertyNames-&gt;builtinNames().getPublicName());</span>
130 }
131 
<a name="25" id="anc25"></a><span class="line-modified">132 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardHasToMapLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; mapLike, ItemType&amp;&amp;)</span>
133 {
<a name="26" id="anc26"></a><span class="line-modified">134     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);</span>
<span class="line-modified">135     return forwardFunctionCallToBackingMap(lexicalGlobalObject, callFrame, getAndInitializeBackingMap(lexicalGlobalObject, mapLike), vm.propertyNames-&gt;builtinNames().hasPublicName());</span>
136 }
137 
<a name="27" id="anc27"></a><span class="line-modified">138 template&lt;typename WrapperClass, typename KeyType, typename ValueType&gt; JSC::JSValue forwardSetToMapLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; mapLike, KeyType&amp;&amp; key, ValueType&amp;&amp; value)</span>
139 {
<a name="28" id="anc28"></a><span class="line-modified">140     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);</span>
<span class="line-modified">141     mapLike.wrapped().setFromMapLike(std::forward&lt;KeyType&gt;(key), std::forward&lt;ValueType&gt;(value));</span>
<span class="line-added">142     forwardFunctionCallToBackingMap(lexicalGlobalObject, callFrame, getAndInitializeBackingMap(lexicalGlobalObject, mapLike), vm.propertyNames-&gt;set);</span>
143     return &amp;mapLike;
144 }
145 
<a name="29" id="anc29"></a><span class="line-modified">146 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardDeleteToMapLike(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, WrapperClass&amp; mapLike, ItemType&amp;&amp; item)</span>
147 {
148     auto isDeleted = mapLike.wrapped().remove(std::forward&lt;ItemType&gt;(item));
149     UNUSED_PARAM(isDeleted);
<a name="30" id="anc30"></a><span class="line-modified">150 </span>
<span class="line-added">151     auto&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);</span>
<span class="line-added">152     auto result = forwardFunctionCallToBackingMap(lexicalGlobalObject, callFrame, getAndInitializeBackingMap(lexicalGlobalObject, mapLike), vm.propertyNames-&gt;deleteKeyword);</span>
<span class="line-added">153 </span>
154     ASSERT_UNUSED(result, result.asBoolean() == isDeleted);
155     return result;
156 }
157 
158 }
<a name="31" id="anc31"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="31" type="hidden" />
</body>
</html>