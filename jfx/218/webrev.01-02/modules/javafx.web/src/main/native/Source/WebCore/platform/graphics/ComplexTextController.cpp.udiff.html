<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/ComplexTextController.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ColorSpace.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ComplexTextController.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/ComplexTextController.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (C) 2007, 2008, 2009, 2010, 2011 Apple Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2007-2019 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -41,32 +41,10 @@</span>
  #include &lt;CoreText/CoreText.h&gt;
  #endif
  
  namespace WebCore {
  
<span class="udiff-line-removed">- #if PLATFORM(WIN)</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- class TextLayout {</span>
<span class="udiff-line-removed">- };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- void TextLayoutDeleter::operator()(TextLayout*) const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- std::unique_ptr&lt;TextLayout, TextLayoutDeleter&gt; FontCascade::createLayout(RenderText&amp;, float, bool) const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return nullptr;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- float FontCascade::width(TextLayout&amp;, unsigned, unsigned, HashSet&lt;const Font*&gt;*)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT_NOT_REACHED();</span>
<span class="udiff-line-removed">-     return 0;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #else</span>
<span class="udiff-line-removed">- </span>
  class TextLayout {
      WTF_MAKE_FAST_ALLOCATED;
  public:
      static bool isNeeded(RenderText&amp; text, const FontCascade&amp; font)
      {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -144,14 +122,10 @@</span>
      , m_end(run.length())
      , m_expansion(run.expansion())
      , m_mayUseNaturalWritingDirection(mayUseNaturalWritingDirection)
      , m_forTextEmphasis(forTextEmphasis)
  {
<span class="udiff-line-removed">- #if PLATFORM(WIN)</span>
<span class="udiff-line-removed">-     ASSERT_NOT_REACHED();</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
      computeExpansionOpportunity();
  
      collectComplexTextRuns();
  
      finishConstruction();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -187,11 +161,11 @@</span>
      }
  }
  
  unsigned ComplexTextController::offsetForPosition(float h, bool includePartialGlyphs)
  {
<span class="udiff-line-modified-removed">-     if (h &gt;= m_totalWidth)</span>
<span class="udiff-line-modified-added">+     if (h &gt;= m_totalAdvance.width())</span>
          return m_run.ltr() ? m_end : 0;
  
      if (h &lt; 0)
          return m_run.ltr() ? 0 : m_end;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -757,11 +731,11 @@</span>
              bool treatAsSpace = FontCascade::treatAsSpace(ch);
              CGGlyph glyph = treatAsSpace ? font.spaceGlyph() : glyphs[i];
              FloatSize advance = treatAsSpace ? FloatSize(spaceWidth, advances[i].height()) : advances[i];
  
              if (ch == &#39;\t&#39; &amp;&amp; m_run.allowTabs())
<span class="udiff-line-modified-removed">-                 advance.setWidth(m_font.tabWidth(font, m_run.tabSize(), m_run.xPos() + m_totalWidth));</span>
<span class="udiff-line-modified-added">+                 advance.setWidth(m_font.tabWidth(font, m_run.tabSize(), m_run.xPos() + m_totalAdvance.width()));</span>
              else if (FontCascade::treatAsZeroWidthSpace(ch) &amp;&amp; !treatAsSpace) {
                  advance.setWidth(0);
                  glyph = font.spaceGlyph();
              }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -794,11 +768,12 @@</span>
                  if (runForbidsLeadingExpansion)
                      forbidLeadingExpansion = m_run.ltr() ? isFirstCharacter : isLastCharacter;
                  if (runForbidsTrailingExpansion)
                      forbidTrailingExpansion = m_run.ltr() ? isLastCharacter : isFirstCharacter;
                  // Handle justification and word-spacing.
<span class="udiff-line-modified-removed">-                 bool ideograph = FontCascade::isCJKIdeographOrSymbol(ch);</span>
<span class="udiff-line-modified-added">+                 static bool expandAroundIdeographs = FontCascade::canExpandAroundIdeographsInComplexText();</span>
<span class="udiff-line-added">+                 bool ideograph = expandAroundIdeographs &amp;&amp; FontCascade::isCJKIdeographOrSymbol(ch);</span>
                  if (treatAsSpace || ideograph || forceLeadingExpansion || forceTrailingExpansion) {
                      // Distribute the run&#39;s total expansion evenly over all expansion opportunities in the run.
                      if (m_expansion) {
                          auto [expandLeft, expandRight] = expansionLocation(ideograph, treatAsSpace, m_run.ltr(), afterExpansion, forbidLeadingExpansion, forbidTrailingExpansion, forceLeadingExpansion, forceTrailingExpansion);
                          if (expandLeft) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -807,11 +782,11 @@</span>
                              if (m_adjustedBaseAdvances.isEmpty()) {
                                  advance.expand(m_expansionPerOpportunity, 0);
                                  complexTextRun.growInitialAdvanceHorizontally(m_expansionPerOpportunity);
                              } else {
                                  m_adjustedBaseAdvances.last().expand(m_expansionPerOpportunity, 0);
<span class="udiff-line-modified-removed">-                                 m_totalWidth += m_expansionPerOpportunity;</span>
<span class="udiff-line-modified-added">+                                 m_totalAdvance.expand(m_expansionPerOpportunity, 0);</span>
                              }
                          }
                          if (expandRight) {
                              m_expansion -= m_expansionPerOpportunity;
                              advance.expand(m_expansionPerOpportunity, 0);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -825,11 +800,11 @@</span>
                          advance.expand(m_font.wordSpacing(), 0);
                  } else
                      afterExpansion = false;
              }
  
<span class="udiff-line-modified-removed">-             m_totalWidth += advance.width();</span>
<span class="udiff-line-modified-added">+             m_totalAdvance += advance;</span>
  
              // FIXME: Combining marks should receive a text emphasis mark if they are combine with a space.
              if (m_forTextEmphasis &amp;&amp; (!FontCascade::canReceiveTextEmphasis(ch) || (U_GET_GC_MASK(ch) &amp; U_GC_M_MASK)))
                  glyph = 0;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -902,8 +877,6 @@</span>
      , m_stringLocation(stringLocation)
      , m_isLTR(ltr)
  {
  }
  
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
  } // namespace WebCore
</pre>
<center><a href="ColorSpace.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ComplexTextController.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>