<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/parser/SourceProviderCacheItem.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SourceProviderCache.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SyntaxChecker.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/parser/SourceProviderCacheItem.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 40     unsigned lastTokenLineStartOffset;
 41     unsigned endFunctionOffset;
 42     unsigned parameterCount;
 43     bool needsFullActivation;
 44     bool usesEval;
 45     bool strictMode;
 46     bool needsSuperBinding;
 47     InnerArrowFunctionCodeFeatures innerArrowFunctionFeatures;
 48     Vector&lt;UniquedStringImpl*, 8&gt; usedVariables;
 49     bool isBodyArrowExpression { false };
 50     JSTokenType tokenType { CLOSEBRACE };
 51     ConstructorKind constructorKind;
 52     SuperBinding expectedSuperBinding;
 53 };
 54 
 55 #if COMPILER(MSVC)
 56 #pragma warning(push)
 57 #pragma warning(disable: 4200) // Disable &quot;zero-sized array in struct/union&quot; warning
 58 #endif
 59 

 60 class SourceProviderCacheItem {
<span class="line-modified"> 61     WTF_MAKE_FAST_ALLOCATED;</span>
 62 public:
 63     static std::unique_ptr&lt;SourceProviderCacheItem&gt; create(const SourceProviderCacheItemCreationParameters&amp;);
 64     ~SourceProviderCacheItem();
 65 
 66     JSToken endFunctionToken() const
 67     {
 68         JSToken token;
 69         token.m_type = isBodyArrowExpression ? static_cast&lt;JSTokenType&gt;(tokenType) : CLOSEBRACE;
 70         token.m_data.offset = lastTokenStartOffset;
 71         token.m_location.startOffset = lastTokenStartOffset;
 72         token.m_location.endOffset = lastTokenEndOffset;
 73         token.m_location.line = lastTokenLine;
 74         token.m_location.lineStartOffset = lastTokenLineStartOffset;
 75         // token.m_location.sourceOffset is initialized once by the client. So,
 76         // we do not need to set it here.
 77         return token;
 78     }
 79 
 80     bool needsFullActivation : 1;
 81     unsigned endFunctionOffset : 31;
 82     bool usesEval : 1;
 83     unsigned lastTokenLine : 31;
 84     bool strictMode : 1;
 85     unsigned lastTokenStartOffset : 31;
 86     unsigned expectedSuperBinding : 1; // SuperBinding
 87     unsigned lastTokenEndOffset: 31;
 88     bool needsSuperBinding: 1;
 89     unsigned parameterCount : 31;
 90     unsigned lastTokenLineStartOffset : 31;
 91     bool isBodyArrowExpression : 1;
 92     unsigned usedVariablesCount;
 93     unsigned tokenType : 24; // JSTokenType
 94     unsigned innerArrowFunctionFeatures : 6; // InnerArrowFunctionCodeFeatures
 95     unsigned constructorKind : 2; // ConstructorKind
 96 
<span class="line-modified"> 97     UniquedStringImpl** usedVariables() const { return const_cast&lt;UniquedStringImpl**&gt;(m_variables); }</span>
 98 
 99 private:
100     SourceProviderCacheItem(const SourceProviderCacheItemCreationParameters&amp;);
101 
<span class="line-modified">102     UniquedStringImpl* m_variables[0];</span>
103 };
104 
105 inline SourceProviderCacheItem::~SourceProviderCacheItem()
106 {
107     for (unsigned i = 0; i &lt; usedVariablesCount; ++i)
108         m_variables[i]-&gt;deref();
109 }
110 
111 inline std::unique_ptr&lt;SourceProviderCacheItem&gt; SourceProviderCacheItem::create(const SourceProviderCacheItemCreationParameters&amp; parameters)
112 {
113     size_t variableCount = parameters.usedVariables.size();
114     size_t objectSize = sizeof(SourceProviderCacheItem) + sizeof(UniquedStringImpl*) * variableCount;
<span class="line-modified">115     void* slot = fastMalloc(objectSize);</span>
116     return std::unique_ptr&lt;SourceProviderCacheItem&gt;(new (slot) SourceProviderCacheItem(parameters));
117 }
118 
119 inline SourceProviderCacheItem::SourceProviderCacheItem(const SourceProviderCacheItemCreationParameters&amp; parameters)
120     : needsFullActivation(parameters.needsFullActivation)
121     , endFunctionOffset(parameters.endFunctionOffset)
122     , usesEval(parameters.usesEval)
123     , lastTokenLine(parameters.lastTokenLine)
124     , strictMode(parameters.strictMode)
125     , lastTokenStartOffset(parameters.lastTokenStartOffset)
126     , expectedSuperBinding(static_cast&lt;unsigned&gt;(parameters.expectedSuperBinding))
127     , lastTokenEndOffset(parameters.lastTokenEndOffset)
128     , needsSuperBinding(parameters.needsSuperBinding)
129     , parameterCount(parameters.parameterCount)
130     , lastTokenLineStartOffset(parameters.lastTokenLineStartOffset)
131     , isBodyArrowExpression(parameters.isBodyArrowExpression)
132     , usedVariablesCount(parameters.usedVariables.size())
133     , tokenType(static_cast&lt;unsigned&gt;(parameters.tokenType))
134     , innerArrowFunctionFeatures(static_cast&lt;unsigned&gt;(parameters.innerArrowFunctionFeatures))
135     , constructorKind(static_cast&lt;unsigned&gt;(parameters.constructorKind))
136 {
137     ASSERT(tokenType == static_cast&lt;unsigned&gt;(parameters.tokenType));
138     ASSERT(innerArrowFunctionFeatures == static_cast&lt;unsigned&gt;(parameters.innerArrowFunctionFeatures));
139     ASSERT(constructorKind == static_cast&lt;unsigned&gt;(parameters.constructorKind));
140     ASSERT(expectedSuperBinding == static_cast&lt;unsigned&gt;(parameters.expectedSuperBinding));
141     for (unsigned i = 0; i &lt; usedVariablesCount; ++i) {
<span class="line-modified">142         m_variables[i] = parameters.usedVariables[i];</span>
<span class="line-modified">143         m_variables[i]-&gt;ref();</span>

144     }
145 }
146 
147 #if COMPILER(MSVC)
148 #pragma warning(pop)
149 #endif
150 
151 } // namespace JSC
</pre>
</td>
<td>
<hr />
<pre>
 40     unsigned lastTokenLineStartOffset;
 41     unsigned endFunctionOffset;
 42     unsigned parameterCount;
 43     bool needsFullActivation;
 44     bool usesEval;
 45     bool strictMode;
 46     bool needsSuperBinding;
 47     InnerArrowFunctionCodeFeatures innerArrowFunctionFeatures;
 48     Vector&lt;UniquedStringImpl*, 8&gt; usedVariables;
 49     bool isBodyArrowExpression { false };
 50     JSTokenType tokenType { CLOSEBRACE };
 51     ConstructorKind constructorKind;
 52     SuperBinding expectedSuperBinding;
 53 };
 54 
 55 #if COMPILER(MSVC)
 56 #pragma warning(push)
 57 #pragma warning(disable: 4200) // Disable &quot;zero-sized array in struct/union&quot; warning
 58 #endif
 59 
<span class="line-added"> 60 DECLARE_ALLOCATOR_WITH_HEAP_IDENTIFIER(SourceProviderCacheItem);</span>
 61 class SourceProviderCacheItem {
<span class="line-modified"> 62     WTF_MAKE_STRUCT_FAST_ALLOCATED_WITH_HEAP_IDENTIFIER(SourceProviderCacheItem);</span>
 63 public:
 64     static std::unique_ptr&lt;SourceProviderCacheItem&gt; create(const SourceProviderCacheItemCreationParameters&amp;);
 65     ~SourceProviderCacheItem();
 66 
 67     JSToken endFunctionToken() const
 68     {
 69         JSToken token;
 70         token.m_type = isBodyArrowExpression ? static_cast&lt;JSTokenType&gt;(tokenType) : CLOSEBRACE;
 71         token.m_data.offset = lastTokenStartOffset;
 72         token.m_location.startOffset = lastTokenStartOffset;
 73         token.m_location.endOffset = lastTokenEndOffset;
 74         token.m_location.line = lastTokenLine;
 75         token.m_location.lineStartOffset = lastTokenLineStartOffset;
 76         // token.m_location.sourceOffset is initialized once by the client. So,
 77         // we do not need to set it here.
 78         return token;
 79     }
 80 
 81     bool needsFullActivation : 1;
 82     unsigned endFunctionOffset : 31;
 83     bool usesEval : 1;
 84     unsigned lastTokenLine : 31;
 85     bool strictMode : 1;
 86     unsigned lastTokenStartOffset : 31;
 87     unsigned expectedSuperBinding : 1; // SuperBinding
 88     unsigned lastTokenEndOffset: 31;
 89     bool needsSuperBinding: 1;
 90     unsigned parameterCount : 31;
 91     unsigned lastTokenLineStartOffset : 31;
 92     bool isBodyArrowExpression : 1;
 93     unsigned usedVariablesCount;
 94     unsigned tokenType : 24; // JSTokenType
 95     unsigned innerArrowFunctionFeatures : 6; // InnerArrowFunctionCodeFeatures
 96     unsigned constructorKind : 2; // ConstructorKind
 97 
<span class="line-modified"> 98     PackedPtr&lt;UniquedStringImpl&gt;* usedVariables() const { return const_cast&lt;PackedPtr&lt;UniquedStringImpl&gt;*&gt;(m_variables); }</span>
 99 
100 private:
101     SourceProviderCacheItem(const SourceProviderCacheItemCreationParameters&amp;);
102 
<span class="line-modified">103     PackedPtr&lt;UniquedStringImpl&gt; m_variables[0];</span>
104 };
105 
106 inline SourceProviderCacheItem::~SourceProviderCacheItem()
107 {
108     for (unsigned i = 0; i &lt; usedVariablesCount; ++i)
109         m_variables[i]-&gt;deref();
110 }
111 
112 inline std::unique_ptr&lt;SourceProviderCacheItem&gt; SourceProviderCacheItem::create(const SourceProviderCacheItemCreationParameters&amp; parameters)
113 {
114     size_t variableCount = parameters.usedVariables.size();
115     size_t objectSize = sizeof(SourceProviderCacheItem) + sizeof(UniquedStringImpl*) * variableCount;
<span class="line-modified">116     void* slot = SourceProviderCacheItemMalloc::malloc(objectSize);</span>
117     return std::unique_ptr&lt;SourceProviderCacheItem&gt;(new (slot) SourceProviderCacheItem(parameters));
118 }
119 
120 inline SourceProviderCacheItem::SourceProviderCacheItem(const SourceProviderCacheItemCreationParameters&amp; parameters)
121     : needsFullActivation(parameters.needsFullActivation)
122     , endFunctionOffset(parameters.endFunctionOffset)
123     , usesEval(parameters.usesEval)
124     , lastTokenLine(parameters.lastTokenLine)
125     , strictMode(parameters.strictMode)
126     , lastTokenStartOffset(parameters.lastTokenStartOffset)
127     , expectedSuperBinding(static_cast&lt;unsigned&gt;(parameters.expectedSuperBinding))
128     , lastTokenEndOffset(parameters.lastTokenEndOffset)
129     , needsSuperBinding(parameters.needsSuperBinding)
130     , parameterCount(parameters.parameterCount)
131     , lastTokenLineStartOffset(parameters.lastTokenLineStartOffset)
132     , isBodyArrowExpression(parameters.isBodyArrowExpression)
133     , usedVariablesCount(parameters.usedVariables.size())
134     , tokenType(static_cast&lt;unsigned&gt;(parameters.tokenType))
135     , innerArrowFunctionFeatures(static_cast&lt;unsigned&gt;(parameters.innerArrowFunctionFeatures))
136     , constructorKind(static_cast&lt;unsigned&gt;(parameters.constructorKind))
137 {
138     ASSERT(tokenType == static_cast&lt;unsigned&gt;(parameters.tokenType));
139     ASSERT(innerArrowFunctionFeatures == static_cast&lt;unsigned&gt;(parameters.innerArrowFunctionFeatures));
140     ASSERT(constructorKind == static_cast&lt;unsigned&gt;(parameters.constructorKind));
141     ASSERT(expectedSuperBinding == static_cast&lt;unsigned&gt;(parameters.expectedSuperBinding));
142     for (unsigned i = 0; i &lt; usedVariablesCount; ++i) {
<span class="line-modified">143         auto* pointer = parameters.usedVariables[i];</span>
<span class="line-modified">144         pointer-&gt;ref();</span>
<span class="line-added">145         m_variables[i] = pointer;</span>
146     }
147 }
148 
149 #if COMPILER(MSVC)
150 #pragma warning(pop)
151 #endif
152 
153 } // namespace JSC
</pre>
</td>
</tr>
</table>
<center><a href="SourceProviderCache.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SyntaxChecker.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>