<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/SpeculatedType.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="RecordedStatuses.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SpeculatedType.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/SpeculatedType.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -27,10 +27,11 @@</span>
   */
  
  #include &quot;config.h&quot;
  #include &quot;SpeculatedType.h&quot;
  
<span class="udiff-line-added">+ #include &quot;DateInstance.h&quot;</span>
  #include &quot;DirectArguments.h&quot;
  #include &quot;JSArray.h&quot;
  #include &quot;JSBigInt.h&quot;
  #include &quot;JSBoundFunction.h&quot;
  #include &quot;JSCInlines.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -172,10 +173,20 @@</span>
              if (value &amp; SpecRegExpObject)
                  strOut.print(&quot;RegExpObject&quot;);
              else
                  isTop = false;
  
<span class="udiff-line-added">+             if (value &amp; SpecDateObject)</span>
<span class="udiff-line-added">+                 strOut.print(&quot;DateObject&quot;);</span>
<span class="udiff-line-added">+             else</span>
<span class="udiff-line-added">+                 isTop = false;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             if (value &amp; SpecPromiseObject)</span>
<span class="udiff-line-added">+                 strOut.print(&quot;PromiseObject&quot;);</span>
<span class="udiff-line-added">+             else</span>
<span class="udiff-line-added">+                 isTop = false;</span>
<span class="udiff-line-added">+ </span>
              if (value &amp; SpecMapObject)
                  strOut.print(&quot;MapObject&quot;);
              else
                  isTop = false;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -261,17 +272,17 @@</span>
              strOut.print(&quot;NonIntAsDouble&quot;);
          else
              isTop = false;
  
          if (value &amp; SpecDoublePureNaN)
<span class="udiff-line-modified-removed">-             strOut.print(&quot;DoublePureNan&quot;);</span>
<span class="udiff-line-modified-added">+             strOut.print(&quot;DoublePureNaN&quot;);</span>
          else
              isTop = false;
      }
  
      if (value &amp; SpecDoubleImpureNaN)
<span class="udiff-line-modified-removed">-         out.print(&quot;DoubleImpureNan&quot;);</span>
<span class="udiff-line-modified-added">+         strOut.print(&quot;DoubleImpureNaN&quot;);</span>
  
      if (value &amp; SpecBoolean)
          strOut.print(&quot;Bool&quot;);
      else
          isTop = false;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -438,10 +449,13 @@</span>
          return SpecStringObject;
  
      if (classInfo == RegExpObject::info())
          return SpecRegExpObject;
  
<span class="udiff-line-added">+     if (classInfo == DateInstance::info())</span>
<span class="udiff-line-added">+         return SpecDateObject;</span>
<span class="udiff-line-added">+ </span>
      if (classInfo == JSMap::info())
          return SpecMapObject;
  
      if (classInfo == JSSet::info())
          return SpecSetObject;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -462,10 +476,13 @@</span>
          if (classInfo == JSBoundFunction::info())
              return SpecFunctionWithNonDefaultHasInstance;
          return SpecFunctionWithDefaultHasInstance;
      }
  
<span class="udiff-line-added">+     if (classInfo-&gt;isSubClassOf(JSPromise::info()))</span>
<span class="udiff-line-added">+         return SpecPromiseObject;</span>
<span class="udiff-line-added">+ </span>
      if (isTypedView(classInfo-&gt;typedArrayStorageType))
          return speculationFromTypedArrayType(classInfo-&gt;typedArrayStorageType);
  
      if (classInfo-&gt;isSubClassOf(JSArray::info()))
          return SpecDerivedArray;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -569,11 +586,11 @@</span>
          return TypeFloat64;
  
      return NotTypedArray;
  }
  
<span class="udiff-line-modified-removed">- SpeculatedType speculationFromJSType(JSType type)</span>
<span class="udiff-line-modified-added">+ Optional&lt;SpeculatedType&gt; speculationFromJSType(JSType type)</span>
  {
      switch (type) {
      case StringType:
          return SpecString;
      case SymbolType:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -584,12 +601,16 @@</span>
          return SpecArray;
      case DerivedArrayType:
          return SpecDerivedArray;
      case RegExpObjectType:
          return SpecRegExpObject;
<span class="udiff-line-added">+     case JSDateType:</span>
<span class="udiff-line-added">+         return SpecDateObject;</span>
      case ProxyObjectType:
          return SpecProxyObject;
<span class="udiff-line-added">+     case JSPromiseType:</span>
<span class="udiff-line-added">+         return SpecPromiseObject;</span>
      case JSMapType:
          return SpecMapObject;
      case JSSetType:
          return SpecSetObject;
      case JSWeakMapType:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -597,13 +618,12 @@</span>
      case JSWeakSetType:
          return SpecWeakSetObject;
      case DataViewType:
          return SpecDataViewObject;
      default:
<span class="udiff-line-modified-removed">-         ASSERT_NOT_REACHED();</span>
<span class="udiff-line-modified-added">+         return WTF::nullopt;</span>
      }
<span class="udiff-line-removed">-     return SpecNone;</span>
  }
  
  SpeculatedType leastUpperBoundOfStrictlyEquivalentSpeculations(SpeculatedType type)
  {
      // SpecNonIntAsDouble includes negative zero (-0.0), which can be equal to 0 and 0.0 in the context of == and ===.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -613,14 +633,25 @@</span>
      if (type &amp; SpecString)
          type |= SpecString;
      return type;
  }
  
<span class="udiff-line-added">+ static inline SpeculatedType leastUpperBoundOfEquivalentSpeculations(SpeculatedType type)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     type = leastUpperBoundOfStrictlyEquivalentSpeculations(type);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // Boolean or BigInt can be converted to Number when performing non-strict equal.</span>
<span class="udiff-line-added">+     if (type &amp; (SpecIntAnyFormat | SpecNonIntAsDouble | SpecBoolean | SpecBigInt))</span>
<span class="udiff-line-added">+         type |= (SpecIntAnyFormat | SpecNonIntAsDouble | SpecBoolean | SpecBigInt);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return type;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  bool valuesCouldBeEqual(SpeculatedType a, SpeculatedType b)
  {
<span class="udiff-line-modified-removed">-     a = leastUpperBoundOfStrictlyEquivalentSpeculations(a);</span>
<span class="udiff-line-modified-removed">-     b = leastUpperBoundOfStrictlyEquivalentSpeculations(b);</span>
<span class="udiff-line-modified-added">+     a = leastUpperBoundOfEquivalentSpeculations(a);</span>
<span class="udiff-line-modified-added">+     b = leastUpperBoundOfEquivalentSpeculations(b);</span>
  
      // Anything could be equal to a string.
      if (a &amp; SpecString)
          return true;
      if (b &amp; SpecString)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -670,10 +701,21 @@</span>
  SpeculatedType typeOfDoubleDifference(SpeculatedType a, SpeculatedType b)
  {
      return typeOfDoubleSumOrDifferenceOrProduct(a, b);
  }
  
<span class="udiff-line-added">+ SpeculatedType typeOfDoubleIncOrDec(SpeculatedType t)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     // Impure NaN could become pure NaN during addition because addition may clear bits.</span>
<span class="udiff-line-added">+     if (t &amp; SpecDoubleImpureNaN)</span>
<span class="udiff-line-added">+         t |= SpecDoublePureNaN;</span>
<span class="udiff-line-added">+     // Values could overflow, or fractions could become integers.</span>
<span class="udiff-line-added">+     if (t &amp; SpecDoubleReal)</span>
<span class="udiff-line-added">+         t |= SpecDoubleReal;</span>
<span class="udiff-line-added">+     return t;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  SpeculatedType typeOfDoubleProduct(SpeculatedType a, SpeculatedType b)
  {
      return typeOfDoubleSumOrDifferenceOrProduct(a, b);
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -792,10 +834,14 @@</span>
          return SpecScopedArguments;
      if (!strncmp(speculation, &quot;SpecStringObject&quot;, strlen(&quot;SpecStringObject&quot;)))
          return SpecStringObject;
      if (!strncmp(speculation, &quot;SpecRegExpObject&quot;, strlen(&quot;SpecRegExpObject&quot;)))
          return SpecRegExpObject;
<span class="udiff-line-added">+     if (!strncmp(speculation, &quot;SpecDateObject&quot;, strlen(&quot;SpecDateObject&quot;)))</span>
<span class="udiff-line-added">+         return SpecDateObject;</span>
<span class="udiff-line-added">+     if (!strncmp(speculation, &quot;SpecPromiseObject&quot;, strlen(&quot;SpecPromiseObject&quot;)))</span>
<span class="udiff-line-added">+         return SpecPromiseObject;</span>
      if (!strncmp(speculation, &quot;SpecMapObject&quot;, strlen(&quot;SpecMapObject&quot;)))
          return SpecMapObject;
      if (!strncmp(speculation, &quot;SpecSetObject&quot;, strlen(&quot;SpecSetObject&quot;)))
          return SpecSetObject;
      if (!strncmp(speculation, &quot;SpecWeakMapObject&quot;, strlen(&quot;SpecWeakMapObject&quot;)))
</pre>
<center><a href="RecordedStatuses.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SpeculatedType.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>