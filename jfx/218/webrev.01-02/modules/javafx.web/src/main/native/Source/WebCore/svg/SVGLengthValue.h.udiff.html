<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/svg/SVGLengthValue.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SVGLengthValue.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SVGLineElement.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/svg/SVGLengthValue.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,8 +1,9 @@</span>
  /*
   * Copyright (C) 2004, 2005, 2006, 2008 Nikolas Zimmermann &lt;zimmermann@kde.org&gt;
   * Copyright (C) 2004, 2005, 2006 Rob Buis &lt;buis@kde.org&gt;
<span class="udiff-line-added">+  * Copyright (C) 2019 Apple Inc. All rights reserved.</span>
   *
   * This library is free software; you can redistribute it and/or
   * modify it under the terms of the GNU Library General Public
   * License as published by the Free Software Foundation; either
   * version 2 of the License, or (at your option) any later version.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -18,144 +19,93 @@</span>
   * Boston, MA 02110-1301, USA.
   */
  
  #pragma once
  
<span class="udiff-line-modified-removed">- #include &quot;AnimationUtilities.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;SVGLengthContext.h&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;ExceptionOr.h&quot;</span>
  #include &quot;SVGParsingError.h&quot;
  #include &quot;SVGPropertyTraits.h&quot;
  
  namespace WebCore {
  
  class CSSPrimitiveValue;
<span class="udiff-line-modified-removed">- class QualifiedName;</span>
<span class="udiff-line-modified-added">+ class SVGLengthContext;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ enum class SVGLengthType : uint8_t {</span>
<span class="udiff-line-added">+     Unknown = 0,</span>
<span class="udiff-line-added">+     Number,</span>
<span class="udiff-line-added">+     Percentage,</span>
<span class="udiff-line-added">+     Ems,</span>
<span class="udiff-line-added">+     Exs,</span>
<span class="udiff-line-added">+     Pixels,</span>
<span class="udiff-line-added">+     Centimeters,</span>
<span class="udiff-line-added">+     Millimeters,</span>
<span class="udiff-line-added">+     Inches,</span>
<span class="udiff-line-added">+     Points,</span>
<span class="udiff-line-added">+     Picas</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ enum class SVGLengthMode : uint8_t {</span>
<span class="udiff-line-added">+     Width,</span>
<span class="udiff-line-added">+     Height,</span>
<span class="udiff-line-added">+     Other</span>
<span class="udiff-line-added">+ };</span>
  
<span class="udiff-line-modified-removed">- enum SVGLengthNegativeValuesMode {</span>
<span class="udiff-line-modified-removed">-     AllowNegativeLengths,</span>
<span class="udiff-line-modified-removed">-     ForbidNegativeLengths</span>
<span class="udiff-line-modified-added">+ enum class SVGLengthNegativeValuesMode : uint8_t {</span>
<span class="udiff-line-modified-added">+     Allow,</span>
<span class="udiff-line-modified-added">+     Forbid</span>
  };
  
  class SVGLengthValue {
      WTF_MAKE_FAST_ALLOCATED;
  public:
<span class="udiff-line-modified-removed">-     // FIXME: Once all SVGLengthValue users use Length internally, we make this a wrapper for Length.</span>
<span class="udiff-line-modified-removed">-     SVGLengthValue(SVGLengthMode = LengthModeOther, const String&amp; valueAsString = String());</span>
<span class="udiff-line-modified-removed">-     SVGLengthValue(const SVGLengthContext&amp;, float, SVGLengthMode = LengthModeOther, SVGLengthType = LengthTypeNumber);</span>
<span class="udiff-line-modified-added">+     SVGLengthValue(SVGLengthMode = SVGLengthMode::Other, const String&amp; valueAsString = String());</span>
<span class="udiff-line-modified-added">+     SVGLengthValue(float valueInSpecifiedUnits, SVGLengthType, SVGLengthMode = SVGLengthMode::Other);</span>
<span class="udiff-line-modified-added">+     SVGLengthValue(const SVGLengthContext&amp;, float, SVGLengthType = SVGLengthType::Number, SVGLengthMode = SVGLengthMode::Other);</span>
  
<span class="udiff-line-modified-removed">-     SVGLengthType unitType() const;</span>
<span class="udiff-line-modified-removed">-     SVGLengthMode unitMode() const;</span>
<span class="udiff-line-modified-added">+     static SVGLengthValue construct(SVGLengthMode, const String&amp;, SVGParsingError&amp;, SVGLengthNegativeValuesMode = SVGLengthNegativeValuesMode::Allow);</span>
<span class="udiff-line-modified-added">+     static SVGLengthValue blend(const SVGLengthValue&amp; from, const SVGLengthValue&amp; to, float progress);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     static SVGLengthValue fromCSSPrimitiveValue(const CSSPrimitiveValue&amp;);</span>
<span class="udiff-line-added">+     static Ref&lt;CSSPrimitiveValue&gt; toCSSPrimitiveValue(const SVGLengthValue&amp;);</span>
  
<span class="udiff-line-modified-removed">-     bool operator==(const SVGLengthValue&amp;) const;</span>
<span class="udiff-line-modified-removed">-     bool operator!=(const SVGLengthValue&amp;) const;</span>
<span class="udiff-line-modified-added">+     SVGLengthType lengthType() const { return m_lengthType; }</span>
<span class="udiff-line-modified-added">+     SVGLengthMode lengthMode() const { return m_lengthMode; }</span>
  
<span class="udiff-line-modified-removed">-     static SVGLengthValue construct(SVGLengthMode, const String&amp;, SVGParsingError&amp;, SVGLengthNegativeValuesMode = AllowNegativeLengths);</span>
<span class="udiff-line-modified-added">+     bool isZero() const { return !m_valueInSpecifiedUnits;  }</span>
<span class="udiff-line-added">+     bool isRelative() const { return m_lengthType == SVGLengthType::Percentage || m_lengthType == SVGLengthType::Ems || m_lengthType == SVGLengthType::Exs; }</span>
  
      float value(const SVGLengthContext&amp;) const;
<span class="udiff-line-added">+     float valueAsPercentage() const { return m_lengthType == SVGLengthType::Percentage ? m_valueInSpecifiedUnits / 100 : m_valueInSpecifiedUnits; }</span>
<span class="udiff-line-added">+     float valueInSpecifiedUnits() const { return m_valueInSpecifiedUnits; }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     String valueAsString() const;</span>
      ExceptionOr&lt;float&gt; valueForBindings(const SVGLengthContext&amp;) const;
<span class="udiff-line-removed">-     ExceptionOr&lt;void&gt; setValue(float, const SVGLengthContext&amp;);</span>
<span class="udiff-line-removed">-     ExceptionOr&lt;void&gt; setValue(const SVGLengthContext&amp;, float, SVGLengthMode, SVGLengthType);</span>
  
<span class="udiff-line-removed">-     float valueInSpecifiedUnits() const { return m_valueInSpecifiedUnits; }</span>
      void setValueInSpecifiedUnits(float value) { m_valueInSpecifiedUnits = value; }
<span class="udiff-line-added">+     ExceptionOr&lt;void&gt; setValue(const SVGLengthContext&amp;, float);</span>
<span class="udiff-line-added">+     ExceptionOr&lt;void&gt; setValue(const SVGLengthContext&amp;, float, SVGLengthType, SVGLengthMode);</span>
  
<span class="udiff-line-removed">-     float valueAsPercentage() const;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     String valueAsString() const;</span>
      ExceptionOr&lt;void&gt; setValueAsString(const String&amp;);
      ExceptionOr&lt;void&gt; setValueAsString(const String&amp;, SVGLengthMode);
  
<span class="udiff-line-modified-removed">-     ExceptionOr&lt;void&gt; newValueSpecifiedUnits(unsigned short, float valueInSpecifiedUnits);</span>
<span class="udiff-line-removed">-     ExceptionOr&lt;void&gt; convertToSpecifiedUnits(unsigned short, const SVGLengthContext&amp;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     // Helper functions</span>
<span class="udiff-line-removed">-     bool isRelative() const</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-         auto type = unitType();</span>
<span class="udiff-line-removed">-         return type == LengthTypePercentage || type == LengthTypeEMS || type == LengthTypeEXS;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     bool isZero() const</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-         return !m_valueInSpecifiedUnits;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     static SVGLengthValue fromCSSPrimitiveValue(const CSSPrimitiveValue&amp;);</span>
<span class="udiff-line-removed">-     static Ref&lt;CSSPrimitiveValue&gt; toCSSPrimitiveValue(const SVGLengthValue&amp;);</span>
<span class="udiff-line-removed">-     static SVGLengthMode lengthModeForAnimatedLengthAttribute(const QualifiedName&amp;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     SVGLengthValue blend(const SVGLengthValue&amp; from, float progress) const</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-         auto toType = unitType();</span>
<span class="udiff-line-removed">-         auto fromType = from.unitType();</span>
<span class="udiff-line-removed">-         if ((from.isZero() &amp;&amp; isZero())</span>
<span class="udiff-line-removed">-             || fromType == LengthTypeUnknown</span>
<span class="udiff-line-removed">-             || toType == LengthTypeUnknown</span>
<span class="udiff-line-removed">-             || (!from.isZero() &amp;&amp; fromType != LengthTypePercentage &amp;&amp; toType == LengthTypePercentage)</span>
<span class="udiff-line-removed">-             || (!isZero() &amp;&amp; fromType == LengthTypePercentage &amp;&amp; toType != LengthTypePercentage)</span>
<span class="udiff-line-removed">-             || (!from.isZero() &amp;&amp; !isZero() &amp;&amp; (fromType == LengthTypeEMS || fromType == LengthTypeEXS) &amp;&amp; fromType != toType))</span>
<span class="udiff-line-removed">-             return *this;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         SVGLengthValue length;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (fromType == LengthTypePercentage || toType == LengthTypePercentage) {</span>
<span class="udiff-line-removed">-             auto fromPercent = from.valueAsPercentage() * 100;</span>
<span class="udiff-line-removed">-             auto toPercent = valueAsPercentage() * 100;</span>
<span class="udiff-line-removed">-             auto result = length.newValueSpecifiedUnits(LengthTypePercentage, WebCore::blend(fromPercent, toPercent, progress));</span>
<span class="udiff-line-removed">-             if (result.hasException())</span>
<span class="udiff-line-removed">-                 return { };</span>
<span class="udiff-line-removed">-             return length;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (fromType == toType || from.isZero() || isZero() || fromType == LengthTypeEMS || fromType == LengthTypeEXS) {</span>
<span class="udiff-line-removed">-             auto fromValue = from.valueInSpecifiedUnits();</span>
<span class="udiff-line-removed">-             auto toValue = valueInSpecifiedUnits();</span>
<span class="udiff-line-removed">-             if (isZero()) {</span>
<span class="udiff-line-removed">-                 auto result = length.newValueSpecifiedUnits(fromType, WebCore::blend(fromValue, toValue, progress));</span>
<span class="udiff-line-removed">-                 if (result.hasException())</span>
<span class="udiff-line-removed">-                     return { };</span>
<span class="udiff-line-removed">-             } else {</span>
<span class="udiff-line-removed">-                 auto result = length.newValueSpecifiedUnits(toType, WebCore::blend(fromValue, toValue, progress));</span>
<span class="udiff-line-removed">-                 if (result.hasException())</span>
<span class="udiff-line-removed">-                     return { };</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             return length;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         ASSERT(!isRelative());</span>
<span class="udiff-line-removed">-         ASSERT(!from.isRelative());</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         SVGLengthContext nonRelativeLengthContext(nullptr);</span>
<span class="udiff-line-removed">-         auto fromValueInUserUnits = nonRelativeLengthContext.convertValueToUserUnits(from.valueInSpecifiedUnits(), from.unitMode(), fromType);</span>
<span class="udiff-line-removed">-         if (fromValueInUserUnits.hasException())</span>
<span class="udiff-line-removed">-             return { };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         auto fromValue = nonRelativeLengthContext.convertValueFromUserUnits(fromValueInUserUnits.releaseReturnValue(), unitMode(), toType);</span>
<span class="udiff-line-removed">-         if (fromValue.hasException())</span>
<span class="udiff-line-removed">-             return { };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         float toValue = valueInSpecifiedUnits();</span>
<span class="udiff-line-removed">-         auto result = length.newValueSpecifiedUnits(toType, WebCore::blend(fromValue.releaseReturnValue(), toValue, progress));</span>
<span class="udiff-line-removed">-         if (result.hasException())</span>
<span class="udiff-line-removed">-             return { };</span>
<span class="udiff-line-removed">-         return length;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     ExceptionOr&lt;void&gt; convertToSpecifiedUnits(const SVGLengthContext&amp;, SVGLengthType);</span>
  
  private:
      float m_valueInSpecifiedUnits { 0 };
<span class="udiff-line-modified-removed">-     unsigned m_unit;</span>
<span class="udiff-line-modified-added">+     SVGLengthType m_lengthType { SVGLengthType::Number };</span>
<span class="udiff-line-added">+     SVGLengthMode m_lengthMode { SVGLengthMode::Other };</span>
  };
  
<span class="udiff-line-modified-removed">- template&lt;&gt; struct SVGPropertyTraits&lt;SVGLengthValue&gt; {</span>
<span class="udiff-line-modified-removed">-     static SVGLengthValue initialValue() { return { }; }</span>
<span class="udiff-line-modified-removed">-     static Optional&lt;SVGLengthValue&gt; parse(const QualifiedName&amp; attrName, const String&amp; string)</span>
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-         SVGLengthValue length;</span>
<span class="udiff-line-modified-removed">-         length.setValueAsString(string, SVGLengthValue::lengthModeForAnimatedLengthAttribute(attrName)).hasException();</span>
<span class="udiff-line-modified-removed">-         return length;</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-removed">-     static String toString(const SVGLengthValue&amp; length) { return length.valueAsString(); }</span>
<span class="udiff-line-removed">- };</span>
<span class="udiff-line-modified-added">+ inline bool operator==(const SVGLengthValue&amp; a, const SVGLengthValue&amp; b)</span>
<span class="udiff-line-modified-added">+ {</span>
<span class="udiff-line-modified-added">+     return a.valueInSpecifiedUnits() == b.valueInSpecifiedUnits() &amp;&amp; a.lengthType() == b.lengthType() &amp;&amp; a.lengthMode() == b.lengthMode();</span>
<span class="udiff-line-modified-added">+ }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ inline bool operator!=(const SVGLengthValue&amp; a, const SVGLengthValue&amp; b)</span>
<span class="udiff-line-modified-added">+ {</span>
<span class="udiff-line-modified-added">+     return a.valueInSpecifiedUnits() != b.valueInSpecifiedUnits() || a.lengthType() != b.lengthType() || a.lengthMode() != b.lengthMode();</span>
<span class="udiff-line-modified-added">+ }</span>
  
  WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, const SVGLengthValue&amp;);
  
  } // namespace WebCore
</pre>
<center><a href="SVGLengthValue.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SVGLineElement.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>