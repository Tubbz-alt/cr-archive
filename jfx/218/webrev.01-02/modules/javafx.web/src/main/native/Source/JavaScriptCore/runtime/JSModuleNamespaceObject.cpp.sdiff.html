<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSModuleNamespaceObject.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSModuleLoader.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSModuleNamespaceObject.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSModuleNamespaceObject.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;JSModuleNamespaceObject.h&quot;
 28 
 29 #include &quot;AbstractModuleRecord.h&quot;
 30 #include &quot;Error.h&quot;
 31 #include &quot;JSCInlines.h&quot;
 32 #include &quot;JSModuleEnvironment.h&quot;
 33 
 34 namespace JSC {
 35 
 36 const ClassInfo JSModuleNamespaceObject::s_info = { &quot;ModuleNamespaceObject&quot;, &amp;Base::s_info, nullptr, nullptr, CREATE_METHOD_TABLE(JSModuleNamespaceObject) };
 37 
 38 JSModuleNamespaceObject::JSModuleNamespaceObject(VM&amp; vm, Structure* structure)
 39     : Base(vm, structure)
 40     , m_exports()
 41 {
 42 }
 43 
<span class="line-modified"> 44 void JSModuleNamespaceObject::finishCreation(ExecState* exec, JSGlobalObject*, AbstractModuleRecord* moduleRecord, Vector&lt;std::pair&lt;Identifier, AbstractModuleRecord::Resolution&gt;&gt;&amp;&amp; resolutions)</span>
 45 {
<span class="line-modified"> 46     VM&amp; vm = exec-&gt;vm();</span>
 47     auto scope = DECLARE_THROW_SCOPE(vm);
 48     Base::finishCreation(vm);
 49     ASSERT(inherits(vm, info()));
 50 
 51     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects
 52     // Quoted from the spec:
 53     //     A List containing the String values of the exported names exposed as own properties of this object.
 54     //     The list is ordered as if an Array of those String values had been sorted using Array.prototype.sort using SortCompare as comparefn.
 55     //
 56     // Sort the exported names by the code point order.
 57     std::sort(resolutions.begin(), resolutions.end(), [] (const auto&amp; lhs, const auto&amp; rhs) {
 58         return codePointCompare(lhs.first.impl(), rhs.first.impl()) &lt; 0;
 59     });
 60 
 61     m_moduleRecord.set(vm, this, moduleRecord);

 62     {
<span class="line-modified"> 63         unsigned moduleRecordOffset = 0;</span>
<span class="line-removed"> 64         m_names.reserveCapacity(resolutions.size());</span>
 65         for (const auto&amp; pair : resolutions) {
<span class="line-removed"> 66             moduleRecordAt(moduleRecordOffset).set(vm, this, pair.second.moduleRecord);</span>
 67             m_names.append(pair.first);
<span class="line-modified"> 68             m_exports.add(pair.first.impl(), ExportEntry {</span>
<span class="line-modified"> 69                 pair.second.localName,</span>
<span class="line-modified"> 70                 moduleRecordOffset</span>
<span class="line-removed"> 71             });</span>
<span class="line-removed"> 72             ++moduleRecordOffset;</span>
 73         }
 74     }
 75 
<span class="line-modified"> 76     putDirect(vm, vm.propertyNames-&gt;toStringTagSymbol, jsString(vm, &quot;Module&quot;), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly);</span>
 77 
 78     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-getprototypeof
 79     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-setprototypeof-v
 80     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-isextensible
 81     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-preventextensions
<span class="line-modified"> 82     methodTable(vm)-&gt;preventExtensions(this, exec);</span>
 83     scope.assertNoException();
 84 }
 85 
 86 void JSModuleNamespaceObject::destroy(JSCell* cell)
 87 {
 88     JSModuleNamespaceObject* thisObject = static_cast&lt;JSModuleNamespaceObject*&gt;(cell);
 89     thisObject-&gt;JSModuleNamespaceObject::~JSModuleNamespaceObject();
 90 }
 91 
 92 void JSModuleNamespaceObject::visitChildren(JSCell* cell, SlotVisitor&amp; visitor)
 93 {
 94     JSModuleNamespaceObject* thisObject = jsCast&lt;JSModuleNamespaceObject*&gt;(cell);
 95     ASSERT_GC_OBJECT_INHERITS(thisObject, info());
 96     Base::visitChildren(thisObject, visitor);
 97     visitor.append(thisObject-&gt;m_moduleRecord);
<span class="line-modified"> 98     for (unsigned i = 0; i &lt; thisObject-&gt;m_names.size(); ++i)</span>
<span class="line-modified"> 99         visitor.appendHidden(thisObject-&gt;moduleRecordAt(i));</span>



100 }
101 
102 static JSValue getValue(JSModuleEnvironment* environment, PropertyName localName, ScopeOffset&amp; scopeOffset)
103 {
104     SymbolTable* symbolTable = environment-&gt;symbolTable();
105     {
106         ConcurrentJSLocker locker(symbolTable-&gt;m_lock);
107         auto iter = symbolTable-&gt;find(locker, localName.uid());
108         ASSERT(iter != symbolTable-&gt;end(locker));
109         SymbolTableEntry&amp; entry = iter-&gt;value;
110         ASSERT(!entry.isNull());
111         scopeOffset = entry.scopeOffset();
112     }
113     return environment-&gt;variableAt(scopeOffset).get();
114 }
115 
<span class="line-modified">116 bool JSModuleNamespaceObject::getOwnPropertySlotCommon(ExecState* exec, PropertyName propertyName, PropertySlot&amp; slot)</span>
117 {
<span class="line-modified">118     VM&amp; vm = exec-&gt;vm();</span>
119     auto scope = DECLARE_THROW_SCOPE(vm);
120 
121     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-getownproperty-p
122 
123     // step 1.
124     // If the property name is a symbol, we don&#39;t look into the imported bindings.
125     // It may return the descriptor with writable: true, but namespace objects does not allow it in [[Set]] / [[DefineOwnProperty]] side.
126     if (propertyName.isSymbol())
<span class="line-modified">127         return JSObject::getOwnPropertySlot(this, exec, propertyName, slot);</span>
128 
129     slot.setIsTaintedByOpaqueObject();
130 
131     auto iterator = m_exports.find(propertyName.uid());
132     if (iterator == m_exports.end())
133         return false;
134     ExportEntry&amp; exportEntry = iterator-&gt;value;
135 
136     switch (slot.internalMethodType()) {
137     case PropertySlot::InternalMethodType::GetOwnProperty:
138     case PropertySlot::InternalMethodType::Get: {
<span class="line-modified">139         JSModuleEnvironment* environment = moduleRecordAt(exportEntry.moduleRecordOffset)-&gt;moduleEnvironment();</span>
140         ScopeOffset scopeOffset;
141         JSValue value = getValue(environment, exportEntry.localName, scopeOffset);
142         // If the value is filled with TDZ value, throw a reference error.
143         if (!value) {
<span class="line-modified">144             throwVMError(exec, scope, createTDZError(exec));</span>
145             return false;
146         }
147 
148         slot.setValueModuleNamespace(this, static_cast&lt;unsigned&gt;(PropertyAttribute::DontDelete), value, environment, scopeOffset);
149         return true;
150     }
151 
152     case PropertySlot::InternalMethodType::HasProperty: {
153         // Do not perform [[Get]] for [[HasProperty]].
154         // [[Get]] / [[GetOwnProperty]] onto namespace object could throw an error while [[HasProperty]] just returns true here.
155         // https://tc39.github.io/ecma262/#sec-module-namespace-exotic-objects-hasproperty-p
156         slot.setValue(this, static_cast&lt;unsigned&gt;(PropertyAttribute::DontDelete), jsUndefined());
157         return true;
158     }
159 
160     case PropertySlot::InternalMethodType::VMInquiry:
161         return false;
162     }
163 
164     RELEASE_ASSERT_NOT_REACHED();
165     return false;
166 }
167 
<span class="line-modified">168 bool JSModuleNamespaceObject::getOwnPropertySlot(JSObject* cell, ExecState* exec, PropertyName propertyName, PropertySlot&amp; slot)</span>
169 {
170     JSModuleNamespaceObject* thisObject = jsCast&lt;JSModuleNamespaceObject*&gt;(cell);
<span class="line-modified">171     return thisObject-&gt;getOwnPropertySlotCommon(exec, propertyName, slot);</span>
172 }
173 
<span class="line-modified">174 bool JSModuleNamespaceObject::getOwnPropertySlotByIndex(JSObject* cell, ExecState* exec, unsigned propertyName, PropertySlot&amp; slot)</span>
175 {
<span class="line-modified">176     VM&amp; vm = exec-&gt;vm();</span>
177     JSModuleNamespaceObject* thisObject = jsCast&lt;JSModuleNamespaceObject*&gt;(cell);
<span class="line-modified">178     return thisObject-&gt;getOwnPropertySlotCommon(exec, Identifier::from(vm, propertyName), slot);</span>
179 }
180 
<span class="line-modified">181 bool JSModuleNamespaceObject::put(JSCell*, ExecState* exec, PropertyName, JSValue, PutPropertySlot&amp; slot)</span>
182 {
<span class="line-modified">183     VM&amp; vm = exec-&gt;vm();</span>
184     auto scope = DECLARE_THROW_SCOPE(vm);
185 
186     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-set-p-v-receiver
187     if (slot.isStrictMode())
<span class="line-modified">188         throwTypeError(exec, scope, ReadonlyPropertyWriteError);</span>
189     return false;
190 }
191 
<span class="line-modified">192 bool JSModuleNamespaceObject::putByIndex(JSCell*, ExecState* exec, unsigned, JSValue, bool shouldThrow)</span>
193 {
<span class="line-modified">194     VM&amp; vm = exec-&gt;vm();</span>
195     auto scope = DECLARE_THROW_SCOPE(vm);
196 
197     if (shouldThrow)
<span class="line-modified">198         throwTypeError(exec, scope, ReadonlyPropertyWriteError);</span>
199     return false;
200 }
201 
<span class="line-modified">202 bool JSModuleNamespaceObject::deleteProperty(JSCell* cell, ExecState* exec, PropertyName propertyName)</span>
203 {
204     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-delete-p
205     JSModuleNamespaceObject* thisObject = jsCast&lt;JSModuleNamespaceObject*&gt;(cell);
206     if (propertyName.isSymbol())
<span class="line-modified">207         return JSObject::deleteProperty(thisObject, exec, propertyName);</span>
208 
209     return !thisObject-&gt;m_exports.contains(propertyName.uid());
210 }
211 
<span class="line-modified">212 void JSModuleNamespaceObject::getOwnPropertyNames(JSObject* cell, ExecState* exec, PropertyNameArray&amp; propertyNames, EnumerationMode mode)</span>
213 {
<span class="line-modified">214     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-ownpropertykeys</span>



215     JSModuleNamespaceObject* thisObject = jsCast&lt;JSModuleNamespaceObject*&gt;(cell);
<span class="line-modified">216     for (const auto&amp; name : thisObject-&gt;m_names)</span>






217         propertyNames.add(name.impl());
<span class="line-modified">218     return JSObject::getOwnPropertyNames(thisObject, exec, propertyNames, mode);</span>

219 }
220 
<span class="line-modified">221 bool JSModuleNamespaceObject::defineOwnProperty(JSObject*, ExecState* exec, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow)</span>
222 {
<span class="line-modified">223     VM&amp; vm = exec-&gt;vm();</span>
224     auto scope = DECLARE_THROW_SCOPE(vm);
225 
226     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-defineownproperty-p-desc
227     if (shouldThrow)
<span class="line-modified">228         throwTypeError(exec, scope, NonExtensibleObjectPropertyDefineError);</span>
229     return false;
230 }
231 
232 } // namespace JSC
</pre>
</td>
<td>
<hr />
<pre>
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;JSModuleNamespaceObject.h&quot;
 28 
 29 #include &quot;AbstractModuleRecord.h&quot;
 30 #include &quot;Error.h&quot;
 31 #include &quot;JSCInlines.h&quot;
 32 #include &quot;JSModuleEnvironment.h&quot;
 33 
 34 namespace JSC {
 35 
 36 const ClassInfo JSModuleNamespaceObject::s_info = { &quot;ModuleNamespaceObject&quot;, &amp;Base::s_info, nullptr, nullptr, CREATE_METHOD_TABLE(JSModuleNamespaceObject) };
 37 
 38 JSModuleNamespaceObject::JSModuleNamespaceObject(VM&amp; vm, Structure* structure)
 39     : Base(vm, structure)
 40     , m_exports()
 41 {
 42 }
 43 
<span class="line-modified"> 44 void JSModuleNamespaceObject::finishCreation(JSGlobalObject* globalObject, AbstractModuleRecord* moduleRecord, Vector&lt;std::pair&lt;Identifier, AbstractModuleRecord::Resolution&gt;&gt;&amp;&amp; resolutions)</span>
 45 {
<span class="line-modified"> 46     VM&amp; vm = globalObject-&gt;vm();</span>
 47     auto scope = DECLARE_THROW_SCOPE(vm);
 48     Base::finishCreation(vm);
 49     ASSERT(inherits(vm, info()));
 50 
 51     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects
 52     // Quoted from the spec:
 53     //     A List containing the String values of the exported names exposed as own properties of this object.
 54     //     The list is ordered as if an Array of those String values had been sorted using Array.prototype.sort using SortCompare as comparefn.
 55     //
 56     // Sort the exported names by the code point order.
 57     std::sort(resolutions.begin(), resolutions.end(), [] (const auto&amp; lhs, const auto&amp; rhs) {
 58         return codePointCompare(lhs.first.impl(), rhs.first.impl()) &lt; 0;
 59     });
 60 
 61     m_moduleRecord.set(vm, this, moduleRecord);
<span class="line-added"> 62     m_names.reserveCapacity(resolutions.size());</span>
 63     {
<span class="line-modified"> 64         auto locker = holdLock(cellLock());</span>

 65         for (const auto&amp; pair : resolutions) {

 66             m_names.append(pair.first);
<span class="line-modified"> 67             auto addResult = m_exports.add(pair.first.impl(), ExportEntry());</span>
<span class="line-modified"> 68             addResult.iterator-&gt;value.localName = pair.second.localName;</span>
<span class="line-modified"> 69             addResult.iterator-&gt;value.moduleRecord.set(vm, this, pair.second.moduleRecord);</span>


 70         }
 71     }
 72 
<span class="line-modified"> 73     putDirect(vm, vm.propertyNames-&gt;toStringTagSymbol, jsNontrivialString(vm, &quot;Module&quot;_s), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly);</span>
 74 
 75     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-getprototypeof
 76     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-setprototypeof-v
 77     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-isextensible
 78     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-preventextensions
<span class="line-modified"> 79     methodTable(vm)-&gt;preventExtensions(this, globalObject);</span>
 80     scope.assertNoException();
 81 }
 82 
 83 void JSModuleNamespaceObject::destroy(JSCell* cell)
 84 {
 85     JSModuleNamespaceObject* thisObject = static_cast&lt;JSModuleNamespaceObject*&gt;(cell);
 86     thisObject-&gt;JSModuleNamespaceObject::~JSModuleNamespaceObject();
 87 }
 88 
 89 void JSModuleNamespaceObject::visitChildren(JSCell* cell, SlotVisitor&amp; visitor)
 90 {
 91     JSModuleNamespaceObject* thisObject = jsCast&lt;JSModuleNamespaceObject*&gt;(cell);
 92     ASSERT_GC_OBJECT_INHERITS(thisObject, info());
 93     Base::visitChildren(thisObject, visitor);
 94     visitor.append(thisObject-&gt;m_moduleRecord);
<span class="line-modified"> 95     {</span>
<span class="line-modified"> 96         auto locker = holdLock(thisObject-&gt;cellLock());</span>
<span class="line-added"> 97         for (auto&amp; pair : thisObject-&gt;m_exports)</span>
<span class="line-added"> 98             visitor.appendHidden(pair.value.moduleRecord);</span>
<span class="line-added"> 99     }</span>
100 }
101 
102 static JSValue getValue(JSModuleEnvironment* environment, PropertyName localName, ScopeOffset&amp; scopeOffset)
103 {
104     SymbolTable* symbolTable = environment-&gt;symbolTable();
105     {
106         ConcurrentJSLocker locker(symbolTable-&gt;m_lock);
107         auto iter = symbolTable-&gt;find(locker, localName.uid());
108         ASSERT(iter != symbolTable-&gt;end(locker));
109         SymbolTableEntry&amp; entry = iter-&gt;value;
110         ASSERT(!entry.isNull());
111         scopeOffset = entry.scopeOffset();
112     }
113     return environment-&gt;variableAt(scopeOffset).get();
114 }
115 
<span class="line-modified">116 bool JSModuleNamespaceObject::getOwnPropertySlotCommon(JSGlobalObject* globalObject, PropertyName propertyName, PropertySlot&amp; slot)</span>
117 {
<span class="line-modified">118     VM&amp; vm = globalObject-&gt;vm();</span>
119     auto scope = DECLARE_THROW_SCOPE(vm);
120 
121     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-getownproperty-p
122 
123     // step 1.
124     // If the property name is a symbol, we don&#39;t look into the imported bindings.
125     // It may return the descriptor with writable: true, but namespace objects does not allow it in [[Set]] / [[DefineOwnProperty]] side.
126     if (propertyName.isSymbol())
<span class="line-modified">127         return JSObject::getOwnPropertySlot(this, globalObject, propertyName, slot);</span>
128 
129     slot.setIsTaintedByOpaqueObject();
130 
131     auto iterator = m_exports.find(propertyName.uid());
132     if (iterator == m_exports.end())
133         return false;
134     ExportEntry&amp; exportEntry = iterator-&gt;value;
135 
136     switch (slot.internalMethodType()) {
137     case PropertySlot::InternalMethodType::GetOwnProperty:
138     case PropertySlot::InternalMethodType::Get: {
<span class="line-modified">139         JSModuleEnvironment* environment = exportEntry.moduleRecord-&gt;moduleEnvironment();</span>
140         ScopeOffset scopeOffset;
141         JSValue value = getValue(environment, exportEntry.localName, scopeOffset);
142         // If the value is filled with TDZ value, throw a reference error.
143         if (!value) {
<span class="line-modified">144             throwVMError(globalObject, scope, createTDZError(globalObject));</span>
145             return false;
146         }
147 
148         slot.setValueModuleNamespace(this, static_cast&lt;unsigned&gt;(PropertyAttribute::DontDelete), value, environment, scopeOffset);
149         return true;
150     }
151 
152     case PropertySlot::InternalMethodType::HasProperty: {
153         // Do not perform [[Get]] for [[HasProperty]].
154         // [[Get]] / [[GetOwnProperty]] onto namespace object could throw an error while [[HasProperty]] just returns true here.
155         // https://tc39.github.io/ecma262/#sec-module-namespace-exotic-objects-hasproperty-p
156         slot.setValue(this, static_cast&lt;unsigned&gt;(PropertyAttribute::DontDelete), jsUndefined());
157         return true;
158     }
159 
160     case PropertySlot::InternalMethodType::VMInquiry:
161         return false;
162     }
163 
164     RELEASE_ASSERT_NOT_REACHED();
165     return false;
166 }
167 
<span class="line-modified">168 bool JSModuleNamespaceObject::getOwnPropertySlot(JSObject* cell, JSGlobalObject* globalObject, PropertyName propertyName, PropertySlot&amp; slot)</span>
169 {
170     JSModuleNamespaceObject* thisObject = jsCast&lt;JSModuleNamespaceObject*&gt;(cell);
<span class="line-modified">171     return thisObject-&gt;getOwnPropertySlotCommon(globalObject, propertyName, slot);</span>
172 }
173 
<span class="line-modified">174 bool JSModuleNamespaceObject::getOwnPropertySlotByIndex(JSObject* cell, JSGlobalObject* globalObject, unsigned propertyName, PropertySlot&amp; slot)</span>
175 {
<span class="line-modified">176     VM&amp; vm = globalObject-&gt;vm();</span>
177     JSModuleNamespaceObject* thisObject = jsCast&lt;JSModuleNamespaceObject*&gt;(cell);
<span class="line-modified">178     return thisObject-&gt;getOwnPropertySlotCommon(globalObject, Identifier::from(vm, propertyName), slot);</span>
179 }
180 
<span class="line-modified">181 bool JSModuleNamespaceObject::put(JSCell*, JSGlobalObject* globalObject, PropertyName, JSValue, PutPropertySlot&amp; slot)</span>
182 {
<span class="line-modified">183     VM&amp; vm = globalObject-&gt;vm();</span>
184     auto scope = DECLARE_THROW_SCOPE(vm);
185 
186     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-set-p-v-receiver
187     if (slot.isStrictMode())
<span class="line-modified">188         throwTypeError(globalObject, scope, ReadonlyPropertyWriteError);</span>
189     return false;
190 }
191 
<span class="line-modified">192 bool JSModuleNamespaceObject::putByIndex(JSCell*, JSGlobalObject* globalObject, unsigned, JSValue, bool shouldThrow)</span>
193 {
<span class="line-modified">194     VM&amp; vm = globalObject-&gt;vm();</span>
195     auto scope = DECLARE_THROW_SCOPE(vm);
196 
197     if (shouldThrow)
<span class="line-modified">198         throwTypeError(globalObject, scope, ReadonlyPropertyWriteError);</span>
199     return false;
200 }
201 
<span class="line-modified">202 bool JSModuleNamespaceObject::deleteProperty(JSCell* cell, JSGlobalObject* globalObject, PropertyName propertyName)</span>
203 {
204     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-delete-p
205     JSModuleNamespaceObject* thisObject = jsCast&lt;JSModuleNamespaceObject*&gt;(cell);
206     if (propertyName.isSymbol())
<span class="line-modified">207         return JSObject::deleteProperty(thisObject, globalObject, propertyName);</span>
208 
209     return !thisObject-&gt;m_exports.contains(propertyName.uid());
210 }
211 
<span class="line-modified">212 void JSModuleNamespaceObject::getOwnPropertyNames(JSObject* cell, JSGlobalObject* globalObject, PropertyNameArray&amp; propertyNames, EnumerationMode mode)</span>
213 {
<span class="line-modified">214     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-added">215     auto scope = DECLARE_THROW_SCOPE(vm);</span>
<span class="line-added">216 </span>
<span class="line-added">217     // https://tc39.es/ecma262/#sec-module-namespace-exotic-objects-ownpropertykeys</span>
218     JSModuleNamespaceObject* thisObject = jsCast&lt;JSModuleNamespaceObject*&gt;(cell);
<span class="line-modified">219     for (const auto&amp; name : thisObject-&gt;m_names) {</span>
<span class="line-added">220         if (!mode.includeDontEnumProperties()) {</span>
<span class="line-added">221             // Perform [[GetOwnProperty]] to throw ReferenceError if binding is uninitialized.</span>
<span class="line-added">222             PropertySlot slot(cell, PropertySlot::InternalMethodType::GetOwnProperty);</span>
<span class="line-added">223             thisObject-&gt;getOwnPropertySlotCommon(globalObject, name.impl(), slot);</span>
<span class="line-added">224             RETURN_IF_EXCEPTION(scope, void());</span>
<span class="line-added">225         }</span>
226         propertyNames.add(name.impl());
<span class="line-modified">227     }</span>
<span class="line-added">228     JSObject::getOwnPropertyNames(thisObject, globalObject, propertyNames, mode);</span>
229 }
230 
<span class="line-modified">231 bool JSModuleNamespaceObject::defineOwnProperty(JSObject*, JSGlobalObject* globalObject, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow)</span>
232 {
<span class="line-modified">233     VM&amp; vm = globalObject-&gt;vm();</span>
234     auto scope = DECLARE_THROW_SCOPE(vm);
235 
236     // http://www.ecma-international.org/ecma-262/6.0/#sec-module-namespace-exotic-objects-defineownproperty-p-desc
237     if (shouldThrow)
<span class="line-modified">238         throwTypeError(globalObject, scope, NonExtensibleObjectPropertyDefineError);</span>
239     return false;
240 }
241 
242 } // namespace JSC
</pre>
</td>
</tr>
</table>
<center><a href="JSModuleLoader.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSModuleNamespaceObject.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>