<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/page/DOMWindow.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2006-2017 Apple Inc. All rights reserved.
  3  * Copyright (C) 2010 Nokia Corporation and/or its subsidiary(-ies)
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  * 1. Redistributions of source code must retain the above copyright
  9  *    notice, this list of conditions and the following disclaimer.
 10  * 2. Redistributions in binary form must reproduce the above copyright
 11  *    notice, this list of conditions and the following disclaimer in the
 12  *    documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 15  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 16  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 18  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 19  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 20  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 21  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 22  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 24  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 25  */
 26 
 27 #pragma once
 28 
 29 #include &quot;AbstractDOMWindow.h&quot;
 30 #include &quot;Base64Utilities.h&quot;
 31 #include &quot;ContextDestructionObserver.h&quot;
 32 #include &quot;ExceptionOr.h&quot;
 33 #include &quot;Frame.h&quot;
 34 #include &quot;FrameDestructionObserver.h&quot;
 35 #include &quot;ImageBitmap.h&quot;
<a name="1" id="anc1"></a><span class="line-added"> 36 #include &quot;PostMessageOptions.h&quot;</span>
 37 #include &quot;ScrollToOptions.h&quot;
 38 #include &quot;ScrollTypes.h&quot;
 39 #include &quot;Supplementable.h&quot;
 40 #include &lt;JavaScriptCore/HandleTypes.h&gt;
<a name="2" id="anc2"></a><span class="line-added"> 41 #include &lt;JavaScriptCore/Strong.h&gt;</span>
 42 #include &lt;wtf/Function.h&gt;
 43 #include &lt;wtf/HashSet.h&gt;
<a name="3" id="anc3"></a><span class="line-added"> 44 #include &lt;wtf/MonotonicTime.h&gt;</span>
 45 #include &lt;wtf/WeakPtr.h&gt;
 46 
 47 namespace JSC {
<a name="4" id="anc4"></a><span class="line-modified"> 48 class CallFrame;</span>
 49 class JSObject;
 50 class JSValue;
<a name="5" id="anc5"></a>
 51 }
 52 
 53 namespace WebCore {
 54 
 55 class BarProp;
 56 class CSSRuleList;
 57 class CSSStyleDeclaration;
 58 class Crypto;
 59 class CustomElementRegistry;
 60 class DOMApplicationCache;
 61 class DOMSelection;
 62 class DOMWindowProperty;
 63 class DOMWrapperWorld;
 64 class Document;
 65 class Element;
 66 class EventListener;
 67 class FloatRect;
 68 class History;
<a name="6" id="anc6"></a><span class="line-added"> 69 class IdleRequestCallback;</span>
 70 class Location;
 71 class MediaQueryList;
 72 class Navigator;
 73 class Node;
 74 class NodeList;
 75 class Page;
 76 class PageConsoleClient;
 77 class Performance;
 78 class PostMessageTimer;
 79 class RequestAnimationFrameCallback;
<a name="7" id="anc7"></a><span class="line-added"> 80 class RequestIdleCallback;</span>
 81 class ScheduledAction;
 82 class Screen;
 83 class Storage;
 84 class StyleMedia;
 85 class VisualViewport;
 86 class WebKitNamespace;
 87 class WebKitPoint;
 88 
 89 #if ENABLE(DEVICE_ORIENTATION)
 90 class DeviceMotionController;
 91 class DeviceOrientationController;
 92 #endif
 93 
<a name="8" id="anc8"></a><span class="line-added"> 94 struct IdleRequestOptions;</span>
 95 struct ImageBitmapOptions;
 96 struct WindowFeatures;
 97 
 98 enum SetLocationLocking { LockHistoryBasedOnGestureState, LockHistoryAndBackForwardList };
 99 enum class IncludeTargetOrigin { No, Yes };
100 
<a name="9" id="anc9"></a><span class="line-added">101 struct WindowPostMessageOptions : public PostMessageOptions {</span>
<span class="line-added">102     WindowPostMessageOptions() = default;</span>
<span class="line-added">103     WindowPostMessageOptions(String&amp;&amp; targetOrigin, Vector&lt;JSC::Strong&lt;JSC::JSObject&gt;&gt;&amp;&amp; transfer)</span>
<span class="line-added">104         : PostMessageOptions(WTFMove(transfer))</span>
<span class="line-added">105         , targetOrigin(WTFMove(targetOrigin))</span>
<span class="line-added">106     { }</span>
<span class="line-added">107 </span>
<span class="line-added">108     String targetOrigin { &quot;/&quot;_s };</span>
<span class="line-added">109 };</span>
<span class="line-added">110 </span>
111 // FIXME: Rename DOMWindow to LocalWindow and AbstractDOMWindow to DOMWindow.
112 class DOMWindow final
113     : public AbstractDOMWindow
114     , public CanMakeWeakPtr&lt;DOMWindow&gt;
115     , public ContextDestructionObserver
116     , public Base64Utilities
117     , public Supplementable&lt;DOMWindow&gt; {
118     WTF_MAKE_ISO_ALLOCATED(DOMWindow);
119 public:
120 
121     static Ref&lt;DOMWindow&gt; create(Document&amp; document) { return adoptRef(*new DOMWindow(document)); }
122     WEBCORE_EXPORT virtual ~DOMWindow();
123 
124     // In some rare cases, we&#39;ll reuse a DOMWindow for a new Document. For example,
125     // when a script calls window.open(&quot;...&quot;), the browser gives JavaScript a window
126     // synchronously but kicks off the load in the window asynchronously. Web sites
127     // expect that modifications that they make to the window object synchronously
128     // won&#39;t be blown away when the network load commits. To make that happen, we
129     // &quot;securely transition&quot; the existing DOMWindow to the Document that results from
130     // the network load. See also SecurityContext::isSecureTransitionTo.
131     void didSecureTransitionTo(Document&amp;);
132 
133     class Observer {
134     public:
135         virtual ~Observer() { }
136 
<a name="10" id="anc10"></a><span class="line-modified">137         virtual void suspendForBackForwardCache() { }</span>
<span class="line-modified">138         virtual void resumeFromBackForwardCache() { }</span>
139         virtual void willDestroyGlobalObjectInCachedFrame() { }
140         virtual void willDestroyGlobalObjectInFrame() { }
141         virtual void willDetachGlobalObjectFromFrame() { }
142     };
143 
144     void registerObserver(Observer&amp;);
145     void unregisterObserver(Observer&amp;);
146 
147     void resetUnlessSuspendedForDocumentSuspension();
<a name="11" id="anc11"></a><span class="line-modified">148     void suspendForBackForwardCache();</span>
<span class="line-modified">149     void resumeFromBackForwardCache();</span>
150 
151     WEBCORE_EXPORT Frame* frame() const final;
152 
153     RefPtr&lt;MediaQueryList&gt; matchMedia(const String&amp;);
154 
155     WEBCORE_EXPORT unsigned pendingUnloadEventListeners() const;
156 
157     WEBCORE_EXPORT static bool dispatchAllPendingBeforeUnloadEvents();
158     WEBCORE_EXPORT static void dispatchAllPendingUnloadEvents();
159 
160     static FloatRect adjustWindowRect(Page&amp;, const FloatRect&amp; pendingChanges);
161 
162     bool allowPopUp(); // Call on first window, not target window.
163     static bool allowPopUp(Frame&amp; firstFrame);
164     static bool canShowModalDialog(const Frame&amp;);
165     WEBCORE_EXPORT void setCanShowModalDialogOverride(bool);
166 
167     Screen&amp; screen();
168     History&amp; history();
169     Crypto&amp; crypto() const;
170     BarProp&amp; locationbar();
171     BarProp&amp; menubar();
172     BarProp&amp; personalbar();
173     BarProp&amp; scrollbars();
174     BarProp&amp; statusbar();
175     BarProp&amp; toolbar();
176     WEBCORE_EXPORT Navigator&amp; navigator();
177     Navigator* optionalNavigator() const { return m_navigator.get(); }
178     Navigator&amp; clientInformation() { return navigator(); }
179 
<a name="12" id="anc12"></a><span class="line-modified">180     WEBCORE_EXPORT static void overrideTransientActivationDurationForTesting(Optional&lt;Seconds&gt;&amp;&amp;);</span>
<span class="line-added">181     void setLastActivationTimestamp(MonotonicTime lastActivationTimestamp) { m_lastActivationTimestamp = lastActivationTimestamp; }</span>
<span class="line-added">182     MonotonicTime lastActivationTimestamp() const { return m_lastActivationTimestamp; }</span>
<span class="line-added">183     void notifyActivated(MonotonicTime);</span>
<span class="line-added">184     bool hasTransientActivation() const;</span>
<span class="line-added">185     bool consumeTransientActivation();</span>
<span class="line-added">186 </span>
<span class="line-added">187     WEBCORE_EXPORT Location&amp; location();</span>
188     void setLocation(DOMWindow&amp; activeWindow, const URL&amp; completedURL, SetLocationLocking = LockHistoryBasedOnGestureState);
189 
190     DOMSelection* getSelection();
191 
192     Element* frameElement() const;
193 
194     WEBCORE_EXPORT void focus(bool allowFocus = false);
195     void focus(DOMWindow&amp; incumbentWindow);
196     void blur();
197     WEBCORE_EXPORT void close();
198     void close(Document&amp;);
199     void print();
200     void stop();
201 
202     WEBCORE_EXPORT ExceptionOr&lt;RefPtr&lt;WindowProxy&gt;&gt; open(DOMWindow&amp; activeWindow, DOMWindow&amp; firstWindow, const String&amp; urlString, const AtomString&amp; frameName, const String&amp; windowFeaturesString);
203 
204     void showModalDialog(const String&amp; urlString, const String&amp; dialogFeaturesString, DOMWindow&amp; activeWindow, DOMWindow&amp; firstWindow, const WTF::Function&lt;void(DOMWindow&amp;)&gt;&amp; prepareDialogFunction);
205 
206     void prewarmLocalStorageIfNecessary();
207 
208     void alert(const String&amp; message = emptyString());
<a name="13" id="anc13"></a><span class="line-modified">209     bool confirmForBindings(const String&amp; message);</span>
210     String prompt(const String&amp; message, const String&amp; defaultValue);
211 
212     bool find(const String&amp;, bool caseSensitive, bool backwards, bool wrap, bool wholeWord, bool searchInFrames, bool showDialog) const;
213 
214     bool offscreenBuffering() const;
215 
216     int outerHeight() const;
217     int outerWidth() const;
218     int innerHeight() const;
219     int innerWidth() const;
220     int screenX() const;
221     int screenY() const;
222     int screenLeft() const { return screenX(); }
223     int screenTop() const { return screenY(); }
224     int scrollX() const;
225     int scrollY() const;
226 
227     bool closed() const;
228 
229     unsigned length() const;
230 
231     String name() const;
232     void setName(const String&amp;);
233 
234     String status() const;
235     void setStatus(const String&amp;);
236     String defaultStatus() const;
237     void setDefaultStatus(const String&amp;);
238 
239     WindowProxy* opener() const;
240     void disownOpener();
241     WindowProxy* parent() const;
242     WindowProxy* top() const;
243 
244     String origin() const;
<a name="14" id="anc14"></a><span class="line-added">245     SecurityOrigin* securityOrigin() const;</span>
246 
247     // DOM Level 2 AbstractView Interface
248 
249     WEBCORE_EXPORT Document* document() const;
250 
251     // CSSOM View Module
252 
253     StyleMedia&amp; styleMedia();
254 
255     // DOM Level 2 Style Interface
256 
257     WEBCORE_EXPORT Ref&lt;CSSStyleDeclaration&gt; getComputedStyle(Element&amp;, const String&amp; pseudoElt) const;
258 
259     // WebKit extensions
260 
261     WEBCORE_EXPORT RefPtr&lt;CSSRuleList&gt; getMatchedCSSRules(Element*, const String&amp; pseudoElt, bool authorOnly = true) const;
262     double devicePixelRatio() const;
263 
264     RefPtr&lt;WebKitPoint&gt; webkitConvertPointFromPageToNode(Node*, const WebKitPoint*) const;
265     RefPtr&lt;WebKitPoint&gt; webkitConvertPointFromNodeToPage(Node*, const WebKitPoint*) const;
266 
267     PageConsoleClient* console() const;
268 
<a name="15" id="anc15"></a><span class="line-modified">269     void printErrorMessage(const String&amp;) const;</span>
270 
271     String crossDomainAccessErrorMessage(const DOMWindow&amp; activeWindow, IncludeTargetOrigin);
272 
<a name="16" id="anc16"></a><span class="line-modified">273     ExceptionOr&lt;void&gt; postMessage(JSC::JSGlobalObject&amp;, DOMWindow&amp; incumbentWindow, JSC::JSValue message, WindowPostMessageOptions&amp;&amp;);</span>
<span class="line-added">274     ExceptionOr&lt;void&gt; postMessage(JSC::JSGlobalObject&amp; globalObject, DOMWindow&amp; incumbentWindow, JSC::JSValue message, String&amp;&amp; targetOrigin, Vector&lt;JSC::Strong&lt;JSC::JSObject&gt;&gt;&amp;&amp; transfer)</span>
<span class="line-added">275     {</span>
<span class="line-added">276         return postMessage(globalObject, incumbentWindow, message, WindowPostMessageOptions { WTFMove(targetOrigin), WTFMove(transfer) });</span>
<span class="line-added">277     }</span>
<span class="line-added">278 </span>
279     void postMessageTimerFired(PostMessageTimer&amp;);
280 
281     void languagesChanged();
282 
283     void scrollBy(const ScrollToOptions&amp;) const;
284     void scrollBy(double x, double y) const;
285     void scrollTo(const ScrollToOptions&amp;, ScrollClamping = ScrollClamping::Clamped) const;
286     void scrollTo(double x, double y, ScrollClamping = ScrollClamping::Clamped) const;
287 
288     void moveBy(float x, float y) const;
289     void moveTo(float x, float y) const;
290 
291     void resizeBy(float x, float y) const;
292     void resizeTo(float width, float height) const;
293 
294     VisualViewport&amp; visualViewport();
295 
296     // Timers
<a name="17" id="anc17"></a><span class="line-modified">297     ExceptionOr&lt;int&gt; setTimeout(JSC::JSGlobalObject&amp;, std::unique_ptr&lt;ScheduledAction&gt;, int timeout, Vector&lt;JSC::Strong&lt;JSC::Unknown&gt;&gt;&amp;&amp; arguments);</span>
298     void clearTimeout(int timeoutId);
<a name="18" id="anc18"></a><span class="line-modified">299     ExceptionOr&lt;int&gt; setInterval(JSC::JSGlobalObject&amp;, std::unique_ptr&lt;ScheduledAction&gt;, int timeout, Vector&lt;JSC::Strong&lt;JSC::Unknown&gt;&gt;&amp;&amp; arguments);</span>
300     void clearInterval(int timeoutId);
301 
302     int requestAnimationFrame(Ref&lt;RequestAnimationFrameCallback&gt;&amp;&amp;);
303     int webkitRequestAnimationFrame(Ref&lt;RequestAnimationFrameCallback&gt;&amp;&amp;);
304     void cancelAnimationFrame(int id);
305 
<a name="19" id="anc19"></a><span class="line-added">306     int requestIdleCallback(Ref&lt;IdleRequestCallback&gt;&amp;&amp;, const IdleRequestOptions&amp;);</span>
<span class="line-added">307     void cancelIdleCallback(int id);</span>
<span class="line-added">308 </span>
309     // ImageBitmap
310     void createImageBitmap(ImageBitmap::Source&amp;&amp;, ImageBitmapOptions&amp;&amp;, ImageBitmap::Promise&amp;&amp;);
311     void createImageBitmap(ImageBitmap::Source&amp;&amp;, int sx, int sy, int sw, int sh, ImageBitmapOptions&amp;&amp;, ImageBitmap::Promise&amp;&amp;);
312 
313     // Secure Contexts
314     bool isSecureContext() const;
315 
316     // Events
317     // EventTarget API
318     bool addEventListener(const AtomString&amp; eventType, Ref&lt;EventListener&gt;&amp;&amp;, const AddEventListenerOptions&amp;) final;
319     bool removeEventListener(const AtomString&amp; eventType, EventListener&amp;, const ListenerOptions&amp;) final;
320     void removeAllEventListeners() final;
321 
322     using EventTarget::dispatchEvent;
323     void dispatchEvent(Event&amp;, EventTarget*);
324 
325     void dispatchLoadEvent();
326 
327     void captureEvents();
328     void releaseEvents();
329 
330     void finishedLoading();
331 
332     // HTML 5 key/value storage
333     ExceptionOr&lt;Storage*&gt; sessionStorage();
334     ExceptionOr&lt;Storage*&gt; localStorage();
335     Storage* optionalSessionStorage() const { return m_sessionStorage.get(); }
336     Storage* optionalLocalStorage() const { return m_localStorage.get(); }
337 
338     DOMApplicationCache&amp; applicationCache();
339     DOMApplicationCache* optionalApplicationCache() const { return m_applicationCache.get(); }
340 
341     CustomElementRegistry* customElementRegistry() { return m_customElementRegistry.get(); }
342     CustomElementRegistry&amp; ensureCustomElementRegistry();
343 
344     ExceptionOr&lt;Ref&lt;NodeList&gt;&gt; collectMatchingElementsInFlatTree(Node&amp;, const String&amp; selectors);
345     ExceptionOr&lt;RefPtr&lt;Element&gt;&gt; matchingElementInFlatTree(Node&amp;, const String&amp; selectors);
346 
347 #if ENABLE(ORIENTATION_EVENTS)
348     // This is the interface orientation in degrees. Some examples are:
349     //  0 is straight up; -90 is when the device is rotated 90 clockwise;
350     //  90 is when rotated counter clockwise.
351     int orientation() const;
352 #endif
353 
354     Performance&amp; performance() const;
355     WEBCORE_EXPORT double nowTimestamp() const;
356 
357 #if PLATFORM(IOS_FAMILY)
358     void incrementScrollEventListenersCount();
359     void decrementScrollEventListenersCount();
360     unsigned scrollEventListenerCount() const { return m_scrollEventListenerCount; }
361 #endif
362 
363 #if ENABLE(DEVICE_ORIENTATION)
364     void startListeningForDeviceOrientationIfNecessary();
365     void stopListeningForDeviceOrientationIfNecessary();
366     void startListeningForDeviceMotionIfNecessary();
367     void stopListeningForDeviceMotionIfNecessary();
368 
369     bool isAllowedToUseDeviceMotionOrientation(String&amp; message) const;
370     bool isAllowedToAddDeviceMotionOrientationListener(String&amp; message) const;
371 
372     DeviceOrientationController* deviceOrientationController() const;
373     DeviceMotionController* deviceMotionController() const;
374 #endif
375 
376     void resetAllGeolocationPermission();
377 
378 #if ENABLE(IOS_TOUCH_EVENTS) || ENABLE(IOS_GESTURE_EVENTS)
379     bool hasTouchOrGestureEventListeners() const { return m_touchAndGestureEventListenerCount &gt; 0; }
380 #endif
381 
382 #if ENABLE(USER_MESSAGE_HANDLERS)
383     bool shouldHaveWebKitNamespaceForWorld(DOMWrapperWorld&amp;);
384     WebKitNamespace* webkitNamespace();
385 #endif
386 
387     // FIXME: When this DOMWindow is no longer the active DOMWindow (i.e.,
388     // when its document is no longer the document that is displayed in its
389     // frame), we would like to zero out m_frame to avoid being confused
390     // by the document that is currently active in m_frame.
391     bool isCurrentlyDisplayedInFrame() const;
392 
393     void willDetachDocumentFromFrame();
394     void willDestroyCachedFrame();
395 
396     void enableSuddenTermination();
397     void disableSuddenTermination();
398 
399     void willDestroyDocumentInFrame();
400     void frameDestroyed();
401 
402 private:
403     explicit DOMWindow(Document&amp;);
404 
405     ScriptExecutionContext* scriptExecutionContext() const final { return ContextDestructionObserver::scriptExecutionContext(); }
406 
407     bool isLocalDOMWindow() const final { return true; }
408     bool isRemoteDOMWindow() const final { return false; }
409 
410     Page* page();
411     bool allowedToChangeWindowGeometry() const;
412 
413     static ExceptionOr&lt;RefPtr&lt;Frame&gt;&gt; createWindow(const String&amp; urlString, const AtomString&amp; frameName, const WindowFeatures&amp;, DOMWindow&amp; activeWindow, Frame&amp; firstFrame, Frame&amp; openerFrame, const WTF::Function&lt;void(DOMWindow&amp;)&gt;&amp; prepareDialogFunction = nullptr);
414     bool isInsecureScriptAccess(DOMWindow&amp; activeWindow, const String&amp; urlString);
415 
416 #if ENABLE(DEVICE_ORIENTATION)
417     void failedToRegisterDeviceMotionEventListener();
418 #endif
419 
420     bool isSameSecurityOriginAsMainFrame() const;
421 
422 #if ENABLE(GAMEPAD)
423     void incrementGamepadEventListenerCount();
424     void decrementGamepadEventListenerCount();
425 #endif
426 
427     bool m_shouldPrintWhenFinishedLoading { false };
428     bool m_suspendedForDocumentSuspension { false };
429     bool m_isSuspendingObservers { false };
430     Optional&lt;bool&gt; m_canShowModalDialogOverride;
431 
432     HashSet&lt;Observer*&gt; m_observers;
433 
434     mutable RefPtr&lt;Crypto&gt; m_crypto;
435     mutable RefPtr&lt;History&gt; m_history;
436     mutable RefPtr&lt;BarProp&gt; m_locationbar;
437     mutable RefPtr&lt;StyleMedia&gt; m_media;
438     mutable RefPtr&lt;BarProp&gt; m_menubar;
439     mutable RefPtr&lt;Navigator&gt; m_navigator;
440     mutable RefPtr&lt;BarProp&gt; m_personalbar;
441     mutable RefPtr&lt;Screen&gt; m_screen;
442     mutable RefPtr&lt;BarProp&gt; m_scrollbars;
443     mutable RefPtr&lt;DOMSelection&gt; m_selection;
444     mutable RefPtr&lt;BarProp&gt; m_statusbar;
445     mutable RefPtr&lt;BarProp&gt; m_toolbar;
446     mutable RefPtr&lt;Location&gt; m_location;
447     mutable RefPtr&lt;VisualViewport&gt; m_visualViewport;
448 
449     String m_status;
450     String m_defaultStatus;
451 
452     enum class PageStatus { None, Shown, Hidden };
453     PageStatus m_lastPageStatus { PageStatus::None };
454 
455 #if PLATFORM(IOS_FAMILY)
456     unsigned m_scrollEventListenerCount { 0 };
457 #endif
458 
459 #if ENABLE(IOS_TOUCH_EVENTS) || ENABLE(IOS_GESTURE_EVENTS)
460     unsigned m_touchAndGestureEventListenerCount { 0 };
461 #endif
462 
463 #if ENABLE(GAMEPAD)
464     unsigned m_gamepadEventListenerCount { 0 };
465 #endif
466 
467     mutable RefPtr&lt;Storage&gt; m_sessionStorage;
468     mutable RefPtr&lt;Storage&gt; m_localStorage;
469     mutable RefPtr&lt;DOMApplicationCache&gt; m_applicationCache;
470 
471     RefPtr&lt;CustomElementRegistry&gt; m_customElementRegistry;
472 
473     mutable RefPtr&lt;Performance&gt; m_performance;
474 
<a name="20" id="anc20"></a><span class="line-added">475     // For the purpose of tracking user activation, each Window W has a last activation timestamp. This is a number indicating the last time W got</span>
<span class="line-added">476     // an activation notification. It corresponds to a DOMHighResTimeStamp value except for two cases: positive infinity indicates that W has never</span>
<span class="line-added">477     // been activated, while negative infinity indicates that a user activation-gated API has consumed the last user activation of W. The initial</span>
<span class="line-added">478     // value is positive infinity.</span>
<span class="line-added">479     MonotonicTime m_lastActivationTimestamp { MonotonicTime::infinity() };</span>
<span class="line-added">480 </span>
481 #if ENABLE(USER_MESSAGE_HANDLERS)
482     mutable RefPtr&lt;WebKitNamespace&gt; m_webkitNamespace;
483 #endif
484 };
485 
486 inline String DOMWindow::status() const
487 {
488     return m_status;
489 }
490 
491 inline String DOMWindow::defaultStatus() const
492 {
493     return m_defaultStatus;
494 }
495 
496 } // namespace WebCore
497 
498 SPECIALIZE_TYPE_TRAITS_BEGIN(WebCore::DOMWindow)
499     static bool isType(const WebCore::AbstractDOMWindow&amp; window) { return window.isLocalDOMWindow(); }
500     static bool isType(const WebCore::EventTarget&amp; target) { return target.eventTargetInterface() == WebCore::DOMWindowEventTargetInterfaceType; }
501 SPECIALIZE_TYPE_TRAITS_END()
<a name="21" id="anc21"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="21" type="hidden" />
</body>
</html>