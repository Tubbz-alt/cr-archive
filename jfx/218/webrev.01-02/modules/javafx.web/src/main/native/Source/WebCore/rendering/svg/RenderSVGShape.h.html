<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/rendering/svg/RenderSVGShape.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2004, 2005, 2007 Nikolas Zimmermann &lt;zimmermann@kde.org&gt;
  3  * Copyright (C) 2004, 2005 Rob Buis &lt;buis@kde.org&gt;
  4  * Copyright (C) 2005 Eric Seidel &lt;eric@webkit.org&gt;
  5  * Copyright (C) 2006 Apple Inc.
  6  * Copyright (C) 2009 Google, Inc.
  7  * Copyright (C) 2011 Renata Hodovan &lt;reni@webkit.org&gt;
  8  * Copyright (C) 2011 University of Szeged
  9  *
 10  * This library is free software; you can redistribute it and/or
 11  * modify it under the terms of the GNU Library General Public
 12  * License as published by the Free Software Foundation; either
 13  * version 2 of the License, or (at your option) any later version.
 14  *
 15  * This library is distributed in the hope that it will be useful,
 16  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 17  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 18  * Library General Public License for more details.
 19  *
 20  * You should have received a copy of the GNU Library General Public License
 21  * along with this library; see the file COPYING.LIB.  If not, write to
 22  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 23  * Boston, MA 02110-1301, USA.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;AffineTransform.h&quot;
 29 #include &quot;FloatRect.h&quot;
 30 #include &quot;RenderSVGModelObject.h&quot;
 31 #include &quot;SVGGraphicsElement.h&quot;
 32 #include &quot;SVGMarkerData.h&quot;
 33 #include &lt;memory&gt;
 34 #include &lt;wtf/Vector.h&gt;
 35 
 36 namespace WebCore {
 37 
 38 class FloatPoint;
 39 class GraphicsContextStateSaver;
 40 class RenderSVGContainer;
 41 class RenderSVGPath;
 42 class RenderSVGResource;
 43 class SVGGraphicsElement;
 44 
 45 class RenderSVGShape : public RenderSVGModelObject {
 46     WTF_MAKE_ISO_ALLOCATED(RenderSVGShape);
 47 public:
 48     enum PointCoordinateSpace {
 49         GlobalCoordinateSpace,
 50         LocalCoordinateSpace
 51     };
 52     RenderSVGShape(SVGGraphicsElement&amp;, RenderStyle&amp;&amp;);
 53     virtual ~RenderSVGShape();
 54 
 55     SVGGraphicsElement&amp; graphicsElement() const { return downcast&lt;SVGGraphicsElement&gt;(RenderSVGModelObject::element()); }
 56 
 57     void setNeedsShapeUpdate() { m_needsShapeUpdate = true; }
 58     void setNeedsBoundariesUpdate() final { m_needsBoundariesUpdate = true; }
 59     bool needsBoundariesUpdate() final { return m_needsBoundariesUpdate; }
 60     void setNeedsTransformUpdate() final { m_needsTransformUpdate = true; }
 61     virtual void fillShape(GraphicsContext&amp;) const;
 62     virtual void strokeShape(GraphicsContext&amp;) const;
 63     virtual bool isRenderingDisabled() const = 0;
 64 
 65     bool isPointInFill(const FloatPoint&amp;);
 66     bool isPointInStroke(const FloatPoint&amp;);
 67 
 68     float getTotalLength() const;
 69     FloatPoint getPointAtLength(float distance) const;
 70 
 71     bool hasPath() const { return m_path.get(); }
 72     Path&amp; path() const
 73     {
 74         ASSERT(m_path);
 75         return *m_path;
 76     }
 77     void clearPath() { m_path = nullptr; }
 78 
 79 protected:
 80     void element() const = delete;
 81 
 82     virtual void updateShapeFromElement();
 83     virtual bool isEmpty() const;
 84     virtual bool shapeDependentStrokeContains(const FloatPoint&amp;, PointCoordinateSpace = GlobalCoordinateSpace);
 85     virtual bool shapeDependentFillContains(const FloatPoint&amp;, const WindRule) const;
 86     float strokeWidth() const;
 87     bool hasSmoothStroke() const;
 88 
 89     bool hasNonScalingStroke() const { return style().svgStyle().vectorEffect() == VectorEffect::NonScalingStroke; }
 90     AffineTransform nonScalingStrokeTransform() const;
 91     Path* nonScalingStrokePath(const Path*, const AffineTransform&amp;) const;
 92 
 93     FloatRect m_fillBoundingBox;
 94     FloatRect m_strokeBoundingBox;
 95 
 96 private:
 97     // Hit-detection separated for the fill and the stroke
 98     bool fillContains(const FloatPoint&amp;, bool requiresFill = true, const WindRule fillRule = WindRule::NonZero);
 99     bool strokeContains(const FloatPoint&amp;, bool requiresStroke = true);
100 
101     FloatRect repaintRectInLocalCoordinates() const final { return m_repaintBoundingBox; }
102     const AffineTransform&amp; localToParentTransform() const final { return m_localTransform; }
103     AffineTransform localTransform() const final { return m_localTransform; }
104 
105     bool isSVGShape() const final { return true; }
106     bool canHaveChildren() const final { return false; }
107     const char* renderName() const override { return &quot;RenderSVGShape&quot;; }
108 
109     void layout() final;
110     void paint(PaintInfo&amp;, const LayoutPoint&amp;) final;
111     void addFocusRingRects(Vector&lt;LayoutRect&gt;&amp;, const LayoutPoint&amp; additionalOffset, const RenderLayerModelObject* paintContainer = 0) final;
112 
113     bool nodeAtFloatPoint(const HitTestRequest&amp;, HitTestResult&amp;, const FloatPoint&amp; pointInParent, HitTestAction) final;
114 
115     FloatRect objectBoundingBox() const final { return m_fillBoundingBox; }
116     FloatRect strokeBoundingBox() const final { return m_strokeBoundingBox; }
117     FloatRect calculateObjectBoundingBox() const;
118     FloatRect calculateStrokeBoundingBox() const;
119     void updateRepaintBoundingBox();
120 
121     bool setupNonScalingStrokeContext(AffineTransform&amp;, GraphicsContextStateSaver&amp;);
122 
123     bool shouldGenerateMarkerPositions() const;
124     FloatRect markerRect(float strokeWidth) const;
125 
126     std::unique_ptr&lt;Path&gt; createPath() const;
127     void processMarkerPositions();
128 
129     void fillShape(const RenderStyle&amp;, GraphicsContext&amp;);
130     void strokeShape(const RenderStyle&amp;, GraphicsContext&amp;);
131     void strokeShape(GraphicsContext&amp;);
132     void fillStrokeMarkers(PaintInfo&amp;);
133     void drawMarkers(PaintInfo&amp;);
134 
135 private:
136     FloatRect m_repaintBoundingBox;
137     FloatRect m_repaintBoundingBoxExcludingShadow;
138 
139     bool m_needsBoundariesUpdate : 1;
140     bool m_needsShapeUpdate : 1;
141     bool m_needsTransformUpdate : 1;
142 
143     AffineTransform m_localTransform;
144     std::unique_ptr&lt;Path&gt; m_path;
145     Vector&lt;MarkerPosition&gt; m_markerPositions;
146 };
147 
148 } // namespace WebCore
149 
150 SPECIALIZE_TYPE_TRAITS_RENDER_OBJECT(RenderSVGShape, isSVGShape())
    </pre>
  </body>
</html>