<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/bindings/scripts/generate-bindings.pl</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="generate-bindings-all.pl.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="preprocess-idls.pl.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bindings/scripts/generate-bindings.pl</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -55,12 +55,13 @@</span>
  my $writeDependencies;
  my $verbose;
  my $supplementalDependencyFile;
  my $additionalIdlFiles;
  my $idlAttributesFile;
<span class="udiff-line-added">+ my $includeDirsList;</span>
  
<span class="udiff-line-modified-removed">- GetOptions(&#39;include=s@&#39; =&gt; \@idlDirectories,</span>
<span class="udiff-line-modified-added">+ GetOptions(&#39;includeDirsList=s&#39; =&gt; \$includeDirsList,</span>
             &#39;outputDir=s&#39; =&gt; \$outputDirectory,
             &#39;outputHeadersDir=s&#39; =&gt; \$outputHeadersDirectory,
             &#39;generator=s&#39; =&gt; \$generator,
             &#39;defines=s&#39; =&gt; \$defines,
             &#39;filename=s&#39; =&gt; \$filename,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -70,10 +71,14 @@</span>
             &#39;write-dependencies&#39; =&gt; \$writeDependencies,
             &#39;supplementalDependencyFile=s&#39; =&gt; \$supplementalDependencyFile,
             &#39;additionalIdlFiles=s&#39; =&gt; \$additionalIdlFiles,
             &#39;idlAttributesFile=s&#39; =&gt; \$idlAttributesFile);
  
<span class="udiff-line-added">+ open(my $dh, &#39;&lt;&#39;, $includeDirsList) or die &quot;Cannot open $includeDirsList&quot;;</span>
<span class="udiff-line-added">+ @idlDirectories = map { (my $path = $_) =~ s/\r?\n?$//; CygwinPathIfNeeded($path) } &lt;$dh&gt;;</span>
<span class="udiff-line-added">+ close($dh) or die;</span>
<span class="udiff-line-added">+ </span>
  die(&#39;Must specify input file.&#39;) unless @ARGV;
  die(&#39;Must specify generator&#39;) unless defined($generator);
  die(&#39;Must specify output directory.&#39;) unless defined($outputDirectory);
  die(&#39;Must specify IDL attributes file.&#39;) unless defined($idlAttributesFile);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -92,11 +97,11 @@</span>
          print &quot;$generator: $targetIdlFile\n&quot;;
      }
      my $targetInterfaceName = fileparse($targetIdlFile, &quot;.idl&quot;);
  
      my $idlFound = 0;
<span class="udiff-line-modified-removed">-     my @supplementedIdlFiles;</span>
<span class="udiff-line-modified-added">+     my %supplementalDependencies;</span>
      if ($supplementalDependencyFile) {
          # The format of a supplemental dependency file:
          #
          # DOMWindow.idl P.idl Q.idl R.idl
          # Document.idl S.idl
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -107,17 +112,18 @@</span>
          # Document.idl is supplemented by S.idl, and Event.idl is supplemented by no IDLs.
          # The IDL that supplements another IDL (e.g. P.idl) never appears in the dependency file.
          open FH, &quot;&lt; $supplementalDependencyFile&quot; or die &quot;Cannot open $supplementalDependencyFile\n&quot;;
          while (my $line = &lt;FH&gt;) {
              my ($idlFile, @followingIdlFiles) = split(/\s+/, $line);
<span class="udiff-line-modified-removed">-             if ($idlFile and fileparse($idlFile) eq fileparse($targetIdlFile)) {</span>
<span class="udiff-line-removed">-                 $idlFound = 1;</span>
<span class="udiff-line-removed">-                 @supplementedIdlFiles = sort @followingIdlFiles;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+             $supplementalDependencies{fileparse($idlFile)} = [sort @followingIdlFiles] if $idlFile;</span>
          }
          close FH;
  
<span class="udiff-line-added">+         if (exists $supplementalDependencies{fileparse($targetIdlFile)}) {</span>
<span class="udiff-line-added">+             $idlFound = 1;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
          # $additionalIdlFiles is list of IDL files which should not be included in
          # DerivedSources*.cpp (i.e. they are not described in the supplemental
          # dependency file) but should generate .h and .cpp files.
          if (!$idlFound and $additionalIdlFiles) {
              my @idlFiles = shellwords($additionalIdlFiles);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -147,132 +153,15 @@</span>
  
      # Parse the target IDL file.
      my $targetParser = IDLParser-&gt;new(!$verbose);
      my $targetDocument = $targetParser-&gt;Parse($targetIdlFile, $defines, $preprocessor, $idlAttributes);
  
<span class="udiff-line-removed">-     foreach my $idlFile (@supplementedIdlFiles) {</span>
<span class="udiff-line-removed">-         next if $idlFile eq $targetIdlFile;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         my $interfaceName = fileparse($idlFile, &quot;.idl&quot;);</span>
<span class="udiff-line-removed">-         my $parser = IDLParser-&gt;new(!$verbose);</span>
<span class="udiff-line-removed">-         my $document = $parser-&gt;Parse($idlFile, $defines, $preprocessor, $idlAttributes);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         foreach my $interface (@{$document-&gt;interfaces}) {</span>
<span class="udiff-line-removed">-             next unless !$interface-&gt;isPartial || $interface-&gt;type-&gt;name eq $targetInterfaceName;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             my $targetDataNode;</span>
<span class="udiff-line-removed">-             my @targetGlobalContexts;</span>
<span class="udiff-line-removed">-             foreach my $interface (@{$targetDocument-&gt;interfaces}) {</span>
<span class="udiff-line-removed">-                 if ($interface-&gt;type-&gt;name eq $targetInterfaceName) {</span>
<span class="udiff-line-removed">-                     $targetDataNode = $interface;</span>
<span class="udiff-line-removed">-                     my $exposedAttribute = $targetDataNode-&gt;extendedAttributes-&gt;{&quot;Exposed&quot;} || &quot;Window&quot;;</span>
<span class="udiff-line-removed">-                     $exposedAttribute = substr($exposedAttribute, 1, -1) if substr($exposedAttribute, 0, 1) eq &quot;(&quot;;</span>
<span class="udiff-line-removed">-                     @targetGlobalContexts = split(&quot;,&quot;, $exposedAttribute);</span>
<span class="udiff-line-removed">-                     last;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             die &quot;Not found an interface ${targetInterfaceName} in ${targetInterfaceName}.idl.&quot; unless defined $targetDataNode;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             # Support for attributes of partial interfaces.</span>
<span class="udiff-line-removed">-             foreach my $attribute (@{$interface-&gt;attributes}) {</span>
<span class="udiff-line-removed">-                 next unless shouldPropertyBeExposed($attribute, \@targetGlobalContexts);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 # Record that this attribute is implemented by $interfaceName.</span>
<span class="udiff-line-removed">-                 $attribute-&gt;extendedAttributes-&gt;{&quot;ImplementedBy&quot;} = $interfaceName if $interface-&gt;isPartial &amp;&amp; !$attribute-&gt;extendedAttributes-&gt;{Reflect};</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 # Add interface-wide extended attributes to each attribute.</span>
<span class="udiff-line-removed">-                 foreach my $extendedAttributeName (keys %{$interface-&gt;extendedAttributes}) {</span>
<span class="udiff-line-removed">-                     $attribute-&gt;extendedAttributes-&gt;{$extendedAttributeName} = $interface-&gt;extendedAttributes-&gt;{$extendedAttributeName};</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 push(@{$targetDataNode-&gt;attributes}, $attribute);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             # Support for methods of partial interfaces.</span>
<span class="udiff-line-removed">-             foreach my $operation (@{$interface-&gt;operations}) {</span>
<span class="udiff-line-removed">-                 next unless shouldPropertyBeExposed($operation, \@targetGlobalContexts);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 # Record that this method is implemented by $interfaceName.</span>
<span class="udiff-line-removed">-                 $operation-&gt;extendedAttributes-&gt;{&quot;ImplementedBy&quot;} = $interfaceName if $interface-&gt;isPartial;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 # Add interface-wide extended attributes to each method.</span>
<span class="udiff-line-removed">-                 foreach my $extendedAttributeName (keys %{$interface-&gt;extendedAttributes}) {</span>
<span class="udiff-line-removed">-                     $operation-&gt;extendedAttributes-&gt;{$extendedAttributeName} = $interface-&gt;extendedAttributes-&gt;{$extendedAttributeName};</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 push(@{$targetDataNode-&gt;operations}, $operation);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             # Support for constants of partial interfaces.</span>
<span class="udiff-line-removed">-             foreach my $constant (@{$interface-&gt;constants}) {</span>
<span class="udiff-line-removed">-                 next unless shouldPropertyBeExposed($constant, \@targetGlobalContexts);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 # Record that this constant is implemented by $interfaceName.</span>
<span class="udiff-line-removed">-                 $constant-&gt;extendedAttributes-&gt;{&quot;ImplementedBy&quot;} = $interfaceName if $interface-&gt;isPartial;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 # Add interface-wide extended attributes to each constant.</span>
<span class="udiff-line-removed">-                 foreach my $extendedAttributeName (keys %{$interface-&gt;extendedAttributes}) {</span>
<span class="udiff-line-removed">-                     $constant-&gt;extendedAttributes-&gt;{$extendedAttributeName} = $interface-&gt;extendedAttributes-&gt;{$extendedAttributeName};</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 push(@{$targetDataNode-&gt;constants}, $constant);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         foreach my $dictionary (@{$document-&gt;dictionaries}) {</span>
<span class="udiff-line-removed">-             next unless $dictionary-&gt;isPartial &amp;&amp; $dictionary-&gt;type-&gt;name eq $targetInterfaceName;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             my $targetDataNode;</span>
<span class="udiff-line-removed">-             my @targetGlobalContexts;</span>
<span class="udiff-line-removed">-             foreach my $dictionary (@{$targetDocument-&gt;dictionaries}) {</span>
<span class="udiff-line-removed">-                 if ($dictionary-&gt;type-&gt;name eq $targetInterfaceName) {</span>
<span class="udiff-line-removed">-                     $targetDataNode = $dictionary;</span>
<span class="udiff-line-removed">-                     my $exposedAttribute = $targetDataNode-&gt;extendedAttributes-&gt;{&quot;Exposed&quot;} || &quot;Window&quot;;</span>
<span class="udiff-line-removed">-                     $exposedAttribute = substr($exposedAttribute, 1, -1) if substr($exposedAttribute, 0, 1) eq &quot;(&quot;;</span>
<span class="udiff-line-removed">-                     @targetGlobalContexts = split(&quot;,&quot;, $exposedAttribute);</span>
<span class="udiff-line-removed">-                     last;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             die &quot;Could not find dictionary ${targetInterfaceName} in ${targetInterfaceName}.idl.&quot; unless defined $targetDataNode;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             # Support for members of partial dictionaries</span>
<span class="udiff-line-removed">-             foreach my $member (@{$dictionary-&gt;members}) {</span>
<span class="udiff-line-removed">-                 next unless shouldPropertyBeExposed($member, \@targetGlobalContexts);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 # Record that this member is implemented by $interfaceName.</span>
<span class="udiff-line-removed">-                 $member-&gt;extendedAttributes-&gt;{&quot;ImplementedBy&quot;} = $interfaceName;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 # Add interface-wide extended attributes to each member.</span>
<span class="udiff-line-removed">-                 foreach my $extendedAttributeName (keys %{$dictionary-&gt;extendedAttributes}) {</span>
<span class="udiff-line-removed">-                     $member-&gt;extendedAttributes-&gt;{$extendedAttributeName} = $dictionary-&gt;extendedAttributes-&gt;{$extendedAttributeName};</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 push(@{$targetDataNode-&gt;members}, $member);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      # Generate desired output for the target IDL file.
<span class="udiff-line-modified-removed">-     my $codeGen = CodeGenerator-&gt;new(\@idlDirectories, $generator, $outputDirectory, $outputHeadersDirectory, $preprocessor, $writeDependencies, $verbose, $targetIdlFile, $idlAttributes);</span>
<span class="udiff-line-modified-added">+     my $codeGen = CodeGenerator-&gt;new(\@idlDirectories, $generator, $outputDirectory, $outputHeadersDirectory, $preprocessor, $writeDependencies, $verbose, $targetIdlFile, $idlAttributes, \%supplementalDependencies);</span>
      $codeGen-&gt;ProcessDocument($targetDocument, $defines);
  }
  
<span class="udiff-line-removed">- # Attributes / Operations / Constants of supplemental interfaces can have an [Exposed=XX] attribute which restricts</span>
<span class="udiff-line-removed">- # on which global contexts they should be exposed.</span>
<span class="udiff-line-removed">- sub shouldPropertyBeExposed</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     my ($context, $targetGlobalContexts) = @_;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     my $exposed = $context-&gt;extendedAttributes-&gt;{Exposed};</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return 1 unless $exposed;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     $exposed = substr($exposed, 1, -1) if substr($exposed, 0, 1) eq &quot;(&quot;;</span>
<span class="udiff-line-removed">-     my @sourceGlobalContexts = split(&quot;,&quot;, $exposed);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     for my $targetGlobalContext (@$targetGlobalContexts) {</span>
<span class="udiff-line-removed">-         return 1 if grep(/^$targetGlobalContext$/, @sourceGlobalContexts);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     return 0;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  sub generateEmptyHeaderAndCpp
  {
      my ($prefix, $targetInterfaceName, $outputHeadersDirectory, $outputDirectory) = @_;
  
      my $headerName = &quot;${prefix}${targetInterfaceName}.h&quot;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -290,5 +179,12 @@</span>
  
      open FH, &quot;&gt; ${outputDirectory}/${cppName}&quot; or die &quot;Cannot open $cppName\n&quot;;
      print FH $contents;
      close FH;
  }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ sub CygwinPathIfNeeded</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     my $path = shift;</span>
<span class="udiff-line-added">+     return Cygwin::win_to_posix_path($path) if ($^O eq &#39;cygwin&#39;);</span>
<span class="udiff-line-added">+     return $path;</span>
<span class="udiff-line-added">+ }</span>
</pre>
<center><a href="generate-bindings-all.pl.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="preprocess-idls.pl.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>