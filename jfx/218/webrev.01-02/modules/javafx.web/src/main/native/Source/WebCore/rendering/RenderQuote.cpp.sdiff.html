<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderQuote.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="RenderObject.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderReplaced.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderQuote.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 53     view().setHasQuotesNeedingUpdate(true);
 54 }
 55 
 56 void RenderQuote::willBeRemovedFromTree()
 57 {
 58     view().setHasQuotesNeedingUpdate(true);
 59     RenderInline::willBeRemovedFromTree();
 60 }
 61 
 62 void RenderQuote::styleDidChange(StyleDifference diff, const RenderStyle* oldStyle)
 63 {
 64     RenderInline::styleDidChange(diff, oldStyle);
 65     if (diff &gt;= StyleDifference::Layout) {
 66         m_needsTextUpdate = true;
 67         view().setHasQuotesNeedingUpdate(true);
 68     }
 69 }
 70 
 71 const unsigned maxDistinctQuoteCharacters = 16;
 72 
<span class="line-modified"> 73 #if !ASSERT_DISABLED</span>
 74 
 75 static void checkNumberOfDistinctQuoteCharacters(UChar character)
 76 {
 77     ASSERT(character);
 78     static UChar distinctQuoteCharacters[maxDistinctQuoteCharacters];
 79     for (unsigned i = 0; i &lt; maxDistinctQuoteCharacters; ++i) {
 80         if (distinctQuoteCharacters[i] == character)
 81             return;
 82         if (!distinctQuoteCharacters[i]) {
 83             distinctQuoteCharacters[i] = character;
 84             return;
 85         }
 86     }
 87     ASSERT_NOT_REACHED();
 88 }
 89 
<span class="line-modified"> 90 #endif</span>
 91 
 92 struct QuotesForLanguage {
 93     const char* language;
 94     UChar open1;
 95     UChar close1;
 96     UChar open2;
 97     UChar close2;
 98 };
 99 
100 static int quoteTableLanguageComparisonFunction(const void* a, const void* b)
101 {
102     return strcmp(static_cast&lt;const QuotesForLanguage*&gt;(a)-&gt;language,
103         static_cast&lt;const QuotesForLanguage*&gt;(b)-&gt;language);
104 }
105 
106 static const QuotesForLanguage* quotesForLanguage(const String&amp; language)
107 {
108     // Table of quotes from http://www.whatwg.org/specs/web-apps/current-work/multipage/rendering.html#quotes
109     static const QuotesForLanguage quoteTable[] = {
110         { &quot;af&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
</pre>
<hr />
<pre>
242         { &quot;tr&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
243         { &quot;twq&quot;,        0x201c, 0x201d, 0x2018, 0x2019 },
244         { &quot;tzm&quot;,        0x201c, 0x201d, 0x2018, 0x2019 },
245         { &quot;uk&quot;,         0x00ab, 0x00bb, 0x201e, 0x201c },
246         { &quot;ur&quot;,         0x201d, 0x201c, 0x2019, 0x2018 },
247         { &quot;vai&quot;,        0x201c, 0x201d, 0x2018, 0x2019 },
248         { &quot;vai-latn&quot;,   0x201c, 0x201d, 0x2018, 0x2019 },
249         { &quot;vi&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
250         { &quot;vun&quot;,        0x201c, 0x201d, 0x2018, 0x2019 },
251         { &quot;xh&quot;,         0x2018, 0x2019, 0x201c, 0x201d },
252         { &quot;xog&quot;,        0x201c, 0x201d, 0x2018, 0x2019 },
253         { &quot;yav&quot;,        0x00ab, 0x00bb, 0x00ab, 0x00bb },
254         { &quot;yo&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
255         { &quot;zh&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
256         { &quot;zh-hant&quot;,    0x300c, 0x300d, 0x300e, 0x300f },
257         { &quot;zu&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
258     };
259 
260     const unsigned maxLanguageLength = 8;
261 
<span class="line-modified">262 #if !ASSERT_DISABLED</span>
263     // One time check that the table meets the constraints that the code below relies on.
264 
265     static bool didOneTimeCheck = false;
266     if (!didOneTimeCheck) {
267         didOneTimeCheck = true;
268 
269         checkNumberOfDistinctQuoteCharacters(quotationMark);
270         checkNumberOfDistinctQuoteCharacters(apostrophe);
271 
272         for (unsigned i = 0; i &lt; WTF_ARRAY_LENGTH(quoteTable); ++i) {
273             ASSERT(strlen(quoteTable[i].language) &lt;= maxLanguageLength);
274 
275             if (i)
276                 ASSERT(strcmp(quoteTable[i - 1].language, quoteTable[i].language) &lt; 0);
277 
278             for (unsigned j = 0; UChar character = quoteTable[i].language[j]; ++j)
279                 ASSERT(isASCIILower(character) || character == &#39;-&#39;);
280 
281             checkNumberOfDistinctQuoteCharacters(quoteTable[i].open1);
282             checkNumberOfDistinctQuoteCharacters(quoteTable[i].close1);
283             checkNumberOfDistinctQuoteCharacters(quoteTable[i].open2);
284             checkNumberOfDistinctQuoteCharacters(quoteTable[i].close2);
285         }
286     }
<span class="line-modified">287 #endif</span>
288 
289     unsigned length = language.length();
290     if (!length || length &gt; maxLanguageLength)
291         return 0;
292 
293     char languageKeyBuffer[maxLanguageLength + 1];
294     for (unsigned i = 0; i &lt; length; ++i) {
295         UChar character = toASCIILower(language[i]);
296         if (!(isASCIILower(character) || character == &#39;-&#39;))
297             return 0;
298         languageKeyBuffer[i] = static_cast&lt;char&gt;(character);
299     }
300     languageKeyBuffer[length] = 0;
301 
302     QuotesForLanguage languageKey = { languageKeyBuffer, 0, 0, 0, 0 };
303 
304     return static_cast&lt;const QuotesForLanguage*&gt;(bsearch(&amp;languageKey,
305         quoteTable, WTF_ARRAY_LENGTH(quoteTable), sizeof(quoteTable[0]), quoteTableLanguageComparisonFunction));
306 }
307 
</pre>
</td>
<td>
<hr />
<pre>
 53     view().setHasQuotesNeedingUpdate(true);
 54 }
 55 
 56 void RenderQuote::willBeRemovedFromTree()
 57 {
 58     view().setHasQuotesNeedingUpdate(true);
 59     RenderInline::willBeRemovedFromTree();
 60 }
 61 
 62 void RenderQuote::styleDidChange(StyleDifference diff, const RenderStyle* oldStyle)
 63 {
 64     RenderInline::styleDidChange(diff, oldStyle);
 65     if (diff &gt;= StyleDifference::Layout) {
 66         m_needsTextUpdate = true;
 67         view().setHasQuotesNeedingUpdate(true);
 68     }
 69 }
 70 
 71 const unsigned maxDistinctQuoteCharacters = 16;
 72 
<span class="line-modified"> 73 #if ASSERT_ENABLED</span>
 74 
 75 static void checkNumberOfDistinctQuoteCharacters(UChar character)
 76 {
 77     ASSERT(character);
 78     static UChar distinctQuoteCharacters[maxDistinctQuoteCharacters];
 79     for (unsigned i = 0; i &lt; maxDistinctQuoteCharacters; ++i) {
 80         if (distinctQuoteCharacters[i] == character)
 81             return;
 82         if (!distinctQuoteCharacters[i]) {
 83             distinctQuoteCharacters[i] = character;
 84             return;
 85         }
 86     }
 87     ASSERT_NOT_REACHED();
 88 }
 89 
<span class="line-modified"> 90 #endif // ASSERT_ENABLED</span>
 91 
 92 struct QuotesForLanguage {
 93     const char* language;
 94     UChar open1;
 95     UChar close1;
 96     UChar open2;
 97     UChar close2;
 98 };
 99 
100 static int quoteTableLanguageComparisonFunction(const void* a, const void* b)
101 {
102     return strcmp(static_cast&lt;const QuotesForLanguage*&gt;(a)-&gt;language,
103         static_cast&lt;const QuotesForLanguage*&gt;(b)-&gt;language);
104 }
105 
106 static const QuotesForLanguage* quotesForLanguage(const String&amp; language)
107 {
108     // Table of quotes from http://www.whatwg.org/specs/web-apps/current-work/multipage/rendering.html#quotes
109     static const QuotesForLanguage quoteTable[] = {
110         { &quot;af&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
</pre>
<hr />
<pre>
242         { &quot;tr&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
243         { &quot;twq&quot;,        0x201c, 0x201d, 0x2018, 0x2019 },
244         { &quot;tzm&quot;,        0x201c, 0x201d, 0x2018, 0x2019 },
245         { &quot;uk&quot;,         0x00ab, 0x00bb, 0x201e, 0x201c },
246         { &quot;ur&quot;,         0x201d, 0x201c, 0x2019, 0x2018 },
247         { &quot;vai&quot;,        0x201c, 0x201d, 0x2018, 0x2019 },
248         { &quot;vai-latn&quot;,   0x201c, 0x201d, 0x2018, 0x2019 },
249         { &quot;vi&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
250         { &quot;vun&quot;,        0x201c, 0x201d, 0x2018, 0x2019 },
251         { &quot;xh&quot;,         0x2018, 0x2019, 0x201c, 0x201d },
252         { &quot;xog&quot;,        0x201c, 0x201d, 0x2018, 0x2019 },
253         { &quot;yav&quot;,        0x00ab, 0x00bb, 0x00ab, 0x00bb },
254         { &quot;yo&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
255         { &quot;zh&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
256         { &quot;zh-hant&quot;,    0x300c, 0x300d, 0x300e, 0x300f },
257         { &quot;zu&quot;,         0x201c, 0x201d, 0x2018, 0x2019 },
258     };
259 
260     const unsigned maxLanguageLength = 8;
261 
<span class="line-modified">262 #if ASSERT_ENABLED</span>
263     // One time check that the table meets the constraints that the code below relies on.
264 
265     static bool didOneTimeCheck = false;
266     if (!didOneTimeCheck) {
267         didOneTimeCheck = true;
268 
269         checkNumberOfDistinctQuoteCharacters(quotationMark);
270         checkNumberOfDistinctQuoteCharacters(apostrophe);
271 
272         for (unsigned i = 0; i &lt; WTF_ARRAY_LENGTH(quoteTable); ++i) {
273             ASSERT(strlen(quoteTable[i].language) &lt;= maxLanguageLength);
274 
275             if (i)
276                 ASSERT(strcmp(quoteTable[i - 1].language, quoteTable[i].language) &lt; 0);
277 
278             for (unsigned j = 0; UChar character = quoteTable[i].language[j]; ++j)
279                 ASSERT(isASCIILower(character) || character == &#39;-&#39;);
280 
281             checkNumberOfDistinctQuoteCharacters(quoteTable[i].open1);
282             checkNumberOfDistinctQuoteCharacters(quoteTable[i].close1);
283             checkNumberOfDistinctQuoteCharacters(quoteTable[i].open2);
284             checkNumberOfDistinctQuoteCharacters(quoteTable[i].close2);
285         }
286     }
<span class="line-modified">287 #endif // ASSERT_ENABLED</span>
288 
289     unsigned length = language.length();
290     if (!length || length &gt; maxLanguageLength)
291         return 0;
292 
293     char languageKeyBuffer[maxLanguageLength + 1];
294     for (unsigned i = 0; i &lt; length; ++i) {
295         UChar character = toASCIILower(language[i]);
296         if (!(isASCIILower(character) || character == &#39;-&#39;))
297             return 0;
298         languageKeyBuffer[i] = static_cast&lt;char&gt;(character);
299     }
300     languageKeyBuffer[length] = 0;
301 
302     QuotesForLanguage languageKey = { languageKeyBuffer, 0, 0, 0, 0 };
303 
304     return static_cast&lt;const QuotesForLanguage*&gt;(bsearch(&amp;languageKey,
305         quoteTable, WTF_ARRAY_LENGTH(quoteTable), sizeof(quoteTable[0]), quoteTableLanguageComparisonFunction));
306 }
307 
</pre>
</td>
</tr>
</table>
<center><a href="RenderObject.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderReplaced.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>