<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WTF/wtf/text/StringBuffer.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="IntegerToStringConversion.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="StringBuilder.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WTF/wtf/text/StringBuffer.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 29,28 ***</span>
  #pragma once
  
  #include &lt;limits&gt;
  #include &lt;unicode/utypes.h&gt;
  #include &lt;wtf/Assertions.h&gt;
  #include &lt;wtf/MallocPtr.h&gt;
  
  namespace WTF {
  
  template &lt;typename CharType&gt;
  class StringBuffer {
      WTF_MAKE_NONCOPYABLE(StringBuffer);
      WTF_MAKE_FAST_ALLOCATED;
  public:
      explicit StringBuffer(unsigned length)
          : m_length(length)
<span class="line-modified">!         , m_data(m_length ? static_cast&lt;CharType*&gt;(fastMalloc((Checked&lt;size_t&gt;(m_length) * sizeof(CharType)).unsafeGet())) : nullptr)</span>
      {
      }
  
      ~StringBuffer()
      {
<span class="line-modified">!         fastFree(m_data);</span>
      }
  
      void shrink(unsigned newLength)
      {
          ASSERT(newLength &lt;= m_length);
<span class="line-new-header">--- 29,32 ---</span>
  #pragma once
  
  #include &lt;limits&gt;
  #include &lt;unicode/utypes.h&gt;
  #include &lt;wtf/Assertions.h&gt;
<span class="line-added">+ #include &lt;wtf/DebugHeap.h&gt;</span>
  #include &lt;wtf/MallocPtr.h&gt;
<span class="line-added">+ #include &lt;wtf/Noncopyable.h&gt;</span>
  
  namespace WTF {
  
<span class="line-added">+ DECLARE_ALLOCATOR_WITH_HEAP_IDENTIFIER(StringBuffer);</span>
<span class="line-added">+ </span>
  template &lt;typename CharType&gt;
  class StringBuffer {
      WTF_MAKE_NONCOPYABLE(StringBuffer);
      WTF_MAKE_FAST_ALLOCATED;
  public:
      explicit StringBuffer(unsigned length)
          : m_length(length)
<span class="line-modified">!         , m_data(m_length ? static_cast&lt;CharType*&gt;(StringBufferMalloc::malloc((Checked&lt;size_t&gt;(m_length) * sizeof(CharType)).unsafeGet())) : nullptr)</span>
      {
      }
  
      ~StringBuffer()
      {
<span class="line-modified">!         StringBufferMalloc::free(m_data);</span>
      }
  
      void shrink(unsigned newLength)
      {
          ASSERT(newLength &lt;= m_length);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 60,25 ***</span>
      void resize(unsigned newLength)
      {
          if (newLength &gt; m_length) {
              if (newLength &gt; std::numeric_limits&lt;unsigned&gt;::max() / sizeof(UChar))
                  CRASH();
<span class="line-modified">!             m_data = static_cast&lt;UChar*&gt;(fastRealloc(m_data, newLength * sizeof(UChar)));</span>
          }
          m_length = newLength;
      }
  
      unsigned length() const { return m_length; }
      CharType* characters() { return m_data; }
  
      CharType&amp; operator[](unsigned i) { ASSERT_WITH_SECURITY_IMPLICATION(i &lt; m_length); return m_data[i]; }
  
<span class="line-modified">!     MallocPtr&lt;CharType&gt; release()</span>
      {
          CharType* data = m_data;
          m_data = 0;
<span class="line-modified">!         return adoptMallocPtr(data);</span>
      }
  
  private:
      unsigned m_length;
      CharType* m_data;
<span class="line-new-header">--- 64,25 ---</span>
      void resize(unsigned newLength)
      {
          if (newLength &gt; m_length) {
              if (newLength &gt; std::numeric_limits&lt;unsigned&gt;::max() / sizeof(UChar))
                  CRASH();
<span class="line-modified">!             m_data = static_cast&lt;UChar*&gt;(StringBufferMalloc::realloc(m_data, newLength * sizeof(UChar)));</span>
          }
          m_length = newLength;
      }
  
      unsigned length() const { return m_length; }
      CharType* characters() { return m_data; }
  
      CharType&amp; operator[](unsigned i) { ASSERT_WITH_SECURITY_IMPLICATION(i &lt; m_length); return m_data[i]; }
  
<span class="line-modified">!     MallocPtr&lt;CharType, StringBufferMalloc&gt; release()</span>
      {
          CharType* data = m_data;
          m_data = 0;
<span class="line-modified">!         return adoptMallocPtr&lt;CharType, StringBufferMalloc&gt;(data);</span>
      }
  
  private:
      unsigned m_length;
      CharType* m_data;
</pre>
<center><a href="IntegerToStringConversion.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="StringBuilder.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>