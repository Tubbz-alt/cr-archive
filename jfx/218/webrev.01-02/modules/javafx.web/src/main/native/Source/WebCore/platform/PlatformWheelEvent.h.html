<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/platform/PlatformWheelEvent.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2004-2016 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;FloatPoint.h&quot;
 29 #include &quot;IntPoint.h&quot;
 30 #include &quot;PlatformEvent.h&quot;
 31 #include &lt;wtf/WindowsExtras.h&gt;
 32 
 33 #if PLATFORM(GTK)
 34 typedef struct _GdkEventScroll GdkEventScroll;
 35 #endif
 36 
 37 namespace WTF {
 38 class TextStream;
 39 }
 40 
 41 namespace WebCore {
 42 
 43 // The ScrollByPixelWheelEvent is a fine-grained event that specifies the precise number of pixels to scroll.
 44 // It is sent directly by touch pads on macOS, or synthesized when platforms generate line-by-line scrolling events.
 45 //
 46 // The ScrollByPageWheelEvent indicates that the wheel event should scroll an entire page.
 47 // In this case, WebKit built in paging behavior is used to page up and down.
 48 // This yields the same behavior as clicking in a scrollbar track to page up and down.
 49 
 50 enum PlatformWheelEventGranularity : uint8_t {
 51     ScrollByPageWheelEvent,
 52     ScrollByPixelWheelEvent,
 53 };
 54 
 55 #if ENABLE(KINETIC_SCROLLING)
 56 
 57 enum PlatformWheelEventPhase : uint8_t {
 58     PlatformWheelEventPhaseNone = 0,
 59     PlatformWheelEventPhaseBegan = 1 &lt;&lt; 0,
 60     PlatformWheelEventPhaseStationary = 1 &lt;&lt; 1,
 61     PlatformWheelEventPhaseChanged = 1 &lt;&lt; 2,
 62     PlatformWheelEventPhaseEnded = 1 &lt;&lt; 3,
 63     PlatformWheelEventPhaseCancelled = 1 &lt;&lt; 4,
 64     PlatformWheelEventPhaseMayBegin = 1 &lt;&lt; 5,
 65 };
 66 
 67 WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, PlatformWheelEventPhase);
 68 
 69 #endif
 70 
 71 #if PLATFORM(WIN)
 72 // How many pixels should we scroll per line? Gecko uses the height of the
 73 // current line, which means scroll distance changes as you go through the
 74 // page or go to different pages. IE 7 is ~50 px/line, although the value
 75 // seems to vary slightly by page and zoom level. Since IE 7 has a
 76 // smoothing algorithm on scrolling, it can get away with slightly larger
 77 // scroll values without feeling jerky. Here we use 100 px per three lines
 78 // (the default scroll amount on Windows is three lines per wheel tick).
 79 const float cScrollbarPixelsPerLine = 100.0f / 3.0f;
 80 #endif
 81 
 82 class PlatformWheelEvent : public PlatformEvent {
 83 public:
 84     PlatformWheelEvent()
 85         : PlatformEvent(PlatformEvent::Wheel)
 86     {
 87     }
 88 
 89     PlatformWheelEvent(IntPoint position, IntPoint globalPosition, float deltaX, float deltaY, float wheelTicksX, float wheelTicksY, PlatformWheelEventGranularity granularity, bool shiftKey, bool ctrlKey, bool altKey, bool metaKey)
 90         : PlatformEvent(PlatformEvent::Wheel, shiftKey, ctrlKey, altKey, metaKey, { })
 91         , m_position(position)
 92         , m_globalPosition(globalPosition)
 93         , m_deltaX(deltaX)
 94         , m_deltaY(deltaY)
 95         , m_wheelTicksX(wheelTicksX)
 96         , m_wheelTicksY(wheelTicksY)
 97         , m_granularity(granularity)
 98     {
 99     }
100 
101     PlatformWheelEvent copySwappingDirection() const
102     {
103         PlatformWheelEvent copy = *this;
104         std::swap(copy.m_deltaX, copy.m_deltaY);
105         std::swap(copy.m_wheelTicksX, copy.m_wheelTicksY);
106         return copy;
107     }
108 
109     PlatformWheelEvent copyWithDeltasAndVelocity(float deltaX, float deltaY, const FloatSize&amp; velocity) const
110     {
111         PlatformWheelEvent copy = *this;
112         copy.m_deltaX = deltaX;
113         copy.m_deltaY = deltaY;
114         copy.m_scrollingVelocity = velocity;
115         return copy;
116     }
117 
118     const IntPoint&amp; position() const { return m_position; } // PlatformWindow coordinates.
119     const IntPoint&amp; globalPosition() const { return m_globalPosition; } // Screen coordinates.
120 
121     float deltaX() const { return m_deltaX; }
122     float deltaY() const { return m_deltaY; }
123     FloatSize delta() const { return { m_deltaX, m_deltaY}; }
124 
125     float wheelTicksX() const { return m_wheelTicksX; }
126     float wheelTicksY() const { return m_wheelTicksY; }
127 
128     PlatformWheelEventGranularity granularity() const { return m_granularity; }
129 
130     bool directionInvertedFromDevice() const { return m_directionInvertedFromDevice; }
131 
132     const FloatSize&amp; scrollingVelocity() const { return m_scrollingVelocity; }
133 
134 #if PLATFORM(GTK)
135     explicit PlatformWheelEvent(GdkEventScroll*);
136 #endif
137 
138 #if PLATFORM(COCOA)
139     bool hasPreciseScrollingDeltas() const { return m_hasPreciseScrollingDeltas; }
140     void setHasPreciseScrollingDeltas(bool hasPreciseScrollingDeltas) { m_hasPreciseScrollingDeltas = hasPreciseScrollingDeltas; }
141     unsigned scrollCount() const { return m_scrollCount; }
142     float unacceleratedScrollingDeltaX() const { return m_unacceleratedScrollingDeltaX; }
143     float unacceleratedScrollingDeltaY() const { return m_unacceleratedScrollingDeltaY; }
144 #endif
145 
146 #if ENABLE(ASYNC_SCROLLING)
147     bool useLatchedEventElement() const;
148     bool shouldConsiderLatching() const;
149     bool shouldResetLatching() const;
150     bool isEndOfMomentumScroll() const;
151 #else
152     bool useLatchedEventElement() const { return false; }
153 #endif
154 
155 #if ENABLE(KINETIC_SCROLLING)
156     PlatformWheelEventPhase phase() const { return m_phase; }
157     PlatformWheelEventPhase momentumPhase() const { return m_momentumPhase; }
158     bool isEndOfNonMomentumScroll() const;
159     bool isTransitioningToMomentumScroll() const;
160     FloatPoint swipeVelocity() const;
161 #endif
162 
163 #if PLATFORM(WIN)
164     PlatformWheelEvent(HWND, WPARAM, LPARAM, bool isMouseHWheel);
165 #endif
166 
167 #if PLATFORM(JAVA)
168     PlatformWheelEvent(const IntPoint&amp; pos, const IntPoint&amp; globalPos,
169                        float deltaX, float deltaY,
170                        bool shift, bool ctrl, bool alt, bool meta);
171 
172 #endif
173 protected:
174     IntPoint m_position;
175     IntPoint m_globalPosition;
176     float m_deltaX { 0 };
177     float m_deltaY { 0 };
178     float m_wheelTicksX { 0 };
179     float m_wheelTicksY { 0 };
180     PlatformWheelEventGranularity m_granularity { ScrollByPixelWheelEvent };
181     bool m_directionInvertedFromDevice { false };
182 
183     // Scrolling velocity in pixels per second.
184     FloatSize m_scrollingVelocity;
185 
186 #if ENABLE(KINETIC_SCROLLING)
187     PlatformWheelEventPhase m_phase { PlatformWheelEventPhaseNone };
188     PlatformWheelEventPhase m_momentumPhase { PlatformWheelEventPhaseNone };
189 #endif
190 #if PLATFORM(COCOA)
191     bool m_hasPreciseScrollingDeltas { false };
192     unsigned m_scrollCount { 0 };
193     float m_unacceleratedScrollingDeltaX { 0 };
194     float m_unacceleratedScrollingDeltaY { 0 };
195 #endif
196 };
197 
198 #if ENABLE(ASYNC_SCROLLING)
199 
200 inline bool PlatformWheelEvent::useLatchedEventElement() const
201 {
202     return m_phase == PlatformWheelEventPhaseBegan
203         || m_phase == PlatformWheelEventPhaseChanged
204         || m_momentumPhase == PlatformWheelEventPhaseBegan
205         || m_momentumPhase == PlatformWheelEventPhaseChanged
206         || (m_phase == PlatformWheelEventPhaseEnded &amp;&amp; m_momentumPhase == PlatformWheelEventPhaseNone);
207 }
208 
209 inline bool PlatformWheelEvent::shouldConsiderLatching() const
210 {
211     return m_phase == PlatformWheelEventPhaseBegan || m_phase == PlatformWheelEventPhaseMayBegin;
212 }
213 
214 inline bool PlatformWheelEvent::shouldResetLatching() const
215 {
216     return m_phase == PlatformWheelEventPhaseCancelled || m_phase == PlatformWheelEventPhaseMayBegin || isEndOfMomentumScroll();
217 }
218 
219 inline bool PlatformWheelEvent::isEndOfMomentumScroll() const
220 {
221     return m_phase == PlatformWheelEventPhaseNone &amp;&amp; m_momentumPhase == PlatformWheelEventPhaseEnded;
222 }
223 
224 #endif // ENABLE(ASYNC_SCROLLING)
225 
226 #if ENABLE(KINETIC_SCROLLING)
227 
228 inline bool PlatformWheelEvent::isEndOfNonMomentumScroll() const
229 {
230     return m_phase == PlatformWheelEventPhaseEnded &amp;&amp; m_momentumPhase == PlatformWheelEventPhaseNone;
231 }
232 
233 inline bool PlatformWheelEvent::isTransitioningToMomentumScroll() const
234 {
235     return m_phase == PlatformWheelEventPhaseNone &amp;&amp; m_momentumPhase == PlatformWheelEventPhaseBegan;
236 }
237 
238 inline FloatPoint PlatformWheelEvent::swipeVelocity() const
239 {
240     // The swiping velocity is stored in the deltas of the event declaring it.
241     return isTransitioningToMomentumScroll() ? FloatPoint(m_wheelTicksX, m_wheelTicksY) : FloatPoint();
242 }
243 
244 #endif // ENABLE(KINETIC_SCROLLING)
245 
246 WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, const PlatformWheelEvent&amp;);
247 
248 } // namespace WebCore
    </pre>
  </body>
</html>