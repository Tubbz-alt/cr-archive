<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/Modules/mediastream/MediaDevices.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MediaDevices.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaDevices.idl.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/mediastream/MediaDevices.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 20  * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 21  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 22  * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 23  * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 24  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 25  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 26  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 27  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 28  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 29  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 30  */
 31 
 32 #pragma once
 33 
 34 #if ENABLE(MEDIA_STREAM)
 35 
 36 #include &quot;ActiveDOMObject.h&quot;
 37 #include &quot;EventNames.h&quot;
 38 #include &quot;EventTarget.h&quot;
 39 #include &quot;ExceptionOr.h&quot;
<span class="line-modified"> 40 #include &quot;JSDOMPromiseDeferred.h&quot;</span>
 41 #include &quot;MediaTrackConstraints.h&quot;
 42 #include &quot;RealtimeMediaSourceCenter.h&quot;
 43 #include &quot;Timer.h&quot;
 44 #include &quot;UserMediaClient.h&quot;
 45 #include &lt;wtf/WeakPtr.h&gt;
 46 
 47 namespace WebCore {
 48 
 49 class Document;
 50 class MediaDeviceInfo;
 51 class MediaStream;

 52 
 53 struct MediaTrackSupportedConstraints;
 54 


 55 class MediaDevices final : public RefCounted&lt;MediaDevices&gt;, public ActiveDOMObject, public EventTargetWithInlineData, public CanMakeWeakPtr&lt;MediaDevices&gt; {
 56     WTF_MAKE_ISO_ALLOCATED(MediaDevices);
 57 public:
 58     static Ref&lt;MediaDevices&gt; create(Document&amp;);
 59 
 60     ~MediaDevices();
 61 
 62     Document* document() const;
 63 
 64     using Promise = DOMPromiseDeferred&lt;IDLInterface&lt;MediaStream&gt;&gt;;
 65     using EnumerateDevicesPromise = DOMPromiseDeferred&lt;IDLSequence&lt;IDLInterface&lt;MediaDeviceInfo&gt;&gt;&gt;;
 66 
 67     enum class DisplayCaptureSurfaceType {
 68         Monitor,
 69         Window,
 70         Application,
 71         Browser,
 72     };
 73 
 74     struct StreamConstraints {
 75         Variant&lt;bool, MediaTrackConstraints&gt; video;
 76         Variant&lt;bool, MediaTrackConstraints&gt; audio;
 77     };
<span class="line-modified"> 78     void getUserMedia(const StreamConstraints&amp;, Promise&amp;&amp;) const;</span>
<span class="line-modified"> 79     void getDisplayMedia(const StreamConstraints&amp;, Promise&amp;&amp;) const;</span>






 80     void enumerateDevices(EnumerateDevicesPromise&amp;&amp;);
 81     MediaTrackSupportedConstraints getSupportedConstraints();
 82 
 83     using RefCounted&lt;MediaDevices&gt;::ref;
 84     using RefCounted&lt;MediaDevices&gt;::deref;
 85 
<span class="line-removed"> 86     void setDisableGetDisplayMediaUserGestureConstraint(bool value) { m_disableGetDisplayMediaUserGestureConstraint = value; }</span>
<span class="line-removed"> 87 </span>
 88 private:
 89     explicit MediaDevices(Document&amp;);
 90 
 91     void scheduledEventTimerFired();
 92     bool addEventListener(const AtomString&amp; eventType, Ref&lt;EventListener&gt;&amp;&amp;, const AddEventListenerOptions&amp;) override;
 93 
 94     void refreshDevices(const Vector&lt;CaptureDevice&gt;&amp;);
 95     void listenForDeviceChanges();
 96 
 97     friend class JSMediaDevicesOwner;
 98 
 99     // ActiveDOMObject
100     const char* activeDOMObjectName() const final;
<span class="line-removed">101     bool canSuspendForDocumentSuspension() const final;</span>
102     void stop() final;
103     bool hasPendingActivity() const final;
104 
105     // EventTargetWithInlineData.
106     EventTargetInterface eventTargetInterface() const final { return MediaDevicesEventTargetInterfaceType; }
107     ScriptExecutionContext* scriptExecutionContext() const final { return ActiveDOMObject::scriptExecutionContext(); }
108     void refEventTarget() final { ref(); }
109     void derefEventTarget() final { deref(); }
110 







111     Timer m_scheduledEventTimer;
112     UserMediaClient::DeviceChangeObserverToken m_deviceChangeToken;
113     const EventNames&amp; m_eventNames; // Need to cache this so we can use it from GC threads.
114     bool m_listeningForDeviceChanges { false };
<span class="line-removed">115     bool m_disableGetDisplayMediaUserGestureConstraint { false };</span>
116 
117     Vector&lt;Ref&lt;MediaDeviceInfo&gt;&gt; m_devices;
<span class="line-modified">118     bool m_canAccessCamera { false };</span>
<span class="line-modified">119     bool m_canAccessMicrophone { false };</span>

120 };
121 
122 } // namespace WebCore
123 
124 #endif // ENABLE(MEDIA_STREAM)
</pre>
</td>
<td>
<hr />
<pre>
 20  * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 21  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 22  * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 23  * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 24  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 25  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 26  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 27  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 28  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 29  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 30  */
 31 
 32 #pragma once
 33 
 34 #if ENABLE(MEDIA_STREAM)
 35 
 36 #include &quot;ActiveDOMObject.h&quot;
 37 #include &quot;EventNames.h&quot;
 38 #include &quot;EventTarget.h&quot;
 39 #include &quot;ExceptionOr.h&quot;
<span class="line-modified"> 40 #include &quot;IDLTypes.h&quot;</span>
 41 #include &quot;MediaTrackConstraints.h&quot;
 42 #include &quot;RealtimeMediaSourceCenter.h&quot;
 43 #include &quot;Timer.h&quot;
 44 #include &quot;UserMediaClient.h&quot;
 45 #include &lt;wtf/WeakPtr.h&gt;
 46 
 47 namespace WebCore {
 48 
 49 class Document;
 50 class MediaDeviceInfo;
 51 class MediaStream;
<span class="line-added"> 52 class UserGestureToken;</span>
 53 
 54 struct MediaTrackSupportedConstraints;
 55 
<span class="line-added"> 56 template&lt;typename IDLType&gt; class DOMPromiseDeferred;</span>
<span class="line-added"> 57 </span>
 58 class MediaDevices final : public RefCounted&lt;MediaDevices&gt;, public ActiveDOMObject, public EventTargetWithInlineData, public CanMakeWeakPtr&lt;MediaDevices&gt; {
 59     WTF_MAKE_ISO_ALLOCATED(MediaDevices);
 60 public:
 61     static Ref&lt;MediaDevices&gt; create(Document&amp;);
 62 
 63     ~MediaDevices();
 64 
 65     Document* document() const;
 66 
 67     using Promise = DOMPromiseDeferred&lt;IDLInterface&lt;MediaStream&gt;&gt;;
 68     using EnumerateDevicesPromise = DOMPromiseDeferred&lt;IDLSequence&lt;IDLInterface&lt;MediaDeviceInfo&gt;&gt;&gt;;
 69 
 70     enum class DisplayCaptureSurfaceType {
 71         Monitor,
 72         Window,
 73         Application,
 74         Browser,
 75     };
 76 
 77     struct StreamConstraints {
 78         Variant&lt;bool, MediaTrackConstraints&gt; video;
 79         Variant&lt;bool, MediaTrackConstraints&gt; audio;
 80     };
<span class="line-modified"> 81     void getUserMedia(const StreamConstraints&amp;, Promise&amp;&amp;);</span>
<span class="line-modified"> 82 </span>
<span class="line-added"> 83     struct DisplayMediaStreamConstraints {</span>
<span class="line-added"> 84         Variant&lt;bool, MediaTrackConstraints&gt; video;</span>
<span class="line-added"> 85         Variant&lt;bool, MediaTrackConstraints&gt; audio;</span>
<span class="line-added"> 86     };</span>
<span class="line-added"> 87     void getDisplayMedia(const DisplayMediaStreamConstraints&amp;, Promise&amp;&amp;);</span>
<span class="line-added"> 88 </span>
 89     void enumerateDevices(EnumerateDevicesPromise&amp;&amp;);
 90     MediaTrackSupportedConstraints getSupportedConstraints();
 91 
 92     using RefCounted&lt;MediaDevices&gt;::ref;
 93     using RefCounted&lt;MediaDevices&gt;::deref;
 94 


 95 private:
 96     explicit MediaDevices(Document&amp;);
 97 
 98     void scheduledEventTimerFired();
 99     bool addEventListener(const AtomString&amp; eventType, Ref&lt;EventListener&gt;&amp;&amp;, const AddEventListenerOptions&amp;) override;
100 
101     void refreshDevices(const Vector&lt;CaptureDevice&gt;&amp;);
102     void listenForDeviceChanges();
103 
104     friend class JSMediaDevicesOwner;
105 
106     // ActiveDOMObject
107     const char* activeDOMObjectName() const final;

108     void stop() final;
109     bool hasPendingActivity() const final;
110 
111     // EventTargetWithInlineData.
112     EventTargetInterface eventTargetInterface() const final { return MediaDevicesEventTargetInterfaceType; }
113     ScriptExecutionContext* scriptExecutionContext() const final { return ActiveDOMObject::scriptExecutionContext(); }
114     void refEventTarget() final { ref(); }
115     void derefEventTarget() final { deref(); }
116 
<span class="line-added">117     enum class GestureAllowedRequest {</span>
<span class="line-added">118         Microphone = 1 &lt;&lt; 0,</span>
<span class="line-added">119         Camera = 1 &lt;&lt; 1,</span>
<span class="line-added">120         Display = 1 &lt;&lt; 2,</span>
<span class="line-added">121     };</span>
<span class="line-added">122     bool computeUserGesturePriviledge(GestureAllowedRequest);</span>
<span class="line-added">123 </span>
124     Timer m_scheduledEventTimer;
125     UserMediaClient::DeviceChangeObserverToken m_deviceChangeToken;
126     const EventNames&amp; m_eventNames; // Need to cache this so we can use it from GC threads.
127     bool m_listeningForDeviceChanges { false };

128 
129     Vector&lt;Ref&lt;MediaDeviceInfo&gt;&gt; m_devices;
<span class="line-modified">130 </span>
<span class="line-modified">131     OptionSet&lt;GestureAllowedRequest&gt; m_requestTypesForCurrentGesture;</span>
<span class="line-added">132     WeakPtr&lt;UserGestureToken&gt; m_currentGestureToken;</span>
133 };
134 
135 } // namespace WebCore
136 
137 #endif // ENABLE(MEDIA_STREAM)
</pre>
</td>
</tr>
</table>
<center><a href="MediaDevices.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaDevices.idl.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>