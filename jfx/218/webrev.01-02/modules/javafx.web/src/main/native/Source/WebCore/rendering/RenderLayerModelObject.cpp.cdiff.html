<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderLayerModelObject.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="RenderLayerCompositor.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderLayoutState.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderLayerModelObject.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 95,11 ***</span>
  void RenderLayerModelObject::createLayer()
  {
      ASSERT(!m_layer);
      m_layer = makeUnique&lt;RenderLayer&gt;(*this);
      setHasLayer(true);
<span class="line-modified">!     m_layer-&gt;insertOnlyThisLayer();</span>
  }
  
  bool RenderLayerModelObject::hasSelfPaintingLayer() const
  {
      return m_layer &amp;&amp; m_layer-&gt;isSelfPaintingLayer();
<span class="line-new-header">--- 95,11 ---</span>
  void RenderLayerModelObject::createLayer()
  {
      ASSERT(!m_layer);
      m_layer = makeUnique&lt;RenderLayer&gt;(*this);
      setHasLayer(true);
<span class="line-modified">!     m_layer-&gt;insertOnlyThisLayer(RenderLayer::LayerChangeTiming::StyleChange);</span>
  }
  
  bool RenderLayerModelObject::hasSelfPaintingLayer() const
  {
      return m_layer &amp;&amp; m_layer-&gt;isSelfPaintingLayer();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 130,12 ***</span>
  
          if (diff == StyleDifference::Layout || diff == StyleDifference::SimplifiedLayout) {
              // When a layout hint happens, we do a repaint of the layer, since the layer could end up being destroyed.
              if (hasLayer()) {
                  if (oldStyle-&gt;position() != newStyle.position()
<span class="line-modified">!                     || oldStyle-&gt;zIndex() != newStyle.zIndex()</span>
<span class="line-modified">!                     || oldStyle-&gt;hasAutoZIndex() != newStyle.hasAutoZIndex()</span>
                      || !(oldStyle-&gt;clip() == newStyle.clip())
                      || oldStyle-&gt;hasClip() != newStyle.hasClip()
                      || oldStyle-&gt;opacity() != newStyle.opacity()
                      || oldStyle-&gt;transform() != newStyle.transform()
                      || oldStyle-&gt;filter() != newStyle.filter()
<span class="line-new-header">--- 130,12 ---</span>
  
          if (diff == StyleDifference::Layout || diff == StyleDifference::SimplifiedLayout) {
              // When a layout hint happens, we do a repaint of the layer, since the layer could end up being destroyed.
              if (hasLayer()) {
                  if (oldStyle-&gt;position() != newStyle.position()
<span class="line-modified">!                     || oldStyle-&gt;usedZIndex() != newStyle.usedZIndex()</span>
<span class="line-modified">!                     || oldStyle-&gt;hasAutoUsedZIndex() != newStyle.hasAutoUsedZIndex()</span>
                      || !(oldStyle-&gt;clip() == newStyle.clip())
                      || oldStyle-&gt;hasClip() != newStyle.hasClip()
                      || oldStyle-&gt;opacity() != newStyle.opacity()
                      || oldStyle-&gt;transform() != newStyle.transform()
                      || oldStyle-&gt;filter() != newStyle.filter()
</pre>
<hr />
<pre>
<span class="line-old-header">*** 167,26 ***</span>
      if (requiresLayer()) {
          if (!layer() &amp;&amp; layerCreationAllowedForSubtree()) {
              if (s_wasFloating &amp;&amp; isFloating())
                  setChildNeedsLayout();
              createLayer();
<span class="line-modified">!             if (parent() &amp;&amp; !needsLayout() &amp;&amp; containingBlock()) {</span>
                  layer()-&gt;setRepaintStatus(NeedsFullRepaint);
<span class="line-removed">-                 layer()-&gt;updateLayerPositionsAfterStyleChange();</span>
<span class="line-removed">-             }</span>
          }
      } else if (layer() &amp;&amp; layer()-&gt;parent()) {
  #if ENABLE(CSS_COMPOSITING)
          if (oldStyle-&gt;hasBlendMode())
              layer()-&gt;willRemoveChildWithBlendMode();
  #endif
<span class="line-modified">!         setHasTransformRelatedProperty(false); // All transform-related propeties force layers, so we know we don&#39;t have one or the object doesn&#39;t support them.</span>
          setHasReflection(false);
          // Repaint the about to be destroyed self-painting layer when style change also triggers repaint.
          if (layer()-&gt;isSelfPaintingLayer() &amp;&amp; layer()-&gt;repaintStatus() == NeedsFullRepaint &amp;&amp; hasRepaintLayoutRects())
              repaintUsingContainer(containerForRepaint(), repaintLayoutRects().m_repaintRect);
<span class="line-modified">!         layer()-&gt;removeOnlyThisLayer(); // calls destroyLayer() which clears m_layer</span>
          if (s_wasFloating &amp;&amp; isFloating())
              setChildNeedsLayout();
          if (s_hadTransform)
              setNeedsLayoutAndPrefWidthsRecalc();
      }
<span class="line-new-header">--- 167,25 ---</span>
      if (requiresLayer()) {
          if (!layer() &amp;&amp; layerCreationAllowedForSubtree()) {
              if (s_wasFloating &amp;&amp; isFloating())
                  setChildNeedsLayout();
              createLayer();
<span class="line-modified">!             if (parent() &amp;&amp; !needsLayout() &amp;&amp; containingBlock())</span>
                  layer()-&gt;setRepaintStatus(NeedsFullRepaint);
          }
      } else if (layer() &amp;&amp; layer()-&gt;parent()) {
  #if ENABLE(CSS_COMPOSITING)
          if (oldStyle-&gt;hasBlendMode())
              layer()-&gt;willRemoveChildWithBlendMode();
  #endif
<span class="line-modified">!         setHasTransformRelatedProperty(false); // All transform-related properties force layers, so we know we don&#39;t have one or the object doesn&#39;t support them.</span>
          setHasReflection(false);
          // Repaint the about to be destroyed self-painting layer when style change also triggers repaint.
          if (layer()-&gt;isSelfPaintingLayer() &amp;&amp; layer()-&gt;repaintStatus() == NeedsFullRepaint &amp;&amp; hasRepaintLayoutRects())
              repaintUsingContainer(containerForRepaint(), repaintLayoutRects().m_repaintRect);
<span class="line-modified">! </span>
<span class="line-added">+         layer()-&gt;removeOnlyThisLayer(RenderLayer::LayerChangeTiming::StyleChange); // calls destroyLayer() which clears m_layer</span>
          if (s_wasFloating &amp;&amp; isFloating())
              setChildNeedsLayout();
          if (s_hadTransform)
              setNeedsLayoutAndPrefWidthsRecalc();
      }
</pre>
<center><a href="RenderLayerCompositor.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderLayoutState.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>