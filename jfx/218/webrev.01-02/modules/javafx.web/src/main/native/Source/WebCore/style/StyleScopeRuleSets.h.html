<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/style/StyleScopeRuleSets.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 1999 Lars Knoll (knoll@kde.org)
  3  * Copyright (C) 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Apple Inc. All rights reserved.
  4  * Copyright (C) 2013 Google Inc. All rights reserved.
  5  *
  6  * This library is free software; you can redistribute it and/or
  7  * modify it under the terms of the GNU Library General Public
  8  * License as published by the Free Software Foundation; either
  9  * version 2 of the License, or (at your option) any later version.
 10  *
 11  * This library is distributed in the hope that it will be useful,
 12  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 13  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 14  * Library General Public License for more details.
 15  *
 16  * You should have received a copy of the GNU Library General Public License
 17  * along with this library; see the file COPYING.LIB.  If not, write to
 18  * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 19  * Boston, MA 02110-1301, USA.
 20  *
 21  */
 22 
 23 #pragma once
 24 
 25 #include &quot;RuleFeature.h&quot;
 26 #include &quot;RuleSet.h&quot;
 27 #include &quot;UserAgentStyle.h&quot;
 28 #include &lt;memory&gt;
 29 #include &lt;wtf/HashMap.h&gt;
 30 #include &lt;wtf/RefPtr.h&gt;
 31 #include &lt;wtf/Vector.h&gt;
 32 
 33 namespace WebCore {
 34 
 35 class CSSStyleRule;
 36 class CSSStyleSheet;
 37 class ExtensionStyleSheets;
 38 class MediaQueryEvaluator;
 39 
 40 namespace Style {
 41 
 42 class InspectorCSSOMWrappers;
 43 class Resolver;
 44 
 45 struct InvalidationRuleSet {
 46     MatchElement matchElement;
 47     Ref&lt;RuleSet&gt; ruleSet;
 48     Vector&lt;const CSSSelector*&gt; invalidationSelectors;
 49 
 50     WTF_MAKE_FAST_ALLOCATED;
 51 };
 52 
 53 class ScopeRuleSets {
 54 public:
 55     ScopeRuleSets(Resolver&amp;);
 56     ~ScopeRuleSets();
 57 
 58     bool isAuthorStyleDefined() const { return m_isAuthorStyleDefined; }
 59     RuleSet* userAgentMediaQueryStyle() const;
 60     RuleSet&amp; authorStyle() const { return *m_authorStyle; }
 61     RuleSet* userStyle() const;
 62     const RuleFeatureSet&amp; features() const;
 63     RuleSet* sibling() const { return m_siblingRuleSet.get(); }
 64     RuleSet* uncommonAttribute() const { return m_uncommonAttributeRuleSet.get(); }
 65 
 66     const Vector&lt;InvalidationRuleSet&gt;* classInvalidationRuleSets(const AtomString&amp; className) const;
 67     const Vector&lt;InvalidationRuleSet&gt;* attributeInvalidationRuleSets(const AtomString&amp; attributeName) const;
 68 
 69     bool hasComplexSelectorsForStyleAttribute() const;
 70 
 71     void setIsForShadowScope() { m_isForShadowScope = true; }
 72 
 73     void setUsesSharedUserStyle(bool b) { m_usesSharedUserStyle = b; }
 74     void initializeUserStyle();
 75 
 76     void resetAuthorStyle();
 77     void appendAuthorStyleSheets(const Vector&lt;RefPtr&lt;CSSStyleSheet&gt;&gt;&amp;, MediaQueryEvaluator*, Style::InspectorCSSOMWrappers&amp;);
 78 
 79     void resetUserAgentMediaQueryStyle();
 80 
 81     bool hasViewportDependentMediaQueries() const;
 82 
 83     Optional&lt;DynamicMediaQueryEvaluationChanges&gt; evaluteDynamicMediaQueryRules(const MediaQueryEvaluator&amp;);
 84 
 85     RuleFeatureSet&amp; mutableFeatures();
 86 
 87     bool&amp; isInvalidatingStyleWithRuleSets() { return m_isInvalidatingStyleWithRuleSets; }
 88 
 89 private:
 90     void collectFeatures() const;
 91     void collectRulesFromUserStyleSheets(const Vector&lt;RefPtr&lt;CSSStyleSheet&gt;&gt;&amp;, RuleSet&amp; userStyle, const MediaQueryEvaluator&amp;);
 92     void updateUserAgentMediaQueryStyleIfNeeded() const;
 93 
 94     RefPtr&lt;RuleSet&gt; m_authorStyle;
 95     mutable RefPtr&lt;RuleSet&gt; m_userAgentMediaQueryStyle;
 96     RefPtr&lt;RuleSet&gt; m_userStyle;
 97 
 98     Resolver&amp; m_styleResolver;
 99     mutable RuleFeatureSet m_features;
100     mutable RefPtr&lt;RuleSet&gt; m_siblingRuleSet;
101     mutable RefPtr&lt;RuleSet&gt; m_uncommonAttributeRuleSet;
102     mutable HashMap&lt;AtomString, std::unique_ptr&lt;Vector&lt;InvalidationRuleSet&gt;&gt;&gt; m_classInvalidationRuleSets;
103     mutable HashMap&lt;AtomString, std::unique_ptr&lt;Vector&lt;InvalidationRuleSet&gt;&gt;&gt; m_attributeInvalidationRuleSets;
104 
105     mutable Optional&lt;bool&gt; m_cachedHasComplexSelectorsForStyleAttribute;
106 
107     mutable unsigned m_defaultStyleVersionOnFeatureCollection { 0 };
108     mutable unsigned m_userAgentMediaQueryRuleCountOnUpdate { 0 };
109 
110     bool m_usesSharedUserStyle { false };
111     bool m_isForShadowScope { false };
112     bool m_isAuthorStyleDefined { false };
113 
114     // For catching &lt;rdar://problem/53413013&gt;
115     bool m_isInvalidatingStyleWithRuleSets { false };
116 };
117 
118 inline const RuleFeatureSet&amp; ScopeRuleSets::features() const
119 {
120     if (m_defaultStyleVersionOnFeatureCollection &lt; UserAgentStyle::defaultStyleVersion)
121         collectFeatures();
122     return m_features;
123 }
124 
125 // FIXME: There should be just the const version.
126 inline RuleFeatureSet&amp; ScopeRuleSets::mutableFeatures()
127 {
128     if (m_defaultStyleVersionOnFeatureCollection &lt; UserAgentStyle::defaultStyleVersion)
129         collectFeatures();
130     return m_features;
131 }
132 
133 } // namespace Style
134 } // namespace WebCore
    </pre>
  </body>
</html>