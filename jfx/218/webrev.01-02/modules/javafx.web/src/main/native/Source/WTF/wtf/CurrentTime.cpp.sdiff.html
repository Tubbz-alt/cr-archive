<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WTF/wtf/CurrentTime.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CrossThreadCopier.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DataLog.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WTF/wtf/CurrentTime.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2006-2016 Apple Inc. All rights reserved.</span>
  3  * Copyright (C) 2008 Google Inc. All rights reserved.
  4  * Copyright (C) 2007-2009 Torch Mobile, Inc.
  5  * Copyright (C) 2008 Cameron Zwarich &lt;cwzwarich@uwaterloo.ca&gt;
  6  *
  7  * Redistribution and use in source and binary forms, with or without
  8  * modification, are permitted provided that the following conditions are
  9  * met:
 10  *
 11  *     * Redistributions of source code must retain the above copyright
 12  * notice, this list of conditions and the following disclaimer.
 13  *     * Redistributions in binary form must reproduce the above
 14  * copyright notice, this list of conditions and the following disclaimer
 15  * in the documentation and/or other materials provided with the
 16  * distribution.
 17  *     * Neither the name of Google Inc. nor the names of its
 18  * contributors may be used to endorse or promote products derived from
 19  * this software without specific prior written permission.
 20  *
 21  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 22  * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
</pre>
<hr />
<pre>
 51 #include &lt;windows.h&gt;
 52 #include &lt;math.h&gt;
 53 #include &lt;stdint.h&gt;
 54 #else
 55 #include &lt;sys/time.h&gt;
 56 #endif
 57 
 58 #if OS(FUCHSIA)
 59 #include &lt;zircon/syscalls.h&gt;
 60 #endif
 61 
 62 #if USE(GLIB)
 63 #include &lt;glib.h&gt;
 64 #endif
 65 
 66 namespace WTF {
 67 
 68 #if OS(WINDOWS)
 69 
 70 // Number of 100 nanosecond between January 1, 1601 and January 1, 1970.
<span class="line-modified"> 71 static const ULONGLONG epochBias = 116444736000000000ULL;</span>
<span class="line-modified"> 72 static const double hundredsOfNanosecondsPerMillisecond = 10000;</span>
 73 
 74 static double lowResUTCTime()
 75 {
 76     FILETIME fileTime;
 77 
 78     GetSystemTimeAsFileTime(&amp;fileTime);
 79 
 80     // As per Windows documentation for FILETIME, copy the resulting FILETIME structure to a
 81     // ULARGE_INTEGER structure using memcpy (using memcpy instead of direct assignment can
 82     // prevent alignment faults on 64-bit Windows).
 83 
 84     ULARGE_INTEGER dateTime;
 85     memcpy(&amp;dateTime, &amp;fileTime, sizeof(dateTime));
 86 
 87     // Windows file times are in 100s of nanoseconds.
 88     return (dateTime.QuadPart - epochBias) / hundredsOfNanosecondsPerMillisecond;
 89 }
 90 
 91 #if USE(QUERY_PERFORMANCE_COUNTER)
 92 
</pre>
<hr />
<pre>
213     DWORD tickCountNow = GetTickCount();
214     DWORD elapsed = tickCountNow - lastTickCount;
215     double timeNow = lastTime + (double)elapsed / 1000.;
216     if (elapsed &gt;= 0x7FFFFFFF) {
217         lastTime = timeNow;
218         lastTickCount = tickCountNow;
219     }
220     return timeNow;
221 }
222 
223 #endif // USE(QUERY_PERFORMANCE_COUNTER)
224 
225 #elif USE(GLIB)
226 
227 // Note: GTK on Windows will pick up the PLATFORM(WIN) implementation above which provides
228 // better accuracy compared with Windows implementation of g_get_current_time:
229 // (http://www.google.com/codesearch/p?hl=en#HHnNRjks1t0/glib-2.5.2/glib/gmain.c&amp;q=g_get_current_time).
230 // Non-Windows GTK builds could use gettimeofday() directly but for the sake of consistency lets use GTK function.
231 static inline double currentTime()
232 {
<span class="line-modified">233     GTimeVal now;</span>
<span class="line-removed">234     g_get_current_time(&amp;now);</span>
<span class="line-removed">235     return static_cast&lt;double&gt;(now.tv_sec) + static_cast&lt;double&gt;(now.tv_usec / 1000000.0);</span>
236 }
237 
238 #else
239 
240 static inline double currentTime()
241 {
242     struct timeval now;
243     gettimeofday(&amp;now, 0);
244     return now.tv_sec + now.tv_usec / 1000000.0;
245 }
246 
247 #endif
248 
249 WallTime WallTime::now()
250 {
251     return fromRawSeconds(currentTime());
252 }
253 
254 MonotonicTime MonotonicTime::now()
255 {
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2006-2019 Apple Inc. All rights reserved.</span>
  3  * Copyright (C) 2008 Google Inc. All rights reserved.
  4  * Copyright (C) 2007-2009 Torch Mobile, Inc.
  5  * Copyright (C) 2008 Cameron Zwarich &lt;cwzwarich@uwaterloo.ca&gt;
  6  *
  7  * Redistribution and use in source and binary forms, with or without
  8  * modification, are permitted provided that the following conditions are
  9  * met:
 10  *
 11  *     * Redistributions of source code must retain the above copyright
 12  * notice, this list of conditions and the following disclaimer.
 13  *     * Redistributions in binary form must reproduce the above
 14  * copyright notice, this list of conditions and the following disclaimer
 15  * in the documentation and/or other materials provided with the
 16  * distribution.
 17  *     * Neither the name of Google Inc. nor the names of its
 18  * contributors may be used to endorse or promote products derived from
 19  * this software without specific prior written permission.
 20  *
 21  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 22  * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
</pre>
<hr />
<pre>
 51 #include &lt;windows.h&gt;
 52 #include &lt;math.h&gt;
 53 #include &lt;stdint.h&gt;
 54 #else
 55 #include &lt;sys/time.h&gt;
 56 #endif
 57 
 58 #if OS(FUCHSIA)
 59 #include &lt;zircon/syscalls.h&gt;
 60 #endif
 61 
 62 #if USE(GLIB)
 63 #include &lt;glib.h&gt;
 64 #endif
 65 
 66 namespace WTF {
 67 
 68 #if OS(WINDOWS)
 69 
 70 // Number of 100 nanosecond between January 1, 1601 and January 1, 1970.
<span class="line-modified"> 71 static constexpr ULONGLONG epochBias = 116444736000000000ULL;</span>
<span class="line-modified"> 72 static constexpr double hundredsOfNanosecondsPerMillisecond = 10000;</span>
 73 
 74 static double lowResUTCTime()
 75 {
 76     FILETIME fileTime;
 77 
 78     GetSystemTimeAsFileTime(&amp;fileTime);
 79 
 80     // As per Windows documentation for FILETIME, copy the resulting FILETIME structure to a
 81     // ULARGE_INTEGER structure using memcpy (using memcpy instead of direct assignment can
 82     // prevent alignment faults on 64-bit Windows).
 83 
 84     ULARGE_INTEGER dateTime;
 85     memcpy(&amp;dateTime, &amp;fileTime, sizeof(dateTime));
 86 
 87     // Windows file times are in 100s of nanoseconds.
 88     return (dateTime.QuadPart - epochBias) / hundredsOfNanosecondsPerMillisecond;
 89 }
 90 
 91 #if USE(QUERY_PERFORMANCE_COUNTER)
 92 
</pre>
<hr />
<pre>
213     DWORD tickCountNow = GetTickCount();
214     DWORD elapsed = tickCountNow - lastTickCount;
215     double timeNow = lastTime + (double)elapsed / 1000.;
216     if (elapsed &gt;= 0x7FFFFFFF) {
217         lastTime = timeNow;
218         lastTickCount = tickCountNow;
219     }
220     return timeNow;
221 }
222 
223 #endif // USE(QUERY_PERFORMANCE_COUNTER)
224 
225 #elif USE(GLIB)
226 
227 // Note: GTK on Windows will pick up the PLATFORM(WIN) implementation above which provides
228 // better accuracy compared with Windows implementation of g_get_current_time:
229 // (http://www.google.com/codesearch/p?hl=en#HHnNRjks1t0/glib-2.5.2/glib/gmain.c&amp;q=g_get_current_time).
230 // Non-Windows GTK builds could use gettimeofday() directly but for the sake of consistency lets use GTK function.
231 static inline double currentTime()
232 {
<span class="line-modified">233     return static_cast&lt;double&gt;(g_get_real_time() / 1000000.0);</span>


234 }
235 
236 #else
237 
238 static inline double currentTime()
239 {
240     struct timeval now;
241     gettimeofday(&amp;now, 0);
242     return now.tv_sec + now.tv_usec / 1000000.0;
243 }
244 
245 #endif
246 
247 WallTime WallTime::now()
248 {
249     return fromRawSeconds(currentTime());
250 }
251 
252 MonotonicTime MonotonicTime::now()
253 {
</pre>
</td>
</tr>
</table>
<center><a href="CrossThreadCopier.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DataLog.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>