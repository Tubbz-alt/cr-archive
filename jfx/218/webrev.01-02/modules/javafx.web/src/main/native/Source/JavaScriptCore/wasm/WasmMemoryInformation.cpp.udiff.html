<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/wasm/WasmMemoryInformation.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="WasmMemory.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="WasmModule.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/wasm/WasmMemoryInformation.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -33,45 +33,23 @@</span>
  #include &quot;WasmMemory.h&quot;
  #include &lt;wtf/NeverDestroyed.h&gt;
  
  namespace JSC { namespace Wasm {
  
<span class="udiff-line-removed">- static Vector&lt;GPRReg&gt; getPinnedRegisters(unsigned remainingPinnedRegisters)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     Vector&lt;GPRReg&gt; registers;</span>
<span class="udiff-line-removed">-     jscCallingConvention().m_calleeSaveRegisters.forEach([&amp;] (Reg reg) {</span>
<span class="udiff-line-removed">-         if (!reg.isGPR())</span>
<span class="udiff-line-removed">-             return;</span>
<span class="udiff-line-removed">-         GPRReg gpr = reg.gpr();</span>
<span class="udiff-line-removed">-         if (!remainingPinnedRegisters || RegisterSet::stackRegisters().get(reg))</span>
<span class="udiff-line-removed">-             return;</span>
<span class="udiff-line-removed">-         if (RegisterSet::runtimeTagRegisters().get(reg)) {</span>
<span class="udiff-line-removed">-             // Since we don&#39;t need to, we currently don&#39;t pick from the tag registers to allow</span>
<span class="udiff-line-removed">-             // JS-&gt;Wasm stubs to freely use these registers.</span>
<span class="udiff-line-removed">-             return;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         --remainingPinnedRegisters;</span>
<span class="udiff-line-removed">-         registers.append(gpr);</span>
<span class="udiff-line-removed">-     });</span>
<span class="udiff-line-removed">-     return registers;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  const PinnedRegisterInfo&amp; PinnedRegisterInfo::get()
  {
      static LazyNeverDestroyed&lt;PinnedRegisterInfo&gt; staticPinnedRegisterInfo;
      static std::once_flag staticPinnedRegisterInfoFlag;
      std::call_once(staticPinnedRegisterInfoFlag, [] () {
          unsigned numberOfPinnedRegisters = 2;
          if (!Context::useFastTLS())
              ++numberOfPinnedRegisters;
<span class="udiff-line-modified-removed">-         Vector&lt;GPRReg&gt; pinnedRegs = getPinnedRegisters(numberOfPinnedRegisters);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-         GPRReg baseMemoryPointer = pinnedRegs.takeLast();</span>
<span class="udiff-line-removed">-         GPRReg sizeRegister = pinnedRegs.takeLast();</span>
<span class="udiff-line-modified-added">+         GPRReg baseMemoryPointer = GPRInfo::regCS3;</span>
<span class="udiff-line-modified-added">+         GPRReg sizeRegister = GPRInfo::regCS4;</span>
          GPRReg wasmContextInstancePointer = InvalidGPRReg;
          if (!Context::useFastTLS())
<span class="udiff-line-modified-removed">-             wasmContextInstancePointer = pinnedRegs.takeLast();</span>
<span class="udiff-line-modified-added">+             wasmContextInstancePointer = GPRInfo::regCS0;</span>
  
          staticPinnedRegisterInfo.construct(sizeRegister, baseMemoryPointer, wasmContextInstancePointer);
      });
  
      return staticPinnedRegisterInfo.get();
</pre>
<center><a href="WasmMemory.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="WasmModule.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>