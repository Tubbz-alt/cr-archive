<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorInstrumentation.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InspectorFrontendHost.idl.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorInstrumentation.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorInstrumentation.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  16 * contributors may be used to endorse or promote products derived from
  17 * this software without specific prior written permission.
  18 *
  19 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  20 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  21 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  22 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  23 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  24 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  25 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  26 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  27 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  28 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  29 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  30 */
  31 
  32 #include &quot;config.h&quot;
  33 #include &quot;InspectorInstrumentation.h&quot;
  34 
  35 #include &quot;CachedResource.h&quot;

  36 #include &quot;CustomHeaderFields.h&quot;
  37 #include &quot;DOMWindow.h&quot;
  38 #include &quot;DOMWrapperWorld.h&quot;
  39 #include &quot;DocumentLoader.h&quot;
  40 #include &quot;Event.h&quot;
  41 #include &quot;Frame.h&quot;

  42 #include &quot;InspectorApplicationCacheAgent.h&quot;
  43 #include &quot;InspectorCSSAgent.h&quot;
  44 #include &quot;InspectorCanvasAgent.h&quot;

  45 #include &quot;InspectorDOMAgent.h&quot;
  46 #include &quot;InspectorDOMDebuggerAgent.h&quot;
  47 #include &quot;InspectorDOMStorageAgent.h&quot;
  48 #include &quot;InspectorDatabaseAgent.h&quot;
  49 #include &quot;InspectorLayerTreeAgent.h&quot;
  50 #include &quot;InspectorMemoryAgent.h&quot;
  51 #include &quot;InspectorNetworkAgent.h&quot;
  52 #include &quot;InspectorPageAgent.h&quot;
  53 #include &quot;InspectorTimelineAgent.h&quot;
  54 #include &quot;InspectorWorkerAgent.h&quot;
  55 #include &quot;InstrumentingAgents.h&quot;

  56 #include &quot;LoaderStrategy.h&quot;

  57 #include &quot;PageDebuggerAgent.h&quot;
  58 #include &quot;PageHeapAgent.h&quot;
  59 #include &quot;PageRuntimeAgent.h&quot;
  60 #include &quot;PlatformStrategies.h&quot;
  61 #include &quot;RenderObject.h&quot;
  62 #include &quot;RenderView.h&quot;
  63 #include &quot;ScriptController.h&quot;
  64 #include &quot;ScriptExecutionContext.h&quot;
  65 #include &quot;WebConsoleAgent.h&quot;

  66 #include &quot;WebGLRenderingContextBase.h&quot;

  67 #include &quot;WebSocketFrame.h&quot;


  68 #include &lt;JavaScriptCore/ConsoleMessage.h&gt;
  69 #include &lt;JavaScriptCore/ConsoleTypes.h&gt;
  70 #include &lt;JavaScriptCore/InspectorDebuggerAgent.h&gt;
  71 #include &lt;JavaScriptCore/ScriptArguments.h&gt;
  72 #include &lt;JavaScriptCore/ScriptCallStack.h&gt;
  73 #include &lt;wtf/StdLibExtras.h&gt;
  74 




  75 namespace WebCore {
  76 
  77 using namespace Inspector;
  78 
  79 namespace {
  80 static HashSet&lt;InstrumentingAgents*&gt;* s_instrumentingAgentsSet = nullptr;
  81 }
  82 
<span class="line-removed">  83 int InspectorInstrumentation::s_frontendCounter = 0;</span>
<span class="line-removed">  84 </span>
  85 void InspectorInstrumentation::firstFrontendCreated()
  86 {
  87     platformStrategies()-&gt;loaderStrategy()-&gt;setCaptureExtraNetworkLoadMetricsEnabled(true);
  88 }
  89 
  90 void InspectorInstrumentation::lastFrontendDeleted()
  91 {
  92     platformStrategies()-&gt;loaderStrategy()-&gt;setCaptureExtraNetworkLoadMetricsEnabled(false);
  93 }
  94 
  95 static Frame* frameForScriptExecutionContext(ScriptExecutionContext* context)
  96 {
  97     Frame* frame = nullptr;
  98     if (is&lt;Document&gt;(*context))
  99         frame = downcast&lt;Document&gt;(*context).frame();
 100     return frame;
 101 }
 102 
 103 static Frame* frameForScriptExecutionContext(ScriptExecutionContext&amp; context)
 104 {
 105     Frame* frame = nullptr;
 106     if (is&lt;Document&gt;(context))
 107         frame = downcast&lt;Document&gt;(context).frame();
 108     return frame;
 109 }
 110 
 111 void InspectorInstrumentation::didClearWindowObjectInWorldImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, DOMWrapperWorld&amp; world)
 112 {
<span class="line-modified"> 113     if (PageDebuggerAgent* debuggerAgent = instrumentingAgents.pageDebuggerAgent()) {</span>
<span class="line-modified"> 114         if (&amp;world == &amp;mainThreadNormalWorld() &amp;&amp; frame.isMainFrame())</span>
<span class="line-removed"> 115             debuggerAgent-&gt;didClearMainFrameWindowObject();</span>
<span class="line-removed"> 116     }</span>
 117 
<span class="line-modified"> 118     if (PageRuntimeAgent* pageRuntimeAgent = instrumentingAgents.pageRuntimeAgent()) {</span>
<span class="line-modified"> 119         if (&amp;world == &amp;mainThreadNormalWorld())</span>
<span class="line-modified"> 120             pageRuntimeAgent-&gt;didCreateMainWorldContext(frame);</span>
<span class="line-modified"> 121     }</span>

 122 }
 123 
 124 bool InspectorInstrumentation::isDebuggerPausedImpl(InstrumentingAgents&amp; instrumentingAgents)
 125 {
<span class="line-modified"> 126     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())</span>
<span class="line-modified"> 127         return debuggerAgent-&gt;isPaused();</span>
 128     return false;
 129 }
 130 
 131 int InspectorInstrumentation::identifierForNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 132 {
 133     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 134         return domAgent-&gt;identifierForNode(node);
 135     return 0;
 136 }
 137 
 138 void InspectorInstrumentation::addEventListenersToNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 139 {
 140     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 141         domAgent-&gt;addEventListenersToNode(node);
 142 }
 143 
 144 void InspectorInstrumentation::willInsertDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; parent)
 145 {
<span class="line-modified"> 146     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified"> 147         domDebuggerAgent-&gt;willInsertDOMNode(parent);</span>
 148 }
 149 
 150 void InspectorInstrumentation::didInsertDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 151 {
 152     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 153         domAgent-&gt;didInsertDOMNode(node);
<span class="line-modified"> 154     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified"> 155         domDebuggerAgent-&gt;didInsertDOMNode(node);</span>
 156 }
 157 
 158 void InspectorInstrumentation::willRemoveDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 159 {
<span class="line-modified"> 160     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified"> 161         domDebuggerAgent-&gt;willRemoveDOMNode(node);</span>
 162 }
 163 
 164 void InspectorInstrumentation::didRemoveDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 165 {
<span class="line-modified"> 166     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified"> 167         domDebuggerAgent-&gt;didRemoveDOMNode(node);</span>
 168     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 169         domAgent-&gt;didRemoveDOMNode(node);
 170 }
 171 
 172 void InspectorInstrumentation::willModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; oldValue, const AtomString&amp; newValue)
 173 {
<span class="line-modified"> 174     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified"> 175         domDebuggerAgent-&gt;willModifyDOMAttr(element);</span>
 176     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 177         domAgent-&gt;willModifyDOMAttr(element, oldValue, newValue);
 178 }
 179 
 180 void InspectorInstrumentation::didModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; name, const AtomString&amp; value)
 181 {
 182     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 183         domAgent-&gt;didModifyDOMAttr(element, name, value);
 184 }
 185 
 186 void InspectorInstrumentation::didRemoveDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; name)
 187 {
 188     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 189         domAgent-&gt;didRemoveDOMAttr(element, name);
 190 }
 191 
 192 void InspectorInstrumentation::willInvalidateStyleAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element)
 193 {
<span class="line-modified"> 194     if (auto* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified"> 195         domDebuggerAgent-&gt;willInvalidateStyleAttr(element);</span>
 196 }
 197 
 198 void InspectorInstrumentation::didInvalidateStyleAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element)
 199 {
 200     if (auto* domAgent = instrumentingAgents.inspectorDOMAgent())
 201         domAgent-&gt;didInvalidateStyleAttr(element);
 202 }
 203 
 204 void InspectorInstrumentation::documentDetachedImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 205 {
 206     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 207         cssAgent-&gt;documentDetached(document);
 208 }
 209 
 210 void InspectorInstrumentation::frameWindowDiscardedImpl(InstrumentingAgents&amp; instrumentingAgents, DOMWindow* window)
 211 {
<span class="line-modified"> 212     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
 213         return;
 214 
 215     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 216         consoleAgent-&gt;frameWindowDiscarded(window);
 217 }
 218 
 219 void InspectorInstrumentation::mediaQueryResultChangedImpl(InstrumentingAgents&amp; instrumentingAgents)
 220 {
 221     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 222         cssAgent-&gt;mediaQueryResultChanged();
 223 }
 224 
 225 void InspectorInstrumentation::activeStyleSheetsUpdatedImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 226 {
 227     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 228         cssAgent-&gt;activeStyleSheetsUpdated(document);
 229 }
 230 
 231 void InspectorInstrumentation::didPushShadowRootImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; host, ShadowRoot&amp; root)
 232 {
</pre>
<hr />
<pre>
 296 void InspectorInstrumentation::characterDataModifiedImpl(InstrumentingAgents&amp; instrumentingAgents, CharacterData&amp; characterData)
 297 {
 298     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 299         domAgent-&gt;characterDataModified(characterData);
 300 }
 301 
 302 void InspectorInstrumentation::willSendXMLHttpRequestImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; url)
 303 {
 304     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 305         domDebuggerAgent-&gt;willSendXMLHttpRequest(url);
 306 }
 307 
 308 void InspectorInstrumentation::willFetchImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; url)
 309 {
 310     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 311         domDebuggerAgent-&gt;willFetch(url);
 312 }
 313 
 314 void InspectorInstrumentation::didInstallTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, Seconds timeout, bool singleShot, ScriptExecutionContext&amp; context)
 315 {
<span class="line-modified"> 316     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())</span>
<span class="line-modified"> 317         debuggerAgent-&gt;didScheduleAsyncCall(context.execState(), InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId, singleShot);</span>
 318 
 319     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 320         timelineAgent-&gt;didInstallTimer(timerId, timeout, singleShot, frameForScriptExecutionContext(context));
 321 }
 322 
 323 void InspectorInstrumentation::didRemoveTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, ScriptExecutionContext&amp; context)
 324 {
<span class="line-modified"> 325     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())</span>
<span class="line-modified"> 326         debuggerAgent-&gt;didCancelAsyncCall(InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId);</span>
 327     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 328         timelineAgent-&gt;didRemoveTimer(timerId, frameForScriptExecutionContext(context));
 329 }
 330 
 331 void InspectorInstrumentation::didAddEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)
 332 {
<span class="line-modified"> 333     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
<span class="line-modified"> 334         pageDebuggerAgent-&gt;didAddEventListener(target, eventType, listener, capture);</span>
 335     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 336         domAgent-&gt;didAddEventListener(target);
 337 }
 338 
 339 void InspectorInstrumentation::willRemoveEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)
 340 {
<span class="line-modified"> 341     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
<span class="line-modified"> 342         pageDebuggerAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);</span>
 343     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 344         domAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);
 345 }
 346 
 347 bool InspectorInstrumentation::isEventListenerDisabledImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)
 348 {
 349     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 350         return domAgent-&gt;isEventListenerDisabled(target, eventType, listener, capture);
 351     return false;
 352 }
 353 
<span class="line-modified"> 354 void InspectorInstrumentation::didPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer, JSC::ExecState&amp; state)</span>
 355 {
<span class="line-modified"> 356     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
<span class="line-modified"> 357         pageDebuggerAgent-&gt;didPostMessage(timer, state);</span>
 358 }
 359 
 360 void InspectorInstrumentation::didFailPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 361 {
<span class="line-modified"> 362     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
<span class="line-modified"> 363         pageDebuggerAgent-&gt;didFailPostMessage(timer);</span>
 364 }
 365 
 366 void InspectorInstrumentation::willDispatchPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 367 {
<span class="line-modified"> 368     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
<span class="line-modified"> 369         pageDebuggerAgent-&gt;willDispatchPostMessage(timer);</span>
 370 }
 371 
 372 void InspectorInstrumentation::didDispatchPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 373 {
<span class="line-modified"> 374     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
<span class="line-modified"> 375         pageDebuggerAgent-&gt;didDispatchPostMessage(timer);</span>
 376 }
 377 
<span class="line-modified"> 378 InspectorInstrumentationCookie InspectorInstrumentation::willCallFunctionImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; scriptName, int scriptLine, int scriptColumn, ScriptExecutionContext* context)</span>
 379 {
<span class="line-modified"> 380     int timelineAgentId = 0;</span>
<span class="line-removed"> 381     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
 382         timelineAgent-&gt;willCallFunction(scriptName, scriptLine, scriptColumn, frameForScriptExecutionContext(context));
<span class="line-removed"> 383         timelineAgentId = timelineAgent-&gt;id();</span>
<span class="line-removed"> 384     }</span>
<span class="line-removed"> 385     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);</span>
 386 }
 387 
<span class="line-modified"> 388 void InspectorInstrumentation::didCallFunctionImpl(const InspectorInstrumentationCookie&amp; cookie, ScriptExecutionContext* context)</span>
 389 {
<span class="line-modified"> 390     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))</span>
 391         timelineAgent-&gt;didCallFunction(frameForScriptExecutionContext(context));
 392 }
 393 
<span class="line-modified"> 394 InspectorInstrumentationCookie InspectorInstrumentation::willDispatchEventImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document, const Event&amp; event, bool hasEventListeners)</span>
 395 {
<span class="line-modified"> 396     int timelineAgentId = 0;</span>
<span class="line-removed"> 397     InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent();</span>
<span class="line-removed"> 398     if (timelineAgent &amp;&amp; hasEventListeners) {</span>
 399         timelineAgent-&gt;willDispatchEvent(event, document.frame());
<span class="line-removed"> 400         timelineAgentId = timelineAgent-&gt;id();</span>
<span class="line-removed"> 401     }</span>
<span class="line-removed"> 402 </span>
<span class="line-removed"> 403     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);</span>
 404 }
 405 
 406 void InspectorInstrumentation::willHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents, Event&amp; event, const RegisteredEventListener&amp; listener)
 407 {
<span class="line-modified"> 408     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
<span class="line-modified"> 409         pageDebuggerAgent-&gt;willHandleEvent(listener);</span>
 410 
 411     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 412         domDebuggerAgent-&gt;willHandleEvent(event, listener);
 413 }
 414 
 415 void InspectorInstrumentation::didHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents)
 416 {
<span class="line-modified"> 417     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())</span>
<span class="line-modified"> 418         debuggerAgent-&gt;didDispatchAsyncCall();</span>
 419 
 420     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 421         domDebuggerAgent-&gt;didHandleEvent();
 422 }
 423 
<span class="line-modified"> 424 void InspectorInstrumentation::didDispatchEventImpl(const InspectorInstrumentationCookie&amp; cookie, bool defaultPrevented)</span>
 425 {
<span class="line-modified"> 426     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))</span>
<span class="line-modified"> 427         timelineAgent-&gt;didDispatchEvent(defaultPrevented);</span>
 428 }
 429 
<span class="line-modified"> 430 InspectorInstrumentationCookie InspectorInstrumentation::willDispatchEventOnWindowImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event, DOMWindow&amp; window)</span>
 431 {
<span class="line-modified"> 432     int timelineAgentId = 0;</span>
<span class="line-removed"> 433     InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent();</span>
<span class="line-removed"> 434     if (timelineAgent &amp;&amp; window.hasEventListeners(event.type())) {</span>
 435         timelineAgent-&gt;willDispatchEvent(event, window.frame());
<span class="line-removed"> 436         timelineAgentId = timelineAgent-&gt;id();</span>
<span class="line-removed"> 437     }</span>
<span class="line-removed"> 438 </span>
<span class="line-removed"> 439     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);</span>
 440 }
 441 
<span class="line-modified"> 442 void InspectorInstrumentation::didDispatchEventOnWindowImpl(const InspectorInstrumentationCookie&amp; cookie, bool defaultPrevented)</span>
 443 {
<span class="line-modified"> 444     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))</span>
<span class="line-modified"> 445         timelineAgent-&gt;didDispatchEvent(defaultPrevented);</span>
 446 }
 447 
 448 void InspectorInstrumentation::eventDidResetAfterDispatchImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event)
 449 {
 450     if (auto* domAgent = instrumentingAgents.inspectorDOMAgent())
 451         domAgent-&gt;eventDidResetAfterDispatch(event);
 452 }
 453 
<span class="line-modified"> 454 InspectorInstrumentationCookie InspectorInstrumentation::willEvaluateScriptImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, const String&amp; url, int lineNumber, int columnNumber)</span>
 455 {
<span class="line-modified"> 456     int timelineAgentId = 0;</span>
<span class="line-removed"> 457     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
 458         timelineAgent-&gt;willEvaluateScript(url, lineNumber, columnNumber, frame);
<span class="line-removed"> 459         timelineAgentId = timelineAgent-&gt;id();</span>
<span class="line-removed"> 460     }</span>
<span class="line-removed"> 461     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);</span>
 462 }
 463 
<span class="line-modified"> 464 void InspectorInstrumentation::didEvaluateScriptImpl(const InspectorInstrumentationCookie&amp; cookie, Frame&amp; frame)</span>
 465 {
<span class="line-modified"> 466     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))</span>
 467         timelineAgent-&gt;didEvaluateScript(frame);
 468 }
 469 
<span class="line-modified"> 470 InspectorInstrumentationCookie InspectorInstrumentation::willFireTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, bool oneShot, ScriptExecutionContext&amp; context)</span>
 471 {
<span class="line-modified"> 472     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())</span>
<span class="line-modified"> 473         debuggerAgent-&gt;willDispatchAsyncCall(InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId);</span>
<span class="line-modified"> 474 </span>
<span class="line-removed"> 475     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
 476         domDebuggerAgent-&gt;willFireTimer(oneShot);
<span class="line-modified"> 477 </span>
<span class="line-removed"> 478     int timelineAgentId = 0;</span>
<span class="line-removed"> 479     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
 480         timelineAgent-&gt;willFireTimer(timerId, frameForScriptExecutionContext(context));
<span class="line-removed"> 481         timelineAgentId = timelineAgent-&gt;id();</span>
<span class="line-removed"> 482     }</span>
<span class="line-removed"> 483     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);</span>
 484 }
 485 
<span class="line-modified"> 486 void InspectorInstrumentation::didFireTimerImpl(const InspectorInstrumentationCookie&amp; cookie)</span>
 487 {
<span class="line-modified"> 488     if (InspectorDebuggerAgent* debuggerAgent = cookie.instrumentingAgents()-&gt;inspectorDebuggerAgent())</span>
<span class="line-modified"> 489         debuggerAgent-&gt;didDispatchAsyncCall();</span>
<span class="line-modified"> 490     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))</span>
 491         timelineAgent-&gt;didFireTimer();
 492 }
 493 
 494 void InspectorInstrumentation::didInvalidateLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 495 {
 496     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 497         timelineAgent-&gt;didInvalidateLayout(frame);
 498 }
 499 
<span class="line-modified"> 500 InspectorInstrumentationCookie InspectorInstrumentation::willLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)</span>
 501 {
<span class="line-modified"> 502     int timelineAgentId = 0;</span>
<span class="line-removed"> 503     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
 504         timelineAgent-&gt;willLayout(frame);
<span class="line-removed"> 505         timelineAgentId = timelineAgent-&gt;id();</span>
<span class="line-removed"> 506     }</span>
<span class="line-removed"> 507     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);</span>
 508 }
 509 
<span class="line-modified"> 510 void InspectorInstrumentation::didLayoutImpl(const InspectorInstrumentationCookie&amp; cookie, RenderObject&amp; root)</span>
 511 {
<span class="line-modified"> 512     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))</span>
 513         timelineAgent-&gt;didLayout(root);
<span class="line-modified"> 514 </span>
<span class="line-removed"> 515     if (InspectorPageAgent* pageAgent = cookie.instrumentingAgents()-&gt;inspectorPageAgent())</span>
 516         pageAgent-&gt;didLayout();
 517 }
 518 
 519 void InspectorInstrumentation::willCompositeImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 520 {
 521     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 522         timelineAgent-&gt;willComposite(frame);
 523 }
 524 
 525 void InspectorInstrumentation::didCompositeImpl(InstrumentingAgents&amp; instrumentingAgents)
 526 {
 527     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 528         timelineAgent-&gt;didComposite();
 529 }
 530 
 531 void InspectorInstrumentation::willPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer)
 532 {
 533     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 534         timelineAgent-&gt;willPaint(renderer.frame());
 535 }
 536 
 537 void InspectorInstrumentation::didPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer, const LayoutRect&amp; rect)
 538 {
 539     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 540         timelineAgent-&gt;didPaint(renderer, rect);
 541 
 542     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 543         pageAgent-&gt;didPaint(renderer, rect);
 544 }
 545 
<span class="line-modified"> 546 InspectorInstrumentationCookie InspectorInstrumentation::willRecalculateStyleImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)</span>
 547 {
<span class="line-modified"> 548     int timelineAgentId = 0;</span>
<span class="line-removed"> 549     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
 550         timelineAgent-&gt;willRecalculateStyle(document.frame());
<span class="line-removed"> 551         timelineAgentId = timelineAgent-&gt;id();</span>
<span class="line-removed"> 552     }</span>
 553     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 554         networkAgent-&gt;willRecalculateStyle();
<span class="line-removed"> 555     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);</span>
 556 }
 557 
<span class="line-modified"> 558 void InspectorInstrumentation::didRecalculateStyleImpl(const InspectorInstrumentationCookie&amp; cookie)</span>
 559 {
<span class="line-modified"> 560     if (!cookie.isValid())</span>
<span class="line-removed"> 561         return;</span>
<span class="line-removed"> 562 </span>
<span class="line-removed"> 563     InstrumentingAgents&amp; instrumentingAgents = *cookie.instrumentingAgents();</span>
<span class="line-removed"> 564 </span>
<span class="line-removed"> 565     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))</span>
 566         timelineAgent-&gt;didRecalculateStyle();
 567     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 568         networkAgent-&gt;didRecalculateStyle();
 569     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 570         pageAgent-&gt;didRecalculateStyle();
 571 }
 572 
 573 void InspectorInstrumentation::didScheduleStyleRecalculationImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 574 {
 575     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 576         timelineAgent-&gt;didScheduleStyleRecalculation(document.frame());
 577     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 578         networkAgent-&gt;didScheduleStyleRecalculation(document);
 579 }
 580 
 581 void InspectorInstrumentation::applyUserAgentOverrideImpl(InstrumentingAgents&amp; instrumentingAgents, String&amp; userAgent)
 582 {
 583     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 584         pageAgent-&gt;applyUserAgentOverride(userAgent);
 585 }
</pre>
<hr />
<pre>
 596         networkAgent-&gt;willSendRequest(identifier, loader, request, redirectResponse);
 597 }
 598 
 599 void InspectorInstrumentation::willSendRequestOfTypeImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, ResourceRequest&amp; request, LoadType loadType)
 600 {
 601     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 602         networkAgent-&gt;willSendRequestOfType(identifier, loader, request, loadType);
 603 }
 604 
 605 void InspectorInstrumentation::didLoadResourceFromMemoryCacheImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentLoader* loader, CachedResource* cachedResource)
 606 {
 607     if (!loader || !cachedResource)
 608         return;
 609 
 610     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 611         networkAgent-&gt;didLoadResourceFromMemoryCache(loader, *cachedResource);
 612 }
 613 
 614 void InspectorInstrumentation::didReceiveResourceResponseImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const ResourceResponse&amp; response, ResourceLoader* resourceLoader)
 615 {
<span class="line-modified"> 616     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
 617         return;
 618 
 619     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 620         networkAgent-&gt;didReceiveResponse(identifier, loader, response, resourceLoader);
 621     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 622         consoleAgent-&gt;didReceiveResponse(identifier, response); // This should come AFTER resource notification, front-end relies on this.
 623 }
 624 
 625 void InspectorInstrumentation::didReceiveThreadableLoaderResponseImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentThreadableLoader&amp; documentThreadableLoader, unsigned long identifier)
 626 {
 627     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 628         networkAgent-&gt;didReceiveThreadableLoaderResponse(identifier, documentThreadableLoader);
 629 }
 630 
 631 void InspectorInstrumentation::didReceiveDataImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, const char* data, int dataLength, int encodedDataLength)
 632 {
 633     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 634         networkAgent-&gt;didReceiveData(identifier, data, dataLength, encodedDataLength);
 635 }
 636 
 637 void InspectorInstrumentation::didFinishLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const NetworkLoadMetrics&amp; networkLoadMetrics, ResourceLoader* resourceLoader)
 638 {
 639     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 640         networkAgent-&gt;didFinishLoading(identifier, loader, networkLoadMetrics, resourceLoader);
 641 }
 642 
 643 void InspectorInstrumentation::didFailLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const ResourceError&amp; error)
 644 {
<span class="line-modified"> 645     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
 646         return;
 647 
 648     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 649         networkAgent-&gt;didFailLoading(identifier, loader, error);
 650     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 651         consoleAgent-&gt;didFailLoading(identifier, error); // This should come AFTER resource notification, front-end relies on this.
 652 }
 653 
 654 void InspectorInstrumentation::willLoadXHRSynchronouslyImpl(InstrumentingAgents&amp; instrumentingAgents)
 655 {
 656     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 657         networkAgent-&gt;willLoadXHRSynchronously();
 658 }
 659 
 660 void InspectorInstrumentation::didLoadXHRSynchronouslyImpl(InstrumentingAgents&amp; instrumentingAgents)
 661 {
 662     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 663         networkAgent-&gt;didLoadXHRSynchronously();
 664 }
 665 
 666 void InspectorInstrumentation::scriptImportedImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, const String&amp; sourceString)
 667 {
 668     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 669         networkAgent-&gt;setInitialScriptContent(identifier, sourceString);
 670 }
 671 
 672 void InspectorInstrumentation::scriptExecutionBlockedByCSPImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; directiveText)
 673 {
<span class="line-modified"> 674     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())</span>
<span class="line-modified"> 675         debuggerAgent-&gt;scriptExecutionBlockedByCSP(directiveText);</span>
 676 }
 677 
 678 void InspectorInstrumentation::didReceiveScriptResponseImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier)
 679 {
 680     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 681         networkAgent-&gt;didReceiveScriptResponse(identifier);
 682 }
 683 
 684 void InspectorInstrumentation::domContentLoadedEventFiredImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 685 {
 686     if (!frame.isMainFrame())
 687         return;
 688 
 689     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 690         pageAgent-&gt;domContentEventFired();
 691 }
 692 
 693 void InspectorInstrumentation::loadEventFiredImpl(InstrumentingAgents&amp; instrumentingAgents, Frame* frame)
 694 {
 695     if (!frame || !frame-&gt;isMainFrame())
 696         return;
 697 
 698     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 699         pageAgent-&gt;loadEventFired();
 700 }
 701 
 702 void InspectorInstrumentation::frameDetachedFromParentImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 703 {
 704     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 705         pageAgent-&gt;frameDetached(frame);
 706 }
 707 
 708 void InspectorInstrumentation::didCommitLoadImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, DocumentLoader* loader)
 709 {
<span class="line-modified"> 710     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
 711         return;
 712 
 713     if (!frame.page())
 714         return;
 715 
 716     if (!loader)
 717         return;
 718 
 719     ASSERT(loader-&gt;frame() == &amp;frame);
 720 
 721     if (frame.isMainFrame()) {
 722         if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 723             consoleAgent-&gt;reset();
 724 
 725         if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 726             networkAgent-&gt;mainFrameNavigated(*loader);
 727 
 728         if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 729             cssAgent-&gt;reset();
 730 
 731         if (auto* databaseAgent = instrumentingAgents.inspectorDatabaseAgent())
 732             databaseAgent-&gt;didCommitLoad();
 733 
 734         if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 735             domAgent-&gt;setDocument(frame.document());
 736 
 737         if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
 738             layerTreeAgent-&gt;reset();
 739 
<span class="line-modified"> 740         if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
 741             pageDebuggerAgent-&gt;mainFrameNavigated();
 742 
 743         if (PageHeapAgent* pageHeapAgent = instrumentingAgents.pageHeapAgent())
 744             pageHeapAgent-&gt;mainFrameNavigated();
 745     }
 746 



 747     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 748         canvasAgent-&gt;frameNavigated(frame);
 749 



 750     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 751         domAgent-&gt;didCommitLoad(frame.document());
 752 
 753     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 754         pageAgent-&gt;frameNavigated(frame);
 755 
 756     if (frame.isMainFrame()) {
 757         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 758             timelineAgent-&gt;mainFrameNavigated();
 759     }
 760 }
 761 
 762 void InspectorInstrumentation::frameDocumentUpdatedImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 763 {
 764     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 765         domAgent-&gt;frameDocumentUpdated(frame);
 766 
<span class="line-modified"> 767     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified"> 768         domDebuggerAgent-&gt;frameDocumentUpdated(frame);</span>
 769 }
 770 
 771 void InspectorInstrumentation::loaderDetachedFromFrameImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentLoader&amp; loader)
 772 {
 773     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 774         inspectorPageAgent-&gt;loaderDetachedFromFrame(loader);
 775 }
 776 
 777 void InspectorInstrumentation::frameStartedLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 778 {
 779     if (frame.isMainFrame()) {
<span class="line-modified"> 780         if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
 781             pageDebuggerAgent-&gt;mainFrameStartedLoading();
 782         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())
 783             timelineAgent-&gt;mainFrameStartedLoading();
 784     }
 785 
 786     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 787         inspectorPageAgent-&gt;frameStartedLoading(frame);
 788 }
 789 
 790 void InspectorInstrumentation::frameStoppedLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 791 {
 792     if (frame.isMainFrame()) {
<span class="line-modified"> 793         if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
 794             pageDebuggerAgent-&gt;mainFrameStoppedLoading();
 795     }
 796 
 797     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 798         inspectorPageAgent-&gt;frameStoppedLoading(frame);
 799 }
 800 
 801 void InspectorInstrumentation::frameScheduledNavigationImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, Seconds delay)
 802 {
 803     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 804         inspectorPageAgent-&gt;frameScheduledNavigation(frame, delay);
 805 }
 806 
 807 void InspectorInstrumentation::frameClearedScheduledNavigationImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 808 {
 809     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 810         inspectorPageAgent-&gt;frameClearedScheduledNavigation(frame);
 811 }
 812 
 813 void InspectorInstrumentation::defaultAppearanceDidChangeImpl(InstrumentingAgents&amp; instrumentingAgents, bool useDarkAppearance)
 814 {
 815     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 816         inspectorPageAgent-&gt;defaultAppearanceDidChange(useDarkAppearance);
 817 }
 818 
 819 void InspectorInstrumentation::willDestroyCachedResourceImpl(CachedResource&amp; cachedResource)
 820 {
 821     if (!s_instrumentingAgentsSet)
 822         return;
 823 
 824     for (auto* instrumentingAgent : *s_instrumentingAgentsSet) {
 825         if (InspectorNetworkAgent* inspectorNetworkAgent = instrumentingAgent-&gt;inspectorNetworkAgent())
 826             inspectorNetworkAgent-&gt;willDestroyCachedResource(cachedResource);
 827     }
 828 }
 829 




















 830 // JavaScriptCore InspectorDebuggerAgent should know Console MessageTypes.
 831 static bool isConsoleAssertMessage(MessageSource source, MessageType type)
 832 {
 833     return source == MessageSource::ConsoleAPI &amp;&amp; type == MessageType::Assert;
 834 }
 835 
 836 void InspectorInstrumentation::addMessageToConsoleImpl(InstrumentingAgents&amp; instrumentingAgents, std::unique_ptr&lt;ConsoleMessage&gt; message)
 837 {
<span class="line-modified"> 838     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
 839         return;
 840 
 841     MessageSource source = message-&gt;source();
 842     MessageType type = message-&gt;type();
 843     String messageText = message-&gt;message();
 844 
 845     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 846         consoleAgent-&gt;addMessageToConsole(WTFMove(message));
 847     // FIXME: This should just pass the message on to the debugger agent. JavaScriptCore InspectorDebuggerAgent should know Console MessageTypes.
<span class="line-modified"> 848     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent()) {</span>
 849         if (isConsoleAssertMessage(source, type))
<span class="line-modified"> 850             debuggerAgent-&gt;handleConsoleAssert(messageText);</span>
 851     }
 852 }
 853 
<span class="line-modified"> 854 void InspectorInstrumentation::consoleCountImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* state, const String&amp; label)</span>
 855 {



 856     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 857         consoleAgent-&gt;count(state, label);
 858 }
 859 
<span class="line-modified"> 860 void InspectorInstrumentation::consoleCountResetImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* state, const String&amp; label)</span>
 861 {



 862     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 863         consoleAgent-&gt;countReset(state, label);
 864 }
 865 
 866 void InspectorInstrumentation::takeHeapSnapshotImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; title)
 867 {
 868     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 869         consoleAgent-&gt;takeHeapSnapshot(title);
 870 }
 871 
<span class="line-modified"> 872 void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, JSC::ExecState* exec, const String&amp; label)</span>
 873 {
<span class="line-modified"> 874     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
 875         return;
 876 
 877     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 878         timelineAgent-&gt;time(frame, label);
 879     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 880         consoleAgent-&gt;startTiming(exec, label);
 881 }
 882 
<span class="line-modified"> 883 void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; label)</span>
 884 {
<span class="line-modified"> 885     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
 886         return;
 887 
 888     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 889         consoleAgent-&gt;startTiming(exec, label);
 890 }
 891 
<span class="line-modified"> 892 void InspectorInstrumentation::logConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; label, Ref&lt;Inspector::ScriptArguments&gt;&amp;&amp; arguments)</span>
 893 {
<span class="line-modified"> 894     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
 895         return;
 896 
 897     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 898         consoleAgent-&gt;logTiming(exec, label, WTFMove(arguments));
 899 }
 900 
<span class="line-modified"> 901 void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, JSC::ExecState* exec, const String&amp; label)</span>
 902 {
<span class="line-modified"> 903     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
 904         return;
 905 
 906     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 907         consoleAgent-&gt;stopTiming(exec, label);
 908     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 909         timelineAgent-&gt;timeEnd(frame, label);
 910 }
 911 
<span class="line-modified"> 912 void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; label)</span>
 913 {
<span class="line-modified"> 914     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
 915         return;
 916 
 917     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 918         consoleAgent-&gt;stopTiming(exec, label);
 919 }
 920 
 921 void InspectorInstrumentation::consoleTimeStampImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)
 922 {
 923     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {
 924         String message;
 925         arguments-&gt;getFirstArgumentAsString(message);
 926         timelineAgent-&gt;didTimeStamp(frame, message);
 927      }
 928 }
 929 
<span class="line-modified"> 930 void InspectorInstrumentation::startProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; title)</span>
 931 {
 932     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())
 933         timelineAgent-&gt;startFromConsole(exec, title);
 934 }
 935 
<span class="line-modified"> 936 void InspectorInstrumentation::stopProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; title)</span>
 937 {
 938     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())
 939         timelineAgent-&gt;stopFromConsole(exec, title);
 940 }
 941 
<span class="line-modified"> 942 void InspectorInstrumentation::consoleStartRecordingCanvasImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context, JSC::ExecState&amp; exec, JSC::JSObject* options)</span>
 943 {
 944     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 945         canvasAgent-&gt;consoleStartRecordingCanvas(context, exec, options);
 946 }
 947 






 948 void InspectorInstrumentation::didOpenDatabaseImpl(InstrumentingAgents&amp; instrumentingAgents, Database&amp; database)
 949 {
 950     if (auto* databaseAgent = instrumentingAgents.inspectorDatabaseAgent())
 951         databaseAgent-&gt;didOpenDatabase(database);
 952 }
 953 
 954 void InspectorInstrumentation::didDispatchDOMStorageEventImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; key, const String&amp; oldValue, const String&amp; newValue, StorageType storageType, SecurityOrigin* securityOrigin)
 955 {
 956     if (InspectorDOMStorageAgent* domStorageAgent = instrumentingAgents.inspectorDOMStorageAgent())
 957         domStorageAgent-&gt;didDispatchDOMStorageEvent(key, oldValue, newValue, storageType, securityOrigin);
 958 }
 959 
 960 bool InspectorInstrumentation::shouldWaitForDebuggerOnStartImpl(InstrumentingAgents&amp; instrumentingAgents)
 961 {
 962     if (InspectorWorkerAgent* workerAgent = instrumentingAgents.inspectorWorkerAgent())
 963         return workerAgent-&gt;shouldWaitForDebuggerOnStart();
 964     return false;
 965 }
 966 
 967 void InspectorInstrumentation::workerStartedImpl(InstrumentingAgents&amp; instrumentingAgents, WorkerInspectorProxy* proxy, const URL&amp; url)
</pre>
<hr />
<pre>
1038 
1039 void InspectorInstrumentation::recordCanvasActionImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; canvasRenderingContext, const String&amp; name, std::initializer_list&lt;RecordCanvasActionVariant&gt;&amp;&amp; parameters)
1040 {
1041     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1042         canvasAgent-&gt;recordCanvasAction(canvasRenderingContext, name, WTFMove(parameters));
1043 }
1044 
1045 void InspectorInstrumentation::didFinishRecordingCanvasFrameImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context, bool forceDispatch)
1046 {
1047     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1048         canvasAgent-&gt;didFinishRecordingCanvasFrame(context, forceDispatch);
1049 }
1050 
1051 #if ENABLE(WEBGL)
1052 void InspectorInstrumentation::didEnableExtensionImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLRenderingContextBase&amp; contextWebGLBase, const String&amp; extension)
1053 {
1054     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1055         canvasAgent-&gt;didEnableExtension(contextWebGLBase, extension);
1056 }
1057 
<span class="line-modified">1058 void InspectorInstrumentation::didCreateProgramImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLRenderingContextBase&amp; contextWebGLBase, WebGLProgram&amp; program)</span>
1059 {
1060     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
<span class="line-modified">1061         canvasAgent-&gt;didCreateProgram(contextWebGLBase, program);</span>
1062 }
1063 
<span class="line-modified">1064 void InspectorInstrumentation::willDeleteProgramImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLProgram&amp; program)</span>
1065 {
1066     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
<span class="line-modified">1067         canvasAgent-&gt;willDeleteProgram(program);</span>
1068 }
1069 
<span class="line-modified">1070 bool InspectorInstrumentation::isShaderProgramDisabledImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLProgram&amp; program)</span>
1071 {
1072     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
<span class="line-modified">1073         return canvasAgent-&gt;isShaderProgramDisabled(program);</span>
1074     return false;
1075 }
1076 
<span class="line-modified">1077 bool InspectorInstrumentation::isShaderProgramHighlightedImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLProgram&amp; program)</span>
1078 {
1079     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
<span class="line-modified">1080         return canvasAgent-&gt;isShaderProgramHighlighted(program);</span>
1081     return false;
1082 }
1083 #endif
1084 













































































1085 #if ENABLE(RESOURCE_USAGE)
1086 void InspectorInstrumentation::didHandleMemoryPressureImpl(InstrumentingAgents&amp; instrumentingAgents, Critical critical)
1087 {
1088     if (InspectorMemoryAgent* memoryAgent = instrumentingAgents.inspectorMemoryAgent())
1089         memoryAgent-&gt;didHandleMemoryPressure(critical);
1090 }
1091 #endif
1092 
1093 void InspectorInstrumentation::networkStateChangedImpl(InstrumentingAgents&amp; instrumentingAgents)
1094 {
1095     if (InspectorApplicationCacheAgent* applicationCacheAgent = instrumentingAgents.inspectorApplicationCacheAgent())
1096         applicationCacheAgent-&gt;networkStateChanged();
1097 }
1098 
1099 void InspectorInstrumentation::updateApplicationCacheStatusImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
1100 {
1101     if (auto* applicationCacheAgent = instrumentingAgents.inspectorApplicationCacheAgent())
1102         applicationCacheAgent-&gt;updateApplicationCacheStatus(&amp;frame);
1103 }
1104 
1105 bool InspectorInstrumentation::consoleAgentEnabled(ScriptExecutionContext* scriptExecutionContext)
1106 {
1107     FAST_RETURN_IF_NO_FRONTENDS(false);
1108     if (auto* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext)) {
1109         if (auto* webConsoleAgent = instrumentingAgents-&gt;webConsoleAgent())
1110             return webConsoleAgent-&gt;enabled();
1111     }
1112     return false;
1113 }
1114 
1115 bool InspectorInstrumentation::timelineAgentTracking(ScriptExecutionContext* scriptExecutionContext)
1116 {
1117     FAST_RETURN_IF_NO_FRONTENDS(false);
1118     if (auto* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext))
1119         return instrumentingAgents-&gt;trackingInspectorTimelineAgent();
1120     return false;
1121 }
1122 
1123 void InspectorInstrumentation::didRequestAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
1124 {
<span class="line-modified">1125     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
1126         pageDebuggerAgent-&gt;didRequestAnimationFrame(callbackId, document);
1127     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
1128         timelineAgent-&gt;didRequestAnimationFrame(callbackId, document.frame());
1129 }
1130 
1131 void InspectorInstrumentation::didCancelAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
1132 {
<span class="line-modified">1133     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
1134         pageDebuggerAgent-&gt;didCancelAnimationFrame(callbackId);
1135     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
1136         timelineAgent-&gt;didCancelAnimationFrame(callbackId, document.frame());
1137 }
1138 
<span class="line-modified">1139 InspectorInstrumentationCookie InspectorInstrumentation::willFireAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)</span>
1140 {
<span class="line-modified">1141     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
1142         pageDebuggerAgent-&gt;willFireAnimationFrame(callbackId);
<span class="line-modified">1143 </span>
<span class="line-modified">1144     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified">1145         domDebuggerAgent-&gt;willFireAnimationFrame();</span>
<span class="line-removed">1146 </span>
<span class="line-removed">1147     int timelineAgentId = 0;</span>
<span class="line-removed">1148     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
1149         timelineAgent-&gt;willFireAnimationFrame(callbackId, document.frame());
<span class="line-removed">1150         timelineAgentId = timelineAgent-&gt;id();</span>
<span class="line-removed">1151     }</span>
<span class="line-removed">1152     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);</span>
1153 }
1154 
<span class="line-modified">1155 void InspectorInstrumentation::didFireAnimationFrameImpl(const InspectorInstrumentationCookie&amp; cookie)</span>
1156 {
<span class="line-modified">1157     if (InspectorDebuggerAgent* debuggerAgent = cookie.instrumentingAgents()-&gt;inspectorDebuggerAgent())</span>
<span class="line-modified">1158         debuggerAgent-&gt;didDispatchAsyncCall();</span>
<span class="line-modified">1159     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))</span>
1160         timelineAgent-&gt;didFireAnimationFrame();
1161 }
1162 
<span class="line-modified">1163 InspectorInstrumentationCookie InspectorInstrumentation::willFireObserverCallbackImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; callbackType, ScriptExecutionContext&amp; context)</span>
1164 {
<span class="line-modified">1165     int timelineAgentId = 0;</span>
<span class="line-removed">1166     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
1167         timelineAgent-&gt;willFireObserverCallback(callbackType, frameForScriptExecutionContext(&amp;context));
<span class="line-removed">1168         timelineAgentId = timelineAgent-&gt;id();</span>
<span class="line-removed">1169     }</span>
<span class="line-removed">1170     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);</span>
1171 }
1172 
<span class="line-modified">1173 void InspectorInstrumentation::didFireObserverCallbackImpl(const InspectorInstrumentationCookie&amp; cookie)</span>
1174 {
<span class="line-modified">1175     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))</span>
1176         timelineAgent-&gt;didFireObserverCallback();
1177 }
1178 
1179 void InspectorInstrumentation::registerInstrumentingAgents(InstrumentingAgents&amp; instrumentingAgents)
1180 {
1181     if (!s_instrumentingAgentsSet)
1182         s_instrumentingAgentsSet = new HashSet&lt;InstrumentingAgents*&gt;();
1183 
1184     s_instrumentingAgentsSet-&gt;add(&amp;instrumentingAgents);
1185 }
1186 
1187 void InspectorInstrumentation::unregisterInstrumentingAgents(InstrumentingAgents&amp; instrumentingAgents)
1188 {
1189     if (!s_instrumentingAgentsSet)
1190         return;
1191 
1192     s_instrumentingAgentsSet-&gt;remove(&amp;instrumentingAgents);
1193     if (s_instrumentingAgentsSet-&gt;isEmpty()) {
1194         delete s_instrumentingAgentsSet;
1195         s_instrumentingAgentsSet = nullptr;
1196     }
1197 }
1198 
<span class="line-removed">1199 InspectorTimelineAgent* InspectorInstrumentation::retrieveTimelineAgent(const InspectorInstrumentationCookie&amp; cookie)</span>
<span class="line-removed">1200 {</span>
<span class="line-removed">1201     if (!cookie.isValid())</span>
<span class="line-removed">1202         return nullptr;</span>
<span class="line-removed">1203 </span>
<span class="line-removed">1204     InspectorTimelineAgent* timelineAgent = cookie.instrumentingAgents()-&gt;trackingInspectorTimelineAgent();</span>
<span class="line-removed">1205     if (timelineAgent &amp;&amp; cookie.hasMatchingTimelineAgentId(timelineAgent-&gt;id()))</span>
<span class="line-removed">1206         return timelineAgent;</span>
<span class="line-removed">1207     return nullptr;</span>
<span class="line-removed">1208 }</span>
<span class="line-removed">1209 </span>
1210 InstrumentingAgents* InspectorInstrumentation::instrumentingAgentsForRenderer(RenderObject&amp; renderer)
1211 {
1212     return instrumentingAgentsForFrame(renderer.frame());
1213 }
1214 
1215 void InspectorInstrumentation::layerTreeDidChangeImpl(InstrumentingAgents&amp; instrumentingAgents)
1216 {
1217     if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
1218         layerTreeAgent-&gt;layerTreeDidChange();
1219 }
1220 
1221 void InspectorInstrumentation::renderLayerDestroyedImpl(InstrumentingAgents&amp; instrumentingAgents, const RenderLayer&amp; renderLayer)
1222 {
1223     if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
1224         layerTreeAgent-&gt;renderLayerDestroyed(renderLayer);
1225 }
1226 




















1227 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
  16 * contributors may be used to endorse or promote products derived from
  17 * this software without specific prior written permission.
  18 *
  19 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  20 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  21 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  22 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  23 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  24 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  25 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  26 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  27 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  28 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  29 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  30 */
  31 
  32 #include &quot;config.h&quot;
  33 #include &quot;InspectorInstrumentation.h&quot;
  34 
  35 #include &quot;CachedResource.h&quot;
<span class="line-added">  36 #include &quot;ComputedEffectTiming.h&quot;</span>
  37 #include &quot;CustomHeaderFields.h&quot;
  38 #include &quot;DOMWindow.h&quot;
  39 #include &quot;DOMWrapperWorld.h&quot;
  40 #include &quot;DocumentLoader.h&quot;
  41 #include &quot;Event.h&quot;
  42 #include &quot;Frame.h&quot;
<span class="line-added">  43 #include &quot;InspectorAnimationAgent.h&quot;</span>
  44 #include &quot;InspectorApplicationCacheAgent.h&quot;
  45 #include &quot;InspectorCSSAgent.h&quot;
  46 #include &quot;InspectorCanvasAgent.h&quot;
<span class="line-added">  47 #include &quot;InspectorController.h&quot;</span>
  48 #include &quot;InspectorDOMAgent.h&quot;
  49 #include &quot;InspectorDOMDebuggerAgent.h&quot;
  50 #include &quot;InspectorDOMStorageAgent.h&quot;
  51 #include &quot;InspectorDatabaseAgent.h&quot;
  52 #include &quot;InspectorLayerTreeAgent.h&quot;
  53 #include &quot;InspectorMemoryAgent.h&quot;
  54 #include &quot;InspectorNetworkAgent.h&quot;
  55 #include &quot;InspectorPageAgent.h&quot;
  56 #include &quot;InspectorTimelineAgent.h&quot;
  57 #include &quot;InspectorWorkerAgent.h&quot;
  58 #include &quot;InstrumentingAgents.h&quot;
<span class="line-added">  59 #include &quot;KeyframeEffect.h&quot;</span>
  60 #include &quot;LoaderStrategy.h&quot;
<span class="line-added">  61 #include &quot;PageDOMDebuggerAgent.h&quot;</span>
  62 #include &quot;PageDebuggerAgent.h&quot;
  63 #include &quot;PageHeapAgent.h&quot;
  64 #include &quot;PageRuntimeAgent.h&quot;
  65 #include &quot;PlatformStrategies.h&quot;
  66 #include &quot;RenderObject.h&quot;
  67 #include &quot;RenderView.h&quot;
  68 #include &quot;ScriptController.h&quot;
  69 #include &quot;ScriptExecutionContext.h&quot;
  70 #include &quot;WebConsoleAgent.h&quot;
<span class="line-added">  71 #include &quot;WebDebuggerAgent.h&quot;</span>
  72 #include &quot;WebGLRenderingContextBase.h&quot;
<span class="line-added">  73 #include &quot;WebGPUDevice.h&quot;</span>
  74 #include &quot;WebSocketFrame.h&quot;
<span class="line-added">  75 #include &quot;WorkerGlobalScope.h&quot;</span>
<span class="line-added">  76 #include &quot;WorkerInspectorController.h&quot;</span>
  77 #include &lt;JavaScriptCore/ConsoleMessage.h&gt;
  78 #include &lt;JavaScriptCore/ConsoleTypes.h&gt;
  79 #include &lt;JavaScriptCore/InspectorDebuggerAgent.h&gt;
  80 #include &lt;JavaScriptCore/ScriptArguments.h&gt;
  81 #include &lt;JavaScriptCore/ScriptCallStack.h&gt;
  82 #include &lt;wtf/StdLibExtras.h&gt;
  83 
<span class="line-added">  84 #if ENABLE(WEBGPU)</span>
<span class="line-added">  85 #include &quot;WebGPUSwapChain.h&quot;</span>
<span class="line-added">  86 #endif</span>
<span class="line-added">  87 </span>
  88 namespace WebCore {
  89 
  90 using namespace Inspector;
  91 
  92 namespace {
  93 static HashSet&lt;InstrumentingAgents*&gt;* s_instrumentingAgentsSet = nullptr;
  94 }
  95 


  96 void InspectorInstrumentation::firstFrontendCreated()
  97 {
  98     platformStrategies()-&gt;loaderStrategy()-&gt;setCaptureExtraNetworkLoadMetricsEnabled(true);
  99 }
 100 
 101 void InspectorInstrumentation::lastFrontendDeleted()
 102 {
 103     platformStrategies()-&gt;loaderStrategy()-&gt;setCaptureExtraNetworkLoadMetricsEnabled(false);
 104 }
 105 
 106 static Frame* frameForScriptExecutionContext(ScriptExecutionContext* context)
 107 {
 108     Frame* frame = nullptr;
 109     if (is&lt;Document&gt;(*context))
 110         frame = downcast&lt;Document&gt;(*context).frame();
 111     return frame;
 112 }
 113 
 114 static Frame* frameForScriptExecutionContext(ScriptExecutionContext&amp; context)
 115 {
 116     Frame* frame = nullptr;
 117     if (is&lt;Document&gt;(context))
 118         frame = downcast&lt;Document&gt;(context).frame();
 119     return frame;
 120 }
 121 
 122 void InspectorInstrumentation::didClearWindowObjectInWorldImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, DOMWrapperWorld&amp; world)
 123 {
<span class="line-modified"> 124     if (auto* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
<span class="line-modified"> 125         pageDebuggerAgent-&gt;didClearWindowObjectInWorld(frame, world);</span>


 126 
<span class="line-modified"> 127     if (auto* pageRuntimeAgent = instrumentingAgents.pageRuntimeAgent())</span>
<span class="line-modified"> 128         pageRuntimeAgent-&gt;didClearWindowObjectInWorld(frame, world);</span>
<span class="line-modified"> 129 </span>
<span class="line-modified"> 130     if (auto* pageAgent = instrumentingAgents.inspectorPageAgent())</span>
<span class="line-added"> 131         pageAgent-&gt;didClearWindowObjectInWorld(frame, world);</span>
 132 }
 133 
 134 bool InspectorInstrumentation::isDebuggerPausedImpl(InstrumentingAgents&amp; instrumentingAgents)
 135 {
<span class="line-modified"> 136     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 137         return webDebuggerAgent-&gt;isPaused();</span>
 138     return false;
 139 }
 140 
 141 int InspectorInstrumentation::identifierForNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 142 {
 143     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 144         return domAgent-&gt;identifierForNode(node);
 145     return 0;
 146 }
 147 
 148 void InspectorInstrumentation::addEventListenersToNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 149 {
 150     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 151         domAgent-&gt;addEventListenersToNode(node);
 152 }
 153 
 154 void InspectorInstrumentation::willInsertDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; parent)
 155 {
<span class="line-modified"> 156     if (auto* pageDOMDebuggerAgent = instrumentingAgents.pageDOMDebuggerAgent())</span>
<span class="line-modified"> 157         pageDOMDebuggerAgent-&gt;willInsertDOMNode(parent);</span>
 158 }
 159 
 160 void InspectorInstrumentation::didInsertDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 161 {
 162     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 163         domAgent-&gt;didInsertDOMNode(node);
<span class="line-modified"> 164     if (auto* pageDOMDebuggerAgent = instrumentingAgents.pageDOMDebuggerAgent())</span>
<span class="line-modified"> 165         pageDOMDebuggerAgent-&gt;didInsertDOMNode(node);</span>
 166 }
 167 
 168 void InspectorInstrumentation::willRemoveDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 169 {
<span class="line-modified"> 170     if (auto* pageDOMDebuggerAgent = instrumentingAgents.pageDOMDebuggerAgent())</span>
<span class="line-modified"> 171         pageDOMDebuggerAgent-&gt;willRemoveDOMNode(node);</span>
 172 }
 173 
 174 void InspectorInstrumentation::didRemoveDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 175 {
<span class="line-modified"> 176     if (auto* pageDOMDebuggerAgent = instrumentingAgents.pageDOMDebuggerAgent())</span>
<span class="line-modified"> 177         pageDOMDebuggerAgent-&gt;didRemoveDOMNode(node);</span>
 178     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 179         domAgent-&gt;didRemoveDOMNode(node);
 180 }
 181 
 182 void InspectorInstrumentation::willModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; oldValue, const AtomString&amp; newValue)
 183 {
<span class="line-modified"> 184     if (auto* pageDOMDebuggerAgent = instrumentingAgents.pageDOMDebuggerAgent())</span>
<span class="line-modified"> 185         pageDOMDebuggerAgent-&gt;willModifyDOMAttr(element);</span>
 186     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 187         domAgent-&gt;willModifyDOMAttr(element, oldValue, newValue);
 188 }
 189 
 190 void InspectorInstrumentation::didModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; name, const AtomString&amp; value)
 191 {
 192     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 193         domAgent-&gt;didModifyDOMAttr(element, name, value);
 194 }
 195 
 196 void InspectorInstrumentation::didRemoveDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; name)
 197 {
 198     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 199         domAgent-&gt;didRemoveDOMAttr(element, name);
 200 }
 201 
 202 void InspectorInstrumentation::willInvalidateStyleAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element)
 203 {
<span class="line-modified"> 204     if (auto* pageDOMDebuggerAgent = instrumentingAgents.pageDOMDebuggerAgent())</span>
<span class="line-modified"> 205         pageDOMDebuggerAgent-&gt;willInvalidateStyleAttr(element);</span>
 206 }
 207 
 208 void InspectorInstrumentation::didInvalidateStyleAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element)
 209 {
 210     if (auto* domAgent = instrumentingAgents.inspectorDOMAgent())
 211         domAgent-&gt;didInvalidateStyleAttr(element);
 212 }
 213 
 214 void InspectorInstrumentation::documentDetachedImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 215 {
 216     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 217         cssAgent-&gt;documentDetached(document);
 218 }
 219 
 220 void InspectorInstrumentation::frameWindowDiscardedImpl(InstrumentingAgents&amp; instrumentingAgents, DOMWindow* window)
 221 {
<span class="line-modified"> 222     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
 223         return;
 224 
 225     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 226         consoleAgent-&gt;frameWindowDiscarded(window);
 227 }
 228 
 229 void InspectorInstrumentation::mediaQueryResultChangedImpl(InstrumentingAgents&amp; instrumentingAgents)
 230 {
 231     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 232         cssAgent-&gt;mediaQueryResultChanged();
 233 }
 234 
 235 void InspectorInstrumentation::activeStyleSheetsUpdatedImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 236 {
 237     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 238         cssAgent-&gt;activeStyleSheetsUpdated(document);
 239 }
 240 
 241 void InspectorInstrumentation::didPushShadowRootImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; host, ShadowRoot&amp; root)
 242 {
</pre>
<hr />
<pre>
 306 void InspectorInstrumentation::characterDataModifiedImpl(InstrumentingAgents&amp; instrumentingAgents, CharacterData&amp; characterData)
 307 {
 308     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 309         domAgent-&gt;characterDataModified(characterData);
 310 }
 311 
 312 void InspectorInstrumentation::willSendXMLHttpRequestImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; url)
 313 {
 314     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 315         domDebuggerAgent-&gt;willSendXMLHttpRequest(url);
 316 }
 317 
 318 void InspectorInstrumentation::willFetchImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; url)
 319 {
 320     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 321         domDebuggerAgent-&gt;willFetch(url);
 322 }
 323 
 324 void InspectorInstrumentation::didInstallTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, Seconds timeout, bool singleShot, ScriptExecutionContext&amp; context)
 325 {
<span class="line-modified"> 326     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 327         webDebuggerAgent-&gt;didScheduleAsyncCall(context.execState(), InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId, singleShot);</span>
 328 
 329     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 330         timelineAgent-&gt;didInstallTimer(timerId, timeout, singleShot, frameForScriptExecutionContext(context));
 331 }
 332 
 333 void InspectorInstrumentation::didRemoveTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, ScriptExecutionContext&amp; context)
 334 {
<span class="line-modified"> 335     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 336         webDebuggerAgent-&gt;didCancelAsyncCall(InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId);</span>
 337     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 338         timelineAgent-&gt;didRemoveTimer(timerId, frameForScriptExecutionContext(context));
 339 }
 340 
 341 void InspectorInstrumentation::didAddEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)
 342 {
<span class="line-modified"> 343     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 344         webDebuggerAgent-&gt;didAddEventListener(target, eventType, listener, capture);</span>
 345     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 346         domAgent-&gt;didAddEventListener(target);
 347 }
 348 
 349 void InspectorInstrumentation::willRemoveEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)
 350 {
<span class="line-modified"> 351     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 352         webDebuggerAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);</span>
 353     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 354         domAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);
 355 }
 356 
 357 bool InspectorInstrumentation::isEventListenerDisabledImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)
 358 {
 359     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 360         return domAgent-&gt;isEventListenerDisabled(target, eventType, listener, capture);
 361     return false;
 362 }
 363 
<span class="line-modified"> 364 void InspectorInstrumentation::didPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer, JSC::JSGlobalObject&amp; state)</span>
 365 {
<span class="line-modified"> 366     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 367         webDebuggerAgent-&gt;didPostMessage(timer, state);</span>
 368 }
 369 
 370 void InspectorInstrumentation::didFailPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 371 {
<span class="line-modified"> 372     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 373         webDebuggerAgent-&gt;didFailPostMessage(timer);</span>
 374 }
 375 
 376 void InspectorInstrumentation::willDispatchPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 377 {
<span class="line-modified"> 378     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 379         webDebuggerAgent-&gt;willDispatchPostMessage(timer);</span>
 380 }
 381 
 382 void InspectorInstrumentation::didDispatchPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 383 {
<span class="line-modified"> 384     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 385         webDebuggerAgent-&gt;didDispatchPostMessage(timer);</span>
 386 }
 387 
<span class="line-modified"> 388 void InspectorInstrumentation::willCallFunctionImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; scriptName, int scriptLine, int scriptColumn, ScriptExecutionContext* context)</span>
 389 {
<span class="line-modified"> 390     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>

 391         timelineAgent-&gt;willCallFunction(scriptName, scriptLine, scriptColumn, frameForScriptExecutionContext(context));



 392 }
 393 
<span class="line-modified"> 394 void InspectorInstrumentation::didCallFunctionImpl(InstrumentingAgents&amp; instrumentingAgents, ScriptExecutionContext* context)</span>
 395 {
<span class="line-modified"> 396     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 397         timelineAgent-&gt;didCallFunction(frameForScriptExecutionContext(context));
 398 }
 399 
<span class="line-modified"> 400 void InspectorInstrumentation::willDispatchEventImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document, const Event&amp; event)</span>
 401 {
<span class="line-modified"> 402     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>


 403         timelineAgent-&gt;willDispatchEvent(event, document.frame());




 404 }
 405 
 406 void InspectorInstrumentation::willHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents, Event&amp; event, const RegisteredEventListener&amp; listener)
 407 {
<span class="line-modified"> 408     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 409         webDebuggerAgent-&gt;willHandleEvent(listener);</span>
 410 
 411     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 412         domDebuggerAgent-&gt;willHandleEvent(event, listener);
 413 }
 414 
 415 void InspectorInstrumentation::didHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents)
 416 {
<span class="line-modified"> 417     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 418         webDebuggerAgent-&gt;didDispatchAsyncCall();</span>
 419 
 420     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 421         domDebuggerAgent-&gt;didHandleEvent();
 422 }
 423 
<span class="line-modified"> 424 void InspectorInstrumentation::didDispatchEventImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event)</span>
 425 {
<span class="line-modified"> 426     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
<span class="line-modified"> 427         timelineAgent-&gt;didDispatchEvent(event.defaultPrevented());</span>
 428 }
 429 
<span class="line-modified"> 430 void InspectorInstrumentation::willDispatchEventOnWindowImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event, DOMWindow&amp; window)</span>
 431 {
<span class="line-modified"> 432     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>


 433         timelineAgent-&gt;willDispatchEvent(event, window.frame());




 434 }
 435 
<span class="line-modified"> 436 void InspectorInstrumentation::didDispatchEventOnWindowImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event)</span>
 437 {
<span class="line-modified"> 438     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
<span class="line-modified"> 439         timelineAgent-&gt;didDispatchEvent(event.defaultPrevented());</span>
 440 }
 441 
 442 void InspectorInstrumentation::eventDidResetAfterDispatchImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event)
 443 {
 444     if (auto* domAgent = instrumentingAgents.inspectorDOMAgent())
 445         domAgent-&gt;eventDidResetAfterDispatch(event);
 446 }
 447 
<span class="line-modified"> 448 void InspectorInstrumentation::willEvaluateScriptImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, const String&amp; url, int lineNumber, int columnNumber)</span>
 449 {
<span class="line-modified"> 450     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>

 451         timelineAgent-&gt;willEvaluateScript(url, lineNumber, columnNumber, frame);



 452 }
 453 
<span class="line-modified"> 454 void InspectorInstrumentation::didEvaluateScriptImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)</span>
 455 {
<span class="line-modified"> 456     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 457         timelineAgent-&gt;didEvaluateScript(frame);
 458 }
 459 
<span class="line-modified"> 460 void InspectorInstrumentation::willFireTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, bool oneShot, ScriptExecutionContext&amp; context)</span>
 461 {
<span class="line-modified"> 462     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 463         webDebuggerAgent-&gt;willDispatchAsyncCall(InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId);</span>
<span class="line-modified"> 464     if (auto* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>

 465         domDebuggerAgent-&gt;willFireTimer(oneShot);
<span class="line-modified"> 466     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>


 467         timelineAgent-&gt;willFireTimer(timerId, frameForScriptExecutionContext(context));



 468 }
 469 
<span class="line-modified"> 470 void InspectorInstrumentation::didFireTimerImpl(InstrumentingAgents&amp; instrumentingAgents)</span>
 471 {
<span class="line-modified"> 472     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 473         webDebuggerAgent-&gt;didDispatchAsyncCall();</span>
<span class="line-modified"> 474     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 475         timelineAgent-&gt;didFireTimer();
 476 }
 477 
 478 void InspectorInstrumentation::didInvalidateLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 479 {
 480     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 481         timelineAgent-&gt;didInvalidateLayout(frame);
 482 }
 483 
<span class="line-modified"> 484 void InspectorInstrumentation::willLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)</span>
 485 {
<span class="line-modified"> 486     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>

 487         timelineAgent-&gt;willLayout(frame);



 488 }
 489 
<span class="line-modified"> 490 void InspectorInstrumentation::didLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; root)</span>
 491 {
<span class="line-modified"> 492     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 493         timelineAgent-&gt;didLayout(root);
<span class="line-modified"> 494     if (auto* pageAgent = instrumentingAgents.inspectorPageAgent())</span>

 495         pageAgent-&gt;didLayout();
 496 }
 497 
 498 void InspectorInstrumentation::willCompositeImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 499 {
 500     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 501         timelineAgent-&gt;willComposite(frame);
 502 }
 503 
 504 void InspectorInstrumentation::didCompositeImpl(InstrumentingAgents&amp; instrumentingAgents)
 505 {
 506     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 507         timelineAgent-&gt;didComposite();
 508 }
 509 
 510 void InspectorInstrumentation::willPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer)
 511 {
 512     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 513         timelineAgent-&gt;willPaint(renderer.frame());
 514 }
 515 
 516 void InspectorInstrumentation::didPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer, const LayoutRect&amp; rect)
 517 {
 518     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 519         timelineAgent-&gt;didPaint(renderer, rect);
 520 
 521     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 522         pageAgent-&gt;didPaint(renderer, rect);
 523 }
 524 
<span class="line-modified"> 525 void InspectorInstrumentation::willRecalculateStyleImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)</span>
 526 {
<span class="line-modified"> 527     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>

 528         timelineAgent-&gt;willRecalculateStyle(document.frame());


 529     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 530         networkAgent-&gt;willRecalculateStyle();

 531 }
 532 
<span class="line-modified"> 533 void InspectorInstrumentation::didRecalculateStyleImpl(InstrumentingAgents&amp; instrumentingAgents)</span>
 534 {
<span class="line-modified"> 535     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>





 536         timelineAgent-&gt;didRecalculateStyle();
 537     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 538         networkAgent-&gt;didRecalculateStyle();
 539     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 540         pageAgent-&gt;didRecalculateStyle();
 541 }
 542 
 543 void InspectorInstrumentation::didScheduleStyleRecalculationImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 544 {
 545     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 546         timelineAgent-&gt;didScheduleStyleRecalculation(document.frame());
 547     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 548         networkAgent-&gt;didScheduleStyleRecalculation(document);
 549 }
 550 
 551 void InspectorInstrumentation::applyUserAgentOverrideImpl(InstrumentingAgents&amp; instrumentingAgents, String&amp; userAgent)
 552 {
 553     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 554         pageAgent-&gt;applyUserAgentOverride(userAgent);
 555 }
</pre>
<hr />
<pre>
 566         networkAgent-&gt;willSendRequest(identifier, loader, request, redirectResponse);
 567 }
 568 
 569 void InspectorInstrumentation::willSendRequestOfTypeImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, ResourceRequest&amp; request, LoadType loadType)
 570 {
 571     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 572         networkAgent-&gt;willSendRequestOfType(identifier, loader, request, loadType);
 573 }
 574 
 575 void InspectorInstrumentation::didLoadResourceFromMemoryCacheImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentLoader* loader, CachedResource* cachedResource)
 576 {
 577     if (!loader || !cachedResource)
 578         return;
 579 
 580     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 581         networkAgent-&gt;didLoadResourceFromMemoryCache(loader, *cachedResource);
 582 }
 583 
 584 void InspectorInstrumentation::didReceiveResourceResponseImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const ResourceResponse&amp; response, ResourceLoader* resourceLoader)
 585 {
<span class="line-modified"> 586     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
 587         return;
 588 
 589     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 590         networkAgent-&gt;didReceiveResponse(identifier, loader, response, resourceLoader);
 591     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 592         consoleAgent-&gt;didReceiveResponse(identifier, response); // This should come AFTER resource notification, front-end relies on this.
 593 }
 594 
 595 void InspectorInstrumentation::didReceiveThreadableLoaderResponseImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentThreadableLoader&amp; documentThreadableLoader, unsigned long identifier)
 596 {
 597     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 598         networkAgent-&gt;didReceiveThreadableLoaderResponse(identifier, documentThreadableLoader);
 599 }
 600 
 601 void InspectorInstrumentation::didReceiveDataImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, const char* data, int dataLength, int encodedDataLength)
 602 {
 603     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 604         networkAgent-&gt;didReceiveData(identifier, data, dataLength, encodedDataLength);
 605 }
 606 
 607 void InspectorInstrumentation::didFinishLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const NetworkLoadMetrics&amp; networkLoadMetrics, ResourceLoader* resourceLoader)
 608 {
 609     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 610         networkAgent-&gt;didFinishLoading(identifier, loader, networkLoadMetrics, resourceLoader);
 611 }
 612 
 613 void InspectorInstrumentation::didFailLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const ResourceError&amp; error)
 614 {
<span class="line-modified"> 615     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
 616         return;
 617 
 618     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 619         networkAgent-&gt;didFailLoading(identifier, loader, error);
 620     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 621         consoleAgent-&gt;didFailLoading(identifier, error); // This should come AFTER resource notification, front-end relies on this.
 622 }
 623 
 624 void InspectorInstrumentation::willLoadXHRSynchronouslyImpl(InstrumentingAgents&amp; instrumentingAgents)
 625 {
 626     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 627         networkAgent-&gt;willLoadXHRSynchronously();
 628 }
 629 
 630 void InspectorInstrumentation::didLoadXHRSynchronouslyImpl(InstrumentingAgents&amp; instrumentingAgents)
 631 {
 632     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 633         networkAgent-&gt;didLoadXHRSynchronously();
 634 }
 635 
 636 void InspectorInstrumentation::scriptImportedImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, const String&amp; sourceString)
 637 {
 638     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 639         networkAgent-&gt;setInitialScriptContent(identifier, sourceString);
 640 }
 641 
 642 void InspectorInstrumentation::scriptExecutionBlockedByCSPImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; directiveText)
 643 {
<span class="line-modified"> 644     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified"> 645         webDebuggerAgent-&gt;scriptExecutionBlockedByCSP(directiveText);</span>
 646 }
 647 
 648 void InspectorInstrumentation::didReceiveScriptResponseImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier)
 649 {
 650     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 651         networkAgent-&gt;didReceiveScriptResponse(identifier);
 652 }
 653 
 654 void InspectorInstrumentation::domContentLoadedEventFiredImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 655 {
 656     if (!frame.isMainFrame())
 657         return;
 658 
 659     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 660         pageAgent-&gt;domContentEventFired();
 661 }
 662 
 663 void InspectorInstrumentation::loadEventFiredImpl(InstrumentingAgents&amp; instrumentingAgents, Frame* frame)
 664 {
 665     if (!frame || !frame-&gt;isMainFrame())
 666         return;
 667 
 668     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 669         pageAgent-&gt;loadEventFired();
 670 }
 671 
 672 void InspectorInstrumentation::frameDetachedFromParentImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 673 {
 674     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 675         pageAgent-&gt;frameDetached(frame);
 676 }
 677 
 678 void InspectorInstrumentation::didCommitLoadImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, DocumentLoader* loader)
 679 {
<span class="line-modified"> 680     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
 681         return;
 682 
 683     if (!frame.page())
 684         return;
 685 
 686     if (!loader)
 687         return;
 688 
 689     ASSERT(loader-&gt;frame() == &amp;frame);
 690 
 691     if (frame.isMainFrame()) {
 692         if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 693             consoleAgent-&gt;reset();
 694 
 695         if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 696             networkAgent-&gt;mainFrameNavigated(*loader);
 697 
 698         if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 699             cssAgent-&gt;reset();
 700 
 701         if (auto* databaseAgent = instrumentingAgents.inspectorDatabaseAgent())
 702             databaseAgent-&gt;didCommitLoad();
 703 
 704         if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 705             domAgent-&gt;setDocument(frame.document());
 706 
 707         if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
 708             layerTreeAgent-&gt;reset();
 709 
<span class="line-modified"> 710         if (auto* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
 711             pageDebuggerAgent-&gt;mainFrameNavigated();
 712 
 713         if (PageHeapAgent* pageHeapAgent = instrumentingAgents.pageHeapAgent())
 714             pageHeapAgent-&gt;mainFrameNavigated();
 715     }
 716 
<span class="line-added"> 717     if (auto* pageRuntimeAgent = instrumentingAgents.pageRuntimeAgent())</span>
<span class="line-added"> 718         pageRuntimeAgent-&gt;frameNavigated(frame);</span>
<span class="line-added"> 719 </span>
 720     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 721         canvasAgent-&gt;frameNavigated(frame);
 722 
<span class="line-added"> 723     if (auto* animationAgent = instrumentingAgents.enabledInspectorAnimationAgent())</span>
<span class="line-added"> 724         animationAgent-&gt;frameNavigated(frame);</span>
<span class="line-added"> 725 </span>
 726     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 727         domAgent-&gt;didCommitLoad(frame.document());
 728 
 729     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 730         pageAgent-&gt;frameNavigated(frame);
 731 
 732     if (frame.isMainFrame()) {
 733         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 734             timelineAgent-&gt;mainFrameNavigated();
 735     }
 736 }
 737 
 738 void InspectorInstrumentation::frameDocumentUpdatedImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 739 {
 740     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 741         domAgent-&gt;frameDocumentUpdated(frame);
 742 
<span class="line-modified"> 743     if (auto* pageDOMDebuggerAgent = instrumentingAgents.pageDOMDebuggerAgent())</span>
<span class="line-modified"> 744         pageDOMDebuggerAgent-&gt;frameDocumentUpdated(frame);</span>
 745 }
 746 
 747 void InspectorInstrumentation::loaderDetachedFromFrameImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentLoader&amp; loader)
 748 {
 749     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 750         inspectorPageAgent-&gt;loaderDetachedFromFrame(loader);
 751 }
 752 
 753 void InspectorInstrumentation::frameStartedLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 754 {
 755     if (frame.isMainFrame()) {
<span class="line-modified"> 756         if (auto* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
 757             pageDebuggerAgent-&gt;mainFrameStartedLoading();
 758         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())
 759             timelineAgent-&gt;mainFrameStartedLoading();
 760     }
 761 
 762     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 763         inspectorPageAgent-&gt;frameStartedLoading(frame);
 764 }
 765 
 766 void InspectorInstrumentation::frameStoppedLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 767 {
 768     if (frame.isMainFrame()) {
<span class="line-modified"> 769         if (auto* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
 770             pageDebuggerAgent-&gt;mainFrameStoppedLoading();
 771     }
 772 
 773     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 774         inspectorPageAgent-&gt;frameStoppedLoading(frame);
 775 }
 776 
 777 void InspectorInstrumentation::frameScheduledNavigationImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, Seconds delay)
 778 {
 779     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 780         inspectorPageAgent-&gt;frameScheduledNavigation(frame, delay);
 781 }
 782 
 783 void InspectorInstrumentation::frameClearedScheduledNavigationImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 784 {
 785     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 786         inspectorPageAgent-&gt;frameClearedScheduledNavigation(frame);
 787 }
 788 
 789 void InspectorInstrumentation::defaultAppearanceDidChangeImpl(InstrumentingAgents&amp; instrumentingAgents, bool useDarkAppearance)
 790 {
 791     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 792         inspectorPageAgent-&gt;defaultAppearanceDidChange(useDarkAppearance);
 793 }
 794 
 795 void InspectorInstrumentation::willDestroyCachedResourceImpl(CachedResource&amp; cachedResource)
 796 {
 797     if (!s_instrumentingAgentsSet)
 798         return;
 799 
 800     for (auto* instrumentingAgent : *s_instrumentingAgentsSet) {
 801         if (InspectorNetworkAgent* inspectorNetworkAgent = instrumentingAgent-&gt;inspectorNetworkAgent())
 802             inspectorNetworkAgent-&gt;willDestroyCachedResource(cachedResource);
 803     }
 804 }
 805 
<span class="line-added"> 806 bool InspectorInstrumentation::willInterceptRequestImpl(InstrumentingAgents&amp; instrumentingAgents, const ResourceRequest&amp; request)</span>
<span class="line-added"> 807 {</span>
<span class="line-added"> 808     if (auto* networkAgent = instrumentingAgents.inspectorNetworkAgent())</span>
<span class="line-added"> 809         return networkAgent-&gt;willInterceptRequest(request);</span>
<span class="line-added"> 810     return false;</span>
<span class="line-added"> 811 }</span>
<span class="line-added"> 812 </span>
<span class="line-added"> 813 bool InspectorInstrumentation::shouldInterceptResponseImpl(InstrumentingAgents&amp; instrumentingAgents, const ResourceResponse&amp; response)</span>
<span class="line-added"> 814 {</span>
<span class="line-added"> 815     if (auto* networkAgent = instrumentingAgents.inspectorNetworkAgent())</span>
<span class="line-added"> 816         return networkAgent-&gt;shouldInterceptResponse(response);</span>
<span class="line-added"> 817     return false;</span>
<span class="line-added"> 818 }</span>
<span class="line-added"> 819 </span>
<span class="line-added"> 820 void InspectorInstrumentation::interceptResponseImpl(InstrumentingAgents&amp; instrumentingAgents, const ResourceResponse&amp; response, unsigned long identifier, CompletionHandler&lt;void(const ResourceResponse&amp;, RefPtr&lt;SharedBuffer&gt;)&gt;&amp;&amp; handler)</span>
<span class="line-added"> 821 {</span>
<span class="line-added"> 822     if (auto* networkAgent = instrumentingAgents.inspectorNetworkAgent())</span>
<span class="line-added"> 823         networkAgent-&gt;interceptResponse(response, identifier, WTFMove(handler));</span>
<span class="line-added"> 824 }</span>
<span class="line-added"> 825 </span>
 826 // JavaScriptCore InspectorDebuggerAgent should know Console MessageTypes.
 827 static bool isConsoleAssertMessage(MessageSource source, MessageType type)
 828 {
 829     return source == MessageSource::ConsoleAPI &amp;&amp; type == MessageType::Assert;
 830 }
 831 
 832 void InspectorInstrumentation::addMessageToConsoleImpl(InstrumentingAgents&amp; instrumentingAgents, std::unique_ptr&lt;ConsoleMessage&gt; message)
 833 {
<span class="line-modified"> 834     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
 835         return;
 836 
 837     MessageSource source = message-&gt;source();
 838     MessageType type = message-&gt;type();
 839     String messageText = message-&gt;message();
 840 
 841     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 842         consoleAgent-&gt;addMessageToConsole(WTFMove(message));
 843     // FIXME: This should just pass the message on to the debugger agent. JavaScriptCore InspectorDebuggerAgent should know Console MessageTypes.
<span class="line-modified"> 844     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent()) {</span>
 845         if (isConsoleAssertMessage(source, type))
<span class="line-modified"> 846             webDebuggerAgent-&gt;handleConsoleAssert(messageText);</span>
 847     }
 848 }
 849 
<span class="line-modified"> 850 void InspectorInstrumentation::consoleCountImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::JSGlobalObject* state, const String&amp; label)</span>
 851 {
<span class="line-added"> 852     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
<span class="line-added"> 853         return;</span>
<span class="line-added"> 854 </span>
 855     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 856         consoleAgent-&gt;count(state, label);
 857 }
 858 
<span class="line-modified"> 859 void InspectorInstrumentation::consoleCountResetImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::JSGlobalObject* state, const String&amp; label)</span>
 860 {
<span class="line-added"> 861     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
<span class="line-added"> 862         return;</span>
<span class="line-added"> 863 </span>
 864     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 865         consoleAgent-&gt;countReset(state, label);
 866 }
 867 
 868 void InspectorInstrumentation::takeHeapSnapshotImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; title)
 869 {
 870     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 871         consoleAgent-&gt;takeHeapSnapshot(title);
 872 }
 873 
<span class="line-modified"> 874 void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, JSC::JSGlobalObject* exec, const String&amp; label)</span>
 875 {
<span class="line-modified"> 876     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
 877         return;
 878 
 879     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 880         timelineAgent-&gt;time(frame, label);
 881     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 882         consoleAgent-&gt;startTiming(exec, label);
 883 }
 884 
<span class="line-modified"> 885 void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::JSGlobalObject* exec, const String&amp; label)</span>
 886 {
<span class="line-modified"> 887     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
 888         return;
 889 
 890     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 891         consoleAgent-&gt;startTiming(exec, label);
 892 }
 893 
<span class="line-modified"> 894 void InspectorInstrumentation::logConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::JSGlobalObject* exec, const String&amp; label, Ref&lt;Inspector::ScriptArguments&gt;&amp;&amp; arguments)</span>
 895 {
<span class="line-modified"> 896     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
 897         return;
 898 
 899     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 900         consoleAgent-&gt;logTiming(exec, label, WTFMove(arguments));
 901 }
 902 
<span class="line-modified"> 903 void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, JSC::JSGlobalObject* exec, const String&amp; label)</span>
 904 {
<span class="line-modified"> 905     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
 906         return;
 907 
 908     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 909         consoleAgent-&gt;stopTiming(exec, label);
 910     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
 911         timelineAgent-&gt;timeEnd(frame, label);
 912 }
 913 
<span class="line-modified"> 914 void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::JSGlobalObject* exec, const String&amp; label)</span>
 915 {
<span class="line-modified"> 916     if (LIKELY(!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled()))</span>
 917         return;
 918 
 919     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())
 920         consoleAgent-&gt;stopTiming(exec, label);
 921 }
 922 
 923 void InspectorInstrumentation::consoleTimeStampImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)
 924 {
 925     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {
 926         String message;
 927         arguments-&gt;getFirstArgumentAsString(message);
 928         timelineAgent-&gt;didTimeStamp(frame, message);
 929      }
 930 }
 931 
<span class="line-modified"> 932 void InspectorInstrumentation::startProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::JSGlobalObject* exec, const String&amp; title)</span>
 933 {
 934     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())
 935         timelineAgent-&gt;startFromConsole(exec, title);
 936 }
 937 
<span class="line-modified"> 938 void InspectorInstrumentation::stopProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::JSGlobalObject* exec, const String&amp; title)</span>
 939 {
 940     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())
 941         timelineAgent-&gt;stopFromConsole(exec, title);
 942 }
 943 
<span class="line-modified"> 944 void InspectorInstrumentation::consoleStartRecordingCanvasImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context, JSC::JSGlobalObject&amp; exec, JSC::JSObject* options)</span>
 945 {
 946     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 947         canvasAgent-&gt;consoleStartRecordingCanvas(context, exec, options);
 948 }
 949 
<span class="line-added"> 950 void InspectorInstrumentation::consoleStopRecordingCanvasImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context)</span>
<span class="line-added"> 951 {</span>
<span class="line-added"> 952     if (auto* canvasAgent = instrumentingAgents.inspectorCanvasAgent())</span>
<span class="line-added"> 953         canvasAgent-&gt;consoleStopRecordingCanvas(context);</span>
<span class="line-added"> 954 }</span>
<span class="line-added"> 955 </span>
 956 void InspectorInstrumentation::didOpenDatabaseImpl(InstrumentingAgents&amp; instrumentingAgents, Database&amp; database)
 957 {
 958     if (auto* databaseAgent = instrumentingAgents.inspectorDatabaseAgent())
 959         databaseAgent-&gt;didOpenDatabase(database);
 960 }
 961 
 962 void InspectorInstrumentation::didDispatchDOMStorageEventImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; key, const String&amp; oldValue, const String&amp; newValue, StorageType storageType, SecurityOrigin* securityOrigin)
 963 {
 964     if (InspectorDOMStorageAgent* domStorageAgent = instrumentingAgents.inspectorDOMStorageAgent())
 965         domStorageAgent-&gt;didDispatchDOMStorageEvent(key, oldValue, newValue, storageType, securityOrigin);
 966 }
 967 
 968 bool InspectorInstrumentation::shouldWaitForDebuggerOnStartImpl(InstrumentingAgents&amp; instrumentingAgents)
 969 {
 970     if (InspectorWorkerAgent* workerAgent = instrumentingAgents.inspectorWorkerAgent())
 971         return workerAgent-&gt;shouldWaitForDebuggerOnStart();
 972     return false;
 973 }
 974 
 975 void InspectorInstrumentation::workerStartedImpl(InstrumentingAgents&amp; instrumentingAgents, WorkerInspectorProxy* proxy, const URL&amp; url)
</pre>
<hr />
<pre>
1046 
1047 void InspectorInstrumentation::recordCanvasActionImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; canvasRenderingContext, const String&amp; name, std::initializer_list&lt;RecordCanvasActionVariant&gt;&amp;&amp; parameters)
1048 {
1049     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1050         canvasAgent-&gt;recordCanvasAction(canvasRenderingContext, name, WTFMove(parameters));
1051 }
1052 
1053 void InspectorInstrumentation::didFinishRecordingCanvasFrameImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context, bool forceDispatch)
1054 {
1055     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1056         canvasAgent-&gt;didFinishRecordingCanvasFrame(context, forceDispatch);
1057 }
1058 
1059 #if ENABLE(WEBGL)
1060 void InspectorInstrumentation::didEnableExtensionImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLRenderingContextBase&amp; contextWebGLBase, const String&amp; extension)
1061 {
1062     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1063         canvasAgent-&gt;didEnableExtension(contextWebGLBase, extension);
1064 }
1065 
<span class="line-modified">1066 void InspectorInstrumentation::didCreateWebGLProgramImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLRenderingContextBase&amp; contextWebGLBase, WebGLProgram&amp; program)</span>
1067 {
1068     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
<span class="line-modified">1069         canvasAgent-&gt;didCreateWebGLProgram(contextWebGLBase, program);</span>
1070 }
1071 
<span class="line-modified">1072 void InspectorInstrumentation::willDestroyWebGLProgramImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLProgram&amp; program)</span>
1073 {
1074     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
<span class="line-modified">1075         canvasAgent-&gt;willDestroyWebGLProgram(program);</span>
1076 }
1077 
<span class="line-modified">1078 bool InspectorInstrumentation::isWebGLProgramDisabledImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLProgram&amp; program)</span>
1079 {
1080     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
<span class="line-modified">1081         return canvasAgent-&gt;isWebGLProgramDisabled(program);</span>
1082     return false;
1083 }
1084 
<span class="line-modified">1085 bool InspectorInstrumentation::isWebGLProgramHighlightedImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLProgram&amp; program)</span>
1086 {
1087     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
<span class="line-modified">1088         return canvasAgent-&gt;isWebGLProgramHighlighted(program);</span>
1089     return false;
1090 }
1091 #endif
1092 
<span class="line-added">1093 #if ENABLE(WEBGPU)</span>
<span class="line-added">1094 void InspectorInstrumentation::didCreateWebGPUDeviceImpl(InstrumentingAgents&amp; instrumentingAgents, WebGPUDevice&amp; device)</span>
<span class="line-added">1095 {</span>
<span class="line-added">1096     if (auto* canvasAgent = instrumentingAgents.inspectorCanvasAgent())</span>
<span class="line-added">1097         canvasAgent-&gt;didCreateWebGPUDevice(device);</span>
<span class="line-added">1098 }</span>
<span class="line-added">1099 </span>
<span class="line-added">1100 void InspectorInstrumentation::willDestroyWebGPUDeviceImpl(InstrumentingAgents&amp; instrumentingAgents, WebGPUDevice&amp; device)</span>
<span class="line-added">1101 {</span>
<span class="line-added">1102     if (auto* canvasAgent = instrumentingAgents.inspectorCanvasAgent())</span>
<span class="line-added">1103         canvasAgent-&gt;willDestroyWebGPUDevice(device);</span>
<span class="line-added">1104 }</span>
<span class="line-added">1105 </span>
<span class="line-added">1106 void InspectorInstrumentation::willConfigureSwapChainImpl(InstrumentingAgents&amp; instrumentingAgents, GPUCanvasContext&amp; contextGPU, WebGPUSwapChain&amp; newSwapChain)</span>
<span class="line-added">1107 {</span>
<span class="line-added">1108     if (auto* canvasAgent = instrumentingAgents.inspectorCanvasAgent())</span>
<span class="line-added">1109         canvasAgent-&gt;willConfigureSwapChain(contextGPU, newSwapChain);</span>
<span class="line-added">1110 }</span>
<span class="line-added">1111 </span>
<span class="line-added">1112 void InspectorInstrumentation::didCreateWebGPUPipelineImpl(InstrumentingAgents&amp; instrumentingAgents, WebGPUDevice&amp; device, WebGPUPipeline&amp; pipeline)</span>
<span class="line-added">1113 {</span>
<span class="line-added">1114     if (auto* canvasAgent = instrumentingAgents.inspectorCanvasAgent())</span>
<span class="line-added">1115         canvasAgent-&gt;didCreateWebGPUPipeline(device, pipeline);</span>
<span class="line-added">1116 }</span>
<span class="line-added">1117 </span>
<span class="line-added">1118 void InspectorInstrumentation::willDestroyWebGPUPipelineImpl(InstrumentingAgents&amp; instrumentingAgents, WebGPUPipeline&amp; pipeline)</span>
<span class="line-added">1119 {</span>
<span class="line-added">1120     if (auto* canvasAgent = instrumentingAgents.inspectorCanvasAgent())</span>
<span class="line-added">1121         canvasAgent-&gt;willDestroyWebGPUPipeline(pipeline);</span>
<span class="line-added">1122 }</span>
<span class="line-added">1123 </span>
<span class="line-added">1124 InstrumentingAgents* InspectorInstrumentation::instrumentingAgentsForWebGPUDevice(WebGPUDevice&amp; device)</span>
<span class="line-added">1125 {</span>
<span class="line-added">1126     return instrumentingAgentsForContext(device.scriptExecutionContext());</span>
<span class="line-added">1127 }</span>
<span class="line-added">1128 #endif</span>
<span class="line-added">1129 </span>
<span class="line-added">1130 void InspectorInstrumentation::willApplyKeyframeEffectImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; target, KeyframeEffect&amp; effect, ComputedEffectTiming computedTiming)</span>
<span class="line-added">1131 {</span>
<span class="line-added">1132     if (auto* animationAgent = instrumentingAgents.trackingInspectorAnimationAgent())</span>
<span class="line-added">1133         animationAgent-&gt;willApplyKeyframeEffect(target, effect, computedTiming);</span>
<span class="line-added">1134 }</span>
<span class="line-added">1135 </span>
<span class="line-added">1136 void InspectorInstrumentation::didSetWebAnimationEffectImpl(InstrumentingAgents&amp; instrumentingAgents, WebAnimation&amp; animation)</span>
<span class="line-added">1137 {</span>
<span class="line-added">1138     if (auto* animationAgent = instrumentingAgents.enabledInspectorAnimationAgent())</span>
<span class="line-added">1139         animationAgent-&gt;didSetWebAnimationEffect(animation);</span>
<span class="line-added">1140     else if (auto* animationAgent = instrumentingAgents.trackingInspectorAnimationAgent())</span>
<span class="line-added">1141         animationAgent-&gt;didSetWebAnimationEffect(animation);</span>
<span class="line-added">1142 }</span>
<span class="line-added">1143 </span>
<span class="line-added">1144 void InspectorInstrumentation::didChangeWebAnimationEffectTimingImpl(InstrumentingAgents&amp; instrumentingAgents, WebAnimation&amp; animation)</span>
<span class="line-added">1145 {</span>
<span class="line-added">1146     if (auto* animationAgent = instrumentingAgents.enabledInspectorAnimationAgent())</span>
<span class="line-added">1147         animationAgent-&gt;didChangeWebAnimationEffectTiming(animation);</span>
<span class="line-added">1148 }</span>
<span class="line-added">1149 </span>
<span class="line-added">1150 void InspectorInstrumentation::didChangeWebAnimationEffectTargetImpl(InstrumentingAgents&amp; instrumentingAgents, WebAnimation&amp; animation)</span>
<span class="line-added">1151 {</span>
<span class="line-added">1152     if (auto* animationAgent = instrumentingAgents.enabledInspectorAnimationAgent())</span>
<span class="line-added">1153         animationAgent-&gt;didChangeWebAnimationEffectTarget(animation);</span>
<span class="line-added">1154 }</span>
<span class="line-added">1155 </span>
<span class="line-added">1156 void InspectorInstrumentation::didCreateWebAnimationImpl(InstrumentingAgents&amp; instrumentingAgents, WebAnimation&amp; animation)</span>
<span class="line-added">1157 {</span>
<span class="line-added">1158     if (auto* animationAgent = instrumentingAgents.enabledInspectorAnimationAgent())</span>
<span class="line-added">1159         animationAgent-&gt;didCreateWebAnimation(animation);</span>
<span class="line-added">1160 }</span>
<span class="line-added">1161 </span>
<span class="line-added">1162 void InspectorInstrumentation::willDestroyWebAnimationImpl(InstrumentingAgents&amp; instrumentingAgents, WebAnimation&amp; animation)</span>
<span class="line-added">1163 {</span>
<span class="line-added">1164     if (auto* animationAgent = instrumentingAgents.enabledInspectorAnimationAgent())</span>
<span class="line-added">1165         animationAgent-&gt;willDestroyWebAnimation(animation);</span>
<span class="line-added">1166     else if (auto* animationAgent = instrumentingAgents.trackingInspectorAnimationAgent())</span>
<span class="line-added">1167         animationAgent-&gt;willDestroyWebAnimation(animation);</span>
<span class="line-added">1168 }</span>
<span class="line-added">1169 </span>
1170 #if ENABLE(RESOURCE_USAGE)
1171 void InspectorInstrumentation::didHandleMemoryPressureImpl(InstrumentingAgents&amp; instrumentingAgents, Critical critical)
1172 {
1173     if (InspectorMemoryAgent* memoryAgent = instrumentingAgents.inspectorMemoryAgent())
1174         memoryAgent-&gt;didHandleMemoryPressure(critical);
1175 }
1176 #endif
1177 
1178 void InspectorInstrumentation::networkStateChangedImpl(InstrumentingAgents&amp; instrumentingAgents)
1179 {
1180     if (InspectorApplicationCacheAgent* applicationCacheAgent = instrumentingAgents.inspectorApplicationCacheAgent())
1181         applicationCacheAgent-&gt;networkStateChanged();
1182 }
1183 
1184 void InspectorInstrumentation::updateApplicationCacheStatusImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
1185 {
1186     if (auto* applicationCacheAgent = instrumentingAgents.inspectorApplicationCacheAgent())
1187         applicationCacheAgent-&gt;updateApplicationCacheStatus(&amp;frame);
1188 }
1189 
1190 bool InspectorInstrumentation::consoleAgentEnabled(ScriptExecutionContext* scriptExecutionContext)
1191 {
1192     FAST_RETURN_IF_NO_FRONTENDS(false);
1193     if (auto* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext)) {
1194         if (auto* webConsoleAgent = instrumentingAgents-&gt;webConsoleAgent())
1195             return webConsoleAgent-&gt;enabled();
1196     }
1197     return false;
1198 }
1199 
1200 bool InspectorInstrumentation::timelineAgentTracking(ScriptExecutionContext* scriptExecutionContext)
1201 {
1202     FAST_RETURN_IF_NO_FRONTENDS(false);
1203     if (auto* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext))
1204         return instrumentingAgents-&gt;trackingInspectorTimelineAgent();
1205     return false;
1206 }
1207 
1208 void InspectorInstrumentation::didRequestAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
1209 {
<span class="line-modified">1210     if (auto* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
1211         pageDebuggerAgent-&gt;didRequestAnimationFrame(callbackId, document);
1212     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
1213         timelineAgent-&gt;didRequestAnimationFrame(callbackId, document.frame());
1214 }
1215 
1216 void InspectorInstrumentation::didCancelAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
1217 {
<span class="line-modified">1218     if (auto* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
1219         pageDebuggerAgent-&gt;didCancelAnimationFrame(callbackId);
1220     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())
1221         timelineAgent-&gt;didCancelAnimationFrame(callbackId, document.frame());
1222 }
1223 
<span class="line-modified">1224 void InspectorInstrumentation::willFireAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)</span>
1225 {
<span class="line-modified">1226     if (auto* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())</span>
1227         pageDebuggerAgent-&gt;willFireAnimationFrame(callbackId);
<span class="line-modified">1228     if (auto* pageDOMDebuggerAgent = instrumentingAgents.pageDOMDebuggerAgent())</span>
<span class="line-modified">1229         pageDOMDebuggerAgent-&gt;willFireAnimationFrame();</span>
<span class="line-modified">1230     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>



1231         timelineAgent-&gt;willFireAnimationFrame(callbackId, document.frame());



1232 }
1233 
<span class="line-modified">1234 void InspectorInstrumentation::didFireAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents)</span>
1235 {
<span class="line-modified">1236     if (auto* webDebuggerAgent = instrumentingAgents.webDebuggerAgent())</span>
<span class="line-modified">1237         webDebuggerAgent-&gt;didDispatchAsyncCall();</span>
<span class="line-modified">1238     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
1239         timelineAgent-&gt;didFireAnimationFrame();
1240 }
1241 
<span class="line-modified">1242 void InspectorInstrumentation::willFireObserverCallbackImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; callbackType, ScriptExecutionContext&amp; context)</span>
1243 {
<span class="line-modified">1244     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>

1245         timelineAgent-&gt;willFireObserverCallback(callbackType, frameForScriptExecutionContext(&amp;context));



1246 }
1247 
<span class="line-modified">1248 void InspectorInstrumentation::didFireObserverCallbackImpl(InstrumentingAgents&amp; instrumentingAgents)</span>
1249 {
<span class="line-modified">1250     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
1251         timelineAgent-&gt;didFireObserverCallback();
1252 }
1253 
1254 void InspectorInstrumentation::registerInstrumentingAgents(InstrumentingAgents&amp; instrumentingAgents)
1255 {
1256     if (!s_instrumentingAgentsSet)
1257         s_instrumentingAgentsSet = new HashSet&lt;InstrumentingAgents*&gt;();
1258 
1259     s_instrumentingAgentsSet-&gt;add(&amp;instrumentingAgents);
1260 }
1261 
1262 void InspectorInstrumentation::unregisterInstrumentingAgents(InstrumentingAgents&amp; instrumentingAgents)
1263 {
1264     if (!s_instrumentingAgentsSet)
1265         return;
1266 
1267     s_instrumentingAgentsSet-&gt;remove(&amp;instrumentingAgents);
1268     if (s_instrumentingAgentsSet-&gt;isEmpty()) {
1269         delete s_instrumentingAgentsSet;
1270         s_instrumentingAgentsSet = nullptr;
1271     }
1272 }
1273 











1274 InstrumentingAgents* InspectorInstrumentation::instrumentingAgentsForRenderer(RenderObject&amp; renderer)
1275 {
1276     return instrumentingAgentsForFrame(renderer.frame());
1277 }
1278 
1279 void InspectorInstrumentation::layerTreeDidChangeImpl(InstrumentingAgents&amp; instrumentingAgents)
1280 {
1281     if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
1282         layerTreeAgent-&gt;layerTreeDidChange();
1283 }
1284 
1285 void InspectorInstrumentation::renderLayerDestroyedImpl(InstrumentingAgents&amp; instrumentingAgents, const RenderLayer&amp; renderLayer)
1286 {
1287     if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
1288         layerTreeAgent-&gt;renderLayerDestroyed(renderLayer);
1289 }
1290 
<span class="line-added">1291 InstrumentingAgents&amp; InspectorInstrumentation::instrumentingAgentsForWorkerGlobalScope(WorkerGlobalScope&amp; workerGlobalScope)</span>
<span class="line-added">1292 {</span>
<span class="line-added">1293     return workerGlobalScope.inspectorController().m_instrumentingAgents;</span>
<span class="line-added">1294 }</span>
<span class="line-added">1295 </span>
<span class="line-added">1296 InstrumentingAgents&amp; InspectorInstrumentation::instrumentingAgentsForPage(Page&amp; page)</span>
<span class="line-added">1297 {</span>
<span class="line-added">1298     ASSERT(isMainThread());</span>
<span class="line-added">1299     return page.inspectorController().m_instrumentingAgents.get();</span>
<span class="line-added">1300 }</span>
<span class="line-added">1301 </span>
<span class="line-added">1302 InstrumentingAgents* InspectorInstrumentation::instrumentingAgentsForContext(ScriptExecutionContext&amp; context)</span>
<span class="line-added">1303 {</span>
<span class="line-added">1304     if (is&lt;Document&gt;(context))</span>
<span class="line-added">1305         return instrumentingAgentsForPage(downcast&lt;Document&gt;(context).page());</span>
<span class="line-added">1306     if (is&lt;WorkerGlobalScope&gt;(context))</span>
<span class="line-added">1307         return &amp;instrumentingAgentsForWorkerGlobalScope(downcast&lt;WorkerGlobalScope&gt;(context));</span>
<span class="line-added">1308     return nullptr;</span>
<span class="line-added">1309 }</span>
<span class="line-added">1310 </span>
1311 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="InspectorFrontendHost.idl.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorInstrumentation.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>