<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/editing/EditCommand.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2005, 2006, 2007, 2013 Apple, Inc.  All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;EditCommand.h&quot;
 28 
 29 #include &quot;AXObjectCache.h&quot;
 30 #include &quot;CompositeEditCommand.h&quot;
 31 #include &quot;Document.h&quot;
 32 #include &quot;Editing.h&quot;
 33 #include &quot;Editor.h&quot;
 34 #include &quot;Element.h&quot;
 35 #include &quot;Frame.h&quot;
 36 #include &quot;HTMLInputElement.h&quot;
 37 #include &quot;HTMLTextAreaElement.h&quot;
 38 #include &quot;NodeTraversal.h&quot;
 39 
 40 namespace WebCore {
 41 
 42 String inputTypeNameForEditingAction(EditAction action)
 43 {
 44     switch (action) {
 45     case EditAction::Justify:
 46         return &quot;formatJustifyFull&quot;_s;
 47     case EditAction::AlignLeft:
 48         return &quot;formatJustifyLeft&quot;_s;
 49     case EditAction::AlignRight:
 50         return &quot;formatJustifyRight&quot;_s;
 51     case EditAction::Center:
 52         return &quot;formatJustifyCenter&quot;_s;
 53     case EditAction::Subscript:
 54         return &quot;formatSubscript&quot;_s;
 55     case EditAction::Superscript:
 56         return &quot;formatSuperscript&quot;_s;
 57     case EditAction::Underline:
 58         return &quot;formatUnderline&quot;_s;
<a name="1" id="anc1"></a><span class="line-added"> 59     case EditAction::StrikeThrough:</span>
<span class="line-added"> 60         return &quot;formatStrikeThrough&quot;_s;</span>
 61     case EditAction::SetColor:
 62         return &quot;formatFontColor&quot;_s;
 63     case EditAction::DeleteByDrag:
 64         return &quot;deleteByDrag&quot;_s;
 65     case EditAction::Cut:
 66         return &quot;deleteByCut&quot;_s;
 67     case EditAction::Bold:
 68         return &quot;formatBold&quot;_s;
 69     case EditAction::Italics:
 70         return &quot;formatItalic&quot;_s;
 71     case EditAction::Paste:
 72         return &quot;insertFromPaste&quot;_s;
 73     case EditAction::Delete:
 74     case EditAction::TypingDeleteSelection:
 75         return &quot;deleteContent&quot;_s;
 76     case EditAction::TypingDeleteBackward:
 77         return &quot;deleteContentBackward&quot;_s;
 78     case EditAction::TypingDeleteForward:
 79         return &quot;deleteContentForward&quot;_s;
 80     case EditAction::TypingDeleteWordBackward:
 81         return &quot;deleteWordBackward&quot;_s;
 82     case EditAction::TypingDeleteWordForward:
 83         return &quot;deleteWordForward&quot;_s;
 84     case EditAction::TypingDeleteLineBackward:
 85         return &quot;deleteHardLineBackward&quot;_s;
 86     case EditAction::TypingDeleteLineForward:
 87         return &quot;deleteHardLineForward&quot;_s;
 88     case EditAction::TypingDeletePendingComposition:
 89         return &quot;deleteCompositionText&quot;_s;
 90     case EditAction::TypingDeleteFinalComposition:
 91         return &quot;deleteByComposition&quot;_s;
 92     case EditAction::Insert:
 93     case EditAction::TypingInsertText:
 94         return &quot;insertText&quot;_s;
 95     case EditAction::InsertReplacement:
 96         return &quot;insertReplacementText&quot;_s;
 97     case EditAction::InsertFromDrop:
 98         return &quot;insertFromDrop&quot;_s;
 99     case EditAction::TypingInsertLineBreak:
100         return &quot;insertLineBreak&quot;_s;
101     case EditAction::TypingInsertParagraph:
102         return &quot;insertParagraph&quot;_s;
103     case EditAction::InsertOrderedList:
104         return &quot;insertOrderedList&quot;_s;
105     case EditAction::InsertUnorderedList:
106         return &quot;insertUnorderedList&quot;_s;
107     case EditAction::TypingInsertPendingComposition:
108         return &quot;insertCompositionText&quot;_s;
109     case EditAction::TypingInsertFinalComposition:
110         return &quot;insertFromComposition&quot;_s;
111     case EditAction::Indent:
112         return &quot;formatIndent&quot;_s;
113     case EditAction::Outdent:
114         return &quot;formatOutdent&quot;_s;
115     case EditAction::SetInlineWritingDirection:
116         return &quot;formatSetInlineTextDirection&quot;_s;
117     case EditAction::SetBlockWritingDirection:
118         return &quot;formatSetBlockTextDirection&quot;_s;
<a name="2" id="anc2"></a><span class="line-added">119     case EditAction::CreateLink:</span>
<span class="line-added">120         return &quot;insertLink&quot;_s;</span>
121     default:
122         return emptyString();
123     }
124 }
125 
126 EditCommand::EditCommand(Document&amp; document, EditAction editingAction)
127     : m_document(document)
128     , m_editingAction(editingAction)
129 {
130     ASSERT(document.frame());
131     setStartingSelection(m_document-&gt;frame()-&gt;selection().selection());
132     setEndingSelection(m_startingSelection);
133 }
134 
135 EditCommand::EditCommand(Document&amp; document, const VisibleSelection&amp; startingSelection, const VisibleSelection&amp; endingSelection)
136     : m_document(document)
137 {
138     ASSERT(document.frame());
139     setStartingSelection(startingSelection);
140     setEndingSelection(endingSelection);
141 }
142 
143 EditCommand::~EditCommand() = default;
144 
145 Frame&amp; EditCommand::frame()
146 {
147     ASSERT(document().frame());
148     return *document().frame();
149 }
150 
151 const Frame&amp; EditCommand::frame() const
152 {
153     ASSERT(document().frame());
154     return *document().frame();
155 }
156 
157 EditAction EditCommand::editingAction() const
158 {
159     return m_editingAction;
160 }
161 
162 static inline EditCommandComposition* compositionIfPossible(EditCommand* command)
163 {
164     if (!command-&gt;isCompositeEditCommand())
165         return 0;
166     return toCompositeEditCommand(command)-&gt;composition();
167 }
168 
169 bool EditCommand::isEditingTextAreaOrTextInput() const
170 {
171     auto* frame = m_document-&gt;frame();
172     if (!frame)
173         return false;
174 
175     auto* container = frame-&gt;selection().selection().start().containerNode();
176     if (!container)
177         return false;
178 
179     auto* ancestor = container-&gt;shadowHost();
180     if (!ancestor)
181         return false;
182 
183     return is&lt;HTMLTextAreaElement&gt;(*ancestor) || (is&lt;HTMLInputElement&gt;(*ancestor) &amp;&amp; downcast&lt;HTMLInputElement&gt;(*ancestor).isText());
184 }
185 
186 void EditCommand::setStartingSelection(const VisibleSelection&amp; s)
187 {
188     for (EditCommand* cmd = this; ; cmd = cmd-&gt;m_parent) {
189         if (auto* composition = compositionIfPossible(cmd))
190             composition-&gt;setStartingSelection(s);
191         cmd-&gt;m_startingSelection = s;
192         if (!cmd-&gt;m_parent || cmd-&gt;m_parent-&gt;isFirstCommand(cmd))
193             break;
194     }
195 }
196 
197 void EditCommand::setEndingSelection(const VisibleSelection &amp;s)
198 {
199     for (EditCommand* cmd = this; cmd; cmd = cmd-&gt;m_parent) {
200         if (auto* composition = compositionIfPossible(cmd))
201             composition-&gt;setEndingSelection(s);
202         cmd-&gt;m_endingSelection = s;
203     }
204 }
205 
206 void EditCommand::setParent(CompositeEditCommand* parent)
207 {
208     ASSERT((parent &amp;&amp; !m_parent) || (!parent &amp;&amp; m_parent));
209     m_parent = parent;
210     if (parent) {
211         m_startingSelection = parent-&gt;m_endingSelection;
212         m_endingSelection = parent-&gt;m_endingSelection;
213     }
214 }
215 
216 void EditCommand::postTextStateChangeNotification(AXTextEditType type, const String&amp; text)
217 {
218     if (!AXObjectCache::accessibilityEnabled())
219         return;
220     postTextStateChangeNotification(type, text, frame().selection().selection().start());
221 }
222 
223 void EditCommand::postTextStateChangeNotification(AXTextEditType type, const String&amp; text, const VisiblePosition&amp; position)
224 {
225     if (!AXObjectCache::accessibilityEnabled())
226         return;
227     if (!text.length())
228         return;
229     auto* cache = document().existingAXObjectCache();
230     if (!cache)
231         return;
232     auto* node = highestEditableRoot(position.deepEquivalent(), HasEditableAXRole);
233     cache-&gt;postTextStateChangeNotification(node, type, text, position);
234 }
235 
236 SimpleEditCommand::SimpleEditCommand(Document&amp; document, EditAction editingAction)
237     : EditCommand(document, editingAction)
238 {
239 }
240 
241 void SimpleEditCommand::doReapply()
242 {
243     doApply();
244 }
245 
246 #ifndef NDEBUG
247 void SimpleEditCommand::addNodeAndDescendants(Node* startNode, HashSet&lt;Node*&gt;&amp; nodes)
248 {
249     for (Node* node = startNode; node; node = NodeTraversal::next(*node, startNode))
250         nodes.add(node);
251 }
252 #endif
253 
254 } // namespace WebCore
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>