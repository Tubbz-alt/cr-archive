<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/API/JSValueRef.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSTypedArray.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSVirtualMachineInternal.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/API/JSValueRef.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 59,14 ***</span>
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return kJSTypeUndefined;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     JSValue jsValue = toJS(exec, value);</span>
  
      if (jsValue.isUndefined())
          return kJSTypeUndefined;
      if (jsValue.isNull())
          return kJSTypeNull;
<span class="line-new-header">--- 59,14 ---</span>
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return kJSTypeUndefined;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     JSValue jsValue = toJS(globalObject, value);</span>
  
      if (jsValue.isUndefined())
          return kJSTypeUndefined;
      if (jsValue.isNull())
          return kJSTypeNull;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 86,134 ***</span>
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toJS(exec, value).isUndefined();</span>
  }
  
  bool JSValueIsNull(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toJS(exec, value).isNull();</span>
  }
  
  bool JSValueIsBoolean(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toJS(exec, value).isBoolean();</span>
  }
  
  bool JSValueIsNumber(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toJS(exec, value).isNumber();</span>
  }
  
  bool JSValueIsString(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toJS(exec, value).isString();</span>
  }
  
  bool JSValueIsObject(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toJS(exec, value).isObject();</span>
  }
  
  bool JSValueIsSymbol(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toJS(exec, value).isSymbol();</span>
  }
  
  bool JSValueIsArray(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toJS(exec, value).inherits&lt;JSArray&gt;(vm);</span>
  }
  
  bool JSValueIsDate(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toJS(exec, value).inherits&lt;DateInstance&gt;(vm);</span>
  }
  
  bool JSValueIsObjectOfClass(JSContextRef ctx, JSValueRef value, JSClassRef jsClass)
  {
      if (!ctx || !jsClass) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     JSValue jsValue = toJS(exec, value);</span>
  
      if (JSObject* o = jsValue.getObject()) {
          if (o-&gt;inherits&lt;JSProxy&gt;(vm))
              o = jsCast&lt;JSProxy*&gt;(o)-&gt;target();
  
          if (o-&gt;inherits&lt;JSCallbackObject&lt;JSGlobalObject&gt;&gt;(vm))
              return jsCast&lt;JSCallbackObject&lt;JSGlobalObject&gt;*&gt;(o)-&gt;inherits(jsClass);
<span class="line-modified">!         if (o-&gt;inherits&lt;JSCallbackObject&lt;JSDestructibleObject&gt;&gt;(vm))</span>
<span class="line-modified">!             return jsCast&lt;JSCallbackObject&lt;JSDestructibleObject&gt;*&gt;(o)-&gt;inherits(jsClass);</span>
  #if JSC_OBJC_API_ENABLED
          if (o-&gt;inherits&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;&gt;(vm))
              return jsCast&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;*&gt;(o)-&gt;inherits(jsClass);
  #endif
      }
<span class="line-new-header">--- 86,134 ---</span>
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toJS(globalObject, value).isUndefined();</span>
  }
  
  bool JSValueIsNull(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toJS(globalObject, value).isNull();</span>
  }
  
  bool JSValueIsBoolean(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toJS(globalObject, value).isBoolean();</span>
  }
  
  bool JSValueIsNumber(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toJS(globalObject, value).isNumber();</span>
  }
  
  bool JSValueIsString(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toJS(globalObject, value).isString();</span>
  }
  
  bool JSValueIsObject(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toJS(globalObject, value).isObject();</span>
  }
  
  bool JSValueIsSymbol(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toJS(globalObject, value).isSymbol();</span>
  }
  
  bool JSValueIsArray(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toJS(globalObject, value).inherits&lt;JSArray&gt;(vm);</span>
  }
  
  bool JSValueIsDate(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toJS(globalObject, value).inherits&lt;DateInstance&gt;(vm);</span>
  }
  
  bool JSValueIsObjectOfClass(JSContextRef ctx, JSValueRef value, JSClassRef jsClass)
  {
      if (!ctx || !jsClass) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     JSValue jsValue = toJS(globalObject, value);</span>
  
      if (JSObject* o = jsValue.getObject()) {
          if (o-&gt;inherits&lt;JSProxy&gt;(vm))
              o = jsCast&lt;JSProxy*&gt;(o)-&gt;target();
  
          if (o-&gt;inherits&lt;JSCallbackObject&lt;JSGlobalObject&gt;&gt;(vm))
              return jsCast&lt;JSCallbackObject&lt;JSGlobalObject&gt;*&gt;(o)-&gt;inherits(jsClass);
<span class="line-modified">!         if (o-&gt;inherits&lt;JSCallbackObject&lt;JSNonFinalObject&gt;&gt;(vm))</span>
<span class="line-modified">!             return jsCast&lt;JSCallbackObject&lt;JSNonFinalObject&gt;*&gt;(o)-&gt;inherits(jsClass);</span>
  #if JSC_OBJC_API_ENABLED
          if (o-&gt;inherits&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;&gt;(vm))
              return jsCast&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;*&gt;(o)-&gt;inherits(jsClass);
  #endif
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 224,260 ***</span>
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue jsA = toJS(exec, a);</span>
<span class="line-modified">!     JSValue jsB = toJS(exec, b);</span>
  
<span class="line-modified">!     bool result = JSValue::equal(exec, jsA, jsB); // false if an exception is thrown</span>
<span class="line-modified">!     handleExceptionIfNeeded(scope, exec, exception);</span>
  
      return result;
  }
  
  bool JSValueIsStrictEqual(JSContextRef ctx, JSValueRef a, JSValueRef b)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     JSValue jsA = toJS(exec, a);</span>
<span class="line-modified">!     JSValue jsB = toJS(exec, b);</span>
  
<span class="line-modified">!     return JSValue::strictEqual(exec, jsA, jsB);</span>
  }
  
  bool JSValueIsInstanceOfConstructor(JSContextRef ctx, JSValueRef value, JSObjectRef constructor, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue jsValue = toJS(exec, value);</span>
  
      JSObject* jsConstructor = toJS(constructor);
      if (!jsConstructor-&gt;structure(vm)-&gt;typeInfo().implementsHasInstance())
          return false;
<span class="line-modified">!     bool result = jsConstructor-&gt;hasInstance(exec, jsValue); // false if an exception is thrown</span>
<span class="line-modified">!     handleExceptionIfNeeded(scope, exec, exception);</span>
      return result;
  }
  
  JSValueRef JSValueMakeUndefined(JSContextRef ctx)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toRef(exec, jsUndefined());</span>
  }
  
  JSValueRef JSValueMakeNull(JSContextRef ctx)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toRef(exec, jsNull());</span>
  }
  
  JSValueRef JSValueMakeBoolean(JSContextRef ctx, bool value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toRef(exec, jsBoolean(value));</span>
  }
  
  JSValueRef JSValueMakeNumber(JSContextRef ctx, double value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     return toRef(exec, jsNumber(purifyNaN(value)));</span>
  }
  
  JSValueRef JSValueMakeSymbol(JSContextRef ctx, JSStringRef description)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return nullptr;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
      if (!description)
<span class="line-modified">!         return toRef(exec, Symbol::create(vm));</span>
<span class="line-modified">!     return toRef(exec, Symbol::createWithDescription(vm, description-&gt;string()));</span>
  }
  
  JSValueRef JSValueMakeString(JSContextRef ctx, JSStringRef string)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      JSLockHolder locker(vm);
  
<span class="line-modified">!     return toRef(exec, jsString(vm, string ? string-&gt;string() : String()));</span>
  }
  
  JSValueRef JSValueMakeFromJSONString(JSContextRef ctx, JSStringRef string)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
      String str = string-&gt;string();
      unsigned length = str.length();
      if (!length || str.is8Bit()) {
<span class="line-modified">!         LiteralParser&lt;LChar&gt; parser(exec, str.characters8(), length, StrictJSON);</span>
<span class="line-modified">!         return toRef(exec, parser.tryLiteralParse());</span>
      }
<span class="line-modified">!     LiteralParser&lt;UChar&gt; parser(exec, str.characters16(), length, StrictJSON);</span>
<span class="line-modified">!     return toRef(exec, parser.tryLiteralParse());</span>
  }
  
  JSStringRef JSValueCreateJSONString(JSContextRef ctx, JSValueRef apiValue, unsigned indent, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue value = toJS(exec, apiValue);</span>
<span class="line-modified">!     String result = JSONStringify(exec, value, indent);</span>
      if (exception)
          *exception = 0;
<span class="line-modified">!     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
          return 0;
      return OpaqueJSString::tryCreate(result).leakRef();
  }
  
  bool JSValueToBoolean(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     JSValue jsValue = toJS(exec, value);</span>
<span class="line-modified">!     return jsValue.toBoolean(exec);</span>
  }
  
  double JSValueToNumber(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return PNaN;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue jsValue = toJS(exec, value);</span>
  
<span class="line-modified">!     double number = jsValue.toNumber(exec);</span>
<span class="line-modified">!     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
          number = PNaN;
      return number;
  }
  
  JSStringRef JSValueToStringCopy(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue jsValue = toJS(exec, value);</span>
  
<span class="line-modified">!     auto stringRef(OpaqueJSString::tryCreate(jsValue.toWTFString(exec)));</span>
<span class="line-modified">!     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
          stringRef = nullptr;
      return stringRef.leakRef();
  }
  
  JSObjectRef JSValueToObject(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue jsValue = toJS(exec, value);</span>
  
<span class="line-modified">!     JSObjectRef objectRef = toRef(jsValue.toObject(exec));</span>
<span class="line-modified">!     if (handleExceptionIfNeeded(scope, exec, exception) == ExceptionStatus::DidThrow)</span>
          objectRef = 0;
      return objectRef;
  }
  
  void JSValueProtect(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return;
      }
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     JSValue jsValue = toJSForGC(exec, value);</span>
      gcProtect(jsValue);
  }
  
  void JSValueUnprotect(JSContextRef ctx, JSValueRef value)
  {
<span class="line-modified">!     ExecState* exec = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(exec);</span>
  
<span class="line-modified">!     JSValue jsValue = toJSForGC(exec, value);</span>
      gcUnprotect(jsValue);
  }
<span class="line-new-header">--- 224,260 ---</span>
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue jsA = toJS(globalObject, a);</span>
<span class="line-modified">!     JSValue jsB = toJS(globalObject, b);</span>
  
<span class="line-modified">!     bool result = JSValue::equal(globalObject, jsA, jsB); // false if an exception is thrown</span>
<span class="line-modified">!     handleExceptionIfNeeded(scope, ctx, exception);</span>
  
      return result;
  }
  
  bool JSValueIsStrictEqual(JSContextRef ctx, JSValueRef a, JSValueRef b)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     JSValue jsA = toJS(globalObject, a);</span>
<span class="line-modified">!     JSValue jsB = toJS(globalObject, b);</span>
  
<span class="line-modified">!     return JSValue::strictEqual(globalObject, jsA, jsB);</span>
  }
  
  bool JSValueIsInstanceOfConstructor(JSContextRef ctx, JSValueRef value, JSObjectRef constructor, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue jsValue = toJS(globalObject, value);</span>
  
      JSObject* jsConstructor = toJS(constructor);
      if (!jsConstructor-&gt;structure(vm)-&gt;typeInfo().implementsHasInstance())
          return false;
<span class="line-modified">!     bool result = jsConstructor-&gt;hasInstance(globalObject, jsValue); // false if an exception is thrown</span>
<span class="line-modified">!     handleExceptionIfNeeded(scope, ctx, exception);</span>
      return result;
  }
  
  JSValueRef JSValueMakeUndefined(JSContextRef ctx)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toRef(globalObject, jsUndefined());</span>
  }
  
  JSValueRef JSValueMakeNull(JSContextRef ctx)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toRef(globalObject, jsNull());</span>
  }
  
  JSValueRef JSValueMakeBoolean(JSContextRef ctx, bool value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toRef(globalObject, jsBoolean(value));</span>
  }
  
  JSValueRef JSValueMakeNumber(JSContextRef ctx, double value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     return toRef(globalObject, jsNumber(purifyNaN(value)));</span>
  }
  
  JSValueRef JSValueMakeSymbol(JSContextRef ctx, JSStringRef description)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return nullptr;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
      if (!description)
<span class="line-modified">!         return toRef(globalObject, Symbol::create(vm));</span>
<span class="line-modified">!     return toRef(globalObject, Symbol::createWithDescription(vm, description-&gt;string()));</span>
  }
  
  JSValueRef JSValueMakeString(JSContextRef ctx, JSStringRef string)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
  
<span class="line-modified">!     return toRef(globalObject, jsString(vm, string ? string-&gt;string() : String()));</span>
  }
  
  JSValueRef JSValueMakeFromJSONString(JSContextRef ctx, JSStringRef string)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
      String str = string-&gt;string();
      unsigned length = str.length();
      if (!length || str.is8Bit()) {
<span class="line-modified">!         LiteralParser&lt;LChar&gt; parser(globalObject, str.characters8(), length, StrictJSON);</span>
<span class="line-modified">!         return toRef(globalObject, parser.tryLiteralParse());</span>
      }
<span class="line-modified">!     LiteralParser&lt;UChar&gt; parser(globalObject, str.characters16(), length, StrictJSON);</span>
<span class="line-modified">!     return toRef(globalObject, parser.tryLiteralParse());</span>
  }
  
  JSStringRef JSValueCreateJSONString(JSContextRef ctx, JSValueRef apiValue, unsigned indent, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue value = toJS(globalObject, apiValue);</span>
<span class="line-modified">!     String result = JSONStringify(globalObject, value, indent);</span>
      if (exception)
          *exception = 0;
<span class="line-modified">!     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
          return 0;
      return OpaqueJSString::tryCreate(result).leakRef();
  }
  
  bool JSValueToBoolean(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return false;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     JSValue jsValue = toJS(globalObject, value);</span>
<span class="line-modified">!     return jsValue.toBoolean(globalObject);</span>
  }
  
  double JSValueToNumber(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return PNaN;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue jsValue = toJS(globalObject, value);</span>
  
<span class="line-modified">!     double number = jsValue.toNumber(globalObject);</span>
<span class="line-modified">!     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
          number = PNaN;
      return number;
  }
  
  JSStringRef JSValueToStringCopy(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue jsValue = toJS(globalObject, value);</span>
  
<span class="line-modified">!     auto stringRef(OpaqueJSString::tryCreate(jsValue.toWTFString(globalObject)));</span>
<span class="line-modified">!     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
          stringRef = nullptr;
      return stringRef.leakRef();
  }
  
  JSObjectRef JSValueToObject(JSContextRef ctx, JSValueRef value, JSValueRef* exception)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return 0;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      JSLockHolder locker(vm);
      auto scope = DECLARE_CATCH_SCOPE(vm);
  
<span class="line-modified">!     JSValue jsValue = toJS(globalObject, value);</span>
  
<span class="line-modified">!     JSObjectRef objectRef = toRef(jsValue.toObject(globalObject));</span>
<span class="line-modified">!     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
          objectRef = 0;
      return objectRef;
  }
  
  void JSValueProtect(JSContextRef ctx, JSValueRef value)
  {
      if (!ctx) {
          ASSERT_NOT_REACHED();
          return;
      }
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     JSValue jsValue = toJSForGC(globalObject, value);</span>
      gcProtect(jsValue);
  }
  
  void JSValueUnprotect(JSContextRef ctx, JSValueRef value)
  {
<span class="line-modified">!     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">!     JSLockHolder locker(globalObject);</span>
  
<span class="line-modified">!     JSValue jsValue = toJSForGC(globalObject, value);</span>
      gcUnprotect(jsValue);
  }
</pre>
<center><a href="JSTypedArray.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSVirtualMachineInternal.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>