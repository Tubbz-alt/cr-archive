<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorFrontendClientLocal.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InspectorFrontendClient.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorFrontendClientLocal.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorFrontendClientLocal.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -79,47 +79,58 @@</span>
      void dispatch(const String&amp; message)
      {
          ASSERT_ARG(message, !message.isEmpty());
  
          m_messages.append(message);
<span class="udiff-line-modified-removed">-         if (!m_timer.isActive())</span>
<span class="udiff-line-removed">-             m_timer.startOneShot(0_s);</span>
<span class="udiff-line-modified-added">+         scheduleOneShot();</span>
      }
  
      void reset()
      {
          m_messages.clear();
<span class="udiff-line-removed">-         m_timer.stop();</span>
          m_inspectedPageController = nullptr;
      }
  
<span class="udiff-line-modified-removed">-     void timerFired()</span>
<span class="udiff-line-modified-added">+ private:</span>
<span class="udiff-line-added">+     InspectorBackendDispatchTask(InspectorController* inspectedPageController)</span>
<span class="udiff-line-added">+         : m_inspectedPageController(inspectedPageController)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         ASSERT_ARG(inspectedPageController, inspectedPageController);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     void scheduleOneShot()</span>
      {
<span class="udiff-line-modified-removed">-         ASSERT(m_inspectedPageController);</span>
<span class="udiff-line-modified-added">+         if (m_hasScheduledTask)</span>
<span class="udiff-line-added">+             return;</span>
<span class="udiff-line-added">+         m_hasScheduledTask = true;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // The frontend can be closed and destroy the owning frontend client before or in the</span>
<span class="udiff-line-added">+         // process of dispatching the task, so keep a protector reference here.</span>
<span class="udiff-line-added">+         RunLoop::current().dispatch([this, protectedThis = makeRef(*this)] {</span>
<span class="udiff-line-added">+             m_hasScheduledTask = false;</span>
<span class="udiff-line-added">+             dispatchOneMessage();</span>
<span class="udiff-line-added">+         });</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">-         // Dispatching a message can possibly close the frontend and destroy</span>
<span class="udiff-line-modified-removed">-         // the owning frontend client, so keep a protector reference here.</span>
<span class="udiff-line-modified-removed">-         Ref&lt;InspectorBackendDispatchTask&gt; protectedThis(*this);</span>
<span class="udiff-line-modified-added">+     void dispatchOneMessage()</span>
<span class="udiff-line-modified-added">+     {</span>
<span class="udiff-line-modified-added">+         // Owning frontend client may have been destroyed after the task was scheduled.</span>
<span class="udiff-line-added">+         if (!m_inspectedPageController) {</span>
<span class="udiff-line-added">+             ASSERT(m_messages.isEmpty());</span>
<span class="udiff-line-added">+             return;</span>
<span class="udiff-line-added">+         }</span>
  
          if (!m_messages.isEmpty())
              m_inspectedPageController-&gt;dispatchMessageFromFrontend(m_messages.takeFirst());
  
          if (!m_messages.isEmpty() &amp;&amp; m_inspectedPageController)
<span class="udiff-line-modified-removed">-             m_timer.startOneShot(0_s);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- private:</span>
<span class="udiff-line-removed">-     InspectorBackendDispatchTask(InspectorController* inspectedPageController)</span>
<span class="udiff-line-removed">-         : m_inspectedPageController(inspectedPageController)</span>
<span class="udiff-line-removed">-         , m_timer(*this, &amp;InspectorBackendDispatchTask::timerFired)</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-         ASSERT_ARG(inspectedPageController, inspectedPageController);</span>
<span class="udiff-line-modified-added">+             scheduleOneShot();</span>
      }
  
      InspectorController* m_inspectedPageController { nullptr };
<span class="udiff-line-removed">-     Timer m_timer;</span>
      Deque&lt;String&gt; m_messages;
<span class="udiff-line-added">+     bool m_hasScheduledTask { false };</span>
  };
  
  String InspectorFrontendClientLocal::Settings::getProperty(const String&amp;)
  {
      return String();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -407,22 +418,22 @@</span>
  }
  
  bool InspectorFrontendClientLocal::evaluateAsBoolean(const String&amp; expression)
  {
      auto&amp; state = *mainWorldExecState(&amp;m_frontendPage-&gt;mainFrame());
<span class="udiff-line-modified-removed">-     return m_frontendPage-&gt;mainFrame().script().executeScript(expression).toWTFString(&amp;state) == &quot;true&quot;;</span>
<span class="udiff-line-modified-added">+     return m_frontendPage-&gt;mainFrame().script().executeScriptIgnoringException(expression).toWTFString(&amp;state) == &quot;true&quot;;</span>
  }
  
  void InspectorFrontendClientLocal::evaluateOnLoad(const String&amp; expression)
  {
      if (!m_frontendLoaded) {
          m_evaluateOnLoad.append(expression);
          return;
      }
  
      JSC::SuspendExceptionScope scope(&amp;m_frontendPage-&gt;inspectorController().vm());
<span class="udiff-line-modified-removed">-     m_frontendPage-&gt;mainFrame().script().evaluate(ScriptSourceCode(expression));</span>
<span class="udiff-line-modified-added">+     m_frontendPage-&gt;mainFrame().script().evaluateIgnoringException(ScriptSourceCode(expression));</span>
  }
  
  Page* InspectorFrontendClientLocal::inspectedPage() const
  {
      if (!m_inspectedPageController)
</pre>
<center><a href="InspectorFrontendClient.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorFrontendClientLocal.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>