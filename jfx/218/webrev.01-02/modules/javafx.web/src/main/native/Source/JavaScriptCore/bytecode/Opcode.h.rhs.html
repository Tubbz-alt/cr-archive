<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/Opcode.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2008, 2009, 2013, 2014 Apple Inc. All rights reserved.
  3  * Copyright (C) 2008 Cameron Zwarich &lt;cwzwarich@uwaterloo.ca&gt;
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  *
  9  * 1.  Redistributions of source code must retain the above copyright
 10  *     notice, this list of conditions and the following disclaimer.
 11  * 2.  Redistributions in binary form must reproduce the above copyright
 12  *     notice, this list of conditions and the following disclaimer in the
 13  *     documentation and/or other materials provided with the distribution.
 14  * 3.  Neither the name of Apple Inc. (&quot;Apple&quot;) nor the names of
 15  *     its contributors may be used to endorse or promote products derived
 16  *     from this software without specific prior written permission.
 17  *
 18  * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 19  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 20  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 21  * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 22  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 23  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 24  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 25  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 26  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 27  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 28  */
 29 
 30 #pragma once
 31 
 32 #include &quot;Bytecodes.h&quot;
 33 #include &quot;LLIntOpcode.h&quot;
 34 
 35 #include &lt;algorithm&gt;
 36 #include &lt;string.h&gt;
 37 
 38 #include &lt;wtf/Assertions.h&gt;
<a name="1" id="anc1"></a><span class="line-added"> 39 #include &lt;wtf/MathExtras.h&gt;</span>
 40 
 41 namespace JSC {
 42 
 43 #define FOR_EACH_CORE_OPCODE_ID_WITH_EXTENSION(macro, extension__) \
 44     FOR_EACH_BYTECODE_ID(macro) \
 45     extension__
 46 
 47 #define FOR_EACH_CORE_OPCODE_ID(macro) \
 48     FOR_EACH_CORE_OPCODE_ID_WITH_EXTENSION(macro, /* No extension */ )
 49 
 50 #define FOR_EACH_OPCODE_ID(macro) \
 51     FOR_EACH_CORE_OPCODE_ID_WITH_EXTENSION( \
 52         macro, \
 53         FOR_EACH_LLINT_OPCODE_EXTENSION(macro) \
 54     )
 55 
 56 
<a name="2" id="anc2"></a>
 57 #if ENABLE(C_LOOP)
 58 const int numOpcodeIDs = NUMBER_OF_BYTECODE_IDS + NUMBER_OF_CLOOP_BYTECODE_HELPER_IDS + NUMBER_OF_BYTECODE_HELPER_IDS;
 59 #else
 60 const int numOpcodeIDs = NUMBER_OF_BYTECODE_IDS + NUMBER_OF_BYTECODE_HELPER_IDS;
 61 #endif
 62 
<a name="3" id="anc3"></a><span class="line-added"> 63 constexpr int numWasmOpcodeIDs = NUMBER_OF_WASM_IDS + NUMBER_OF_BYTECODE_HELPER_IDS;</span>
<span class="line-added"> 64 </span>
 65 #define OPCODE_ID_ENUM(opcode, length) opcode,
 66     enum OpcodeID : unsigned { FOR_EACH_OPCODE_ID(OPCODE_ID_ENUM) };
<a name="4" id="anc4"></a><span class="line-added"> 67     enum WasmOpcodeID : unsigned { FOR_EACH_WASM_ID(OPCODE_ID_ENUM) };</span>
 68 #undef OPCODE_ID_ENUM
 69 
 70 #if ENABLE(C_LOOP) &amp;&amp; !HAVE(COMPUTED_GOTO)
 71 
 72 #define OPCODE_ID_ENUM(opcode, length) opcode##_wide16 = numOpcodeIDs + opcode,
 73     enum OpcodeIDWide16 : unsigned { FOR_EACH_OPCODE_ID(OPCODE_ID_ENUM) };
<a name="5" id="anc5"></a><span class="line-added"> 74     enum WasmOpcodeIDWide16 : unsigned { FOR_EACH_WASM_ID(OPCODE_ID_ENUM) };</span>
 75 #undef OPCODE_ID_ENUM
 76 
 77 #define OPCODE_ID_ENUM(opcode, length) opcode##_wide32 = numOpcodeIDs * 2 + opcode,
 78     enum OpcodeIDWide32 : unsigned { FOR_EACH_OPCODE_ID(OPCODE_ID_ENUM) };
<a name="6" id="anc6"></a><span class="line-added"> 79     enum WasmOpcodeIDWide32 : unsigned { FOR_EACH_WASM_ID(OPCODE_ID_ENUM) };</span>
 80 #undef OPCODE_ID_ENUM
 81 #endif
 82 
 83 extern const unsigned opcodeLengths[];
<a name="7" id="anc7"></a><span class="line-added"> 84 extern const unsigned wasmOpcodeLengths[];</span>
 85 
 86 #define OPCODE_ID_LENGTHS(id, length) const int id##_length = length;
 87     FOR_EACH_OPCODE_ID(OPCODE_ID_LENGTHS);
<a name="8" id="anc8"></a><span class="line-added"> 88     FOR_EACH_WASM_ID(OPCODE_ID_LENGTHS);</span>
 89 #undef OPCODE_ID_LENGTHS
 90 
<a name="9" id="anc9"></a><span class="line-added"> 91 static constexpr unsigned maxJSOpcodeLength = /* Opcode */ 1 + /* Wide32 Opcode */ 1 + /* Operands */ (MAX_LENGTH_OF_BYTECODE_IDS - 1) * 4;</span>
<span class="line-added"> 92 static constexpr unsigned maxWasmOpcodeLength = /* Opcode */ 1 + /* Wide32 Opcode */ 1 + /* Operands */ (MAX_LENGTH_OF_WASM_IDS - 1) * 4;</span>
<span class="line-added"> 93 static constexpr unsigned maxOpcodeLength = std::max(maxJSOpcodeLength, maxWasmOpcodeLength);</span>
<span class="line-added"> 94 static constexpr unsigned bitWidthForMaxOpcodeLength = WTF::getMSBSetConstexpr(maxOpcodeLength) + 1;</span>
<span class="line-added"> 95 </span>
 96 #define FOR_EACH_OPCODE_WITH_VALUE_PROFILE(macro) \
 97     macro(OpCallVarargs) \
 98     macro(OpTailCallVarargs) \
 99     macro(OpTailCallForwardArguments) \
100     macro(OpConstructVarargs) \
101     macro(OpGetByVal) \
102     macro(OpGetDirectPname) \
103     macro(OpGetById) \
104     macro(OpGetByIdWithThis) \
105     macro(OpTryGetById) \
106     macro(OpGetByIdDirect) \
107     macro(OpGetByValWithThis) \
108     macro(OpGetFromArguments) \
109     macro(OpToNumber) \
<a name="10" id="anc10"></a><span class="line-added">110     macro(OpToNumeric) \</span>
111     macro(OpToObject) \
112     macro(OpGetArgument) \
<a name="11" id="anc11"></a><span class="line-added">113     macro(OpGetInternalField) \</span>
114     macro(OpToThis) \
115     macro(OpCall) \
116     macro(OpTailCall) \
117     macro(OpCallEval) \
118     macro(OpConstruct) \
119     macro(OpGetFromScope) \
120     macro(OpBitand) \
121     macro(OpBitor) \
122     macro(OpBitnot) \
123     macro(OpBitxor) \
124     macro(OpLshift) \
<a name="12" id="anc12"></a><span class="line-added">125     macro(OpRshift) \</span>
126 
127 #define FOR_EACH_OPCODE_WITH_ARRAY_PROFILE(macro) \
128     macro(OpHasIndexedProperty) \
129     macro(OpCallVarargs) \
130     macro(OpTailCallVarargs) \
131     macro(OpTailCallForwardArguments) \
132     macro(OpConstructVarargs) \
133     macro(OpGetByVal) \
134     macro(OpInByVal) \
135     macro(OpPutByVal) \
136     macro(OpPutByValDirect) \
137 
138 #define FOR_EACH_OPCODE_WITH_ARRAY_ALLOCATION_PROFILE(macro) \
139     macro(OpNewArray) \
140     macro(OpNewArrayWithSize) \
141     macro(OpNewArrayBuffer) \
142 
143 #define FOR_EACH_OPCODE_WITH_OBJECT_ALLOCATION_PROFILE(macro) \
144     macro(OpNewObject) \
145 
146 #define FOR_EACH_OPCODE_WITH_LLINT_CALL_LINK_INFO(macro) \
147     macro(OpCall) \
148     macro(OpTailCall) \
149     macro(OpCallEval) \
150     macro(OpConstruct) \
151 
152 IGNORE_WARNINGS_BEGIN(&quot;type-limits&quot;)
153 
154 #define VERIFY_OPCODE_ID(id, size) COMPILE_ASSERT(id &lt;= numOpcodeIDs, ASSERT_THAT_JS_OPCODE_IDS_ARE_VALID);
155     FOR_EACH_OPCODE_ID(VERIFY_OPCODE_ID);
156 #undef VERIFY_OPCODE_ID
157 
158 IGNORE_WARNINGS_END
159 
160 #if ENABLE(COMPUTED_GOTO_OPCODES)
161 typedef void* Opcode;
162 #else
163 typedef OpcodeID Opcode;
164 #endif
165 
166 extern const char* const opcodeNames[];
<a name="13" id="anc13"></a><span class="line-added">167 extern const char* const wasmOpcodeNames[];</span>
168 
169 #if ENABLE(OPCODE_STATS)
170 
171 struct OpcodeStats {
172     OpcodeStats();
173     ~OpcodeStats();
174     static long long opcodeCounts[numOpcodeIDs];
175     static long long opcodePairCounts[numOpcodeIDs][numOpcodeIDs];
176     static int lastOpcode;
177 
178     static void recordInstruction(int opcode);
179     static void resetLastInstruction();
180 };
181 
182 #endif
183 
184 inline bool isBranch(OpcodeID opcodeID)
185 {
186     switch (opcodeID) {
187     case op_jmp:
188     case op_jtrue:
189     case op_jfalse:
190     case op_jeq_null:
191     case op_jneq_null:
192     case op_jundefined_or_null:
193     case op_jnundefined_or_null:
194     case op_jneq_ptr:
195     case op_jless:
196     case op_jlesseq:
197     case op_jgreater:
198     case op_jgreatereq:
199     case op_jnless:
200     case op_jnlesseq:
201     case op_jngreater:
202     case op_jngreatereq:
203     case op_jeq:
204     case op_jneq:
205     case op_jstricteq:
206     case op_jnstricteq:
207     case op_jbelow:
208     case op_jbeloweq:
209     case op_switch_imm:
210     case op_switch_char:
211     case op_switch_string:
212         return true;
213     default:
214         return false;
215     }
216 }
217 
218 inline bool isUnconditionalBranch(OpcodeID opcodeID)
219 {
220     switch (opcodeID) {
221     case op_jmp:
222         return true;
223     default:
224         return false;
225     }
226 }
227 
228 inline bool isTerminal(OpcodeID opcodeID)
229 {
230     switch (opcodeID) {
231     case op_ret:
232     case op_end:
233     case op_unreachable:
234         return true;
235     default:
236         return false;
237     }
238 }
239 
240 inline bool isThrow(OpcodeID opcodeID)
241 {
242     switch (opcodeID) {
243     case op_throw:
244     case op_throw_static_error:
245         return true;
246     default:
247         return false;
248     }
249 }
250 
251 unsigned metadataSize(OpcodeID);
252 unsigned metadataAlignment(OpcodeID);
253 
254 } // namespace JSC
255 
256 namespace WTF {
257 
258 class PrintStream;
259 
260 void printInternal(PrintStream&amp;, JSC::OpcodeID);
261 
262 } // namespace WTF
<a name="14" id="anc14"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="14" type="hidden" />
</body>
</html>