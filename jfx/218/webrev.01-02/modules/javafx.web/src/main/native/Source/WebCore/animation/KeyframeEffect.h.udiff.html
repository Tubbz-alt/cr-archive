<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/animation/KeyframeEffect.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="KeyframeEffect.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="KeyframeEffect.idl.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/animation/KeyframeEffect.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -24,10 +24,11 @@</span>
   */
  
  #pragma once
  
  #include &quot;AnimationEffect.h&quot;
<span class="udiff-line-added">+ #include &quot;AnimationEffectPhase.h&quot;</span>
  #include &quot;CSSPropertyBlendingClient.h&quot;
  #include &quot;CompositeOperation.h&quot;
  #include &quot;CompositeOperationOrAuto.h&quot;
  #include &quot;EffectTiming.h&quot;
  #include &quot;Element.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -45,12 +46,12 @@</span>
  class FilterOperations;
  
  class KeyframeEffect : public AnimationEffect
      , public CSSPropertyBlendingClient {
  public:
<span class="udiff-line-modified-removed">-     static ExceptionOr&lt;Ref&lt;KeyframeEffect&gt;&gt; create(JSC::ExecState&amp;, Element*, JSC::Strong&lt;JSC::JSObject&gt;&amp;&amp;, Optional&lt;Variant&lt;double, KeyframeEffectOptions&gt;&gt;&amp;&amp;);</span>
<span class="udiff-line-modified-removed">-     static ExceptionOr&lt;Ref&lt;KeyframeEffect&gt;&gt; create(JSC::ExecState&amp;, Ref&lt;KeyframeEffect&gt;&amp;&amp;);</span>
<span class="udiff-line-modified-added">+     static ExceptionOr&lt;Ref&lt;KeyframeEffect&gt;&gt; create(JSC::JSGlobalObject&amp;, Element*, JSC::Strong&lt;JSC::JSObject&gt;&amp;&amp;, Optional&lt;Variant&lt;double, KeyframeEffectOptions&gt;&gt;&amp;&amp;);</span>
<span class="udiff-line-modified-added">+     static ExceptionOr&lt;Ref&lt;KeyframeEffect&gt;&gt; create(JSC::JSGlobalObject&amp;, Ref&lt;KeyframeEffect&gt;&amp;&amp;);</span>
      static Ref&lt;KeyframeEffect&gt; create(const Element&amp;);
      ~KeyframeEffect() { }
  
      bool isKeyframeEffect() const final { return true; }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -96,67 +97,90 @@</span>
          double computedOffset;
          String easing { &quot;linear&quot; };
          CompositeOperationOrAuto composite { CompositeOperationOrAuto::Auto };
      };
  
<span class="udiff-line-added">+     const Vector&lt;ParsedKeyframe&gt;&amp; parsedKeyframes() const { return m_parsedKeyframes; }</span>
<span class="udiff-line-added">+ </span>
      Element* target() const { return m_target.get(); }
      void setTarget(RefPtr&lt;Element&gt;&amp;&amp;);
  
<span class="udiff-line-modified-removed">-     Vector&lt;JSC::Strong&lt;JSC::JSObject&gt;&gt; getKeyframes(JSC::ExecState&amp;);</span>
<span class="udiff-line-modified-removed">-     ExceptionOr&lt;void&gt; setKeyframes(JSC::ExecState&amp;, JSC::Strong&lt;JSC::JSObject&gt;&amp;&amp;);</span>
<span class="udiff-line-modified-added">+     Vector&lt;JSC::Strong&lt;JSC::JSObject&gt;&gt; getKeyframes(JSC::JSGlobalObject&amp;);</span>
<span class="udiff-line-modified-added">+     ExceptionOr&lt;void&gt; setKeyframes(JSC::JSGlobalObject&amp;, JSC::Strong&lt;JSC::JSObject&gt;&amp;&amp;);</span>
  
      IterationCompositeOperation iterationComposite() const { return m_iterationCompositeOperation; }
      void setIterationComposite(IterationCompositeOperation iterationCompositeOperation) { m_iterationCompositeOperation = iterationCompositeOperation; }
      CompositeOperation composite() const { return m_compositeOperation; }
      void setComposite(CompositeOperation compositeOperation) { m_compositeOperation = compositeOperation; }
  
      void getAnimatedStyle(std::unique_ptr&lt;RenderStyle&gt;&amp; animatedStyle);
      void apply(RenderStyle&amp;) override;
      void invalidate() override;
<span class="udiff-line-added">+     void animationDidTick() final;</span>
<span class="udiff-line-added">+     void animationDidPlay() final;</span>
      void animationDidSeek() final;
<span class="udiff-line-added">+     void animationWasCanceled() final;</span>
      void animationSuspensionStateDidChange(bool) final;
<span class="udiff-line-added">+     void animationTimelineDidChange(AnimationTimeline*) final;</span>
<span class="udiff-line-added">+     void animationTimingDidChange();</span>
      void applyPendingAcceleratedActions();
<span class="udiff-line-modified-removed">-     bool isRunningAccelerated() const { return m_lastRecordedAcceleratedAction != AcceleratedAction::Stop; }</span>
<span class="udiff-line-modified-removed">-     bool hasPendingAcceleratedAction() const { return !m_pendingAcceleratedActions.isEmpty() &amp;&amp; isRunningAccelerated(); }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     void willChangeRenderer();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     void setAnimation(WebAnimation*) final;</span>
  
      RenderElement* renderer() const override;
      const RenderStyle&amp; currentStyle() const override;
<span class="udiff-line-modified-removed">-     bool isAccelerated() const override { return m_shouldRunAccelerated; }</span>
<span class="udiff-line-modified-added">+     bool triggersStackingContext() const { return m_triggersStackingContext; }</span>
<span class="udiff-line-added">+     bool isRunningAccelerated() const { return m_isRunningAccelerated; }</span>
<span class="udiff-line-added">+     bool isAboutToRunAccelerated() const { return m_acceleratedPropertiesState != AcceleratedProperties::None &amp;&amp; m_lastRecordedAcceleratedAction != AcceleratedAction::Stop; }</span>
<span class="udiff-line-added">+     bool isCompletelyAccelerated() const { return m_acceleratedPropertiesState == AcceleratedProperties::All; }</span>
      bool filterFunctionListsMatch() const override { return m_filterFunctionListsMatch; }
      bool transformFunctionListsMatch() const override { return m_transformFunctionListsMatch; }
  #if ENABLE(FILTERS_LEVEL_2)
      bool backdropFilterFunctionListsMatch() const override { return m_backdropFilterFunctionListsMatch; }
  #endif
      bool colorFilterFunctionListsMatch() const override { return m_colorFilterFunctionListsMatch; }
  
      void computeDeclarativeAnimationBlendingKeyframes(const RenderStyle* oldStyle, const RenderStyle&amp; newStyle);
<span class="udiff-line-modified-removed">-     bool hasBlendingKeyframes() const { return m_blendingKeyframes.size(); }</span>
<span class="udiff-line-modified-added">+     const KeyframeList&amp; blendingKeyframes() const { return m_blendingKeyframes; }</span>
      const HashSet&lt;CSSPropertyID&gt;&amp; animatedProperties() const { return m_blendingKeyframes.properties(); }
<span class="udiff-line-added">+     bool animatesProperty(CSSPropertyID) const;</span>
  
      bool computeExtentOfTransformAnimation(LayoutRect&amp;) const;
      bool computeTransformedExtentViaTransformList(const FloatRect&amp;, const RenderStyle&amp;, LayoutRect&amp;) const;
      bool computeTransformedExtentViaMatrix(const FloatRect&amp;, const RenderStyle&amp;, LayoutRect&amp;) const;
      bool forceLayoutIfNeeded();
  
<span class="udiff-line-added">+     enum class Accelerated : uint8_t { Yes, No };</span>
<span class="udiff-line-added">+     bool isCurrentlyAffectingProperty(CSSPropertyID, Accelerated = Accelerated::No) const;</span>
<span class="udiff-line-added">+     bool isRunningAcceleratedAnimationForProperty(CSSPropertyID) const;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     const RenderStyle* unanimatedStyle() const { return m_unanimatedStyle.get(); }</span>
<span class="udiff-line-added">+ </span>
  private:
      KeyframeEffect(Element*);
  
      enum class AcceleratedAction : uint8_t { Play, Pause, Seek, Stop };
<span class="udiff-line-added">+     enum class BlendingKeyframesSource : uint8_t { CSSAnimation, CSSTransition, WebAnimation };</span>
<span class="udiff-line-added">+     enum class AcceleratedProperties : uint8_t { None, Some, All };</span>
  
<span class="udiff-line-added">+     void updateEffectStackMembership();</span>
      void copyPropertiesFromSource(Ref&lt;KeyframeEffect&gt;&amp;&amp;);
<span class="udiff-line-modified-removed">-     ExceptionOr&lt;void&gt; processKeyframes(JSC::ExecState&amp;, JSC::Strong&lt;JSC::JSObject&gt;&amp;&amp;);</span>
<span class="udiff-line-modified-added">+     ExceptionOr&lt;void&gt; processKeyframes(JSC::JSGlobalObject&amp;, JSC::Strong&lt;JSC::JSObject&gt;&amp;&amp;);</span>
      void addPendingAcceleratedAction(AcceleratedAction);
<span class="udiff-line-modified-removed">-     void updateAcceleratedAnimationState();</span>
<span class="udiff-line-modified-added">+     void updateAcceleratedActions();</span>
      void setAnimatedPropertiesInStyle(RenderStyle&amp;, double);
      TimingFunction* timingFunctionForKeyframeAtIndex(size_t);
      Ref&lt;const Animation&gt; backingAnimationForCompositedRenderer() const;
      void computedNeedsForcedLayout();
      void computeStackingContextImpact();
<span class="udiff-line-added">+     void clearBlendingKeyframes();</span>
      void updateBlendingKeyframes(RenderStyle&amp;);
<span class="udiff-line-modified-removed">-     void computeCSSAnimationBlendingKeyframes();</span>
<span class="udiff-line-modified-added">+     void computeCSSAnimationBlendingKeyframes(const RenderStyle&amp;);</span>
      void computeCSSTransitionBlendingKeyframes(const RenderStyle* oldStyle, const RenderStyle&amp; newStyle);
<span class="udiff-line-modified-removed">-     void computeShouldRunAccelerated();</span>
<span class="udiff-line-modified-added">+     void computeAcceleratedPropertiesState();</span>
      void setBlendingKeyframes(KeyframeList&amp;);
      void checkForMatchingTransformFunctionLists();
      void checkForMatchingFilterFunctionLists();
      void checkForMatchingColorFilterFunctionLists();
      bool checkForMatchingFilterFunctionLists(CSSPropertyID, const std::function&lt;const FilterOperations&amp; (const RenderStyle&amp;)&gt;&amp;) const;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -165,24 +189,30 @@</span>
  #endif
  
      KeyframeList m_blendingKeyframes { emptyString() };
      Vector&lt;ParsedKeyframe&gt; m_parsedKeyframes;
      Vector&lt;AcceleratedAction&gt; m_pendingAcceleratedActions;
<span class="udiff-line-modified-removed">-     RefPtr&lt;Element&gt; m_target;</span>
<span class="udiff-line-modified-added">+     WeakPtr&lt;Element&gt; m_target;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     std::unique_ptr&lt;const RenderStyle&gt; m_unanimatedStyle;</span>
  
      AcceleratedAction m_lastRecordedAcceleratedAction { AcceleratedAction::Stop };
<span class="udiff-line-added">+     BlendingKeyframesSource m_blendingKeyframesSource { BlendingKeyframesSource::WebAnimation };</span>
      IterationCompositeOperation m_iterationCompositeOperation { IterationCompositeOperation::Replace };
      CompositeOperation m_compositeOperation { CompositeOperation::Replace };
<span class="udiff-line-modified-removed">-     bool m_shouldRunAccelerated { false };</span>
<span class="udiff-line-modified-added">+     AcceleratedProperties m_acceleratedPropertiesState { AcceleratedProperties::None };</span>
<span class="udiff-line-added">+     AnimationEffectPhase m_phaseAtLastApplication { AnimationEffectPhase::Idle };</span>
<span class="udiff-line-added">+     bool m_isRunningAccelerated { false };</span>
      bool m_needsForcedLayout { false };
      bool m_triggersStackingContext { false };
      bool m_transformFunctionListsMatch { false };
      bool m_filterFunctionListsMatch { false };
  #if ENABLE(FILTERS_LEVEL_2)
      bool m_backdropFilterFunctionListsMatch { false };
  #endif
      bool m_colorFilterFunctionListsMatch { false };
<span class="udiff-line-added">+     bool m_inTargetEffectStack { false };</span>
  };
  
  } // namespace WebCore
  
  SPECIALIZE_TYPE_TRAITS_ANIMATION_EFFECT(KeyframeEffect, isKeyframeEffect());
</pre>
<center><a href="KeyframeEffect.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="KeyframeEffect.idl.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>