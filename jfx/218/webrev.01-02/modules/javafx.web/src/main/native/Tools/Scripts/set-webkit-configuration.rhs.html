<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Tools/Scripts/set-webkit-configuration</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 #!/usr/bin/env perl
  2 
<a name="1" id="anc1"></a><span class="line-modified">  3 # Copyright (C) 2005-2019 Apple Inc.  All rights reserved.</span>
  4 #
  5 # Redistribution and use in source and binary forms, with or without
  6 # modification, are permitted provided that the following conditions
  7 # are met:
  8 #
  9 # 1.  Redistributions of source code must retain the above copyright
 10 #     notice, this list of conditions and the following disclaimer. 
 11 # 2.  Redistributions in binary form must reproduce the above copyright
 12 #     notice, this list of conditions and the following disclaimer in the
 13 #     documentation and/or other materials provided with the distribution. 
 14 # 3.  Neither the name of Apple Inc. (&quot;Apple&quot;) nor the names of
 15 #     its contributors may be used to endorse or promote products derived
 16 #     from this software without specific prior written permission. 
 17 #
 18 # THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 19 # EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 20 # WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 21 # DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 22 # DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 23 # (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 24 # LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 25 # ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 26 # (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 27 # THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 28 
 29 use strict;
 30 use warnings;
 31 use FindBin;
 32 use lib $FindBin::Bin;
 33 use webkitdirs;
 34 
 35 my $programName = basename($0);
 36 my $usage = &lt;&lt;EOF;
 37 Usage: $programName [options]
<a name="2" id="anc2"></a><span class="line-modified"> 38   --32-bit                           Set the default architecture to 32-bit</span>
<span class="line-modified"> 39   --64-bit                           Set the default architecture to 64-bit</span>
<span class="line-modified"> 40   --[no-]asan                        Enable or disable clang address sanitizer</span>
<span class="line-modified"> 41   --[no-]coverage                    Enable or disable LLVM Source-based Code Coverage</span>
<span class="line-modified"> 42   --force-optimization-level=&lt;level&gt; Optimization level: O3, O2, O1, O0, Os, Ofast, Og, or none</span>
<span class="line-modified"> 43   --lto-mode=&lt;mode&gt;                  Set LTO mode: full, thin, or none</span>
<span class="line-modified"> 44   --debug                            Set the default configuration to debug</span>
<span class="line-added"> 45   --release                          Set the default configuration to release</span>
<span class="line-added"> 46   --reset                            Reset configurations</span>
 47 EOF
 48 
 49 my $configuration = passedConfiguration();
 50 my $architecture = passedArchitecture();
 51 my $enableASAN = checkForArgumentAndRemoveFromARGV(&quot;--asan&quot;);
 52 my $disableASAN = checkForArgumentAndRemoveFromARGV(&quot;--no-asan&quot;);
<a name="3" id="anc3"></a><span class="line-added"> 53 my $enableCoverage = checkForArgumentAndRemoveFromARGV(&quot;--coverage&quot;);</span>
<span class="line-added"> 54 my $disableCoverage = checkForArgumentAndRemoveFromARGV(&quot;--no-coverage&quot;);</span>
 55 my $ltoMode;
 56 if (!checkForArgumentAndRemoveFromARGVGettingValue(&quot;--lto-mode&quot;, \$ltoMode)) {
 57     $ltoMode=&quot;&quot;;
 58 }
<a name="4" id="anc4"></a><span class="line-added"> 59 my $forceOptimizationLevel;</span>
<span class="line-added"> 60 if (!checkForArgumentAndRemoveFromARGVGettingValue(&quot;--force-optimization-level&quot;, \$forceOptimizationLevel)</span>
<span class="line-added"> 61     &amp;&amp; !checkForArgumentAndRemoveFromARGVGettingValue(&quot;--force-opt&quot;, \$forceOptimizationLevel)) {</span>
<span class="line-added"> 62     $forceOptimizationLevel=&quot;&quot;;</span>
<span class="line-added"> 63 }</span>
 64 
 65 if (!$architecture) {
 66     # Handle --64-bit explicitly here, as we don&#39;t want our other scripts to accept it
 67     for my $i (0 .. $#ARGV) {
 68         my $opt = $ARGV[$i];
 69         if ($opt =~ /^--64-bit$/i) {
 70             splice(@ARGV, $i, 1);
 71             $architecture = &#39;x86_64&#39;;
 72         }
 73     }
 74 }
 75 
 76 my $baseProductDir = baseProductDir();
 77 system &quot;mkdir&quot;, &quot;-p&quot;, &quot;$baseProductDir&quot;;
 78 
 79 if (checkForArgumentAndRemoveFromARGV(&quot;--reset&quot;)) {
 80     unlink &quot;$baseProductDir/Configuration&quot;;
 81     unlink &quot;$baseProductDir/Architecture&quot;;
 82     unlink &quot;$baseProductDir/ASan&quot;;
<a name="5" id="anc5"></a><span class="line-added"> 83     unlink &quot;$baseProductDir/ForceOptimizationLevel&quot;;</span>
<span class="line-added"> 84     unlink &quot;$baseProductDir/Coverage&quot;;</span>
 85     unlink &quot;$baseProductDir/LTO&quot;;
 86     exit 0;
 87 }
 88 
<a name="6" id="anc6"></a><span class="line-modified"> 89 if ((!$configuration &amp;&amp; !$architecture &amp;&amp; !$enableASAN &amp;&amp; !$disableASAN &amp;&amp; !$enableCoverage &amp;&amp; !$disableCoverage &amp;&amp; !$ltoMode &amp;&amp; !$forceOptimizationLevel)</span>
<span class="line-added"> 90     || ($enableASAN &amp;&amp; $disableASAN)</span>
<span class="line-added"> 91     || ($enableCoverage &amp;&amp; $disableCoverage)) {</span>
 92     print STDERR $usage;
 93     exit 1;
 94 }
 95 
 96 if ($ltoMode &amp;&amp; $ltoMode ne &quot;full&quot; &amp;&amp; $ltoMode ne &quot;thin&quot; &amp;&amp; $ltoMode ne &quot;none&quot;) {
 97     print STDERR $usage;
 98     exit 1;
 99 }
100 
<a name="7" id="anc7"></a><span class="line-added">101 if ($forceOptimizationLevel</span>
<span class="line-added">102     &amp;&amp; $forceOptimizationLevel ne &quot;none&quot;</span>
<span class="line-added">103     &amp;&amp; $forceOptimizationLevel ne &quot;O0&quot;</span>
<span class="line-added">104     &amp;&amp; $forceOptimizationLevel ne &quot;O1&quot;</span>
<span class="line-added">105     &amp;&amp; $forceOptimizationLevel ne &quot;O2&quot;</span>
<span class="line-added">106     &amp;&amp; $forceOptimizationLevel ne &quot;O3&quot;</span>
<span class="line-added">107     &amp;&amp; $forceOptimizationLevel ne &quot;Os&quot;</span>
<span class="line-added">108     &amp;&amp; $forceOptimizationLevel ne &quot;Ofast&quot;</span>
<span class="line-added">109     &amp;&amp; $forceOptimizationLevel ne &quot;Og&quot;) {</span>
<span class="line-added">110     print STDERR $usage;</span>
<span class="line-added">111     exit 1;</span>
<span class="line-added">112 }</span>
<span class="line-added">113 </span>
114 if ($configuration) {
115     open CONFIGURATION, &quot;&gt;&quot;, &quot;$baseProductDir/Configuration&quot; or die;
116     print CONFIGURATION $configuration;
117     close CONFIGURATION;
118 }
119 
120 if ($architecture) {
121     if ($architecture ne &quot;x86_64&quot;) {
122         open ARCHITECTURE, &quot;&gt;&quot;, &quot;$baseProductDir/Architecture&quot; or die;
123         print ARCHITECTURE $architecture;
124         close ARCHITECTURE;
125     } else {
126         unlink &quot;$baseProductDir/Architecture&quot;;
127     }
128 }
129 
130 if ($enableASAN) {
131     open ASAN, &quot;&gt;&quot;, &quot;$baseProductDir/ASan&quot; or die;
132     print ASAN &quot;YES&quot;;
133     close ASAN;
134 } elsif ($disableASAN) {
135     unlink &quot;$baseProductDir/ASan&quot;;
136 }
137 
<a name="8" id="anc8"></a><span class="line-added">138 if ($enableCoverage) {</span>
<span class="line-added">139     open Coverage, &quot;&gt;&quot;, &quot;$baseProductDir/Coverage&quot; or die;</span>
<span class="line-added">140     print Coverage &quot;YES&quot;;</span>
<span class="line-added">141     close Coverage;</span>
<span class="line-added">142 } elsif ($disableCoverage) {</span>
<span class="line-added">143     unlink &quot;$baseProductDir/Coverage&quot;;</span>
<span class="line-added">144 }</span>
<span class="line-added">145 </span>
<span class="line-added">146 if ($forceOptimizationLevel &amp;&amp; $forceOptimizationLevel eq &quot;none&quot;) {</span>
<span class="line-added">147     unlink &quot;$baseProductDir/ForceOptimizationLevel&quot;;</span>
<span class="line-added">148 } elsif ($forceOptimizationLevel) {</span>
<span class="line-added">149     open ForceOptimizationLevel, &quot;&gt;&quot;, &quot;$baseProductDir/ForceOptimizationLevel&quot; or die;</span>
<span class="line-added">150     print ForceOptimizationLevel substr($forceOptimizationLevel, 1) . &quot;\n&quot;;</span>
<span class="line-added">151     close ForceOptimizationLevel;</span>
<span class="line-added">152 }</span>
<span class="line-added">153 </span>
154 if ($ltoMode) {
155     open LTO, &quot;&gt;&quot;, &quot;$baseProductDir/LTO&quot; or die;
156     print LTO &quot;$ltoMode&quot;;
157     close LTO;
158 }
<a name="9" id="anc9"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="9" type="hidden" />
</body>
</html>