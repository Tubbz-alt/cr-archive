<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/JITDisassembler.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JITCodeMap.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JITDisassembler.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/JITDisassembler.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
101         if (m_labelForBytecodeIndexInSlowPath[i].isSet()) {
102             firstSlowLabel = m_labelForBytecodeIndexInSlowPath[i];
103             break;
104         }
105     }
106     return firstSlowLabel.isSet() ? firstSlowLabel : m_endOfSlowPath;
107 }
108 
109 Vector&lt;JITDisassembler::DumpedOp&gt; JITDisassembler::dumpVectorForInstructions(LinkBuffer&amp; linkBuffer, const char* prefix, Vector&lt;MacroAssembler::Label&gt;&amp; labels, MacroAssembler::Label endLabel)
110 {
111     StringPrintStream out;
112     Vector&lt;DumpedOp&gt; result;
113 
114     for (unsigned i = 0; i &lt; labels.size();) {
115         if (!labels[i].isSet()) {
116             i++;
117             continue;
118         }
119         out.reset();
120         result.append(DumpedOp());
<span class="line-modified">121         result.last().index = i;</span>
122         out.print(prefix);
123         m_codeBlock-&gt;dumpBytecode(out, i);
124         for (unsigned nextIndex = i + 1; ; nextIndex++) {
125             if (nextIndex &gt;= labels.size()) {
126                 dumpDisassembly(out, linkBuffer, labels[i], endLabel);
127                 result.last().disassembly = out.toCString();
128                 return result;
129             }
130             if (labels[nextIndex].isSet()) {
131                 dumpDisassembly(out, linkBuffer, labels[i], labels[nextIndex]);
132                 result.last().disassembly = out.toCString();
133                 i = nextIndex;
134                 break;
135             }
136         }
137     }
138 
139     return result;
140 }
141 
142 void JITDisassembler::dumpForInstructions(PrintStream&amp; out, LinkBuffer&amp; linkBuffer, const char* prefix, Vector&lt;MacroAssembler::Label&gt;&amp; labels, MacroAssembler::Label endLabel)
143 {
144     Vector&lt;DumpedOp&gt; dumpedOps = dumpVectorForInstructions(linkBuffer, prefix, labels, endLabel);
145 
146     for (unsigned i = 0; i &lt; dumpedOps.size(); ++i)
147         out.print(dumpedOps[i].disassembly);
148 }
149 
150 void JITDisassembler::reportInstructions(Profiler::Compilation* compilation, LinkBuffer&amp; linkBuffer, const char* prefix, Vector&lt;MacroAssembler::Label&gt;&amp; labels, MacroAssembler::Label endLabel)
151 {
152     Vector&lt;DumpedOp&gt; dumpedOps = dumpVectorForInstructions(linkBuffer, prefix, labels, endLabel);
153 
154     for (unsigned i = 0; i &lt; dumpedOps.size(); ++i) {
155         compilation-&gt;addDescription(
156             Profiler::CompiledBytecode(
<span class="line-modified">157                 Profiler::OriginStack(Profiler::Origin(compilation-&gt;bytecodes(), dumpedOps[i].index)),</span>
158                 dumpedOps[i].disassembly));
159     }
160 }
161 
162 void JITDisassembler::dumpDisassembly(PrintStream&amp; out, LinkBuffer&amp; linkBuffer, MacroAssembler::Label from, MacroAssembler::Label to)
163 {
164     CodeLocationLabel&lt;DisassemblyPtrTag&gt; fromLocation = linkBuffer.locationOf&lt;DisassemblyPtrTag&gt;(from);
165     CodeLocationLabel&lt;DisassemblyPtrTag&gt; toLocation = linkBuffer.locationOf&lt;DisassemblyPtrTag&gt;(to);
166     disassemble(fromLocation, toLocation.dataLocation&lt;uintptr_t&gt;() - fromLocation.dataLocation&lt;uintptr_t&gt;(), &quot;        &quot;, out);
167 }
168 
169 } // namespace JSC
170 
171 #endif // ENABLE(JIT)
172 
</pre>
</td>
<td>
<hr />
<pre>
101         if (m_labelForBytecodeIndexInSlowPath[i].isSet()) {
102             firstSlowLabel = m_labelForBytecodeIndexInSlowPath[i];
103             break;
104         }
105     }
106     return firstSlowLabel.isSet() ? firstSlowLabel : m_endOfSlowPath;
107 }
108 
109 Vector&lt;JITDisassembler::DumpedOp&gt; JITDisassembler::dumpVectorForInstructions(LinkBuffer&amp; linkBuffer, const char* prefix, Vector&lt;MacroAssembler::Label&gt;&amp; labels, MacroAssembler::Label endLabel)
110 {
111     StringPrintStream out;
112     Vector&lt;DumpedOp&gt; result;
113 
114     for (unsigned i = 0; i &lt; labels.size();) {
115         if (!labels[i].isSet()) {
116             i++;
117             continue;
118         }
119         out.reset();
120         result.append(DumpedOp());
<span class="line-modified">121         result.last().bytecodeIndex = BytecodeIndex(i);</span>
122         out.print(prefix);
123         m_codeBlock-&gt;dumpBytecode(out, i);
124         for (unsigned nextIndex = i + 1; ; nextIndex++) {
125             if (nextIndex &gt;= labels.size()) {
126                 dumpDisassembly(out, linkBuffer, labels[i], endLabel);
127                 result.last().disassembly = out.toCString();
128                 return result;
129             }
130             if (labels[nextIndex].isSet()) {
131                 dumpDisassembly(out, linkBuffer, labels[i], labels[nextIndex]);
132                 result.last().disassembly = out.toCString();
133                 i = nextIndex;
134                 break;
135             }
136         }
137     }
138 
139     return result;
140 }
141 
142 void JITDisassembler::dumpForInstructions(PrintStream&amp; out, LinkBuffer&amp; linkBuffer, const char* prefix, Vector&lt;MacroAssembler::Label&gt;&amp; labels, MacroAssembler::Label endLabel)
143 {
144     Vector&lt;DumpedOp&gt; dumpedOps = dumpVectorForInstructions(linkBuffer, prefix, labels, endLabel);
145 
146     for (unsigned i = 0; i &lt; dumpedOps.size(); ++i)
147         out.print(dumpedOps[i].disassembly);
148 }
149 
150 void JITDisassembler::reportInstructions(Profiler::Compilation* compilation, LinkBuffer&amp; linkBuffer, const char* prefix, Vector&lt;MacroAssembler::Label&gt;&amp; labels, MacroAssembler::Label endLabel)
151 {
152     Vector&lt;DumpedOp&gt; dumpedOps = dumpVectorForInstructions(linkBuffer, prefix, labels, endLabel);
153 
154     for (unsigned i = 0; i &lt; dumpedOps.size(); ++i) {
155         compilation-&gt;addDescription(
156             Profiler::CompiledBytecode(
<span class="line-modified">157                 Profiler::OriginStack(Profiler::Origin(compilation-&gt;bytecodes(), dumpedOps[i].bytecodeIndex)),</span>
158                 dumpedOps[i].disassembly));
159     }
160 }
161 
162 void JITDisassembler::dumpDisassembly(PrintStream&amp; out, LinkBuffer&amp; linkBuffer, MacroAssembler::Label from, MacroAssembler::Label to)
163 {
164     CodeLocationLabel&lt;DisassemblyPtrTag&gt; fromLocation = linkBuffer.locationOf&lt;DisassemblyPtrTag&gt;(from);
165     CodeLocationLabel&lt;DisassemblyPtrTag&gt; toLocation = linkBuffer.locationOf&lt;DisassemblyPtrTag&gt;(to);
166     disassemble(fromLocation, toLocation.dataLocation&lt;uintptr_t&gt;() - fromLocation.dataLocation&lt;uintptr_t&gt;(), &quot;        &quot;, out);
167 }
168 
169 } // namespace JSC
170 
171 #endif // ENABLE(JIT)
172 
</pre>
</td>
</tr>
</table>
<center><a href="JITCodeMap.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JITDisassembler.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>