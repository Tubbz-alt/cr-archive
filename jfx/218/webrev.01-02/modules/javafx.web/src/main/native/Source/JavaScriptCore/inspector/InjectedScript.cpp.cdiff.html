<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/InjectedScript.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ContentSearchUtilities.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InjectedScript.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/InjectedScript.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 162,15 ***</span>
      }
  
      result = BindingTraits&lt;Protocol::Runtime::ObjectPreview&gt;::runtimeCast(WTFMove(resultValue));
  }
  
<span class="line-modified">! void InjectedScript::getProperties(ErrorString&amp; errorString, const String&amp; objectId, bool ownProperties, bool generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; properties)</span>
  {
      Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getProperties&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      function.appendArgument(objectId);
      function.appendArgument(ownProperties);
      function.appendArgument(generatePreview);
  
      RefPtr&lt;JSON::Value&gt; result = makeCall(function);
      if (!result || result-&gt;type() != JSON::Value::Type::Array) {
          errorString = &quot;Internal error&quot;_s;
<span class="line-new-header">--- 162,20 ---</span>
      }
  
      result = BindingTraits&lt;Protocol::Runtime::ObjectPreview&gt;::runtimeCast(WTFMove(resultValue));
  }
  
<span class="line-modified">! void InjectedScript::getProperties(ErrorString&amp; errorString, const String&amp; objectId, bool ownProperties, int fetchStart, int fetchCount, bool generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; properties)</span>
  {
<span class="line-added">+     ASSERT(fetchStart &gt;= 0);</span>
<span class="line-added">+     ASSERT(fetchCount &gt;= 0);</span>
<span class="line-added">+ </span>
      Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getProperties&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      function.appendArgument(objectId);
      function.appendArgument(ownProperties);
<span class="line-added">+     function.appendArgument(fetchStart);</span>
<span class="line-added">+     function.appendArgument(fetchCount);</span>
      function.appendArgument(generatePreview);
  
      RefPtr&lt;JSON::Value&gt; result = makeCall(function);
      if (!result || result-&gt;type() != JSON::Value::Type::Array) {
          errorString = &quot;Internal error&quot;_s;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 178,14 ***</span>
      }
  
      properties = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;::runtimeCast(WTFMove(result));
  }
  
<span class="line-modified">! void InjectedScript::getDisplayableProperties(ErrorString&amp; errorString, const String&amp; objectId, bool generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; properties)</span>
  {
      Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getDisplayableProperties&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      function.appendArgument(objectId);
      function.appendArgument(generatePreview);
  
      RefPtr&lt;JSON::Value&gt; result = makeCall(function);
      if (!result || result-&gt;type() != JSON::Value::Type::Array) {
          errorString = &quot;Internal error&quot;_s;
<span class="line-new-header">--- 183,19 ---</span>
      }
  
      properties = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;::runtimeCast(WTFMove(result));
  }
  
<span class="line-modified">! void InjectedScript::getDisplayableProperties(ErrorString&amp; errorString, const String&amp; objectId, int fetchStart, int fetchCount, bool generatePreview, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::PropertyDescriptor&gt;&gt;&amp; properties)</span>
  {
<span class="line-added">+     ASSERT(fetchStart &gt;= 0);</span>
<span class="line-added">+     ASSERT(fetchCount &gt;= 0);</span>
<span class="line-added">+ </span>
      Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getDisplayableProperties&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      function.appendArgument(objectId);
<span class="line-added">+     function.appendArgument(fetchStart);</span>
<span class="line-added">+     function.appendArgument(fetchCount);</span>
      function.appendArgument(generatePreview);
  
      RefPtr&lt;JSON::Value&gt; result = makeCall(function);
      if (!result || result-&gt;type() != JSON::Value::Type::Array) {
          errorString = &quot;Internal error&quot;_s;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 209,17 ***</span>
  
      auto array = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::InternalPropertyDescriptor&gt;&gt;::runtimeCast(WTFMove(result));
      properties = array-&gt;length() &gt; 0 ? array : nullptr;
  }
  
<span class="line-modified">! void InjectedScript::getCollectionEntries(ErrorString&amp; errorString, const String&amp; objectId, const String&amp; objectGroup, int startIndex, int numberToFetch, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::CollectionEntry&gt;&gt;&amp; entries)</span>
  {
      Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getCollectionEntries&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      function.appendArgument(objectId);
      function.appendArgument(objectGroup);
<span class="line-modified">!     function.appendArgument(startIndex);</span>
<span class="line-modified">!     function.appendArgument(numberToFetch);</span>
  
      RefPtr&lt;JSON::Value&gt; result = makeCall(function);
      if (!result || result-&gt;type() != JSON::Value::Type::Array) {
          errorString = &quot;Internal error&quot;_s;
          return;
<span class="line-new-header">--- 219,20 ---</span>
  
      auto array = BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Runtime::InternalPropertyDescriptor&gt;&gt;::runtimeCast(WTFMove(result));
      properties = array-&gt;length() &gt; 0 ? array : nullptr;
  }
  
<span class="line-modified">! void InjectedScript::getCollectionEntries(ErrorString&amp; errorString, const String&amp; objectId, const String&amp; objectGroup, int fetchStart, int fetchCount, RefPtr&lt;JSON::ArrayOf&lt;Protocol::Runtime::CollectionEntry&gt;&gt;&amp; entries)</span>
  {
<span class="line-added">+     ASSERT(fetchStart &gt;= 0);</span>
<span class="line-added">+     ASSERT(fetchCount &gt;= 0);</span>
<span class="line-added">+ </span>
      Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;getCollectionEntries&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      function.appendArgument(objectId);
      function.appendArgument(objectGroup);
<span class="line-modified">!     function.appendArgument(fetchStart);</span>
<span class="line-modified">!     function.appendArgument(fetchCount);</span>
  
      RefPtr&lt;JSON::Value&gt; result = makeCall(function);
      if (!result || result-&gt;type() != JSON::Value::Type::Array) {
          errorString = &quot;Internal error&quot;_s;
          return;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 248,16 ***</span>
  {
      ASSERT(!hasNoValue());
      Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;wrapCallFrames&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      function.appendArgument(callFrames);
  
<span class="line-modified">!     bool hadException = false;</span>
<span class="line-modified">!     auto callFramesValue = callFunctionWithEvalEnabled(function, hadException);</span>
<span class="line-modified">!     if (!callFramesValue)</span>
          return JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;::create();
<span class="line-modified">!     ASSERT(!hadException);</span>
<span class="line-modified">!     RefPtr&lt;JSON::Value&gt; result = toInspectorValue(*scriptState(), callFramesValue);</span>
      if (result-&gt;type() == JSON::Value::Type::Array)
          return BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;&gt;::runtimeCast(WTFMove(result)).releaseNonNull();
  
      return JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;::create();
  }
<span class="line-new-header">--- 261,16 ---</span>
  {
      ASSERT(!hasNoValue());
      Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;wrapCallFrames&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      function.appendArgument(callFrames);
  
<span class="line-modified">!     auto callResult = callFunctionWithEvalEnabled(function);</span>
<span class="line-modified">!     ASSERT(callResult);</span>
<span class="line-modified">!     if (!callResult || !callResult.value())</span>
          return JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;::create();
<span class="line-modified">! </span>
<span class="line-modified">!     RefPtr&lt;JSON::Value&gt; result = toInspectorValue(globalObject(), callResult.value());</span>
      if (result-&gt;type() == JSON::Value::Type::Array)
          return BindingTraits&lt;JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;&gt;::runtimeCast(WTFMove(result)).releaseNonNull();
  
      return JSON::ArrayOf&lt;Protocol::Debugger::CallFrame&gt;::create();
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 269,17 ***</span>
      wrapFunction.appendArgument(value);
      wrapFunction.appendArgument(groupName);
      wrapFunction.appendArgument(hasAccessToInspectedScriptState());
      wrapFunction.appendArgument(generatePreview);
  
<span class="line-modified">!     bool hadException = false;</span>
<span class="line-modified">!     auto r = callFunctionWithEvalEnabled(wrapFunction, hadException);</span>
<span class="line-removed">-     if (hadException)</span>
          return nullptr;
  
      RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">!     bool castSucceeded = toInspectorValue(*scriptState(), r)-&gt;asObject(resultObject);</span>
      ASSERT_UNUSED(castSucceeded, castSucceeded);
  
      return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
  }
  
<span class="line-new-header">--- 282,16 ---</span>
      wrapFunction.appendArgument(value);
      wrapFunction.appendArgument(groupName);
      wrapFunction.appendArgument(hasAccessToInspectedScriptState());
      wrapFunction.appendArgument(generatePreview);
  
<span class="line-modified">!     auto callResult = callFunctionWithEvalEnabled(wrapFunction);</span>
<span class="line-modified">!     if (!callResult)</span>
          return nullptr;
  
      RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">!     bool castSucceeded = toInspectorValue(globalObject(), callResult.value())-&gt;asObject(resultObject);</span>
      ASSERT_UNUSED(castSucceeded, castSucceeded);
  
      return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 289,20 ***</span>
      Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;wrapJSONString&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      wrapFunction.appendArgument(json);
      wrapFunction.appendArgument(groupName);
      wrapFunction.appendArgument(generatePreview);
  
<span class="line-modified">!     bool hadException = false;</span>
<span class="line-modified">!     auto evalResult = callFunctionWithEvalEnabled(wrapFunction, hadException);</span>
<span class="line-removed">-     if (hadException)</span>
          return nullptr;
  
<span class="line-modified">!     if (evalResult.isNull())</span>
          return nullptr;
  
      RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">!     bool castSucceeded = toInspectorValue(*scriptState(), evalResult)-&gt;asObject(resultObject);</span>
      ASSERT_UNUSED(castSucceeded, castSucceeded);
  
      return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
  }
  
<span class="line-new-header">--- 301,19 ---</span>
      Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;wrapJSONString&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      wrapFunction.appendArgument(json);
      wrapFunction.appendArgument(groupName);
      wrapFunction.appendArgument(generatePreview);
  
<span class="line-modified">!     auto callResult = callFunctionWithEvalEnabled(wrapFunction);</span>
<span class="line-modified">!     if (!callResult)</span>
          return nullptr;
  
<span class="line-modified">!     if (callResult.value().isNull())</span>
          return nullptr;
  
      RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">!     bool castSucceeded = toInspectorValue(globalObject(), callResult.value())-&gt;asObject(resultObject);</span>
      ASSERT_UNUSED(castSucceeded, castSucceeded);
  
      return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 315,17 ***</span>
      if (!columns)
          wrapFunction.appendArgument(false);
      else
          wrapFunction.appendArgument(columns);
  
<span class="line-modified">!     bool hadException = false;</span>
<span class="line-modified">!     auto r = callFunctionWithEvalEnabled(wrapFunction, hadException);</span>
<span class="line-removed">-     if (hadException)</span>
          return nullptr;
  
      RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">!     bool castSucceeded = toInspectorValue(*scriptState(), r)-&gt;asObject(resultObject);</span>
      ASSERT_UNUSED(castSucceeded, castSucceeded);
  
      return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
  }
  
<span class="line-new-header">--- 326,16 ---</span>
      if (!columns)
          wrapFunction.appendArgument(false);
      else
          wrapFunction.appendArgument(columns);
  
<span class="line-modified">!     auto callResult = callFunctionWithEvalEnabled(wrapFunction);</span>
<span class="line-modified">!     if (!callResult)</span>
          return nullptr;
  
      RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">!     bool castSucceeded = toInspectorValue(globalObject(), callResult.value())-&gt;asObject(resultObject);</span>
      ASSERT_UNUSED(castSucceeded, castSucceeded);
  
      return BindingTraits&lt;Protocol::Runtime::RemoteObject&gt;::runtimeCast(resultObject);
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 333,17 ***</span>
  {
      ASSERT(!hasNoValue());
      Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;previewValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      wrapFunction.appendArgument(value);
  
<span class="line-modified">!     bool hadException = false;</span>
<span class="line-modified">!     auto r = callFunctionWithEvalEnabled(wrapFunction, hadException);</span>
<span class="line-removed">-     if (hadException)</span>
          return nullptr;
  
      RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">!     bool castSucceeded = toInspectorValue(*scriptState(), r)-&gt;asObject(resultObject);</span>
      ASSERT_UNUSED(castSucceeded, castSucceeded);
  
      return BindingTraits&lt;Protocol::Runtime::ObjectPreview&gt;::runtimeCast(resultObject);
  }
  
<span class="line-new-header">--- 343,16 ---</span>
  {
      ASSERT(!hasNoValue());
      Deprecated::ScriptFunctionCall wrapFunction(injectedScriptObject(), &quot;previewValue&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      wrapFunction.appendArgument(value);
  
<span class="line-modified">!     auto callResult = callFunctionWithEvalEnabled(wrapFunction);</span>
<span class="line-modified">!     if (!callResult)</span>
          return nullptr;
  
      RefPtr&lt;JSON::Object&gt; resultObject;
<span class="line-modified">!     bool castSucceeded = toInspectorValue(globalObject(), callResult.value())-&gt;asObject(resultObject);</span>
      ASSERT_UNUSED(castSucceeded, castSucceeded);
  
      return BindingTraits&lt;Protocol::Runtime::ObjectPreview&gt;::runtimeCast(resultObject);
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 381,15 ***</span>
  {
      ASSERT(!hasNoValue());
      Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;findObjectById&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      function.appendArgument(objectId);
  
<span class="line-modified">!     bool hadException = false;</span>
<span class="line-modified">!     auto resultValue = callFunctionWithEvalEnabled(function, hadException);</span>
<span class="line-modified">!     ASSERT(!hadException);</span>
<span class="line-modified">! </span>
<span class="line-modified">!     return resultValue;</span>
  }
  
  void InjectedScript::inspectObject(JSC::JSValue value)
  {
      ASSERT(!hasNoValue());
<span class="line-new-header">--- 390,15 ---</span>
  {
      ASSERT(!hasNoValue());
      Deprecated::ScriptFunctionCall function(injectedScriptObject(), &quot;findObjectById&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      function.appendArgument(objectId);
  
<span class="line-modified">!     auto callResult = callFunctionWithEvalEnabled(function);</span>
<span class="line-modified">!     ASSERT(callResult);</span>
<span class="line-modified">!     if (!callResult)</span>
<span class="line-modified">!         return { };</span>
<span class="line-modified">!     return callResult.value();</span>
  }
  
  void InjectedScript::inspectObject(JSC::JSValue value)
  {
      ASSERT(!hasNoValue());
</pre>
<hr />
<pre>
<span class="line-old-header">*** 406,32 ***</span>
  }
  
  void InjectedScript::releaseObjectGroup(const String&amp; objectGroup)
  {
      ASSERT(!hasNoValue());
      Deprecated::ScriptFunctionCall releaseFunction(injectedScriptObject(), &quot;releaseObjectGroup&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      releaseFunction.appendArgument(objectGroup);
  
<span class="line-modified">!     bool hadException = false;</span>
<span class="line-modified">!     callFunctionWithEvalEnabled(releaseFunction, hadException);</span>
<span class="line-removed">-     ASSERT(!hadException);</span>
  }
  
  JSC::JSValue InjectedScript::arrayFromVector(Vector&lt;JSC::JSValue&gt;&amp;&amp; vector)
  {
<span class="line-modified">!     JSC::ExecState* execState = scriptState();</span>
<span class="line-modified">!     if (!execState)</span>
          return JSC::jsUndefined();
  
<span class="line-modified">!     JSC::JSLockHolder lock(execState);</span>
  
<span class="line-modified">!     JSC::JSArray* array = JSC::constructEmptyArray(execState, nullptr);</span>
      if (!array)
          return JSC::jsUndefined();
  
      for (auto&amp; item : vector)
<span class="line-modified">!         array-&gt;putDirectIndex(execState, array-&gt;length(), item);</span>
  
      return array;
  }
  
  } // namespace Inspector
<span class="line-new-header">--- 415,35 ---</span>
  }
  
  void InjectedScript::releaseObjectGroup(const String&amp; objectGroup)
  {
      ASSERT(!hasNoValue());
<span class="line-added">+     // JDK-8164076</span>
<span class="line-added">+     if (hasNoValue())</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
      Deprecated::ScriptFunctionCall releaseFunction(injectedScriptObject(), &quot;releaseObjectGroup&quot;_s, inspectorEnvironment()-&gt;functionCallHandler());
      releaseFunction.appendArgument(objectGroup);
  
<span class="line-modified">!     auto callResult = callFunctionWithEvalEnabled(releaseFunction);</span>
<span class="line-modified">!     ASSERT_UNUSED(callResult, callResult);</span>
  }
  
  JSC::JSValue InjectedScript::arrayFromVector(Vector&lt;JSC::JSValue&gt;&amp;&amp; vector)
  {
<span class="line-modified">!     JSC::JSGlobalObject* globalObject = this-&gt;globalObject();</span>
<span class="line-modified">!     if (!globalObject)</span>
          return JSC::jsUndefined();
  
<span class="line-modified">!     JSC::JSLockHolder lock(globalObject);</span>
  
<span class="line-modified">!     JSC::JSArray* array = JSC::constructEmptyArray(globalObject, nullptr);</span>
      if (!array)
          return JSC::jsUndefined();
  
      for (auto&amp; item : vector)
<span class="line-modified">!         array-&gt;putDirectIndex(globalObject, array-&gt;length(), item);</span>
  
      return array;
  }
  
  } // namespace Inspector
</pre>
<center><a href="ContentSearchUtilities.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InjectedScript.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>