<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/html/ValidationMessage.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="URLUtils.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="canvas/ANGLEInstancedArrays.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/html/ValidationMessage.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
146         m_timer = makeUnique&lt;Timer&gt;(*this, &amp;ValidationMessage::deleteBubbleTree);
147         m_timer-&gt;startOneShot(std::max(5_s, 1_ms * static_cast&lt;double&gt;(m_message.length()) * magnification));
148     }
149 }
150 
151 static void adjustBubblePosition(const LayoutRect&amp; hostRect, HTMLElement* bubble)
152 {
153     ASSERT(bubble);
154     if (hostRect.isEmpty())
155         return;
156     double hostX = hostRect.x();
157     double hostY = hostRect.y();
158     if (RenderObject* renderer = bubble-&gt;renderer()) {
159         if (RenderBox* container = renderer-&gt;containingBlock()) {
160             FloatPoint containerLocation = container-&gt;localToAbsolute();
161             hostX -= containerLocation.x() + container-&gt;borderLeft();
162             hostY -= containerLocation.y() + container-&gt;borderTop();
163         }
164     }
165 
<span class="line-modified">166     bubble-&gt;setInlineStyleProperty(CSSPropertyTop, hostY + hostRect.height(), CSSPrimitiveValue::CSS_PX);</span>
167     // The &#39;left&#39; value of ::-webkit-validation-bubble-arrow.
168     const int bubbleArrowTopOffset = 32;
169     double bubbleX = hostX;
170     if (hostRect.width() / 2 &lt; bubbleArrowTopOffset)
171         bubbleX = std::max(hostX + hostRect.width() / 2 - bubbleArrowTopOffset, 0.0);
<span class="line-modified">172     bubble-&gt;setInlineStyleProperty(CSSPropertyLeft, bubbleX, CSSPrimitiveValue::CSS_PX);</span>
173 }
174 
175 void ValidationMessage::buildBubbleTree()
176 {
177     ASSERT(!validationMessageClient());
178 
179     if (!m_element-&gt;renderer())
180         return;
181 
182     ShadowRoot&amp; shadowRoot = m_element-&gt;ensureUserAgentShadowRoot();
183 
184     Document&amp; document = m_element-&gt;document();
185     m_bubble = HTMLDivElement::create(document);
186     m_bubble-&gt;setPseudo(AtomString(&quot;-webkit-validation-bubble&quot;, AtomString::ConstructFromLiteral));
187     // Need to force position:absolute because RenderMenuList doesn&#39;t assume it
188     // contains non-absolute or non-fixed renderers as children.
189     m_bubble-&gt;setInlineStyleProperty(CSSPropertyPosition, CSSValueAbsolute);
190     shadowRoot.appendChild(*m_bubble);
191 
192     auto weakElement = makeWeakPtr(*m_element);
</pre>
</td>
<td>
<hr />
<pre>
146         m_timer = makeUnique&lt;Timer&gt;(*this, &amp;ValidationMessage::deleteBubbleTree);
147         m_timer-&gt;startOneShot(std::max(5_s, 1_ms * static_cast&lt;double&gt;(m_message.length()) * magnification));
148     }
149 }
150 
151 static void adjustBubblePosition(const LayoutRect&amp; hostRect, HTMLElement* bubble)
152 {
153     ASSERT(bubble);
154     if (hostRect.isEmpty())
155         return;
156     double hostX = hostRect.x();
157     double hostY = hostRect.y();
158     if (RenderObject* renderer = bubble-&gt;renderer()) {
159         if (RenderBox* container = renderer-&gt;containingBlock()) {
160             FloatPoint containerLocation = container-&gt;localToAbsolute();
161             hostX -= containerLocation.x() + container-&gt;borderLeft();
162             hostY -= containerLocation.y() + container-&gt;borderTop();
163         }
164     }
165 
<span class="line-modified">166     bubble-&gt;setInlineStyleProperty(CSSPropertyTop, hostY + hostRect.height(), CSSUnitType::CSS_PX);</span>
167     // The &#39;left&#39; value of ::-webkit-validation-bubble-arrow.
168     const int bubbleArrowTopOffset = 32;
169     double bubbleX = hostX;
170     if (hostRect.width() / 2 &lt; bubbleArrowTopOffset)
171         bubbleX = std::max(hostX + hostRect.width() / 2 - bubbleArrowTopOffset, 0.0);
<span class="line-modified">172     bubble-&gt;setInlineStyleProperty(CSSPropertyLeft, bubbleX, CSSUnitType::CSS_PX);</span>
173 }
174 
175 void ValidationMessage::buildBubbleTree()
176 {
177     ASSERT(!validationMessageClient());
178 
179     if (!m_element-&gt;renderer())
180         return;
181 
182     ShadowRoot&amp; shadowRoot = m_element-&gt;ensureUserAgentShadowRoot();
183 
184     Document&amp; document = m_element-&gt;document();
185     m_bubble = HTMLDivElement::create(document);
186     m_bubble-&gt;setPseudo(AtomString(&quot;-webkit-validation-bubble&quot;, AtomString::ConstructFromLiteral));
187     // Need to force position:absolute because RenderMenuList doesn&#39;t assume it
188     // contains non-absolute or non-fixed renderers as children.
189     m_bubble-&gt;setInlineStyleProperty(CSSPropertyPosition, CSSValueAbsolute);
190     shadowRoot.appendChild(*m_bubble);
191 
192     auto weakElement = makeWeakPtr(*m_element);
</pre>
</td>
</tr>
</table>
<center><a href="URLUtils.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="canvas/ANGLEInstancedArrays.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>