<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff tests/system/src/test/java/test/javafx/scene/Snapshot2Test.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>tests/system/src/test/java/test/javafx/scene/Snapshot2Test.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
237             tmpNode = new Rectangle(10, 5, NODE_W, NODE_H);
238             Group root = new Group();
239             tmpScene = new Scene(root, SCENE_W, SCENE_H);
240             root.getChildren().add(tmpNode);
241             if (live) {
242                 tmpStage = new TestStage(tmpScene);
243                 assertNotNull(tmpScene.getWindow());
244                 tmpStage.show();
245             } else {
246                 assertNull(tmpScene.getWindow());
247             }
248         });
249     }
250 
251     private void setupImageScene(int width, int height) {
252         Util.runAndWait(() -&gt; {
253             WritableImage image = new WritableImage(width, height);
254             // Initialize image with noise
255             var pixWriter = image.getPixelWriter();
256             assertNotNull(pixWriter);
<span class="line-modified">257             IntStream.range(0, width).parallel()</span>
<span class="line-modified">258                     .forEach(x -&gt; IntStream.range(0, height).parallel()</span>
<span class="line-modified">259                             .forEach(y -&gt; pixWriter.setColor(x, y, Color.rgb(</span>
<span class="line-modified">260                                     ThreadLocalRandom.current().nextInt(0, 256),</span>
<span class="line-modified">261                                     ThreadLocalRandom.current().nextInt(0, 256),</span>
<span class="line-modified">262                                     ThreadLocalRandom.current().nextInt(0, 256)))));</span>


263             tmpNode = new ImageView(image);
264             Group root = new Group();
265             tmpScene = new Scene(root, width, height);
266             root.getChildren().add(tmpNode);
267             if (live) {
268                 tmpStage = new TestStage(tmpScene);
269                 assertNotNull(tmpScene.getWindow());
270                 tmpStage.show();
271             }
272             else {
273                 assertNull(tmpScene.getWindow());
274             }
275         });
276     }
277 
278     // Test snapshot of a simple scene
279 
280     @Test
281     public void testSnapshotSimpleSceneImm() {
282         setupSimpleScene();
</pre>
<hr />
<pre>
385         }, null, buffer);
386     }
387 
388     private boolean comparePixels(Image imageA, Image imageB) {
389         if (imageA == null) {
390             return false;
391         }
392         if (imageB == null) {
393             return false;
394         }
395         int width = (int)imageA.getWidth();
396         if (width != (int)imageB.getWidth()) {
397             return false;
398         }
399         int height = (int)imageA.getHeight();
400         if (height != (int)imageB.getHeight()) {
401             return false;
402         }
403         var pixRdrA = imageA.getPixelReader();
404         var pixRdrB = imageB.getPixelReader();
<span class="line-modified">405         return IntStream.range(0, width).parallel()</span>
<span class="line-modified">406                 .allMatch(x -&gt; IntStream.range(0, height).parallel()</span>
<span class="line-modified">407                         .allMatch(y -&gt; pixRdrA.getArgb(x, y) == pixRdrB.getArgb(x, y)));</span>





408     }
409 
410     @Test
411     public void testSnapshot2x1TilesSameSizeImm() {
412         doTestTiledSnapshotImm(4100, 10);
413     }
414 
415     @Test
416     public void testSnapshot2x1TilesDifferentSizeImm() {
417         doTestTiledSnapshotImm(4099, 10);
418     }
419 
420     @Test
421     public void testSnapshot1x2TilesSameSizeImm() {
422         doTestTiledSnapshotImm(10, 4100);
423     }
424 
425     @Test
426     public void testSnapshot1x2TilesDifferentSizeImm() {
427         doTestTiledSnapshotImm(10, 4099);
</pre>
</td>
<td>
<hr />
<pre>
237             tmpNode = new Rectangle(10, 5, NODE_W, NODE_H);
238             Group root = new Group();
239             tmpScene = new Scene(root, SCENE_W, SCENE_H);
240             root.getChildren().add(tmpNode);
241             if (live) {
242                 tmpStage = new TestStage(tmpScene);
243                 assertNotNull(tmpScene.getWindow());
244                 tmpStage.show();
245             } else {
246                 assertNull(tmpScene.getWindow());
247             }
248         });
249     }
250 
251     private void setupImageScene(int width, int height) {
252         Util.runAndWait(() -&gt; {
253             WritableImage image = new WritableImage(width, height);
254             // Initialize image with noise
255             var pixWriter = image.getPixelWriter();
256             assertNotNull(pixWriter);
<span class="line-modified">257             for (int x = 0; x &lt; width; x++) {</span>
<span class="line-modified">258                 for (int y = 0; y &lt; height; y++) {</span>
<span class="line-modified">259                     pixWriter.setColor(x, y, Color.rgb(</span>
<span class="line-modified">260                             ThreadLocalRandom.current().nextInt(0, 256),</span>
<span class="line-modified">261                             ThreadLocalRandom.current().nextInt(0, 256),</span>
<span class="line-modified">262                             ThreadLocalRandom.current().nextInt(0, 256)));</span>
<span class="line-added">263                 }</span>
<span class="line-added">264             }</span>
265             tmpNode = new ImageView(image);
266             Group root = new Group();
267             tmpScene = new Scene(root, width, height);
268             root.getChildren().add(tmpNode);
269             if (live) {
270                 tmpStage = new TestStage(tmpScene);
271                 assertNotNull(tmpScene.getWindow());
272                 tmpStage.show();
273             }
274             else {
275                 assertNull(tmpScene.getWindow());
276             }
277         });
278     }
279 
280     // Test snapshot of a simple scene
281 
282     @Test
283     public void testSnapshotSimpleSceneImm() {
284         setupSimpleScene();
</pre>
<hr />
<pre>
387         }, null, buffer);
388     }
389 
390     private boolean comparePixels(Image imageA, Image imageB) {
391         if (imageA == null) {
392             return false;
393         }
394         if (imageB == null) {
395             return false;
396         }
397         int width = (int)imageA.getWidth();
398         if (width != (int)imageB.getWidth()) {
399             return false;
400         }
401         int height = (int)imageA.getHeight();
402         if (height != (int)imageB.getHeight()) {
403             return false;
404         }
405         var pixRdrA = imageA.getPixelReader();
406         var pixRdrB = imageB.getPixelReader();
<span class="line-modified">407         for (int x = 0; x &lt; width; x++) {</span>
<span class="line-modified">408             for (int y = 0; y &lt; height; y++) {</span>
<span class="line-modified">409                 if (pixRdrA.getArgb(x, y) != pixRdrB.getArgb(x, y)) {</span>
<span class="line-added">410                     return false;</span>
<span class="line-added">411                 }</span>
<span class="line-added">412             }</span>
<span class="line-added">413         }</span>
<span class="line-added">414         return true;</span>
415     }
416 
417     @Test
418     public void testSnapshot2x1TilesSameSizeImm() {
419         doTestTiledSnapshotImm(4100, 10);
420     }
421 
422     @Test
423     public void testSnapshot2x1TilesDifferentSizeImm() {
424         doTestTiledSnapshotImm(4099, 10);
425     }
426 
427     @Test
428     public void testSnapshot1x2TilesSameSizeImm() {
429         doTestTiledSnapshotImm(10, 4100);
430     }
431 
432     @Test
433     public void testSnapshot1x2TilesDifferentSizeImm() {
434         doTestTiledSnapshotImm(10, 4099);
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>