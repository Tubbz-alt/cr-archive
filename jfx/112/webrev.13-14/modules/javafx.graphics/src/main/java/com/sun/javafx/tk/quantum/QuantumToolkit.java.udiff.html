<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.graphics/src/main/java/com/sun/javafx/tk/quantum/QuantumToolkit.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../../tests/system/src/test/java/test/javafx/scene/Snapshot2Test.java.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/java/com/sun/javafx/tk/quantum/QuantumToolkit.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1552,23 +1552,24 @@</span>
                      return;
                  }
  
                  boolean errored = false;
                  // A temp QuantumImage used only as a RTT cache for rendering tiles.
<span class="udiff-line-modified-removed">-                 var tileRttCache = new QuantumImage((com.sun.prism.Image) null);</span>
<span class="udiff-line-modified-added">+                 QuantumImage tileRttCache = null;</span>
                  try {
                      QuantumImage pImage = (params.platformImage instanceof QuantumImage) ?
                              (QuantumImage) params.platformImage : new QuantumImage((com.sun.prism.Image) null);
  
                      int maxTextureSize = rf.getMaximumTextureSize();
                      if (h &gt; maxTextureSize || w &gt; maxTextureSize) {
<span class="udiff-line-modified-removed">-                         // The requested size for the screenshot is too big to fit a single texture,</span>
<span class="udiff-line-modified-added">+                         tileRttCache = new QuantumImage((com.sun.prism.Image) null);</span>
<span class="udiff-line-added">+                         // The requested size for the snapshot is too big to fit a single texture,</span>
                          // so we need to take several snapshot tiles and merge them into pImage
                          if (pImage.image == null) {
                              pImage.setImage(com.sun.prism.Image.fromIntArgbPreData(IntBuffer.allocate(w * h), w, h));
                          }
<span class="udiff-line-modified-removed">-                         // Find out if it is possible to divide up the image in tiles of the same size</span>
<span class="udiff-line-modified-added">+                         // Determine the initial dimensions of the tiles</span>
                          int tileWidth = computeTileSize(w, maxTextureSize);
                          int tileHeight = computeTileSize(h, maxTextureSize);
                          IntBuffer buffer = IntBuffer.allocate(tileWidth * tileHeight);
  
                          // M represents the middle set of tiles each with a size of tileW x tileH.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1630,20 +1631,22 @@</span>
                          if (mTileWidth &gt; 0 &amp;&amp; mTileHeight &gt; 0 &amp;&amp; rOffset &gt; 0 &amp;&amp; bOffset &gt; 0) {
                              renderTile(x, bOffset, y, rOffset, bTileWidth, rTileHeight, buffer, rf, tileRttCache, pImage);
                          }
                      }
                      else {
<span class="udiff-line-modified-removed">-                         // The requested size for the screenshot fits max texture size,</span>
<span class="udiff-line-modified-added">+                         // The requested size for the snapshot fits max texture size,</span>
                          // so we can directly render it in the target image.
                          renderWholeImage(x, y, w, h, rf, pImage);
                      }
                      params.platformImage = pImage;
                  } catch (Throwable t) {
                      errored = true;
                      t.printStackTrace(System.err);
                  } finally {
<span class="udiff-line-modified-removed">-                     tileRttCache.dispose();</span>
<span class="udiff-line-modified-added">+                     if (tileRttCache != null) {</span>
<span class="udiff-line-added">+                         tileRttCache.dispose();</span>
<span class="udiff-line-added">+                     }</span>
                      Disposer.cleanUp();
                      rf.getTextureResourcePool().freeDisposalRequestedAndCheckResources(errored);
                  }
              }
          });
</pre>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../../tests/system/src/test/java/test/javafx/scene/Snapshot2Test.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>