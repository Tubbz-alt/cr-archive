<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.controls/src/test/java/test/javafx/scene/control/SpinnerTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
<a name="1" id="anc1"></a><span class="line-modified">   2  * Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 package test.javafx.scene.control;
  26 
  27 import static junit.framework.Assert.*;
  28 
  29 import javafx.collections.FXCollections;
  30 import javafx.collections.ObservableList;
  31 import org.junit.Before;
  32 import org.junit.Ignore;
  33 import org.junit.Test;
  34 
  35 import java.time.LocalDate;
  36 import java.time.LocalTime;
  37 import java.time.temporal.ChronoUnit;
  38 import javafx.scene.control.Button;
  39 import javafx.scene.control.skin.SpinnerSkin;
  40 import javafx.scene.control.Spinner;
  41 import javafx.scene.control.SpinnerShim;
  42 import javafx.scene.control.SpinnerValueFactory;
  43 import javafx.scene.control.SpinnerValueFactoryShim;
  44 import javafx.scene.input.KeyCode;
  45 import javafx.scene.layout.FlowPane;
  46 import javafx.scene.layout.VBox;
  47 import javafx.scene.Scene;
  48 import javafx.stage.Stage;
  49 import javafx.util.Duration;
  50 
  51 import test.com.sun.javafx.pgstub.StubToolkit;
  52 import test.com.sun.javafx.scene.control.infrastructure.KeyEventFirer;
  53 import com.sun.javafx.tk.Toolkit;
  54 
  55 import static javafx.scene.control.SpinnerValueFactoryShim.*;
  56 
  57 public class SpinnerTest {
  58 
  59     private Spinner&lt;?&gt; spinner;
  60 
  61     // --- int spinner
  62     private Spinner&lt;Integer&gt; intSpinner;
  63     private IntegerSpinnerValueFactory intValueFactory;
  64 
  65     // --- double spinner
  66     private Spinner&lt;Double&gt; dblSpinner;
  67     private DoubleSpinnerValueFactory dblValueFactory;
  68 
  69     // --- list spinner
  70     private ObservableList&lt;String&gt; strings;
  71     private Spinner&lt;String&gt; listSpinner;
  72     private ListSpinnerValueFactory listValueFactory;
  73 
  74     // --- LocalDate spinner
  75     private Spinner&lt;LocalDate&gt; localDateSpinner;
  76     private SpinnerValueFactory&lt;LocalDate&gt; localDateValueFactory;
  77 
  78     // --- LocalTime spinner
  79     private Spinner&lt;LocalTime&gt; localTimeSpinner;
  80     private SpinnerValueFactory&lt;LocalTime&gt;localTimeValueFactory;
  81 
  82     // used in tests for counting events, reset to zero in setup()
  83     private int eventCount;
  84 
  85 
  86     @Before public void setup() {
  87         eventCount = 0;
  88         spinner = new Spinner();
  89 
  90         intSpinner = new Spinner&lt;&gt;(0, 10, 5, 1);
  91         intValueFactory = (IntegerSpinnerValueFactory) intSpinner.getValueFactory();
<a name="2" id="anc2"></a>
  92 
  93         dblSpinner = new Spinner&lt;&gt;(0.0, 1.0, 0.5, 0.05);
  94         dblValueFactory = (DoubleSpinnerValueFactory) dblSpinner.getValueFactory();
  95 
  96         strings = FXCollections.observableArrayList(&quot;string1&quot;, &quot;string2&quot;, &quot;string3&quot;);
  97         listSpinner = new Spinner&lt;&gt;(strings);
  98         listValueFactory = (ListSpinnerValueFactory&lt;String&gt;) listSpinner.getValueFactory();
  99 
 100         // minimum is today minus 10 days, maximum is today plus 10 days
 101         localDateSpinner = SpinnerShim.getSpinnerLocalDate(
 102                 nowPlusDays(-10), nowPlusDays(10),
 103                 LocalDate.now(), 1, ChronoUnit.DAYS);
 104         localDateValueFactory = localDateSpinner.getValueFactory();
 105 
 106         localTimeSpinner = SpinnerShim.getSpinnerLocalTime(
 107                 LocalTime.MIN, LocalTime.MAX,
 108                 LocalTime.now(), 1, ChronoUnit.HOURS);
 109         localTimeValueFactory = localTimeSpinner.getValueFactory();
 110     }
 111 
 112 
 113     /***************************************************************************
 114      *                                                                         *
 115      * Basic tests                                                             *
 116      *                                                                         *
 117      **************************************************************************/
 118 
 119     @Test public void createDefaultSpinner_hasSpinnerStyleClass() {
 120         assertEquals(1, spinner.getStyleClass().size());
 121         assertTrue(spinner.getStyleClass().contains(&quot;spinner&quot;));
 122     }
 123 
 124     @Test public void createDefaultSpinner_editorIsNotNull() {
 125         assertNotNull(spinner.getEditor());
 126     }
 127 
 128     @Test public void createDefaultSpinner_valueFactoryIsNull() {
 129         assertNull(spinner.getValueFactory());
 130     }
 131 
 132     @Test public void createDefaultSpinner_valueIsNull() {
 133         assertNull(spinner.getValue());
 134     }
 135 
 136     @Test public void createDefaultSpinner_editableIsFalse() {
 137         assertFalse(spinner.isEditable());
 138     }
 139 
 140     @Ignore(&quot;Waiting for StageLoader&quot;)
 141     @Test public void createDefaultSpinner_defaultSkinIsInstalled() {
 142         assertTrue(spinner.getSkin() instanceof SpinnerSkin);
 143     }
 144 
 145 
 146     /***************************************************************************
 147      *                                                                         *
 148      * Alternative constructor tests                                           *
 149      *                                                                         *
 150      **************************************************************************/
 151 
 152     @Test public void createIntSpinner_createValidValueFactory() {
 153         Spinner&lt;Integer&gt; intSpinner = new Spinner&lt;Integer&gt;(0, 10, 5, 1);
 154         assertTrue(intSpinner.getValueFactory() instanceof IntegerSpinnerValueFactory);
 155         IntegerSpinnerValueFactory valueFactory = (IntegerSpinnerValueFactory) intSpinner.getValueFactory();
 156         assertEquals(5, (int) valueFactory.getValue());
 157     }
 158 
 159     @Test public void createIntSpinner_setInitialValueOutsideMaxBounds() {
 160         Spinner&lt;Integer&gt; intSpinner = new Spinner&lt;Integer&gt;(0, 10, 100, 1);
 161         assertTrue(intSpinner.getValueFactory() instanceof IntegerSpinnerValueFactory);
 162         IntegerSpinnerValueFactory valueFactory = (IntegerSpinnerValueFactory) intSpinner.getValueFactory();
 163         assertEquals(0, (int) valueFactory.getValue());
 164     }
 165 
 166     @Test public void createIntSpinner_setInitialValueOutsideMinBounds() {
 167         Spinner&lt;Integer&gt; intSpinner = new Spinner&lt;Integer&gt;(0, 10, -100, 1);
 168         assertTrue(intSpinner.getValueFactory() instanceof IntegerSpinnerValueFactory);
 169         IntegerSpinnerValueFactory valueFactory = (IntegerSpinnerValueFactory) intSpinner.getValueFactory();
 170         assertEquals(0, (int) valueFactory.getValue());
 171     }
 172 
 173     @Test public void createListSpinner_createValidValueFactory() {
 174         Spinner&lt;String&gt; stringSpinner = new Spinner&lt;&gt;(FXCollections.observableArrayList(&quot;item 1&quot;, &quot;item 2&quot;));
 175         assertTrue(stringSpinner.getValueFactory() instanceof ListSpinnerValueFactory);
 176         ListSpinnerValueFactory valueFactory = (ListSpinnerValueFactory) stringSpinner.getValueFactory();
 177         assertEquals(&quot;item 1&quot;, valueFactory.getValue());
 178     }
 179 
 180     @Test public void createListSpinner_emptyListResultsInNullValue() {
 181         Spinner&lt;String&gt; stringSpinner = new Spinner&lt;String&gt;(FXCollections.observableArrayList());
 182         assertTrue(stringSpinner.getValueFactory() instanceof ListSpinnerValueFactory);
 183         ListSpinnerValueFactory valueFactory = (ListSpinnerValueFactory) stringSpinner.getValueFactory();
 184         assertNull(valueFactory.getValue());
 185     }
 186 
 187     @Test public void createListSpinner_nullListResultsInNullValue() {
 188         Spinner&lt;String&gt; stringSpinner = new Spinner&lt;&gt;((ObservableList&lt;String&gt;)null);
 189         assertTrue(stringSpinner.getValueFactory() instanceof ListSpinnerValueFactory);
 190         ListSpinnerValueFactory valueFactory = (ListSpinnerValueFactory) stringSpinner.getValueFactory();
 191         assertNull(valueFactory.getValue());
 192     }
 193 
 194     @Test public void createSpinner_customSpinnerValueFactory() {
 195         SpinnerValueFactory&lt;String&gt; valueFactory = new ListSpinnerValueFactory&lt;&gt;(FXCollections.observableArrayList(&quot;item 1&quot;, &quot;item 2&quot;));
 196         Spinner&lt;String&gt; stringSpinner = new Spinner&lt;&gt;(valueFactory);
 197         assertEquals(valueFactory, stringSpinner.getValueFactory());
 198         ListSpinnerValueFactory valueFactory1 = (ListSpinnerValueFactory) stringSpinner.getValueFactory();
 199         assertEquals(&quot;item 1&quot;, valueFactory.getValue());
 200         assertEquals(&quot;item 1&quot;, valueFactory1.getValue());
 201     }
 202 
 203 
 204 
 205     /***************************************************************************
 206      *                                                                         *
 207      * increment / decrement tests                                             *
 208      * (we test the actual inc / dec in the value factory impl tests)          *
 209      *                                                                         *
 210      **************************************************************************/
 211 
 212     @Test(expected = IllegalStateException.class)
 213     public void expectExceptionWhenNoArgsIncrementCalled_noValueFactory() {
 214         spinner.increment();
 215     }
 216 
 217     @Test(expected = IllegalStateException.class)
 218     public void expectExceptionWhenOneArgsIncrementCalled_noValueFactory() {
 219         spinner.increment(2);
 220     }
 221 
 222     @Test(expected = IllegalStateException.class)
 223     public void expectExceptionWhenNoArgsDecrementCalled_noValueFactory() {
 224         spinner.decrement();
 225     }
 226 
 227     @Test(expected = IllegalStateException.class)
 228     public void expectExceptionWhenOneArgsDecrementCalled_noValueFactory() {
 229         spinner.decrement(2);
 230     }
 231 
 232 
 233     /***************************************************************************
 234      *                                                                         *
 235      * changing value factory tests                                            *
 236      *                                                                         *
 237      **************************************************************************/
 238 
 239     @Test public void valueFactory_valueIsNulledWhenValueFactoryisNull() {
 240         assertEquals(5, (int) intSpinner.getValue());
 241         intSpinner.setValueFactory(null);
 242         assertNull(spinner.getValue());
 243     }
 244 
 245     @Test public void valueFactory_valueIsUpdatedWhenValueFactoryChanged() {
 246         assertEquals(5, (int) intSpinner.getValue());
 247         intSpinner.setValueFactory(new IntegerSpinnerValueFactory(0, 10, 8));
 248         assertEquals(8, (int) intSpinner.getValue());
 249     }
 250 
 251 //    @Test public void valueFactory_spinnerPropertyIsNullWhenRemovedFromSpinner() {
 252 //        SpinnerValueFactory initialValueFactory = intSpinner.getValueFactory();
 253 //        assertEquals(intSpinner, initialValueFactory.getSpinner());
 254 //
 255 //        intSpinner.setValueFactory(null);
 256 //        assertNull(intSpinner.getValueFactory());
 257 //    }
 258 //
 259 //    @Test public void valueFactory_spinnerPropertyIsSetOnNewSpinner() {
 260 //        SpinnerValueFactory initialValueFactory = intSpinner.getValueFactory();
 261 //        assertEquals(intSpinner, initialValueFactory.getSpinner());
 262 //
 263 //        SpinnerValueFactory newValueFactory = new IntSpinnerValueFactory(0, 10, 8);
 264 //        intSpinner.setValueFactory(newValueFactory);
 265 //
 266 //        assertNull(initialValueFactory.getSpinner());
 267 //        assertEquals(intSpinner, newValueFactory.getSpinner());
 268 //    }
 269 
 270 
 271     /***************************************************************************
 272      *                                                                         *
 273      * value property events                                                   *
 274      *                                                                         *                                                                         *
 275      **************************************************************************/
 276 
 277     @Test public void value_notifyWhenChanged_validValue() {
 278         assertEquals(5, (int) intSpinner.getValue());
 279         intSpinner.valueProperty().addListener(o -&gt; eventCount++);
 280         intSpinner.getValueFactory().setValue(3);
 281         assertEquals(1, eventCount);
 282     }
 283 
 284     @Test public void value_notifyWhenChanged_invalidValue() {
 285         assertEquals(5, (int) intSpinner.getValue());
 286         intSpinner.valueProperty().addListener(o -&gt; eventCount++);
 287         intSpinner.getValueFactory().setValue(1000);
 288 
 289         // we expect two events: firstly, one for the invalid value, and another
 290         // for the valid value
 291         assertEquals(2, eventCount);
 292     }
 293 
 294     @Test public void value_notifyWhenChanged_existingValue() {
 295         assertEquals(5, (int) intSpinner.getValue());
 296         intSpinner.valueProperty().addListener(o -&gt; eventCount++);
 297         intSpinner.getValueFactory().setValue(5);
 298         assertEquals(0, eventCount);
 299     }
 300 
 301 
 302     /***************************************************************************
 303      *                                                                         *
 304      * editing tests                                                           *
 305      *                                                                         *
 306      **************************************************************************/
 307 
 308     @Ignore(&quot;Need KeyboardEventFirer&quot;)
 309     @Test public void editing_commitValidInput() {
 310         intSpinner.valueProperty().addListener(o -&gt; eventCount++);
 311         intSpinner.getEditor().setText(&quot;3&quot;);
 312         // TODO press enter
 313 
 314         assertEquals(1, eventCount);
 315         assertEquals(3, (int) intSpinner.getValue());
 316         assertEquals(&quot;3&quot;, intSpinner.getEditor().getText());
 317     }
 318 
 319     @Ignore(&quot;Need KeyboardEventFirer&quot;)
 320     @Test public void editing_commitInvalidInput() {
 321         intSpinner.valueProperty().addListener(o -&gt; eventCount++);
 322         intSpinner.getEditor().setText(&quot;300&quot;);
 323         // TODO press enter
 324 
 325         assertEquals(2, eventCount);
 326         assertEquals(5, (int) intSpinner.getValue());
 327         assertEquals(&quot;5&quot;, intSpinner.getEditor().getText());
 328     }
 329 
 330 
 331     /***************************************************************************
 332      *                                                                         *
 333      * IntegerSpinnerValueFactory tests                                        *
 334      *                                                                         *
 335      **************************************************************************/
 336 
 337     @Test public void intSpinner_testIncrement_oneStep() {
 338         intValueFactory.increment(1);
 339         assertEquals(6, (int) intValueFactory.getValue());
 340     }
 341 
 342     @Test public void intSpinner_testIncrement_twoSteps() {
 343         intValueFactory.increment(2);
 344         assertEquals(7, (int) intValueFactory.getValue());
 345     }
 346 
 347     @Test public void intSpinner_testIncrement_manyCalls() {
 348         for (int i = 0; i &lt; 100; i++) {
 349             intValueFactory.increment(1);
 350         }
 351         assertEquals(10, (int) intValueFactory.getValue());
 352     }
 353 
 354     @Test public void intSpinner_testIncrement_bigStepPastMaximum() {
 355         intValueFactory.increment(1000);
 356         assertEquals(10, (int) intValueFactory.getValue());
 357     }
 358 
 359     @Test public void intSpinner_testDecrement_oneStep() {
 360         intValueFactory.decrement(1);
 361         assertEquals(4, (int) intValueFactory.getValue());
 362     }
 363 
 364     @Test public void intSpinner_testDecrement_twoSteps() {
 365         intValueFactory.decrement(2);
 366         assertEquals(3, (int) intValueFactory.getValue());
 367     }
 368 
 369     @Test public void intSpinner_testDecrement_manyCalls() {
 370         for (int i = 0; i &lt; 100; i++) {
 371             intValueFactory.decrement(1);
 372         }
 373         assertEquals(0, (int) intValueFactory.getValue());
 374     }
 375 
 376     @Test public void intSpinner_testDecrement_bigStepPastMinimum() {
 377         intValueFactory.decrement(1000);
 378         assertEquals(0, (int) intValueFactory.getValue());
 379     }
 380 
 381     @Test public void intSpinner_testWrapAround_increment_oneStep() {
 382         intValueFactory.setWrapAround(true);
 383         intValueFactory.increment(1); // 6
 384         intValueFactory.increment(1); // 7
 385         intValueFactory.increment(1); // 8
 386         intValueFactory.increment(1); // 9
 387         intValueFactory.increment(1); // 10
 388         intValueFactory.increment(1); // 0
 389         intValueFactory.increment(1); // 1
 390         assertEquals(1, (int) intValueFactory.getValue());
 391     }
 392 
<a name="3" id="anc3"></a>

















































































































































































 393     @Test public void intSpinner_testWrapAround_increment_twoSteps() {
 394         intValueFactory.setWrapAround(true);
 395         intValueFactory.increment(2); // 7
 396         intValueFactory.increment(2); // 9
 397         intValueFactory.increment(2); // 0
 398         intValueFactory.increment(2); // 2
 399         assertEquals(2, (int) intValueFactory.getValue());
 400     }
 401 
 402     @Test public void intSpinner_testWrapAround_decrement_oneStep() {
 403         intValueFactory.setWrapAround(true);
 404         intValueFactory.decrement(1); // 4
 405         intValueFactory.decrement(1); // 3
 406         intValueFactory.decrement(1); // 2
 407         intValueFactory.decrement(1); // 1
 408         intValueFactory.decrement(1); // 0
 409         intValueFactory.decrement(1); // 10
 410         intValueFactory.decrement(1); // 9
 411         assertEquals(9, (int) intValueFactory.getValue());
 412     }
 413 
 414     @Test public void intSpinner_testWrapAround_decrement_twoSteps() {
 415         intValueFactory.setWrapAround(true);
 416         intValueFactory.decrement(2); // 3
 417         intValueFactory.decrement(2); // 1
 418         intValueFactory.decrement(2); // 10
 419         intValueFactory.decrement(2); // 8
 420         assertEquals(8, (int) intValueFactory.getValue());
 421     }
 422 
 423     @Test public void intSpinner_assertDefaultConverterIsNonNull() {
 424         assertNotNull(intValueFactory.getConverter());
 425     }
 426 
 427     @Test public void intSpinner_testToString_valueInRange() {
 428         assertEquals(&quot;3&quot;, intValueFactory.getConverter().toString(3));
 429     }
 430 
 431     @Test public void intSpinner_testToString_valueOutOfRange() {
 432         assertEquals(&quot;300&quot;, intValueFactory.getConverter().toString(300));
 433     }
 434 
 435     @Test public void intSpinner_testFromString_valueInRange() {
 436         assertEquals(3, (int) intValueFactory.getConverter().fromString(&quot;3&quot;));
 437     }
 438 
 439     @Test public void intSpinner_testFromString_valueOutOfRange() {
 440         assertEquals(300, (int) intValueFactory.getConverter().fromString(&quot;300&quot;));
 441     }
 442 
 443     @Test public void intSpinner_testSetMin_doesNotChangeSpinnerValueWhenMinIsLessThanCurrentValue() {
 444         intValueFactory.setValue(5);
 445         assertEquals(5, (int) intSpinner.getValue());
 446         intValueFactory.setMin(3);
 447         assertEquals(5, (int) intSpinner.getValue());
 448     }
 449 
 450     @Test public void intSpinner_testSetMin_changesSpinnerValueWhenMinIsGreaterThanCurrentValue() {
 451         intValueFactory.setValue(0);
 452         assertEquals(0, (int) intSpinner.getValue());
 453         intValueFactory.setMin(5);
 454         assertEquals(5, (int) intSpinner.getValue());
 455     }
 456 
 457     @Test public void intSpinner_testSetMin_ensureThatMinCanNotExceedMax() {
 458         assertEquals(0, intValueFactory.getMin());
 459         assertEquals(10, intValueFactory.getMax());
 460         intValueFactory.setMin(20);
 461         assertEquals(10, intValueFactory.getMin());
 462     }
 463 
 464     @Test public void intSpinner_testSetMin_ensureThatMinCanEqualMax() {
 465         assertEquals(0, intValueFactory.getMin());
 466         assertEquals(10, intValueFactory.getMax());
 467         intValueFactory.setMin(10);
 468         assertEquals(10, intValueFactory.getMin());
 469     }
 470 
 471     @Test public void intSpinner_testSetMax_doesNotChangeSpinnerValueWhenMaxIsGreaterThanCurrentValue() {
 472         intValueFactory.setValue(5);
 473         assertEquals(5, (int) intSpinner.getValue());
 474         intValueFactory.setMax(8);
 475         assertEquals(5, (int) intSpinner.getValue());
 476     }
 477 
 478     @Test public void intSpinner_testSetMax_changesSpinnerValueWhenMaxIsGreaterThanCurrentValue() {
 479         intValueFactory.setValue(5);
 480         assertEquals(5, (int) intSpinner.getValue());
 481         intValueFactory.setMax(3);
 482         assertEquals(3, (int) intSpinner.getValue());
 483     }
 484 
 485     @Test public void intSpinner_testSetMax_ensureThatMaxCanNotGoLessThanMin() {
 486         intValueFactory.setMin(5);
 487         assertEquals(5, intValueFactory.getMin());
 488         assertEquals(10, intValueFactory.getMax());
 489         intValueFactory.setMax(3);
 490         assertEquals(5, intValueFactory.getMin());
 491     }
 492 
 493     @Test public void intSpinner_testSetMax_ensureThatMaxCanEqualMin() {
 494         intValueFactory.setMin(5);
 495         assertEquals(5, intValueFactory.getMin());
 496         assertEquals(10, intValueFactory.getMax());
 497         intValueFactory.setMax(5);
 498         assertEquals(5, intValueFactory.getMin());
 499     }
 500 
 501     @Test public void intSpinner_testSetValue_canNotExceedMax() {
 502         assertEquals(0, intValueFactory.getMin());
 503         assertEquals(10, intValueFactory.getMax());
 504         intValueFactory.setValue(50);
 505         assertEquals(10, (int) intSpinner.getValue());
 506     }
 507 
 508     @Test public void intSpinner_testSetValue_canNotExceedMin() {
 509         assertEquals(0, intValueFactory.getMin());
 510         assertEquals(10, intValueFactory.getMax());
 511         intValueFactory.setValue(-50);
 512         assertEquals(0, (int) intSpinner.getValue());
 513     }
 514 
 515 
 516 
 517     /***************************************************************************
 518      *                                                                         *
 519      * DoubleSpinnerValueFactory tests                                         *
 520      *                                                                         *                                                                         *
 521      **************************************************************************/
 522 
 523     @Test public void dblSpinner_testIncrement_oneStep() {
 524         dblValueFactory.increment(1);
 525         assertEquals(0.55, dblValueFactory.getValue(), 0);
 526     }
 527 
 528     @Test public void dblSpinner_testIncrement_twoSteps() {
 529         dblValueFactory.increment(2);
 530         assertEquals(0.6, dblValueFactory.getValue(), 0);
 531     }
 532 
 533     @Test public void dblSpinner_testIncrement_manyCalls() {
 534         for (int i = 0; i &lt; 100; i++) {
 535             dblValueFactory.increment(1);
 536         }
 537         assertEquals(1.0, dblValueFactory.getValue(), 0);
 538     }
 539 
 540     @Test public void dblSpinner_testIncrement_bigStepPastMaximum() {
 541         dblValueFactory.increment(1000);
 542         assertEquals(1.0, dblValueFactory.getValue(), 0);
 543     }
 544 
 545     @Test public void dblSpinner_testDecrement_oneStep() {
 546         dblValueFactory.decrement(1);
 547         assertEquals(0.45, dblValueFactory.getValue());
 548     }
 549 
 550     @Test public void dblSpinner_testDecrement_twoSteps() {
 551         dblValueFactory.decrement(2);
 552         assertEquals(0.4, dblValueFactory.getValue());
 553     }
 554 
 555     @Test public void dblSpinner_testDecrement_manyCalls() {
 556         for (int i = 0; i &lt; 100; i++) {
 557             dblValueFactory.decrement(1);
 558         }
 559         assertEquals(0, dblValueFactory.getValue(), 0);
 560     }
 561 
 562     @Test public void dblSpinner_testDecrement_bigStepPastMinimum() {
 563         dblValueFactory.decrement(1000);
 564         assertEquals(0, dblValueFactory.getValue(), 0);
 565     }
 566 
 567     @Test public void dblSpinner_testWrapAround_increment_oneStep() {
 568         dblValueFactory.setWrapAround(true);
 569         dblValueFactory.setValue(0.80);
 570         dblValueFactory.increment(1); // 0.85
 571         dblValueFactory.increment(1); // 0.90
 572         dblValueFactory.increment(1); // 0.95
 573         dblValueFactory.increment(1); // 1.00
 574         dblValueFactory.increment(1); // 0.00
 575         dblValueFactory.increment(1); // 0.05
 576         dblValueFactory.increment(1); // 0.10
 577         assertEquals(0.10, dblValueFactory.getValue(), 0);
 578     }
 579 
 580     @Test public void dblSpinner_testWrapAround_increment_twoSteps() {
 581         dblValueFactory.setWrapAround(true);
 582         dblValueFactory.setValue(0.80);
 583         dblValueFactory.increment(2); // 0.90
 584         dblValueFactory.increment(2); // 1.00
 585         dblValueFactory.increment(2); // 0.00
 586         dblValueFactory.increment(2); // 0.10
 587         assertEquals(0.10, dblValueFactory.getValue(), 0);
 588     }
 589 
 590     @Test public void dblSpinner_testWrapAround_decrement_oneStep() {
 591         dblValueFactory.setWrapAround(true);
 592         dblValueFactory.setValue(0.20);
 593         dblValueFactory.decrement(1); // 0.15
 594         dblValueFactory.decrement(1); // 0.10
 595         dblValueFactory.decrement(1); // 0.05
 596         dblValueFactory.decrement(1); // 0.00
 597         dblValueFactory.decrement(1); // 1.00
 598         dblValueFactory.decrement(1); // 0.95
 599         dblValueFactory.decrement(1); // 0.90
 600         assertEquals(0.90, dblValueFactory.getValue(), 0);
 601     }
 602 
 603     @Test public void dblSpinner_testWrapAround_decrement_twoSteps() {
 604         dblValueFactory.setWrapAround(true);
 605         dblValueFactory.setValue(0.20);
 606         dblValueFactory.decrement(2); // 0.10
 607         dblValueFactory.decrement(2); // 0.00
 608         dblValueFactory.decrement(2); // 1.00
 609         dblValueFactory.decrement(2); // 0.90
 610         assertEquals(0.90, dblValueFactory.getValue());
 611     }
 612 
 613     @Test public void dblSpinner_assertDefaultConverterIsNonNull() {
 614         assertNotNull(dblValueFactory.getConverter());
 615     }
 616 
 617     @Test public void dblSpinner_testToString_valueInRange() {
 618         assertEquals(&quot;0.3&quot;, dblValueFactory.getConverter().toString(0.3));
 619     }
 620 
 621     @Test public void dblSpinner_testToString_valueOutOfRange() {
 622         assertEquals(&quot;300&quot;, dblValueFactory.getConverter().toString(300D));
 623     }
 624 
 625     @Test public void dblSpinner_testFromString_valueInRange() {
 626         assertEquals(0.3, dblValueFactory.getConverter().fromString(&quot;0.3&quot;));
 627     }
 628 
 629     @Test public void dblSpinner_testFromString_valueOutOfRange() {
 630         assertEquals(300.0, dblValueFactory.getConverter().fromString(&quot;300&quot;), 0);
 631     }
 632 
 633     @Test public void dblSpinner_testSetMin_doesNotChangeSpinnerValueWhenMinIsLessThanCurrentValue() {
 634         dblValueFactory.setValue(0.5);
 635         assertEquals(0.5, dblSpinner.getValue());
 636         dblValueFactory.setMin(0.3);
 637         assertEquals(0.5, dblSpinner.getValue());
 638     }
 639 
 640     @Test public void dblSpinner_testSetMin_changesSpinnerValueWhenMinIsGreaterThanCurrentValue() {
 641         dblValueFactory.setValue(0.0);
 642         assertEquals(0.0, dblSpinner.getValue());
 643         dblValueFactory.setMin(0.5);
 644         assertEquals(0.5, dblSpinner.getValue());
 645     }
 646 
 647     @Test public void dblSpinner_testSetMin_ensureThatMinCanNotExceedMax() {
 648         assertEquals(0, dblValueFactory.getMin(), 0);
 649         assertEquals(1.0, dblValueFactory.getMax());
 650         dblValueFactory.setMin(20);
 651         assertEquals(1.0, dblValueFactory.getMin());
 652     }
 653 
 654     @Test public void dblSpinner_testSetMin_ensureThatMinCanEqualMax() {
 655         assertEquals(0, dblValueFactory.getMin(), 0);
 656         assertEquals(1.0, dblValueFactory.getMax());
 657         dblValueFactory.setMin(1.0);
 658         assertEquals(1.0, dblValueFactory.getMin());
 659     }
 660 
 661     @Test public void dblSpinner_testSetMax_doesNotChangeSpinnerValueWhenMaxIsGreaterThanCurrentValue() {
 662         dblValueFactory.setValue(0.5);
 663         assertEquals(0.5, dblSpinner.getValue());
 664         dblValueFactory.setMax(0.8);
 665         assertEquals(0.5, dblSpinner.getValue());
 666     }
 667 
 668     @Test public void dblSpinner_testSetMax_changesSpinnerValueWhenMaxIsGreaterThanCurrentValue() {
 669         dblValueFactory.setValue(0.5);
 670         assertEquals(0.5, dblSpinner.getValue());
 671         dblValueFactory.setMax(0.3);
 672         assertEquals(0.3, dblSpinner.getValue());
 673     }
 674 
 675     @Test public void dblSpinner_testSetMax_ensureThatMaxCanNotGoLessThanMin() {
 676         dblValueFactory.setMin(0.5);
 677         assertEquals(0.5, dblValueFactory.getMin());
 678         assertEquals(1.0, dblValueFactory.getMax());
 679         dblValueFactory.setMax(0.3);
 680         assertEquals(0.5, dblValueFactory.getMin());
 681     }
 682 
 683     @Test public void dblSpinner_testSetMax_ensureThatMaxCanEqualMin() {
 684         dblValueFactory.setMin(0.5);
 685         assertEquals(0.5, dblValueFactory.getMin());
 686         assertEquals(1.0, dblValueFactory.getMax());
 687         dblValueFactory.setMax(0.5);
 688         assertEquals(0.5, dblValueFactory.getMin());
 689     }
 690 
 691     @Test public void dblSpinner_testSetValue_canNotExceedMax() {
 692         assertEquals(0, dblValueFactory.getMin(), 0);
 693         assertEquals(1.0, dblValueFactory.getMax());
 694         dblValueFactory.setValue(5.0);
 695         assertEquals(1.0, dblSpinner.getValue());
 696     }
 697 
 698     @Test public void dblSpinner_testSetValue_canNotExceedMin() {
 699         assertEquals(0, dblValueFactory.getMin(), 0);
 700         assertEquals(1.0, dblValueFactory.getMax(), 0);
 701         dblValueFactory.setValue(-5.0);
 702         assertEquals(0, dblSpinner.getValue(), 0);
 703     }
 704 
 705 
 706     /***************************************************************************
 707      *                                                                         *
 708      * ListSpinnerValueFactory tests                                           *
 709      *                                                                         *
 710      **************************************************************************/
 711 
 712     @Test public void listSpinner_testIncrement_oneStep() {
 713         listValueFactory.increment(1);
 714         assertEquals(&quot;string2&quot;, listValueFactory.getValue());
 715     }
 716 
 717     @Test public void listSpinner_testIncrement_twoSteps() {
 718         listValueFactory.increment(2);
 719         assertEquals(&quot;string3&quot;, listValueFactory.getValue());
 720     }
 721 
 722     @Test public void listSpinner_testIncrement_manyCalls() {
 723         for (int i = 0; i &lt; 100; i++) {
 724             listValueFactory.increment(1);
 725         }
 726         assertEquals(&quot;string3&quot;, listValueFactory.getValue());
 727     }
 728 
 729     @Test public void listSpinner_testIncrement_bigStepPastMaximum() {
 730         listValueFactory.increment(1000);
 731         assertEquals(&quot;string3&quot;, listValueFactory.getValue());
 732     }
 733 
 734     @Test public void listSpinner_testDecrement_oneStep() {
 735         listValueFactory.decrement(1);
 736         assertEquals(&quot;string1&quot;, listValueFactory.getValue());
 737     }
 738 
 739     @Test public void listSpinner_testDecrement_twoSteps() {
 740         listValueFactory.decrement(2);
 741         assertEquals(&quot;string1&quot;, listValueFactory.getValue());
 742     }
 743 
 744     @Test public void listSpinner_testDecrement_manyCalls() {
 745         for (int i = 0; i &lt; 100; i++) {
 746             listValueFactory.decrement(1);
 747         }
 748         assertEquals(&quot;string1&quot;, listValueFactory.getValue());
 749     }
 750 
 751     @Test public void listSpinner_testDecrement_bigStepPastMinimum() {
 752         listValueFactory.decrement(1000);
 753         assertEquals(&quot;string1&quot;, listValueFactory.getValue());
 754     }
 755 
 756     @Test public void listSpinner_testWrapAround_increment_oneStep() {
 757         listValueFactory.setWrapAround(true);
 758         listValueFactory.increment(1); // string2
 759         listValueFactory.increment(1); // string3
 760         listValueFactory.increment(1); // string1
 761         listValueFactory.increment(1); // string2
 762         listValueFactory.increment(1); // string3
 763         listValueFactory.increment(1); // string1
 764         listValueFactory.increment(1); // string2
 765         assertEquals(&quot;string2&quot;, listValueFactory.getValue());
 766     }
 767 
 768     @Test public void listSpinner_testWrapAround_increment_twoSteps() {
 769         listValueFactory.setWrapAround(true);
 770         listValueFactory.increment(2); // string1 -&gt; string3
 771         listValueFactory.increment(2); // string3 -&gt; string2
 772         listValueFactory.increment(2); // string2 -&gt; string1
 773         listValueFactory.increment(2); // string1 -&gt; string3
 774         assertEquals(&quot;string3&quot;, listValueFactory.getValue());
 775     }
 776 
 777     @Test public void listSpinner_testWrapAround_decrement_oneStep() {
 778         listValueFactory.setWrapAround(true);
 779         listValueFactory.decrement(1); // string3
 780         listValueFactory.decrement(1); // string2
 781         listValueFactory.decrement(1); // string1
 782         listValueFactory.decrement(1); // string3
 783         listValueFactory.decrement(1); // string2
 784         listValueFactory.decrement(1); // string1
 785         listValueFactory.decrement(1); // string3
 786         assertEquals(&quot;string3&quot;, listValueFactory.getValue());
 787     }
 788 
 789     @Test public void listSpinner_testWrapAround_decrement_twoSteps() {
 790         listValueFactory.setWrapAround(true);
 791         listValueFactory.decrement(2); // string1 -&gt; string2
 792         listValueFactory.decrement(2); // string2 -&gt; string3
 793         listValueFactory.decrement(2); // string3 -&gt; string1
 794         listValueFactory.decrement(2); // string1 -&gt; string2
 795         assertEquals(&quot;string2&quot;, listValueFactory.getValue());
 796     }
 797 
 798     @Test public void listSpinner_assertDefaultConverterIsNonNull() {
 799         assertNotNull(listValueFactory.getConverter());
 800     }
 801 
 802     @Test public void listSpinner_testToString_valueInRange() {
 803         assertEquals(&quot;string2&quot;, listValueFactory.getConverter().toString(&quot;string2&quot;));
 804     }
 805 
 806     @Test public void listSpinner_testToString_valueOutOfRange() {
 807         assertEquals(&quot;string300&quot;, listValueFactory.getConverter().toString(&quot;string300&quot;));
 808     }
 809 
 810     @Test public void listSpinner_testFromString_valueInRange() {
 811         assertEquals(&quot;string3&quot;, listValueFactory.getConverter().fromString(&quot;string3&quot;));
 812     }
 813 
 814     @Test public void listSpinner_testFromString_valueOutOfRange() {
 815         assertEquals(&quot;string300&quot;, listValueFactory.getConverter().fromString(&quot;string300&quot;));
 816     }
 817 
 818     @Test public void listSpinner_testListChange_changeNonSelectedItem() {
 819         assertEquals(&quot;string1&quot;, listSpinner.getValue());
 820 
 821         strings.set(1, &quot;string200&quot;); // change &#39;string2&#39; to &#39;string200&#39;
 822 
 823         // there should be no change
 824         assertEquals(&quot;string1&quot;, listSpinner.getValue());
 825     }
 826 
 827     @Test public void listSpinner_testListChange_changeSelectedItem() {
 828         assertEquals(&quot;string1&quot;, listSpinner.getValue());
 829 
 830         strings.set(0, &quot;string100&quot;); // change &#39;string1&#39; to &#39;string100&#39;
 831 
 832         // the selected value should change
 833         assertEquals(&quot;string100&quot;, listSpinner.getValue());
 834     }
 835 
 836     @Test public void listSpinner_testListChange_changeEntireList_directly() {
 837         assertEquals(&quot;string1&quot;, listSpinner.getValue());
 838 
 839         listValueFactory.getItems().setAll(&quot;newString1&quot;, &quot;newString2&quot;, &quot;newString3&quot;);
 840 
 841         // the selected value should change
 842         assertEquals(&quot;newString1&quot;, listSpinner.getValue());
 843     }
 844 
 845     @Test public void listSpinner_testListChange_changeEntireList_usingSetter() {
 846         assertEquals(&quot;string1&quot;, listSpinner.getValue());
 847 
 848         listValueFactory.setItems(FXCollections.observableArrayList(&quot;newString1&quot;, &quot;newString2&quot;, &quot;newString3&quot;));
 849         assertEquals(&quot;newString1&quot;, listSpinner.getValue());
 850     }
 851 
 852     @Test public void listSpinner_testListChange_setItemsToNull() {
 853         assertEquals(&quot;string1&quot;, listSpinner.getValue());
 854         listValueFactory.setItems(null);
 855         assertNull(listSpinner.getValue());
 856     }
 857 
 858     @Test public void listSpinner_testListChange_setItemsToNonNull() {
 859         assertEquals(&quot;string1&quot;, listSpinner.getValue());
 860         listValueFactory.setItems(null);
 861         assertNull(listSpinner.getValue());
 862 
 863         listValueFactory.setItems(FXCollections.observableArrayList(&quot;newString1&quot;, &quot;newString2&quot;, &quot;newString3&quot;));
 864         assertEquals(&quot;newString1&quot;, listSpinner.getValue());
 865     }
 866 
 867     @Test public void listSpinner_testListChange_setNewEmptyListOverOldEmptyList() {
 868         // this tests the issue where we replace an empty list with another. As
 869         // both empty lists are equal, we are ensuring that the listeners update
 870         // to the new list.
 871         ObservableList&lt;String&gt; firstEmptyList = FXCollections.observableArrayList();
 872         ObservableList&lt;String&gt; newEmptyList = FXCollections.observableArrayList();
 873 
 874         ListSpinnerValueFactory valueFactory = new ListSpinnerValueFactory(firstEmptyList);
 875         Spinner listSpinner = new Spinner(valueFactory);
 876 
 877         valueFactory.setItems(newEmptyList);
 878         assertNull(listSpinner.getValue());
 879 
 880         newEmptyList.addAll(&quot;newString1&quot;, &quot;newString2&quot;, &quot;newString3&quot;);
 881         assertEquals(&quot;newString1&quot;, listSpinner.getValue());
 882     }
 883 
 884 
 885 
 886     /***************************************************************************
 887      *                                                                         *
 888      * LocalDateSpinnerValueFactory tests                                      *
 889      *                                                                         *
 890      **************************************************************************/
 891 
 892     private LocalDate nowPlusDays(int days) {
 893         return LocalDate.now().plus(days, ChronoUnit.DAYS);
 894     }
 895 
 896     @Test public void localDateSpinner_testIncrement_oneStep() {
 897         localDateValueFactory.increment(1);
 898         assertEquals(nowPlusDays(1), localDateValueFactory.getValue());
 899     }
 900 
 901     @Test public void localDateSpinner_testIncrement_twoSteps() {
 902         localDateValueFactory.increment(2);
 903         assertEquals(nowPlusDays(2), localDateValueFactory.getValue());
 904     }
 905 
 906     @Test public void localDateSpinner_testIncrement_manyCalls() {
 907         for (int i = 0; i &lt; 100; i++) {
 908             localDateValueFactory.increment(1);
 909         }
 910         assertEquals(nowPlusDays(10), localDateValueFactory.getValue());
 911     }
 912 
 913     @Test public void localDateSpinner_testIncrement_bigStepPastMaximum() {
 914         localDateValueFactory.increment(1000);
 915         assertEquals(nowPlusDays(10), localDateValueFactory.getValue());
 916     }
 917 
 918     @Test public void localDateSpinner_testDecrement_oneStep() {
 919         localDateValueFactory.decrement(1);
 920         assertEquals(nowPlusDays(-1), localDateValueFactory.getValue());
 921     }
 922 
 923     @Test public void localDateSpinner_testDecrement_twoSteps() {
 924         localDateValueFactory.decrement(2);
 925         assertEquals(nowPlusDays(-2), localDateValueFactory.getValue());
 926     }
 927 
 928     @Test public void localDateSpinner_testDecrement_manyCalls() {
 929         for (int i = 0; i &lt; 100; i++) {
 930             localDateValueFactory.decrement(1);
 931         }
 932         assertEquals(nowPlusDays(-10), localDateValueFactory.getValue());
 933     }
 934 
 935     @Test public void localDateSpinner_testDecrement_bigStepPastMinimum() {
 936         localDateValueFactory.decrement(1000);
 937         assertEquals(nowPlusDays(-10), localDateValueFactory.getValue());
 938     }
 939 
 940     @Test public void localDateSpinner_testWrapAround_increment_oneStep() {
 941         localDateValueFactory.setWrapAround(true);
 942         localDateValueFactory.setValue(nowPlusDays(7));
 943         localDateValueFactory.increment(1); // nowPlusDays(8)
 944         localDateValueFactory.increment(1); // nowPlusDays(9)
 945         localDateValueFactory.increment(1); // nowPlusDays(10)
 946         localDateValueFactory.increment(1); // nowPlusDays(-10)
 947         localDateValueFactory.increment(1); // nowPlusDays(-9)
 948         localDateValueFactory.increment(1); // nowPlusDays(-8)
 949         localDateValueFactory.increment(1); // nowPlusDays(-7)
 950         assertEquals(nowPlusDays(-7), localDateValueFactory.getValue());
 951     }
 952 
 953     @Test public void localDateSpinner_testWrapAround_increment_twoSteps() {
 954         localDateValueFactory.setWrapAround(true);
 955         localDateValueFactory.setValue(nowPlusDays(7));
 956         localDateValueFactory.increment(2); // nowPlusDays(9)
 957         localDateValueFactory.increment(2); // nowPlusDays(-10)
 958         localDateValueFactory.increment(2); // nowPlusDays(-8)
 959         localDateValueFactory.increment(2); // nowPlusDays(-6)
 960         assertEquals(nowPlusDays(-6), localDateValueFactory.getValue());
 961     }
 962 
 963     @Test public void localDateSpinner_testWrapAround_decrement_oneStep() {
 964         localDateValueFactory.setWrapAround(true);
 965         localDateValueFactory.setValue(nowPlusDays(-8));
 966         localDateValueFactory.decrement(1); // nowPlusDays(-9)
 967         localDateValueFactory.decrement(1); // nowPlusDays(-10)
 968         localDateValueFactory.decrement(1); // nowPlusDays(10)
 969         localDateValueFactory.decrement(1); // nowPlusDays(9)
 970         localDateValueFactory.decrement(1); // nowPlusDays(8)
 971         localDateValueFactory.decrement(1); // nowPlusDays(7)
 972         localDateValueFactory.decrement(1); // nowPlusDays(6)
 973         assertEquals(nowPlusDays(6), localDateValueFactory.getValue());
 974     }
 975 
 976     @Test public void localDateSpinner_testWrapAround_decrement_twoSteps() {
 977         localDateValueFactory.setWrapAround(true);
 978         localDateValueFactory.setValue(nowPlusDays(-8));
 979         localDateValueFactory.decrement(2); // nowPlusDays(-10)
 980         localDateValueFactory.decrement(2); // nowPlusDays(9)
 981         localDateValueFactory.decrement(2); // nowPlusDays(7)
 982         localDateValueFactory.decrement(2); // nowPlusDays(6)
 983         assertEquals(nowPlusDays(6), localDateValueFactory.getValue());
 984     }
 985 
 986     @Test public void localDateSpinner_assertDefaultConverterIsNonNull() {
 987         assertNotNull(localDateValueFactory.getConverter());
 988     }
 989 
 990     @Test public void localDateSpinner_testToString_valueInRange() {
 991         assertEquals(&quot;2014-06-27&quot;, localDateValueFactory.getConverter().toString(LocalDate.of(2014, 6, 27)));
 992     }
 993 
 994     @Test public void localDateSpinner_testToString_valueOutOfRange() {
 995         assertEquals(&quot;2024-06-27&quot;, localDateValueFactory.getConverter().toString(LocalDate.of(2024, 6, 27)));
 996     }
 997 
 998     @Test public void localDateSpinner_testFromString_valueInRange() {
 999         assertEquals(LocalDate.of(2014, 6, 27), localDateValueFactory.getConverter().fromString(&quot;2014-06-27&quot;));
1000     }
1001 
1002     @Test public void localDateSpinner_testFromString_valueOutOfRange() {
1003         assertEquals(LocalDate.of(2024, 6, 27), localDateValueFactory.getConverter().fromString(&quot;2024-06-27&quot;));
1004     }
1005 
1006     @Test public void localDateSpinner_testSetMin_doesNotChangeSpinnerValueWhenMinIsLessThanCurrentValue() {
1007         LocalDate newValue = LocalDate.now();
1008         localDateValueFactory.setValue(newValue);
1009         assertEquals(newValue, localDateSpinner.getValue());
1010         SpinnerValueFactoryShim.LocalDate_setMin(localDateValueFactory, nowPlusDays(-3));
1011         assertEquals(newValue, localDateSpinner.getValue());
1012     }
1013 
1014     @Test public void localDateSpinner_testSetMin_changesSpinnerValueWhenMinIsGreaterThanCurrentValue() {
1015         LocalDate newValue = LocalDate.now();
1016         localDateValueFactory.setValue(newValue);
1017         assertEquals(newValue, localDateSpinner.getValue());
1018 
1019         LocalDate twoDaysFromNow = nowPlusDays(2);
1020         SpinnerValueFactoryShim.LocalDate_setMin(localDateValueFactory, twoDaysFromNow);
1021         assertEquals(twoDaysFromNow, localDateSpinner.getValue());
1022     }
1023 
1024     @Test public void localDateSpinner_testSetMin_ensureThatMinCanNotExceedMax() {
1025         assertEquals(nowPlusDays(-10), SpinnerValueFactoryShim.LocalDate_getMin(localDateValueFactory));
1026         assertEquals(nowPlusDays(10), SpinnerValueFactoryShim.LocalDate_getMax(localDateValueFactory));
1027         SpinnerValueFactoryShim.LocalDate_setMin(localDateValueFactory, nowPlusDays(20));
1028         assertEquals(nowPlusDays(10), SpinnerValueFactoryShim.LocalDate_getMax(localDateValueFactory));
1029     }
1030 
1031     @Test public void localDateSpinner_testSetMin_ensureThatMinCanEqualMax() {
1032         assertEquals(nowPlusDays(-10), SpinnerValueFactoryShim.LocalDate_getMin(localDateValueFactory));
1033         assertEquals(nowPlusDays(10), SpinnerValueFactoryShim.LocalDate_getMax(localDateValueFactory));
1034         SpinnerValueFactoryShim.LocalDate_setMin(localDateValueFactory, nowPlusDays(10));
1035         assertEquals(nowPlusDays(10), SpinnerValueFactoryShim.LocalDate_getMax(localDateValueFactory));
1036     }
1037 
1038     @Test public void localDateSpinner_testSetMax_doesNotChangeSpinnerValueWhenMaxIsGreaterThanCurrentValue() {
1039         LocalDate newValue = LocalDate.now();
1040         localDateValueFactory.setValue(newValue);
1041         assertEquals(newValue, localDateSpinner.getValue());
1042         SpinnerValueFactoryShim.LocalDate_setMax(localDateValueFactory, nowPlusDays(2));
1043         assertEquals(newValue, localDateSpinner.getValue());
1044     }
1045 
1046     @Test public void localDateSpinner_testSetMax_changesSpinnerValueWhenMaxIsLessThanCurrentValue() {
1047         LocalDate newValue = nowPlusDays(4);
1048         localDateValueFactory.setValue(newValue);
1049         assertEquals(newValue, localDateSpinner.getValue());
1050 
1051         LocalDate twoDays = nowPlusDays(2);
1052         SpinnerValueFactoryShim.LocalDate_setMax(localDateValueFactory, twoDays);
1053         assertEquals(twoDays, localDateSpinner.getValue());
1054     }
1055 
1056     @Test public void localDateSpinner_testSetMax_ensureThatMaxCanNotGoLessThanMin() {
1057         SpinnerValueFactoryShim.LocalDate_setMin(localDateValueFactory, nowPlusDays(5));
1058         assertEquals(nowPlusDays(5), SpinnerValueFactoryShim.LocalDate_getMin(localDateValueFactory));
1059         assertEquals(nowPlusDays(10), SpinnerValueFactoryShim.LocalDate_getMax(localDateValueFactory));
1060         SpinnerValueFactoryShim.LocalDate_setMax(localDateValueFactory, nowPlusDays(2));
1061         assertEquals(nowPlusDays(5), SpinnerValueFactoryShim.LocalDate_getMax(localDateValueFactory));
1062     }
1063 
1064     @Test public void localDateSpinner_testSetMax_ensureThatMaxCanEqualMin() {
1065         LocalDate twoDays = nowPlusDays(2);
1066         SpinnerValueFactoryShim.LocalDate_setMin(localDateValueFactory, twoDays);
1067         assertEquals(twoDays, SpinnerValueFactoryShim.LocalDate_getMin(localDateValueFactory));
1068         assertEquals(nowPlusDays(10), SpinnerValueFactoryShim.LocalDate_getMax(localDateValueFactory));
1069         SpinnerValueFactoryShim.LocalDate_setMax(localDateValueFactory, twoDays);
1070         assertEquals(twoDays, SpinnerValueFactoryShim.LocalDate_getMax(localDateValueFactory));
1071     }
1072 
1073     @Test public void localDateSpinner_testSetValue_canNotExceedMax() {
1074         assertEquals(nowPlusDays(-10), SpinnerValueFactoryShim.LocalDate_getMin(localDateValueFactory));
1075         assertEquals(nowPlusDays(10), SpinnerValueFactoryShim.LocalDate_getMax(localDateValueFactory));
1076         localDateValueFactory.setValue(nowPlusDays(50));
1077         assertEquals(nowPlusDays(10), localDateSpinner.getValue());
1078     }
1079 
1080     @Test public void localDateSpinner_testSetValue_canNotExceedMin() {
1081         assertEquals(nowPlusDays(-10), SpinnerValueFactoryShim.LocalDate_getMin(localDateValueFactory));
1082         assertEquals(nowPlusDays(10), SpinnerValueFactoryShim.LocalDate_getMax(localDateValueFactory));
1083         localDateValueFactory.setValue(nowPlusDays(-50));
1084         assertEquals(nowPlusDays(-10), localDateSpinner.getValue());
1085     }
1086 
1087 
1088 
1089     /***************************************************************************
1090      *                                                                         *
1091      * LocalTimeSpinnerValueFactory tests                                      *
1092      *                                                                         *
1093      **************************************************************************/
1094 
1095     private LocalTime nowPlusHours(int hours) {
1096         return LocalTime.now().plus(hours, ChronoUnit.HOURS);
1097     }
1098 
1099     private void assertTimeEquals(LocalTime expected, LocalTime actual) {
1100         // just compare hours, minutes and seconds
1101         assertEquals(expected.truncatedTo(ChronoUnit.MINUTES), actual.truncatedTo(ChronoUnit.MINUTES));
1102     }
1103 
1104     @Ignore
1105     @Test public void localTimeSpinner_testIncrement_oneStep() {
1106         localTimeValueFactory.increment(1);
1107         assertTimeEquals(nowPlusHours(1), localTimeValueFactory.getValue());
1108     }
1109 
1110     @Ignore
1111     @Test public void localTimeSpinner_testIncrement_twoSteps() {
1112         localTimeValueFactory.increment(2);
1113         assertTimeEquals(nowPlusHours(2), localTimeValueFactory.getValue());
1114     }
1115 
1116     @Ignore
1117     @Test public void localTimeSpinner_testIncrement_manyCalls() {
1118         for (int i = 0; i &lt; 100; i++) {
1119             localTimeValueFactory.increment(1);
1120         }
1121         assertTimeEquals(LocalTime.MAX, localTimeValueFactory.getValue());
1122     }
1123 
1124     @Ignore
1125     @Test public void localTimeSpinner_testIncrement_bigStepPastMaximum() {
1126         localTimeValueFactory.increment(100000);
1127         assertTimeEquals(LocalTime.MAX, localTimeValueFactory.getValue());
1128     }
1129 
1130     @Ignore
1131     @Test public void localTimeSpinner_testDecrement_oneStep() {
1132         localTimeValueFactory.decrement(1);
1133         assertTimeEquals(nowPlusHours(-1), localTimeValueFactory.getValue());
1134     }
1135 
1136     @Ignore
1137     @Test public void localTimeSpinner_testDecrement_twoSteps() {
1138         localTimeValueFactory.decrement(2);
1139         assertTimeEquals(nowPlusHours(-2), localTimeValueFactory.getValue());
1140     }
1141 
1142     @Ignore
1143     @Test public void localTimeSpinner_testDecrement_manyCalls() {
1144         for (int i = 0; i &lt; 100; i++) {
1145             localTimeValueFactory.decrement(1);
1146         }
1147         assertTimeEquals(LocalTime.MIN, localTimeValueFactory.getValue());
1148     }
1149 
1150     @Ignore
1151     @Test public void localTimeSpinner_testDecrement_bigStepPastMinimum() {
1152         localTimeValueFactory.decrement(100000);
1153         assertTimeEquals(LocalTime.MIN, localTimeValueFactory.getValue());
1154     }
1155 
1156     @Ignore
1157     @Test public void localTimeSpinner_testWrapAround_increment_oneStep() {
1158         localTimeValueFactory.setWrapAround(true);
1159 
1160         LocalTime six_pm = LocalTime.of(18,32);
1161         localTimeValueFactory.setValue(six_pm);
1162         localTimeValueFactory.increment(1); // 19:32
1163         localTimeValueFactory.increment(1); // 20:32
1164         localTimeValueFactory.increment(1); // 21:32
1165         localTimeValueFactory.increment(1); // 22:32
1166         localTimeValueFactory.increment(1); // 23:32
1167         localTimeValueFactory.increment(1); // 00:32
1168         localTimeValueFactory.increment(1); // 01:32
1169         assertTimeEquals(LocalTime.of(01,32), localTimeValueFactory.getValue());
1170     }
1171 
1172     @Ignore
1173     @Test public void localTimeSpinner_testWrapAround_increment_twoSteps() {
1174         localTimeValueFactory.setWrapAround(true);
1175 
1176         LocalTime six_pm = LocalTime.of(18,32);
1177         localTimeValueFactory.setValue(six_pm);
1178         localTimeValueFactory.increment(2); // 20:32
1179         localTimeValueFactory.increment(2); // 22:32
1180         localTimeValueFactory.increment(2); // 00:32
1181         localTimeValueFactory.increment(2); // 02:32
1182         assertTimeEquals(LocalTime.of(02,32), localTimeValueFactory.getValue());
1183     }
1184 
1185     @Test public void localTimeSpinner_testWrapAround_decrement_oneStep() {
1186         localTimeValueFactory.setWrapAround(true);
1187 
1188         LocalTime six_am = LocalTime.of(06,32);
1189         localTimeValueFactory.setValue(six_am);
1190         localTimeValueFactory.decrement(1); // 05:32
1191         localTimeValueFactory.decrement(1); // 04:32
1192         localTimeValueFactory.decrement(1); // 03:32
1193         localTimeValueFactory.decrement(1); // 02:32
1194         localTimeValueFactory.decrement(1); // 01:32
1195         localTimeValueFactory.decrement(1); // 00:32
1196         localTimeValueFactory.decrement(1); // 23:32
1197         assertTimeEquals(LocalTime.of(23,32), localTimeValueFactory.getValue());
1198     }
1199 
1200     @Ignore
1201     @Test public void localTimeSpinner_testWrapAround_decrement_twoSteps() {
1202         localTimeValueFactory.setWrapAround(true);
1203 
1204         LocalTime six_am = LocalTime.of(06,32);
1205         localTimeValueFactory.setValue(six_am);
1206         localTimeValueFactory.decrement(2); // 04:32
1207         localTimeValueFactory.decrement(2); // 02:32
1208         localTimeValueFactory.decrement(2); // 00:32
1209         localTimeValueFactory.decrement(2); // 22:32
1210         assertTimeEquals(LocalTime.of(22,32), localTimeValueFactory.getValue());
1211     }
1212 
1213     @Ignore
1214     @Test public void localTimeSpinner_assertDefaultConverterIsNonNull() {
1215         assertNotNull(localTimeValueFactory.getConverter());
1216     }
1217 
1218     @Ignore(&quot;Not safe when run early in the morning - needs refining when time permits&quot;)
1219     @Test public void localTimeSpinner_testSetMin_doesNotChangeSpinnerValueWhenMinIsLessThanCurrentValue() {
1220         LocalTime newValue = LocalTime.now();
1221         localTimeValueFactory.setValue(newValue);
1222         assertTimeEquals(newValue, localTimeSpinner.getValue());
1223         SpinnerValueFactoryShim.LocalTime_setMin(localTimeValueFactory, nowPlusHours(-3));
1224         assertTimeEquals(newValue, localTimeSpinner.getValue());
1225     }
1226 
1227     @Ignore(&quot;Not safe when late at night - needs refining when time permits&quot;)
1228     @Test public void localTimeSpinner_testSetMin_changesSpinnerValueWhenMinIsGreaterThanCurrentValue() {
1229         LocalTime newValue = LocalTime.now();
1230         localTimeValueFactory.setValue(newValue);
1231         assertTimeEquals(newValue, localTimeSpinner.getValue());
1232 
1233         LocalTime twoDaysFromNow = nowPlusHours(2);
1234         SpinnerValueFactoryShim.LocalTime_setMin(localTimeValueFactory, twoDaysFromNow);
1235         assertTimeEquals(twoDaysFromNow, localTimeSpinner.getValue());
1236     }
1237 
1238     @Test public void localTimeSpinner_testSetMin_ensureThatMinCanEqualMax() {
1239         assertTimeEquals(LocalTime.MIN, SpinnerValueFactoryShim.LocalTime_getMin(localTimeValueFactory));
1240         assertTimeEquals(LocalTime.MAX, SpinnerValueFactoryShim.LocalTime_getMax(localTimeValueFactory));
1241         SpinnerValueFactoryShim.LocalTime_setMin(localTimeValueFactory, LocalTime.MAX);
1242         assertTimeEquals(LocalTime.MAX, SpinnerValueFactoryShim.LocalTime_getMax(localTimeValueFactory));
1243     }
1244 
1245     @Ignore
1246     @Test public void localTimeSpinner_testSetMax_doesNotChangeSpinnerValueWhenMaxIsGreaterThanCurrentValue() {
1247         LocalTime newValue = LocalTime.now();
1248         localTimeValueFactory.setValue(newValue);
1249         assertTimeEquals(newValue, localTimeSpinner.getValue());
1250         SpinnerValueFactoryShim.LocalTime_setMax(localTimeValueFactory, nowPlusHours(2));
1251         assertTimeEquals(newValue, localTimeSpinner.getValue());
1252     }
1253 
1254     @Ignore
1255     @Test public void localTimeSpinner_testSetMax_changesSpinnerValueWhenMaxIsLessThanCurrentValue() {
1256         LocalTime newValue = nowPlusHours(4);
1257         localTimeValueFactory.setValue(newValue);
1258         assertTimeEquals(newValue, localTimeSpinner.getValue());
1259 
1260         LocalTime twoDays = nowPlusHours(2);
1261         SpinnerValueFactoryShim.LocalTime_setMax(localTimeValueFactory, twoDays);
1262         assertTimeEquals(twoDays, localTimeSpinner.getValue());
1263     }
1264 
1265     @Ignore
1266     @Test public void localTimeSpinner_testSetMax_ensureThatMaxCanNotGoLessThanMin() {
1267         SpinnerValueFactoryShim.LocalTime_setMin(localTimeValueFactory, nowPlusHours(5));
1268         assertTimeEquals(nowPlusHours(5), SpinnerValueFactoryShim.LocalTime_getMax(localTimeValueFactory));
1269         assertTimeEquals(LocalTime.MAX, SpinnerValueFactoryShim.LocalTime_getMax(localTimeValueFactory));
1270         SpinnerValueFactoryShim.LocalTime_setMax(localTimeValueFactory, nowPlusHours(2));
1271         assertTimeEquals(nowPlusHours(5), SpinnerValueFactoryShim.LocalTime_getMax(localTimeValueFactory));
1272     }
1273 
1274     @Ignore
1275     @Test public void localTimeSpinner_testSetMax_ensureThatMaxCanEqualMin() {
1276         LocalTime twoDays = nowPlusHours(2);
1277         SpinnerValueFactoryShim.LocalTime_setMin(localTimeValueFactory, twoDays);
1278         assertTimeEquals(twoDays, SpinnerValueFactoryShim.LocalTime_getMax(localTimeValueFactory));
1279         assertTimeEquals(LocalTime.MAX, SpinnerValueFactoryShim.LocalTime_getMax(localTimeValueFactory));
1280         SpinnerValueFactoryShim.LocalTime_setMax(localTimeValueFactory, twoDays);
1281         assertTimeEquals(twoDays, SpinnerValueFactoryShim.LocalTime_getMax(localTimeValueFactory));
1282     }
1283 
1284 
1285     /***************************************************************************
1286      *                                                                         *
1287      * Tests for bugs                                                          *
1288      *                                                                         *
1289      **************************************************************************/
1290 
1291     @Test public void test_rt_39655_decrement() {
1292         assertEquals(5, (int) intSpinner.getValue());
1293         intSpinner.setEditable(true);
1294         intSpinner.getEditor().setText(&quot;7&quot;);
1295         intSpinner.decrement();
1296         assertEquals(6, (int) intSpinner.getValue());
1297     }
1298 
1299     @Test public void test_rt_39655_increment() {
1300         assertEquals(5, (int) intSpinner.getValue());
1301         intSpinner.setEditable(true);
1302         intSpinner.getEditor().setText(&quot;7&quot;);
1303         intSpinner.increment();
1304         assertEquals(8, (int) intSpinner.getValue());
1305     }
1306 
1307     @Test public void test_jdk_8150962() {
1308         Spinner&lt;Double&gt; spinner = new Spinner&lt;&gt;(-100, 100, 0, 0.5);
1309         spinner.getValueFactory().setValue(null);
1310         assertNull(spinner.getValue());
1311     }
1312 
1313     @Test public void test_jdk_8150946_testCommit_valid() {
1314         Spinner&lt;Double&gt; spinner = new Spinner&lt;&gt;(-100, 100, 0, 0.5);
1315         spinner.setEditable(true);
1316         assertEquals(0.0, spinner.getValue());
1317         spinner.getEditor().setText(&quot;2.5&quot;);
1318         spinner.commitValue();
1319         assertEquals(2.5, spinner.getValue());
1320     }
1321 
1322     @Test public void test_jdk_8150946_testCommit_invalid_outOfRange() {
1323         Spinner&lt;Double&gt; spinner = new Spinner&lt;&gt;(-100, 100, 0, 0.5);
1324         spinner.setEditable(true);
1325         assertEquals(0.0, spinner.getValue());
1326         spinner.getEditor().setText(&quot;2500&quot;);
1327         spinner.commitValue();
1328         assertEquals(100.0, spinner.getValue());
1329     }
1330 
1331     @Test(expected = RuntimeException.class)
1332     public void test_jdk_8150946_testCommit_invalid_wrongType() {
1333         Spinner&lt;Double&gt; spinner = new Spinner&lt;&gt;(-100, 100, 0, 0.5);
1334         spinner.setEditable(true);
1335         assertEquals(0.0, spinner.getValue());
1336         spinner.getEditor().setText(&quot;Hello, World!&quot;);
1337         spinner.commitValue();
1338         assertEquals(0.0, spinner.getValue());
1339     }
1340 
1341     @Test public void test_jdk_8150946_testCancel() {
1342         Spinner&lt;Double&gt; spinner = new Spinner&lt;&gt;(-100, 100, 2.5, 0.5);
1343         spinner.setEditable(true);
1344         assertEquals(2.5, spinner.getValue());
1345         assertEquals(&quot;2.5&quot;, spinner.getEditor().getText());
1346         spinner.getEditor().setText(&quot;3.5&quot;);
1347         assertEquals(2.5, spinner.getValue());
1348         spinner.cancelEdit();
1349         assertEquals(2.5, spinner.getValue());
1350         assertEquals(&quot;2.5&quot;, spinner.getEditor().getText());
1351     }
1352 
1353     // Test for JDK-8193311
1354     boolean enterDefaultPass = false;
1355     boolean escapeCancelPass = false;
1356     @Test public void testEnterEscapeKeysWithDefaultCancelButtons() {
1357         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
1358         VBox root = new VBox();
1359         Scene scene = new Scene(root);
1360         Stage stage = new Stage();
1361         stage.setScene(scene);
1362         stage.setWidth(200);
1363         stage.setHeight(200);
1364 
1365         intSpinner.setEditable(true);
1366 
1367         Button defaultButton = new Button(&quot;OK&quot;);
1368         defaultButton.setOnAction(arg0 -&gt; { enterDefaultPass = true; });
1369         defaultButton.setDefaultButton(true);
1370 
1371         Button cancelButton = new Button(&quot;Cancel&quot;);
1372         cancelButton.setOnAction(arg0 -&gt; { escapeCancelPass = true; });
1373         cancelButton.setCancelButton(true);
1374 
1375         root.getChildren().addAll(intSpinner, defaultButton, cancelButton);
1376         stage.show();
1377         intSpinner.requestFocus();
1378         tk.firePulse();
1379 
1380         KeyEventFirer keyboard = new KeyEventFirer(intSpinner);
1381         keyboard.doKeyPress(KeyCode.ENTER);
1382         keyboard.doKeyPress(KeyCode.ESCAPE);
1383         tk.firePulse();
1384 
1385         if (!enterDefaultPass || !escapeCancelPass) {
1386             stage.hide();
1387         }
1388 
1389         String defMsg = &quot;OnAction EventHandler of the default &#39;OK&#39; &quot; +
1390             &quot;button should get invoked on ENTER key press.&quot;;
1391         String canMsg = &quot;OnAction EventHandler of the cancel &#39;Cancel&#39; &quot; +
1392             &quot;button should get invoked on ESCAPE key press.&quot;;
1393 
1394         assertTrue(defMsg, enterDefaultPass);
1395         assertTrue(canMsg, escapeCancelPass);
1396 
1397         // Same test with non editable spinner.
1398         intSpinner.setEditable(false);
1399         enterDefaultPass = false;
1400         escapeCancelPass = false;
1401         keyboard.doKeyPress(KeyCode.ENTER);
1402         keyboard.doKeyPress(KeyCode.ESCAPE);
1403         tk.firePulse();
1404         stage.hide();
1405 
1406         assertTrue(defMsg, enterDefaultPass);
1407         assertTrue(canMsg, escapeCancelPass);
1408     }
1409 
1410     @Test public void spinnerDelayTest() {
1411         Spinner&lt;Double&gt; spinner = new Spinner&lt;&gt;(-100, 100, 2.5, 0.5);
1412 
1413         spinner.setInitialDelay(null);
1414         assertEquals(300.0, spinner.getInitialDelay().toMillis(), 0.001);
1415         spinner.setInitialDelay(new Duration(500));
1416         assertEquals(500.0, spinner.getInitialDelay().toMillis(), 0.001);
1417 
1418         spinner.setRepeatDelay(null);
1419         assertEquals(60.0, spinner.getRepeatDelay().toMillis(), 0.001);
1420         spinner.setRepeatDelay(new Duration(200));
1421         assertEquals(200.0, spinner.getRepeatDelay().toMillis(), 0.001);
1422 
1423         spinner.setStyle(&quot;-fx-initial-delay: 400ms; -fx-repeat-delay: 100ms&quot;);
1424         FlowPane root = new FlowPane();
1425         root.getChildren().addAll(spinner);
1426         Scene scene = new Scene(root, 150, 150);
1427         scene.getRoot().applyCss();
1428 
1429         assertEquals(400.0, spinner.getInitialDelay().toMillis(), 0.001);
1430         assertEquals(100.0, spinner.getRepeatDelay().toMillis(), 0.001);
1431     }
1432 
1433     // Test for JDK-8185937
1434     @Test public void testIncDecKeys() {
1435         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
1436         VBox root = new VBox();
1437         Scene scene = new Scene(root);
1438         Stage stage = new Stage();
1439         stage.setScene(scene);
1440         stage.setWidth(200);
1441         stage.setHeight(200);
1442 
1443         Spinner&lt;Integer&gt; spinner = new Spinner&lt;&gt;(-100, 100, 0);
1444         spinner.setEditable(true);
1445         assertEquals(0, spinner.getValue().intValue());
1446 
1447         try {
1448             root.getChildren().addAll(spinner);
1449             stage.show();
1450             spinner.requestFocus();
1451             tk.firePulse();
1452 
1453             KeyEventFirer keyboard = new KeyEventFirer(spinner.getEditor());
1454             keyboard.doKeyPress(KeyCode.UP);
1455             tk.firePulse();
1456 
1457             assertEquals(1, spinner.getValue().intValue());
1458 
1459             keyboard.doKeyPress(KeyCode.DOWN);
1460             tk.firePulse();
1461 
1462             assertEquals(0, spinner.getValue().intValue());
1463         } finally {
1464             stage.hide();
1465         }
1466     }
1467 }
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>