<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff tests/system/src/test/java/test/robot/javafx/embed/swing/JFXPanelScaledTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../../../modules/javafx.swt/src/main/java/javafx/embed/swt/FXCanvas.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>tests/system/src/test/java/test/robot/javafx/embed/swing/JFXPanelScaledTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -49,103 +49,103 @@</span>
  import javafx.scene.Scene;
  import javafx.scene.layout.Region;
  import junit.framework.AssertionFailedError;
  
  public class JFXPanelScaledTest {
<span class="udiff-line-modified-removed">- 	static CountDownLatch launchLatch;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	private static MyApp myApp;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	private static Timer t;</span>
<span class="udiff-line-modified-removed">- 	static int cnt;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	@BeforeClass</span>
<span class="udiff-line-modified-removed">- 	public static void setupOnce() throws Exception {</span>
<span class="udiff-line-modified-removed">- 		System.setProperty(&quot;sun.java2d.uiScale.enabled&quot;, &quot;true&quot;);</span>
<span class="udiff-line-modified-removed">- 		System.setProperty(&quot;sun.java2d.uiScale&quot;, &quot;125%&quot;);</span>
<span class="udiff-line-modified-removed">- 		System.setProperty(&quot;glass.win.uiScale&quot;, &quot;1.25&quot;);</span>
<span class="udiff-line-modified-removed">- 		System.setProperty(&quot;glass.gtk.uiScale&quot;, &quot;1.25&quot;);</span>
<span class="udiff-line-modified-removed">- 		launchLatch = new CountDownLatch(1);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		// Start the Application</span>
<span class="udiff-line-modified-removed">- 		SwingUtilities.invokeLater(() -&gt; {</span>
<span class="udiff-line-modified-removed">- 			myApp = new MyApp();</span>
<span class="udiff-line-modified-removed">- 		});</span>
<span class="udiff-line-modified-removed">- 		if (!launchLatch.await(5 * TIMEOUT, TimeUnit.MILLISECONDS)) {</span>
<span class="udiff-line-modified-removed">- 			throw new AssertionFailedError(&quot;Timeout waiting for Application to launch (&quot; + (5 * TIMEOUT) + &quot; seconds)&quot;);</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	@AfterClass</span>
<span class="udiff-line-modified-removed">- 	public static void teardownOnce() {</span>
<span class="udiff-line-modified-removed">- 		if (myApp != null) {</span>
<span class="udiff-line-modified-removed">- 			SwingUtilities.invokeLater(myApp::dispose);</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	@Test</span>
<span class="udiff-line-modified-removed">- 	public void testScale() throws Exception {</span>
<span class="udiff-line-modified-removed">- 		// Get the Swing-side BackBuffer</span>
<span class="udiff-line-modified-removed">- 		BufferedImage pixelsIm = JFXPanelShim.getPixelsIm(myApp.jfxPanel);</span>
<span class="udiff-line-modified-removed">- 		assertEquals(127, pixelsIm.getWidth());</span>
<span class="udiff-line-modified-removed">- 		assertEquals(127, pixelsIm.getHeight());</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		// if all is ok, there is a black border on the right side</span>
<span class="udiff-line-modified-removed">- 		// if the buffer is off, there is a black diagonal which should be the right</span>
<span class="udiff-line-modified-removed">- 		// border</span>
<span class="udiff-line-modified-removed">- 		Color c = new Color(0, 0, 0);</span>
<span class="udiff-line-modified-removed">- 		int colorOfDiagonal = c.getRGB();</span>
<span class="udiff-line-modified-removed">- 		for (int x = 10; x &lt; 45; x++) {</span>
<span class="udiff-line-modified-removed">- 			for (int y = 90; y &lt; 115; y++) {</span>
<span class="udiff-line-modified-removed">- 				if (colorOfDiagonal == pixelsIm.getRGB(x, y)) {</span>
<span class="udiff-line-modified-removed">- 					fail(&quot;image is skewed&quot;);</span>
<span class="udiff-line-modified-removed">- 				}</span>
<span class="udiff-line-modified-removed">- 			}</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	public static class MyApp extends JFrame {</span>
<span class="udiff-line-modified-removed">- 		private static final long serialVersionUID = 1L;</span>
<span class="udiff-line-modified-removed">- 		private final JFXPanel jfxPanel;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		public MyApp() {</span>
<span class="udiff-line-modified-removed">- 			super(&quot;JFXPanel Scaling&quot;);</span>
<span class="udiff-line-modified-removed">- 			jfxPanel = new JFXPanel();</span>
<span class="udiff-line-modified-removed">- 			setLayout(null);</span>
<span class="udiff-line-modified-removed">- 			jfxPanel.setSize(new Dimension(100, 100));</span>
<span class="udiff-line-modified-removed">- 			add(jfxPanel);</span>
<span class="udiff-line-modified-removed">- 			setSize(500, 500);</span>
<span class="udiff-line-modified-removed">- 			setVisible(true);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 			Platform.runLater(() -&gt; initFX(jfxPanel));</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 			// Give it time to paint and resize the buffers</span>
<span class="udiff-line-modified-removed">- 			// the issues only appears if the buffer has been resized, not on the initial</span>
<span class="udiff-line-modified-removed">- 			// creation.</span>
<span class="udiff-line-modified-removed">- 			cnt = 0;</span>
<span class="udiff-line-modified-removed">- 			t = new Timer(500, (e) -&gt; {</span>
<span class="udiff-line-modified-removed">- 				switch (cnt) {</span>
<span class="udiff-line-modified-removed">- 				case 0:</span>
<span class="udiff-line-modified-removed">- 					jfxPanel.setSize(new Dimension(201, 201));</span>
<span class="udiff-line-modified-removed">- 					break;</span>
<span class="udiff-line-modified-removed">- 				case 1:</span>
<span class="udiff-line-modified-removed">- 					jfxPanel.setSize(new Dimension(101, 101));</span>
<span class="udiff-line-modified-removed">- 					break;</span>
<span class="udiff-line-modified-removed">- 				case 2:</span>
<span class="udiff-line-modified-removed">- 					t.stop();</span>
<span class="udiff-line-modified-removed">- 					launchLatch.countDown();</span>
<span class="udiff-line-modified-removed">- 					break;</span>
<span class="udiff-line-modified-removed">- 				}</span>
<span class="udiff-line-modified-removed">- 				cnt++;</span>
<span class="udiff-line-modified-removed">- 			});</span>
<span class="udiff-line-modified-removed">- 			t.start();</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		private static void initFX(JFXPanel fxPanel) {</span>
<span class="udiff-line-modified-removed">- 			Region region = new Region();</span>
<span class="udiff-line-modified-removed">- 			region.setStyle(&quot;-fx-background-color: #FFFFFF;&quot; + &quot;-fx-border-color: #000000;&quot;</span>
<span class="udiff-line-modified-removed">- 					+ &quot;-fx-border-width: 0 5px 0 0;&quot; + &quot;-fx-border-style: solid&quot;);</span>
<span class="udiff-line-modified-removed">- 			Scene scene = new Scene(region);</span>
<span class="udiff-line-modified-removed">- 			fxPanel.setScene(scene);</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+     static CountDownLatch launchLatch;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private static MyApp myApp;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private static Timer t;</span>
<span class="udiff-line-modified-added">+     static int cnt;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     @BeforeClass</span>
<span class="udiff-line-modified-added">+     public static void setupOnce() throws Exception {</span>
<span class="udiff-line-modified-added">+         System.setProperty(&quot;sun.java2d.uiScale.enabled&quot;, &quot;true&quot;);</span>
<span class="udiff-line-modified-added">+         System.setProperty(&quot;sun.java2d.uiScale&quot;, &quot;125%&quot;);</span>
<span class="udiff-line-modified-added">+         System.setProperty(&quot;glass.win.uiScale&quot;, &quot;1.25&quot;);</span>
<span class="udiff-line-modified-added">+         System.setProperty(&quot;glass.gtk.uiScale&quot;, &quot;1.25&quot;);</span>
<span class="udiff-line-modified-added">+         launchLatch = new CountDownLatch(1);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         // Start the Application</span>
<span class="udiff-line-modified-added">+         SwingUtilities.invokeLater(() -&gt; {</span>
<span class="udiff-line-modified-added">+             myApp = new MyApp();</span>
<span class="udiff-line-modified-added">+         });</span>
<span class="udiff-line-modified-added">+         if (!launchLatch.await(5 * TIMEOUT, TimeUnit.MILLISECONDS)) {</span>
<span class="udiff-line-modified-added">+             throw new AssertionFailedError(&quot;Timeout waiting for Application to launch (&quot; + (5 * TIMEOUT) + &quot; seconds)&quot;);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     @AfterClass</span>
<span class="udiff-line-modified-added">+     public static void teardownOnce() {</span>
<span class="udiff-line-modified-added">+         if (myApp != null) {</span>
<span class="udiff-line-modified-added">+             SwingUtilities.invokeLater(myApp::dispose);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     @Test</span>
<span class="udiff-line-modified-added">+     public void testScale() throws Exception {</span>
<span class="udiff-line-modified-added">+         // Get the Swing-side BackBuffer</span>
<span class="udiff-line-modified-added">+         BufferedImage pixelsIm = JFXPanelShim.getPixelsIm(myApp.jfxPanel);</span>
<span class="udiff-line-modified-added">+         assertEquals(127, pixelsIm.getWidth());</span>
<span class="udiff-line-modified-added">+         assertEquals(127, pixelsIm.getHeight());</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         // if all is ok, there is a black border on the right side</span>
<span class="udiff-line-modified-added">+         // if the buffer is off, there is a black diagonal which should be the right</span>
<span class="udiff-line-modified-added">+         // border</span>
<span class="udiff-line-modified-added">+         Color c = new Color(0, 0, 0);</span>
<span class="udiff-line-modified-added">+         int colorOfDiagonal = c.getRGB();</span>
<span class="udiff-line-modified-added">+         for (int x = 10; x &lt; 45; x++) {</span>
<span class="udiff-line-modified-added">+             for (int y = 90; y &lt; 115; y++) {</span>
<span class="udiff-line-modified-added">+                 if (colorOfDiagonal == pixelsIm.getRGB(x, y)) {</span>
<span class="udiff-line-modified-added">+                     fail(&quot;image is skewed&quot;);</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     public static class MyApp extends JFrame {</span>
<span class="udiff-line-modified-added">+         private static final long serialVersionUID = 1L;</span>
<span class="udiff-line-modified-added">+         private final JFXPanel jfxPanel;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         public MyApp() {</span>
<span class="udiff-line-modified-added">+             super(&quot;JFXPanel Scaling&quot;);</span>
<span class="udiff-line-modified-added">+             jfxPanel = new JFXPanel();</span>
<span class="udiff-line-modified-added">+             setLayout(null);</span>
<span class="udiff-line-modified-added">+             jfxPanel.setSize(new Dimension(100, 100));</span>
<span class="udiff-line-modified-added">+             add(jfxPanel);</span>
<span class="udiff-line-modified-added">+             setSize(500, 500);</span>
<span class="udiff-line-modified-added">+             setVisible(true);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+             Platform.runLater(() -&gt; initFX(jfxPanel));</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+             // Give it time to paint and resize the buffers</span>
<span class="udiff-line-modified-added">+             // the issues only appears if the buffer has been resized, not on the initial</span>
<span class="udiff-line-modified-added">+             // creation.</span>
<span class="udiff-line-modified-added">+             cnt = 0;</span>
<span class="udiff-line-modified-added">+             t = new Timer(500, (e) -&gt; {</span>
<span class="udiff-line-modified-added">+                 switch (cnt) {</span>
<span class="udiff-line-modified-added">+                 case 0:</span>
<span class="udiff-line-modified-added">+                     jfxPanel.setSize(new Dimension(201, 201));</span>
<span class="udiff-line-modified-added">+                     break;</span>
<span class="udiff-line-modified-added">+                 case 1:</span>
<span class="udiff-line-modified-added">+                     jfxPanel.setSize(new Dimension(101, 101));</span>
<span class="udiff-line-modified-added">+                     break;</span>
<span class="udiff-line-modified-added">+                 case 2:</span>
<span class="udiff-line-modified-added">+                     t.stop();</span>
<span class="udiff-line-modified-added">+                     launchLatch.countDown();</span>
<span class="udiff-line-modified-added">+                     break;</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+                 cnt++;</span>
<span class="udiff-line-modified-added">+             });</span>
<span class="udiff-line-modified-added">+             t.start();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         private static void initFX(JFXPanel fxPanel) {</span>
<span class="udiff-line-modified-added">+             Region region = new Region();</span>
<span class="udiff-line-modified-added">+             region.setStyle(&quot;-fx-background-color: #FFFFFF;&quot; + &quot;-fx-border-color: #000000;&quot;</span>
<span class="udiff-line-modified-added">+                     + &quot;-fx-border-width: 0 5px 0 0;&quot; + &quot;-fx-border-style: solid&quot;);</span>
<span class="udiff-line-modified-added">+             Scene scene = new Scene(region);</span>
<span class="udiff-line-modified-added">+             fxPanel.setScene(scene);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+     }</span>
  }
</pre>
<center><a href="../../../../../../../../../../modules/javafx.swt/src/main/java/javafx/embed/swt/FXCanvas.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>