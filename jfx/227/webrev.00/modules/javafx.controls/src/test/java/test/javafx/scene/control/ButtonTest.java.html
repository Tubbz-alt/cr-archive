<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.controls/src/test/java/test/javafx/scene/control/ButtonTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2010, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package test.javafx.scene.control;
 27 
 28 import javafx.beans.property.BooleanProperty;
 29 import javafx.beans.property.SimpleBooleanProperty;
 30 import javafx.event.ActionEvent;
 31 import javafx.event.EventHandler;
 32 import javafx.scene.Scene;
 33 import javafx.scene.input.KeyCode;
 34 import javafx.scene.input.MouseButton;
 35 import javafx.scene.layout.BackgroundFill;
 36 import javafx.scene.layout.HBox;
 37 import javafx.scene.layout.Region;
 38 import javafx.scene.layout.StackPane;
 39 import javafx.scene.paint.LinearGradient;
 40 import javafx.scene.paint.Stop;
 41 import javafx.scene.shape.Rectangle;
 42 import javafx.stage.Stage;
 43 import javafx.stage.WindowEvent;
 44 import java.util.List;
 45 import test.com.sun.javafx.pgstub.StubToolkit;
 46 import test.com.sun.javafx.scene.control.infrastructure.ContextMenuEventFirer;
 47 import test.com.sun.javafx.scene.control.infrastructure.KeyEventFirer;
 48 import test.com.sun.javafx.scene.control.infrastructure.MouseEventFirer;
 49 import com.sun.javafx.tk.Toolkit;
 50 import javafx.scene.control.Button;
 51 import javafx.scene.control.ContextMenu;
 52 import javafx.scene.control.MenuItem;
 53 import javafx.scene.control.Skin;
 54 import org.junit.Before;
 55 import org.junit.After;
 56 import org.junit.Test;
 57 import static test.com.sun.javafx.scene.control.infrastructure.ControlTestUtils.assertPseudoClassDoesNotExist;
 58 import static test.com.sun.javafx.scene.control.infrastructure.ControlTestUtils.assertPseudoClassExists;
 59 import static test.com.sun.javafx.scene.control.infrastructure.ControlTestUtils.assertStyleClassContains;
 60 import static org.junit.Assert.assertEquals;
 61 import static org.junit.Assert.assertFalse;
 62 import static org.junit.Assert.assertNull;
 63 import static org.junit.Assert.assertSame;
 64 import static org.junit.Assert.assertTrue;
 65 import static org.junit.Assert.fail;
 66 
 67 //import com.sun.javafx.test.MouseEventGenerator;
 68 
 69 /**
 70  * action (which can be bound, and can be null),
 71  * and that action is called when the button is fired.
 72  */
 73 public class ButtonTest {
 74     private Button btn;
 75     private Toolkit tk;
 76     private Scene scene;
 77     private Stage stage;
 78     private StackPane root;
 79     private MouseEventFirer mouse;
 80 
 81     @Before public void setup() {
 82         btn = new Button();
 83         tk = (StubToolkit)Toolkit.getToolkit();//This step is not needed (Just to make sure StubToolkit is loaded into VM)
 84         root = new StackPane();
 85         scene = new Scene(root);
 86         stage = new Stage();
 87         stage.setScene(scene);
 88         mouse = new MouseEventFirer(btn);
 89     }
 90 
 91     @After public void after() {
 92         stage.hide();
 93         mouse.dispose();
 94     }
 95 
 96     /*********************************************************************
 97      * Helper methods                                                    *
 98      ********************************************************************/
 99     private void show() {
100         stage.show();
101     }
102 
103     /*********************************************************************
104      * Tests for the constructors                                        *
105      ********************************************************************/
106 
107     @Test public void defaultConstructorShouldHaveNoGraphicAndEmptyString() {
108         assertNull(btn.getGraphic());
109         assertEquals(&quot;&quot;, btn.getText());
110     }
111 
112     @Test public void oneArgConstructorShouldHaveNoGraphicAndSpecifiedString() {
113         Button b2 = new Button(null);
114         assertNull(b2.getGraphic());
115         assertNull(b2.getText());
116 
117         b2 = new Button(&quot;&quot;);
118         assertNull(b2.getGraphic());
119         assertEquals(&quot;&quot;, b2.getText());
120 
121         b2 = new Button(&quot;Hello&quot;);
122         assertNull(b2.getGraphic());
123         assertEquals(&quot;Hello&quot;, b2.getText());
124     }
125 
126     @Test public void twoArgConstructorShouldHaveSpecifiedGraphicAndSpecifiedString() {
127         Button b2 = new Button(null, null);
128         assertNull(b2.getGraphic());
129         assertNull(b2.getText());
130 
131         Rectangle rect = new Rectangle();
132         b2 = new Button(&quot;Hello&quot;, rect);
133         assertSame(rect, b2.getGraphic());
134         assertEquals(&quot;Hello&quot;, b2.getText());
135     }
136 
137     @Test public void defaultConstructorShouldSetStyleClassTo_button() {
138         assertStyleClassContains(btn, &quot;button&quot;);
139     }
140 
141     @Test public void oneArgConstructorShouldSetStyleClassTo_button() {
142         Button b2 = new Button(null);
143         assertStyleClassContains(b2, &quot;button&quot;);
144     }
145 
146     @Test public void twoArgConstructorShouldSetStyleClassTo_button() {
147         Button b2 = new Button(null, null);
148         assertStyleClassContains(b2, &quot;button&quot;);
149     }
150 
151     /*********************************************************************
152      * Tests for the defaultButton state                                 *
153      ********************************************************************/
154 
155     @Test public void defaultButtonIsFalseByDefault() {
156         assertFalse(btn.isDefaultButton());
157         assertFalse(btn.defaultButtonProperty().getValue());
158     }
159 
160     @Test public void defaultButtonCanBeSet() {
161         btn.setDefaultButton(true);
162         assertTrue(btn.isDefaultButton());
163     }
164 
165     @Test public void defaultButtonSetToNonDefaultValueIsReflectedInModel() {
166         btn.setDefaultButton(true);
167         assertTrue(btn.defaultButtonProperty().getValue());
168     }
169 
170     @Test public void defaultButtonCanBeCleared() {
171         btn.setDefaultButton(true);
172         btn.setDefaultButton(false);
173         assertFalse(btn.isDefaultButton());
174     }
175 
176     @Test public void defaultButtonCanBeBound() {
177         BooleanProperty other = new SimpleBooleanProperty(true);
178         btn.defaultButtonProperty().bind(other);
179         assertTrue(btn.isDefaultButton());
180     }
181 
182     @Test public void settingDefaultButtonSetsPseudoClass() {
183         btn.setDefaultButton(true);
184         assertPseudoClassExists(btn, &quot;default&quot;);
185     }
186 
187     @Test public void clearingDefaultButtonClearsPseudoClass() {
188         btn.setDefaultButton(true);
189         btn.setDefaultButton(false);
190         assertPseudoClassDoesNotExist(btn, &quot;default&quot;);
191     }
192 
193     @Test public void defaultButtonSetToTrueViaBindingSetsPseudoClass() {
194         BooleanProperty other = new SimpleBooleanProperty(true);
195         btn.defaultButtonProperty().bind(other);
196         assertPseudoClassExists(btn, &quot;default&quot;);
197     }
198 
199     @Test public void defaultButtonSetToFalseViaBindingClearsPseudoClass() {
200         BooleanProperty other = new SimpleBooleanProperty(true);
201         btn.defaultButtonProperty().bind(other);
202         other.setValue(false);
203         assertPseudoClassDoesNotExist(btn, &quot;default&quot;);
204     }
205 
206     @Test public void cannotSpecifyDefaultButtonViaCSS() {
207         // By default, &#39;btn&#39; is not a default button
208         // Making it a default button via CSS should not succeed
209         btn.setStyle(&quot;-fx-default-button: true;&quot;);
210         btn.applyCss();
211         assertFalse(btn.isDefaultButton());
212 
213         // Set button to be a default button
214         btn.setDefaultButton(true);
215         assertTrue(btn.isDefaultButton());
216 
217         // Making it a non-default button via CSS should not succeed
218         btn.setStyle(&quot;-fx-default-button: false;&quot;);
219         btn.applyCss();
220         assertTrue(btn.isDefaultButton());
221     }
222 
223     @Test public void defaultButtonPropertyHasBeanReference() {
224         assertSame(btn, btn.defaultButtonProperty().getBean());
225     }
226 
227     @Test public void defaultButtonPropertyHasName() {
228         assertEquals(&quot;defaultButton&quot;, btn.defaultButtonProperty().getName());
229     }
230 
231     @Test public void disabledDefaultButtonCannotGetInvoked_RT20929() {
232         root.getChildren().add(btn);
233 
234         btn.setOnAction(actionEvent -&gt; {
235             fail();
236         });
237 
238         btn.setDefaultButton(true);
239         btn.setDisable(true);
240         show();
241 
242         KeyEventFirer keyboard = new KeyEventFirer(btn);
243         keyboard.doKeyPress(KeyCode.ENTER);
244 
245         tk.firePulse();
246     }
247 
248     @Test public void defaultButtonCanBeInvokeAfterRemovingFromTheScene_RT22106() {
249         btn.setDefaultButton(true);
250         btn.setOnAction(actionEvent -&gt; {
251             fail();
252         });
253         root.getChildren().add(btn);
254         show();
255 
256         root.getChildren().remove(btn);
257 
258         KeyEventFirer keyboard = new KeyEventFirer(root);
259         keyboard.doKeyPress(KeyCode.ENTER);
260 
261         tk.firePulse();
262     }
263 
264     // Test for JDK-8209938
265     @Test public void defaultButtonSceneAccelerators() {
266         assertEquals(&quot;Scene.getAccelerators() should contain no accelerators.&quot;,
267             0, scene.getAccelerators().size());
268 
269         HBox btnParent = new HBox();
270         btnParent.getChildren().add(btn);
271         root.getChildren().add(btnParent);
272         btn.setDefaultButton(true);
273         show();
274         assertEquals(&quot;Scene.getAccelerators() should contain one accelerator&quot; +
275             &quot; for Default button.&quot;, 1, scene.getAccelerators().size());
276 
277         root.getChildren().remove(btnParent);
278         assertEquals(&quot;Default button accelerator should be removed from&quot; +
279             &quot; Scene.getAccelerators().&quot;, 0, scene.getAccelerators().size());
280 
281         tk.firePulse();
282     }
283 
284     /*********************************************************************
285      * Tests for the cancelButton state                                 *
286      ********************************************************************/
287 
288     @Test public void cancelButtonIsFalseByDefault() {
289         assertFalse(btn.isCancelButton());
290         assertFalse(btn.cancelButtonProperty().getValue());
291     }
292 
293     @Test public void cancelButtonCanBeSet() {
294         btn.setCancelButton(true);
295         assertTrue(btn.isCancelButton());
296     }
297 
298     @Test public void cancelButtonSetToNonDefaultValueIsReflectedInModel() {
299         btn.setCancelButton(true);
300         assertTrue(btn.cancelButtonProperty().getValue());
301     }
302 
303     @Test public void cancelButtonCanBeCleared() {
304         btn.setCancelButton(true);
305         btn.setCancelButton(false);
306         assertFalse(btn.isCancelButton());
307     }
308 
309     @Test public void cancelButtonCanBeBound() {
310         BooleanProperty other = new SimpleBooleanProperty(true);
311         btn.cancelButtonProperty().bind(other);
312         assertTrue(btn.isCancelButton());
313     }
314 
315     @Test public void settingCancelButtonSetsPseudoClass() {
316         btn.setCancelButton(true);
317         assertPseudoClassExists(btn, &quot;cancel&quot;);
318     }
319 
320     @Test public void clearingCancelButtonClearsPseudoClass() {
321         btn.setCancelButton(true);
322         btn.setCancelButton(false);
323         assertPseudoClassDoesNotExist(btn, &quot;cancel&quot;);
324     }
325 
326     @Test public void cancelButtonSetToTrueViaBindingSetsPseudoClass() {
327         BooleanProperty other = new SimpleBooleanProperty(true);
328         btn.cancelButtonProperty().bind(other);
329         assertPseudoClassExists(btn, &quot;cancel&quot;);
330     }
331 
332     @Test public void cancelButtonSetToFalseViaBindingClearsPseudoClass() {
333         BooleanProperty other = new SimpleBooleanProperty(true);
334         btn.cancelButtonProperty().bind(other);
335         other.setValue(false);
336         assertPseudoClassDoesNotExist(btn, &quot;cancel&quot;);
337     }
338 
339     // Test for JDK-8209938
340     @Test public void cancelButtonSceneAccelerators() {
341         assertEquals(&quot;Scene.getAccelerators() should contain no accelerators.&quot;,
342             0, scene.getAccelerators().size());
343 
344         HBox btnParent = new HBox();
345         btnParent.getChildren().add(btn);
346         root.getChildren().add(btnParent);
347         btn.setCancelButton(true);
348         show();
349         assertEquals(&quot;Scene.getAccelerators() should contain one accelerator&quot; +
350             &quot; for Cancel button.&quot;, 1, scene.getAccelerators().size());
351 
352         root.getChildren().remove(btnParent);
353         assertEquals(&quot;Cancel button accelerator should be removed from&quot; +
354             &quot; Scene.getAccelerators().&quot;, 0, scene.getAccelerators().size());
355 
356         tk.firePulse();
357     }
358 
359     @Test public void cannotSpecifyCancelButtonViaCSS() {
360         // By default, &#39;btn&#39; is not a cancel button
361         // Making it a cancel button via CSS should not succeed
362         btn.setStyle(&quot;-fx-cancel-button: true;&quot;);
363         btn.applyCss();
364         assertFalse(btn.isCancelButton());
365 
366         // Make button a cancel-button
367         btn.setCancelButton(true);
368         assertTrue(btn.isCancelButton());
369 
370         // Making it a non-cancel button via CSS should not succeed
371         btn.setStyle(&quot;-fx-cancel-button: false;&quot;);
372         btn.applyCss();
373         assertTrue(btn.isCancelButton());
374     }
375 
376     @Test public void cancelButtonPropertyHasBeanReference() {
377         assertSame(btn, btn.cancelButtonProperty().getBean());
378     }
379 
380     @Test public void cancelButtonPropertyHasName() {
381         assertEquals(&quot;cancelButton&quot;, btn.cancelButtonProperty().getName());
382     }
383 
384     @Test public void cancelButtonCanBeInvokeAfterRemovingFromTheScene_RT22106() {
385         btn.setCancelButton(true);
386         btn.setOnAction(actionEvent -&gt; {
387             fail();
388         });
389         root.getChildren().add(btn);
390         show();
391 
392         root.getChildren().remove(btn);
393 
394         KeyEventFirer keyboard = new KeyEventFirer(root);
395         keyboard.doKeyPress(KeyCode.ESCAPE);
396 
397         tk.firePulse();
398     }
399 
400 
401     @Test public void conextMenuShouldntShowOnAction() {
402         ContextMenu popupMenu = new ContextMenu();
403         MenuItem item1 = new MenuItem(&quot;_About&quot;);
404         popupMenu.getItems().add(item1);
405         popupMenu.setOnShown(w -&gt; {
406             fail();
407         });
408 
409         btn.setContextMenu(popupMenu);
410         btn.setDefaultButton(true);
411 
412         root.getChildren().add(btn);
413         show();
414 
415         // None of these should cause the context menu to appear,
416         // so fire them all, and see if anything happens.
417         KeyEventFirer keyboard = new KeyEventFirer(btn);
418         keyboard.doKeyPress(KeyCode.ENTER);
419 
420         btn.fireEvent(new ActionEvent());
421         btn.fire();
422 
423         mouse.fireMousePressed();
424         mouse.fireMouseReleased();
425         mouse.fireMouseClicked();
426     }
427 
428     private int count = 0;
429     @Test public void contextMenuShouldShowOnInSomeCircumstances() {
430         ContextMenu popupMenu = new ContextMenu();
431         MenuItem item1 = new MenuItem(&quot;_About&quot;);
432         popupMenu.getItems().add(item1);
433         popupMenu.setOnShown(w -&gt; {
434             count++;
435         });
436 
437         btn.setContextMenu(popupMenu);
438         btn.setDefaultButton(true);
439 
440         root.getChildren().add(btn);
441         show();
442 
443         btn.setOnAction(event -&gt; {
444             fail();
445         });
446 
447         assertEquals(0, count);
448 
449         /* Note that right-mouse press events don&#39;t force the popup open */
450         mouse.fireMousePressed(MouseButton.SECONDARY);
451         assertEquals(0, count);
452 
453         mouse.fireMouseClicked(MouseButton.SECONDARY);
454         assertEquals(0, count);
455 
456         mouse.fireMouseReleased(MouseButton.SECONDARY);
457         assertEquals(0, count);
458 
459         /* Only context menu events force it to appear */
460         ContextMenuEventFirer.fireContextMenuEvent(btn);
461         assertEquals(1, count);
462     }
463 
464     static class MyButton extends Button {
465         MyButton(String text) {
466             super(text);
467         }
468 
469         void setHoverPseudoclassState(boolean b) {
470             setHover(b);
471         }
472     }
473 
474     List&lt;Stop&gt; getStops(Button button) {
475         Skin skin = button.getSkin();
476         Region region = (Region)skin.getNode();
477         List&lt;BackgroundFill&gt; fills = region.getBackground().getFills();
478         BackgroundFill top = fills.get(fills.size()-1);
479         LinearGradient topFill = (LinearGradient)top.getFill();
480         return topFill.getStops();
481     }
482 
483     @Test
484     public void testRT_23207() {
485 
486         HBox hBox = new HBox();
487         hBox.setSpacing(5);
488         hBox.setTranslateY(30);
489         MyButton red = new MyButton(&quot;Red&quot;);
490         red.setStyle(&quot;-fx-base: red;&quot;);
491         MyButton green = new MyButton(&quot;Green&quot;);
492         green.setStyle(&quot;-fx-base: green;&quot;);
493         hBox.getChildren().add(red);
494         hBox.getChildren().add(green);
495 
496         Scene scene = new Scene(hBox, 500, 300);
497         Stage stage = new Stage();
498         stage.setScene(scene);
499         stage.show();
500 
501         Toolkit.getToolkit().firePulse();
502 
503         List&lt;Stop&gt; redStops0 = getStops(red);
504         List&lt;Stop&gt; greenStops0 = getStops(green);
505 
506         red.setHoverPseudoclassState(true);
507 
508         Toolkit.getToolkit().firePulse();
509 
510         List&lt;Stop&gt; redStops1 = getStops(red);
511         List&lt;Stop&gt; greenStops1 = getStops(green);
512 
513         red.setHoverPseudoclassState(false);
514         green.setHoverPseudoclassState(true);
515 
516         Toolkit.getToolkit().firePulse();
517 
518         List&lt;Stop&gt; redStops2 = getStops(red);
519         List&lt;Stop&gt; greenStops2 = getStops(green);
520 
521         green.setHoverPseudoclassState(false);
522 
523         Toolkit.getToolkit().firePulse();
524 
525         List&lt;Stop&gt; redStops3 = getStops(red);
526         List&lt;Stop&gt; greenStops3 = getStops(green);
527 
528         // did red change color after red hover=true?
529         assertFalse(redStops0.equals(redStops1));
530         // did red change back to original color after green hover=true?
531         assertTrue(redStops0.equals(redStops2));
532         // did red stay original color after green hover=false?
533         assertTrue(redStops0.equals(redStops3));
534         // did green stay green after red hover=true?
535         assertTrue(greenStops0.equals(greenStops1));
536         // did green change after green hover=true?
537         assertFalse(greenStops0.equals(greenStops2));
538         // did green revert to original after green hover=false?
539         // This is the acid test. If this fails, then RT-23207 is present.
540         assertTrue(greenStops0.equals(greenStops3));
541 
542     }
543 
544 
545 //  private Button button1;
546 //  private Button button2;
547 //
548 //  @Override protected Node createNodeToTest() {
549 //    button1 = createButton(&quot;Button1&quot;);
550 //    button2 = createButton(&quot;Button2&quot;);
551 //    button2.setLayoutX(0);
552 //    button2.setLayoutY(110);
553 //    Group group = new Group();
554 //    group.getChildren().addAll(button1, button2);
555 //    group.setAutoSizeChildren(false);
556 //    return group;
557 //  }
558 //
559 //  private static Button createButton(String text) {
560 //    Button button = new Button(text);
561 //    button.resize(100, 100);
562 //    return button;
563 //  }
564 //
565 //  @Test public void pressEventsShouldLeadToFocusGained() {
566 //    mouse().positionAtCenterOf(button2);
567 //    mouse().leftPress();
568 //    assertTrue(button2.isFocused());
569 //  }
570 //
571 //  @Test public void pressEventsShouldLeadToFocusGained_efficiently() {
572 //    executeInUIThread(new Runnable() {
573 //      @Override public void run() {
574 //        mouse().positionAtCenterOf(button2);
575 //        mouse().leftPress();
576 //      }
577 //    });
578 //    assertTrue(button2.isFocused());
579 //  }
580 }
    </pre>
  </body>
</html>