<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.graphics/src/main/native-glass/ios/GlassViewDelegate.m</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="GlassApplication.m.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="common.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/native-glass/ios/GlassViewDelegate.m</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
358         env,
359         jGestureSupportClass,
360         jGestureSupportRotateGesturePerformed,
361         self.jView,
362         modifiers,
363         (jint)viewPoint.x, (jint)viewPoint.y,
364         (jint)basePoint.x, (jint)basePoint.y,
365         rotation
366     );
367 
368     [sender setRotation:0.0];
369 
370     if (sender.state == UIGestureRecognizerStateEnded) {
371         [self sendJavaGestureEndEvent:viewPoint];
372     }
373 
374     GLASS_CHECK_EXCEPTION(env);
375 }
376 
377 













378 - (id)initWithView:(UIScrollView*)view withJview:(jobject)jview
379 {
380     self = [super init];
381     if (self != nil)
382     {
383         GET_MAIN_JENV;
384 
385         // Owner View
386         self.uiView = view; // native side
387         self.uiView.delegate = self;
388         self.jView = (*env)-&gt;NewGlobalRef(env, jview); // java side
389 
390         // Ensure JNI stuff related to gesture processing is ready
391         if (NULL == jGestureSupportClass) {
392             [GlassHelper ClassForName:&quot;com.sun.glass.ui.ios.IosGestureSupport&quot; withEnv:env];
393         }
394         self.touches = NULL;
395         self.lastTouchId = 0;
396 
397         mouseTouch = nil;
</pre>
<hr />
<pre>
405         [pinchGesture setCancelsTouchesInView:NO];
406         [pinchGesture setDelaysTouchesEnded:NO];
407         [pinchGesture setDelaysTouchesBegan:NO];
408         [self.uiView addGestureRecognizer:pinchGesture];
409         [pinchGesture setDelegate:ggDelegate];
410         [pinchGesture release];
411         //Rotation
412         UIRotationGestureRecognizer *rotateGesture =
413             [[UIRotationGestureRecognizer alloc] initWithTarget:self action:@selector(handleRotateGesture:)];
414         [rotateGesture setCancelsTouchesInView:NO];
415         [rotateGesture setDelaysTouchesEnded:NO];
416         [rotateGesture setDelaysTouchesBegan:NO];
417         [self.uiView addGestureRecognizer:rotateGesture];
418         [rotateGesture setDelegate:ggDelegate];
419         [rotateGesture release];
420         //Scrolling
421         UIPanGestureRecognizer * panGestureRecognizer = self.uiView.panGestureRecognizer;
422         [panGestureRecognizer setCancelsTouchesInView:NO];
423         [panGestureRecognizer setDelaysTouchesBegan:NO];
424         [panGestureRecognizer setDelaysTouchesEnded:NO];









425     }
426     return self;
427 }
428 
429 
430 - (void)dealloc
431 {
432     GET_MAIN_JENV;
433     (*env)-&gt;DeleteGlobalRef(env, self.jView);
434     self.jView = NULL;
435     self.delegate = nil;
436     self.touches = NULL;
437 
438     [super dealloc];
439 }
440 
441 
442 - (void)viewDidMoveToWindow
443 {
444     GLASS_LOG(&quot;viewDidMoveToWindow; self: %@&quot;, self);
</pre>
<hr />
<pre>
534     switch (type) {
535             // prepare GlassDragDelegate for possible drag,
536         case com_sun_glass_events_MouseEvent_DOWN:
537         case com_sun_glass_events_MouseEvent_DRAG:
538             DNDLOG(@&quot;mouse type ==  com_sun_glass_events_MouseEvent_DRAG  %d&quot;,type ==  com_sun_glass_events_MouseEvent_DRAG);
539             [GlassDragDelegate setDelegate:self];
540             // fall through to save the lastEvent
541             // or for filtering out duplicate MOVE events
542         case com_sun_glass_events_MouseEvent_MOVE:
543             self.lastEventPoint = CGPointMake(viewPoint.x, viewPoint.y);
544             break;
545 
546       }
547 
548 
549     GET_MAIN_JENV;
550     (*env)-&gt;CallVoidMethod(env, self.jView, mat_jViewNotifyMouse, type, button,
551                            (jint)viewPoint.x, (jint)viewPoint.y, (jint)viewPoint.x, (jint)viewPoint.y,
552                            modifiers, isPopupTrigger, isSynthesized);
553     GLASS_CHECK_EXCEPTION(env);







554 }
555 
556 
557 - (void)sendJavaKeyEventWithType:(int)type keyCode:(int)code unicode:(int)unicode modifiers:(int)modif
558 {
559     GET_MAIN_JENV;
560 
561     (*env)-&gt;CallVoidMethod(env, self.jView, mat_jViewNotifyKey, type, code, unicode, modif);
562 
563     GLASS_CHECK_EXCEPTION(env);
564 }
565 
566 -(void) sendJavaInputMethodEvent:(NSString *) text clauseBoundary:(int[])clsBndr attrBoundary:(int[])attrBndr attrValue:(Byte[])attrVal
567             committedTextLength:(int)cmtdTxtLen caretPos:(int)crtPos visiblePos:(int)visPos
568 {
569     GET_MAIN_JENV;
570 
571     jsize buflen = [text length];
572     unichar buffer[buflen];
573     [text getCharacters:buffer];
</pre>
</td>
<td>
<hr />
<pre>
358         env,
359         jGestureSupportClass,
360         jGestureSupportRotateGesturePerformed,
361         self.jView,
362         modifiers,
363         (jint)viewPoint.x, (jint)viewPoint.y,
364         (jint)basePoint.x, (jint)basePoint.y,
365         rotation
366     );
367 
368     [sender setRotation:0.0];
369 
370     if (sender.state == UIGestureRecognizerStateEnded) {
371         [self sendJavaGestureEndEvent:viewPoint];
372     }
373 
374     GLASS_CHECK_EXCEPTION(env);
375 }
376 
377 
<span class="line-added">378 - (void)handleLongPressGesture:(UILongPressGestureRecognizer*)sender {</span>
<span class="line-added">379     if (sender.state == UIGestureRecognizerStateBegan) {</span>
<span class="line-added">380         // Simulate right-click</span>
<span class="line-added">381         CGPoint viewPoint = [sender locationInView:self.uiView.superview];</span>
<span class="line-added">382         [self sendJavaMouseEvent:viewPoint type:com_sun_glass_events_MouseEvent_ENTER button:com_sun_glass_events_MouseEvent_BUTTON_NONE];</span>
<span class="line-added">383         [self sendJavaMouseEvent:viewPoint type:com_sun_glass_events_MouseEvent_DOWN button:com_sun_glass_events_MouseEvent_BUTTON_RIGHT];</span>
<span class="line-added">384     } else if (sender.state == UIGestureRecognizerStateEnded) {</span>
<span class="line-added">385         // Prevent touch ended event</span>
<span class="line-added">386         self.mouseTouch = nil;</span>
<span class="line-added">387     }</span>
<span class="line-added">388 }</span>
<span class="line-added">389 </span>
<span class="line-added">390 </span>
391 - (id)initWithView:(UIScrollView*)view withJview:(jobject)jview
392 {
393     self = [super init];
394     if (self != nil)
395     {
396         GET_MAIN_JENV;
397 
398         // Owner View
399         self.uiView = view; // native side
400         self.uiView.delegate = self;
401         self.jView = (*env)-&gt;NewGlobalRef(env, jview); // java side
402 
403         // Ensure JNI stuff related to gesture processing is ready
404         if (NULL == jGestureSupportClass) {
405             [GlassHelper ClassForName:&quot;com.sun.glass.ui.ios.IosGestureSupport&quot; withEnv:env];
406         }
407         self.touches = NULL;
408         self.lastTouchId = 0;
409 
410         mouseTouch = nil;
</pre>
<hr />
<pre>
418         [pinchGesture setCancelsTouchesInView:NO];
419         [pinchGesture setDelaysTouchesEnded:NO];
420         [pinchGesture setDelaysTouchesBegan:NO];
421         [self.uiView addGestureRecognizer:pinchGesture];
422         [pinchGesture setDelegate:ggDelegate];
423         [pinchGesture release];
424         //Rotation
425         UIRotationGestureRecognizer *rotateGesture =
426             [[UIRotationGestureRecognizer alloc] initWithTarget:self action:@selector(handleRotateGesture:)];
427         [rotateGesture setCancelsTouchesInView:NO];
428         [rotateGesture setDelaysTouchesEnded:NO];
429         [rotateGesture setDelaysTouchesBegan:NO];
430         [self.uiView addGestureRecognizer:rotateGesture];
431         [rotateGesture setDelegate:ggDelegate];
432         [rotateGesture release];
433         //Scrolling
434         UIPanGestureRecognizer * panGestureRecognizer = self.uiView.panGestureRecognizer;
435         [panGestureRecognizer setCancelsTouchesInView:NO];
436         [panGestureRecognizer setDelaysTouchesBegan:NO];
437         [panGestureRecognizer setDelaysTouchesEnded:NO];
<span class="line-added">438         //LongPress</span>
<span class="line-added">439         UILongPressGestureRecognizer *longPressGesture =</span>
<span class="line-added">440             [[UILongPressGestureRecognizer alloc] initWithTarget:self action:@selector(handleLongPressGesture:)];</span>
<span class="line-added">441         [longPressGesture setCancelsTouchesInView:NO];</span>
<span class="line-added">442         [longPressGesture setDelaysTouchesEnded:NO];</span>
<span class="line-added">443         [longPressGesture setDelaysTouchesBegan:NO];</span>
<span class="line-added">444         [self.uiView addGestureRecognizer:longPressGesture];</span>
<span class="line-added">445         [longPressGesture setDelegate:ggDelegate];</span>
<span class="line-added">446         [longPressGesture release];</span>
447     }
448     return self;
449 }
450 
451 
452 - (void)dealloc
453 {
454     GET_MAIN_JENV;
455     (*env)-&gt;DeleteGlobalRef(env, self.jView);
456     self.jView = NULL;
457     self.delegate = nil;
458     self.touches = NULL;
459 
460     [super dealloc];
461 }
462 
463 
464 - (void)viewDidMoveToWindow
465 {
466     GLASS_LOG(&quot;viewDidMoveToWindow; self: %@&quot;, self);
</pre>
<hr />
<pre>
556     switch (type) {
557             // prepare GlassDragDelegate for possible drag,
558         case com_sun_glass_events_MouseEvent_DOWN:
559         case com_sun_glass_events_MouseEvent_DRAG:
560             DNDLOG(@&quot;mouse type ==  com_sun_glass_events_MouseEvent_DRAG  %d&quot;,type ==  com_sun_glass_events_MouseEvent_DRAG);
561             [GlassDragDelegate setDelegate:self];
562             // fall through to save the lastEvent
563             // or for filtering out duplicate MOVE events
564         case com_sun_glass_events_MouseEvent_MOVE:
565             self.lastEventPoint = CGPointMake(viewPoint.x, viewPoint.y);
566             break;
567 
568       }
569 
570 
571     GET_MAIN_JENV;
572     (*env)-&gt;CallVoidMethod(env, self.jView, mat_jViewNotifyMouse, type, button,
573                            (jint)viewPoint.x, (jint)viewPoint.y, (jint)viewPoint.x, (jint)viewPoint.y,
574                            modifiers, isPopupTrigger, isSynthesized);
575     GLASS_CHECK_EXCEPTION(env);
<span class="line-added">576 </span>
<span class="line-added">577     if (isPopupTrigger) {</span>
<span class="line-added">578         jboolean isKeyboardTrigger = JNI_FALSE;</span>
<span class="line-added">579         (*env)-&gt;CallVoidMethod(env, self.jView, mat_jViewNotifyMenu,</span>
<span class="line-added">580                                (jint)viewPoint.x, (jint)viewPoint.y, (jint)viewPoint.x, (jint)viewPoint.y, isKeyboardTrigger);</span>
<span class="line-added">581         GLASS_CHECK_EXCEPTION(env);</span>
<span class="line-added">582     }</span>
583 }
584 
585 
586 - (void)sendJavaKeyEventWithType:(int)type keyCode:(int)code unicode:(int)unicode modifiers:(int)modif
587 {
588     GET_MAIN_JENV;
589 
590     (*env)-&gt;CallVoidMethod(env, self.jView, mat_jViewNotifyKey, type, code, unicode, modif);
591 
592     GLASS_CHECK_EXCEPTION(env);
593 }
594 
595 -(void) sendJavaInputMethodEvent:(NSString *) text clauseBoundary:(int[])clsBndr attrBoundary:(int[])attrBndr attrValue:(Byte[])attrVal
596             committedTextLength:(int)cmtdTxtLen caretPos:(int)crtPos visiblePos:(int)visPos
597 {
598     GET_MAIN_JENV;
599 
600     jsize buflen = [text length];
601     unichar buffer[buflen];
602     [text getCharacters:buffer];
</pre>
</td>
</tr>
</table>
<center><a href="GlassApplication.m.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="common.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>