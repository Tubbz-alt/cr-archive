<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff tests/system/src/testscriptapp1/java/mymod/myapp1/FXMLScriptDeployment.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> <a href="../pseudoScriptEngine/InvocationInfos.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>tests/system/src/testscriptapp1/java/mymod/myapp1/FXMLScriptDeployment.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 84             ex.printStackTrace(System.err);
 85             System.exit(ERROR_UNEXPECTED_EXCEPTION);
 86         }
 87         System.exit(ERROR_NONE);    // not in stop() method as we need to run the assertions first
 88     }
 89 
 90     @Override
 91     public void start(Stage mainStage) {
 92         URL fxmlUrl = null;
 93         Parent rootNode = null;
 94         Scene scene = null;
 95         Button btn = null;
 96         try {
 97              fxmlUrl = Util.getURL(FXMLScriptDeployment.class, &quot;demo_01&quot;);
 98              rootNode = FXMLLoader.load(fxmlUrl);
 99              scene = new Scene(rootNode);
100              btn = (Button) scene.lookup(&quot;#idButton&quot;);
101         }
102         catch (Exception ioe) {
103             ioe.printStackTrace();
<span class="line-modified">104             System.exit(-1);</span>
105         }
106             // fire three events on the button
107         btn.fire();
108         btn.fireEvent(new ActionEvent());
<span class="line-modified">109         btn.fireEvent(new MouseEvent( MouseEvent.MOUSE_CLICKED,</span>
110                                        0,       // double x,
111                                        0,       // double y,
112                                        0,       // double screenX,
113                                        0,       // double screenY,
114                                        MouseButton.PRIMARY,         // MouseButton button,
115                                        0,       // int clickCount,
116                                        false,   // boolean shiftDown,
117                                        false,   // boolean controlDown,
118                                        false,   // boolean altDown,
119                                        false,   // boolean metaDown,
120                                        true,    // boolean primaryButtonDown,
121                                        false,   // boolean middleButtonDown,
122                                        false,   // boolean secondaryButtonDown,
123                                        false,   // boolean synthesized,
124                                        false,   // boolean popupTrigger,
125                                        false,   // boolean stillSincePress,
126                                        null     // PickResult pickResult
127                                      )
128                       );
129 
</pre>
<hr />
<pre>
165 
166         final String FILENAME = &quot;javax.script.filename&quot;;
167         final String ARGV = &quot;javax.script.argv&quot;;
168         final String EVENT = &quot;event&quot;;
169         final String IDBUTTON = &quot;idButton&quot;;
170         final String IDROOT = &quot;idRoot&quot;;
171         final String LOCATION = &quot;location&quot;;    // always FXML File hosting script controller code
172         final String RESOURCES = &quot;resources&quot;;   // always null in this test
173 
174         for (Integer invocation = 1; invocation &lt;= invocationList.size(); invocation++) {
175             InvocationInfos entry = (InvocationInfos) invocationList.get(invocation - 1);
176             String script = entry.script;
177             TreeMap&lt;Integer,TreeMap&gt; scopes = (TreeMap) entry.bindings;
178 
179             TreeMap&lt;String,Object&gt; engineBindings = scopes.get(100);
180             TreeMap&lt;String,Object&gt; globalBindings = scopes.get(200);
181 
182             Object obj = null;
183             Button btn = null;
184 
<span class="line-modified">185                 // global Bindings</span>
186             Util.assertExists(IDROOT + &quot; in global scope Bindings&quot;, globalBindings.containsKey(IDROOT));
187             obj = globalBindings.get(IDROOT);
188             Util.assertType(IDROOT, AnchorPane.class, obj);
189 
190             Util.assertExists(LOCATION + &quot; in global scope Bindings&quot;, globalBindings.containsKey(LOCATION));
191             obj = globalBindings.get(LOCATION);
192             Util.assertType(LOCATION, URL.class, obj);
193 
194             Util.assertExists(RESOURCES + &quot; in global scope Bindings&quot;, globalBindings.containsKey(RESOURCES));
195             obj = globalBindings.get(RESOURCES);
196             Util.assertNull(RESOURCES,obj);
197 
198             if (invocation == 1) {
199                 Util.assertNotExists(IDBUTTON + &quot; in global scope Bindings&quot;, globalBindings.containsKey(IDBUTTON));
200             }
201             else {
202                 Util.assertExists(IDBUTTON + &quot; in global scope Bindings&quot;, globalBindings.containsKey(IDBUTTON));
203                 obj = globalBindings.get(IDBUTTON);
204                 Util.assertType(IDBUTTON, Button.class, obj);
205                 btn = (Button) obj;
206             }
207 
<span class="line-modified">208                 // engine Bindings</span>
209             Util.assertExists(FILENAME + &quot; in engine scope Bindings&quot;, engineBindings.containsKey(FILENAME));
210             if (invocation &lt; 7) {  // no event objects, no arguments
211                 Util.assertNotExists(ARGV + &quot; in engine scope Bindings&quot;, engineBindings.containsKey(ARGV));
212                 Util.assertNotExists(EVENT + &quot; in engine scope Bindings&quot;, engineBindings.containsKey(EVENT));
213             }
214             else {    // this has events on the Button
215                 Util.assertExists(ARGV + &quot; in engine scope Bindings&quot;, engineBindings.containsKey(ARGV));
216                 Object[] argv = (Object[]) engineBindings.get(ARGV);
217 
218                 Util.assertExists(EVENT + &quot; in engine scope Bindings&quot;, engineBindings.containsKey(EVENT));
219                 obj = engineBindings.get(EVENT);
220 
221                 Util.assertSame(&quot;argv[0] == event&quot;, argv[0], obj);
222 
223                 if (invocation == 9) {
224                     Util.assertType(EVENT, MouseEvent.class, obj);
225                     MouseEvent ev = (MouseEvent) obj;
226                     Util.assertSame(&quot;MouseEvent.getSource() == btn&quot;, ev.getSource(), btn);
227                     Util.assertSame(&quot;MouseEvent.MOUSE_CLICKED&quot;, MouseEvent.MOUSE_CLICKED, ev.getEventType());
<span class="line-modified">228                 }</span>
<span class="line-removed">229                 else {</span>
230                     Util.assertType(EVENT, ActionEvent.class, obj);
231                     ActionEvent ev = (ActionEvent) obj;
232                     Util.assertSame(&quot;ActionEvent.getSource() == btn&quot;, ev.getSource(), btn);
233                 }
234             }
235 
236             // check filename and script
237             String filename = (String) engineBindings.get(FILENAME);
238             boolean ok = false;
239             switch (invocation) {
240                 case 1:
241                     Util.assertEndsWith  (&quot;demo_01_topscript.rpsl&quot;, filename);
242                     Util.assertStartsWith(&quot;demo_01_topscript.rpsl file - pseudo script&quot;, script);
243                     break;
244 
245                 case 2:
246                     Util.assertEndsWith  (&quot;demo_01_middlescript.rpsl&quot;, filename);
247                     Util.assertStartsWith(&quot;demo_01_middlescript.rpsl file - pseudo script&quot;, script);
248                     break;
249 
</pre>
</td>
<td>
<hr />
<pre>
 84             ex.printStackTrace(System.err);
 85             System.exit(ERROR_UNEXPECTED_EXCEPTION);
 86         }
 87         System.exit(ERROR_NONE);    // not in stop() method as we need to run the assertions first
 88     }
 89 
 90     @Override
 91     public void start(Stage mainStage) {
 92         URL fxmlUrl = null;
 93         Parent rootNode = null;
 94         Scene scene = null;
 95         Button btn = null;
 96         try {
 97              fxmlUrl = Util.getURL(FXMLScriptDeployment.class, &quot;demo_01&quot;);
 98              rootNode = FXMLLoader.load(fxmlUrl);
 99              scene = new Scene(rootNode);
100              btn = (Button) scene.lookup(&quot;#idButton&quot;);
101         }
102         catch (Exception ioe) {
103             ioe.printStackTrace();
<span class="line-modified">104             System.exit(ERROR_UNEXPECTED_EXCEPTION);</span>
105         }
106             // fire three events on the button
107         btn.fire();
108         btn.fireEvent(new ActionEvent());
<span class="line-modified">109         btn.fireEvent(new MouseEvent(MouseEvent.MOUSE_CLICKED,</span>
110                                        0,       // double x,
111                                        0,       // double y,
112                                        0,       // double screenX,
113                                        0,       // double screenY,
114                                        MouseButton.PRIMARY,         // MouseButton button,
115                                        0,       // int clickCount,
116                                        false,   // boolean shiftDown,
117                                        false,   // boolean controlDown,
118                                        false,   // boolean altDown,
119                                        false,   // boolean metaDown,
120                                        true,    // boolean primaryButtonDown,
121                                        false,   // boolean middleButtonDown,
122                                        false,   // boolean secondaryButtonDown,
123                                        false,   // boolean synthesized,
124                                        false,   // boolean popupTrigger,
125                                        false,   // boolean stillSincePress,
126                                        null     // PickResult pickResult
127                                      )
128                       );
129 
</pre>
<hr />
<pre>
165 
166         final String FILENAME = &quot;javax.script.filename&quot;;
167         final String ARGV = &quot;javax.script.argv&quot;;
168         final String EVENT = &quot;event&quot;;
169         final String IDBUTTON = &quot;idButton&quot;;
170         final String IDROOT = &quot;idRoot&quot;;
171         final String LOCATION = &quot;location&quot;;    // always FXML File hosting script controller code
172         final String RESOURCES = &quot;resources&quot;;   // always null in this test
173 
174         for (Integer invocation = 1; invocation &lt;= invocationList.size(); invocation++) {
175             InvocationInfos entry = (InvocationInfos) invocationList.get(invocation - 1);
176             String script = entry.script;
177             TreeMap&lt;Integer,TreeMap&gt; scopes = (TreeMap) entry.bindings;
178 
179             TreeMap&lt;String,Object&gt; engineBindings = scopes.get(100);
180             TreeMap&lt;String,Object&gt; globalBindings = scopes.get(200);
181 
182             Object obj = null;
183             Button btn = null;
184 
<span class="line-modified">185             // global Bindings</span>
186             Util.assertExists(IDROOT + &quot; in global scope Bindings&quot;, globalBindings.containsKey(IDROOT));
187             obj = globalBindings.get(IDROOT);
188             Util.assertType(IDROOT, AnchorPane.class, obj);
189 
190             Util.assertExists(LOCATION + &quot; in global scope Bindings&quot;, globalBindings.containsKey(LOCATION));
191             obj = globalBindings.get(LOCATION);
192             Util.assertType(LOCATION, URL.class, obj);
193 
194             Util.assertExists(RESOURCES + &quot; in global scope Bindings&quot;, globalBindings.containsKey(RESOURCES));
195             obj = globalBindings.get(RESOURCES);
196             Util.assertNull(RESOURCES,obj);
197 
198             if (invocation == 1) {
199                 Util.assertNotExists(IDBUTTON + &quot; in global scope Bindings&quot;, globalBindings.containsKey(IDBUTTON));
200             }
201             else {
202                 Util.assertExists(IDBUTTON + &quot; in global scope Bindings&quot;, globalBindings.containsKey(IDBUTTON));
203                 obj = globalBindings.get(IDBUTTON);
204                 Util.assertType(IDBUTTON, Button.class, obj);
205                 btn = (Button) obj;
206             }
207 
<span class="line-modified">208             // engine Bindings</span>
209             Util.assertExists(FILENAME + &quot; in engine scope Bindings&quot;, engineBindings.containsKey(FILENAME));
210             if (invocation &lt; 7) {  // no event objects, no arguments
211                 Util.assertNotExists(ARGV + &quot; in engine scope Bindings&quot;, engineBindings.containsKey(ARGV));
212                 Util.assertNotExists(EVENT + &quot; in engine scope Bindings&quot;, engineBindings.containsKey(EVENT));
213             }
214             else {    // this has events on the Button
215                 Util.assertExists(ARGV + &quot; in engine scope Bindings&quot;, engineBindings.containsKey(ARGV));
216                 Object[] argv = (Object[]) engineBindings.get(ARGV);
217 
218                 Util.assertExists(EVENT + &quot; in engine scope Bindings&quot;, engineBindings.containsKey(EVENT));
219                 obj = engineBindings.get(EVENT);
220 
221                 Util.assertSame(&quot;argv[0] == event&quot;, argv[0], obj);
222 
223                 if (invocation == 9) {
224                     Util.assertType(EVENT, MouseEvent.class, obj);
225                     MouseEvent ev = (MouseEvent) obj;
226                     Util.assertSame(&quot;MouseEvent.getSource() == btn&quot;, ev.getSource(), btn);
227                     Util.assertSame(&quot;MouseEvent.MOUSE_CLICKED&quot;, MouseEvent.MOUSE_CLICKED, ev.getEventType());
<span class="line-modified">228                 } else {</span>

229                     Util.assertType(EVENT, ActionEvent.class, obj);
230                     ActionEvent ev = (ActionEvent) obj;
231                     Util.assertSame(&quot;ActionEvent.getSource() == btn&quot;, ev.getSource(), btn);
232                 }
233             }
234 
235             // check filename and script
236             String filename = (String) engineBindings.get(FILENAME);
237             boolean ok = false;
238             switch (invocation) {
239                 case 1:
240                     Util.assertEndsWith  (&quot;demo_01_topscript.rpsl&quot;, filename);
241                     Util.assertStartsWith(&quot;demo_01_topscript.rpsl file - pseudo script&quot;, script);
242                     break;
243 
244                 case 2:
245                     Util.assertEndsWith  (&quot;demo_01_middlescript.rpsl&quot;, filename);
246                     Util.assertStartsWith(&quot;demo_01_middlescript.rpsl file - pseudo script&quot;, script);
247                     break;
248 
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> <a href="../pseudoScriptEngine/InvocationInfos.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>