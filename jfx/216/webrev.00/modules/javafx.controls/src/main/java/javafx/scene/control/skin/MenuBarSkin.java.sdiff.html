<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.controls/src/main/java/javafx/scene/control/skin/MenuBarSkin.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../test/java/test/javafx/scene/control/MenuBarTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.controls/src/main/java/javafx/scene/control/skin/MenuBarSkin.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 287                                 Menu menuToOpen = getSkinnable().getMenus().get(focusedMenuIndex);
 288                                 showMenu(menuToOpen, true);
 289                                 event.consume();
 290                             }
 291                         }
 292                         break;
 293                     case ESCAPE:
 294                         unSelectMenus();
 295                         event.consume();
 296                         break;
 297                 default:
 298                     break;
 299                 }
 300             }
 301         };
 302         menuBarFocusedPropertyListener = (ov, t, t1) -&gt; {
 303             if (t1) {
 304                 // RT-23147 when MenuBar&#39;s focusTraversable is true the first
 305                 // menu will visually indicate focus
 306                 unSelectMenus();
<span class="line-modified"> 307                 menuModeStart(0);</span>
<span class="line-modified"> 308                 openMenuButton = ((MenuBarButton)container.getChildren().get(0));</span>
<span class="line-modified"> 309                 setFocusedMenuIndex(0);</span>
<span class="line-modified"> 310                 openMenuButton.setHover();</span>


 311             } else {
 312                 unSelectMenus();
 313              }
 314          };
 315         weakSceneKeyEventHandler = new WeakEventHandler&lt;KeyEvent&gt;(keyEventHandler);
 316         Utils.executeOnceWhenPropertyIsNonNull(control.sceneProperty(), (Scene scene) -&gt; {
 317             scene.addEventFilter(KeyEvent.KEY_PRESSED, weakSceneKeyEventHandler);
 318         });
 319 
 320         // When we click else where in the scene - menu selection should be cleared.
 321         mouseEventHandler = t -&gt; {
 322             Bounds containerScreenBounds = container.localToScreen(container.getLayoutBounds());
 323             if (containerScreenBounds == null || !containerScreenBounds.contains(t.getScreenX(), t.getScreenY())) {
 324                 unSelectMenus();
 325             }
 326         };
 327         weakSceneMouseEventHandler = new WeakEventHandler&lt;MouseEvent&gt;(mouseEventHandler);
 328         Utils.executeOnceWhenPropertyIsNonNull(control.sceneProperty(), (Scene scene) -&gt; {
 329             scene.addEventFilter(MouseEvent.MOUSE_CLICKED, weakSceneMouseEventHandler);
 330         });
</pre>
<hr />
<pre>
 458             openMenu.hide();
 459         }
 460 
 461         openMenu = menu;
 462         if (!menu.isShowing() &amp;&amp; !isMenuEmpty(menu)) {
 463             if (selectFirstItem) {
 464                 // put selection / focus on first item in menu
 465                 MenuButton menuButton = getNodeForMenu(focusedMenuIndex);
 466                 Skin&lt;?&gt; skin = menuButton.getSkin();
 467                 if (skin instanceof MenuButtonSkinBase) {
 468                     ((MenuButtonSkinBase)skin).requestFocusOnFirstMenuItem();
 469                 }
 470             }
 471 
 472             openMenu.show();
 473         }
 474     }
 475 
 476     private void setFocusedMenuIndex(int index) {
 477         this.focusedMenuIndex = index;
<span class="line-modified"> 478         focusedMenu = index == -1 ? null : getSkinnable().getMenus().get(index);</span>




 479 
 480         if (focusedMenu != null &amp;&amp; focusedMenuIndex != -1) {
 481             openMenuButton = (MenuBarButton)container.getChildren().get(focusedMenuIndex);
 482             openMenuButton.setHover();
 483         }
 484     }
 485 
 486 
 487 
 488     /***************************************************************************
 489      *                                                                         *
 490      * Static methods                                                          *
 491      *                                                                         *
 492      **************************************************************************/
 493 
 494     // RT-22480: This is intended as private API for SceneBuilder,
 495     // pending fix for RT-19857: Keeping menu in the Mac menu bar when
 496     // there is no more stage
 497     /**
 498      * Set the default system menu bar. This allows an application to keep menu
</pre>
</td>
<td>
<hr />
<pre>
 287                                 Menu menuToOpen = getSkinnable().getMenus().get(focusedMenuIndex);
 288                                 showMenu(menuToOpen, true);
 289                                 event.consume();
 290                             }
 291                         }
 292                         break;
 293                     case ESCAPE:
 294                         unSelectMenus();
 295                         event.consume();
 296                         break;
 297                 default:
 298                     break;
 299                 }
 300             }
 301         };
 302         menuBarFocusedPropertyListener = (ov, t, t1) -&gt; {
 303             if (t1) {
 304                 // RT-23147 when MenuBar&#39;s focusTraversable is true the first
 305                 // menu will visually indicate focus
 306                 unSelectMenus();
<span class="line-modified"> 307                 if (!container.getChildren().isEmpty()) {</span>
<span class="line-modified"> 308                     menuModeStart(0);</span>
<span class="line-modified"> 309                     openMenuButton = ((MenuBarButton)container.getChildren().get(0));</span>
<span class="line-modified"> 310                     setFocusedMenuIndex(0);</span>
<span class="line-added"> 311                     openMenuButton.setHover();</span>
<span class="line-added"> 312                 }</span>
 313             } else {
 314                 unSelectMenus();
 315              }
 316          };
 317         weakSceneKeyEventHandler = new WeakEventHandler&lt;KeyEvent&gt;(keyEventHandler);
 318         Utils.executeOnceWhenPropertyIsNonNull(control.sceneProperty(), (Scene scene) -&gt; {
 319             scene.addEventFilter(KeyEvent.KEY_PRESSED, weakSceneKeyEventHandler);
 320         });
 321 
 322         // When we click else where in the scene - menu selection should be cleared.
 323         mouseEventHandler = t -&gt; {
 324             Bounds containerScreenBounds = container.localToScreen(container.getLayoutBounds());
 325             if (containerScreenBounds == null || !containerScreenBounds.contains(t.getScreenX(), t.getScreenY())) {
 326                 unSelectMenus();
 327             }
 328         };
 329         weakSceneMouseEventHandler = new WeakEventHandler&lt;MouseEvent&gt;(mouseEventHandler);
 330         Utils.executeOnceWhenPropertyIsNonNull(control.sceneProperty(), (Scene scene) -&gt; {
 331             scene.addEventFilter(MouseEvent.MOUSE_CLICKED, weakSceneMouseEventHandler);
 332         });
</pre>
<hr />
<pre>
 460             openMenu.hide();
 461         }
 462 
 463         openMenu = menu;
 464         if (!menu.isShowing() &amp;&amp; !isMenuEmpty(menu)) {
 465             if (selectFirstItem) {
 466                 // put selection / focus on first item in menu
 467                 MenuButton menuButton = getNodeForMenu(focusedMenuIndex);
 468                 Skin&lt;?&gt; skin = menuButton.getSkin();
 469                 if (skin instanceof MenuButtonSkinBase) {
 470                     ((MenuButtonSkinBase)skin).requestFocusOnFirstMenuItem();
 471                 }
 472             }
 473 
 474             openMenu.show();
 475         }
 476     }
 477 
 478     private void setFocusedMenuIndex(int index) {
 479         this.focusedMenuIndex = index;
<span class="line-modified"> 480         focusedMenu = null;</span>
<span class="line-added"> 481 </span>
<span class="line-added"> 482         if (index != -1 &amp;&amp; !(getSkinnable().getMenus().isEmpty())) {</span>
<span class="line-added"> 483             focusedMenu = getSkinnable().getMenus().get(index);</span>
<span class="line-added"> 484         }</span>
 485 
 486         if (focusedMenu != null &amp;&amp; focusedMenuIndex != -1) {
 487             openMenuButton = (MenuBarButton)container.getChildren().get(focusedMenuIndex);
 488             openMenuButton.setHover();
 489         }
 490     }
 491 
 492 
 493 
 494     /***************************************************************************
 495      *                                                                         *
 496      * Static methods                                                          *
 497      *                                                                         *
 498      **************************************************************************/
 499 
 500     // RT-22480: This is intended as private API for SceneBuilder,
 501     // pending fix for RT-19857: Keeping menu in the Mac menu bar when
 502     // there is no more stage
 503     /**
 504      * Set the default system menu bar. This allows an application to keep menu
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../test/java/test/javafx/scene/control/MenuBarTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>