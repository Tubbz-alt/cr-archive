<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.controls/src/test/java/test/javafx/scene/control/SelectionFocusModelMemoryTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>modules/javafx.controls/src/test/java/test/javafx/scene/control/SelectionFocusModelMemoryTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
179         control.setSelectionModel(replacingSm);
180         attemptGC(weakRef, 10);
181         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
182     }
183 
184     @Test
185     public void testListViewSelectionModel() {
186         ListView&lt;String&gt; control = new ListView&lt;&gt;(FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;));
187         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
188         MultipleSelectionModel&lt;String&gt; replacingSm = ListViewShim.getListViewBitSetSelectionModel(control);
189         maybeShowControl(control);
190         control.setSelectionModel(replacingSm);
191         attemptGC(weakRef, 10);
192         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
193     }
194 
195     @Test
196     public void testTabPaneSelectionModel() {
197         // FIXME
198         // can&#39;t formally ignore just one parameter, so backing out if showBeforeReplaceSM
<span class="line-modified">199         // has its own issue https://bugs.openjdk.java.net/browse/JDK-8241737</span>
<span class="line-removed">200         if (showBeforeReplaceSM) return;</span>
201         TabPane control = new TabPane();
202         ObservableList&lt;String&gt; data = FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;);
<span class="line-modified">203         data.forEach(text -&gt; control.getTabs().add(new Tab(&quot;text&quot;)));</span>
204         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
205         SingleSelectionModel&lt;Tab&gt; replacingSm = TabPaneShim.getTabPaneSelectionModel(control);
206         maybeShowControl(control);
207         control.setSelectionModel(replacingSm);
208         attemptGC(weakRef, 10);
209         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
210     }
211 
212     @Test
213     public void testComboBoxSelectionModel() {
214         ComboBox&lt;String&gt; control = new ComboBox&lt;&gt;(FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;));
215         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
216         SingleSelectionModel&lt;String&gt; replacingSm = ComboBoxShim.get_ComboBoxSelectionModel(control);
217         maybeShowControl(control);
218         control.setSelectionModel(replacingSm);
219         attemptGC(weakRef, 10);
220         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
221     }
222 
223     @Test
224     public void testChoiceBoxSelectionModel() {
225         // FIXME
226         // can&#39;t formally ignore just one parameter, so backing out if showBeforeReplaceSM
<span class="line-modified">227         // will be fixed as side-effect of skin cleanup in https://bugs.openjdk.java.net/browse/JDK-8087555</span>
<span class="line-modified">228         if (showBeforeReplaceSM) return;</span>
229         ChoiceBox&lt;String&gt; control = new ChoiceBox&lt;&gt;(FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;));
230         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
231         SingleSelectionModel&lt;String&gt; replacingSm = ChoiceBoxShim.get_ChoiceBoxSelectionModel(control);
232         maybeShowControl(control);
233         control.setSelectionModel(replacingSm);
234         attemptGC(weakRef, 10);
235         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
236     }
237 
238     private void attemptGC(WeakReference&lt;?&gt; weakRef, int n) {
239         // Attempt gc n times
240         for (int i = 0; i &lt; n; i++) {
241             System.gc();
242             System.runFinalization();
243 
244             if (weakRef.get() == null) {
245                 break;
246             }
247             try {
248                 Thread.sleep(500);
</pre>
</td>
<td>
<hr />
<pre>
179         control.setSelectionModel(replacingSm);
180         attemptGC(weakRef, 10);
181         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
182     }
183 
184     @Test
185     public void testListViewSelectionModel() {
186         ListView&lt;String&gt; control = new ListView&lt;&gt;(FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;));
187         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
188         MultipleSelectionModel&lt;String&gt; replacingSm = ListViewShim.getListViewBitSetSelectionModel(control);
189         maybeShowControl(control);
190         control.setSelectionModel(replacingSm);
191         attemptGC(weakRef, 10);
192         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
193     }
194 
195     @Test
196     public void testTabPaneSelectionModel() {
197         // FIXME
198         // can&#39;t formally ignore just one parameter, so backing out if showBeforeReplaceSM
<span class="line-modified">199         if (showBeforeReplaceSM) return; //@Ignore(&quot;8241737&quot;)</span>

200         TabPane control = new TabPane();
201         ObservableList&lt;String&gt; data = FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;);
<span class="line-modified">202         data.forEach(text -&gt; control.getTabs().add(new Tab(text)));</span>
203         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
204         SingleSelectionModel&lt;Tab&gt; replacingSm = TabPaneShim.getTabPaneSelectionModel(control);
205         maybeShowControl(control);
206         control.setSelectionModel(replacingSm);
207         attemptGC(weakRef, 10);
208         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
209     }
210 
211     @Test
212     public void testComboBoxSelectionModel() {
213         ComboBox&lt;String&gt; control = new ComboBox&lt;&gt;(FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;));
214         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
215         SingleSelectionModel&lt;String&gt; replacingSm = ComboBoxShim.get_ComboBoxSelectionModel(control);
216         maybeShowControl(control);
217         control.setSelectionModel(replacingSm);
218         attemptGC(weakRef, 10);
219         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
220     }
221 
222     @Test
223     public void testChoiceBoxSelectionModel() {
224         // FIXME
225         // can&#39;t formally ignore just one parameter, so backing out if showBeforeReplaceSM
<span class="line-modified">226         // will be fixed as side-effect of skin cleanup</span>
<span class="line-modified">227         if (showBeforeReplaceSM) return; //@Ignore(&quot;8087555&quot;)</span>
228         ChoiceBox&lt;String&gt; control = new ChoiceBox&lt;&gt;(FXCollections.observableArrayList(&quot;Apple&quot;, &quot;Orange&quot;, &quot;Banana&quot;));
229         WeakReference&lt;SelectionModel&lt;?&gt;&gt; weakRef = new WeakReference&lt;&gt;(control.getSelectionModel());
230         SingleSelectionModel&lt;String&gt; replacingSm = ChoiceBoxShim.get_ChoiceBoxSelectionModel(control);
231         maybeShowControl(control);
232         control.setSelectionModel(replacingSm);
233         attemptGC(weakRef, 10);
234         assertNull(&quot;selectionModel must be gc&#39;ed&quot;, weakRef.get());
235     }
236 
237     private void attemptGC(WeakReference&lt;?&gt; weakRef, int n) {
238         // Attempt gc n times
239         for (int i = 0; i &lt; n; i++) {
240             System.gc();
241             System.runFinalization();
242 
243             if (weakRef.get() == null) {
244                 break;
245             }
246             try {
247                 Thread.sleep(500);
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>