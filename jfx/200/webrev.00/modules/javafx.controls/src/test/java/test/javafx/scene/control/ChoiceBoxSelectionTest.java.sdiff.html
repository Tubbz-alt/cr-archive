<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.controls/src/test/java/test/javafx/scene/control/ChoiceBoxSelectionTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../main/java/javafx/scene/control/ChoiceBox.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>modules/javafx.controls/src/test/java/test/javafx/scene/control/ChoiceBoxSelectionTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package test.javafx.scene.control;
 27 
 28 import java.util.List;
 29 
 30 import org.junit.After;
 31 import org.junit.Before;
<span class="line-removed"> 32 import org.junit.Ignore;</span>
 33 import org.junit.Test;
 34 
 35 import static org.junit.Assert.*;
 36 
 37 import javafx.collections.FXCollections;
 38 import javafx.scene.Node;
 39 import javafx.scene.Scene;
 40 import javafx.scene.control.ChoiceBox;
 41 import javafx.scene.control.ContextMenu;
 42 import javafx.scene.control.Control;
 43 import javafx.scene.control.MenuItem;
 44 import javafx.scene.control.RadioMenuItem;
 45 import javafx.scene.control.Separator;
 46 import javafx.scene.control.SingleSelectionModel;
 47 import javafx.scene.control.skin.ChoiceBoxSkin;
 48 import javafx.scene.control.skin.ChoiceBoxSkinNodesShim;
 49 import javafx.scene.layout.Pane;
 50 import javafx.scene.layout.VBox;
 51 import javafx.stage.Stage;
 52 
 53 /**
<span class="line-modified"> 54  * Temporary collection of tests around state of toggle in popup.</span>
 55  * &lt;p&gt;
 56  *


 57  * Note that the selection should be correct even if the
<span class="line-modified"> 58  * popup has not yet been shown! That&#39;s hampered by JDK-8242489 (see</span>
<span class="line-removed"> 59  * analysis in bug).</span>
 60  *
 61  * &lt;p&gt;
 62  * Need to test (testBaseToggle):
 63  * a) initial sync of selection state: selected toggle must be that of selectedIndex or none
 64  * b) change selection state after skin: selected toggle must follow
 65  *




 66  */
 67 public class ChoiceBoxSelectionTest {
 68     private Scene scene;
 69     private Stage stage;
 70     private Pane root;
 71 
 72     private ChoiceBox&lt;String&gt; box;
 73 
 74     private String uncontained;
 75 
 76     /**
 77      * selected index taken by toggle when popup open
 78      */
 79     @Test
 80     public void testBaseToggleInitialSelectOpenPopup() {
 81         SingleSelectionModel&lt;String&gt; sm = box.getSelectionModel();
 82         int selectedIndex = box.getItems().size() - 1;
 83         sm.select(selectedIndex);
 84         showChoiceBox();
 85         box.show();
</pre>
<hr />
<pre>
249 
250     protected void assertToggleSelected(ChoiceBox&lt;?&gt; box, int selectedIndex) {
251         boolean isSelected = selectedIndex &gt;= 0;
252         ContextMenu popup = ChoiceBoxSkinNodesShim.getChoiceBoxPopup((ChoiceBoxSkin&lt;?&gt;) box.getSkin());
253         for (int i = 0; i &lt; popup.getItems().size(); i++) {
254             boolean shouldBeSelected = isSelected ? selectedIndex == i : false;
255             MenuItem item = popup.getItems().get(i);
256             if (item instanceof RadioMenuItem) {
257                 RadioMenuItem selectedToggle = (RadioMenuItem) popup.getItems().get(i);
258                 assertEquals(&quot;toggle &quot; + selectedToggle.getText() + &quot; at index: &quot; + i + &quot; must be selected: &quot; + shouldBeSelected,
259                         shouldBeSelected,
260                         selectedToggle.isSelected());
261             }
262         }
263     }
264 
265     protected void assertToggleSelected(int selectedIndex) {
266         assertToggleSelected(box, selectedIndex);
267     }
268 
<span class="line-modified">269     //------------- ignored tests, other issues</span>
270 
<span class="line-removed">271     /**</span>
<span class="line-removed">272      * Issue &quot;8241999&quot;: toggle not unselected on setting uncontained value.</span>
<span class="line-removed">273      */</span>
274     @Test
<span class="line-removed">275     @Ignore(&quot;8241999&quot;)</span>
276     public void testSyncedToggleUncontainedValue() {
277         SingleSelectionModel&lt;String&gt; sm = box.getSelectionModel();
278         sm.select(2);
279         showChoiceBox();
280         box.setValue(uncontained);
281         assertToggleSelected(-1);
282     }
283 
284     /**
285      * Base reason for &quot;8241999&quot;: selected index not sync&#39;ed.
286      */
287     @Test
<span class="line-removed">288     @Ignore(&quot;8241999&quot;)</span>
289     public void testSyncedSelectedIndexUncontained() {
290         box.setValue(box.getItems().get(1));
291         box.setValue(uncontained);
<span class="line-modified">292         assertEquals(-1, box.getSelectionModel().getSelectedIndex());</span>























293     }
294 

295     //----------- setup and sanity test for initial state
296 
297     @Test
298     public void testSetupState() {
299         assertNotNull(box);
300         showChoiceBox();
301         List&lt;Node&gt; expected = List.of(box);
302         assertEquals(expected, root.getChildren());
303     }
304 
305     protected void showChoiceBox() {
306         showControl(box);
307     }
308 
309     protected void showControl(Control box) {
310         if (!root.getChildren().contains(box)) {
311             root.getChildren().add(box);
312         }
313         stage.show();
314         stage.requestFocus();
</pre>
</td>
<td>
<hr />
<pre>
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package test.javafx.scene.control;
 27 
 28 import java.util.List;
 29 
 30 import org.junit.After;
 31 import org.junit.Before;

 32 import org.junit.Test;
 33 
 34 import static org.junit.Assert.*;
 35 
 36 import javafx.collections.FXCollections;
 37 import javafx.scene.Node;
 38 import javafx.scene.Scene;
 39 import javafx.scene.control.ChoiceBox;
 40 import javafx.scene.control.ContextMenu;
 41 import javafx.scene.control.Control;
 42 import javafx.scene.control.MenuItem;
 43 import javafx.scene.control.RadioMenuItem;
 44 import javafx.scene.control.Separator;
 45 import javafx.scene.control.SingleSelectionModel;
 46 import javafx.scene.control.skin.ChoiceBoxSkin;
 47 import javafx.scene.control.skin.ChoiceBoxSkinNodesShim;
 48 import javafx.scene.layout.Pane;
 49 import javafx.scene.layout.VBox;
 50 import javafx.stage.Stage;
 51 
 52 /**
<span class="line-modified"> 53  * Collection of tests around state related to selection.</span>
 54  * &lt;p&gt;
 55  *
<span class="line-added"> 56  * Tests that toggles are un/selected as required (JDK-8242489).</span>
<span class="line-added"> 57  *</span>
 58  * Note that the selection should be correct even if the
<span class="line-modified"> 59  * popup has not yet been shown.</span>

 60  *
 61  * &lt;p&gt;
 62  * Need to test (testBaseToggle):
 63  * a) initial sync of selection state: selected toggle must be that of selectedIndex or none
 64  * b) change selection state after skin: selected toggle must follow
 65  *
<span class="line-added"> 66  * &lt;p&gt;</span>
<span class="line-added"> 67  *</span>
<span class="line-added"> 68  * Tests around selectedIndex and uncontained value (testSynced).</span>
<span class="line-added"> 69  *</span>
 70  */
 71 public class ChoiceBoxSelectionTest {
 72     private Scene scene;
 73     private Stage stage;
 74     private Pane root;
 75 
 76     private ChoiceBox&lt;String&gt; box;
 77 
 78     private String uncontained;
 79 
 80     /**
 81      * selected index taken by toggle when popup open
 82      */
 83     @Test
 84     public void testBaseToggleInitialSelectOpenPopup() {
 85         SingleSelectionModel&lt;String&gt; sm = box.getSelectionModel();
 86         int selectedIndex = box.getItems().size() - 1;
 87         sm.select(selectedIndex);
 88         showChoiceBox();
 89         box.show();
</pre>
<hr />
<pre>
253 
254     protected void assertToggleSelected(ChoiceBox&lt;?&gt; box, int selectedIndex) {
255         boolean isSelected = selectedIndex &gt;= 0;
256         ContextMenu popup = ChoiceBoxSkinNodesShim.getChoiceBoxPopup((ChoiceBoxSkin&lt;?&gt;) box.getSkin());
257         for (int i = 0; i &lt; popup.getItems().size(); i++) {
258             boolean shouldBeSelected = isSelected ? selectedIndex == i : false;
259             MenuItem item = popup.getItems().get(i);
260             if (item instanceof RadioMenuItem) {
261                 RadioMenuItem selectedToggle = (RadioMenuItem) popup.getItems().get(i);
262                 assertEquals(&quot;toggle &quot; + selectedToggle.getText() + &quot; at index: &quot; + i + &quot; must be selected: &quot; + shouldBeSelected,
263                         shouldBeSelected,
264                         selectedToggle.isSelected());
265             }
266         }
267     }
268 
269     protected void assertToggleSelected(int selectedIndex) {
270         assertToggleSelected(box, selectedIndex);
271     }
272 
<span class="line-modified">273     //------------- tests for JDK-8241999</span>
274 



275     @Test

276     public void testSyncedToggleUncontainedValue() {
277         SingleSelectionModel&lt;String&gt; sm = box.getSelectionModel();
278         sm.select(2);
279         showChoiceBox();
280         box.setValue(uncontained);
281         assertToggleSelected(-1);
282     }
283 
284     /**
285      * Base reason for &quot;8241999&quot;: selected index not sync&#39;ed.
286      */
287     @Test

288     public void testSyncedSelectedIndexUncontained() {
289         box.setValue(box.getItems().get(1));
290         box.setValue(uncontained);
<span class="line-modified">291         assertEquals(&quot;selectedIndex for uncontained value &quot;, -1, box.getSelectionModel().getSelectedIndex());</span>
<span class="line-added">292     }</span>
<span class="line-added">293 </span>
<span class="line-added">294     /**</span>
<span class="line-added">295      * From review of JDK-8087555:</span>
<span class="line-added">296      * select contained -&gt; select uncontained -&gt; clearselection -&gt; nulls value</span>
<span class="line-added">297      */</span>
<span class="line-added">298     @Test</span>
<span class="line-added">299     public void testSyncedSelectedOnPreselectedThenUncontained() {</span>
<span class="line-added">300         box.setValue(box.getItems().get(1));</span>
<span class="line-added">301         box.setValue(uncontained);</span>
<span class="line-added">302         box.getSelectionModel().clearSelection();</span>
<span class="line-added">303         assertEquals(&quot;uncontained value must be unchanged after clearSelection&quot;, uncontained, box.getValue());</span>
<span class="line-added">304     }</span>
<span class="line-added">305 </span>
<span class="line-added">306     /**</span>
<span class="line-added">307      * From review of JDK-8087555:</span>
<span class="line-added">308      * select uncontained -&gt; clearselection -&gt; nulls value</span>
<span class="line-added">309      */</span>
<span class="line-added">310     @Test</span>
<span class="line-added">311     public void testSyncedClearSelectionUncontained() {</span>
<span class="line-added">312         box.setValue(uncontained);</span>
<span class="line-added">313         box.getSelectionModel().clearSelection();</span>
<span class="line-added">314         assertEquals(uncontained, box.getValue());</span>
315     }
316 
<span class="line-added">317 </span>
318     //----------- setup and sanity test for initial state
319 
320     @Test
321     public void testSetupState() {
322         assertNotNull(box);
323         showChoiceBox();
324         List&lt;Node&gt; expected = List.of(box);
325         assertEquals(expected, root.getChildren());
326     }
327 
328     protected void showChoiceBox() {
329         showControl(box);
330     }
331 
332     protected void showControl(Control box) {
333         if (!root.getChildren().contains(box)) {
334             root.getChildren().add(box);
335         }
336         stage.show();
337         stage.requestFocus();
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../main/java/javafx/scene/control/ChoiceBox.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>