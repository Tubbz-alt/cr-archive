<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff tests/system/src/test/java/test/javafx/scene/control/ProgressIndicatorLeakTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>tests/system/src/test/java/test/javafx/scene/control/ProgressIndicatorLeakTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 70             });
 71             primaryStage.show();
 72         }
 73     }
 74 
 75     @BeforeClass
 76     public static void initFX() throws Exception {
 77         startupLatch = new CountDownLatch(1);
 78         new Thread(() -&gt; Application.launch(TestApp.class, (String[]) null)).start();
 79         Assert.assertTrue(&quot;Timeout waiting for FX runtime to start&quot;, startupLatch.await(15, TimeUnit.SECONDS));
 80     }
 81 
 82     @Test
 83     public void memoryTest() throws Exception {
 84         assertCollectable(detIndicator);
 85     }
 86 
 87     public static void assertCollectable(WeakReference weakReference) throws Exception {
 88         int counter = 0;
 89 
<span class="line-removed"> 90         createGarbage();</span>
 91         System.gc();
 92         System.runFinalization();
 93 
 94         while (counter &lt; 10 &amp;&amp; weakReference.get() != null) {
 95             Thread.sleep(100);
 96             counter = counter + 1;
<span class="line-removed"> 97             createGarbage();</span>
 98             System.gc();
 99             System.runFinalization();
100         }
101 
102         Assert.assertNull(weakReference.get());
103     }
<span class="line-removed">104     public static void createGarbage() {</span>
<span class="line-removed">105         LinkedList list = new LinkedList&lt;Integer&gt;();</span>
<span class="line-removed">106         int counter = 0;</span>
<span class="line-removed">107         while (counter &lt; 999999) {</span>
<span class="line-removed">108             counter += 1;</span>
<span class="line-removed">109             list.add(1);</span>
<span class="line-removed">110         }</span>
<span class="line-removed">111     }</span>
112 
113     @AfterClass
114     public static void teardownOnce() {
115         Platform.runLater(() -&gt; {
116             stage.hide();
117             Platform.exit();
118         });
119     }
120 }
</pre>
</td>
<td>
<hr />
<pre>
 70             });
 71             primaryStage.show();
 72         }
 73     }
 74 
 75     @BeforeClass
 76     public static void initFX() throws Exception {
 77         startupLatch = new CountDownLatch(1);
 78         new Thread(() -&gt; Application.launch(TestApp.class, (String[]) null)).start();
 79         Assert.assertTrue(&quot;Timeout waiting for FX runtime to start&quot;, startupLatch.await(15, TimeUnit.SECONDS));
 80     }
 81 
 82     @Test
 83     public void memoryTest() throws Exception {
 84         assertCollectable(detIndicator);
 85     }
 86 
 87     public static void assertCollectable(WeakReference weakReference) throws Exception {
 88         int counter = 0;
 89 

 90         System.gc();
 91         System.runFinalization();
 92 
 93         while (counter &lt; 10 &amp;&amp; weakReference.get() != null) {
 94             Thread.sleep(100);
 95             counter = counter + 1;

 96             System.gc();
 97             System.runFinalization();
 98         }
 99 
100         Assert.assertNull(weakReference.get());
101     }








102 
103     @AfterClass
104     public static void teardownOnce() {
105         Platform.runLater(() -&gt; {
106             stage.hide();
107             Platform.exit();
108         });
109     }
110 }
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>