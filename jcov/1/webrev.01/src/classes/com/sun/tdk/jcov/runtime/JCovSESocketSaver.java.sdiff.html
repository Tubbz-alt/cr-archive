<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/classes/com/sun/tdk/jcov/runtime/JCovSESocketSaver.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="CollectDetect.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="JCovServerSocketSaver.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/classes/com/sun/tdk/jcov/runtime/JCovSESocketSaver.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 26 
 27 import java.io.DataOutputStream;
 28 import java.io.File;
 29 import java.io.FileInputStream;
 30 import java.net.Socket;
 31 import java.net.URL;
 32 import java.net.UnknownHostException;
 33 import java.util.Properties;
 34 
 35 /**
 36  *
 37  * @author Sergey Borodin
 38  */
 39 public class JCovSESocketSaver extends JCovSocketSaver {
 40 
 41     public static final String NETWORK_DEF_PROPERTIES_FILENAME = &quot;jcov_network_default.properties&quot;;
 42     public static final String PORT_PROPERTIES_NAME = &quot;port&quot;;
 43     public static final String HOST_PROPERTIES_NAME = &quot;host&quot;;
 44 
 45     static {
<span class="line-modified"> 46 </span>
 47         File file = null;
 48         String urlString = &quot;&quot;;
<span class="line-modified"> 49         URL url = ClassLoader.getSystemClassLoader().getResource(JCovSESocketSaver.class.getCanonicalName().replaceAll(&quot;\\.&quot;, &quot;/&quot;) + &quot;.class&quot;);</span>






 50         if (url != null) {
 51             urlString = url.toString();
 52             if (urlString.contains(&quot;file:&quot;) &amp;&amp; urlString.contains(&quot;!&quot;)) {
 53                 urlString = urlString.substring(urlString.indexOf(&quot;file:&quot;), urlString.indexOf(&#39;!&#39;));
 54             }
 55             urlString = urlString.replaceAll(&quot;jrt:&quot;, &quot;file:&quot;);
 56             try {
 57                 url = new URL(urlString);
 58                 file = new File(url.toURI());
 59             } catch (Exception e) {
 60                 System.err.println(&quot;Error while finding &quot; + urlString + &quot; file: &quot; + e);
 61             }
 62         }
 63 
<span class="line-modified"> 64         if (file == null){</span>
<span class="line-modified"> 65             file = new File(System.getProperty(&quot;java.home&quot;)+File.separator + NETWORK_DEF_PROPERTIES_FILENAME);</span>





 66         }
 67 
 68         if (file != null &amp;&amp; file.exists()) {
 69 
<span class="line-modified"> 70             File defProperties = new File(file.getParent() + File.separator + NETWORK_DEF_PROPERTIES_FILENAME);</span>


 71 
 72             if (defProperties.exists()) {
 73 
 74                 Properties prop = new Properties();
 75 
 76                 try {
 77                     prop.load(new FileInputStream(defProperties));
 78                     if (prop.getProperty(PORT_PROPERTIES_NAME) != null) {
 79                         setDefaultPort(Integer.valueOf(prop.getProperty(PORT_PROPERTIES_NAME)));
 80                     }
 81                     if (prop.getProperty(HOST_PROPERTIES_NAME) != null) {
 82                         setDefaultHost(prop.getProperty(HOST_PROPERTIES_NAME));
 83                     }
 84                 } catch (Exception e) {
 85                     System.err.println(&quot;Error while reading &quot; + defProperties.getAbsolutePath() + &quot; file: &quot; + e);
 86                 }
 87             }
 88         }
 89 
 90     }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 26 
 27 import java.io.DataOutputStream;
 28 import java.io.File;
 29 import java.io.FileInputStream;
 30 import java.net.Socket;
 31 import java.net.URL;
 32 import java.net.UnknownHostException;
 33 import java.util.Properties;
 34 
 35 /**
 36  *
 37  * @author Sergey Borodin
 38  */
 39 public class JCovSESocketSaver extends JCovSocketSaver {
 40 
 41     public static final String NETWORK_DEF_PROPERTIES_FILENAME = &quot;jcov_network_default.properties&quot;;
 42     public static final String PORT_PROPERTIES_NAME = &quot;port&quot;;
 43     public static final String HOST_PROPERTIES_NAME = &quot;host&quot;;
 44 
 45     static {
<span class="line-modified"> 46         URL url = null;</span>
 47         File file = null;
 48         String urlString = &quot;&quot;;
<span class="line-modified"> 49         try {</span>
<span class="line-added"> 50             url = ClassLoader.getSystemClassLoader().getResource(</span>
<span class="line-added"> 51                     JCovSESocketSaver.class.</span>
<span class="line-added"> 52                             getCanonicalName().</span>
<span class="line-added"> 53                             replace(&#39;.&#39;, &#39;/&#39;) + &quot;.class&quot;);</span>
<span class="line-added"> 54         } catch( Exception ignore ) {</span>
<span class="line-added"> 55         }</span>
 56         if (url != null) {
 57             urlString = url.toString();
 58             if (urlString.contains(&quot;file:&quot;) &amp;&amp; urlString.contains(&quot;!&quot;)) {
 59                 urlString = urlString.substring(urlString.indexOf(&quot;file:&quot;), urlString.indexOf(&#39;!&#39;));
 60             }
 61             urlString = urlString.replaceAll(&quot;jrt:&quot;, &quot;file:&quot;);
 62             try {
 63                 url = new URL(urlString);
 64                 file = new File(url.toURI());
 65             } catch (Exception e) {
 66                 System.err.println(&quot;Error while finding &quot; + urlString + &quot; file: &quot; + e);
 67             }
 68         }
 69 
<span class="line-modified"> 70         if (file == null) {</span>
<span class="line-modified"> 71             try {</span>
<span class="line-added"> 72                 file = new File(System.getProperty(&quot;java.home&quot;) +</span>
<span class="line-added"> 73                         File.separator +</span>
<span class="line-added"> 74                         NETWORK_DEF_PROPERTIES_FILENAME);</span>
<span class="line-added"> 75             } catch( Exception ignore ) {</span>
<span class="line-added"> 76             }</span>
 77         }
 78 
 79         if (file != null &amp;&amp; file.exists()) {
 80 
<span class="line-modified"> 81             File defProperties = new File(file.getParent() +</span>
<span class="line-added"> 82                     File.separator +</span>
<span class="line-added"> 83                     NETWORK_DEF_PROPERTIES_FILENAME);</span>
 84 
 85             if (defProperties.exists()) {
 86 
 87                 Properties prop = new Properties();
 88 
 89                 try {
 90                     prop.load(new FileInputStream(defProperties));
 91                     if (prop.getProperty(PORT_PROPERTIES_NAME) != null) {
 92                         setDefaultPort(Integer.valueOf(prop.getProperty(PORT_PROPERTIES_NAME)));
 93                     }
 94                     if (prop.getProperty(HOST_PROPERTIES_NAME) != null) {
 95                         setDefaultHost(prop.getProperty(HOST_PROPERTIES_NAME));
 96                     }
 97                 } catch (Exception e) {
 98                     System.err.println(&quot;Error while reading &quot; + defProperties.getAbsolutePath() + &quot; file: &quot; + e);
 99                 }
100             }
101         }
102 
103     }
</pre>
</td>
</tr>
</table>
<center><a href="CollectDetect.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="JCovServerSocketSaver.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>